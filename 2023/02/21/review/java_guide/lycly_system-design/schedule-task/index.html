<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Java定时任务详解">
<meta property="og:type" content="article">
<meta property="og:title" content="Java定时任务详解">
<meta property="og:url" content="http://example.com/2023/02/21/review/java_guide/lycly_system-design/schedule-task/index.html">
<meta property="og:site_name" content="随记">
<meta property="og:description" content="Java定时任务详解">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-02-21T09:17:31.000Z">
<meta property="article:modified_time" content="2023-02-21T09:17:31.000Z">
<meta property="article:author" content="刘易">
<meta property="article:tag" content="复习">
<meta property="article:tag" content="复习-javaGuide">
<meta property="article:tag" content="复习-javaGuide-distributed_system">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2023/02/21/review/java_guide/lycly_system-design/schedule-task/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Java定时任务详解 | 随记</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">随记</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/02/21/review/java_guide/lycly_system-design/schedule-task/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/lwmfjc/lwmfjc.github.io.resource/main/img/avatar.png">
      <meta itemprop="name" content="刘易">
      <meta itemprop="description" content="知命不惧 日日自新">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Java定时任务详解
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-02-21 09:17:31" itemprop="dateCreated datePublished" datetime="2023-02-21T09:17:31+00:00">2023-02-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">学习</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>8.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>15 分钟</span>
            </span>
            <div class="post-description">Java定时任务详解</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>转载自https://github.com/Snailclimb/JavaGuide（添加小部分笔记）感谢作者!</p>
</blockquote>
<h2 id="为什么需要定时任务">为什么需要定时任务？</h2>
<p>我们来看一下几个非常常见的业务场景：</p>
<ol type="1">
<li>某系统<strong>凌晨要进行数据备份</strong>。</li>
<li>某电商平台，用户<strong>下单半个小时未支付的情况下需要自动取消</strong>订单。</li>
<li>某媒体聚合平台，<strong>每 10
分钟动态抓取某某网站的数据</strong>为自己所用。</li>
<li>某博客平台，支持<strong>定时发送文章</strong>。</li>
<li>某基金平台，<strong>每晚定时计算用户当日收益情况并推送给用户最新的数据</strong>。</li>
<li>......</li>
</ol>
<p>这些场景往往都要求我们在某个特定的时间去做某个事情。</p>
<h2 id="单机定时任务技术选型">单机定时任务技术选型</h2>
<h3 id="timer">Timer</h3>
<p><code>java.util.Timer</code>是 JDK 1.3
开始就已经支持的一种定时任务的实现方式。</p>
<p><code>Timer</code> 内部使用一个叫做 <code>TaskQueue</code>
的类存放定时任务，它是一个<strong>基于最小堆实现的优先级队列</strong>。<code>TaskQueue</code>
会按照<strong>任务距离下一次执行时间的大小</strong>将任务排序，保证在堆顶的任务最先执行。这样在需要执行任务时，每次<strong>只需要取出堆顶的任务</strong>运行即可！</p>
<p><code>Timer</code> 使用起来比较简单，通过下面的方式我们就能创建一个
1s 之后执行的定时任务。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 示例代码：</span></span><br><span class="line"><span class="type">TimerTask</span> <span class="variable">task</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TimerTask</span>() &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;当前时间: &quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>() + <span class="string">&quot;n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;线程名称: &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">System.out.println(<span class="string">&quot;当前时间: &quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>() + <span class="string">&quot;n&quot;</span> +</span><br><span class="line">        <span class="string">&quot;线程名称: &quot;</span> + Thread.currentThread().getName());</span><br><span class="line"><span class="type">Timer</span> <span class="variable">timer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Timer</span>(<span class="string">&quot;Timer&quot;</span>);</span><br><span class="line"><span class="type">long</span> <span class="variable">delay</span> <span class="operator">=</span> <span class="number">1000L</span>;</span><br><span class="line">timer.schedule(task, delay);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//输出：</span></span><br><span class="line">当前时间: Fri May <span class="number">28</span> <span class="number">15</span>:<span class="number">18</span>:<span class="number">47</span> CST 2021n线程名称: main</span><br><span class="line">当前时间: Fri May <span class="number">28</span> <span class="number">15</span>:<span class="number">18</span>:<span class="number">48</span> CST 2021n线程名称: Timer</span><br></pre></td></tr></table></figure>
<p>不过其缺陷较多，比如一个 <code>Timer</code> 一个线程，这就导致
<code>Timer</code>
的任务的执行<strong>只能串行执行，一个任务执行时间过长的话会影响其他任务（性能非常差），再比如发生异常时任务直接停止（<code>Timer</code>
只捕获了 <code>InterruptedException</code> ）</strong>。</p>
<p><code>Timer</code> 类上的有一段注释是这样写的：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">* This class does not offer real-time guarantees: it schedules</span><br><span class="line">* tasks using the &lt;tt&gt;Object.wait(long)&lt;/tt&gt; method.</span><br><span class="line">*Java 5.0 introduced the &#123;@code java.util.concurrent&#125; package and</span><br><span class="line">* one of the concurrency utilities therein is the &#123;@link</span><br><span class="line">* java.util.concurrent.ScheduledThreadPoolExecutor</span><br><span class="line">* ScheduledThreadPoolExecutor&#125; which is a thread pool for repeatedly</span><br><span class="line">* executing tasks at a given rate or delay.  It is effectively a more</span><br><span class="line">* versatile replacement for the &#123;@code Timer&#125;/&#123;@code TimerTask&#125;</span><br><span class="line">* combination, as it allows multiple service threads, accepts various</span><br><span class="line">* time units, and doesn&#x27;t require subclassing &#123;@code TimerTask&#125; (just</span><br><span class="line">* implement &#123;@code Runnable&#125;).  Configuring &#123;@code</span><br><span class="line">* ScheduledThreadPoolExecutor&#125; with one thread makes it equivalent to</span><br><span class="line">* &#123;@code Timer&#125;.</span><br></pre></td></tr></table></figure>
<p>大概的意思就是： <strong><code>ScheduledThreadPoolExecutor</code>
支持多线程执行定时任务</strong>并且功能更强大，是 <code>Timer</code>
的替代品。</p>
<h3 id="scheduledexecutorservice">ScheduledExecutorService</h3>
<p><code>ScheduledExecutorService</code>
是一个接口，有多个实现类，比较常用的是
<code>ScheduledThreadPoolExecutor</code> 。</p>
<p><a
target="_blank" rel="noopener" href="https://camo.githubusercontent.com/8e9ea475f79f93c6d5f5fec2014e3c5c175723dec106891e21e9ef21a9a942ce/68747470733a2f2f67756964652d626c6f672d696d616765732e6f73732d636e2d7368656e7a68656e2e616c6979756e63732e636f6d2f6a61766167756964652f32303231303630373135343332343731322e706e67"><img
src="https://raw.githubusercontent.com/lwmfjc/lwmfjc.github.io.resource/main/img/image-20230221092054567.png"
alt="image-20230221092054567" /></a></p>
<p><code>ScheduledThreadPoolExecutor</code>
本身就是一个线程池，支持<strong>任务并发执行</strong>。并且，其内部使用
<strong><code>DelayedWorkQueue</code></strong> 作为任务队列。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 示例代码：</span></span><br><span class="line"><span class="type">TimerTask</span> <span class="variable">repeatedTask</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TimerTask</span>() &#123;</span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;当前时间: &quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>() + <span class="string">&quot;n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;线程名称: &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">System.out.println(<span class="string">&quot;当前时间: &quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>() + <span class="string">&quot;n&quot;</span> +</span><br><span class="line">        <span class="string">&quot;线程名称: &quot;</span> + Thread.currentThread().getName());</span><br><span class="line"><span class="type">ScheduledExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">3</span>);</span><br><span class="line"><span class="type">long</span> <span class="variable">delay</span>  <span class="operator">=</span> <span class="number">1000L</span>;</span><br><span class="line"><span class="type">long</span> <span class="variable">period</span> <span class="operator">=</span> <span class="number">1000L</span>;</span><br><span class="line">executor.scheduleAtFixedRate(repeatedTask, delay, period, TimeUnit.MILLISECONDS);</span><br><span class="line">Thread.sleep(delay + period * <span class="number">5</span>);</span><br><span class="line">executor.shutdown();</span><br><span class="line"><span class="comment">//输出：</span></span><br><span class="line">当前时间: Fri May <span class="number">28</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">46</span> CST 2021n线程名称: main</span><br><span class="line">当前时间: Fri May <span class="number">28</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">47</span> CST 2021n线程名称: pool-<span class="number">1</span>-thread-<span class="number">1</span></span><br><span class="line">当前时间: Fri May <span class="number">28</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">48</span> CST 2021n线程名称: pool-<span class="number">1</span>-thread-<span class="number">1</span></span><br><span class="line">当前时间: Fri May <span class="number">28</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">49</span> CST 2021n线程名称: pool-<span class="number">1</span>-thread-<span class="number">2</span></span><br><span class="line">当前时间: Fri May <span class="number">28</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">50</span> CST 2021n线程名称: pool-<span class="number">1</span>-thread-<span class="number">2</span></span><br><span class="line">当前时间: Fri May <span class="number">28</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">51</span> CST 2021n线程名称: pool-<span class="number">1</span>-thread-<span class="number">2</span></span><br><span class="line">当前时间: Fri May <span class="number">28</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">52</span> CST 2021n线程名称: pool-<span class="number">1</span>-thread-<span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>不论是使用 <code>Timer</code> 还是
<code>ScheduledExecutorService</code> 都无法使用 Cron
表达式指定任务执行的具体时间。</p>
<h3 id="spring-task">Spring Task</h3>
<blockquote>
<p><code>[krɑn] cron</code></p>
</blockquote>
<p><a
target="_blank" rel="noopener" href="https://camo.githubusercontent.com/a8cb6ddda53ca8db2fc78715cda20f4380b4076adf7500bf57a9b17bbb7dec09/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303532383134353035363838302e706e67"><img
src="https://raw.githubusercontent.com/lwmfjc/lwmfjc.github.io.resource/main/img/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303532383134353035363838302e706e67"
alt="img" /></a></p>
<p>我们直接通过 Spring 提供的 <code>@Scheduled</code>
注解即可定义定时任务，非常方便！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * cron：使用Cron表达式。　每分钟的1，2秒运行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Scheduled(cron = &quot;1-2 * * * * ? &quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reportCurrentTimeWithCronExpression</span><span class="params">()</span> &#123;</span><br><span class="line">  log.info(<span class="string">&quot;Cron Expression: The time is now &#123;&#125;&quot;</span>, dateFormat.format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我在大学那会做的一个 SSM 的企业级项目，就是用的 Spring Task
来做的定时任务。</p>
<p>并且，Spring Task 还是支持 <strong>Cron 表达式</strong> 的。Cron
表达式主要用于定时作业(定时任务)系统定义执行时间或执行频率的表达式，非常厉害，你可以通过
Cron
表达式进行设置定时任务每天或者每个月什么时候执行等等操作。咱们要学习定时任务的话，Cron
表达式是一定是要重点关注的。推荐一个在线 Cron
表达式生成器：http://cron.qqe2.com/ 。</p>
<p>但是，Spring
自带的定时调度只支持单机，并且提供的功能比较单一。之前写过一篇文章:<a
target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485563&amp;idx=1&amp;sn=7419341f04036a10b141b74624a3f8c9&amp;chksm=cea247b0f9d5cea6440759e6d49b4e77d06f4c99470243a10c1463834e873ca90266413fbc92&amp;token=2133161636&amp;lang=zh_CN#rd">《5
分钟搞懂如何在 Spring Boot 中 Schedule Tasks》</a>
，不了解的小伙伴可以参考一下。</p>
<p>Spring Task 底层是基于 JDK 的
<code>ScheduledThreadPoolExecutor</code> 线程池来实现的。</p>
<p><strong>优缺点总结：</strong></p>
<ul>
<li>优点： 简单，轻量，支持 Cron 表达式</li>
<li>缺点 ：功能单一</li>
</ul>
<h3 id="时间轮">时间轮</h3>
<p>Kafka、Dubbo、ZooKeeper、Netty 、Caffeine 、Akka
中都有对时间轮的实现。</p>
<p>时间轮简单来说就是一个环形的队列（底层一般基于数组实现），队列中的每一个元素（时间格）都可以存放一个定时任务列表。</p>
<p>时间轮中的每个时间格代表了时间轮的基本时间跨度或者说时间精度，加入时间一秒走一个时间格的话，那么这个时间轮的最高精度就是
1 秒（也就是说 3 s 和 3.9s 会在同一个时间格中）。</p>
<p>下图是一个有 12 个时间格的时间轮，转完一圈需要 12
s。当我们需要新建一个 3s 后执行的定时任务，只需要将定时任务放在下标为 3
的时间格中即可。当我们需要新建一个 9s
后执行的定时任务，只需要将定时任务放在下标为 9 的时间格中即可。</p>
<figure>
<img
src="https://raw.githubusercontent.com/lwmfjc/lwmfjc.github.io.resource/main/img/68747470733a2f2f67756964652d626c6f672d696d616765732e6f73732d636e2d7368656e7a68656e2e616c6979756e63732e636f6d2f6a61766167756964652f32303231303630373137313333343836312e706e67"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>那当我们需要创建一个 13s
后执行的定时任务怎么办呢？这个时候可以引入一叫做
<strong>圈数/轮数</strong> 的概念，也就是说这个任务还是放在下标为 3
的时间格中， 不过它的圈数为 2 。</p>
<p>除了增加圈数这种方法之外，还有一种 <strong>多层次时间轮</strong>
（类似手表），Kafka 采用的就是这种方案。</p>
<p>针对下图的时间轮，我来举一个例子便于大家理解。</p>
<figure>
<img
src="https://raw.githubusercontent.com/lwmfjc/lwmfjc.github.io.resource/main/img/68747470733a2f2f67756964652d626c6f672d696d616765732e6f73732d636e2d7368656e7a68656e2e616c6979756e63732e636f6d2f6a61766167756964652f32303231303630373139333034323135312e706e67"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>上图的时间轮，第 1 层的时间精度为 1 ，第 2 层的时间精度为 20 ，第 3
层的时间精度为 400。假如我们需要添加一个 350s 后执行的任务 A
的话（当前时间是 0s），这个任务会被放在第 2 层（因为第二层的时间跨度为
20*20=400&gt;350）的第 350/20=17 个时间格子。</p>
<p>当第一层转了 17 圈之后，时间过去了 340s ，第 2 层的指针此时来到第 17
个时间格子。此时，第 2 层第 17 个格子的任务会被移动到第 1 层。</p>
<p>任务 A 当前是 10s 之后执行，因此它会被移动到第 1 层的第 10
个时间格子。</p>
<p>这里在层与层之间的移动也叫做时间轮的升降级。参考手表来理解就好！</p>
<figure>
<img
src="https://raw.githubusercontent.com/lwmfjc/lwmfjc.github.io.resource/main/img/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303630373139353230363739372e706e67"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p><strong>时间轮比较适合任务数量比较多的定时任务场景，它的任务写入和执行的时间复杂度都是
0（1）。</strong></p>
<h2 id="分布式定时任务技术选型">分布式定时任务技术选型</h2>
<p>上面提到的一些定时任务的解决方案都是在单机下执行的，适用于比较简单的定时任务场景比如每天凌晨备份一次数据。</p>
<p>如果我们需要一些高级特性比如支持任务在分布式场景下的分片和高可用的话，我们就需要用到分布式任务调度框架了。</p>
<p>通常情况下，一个定时任务的执行往往涉及到下面这些角色：</p>
<ul>
<li><strong>任务</strong> ：
首先肯定是要执行的任务，这个任务就是具体的业务逻辑比如定时发送文章。</li>
<li><strong>调度器</strong>
：其次是调度中心，调度中心主要负责任务管理，会分配任务给执行器。</li>
<li><strong>执行器</strong> ：
最后就是执行器，执行器接收调度器分派的任务并执行。</li>
</ul>
<h3 id="quartz">Quartz</h3>
<figure>
<img
src="https://raw.githubusercontent.com/lwmfjc/lwmfjc.github.io.resource/main/img/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f323032313035323831343530323432352e706e67"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>一个很火的开源任务调度框架，完全由<code>Java</code>写成。<code>Quartz</code>
可以说是 Java
定时任务领域的老大哥或者说参考标准，其他的任务调度框架基本都是基于
<code>Quartz</code>
开发的，比如当当网的<code>elastic-job</code>就是基于<code>quartz</code>二次开发之后的分布式调度解决方案。</p>
<p>使用 <code>Quartz</code> 可以很方便地与 <code>Spring</code>
集成，并且支持动态添加任务和集群。但是，<code>Quartz</code>
使用起来也比较麻烦，API 繁琐。</p>
<p>并且，<code>Quzrtz</code> 并没有内置 UI 管理控制台，不过你可以使用 <a
target="_blank" rel="noopener" href="https://github.com/zhaopeiym/quartzui">quartzui</a>
这个开源项目来解决这个问题。</p>
<p>另外，<code>Quartz</code>
虽然也支持分布式任务。但是，它是在数据库层面，通过数据库的锁机制做的，有非常多的弊端比如系统侵入性严重、节点负载不均衡。有点伪分布式的味道。</p>
<p><strong>优缺点总结：</strong></p>
<ul>
<li>优点： 可以与 <code>Spring</code>
集成，并且支持动态添加任务和集群。</li>
<li>缺点 ：分布式支持不友好，没有内置 UI
管理控制台、使用麻烦（相比于其他同类型框架来说）</li>
</ul>
<h3 id="elastic-job">Elastic-Job</h3>
<figure>
<img
src="https://raw.githubusercontent.com/lwmfjc/lwmfjc.github.io.resource/main/img/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303532383134343530383131342e706e67"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p><code>Elastic-Job</code>
是当当网开源的一个基于<code>Quartz</code>和<code>ZooKeeper</code>的分布式调度解决方案，由两个相互独立的子项目
<code>Elastic-Job-Lite</code> 和 <code>Elastic-Job-Cloud</code>
组成，一般我们只要使用 <code>Elastic-Job-Lite</code> 就好。</p>
<p><code>ElasticJob</code>
支持任务在分布式场景下的分片和高可用、任务可视化管理等功能。</p>
<figure>
<img
src="https://raw.githubusercontent.com/lwmfjc/lwmfjc.github.io.resource/main/img/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303630383038303433373335362e706e67"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>ElasticJob-Lite 的架构设计如下图所示：</p>
<figure>
<img
src="https://raw.githubusercontent.com/lwmfjc/lwmfjc.github.io.resource/main/img/image-20230221092410062.png"
alt="image-20230221092410062" />
<figcaption aria-hidden="true">image-20230221092410062</figcaption>
</figure>
<p>从上图可以看出，<code>Elastic-Job</code>
没有调度中心这一概念，而是使用 <code>ZooKeeper</code>
作为注册中心，注册中心负责协调分配任务到不同的节点上。</p>
<p>Elastic-Job
中的定时调度都是由执行器自行触发，这种设计也被称为去中心化设计（调度和处理都是执行器单独完成）。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ElasticJobConf(name = &quot;dayJob&quot;, cron = &quot;0/10 * * * * ?&quot;, shardingTotalCount = 2,</span></span><br><span class="line"><span class="meta">        shardingItemParameters = &quot;0=AAAA,1=BBBB&quot;, description = &quot;简单任务&quot;, failover = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestJob</span> <span class="keyword">implements</span> <span class="title class_">SimpleJob</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(ShardingContext shardingContext)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;TestJob任务名：【&#123;&#125;】, 片数：【&#123;&#125;】, param=【&#123;&#125;】&quot;</span>, shardingContext.getJobName(), shardingContext.getShardingTotalCount(),</span><br><span class="line">                shardingContext.getShardingParameter());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>相关地址：</strong></p>
<ul>
<li>Github
地址：https://github.com/apache/shardingsphere-elasticjob。</li>
<li>官方网站：https://shardingsphere.apache.org/elasticjob/index_zh.html
。</li>
</ul>
<p><strong>优缺点总结：</strong></p>
<ul>
<li>优点 ：可以与 <code>Spring</code>
集成、支持分布式、支持集群、性能不错</li>
<li>缺点 ：依赖了额外的中间件比如
Zookeeper（复杂度增加，可靠性降低、维护成本变高）</li>
</ul>
<h3 id="xxl-job">XXL-JOB</h3>
<figure>
<img
src="https://raw.githubusercontent.com/lwmfjc/lwmfjc.github.io.resource/main/img/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303532383134343631313732382e706e67"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p><code>XXL-JOB</code> 于 2015
年开源，是一款优秀的轻量级分布式任务调度框架，支持任务可视化管理、弹性扩容缩容、任务失败重试和告警、任务分片等功能，</p>
<figure>
<img
src="https://raw.githubusercontent.com/lwmfjc/lwmfjc.github.io.resource/main/img/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303630383038303535303433332e706e67"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>根据 <code>XXL-JOB</code> 官网介绍，其解决了很多 <code>Quartz</code>
的不足。</p>
<p><a
target="_blank" rel="noopener" href="https://camo.githubusercontent.com/eb8545689595a808858e72cc81e83a0946b1687dce93555284a6215994388ddf/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303630373230323530333139332e706e67"><img
src="https://raw.githubusercontent.com/lwmfjc/lwmfjc.github.io.resource/main/img/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303630373230323530333139332e706e67"
alt="img" /></a></p>
<p><code>XXL-JOB</code> 的架构设计如下图所示：</p>
<figure>
<img
src="https://raw.githubusercontent.com/lwmfjc/lwmfjc.github.io.resource/main/img/image-20230221092536211.png"
alt="image-20230221092536211" />
<figcaption aria-hidden="true">image-20230221092536211</figcaption>
</figure>
<p>从上图可以看出，<code>XXL-JOB</code> 由 <strong>调度中心</strong> 和
<strong>执行器</strong>
两大部分组成。调度中心主要负责任务管理、执行器管理以及日志管理。执行器主要是接收调度信号并处理。另外，调度中心进行任务调度时，是通过自研
RPC 来实现的。</p>
<p>不同于 <code>Elastic-Job</code> 的去中心化设计， <code>XXL-JOB</code>
的这种设计也被称为中心化设计（调度中心调度多个执行器执行任务）。</p>
<p>和 <code>Quzrtz</code> 类似 <code>XXL-JOB</code>
也是基于数据库锁调度任务，存在性能瓶颈。不过，一般在任务量不是特别大的情况下，没有什么影响的，可以满足绝大部分公司的要求。</p>
<p>不要被 <code>XXL-JOB</code> 的架构图给吓着了，实际上，我们要用
<code>XXL-JOB</code> 的话，只需要重写 <code>IJobHandler</code>
自定义任务执行逻辑就可以了，非常易用！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JobHandler(value=&quot;myApiJobHandler&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApiJobHandler</span> <span class="keyword">extends</span> <span class="title class_">IJobHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ReturnT&lt;String&gt; <span class="title function_">execute</span><span class="params">(String param)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//......</span></span><br><span class="line">        <span class="keyword">return</span> ReturnT.SUCCESS;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还可以直接基于注解定义任务。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@XxlJob(&quot;myAnnotationJobHandler&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ReturnT&lt;String&gt; <span class="title function_">myAnnotationJobHandler</span><span class="params">(String param)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">  <span class="comment">//......</span></span><br><span class="line">  <span class="keyword">return</span> ReturnT.SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/lwmfjc/lwmfjc.github.io.resource/main/img/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303630373230303732383231322e706e67"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p><strong>相关地址：</strong></p>
<ul>
<li>Github 地址：https://github.com/xuxueli/xxl-job/。</li>
<li>官方介绍：https://www.xuxueli.com/xxl-job/ 。</li>
</ul>
<p><strong>优缺点总结：</strong></p>
<ul>
<li>优点：开箱即用（学习成本比较低）、与 Spring
集成、支持分布式、支持集群、内置了 UI 管理控制台。</li>
<li>缺点：不支持动态添加任务（如果一定想要动态创建任务也是支持的，参见：<a
target="_blank" rel="noopener" href="https://github.com/xuxueli/xxl-job/issues/277">xxl-job
issue277</a>）。</li>
</ul>
<h3 id="powerjob">PowerJob</h3>
<p><a
target="_blank" rel="noopener" href="https://camo.githubusercontent.com/e5d5ca0055683c667858752f1ca7604d22c6b3ad4c91483ce346f570683e5f4c/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303532383134353030393730312e706e67"><img
src="https://raw.githubusercontent.com/lwmfjc/lwmfjc.github.io.resource/main/img/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303532383134353030393730312e706e67"
alt="img" /></a></p>
<p>非常值得关注的一个分布式任务调度框架，分布式任务调度领域的新星。目前，已经有很多公司接入比如
OPPO、京东、中通、思科。</p>
<p>这个框架的诞生也挺有意思的，PowerJob
的作者当时在阿里巴巴实习过，阿里巴巴那会使用的是内部自研的
SchedulerX（阿里云付费产品）。实习期满之后，PowerJob
的作者离开了阿里巴巴。想着说自研一个 SchedulerX，防止哪天 SchedulerX
满足不了需求，于是 PowerJob 就诞生了。</p>
<p>更多关于 PowerJob 的故事，小伙伴们可以去看看 PowerJob 作者的视频 <a
target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1SK411A7F3/">《我和我的任务调度中间件》</a>。简单点概括就是：“游戏没啥意思了，我要扛起了新一代分布式任务调度与计算框架的大旗！”。</p>
<p>由于 SchedulerX 属于人民币产品，我这里就不过多介绍。PowerJob
官方也对比过其和 QuartZ、XXL-JOB 以及 SchedulerX。</p>
<p><a
target="_blank" rel="noopener" href="https://camo.githubusercontent.com/ac751a4966ebfb8008e233daa7b1ce5c24645644709df6e7220ea6a6df1e063d/68747470733a2f2f6f7363696d672e6f736368696e612e6e65742f6f73636e65742f75702d37393566356539623064383735303633373137623165653661303866326666316330312e706e67"><img
src="https://camo.githubusercontent.com/ac751a4966ebfb8008e233daa7b1ce5c24645644709df6e7220ea6a6df1e063d/68747470733a2f2f6f7363696d672e6f736368696e612e6e65742f6f73636e65742f75702d37393566356539623064383735303633373137623165653661303866326666316330312e706e67"
alt="img" /></a></p>
<h2 id="总结">总结</h2>
<p>这篇文章中，我主要介绍了：</p>
<ul>
<li><strong>定时任务的相关概念</strong>
：为什么需要定时任务、定时任务中的核心角色、分布式定时任务。</li>
<li><strong>定时任务的技术选型</strong> ： XXL-JOB 2015
年推出，已经经过了很多年的考验。XXL-JOB
轻量级，并且使用起来非常简单。虽然存在性能瓶颈，但是，在绝大多数情况下，对于企业的基本需求来说是没有影响的。PowerJob
属于分布式任务调度领域里的新星，其稳定性还有待继续考察。ElasticJob
由于在架构设计上是基于 Zookeeper ，而 XXL-JOB
是基于数据库，性能方面的话，ElasticJob 略胜一筹。</li>
</ul>
<p>这篇文章并没有介绍到实际使用，但是，并不代表实际使用不重要。我在写这篇文章之前，已经动手写过相应的
Demo。像 Quartz，我在大学那会就用过。不过，当时用的是 Spring
。为了能够更好地体验，我自己又在 Spring Boot
上实际体验了一下。如果你并没有实际使用某个框架，就直接说它并不好用的话，是站不住脚的。</p>
<p>最后，这篇文章要感谢艿艿的帮助，写这篇文章的时候向艿艿询问过一些问题。推荐一篇艿艿写的偏实战类型的硬核文章：<a
target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247490679&amp;idx=1&amp;sn=25374dbdcca95311d41be5d7b7db454d&amp;chksm=fa4963c6cd3eead055bb9cd10cca13224bb35d0f7373a27aa22a55495f71e24b8273a7603314&amp;scene=27#wechat_redirect">《Spring
Job？Quartz？XXL-Job？年轻人才做选择，艿艿全莽~》</a> 。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%A4%8D%E4%B9%A0/" rel="tag"># 复习</a>
              <a href="/tags/%E5%A4%8D%E4%B9%A0-javaGuide/" rel="tag"># 复习-javaGuide</a>
              <a href="/tags/%E5%A4%8D%E4%B9%A0-javaGuide-distributed-system/" rel="tag"># 复习-javaGuide-distributed_system</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/02/21/review/java_guide/lycly_system-design/security/ly06ly_sentive-words-filter/" rel="prev" title="敏感词过滤方案总结">
      <i class="fa fa-chevron-left"></i> 敏感词过滤方案总结
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/02/21/review/java_guide/lycly_system-design/web-real-time-message-push/" rel="next" title="web-real-time-message-push">
      web-real-time-message-push <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  
  <div class="comments">
  <script src="https://utteranc.es/client.js" repo="lwmfjc/lwmfjc.github.io.comment" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
  </div>
  
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="nav-number">1.</span> <span class="nav-text">为什么需要定时任务？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%95%E6%9C%BA%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="nav-number">2.</span> <span class="nav-text">单机定时任务技术选型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#timer"><span class="nav-number">2.1.</span> <span class="nav-text">Timer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#scheduledexecutorservice"><span class="nav-number">2.2.</span> <span class="nav-text">ScheduledExecutorService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#spring-task"><span class="nav-number">2.3.</span> <span class="nav-text">Spring Task</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E8%BD%AE"><span class="nav-number">2.4.</span> <span class="nav-text">时间轮</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="nav-number">3.</span> <span class="nav-text">分布式定时任务技术选型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#quartz"><span class="nav-number">3.1.</span> <span class="nav-text">Quartz</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#elastic-job"><span class="nav-number">3.2.</span> <span class="nav-text">Elastic-Job</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#xxl-job"><span class="nav-number">3.3.</span> <span class="nav-text">XXL-JOB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#powerjob"><span class="nav-number">3.4.</span> <span class="nav-text">PowerJob</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">4.</span> <span class="nav-text">总结</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="刘易"
      src="https://raw.githubusercontent.com/lwmfjc/lwmfjc.github.io.resource/main/img/avatar.png">
  <p class="site-author-name" itemprop="name">刘易</p>
  <div class="site-description" itemprop="description">知命不惧 日日自新</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">201</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/lwmfjc" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;lwmfjc" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">刘易</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">1.4m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">43:27</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
