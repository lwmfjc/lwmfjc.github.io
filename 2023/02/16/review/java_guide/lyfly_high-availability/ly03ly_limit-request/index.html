<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"lwmfjc.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="æœåŠ¡é™æµè¯¦è§£">
<meta property="og:type" content="article">
<meta property="og:title" content="æœåŠ¡é™æµè¯¦è§£">
<meta property="og:url" content="https://lwmfjc.github.io/2023/02/16/review/java_guide/lyfly_high-availability/ly03ly_limit-request/index.html">
<meta property="og:site_name" content="éšè®°">
<meta property="og:description" content="æœåŠ¡é™æµè¯¦è§£">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lwmfjc.github.io/attachments/img/ly-20241129104630039.jpg">
<meta property="og:image" content="https://lwmfjc.github.io/attachments/img/ly-20241129104630402.jpg">
<meta property="og:image" content="https://lwmfjc.github.io/attachments/img/ly-20241129104630748.jpg">
<meta property="og:image" content="https://lwmfjc.github.io/attachments/img/ly-20241129104631075.jpg">
<meta property="og:image" content="https://lwmfjc.github.io/attachments/img/ly-20241129104631409.png">
<meta property="og:image" content="https://lwmfjc.github.io/attachments/img/ly-20241129104631749.jpg">
<meta property="article:published_time" content="2023-02-16T17:06:11.000Z">
<meta property="article:modified_time" content="2023-02-16T17:06:11.000Z">
<meta property="article:author" content="åˆ˜æ˜“">
<meta property="article:tag" content="å¤ä¹ ">
<meta property="article:tag" content="å¤ä¹ -javaGuide">
<meta property="article:tag" content="å¤ä¹ -javaGuide-distributed_system">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lwmfjc.github.io/attachments/img/ly-20241129104630039.jpg">


<link rel="canonical" href="https://lwmfjc.github.io/2023/02/16/review/java_guide/lyfly_high-availability/ly03ly_limit-request/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://lwmfjc.github.io/2023/02/16/review/java_guide/lyfly_high-availability/ly03ly_limit-request/","path":"2023/02/16/review/java_guide/lyfly_high-availability/ly03ly_limit-request/","title":"æœåŠ¡é™æµè¯¦è§£"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>æœåŠ¡é™æµè¯¦è§£ | éšè®°</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">éšè®°</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%99%90%E6%B5%81%E7%AE%97%E6%B3%95%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F"><span class="nav-number">1.</span> <span class="nav-text">å¸¸è§é™æµç®—æ³•æœ‰å“ªäº›ï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%BA%E5%AE%9A%E7%AA%97%E5%8F%A3%E8%AE%A1%E6%95%B0%E5%99%A8%E7%AE%97%E6%B3%95"><span class="nav-number">1.1.</span> <span class="nav-text">å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E8%AE%A1%E6%95%B0%E5%99%A8%E7%AE%97%E6%B3%95"><span class="nav-number">1.2.</span> <span class="nav-text">æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%BC%8F%E6%A1%B6%E7%AE%97%E6%B3%95"><span class="nav-number">1.3.</span> <span class="nav-text">æ¼æ¡¶ç®—æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A4%E7%89%8C%E6%A1%B6%E7%AE%97%E6%B3%95"><span class="nav-number">1.4.</span> <span class="nav-text">ä»¤ç‰Œæ¡¶ç®—æ³•</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%95%E6%9C%BA%E9%99%90%E6%B5%81%E6%80%8E%E4%B9%88%E5%81%9A%EF%BC%9F"><span class="nav-number">2.</span> <span class="nav-text">å•æœºé™æµæ€ä¹ˆåšï¼Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%99%90%E6%B5%81%E6%80%8E%E4%B9%88%E5%81%9A%EF%BC%9F"><span class="nav-number">3.</span> <span class="nav-text">åˆ†å¸ƒå¼é™æµæ€ä¹ˆåšï¼Ÿ</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="åˆ˜æ˜“"
      src="/images/sys/avatar.png">
  <p class="site-author-name" itemprop="name">åˆ˜æ˜“</p>
  <div class="site-description" itemprop="description">çŸ¥å‘½ä¸æƒ§ æ—¥æ—¥è‡ªæ–°</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">254</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/lwmfjc" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;lwmfjc" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=450 src="//music.163.com/outchain/player?type=0&id=33517178&auto=1&height=430"></iframe>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lwmfjc.github.io/2023/02/16/review/java_guide/lyfly_high-availability/ly03ly_limit-request/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sys/avatar.png">
      <meta itemprop="name" content="åˆ˜æ˜“">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="éšè®°">
      <meta itemprop="description" content="çŸ¥å‘½ä¸æƒ§ æ—¥æ—¥è‡ªæ–°">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="æœåŠ¡é™æµè¯¦è§£ | éšè®°">
      <meta itemprop="description" content="æœåŠ¡é™æµè¯¦è§£">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          æœåŠ¡é™æµè¯¦è§£
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-02-16 17:06:11" itemprop="dateCreated datePublished" datetime="2023-02-16T17:06:11+00:00">2023-02-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">å­¦ä¹ </span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>6.7k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>12 åˆ†é’Ÿ</span>
    </span>
</div>

            <div class="post-description">æœåŠ¡é™æµè¯¦è§£</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><blockquote>
<p>è½¬è½½è‡ª<a target="_blank" rel="noopener" href="https://github.com/Snailclimb/JavaGuide%EF%BC%88%E6%B7%BB%E5%8A%A0%E5%B0%8F%E9%83%A8%E5%88%86%E7%AC%94%E8%AE%B0%EF%BC%89%E6%84%9F%E8%B0%A2%E4%BD%9C%E8%80%85">https://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…</a>!</p>
</blockquote>
<p>é’ˆå¯¹è½¯ä»¶ç³»ç»Ÿæ¥è¯´ï¼Œé™æµå°±æ˜¯<strong>å¯¹è¯·æ±‚çš„é€Ÿç‡è¿›è¡Œé™åˆ¶</strong>ï¼Œ<strong>é¿å…ç¬æ—¶çš„å¤§é‡è¯·æ±‚å‡»å®è½¯ä»¶ç³»ç»Ÿ</strong>ã€‚æ¯•ç«Ÿï¼Œè½¯ä»¶ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›æ˜¯æœ‰é™çš„ã€‚å¦‚æœè¯´è¶…è¿‡äº†å…¶å¤„ç†èƒ½åŠ›çš„èŒƒå›´ï¼Œè½¯ä»¶ç³»ç»Ÿå¯èƒ½ç›´æ¥å°±æŒ‚æ‰äº†ã€‚</p>
<p>é™æµå¯èƒ½ä¼š<strong>å¯¼è‡´ç”¨æˆ·çš„è¯·æ±‚æ— æ³•è¢«æ­£ç¡®å¤„ç†</strong>ï¼Œä¸è¿‡ï¼Œè¿™å¾€å¾€ä¹Ÿæ˜¯<strong>æƒè¡¡äº†è½¯ä»¶ç³»ç»Ÿçš„ç¨³å®šæ€§ä¹‹åå¾—åˆ°çš„æœ€ä¼˜è§£</strong>ã€‚</p>
<p>ç°å®ç”Ÿæ´»ä¸­ï¼Œå¤„å¤„éƒ½æœ‰é™æµçš„å®é™…åº”ç”¨ï¼Œå°±æ¯”å¦‚<strong>æ’é˜Ÿä¹°ç¥¨</strong>æ˜¯ä¸ºäº†é¿å…å¤§é‡ç”¨æˆ·æ¶Œå…¥è´­ç¥¨è€Œå¯¼è‡´<strong>å”®ç¥¨å‘˜æ— æ³•å¤„ç†</strong>ã€‚</p>
<p> <img src="/attachments/img/ly-20241129104630039.jpg" alt="æ’é˜Ÿç¤ºæ„å›¾"> </p>
<h2 id="å¸¸è§é™æµç®—æ³•æœ‰å“ªäº›ï¼Ÿ"><a href="#å¸¸è§é™æµç®—æ³•æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="å¸¸è§é™æµç®—æ³•æœ‰å“ªäº›ï¼Ÿ"></a>å¸¸è§é™æµç®—æ³•æœ‰å“ªäº›ï¼Ÿ</h2><p>ç®€å•ä»‹ç» 4 ç§éå¸¸å¥½ç†è§£å¹¶ä¸”å®¹æ˜“å®ç°çš„é™æµç®—æ³•ï¼</p>
<blockquote>
<p>å›¾ç‰‡æ¥æºäº InfoQ çš„ä¸€ç¯‡æ–‡ç« <a target="_blank" rel="noopener" href="https://www.infoq.cn/article/Qg2tX8fyw5Vt-f3HH673">ã€Šåˆ†å¸ƒå¼æœåŠ¡é™æµå®æˆ˜ï¼Œå·²ç»ä¸ºä½ æ’å¥½å‘äº†ã€‹</a>ã€‚</p>
</blockquote>
<h3 id="å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•"><a href="#å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•" class="headerlink" title="å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•"></a>å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•</h3><p>å›ºå®šçª—å£å…¶å®å°±æ˜¯æ—¶é—´çª—å£ã€‚<strong>å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•</strong> è§„å®šäº†æˆ‘ä»¬<strong>å•ä½æ—¶é—´å¤„ç†çš„è¯·æ±‚æ•°é‡</strong>ã€‚</p>
<p>å‡å¦‚æˆ‘ä»¬è§„å®šç³»ç»Ÿä¸­æŸä¸ªæ¥å£ 1 åˆ†é’Ÿåªèƒ½è®¿é—® 33 æ¬¡çš„è¯ï¼Œä½¿ç”¨å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•çš„å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç»™å®šä¸€ä¸ªå˜é‡ <code>counter</code> æ¥<strong>è®°å½•å½“å‰æ¥å£å¤„ç†çš„è¯·æ±‚æ•°é‡</strong>ï¼Œåˆå§‹å€¼ä¸º 0ï¼ˆä»£è¡¨æ¥å£å½“å‰ 1 åˆ†é’Ÿå†…è¿˜æœªå¤„ç†è¯·æ±‚ï¼‰ã€‚</li>
<li>1 åˆ†é’Ÿä¹‹å†…æ¯å¤„ç†ä¸€ä¸ªè¯·æ±‚ä¹‹åå°±å°† <code>counter+1</code> ï¼Œå½“ <code>counter=33</code> ä¹‹åï¼ˆä¹Ÿå°±æ˜¯è¯´åœ¨è¿™ 1 åˆ†é’Ÿå†…æ¥å£å·²ç»è¢«è®¿é—® 33 æ¬¡çš„è¯ï¼‰ï¼Œåç»­çš„è¯·æ±‚å°±ä¼šè¢«å…¨éƒ¨æ‹’ç»ã€‚</li>
<li>ç­‰åˆ° 1 åˆ†é’Ÿç»“æŸåï¼Œå°† <code>counter</code> é‡ç½® 0ï¼Œé‡æ–°å¼€å§‹è®¡æ•°ã€‚</li>
</ul>
<p><strong>è¿™ç§é™æµç®—æ³•æ— æ³•ä¿è¯é™æµé€Ÿç‡ï¼Œå› è€Œæ— æ³•ä¿è¯çªç„¶æ¿€å¢çš„æµé‡ã€‚</strong></p>
<p>å°±æ¯”å¦‚è¯´æˆ‘ä»¬é™åˆ¶æŸä¸ªæ¥å£ 1 åˆ†é’Ÿåªèƒ½è®¿é—® 1000 æ¬¡ï¼Œè¯¥æ¥å£çš„ QPS ä¸º 500ï¼Œå‰ 55s è¿™ä¸ªæ¥å£ 1 ä¸ªè¯·æ±‚æ²¡æœ‰æ¥æ”¶ï¼Œå 1s çªç„¶æ¥æ”¶äº† 1000 ä¸ªè¯·æ±‚ã€‚ç„¶åï¼Œåœ¨å½“å‰åœºæ™¯ä¸‹ï¼Œè¿™ 1000 ä¸ªè¯·æ±‚åœ¨ 1s å†…æ˜¯æ²¡åŠæ³•è¢«å¤„ç†çš„ï¼Œç³»ç»Ÿç›´æ¥å°±è¢«ç¬æ—¶çš„å¤§é‡è¯·æ±‚ç»™å‡»å®äº†ã€‚</p>
<p> <img src="/attachments/img/ly-20241129104630402.jpg" alt="å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•"> </p>
<h3 id="æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•"><a href="#æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•" class="headerlink" title="æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•"></a>æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•</h3><p><strong>æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•</strong> ç®—çš„ä¸Šæ˜¯å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•çš„å‡çº§ç‰ˆã€‚</p>
<p>æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•ç›¸æ¯”äºå›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•çš„ä¼˜åŒ–åœ¨äºï¼š<strong>å®ƒæŠŠæ—¶é—´ä»¥ä¸€å®šæ¯”ä¾‹åˆ†ç‰‡(å³åˆ†ç‰‡ååº”ç”¨â€å›ºå®šçª—å£è®¡æ•°å™¨â€ç®—æ³•)</strong> ã€‚</p>
<p>ä¾‹å¦‚æˆ‘ä»¬çš„æ¥å£é™æµæ¯åˆ†é’Ÿå¤„ç† 60 ä¸ªè¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ 1 åˆ†é’Ÿåˆ†ä¸º **60 ä¸ªçª—å£(æ¯ä¸ªçª—å£æ—¶1ç§’)**ã€‚æ¯éš” 1 ç§’ç§»åŠ¨ä¸€æ¬¡ï¼Œæ¯ä¸ªçª—å£ä¸€ç§’åªèƒ½å¤„ç† ä¸å¤§äº <code>60(è¯·æ±‚æ•°)/60ï¼ˆçª—å£æ•°ï¼‰</code> çš„è¯·æ±‚ï¼Œ å¦‚æœå½“å‰çª—å£çš„è¯·æ±‚è®¡æ•°æ€»å’Œè¶…è¿‡äº†é™åˆ¶çš„æ•°é‡çš„è¯å°±ä¸å†å¤„ç†å…¶ä»–è¯·æ±‚ã€‚  </p>
<blockquote>
<p>æ„Ÿè§‰ä¸Šé¢çš„ä¾‹å­å’Œå›¾æ²¡åŒ¹é…ä¸Šï¼Œåº”è¯¥æ˜¯<br>ä¾‹å¦‚æˆ‘ä»¬çš„æ¥å£é™æµæ¯åˆ†é’Ÿå¤„ç† 300 ä¸ªè¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ 1 åˆ†é’Ÿåˆ†ä¸º **60 ä¸ªçª—å£(æ¯ä¸ªçª—å£æ—¶1ç§’)**ã€‚æ¯éš” 1 ç§’ç§»åŠ¨ä¸€æ¬¡ï¼Œæ¯ä¸ªçª—å£ä¸€ç§’åªèƒ½å¤„ç† ä¸å¤§äº <code>300(è¯·æ±‚æ•°)/60ï¼ˆçª—å£æ•°ï¼‰</code> çš„è¯·æ±‚ï¼Œ å¦‚æœå½“å‰çª—å£çš„è¯·æ±‚è®¡æ•°æ€»å’Œè¶…è¿‡äº†é™åˆ¶çš„æ•°é‡çš„è¯å°±ä¸å†å¤„ç†å…¶ä»–è¯·æ±‚ã€‚</p>
</blockquote>
<p>å¾ˆæ˜¾ç„¶ï¼Œ <strong>å½“æ»‘åŠ¨çª—å£çš„æ ¼å­åˆ’åˆ†çš„è¶Šå¤šï¼Œæ»‘åŠ¨çª—å£çš„æ»šåŠ¨å°±è¶Šå¹³æ»‘ï¼Œé™æµçš„ç»Ÿè®¡å°±ä¼šè¶Šç²¾ç¡®ã€‚</strong></p>
<p><img src="/attachments/img/ly-20241129104630748.jpg" alt="æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•">] </p>
<h3 id="æ¼æ¡¶ç®—æ³•"><a href="#æ¼æ¡¶ç®—æ³•" class="headerlink" title="æ¼æ¡¶ç®—æ³•"></a>æ¼æ¡¶ç®—æ³•</h3><p>æˆ‘ä»¬å¯ä»¥æŠŠå‘è¯·æ±‚çš„åŠ¨ä½œæ¯”ä½œæˆæ³¨æ°´åˆ°æ¡¶ä¸­ï¼Œæˆ‘ä»¬å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹å¯ä»¥æ¯”å–»ä¸ºæ¼æ¡¶æ¼æ°´ã€‚æˆ‘ä»¬å¾€æ¡¶ä¸­<strong>ä»¥ä»»æ„é€Ÿç‡æµå…¥æ°´</strong>ï¼Œä»¥ä¸€å®šé€Ÿç‡æµå‡ºæ°´ã€‚å½“<strong>æ°´è¶…è¿‡æ¡¶æµé‡åˆ™ä¸¢å¼ƒ</strong>ï¼Œå› ä¸ºæ¡¶å®¹é‡æ˜¯ä¸å˜çš„ï¼Œä¿è¯äº†æ•´ä½“çš„é€Ÿç‡ã€‚</p>
<p>å¦‚æœæƒ³è¦å®ç°è¿™ä¸ªç®—æ³•çš„è¯ä¹Ÿå¾ˆç®€å•ï¼Œ<strong>å‡†å¤‡ä¸€ä¸ªé˜Ÿåˆ—ç”¨æ¥ä¿å­˜è¯·æ±‚</strong>ï¼Œç„¶åæˆ‘ä»¬<strong>å®šæœŸä»é˜Ÿåˆ—ä¸­æ‹¿è¯·æ±‚æ¥æ‰§è¡Œ</strong>å°±å¥½äº†ï¼ˆå’Œæ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°&#x2F;é™æµçš„æ€æƒ³æ˜¯ä¸€æ ·çš„ï¼‰ã€‚</p>
<p> <img src="/attachments/img/ly-20241129104631075.jpg" alt="æ¼æ¡¶ç®—æ³•"> </p>
<h3 id="ä»¤ç‰Œæ¡¶ç®—æ³•"><a href="#ä»¤ç‰Œæ¡¶ç®—æ³•" class="headerlink" title="ä»¤ç‰Œæ¡¶ç®—æ³•"></a>ä»¤ç‰Œæ¡¶ç®—æ³•</h3><p>ä»¤ç‰Œæ¡¶ç®—æ³•ä¹Ÿæ¯”è¾ƒç®€å•ã€‚å’Œæ¼æ¡¶ç®—æ³•ç®—æ³•ä¸€æ ·ï¼Œæˆ‘ä»¬çš„ä¸»è§’è¿˜æ˜¯æ¡¶ï¼ˆè¿™é™æµç®—æ³•å’Œæ¡¶è¿‡ä¸å»å•Šï¼‰ã€‚ä¸è¿‡ç°åœ¨<strong>æ¡¶é‡Œè£…çš„æ˜¯ä»¤ç‰Œ</strong>äº†ï¼Œè¯·æ±‚åœ¨<strong>è¢«å¤„ç†ä¹‹å‰éœ€è¦æ‹¿åˆ°ä¸€ä¸ªä»¤ç‰Œ</strong>ï¼Œè¯·æ±‚<strong>å¤„ç†å®Œæ¯•ä¹‹åå°†è¿™ä¸ªä»¤ç‰Œä¸¢å¼ƒï¼ˆåˆ é™¤ï¼‰</strong>ã€‚æˆ‘ä»¬<strong>æ ¹æ®é™æµå¤§å°ï¼ŒæŒ‰ç…§ä¸€å®šçš„é€Ÿç‡å¾€æ¡¶é‡Œæ·»åŠ ä»¤ç‰Œ</strong>ã€‚å¦‚æœ<strong>æ¡¶è£…æ»¡äº†ï¼Œå°±ä¸èƒ½ç»§ç»­å¾€é‡Œé¢ç»§ç»­æ·»åŠ ä»¤ç‰Œ</strong>äº†ã€‚</p>
<p> <img src="/attachments/img/ly-20241129104631409.png" alt="ly-20241129104631409"></p>
<h2 id="å•æœºé™æµæ€ä¹ˆåšï¼Ÿ"><a href="#å•æœºé™æµæ€ä¹ˆåšï¼Ÿ" class="headerlink" title="å•æœºé™æµæ€ä¹ˆåšï¼Ÿ"></a>å•æœºé™æµæ€ä¹ˆåšï¼Ÿ</h2><p>å•æœºé™æµé’ˆå¯¹çš„æ˜¯å•ä½“æ¶æ„åº”ç”¨ã€‚</p>
<p>å•æœºé™æµå¯ä»¥ç›´æ¥ä½¿ç”¨ Google Guava è‡ªå¸¦çš„é™æµå·¥å…·ç±» <code>RateLimiter</code> ã€‚ <strong><code>RateLimiter</code> åŸºäºä»¤ç‰Œæ¡¶ç®—æ³•</strong>ï¼Œå¯ä»¥åº”å¯¹çªå‘æµé‡ã€‚</p>
<blockquote>
<p>Guava åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/google/guava">https://github.com/google/guava</a></p>
</blockquote>
<p>é™¤äº†æœ€åŸºæœ¬çš„ä»¤ç‰Œæ¡¶ç®—æ³•(å¹³æ»‘çªå‘é™æµ)å®ç°ä¹‹å¤–ï¼ŒGuava çš„<code>RateLimiter</code>è¿˜æä¾›äº† <strong>å¹³æ»‘é¢„çƒ­é™æµ</strong> çš„ç®—æ³•å®ç°ã€‚</p>
<p>å¹³æ»‘çªå‘é™æµå°±æ˜¯<strong>æŒ‰ç…§æŒ‡å®šçš„é€Ÿç‡æ”¾ä»¤ç‰Œåˆ°æ¡¶é‡Œ</strong>ï¼Œè€Œå¹³æ»‘é¢„çƒ­é™æµä¼šæœ‰ä¸€æ®µé¢„çƒ­æ—¶é—´ï¼Œé¢„çƒ­æ—¶é—´ä¹‹å†…ï¼Œ<strong>é€Ÿç‡ä¼šé€æ¸æå‡åˆ°é…ç½®çš„é€Ÿç‡</strong>ã€‚</p>
<p>æˆ‘ä»¬ä¸‹é¢é€šè¿‡ä¸¤ä¸ªç®€å•çš„å°ä¾‹å­æ¥è¯¦ç»†äº†è§£å§ï¼</p>
<p>æˆ‘ä»¬ç›´æ¥åœ¨é¡¹ç›®ä¸­å¼•å…¥ Guava ç›¸å…³çš„ä¾èµ–å³å¯ä½¿ç”¨ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.guava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guava<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>31.0.1-jre<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Guava å¹³æ»‘çªå‘é™æµçš„ Demoã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.util.concurrent.RateLimiter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¾®ä¿¡æœ JavaGuide å›å¤&quot;é¢è¯•çªå‡»&quot;å³å¯å…è´¹é¢†å–ä¸ªäººåŸåˆ›çš„ Java é¢è¯•æ‰‹å†Œ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Guideå“¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/10/08 19:12</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RateLimiterDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 1s æ”¾ 5 ä¸ªä»¤ç‰Œåˆ°æ¡¶é‡Œä¹Ÿå°±æ˜¯ 0.2s æ”¾ 1ä¸ªä»¤ç‰Œåˆ°æ¡¶é‡Œ</span></span><br><span class="line">        <span class="comment">//ä¹Ÿå°±æ˜¯1sæ”¾å‡ ä¸ª</span></span><br><span class="line">        <span class="comment">//public static RateLimiter create(double permitsPerSecond) &#123;&#125;</span></span><br><span class="line">        <span class="type">RateLimiter</span> <span class="variable">rateLimiter</span> <span class="operator">=</span> RateLimiter.create(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="comment">//é˜»å¡ç›´åˆ°å¾—åˆ°ä¸€ä¸ªä»¤ç‰Œ ,ä¼šè¿”å›é˜»å¡çš„æ—¶é—´</span></span><br><span class="line">            <span class="type">double</span> <span class="variable">sleepingTime</span> <span class="operator">=</span> rateLimiter.acquire(<span class="number">1</span>);</span><br><span class="line">            System.out.printf(<span class="string">&quot;get 1 tokens: %ss%n&quot;</span>, sleepingTime);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æºç </span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Creates a &#123;<span class="doctag">@code</span> RateLimiter&#125; with the specified stable throughput, given as &quot;permits per</span></span><br><span class="line"><span class="comment">   * second&quot; (commonly referred to as &lt;i&gt;QPS&lt;/i&gt;, queries per second).</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * &lt;p&gt;The returned &#123;<span class="doctag">@code</span> RateLimiter&#125; ensures that on average no more than &#123;<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment">   * permitsPerSecond&#125; are issued during any given second, with sustained requests being smoothly</span></span><br><span class="line"><span class="comment">   * spread over each second. When the incoming request rate exceeds &#123;<span class="doctag">@code</span> permitsPerSecond&#125; the</span></span><br><span class="line"><span class="comment">   * rate limiter will release one permit every &#123;<span class="doctag">@code</span> (1.0 / permitsPerSecond)&#125; seconds. When the</span></span><br><span class="line"><span class="comment">   * rate limiter is unused, bursts of up to &#123;<span class="doctag">@code</span> permitsPerSecond&#125; permits will be allowed, with</span></span><br><span class="line"><span class="comment">   * subsequent requests being smoothly limited at the stable rate of &#123;<span class="doctag">@code</span> permitsPerSecond&#125;.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> permitsPerSecond the rate of the returned &#123;<span class="doctag">@code</span> RateLimiter&#125;, measured in how many</span></span><br><span class="line"><span class="comment">   *     permits become available per second</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> IllegalArgumentException if &#123;<span class="doctag">@code</span> permitsPerSecond&#125; is negative or zero</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// TODO(user): &quot;This is equivalent to</span></span><br><span class="line">  <span class="comment">// &#123;@code createWithCapacity(permitsPerSecond, 1, TimeUnit.SECONDS)&#125;&quot;.</span></span><br><span class="line"><span class="comment">//  public static RateLimiter create(double permitsPerSecond) &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æºç </span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Acquires the given number of permits from this &#123;<span class="doctag">@code</span> RateLimiter&#125;, blocking until the request</span></span><br><span class="line"><span class="comment">   * can be granted. Tells the amount of time slept, if any.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> permits the number of permits to acquire</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> time spent sleeping to enforce rate, in seconds; 0.0 if not rate-limited</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> IllegalArgumentException if the requested number of permits is negative or zero</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@since</span> 16.0 (present in 13.0 with &#123;<span class="doctag">@code</span> void&#125; return type&#125;)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  @CanIgnoreReturnValue</span></span><br><span class="line"><span class="comment">  public double acquire(int permits) &#123;</span></span><br><span class="line"><span class="comment">    long microsToWait = reserve(permits);</span></span><br><span class="line"><span class="comment">    stopwatch.sleepMicrosUninterruptibly(microsToWait);</span></span><br><span class="line"><span class="comment">    return 1.0 * microsToWait / SECONDS.toMicros(1L);</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">get 1 tokens: 0.0s</span><br><span class="line">get 1 tokens: 0.188413s</span><br><span class="line">get 1 tokens: 0.197811s</span><br><span class="line">get 1 tokens: 0.198316s</span><br><span class="line">get 1 tokens: 0.19864s</span><br><span class="line">get 1 tokens: 0.199363s</span><br><span class="line">get 1 tokens: 0.193997s</span><br><span class="line">get 1 tokens: 0.199623s</span><br><span class="line">get 1 tokens: 0.199357s</span><br><span class="line">get 1 tokens: 0.195676s</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Guava å¹³æ»‘é¢„çƒ­é™æµçš„ Demoã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.util.concurrent.RateLimiter;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¾®ä¿¡æœ JavaGuide å›å¤&quot;é¢è¯•çªå‡»&quot;å³å¯å…è´¹é¢†å–ä¸ªäººåŸåˆ›çš„ Java é¢è¯•æ‰‹å†Œ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Guideå“¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/10/08 19:12</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RateLimiterDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 1s æ”¾ 5 ä¸ªä»¤ç‰Œåˆ°æ¡¶é‡Œä¹Ÿå°±æ˜¯ 0.2s æ”¾ 1ä¸ªä»¤ç‰Œåˆ°æ¡¶é‡Œ</span></span><br><span class="line">        <span class="comment">// é¢„çƒ­æ—¶é—´ä¸º3s,ä¹Ÿå°±è¯´åˆšå¼€å§‹çš„ 3s å†…å‘ç‰Œé€Ÿç‡ä¼šé€æ¸æå‡åˆ° 0.2s æ”¾ 1 ä¸ªä»¤ç‰Œåˆ°æ¡¶é‡Œ(æ‰€ä»¥å‰é¢çš„é€Ÿç‡æ¯”è¾ƒå°ï¼Œè·å–éœ€è¦çš„æ—¶é—´æ¯”è¾ƒé•¿)</span></span><br><span class="line">        <span class="type">RateLimiter</span> <span class="variable">rateLimiter</span> <span class="operator">=</span> RateLimiter.create(<span class="number">5</span>, <span class="number">3</span>, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="type">double</span> <span class="variable">sleepingTime</span> <span class="operator">=</span> rateLimiter.acquire(<span class="number">1</span>);</span><br><span class="line">            System.out.printf(<span class="string">&quot;get 1 tokens: %sds%n&quot;</span>, sleepingTime);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">get 1 tokens: 0.0s</span><br><span class="line">get 1 tokens: 0.561919s</span><br><span class="line">get 1 tokens: 0.516931s</span><br><span class="line">get 1 tokens: 0.463798s</span><br><span class="line">get 1 tokens: 0.41286s</span><br><span class="line">get 1 tokens: 0.356172s</span><br><span class="line">get 1 tokens: 0.300489s</span><br><span class="line">get 1 tokens: 0.252545s</span><br><span class="line">get 1 tokens: 0.203996s</span><br><span class="line">get 1 tokens: 0.198359s</span><br></pre></td></tr></table></figure>

<p>å¦å¤–ï¼Œ<strong>Bucket4j</strong> æ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„åŸºäºä»¤ç‰Œ&#x2F;æ¼æ¡¶ç®—æ³•çš„é™æµåº“ã€‚</p>
<blockquote>
<p>Bucket4j åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/vladimir-bukhtoyarov/bucket4j">https://github.com/vladimir-bukhtoyarov/bucket4j</a></p>
</blockquote>
<p>ç›¸å¯¹äºï¼ŒGuava çš„é™æµå·¥å…·ç±»æ¥è¯´ï¼ŒBucket4j æä¾›çš„é™æµåŠŸèƒ½æ›´åŠ å…¨é¢ã€‚ä¸ä»…æ”¯æŒå•æœºé™æµå’Œåˆ†å¸ƒå¼é™æµï¼Œè¿˜å¯ä»¥é›†æˆç›‘æ§ï¼Œæ­é… Prometheus å’Œ Grafana ä½¿ç”¨ã€‚</p>
<p>ä¸è¿‡ï¼Œæ¯•ç«Ÿ Guava ä¹Ÿåªæ˜¯ä¸€ä¸ªåŠŸèƒ½å…¨é¢çš„å·¥å…·ç±»åº“ï¼Œå…¶æä¾›çš„å¼€ç®±å³ç”¨çš„é™æµåŠŸèƒ½åœ¨å¾ˆå¤šå•æœºåœºæ™¯ä¸‹è¿˜æ˜¯æ¯”è¾ƒå®ç”¨çš„ã€‚</p>
<p>Spring Cloud Gateway ä¸­è‡ªå¸¦çš„å•æœºé™æµçš„æ—©æœŸç‰ˆæœ¬å°±æ˜¯åŸºäº Bucket4j å®ç°çš„ã€‚åæ¥ï¼Œæ›¿æ¢æˆäº† <strong>Resilience4j</strong>ã€‚</p>
<p>Resilience4j æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å®¹é”™ç»„ä»¶ï¼Œå…¶çµæ„Ÿæ¥è‡ªäº Hystrixã€‚è‡ª<a target="_blank" rel="noopener" href="https://github.com/Netflix/Hystrix/commit/a7df971cbaddd8c5e976b3cc5f14013fe6ad00e6">Netflix å®£å¸ƒä¸å†ç§¯æå¼€å‘ Hystrix</a> ä¹‹åï¼ŒSpring å®˜æ–¹å’Œ Netflix éƒ½æ›´æ¨èä½¿ç”¨ Resilience4j æ¥åšé™æµç†”æ–­ã€‚</p>
<blockquote>
<p>Resilience4j åœ°å€: <a target="_blank" rel="noopener" href="https://github.com/resilience4j/resilience4j">https://github.com/resilience4j/resilience4j</a></p>
</blockquote>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨ï¼Œé¡¹ç›®çš„é™æµå’Œç†”æ–­éƒ½æ˜¯è¦ä¸€èµ·åšçš„ã€‚</p>
<p>Resilience4j ä¸ä»…æä¾›é™æµï¼Œè¿˜æä¾›äº†<strong>ç†”æ–­</strong>ã€<strong>è´Ÿè½½ä¿æŠ¤</strong>ã€<strong>è‡ªåŠ¨é‡è¯•</strong>ç­‰ä¿éšœç³»ç»Ÿé«˜å¯ç”¨å¼€ç®±å³ç”¨çš„åŠŸèƒ½ã€‚å¹¶ä¸”ï¼ŒResilience4j çš„ç”Ÿæ€ä¹Ÿæ›´å¥½ï¼Œå¾ˆå¤šç½‘å…³éƒ½ä½¿ç”¨ Resilience4j æ¥åšé™æµç†”æ–­çš„ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨ç»å¤§éƒ¨åˆ†åœºæ™¯ä¸‹ Resilience4j æˆ–è®¸ä¼šæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚å¦‚æœæ˜¯ä¸€äº›<strong>æ¯”è¾ƒç®€å•çš„é™æµ</strong>åœºæ™¯çš„è¯ï¼ŒGuava æˆ–è€… Bucket4j ä¹Ÿæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚</p>
<h2 id="åˆ†å¸ƒå¼é™æµæ€ä¹ˆåšï¼Ÿ"><a href="#åˆ†å¸ƒå¼é™æµæ€ä¹ˆåšï¼Ÿ" class="headerlink" title="åˆ†å¸ƒå¼é™æµæ€ä¹ˆåšï¼Ÿ"></a>åˆ†å¸ƒå¼é™æµæ€ä¹ˆåšï¼Ÿ</h2><p><strong>åˆ†å¸ƒå¼é™æµ</strong>é’ˆå¯¹çš„åˆ†å¸ƒå¼&#x2F;å¾®æœåŠ¡åº”ç”¨æ¶æ„åº”ç”¨ï¼Œåœ¨è¿™ç§æ¶æ„ä¸‹ï¼Œå•æœºé™æµå°±ä¸é€‚ç”¨äº†ï¼Œå› ä¸ºä¼šå­˜åœ¨å¤šç§æœåŠ¡ï¼Œå¹¶ä¸”ä¸€ç§æœåŠ¡ä¹Ÿå¯èƒ½ä¼šè¢«éƒ¨ç½²å¤šä»½ã€‚</p>
<p>åˆ†å¸ƒå¼é™æµå¸¸è§çš„æ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>å€ŸåŠ©ä¸­é—´ä»¶æ¶é™æµ</strong> ï¼šå¯ä»¥å€ŸåŠ© <strong>Sentinel</strong> æˆ–è€…ä½¿ç”¨ <strong>Redis</strong> æ¥è‡ªå·±å®ç°å¯¹åº”çš„é™æµé€»è¾‘ã€‚</li>
<li><strong>ç½‘å…³å±‚é™æµ</strong> ï¼šæ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§æ–¹æ¡ˆï¼Œç›´æ¥åœ¨ç½‘å…³å±‚æŠŠé™æµç»™å®‰æ’ä¸Šäº†ã€‚ä¸è¿‡ï¼Œé€šå¸¸ç½‘å…³å±‚é™æµé€šå¸¸ä¹Ÿéœ€è¦å€ŸåŠ©åˆ°ä¸­é—´ä»¶&#x2F;æ¡†æ¶ã€‚å°±æ¯”å¦‚ Spring Cloud Gateway çš„åˆ†å¸ƒå¼é™æµå®ç°**<code>RedisRateLimiter</code>**å°±æ˜¯åŸºäº <strong>Redis+Lua</strong> æ¥å®ç°çš„ï¼Œå†æ¯”å¦‚ Spring Cloud Gateway è¿˜å¯ä»¥æ•´åˆ <strong>Sentinel</strong> æ¥åšé™æµã€‚</li>
</ul>
<p>å¦‚æœä½ è¦åŸºäº Redis æ¥æ‰‹åŠ¨å®ç°é™æµé€»è¾‘çš„è¯ï¼Œå»ºè®®é…åˆ Lua è„šæœ¬æ¥åšã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆå»ºè®® Redis+Lua çš„æ–¹å¼ï¼Ÿ</strong> ä¸»è¦æœ‰ä¸¤ç‚¹åŸå› ï¼š</p>
<ul>
<li><strong>å‡å°‘äº†ç½‘ç»œå¼€é”€</strong> ï¼šæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Lua è„šæœ¬æ¥<strong>æ‰¹é‡æ‰§è¡Œå¤šæ¡</strong> Redis å‘½ä»¤ï¼Œè¿™äº› Redis å‘½ä»¤ä¼šè¢«æäº¤åˆ° Redis æœåŠ¡å™¨<strong>ä¸€æ¬¡æ€§æ‰§è¡Œ</strong>å®Œæˆï¼Œå¤§å¹…<strong>å‡å°äº†ç½‘ç»œå¼€é”€</strong>ã€‚</li>
<li><strong>åŸå­æ€§</strong> ï¼š<strong>ä¸€æ®µ Lua è„šæœ¬å¯ä»¥è§†ä½œä¸€æ¡å‘½ä»¤</strong>æ‰§è¡Œï¼Œä¸€æ®µ Lua è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šæœ‰å…¶ä»–è„šæœ¬æˆ– Redis å‘½ä»¤åŒæ—¶æ‰§è¡Œï¼Œä¿è¯äº†æ“ä½œä¸ä¼šè¢«å…¶ä»–æŒ‡ä»¤æ’å…¥æˆ–æ‰“æ‰°ã€‚</li>
</ul>
<p>æˆ‘è¿™é‡Œå°±ä¸æ”¾å…·ä½“çš„é™æµè„šæœ¬ä»£ç äº†ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šç°æˆçš„ä¼˜ç§€çš„é™æµè„šæœ¬ä¾›ä½ å‚è€ƒï¼Œå°±æ¯”å¦‚ Apache ç½‘å…³é¡¹ç›® ShenYu çš„ RateLimiter é™æµæ’ä»¶å°±åŸºäº Redis + Lua å®ç°äº†ä»¤ç‰Œæ¡¶ç®—æ³•&#x2F;å¹¶å‘ä»¤ç‰Œæ¡¶ç®—æ³•ã€æ¼æ¡¶ç®—æ³•ã€æ»‘åŠ¨çª—å£ç®—æ³•ã€‚</p>
<blockquote>
<p>ShenYu åœ°å€: <a target="_blank" rel="noopener" href="https://github.com/apache/incubator-shenyu">https://github.com/apache/incubator-shenyu</a></p>
</blockquote>
<p> <img src="/attachments/img/ly-20241129104631749.jpg" alt="img"></p>
<ul>
<li>æœåŠ¡æ²»ç†ä¹‹è½»é‡çº§ç†”æ–­æ¡†æ¶ Resilience4j ï¼š<a target="_blank" rel="noopener" href="https://xie.infoq.cn/article/14786e571c1a4143ad1ef8f19">https://xie.infoq.cn/article/14786e571c1a4143ad1ef8f19</a></li>
<li>è¶…è¯¦ç»†çš„ Guava RateLimiter é™æµåŸç†è§£æï¼š<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1408819">https://cloud.tencent.com/developer/article/1408819</a></li>
<li>å®æˆ˜ Spring Cloud Gateway ä¹‹é™æµç¯‡ ğŸ‘ï¼š<a target="_blank" rel="noopener" href="https://www.aneasystone.com/archives/2020/08/spring-cloud-gateway-current-limiting.html">https://www.aneasystone.com/archives/2020/08/spring-cloud-gateway-current-limiting.html</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%A4%8D%E4%B9%A0/" rel="tag"># å¤ä¹ </a>
              <a href="/tags/%E5%A4%8D%E4%B9%A0-javaGuide/" rel="tag"># å¤ä¹ -javaGuide</a>
              <a href="/tags/%E5%A4%8D%E4%B9%A0-javaGuide-distributed-system/" rel="tag"># å¤ä¹ -javaGuide-distributed_system</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/02/16/review/java_guide/lyfly_high-availability/ly02ly_redundancy/" rel="prev" title="å†—ä½™è®¾è®¡">
                  <i class="fa fa-angle-left"></i> å†—ä½™è®¾è®¡
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/02/17/review/java_guide/lyfly_high-availability/ly04ly_timout-and-retry/" rel="next" title="è¶…æ—¶&é‡è¯•è¯¦è§£">
                  è¶…æ—¶&é‡è¯•è¯¦è§£ <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">åˆ˜æ˜“</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">1.5m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">45:38</span>
  </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.3.0/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>



  <script src="/js/third-party/fancybox.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"lwmfjc/blog.comment","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
