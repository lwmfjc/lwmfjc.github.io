<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>éšè®°</title><link>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/</link><description>Recent content on éšè®°</description><generator>Hugo</generator><language>zh</language><atom:link href="https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/index.xml" rel="self" type="application/rss+xml"/><item><title>AQS è¯¦è§£</title><link>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/aqs/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/aqs/</guid><description>&lt;h2 id="aqs-ä»‹ç»">
 AQS ä»‹ç»
 &lt;a class="anchor" href="#aqs-%e4%bb%8b%e7%bb%8d">#&lt;/a>
&lt;/h2>
&lt;p>AQS çš„å…¨ç§°ä¸º &lt;code>AbstractQueuedSynchronizer&lt;/code> ï¼Œç¿»è¯‘è¿‡æ¥çš„æ„æ€å°±æ˜¯æŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨ã€‚è¿™ä¸ªç±»åœ¨ &lt;code>java.util.concurrent.locks&lt;/code> åŒ…ä¸‹é¢ã€‚&lt;/p>
&lt;p>&lt;img src="https://oss.javaguide.cn/github/javaguide/AQS.png" alt="" />&lt;/p>
&lt;p>AQS å°±æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸»è¦ç”¨æ¥æ„å»ºé”å’ŒåŒæ­¥å™¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">abstract&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">AbstractQueuedSynchronizer&lt;/span> &lt;span style="color:#66d9ef">extends&lt;/span> AbstractOwnableSynchronizer &lt;span style="color:#66d9ef">implements&lt;/span> java.&lt;span style="color:#a6e22e">io&lt;/span>.&lt;span style="color:#a6e22e">Serializable&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>AQS ä¸ºæ„å»ºé”å’ŒåŒæ­¥å™¨æä¾›äº†ä¸€äº›é€šç”¨åŠŸèƒ½çš„å®ç°ã€‚å› æ­¤ï¼Œä½¿ç”¨ AQS èƒ½ç®€å•ä¸”é«˜æ•ˆåœ°æ„é€ å‡ºåº”ç”¨å¹¿æ³›çš„å¤§é‡çš„åŒæ­¥å™¨ï¼Œæ¯”å¦‚æˆ‘ä»¬æåˆ°çš„ &lt;code>ReentrantLock&lt;/code>ï¼Œ&lt;code>Semaphore&lt;/code>ï¼Œå…¶ä»–çš„è¯¸å¦‚ &lt;code>ReentrantReadWriteLock&lt;/code>ï¼Œ&lt;code>SynchronousQueue&lt;/code>ç­‰ç­‰çš†æ˜¯åŸºäº AQS çš„ã€‚&lt;/p>
&lt;h2 id="aqs-åŸç†">
 AQS åŸç†
 &lt;a class="anchor" href="#aqs-%e5%8e%9f%e7%90%86">#&lt;/a>
&lt;/h2>
&lt;p>åœ¨é¢è¯•ä¸­è¢«é—®åˆ°å¹¶å‘çŸ¥è¯†çš„æ—¶å€™ï¼Œå¤§å¤šéƒ½ä¼šè¢«é—®åˆ°â€œè¯·ä½ è¯´ä¸€ä¸‹è‡ªå·±å¯¹äº AQS åŸç†çš„ç†è§£â€ã€‚ä¸‹é¢ç»™å¤§å®¶ä¸€ä¸ªç¤ºä¾‹ä¾›å¤§å®¶å‚è€ƒï¼Œé¢è¯•ä¸æ˜¯èƒŒé¢˜ï¼Œå¤§å®¶ä¸€å®šè¦åŠ å…¥è‡ªå·±çš„æ€æƒ³ï¼Œå³ä½¿åŠ å…¥ä¸äº†è‡ªå·±çš„æ€æƒ³ä¹Ÿè¦ä¿è¯è‡ªå·±èƒ½å¤Ÿé€šä¿—çš„è®²å‡ºæ¥è€Œä¸æ˜¯èƒŒå‡ºæ¥ã€‚&lt;/p>
&lt;h3 id="aqs-å¿«é€Ÿäº†è§£">
 AQS å¿«é€Ÿäº†è§£
 &lt;a class="anchor" href="#aqs-%e5%bf%ab%e9%80%9f%e4%ba%86%e8%a7%a3">#&lt;/a>
&lt;/h3>
&lt;p>åœ¨çœŸæ­£è®²è§£ AQS æºç ä¹‹å‰ï¼Œéœ€è¦å¯¹ AQS æœ‰ä¸€ä¸ªæ•´ä½“å±‚é¢çš„è®¤è¯†ã€‚è¿™é‡Œä¼šå…ˆé€šè¿‡å‡ ä¸ªé—®é¢˜ï¼Œä»æ•´ä½“å±‚é¢ä¸Šè®¤è¯† AQSï¼Œäº†è§£ AQS åœ¨æ•´ä¸ª Java å¹¶å‘ä¸­æ‰€ä½äºçš„å±‚é¢ï¼Œä¹‹ååœ¨å­¦ä¹  AQS æºç çš„è¿‡ç¨‹ä¸­ï¼Œæ‰èƒ½æ›´åŠ äº†è§£åŒæ­¥å™¨å’Œ AQS ä¹‹é—´çš„å…³ç³»ã€‚&lt;/p>
&lt;h4 id="aqs-çš„ä½œç”¨æ˜¯ä»€ä¹ˆ">
 AQS çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ
 &lt;a class="anchor" href="#aqs-%e7%9a%84%e4%bd%9c%e7%94%a8%e6%98%af%e4%bb%80%e4%b9%88">#&lt;/a>
&lt;/h4>
&lt;p>AQS è§£å†³äº†å¼€å‘è€…åœ¨å®ç°åŒæ­¥å™¨æ—¶çš„å¤æ‚æ€§é—®é¢˜ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé€šç”¨æ¡†æ¶ï¼Œç”¨äºå®ç°å„ç§åŒæ­¥å™¨ï¼Œä¾‹å¦‚ &lt;mark>å¯é‡å…¥é”&lt;/mark>ï¼ˆ&lt;code>ReentrantLock&lt;/code>ï¼‰ã€&lt;mark>ä¿¡å·é‡&lt;/mark>ï¼ˆ&lt;code>Semaphore&lt;/code>ï¼‰å’Œ &lt;mark>å€’è®¡æ—¶å™¨&lt;/mark>ï¼ˆ&lt;code>CountDownLatch&lt;/code>ï¼‰ã€‚é€šè¿‡å°è£…åº•å±‚çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶ï¼ŒAQS å°†å¤æ‚çš„çº¿ç¨‹ç®¡ç†é€»è¾‘éšè—èµ·æ¥ï¼Œä½¿å¼€å‘è€…åªéœ€ä¸“æ³¨äºå…·ä½“çš„åŒæ­¥é€»è¾‘ã€‚&lt;/p>
&lt;p>ç®€å•æ¥è¯´ï¼ŒAQS æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸ºåŒæ­¥å™¨æä¾›äº†é€šç”¨çš„ &lt;mark>æ‰§è¡Œæ¡†æ¶&lt;/mark>ã€‚å®ƒå®šä¹‰äº† &lt;mark>èµ„æºè·å–å’Œé‡Šæ”¾çš„é€šç”¨æµç¨‹&lt;/mark>ï¼Œè€Œå…·ä½“çš„èµ„æºè·å–é€»è¾‘åˆ™ç”±å…·ä½“åŒæ­¥å™¨é€šè¿‡é‡å†™æ¨¡æ¿æ–¹æ³•æ¥å®ç°ã€‚ å› æ­¤ï¼Œå¯ä»¥å°† AQS çœ‹ä½œæ˜¯åŒæ­¥å™¨çš„ &lt;mark>åŸºç¡€â€œåº•åº§â€&lt;/mark>ï¼Œè€ŒåŒæ­¥å™¨åˆ™æ˜¯åŸºäº AQS å®ç°çš„ &lt;mark>å…·ä½“â€œåº”ç”¨â€&lt;/mark>ã€‚&lt;/p></description></item><item><title>Atomic åŸå­ç±»æ€»ç»“</title><link>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/atomic-classes/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/atomic-classes/</guid><description>&lt;h2 id="atomic-åŸå­ç±»ä»‹ç»">
 Atomic åŸå­ç±»ä»‹ç»
 &lt;a class="anchor" href="#atomic-%e5%8e%9f%e5%ad%90%e7%b1%bb%e4%bb%8b%e7%bb%8d">#&lt;/a>
&lt;/h2>
&lt;p>&lt;code>Atomic&lt;/code> ç¿»è¯‘æˆä¸­æ–‡æ˜¯â€œåŸå­â€çš„æ„æ€ã€‚åœ¨åŒ–å­¦ä¸Šï¼ŒåŸå­æ˜¯æ„æˆç‰©è´¨çš„æœ€å°å•ä½ï¼Œåœ¨åŒ–å­¦ååº”ä¸­ä¸å¯åˆ†å‰²ã€‚åœ¨ç¼–ç¨‹ä¸­ï¼Œ&lt;code>Atomic&lt;/code> æŒ‡çš„æ˜¯ä¸€ä¸ªæ“ä½œå…·æœ‰åŸå­æ€§ï¼Œå³è¯¥æ“ä½œä¸å¯åˆ†å‰²ã€ä¸å¯ä¸­æ–­ã€‚å³ä½¿åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œæ—¶ï¼Œè¯¥æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå®Œæˆï¼Œè¦ä¹ˆä¸æ‰§è¡Œï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°éƒ¨åˆ†å®Œæˆçš„çŠ¶æ€ã€‚&lt;/p>
&lt;p>åŸå­ç±»ç®€å•æ¥è¯´å°±æ˜¯å…·æœ‰åŸå­æ€§æ“ä½œç‰¹å¾çš„ç±»ã€‚&lt;/p>
&lt;p>&lt;code>java.util.concurrent.atomic&lt;/code> åŒ…ä¸­çš„ &lt;code>Atomic&lt;/code> åŸå­ç±»æä¾›äº†ä¸€ç§çº¿ç¨‹å®‰å…¨çš„æ–¹å¼æ¥æ“ä½œå•ä¸ªå˜é‡ã€‚&lt;/p>
&lt;p>&lt;code>Atomic&lt;/code> ç±»ä¾èµ–äº CASï¼ˆCompare-And-Swapï¼Œæ¯”è¾ƒå¹¶äº¤æ¢ï¼‰ä¹è§‚é”æ¥ä¿è¯å…¶æ–¹æ³•çš„åŸå­æ€§ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨ä¼ ç»Ÿçš„é”æœºåˆ¶ï¼ˆå¦‚ &lt;code>synchronized&lt;/code> å—æˆ– &lt;code>ReentrantLock&lt;/code>ï¼‰ã€‚&lt;/p>
&lt;p>è¿™ç¯‡æ–‡ç« æˆ‘ä»¬åªä»‹ç» Atomic åŸå­ç±»çš„æ¦‚å¿µï¼Œå…·ä½“å®ç°åŸç†å¯ä»¥é˜…è¯»ç¬”è€…å†™çš„è¿™ç¯‡æ–‡ç« ï¼š
&lt;a target="_blank" href="./cas.md">CAS è¯¦è§£&lt;/a>ã€‚&lt;/p>
&lt;p>&lt;img src="https://oss.javaguide.cn/github/javaguide/java/JUC%E5%8E%9F%E5%AD%90%E7%B1%BB%E6%A6%82%E8%A7%88.png" alt="JUCåŸå­ç±»æ¦‚è§ˆ" />&lt;/p>
&lt;p>æ ¹æ®æ“ä½œçš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥å°† JUC åŒ…ä¸­çš„åŸå­ç±»åˆ†ä¸º 4 ç±»ï¼š&lt;/p>
&lt;p>&lt;mark>1ã€åŸºæœ¬ç±»å‹&lt;/mark>&lt;/p>
&lt;p>ä½¿ç”¨åŸå­çš„æ–¹å¼æ›´æ–°åŸºæœ¬ç±»å‹&lt;/p>
&lt;ul>
&lt;li>&lt;code>AtomicInteger&lt;/code>ï¼šæ•´å‹åŸå­ç±»&lt;/li>
&lt;li>&lt;code>AtomicLong&lt;/code>ï¼šé•¿æ•´å‹åŸå­ç±»&lt;/li>
&lt;li>&lt;code>AtomicBoolean&lt;/code>ï¼šå¸ƒå°”å‹åŸå­ç±»&lt;/li>
&lt;/ul>
&lt;p>&lt;mark>2ã€æ•°ç»„ç±»å‹&lt;/mark>&lt;/p>
&lt;p>ä½¿ç”¨åŸå­çš„æ–¹å¼æ›´æ–°æ•°ç»„é‡Œçš„æŸä¸ªå…ƒç´ &lt;/p>
&lt;ul>
&lt;li>&lt;code>AtomicIntegerArray&lt;/code>ï¼šæ•´å‹æ•°ç»„åŸå­ç±»&lt;/li>
&lt;li>&lt;code>AtomicLongArray&lt;/code>ï¼šé•¿æ•´å‹æ•°ç»„åŸå­ç±»&lt;/li>
&lt;li>&lt;code>AtomicReferenceArray&lt;/code>ï¼šå¼•ç”¨ç±»å‹æ•°ç»„åŸå­ç±»&lt;/li>
&lt;/ul>
&lt;p>&lt;mark>3ã€å¼•ç”¨ç±»å‹&lt;/mark>&lt;/p>
&lt;ul>
&lt;li>&lt;code>AtomicReference&lt;/code>ï¼šå¼•ç”¨ç±»å‹åŸå­ç±»&lt;/li>
&lt;li>&lt;code>AtomicMarkableReference&lt;/code>ï¼šåŸå­æ›´æ–°å¸¦æœ‰æ ‡è®°çš„å¼•ç”¨ç±»å‹ã€‚è¯¥ç±»å°† boolean æ ‡è®°ä¸å¼•ç”¨å…³è”èµ·æ¥ï¼Œ&lt;del>ä¹Ÿå¯ä»¥è§£å†³ä½¿ç”¨ CAS è¿›è¡ŒåŸå­æ›´æ–°æ—¶å¯èƒ½å‡ºç°çš„ ABA é—®é¢˜&lt;/del>ã€‚&lt;/li>
&lt;li>&lt;code>AtomicStampedReference&lt;/code>ï¼šåŸå­æ›´æ–°å¸¦æœ‰ç‰ˆæœ¬å·çš„å¼•ç”¨ç±»å‹ã€‚è¯¥ç±»å°†æ•´æ•°å€¼ä¸å¼•ç”¨å…³è”èµ·æ¥ï¼Œå¯ç”¨äºè§£å†³åŸå­çš„æ›´æ–°æ•°æ®å’Œæ•°æ®çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥è§£å†³ä½¿ç”¨ CAS è¿›è¡ŒåŸå­æ›´æ–°æ—¶å¯èƒ½å‡ºç°çš„ ABA é—®é¢˜ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;mark>ğŸ› ä¿®æ­£ï¼ˆå‚è§ï¼š
&lt;a target="_blank" href="https://github.com/Snailclimb/JavaGuide/issues/626">issue#626&lt;/a>ï¼‰&lt;/mark> : &lt;code>AtomicMarkableReference&lt;/code> ä¸èƒ½è§£å†³ ABA é—®é¢˜ã€‚&lt;/p>
&lt;p>&lt;mark>4ã€å¯¹è±¡çš„å±æ€§ä¿®æ”¹ç±»å‹&lt;/mark>&lt;/p>
&lt;ul>
&lt;li>&lt;code>AtomicIntegerFieldUpdater&lt;/code>:åŸå­æ›´æ–°æ•´å‹å­—æ®µçš„æ›´æ–°å™¨&lt;/li>
&lt;li>&lt;code>AtomicLongFieldUpdater&lt;/code>ï¼šåŸå­æ›´æ–°é•¿æ•´å‹å­—æ®µçš„æ›´æ–°å™¨&lt;/li>
&lt;li>&lt;code>AtomicReferenceFieldUpdater&lt;/code>ï¼šåŸå­æ›´æ–°å¼•ç”¨ç±»å‹é‡Œçš„å­—æ®µ&lt;/li>
&lt;/ul>
&lt;h2 id="åŸºæœ¬ç±»å‹åŸå­ç±»">
 åŸºæœ¬ç±»å‹åŸå­ç±»
 &lt;a class="anchor" href="#%e5%9f%ba%e6%9c%ac%e7%b1%bb%e5%9e%8b%e5%8e%9f%e5%ad%90%e7%b1%bb">#&lt;/a>
&lt;/h2>
&lt;p>ä½¿ç”¨åŸå­çš„æ–¹å¼æ›´æ–°åŸºæœ¬ç±»å‹&lt;/p>
&lt;ul>
&lt;li>&lt;code>AtomicInteger&lt;/code>ï¼šæ•´å‹åŸå­ç±»&lt;/li>
&lt;li>&lt;code>AtomicLong&lt;/code>ï¼šé•¿æ•´å‹åŸå­ç±»&lt;/li>
&lt;li>&lt;code>AtomicBoolean&lt;/code>ï¼šå¸ƒå°”å‹åŸå­ç±»&lt;/li>
&lt;/ul>
&lt;p>ä¸Šé¢ä¸‰ä¸ªç±»æä¾›çš„æ–¹æ³•å‡ ä¹ç›¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä»¥ &lt;code>AtomicInteger&lt;/code> ä¸ºä¾‹å­æ¥ä»‹ç»ã€‚&lt;/p></description></item><item><title>CAS è¯¦è§£</title><link>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/cas/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/cas/</guid><description>&lt;p>ä¹è§‚é”å’Œæ‚²è§‚é”çš„ä»‹ç»ä»¥åŠä¹è§‚é”å¸¸è§å®ç°æ–¹å¼å¯ä»¥é˜…è¯»ç¬”è€…å†™çš„è¿™ç¯‡æ–‡ç« ï¼š
&lt;a target="_blank" href="https://javaguide.cn/java/concurrent/optimistic-lock-and-pessimistic-lock.html">ä¹è§‚é”å’Œæ‚²è§‚é”è¯¦è§£&lt;/a>ã€‚&lt;/p>
&lt;p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç» ï¼šJava ä¸­ CAS çš„å®ç°ä»¥åŠ CAS å­˜åœ¨çš„ä¸€äº›é—®é¢˜ã€‚&lt;/p>
&lt;h2 id="java-ä¸­-cas-æ˜¯å¦‚ä½•å®ç°çš„">
 Java ä¸­ CAS æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ
 &lt;a class="anchor" href="#java-%e4%b8%ad-cas-%e6%98%af%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0%e7%9a%84">#&lt;/a>
&lt;/h2>
&lt;p>åœ¨ Java ä¸­ï¼Œå®ç° CASï¼ˆCompare-And-Swap, æ¯”è¾ƒå¹¶äº¤æ¢ï¼‰æ“ä½œçš„ä¸€ä¸ªå…³é”®ç±»æ˜¯&lt;code>Unsafe&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>Unsafe&lt;/code>ç±»ä½äº&lt;code>sun.misc&lt;/code>åŒ…ä¸‹ï¼Œæ˜¯ä¸€ä¸ªæä¾›ä½çº§åˆ«ã€ä¸å®‰å…¨æ“ä½œçš„ç±»ã€‚ç”±äºå…¶å¼ºå¤§çš„åŠŸèƒ½å’Œæ½œåœ¨çš„å±é™©æ€§ï¼Œå®ƒé€šå¸¸ç”¨äº JVM å†…éƒ¨æˆ–ä¸€äº›éœ€è¦æé«˜æ€§èƒ½å’Œåº•å±‚è®¿é—®çš„åº“ä¸­ï¼Œè€Œä¸æ¨èæ™®é€šå¼€å‘è€…åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ã€‚å…³äº &lt;code>Unsafe&lt;/code>ç±»çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥é˜…è¯»è¿™ç¯‡æ–‡ç« ï¼šğŸ“Œ
&lt;a target="_blank" href="https://javaguide.cn/java/basis/unsafe.html">Java é­”æ³•ç±» Unsafe è¯¦è§£&lt;/a>ã€‚&lt;/p>
&lt;p>&lt;code>sun.misc&lt;/code>åŒ…ä¸‹çš„&lt;code>Unsafe&lt;/code>ç±»æä¾›äº†&lt;code>compareAndSwapObject&lt;/code>ã€&lt;code>compareAndSwapInt&lt;/code>ã€&lt;code>compareAndSwapLong&lt;/code>æ–¹æ³•æ¥å®ç°çš„å¯¹&lt;code>Object&lt;/code>ã€&lt;code>int&lt;/code>ã€&lt;code>long&lt;/code>ç±»å‹çš„ CAS æ“ä½œï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * ä»¥åŸå­æ–¹å¼æ›´æ–°å¯¹è±¡å­—æ®µçš„å€¼ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param o è¦æ“ä½œçš„å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param offset å¯¹è±¡å­—æ®µçš„å†…å­˜åç§»é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param expected æœŸæœ›çš„æ—§å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param x è¦è®¾ç½®çš„æ–°å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @return å¦‚æœå€¼è¢«æˆåŠŸæ›´æ–°ï¼Œåˆ™è¿”å› trueï¼›å¦åˆ™è¿”å› false
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">boolean&lt;/span> &lt;span style="color:#a6e22e">compareAndSwapObject&lt;/span>(Object o, &lt;span style="color:#66d9ef">long&lt;/span> offset, Object expected, Object x);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * ä»¥åŸå­æ–¹å¼æ›´æ–° int ç±»å‹çš„å¯¹è±¡å­—æ®µçš„å€¼ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">boolean&lt;/span> &lt;span style="color:#a6e22e">compareAndSwapInt&lt;/span>(Object o, &lt;span style="color:#66d9ef">long&lt;/span> offset, &lt;span style="color:#66d9ef">int&lt;/span> expected, &lt;span style="color:#66d9ef">int&lt;/span> x);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * ä»¥åŸå­æ–¹å¼æ›´æ–° long ç±»å‹çš„å¯¹è±¡å­—æ®µçš„å€¼ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">boolean&lt;/span> &lt;span style="color:#a6e22e">compareAndSwapLong&lt;/span>(Object o, &lt;span style="color:#66d9ef">long&lt;/span> offset, &lt;span style="color:#66d9ef">long&lt;/span> expected, &lt;span style="color:#66d9ef">long&lt;/span> x);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Unsafe&lt;/code>ç±»ä¸­çš„ CAS æ–¹æ³•æ˜¯&lt;code>native&lt;/code>æ–¹æ³•ã€‚&lt;code>native&lt;/code>å…³é”®å­—è¡¨æ˜è¿™äº›æ–¹æ³•æ˜¯ç”¨æœ¬åœ°ä»£ç ï¼ˆé€šå¸¸æ˜¯ C æˆ– C++ï¼‰å®ç°çš„ï¼Œè€Œä¸æ˜¯ç”¨ Java å®ç°çš„ã€‚è¿™äº›æ–¹æ³•ç›´æ¥è°ƒç”¨åº•å±‚çš„ç¡¬ä»¶æŒ‡ä»¤æ¥å®ç°åŸå­æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒJava è¯­è¨€å¹¶æ²¡æœ‰ç›´æ¥ç”¨ Java å®ç° CASã€‚&lt;/p></description></item><item><title>CompletableFuture è¯¦è§£</title><link>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/completablefuture-intro/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/completablefuture-intro/</guid><description>&lt;p>å®é™…é¡¹ç›®ä¸­ï¼Œä¸€ä¸ªæ¥å£å¯èƒ½éœ€è¦åŒæ—¶è·å–å¤šç§ä¸åŒçš„æ•°æ®ï¼Œç„¶åå†æ±‡æ€»è¿”å›ï¼Œè¿™ç§åœºæ™¯è¿˜æ˜¯æŒºå¸¸è§çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼šç”¨æˆ·è¯·æ±‚è·å–è®¢å•ä¿¡æ¯ï¼Œå¯èƒ½éœ€è¦åŒæ—¶è·å–ç”¨æˆ·ä¿¡æ¯ã€å•†å“è¯¦æƒ…ã€ç‰©æµä¿¡æ¯ã€å•†å“æ¨èç­‰æ•°æ®ã€‚&lt;/p>
&lt;p>å¦‚æœæ˜¯ä¸²è¡Œï¼ˆæŒ‰é¡ºåºä¾æ¬¡æ‰§è¡Œæ¯ä¸ªä»»åŠ¡ï¼‰æ‰§è¡Œçš„è¯ï¼Œæ¥å£çš„å“åº”é€Ÿåº¦ä¼šéå¸¸æ…¢ã€‚è€ƒè™‘åˆ°è¿™äº›ä»»åŠ¡ä¹‹é—´æœ‰å¤§éƒ¨åˆ†éƒ½æ˜¯ &lt;mark>æ— å‰åé¡ºåºå…³è”&lt;/mark> çš„ï¼Œå¯ä»¥ &lt;mark>å¹¶è¡Œæ‰§è¡Œ&lt;/mark> ï¼Œå°±æ¯”å¦‚è¯´è°ƒç”¨è·å–å•†å“è¯¦æƒ…çš„æ—¶å€™ï¼Œå¯ä»¥åŒæ—¶è°ƒç”¨è·å–ç‰©æµä¿¡æ¯ã€‚é€šè¿‡å¹¶è¡Œæ‰§è¡Œå¤šä¸ªä»»åŠ¡çš„æ–¹å¼ï¼Œæ¥å£çš„å“åº”é€Ÿåº¦ä¼šå¾—åˆ°å¤§å¹…ä¼˜åŒ–ã€‚&lt;/p>
&lt;p>&lt;img src="https://oss.javaguide.cn/github/javaguide/high-performance/serial-to-parallel.png" alt="" />&lt;/p>
&lt;p>å¯¹äºå­˜åœ¨å‰åè°ƒç”¨é¡ºåºå…³ç³»çš„ä»»åŠ¡ï¼Œå¯ä»¥è¿›è¡Œä»»åŠ¡ç¼–æ’ã€‚&lt;/p>
&lt;p>&lt;img src="https://oss.javaguide.cn/github/javaguide/high-performance/serial-to-parallel2.png" alt="" />&lt;/p>
&lt;ol>
&lt;li>è·å–ç”¨æˆ·ä¿¡æ¯ä¹‹åï¼Œæ‰èƒ½è°ƒç”¨å•†å“è¯¦æƒ…å’Œç‰©æµä¿¡æ¯æ¥å£ã€‚&lt;/li>
&lt;li>æˆåŠŸè·å–å•†å“è¯¦æƒ…å’Œç‰©æµä¿¡æ¯ä¹‹åï¼Œæ‰èƒ½è°ƒç”¨å•†å“æ¨èæ¥å£ã€‚&lt;/li>
&lt;/ol>
&lt;p>å¯èƒ½ä¼šç”¨åˆ°å¤šçº¿ç¨‹å¼‚æ­¥ä»»åŠ¡ç¼–æ’çš„åœºæ™¯ï¼ˆè¿™é‡Œåªæ˜¯ä¸¾ä¾‹ï¼Œæ•°æ®ä¸ä¸€å®šæ˜¯ä¸€æ¬¡è¿”å›ï¼Œå¯èƒ½ä¼šå¯¹æ¥å£è¿›è¡Œæ‹†åˆ†ï¼‰ï¼š&lt;/p>
&lt;ol>
&lt;li>é¦–é¡µï¼šä¾‹å¦‚æŠ€æœ¯ç¤¾åŒºçš„é¦–é¡µå¯èƒ½éœ€è¦åŒæ—¶è·å–æ–‡ç« æ¨èåˆ—è¡¨ã€å¹¿å‘Šæ ã€æ–‡ç« æ’è¡Œæ¦œã€çƒ­é—¨è¯é¢˜ç­‰ä¿¡æ¯ã€‚&lt;/li>
&lt;li>è¯¦æƒ…é¡µï¼šä¾‹å¦‚æŠ€æœ¯ç¤¾åŒºçš„æ–‡ç« è¯¦æƒ…é¡µå¯èƒ½éœ€è¦åŒæ—¶è·å–ä½œè€…ä¿¡æ¯ã€æ–‡ç« è¯¦æƒ…ã€æ–‡ç« è¯„è®ºç­‰ä¿¡æ¯ã€‚&lt;/li>
&lt;li>ç»Ÿè®¡æ¨¡å—ï¼šä¾‹å¦‚æŠ€æœ¯ç¤¾åŒºçš„åå°ç»Ÿè®¡æ¨¡å—å¯èƒ½éœ€è¦åŒæ—¶è·å–ç²‰ä¸æ•°æ±‡æ€»ã€æ–‡ç« æ•°æ®ï¼ˆé˜…è¯»é‡ã€è¯„è®ºé‡ã€æ”¶è—é‡ï¼‰æ±‡æ€»ç­‰ä¿¡æ¯ã€‚&lt;/li>
&lt;/ol>
&lt;p>å¯¹äº Java ç¨‹åºæ¥è¯´ï¼ŒJava 8 æ‰è¢«å¼•å…¥çš„ &lt;code>CompletableFuture&lt;/code> å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ¥åšå¤šä¸ªä»»åŠ¡çš„ç¼–æ’ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§ã€‚&lt;/p>
&lt;p>è¿™ç¯‡æ–‡ç« æ˜¯ &lt;code>CompletableFuture&lt;/code> çš„ç®€å•å…¥é—¨ï¼Œå¸¦å¤§å®¶çœ‹çœ‹ &lt;code>CompletableFuture&lt;/code> å¸¸ç”¨çš„ APIã€‚&lt;/p>
&lt;h2 id="future-ä»‹ç»">
 Future ä»‹ç»
 &lt;a class="anchor" href="#future-%e4%bb%8b%e7%bb%8d">#&lt;/a>
&lt;/h2>
&lt;p>&lt;code>Future&lt;/code> ç±»æ˜¯å¼‚æ­¥æ€æƒ³çš„å…¸å‹è¿ç”¨ï¼Œä¸»è¦ç”¨åœ¨ä¸€äº›éœ€è¦æ‰§è¡Œè€—æ—¶ä»»åŠ¡çš„åœºæ™¯ï¼Œé¿å…ç¨‹åºä¸€ç›´åŸåœ°ç­‰å¾…è€—æ—¶ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ‰§è¡Œæ•ˆç‡å¤ªä½ã€‚å…·ä½“æ¥è¯´æ˜¯è¿™æ ·çš„ï¼šå½“æˆ‘ä»¬æ‰§è¡ŒæŸä¸€è€—æ—¶çš„ä»»åŠ¡æ—¶ï¼Œå¯ä»¥å°†è¿™ä¸ªè€—æ—¶ä»»åŠ¡äº¤ç»™ä¸€ä¸ªå­çº¿ç¨‹å»å¼‚æ­¥æ‰§è¡Œï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥å¹²ç‚¹å…¶ä»–äº‹æƒ…ï¼Œä¸ç”¨å‚»å‚»ç­‰å¾…è€—æ—¶ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚ç­‰æˆ‘ä»¬çš„äº‹æƒ…å¹²å®Œåï¼Œæˆ‘ä»¬å†é€šè¿‡ &lt;code>Future&lt;/code> ç±»è·å–åˆ°è€—æ—¶ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚è¿™æ ·ä¸€æ¥ï¼Œç¨‹åºçš„æ‰§è¡Œæ•ˆç‡å°±æ˜æ˜¾æé«˜äº†ã€‚&lt;/p>
&lt;p>è¿™å…¶å®å°±æ˜¯å¤šçº¿ç¨‹ä¸­ç»å…¸çš„ &lt;mark>Future æ¨¡å¼&lt;/mark>ï¼Œä½ å¯ä»¥å°†å…¶çœ‹ä½œæ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯å¼‚æ­¥è°ƒç”¨ï¼Œä¸»è¦ç”¨åœ¨å¤šçº¿ç¨‹é¢†åŸŸï¼Œå¹¶é Java è¯­è¨€ç‹¬æœ‰ã€‚&lt;/p>
&lt;p>åœ¨ Java ä¸­ï¼Œ&lt;code>Future&lt;/code> ç±»åªæ˜¯ä¸€ä¸ªæ³›å‹æ¥å£ï¼Œä½äº &lt;code>java.util.concurrent&lt;/code> åŒ…ä¸‹ï¼Œå…¶ä¸­å®šä¹‰äº† 5 ä¸ªæ–¹æ³•ï¼Œä¸»è¦åŒ…æ‹¬ä¸‹é¢è¿™ 4 ä¸ªåŠŸèƒ½ï¼š&lt;/p>
&lt;ul>
&lt;li>å–æ¶ˆä»»åŠ¡ï¼›&lt;/li>
&lt;li>åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆ;&lt;/li>
&lt;li>åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»æ‰§è¡Œå®Œæˆ;&lt;/li>
&lt;li>è·å–ä»»åŠ¡æ‰§è¡Œç»“æœã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// V ä»£è¡¨äº†Futureæ‰§è¡Œçš„ä»»åŠ¡è¿”å›å€¼çš„ç±»å‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">interface&lt;/span> &lt;span style="color:#a6e22e">Future&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>V&lt;span style="color:#f92672">&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å–æ¶ˆä»»åŠ¡æ‰§è¡Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æˆåŠŸå–æ¶ˆè¿”å› trueï¼Œå¦åˆ™è¿”å› false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> &lt;span style="color:#a6e22e">cancel&lt;/span>(&lt;span style="color:#66d9ef">boolean&lt;/span> mayInterruptIfRunning);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> &lt;span style="color:#a6e22e">isCancelled&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»æ‰§è¡Œå®Œæˆ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">boolean&lt;/span> &lt;span style="color:#a6e22e">isDone&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è·å–ä»»åŠ¡æ‰§è¡Œç»“æœ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> V &lt;span style="color:#a6e22e">get&lt;/span>() &lt;span style="color:#66d9ef">throws&lt;/span> InterruptedException, ExecutionException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰è¿”å›è®¡ç®—ç»“æœå°±æŠ›å‡º TimeOutException å¼‚å¸¸&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> V &lt;span style="color:#a6e22e">get&lt;/span>(&lt;span style="color:#66d9ef">long&lt;/span> timeout, TimeUnit unit)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">throws&lt;/span> InterruptedException, ExecutionException, TimeoutExceptio
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç®€å•ç†è§£å°±æ˜¯ï¼šæˆ‘æœ‰ä¸€ä¸ªä»»åŠ¡ï¼Œæäº¤ç»™äº† &lt;code>Future&lt;/code> æ¥å¤„ç†ã€‚ä»»åŠ¡æ‰§è¡ŒæœŸé—´æˆ‘è‡ªå·±å¯ä»¥å»åšä»»ä½•æƒ³åšçš„äº‹æƒ…ã€‚å¹¶ä¸”ï¼Œåœ¨è¿™æœŸé—´æˆ‘è¿˜å¯ä»¥å–æ¶ˆä»»åŠ¡ä»¥åŠè·å–ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ã€‚ä¸€æ®µæ—¶é—´ä¹‹åï¼Œæˆ‘å°±å¯ä»¥ &lt;code>Future&lt;/code> é‚£é‡Œç›´æ¥å–å‡ºä»»åŠ¡æ‰§è¡Œç»“æœã€‚&lt;/p></description></item><item><title>Java å¸¸è§å¹¶å‘å®¹å™¨æ€»ç»“</title><link>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/java-concurrent-collections/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/java-concurrent-collections/</guid><description>&lt;p>JDK æä¾›çš„è¿™äº›å®¹å™¨å¤§éƒ¨åˆ†åœ¨ &lt;code>java.util.concurrent&lt;/code> åŒ…ä¸­ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;mark>&lt;code>ConcurrentHashMap&lt;/code>&lt;/mark> : çº¿ç¨‹å®‰å…¨çš„ &lt;code>HashMap&lt;/code>&lt;/li>
&lt;li>&lt;mark>&lt;code>CopyOnWriteArrayList&lt;/code>&lt;/mark> : çº¿ç¨‹å®‰å…¨çš„ &lt;code>List&lt;/code>ï¼Œåœ¨è¯»å¤šå†™å°‘çš„åœºåˆæ€§èƒ½éå¸¸å¥½ï¼Œè¿œè¿œå¥½äº &lt;code>Vector&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;mark>&lt;code>ConcurrentLinkedQueue&lt;/code>&lt;/mark> : é«˜æ•ˆçš„å¹¶å‘é˜Ÿåˆ—ï¼Œä½¿ç”¨é“¾è¡¨å®ç°ã€‚å¯ä»¥çœ‹åšä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ &lt;code>LinkedList&lt;/code>ï¼Œè¿™æ˜¯ä¸€ä¸ªéé˜»å¡é˜Ÿåˆ—ã€‚&lt;/li>
&lt;li>&lt;mark>&lt;code>BlockingQueue&lt;/code>&lt;/mark> : è¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼ŒJDK å†…éƒ¨é€šè¿‡é“¾è¡¨ã€æ•°ç»„ç­‰æ–¹å¼å®ç°äº†è¿™ä¸ªæ¥å£ã€‚è¡¨ç¤ºé˜»å¡é˜Ÿåˆ—ï¼Œéå¸¸é€‚åˆç”¨äºä½œä¸ºæ•°æ®å…±äº«çš„é€šé“ã€‚&lt;/li>
&lt;li>&lt;mark>&lt;code>ConcurrentSkipListMap&lt;/code>&lt;/mark> : è·³è¡¨çš„å®ç°ã€‚è¿™æ˜¯ä¸€ä¸ª Mapï¼Œä½¿ç”¨è·³è¡¨çš„æ•°æ®ç»“æ„è¿›è¡Œå¿«é€ŸæŸ¥æ‰¾ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="concurrenthashmap">
 ConcurrentHashMap
 &lt;a class="anchor" href="#concurrenthashmap">#&lt;/a>
&lt;/h2>
&lt;p>æˆ‘ä»¬çŸ¥é“ï¼Œ&lt;code>HashMap&lt;/code> æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå¦‚æœåœ¨å¹¶å‘åœºæ™¯ä¸‹ä½¿ç”¨ï¼Œä¸€ç§å¸¸è§çš„è§£å†³æ–¹å¼æ˜¯é€šè¿‡ &lt;code>Collections.synchronizedMap()&lt;/code> æ–¹æ³•å¯¹ &lt;code>HashMap&lt;/code> è¿›è¡ŒåŒ…è£…ï¼Œä½¿å…¶å˜ä¸ºçº¿ç¨‹å®‰å…¨ã€‚ä¸è¿‡ï¼Œè¿™ç§æ–¹å¼æ˜¯é€šè¿‡ä¸€ä¸ªå…¨å±€é”æ¥åŒæ­¥ä¸åŒçº¿ç¨‹é—´çš„å¹¶å‘è®¿é—®ï¼Œä¼šå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½ç“¶é¢ˆï¼Œå°¤å…¶æ˜¯åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ã€‚&lt;/p>
&lt;p>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œ&lt;code>ConcurrentHashMap&lt;/code> åº”è¿è€Œç”Ÿï¼Œä½œä¸º &lt;code>HashMap&lt;/code> çš„çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬ï¼Œå®ƒæä¾›äº†æ›´é«˜æ•ˆçš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚&lt;/p>
&lt;p>åœ¨ JDK1.7 çš„æ—¶å€™ï¼Œ&lt;code>ConcurrentHashMap&lt;/code> å¯¹æ•´ä¸ªæ¡¶æ•°ç»„è¿›è¡Œäº†åˆ†å‰²åˆ†æ®µ(&lt;code>Segment&lt;/code>ï¼Œåˆ†æ®µé”)ï¼Œæ¯ä¸€æŠŠé”åªé”å®¹å™¨å…¶ä¸­ä¸€éƒ¨åˆ†æ•°æ®ï¼ˆä¸‹é¢æœ‰ç¤ºæ„å›¾ï¼‰ï¼Œå¤šçº¿ç¨‹è®¿é—®å®¹å™¨é‡Œä¸åŒæ•°æ®æ®µçš„æ•°æ®ï¼Œå°±ä¸ä¼šå­˜åœ¨é”ç«äº‰ï¼Œæé«˜å¹¶å‘è®¿é—®ç‡ã€‚&lt;/p>
&lt;p>&lt;img src="https://oss.javaguide.cn/github/javaguide/java/collection/java7_concurrenthashmap.png" alt="Java7 ConcurrentHashMap å­˜å‚¨ç»“æ„" />&lt;/p>
&lt;p>åˆ°äº† JDK1.8 çš„æ—¶å€™ï¼Œ&lt;code>ConcurrentHashMap&lt;/code> å–æ¶ˆäº† &lt;code>Segment&lt;/code> åˆ†æ®µé”ï¼Œé‡‡ç”¨ &lt;code>Node + CAS + synchronized&lt;/code> æ¥ä¿è¯å¹¶å‘å®‰å…¨ã€‚æ•°æ®ç»“æ„è·Ÿ &lt;code>HashMap&lt;/code> 1.8 çš„ç»“æ„ç±»ä¼¼ï¼Œæ•°ç»„+é“¾è¡¨/çº¢é»‘äºŒå‰æ ‘ã€‚Java 8 åœ¨é“¾è¡¨é•¿åº¦è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼ˆ8ï¼‰æ—¶å°†é“¾è¡¨ï¼ˆå¯»å€æ—¶é—´å¤æ‚åº¦ä¸º O(N)ï¼‰è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼ˆå¯»å€æ—¶é—´å¤æ‚åº¦ä¸º O(log(N))ï¼‰ã€‚&lt;/p>
&lt;p>Java 8 ä¸­ï¼Œé”ç²’åº¦æ›´ç»†ï¼Œ&lt;code>synchronized&lt;/code> åªé”å®šå½“å‰é“¾è¡¨æˆ–çº¢é»‘äºŒå‰æ ‘çš„é¦–èŠ‚ç‚¹ï¼Œè¿™æ ·åªè¦ hash ä¸å†²çªï¼Œå°±ä¸ä¼šäº§ç”Ÿå¹¶å‘ï¼Œå°±ä¸ä¼šå½±å“å…¶ä»– Node çš„è¯»å†™ï¼Œæ•ˆç‡å¤§å¹…æå‡ã€‚&lt;/p></description></item><item><title>Java çº¿ç¨‹æ± è¯¦è§£</title><link>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/java-thread-pool-summary/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/java-thread-pool-summary/</guid><description>&lt;p>æ± åŒ–æŠ€æœ¯æƒ³å¿…å¤§å®¶å·²ç»å±¡è§ä¸é²œäº†ï¼Œçº¿ç¨‹æ± ã€æ•°æ®åº“è¿æ¥æ± ã€HTTP è¿æ¥æ± ç­‰ç­‰éƒ½æ˜¯å¯¹è¿™ä¸ªæ€æƒ³çš„åº”ç”¨ã€‚æ± åŒ–æŠ€æœ¯çš„æ€æƒ³ä¸»è¦æ˜¯ä¸ºäº†å‡å°‘æ¯æ¬¡è·å–èµ„æºçš„æ¶ˆè€—ï¼Œæé«˜å¯¹èµ„æºçš„åˆ©ç”¨ç‡ã€‚&lt;/p>
&lt;p>è¿™ç¯‡æ–‡ç« æˆ‘ä¼šè¯¦ç»†ä»‹ç»ä¸€ä¸‹çº¿ç¨‹æ± çš„åŸºæœ¬æ¦‚å¿µä»¥åŠæ ¸å¿ƒåŸç†ã€‚&lt;/p>
&lt;h2 id="çº¿ç¨‹æ± ä»‹ç»">
 çº¿ç¨‹æ± ä»‹ç»
 &lt;a class="anchor" href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e4%bb%8b%e7%bb%8d">#&lt;/a>
&lt;/h2>
&lt;p>é¡¾åæ€ä¹‰ï¼Œçº¿ç¨‹æ± å°±æ˜¯ç®¡ç†ä¸€ç³»åˆ—çº¿ç¨‹çš„èµ„æºæ± ï¼Œå…¶æä¾›äº†ä¸€ç§é™åˆ¶å’Œç®¡ç†çº¿ç¨‹èµ„æºçš„æ–¹å¼ã€‚æ¯ä¸ªçº¿ç¨‹æ± è¿˜ç»´æŠ¤ä¸€äº›åŸºæœ¬ç»Ÿè®¡ä¿¡æ¯ï¼Œä¾‹å¦‚å·²å®Œæˆä»»åŠ¡çš„æ•°é‡ã€‚&lt;/p>
&lt;p>è¿™é‡Œå€Ÿç”¨ã€ŠJava å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹ä¹¦ä¸­çš„éƒ¨åˆ†å†…å®¹æ¥æ€»ç»“ä¸€ä¸‹ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;mark>é™ä½èµ„æºæ¶ˆè€—&lt;/mark>ã€‚é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ã€‚&lt;/li>
&lt;li>&lt;mark>æé«˜å“åº”é€Ÿåº¦&lt;/mark>ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚&lt;/li>
&lt;li>&lt;mark>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§&lt;/mark>ã€‚çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;mark>çº¿ç¨‹æ± ä¸€èˆ¬ç”¨äºæ‰§è¡Œå¤šä¸ªä¸ç›¸å…³è”çš„è€—æ—¶ä»»åŠ¡ï¼Œæ²¡æœ‰å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œä»»åŠ¡é¡ºåºæ‰§è¡Œï¼Œä½¿ç”¨äº†çº¿ç¨‹æ± çš„è¯å¯è®©å¤šä¸ªä¸ç›¸å…³è”çš„ä»»åŠ¡åŒæ—¶æ‰§è¡Œã€‚&lt;/mark>&lt;/p>
&lt;h2 id="executor-æ¡†æ¶ä»‹ç»">
 Executor æ¡†æ¶ä»‹ç»
 &lt;a class="anchor" href="#executor-%e6%a1%86%e6%9e%b6%e4%bb%8b%e7%bb%8d">#&lt;/a>
&lt;/h2>
&lt;p>&lt;code>Executor&lt;/code> æ¡†æ¶æ˜¯ Java5 ä¹‹åå¼•è¿›çš„ï¼Œåœ¨ Java 5 ä¹‹åï¼Œé€šè¿‡ &lt;code>Executor&lt;/code> æ¥å¯åŠ¨çº¿ç¨‹æ¯”ä½¿ç”¨ &lt;code>Thread&lt;/code> çš„ &lt;code>start&lt;/code> æ–¹æ³•æ›´å¥½ï¼Œé™¤äº†æ›´æ˜“ç®¡ç†ï¼Œæ•ˆç‡æ›´å¥½ï¼ˆç”¨çº¿ç¨‹æ± å®ç°ï¼ŒèŠ‚çº¦å¼€é”€ï¼‰å¤–ï¼Œè¿˜æœ‰å…³é”®çš„ä¸€ç‚¹ï¼šæœ‰åŠ©äºé¿å… this é€ƒé€¸é—®é¢˜ã€‚&lt;/p>
&lt;blockquote>
&lt;p>this é€ƒé€¸æ˜¯æŒ‡åœ¨æ„é€ å‡½æ•°è¿”å›ä¹‹å‰å…¶ä»–çº¿ç¨‹å°±æŒæœ‰è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼Œè°ƒç”¨å°šæœªæ„é€ å®Œå…¨çš„å¯¹è±¡çš„æ–¹æ³•å¯èƒ½å¼•å‘ä»¤äººç–‘æƒ‘çš„é”™è¯¯ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>&lt;code>Executor&lt;/code> æ¡†æ¶ä¸ä»…åŒ…æ‹¬äº†çº¿ç¨‹æ± çš„ç®¡ç†ï¼Œè¿˜æä¾›äº†çº¿ç¨‹å·¥å‚ã€é˜Ÿåˆ—ä»¥åŠæ‹’ç»ç­–ç•¥ç­‰ï¼Œ&lt;code>Executor&lt;/code> æ¡†æ¶è®©å¹¶å‘ç¼–ç¨‹å˜å¾—æ›´åŠ ç®€å•ã€‚&lt;/p>
&lt;p>&lt;code>Executor&lt;/code> æ¡†æ¶ç»“æ„ä¸»è¦ç”±ä¸‰å¤§éƒ¨åˆ†ç»„æˆï¼š&lt;/p>
&lt;p>&lt;mark>1ã€ä»»åŠ¡(&lt;code>Runnable&lt;/code> /&lt;code>Callable&lt;/code>)&lt;/mark>&lt;/p>
&lt;p>æ‰§è¡Œä»»åŠ¡éœ€è¦å®ç°çš„ &lt;mark>&lt;code>Runnable&lt;/code> æ¥å£&lt;/mark> æˆ– &lt;mark>&lt;code>Callable&lt;/code>æ¥å£&lt;/mark>ã€‚&lt;mark>&lt;code>Runnable&lt;/code> æ¥å£&lt;/mark>æˆ– &lt;mark>&lt;code>Callable&lt;/code> æ¥å£&lt;/mark> å®ç°ç±»éƒ½å¯ä»¥è¢« &lt;mark>&lt;code>ThreadPoolExecutor&lt;/code>&lt;/mark> æˆ– &lt;mark>&lt;code>ScheduledThreadPoolExecutor&lt;/code>&lt;/mark> æ‰§è¡Œã€‚&lt;/p>
&lt;p>&lt;mark>2ã€ä»»åŠ¡çš„æ‰§è¡Œ(&lt;code>Executor&lt;/code>)&lt;/mark>&lt;/p>
&lt;p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒåŒ…æ‹¬ä»»åŠ¡æ‰§è¡Œæœºåˆ¶çš„æ ¸å¿ƒæ¥å£ &lt;mark>&lt;code>Executor&lt;/code>&lt;/mark> ï¼Œä»¥åŠç»§æ‰¿è‡ª &lt;code>Executor&lt;/code> æ¥å£çš„ &lt;mark>&lt;code>ExecutorService&lt;/code> æ¥å£ã€‚&lt;code>ThreadPoolExecutor&lt;/code>&lt;/mark> å’Œ &lt;mark>&lt;code>ScheduledThreadPoolExecutor&lt;/code>&lt;/mark> è¿™ä¸¤ä¸ªå…³é”®ç±»å®ç°äº† &lt;mark>&lt;code>ExecutorService&lt;/code>&lt;/mark> æ¥å£ã€‚&lt;/p>
&lt;p>&lt;img src="https://oss.javaguide.cn/github/javaguide/java/concurrent/executor-class-diagram.png" alt="" />&lt;/p>
&lt;p>è¿™é‡Œæäº†å¾ˆå¤šåº•å±‚çš„ç±»å…³ç³»ï¼Œä½†æ˜¯ï¼Œå®é™…ä¸Šæˆ‘ä»¬éœ€è¦æ›´å¤šå…³æ³¨çš„æ˜¯ &lt;code>ThreadPoolExecutor&lt;/code> è¿™ä¸ªç±»ï¼Œè¿™ä¸ªç±»åœ¨æˆ‘ä»¬å®é™…ä½¿ç”¨çº¿ç¨‹æ± çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨é¢‘ç‡è¿˜æ˜¯éå¸¸é«˜çš„ã€‚&lt;/p></description></item><item><title>Java çº¿ç¨‹æ± æœ€ä½³å®è·µ</title><link>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/java-thread-pool-best-practices/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/java-thread-pool-best-practices/</guid><description>&lt;p>ç®€å•æ€»ç»“ä¸€ä¸‹æˆ‘äº†è§£çš„ä½¿ç”¨çº¿ç¨‹æ± çš„æ—¶å€™åº”è¯¥æ³¨æ„çš„ä¸œè¥¿ï¼Œç½‘ä¸Šä¼¼ä¹è¿˜æ²¡æœ‰ä¸“é—¨å†™è¿™æ–¹é¢çš„æ–‡ç« ã€‚&lt;/p>
&lt;h2 id="1æ­£ç¡®å£°æ˜çº¿ç¨‹æ± ">
 1ã€æ­£ç¡®å£°æ˜çº¿ç¨‹æ± 
 &lt;a class="anchor" href="#1%e6%ad%a3%e7%a1%ae%e5%a3%b0%e6%98%8e%e7%ba%bf%e7%a8%8b%e6%b1%a0">#&lt;/a>
&lt;/h2>
&lt;p>&lt;mark>çº¿ç¨‹æ± å¿…é¡»æ‰‹åŠ¨é€šè¿‡ &lt;code>ThreadPoolExecutor&lt;/code> çš„æ„é€ å‡½æ•°æ¥å£°æ˜ï¼Œé¿å…ä½¿ç”¨&lt;code>Executors&lt;/code> ç±»åˆ›å»ºçº¿ç¨‹æ± ï¼Œä¼šæœ‰ OOM é£é™©ã€‚&lt;/mark>&lt;/p>
&lt;p>&lt;code>Executors&lt;/code> è¿”å›çº¿ç¨‹æ± å¯¹è±¡çš„å¼Šç«¯å¦‚ä¸‹(åæ–‡ä¼šè¯¦ç»†ä»‹ç»åˆ°)ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;mark>&lt;code>FixedThreadPool&lt;/code> å’Œ &lt;code>SingleThreadExecutor&lt;/code>&lt;/mark>ï¼šä½¿ç”¨çš„æ˜¯æœ‰ç•Œé˜»å¡é˜Ÿåˆ— &lt;code>LinkedBlockingQueue&lt;/code>ï¼Œä»»åŠ¡é˜Ÿåˆ—çš„é»˜è®¤é•¿åº¦å’Œæœ€å¤§é•¿åº¦ä¸º &lt;code>Integer.MAX_VALUE&lt;/code>ï¼Œå¯èƒ½å †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ OOMã€‚&lt;/li>
&lt;li>&lt;mark>&lt;code>CachedThreadPool&lt;/code>&lt;/mark>ï¼šä½¿ç”¨çš„æ˜¯åŒæ­¥é˜Ÿåˆ— &lt;code>SynchronousQueue&lt;/code>ï¼Œå…è®¸åˆ›å»ºçš„çº¿ç¨‹æ•°é‡ä¸º &lt;code>Integer.MAX_VALUE&lt;/code> ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ OOMã€‚&lt;/li>
&lt;li>&lt;mark>&lt;code>ScheduledThreadPool&lt;/code> å’Œ &lt;code>SingleThreadScheduledExecutor&lt;/code>&lt;/mark> : ä½¿ç”¨çš„æ— ç•Œçš„å»¶è¿Ÿé˜»å¡é˜Ÿåˆ—&lt;code>DelayedWorkQueue&lt;/code>ï¼Œä»»åŠ¡é˜Ÿåˆ—æœ€å¤§é•¿åº¦ä¸º &lt;code>Integer.MAX_VALUE&lt;/code>ï¼Œå¯èƒ½å †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ OOMã€‚&lt;/li>
&lt;/ul>
&lt;p>è¯´ç™½äº†å°±æ˜¯ï¼š&lt;mark>ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—ï¼Œæ§åˆ¶çº¿ç¨‹åˆ›å»ºæ•°é‡ã€‚&lt;/mark>&lt;/p>
&lt;p>é™¤äº†é¿å… OOM çš„åŸå› ä¹‹å¤–ï¼Œä¸æ¨èä½¿ç”¨ &lt;code>Executors&lt;/code>æä¾›çš„ä¸¤ç§å¿«æ·çš„çº¿ç¨‹æ± çš„åŸå› è¿˜æœ‰ï¼š&lt;/p>
&lt;ul>
&lt;li>å®é™…ä½¿ç”¨ä¸­éœ€è¦æ ¹æ®è‡ªå·±æœºå™¨çš„æ€§èƒ½ã€ä¸šåŠ¡åœºæ™¯æ¥æ‰‹åŠ¨é…ç½®çº¿ç¨‹æ± çš„å‚æ•°æ¯”å¦‚æ ¸å¿ƒçº¿ç¨‹æ•°ã€ä½¿ç”¨çš„ä»»åŠ¡é˜Ÿåˆ—ã€é¥±å’Œç­–ç•¥ç­‰ç­‰ã€‚&lt;/li>
&lt;li>æˆ‘ä»¬åº”è¯¥æ˜¾ç¤ºåœ°ç»™æˆ‘ä»¬çš„çº¿ç¨‹æ± å‘½åï¼Œè¿™æ ·æœ‰åŠ©äºæˆ‘ä»¬å®šä½é—®é¢˜ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="2ç›‘æµ‹çº¿ç¨‹æ± è¿è¡ŒçŠ¶æ€">
 2ã€ç›‘æµ‹çº¿ç¨‹æ± è¿è¡ŒçŠ¶æ€
 &lt;a class="anchor" href="#2%e7%9b%91%e6%b5%8b%e7%ba%bf%e7%a8%8b%e6%b1%a0%e8%bf%90%e8%a1%8c%e7%8a%b6%e6%80%81">#&lt;/a>
&lt;/h2>
&lt;p>ä½ å¯ä»¥é€šè¿‡ä¸€äº›æ‰‹æ®µæ¥æ£€æµ‹çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€æ¯”å¦‚ SpringBoot ä¸­çš„ Actuator ç»„ä»¶ã€‚&lt;/p>
&lt;p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨ &lt;code>ThreadPoolExecutor&lt;/code> çš„ç›¸å…³ API åšä¸€ä¸ªç®€é™‹çš„ç›‘æ§ã€‚ä»ä¸‹å›¾å¯ä»¥çœ‹å‡ºï¼Œ &lt;code>ThreadPoolExecutor&lt;/code>æä¾›äº†è·å–çº¿ç¨‹æ± å½“å‰çš„çº¿ç¨‹æ•°å’Œæ´»è·ƒçº¿ç¨‹æ•°ã€å·²ç»æ‰§è¡Œå®Œæˆçš„ä»»åŠ¡æ•°ã€æ­£åœ¨æ’é˜Ÿä¸­çš„ä»»åŠ¡æ•°ç­‰ç­‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://oss.javaguide.cn/github/javaguide/java/concurrent/threadpool-methods-information.png" alt="" />&lt;/p>
&lt;p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Demoã€‚&lt;code>printThreadPoolStatus()&lt;/code>ä¼šæ¯éš”ä¸€ç§’æ‰“å°å‡ºçº¿ç¨‹æ± çš„çº¿ç¨‹æ•°ã€æ´»è·ƒçº¿ç¨‹æ•°ã€å®Œæˆçš„ä»»åŠ¡æ•°ã€ä»¥åŠé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * æ‰“å°çº¿ç¨‹æ± çš„çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * @param threadPool çº¿ç¨‹æ± å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">printThreadPoolStatus&lt;/span>(ThreadPoolExecutor threadPool) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ScheduledExecutorService scheduledExecutorService &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ScheduledThreadPoolExecutor(1, createThreadFactory(&lt;span style="color:#e6db74">&amp;#34;print-images/thread-pool-status&amp;#34;&lt;/span>, &lt;span style="color:#66d9ef">false&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> scheduledExecutorService.&lt;span style="color:#a6e22e">scheduleAtFixedRate&lt;/span>(() &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> log.&lt;span style="color:#a6e22e">info&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;=========================&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> log.&lt;span style="color:#a6e22e">info&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ThreadPool Size: [{}]&amp;#34;&lt;/span>, threadPool.&lt;span style="color:#a6e22e">getPoolSize&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> log.&lt;span style="color:#a6e22e">info&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Active Threads: {}&amp;#34;&lt;/span>, threadPool.&lt;span style="color:#a6e22e">getActiveCount&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> log.&lt;span style="color:#a6e22e">info&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Number of Tasks : {}&amp;#34;&lt;/span>, threadPool.&lt;span style="color:#a6e22e">getCompletedTaskCount&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> log.&lt;span style="color:#a6e22e">info&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Number of Tasks in Queue: {}&amp;#34;&lt;/span>, threadPool.&lt;span style="color:#a6e22e">getQueue&lt;/span>().&lt;span style="color:#a6e22e">size&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> log.&lt;span style="color:#a6e22e">info&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;=========================&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }, 0, 1, TimeUnit.&lt;span style="color:#a6e22e">SECONDS&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="3å»ºè®®ä¸åŒç±»åˆ«çš„ä¸šåŠ¡ç”¨ä¸åŒçš„çº¿ç¨‹æ± ">
 3ã€å»ºè®®ä¸åŒç±»åˆ«çš„ä¸šåŠ¡ç”¨ä¸åŒçš„çº¿ç¨‹æ± 
 &lt;a class="anchor" href="#3%e5%bb%ba%e8%ae%ae%e4%b8%8d%e5%90%8c%e7%b1%bb%e5%88%ab%e7%9a%84%e4%b8%9a%e5%8a%a1%e7%94%a8%e4%b8%8d%e5%90%8c%e7%9a%84%e7%ba%bf%e7%a8%8b%e6%b1%a0">#&lt;/a>
&lt;/h2>
&lt;p>å¾ˆå¤šäººåœ¨å®é™…é¡¹ç›®ä¸­éƒ½ä¼šæœ‰ç±»ä¼¼è¿™æ ·çš„é—®é¢˜ï¼š&lt;mark>æˆ‘çš„é¡¹ç›®ä¸­å¤šä¸ªä¸šåŠ¡éœ€è¦ç”¨åˆ°çº¿ç¨‹æ± ï¼Œæ˜¯ä¸ºæ¯ä¸ªçº¿ç¨‹æ± éƒ½å®šä¹‰ä¸€ä¸ªè¿˜æ˜¯è¯´å®šä¹‰ä¸€ä¸ªå…¬å…±çš„çº¿ç¨‹æ± å‘¢ï¼Ÿ&lt;/mark>&lt;/p></description></item><item><title>Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸Šï¼‰</title><link>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/java-concurrent-questions-01/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/java-concurrent-questions-01/</guid><description>&lt;h2 id="çº¿ç¨‹">
 çº¿ç¨‹
 &lt;a class="anchor" href="#%e7%ba%bf%e7%a8%8b">#&lt;/a>
&lt;/h2>
&lt;h3 id="ä»€ä¹ˆæ˜¯çº¿ç¨‹å’Œè¿›ç¨‹">
 â­ï¸ä»€ä¹ˆæ˜¯çº¿ç¨‹å’Œè¿›ç¨‹?
 &lt;a class="anchor" href="#%e4%bb%80%e4%b9%88%e6%98%af%e7%ba%bf%e7%a8%8b%e5%92%8c%e8%bf%9b%e7%a8%8b">#&lt;/a>
&lt;/h3>
&lt;h4 id="ä½•ä¸ºè¿›ç¨‹">
 ä½•ä¸ºè¿›ç¨‹?
 &lt;a class="anchor" href="#%e4%bd%95%e4%b8%ba%e8%bf%9b%e7%a8%8b">#&lt;/a>
&lt;/h4>
&lt;p>è¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿè¿è¡Œç¨‹åºçš„åŸºæœ¬å•ä½ï¼Œå› æ­¤è¿›ç¨‹æ˜¯åŠ¨æ€çš„ã€‚ç³»ç»Ÿè¿è¡Œä¸€ä¸ªç¨‹åºå³æ˜¯ä¸€ä¸ªè¿›ç¨‹ä»åˆ›å»ºï¼Œè¿è¡Œåˆ°æ¶ˆäº¡çš„è¿‡ç¨‹ã€‚&lt;/p>
&lt;p>åœ¨ Java ä¸­ï¼Œå½“æˆ‘ä»¬å¯åŠ¨ main å‡½æ•°æ—¶å…¶å®å°±æ˜¯å¯åŠ¨äº†ä¸€ä¸ª JVM çš„è¿›ç¨‹ï¼Œè€Œ main å‡½æ•°æ‰€åœ¨çš„çº¿ç¨‹å°±æ˜¯è¿™ä¸ªè¿›ç¨‹ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿç§°ä¸»çº¿ç¨‹ã€‚&lt;/p>
&lt;p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨ Windows ä¸­é€šè¿‡æŸ¥çœ‹ä»»åŠ¡ç®¡ç†å™¨çš„æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¸…æ¥šçœ‹åˆ° Windows å½“å‰è¿è¡Œçš„è¿›ç¨‹ï¼ˆ&lt;code>.exe&lt;/code> æ–‡ä»¶çš„è¿è¡Œï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://oss.javaguide.cn/github/javaguide/java/%E8%BF%9B%E7%A8%8B%E7%A4%BA%E4%BE%8B%E5%9B%BE%E7%89%87-Windows.png" alt="è¿›ç¨‹ç¤ºä¾‹å›¾ç‰‡-Windows" />&lt;/p>
&lt;h4 id="ä½•ä¸ºçº¿ç¨‹">
 ä½•ä¸ºçº¿ç¨‹?
 &lt;a class="anchor" href="#%e4%bd%95%e4%b8%ba%e7%ba%bf%e7%a8%8b">#&lt;/a>
&lt;/h4>
&lt;p>çº¿ç¨‹ä¸è¿›ç¨‹ç›¸ä¼¼ï¼Œä½†çº¿ç¨‹æ˜¯ä¸€ä¸ªæ¯”è¿›ç¨‹æ›´å°çš„æ‰§è¡Œå•ä½ã€‚ä¸€ä¸ªè¿›ç¨‹åœ¨å…¶æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¯ä»¥äº§ç”Ÿå¤šä¸ªçº¿ç¨‹ã€‚ä¸è¿›ç¨‹ä¸åŒçš„æ˜¯åŒç±»çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„&lt;mark>å †&lt;/mark>å’Œ&lt;mark>æ–¹æ³•åŒº&lt;/mark>èµ„æºï¼Œä½†æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„&lt;mark>ç¨‹åºè®¡æ•°å™¨&lt;/mark>ã€&lt;mark>è™šæ‹Ÿæœºæ ˆ&lt;/mark>å’Œ&lt;mark>æœ¬åœ°æ–¹æ³•æ ˆ&lt;/mark>ï¼Œæ‰€ä»¥ç³»ç»Ÿåœ¨äº§ç”Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ–æ˜¯åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´åšåˆ‡æ¢å·¥ä½œæ—¶ï¼Œè´Ÿæ‹…è¦æ¯”è¿›ç¨‹å°å¾—å¤šï¼Œä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œçº¿ç¨‹ä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹ã€‚&lt;/p>
&lt;p>Java ç¨‹åºå¤©ç”Ÿå°±æ˜¯å¤šçº¿ç¨‹ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ JMX æ¥çœ‹çœ‹ä¸€ä¸ªæ™®é€šçš„ Java ç¨‹åºæœ‰å“ªäº›çº¿ç¨‹ï¼Œä»£ç å¦‚ä¸‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">MultiThread&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		&lt;span style="color:#75715e">// è·å– Java çº¿ç¨‹ç®¡ç† MXBean&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	ThreadMXBean threadMXBean &lt;span style="color:#f92672">=&lt;/span> ManagementFactory.&lt;span style="color:#a6e22e">getThreadMXBean&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		&lt;span style="color:#75715e">// ä¸éœ€è¦è·å–åŒæ­¥çš„ monitor å’Œ synchronizer ä¿¡æ¯ï¼Œä»…è·å–çº¿ç¨‹å’Œçº¿ç¨‹å †æ ˆä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		ThreadInfo&lt;span style="color:#f92672">[]&lt;/span> threadInfos &lt;span style="color:#f92672">=&lt;/span> threadMXBean.&lt;span style="color:#a6e22e">dumpAllThreads&lt;/span>(&lt;span style="color:#66d9ef">false&lt;/span>, &lt;span style="color:#66d9ef">false&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		&lt;span style="color:#75715e">// éå†çº¿ç¨‹ä¿¡æ¯ï¼Œä»…æ‰“å°çº¿ç¨‹ ID å’Œçº¿ç¨‹åç§°ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		&lt;span style="color:#66d9ef">for&lt;/span> (ThreadInfo threadInfo : threadInfos) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>			System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;[&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> threadInfo.&lt;span style="color:#a6e22e">getThreadId&lt;/span>() &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;] &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> threadInfo.&lt;span style="color:#a6e22e">getThreadName&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šè¿°ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼ˆè¾“å‡ºå†…å®¹å¯èƒ½ä¸åŒï¼Œä¸ç”¨å¤ªçº ç»“ä¸‹é¢æ¯ä¸ªçº¿ç¨‹çš„ä½œç”¨ï¼Œåªç”¨çŸ¥é“ main çº¿ç¨‹æ‰§è¡Œ main æ–¹æ³•å³å¯ï¼‰ï¼š&lt;/p></description></item><item><title>Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸‹ï¼‰</title><link>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/java-concurrent-questions-03/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/java-concurrent-questions-03/</guid><description>&lt;h2 id="threadlocal">
 ThreadLocal
 &lt;a class="anchor" href="#threadlocal">#&lt;/a>
&lt;/h2>
&lt;h3 id="threadlocal-æœ‰ä»€ä¹ˆç”¨">
 ThreadLocal æœ‰ä»€ä¹ˆç”¨ï¼Ÿ
 &lt;a class="anchor" href="#threadlocal-%e6%9c%89%e4%bb%80%e4%b9%88%e7%94%a8">#&lt;/a>
&lt;/h3>
&lt;p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åˆ›å»ºçš„å˜é‡å¯ä»¥è¢«ä»»ä½•ä¸€ä¸ªçº¿ç¨‹è®¿é—®å’Œä¿®æ”¹ã€‚è¿™åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å¯èƒ½å¯¼è‡´æ•°æ®ç«äº‰å’Œçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚é‚£ä¹ˆï¼Œ&lt;mark>å¦‚æœæƒ³è®©æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸“å±æœ¬åœ°å˜é‡ï¼Œè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ&lt;/mark>&lt;/p>
&lt;p>JDK ä¸­æä¾›çš„ &lt;code>ThreadLocal&lt;/code> ç±»æ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;mark>&lt;code>ThreadLocal&lt;/code> ç±»å…è®¸æ¯ä¸ªçº¿ç¨‹ç»‘å®šè‡ªå·±çš„å€¼&lt;/mark>ï¼Œå¯ä»¥å°†å…¶å½¢è±¡åœ°æ¯”å–»ä¸ºä¸€ä¸ªâ€œå­˜æ”¾æ•°æ®çš„ç›’å­â€ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ç›’å­ï¼Œç”¨äºå­˜å‚¨ç§æœ‰æ•°æ®ï¼Œç¡®ä¿ä¸åŒçº¿ç¨‹ä¹‹é—´çš„æ•°æ®äº’ä¸å¹²æ‰°ã€‚&lt;/p>
&lt;p>å½“ä½ åˆ›å»ºä¸€ä¸ª &lt;code>ThreadLocal&lt;/code> å˜é‡æ—¶ï¼Œæ¯ä¸ªè®¿é—®è¯¥å˜é‡çš„çº¿ç¨‹éƒ½ä¼šæ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å‰¯æœ¬ã€‚è¿™ä¹Ÿæ˜¯ &lt;code>ThreadLocal&lt;/code> åç§°çš„ç”±æ¥ã€‚çº¿ç¨‹å¯ä»¥é€šè¿‡ &lt;code>get()&lt;/code> æ–¹æ³•è·å–è‡ªå·±çº¿ç¨‹çš„æœ¬åœ°å‰¯æœ¬ï¼Œæˆ–é€šè¿‡ &lt;code>set()&lt;/code> æ–¹æ³•ä¿®æ”¹è¯¥å‰¯æœ¬çš„å€¼ï¼Œä»è€Œé¿å…äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚&lt;/p>
&lt;p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼šå‡è®¾æœ‰ä¸¤ä¸ªäººå»å®å±‹æ”¶é›†å®ç‰©ã€‚å¦‚æœä»–ä»¬å…±ç”¨ä¸€ä¸ªè¢‹å­ï¼Œå¿…ç„¶ä¼šäº§ç”Ÿäº‰æ‰§ï¼›ä½†å¦‚æœæ¯ä¸ªäººéƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„è¢‹å­ï¼Œå°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœå°†è¿™ä¸¤ä¸ªäººæ¯”ä½œçº¿ç¨‹ï¼Œé‚£ä¹ˆ &lt;code>ThreadLocal&lt;/code> å°±æ˜¯ç”¨æ¥é¿å…è¿™ä¸¤ä¸ªçº¿ç¨‹ç«äº‰åŒä¸€ä¸ªèµ„æºçš„æ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">ThreadLocalExample&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> ThreadLocal&lt;span style="color:#f92672">&amp;lt;&lt;/span>Integer&lt;span style="color:#f92672">&amp;gt;&lt;/span> threadLocal &lt;span style="color:#f92672">=&lt;/span> ThreadLocal.&lt;span style="color:#a6e22e">withInitial&lt;/span>(() &lt;span style="color:#f92672">-&amp;gt;&lt;/span> 0);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Runnable task &lt;span style="color:#f92672">=&lt;/span> () &lt;span style="color:#f92672">-&amp;gt;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> value &lt;span style="color:#f92672">=&lt;/span> threadLocal.&lt;span style="color:#a6e22e">get&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> value &lt;span style="color:#f92672">+=&lt;/span> 1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> threadLocal.&lt;span style="color:#a6e22e">set&lt;/span>(value);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(Thread.&lt;span style="color:#a6e22e">currentThread&lt;/span>().&lt;span style="color:#a6e22e">getName&lt;/span>() &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34; Value: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> threadLocal.&lt;span style="color:#a6e22e">get&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread thread1 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Thread(task, &lt;span style="color:#e6db74">&amp;#34;Thread-1&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Thread thread2 &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Thread(task, &lt;span style="color:#e6db74">&amp;#34;Thread-2&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> thread1.&lt;span style="color:#a6e22e">start&lt;/span>(); &lt;span style="color:#75715e">// è¾“å‡º: Thread-1 Value: 1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> thread2.&lt;span style="color:#a6e22e">start&lt;/span>(); &lt;span style="color:#75715e">// è¾“å‡º: Thread-2 Value: 1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="threadlocal-åŸç†äº†è§£å—">
 â­ï¸ThreadLocal åŸç†äº†è§£å—ï¼Ÿ
 &lt;a class="anchor" href="#threadlocal-%e5%8e%9f%e7%90%86%e4%ba%86%e8%a7%a3%e5%90%97">#&lt;/a>
&lt;/h3>
&lt;p>ä» &lt;code>Thread&lt;/code>ç±»æºä»£ç å…¥æ‰‹ã€‚&lt;/p></description></item><item><title>Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸­ï¼‰</title><link>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/java-concurrent-questions-02/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/java-concurrent-questions-02/</guid><description>&lt;h2 id="jmmjava-å†…å­˜æ¨¡å‹">
 â­ï¸JMM(Java å†…å­˜æ¨¡å‹)
 &lt;a class="anchor" href="#jmmjava-%e5%86%85%e5%ad%98%e6%a8%a1%e5%9e%8b">#&lt;/a>
&lt;/h2>
&lt;p>JMMï¼ˆJava å†…å­˜æ¨¡å‹ï¼‰ç›¸å…³çš„é—®é¢˜æ¯”è¾ƒå¤šï¼Œä¹Ÿæ¯”è¾ƒé‡è¦ï¼Œäºæ˜¯æˆ‘å•ç‹¬æŠ½äº†ä¸€ç¯‡æ–‡ç« æ¥æ€»ç»“ JMM ç›¸å…³çš„çŸ¥è¯†ç‚¹å’Œé—®é¢˜ï¼š
&lt;a target="_blank" href="./jmm.md">JMMï¼ˆJava å†…å­˜æ¨¡å‹ï¼‰è¯¦è§£&lt;/a> ã€‚&lt;/p>
&lt;h2 id="volatile-å…³é”®å­—">
 â­ï¸volatile å…³é”®å­—
 &lt;a class="anchor" href="#volatile-%e5%85%b3%e9%94%ae%e5%ad%97">#&lt;/a>
&lt;/h2>
&lt;h3 id="å¦‚ä½•ä¿è¯å˜é‡çš„å¯è§æ€§">
 å¦‚ä½•ä¿è¯å˜é‡çš„å¯è§æ€§ï¼Ÿ
 &lt;a class="anchor" href="#%e5%a6%82%e4%bd%95%e4%bf%9d%e8%af%81%e5%8f%98%e9%87%8f%e7%9a%84%e5%8f%af%e8%a7%81%e6%80%a7">#&lt;/a>
&lt;/h3>
&lt;p>åœ¨ Java ä¸­ï¼Œ&lt;code>volatile&lt;/code> å…³é”®å­—å¯ä»¥ä¿è¯å˜é‡çš„å¯è§æ€§ï¼Œå¦‚æœæˆ‘ä»¬å°†å˜é‡å£°æ˜ä¸º &lt;mark>&lt;code>volatile&lt;/code>&lt;/mark> ï¼Œè¿™å°±æŒ‡ç¤º JVMï¼Œè¿™ä¸ªå˜é‡æ˜¯å…±äº«ä¸”ä¸ç¨³å®šçš„ï¼Œæ¯æ¬¡ä½¿ç”¨å®ƒéƒ½åˆ°ä¸»å­˜ä¸­è¿›è¡Œè¯»å–ã€‚&lt;/p>
&lt;p>&lt;img src="https://oss.javaguide.cn/github/javaguide/java/concurrent/jmm.png" alt="JMM(Java å†…å­˜æ¨¡å‹)" />&lt;/p>
&lt;p>&lt;img src="https://oss.javaguide.cn/github/javaguide/java/concurrent/jmm2.png" alt="JMM(Java å†…å­˜æ¨¡å‹)å¼ºåˆ¶åœ¨ä¸»å­˜ä¸­è¿›è¡Œè¯»å–" />&lt;/p>
&lt;p>&lt;code>volatile&lt;/code> å…³é”®å­—å…¶å®å¹¶éæ˜¯ Java è¯­è¨€ç‰¹æœ‰çš„ï¼Œåœ¨ C è¯­è¨€é‡Œä¹Ÿæœ‰ï¼Œå®ƒæœ€åŸå§‹çš„æ„ä¹‰å°±æ˜¯ç¦ç”¨ CPU ç¼“å­˜ã€‚å¦‚æœæˆ‘ä»¬å°†ä¸€ä¸ªå˜é‡ä½¿ç”¨ &lt;code>volatile&lt;/code> ä¿®é¥°ï¼Œè¿™å°±æŒ‡ç¤º ç¼–è¯‘å™¨ï¼Œè¿™ä¸ªå˜é‡æ˜¯å…±äº«ä¸”ä¸ç¨³å®šçš„ï¼Œæ¯æ¬¡ä½¿ç”¨å®ƒéƒ½åˆ°ä¸»å­˜ä¸­è¿›è¡Œè¯»å–ã€‚&lt;/p>
&lt;p>&lt;code>volatile&lt;/code> å…³é”®å­—èƒ½ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œä½†ä¸èƒ½ä¿è¯æ•°æ®çš„åŸå­æ€§ã€‚&lt;code>synchronized&lt;/code> å…³é”®å­—ä¸¤è€…éƒ½èƒ½ä¿è¯ã€‚&lt;/p>
&lt;h3 id="å¦‚ä½•ç¦æ­¢æŒ‡ä»¤é‡æ’åº">
 å¦‚ä½•ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Ÿ
 &lt;a class="anchor" href="#%e5%a6%82%e4%bd%95%e7%a6%81%e6%ad%a2%e6%8c%87%e4%bb%a4%e9%87%8d%e6%8e%92%e5%ba%8f">#&lt;/a>
&lt;/h3>
&lt;p>&lt;mark>åœ¨ Java ä¸­ï¼Œ&lt;code>volatile&lt;/code> å…³é”®å­—é™¤äº†å¯ä»¥ä¿è¯å˜é‡çš„å¯è§æ€§ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä½œç”¨å°±æ˜¯é˜²æ­¢ JVM çš„æŒ‡ä»¤é‡æ’åºã€‚&lt;/mark> å¦‚æœæˆ‘ä»¬å°†å˜é‡å£°æ˜ä¸º &lt;mark>&lt;code>volatile&lt;/code>&lt;/mark> ï¼Œåœ¨å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œè¯»å†™æ“ä½œçš„æ—¶å€™ï¼Œä¼šé€šè¿‡æ’å…¥ç‰¹å®šçš„ &lt;mark>å†…å­˜å±éšœ&lt;/mark> çš„æ–¹å¼æ¥ç¦æ­¢æŒ‡ä»¤é‡æ’åºã€‚&lt;/p>
&lt;p>åœ¨ Java ä¸­ï¼Œ&lt;code>Unsafe&lt;/code> ç±»æä¾›äº†ä¸‰ä¸ªå¼€ç®±å³ç”¨çš„å†…å­˜å±éšœç›¸å…³çš„æ–¹æ³•ï¼Œå±è”½äº†æ“ä½œç³»ç»Ÿåº•å±‚çš„å·®å¼‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">native&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">loadFence&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">native&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">storeFence&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">native&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">fullFence&lt;/span>();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç†è®ºä¸Šæ¥è¯´ï¼Œä½ é€šè¿‡è¿™ä¸ªä¸‰ä¸ªæ–¹æ³•ä¹Ÿå¯ä»¥å®ç°å’Œ&lt;code>volatile&lt;/code>ç¦æ­¢é‡æ’åºä¸€æ ·çš„æ•ˆæœï¼Œåªæ˜¯ä¼šéº»çƒ¦ä¸€äº›ã€‚&lt;/p>
&lt;p>ä¸‹é¢æˆ‘ä»¥ä¸€ä¸ªå¸¸è§çš„é¢è¯•é¢˜ä¸ºä¾‹è®²è§£ä¸€ä¸‹ &lt;code>volatile&lt;/code> å…³é”®å­—ç¦æ­¢æŒ‡ä»¤é‡æ’åºçš„æ•ˆæœã€‚&lt;/p>
&lt;p>é¢è¯•ä¸­é¢è¯•å®˜ç»å¸¸ä¼šè¯´ï¼šâ€œå•ä¾‹æ¨¡å¼äº†è§£å—ï¼Ÿæ¥ç»™æˆ‘æ‰‹å†™ä¸€ä¸‹ï¼ç»™æˆ‘è§£é‡Šä¸€ä¸‹åŒé‡æ£€éªŒé”æ–¹å¼å®ç°å•ä¾‹æ¨¡å¼çš„åŸç†å‘—ï¼â€&lt;/p>
&lt;p>&lt;mark>åŒé‡æ ¡éªŒé”å®ç°å¯¹è±¡å•ä¾‹ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰&lt;/mark>ï¼š&lt;/p></description></item><item><title>JMMï¼ˆJava å†…å­˜æ¨¡å‹ï¼‰è¯¦è§£</title><link>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/jmm/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/jmm/</guid><description>&lt;p>JMM(Java å†…å­˜æ¨¡å‹)ä¸»è¦å®šä¹‰äº†å¯¹äºä¸€ä¸ªå…±äº«å˜é‡ï¼Œå½“å¦ä¸€ä¸ªçº¿ç¨‹å¯¹è¿™ä¸ªå…±äº«å˜é‡æ‰§è¡Œå†™æ“ä½œåï¼Œè¿™ä¸ªçº¿ç¨‹å¯¹è¿™ä¸ªå…±äº«å˜é‡çš„å¯è§æ€§ã€‚&lt;/p>
&lt;p>è¦æƒ³ç†è§£é€å½» JMMï¼ˆJava å†…å­˜æ¨¡å‹ï¼‰ï¼Œæˆ‘ä»¬å…ˆè¦ä» &lt;mark>CPU ç¼“å­˜æ¨¡å‹å’ŒæŒ‡ä»¤é‡æ’åº&lt;/mark> è¯´èµ·ï¼&lt;/p>
&lt;h2 id="ä»-cpu-ç¼“å­˜æ¨¡å‹è¯´èµ·">
 ä» CPU ç¼“å­˜æ¨¡å‹è¯´èµ·
 &lt;a class="anchor" href="#%e4%bb%8e-cpu-%e7%bc%93%e5%ad%98%e6%a8%a1%e5%9e%8b%e8%af%b4%e8%b5%b7">#&lt;/a>
&lt;/h2>
&lt;p>&lt;mark>ä¸ºä»€ä¹ˆè¦å¼„ä¸€ä¸ª CPU é«˜é€Ÿç¼“å­˜å‘¢ï¼Ÿ&lt;/mark> ç±»æ¯”æˆ‘ä»¬å¼€å‘ç½‘ç«™åå°ç³»ç»Ÿä½¿ç”¨çš„ç¼“å­˜ï¼ˆæ¯”å¦‚ Redisï¼‰æ˜¯ä¸ºäº†è§£å†³ç¨‹åºå¤„ç†é€Ÿåº¦å’Œè®¿é—®å¸¸è§„å…³ç³»å‹æ•°æ®åº“é€Ÿåº¦ä¸å¯¹ç­‰çš„é—®é¢˜ã€‚ &lt;mark>CPU ç¼“å­˜åˆ™æ˜¯ä¸ºäº†è§£å†³ CPU å¤„ç†é€Ÿåº¦å’Œå†…å­˜å¤„ç†é€Ÿåº¦ä¸å¯¹ç­‰çš„é—®é¢˜ã€‚&lt;/mark>&lt;/p>
&lt;p>æˆ‘ä»¬ç”šè‡³å¯ä»¥æŠŠ &lt;mark>å†…å­˜çœ‹ä½œå¤–å­˜çš„é«˜é€Ÿç¼“å­˜&lt;/mark>ï¼Œç¨‹åºè¿è¡Œçš„æ—¶å€™æˆ‘ä»¬æŠŠå¤–å­˜çš„æ•°æ®å¤åˆ¶åˆ°å†…å­˜ï¼Œç”±äºå†…å­˜çš„å¤„ç†é€Ÿåº¦è¿œè¿œé«˜äºå¤–å­˜ï¼Œè¿™æ ·æé«˜äº†å¤„ç†é€Ÿåº¦ã€‚&lt;/p>
&lt;p>æ€»ç»“ï¼š&lt;mark>CPU Cache ç¼“å­˜çš„æ˜¯å†…å­˜æ•°æ®ç”¨äºè§£å†³ CPU å¤„ç†é€Ÿåº¦å’Œå†…å­˜ä¸åŒ¹é…çš„é—®é¢˜ï¼Œå†…å­˜ç¼“å­˜çš„æ˜¯ç¡¬ç›˜æ•°æ®ç”¨äºè§£å†³ç¡¬ç›˜è®¿é—®é€Ÿåº¦è¿‡æ…¢çš„é—®é¢˜ã€‚&lt;/mark>&lt;/p>
&lt;p>ä¸ºäº†æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘ç”»äº†ä¸€ä¸ªç®€å•çš„ CPU Cache ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚&lt;/p>
&lt;blockquote>
&lt;p>&lt;mark>ğŸ› ä¿®æ­£ï¼ˆå‚è§ï¼š
&lt;a target="_blank" href="https://github.com/Snailclimb/JavaGuide/issues/1848">issue#1848&lt;/a>ï¼‰&lt;/mark>ï¼šå¯¹ CPU ç¼“å­˜æ¨¡å‹ç»˜å›¾ä¸ä¸¥è°¨çš„åœ°æ–¹è¿›è¡Œå®Œå–„ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>&lt;img src="https://oss.javaguide.cn/github/javaguide/java/concurrent/cpu-cache.png" alt="CPU ç¼“å­˜æ¨¡å‹ç¤ºæ„å›¾" />&lt;/p>
&lt;p>ç°ä»£çš„ CPU Cache é€šå¸¸åˆ†ä¸ºä¸‰å±‚ï¼Œåˆ†åˆ«å« L1,L2,L3 Cacheã€‚æœ‰äº› CPU å¯èƒ½è¿˜æœ‰ L4 Cacheï¼Œè¿™é‡Œä¸åšè®¨è®ºï¼Œå¹¶ä¸å¸¸è§&lt;/p>
&lt;p>&lt;mark>CPU Cache çš„å·¥ä½œæ–¹å¼ï¼š&lt;/mark> å…ˆå¤åˆ¶ä¸€ä»½æ•°æ®åˆ° CPU Cache ä¸­ï¼Œå½“ CPU éœ€è¦ç”¨åˆ°çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥ä» CPU Cache ä¸­è¯»å–æ•°æ®ï¼Œå½“è¿ç®—å®Œæˆåï¼Œå†å°†è¿ç®—å¾—åˆ°çš„æ•°æ®å†™å› Main Memory ä¸­ã€‚ä½†æ˜¯ï¼Œè¿™æ ·å­˜åœ¨ &lt;mark>å†…å­˜ç¼“å­˜ä¸ä¸€è‡´æ€§çš„é—®é¢˜&lt;/mark> ï¼æ¯”å¦‚æˆ‘æ‰§è¡Œä¸€ä¸ª i++ æ“ä½œçš„è¯ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œçš„è¯ï¼Œå‡è®¾ä¸¤ä¸ªçº¿ç¨‹ä» CPU Cache ä¸­è¯»å–çš„ i=1ï¼Œä¸¤ä¸ªçº¿ç¨‹åšäº† i++ è¿ç®—å®Œä¹‹åå†å†™å› Main Memory ä¹‹å i=2ï¼Œè€Œæ­£ç¡®ç»“æœåº”è¯¥æ˜¯ i=3ã€‚&lt;/p></description></item><item><title>ThreadLocal è¯¦è§£</title><link>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/threadlocal/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/threadlocal/</guid><description>&lt;blockquote>
&lt;p>æœ¬æ–‡æ¥è‡ªä¸€æèŠ±ç®—ä¸ç®—æµªæ¼«æŠ•ç¨¿ï¼Œ åŸæ–‡åœ°å€ï¼š
&lt;a target="_blank" href="https://juejin.cn/post/6844904151567040519">https://juejin.cn/post/6844904151567040519&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="å‰è¨€">
 å‰è¨€
 &lt;a class="anchor" href="#%e5%89%8d%e8%a8%80">#&lt;/a>
&lt;/h3>
&lt;p>&lt;img src="./images/thread-local/1.png" alt="" />&lt;/p>
&lt;p>&lt;mark>å…¨æ–‡å…± 10000+å­—ï¼Œ31 å¼ å›¾ï¼Œè¿™ç¯‡æ–‡ç« åŒæ ·è€—è´¹äº†ä¸å°‘çš„æ—¶é—´å’Œç²¾åŠ›æ‰åˆ›ä½œå®Œæˆï¼ŒåŸåˆ›ä¸æ˜“ï¼Œè¯·å¤§å®¶ç‚¹ç‚¹å…³æ³¨+åœ¨çœ‹ï¼Œæ„Ÿè°¢ã€‚&lt;/mark>&lt;/p>
&lt;p>å¯¹äº&lt;code>ThreadLocal&lt;/code>ï¼Œå¤§å®¶çš„ç¬¬ä¸€ååº”å¯èƒ½æ˜¯å¾ˆç®€å•å‘€ï¼Œçº¿ç¨‹çš„å˜é‡å‰¯æœ¬ï¼Œæ¯ä¸ªçº¿ç¨‹éš”ç¦»ã€‚é‚£è¿™é‡Œæœ‰å‡ ä¸ªé—®é¢˜å¤§å®¶å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>ThreadLocal&lt;/code>çš„ key æ˜¯&lt;mark>å¼±å¼•ç”¨&lt;/mark>ï¼Œé‚£ä¹ˆåœ¨ &lt;code>ThreadLocal.get()&lt;/code>çš„æ—¶å€™ï¼Œå‘ç”Ÿ&lt;mark>GC&lt;/mark>ä¹‹åï¼Œkey æ˜¯å¦ä¸º&lt;mark>null&lt;/mark>ï¼Ÿ&lt;/li>
&lt;li>&lt;code>ThreadLocal&lt;/code>ä¸­&lt;code>ThreadLocalMap&lt;/code>çš„&lt;mark>æ•°æ®ç»“æ„&lt;/mark>ï¼Ÿ&lt;/li>
&lt;li>&lt;code>ThreadLocalMap&lt;/code>çš„&lt;mark>Hash ç®—æ³•&lt;/mark>ï¼Ÿ&lt;/li>
&lt;li>&lt;code>ThreadLocalMap&lt;/code>ä¸­&lt;mark>Hash å†²çª&lt;/mark>å¦‚ä½•è§£å†³ï¼Ÿ&lt;/li>
&lt;li>&lt;code>ThreadLocalMap&lt;/code>çš„&lt;mark>æ‰©å®¹æœºåˆ¶&lt;/mark>ï¼Ÿ&lt;/li>
&lt;li>&lt;code>ThreadLocalMap&lt;/code>ä¸­&lt;mark>è¿‡æœŸ key çš„æ¸…ç†æœºåˆ¶&lt;/mark>ï¼Ÿ&lt;mark>æ¢æµ‹å¼æ¸…ç†&lt;/mark>å’Œ&lt;mark>å¯å‘å¼æ¸…ç†&lt;/mark>æµç¨‹ï¼Ÿ&lt;/li>
&lt;li>&lt;code>ThreadLocalMap.set()&lt;/code>æ–¹æ³•å®ç°åŸç†ï¼Ÿ&lt;/li>
&lt;li>&lt;code>ThreadLocalMap.get()&lt;/code>æ–¹æ³•å®ç°åŸç†ï¼Ÿ&lt;/li>
&lt;li>é¡¹ç›®ä¸­&lt;code>ThreadLocal&lt;/code>ä½¿ç”¨æƒ…å†µï¼Ÿé‡åˆ°çš„å‘ï¼Ÿ&lt;/li>
&lt;li>â€¦â€¦&lt;/li>
&lt;/ul>
&lt;p>ä¸Šè¿°çš„ä¸€äº›é—®é¢˜ä½ æ˜¯å¦éƒ½å·²ç»æŒæ¡çš„å¾ˆæ¸…æ¥šäº†å‘¢ï¼Ÿæœ¬æ–‡å°†å›´ç»•è¿™äº›é—®é¢˜ä½¿ç”¨å›¾æ–‡æ–¹å¼æ¥å‰–æ&lt;code>ThreadLocal&lt;/code>çš„&lt;mark>ç‚¹ç‚¹æ»´æ»´&lt;/mark>ã€‚&lt;/p>
&lt;h3 id="ç›®å½•">
 ç›®å½•
 &lt;a class="anchor" href="#%e7%9b%ae%e5%bd%95">#&lt;/a>
&lt;/h3>
&lt;p>&lt;mark>æ³¨æ˜ï¼š&lt;/mark> æœ¬æ–‡æºç åŸºäº&lt;code>JDK 1.8&lt;/code>&lt;/p>
&lt;h3 id="threadlocalä»£ç æ¼”ç¤º">
 &lt;code>ThreadLocal&lt;/code>ä»£ç æ¼”ç¤º
 &lt;a class="anchor" href="#threadlocal%e4%bb%a3%e7%a0%81%e6%bc%94%e7%a4%ba">#&lt;/a>
&lt;/h3>
&lt;p>æˆ‘ä»¬å…ˆçœ‹ä¸‹&lt;code>ThreadLocal&lt;/code>ä½¿ç”¨ç¤ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">ThreadLocalTest&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">private&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>String&lt;span style="color:#f92672">&amp;gt;&lt;/span> messages &lt;span style="color:#f92672">=&lt;/span> Lists.&lt;span style="color:#a6e22e">newArrayList&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">final&lt;/span> ThreadLocal&lt;span style="color:#f92672">&amp;lt;&lt;/span>ThreadLocalTest&lt;span style="color:#f92672">&amp;gt;&lt;/span> holder &lt;span style="color:#f92672">=&lt;/span> ThreadLocal.&lt;span style="color:#a6e22e">withInitial&lt;/span>(ThreadLocalTest::&lt;span style="color:#66d9ef">new&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">add&lt;/span>(String message) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> holder.&lt;span style="color:#a6e22e">get&lt;/span>().&lt;span style="color:#a6e22e">messages&lt;/span>.&lt;span style="color:#a6e22e">add&lt;/span>(message);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>String&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#a6e22e">clear&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> List&lt;span style="color:#f92672">&amp;lt;&lt;/span>String&lt;span style="color:#f92672">&amp;gt;&lt;/span> messages &lt;span style="color:#f92672">=&lt;/span> holder.&lt;span style="color:#a6e22e">get&lt;/span>().&lt;span style="color:#a6e22e">messages&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> holder.&lt;span style="color:#a6e22e">remove&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;size: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> holder.&lt;span style="color:#a6e22e">get&lt;/span>().&lt;span style="color:#a6e22e">messages&lt;/span>.&lt;span style="color:#a6e22e">size&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> messages;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ThreadLocalTest.&lt;span style="color:#a6e22e">add&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ä¸€æèŠ±ç®—ä¸ç®—æµªæ¼«&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(holder.&lt;span style="color:#a6e22e">get&lt;/span>().&lt;span style="color:#a6e22e">messages&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ThreadLocalTest.&lt;span style="color:#a6e22e">clear&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰“å°ç»“æœï¼š&lt;/p></description></item><item><title>ä»ReentrantLockçš„å®ç°çœ‹AQSçš„åŸç†åŠåº”ç”¨</title><link>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/reentrantlock/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/reentrantlock/</guid><description>&lt;blockquote>
&lt;p>æœ¬æ–‡è½¬è½½è‡ªï¼š
&lt;a target="_blank" href="https://tech.meituan.com/2019/12/05/aqs-theory-and-apply.html">https://tech.meituan.com/2019/12/05/aqs-theory-and-apply.html&lt;/a>&lt;/p>
&lt;p>ä½œè€…ï¼šç¾å›¢æŠ€æœ¯å›¢é˜Ÿ&lt;/p>
&lt;/blockquote>
&lt;p>Java ä¸­çš„å¤§éƒ¨åˆ†åŒæ­¥ç±»ï¼ˆSemaphoreã€ReentrantLock ç­‰ï¼‰éƒ½æ˜¯åŸºäº AbstractQueuedSynchronizerï¼ˆç®€ç§°ä¸º AQSï¼‰å®ç°çš„ã€‚AQS æ˜¯ä¸€ç§æä¾›äº†åŸå­å¼ç®¡ç†åŒæ­¥çŠ¶æ€ã€é˜»å¡å’Œå”¤é†’çº¿ç¨‹åŠŸèƒ½ä»¥åŠé˜Ÿåˆ—æ¨¡å‹çš„ç®€å•æ¡†æ¶ã€‚&lt;/p>
&lt;p>æœ¬æ–‡ä¼šä»åº”ç”¨å±‚é€æ¸æ·±å…¥åˆ°åŸç†å±‚ï¼Œå¹¶é€šè¿‡ ReentrantLock çš„åŸºæœ¬ç‰¹æ€§å’Œ ReentrantLock ä¸ AQS çš„å…³è”ï¼Œæ¥æ·±å…¥è§£è¯» AQS ç›¸å…³ç‹¬å é”çš„çŸ¥è¯†ç‚¹ï¼ŒåŒæ—¶é‡‡å–é—®ç­”çš„æ¨¡å¼æ¥å¸®åŠ©å¤§å®¶ç†è§£ AQSã€‚ç”±äºç¯‡å¹…åŸå› ï¼Œæœ¬ç¯‡æ–‡ç« ä¸»è¦é˜è¿° AQS ä¸­ç‹¬å é”çš„é€»è¾‘å’Œ Sync Queueï¼Œä¸è®²è¿°åŒ…å«å…±äº«é”å’Œ Condition Queue çš„éƒ¨åˆ†ï¼ˆæœ¬ç¯‡æ–‡ç« æ ¸å¿ƒä¸º AQS åŸç†å‰–æï¼Œåªæ˜¯ç®€å•ä»‹ç»äº† ReentrantLockï¼Œæ„Ÿå…´è¶£åŒå­¦å¯ä»¥é˜…è¯»ä¸€ä¸‹ ReentrantLock çš„æºç ï¼‰ã€‚&lt;/p>
&lt;h2 id="1-reentrantlock">
 1 ReentrantLock
 &lt;a class="anchor" href="#1-reentrantlock">#&lt;/a>
&lt;/h2>
&lt;h3 id="11-reentrantlock-ç‰¹æ€§æ¦‚è§ˆ">
 1.1 ReentrantLock ç‰¹æ€§æ¦‚è§ˆ
 &lt;a class="anchor" href="#11-reentrantlock-%e7%89%b9%e6%80%a7%e6%a6%82%e8%a7%88">#&lt;/a>
&lt;/h3>
&lt;p>ReentrantLock æ„æ€ä¸ºå¯é‡å…¥é”ï¼ŒæŒ‡çš„æ˜¯ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿå¯¹ä¸€ä¸ªä¸´ç•Œèµ„æºé‡å¤åŠ é”ã€‚ä¸ºäº†å¸®åŠ©å¤§å®¶æ›´å¥½åœ°ç†è§£ ReentrantLock çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å…ˆå°† ReentrantLock è·Ÿå¸¸ç”¨çš„ Synchronized è¿›è¡Œæ¯”è¾ƒï¼Œå…¶ç‰¹æ€§å¦‚ä¸‹ï¼ˆè“è‰²éƒ¨åˆ†ä¸ºæœ¬ç¯‡æ–‡ç« ä¸»è¦å‰–æçš„ç‚¹ï¼‰ï¼š&lt;/p>
&lt;p>&lt;img src="https://p0.meituan.net/travelcube/412d294ff5535bbcddc0d979b2a339e6102264.png" alt="" />&lt;/p>
&lt;p>ä¸‹é¢é€šè¿‡ä¼ªä»£ç ï¼Œè¿›è¡Œæ›´åŠ ç›´è§‚çš„æ¯”è¾ƒï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ==========================Synchronizedçš„ä½¿ç”¨æ–¹å¼==========================&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 1.ç”¨äºä»£ç å—&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">synchronized&lt;/span> (&lt;span style="color:#66d9ef">this&lt;/span>) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 2.ç”¨äºå¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">synchronized&lt;/span> (object) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 3.ç”¨äºæ–¹æ³•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">synchronized&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test&lt;/span> () {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 4.å¯é‡å…¥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> (&lt;span style="color:#66d9ef">int&lt;/span> i &lt;span style="color:#f92672">=&lt;/span> 0; i &lt;span style="color:#f92672">&amp;lt;&lt;/span> 100; i&lt;span style="color:#f92672">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">synchronized&lt;/span> (&lt;span style="color:#66d9ef">this&lt;/span>) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ==========================ReentrantLockçš„ä½¿ç”¨æ–¹å¼==========================&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">test&lt;/span> () &lt;span style="color:#66d9ef">throw&lt;/span> Exception {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 1.åˆå§‹åŒ–é€‰æ‹©å…¬å¹³é”ã€éå…¬å¹³é”&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ReentrantLock lock &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ReentrantLock(&lt;span style="color:#66d9ef">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 2.å¯ç”¨äºä»£ç å—&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lock.&lt;span style="color:#a6e22e">lock&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 3.æ”¯æŒå¤šç§åŠ é”æ–¹å¼ï¼Œæ¯”è¾ƒçµæ´»; å…·æœ‰å¯é‡å…¥ç‰¹æ€§&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>(lock.&lt;span style="color:#a6e22e">tryLock&lt;/span>(100, TimeUnit.&lt;span style="color:#a6e22e">MILLISECONDS&lt;/span>)){ }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">finally&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 4.æ‰‹åŠ¨é‡Šæ”¾é”&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lock.&lt;span style="color:#a6e22e">unlock&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">finally&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lock.&lt;span style="color:#a6e22e">unlock&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="12-reentrantlock-ä¸-aqs-çš„å…³è”">
 1.2 ReentrantLock ä¸ AQS çš„å…³è”
 &lt;a class="anchor" href="#12-reentrantlock-%e4%b8%8e-aqs-%e7%9a%84%e5%85%b3%e8%81%94">#&lt;/a>
&lt;/h3>
&lt;p>é€šè¿‡ä¸Šæ–‡æˆ‘ä»¬å·²ç»äº†è§£ï¼ŒReentrantLock æ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”ï¼ˆå…³äºå…¬å¹³é”å’Œéå…¬å¹³é”çš„åŸç†åˆ†æï¼Œå¯å‚è€ƒã€Š
&lt;a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651749434&amp;amp;idx=3&amp;amp;sn=5ffa63ad47fe166f2f1a9f604ed10091&amp;amp;chksm=bd12a5778a652c61509d9e718ab086ff27ad8768586ea9b38c3dcf9e017a8e49bcae3df9bcc8&amp;amp;scene=38#wechat_redirect">ä¸å¯ä¸è¯´çš„ Javaâ€œé”â€äº‹&lt;/a>ã€‹ï¼‰ï¼Œå¹¶ä¸” ReentrantLock çš„åº•å±‚å°±æ˜¯ç”± AQS æ¥å®ç°çš„ã€‚é‚£ä¹ˆ ReentrantLock æ˜¯å¦‚ä½•é€šè¿‡å…¬å¹³é”å’Œéå…¬å¹³é”ä¸ AQS å…³è”èµ·æ¥å‘¢ï¼Ÿ æˆ‘ä»¬ç€é‡ä»è¿™ä¸¤è€…çš„åŠ é”è¿‡ç¨‹æ¥ç†è§£ä¸€ä¸‹å®ƒä»¬ä¸ AQS ä¹‹é—´çš„å…³ç³»ï¼ˆåŠ é”è¿‡ç¨‹ä¸­ä¸ AQS çš„å…³è”æ¯”è¾ƒæ˜æ˜¾ï¼Œè§£é”æµç¨‹åç»­ä¼šä»‹ç»ï¼‰ã€‚&lt;/p></description></item><item><title>ä¹è§‚é”å’Œæ‚²è§‚é”è¯¦è§£</title><link>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/optimistic-lock-and-pessimistic-lock/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/optimistic-lock-and-pessimistic-lock/</guid><description>&lt;p>å¦‚æœå°†æ‚²è§‚é”ï¼ˆPessimistic Lockï¼‰å’Œä¹è§‚é”ï¼ˆOptimistic Lockï¼‰å¯¹åº”åˆ°ç°å®ç”Ÿæ´»ä¸­æ¥ã€‚æ‚²è§‚é”æœ‰ç‚¹åƒæ˜¯ä¸€ä½æ¯”è¾ƒæ‚²è§‚ï¼ˆä¹Ÿå¯ä»¥è¯´æ˜¯æœªé›¨ç»¸ç¼ªï¼‰çš„äººï¼Œæ€»æ˜¯ä¼šå‡è®¾æœ€åçš„æƒ…å†µï¼Œé¿å…å‡ºç°é—®é¢˜ã€‚ä¹è§‚é”æœ‰ç‚¹åƒæ˜¯ä¸€ä½æ¯”è¾ƒä¹è§‚çš„äººï¼Œæ€»æ˜¯ä¼šå‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œåœ¨è¦å‡ºç°é—®é¢˜ä¹‹å‰å¿«é€Ÿè§£å†³é—®é¢˜ã€‚&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯æ‚²è§‚é”">
 ä»€ä¹ˆæ˜¯æ‚²è§‚é”ï¼Ÿ
 &lt;a class="anchor" href="#%e4%bb%80%e4%b9%88%e6%98%af%e6%82%b2%e8%a7%82%e9%94%81">#&lt;/a>
&lt;/h2>
&lt;p>æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œè®¤ä¸ºå…±äº«èµ„æºæ¯æ¬¡è¢«è®¿é—®çš„æ—¶å€™å°±ä¼šå‡ºç°é—®é¢˜(æ¯”å¦‚å…±äº«æ•°æ®è¢«ä¿®æ”¹)ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨è·å–èµ„æºæ“ä½œçš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹æƒ³æ‹¿åˆ°è¿™ä¸ªèµ„æºå°±ä¼šé˜»å¡ç›´åˆ°é”è¢«ä¸Šä¸€ä¸ªæŒæœ‰è€…é‡Šæ”¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ&lt;mark>å…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹&lt;/mark>ã€‚&lt;/p>
&lt;p>åƒ Java ä¸­&lt;code>synchronized&lt;/code>å’Œ&lt;code>ReentrantLock&lt;/code>ç­‰ç‹¬å é”å°±æ˜¯æ‚²è§‚é”æ€æƒ³çš„å®ç°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">performSynchronisedTask&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">synchronized&lt;/span> (&lt;span style="color:#66d9ef">this&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// éœ€è¦åŒæ­¥çš„æ“ä½œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">private&lt;/span> Lock lock &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> ReentrantLock();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>lock.&lt;span style="color:#a6e22e">lock&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// éœ€è¦åŒæ­¥çš„æ“ä½œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>} &lt;span style="color:#66d9ef">finally&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> lock.&lt;span style="color:#a6e22e">unlock&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œæ¿€çƒˆçš„é”ç«äº‰ä¼šé€ æˆçº¿ç¨‹é˜»å¡ï¼Œå¤§é‡é˜»å¡çº¿ç¨‹ä¼šå¯¼è‡´ç³»ç»Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¢åŠ ç³»ç»Ÿçš„æ€§èƒ½å¼€é”€ã€‚å¹¶ä¸”ï¼Œæ‚²è§‚é”è¿˜å¯èƒ½ä¼šå­˜åœ¨æ­»é”é—®é¢˜ï¼ˆçº¿ç¨‹è·å¾—é”çš„é¡ºåºä¸å½“æ—¶ï¼‰ï¼Œå½±å“ä»£ç çš„æ­£å¸¸è¿è¡Œã€‚&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯ä¹è§‚é”">
 ä»€ä¹ˆæ˜¯ä¹è§‚é”ï¼Ÿ
 &lt;a class="anchor" href="#%e4%bb%80%e4%b9%88%e6%98%af%e4%b9%90%e8%a7%82%e9%94%81">#&lt;/a>
&lt;/h2>
&lt;p>ä¹è§‚é”æ€»æ˜¯å‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œè®¤ä¸ºå…±äº«èµ„æºæ¯æ¬¡è¢«è®¿é—®çš„æ—¶å€™ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œçº¿ç¨‹å¯ä»¥ä¸åœåœ°æ‰§è¡Œï¼Œæ— éœ€åŠ é”ä¹Ÿæ— éœ€ç­‰å¾…ï¼Œåªæ˜¯åœ¨æäº¤ä¿®æ”¹çš„æ—¶å€™å»éªŒè¯å¯¹åº”çš„èµ„æºï¼ˆä¹Ÿå°±æ˜¯æ•°æ®ï¼‰æ˜¯å¦è¢«å…¶å®ƒçº¿ç¨‹ä¿®æ”¹äº†ï¼ˆå…·ä½“æ–¹æ³•å¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶æˆ– CAS ç®—æ³•ï¼‰ã€‚&lt;/p>
&lt;p>åœ¨ Java ä¸­&lt;code>java.util.concurrent.atomic&lt;/code>åŒ…ä¸‹é¢çš„åŸå­å˜é‡ç±»ï¼ˆæ¯”å¦‚&lt;code>AtomicInteger&lt;/code>ã€&lt;code>LongAdder&lt;/code>ï¼‰å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼ &lt;mark>CAS&lt;/mark> å®ç°çš„ã€‚
&lt;img src="https://oss.javaguide.cn/github/javaguide/java/JUC%E5%8E%9F%E5%AD%90%E7%B1%BB%E6%A6%82%E8%A7%88-20230814005211968.png" alt="JUCåŸå­ç±»æ¦‚è§ˆ" />&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// LongAdder åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ä¼šæ¯” AtomicInteger å’Œ AtomicLong çš„æ€§èƒ½æ›´å¥½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä»£ä»·å°±æ˜¯ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼ˆç©ºé—´æ¢æ—¶é—´ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>LongAdder sum &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> LongAdder();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sum.&lt;span style="color:#a6e22e">increment&lt;/span>();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œä¹è§‚é”ç›¸æ¯”æ‚²è§‚é”æ¥è¯´ï¼Œä¸å­˜åœ¨é”ç«äº‰é€ æˆçº¿ç¨‹é˜»å¡ï¼Œä¹Ÿä¸ä¼šæœ‰æ­»é”é—®é¢˜ï¼Œåœ¨æ€§èƒ½ä¸Šå¾€å¾€ä¼šæ›´èƒœä¸€ç­¹ã€‚ä½†æ˜¯ï¼Œå¦‚æœå†²çªé¢‘ç¹å‘ç”Ÿï¼ˆå†™å æ¯”éå¸¸å¤šçš„æƒ…å†µï¼‰ï¼Œä¼šé¢‘ç¹å¤±è´¥å¹¶é‡è¯•ï¼Œè¿™æ ·åŒæ ·ä¼šéå¸¸å½±å“æ€§èƒ½ï¼Œå¯¼è‡´ CPU é£™å‡ã€‚&lt;/p>
&lt;p>ä¸è¿‡ï¼Œå¤§é‡å¤±è´¥é‡è¯•çš„é—®é¢˜ä¹Ÿæ˜¯å¯ä»¥è§£å†³çš„ï¼Œåƒæˆ‘ä»¬å‰é¢æåˆ°çš„ &lt;code>LongAdder&lt;/code>ä»¥ç©ºé—´æ¢æ—¶é—´çš„æ–¹å¼å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚&lt;/p>
&lt;p>ç†è®ºä¸Šæ¥è¯´ï¼š&lt;/p>
&lt;ul>
&lt;li>æ‚²è§‚é”é€šå¸¸å¤šç”¨äºå†™æ¯”è¾ƒå¤šçš„æƒ…å†µï¼ˆå¤šå†™åœºæ™¯ï¼Œç«äº‰æ¿€çƒˆï¼‰ï¼Œè¿™æ ·å¯ä»¥é¿å…é¢‘ç¹å¤±è´¥å’Œé‡è¯•å½±å“æ€§èƒ½ï¼Œæ‚²è§‚é”çš„å¼€é”€æ˜¯å›ºå®šçš„ã€‚ä¸è¿‡ï¼Œå¦‚æœä¹è§‚é”è§£å†³äº†é¢‘ç¹å¤±è´¥å’Œé‡è¯•è¿™ä¸ªé—®é¢˜çš„è¯ï¼ˆæ¯”å¦‚&lt;code>LongAdder&lt;/code>ï¼‰ï¼Œä¹Ÿæ˜¯å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¹è§‚é”çš„ï¼Œè¦è§†å®é™…æƒ…å†µè€Œå®šã€‚&lt;/li>
&lt;li>ä¹è§‚é”é€šå¸¸å¤šç”¨äºå†™æ¯”è¾ƒå°‘çš„æƒ…å†µï¼ˆå¤šè¯»åœºæ™¯ï¼Œç«äº‰è¾ƒå°‘ï¼‰ï¼Œè¿™æ ·å¯ä»¥é¿å…é¢‘ç¹åŠ é”å½±å“æ€§èƒ½ã€‚ä¸è¿‡ï¼Œä¹è§‚é”ä¸»è¦é’ˆå¯¹çš„å¯¹è±¡æ˜¯å•ä¸ªå…±äº«å˜é‡ï¼ˆå‚è€ƒ&lt;code>java.util.concurrent.atomic&lt;/code>åŒ…ä¸‹é¢çš„åŸå­å˜é‡ç±»ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="å¦‚ä½•å®ç°ä¹è§‚é”">
 å¦‚ä½•å®ç°ä¹è§‚é”ï¼Ÿ
 &lt;a class="anchor" href="#%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0%e4%b9%90%e8%a7%82%e9%94%81">#&lt;/a>
&lt;/h2>
&lt;p>ä¹è§‚é”ä¸€èˆ¬ä¼šä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶æˆ– CAS ç®—æ³•å®ç°ï¼ŒCAS ç®—æ³•ç›¸å¯¹æ¥è¯´æ›´å¤šä¸€äº›ï¼Œè¿™é‡Œéœ€è¦æ ¼å¤–æ³¨æ„ã€‚&lt;/p></description></item><item><title>è™šæ‹Ÿçº¿ç¨‹å¸¸è§é—®é¢˜æ€»ç»“</title><link>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/virtual-thread/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lwmfjc.github.io/zh/docs/technology/Interview/java/concurrent/virtual-thread/</guid><description>&lt;blockquote>
&lt;p>æœ¬æ–‡éƒ¨åˆ†å†…å®¹æ¥è‡ª 
&lt;a target="_blank" href="https://github.com/Lorin-github">Lorin&lt;/a> çš„
&lt;a target="_blank" href="https://github.com/Snailclimb/JavaGuide/pull/2190">PR&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>è™šæ‹Ÿçº¿ç¨‹åœ¨ Java 21 æ­£å¼å‘å¸ƒï¼Œè¿™æ˜¯ä¸€é¡¹é‡é‡çº§çš„æ›´æ–°ã€‚&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯è™šæ‹Ÿçº¿ç¨‹">
 ä»€ä¹ˆæ˜¯è™šæ‹Ÿçº¿ç¨‹ï¼Ÿ
 &lt;a class="anchor" href="#%e4%bb%80%e4%b9%88%e6%98%af%e8%99%9a%e6%8b%9f%e7%ba%bf%e7%a8%8b">#&lt;/a>
&lt;/h2>
&lt;p>è™šæ‹Ÿçº¿ç¨‹ï¼ˆVirtual Threadï¼‰æ˜¯ JDK è€Œä¸æ˜¯ OS å®ç°çš„è½»é‡çº§çº¿ç¨‹(Lightweight Processï¼ŒLWPï¼‰ï¼Œç”± JVM è°ƒåº¦ã€‚è®¸å¤šè™šæ‹Ÿçº¿ç¨‹å…±äº«åŒä¸€ä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼Œè™šæ‹Ÿçº¿ç¨‹çš„æ•°é‡å¯ä»¥è¿œå¤§äºæ“ä½œç³»ç»Ÿçº¿ç¨‹çš„æ•°é‡ã€‚&lt;/p>
&lt;h2 id="è™šæ‹Ÿçº¿ç¨‹å’Œå¹³å°çº¿ç¨‹æœ‰ä»€ä¹ˆå…³ç³»">
 è™šæ‹Ÿçº¿ç¨‹å’Œå¹³å°çº¿ç¨‹æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ
 &lt;a class="anchor" href="#%e8%99%9a%e6%8b%9f%e7%ba%bf%e7%a8%8b%e5%92%8c%e5%b9%b3%e5%8f%b0%e7%ba%bf%e7%a8%8b%e6%9c%89%e4%bb%80%e4%b9%88%e5%85%b3%e7%b3%bb">#&lt;/a>
&lt;/h2>
&lt;p>åœ¨å¼•å…¥è™šæ‹Ÿçº¿ç¨‹ä¹‹å‰ï¼Œ&lt;code>java.lang.Thread&lt;/code> åŒ…å·²ç»æ”¯æŒæ‰€è°“çš„å¹³å°çº¿ç¨‹ï¼ˆPlatform Threadï¼‰ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰è™šæ‹Ÿçº¿ç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸€ç›´ä½¿ç”¨çš„çº¿ç¨‹ã€‚JVM è°ƒåº¦ç¨‹åºé€šè¿‡å¹³å°çº¿ç¨‹ï¼ˆè½½ä½“çº¿ç¨‹ï¼‰æ¥ç®¡ç†è™šæ‹Ÿçº¿ç¨‹ï¼Œä¸€ä¸ªå¹³å°çº¿ç¨‹å¯ä»¥åœ¨ä¸åŒçš„æ—¶é—´æ‰§è¡Œä¸åŒçš„è™šæ‹Ÿçº¿ç¨‹ï¼ˆå¤šä¸ªè™šæ‹Ÿçº¿ç¨‹æŒ‚è½½åœ¨ä¸€ä¸ªå¹³å°çº¿ç¨‹ä¸Šï¼‰ï¼Œå½“è™šæ‹Ÿçº¿ç¨‹è¢«é˜»å¡æˆ–ç­‰å¾…æ—¶ï¼Œå¹³å°çº¿ç¨‹å¯ä»¥åˆ‡æ¢åˆ°æ‰§è¡Œå¦ä¸€ä¸ªè™šæ‹Ÿçº¿ç¨‹ã€‚&lt;/p>
&lt;p>è™šæ‹Ÿçº¿ç¨‹ã€å¹³å°çº¿ç¨‹å’Œç³»ç»Ÿå†…æ ¸çº¿ç¨‹çš„å…³ç³»å›¾å¦‚ä¸‹æ‰€ç¤ºï¼ˆå›¾æºï¼š
&lt;a target="_blank" href="https://medium.com/javarevisited/how-to-use-java-19-virtual-threads-c16a32bad5f7">How to Use Java 19 Virtual Threads&lt;/a>ï¼‰ï¼š&lt;/p>
&lt;p>&lt;img src="https://oss.javaguide.cn/github/javaguide/java/new-features/virtual-threads-platform-threads-kernel-threads-relationship.png" alt="è™šæ‹Ÿçº¿ç¨‹ã€å¹³å°çº¿ç¨‹å’Œç³»ç»Ÿå†…æ ¸çº¿ç¨‹çš„å…³ç³»" />&lt;/p>
&lt;p>å…³äºå¹³å°çº¿ç¨‹å’Œç³»ç»Ÿå†…æ ¸çº¿ç¨‹çš„å¯¹åº”å…³ç³»å¤šæä¸€ç‚¹ï¼šåœ¨ Windows å’Œ Linux ç­‰ä¸»æµæ“ä½œç³»ç»Ÿä¸­ï¼ŒJava çº¿ç¨‹é‡‡ç”¨çš„æ˜¯ä¸€å¯¹ä¸€çš„çº¿ç¨‹æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå¹³å°çº¿ç¨‹å¯¹åº”ä¸€ä¸ªç³»ç»Ÿå†…æ ¸çº¿ç¨‹ã€‚Solaris ç³»ç»Ÿæ˜¯ä¸€ä¸ªç‰¹ä¾‹ï¼ŒHotSpot VM åœ¨ Solaris ä¸Šæ”¯æŒå¤šå¯¹å¤šå’Œä¸€å¯¹ä¸€ã€‚å…·ä½“å¯ä»¥å‚è€ƒ R å¤§çš„å›ç­”: 
&lt;a target="_blank" href="https://www.zhihu.com/question/23096638/answer/29617153">JVM ä¸­çš„çº¿ç¨‹æ¨¡å‹æ˜¯ç”¨æˆ·çº§çš„ä¹ˆï¼Ÿ&lt;/a>ã€‚&lt;/p>
&lt;h2 id="è™šæ‹Ÿçº¿ç¨‹æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹">
 è™šæ‹Ÿçº¿ç¨‹æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Ÿ
 &lt;a class="anchor" href="#%e8%99%9a%e6%8b%9f%e7%ba%bf%e7%a8%8b%e6%9c%89%e4%bb%80%e4%b9%88%e4%bc%98%e7%82%b9%e5%92%8c%e7%bc%ba%e7%82%b9">#&lt;/a>
&lt;/h2>
&lt;h3 id="ä¼˜ç‚¹">
 ä¼˜ç‚¹
 &lt;a class="anchor" href="#%e4%bc%98%e7%82%b9">#&lt;/a>
&lt;/h3>
&lt;ul>
&lt;li>&lt;mark>éå¸¸è½»é‡çº§&lt;/mark>ï¼šå¯ä»¥åœ¨å•ä¸ªçº¿ç¨‹ä¸­åˆ›å»ºæˆç™¾ä¸Šåƒä¸ªè™šæ‹Ÿçº¿ç¨‹è€Œä¸ä¼šå¯¼è‡´è¿‡å¤šçš„çº¿ç¨‹åˆ›å»ºå’Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚&lt;/li>
&lt;li>&lt;mark>ç®€åŒ–å¼‚æ­¥ç¼–ç¨‹&lt;/mark>ï¼š è™šæ‹Ÿçº¿ç¨‹å¯ä»¥ç®€åŒ–å¼‚æ­¥ç¼–ç¨‹ï¼Œä½¿ä»£ç æ›´æ˜“äºç†è§£å’Œç»´æŠ¤ã€‚å®ƒå¯ä»¥å°†å¼‚æ­¥ä»£ç ç¼–å†™å¾—æ›´åƒåŒæ­¥ä»£ç ï¼Œé¿å…äº†å›è°ƒåœ°ç‹±ï¼ˆCallback Hellï¼‰ã€‚&lt;/li>
&lt;li>&lt;mark>å‡å°‘èµ„æºå¼€é”€&lt;/mark>ï¼š ç”±äºè™šæ‹Ÿçº¿ç¨‹æ˜¯ç”± JVM å®ç°çš„ï¼Œå®ƒèƒ½å¤Ÿæ›´é«˜æ•ˆåœ°åˆ©ç”¨åº•å±‚èµ„æºï¼Œä¾‹å¦‚ CPU å’Œå†…å­˜ã€‚è™šæ‹Ÿçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¯”å¹³å°çº¿ç¨‹æ›´è½»é‡ï¼Œå› æ­¤èƒ½å¤Ÿæ›´å¥½åœ°æ”¯æŒé«˜å¹¶å‘åœºæ™¯ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="ç¼ºç‚¹">
 ç¼ºç‚¹
 &lt;a class="anchor" href="#%e7%bc%ba%e7%82%b9">#&lt;/a>
&lt;/h3>
&lt;ul>
&lt;li>&lt;mark>ä¸é€‚ç”¨äºè®¡ç®—å¯†é›†å‹ä»»åŠ¡&lt;/mark>ï¼š è™šæ‹Ÿçº¿ç¨‹é€‚ç”¨äº I/O å¯†é›†å‹ä»»åŠ¡ï¼Œä½†ä¸é€‚ç”¨äºè®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œå› ä¸ºå¯†é›†å‹è®¡ç®—å§‹ç»ˆéœ€è¦ CPU èµ„æºä½œä¸ºæ”¯æŒã€‚&lt;/li>
&lt;li>&lt;mark>ä¸æŸäº›ç¬¬ä¸‰æ–¹åº“ä¸å…¼å®¹&lt;/mark>ï¼š è™½ç„¶è™šæ‹Ÿçº¿ç¨‹è®¾è®¡æ—¶è€ƒè™‘äº†ä¸ç°æœ‰ä»£ç çš„å…¼å®¹æ€§ï¼Œä½†æŸäº›ä¾èµ–å¹³å°çº¿ç¨‹ç‰¹æ€§çš„ç¬¬ä¸‰æ–¹åº“å¯èƒ½ä¸å®Œå…¨å…¼å®¹è™šæ‹Ÿçº¿ç¨‹ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="å¦‚ä½•åˆ›å»ºè™šæ‹Ÿçº¿ç¨‹">
 å¦‚ä½•åˆ›å»ºè™šæ‹Ÿçº¿ç¨‹ï¼Ÿ
 &lt;a class="anchor" href="#%e5%a6%82%e4%bd%95%e5%88%9b%e5%bb%ba%e8%99%9a%e6%8b%9f%e7%ba%bf%e7%a8%8b">#&lt;/a>
&lt;/h2>
&lt;p>å®˜æ–¹æä¾›äº†ä»¥ä¸‹å››ç§æ–¹å¼åˆ›å»ºè™šæ‹Ÿçº¿ç¨‹ï¼š&lt;/p></description></item></channel></rss>