[{"id":0,"href":"/zh/docs/study/","title":"å­¦ä¹ ","section":"Docs","content":"è¿™é‡Œé¢éƒ½æ˜¯æ”¾ä¸€äº›å¹³å¸¸å­¦ä¹ çš„çŸ¥è¯†ï¼ŒçŸ¥è¯†æ¥æºä¸»è¦æ¥è‡ªç»å…¸ä¹¦ç±ï¼Œæˆ–æ˜¯å…¶ä»–é€šä¿—æ˜“æ‡‚çš„ç³»åˆ—è§†é¢‘ã€‚\n"},{"id":1,"href":"/zh/docs/problem/","title":"é—®é¢˜è§£å†³","section":"Docs","content":"ä¸»è¦æ˜¯ä¸€äº›å¹³å¸¸é‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼Œæˆ–æ˜¯ç»è¿‡ä¸€é¡¿æŠ˜è…¾åè§£å†³çš„ï¼Œæˆ–æ˜¯ä¸´æ—¶é‡åˆ°çš„å°é—®é¢˜ã€‚\n"},{"id":2,"href":"/zh/docs/study/Review/java_guide/","title":"JavaGuide","section":"é¢è¯•","content":"åŸºæœ¬å…¨éƒ¨è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…! ä¸è¿‡ä¸æ˜¯æ•´ç¯‡æ‹·è´ï¼Œä¹Ÿæ˜¯ä¸€å¥å¥ç†è§£åï¼Œä¸€ä¸ªå­—ä¸€ä¸ªå­—æ‰“ä¸‹æ¥çš„ã€‚\n"},{"id":3,"href":"/zh/docs/study/Review/","title":"é¢è¯•","section":"å­¦ä¹ ","content":"é¢è¯•ç”¨çš„ï¼Œé¢ç»ã€‚ä½†æ˜¯ä»å¦ä¸€ä¸ªè§’åº¦ä¹Ÿå¯ä»¥è¯´æ˜¯æ¢³ç†çŸ¥è¯†æ¡†æ¶ï¼Œçˆ±æ¨äº¤åŠ ã€‚\n"},{"id":4,"href":"/zh/docs/life/","title":"ç”Ÿæ´»","section":"Docs","content":"ç”Ÿæ´»ç›¸å…³çš„ä¸€äº›éšæ„Ÿè€Œå‘\n"},{"id":5,"href":"/zh/docs/test/","title":"æµ‹è¯•","section":"Docs","content":"æ²¡å•¥é‡è¦çš„ï¼Œéšä¾¿æµ‹è¯•çš„ä¸€äº›ä¸œè¥¿ï¼Œå¤§éƒ¨åˆ†è·Ÿåšå®¢æ¶æ„ç›¸å…³çš„ä¸œè¥¿ï¼Œä¹‹å‰ç”¨çš„hexoï¼Œç°åœ¨æ”¹ç”¨hugoäº†ï¼Œè¿˜æœ‰ä¸€äº›ä¸œè¥¿åœ¨æ‘¸ç´¢ä¸­ã€‚\n"},{"id":6,"href":"/zh/docs/test/hello2/","title":"å¤œéª‘","section":"æµ‹è¯•","content":" %%ğŸ–‹ Edit in Excalidraw%%\næœªå‘½å\næœªå‘½å\n"},{"id":7,"href":"/zh/docs/study/Hugo/themes/PaperMod/01/","title":"ä½¿ç”¨PaperMode","section":"ä¸»é¢˜","content":" åœ°å€ # å®˜æ–¹ï¼š https://github.com/adityatelange/hugo-PaperMod/wiki/Installation ï¼ˆæœ‰äº›ä¸œè¥¿æ²¡æœ‰åŒhugoå®˜æ–¹åŒæ­¥ï¼‰ éå®˜æ–¹ï¼š https://github.com/vanitysys28/hugo-papermod-wiki/blob/master/Home.md ï¼ˆä¸hugoå®˜æ–¹æ›´åŒæ­¥ï¼‰\nå®‰è£… # hugo new site blog.source --format yaml cd blog.source git init git submodule add --depth=1 https://github.com/adityatelange/hugo-PaperMod.git themes/PaperMod git submodule update --init --recursive # needed when you reclone your repo (submodules may not get cloned automatically) git submodule update --remote --merge "},{"id":8,"href":"/zh/docs/study/Hugo/GiraffeAcademy/advanced20-23/","title":"hugoè¿›é˜¶å­¦ä¹ 20-23","section":"åŸºç¡€(Giraffeå­¦é™¢)_","content":"\nDateFiles # {% raw %} { \u0026#34;classA\u0026#34;:\u0026#34;jsonä½ç½®: data\\\\classes.json\u0026#34;, \u0026#34;classA\u0026#34;:{ \u0026#34;master\u0026#34;:\u0026#34;xiaoLi\u0026#34;, \u0026#34;number\u0026#34;:\u0026#34;05\u0026#34; }, \u0026#34;classB\u0026#34;:{ \u0026#34;master\u0026#34;:\u0026#34;aXiang\u0026#34;, \u0026#34;number\u0026#34;:\u0026#34;15\u0026#34; }, \u0026#34;classC\u0026#34;:{ \u0026#34;master\u0026#34;:\u0026#34;BaoCeng\u0026#34;, \u0026#34;number\u0026#34;:\u0026#34;20\u0026#34; } } {% endraw %} æ¨¡æ¿ä»£ç \n{% raw %} {{/* layouts\\_default\\single.html */}} {{ define \u0026#34;main\u0026#34; }} {{ range .Site.Data.classes }} master:{{.master}}==number:{{.number}}\u0026lt;br\u0026gt; {{end}} {{end}} {% endraw %} PartialTemplates # ä¼ é€’å…¨å±€èŒƒå›´ # {% raw %} {{/*layouts\\partials\\header.html*/}} \u0026lt;h1\u0026gt;{{.Title}}\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;{{.Date}}\u0026lt;/p\u0026gt; {% endraw %} {% raw %} {{/*layouts\\_default\\single.html*/}} {{ define \u0026#34;main\u0026#34; }} {{ partial \u0026#34;header\u0026#34; . }} {{/*ç‚¹.ä¼ é€’äº†å½“å‰æ–‡ä»¶çš„èŒƒå›´ï¼Œä»£è¡¨äº†æ‰€æœ‰çš„èŒƒå›´ï¼Œæ‰€æœ‰å¯ä»¥è®¿é—®çš„å˜é‡*/}} \u0026lt;hr\u0026gt; {{end}} {% endraw %} é¢„è§ˆï¼š\nä¼ é€’å­—å…¸ # {% raw %} {{/* layouts\\partials\\header.html */}} {{ partial \u0026#34;header\u0026#34; (dict \u0026#34;myTitle\u0026#34; \u0026#34;myCustomTitle\u0026#34; \u0026#34;myDate\u0026#34; \u0026#34;myCustomDate\u0026#34; ) }} {{/* partial \u0026#34;header\u0026#34; . åŒä¸€ä¸ªpartialåªèƒ½åœ¨ä¸€ä¸ªåœ°æ–¹å‡ºç°ä¸€æ¬¡ï¼Ÿè¿™é‡Œä¼šæŠ¥é”™ï¼Œä¸çŸ¥é“ä¸ºå•¥*/}} \u0026lt;hr\u0026gt; {% endraw %} ä½¿ç”¨:\n{% raw %} {{/*layouts\\partials\\header.html*/}} \u0026lt;h1\u0026gt;{{.myTitle}}\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;{{.myDate}}\u0026lt;/p\u0026gt; {% endraw %} æ•ˆæœï¼š\nShortCodeTemplate # æ•ˆæœå›¾ # è®°å¾—å…ˆåœ¨aç›¸å…³çš„templateæŠŠ .Content è¡¥ä¸Š # ä»£ç ç‰‡æ®µçš„ä½¿ç”¨ # {% raw %} --- title: \u0026#34;This is A\u0026#39;s title\u0026#34; date: 2004-12-04T12:42:49+08:00 draft: true author: \u0026#34;Mike\u0026#34; color: \u0026#34;blue\u0026#34; --- This is A. {{\u0026lt; myshortcode color=\u0026#34;blue\u0026#34; \u0026gt;}} {{\u0026lt; myshortcode2 red \u0026gt;}} {{\u0026lt; myshortcode-p \u0026gt;}} This is the test inside the shortcode tags.. sdf d---end {{\u0026lt; /myshortcode-p \u0026gt;}} ä¸‹é¢æ²¡æœ‰è¢«æ¸²æŸ“ï¼š {{\u0026lt; myshortcode-p \u0026gt;}} **bold text** {{\u0026lt; /myshortcode-p \u0026gt;}} ä¸‹é¢è¢«æ¸²æŸ“äº†ï¼Œä½†æ˜¯æ²¡æœ‰è¢«ç‰‡æ®µå¤„ç†ï¼š {{% myshortcode-p %}} **bold text**xxx {{% /myshortcode-p %}} {%/* endraw */%} ä»£ç ç‰‡æ®µçš„ç¼–å†™ # ç­‰å·é”®å€¼å¯¹ # {% raw %} \u0026lt;!--layouts\\shortcodes\\myshortcode.html--\u0026gt; \u0026lt;p style=\u0026#34;color:{{.Get `color`}}\u0026#34;\u0026gt;This is my shortcode text\u0026lt;/p\u0026gt; {% endraw %} ç›´æ¥å†™å€¼ # {% raw %} \u0026lt;!--layouts\\shortcodes\\myshortcode2.html--\u0026gt; \u0026lt;p style=\u0026#34;color:{{.Get 0}}\u0026#34;\u0026gt;This is my shortcode text\u0026lt;/p\u0026gt; {% endraw %} è·å–å¤šè¡Œå¤§é‡æ–‡å­— # {% raw %} \u0026lt;!--layouts\\shortcodes\\myshortcode-p.html--\u0026gt; \u0026lt;p style=\u0026#34;background-color: yellow;\u0026#34;\u0026gt;{{.Inner}}\u0026lt;/p\u0026gt; {% endraw %} å¦‚ä½•æ„å»ºç½‘ç«™åŠæ‰˜ç®¡ # ä½¿ç”¨hugo serverè¿è¡Œå¹¶æ‰“å¼€ç½‘ç«™ï¼ˆå¹³å¸¸æµ‹è¯•ï¼‰ ä½¿ç”¨hugoç”Ÿæˆé™æ€ç½‘é¡µæ–‡ä»¶å¤¹/public/ æŠŠä¸Šé¢çš„/public/ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä¼ åˆ°ç½‘ç»œæœåŠ¡å™¨å³å¯ è¿›è¡Œç¬¬ä¸‰æ­¥ä¹‹å‰ï¼Œå¾—å…ˆæŠŠåŸå…ˆä¼ åˆ°ç½‘ç»œæœåŠ¡å™¨ä¸Šçš„/public/çš„å†…å®¹æ¸…ç©º "},{"id":9,"href":"/zh/docs/study/Hugo/GiraffeAcademy/advanced17-19/","title":"hugoè¿›é˜¶å­¦ä¹ 17-19","section":"åŸºç¡€(Giraffeå­¦é™¢)_","content":"\nVariable # æ–‡ä»¶ç»“æ„ # å®æˆ˜ # {% raw %} {{/*layouts\\_default\\single.html*/}} {{ define \u0026#34;main\u0026#34; }} This is the single template\u0026lt;br\u0026gt; {{/* å¸¸è§å˜é‡ */}} title: {{ .Params.title }}\u0026lt;br\u0026gt; title: {{ .Title }}\u0026lt;br\u0026gt; date: {{ .Date }}\u0026lt;br\u0026gt; url: {{ .URL }}\u0026lt;br\u0026gt; myvar: {{ .Params.myVar }}\u0026lt;br\u0026gt; {{/* å®šä¹‰å˜é‡ */}} {{ $myVarname := \u0026#34;aString\u0026#34; }} myVarname:{{ $myVarname }}\u0026lt;br\u0026gt; \u0026lt;h1 style=\u0026#34;color: {{ .Params.color }} ;\u0026#34; \u0026gt;Single Template\u0026lt;/h1\u0026gt; {{ end }} {% endraw %} {% raw %} --- title: \u0026#34;E-title\u0026#34; date: 2024-12-07T12:43:21+08:00 draft: true myVar: \u0026#34;myvalue\u0026#34; color: \u0026#34;red\u0026#34; --- This is dir3/e.md {% endraw %} å…¶ä»–ä¸¤ä¸ªæ–‡ä»¶æ•ˆæœ\n{% raw %} --- title: \u0026#34;F\u0026#34; date: 2024-12-07T12:43:21+08:00 draft: true color: \u0026#34;green\u0026#34; --- This is dir3/f.md {% endraw %} {% raw %} --- title: \u0026#34;This is A\u0026#39;s title\u0026#34; date: 2004-12-04T12:42:49+08:00 draft: true author: \u0026#34;Mike\u0026#34; color: \u0026#34;blue\u0026#34; --- This is A,/a. {% endraw %} æ•ˆæœï¼š\nå®˜ç½‘è¯¦ç»†é»˜è®¤å˜é‡ # hugo variablesã€‚\nFunctionså‡½æ•° # æ–‡ä»¶ç»“æ„ # ä»£ç (æ¨¡æ¿) # æ³¨æ„ï¼Œä¸‹é¢å…¨æ˜¯dir1ä¸‹çš„æ¨¡æ¿ï¼Œåªå¯¹/dir1/åŠå…¶ä¸‹æ–‡ä»¶æœ‰æ•ˆ\nbaseof.html\n{% raw %} {{/*layouts\\_default\\baseof.html*/}} \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; {{ block \u0026#34;main\u0026#34; . }} 33 {{ end }} \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; {% endraw %} single.html\n{% raw %} {{/*layouts\\dir1\\single.html*/}} \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document111\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; Dir1Template,see! \u0026lt;h1\u0026gt;Header\u0026lt;/h1\u0026gt; \u0026lt;h3\u0026gt;{{.Title}}\u0026lt;/h3\u0026gt; \u0026lt;h4\u0026gt;{{.Date}}\u0026lt;/h4\u0026gt; \u0026lt;!--ç‰¹æ®Šé¡¹--\u0026gt; {{.Content}} \u0026lt;h1\u0026gt;Footer\u0026lt;/h1\u0026gt; \u0026lt;hr\u0026gt; {{ truncate 10 \u0026#34;This is a really long string\u0026#34;}}\u0026lt;br\u0026gt; {{ add 1 5 }}\u0026lt;br\u0026gt; {{ sub 1 5 }}\u0026lt;br\u0026gt; {{ singularize \u0026#34;dogs\u0026#34; }} \u0026lt;br\u0026gt; {{/*ä¸‹é¢å®Œå…¨æ²¡æœ‰è¾“å‡ºï¼Œå› ä¸ºä¸æ˜¯list page*/}} {{ range .Pages }} {{ .Title }}\u0026lt;br\u0026gt; {{ end }} \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; {% endraw %} å¯¹äºä¸Šé¢çš„single.htmlç”Ÿæˆçš„htmlæºç ï¼š\n{% raw %} \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document111\u0026lt;/title\u0026gt; \u0026lt;!--æ³¨æ„è¿™é‡Œï¼Œè¯´æ˜å®Œå…¨ä½¿ç”¨layouts\\dir1\\single.htmlä½œä¸ºæ¨¡æ¿ï¼Œè·Ÿbaseof.htmlæ— å…³--\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; Dir1Template,see! \u0026lt;h1\u0026gt;Header\u0026lt;/h1\u0026gt; \u0026lt;h3\u0026gt;B-title\u0026lt;/h3\u0026gt; \u0026lt;h4\u0026gt;2024-12-07 12:43:21 \u0026amp;#43;0800 CST\u0026lt;/h4\u0026gt; \u0026lt;p\u0026gt;This is dir1/b.md\u0026lt;/p\u0026gt; \u0026lt;h1\u0026gt;Footer\u0026lt;/h1\u0026gt; \u0026lt;hr\u0026gt; This is a â€¦\u0026lt;br\u0026gt; 6\u0026lt;br\u0026gt; -4\u0026lt;br\u0026gt; dog \u0026lt;br\u0026gt; \u0026lt;script data-no-instant\u0026gt;document.write(\u0026#39;\u0026lt;script src=\u0026#34;/livereload.js?port=1313\u0026amp;mindelay=10\u0026#34;\u0026gt;\u0026lt;/\u0026#39; + \u0026#39;script\u0026gt;\u0026#39;)\u0026lt;/script\u0026gt;\u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; {% endraw %} list.html\n{% raw %} {{/* layouts\\dir1\\list.html */}} {{ define \u0026#34;main\u0026#34; }} This is the listTemplate for dir1;\u0026lt;br\u0026gt; {{/*ä¸‹é¢åªè¾“å‡ºäº†dir1ä¸‹çš„æ‰€æœ‰æ–‡ä»¶(åŒ…æ‹¬å­æ–‡ä»¶å¤¹)*/}} {{ range .Pages }} {{ .Title }}\u0026lt;br\u0026gt; {{ end }} {{ end }} {% endraw %} IfStatements # æ–‡ä»¶ç»“æ„ # ifä»£ç æ¼”ç¤º # {% raw %} {{/* layouts\\_default\\single.html */}} {{ define \u0026#34;main\u0026#34; }} This is the listTemplate\u0026lt;br\u0026gt; {{ $var1 := \u0026#34;dog\u0026#34; }} {{ $var2 := \u0026#34;cat\u0026#34; }} {{ if ge $var1 $var2 }} True {{ else }} False {{ end }} \u0026lt;br\u0026gt; {{ $var3 := 6 }} {{ $var4 := 4 }} {{ $var5 := 1 }} {{ if and (le $var3 $var4) (lt $var3 $var5) }} var3 is minist {{ else if and (le $var4 $var3) (lt $var4 $var5)}} var4 is minist {{ else }} var5 is minist {{ end }} \u0026lt;br\u0026gt; {{ end }} {% endraw %} å…¶ä»–ä»£ç å±•ç¤º # {% raw %} \u0026lt;!--layouts\\dir1\\single.html--\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document111\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; {{ $title := .Title }} {{/* æ³¨æ„ï¼Œè¿™é‡Œéå†çš„æ˜¯æ•´ä¸ªç½‘ç«™(.Site)çš„æ–‡ä»¶ */}} {{ range .Site.Pages }} \u0026lt;a href=\u0026#34;{{.URL}}\u0026#34; style=\u0026#34; {{ if eq .Title $title }} background-color: red; {{ end }} \u0026#34;\u0026gt;{{.Title}}\u0026lt;/a\u0026gt; {{ end }} \u0026lt;hr\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; {% endraw %} "},{"id":10,"href":"/zh/docs/study/Hugo/GiraffeAcademy/advanced11-16/","title":"hugoè¿›é˜¶å­¦ä¹ 11-15","section":"åŸºç¡€(Giraffeå­¦é™¢)_","content":" è¿™é‡Œä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯v0.26ï¼ˆå¾ˆä¹…ä¹‹å‰çš„ç‰ˆæœ¬ï¼‰\ntemplate basic # æ¨¡æ¿åˆ†ä¸ºlist templateå’Œsingle template\næ–‡ä»¶å¤¹ç»“æ„ # contentç›®å½•ç»“æ„\nlist template ï¼ˆåˆ—è¡¨æ¨¡æ¿ï¼‰ # single template ï¼ˆå•é¡µæ¨¡æ¿ï¼‰ # ç‰¹ç‚¹ # æ‰€æœ‰çš„åˆ—è¡¨ä¹‹é—´éƒ½æ˜¯é•¿ä¸€æ ·çš„ï¼ˆé¡µçœ‰ï¼Œé¡µè„šï¼ŒåŠå†…å®¹ï¼ˆéƒ½æ˜¯åˆ—è¡¨ï¼‰ï¼‰\næ‰€æœ‰çš„å•é¡µä¹‹é—´éƒ½æ˜¯é•¿ä¸€æ ·çš„ï¼ˆä¸€æ ·çš„é¡µçœ‰é¡µè„šï¼Œä¸€æ ·çš„å†…å®¹å¸ƒå±€ï¼‰\néƒ¨åˆ†ä»£ç è§£é‡Š # å•é¡µæ¢ç´¢ # list page templates # æ–‡ä»¶å¤¹ç»“æ„ # æ–‡ä»¶å†…å®¹ # #content/_index --- title: \u0026#34;_Index\u0026#34; --- This is the home page #content/dir1/_index --- title: \u0026#34;_Index\u0026#34; --- This is the landing page for dir1 å½“å‰æ•ˆæœ # åŸå›  # {% raw %} \u0026lt;!--themes\\ga-hugo-theme\\layouts\\_default\\list.html--\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; {{ partial \u0026#34;header\u0026#34; (dict \u0026#34;Kind\u0026#34; .Kind \u0026#34;Template\u0026#34; \u0026#34;List\u0026#34;) }} {{.Content}} {{ range .Pages }} \u0026lt;div style=\u0026#34;border: 1px solid black; margin:10px; padding:10px; \u0026#34;\u0026gt; \u0026lt;div style=\u0026#34;font-size:20px;\u0026#34;\u0026gt; \u0026lt;a href=\u0026#34;{{.URL}}\u0026#34;\u0026gt;{{.Title}}\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div style=\u0026#34;color:grey; font-size:16px;\u0026#34;\u0026gt;{{ dateFormat \u0026#34;Monday, Jan 2, 2006\u0026#34; .Date }}\u0026lt;/div\u0026gt; \u0026lt;div style=\u0026#34;color:grey; font-size:16px;\u0026#34;\u0026gt;{{ if .Params.tags }}\u0026lt;strong\u0026gt;Tags:\u0026lt;/strong\u0026gt; {{range .Params.tags}}\u0026lt;a href=\u0026#34;{{ \u0026#34;/tags/\u0026#34; | relLangURL }}{{ . | urlize }}\u0026#34;\u0026gt;{{ . }}\u0026lt;/a\u0026gt; {{end}}{{end}}\u0026lt;/div\u0026gt; \u0026lt;div style=\u0026#34;color:grey; font-size:16px;\u0026#34;\u0026gt;{{ if .Params.categories }}\u0026lt;strong\u0026gt;Categories:\u0026lt;/strong\u0026gt; {{range .Params.categories}}\u0026lt;a href=\u0026#34;{{ \u0026#34;/categories/\u0026#34; | relLangURL }}{{ . | urlize }}\u0026#34;\u0026gt;{{ . }}\u0026lt;/a\u0026gt; {{end}}{{end}}\u0026lt;/div\u0026gt; \u0026lt;div style=\u0026#34;color:grey; font-size:16px;\u0026#34;\u0026gt;{{ if .Params.moods }}\u0026lt;strong\u0026gt;Moods:\u0026lt;/strong\u0026gt; {{range .Params.moods}}\u0026lt;a href=\u0026#34;{{ \u0026#34;/moods/\u0026#34; | relLangURL }}{{ . | urlize }}\u0026#34;\u0026gt;{{ . }}\u0026lt;/a\u0026gt; {{end}}{{end}}\u0026lt;/div\u0026gt; \u0026lt;p style=\u0026#34;font-size:18px;\u0026#34;\u0026gt;{{.Summary}}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; {{ end }} {{ partial \u0026#34;footer\u0026#34; . }} \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; {% endraw %} è¦†ç›–é»˜è®¤çš„list template # ç¼–è¾‘æ–‡ä»¶å¹¶ä¿å­˜\n{% raw %} \u0026lt;!--layouts\\_default\\list.html--\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; {{.Content}} \u0026lt;!--æ˜¾ç¤ºå¯¹åº”çš„ç›®å½•ä¸‹çš„_index.mdå†…å®¹--\u0026gt; {{ range .Pages }} \u0026lt;!--æšä¸¾å¯¹åº”ç›®å½•ä¸‹æ‰€æœ‰é¡µé¢(.md)--\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;!--.URL æ–‡ä»¶è·¯å¾„ï¼Œç±»ä¼¼ /aæˆ–è€…/dir1/b--\u0026gt; \u0026lt;!--.Title mdä¸­çš„å‰è¨€-titleå­—æ®µ--\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;{{.URL}}\u0026#34;\u0026gt;{{.Title}}\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; {{end}} \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; {% endraw %} æ•ˆæœ # list templateç®€æ˜“ç‰ˆ\nsingle template # å½“å‰æ•ˆæœ # ä¸»é¢˜é»˜è®¤ä»£ç  # {% raw %} \u0026lt;!-- themes\\ga-hugo-theme\\layouts\\_default\\single.html --\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; {{ partial \u0026#34;header\u0026#34; (dict \u0026#34;Kind\u0026#34; .Kind \u0026#34;Template\u0026#34; \u0026#34;Single\u0026#34;) }} \u0026lt;p\u0026gt;Test test\u0026lt;/p\u0026gt; \u0026lt;div style=\u0026#34;margin:25px;\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;{{.Title}}\u0026lt;/h1\u0026gt; \u0026lt;div style=\u0026#34;color:grey; font-size:16px;\u0026#34;\u0026gt;{{ dateFormat \u0026#34;Monday, Jan 2, 2006\u0026#34; .Date }}\u0026lt;/div\u0026gt; \u0026lt;div style=\u0026#34;color:grey; font-size:16px;\u0026#34;\u0026gt;{{if .Params.author}}Author: {{.Params.Author}}{{end}}\u0026lt;/div\u0026gt; \u0026lt;div style=\u0026#34;font-size:18px;\u0026#34;\u0026gt;{{.Content}}\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; {{ partial \u0026#34;footer\u0026#34; . }} \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; {% endraw %} æ”¹ç¼– # {% raw %} \u0026lt;!--layouts\\_default\\single.html--\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Header\u0026lt;/h1\u0026gt; \u0026lt;h3\u0026gt;{{.Title}}\u0026lt;/h3\u0026gt; \u0026lt;h4\u0026gt;{{.Date}}\u0026lt;/h4\u0026gt; \u0026lt;!--ç‰¹æ®Šé¡¹--\u0026gt; {{.Content}} \u0026lt;h1\u0026gt;Footer\u0026lt;/h1\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; {% endraw %} æ•ˆæœ\nhome template # æ˜¯ä»€ä¹ˆ # å‰é¢å­¦åˆ°ï¼Œé¡µé¢åˆ†ä¸ºâ€œåˆ—è¡¨é¡µé¢list pageâ€å’Œâ€œå•é¡µé¡µé¢â€ã€‚å…¶å®å†ç»†åˆ†è¿˜æœ‰ä¸€ç§â€œä¸»é¡µé¡µé¢home pageâ€ã€‚ ä¸»é¡µï¼Œå³ localhost:1313 æ˜¯å…ˆä½¿ç”¨homepageï¼Œæ‰¾ä¸åˆ°çš„æƒ…å†µï¼Œæ‰ä¼šä½¿ç”¨list page ç›®å½•ç»“æ„ # å½“å‰æ•ˆæœ # ä¿®æ”¹æ–‡ä»¶ä»£ç  # {% raw %} \u0026lt;!--layouts\\index.html--\u0026gt; Home Page Template {% endraw %} æ•ˆæœ # SectionTemplate # å½“å‰ç›®å½•ç»“æ„ # ç›®çš„ # ä¸ç”¨ç†ä¼ša.mdä½¿ç”¨å“ªä¸ªå½“single templateã€‚è€Œdir1æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰mdï¼Œéƒ½æ˜¯ç”¨åŒä¸€ä¸ªsingle templateã€‚\nç›®å‰contentä¸‹æ‰€æœ‰mdæ–‡ä»¶è¯¦æƒ…ï¼ša.mdä½¿ç”¨layouts/index.htmlå½“æ¨¡æ¿ï¼ˆæ²¡æœ‰çš„è¯åˆ™æ‰¾layouts/_default/index.htmlå½“æ¨¡æ¿ï¼‰ã€‚b.mdå’Œc.mdã€e.mdã€d.mdã€f.mdå‡ä½¿ç”¨layouts/_default/index.htmlå½“æ¨¡æ¿\nä»£ç \n{% raw %} \u0026lt;!--layouts\\dir1\\single.html--\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;ie=edge\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; Dir1Template,see! \u0026lt;h1\u0026gt;Header\u0026lt;/h1\u0026gt; \u0026lt;h3\u0026gt;{{.Title}}\u0026lt;/h3\u0026gt; \u0026lt;h4\u0026gt;{{.Date}}\u0026lt;/h4\u0026gt; \u0026lt;!--ç‰¹æ®Šé¡¹--\u0026gt; {{.Content}} \u0026lt;h1\u0026gt;Footer\u0026lt;/h1\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; {% endraw %} ç»“æœ # å…¶ä»–çš„èµ°é»˜è®¤æ¨¡æ¿ layouts\\_default\\single.html\nBase Templates \u0026amp;\u0026amp; Blocks Hugo # æ˜¯ä»€ä¹ˆ # BaseTemplateå°±æ˜¯è¿™ä¸ªç½‘ç«™çš„æ€»ä½“æ¨¡æ¿\næ¡ˆä¾‹ # ç›®å½•ç»“æ„ # ç¼–è¾‘æ–‡ä»¶ # baseof.html\n{% raw %} \u0026lt;!--layouts\\_default\\baseof.html--\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;!--Hugoå®ä½“å¿«ï¼ŒBlock--\u0026gt; {{ block \u0026#34;main\u0026#34; . }} {{end}} \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; {% endraw %} single.html\nä¸è¦ç”¨html5çš„\u0026lt;!----!\u0026gt;æ³¨é‡Šï¼Œä¼šå‡ºé—®é¢˜\n{% raw %} {{ define \u0026#34;main\u0026#34; }} This is the single template {{ end }} {% endraw %} list.html\n{% raw %} {{/* layouts\\_default\\single.html */}} {{ define \u0026#34;main\u0026#34; }} This is the listTemplate {{ end }} {% endraw %} æ•ˆæœ\n"},{"id":11,"href":"/zh/docs/study/Hugo/GiraffeAcademy/advanced01-10/","title":"hugoè¿›é˜¶å­¦ä¹ 01-10","section":"åŸºç¡€(Giraffeå­¦é™¢)_","content":" ç³»åˆ—è§†é¢‘åœ°å€ä»‹ç»\nhttps://www.youtube.com/watch?v=qtIqKaDlqXo\u0026list=PLLAZ4kZ9dFpOnyRlyS-liKL5ReHDcj4G3\nä»‹ç» # hugoæ˜¯ç”¨æ¥æ„å»ºé™æ€ç½‘ç«™çš„ ä½†æ˜¯ä¹Ÿå¯ä»¥ç¨å¾®åšç‚¹åŠ¨æ€ç”Ÿæˆçš„äº‹ è¿™é‡Œä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯v0.26ï¼ˆå¾ˆä¹…ä¹‹å‰çš„ç‰ˆæœ¬ï¼‰ å¤‡æ³¨ï¼šæ ‡é¢˜çŸ­ä»£ç ä¹‹å‰ï¼ˆä¸åŒ…æ‹¬çŸ­ä»£ç è¿™ç¯‡ï¼‰çš„ç¬”è®°æ˜¯å›æº¯çš„ï¼Œæ‰€ä»¥æ²¡æœ‰å¤åˆ¶æºä»£ç ä¸‹æ¥ï¼Œç›´æ¥åœ¨è§†é¢‘å†æ¬¡æˆªå›¾çš„\nåœ¨Windowsä¸Šå®‰è£…hugo # åˆ°github releaseä¸‹è½½ï¼Œç„¶åæ”¾åˆ°æŸä¸ªæ–‡ä»¶å¤¹ä¸­\nè®¾ç½®ç¯å¢ƒå˜é‡\néªŒè¯ç¯å¢ƒå˜é‡\næœ€åéªŒè¯hugoç‰ˆæœ¬ hugo version åˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘ç«™ # ä½¿ç”¨ä»£ç ç”Ÿæˆ hugo new site æ–‡ä»¶å¤¹ç»“æ„\nä½¿ç”¨ä¸»é¢˜ # è¿™é‡Œæ˜¯https://themes.gohugo.io\nè¿™é‡Œä½¿ç”¨çš„æ˜¯ga-hugo-themeï¼ˆgithubä¸­æŸ¥æ‰¾ï¼‰ï¼Œå¹¶æ”¾åˆ°themesæ–‡ä»¶å¤¹ä¸­\nä¹‹ååœ¨config.tomlä¸­ä½¿ç”¨ä¸»é¢˜\nbaseURL = \u0026#34;http://example.org/\u0026#34; languageCode = \u0026#34;en-us\u0026#34; title = \u0026#34;My New Hugo Site\u0026#34; theme = \u0026#34;ga-hugo-theme\u0026#34; #æ·»åŠ è¿™å¥è¯ å¯åŠ¨åšå®¢\nhugo serve åœ°å€\nlocalhost:1313 åˆ›å»ºmdæ–‡ä»¶ # ä½¿ç”¨hugo new a.mdæŠŠæ–‡ä»¶åˆ›å»ºåœ¨content/a.mdæˆ–è€…hugo new dir2/d.mdæŠŠæ–‡ä»¶åˆ›å»ºåœ¨content/dir2.mdä¸‹ï¼Œè¿™è®²åˆ›å»ºåçš„ç»“æ„ç›®å½•ä¸º\næ€»å…±5ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨localhost:1313è®¿é—®åšå®¢ï¼ˆé»˜è®¤åˆ—ä¸¾æ‰€æœ‰ï¼ˆåŒ…æ‹¬å­æ–‡ä»¶å¤¹ï¼‰æ–‡ä»¶ å¯ä»¥ä½¿ç”¨ localhost:1313/dir3è®¿é—®dir3ä¸‹æ‰€æœ‰æ–‡ä»¶åˆ—è¡¨(list)ï¼Œlocalhost:1313/dir1è®¿é—®dir1ä¸‹æ‰€æœ‰æ–‡ä»¶åˆ—è¡¨ ï¼ˆéƒ½æ˜¯contentçš„ç›´æ¥å­æ–‡ä»¶å¤¹ï¼‰ å¦‚æœæ²¡æœ‰dir1/dir2/_index.mdè¿™ä¸ªæ–‡ä»¶ ï¼Œåˆ™ä¸èƒ½ç›´æ¥ä½¿ç”¨localhost:1313/dir1/dir2è®¿é—®dir1/dir2ä¸‹æ‰€æœ‰æ–‡ä»¶ æŸ¥çœ‹dir1/dir2/index.mdæ–‡ä»¶åŠæ•ˆæœ\nfrontmatter (å‰è¨€) # å¯ä»¥ä½¿ç”¨YAMLï¼ŒTOMLï¼Œæˆ–è€…JSON mdç¼–ç åŠæ•ˆæœ\narchetypesï¼ˆåŸå‹ï¼‰ # é»˜è®¤çš„åŸå‹æ–‡ä»¶ # archetypes/default.md\n{% raw %} --- title: \u0026#34;{{ replace .TranslationBaseName \u0026#34;-\u0026#34; \u0026#34; \u0026#34; | title }}\u0026#34; date: {{ .Date }} draft: true author: \u0026#34;Mike\u0026#34; --- {% endraw %} ä½¿ç”¨å‘½ä»¤è¡Œhugo new b.mdç»“æœ\nå’Œæ–‡ä»¶å¤¹ç»“æ„ç›¸å…³çš„åŸå‹æ–‡ä»¶ # ä½¿ç”¨å‘½ä»¤è¡Œhugo new dir1/c.mdç»“æœ\nå¦‚æœhugo new dir1/c.mdæ—¶archetypes/dir1.mdä¸å­˜åœ¨ï¼Œåˆ™æ‰ä¼šå»æ‰¾archetypes/default.mdå½“æ¨¡æ¿åˆ›å»ºæ–‡ä»¶\nshortcodes çŸ­ä»£ç  # ä»£ç  # æ”¾åˆ°markdownæ–‡ä»¶ä¸­ï¼ˆè¿™ä¸ªyoutubeæ˜¯å®˜æ–¹æ”¯æŒçš„å†…åµŒçš„ï¼‰\n{% raw %} {{/*\u0026lt; youtube w7Ft2ymGmfc \u0026gt;*/}} {% endraw %} æ•ˆæœ # taxonomiesï¼ˆåˆ†ç±»æ³•ï¼‰ # é»˜è®¤çš„ä¸¤ä¸ªåˆ†ç±» # æ¯”å¦‚ä¿®æ”¹äº†æ€»å…±ä¸‰ä¸ªæ–‡ä»¶ ï¼ˆéšå»å…¶ä»–å‰è¨€æ•°æ®ï¼‰\n{% raw %} --- # a.md title: \u0026#34;A\u0026#34; tags: [\u0026#34;tag1\u0026#34;,\u0026#34;tag2\u0026#34;,\u0026#34;tag3\u0026#34;] categories: [\u0026#34;cat1\u0026#34;] --- # b.md --- title: \u0026#34;B\u0026#34; tags: [\u0026#34;tag2\u0026#34; ] categories: [\u0026#34;cat2\u0026#34;] --- # c.md --- title: \u0026#34;C\u0026#34; tags: [\u0026#34;tag3\u0026#34;] categories: [\u0026#34;cat2\u0026#34;] --- {% endraw %} æ•ˆæœï¼š\nç‚¹å‡»tag2æ—¶æ•ˆæœ\nç‚¹å‡»cat1æ—¶çš„æ•ˆæœ\nè‡ªå®šä¹‰åˆ†ç±» # {% raw %} # a.mdæ·»åŠ æœ€åä¸€è¡Œï¼Œæœ€åä»£ç ï¼ˆå¿½ç•¥å…¶ä»–å±æ€§ï¼‰ --- title: \u0026#34;A tags: [\u0026#34;tag1\u0026#34;,\u0026#34;tag2\u0026#34;,\u0026#34;tag3\u0026#34;] categories: [\u0026#34;cat1\u0026#34;] moods: [\u0026#34;Happy\u0026#34;,\u0026#34;Upbeat\u0026#34;] --- {% endraw %} ä»¥åŠä¿®æ”¹config.tomlæ–‡ä»¶\n{% raw %} baseURL = \u0026#34;http://example.org/\u0026#34; languageCode = \u0026#34;en-us\u0026#34; title = \u0026#34;My New Hugo Site\u0026#34; theme = \u0026#34;ga-hugo-theme\u0026#34; [taxonomies] #æ·»åŠ è¿™è¡ŒåŠä»¥ä¸‹ä¸‰è¡Œ tag = \u0026#34;tags\u0026#34; category = \u0026#34;categories\u0026#34; mood = \u0026#34;moods\u0026#34; {% endraw %} æ•ˆæœï¼š\n"},{"id":12,"href":"/zh/docs/study/Obsidian/border-theme/","title":"border-themeèƒŒæ™¯å›¾ç‰‡é—®é¢˜","section":"Obsidian","content":" svgæ ¼å¼ä½œä¸ºèƒŒæ™¯å›¾ç‰‡ï¼ˆç®€å•å›¾ç‰‡å¯è¡Œï¼‰ # ä»¥ä¸‹é¢è¿™å¼ å›¾ç‰‡ä¸ºä¾‹\næœ€ç®€å•çš„æ–¹å¼ï¼Œç”¨è®°äº‹æœ¬/æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ‰“å¼€svgå›¾ç‰‡ï¼Œå…¨é€‰ï¼Œå¤åˆ¶ï¼Œå³\n\u0026lt;svg xmlns=\u0026#34;http://www.w3.org/2000/svg\u0026#34; viewBox=\u0026#34;0 0 1920 1080\u0026#34;\u0026gt;\u0026lt;g transform=\u0026#34; rotate(0 960 540) translate(-0 -0) scale(1) \u0026#34;\u0026gt;\u0026lt;rect width=\u0026#34;1920\u0026#34; height=\u0026#34;1080\u0026#34; fill=\u0026#34;rgb(184, 171, 255)\u0026#34;\u0026gt;\u0026lt;/rect\u0026gt;\u0026lt;g transform=\u0026#34;translate(0, 0)\u0026#34;\u0026gt;\u0026lt;path fill=\u0026#34;rgb(131, 114, 218)\u0026#34; fill-opacity=\u0026#34;1\u0026#34; d=\u0026#34;M0,352.943L45.714,350.075C91.429,347.207,182.857,341.471,274.286,340.581C365.714,339.692,457.143,343.65,548.571,344.095C640,344.54,731.429,341.472,822.857,303.183C914.286,264.894,1005.714,191.383,1097.143,185.175C1188.571,178.967,1280,240.06,1371.429,221.336C1462.857,202.612,1554.286,104.069,1645.714,98.48C1737.143,92.892,1828.571,180.258,1874.286,223.941L1920,267.624L1920,1080L1874.286,1080C1828.571,1080,1737.143,1080,1645.714,1080C1554.286,1080,1462.857,1080,1371.429,1080C1280,1080,1188.571,1080,1097.143,1080C1005.714,1080,914.286,1080,822.857,1080C731.429,1080,640,1080,548.571,1080C457.143,1080,365.714,1080,274.286,1080C182.857,1080,91.429,1080,45.714,1080L0,1080Z\u0026#34;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/g\u0026gt;\u0026lt;g transform=\u0026#34;translate(0, 360)\u0026#34;\u0026gt;\u0026lt;path fill=\u0026#34;rgb(79, 57, 180)\u0026#34; fill-opacity=\u0026#34;1\u0026#34; d=\u0026#34;M0,136.093L45.714,117.434C91.429,98.774,182.857,61.455,274.286,80.719C365.714,99.983,457.143,175.829,548.571,189.505C640,203.181,731.429,154.687,822.857,130.414C914.286,106.141,1005.714,106.09,1097.143,141.274C1188.571,176.458,1280,246.877,1371.429,284.697C1462.857,322.517,1554.286,327.739,1645.714,284.675C1737.143,241.611,1828.571,150.263,1874.286,104.589L1920,58.914L1920,720L1874.286,720C1828.571,720,1737.143,720,1645.714,720C1554.286,720,1462.857,720,1371.429,720C1280,720,1188.571,720,1097.143,720C1005.714,720,914.286,720,822.857,720C731.429,720,640,720,548.571,720C457.143,720,365.714,720,274.286,720C182.857,720,91.429,720,45.714,720L0,720Z\u0026#34;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/g\u0026gt;\u0026lt;g transform=\u0026#34;translate(0, 720)\u0026#34;\u0026gt;\u0026lt;path fill=\u0026#34;rgb(26, 0, 143)\u0026#34; fill-opacity=\u0026#34;1\u0026#34; d=\u0026#34;M0,107.121L45.714,134.307C91.429,161.493,182.857,215.866,274.286,254.33C365.714,292.794,457.143,315.35,548.571,300.514C640,285.679,731.429,233.452,822.857,180.313C914.286,127.174,1005.714,73.123,1097.143,43.365C1188.571,13.606,1280,8.141,1371.429,41.079C1462.857,74.017,1554.286,145.358,1645.714,167.782C1737.143,190.206,1828.571,163.713,1874.286,150.467L1920,137.221L1920,360L1874.286,360C1828.571,360,1737.143,360,1645.714,360C1554.286,360,1462.857,360,1371.429,360C1280,360,1188.571,360,1097.143,360C1005.714,360,914.286,360,822.857,360C731.429,360,640,360,548.571,360C457.143,360,365.714,360,274.286,360C182.857,360,91.429,360,45.714,360L0,360Z\u0026#34;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/g\u0026gt;\u0026lt;/g\u0026gt;\u0026lt;/svg\u0026gt; ä¹‹åæ‰“å¼€https://codepen.io/yoksel/details/MWKeKK ç½‘ç«™ï¼Œåœ¨ Insert your SVGä¸­ç²˜è´´ï¼Œå¾—åˆ°\næœ€åæŠŠurl(\u0026quot;\u0026quot;) è¿™å—å¤åˆ¶ã€æ²¡æœ‰åˆ†å·ã€‘ï¼Œå³\nurl(\u0026#39;data:image/svg+xml,%3Csvg xmlns=\u0026#34;http://www.w3.org/2000/svg\u0026#34; viewBox=\u0026#34;0 0 1920 1080\u0026#34;%3E%3Cg transform=\u0026#34; rotate(0 960 540) translate(-0 -0) scale(1) \u0026#34;%3E%3Crect width=\u0026#34;1920\u0026#34; height=\u0026#34;1080\u0026#34; fill=\u0026#34;rgb(184, 171, 255)\u0026#34;%3E%3C/rect%3E%3Cg transform=\u0026#34;translate(0, 0)\u0026#34;%3E%3Cpath fill=\u0026#34;rgb(131, 114, 218)\u0026#34; fill-opacity=\u0026#34;1\u0026#34; d=\u0026#34;M0,352.943L45.714,350.075C91.429,347.207,182.857,341.471,274.286,340.581C365.714,339.692,457.143,343.65,548.571,344.095C640,344.54,731.429,341.472,822.857,303.183C914.286,264.894,1005.714,191.383,1097.143,185.175C1188.571,178.967,1280,240.06,1371.429,221.336C1462.857,202.612,1554.286,104.069,1645.714,98.48C1737.143,92.892,1828.571,180.258,1874.286,223.941L1920,267.624L1920,1080L1874.286,1080C1828.571,1080,1737.143,1080,1645.714,1080C1554.286,1080,1462.857,1080,1371.429,1080C1280,1080,1188.571,1080,1097.143,1080C1005.714,1080,914.286,1080,822.857,1080C731.429,1080,640,1080,548.571,1080C457.143,1080,365.714,1080,274.286,1080C182.857,1080,91.429,1080,45.714,1080L0,1080Z\u0026#34;%3E%3C/path%3E%3C/g%3E%3Cg transform=\u0026#34;translate(0, 360)\u0026#34;%3E%3Cpath fill=\u0026#34;rgb(79, 57, 180)\u0026#34; fill-opacity=\u0026#34;1\u0026#34; d=\u0026#34;M0,136.093L45.714,117.434C91.429,98.774,182.857,61.455,274.286,80.719C365.714,99.983,457.143,175.829,548.571,189.505C640,203.181,731.429,154.687,822.857,130.414C914.286,106.141,1005.714,106.09,1097.143,141.274C1188.571,176.458,1280,246.877,1371.429,284.697C1462.857,322.517,1554.286,327.739,1645.714,284.675C1737.143,241.611,1828.571,150.263,1874.286,104.589L1920,58.914L1920,720L1874.286,720C1828.571,720,1737.143,720,1645.714,720C1554.286,720,1462.857,720,1371.429,720C1280,720,1188.571,720,1097.143,720C1005.714,720,914.286,720,822.857,720C731.429,720,640,720,548.571,720C457.143,720,365.714,720,274.286,720C182.857,720,91.429,720,45.714,720L0,720Z\u0026#34;%3E%3C/path%3E%3C/g%3E%3Cg transform=\u0026#34;translate(0, 720)\u0026#34;%3E%3Cpath fill=\u0026#34;rgb(26, 0, 143)\u0026#34; fill-opacity=\u0026#34;1\u0026#34; d=\u0026#34;M0,107.121L45.714,134.307C91.429,161.493,182.857,215.866,274.286,254.33C365.714,292.794,457.143,315.35,548.571,300.514C640,285.679,731.429,233.452,822.857,180.313C914.286,127.174,1005.714,73.123,1097.143,43.365C1188.571,13.606,1280,8.141,1371.429,41.079C1462.857,74.017,1554.286,145.358,1645.714,167.782C1737.143,190.206,1828.571,163.713,1874.286,150.467L1920,137.221L1920,360L1874.286,360C1828.571,360,1737.143,360,1645.714,360C1554.286,360,1462.857,360,1371.429,360C1280,360,1188.571,360,1097.143,360C1005.714,360,914.286,360,822.857,360C731.429,360,640,360,548.571,360C457.143,360,365.714,360,274.286,360C182.857,360,91.429,360,45.714,360L0,360Z\u0026#34;%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/svg%3E\u0026#39;) åŠ ä¸Š\ntop/cover no-repeat fixed å³\nurl(\u0026#39;data:image/svg+xml,%3Csvg xmlns=\u0026#34;http://www.w3.org/2000/svg\u0026#34; viewBox=\u0026#34;0 0 1920 1080\u0026#34;%3E%3Cg transform=\u0026#34; rotate(0 960 540) translate(-0 -0) scale(1) \u0026#34;%3E%3Crect width=\u0026#34;1920\u0026#34; height=\u0026#34;1080\u0026#34; fill=\u0026#34;rgb(184, 171, 255)\u0026#34;%3E%3C/rect%3E%3Cg transform=\u0026#34;translate(0, 0)\u0026#34;%3E%3Cpath fill=\u0026#34;rgb(131, 114, 218)\u0026#34; fill-opacity=\u0026#34;1\u0026#34; d=\u0026#34;M0,352.943L45.714,350.075C91.429,347.207,182.857,341.471,274.286,340.581C365.714,339.692,457.143,343.65,548.571,344.095C640,344.54,731.429,341.472,822.857,303.183C914.286,264.894,1005.714,191.383,1097.143,185.175C1188.571,178.967,1280,240.06,1371.429,221.336C1462.857,202.612,1554.286,104.069,1645.714,98.48C1737.143,92.892,1828.571,180.258,1874.286,223.941L1920,267.624L1920,1080L1874.286,1080C1828.571,1080,1737.143,1080,1645.714,1080C1554.286,1080,1462.857,1080,1371.429,1080C1280,1080,1188.571,1080,1097.143,1080C1005.714,1080,914.286,1080,822.857,1080C731.429,1080,640,1080,548.571,1080C457.143,1080,365.714,1080,274.286,1080C182.857,1080,91.429,1080,45.714,1080L0,1080Z\u0026#34;%3E%3C/path%3E%3C/g%3E%3Cg transform=\u0026#34;translate(0, 360)\u0026#34;%3E%3Cpath fill=\u0026#34;rgb(79, 57, 180)\u0026#34; fill-opacity=\u0026#34;1\u0026#34; d=\u0026#34;M0,136.093L45.714,117.434C91.429,98.774,182.857,61.455,274.286,80.719C365.714,99.983,457.143,175.829,548.571,189.505C640,203.181,731.429,154.687,822.857,130.414C914.286,106.141,1005.714,106.09,1097.143,141.274C1188.571,176.458,1280,246.877,1371.429,284.697C1462.857,322.517,1554.286,327.739,1645.714,284.675C1737.143,241.611,1828.571,150.263,1874.286,104.589L1920,58.914L1920,720L1874.286,720C1828.571,720,1737.143,720,1645.714,720C1554.286,720,1462.857,720,1371.429,720C1280,720,1188.571,720,1097.143,720C1005.714,720,914.286,720,822.857,720C731.429,720,640,720,548.571,720C457.143,720,365.714,720,274.286,720C182.857,720,91.429,720,45.714,720L0,720Z\u0026#34;%3E%3C/path%3E%3C/g%3E%3Cg transform=\u0026#34;translate(0, 720)\u0026#34;%3E%3Cpath fill=\u0026#34;rgb(26, 0, 143)\u0026#34; fill-opacity=\u0026#34;1\u0026#34; d=\u0026#34;M0,107.121L45.714,134.307C91.429,161.493,182.857,215.866,274.286,254.33C365.714,292.794,457.143,315.35,548.571,300.514C640,285.679,731.429,233.452,822.857,180.313C914.286,127.174,1005.714,73.123,1097.143,43.365C1188.571,13.606,1280,8.141,1371.429,41.079C1462.857,74.017,1554.286,145.358,1645.714,167.782C1737.143,190.206,1828.571,163.713,1874.286,150.467L1920,137.221L1920,360L1874.286,360C1828.571,360,1737.143,360,1645.714,360C1554.286,360,1462.857,360,1371.429,360C1280,360,1188.571,360,1097.143,360C1005.714,360,914.286,360,822.857,360C731.429,360,640,360,548.571,360C457.143,360,365.714,360,274.286,360C182.857,360,91.429,360,45.714,360L0,360Z\u0026#34;%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/svg%3E\u0026#39;) top/cover no-repeat fixed ä¹‹åç²˜è´´å³å¯\né€šè¿‡å¯¹æ¯”å‘ç°ï¼š\nå°±æ˜¯æŠŠä¸‹é¢çš„å†…å®¹\nurl(\u0026#39;data:image/svg+xml,\u0026lt;svg xmlns=\u0026#34;http://www.w3.org/2000/svg\u0026#34; viewBox=\u0026#34;0 0 1920 1080\u0026#34;\u0026gt;\u0026lt;g transform=\u0026#34; rotate(0 960 540) translate(-0 -0) scale(1) \u0026#34;\u0026gt;\u0026lt;rect width=\u0026#34;1920\u0026#34; height=\u0026#34;1080\u0026#34; fill=\u0026#34;rgb(184, 171, 255)\u0026#34;\u0026gt;\u0026lt;/rect\u0026gt;\u0026lt;g transform=\u0026#34;translate(0, 0)\u0026#34;\u0026gt;\u0026lt;path fill=\u0026#34;rgb(131, 114, 218)\u0026#34; fill-opacity=\u0026#34;1\u0026#34; d=\u0026#34;M0,352.943L45.714,350.075C91.429,347.207,182.857,341.471,274.286,340.581C365.714,339.692,457.143,343.65,548.571,344.095C640,344.54,731.429,341.472,822.857,303.183C914.286,264.894,1005.714,191.383,1097.143,185.175C1188.571,178.967,1280,240.06,1371.429,221.336C1462.857,202.612,1554.286,104.069,1645.714,98.48C1737.143,92.892,1828.571,180.258,1874.286,223.941L1920,267.624L1920,1080L1874.286,1080C1828.571,1080,1737.143,1080,1645.714,1080C1554.286,1080,1462.857,1080,1371.429,1080C1280,1080,1188.571,1080,1097.143,1080C1005.714,1080,914.286,1080,822.857,1080C731.429,1080,640,1080,548.571,1080C457.143,1080,365.714,1080,274.286,1080C182.857,1080,91.429,1080,45.714,1080L0,1080Z\u0026#34;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/g\u0026gt;\u0026lt;g transform=\u0026#34;translate(0, 360)\u0026#34;\u0026gt;\u0026lt;path fill=\u0026#34;rgb(79, 57, 180)\u0026#34; fill-opacity=\u0026#34;1\u0026#34; d=\u0026#34;M0,136.093L45.714,117.434C91.429,98.774,182.857,61.455,274.286,80.719C365.714,99.983,457.143,175.829,548.571,189.505C640,203.181,731.429,154.687,822.857,130.414C914.286,106.141,1005.714,106.09,1097.143,141.274C1188.571,176.458,1280,246.877,1371.429,284.697C1462.857,322.517,1554.286,327.739,1645.714,284.675C1737.143,241.611,1828.571,150.263,1874.286,104.589L1920,58.914L1920,720L1874.286,720C1828.571,720,1737.143,720,1645.714,720C1554.286,720,1462.857,720,1371.429,720C1280,720,1188.571,720,1097.143,720C1005.714,720,914.286,720,822.857,720C731.429,720,640,720,548.571,720C457.143,720,365.714,720,274.286,720C182.857,720,91.429,720,45.714,720L0,720Z\u0026#34;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/g\u0026gt;\u0026lt;g transform=\u0026#34;translate(0, 720)\u0026#34;\u0026gt;\u0026lt;path fill=\u0026#34;rgb(26, 0, 143)\u0026#34; fill-opacity=\u0026#34;1\u0026#34; d=\u0026#34;M0,107.121L45.714,134.307C91.429,161.493,182.857,215.866,274.286,254.33C365.714,292.794,457.143,315.35,548.571,300.514C640,285.679,731.429,233.452,822.857,180.313C914.286,127.174,1005.714,73.123,1097.143,43.365C1188.571,13.606,1280,8.141,1371.429,41.079C1462.857,74.017,1554.286,145.358,1645.714,167.782C1737.143,190.206,1828.571,163.713,1874.286,150.467L1920,137.221L1920,360L1874.286,360C1828.571,360,1737.143,360,1645.714,360C1554.286,360,1462.857,360,1371.429,360C1280,360,1188.571,360,1097.143,360C1005.714,360,914.286,360,822.857,360C731.429,360,640,360,548.571,360C457.143,360,365.714,360,274.286,360C182.857,360,91.429,360,45.714,360L0,360Z\u0026#34;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/g\u0026gt;\u0026lt;/g\u0026gt;\u0026lt;/svg\u0026gt;\u0026#39;) top/cover no-repeat fixed ,å·¦å°–æ‹¬å· \u0026lt; æ›¿æ¢æˆ %3Cï¼ŒæŠŠ \u0026lt; æ›¿æ¢æˆ %3E ï¼ˆè¡¥å……ä¸‹ï¼Œå¦‚æœæ˜¯å…¶ä»–å›¾ç‰‡å¯èƒ½ä¸æ­¢è¿™å‡ ä¸ªï¼Œä½†æ˜¯è¿™å¼ å›¾åªæ›¿æ¢äº†è¿™å‡ ä¸ªã€‚ä¸å¤ªäº†è§£å‰ç«¯åˆ°åº•éœ€è¦è½¬å“ªäº›ç‰¹æ®Šå­—ç¬¦ï¼Œå› ä¸ºæˆ‘å‘ç°æœ‰äº›ç©ºæ ¼ / \u0026quot; ä¹Ÿéƒ½æ²¡æœ‰è½¬ï¼‰ï¼Œå³\nurl(\u0026#39;data:image/svg+xml,%3Csvg xmlns=\u0026#34;http://www.w3.org/2000/svg\u0026#34; viewBox=\u0026#34;0 0 1920 1080\u0026#34;%3E%3Cg transform=\u0026#34; rotate(0 960 540) translate(-0 -0) scale(1) \u0026#34;%3E%3Crect width=\u0026#34;1920\u0026#34; height=\u0026#34;1080\u0026#34; fill=\u0026#34;rgb(184, 171, 255)\u0026#34;%3E%3C/rect%3E%3Cg transform=\u0026#34;translate(0, 0)\u0026#34;%3E%3Cpath fill=\u0026#34;rgb(131, 114, 218)\u0026#34; fill-opacity=\u0026#34;1\u0026#34; d=\u0026#34;M0,352.943L45.714,350.075C91.429,347.207,182.857,341.471,274.286,340.581C365.714,339.692,457.143,343.65,548.571,344.095C640,344.54,731.429,341.472,822.857,303.183C914.286,264.894,1005.714,191.383,1097.143,185.175C1188.571,178.967,1280,240.06,1371.429,221.336C1462.857,202.612,1554.286,104.069,1645.714,98.48C1737.143,92.892,1828.571,180.258,1874.286,223.941L1920,267.624L1920,1080L1874.286,1080C1828.571,1080,1737.143,1080,1645.714,1080C1554.286,1080,1462.857,1080,1371.429,1080C1280,1080,1188.571,1080,1097.143,1080C1005.714,1080,914.286,1080,822.857,1080C731.429,1080,640,1080,548.571,1080C457.143,1080,365.714,1080,274.286,1080C182.857,1080,91.429,1080,45.714,1080L0,1080Z\u0026#34;%3E%3C/path%3E%3C/g%3E%3Cg transform=\u0026#34;translate(0, 360)\u0026#34;%3E%3Cpath fill=\u0026#34;rgb(79, 57, 180)\u0026#34; fill-opacity=\u0026#34;1\u0026#34; d=\u0026#34;M0,136.093L45.714,117.434C91.429,98.774,182.857,61.455,274.286,80.719C365.714,99.983,457.143,175.829,548.571,189.505C640,203.181,731.429,154.687,822.857,130.414C914.286,106.141,1005.714,106.09,1097.143,141.274C1188.571,176.458,1280,246.877,1371.429,284.697C1462.857,322.517,1554.286,327.739,1645.714,284.675C1737.143,241.611,1828.571,150.263,1874.286,104.589L1920,58.914L1920,720L1874.286,720C1828.571,720,1737.143,720,1645.714,720C1554.286,720,1462.857,720,1371.429,720C1280,720,1188.571,720,1097.143,720C1005.714,720,914.286,720,822.857,720C731.429,720,640,720,548.571,720C457.143,720,365.714,720,274.286,720C182.857,720,91.429,720,45.714,720L0,720Z\u0026#34;%3E%3C/path%3E%3C/g%3E%3Cg transform=\u0026#34;translate(0, 720)\u0026#34;%3E%3Cpath fill=\u0026#34;rgb(26, 0, 143)\u0026#34; fill-opacity=\u0026#34;1\u0026#34; d=\u0026#34;M0,107.121L45.714,134.307C91.429,161.493,182.857,215.866,274.286,254.33C365.714,292.794,457.143,315.35,548.571,300.514C640,285.679,731.429,233.452,822.857,180.313C914.286,127.174,1005.714,73.123,1097.143,43.365C1188.571,13.606,1280,8.141,1371.429,41.079C1462.857,74.017,1554.286,145.358,1645.714,167.782C1737.143,190.206,1828.571,163.713,1874.286,150.467L1920,137.221L1920,360L1874.286,360C1828.571,360,1737.143,360,1645.714,360C1554.286,360,1462.857,360,1371.429,360C1280,360,1188.571,360,1097.143,360C1005.714,360,914.286,360,822.857,360C731.429,360,640,360,548.571,360C457.143,360,365.714,360,274.286,360C182.857,360,91.429,360,45.714,360L0,360Z\u0026#34;%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/svg%3E\u0026#39;) top/cover no-repeat fixed PNGæ ¼å¼ä½œä¸ºèƒŒæ™¯å›¾ç‰‡ï¼ˆä¸å¯è¡Œï¼‰ # è¯•ç€å°†è¿™å¼ å›¾ç‰‡ç”¨base64ç¼–ç \nè¿™é‡Œä¹‹æ‰€ä»¥ä¸æ”¾å­—ç¬¦äº†ï¼Œæ˜¯å› ä¸ºæˆ‘æ”¾äº†ä¹‹åobsidianå¡æ­»äº†ï¼ˆ30å¤šä¸‡ä¸ªå­—ç¬¦ï¼‰ï¼Œæ‰€ä»¥çªç„¶è”æƒ³åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘æŠŠè¿™ä¸ªbase64æ”¾åˆ°StyleSettingsé‡Œé¢çš„æ—¶å€™ï¼Œæ²¡æ•ˆæœè€Œä¸”å¡æ­»çš„åŸå› æŠŠï¼Œå“ˆå“ˆï¼Œä¹‹å‰ä¸€ç›´æ²¡æ³¨æ„\nè¯•ç€æŠŠpngå…ˆè½¬ä¸ºsvgï¼Œä¹‹åå†æŒ‰ç…§svgä½œä¸ºèƒŒæ™¯çš„æ–¹æ³•åšä¸€éã€‚\nè½¬æ¢åçš„svgå›¾ç‰‡(ä¸çŸ¥é“ä¸ºä»€ä¹ˆå›¾ç‰‡æ–¹å‘å˜äº†ï¼Œæˆ‘ç¬¬ä¸€æ¬¡ä¸‹è½½è¿™å¼ å›¾ã€pngã€‘ç¡®å®æ˜¯è¿™ä¸ªæ–¹å‘ï¼Œåé¢æˆ‘è°ƒæ•´æ­£äº†ï¼Œç°åœ¨åˆæ­ªäº†)\næœ‰ä¸¤ç™¾å¤šä¸‡å¤šä¸ªå­—ç¬¦ã€‚ã€‚ã€‚ç…§æ ·æ²¡æ•ˆæœï¼Œä¸è¿‡è¿™æ¬¡æ²¡å¡æ­»äº† ç”¨äº†ä¸ªçº¯è‰²pngè½¬svgï¼Œæœ‰æ•ˆæœäº†ï¼Œä½†æ˜¯å›¾ç‰‡å˜äº†ä¸€äº›ã€‚æˆ‘è§‰å¾—å¯èƒ½æ˜¯è½¬æ¢çš„é—®é¢˜ï¼Ÿä¸è¿‡å¯ä»¥ç¡®å®šçš„ä¸€ç‚¹å°±æ˜¯ï¼Œpngæ²¡æ•ˆæœçš„ä¸€ä¸ªåŸå› æ˜¯å­—ç¬¦å¤ªå¤š\næœ€åå°è¯•ç”¨ä¸€å¼ çº¯è‰²pngï¼Œè½¬base64ï¼Œå¹¶ç”¨url(\u0026quot;\u0026quot;)çš„å½¢å¼æ”¾å…¥è®¾ç½®ï¼Œç…§æ ·æ²¡æ•ˆæœã€‚ä¸çŸ¥é“æ˜¯ä¸æ”¯æŒpngï¼Œè¿˜æ˜¯æˆ‘çš„è®¾ç½®æ–¹æ³•é”™äº†ï¼Œè¿™æ¬¡åªæœ‰9000ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯å¡é¡¿äº†ï¼Œtabç•Œé¢èŠ±å±ï¼Œå¦‚å›¾\næ–‡ç« ä¸­ç”¨åˆ°çš„ï¼ˆå¯èƒ½ç”¨åˆ°çš„ï¼‰urlå¦‚ä¸‹\nhttps://codepen.io/yoksel/details/MWKeKK svg-\u0026gt;encode-\u0026gt;css https://stackoverflow.com/questions/41405884/svg-data-image-as-css-background å…³äºsvgè½¬base64å¹¶åµŒå…¥cssçš„åšæ³•ï¼ˆå¯èƒ½å¯è¡Œï¼Œæ²¡è¯•è¿‡ï¼Œæœ¬æ–‡ä¸­é‡‡ç”¨ç¨å¾®ç®€å•çš„åŠæ³•ï¼‰ https://meyerweb.com/eric/tools/dencoder/ url encodeï¼ˆæ²¡ç”¨ä¸Šï¼Œå› ä¸ºå‘ç°ä»–æŠŠæ‰€æœ‰å­—ç¬¦éƒ½è½¬ç äº†ï¼Œå®é™…ä¸Šåªè½¬äº† \u0026lt; å’Œ \u0026gt; https://www.base64-image.de/ å›¾ç‰‡è½¬base64\nhttps://tool.chinaz.com/tools/urlencode.aspx urlç¼–ç è§£ç \nhttps://www.asciim.cn/m/tools/convert_ascii_to_string.html ascaiiä¸å­—ç¬¦ä¸²çš„è½¬æ¢\nhttps://forever-z-133.github.io/demos/single/svg-to-base64.html svgè½¬base64\nhttps://products.aspose.app/pdf/zh/conversion/png-to-svg pngè½¬svg\nhttps://github.com/Akifyss/obsidian-border/issues/251 obsidian-borderä¸»é¢˜ï¼Œissueä¸­ä½œè€…çš„ç›¸å…³å›å¤\n"},{"id":13,"href":"/zh/docs/study/Obsidian/obsidian-theme/","title":"obsidian-theme","section":"Obsidian","content":" ä¸»é¢˜æ¨è # Neumorphism-dark.json\nSunset-base64.json âœ” Obsidian-default-dark-alt âœ” 4. Obsidian-default-light-alt Neumorphism.json eyefriendly âœ” boundy âœ” flexoki-light Borderless-light å…³äºobsidianä¸»é¢˜borderçš„èƒŒæ™¯å›¾ç‰‡è®¾ç½® # é…åˆStyleSettingsï¼Œåœ¨StyleSettingsçš„è¿™é‡Œè®¾ç½®\næš‚ä¸æ˜ç¡® # backgroundä¸­è²Œä¼¼å­˜åœ¨è½¬æ¢è§„åˆ™ï¼Œä¸æ˜¯ç›´æ¥ç”¨url(\u0026quot;\u0026quot;)è¿™ä¸ªå½¢å¼æŠŠå›¾ç‰‡base64æ”¾è¿›æ¥å°±å¯ä»¥äº†ï¼Œç›®å‰è§‰å¾—å¯èƒ½çš„è½¬æ¢è§„åˆ™\n%3c 48+12=60 \u0026lt; %3e 48+14=62 \u0026gt; %23 32+3=35 # #ä¸‹é¢çš„å¥½åƒæ²¡ç”¨åˆ°ï¼Œä¹Ÿä¸ç¡®å®š %2b 32+11=43 + %3b ; %2c , åç»­è§å¦ä¸€ç¯‡æ–‡ç« \nborder-theme {% post_link \u0026lsquo;study/obsidian/border-theme\u0026rsquo; \u0026lsquo;helo\u0026rsquo; %}\n"},{"id":14,"href":"/zh/docs/study/Obsidian/plugin/","title":"plugin","section":"Obsidian","content":"obsidian-custom-attachment-location v.28.1æ–‡ä»¶æ‰¹é‡é‡å‘½åæœ‰æ•ˆï¼Œå†å¾€ä¸Šéƒ½æ˜¯æ— æ•ˆçš„\n"},{"id":15,"href":"/zh/docs/test/pdf-test/","title":"pdfæ ¼å¼æµ‹è¯•","section":"æµ‹è¯•","content":"![ly-pdf](attachments/book/æ¨ªæ ¼ä¸­.pdf) ![ly-pdf](attachments/book/æ¨ªæ ¼ä¸­.pdf) \u0026lt;a href=\u0026#34;/myjs/pdfjs/web/viewer.html?file=/attachments/book/æ¨ªæ ¼ä¸­.pdf\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;æ¨ªæ ¼ä¸­\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;/myjs/pdfjs/web/viewer.html?file=/attachments/book/æ¨ªæ ¼ä¸­.pdf\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;æ¨ªæ ¼ä¸­\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;/myjs/pdfjs/web/viewer.html?file=/attachments/book/æ¨ªæ ¼ä¸­.pdf\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;åº”è¯¥å‡ºç°\u0026lt;/a\u0026gt; \u0026lt;iframe src=\u0026#39;/myjs/pdfjs/web/viewer.html?file=/attachments/book/æ¨ªæ ¼ä¸­.pdf\u0026#39; marginwidth=\u0026#34;0\u0026#34; frameborder=\u0026#34;no\u0026#34; scrolling=\u0026#34;no\u0026#34; style=\u0026#34;padding: 0;width:100%;height: 50px;\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; \u0026lt;iframe src=\u0026#39;/myjs/pdfjs/web/viewer.html?file=/attachments/book/æ¨ªæ ¼ä¸­.pdf\u0026#39; marginwidth=\u0026#34;0\u0026#34; frameborder=\u0026#34;no\u0026#34; scrolling=\u0026#34;no\u0026#34; style=\u0026#34;padding: 0;width:100%;height: 50px;\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; \u0026lt;iframe src=\u0026#39;/myjs/pdfjs/web/viewer.html?file=/attachments/book/æ¨ªæ ¼ä¸­.pdf\u0026#39; marginwidth=\u0026#34;0\u0026#34; frameborder=\u0026#34;no\u0026#34; scrolling=\u0026#34;no\u0026#34; style=\u0026#34;padding: 0;width:100%;height: 50px;\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; ------ dfdf ![](img/ecd-20241202113023866.svg) %%[ğŸ–‹ Edit in Excalidraw](img/ecd-20241202113023866.md)%% %%[ğŸ–‹ Edit in Excalidraw](img/ecd-20241202113023866.md)%% "},{"id":16,"href":"/zh/docs/study/Redis/rsync-use/","title":"rsyncä½¿ç”¨","section":"Redis","content":"å…¶å®å°±æ˜¯linuxçš„cpåŠŸèƒ½ï¼ˆå¸¦å¢é‡å¤åˆ¶ï¼‰ #æ¨é€åˆ°rsync-k40 rsync -avz \u0026ndash;progress \u0026ndash;delete source-rsync -e \u0026lsquo;ssh -p 8022\u0026rsquo; ly@192.168.1.101:/storage/emulated/0/000Ly/git/blog.source/source/attachments/rsync-k40 #æ¨é€åˆ°rsync-tabs8 rsync -avz \u0026ndash;progress \u0026ndash;delete source-rsync -e \u0026lsquo;ssh -p 8022\u0026rsquo; ly@192.168.1.106:/storage/emulated/0/000Ly/git/blog.source/source/attachments/rsync-tabs8 #æ¨é€åˆ°rsync-pc rsync -avz \u0026ndash;progress \u0026ndash;delete source-rsync -e \u0026lsquo;ssh -p 22\u0026rsquo; ly@192.168.1.206:/mnt/hgfs/gitRepo/blog.source/source/attachments/rsync-pc\n#ä»æ‰‹æœºä¸Šæ‹‰å– rsync -avz \u0026ndash;progress \u0026ndash;delete -e \u0026lsquo;ssh -p 8022\u0026rsquo; ly@192.168.1.101:/storage/emulated/0/000Ly/git/blog.source/source/attachments/rsync-k40 source-rsync\n"},{"id":17,"href":"/zh/docs/life/20240626/","title":"çŸ¥å‘½ä¸æƒ§  æ—¥æ—¥è‡ªæ–°","section":"ç”Ÿæ´»","content":"è§†é¢‘åˆ†äº«\n"},{"id":18,"href":"/zh/docs/test/hello/","title":"çŸ¥å‘½ä¸æƒ§  æ—¥æ—¥è‡ªæ–°","section":"æµ‹è¯•","content":"String\u0026lt;A\u0026gt; a=new String(); "},{"id":19,"href":"/zh/docs/problem/Other/01/","title":"å¦‚ä½•æœç´¢","section":"Other","content":" åŸåˆ™ # æœç´¢çš„æ—¶å€™ï¼Œè¦ç®€çº¦ï¼Œä¸”å°½é‡æŠŠå…³é”®è¯åˆ†æ•£ï¼Œä¸è¦æœ‰\u0026quot;çš„\u0026quot;ï¼Œ\u0026ldquo;åœ°\u0026rdquo;ï¼Œæˆ–è€…å…¶ä»–åŠ¨è¯ä»€ä¹ˆçš„ï¼Œå°½é‡æ˜¯åè¯ã€‚ å…³é”®è¯ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ æ¯”å¦‚æƒ³è¦çœ‹ä¸€éƒ¨ç”µå½±ï¼Œé‚£ä¹ˆå…³é”®è¯æœ‰\u0026quot;ç”µå½±å\u0026quot;ï¼Œ\u0026ldquo;bt\u0026rdquo;ï¼Œ\u0026ldquo;è¿…é›·\u0026rdquo;ï¼Œ\u0026ldquo;é˜¿é‡Œäº‘ç›˜\u0026rdquo;ï¼Œ\u0026ldquo;ç™¾åº¦ç½‘ç›˜\u0026rdquo;\nè§£é‡Šä¸€ä¸‹ï¼Œè¿™é‡Œæ¥æºï¼ˆè¿…é›·|é˜¿é‡Œäº‘ç›˜|ç™¾åº¦ç½‘ç›˜ï¼‰ï¼Œèµ„æºç±»å‹ï¼ˆbtï¼‰ä¹Ÿæ˜¯å…³é”®è¯\næ‰€ä»¥æœç´¢å°±æ˜¯**\u0026ldquo;å­¤æ³¨ä¸€æ· bt\u0026rdquo;ï¼Œ\u0026ldquo;å­¤æ³¨ä¸€æ· é˜¿é‡Œäº‘ç›˜\u0026rdquo;ï¼Œ\u0026ldquo;å­¤æ³¨ä¸€æ· ç™¾åº¦ç½‘ç›˜\u0026rdquo;ï¼Œ\u0026ldquo;å­¤æ³¨ä¸€æ· è¿…é›·\u0026rdquo;ï¼Œæ³¨æ„ï¼Œä¸­é—´éƒ½æœ‰ç©ºæ ¼**\nä¾‹å­ # btç§å­å½¢å¼ # ç‚¹è¿›æ¥ä¹‹åï¼Œæ»‘åˆ°æœ€ä¸‹é¢ï¼ˆä¸€èˆ¬é“¾æ¥éƒ½æ˜¯ä»¥æµ…è“è‰²æ ‡è¯†ï¼Œç‚¹è¿‡ä¸€æ¬¡åå°±å˜æˆæš—çº¢è‰²ï¼‰\nbtæ–‡ä»¶ä¸€èˆ¬è¦ç”¨\u0026quot;è¿…é›·\u0026quot;è¿™ä¸ªè½¯ä»¶ä¸‹è½½ï¼Œä¸Šé¢éšä¾¿ç‚¹å‡»ä¸€ä¸ªï¼Œè¿…é›·è¿™ä¸ªè½¯ä»¶å°±ä¼šè·³å‡ºæ¥\nç„¶åé€‰æ‹©å¥½ç›®å½•ç‚¹å‡»ç¡®è®¤å°±å¯ä»¥ä¸‹è½½äº†\né˜¿é‡Œäº‘ç›˜å½¢å¼ # ç¬¬ä¸€ä¸ªé“¾æ¥æœ‰äººæå‡ºè´¨ç–‘äº†ï¼Œæˆ‘ä»¬ç‚¹ä¸‹é¢é‚£ä¸ªï¼Œè¿™æ˜¯è¿›å…¥ä¹‹åçš„ç”»é¢ï¼š\nå†ç‚¹å‡»\u0026quot;é˜¿é‡Œxxxxxxxxxx\u0026quot;è¿™ä¸ªé“¾æ¥ï¼Œè¿›å…¥é˜¿é‡Œäº‘ç›˜ï¼š\nç‚¹è¿›æ¥çœ‹è§†é¢‘æ–‡ä»¶è¿˜åœ¨ä¸åœ¨ï¼Œåœ¨çš„è¯ï¼Œä¿å­˜å°±å¯ä»¥äº†\nä¹‹ååˆ°è‡ªå·±çš„é˜¿é‡Œäº‘ç›˜ä¸‹è½½å°±è¡Œäº†\nç™¾åº¦äº‘ç›˜å½¢å¼ # ç™¾åº¦äº‘ç›˜è¢«é™é€Ÿäº†ï¼Œä¸å¾—å·²çš„æƒ…å†µä¸‹ï¼Œä¸è¦ç”¨ç™¾åº¦äº‘ç›˜ï¼ŒåŸºæœ¬ä¸Šå‰é¢ä¸¤ç§å½¢å¼çš„èµ„æºæ²¡æ‰¾åˆ°çš„è¯ï¼Œç™¾åº¦äº‘ç›˜å¤§æ¦‚ç‡ä¹Ÿä¸ä¼šæœ‰\n"},{"id":20,"href":"/zh/docs/life/20231227/","title":"èµ·åºŠä¸´æ„Ÿ","section":"ç”Ÿæ´»","content":"æ‰€è°“è´µäººï¼Œå¹¶ä¸æ˜¯å°å»ºè¿·ä¿¡ï¼Œè€Œæ˜¯æŒ‡å¯¹ä½ æˆé•¿æœ‰å¸®åŠ©çš„äººï¼Œä¸å•å•æ˜¯ç›´è§‚çš„å¥½ã€‚\nåœ¨ä½ è’¸è’¸æ—¥ä¸Šçš„æ—¶å€™æ‰“å‹ä½ ï¼Œè®©ä½ æœ‰æ‰€æ”¶æ•›ï¼›åœ¨ä½ é¢“åºŸå •è½çš„æ—¶å€™é¼“åŠ±ä½ ï¼Œä½¿ä½ ç§¯æå‘ä¸Šã€‚ä»–ä»¬éƒ½æ˜¯è´µäººï¼Œä¸€é˜´ä¸€é˜³ä¹‹è°“é“ï¼Œå¦‚æ˜¯è€Œå·²ã€‚\n"},{"id":21,"href":"/zh/docs/life/20231101/","title":"20231101","section":"ç”Ÿæ´»","content":" é™„(20231102)\nèå…¥æˆ‘ä¸­åæ–‡åŒ–çš„ï¼Œæ‰æ˜¯è‡ªå·±äººã€‚æƒ³æ¶ˆç­æˆ‘ä¸­åæ–‡åŒ–çš„ï¼Œå³ä½¿å æœ‰äº†è¿™ç‰‡åœŸåœ°ï¼Œä¹Ÿä¸èƒ½ç§°ä¹‹â€œåŠŸè‡£â€ã€‚\nå½“ä¸€ä¸ªæ°‘æ—çš„æ–‡åŒ–è¢«æ‘§æ¯çš„æ—¶å€™ï¼Œé‚£ä¸ªæ°‘æ—å°±æ˜¯å½»åº•ç­äº¡äº†ã€‚ ä¸è¿‡ï¼Œæˆ‘è§‰å¾—ï¼Œåªè¦æ˜¯åœ¨ä¸­å›½è¿™ç‰‡åœŸåœ°ä¸Š(åœ°ç†)ï¼Œæ— è®ºè°æ¥ï¼Œéƒ½ä¼šäº§ç”Ÿè¿™æ ·çš„æ–‡åŒ–ï¼Œæ— ä¾‹å¤–ã€‚(åœ°ç†å†³å®šè®º) "},{"id":22,"href":"/zh/docs/life/archive/20231026/","title":"æˆå°±","section":"å¾€æ—¥å½’æ¡£","content":" ä»»ä½•äº‹æƒ…çš„æˆåŠŸï¼Œéƒ½æ²¡æœ‰ä»€ä¹ˆå¯éª„å‚²çš„ï¼Œä¸è¿‡æ˜¯ä¸€ç‰©é™ä¸€ç‰©ï¼Œæ— ä»–å°”ã€‚ äººç”Ÿæœ€å¤§çš„é—®é¢˜ï¼Œæ˜¯ä¸æƒ³ï¼Œè€Œä¸æ˜¯ä¸èƒ½ã€‚ "},{"id":23,"href":"/zh/docs/life/archive/20231013/","title":"æ²‰æ²¡","section":"å¾€æ—¥å½’æ¡£","content":" åŠªåŠ›ä¸ä¸€å®šæœ‰ç”¨ï¼Œä½†æ˜¯è™šåº¦å…‰é˜´éš¾é“å°±æ˜¯å¯¹çš„å—ï¼Ÿ å³ä½¿ä½ ä¸€æ—¶æ‰¾ä¸åˆ°æ­£ç¡®çš„è·¯ï¼Œä½†æ˜¯ä½ åº”è¯¥èƒ½ä¸€çœ¼çœ‹å‡ºå“ªäº›æ˜¯é”™çš„ï¼ŒåŠæ—¶é¿å¼€ã€‚ "},{"id":24,"href":"/zh/docs/problem/Linux/20230919/","title":"Linuxæ“ä½œç¬¦é—®é¢˜","section":"Linux","content":" å‡½æ•°é€€å‡º # å‡½æ•°é€€å‡ºçŠ¶æ€ï¼š0ï¼ˆæˆåŠŸï¼‰ï¼Œéé›¶ï¼ˆéæ­£å¸¸ï¼Œå¤±è´¥ï¼‰\nå¼•å· # åŒå¼•å·ä¸­ä½¿ç”¨è½¬ä¹‰å­—ç¬¦å¯ä»¥é˜²æ­¢å±•å¼€\nè¿™æ„å‘³ç€å•è¯åˆ†å‰²(ç©ºæ ¼åˆ¶è¡¨æ¢è¡Œåˆ†å‰²å•è¯)ã€è·¯å¾„åå±•å¼€(*æ˜Ÿå·)ã€æ³¢æµªçº¿å±•å¼€å’ŒèŠ±æ‹¬å·å±•å¼€éƒ½å°†å¤±æ•ˆï¼Œç„¶è€Œå‚æ•°å±•å¼€ã€ ç®—æœ¯å±•å¼€å’Œå‘½ä»¤æ›¿æ¢ä»ç„¶æ‰§è¡Œ\necho \u0026#34;text ~/*.txt {a,b} $(echo foo) $((2+2)) $USER\u0026#34; #ç¦æ­¢éƒ¨åˆ† text ~/*.txt {a,b} foo 4 me echo \u0026#39;text ~/*.txt {a,b} $(echo foo) $((2+2)) $USER\u0026#39; #å…¨éƒ¨ç¦æ­¢ text ~/*.txt {a,b} $(echo foo) $((2+2)) $USER å„ç§æ“ä½œç¬¦ # [ expression ] / test [[ expression ]] $(( expression )) $var $( termi ) æ–‡ä»¶è¡¨è¾¾å¼ -e fileï¼Œå­—ç¬¦ä¸²è¡¨è¾¾å¼ -n stringï¼Œæ•´æ•°è¡¨è¾¾å¼ integer1 -eq integer2 testå¢å¼ºï¼Œå¢åŠ  [ str =~ regex ]ï¼Œå¢åŠ  == [[ $FILE == foo.* ]] æ•´æ•°åŠ å‡ä¹˜é™¤å–ä½™ å–å˜é‡ æ‰§è¡Œå‘½ä»¤/å‡½æ•° termiå–å˜é‡$å¿…åŠ ï¼Œé‡Œé¢è¢«çœ‹ä½œå‘½ä»¤å‚æ•°ï¼Œ\u0026lt; \u0026gt; ( ) å¿…é¡»è½¬ä¹‰ å¦åˆ™ å°äºå· \u0026lt; å¤§äºå·\u0026gt;è¢«è®¤ä¸ºé‡å®šå‘ ä¸[ ] ä¸€è‡´ å–å˜é‡$å¯åŠ å¯ä¸åŠ  termiå–å˜é‡$å¿…åŠ  if [ -x \u0026#34;$FILE\u0026#34; ] #å¼•å·å¯ä»¥é˜²æ­¢ç©ºå‚æ•°ï¼Œç©ºå€¼ã€‚è€Œ\u0026#34;\u0026#34;è¢«è§£é‡Šæˆç©ºå­—ç¬¦ä¸² "},{"id":25,"href":"/zh/docs/life/archive/20230913/","title":"é²‡é±¼åæ€","section":"å¾€æ—¥å½’æ¡£","content":" é²‡é±¼äº‹ä»¶å…¶å®å‡ºæ¥å¾ˆä¹…äº†ï¼Œä¸€ç›´æ²¡æœ‰å¤ªå¤§å…³æ³¨ï¼Œè¿™å‡ å¤©çªå‘å…´è‡´ï¼ˆæŸä¹è¯„è®ºæåˆ°ï¼‰ï¼Œå°±å»äº†è§£äº†ä¸‹ã€‚å¯èƒ½æˆ‘å¯¹â€œå®˜â€è¿™ç§ä¸œè¥¿ï¼Œä»å°åˆ°å¤§å°±å®šäº†æ€§ï¼Œæ‰€ä»¥å¦‚æœæŸ¥å‡ºä¸ªå¤§æ¸…å®˜ï¼Œçœåƒä¿­ç”¨ç ´è¡£çƒ‚è¡«ï¼Œå€’å¯ç®—å¾—ä¸Šæ–°é—»ã€‚ å¯¹äºå…¶è¨€è®ºï¼Œç¡®å®å¬äº†æœªå°ä¸å…ä¹‰æ„¤å¡«è†ºã€‚äºæ˜¯æˆ‘å°±èŠ±äº†å¤§åŠä¸ªå°æ—¶ä¹‰æ„¤å¡«è†º\u0026hellip; ä¸€ä»£äººåªèƒ½åšä¸€ä»£äººçš„äº‹\u0026mdash;ã€Šèµ°å‘å…±å’Œã€‹ï¼Œå®˜å¦‚æ­¤ï¼Œæ°‘äº¦å¦‚æ­¤ã€‚å¦‚æœä½œä¸ºæ™®é€šè€ç™¾å§“ï¼Œä¸èƒ½å¤Ÿè·»èº«ä»•é€”ï¼Œé‚£å°±æ˜¯å…ˆè€è€å®å®åšå¥½è‡ªå·±çš„æœ¬åˆ†\u0026ndash;ç…§é¡¾çˆ¶æ¯ï¼Œç…§é¡¾è‡ªå·±ï¼Œç…§é¡¾å¦»å­ï¼Œç…§é¡¾å„¿å¥³ã€‚æ€»æœ‰äººä¼šæ›¿å¤©è¡Œé“ï¼Œå¦‚æœä¸æ˜¯ä½ ï¼Œé‚£å°±åšå¥½è‡ªå·±ï¼Œæ•™è‚²å¥½è‡ªå·±çš„å­å¥³ï¼Œè¶³ä»¥ã€‚ä¸è¦ä¸‰å¿ƒäºŒæ„ï¼Œäº‹ç‰©å‘å±•æœ‰å…¶å¿…ç„¶è§„å¾‹ï¼Œæœ‰ç››å¿…æœ‰è¡°ï¼Œè‡ªå¤çš†å¦‚æ­¤ã€‚ç©·åˆ™ç‹¬å–„å…¶èº«ï¼Œè¾¾åˆ™å…¼æµå¤©ä¸‹ã€‚ æ²¡æœ‰å¿…è¦æŠŠè‡ªå·±å¸¦å…¥é«˜é«˜åœ¨ä¸Šçš„è§’è‰²ã€‚ä¹Ÿè®¸è‡ªå·±åˆ°äº†é‚£ä¸ªåœ°ä½ï¼Œè´ªå¾—æ›´å‡¶ã€‚çœŸå°äººå¥½è¿‡ä¼ªå›å­ï¼Œä¼ªå›å­å¾€å¾€ä¼šè¿·å¤±è‡ªå·±ï¼Œæ—¢åšä¸äº†å›å­ï¼Œåˆæˆä¸äº†å°äººã€‚ "},{"id":26,"href":"/zh/docs/life/archive/20230912/","title":"ç—…æ„ˆ æœ‰æ„Ÿ","section":"å¾€æ—¥å½’æ¡£","content":" ä¸€ä¸ªäººåªæœ‰çœŸæ­£æ„è¯†åˆ°äº‹æƒ…çš„å‘å±•ï¼Œæ˜¯è‡ªå·±çš„é”™è¯¯å¯¼è‡´ï¼Œæ‰ä¼šçœŸæ­£æ”¹è¿‡è‡ªæ–°ã€‚å¦åˆ™å°±ä¼šæ€¨å¤©å°¤äººï¼Œç”šè‡³æ©è€³ç›—é“ƒã€‚ ä¸–ç•Œä¸‡äº‹ä¸‡ç‰©ï¼Œæœ‰ä¼˜æœ‰åŠ£ã€‚åŠ£å¹¶ä¸ä»£è¡¨ç½ªæ¶ï¼Œä¸è¿‡æ˜¯äº‹ç‰©å‘å±•çš„æŸä¸ªè¿‡ç¨‹ï¼Œå¦‚åŒç”Ÿç—…çš„å¤´ç–¼è„‘çƒ­ï¼Œâ€œç°è±¡â€ï¼Œä¸è¿‡æ˜¯æé†’ä¸–äººç½¢äº†ã€‚åˆ‡å‹¿ä»¥è¿‡ç¨‹ç›–æ£ºå®šè®ºï¼Œè‡ªæš´è‡ªå¼ƒï¼ŒåŠæ—¶æ­¢æŸå³å¯ã€‚ "},{"id":27,"href":"/zh/docs/problem/Linux/20230819/","title":"Debiané—®é¢˜å¤„ç†3","section":"Linux","content":" fcitxé…åˆå„ç§è½¯ä»¶å‡ºç°çš„é—®é¢˜ # æœ¬æ–‡ç« ä¸­å‡ºç°çš„å¼•å·éƒ½æ˜¯è‹±æ–‡çŠ¶æ€ä¸‹çš„å¼•å·ï¼Œåˆ‡è®°ï¼\nå®‰è£…å®Œæ¯•åç¯å¢ƒå˜é‡è®¾ç½® # /etc/profile å’Œ/etc/enviroment å‡å¯ï¼Œprofileé’ˆå¯¹ç”¨æˆ·ï¼Œenvironmenté’ˆå¯¹ç³»ç»Ÿã€‚ä¸€èˆ¬éƒ½æ˜¯æ”¾profileé‡Œé¢\nä¸è¡Œçš„è¯ # å¦‚æœä¿®æ”¹profileæ— æ•ˆï¼Œåˆ™åœ¨/etc/enviromentæ·»åŠ ä¿®æ”¹\n#/etc/enviroment æœ«å°¾æ·»åŠ  fcitx \u0026amp; #è¿™è¡Œè¦æ·»åŠ  export XIM_PROGRAM=fcitx export XIM=fcitx export GTK_IM_MODULE=fcitx export QT_IM_MODULE=fcitx export XMODIFIERS=\u0026#34;@im=fcitx\u0026#34; export LANG=zh_CN.UTF-8 sourceåå†é‡å¯ä¸€ä¸‹å“¦\nè£…äº†zshå(ä»ç»ˆç«¯æ‰“å¼€)ideaç­‰å„ç§è½¯ä»¶ä¸å‡ºç°fcitxè¾“å…¥æ³•çš„é—®é¢˜ # åœ¨/.zshrcæœ€åæ·»åŠ \nexport XIM_PROGRAM=fcitx export XIM=fcitx export GTK_IM_MODULE=fcitx export QT_IM_MODULE=fcitx export XMODIFIERS=\u0026#34;@im=fcitx\u0026#34; export LANG=zh_CN.UTF-8 export LC_MESSAGES=en_US.UTF-8 #è®©ç»ˆç«¯æŠ¥é”™æ—¶ï¼Œæ˜¾ç¤ºè‹±æ–‡ è€Œä¸æ˜¯ä¸­æ–‡ ä¹Ÿå¯ä»¥ä¸åœ¨/.zshrcä¸­è¿½åŠ è¿™äº›ï¼Œè€Œæ˜¯ç›´æ¥è¿½åŠ  source /etc/profileæˆ–è€…/etc/enviromentå³å¯\nå¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œå°±è¦åœ¨ideaçš„é…ç½®æ–‡ä»¶idea.vmoptionsæ·»åŠ \n-Drecreate.x11.input.method=true å¦‚æœä½¿ç”¨ç³»ç»Ÿé»˜è®¤ç»ˆç«¯çš„æƒ…å†µä¸‹å‡ºçš„é—®é¢˜ # å¯ä»¥åœ¨ ~/.bashrcæœ€åæ·»åŠ è¿™æ®µè¯ï¼Œé‡å¯è¯•è¯•\nexport XIM_PROGRAM=fcitx export XIM=fcitx export GTK_IM_MODULE=fcitx export QT_IM_MODULE=fcitx export XMODIFIERS=\u0026#34;@im=fcitx\u0026#34; export LANG=zh_CN.UTF-8 å„ä¸ªæ–‡ä»¶çš„è§£é‡Š # /etc/profile //ç”¨æˆ·çº§ï¼Œæ‰€æœ‰ç”¨æˆ·ç™»é™†æ—¶æ‰ä¼šæ‰§è¡Œ å¯¹äºfcitxæ²¡æ•ˆæœ(firefoxæ— æ•ˆ)\n/etc/enviroment //ç³»ç»Ÿçº§ï¼Œä¸€èˆ¬ä¸ä¿®æ”¹ è¿™é‡Œæœ‰æ•ˆæœ\n~/.bashrc //ç³»ç»Ÿé»˜è®¤ç»ˆç«¯æ‰“å¼€æ—¶æ‰§è¡Œ ~/.zshrc //zshä½¿ç”¨å‰æ‰§è¡Œ\nsourceå‘½ä»¤æ˜¯ä¸€ä¸ªå†…ç½®çš„shellå‘½ä»¤ï¼Œç”¨äºä»å½“å‰shellä¼šè¯ä¸­çš„æ–‡ä»¶è¯»å–å’Œæ‰§è¡Œå‘½ä»¤ã€‚sourceå‘½ä»¤é€šå¸¸ç”¨äºä¿ç•™ã€æ›´æ”¹å½“å‰shellä¸­çš„ç¯å¢ƒå˜é‡ã€‚ç®€è€Œè¨€ä¹‹ï¼Œsourceä¸€ä¸ªè„šæœ¬ï¼Œå°†ä¼šåœ¨å½“å‰shellä¸­è¿è¡Œexecuteå‘½ä»¤ã€‚ sourceå‘½ä»¤å¯ç”¨äºï¼š\nåˆ·æ–°å½“å‰çš„shellç¯å¢ƒ åœ¨å½“å‰ç¯å¢ƒä½¿ç”¨sourceæ‰§è¡ŒShellè„šæœ¬ ä»è„šæœ¬ä¸­å¯¼å…¥ç¯å¢ƒä¸­ä¸€ä¸ªShellå‡½æ•° ä»å¦ä¸€ä¸ªShellè„šæœ¬ä¸­è¯»å–å˜é‡\nzshå¸è½½åè´¦å·æ— æ³•ç™»å½• # å‚è€ƒhttps://lwmfjc.github.io/2023/05/23/problem/linux/20230523/ è¿™ç¯‡æ–‡ç« \nå¦‚æœä¸æ˜¯rootç”¨æˆ·å°±ç®€å•å¤šäº†ï¼Œç›´æ¥\nvim /etc/passwd # xx(è´¦æˆ·å)......zshï¼Œä¸­/bin/zshï¼Œæ”¹ä¸º/bin/bash å³å¯ xfce4çš„å®‰è£…åŠgnomeå¸è½½ # gnomeå®Œå…¨å¸è½½\naptitude purge `dpkg --get-selections | grep gnome | cut -f 1` aptitude -f install aptitude purge `dpkg --get-selections | grep deinstall | cut -f 1` aptitude -f install xfce4å®‰è£…\nsudo apt install task-xfce-desktop è“ç‰™é—®é¢˜ # æœ€åæ˜¯è£…äº†blueman è¿æ¥è“ç‰™è€³æœºå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œä¸ºäº†è¿æ¥è£…äº†è¿™ä¸ªã€‚ä¹‹åæƒ³ç”¨æ‰¬å£°å™¨å‘ç°ç”¨ä¸äº†ï¼Œæ‹”äº†è€³æœºå¯ä»¥äº†å´å‘ç°ç ´éŸ³äº†\u0026hellip;.\næœ€åè§£å†³æ–¹æ¡ˆæ˜¯æŠŠè¿™ä¸¤ä¸ªåˆ äº†ï¼Œè€Œä¸”æ­¤æ—¶è“ç‰™è€³æœºä¹Ÿå¯ä»¥è¿ä¸Šäº†\u0026hellip;åŸå› ä¸æ˜\nå¤‡ä»½ # å¦‚æœæ˜¯vmä¸‹å­¦ä¹ linuxï¼Œè¦å¤šåˆ©ç”¨vmwareï¼Œå…»æˆä¹ æƒ¯ï¼Œæ¯è¿›è¡Œä¸€æ¬¡å¤§æ“ä½œä¹‹å‰ï¼Œéƒ½è¦è¿›è¡Œvmwareçš„å¿«ç…§å¤‡ä»½ã€‚é¿å…å¤§æ“ä½œå¯¼è‡´å‡ºé—®é¢˜\n"},{"id":28,"href":"/zh/docs/problem/Linux/20230817/","title":"Debiané—®é¢˜å¤„ç†2","section":"Linux","content":" ä»£ç† # Vmwareé‡Œé¢çš„debian,è¿æ¥å¤–é¢ç‰©ç†æœºçš„v2rayã€‚\nå¯¹äºæµè§ˆå™¨ # æ— è®ºæ˜¯firefoxè¿˜æ˜¯chromiumï¼Œéƒ½å¯ä»¥ç›´æ¥é€šè¿‡v2rayå…è®¸å±€åŸŸç½‘ï¼Œç„¶åä½¿ç”¨ProxySwitchOmegeä»£ç†è®¿é—®\nå¯¹äºå‘½ä»¤ # å¯ä»¥ä½¿ç”¨proxychainsï¼Œç›´æ¥ç”¨apt-get å®‰è£…å³å¯ï¼Œæ³¨æ„äº‹é¡¹\nä½œç”¨èŒƒå›´ # å¯¹tcpç”Ÿæ•ˆï¼Œpingæ˜¯ä¸ç”Ÿæ•ˆçš„ï¼Œä¸è¦ç™½è´¹åŠ›æ°”\néœ€è¦ä¿®æ”¹ä¸¤ä¸ªåœ°æ–¹ # libproxychains.so.3 æç¤ºä¸å­˜åœ¨ ly\nwhereis libproxychains.so.3 #libproxychains.so.3: /usr/lib/x86_64-linux-gnu/libproxychains.so.3 #ä¿®æ”¹/usr/bin/proxychains #export LD_PRELOAD = libproxychains.so.3 ä¿®æ”¹ä¸ºï¼š export LD_PRELOAD = /usr/lib/x86_64-linux-gnu/libproxychains.so.3 l\u0026rsquo;yé…ç½®ä¿®æ”¹\n#ä¿®æ”¹æ–‡ä»¶/etc/proxychains.confï¼Œåœ¨æœ€åä¸€è¡Œæ·»åŠ  socks5 192.168.1.201 1082 ä½¿ç”¨\nproxychains git pull #ç›´æ¥åœ¨å‘½ä»¤æœ€å‰é¢è¾“å…¥proxychainså³å¯ ç›´æ¥ç½‘ç»œï¼ˆguiï¼‰é…ç½®ä»£ç† # è¿™ä¸ªå¯¹äºç»ˆç«¯ä¸ç”Ÿæ•ˆ\nzshå®‰è£… # proxychains wget https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh proxychains sh install.sh zshä¸»é¢˜å®‰è£… # proxychains git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k #ä¿®æ”¹ vim ~/.zshrc ZSH_THEME=\u0026#34;powerlevel10k/powerlevel10k\u0026#34; é‡æ–°é…ç½® p10k configure\nç¨‹åºç¯å¢ƒè®¾ç½® # ç¯å¢ƒå˜é‡\n#javaç¯å¢ƒå˜é‡ export JAVA_HOME=/usr/local/jdk1.8.0_281 export CLASSPATH=$:CLASSPATH:$JAVA_HOME/lib/ export PATH=$PATH:$JAVA_HOME/bin #mavenç¯å¢ƒå˜é‡ export MAVEN_HOME=/usr/local/apache-maven-3.3.9 export PATH=$PATH:$MAVEN_HOME/bin typoraç ´è§£ # å£°æ˜ï¼šç ´è§£å¯è€»ï¼Œå°Šé‡æ­£ç‰ˆã€‚è¿™é‡Œä»…ä»¥å­¦ä¹ ä¸ºç›®çš„\næ¥è‡ªæ–‡ç«  https://ccalt.cn/2023/04/07/%5BWindows%7CLinux%5DTypora%E6%9C%80%E6%96%B0%E7%89%88%E9%80%9A%E7%94%A8%E7%A0%B4%E8%A7%A3-%E8%87%B3%E4%BB%8A%E5%8F%AF%E7%94%A8/\nç¨‹åº # https://github.com/DiamondHunters/NodeInject_Hook_example/actions/runs/4180836116\næˆ‘è‡ªå·±forkäº†ä¸€ä»½ï¼Œä¸çŸ¥é“å“ªå¤©å°±æ²¡äº†\nhttps://github.com/lwmfjc/NodeInject_Hook_example/actions/runs/5888943386\næ­¥éª¤ # å°†linuxç‰ˆæœ¬çš„æ–‡ä»¶ï¼ŒæŒ‰ä¸‹é¢çš„ç»“æ„è§£å‹æ”¾å…¥Typoraæ–‡ä»¶å¤¹ä¸­\nè¿™é‡Œç›—ï¼ˆå€Ÿï¼‰ç”¨æ–‡ç« å›¾ç‰‡è¯´æ˜ï¼Œä¸æƒ³æˆªå›¾äº†\nä¹‹åå…ˆè¿è¡Œnode_injectï¼Œåè¿è¡Œlicense-gen ï¼Œå³å¯å¾—åˆ°åºåˆ—å·\nå­—ä½“ # å¾ˆå¤šç¨‹åºéƒ½åå°ï¼Œç³»ç»Ÿå­—ä½“åŸºæœ¬æ­£å¸¸ã€‚\nfirefoxä¸­ï¼Œè¦è®¾ç½®æœ€å°å­—ä½“ã€‚ Typoræ²¡æ‰¾åˆ°ã€‚\npicgoé—®é¢˜ # æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«æ³¨æ„çš„ï¼ŒåŸºæœ¬é—®é¢˜æœç´¢å¼•æ“éƒ½æœ‰ã€‚å¯¹äº†ï¼ŒæŠŠwindowsä¸‹çš„picgoå¸è½½äº†ï¼Œåªç•™ä¸‹äº†picgo-coreï¼Œè¿˜å®‰è£…äº† super-prefixï¼Œè‡ªå®šä¹‰ä¸Šä¼ è·¯å¾„åŠæ–‡ä»¶å\nå‚è€ƒæ–‡ç«  https://connor-sun.github.io/posts/38835.html\n#è‡ªå®šä¹‰æ–‡ä»¶å¤¹åŠæ–‡ä»¶å picgo install super-prefix #super-prefixåœ°å€ https://github.com/gclove/picgo-plugin-super-prefix picgo-core é…ç½®æ‰‹å†Œ https://picgo.github.io/PicGo-Core-Doc/zh/guide/config.html\n#æ’ä»¶é…ç½® ~/.picgo/config.json ,åœ¨æ ¹ç»“æ„é‡Œé¢æ·»åŠ  \u0026#34;picgoPlugins\u0026#34;: { \u0026#34;picgo-plugin-super-prefix\u0026#34;: true }, \u0026#34;picgo-plugin-super-prefix\u0026#34;: { \u0026#34;prefixFormat\u0026#34;: \u0026#34;YYYY/MM/DD/\u0026#34;, \u0026#34;fileFormat\u0026#34;: \u0026#34;YYYYMMDD-HHmmss\u0026#34; } Typoraä¸­æ–‡ä»¶ä¸Šä¼ å¯¹picgo-coreçš„è®¾ç½® # è‡ªå®šä¹‰å‘½ä»¤æ ¼å¼ï¼špicgo uploadï¼Œwindowsä¸­å¯ä»¥ä½¿ç”¨ç»å¯¹è·¯å¾„(åŠ åŒå¼•å·)\næˆªå›¾å·¥å…· # apt install flameshot ä½¿ç”¨flameshot gui å¯åŠ¨\n"},{"id":29,"href":"/zh/docs/problem/Linux/20230815/","title":"Debiané—®é¢˜å¤„ç†1","section":"Linux","content":" æ¸…åæºè®¾ç½® # vim /etc/apt/sources.list #æ³¨é‡Šæ‰åŸæ¥çš„ï¼Œå¹¶æ·»åŠ  # é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Š deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware # deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware # deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware # deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware deb https://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware # deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware deb https://security.debian.org/debian-security bookworm-security main contrib non-free non-free-firmware # deb-src https://security.debian.org/debian-security bookworm-security main contrib non-free non-free-firmware ä¸­æ–‡ç¯å¢ƒ # su sudo apt-get install locales #é…ç½®ä¸­æ–‡ç¯å¢ƒ 1.é€‰æ‹©zhå¼€å¤´çš„ 2 åé¢é€‰æ‹©en(cnä¹Ÿè¡Œï¼Œä¸å½±å“è¾“å…¥æ³•) sudo dpkg-reconfigure locales #è®¾ç½®ä¸Šæµ·æ—¶åŒº sudo timedatectl set-timezone Asia/Shanghai ä¸­æ–‡è¾“å…¥æ³• # #æ¸…é™¤æ—§çš„ç¯å¢ƒ apt-get remove ibus #ä¸å…¼å®¹é—®é¢˜ apt-get remove fcitx5 fcitx5-chinese-addons apt-get autoremove ly # gnome-shell-extension-kimpanel sudo apt install fcitx5 fcitx5-chinese-addons fcitx5-frontend-gtk4 fcitx5-frontend-gtk3 fcitx5-frontend-gtk2 fcitx5-frontend-qt5 im-config #é…ç½®ä½¿ç”¨fcitx5 #ç¯å¢ƒå˜é‡æ·»åŠ  export XMODIFIERS=@im=fcitx export GTK_IM_MODULE=fcitx export QT_IM_MODULE=fcitx #é€€å‡ºrootç”¨æˆ·æƒé™ï¼Œä½¿ç”¨æ™®é€šç”¨æˆ·æƒé™å†ç»ˆç«¯ fcitx5-configtool #é…ç½®ä¸­æ–‡è¾“å…¥æ³•å³å¯ #é™„åŠ ç»„ä»¶-ç»å…¸ç”¨æˆ·ç•Œé¢--è¿™é‡Œå¯ä»¥ä¿®æ”¹å­—ä½“åŠå¤§å° å…¶ä»– # åº”ç”¨ç¨‹åº-ä¼˜åŒ– ä¿®æ”¹é»˜è®¤å­—ä½“å¤§å°\næ¡Œé¢ä»»åŠ¡æ \u0026ndash; https://extensions.gnome.org/extension/1160/dash-to-panel\nå‚è€ƒæ–‡ç«  https://itsfoss.com/gnome-shell-extensions/\nä¹‹åè®¾ç½®ä¸€ä¸‹ä»»åŠ¡æ çš„ä½ç½®å³å¯\nå‚è€ƒæ–‡ç«  # https://zhuanlan.zhihu.com/p/508797663\n"},{"id":30,"href":"/zh/docs/problem/Linux/20230803/","title":"å®‰å“æ‰‹æœºåŠå¹³æ¿å®‰è£…linuxDeployçš„é—®é¢˜ç®€è®°","section":"Linux","content":" ä¸ºä»€ä¹ˆæ˜¯ç®€è®°å‘¢ï¼Œå› ä¸ºè¿™å‡ å¤©æŠ˜è…¾è¿™äº›å¤ªç´¯äº†ï¼Œç­‰ä»¥åå›è¿‡å¤´æ¥é‡æ–°æ“ä½œå†è¯¦ç»†è®°è½½\nå‰è¨€ # åˆè¡· # ä¸€å¼€å§‹çš„åˆè¡·æ˜¯ä¸ºäº†åœ¨å¹³æ¿ä¸Šä½¿ç”¨ideaï¼Œä¹‹å‰çœ‹äº†ä¸€ç¯‡dockerä½¿ç”¨ideaçš„æ–‡ç« ï¼Œå¿ƒè¡€æ¥æ½®ã€‚æ‰€ä»¥æƒ³ç›´æ¥åœ¨å¹³æ¿çš„termuxå®‰è£…dockerç„¶åä½¿ç”¨ï¼Œç»“æœä¸€å †é—®é¢˜ã€‚åé¢å¦¥åäº†ï¼Œåœ¨æ‰‹æœºä¸Šè£…ï¼Œç„¶åå¼€è¿œç¨‹å§\nè¿™å¹´å¤´æœºåœ¨äººåœ¨ï¼Œæ‰€ä»¥è£…æ‰‹æœºè¿˜æ˜¯å¹³æ¿ï¼Œè¿˜çœŸæ²¡æœ‰å¾ˆå¤§çš„é—®é¢˜ã€‚åé¢ä½¿ç”¨æƒ…å†µè¯æ˜ï¼šæ‰‹æœºä¸éœ€è¦å¼€çƒ­ç‚¹çš„æƒ…å†µï¼ˆå¼€çƒ­ç‚¹æ˜¯ä¸ºäº†ä¿è¯ç½‘ç»œè”é€šï¼Œåœ¨åŒä¸€å±€åŸŸç½‘ï¼‰ï¼Œå…¶å®ä¸æ€ä¹ˆå‘çƒ­ä¹Ÿä¸æ€ä¹ˆè€—ç”µçš„ã€‚\nå¹³æ¿ä¸Š # æœ¬æ¥æƒ³åœ¨tab s8å¹³æ¿ä¸Šé€šè¿‡termuxå®‰è£…linuxï¼ˆæ— rootæƒé™ï¼‰ï¼Œä½†æ˜¯æ€»ä¼šé‡åˆ°ä¸€å †é—®é¢˜\u0026ndash;è¿ç³»ç»Ÿéƒ½è£…ä¸ä¸Šã€‚å› ä¸ºrootä¼šæœ‰ä¸¤ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥ä¸€å¼€å§‹æ²¡æœ‰è€ƒè™‘ä½¿ç”¨linuxDeployï¼ˆéœ€è¦rootï¼‰\nä¿ä¿®å¤±æ•ˆ æ— æ³•é€šè¿‡ç³»ç»Ÿç›´æ¥æ›´æ–°ï¼ˆéœ€è¦çº¿åˆ·ï¼‰ æ‰‹æœºä¸Šï¼ˆrootï¼‰ # é…ç½® # åé¢å°è¯•åœ¨rootè¿‡çš„æ‰‹æœºä¸Šå®‰è£…linuxDeployï¼Œç…§æ ·æœ‰ä¸€å †é—®é¢˜ï¼Œè¿™é‡Œé…ä¸Šèƒ½ä½¿ç”¨çš„é…ç½®ï¼ˆèƒ½è¿›ç³»ç»Ÿï¼‰ï¼š\næˆ‘ç”¨çš„æ—¶å€™sshç«¯å£æ”¹äº†ä¸€ä¸‹ï¼Œä¸è¿‡ä¸å½±å“ï¼Œç¬¬ä¸€æ¬¡ç”¨çš„22ç«¯å£ä¹Ÿæ˜¯èƒ½è¿ä¸Šçš„ã€‚åˆå§‹ç”¨æˆ·å†™çš„rootï¼Œè¿™é‡Œä¹Ÿæ˜¯è®¾ç½®çš„rootã€‚\næœ€å¥½æŒ‚è½½ä¸€ä¸‹\né—®é¢˜ # ç”¨å…¶ä»–æ¡Œé¢ç¯å¢ƒï¼Œå¯èƒ½ä¼šå¯¼è‡´å›¾æ ‡æ²¡æœ‰ï¼ˆåº”è¯¥æ˜¯å°±æ²¡æœ‰é‚£ä¸ªåº”ç”¨ï¼Œæ¯”å¦‚æµè§ˆå™¨ï¼‰ï¼Œä¸è¿‡æˆ‘è¿™ä¸ªé…ç½®å®Œä¹Ÿæ²¡æœ‰æµè§ˆå™¨ï¼Œä¸è¿‡å¥½åœ¨å›¾æ ‡ä¹Ÿæ²¡ï¼Œä¸ç”¨è‡ªå·±å†å»ç§»é™¤äº†ã€‚\nè£…å®Œä¹‹åvnsæœ‰å‡ºé”™è¿‡ä¸€æ¬¡ï¼Œçªç„¶å°±è¹¦äº†ï¼Œæ­»æ´»è¿ä¸ä¸Šã€‚åé¢æˆ‘ç›´æ¥é‡è£…ç³»ç»Ÿäº†ï¼ˆlinux deployï¼‰ï¼Œæ²¡æœ‰å†å‡ºç°é—®é¢˜ã€‚è£…å®Œä¹‹åéœ€è¦åœ¨etc/rc.localæ·»åŠ :\n#åˆ é™¤vnsä¸´æ—¶æ–‡ä»¶ï¼Œä¿è¯æ¯æ¬¡å¯åŠ¨éƒ½æ˜¯ä½¿ç”¨ç«¯å£:5901 #(linuxä¸Šæ˜¾ç¤º:1ï¼Œè¿æ¥ä½¿ç”¨æ—¶è¦+5900ï¼Œå³ä½¿ç”¨5901ç«¯å£) rm -rf /tmp/.X[1-9]-lock rm -rf /tmp/.X11-unix/X[1-9] #ä¿è¯ç³»ç»Ÿæ¯æ¬¡å¯åŠ¨åéƒ½è‡ªåŠ¨å¯åŠ¨vncserver vncserver ç”µè„‘ä¸Šéšä¾¿æ‰¾äº†ä¸ªVNCServer ç»¿è‰²å…å®‰è£…ç¨‹åºå¯ä»¥è¿ä¸Š\nå¹³æ¿ä¸Šä½¿ç”¨AVNCï¼Œç”µè„‘ä¸æ–¹ä¾¿æˆªå›¾ï¼Œå°±ä¸æˆªäº†.. ç±»ä¼¼é•¿è¿™æ ·\n#å¸¸ç”¨å‘½ä»¤(ä¹Ÿä¸å¸¸ï¼Œè¿™ä¸¤å¤©ç”¨çš„æœ€å¤šçš„) vncserver -kill :1 #å¼ºåˆ¶å…³é—­ç«¯å£1 vncserver #å¯åŠ¨ å®‰è£…ideaï¼Œä¹Ÿä¸ç”¨å®‰è£…ï¼Œå°±æ˜¯å»å®˜ç½‘ä¸‹è½½è§£å‹å³å¯ã€‚é—®é¢˜ï¼šéœ€è¦jdk11ä»¥ä¸Šæ‰èƒ½æ‰“å¼€ï¼ˆç–‘æƒ‘ï¼Œè²Œä¼¼ä¹‹å‰åœ¨windowså®‰è£…çš„æ—¶å€™æ²¡è¿™è¦æ±‚ï¼Œåæ­£åé¢æˆ‘å¦¥åäº†ï¼Œè£…äº†11ï¼Œä¹‹åå°±æ˜¯é…ç½®ç¯å¢ƒå˜é‡ä»€ä¹ˆçš„ï¼‰\nä¸€å¼€å§‹linuxDeployçš„Ubuntuï¼Œç„¶å..å‘ç°openjdk11è£…å®Œä¹‹åï¼Œjava -versionæ˜¾ç¤ºçš„10ï¼Œä¸€è„¸è’™åœˆï¼Œæå¾—åé¢åˆé‡è£…äº†Debianï¼ˆä¸­é€”è¿˜è¯•äº†centosï¼‰\nè£…å®Œæ²¡æœ‰ä¸­æ–‡è¾“å…¥æ³•ï¼Œç³»ç»Ÿè£…å®Œå°±æ˜¯è¦ç”¨çš„ï¼Œå¦‚æœéšä¾¿æ‰“æ‰“å‘½ä»¤å€’æ˜¯ä¸éœ€è¦ä¸­æ–‡è¾“å…¥æ³•ï¼Œä½†æ˜¯å¦‚æœæ‰“ç‚¹ä»£ç å†™ç‚¹æ³¨è§£ï¼Œé‚£è¹©è„šè‹±è¯­å°±\u0026hellip;æ€»ä¸èƒ½å¥å¥good good study,day day up..çœŸæ˜¯one day day de\u0026hellip;\né—®é¢˜å¤„ç† # å…¶å®è§£å†³æ–¹æ¡ˆå‰é¢å¥½åƒéƒ½è¯´äº†ï¼Œè¾“å…¥æ³•å•ç‹¬å¼€ä¸€å—å§ï¼Œæ¯”è¾ƒæ¶å¿ƒï¼Œä¸»è¦æ˜¯è®©æˆ‘æ„è¯†åˆ°äº†è‡ªå·±æ°´å¹³æœ‰å¤šèœ\u0026hellip;\næŸäº›æœºå™¨ï¼ˆå¹³æ¿ï¼‰çœç”µæ¨¡å¼ä¸‹ï¼Œé»˜è®¤çš„é‚£ä¸ªç”¨æˆ·ä¼šæ–­ç½‘ï¼ŒåŸå› ä¸æ˜ # æ‰€ä»¥é‚£ä¸ªç”¨æˆ·å°±åˆ«ç”¨äº†ï¼Œå†åˆ›å»ºä¸€ä¸ªæ–°çš„\nuseradd -d /home/ly -s /bin/bash -m ly ç„¶åè®¾ç½®ä¸‹å¯†ç \npasswd ly é…ç½®ä¸­æ–‡ç¯å¢ƒ # sudo dpkg-reconfigure locales #å‰é¢é€‰è‹±æ–‡å’Œä¸­æ–‡ï¼Œåé¢é€‰è‹±æ–‡ #è®¾ç½®æ—¶åŒº sudo timedatectl set-timezone Asia/Shanghai ä¸­æ–‡å­—ä½“å®‰è£… # apt-get install ttf-wqy-zenhei apt-get install xfonts-intl-chinese wqy* è¾“å…¥æ³•ç›¸å…³å®‰è£… # #fcitxå®‰è£… apt install fcitx -y #è¾“å…¥æ³•å®‰è£… apt install fcitx-googlepinyin fcitx-sunpinyin fcitx-pinyin #ä¸­æ–‡å­—ä½“åŒ…ï¼Œç®€ä½“ç¹ä½“ apt install fonts-arphic-bsmi00lp fonts-arphic-gbsn00lp fonts-arphic-gkai00mp apt install fcitx-table* è¾“å…¥æ³•bug # ç½‘ä¸Šä¸€å †æ•™ç¨‹ï¼Œæ‰¾äº†å¾ˆå¤šï¼Œæœ€åçš„è§£å†³æ–¹æ¡ˆ fcitx+googlepinyin\næ²¡ç”¨fcitx5å’Œsougouè¾“å…¥æ³•ï¼Œå› ä¸ºå°è¯•äº†å¾ˆå¤šæ¬¡å®åœ¨è£…ä¸ä¸Šï¼Œä¸çŸ¥é“æ˜¯arm64çš„æ¶æ„é—®é¢˜è¿˜æ˜¯ä»€ä¹ˆï¼Œè£…å®Œè€æ˜¯è¾“å…¥æ³•çŠ¶æ€æ é—ªå•Šé—ª\u0026hellip;bugï¼Ÿç„å­¦ï¼Ÿ\nè¿™ä¸ªç½‘ä¸Šéƒ½æœ‰æ•™ç¨‹ï¼ˆæŠ„è¢­ï¼‰ï¼Œå°±ä¸å†™ï¼ˆæŠ„ï¼‰äº†ã€‚å†™ä¸‹é‡è¦çš„é—®é¢˜\nè¾“å…¥æ³•åœ¨terminalç»ˆç«¯ã€ideaä¸­ä¸èƒ½åˆ‡æ¢å‡ºæ¥ã€åˆ‡æ¢åæ‰“å­—ä¸èƒ½ä¸Šå» # tabs8æ²¡æœ‰è¿™ä¸ªbugï¼Œæ‰‹æœºçš„miuiç³»ç»Ÿæœ‰è¿™ä¸ªbugï¼Œä¸çŸ¥é“ä¸ºå•¥\nè¿™ä¸ªé—®é¢˜å…¶å®åœ¨wikié‡Œé¢æœ‰è¯´åˆ°ï¼Œä¸è¿‡æˆ‘æ˜¯googleä¹‹åæ‰å®šä½åˆ°è¿™é‡Œçš„\nhttps://wiki.archlinux.org/title/fcitx\néœ€è¦ä¿®æ”¹ ~/.xinitrcæ–‡ä»¶\nfcitx \u0026amp; #add export GTK_IM_MODULE=fcitx #add export QT_IM_MODULE=fcitx #add export XMODIFIERS=@im=fcitx #add XAUTHORITY=$HOME/.Xauthority export XAUTHORITY LANG_MESSAGE=zh_CN.UTF-8 #add LANG=en_US.UTF-8 #add export LANG #add export LANG_MESSAGE #add echo $$ \u0026gt; /tmp/xsession.pid . $HOME/.xsession å…¶ä»–çš„ä¸è¦æ”¹ï¼Œå®‰è£…ç³»ç»ŸåŸæ¥æ€ä¹ˆæ ·å°±æ€ä¹ˆæ ·å°±è¡Œ\u0026hellip;\nåœ¨è¿™ä¹‹å‰ä»€ä¹ˆä¸­æ–‡å­—ä½“ã€è¿˜æœ‰åŒºåŸŸè®¾ç½®éƒ½è¦å…ˆæå®šï¼Œå‰é¢çš„è®¾ç½®é€‰æ‹©en_US.UTF-8+zh_CNæ‰€æœ‰ï¼ˆæœ‰å››äº”ä¸ªï¼‰ï¼Œåé¢çš„è®¾ç½®é€‰æ‹©ç³»ç»Ÿé»˜è®¤è¯­è¨€ï¼ˆä¸­è‹±æ–‡éƒ½å¯ï¼Œæˆ‘é€‰çš„è‹±æ–‡ï¼Œæ–¹ä¾¿æˆ‘è¿™æ ·çš„èœé¸ŸæŠ¥é”™æ—¶googleæŸ¥è§£å†³æ–¹æ¡ˆï¼Œåªèƒ½é€‰ä¸€ä¸ªï¼‰\nçªç„¶æƒ³èµ·æ¥souhupinyiné—ªå•Šé—ªå¯èƒ½è·Ÿè¿™é‡Œè®¾ç½®äº†fcitxæœ‰å…³ç³»ï¼Ÿä»¥åæœ‰ç©ºå†ç ”ç©¶\nè¿˜æœ‰è¿™ä¸ªåœ°æ–¹è¦æ”¹\nvim /etc/locale.conf #LANG=zh_CN.UTF-8 #LC_MESSAGES=en_US.UTF-8 LANG=en_US.UTF-8 LC_MESSAGES=zh_CN.UTF-8 ä¹‹å‰æˆ‘è¿˜æ”¹äº†idea.*vmoptionsçš„é…ç½®ï¼Œä¸è¿‡å¯èƒ½è·Ÿè¿™ä¸ªæ²¡æœ‰å¤ªå¤§å…³ç³»\nideaä¸­è¾“å…¥æ³•ä½ç½®ä¼šå‡ºç°åœ¨å·¦ä¸‹è§’ # çœ‹äº†fcitxå®˜æ–¹çš„issueï¼Œè¯´æ˜¯ä¸å…³å®ƒçš„äº‹\u0026hellip;.\nåšå®¢ # Obsidian # åˆ°å®˜æ–¹githubä¸‹è½½å³å¯\nhttps://github.com/obsidianmd/obsidian-releases/releases\nä¸‹è½½å…¶ä¸­ä¸€ä¸ªå°±è¡Œï¼Œä¸è¿‡éƒ½è¦ä»¥ \u0026ndash;no-sandboxæ–¹å¼æ‰èƒ½è¿è¡Œ\nè¿™æœŸé—´ä¼šæœ‰å¾ˆå¤šé—®é¢˜ï¼Œéœ€è¦å®‰è£…ä¸‹åˆ—è½¯ä»¶\napt-get install zlib1g-dev apt-get install fuse libfuse2 apt install libnss3 ./obsidian --no-sandbox #ä»¥è¿™ç§æ–¹å¼è¿è¡Œ Typora # linux çš„arm64åªå­˜åœ¨äº1.0ä»¥ä¸Šç‰ˆæœ¬ï¼Œä¼—æ‰€å‘¨çŸ¥\u0026hellip;\nä»¥ä¸‹é“¾æ¥ï¼Œä»…ä¾›å­¦ä¹ \nhttps://www.cnblogs.com/youngyajun/p/16661980.html \u0026ndash;1.0.3æœ‰æ•ˆï¼Œä¸è¿‡å›¾ç‰‡ä¸Šä¼ æœ‰ç‚¹é—®é¢˜ï¼Œç›´æ¥æ‹–æ›³è¿›å»æ˜¯èƒ½ä¸Šä¼ çš„ï¼Œå¤åˆ¶åç²˜è´´ä¸è¡Œï¼ˆ1.6å¯ä»¥ï¼Œä¸è¿‡æœªæˆæƒï¼Œä¸å¤ªå¥½å¼„ï¼‰\npythonå®‰è£…è¿‡ç¨‹ä¹ŸæŒºæ›²æŠ˜ï¼Œä¸è¦è£…python2ï¼Œç›´æ¥è£…3ã€‚pipä¹Ÿæ˜¯ç›´æ¥è£…ç‰ˆæœ¬3å³å¯ã€‚è®°å¾—ä½¿ç”¨æ¸…åæº/æˆ–è€…é˜¿é‡Œæºï¼Œè¦ä¸å¾—ä¸‹è½½åŠå¤©\npicgo # è¿™é‡Œé…åˆçš„æ˜¯picgo-coreï¼Œç”¨å®˜æ–¹æ•™ç¨‹å®‰è£…å³å¯\nç›´æ¥picgoä¸è¡Œï¼Œæ²¡æœ‰æ‰¾åˆ°å¯¹åº”å¹³å°çš„å®‰è£…åŒ…\nPicHoro # æœ€åæ”¾å¼ƒåœ¨linuxä¸Šå†™åšå®¢çš„æƒ³æ³•äº†ï¼Œå‹‰å¼ºèƒ½ç”¨ï¼Œä¸è¿‡å®åœ¨æ˜¯å‹‰å¼ºã€‚\nåé¢é‡‡ç”¨ç›´æ¥åœ¨å¹³æ¿å®‰è£…obsidian+pichoroçš„åŠæ³•\nhttps://github.com/Kuingsmile/PicHoro\nè¿˜è¡Œã€‚ä¸è¿‡2.1.2æŠ¥æ¯’ï¼Œä¸çŸ¥é“ä¸ºå•¥ï¼Œä¸‹å®Œè¢«è‡ªåŠ¨åˆ é™¤äº†ã€‚ä½¿ç”¨çš„æ˜¯2.1.1\næµè§ˆå™¨ # chromium # ç›´æ¥aptå®‰è£…å°±å¥½äº†ï¼Œè£…å®Œä¹‹åuié‚£ä¸ªå›¾æ ‡æ˜¯æ‰“ä¸å¼€çš„ï¼ŒåŒæ ·çš„é—®é¢˜ï¼Œåœ¨terminalç»ˆç«¯é‚£é‡Œï¼Œä½¿ç”¨å‘½ä»¤chromium --no-sandboxå³å¯æ‰“å¼€ã€‚æœ‰ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚æ²¡å£°éŸ³å•¦ã€ä¸€äº›pdfæ’ä»¶ï¼ˆåšå®¢çš„ï¼‰æ˜¾ç¤ºä¸å‡ºæ¥ä¹‹ç±»ã€‚ç›®å‰æ²¡éœ€æ±‚ï¼Œæš‚ä¸å¤„ç†äº†\nps: è¿˜æœ‰qçš„é—®é¢˜ï¼Œç›®å‰ä¹Ÿæ²¡éœ€æ±‚ã€‚æš‚ä¸å¤„ç†\nå‚è€ƒé“¾æ¥ # https://cloud.tencent.com/developer/article/1159972\nhttps://blog.csdn.net/qysh123/article/details/117288055\nhttps://blog.csdn.net/weixin_42122432/article/details/116703457\nhttps://www.cnblogs.com/jtianlin/p/4230527.html\nhttps://blog.csdn.net/sinat_42483341/article/details/104104441\nhttps://blog.csdn.net/ma726518972/article/details/121034994?ydreferer=aHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS8%3D\nhttps://www.cnblogs.com/shanhubei/p/17517381.html\nhttps://blog.csdn.net/sandonz/article/details/106877555\nhttps://archlinuxarm.org/packages/aarch64/vim\nhttps://bbs.archlinuxcn.org/viewtopic.php?id=12685\nhttps://soft.zol.com.cn/126/1262460.html\nhttps://bbs.archlinuxcn.org/viewtopic.php?id=10498\nhttps://wiki.archlinux.org/title/fcitx\nhttps://www.reddit.com/r/archlinux/comments/rl1ncw/fcitx_input_in_terminal_window_doesnt_work/\nhttps://stackoverflow.com/questions/20705089/why-can-not-i-use-fcitx-input-method-in-gnome-terminal\nhttps://blog.csdn.net/u011166277/article/details/106287587/\nhttps://www.reddit.com/r/swaywm/comments/t09udp/anyone_using_the_input_method_fcitx5rime_cant_get/\nhttps://github.com/fcitx/fcitx5/issues/79\nå…¶å®ä¸æ­¢è¿™äº›ï¼Œä¸è¿‡æœ‰ç”¨çš„å¯èƒ½å°±è¿™äº›\næˆæœ # ç–‘æƒ‘ # å…¶å®ç§‘å­¦è¿™ç§ä¸œè¥¿ï¼Œåœ¨ä½ ä¸ç²¾é€šçš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¼šå‡ºç°ç„è€Œåˆç„çš„äº‹ã€‚é‚£ä¼ ç»Ÿæ„ä¹‰ä¸Šæ‰€è°“çš„ç„å­¦ï¼Œæ˜¯å¦æ˜¯å› ä¸ºè‡ªå·±ä¸ç²¾é€š/å¤±ä¼ å¯¼è‡´çš„å‘¢\u0026hellip;äººç±»æ˜¯é€€åŒ–è¿˜æ˜¯è¿›åŒ–..ä¸è¿‡æœ‰ä¸€ç‚¹æ˜¯è‚¯å®šçš„ï¼Œæ‰€æœ‰çš„äº‹æƒ…éƒ½æ˜¯äººä¸ºçš„ \u0026ndash; è‡ªä½œè‡ªå—ã€‚\nç”¨windowç³»ç»Ÿæ‰“å®Œäº†è¿™ç¯‡åšå®¢çœŸçš„çˆ½ï¼Œæ²¡æœ‰å„ç§è«åå…¶å¦™çš„é—®é¢˜ã€‚æœç„¶ï¼Œè·Œåˆ°è°·åº•çš„æ—¶å€™ï¼Œæ€ä¹ˆèµ°éƒ½æ˜¯å‘ä¸Šã€‚\n"},{"id":31,"href":"/zh/docs/problem/JVM/20230526/","title":"JDKä»£ç†å’ŒCGLIBä»£ç†","section":"Jvm","content":" å®Œå…¨è½¬è½½è‡ªhttps://juejin.cn/post/7011357346018361375 ï¼Œä»¥é˜²ä¸¢å¤±æ•…ä½œå¤‡ä»½ ã€‚\nä¸€ã€ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼ # ä»£ç†æ¨¡å¼ï¼ˆProxy Patternï¼‰ç»™æŸä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æ§åˆ¶åŸå¯¹è±¡çš„å¼•ç”¨ã€‚ä»£ç†å¯¹è±¡åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´èµ·åˆ°ä¸­ä»‹ä½œç”¨ã€‚\nä»£ç†æ¨¡å¼æ˜¯å¸¸ç”¨çš„ç»“æ„å‹è®¾è®¡æ¨¡å¼ä¹‹ä¸€ï¼Œå½“ç›´æ¥è®¿é—®æŸäº›å¯¹è±¡å­˜åœ¨é—®é¢˜æ—¶å¯ä»¥é€šè¿‡ä¸€ä¸ªä»£ç†å¯¹è±¡æ¥é—´æ¥è®¿é—®ï¼Œä¸ºäº†ä¿è¯å®¢æˆ·ç«¯ä½¿ç”¨çš„é€æ˜æ€§ï¼Œæ‰€è®¿é—®çš„çœŸå®å¯¹è±¡ä¸ä»£ç†å¯¹è±¡éœ€è¦å®ç°ç›¸åŒçš„æ¥å£ã€‚ä»£ç†æ¨¡å¼å±äºç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå±äºGOF23ç§è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚\nä»£ç†æ¨¡å¼å¯ä»¥åˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ä¸¤ç§ç±»å‹ï¼Œè€ŒåŠ¨æ€ä»£ç†ä¸­åˆåˆ†ä¸ºJDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†ä¸¤ç§ã€‚ ä»£ç†æ¨¡å¼åŒ…å«å¦‚ä¸‹è§’è‰²:\nSubject (æŠ½è±¡ä¸»é¢˜è§’è‰²) æŠ½è±¡ä¸»é¢˜è§’è‰²å£°æ˜äº†çœŸå®ä¸»é¢˜å’Œä»£ç†ä¸»é¢˜çš„å…±åŒæ¥å£,è¿™æ ·ä¸€æ¥åœ¨ä»»ä½•ä½¿ç”¨çœŸå®ä¸»é¢˜ çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨ä»£ç†ä¸»é¢˜ã€‚å®¢æˆ·ç«¯éœ€è¦é’ˆå¯¹æŠ½è±¡ä¸»é¢˜è§’è‰²è¿›è¡Œç¼–ç¨‹ã€‚ Proxy (ä»£ç†ä¸»é¢˜è§’è‰²) ä»£ç†ä¸»é¢˜è§’è‰²å†…éƒ¨åŒ…å«å¯¹çœŸå®ä¸»é¢˜çš„å¼•ç”¨ï¼Œä»è€Œå¯ä»¥åœ¨ä»»ä½•æ—¶å€™æ“ä½œçœŸå®ä¸»é¢˜å¯¹è±¡ã€‚ åœ¨ä»£ç†ä¸»é¢˜è§’è‰²ä¸­æä¾›ä¸€ä¸ªä¸çœŸå®ä¸»é¢˜è§’è‰²ç›¸åŒçš„æ¥å£ï¼Œä»¥ä¾¿åœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥æ›¿ä»£çœŸå® ä¸»ä½“ã€‚ä»£ç†ä¸»é¢˜è§’è‰²è¿˜å¯ä»¥æ§åˆ¶å¯¹çœŸå®ä¸»é¢˜çš„ä½¿ç”¨ï¼Œè´Ÿè´£åœ¨éœ€è¦çš„æ—¶å€™åˆ›å»ºå’Œåˆ é™¤çœŸå®ä¸» é¢˜å¯¹è±¡,å¹¶å¯¹çœŸå®ä¸»é¢˜å¯¹è±¡çš„ä½¿ç”¨åŠ ä»¥çº¦æŸã€‚ä»£ç†è§’è‰²é€šå¸¸åœ¨å®¢æˆ·ç«¯è°ƒç”¨æ‰€å¼•ç”¨çš„çœŸå®ä¸» é¢˜æ“ä½œä¹‹å‰æˆ–ä¹‹åè¿˜éœ€è¦æ‰§è¡Œå…¶ä»–æ“ä½œï¼Œè€Œä¸ä»…ä»…æ˜¯å•çº¯çš„è°ƒç”¨çœŸå®ä¸»é¢˜å¯¹è±¡ä¸­çš„æ“ä½œã€‚ RealSubject (çœŸå®ä¸»é¢˜ è§’è‰²) çœŸå®ä¸»é¢˜è§’è‰²å®šä¹‰äº†ä»£ç†è§’è‰²æ‰€ä»£è¡¨çš„çœŸå®å¯¹è±¡ï¼Œåœ¨çœŸå®ä¸»é¢˜è§’è‰²ä¸­å®ç°äº†çœŸå®çš„ä¸š åŠ¡æ“ä½œ,å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ä»£ç†ä¸»é¢˜è§’è‰²é—´æ¥è°ƒç”¨çœŸå®ä¸»é¢˜è§’è‰²ä¸­å®šä¹‰çš„æ–¹æ³•ã€‚ ä»£ç†æ¨¡å¼çš„ä¼˜ç‚¹ # ä»£ç†æ¨¡å¼èƒ½å°†ä»£ç†å¯¹è±¡ä¸çœŸå®è¢«è°ƒç”¨çš„ç›®æ ‡å¯¹è±¡åˆ†ç¦»ã€‚ ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†ç³»ç»Ÿçš„è€¦åˆåº¦ï¼Œæ‰©å±•æ€§å¥½ã€‚ å¯ä»¥èµ·åˆ°ä¿æŠ¤ç›®æ ‡å¯¹è±¡çš„ä½œç”¨ã€‚ å¯ä»¥å¯¹ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½å¢å¼ºã€‚ ä»£ç†æ¨¡å¼çš„ç¼ºç‚¹ # ä»£ç†æ¨¡å¼ä¼šé€ æˆç³»ç»Ÿè®¾è®¡ä¸­ç±»çš„æ•°é‡å¢åŠ ã€‚ åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡å¢åŠ ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œä¼šé€ æˆè¯·æ±‚å¤„ç†é€Ÿåº¦å˜æ…¢ã€‚ äºŒã€JDKåŠ¨æ€ä»£ç† # åœ¨javaçš„åŠ¨æ€ä»£ç†æœºåˆ¶ä¸­ï¼Œæœ‰ä¸¤ä¸ªé‡è¦çš„ç±»æˆ–æ¥å£ï¼Œä¸€ä¸ªæ˜¯ InvocationHandler(Interface)ã€å¦ä¸€ä¸ªåˆ™æ˜¯ Proxy(Class)ï¼Œè¿™ä¸€ä¸ªç±»å’Œæ¥å£æ˜¯å®ç°æˆ‘ä»¬åŠ¨æ€ä»£ç†æ‰€å¿…é¡»ç”¨åˆ°çš„ã€‚\nInvocationHandler # æ¯ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»éƒ½å¿…é¡»è¦å®ç°InvocationHandlerè¿™ä¸ªæ¥å£ï¼Œå¹¶ä¸”æ¯ä¸ªä»£ç†ç±»çš„å®ä¾‹éƒ½å…³è”äº†ä¸€ä¸ªhandlerï¼Œå½“æˆ‘ä»¬é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œè¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨å°±ä¼šè¢«è½¬å‘ä¸ºç”±InvocationHandlerè¿™ä¸ªæ¥å£çš„ invoke æ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨ã€‚\nInvocationHandlerè¿™ä¸ªæ¥å£çš„å”¯ä¸€ä¸€ä¸ªæ–¹æ³• invoke æ–¹æ³•ï¼š\njava å¤åˆ¶ä»£ç Object invoke(Object proxy, Method method, Object[] args) throws Throwable è¿™ä¸ªæ–¹æ³•ä¸€å…±æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆè¿™ä¸‰ä¸ªå‚æ•°åˆ†åˆ«ä»£è¡¨å¦‚ä¸‹ï¼š\nproxy:æŒ‡ä»£JDKåŠ¨æ€ç”Ÿæˆçš„æœ€ç»ˆä»£ç†å¯¹è±¡ method:æŒ‡ä»£çš„æ˜¯æˆ‘ä»¬æ‰€è¦è°ƒç”¨çœŸå®å¯¹è±¡çš„æŸä¸ªæ–¹æ³•çš„Methodå¯¹è±¡ args:æŒ‡ä»£çš„æ˜¯è°ƒç”¨çœŸå®å¯¹è±¡æŸä¸ªæ–¹æ³•æ—¶æ¥å—çš„å‚æ•° Proxy # Proxyè¿™ä¸ªç±»çš„ä½œç”¨å°±æ˜¯ç”¨æ¥åŠ¨æ€åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡çš„ç±»ï¼Œå®ƒæä¾›äº†è®¸å¤šçš„æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨çš„æœ€å¤šçš„å°±æ˜¯newProxyInstance è¿™ä¸ªæ–¹æ³•ï¼š\njava å¤åˆ¶ä»£ç public static Object newProxyInstance(ClassLoader loader, Class\u0026lt;?\u0026gt;[] interfaces, InvocationHandler handler) throws IllegalArgumentException è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯å¾—åˆ°ä¸€ä¸ªåŠ¨æ€çš„ä»£ç†å¯¹è±¡ï¼Œå…¶æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸‰ä¸ªå‚æ•°æ‰€ä»£è¡¨çš„å«ä¹‰ï¼š\nloaderï¼šClassLoaderå¯¹è±¡ï¼Œå®šä¹‰äº†ç”±å“ªä¸ªClassLoaderæ¥å¯¹ç”Ÿæˆçš„ä»£ç†å¯¹è±¡è¿›è¡ŒåŠ è½½ï¼Œå³ä»£ç†ç±»çš„ç±»åŠ è½½å™¨ã€‚ interfacesï¼šInterfaceå¯¹è±¡çš„æ•°ç»„ï¼Œè¡¨ç¤ºçš„æ˜¯æˆ‘å°†è¦ç»™æˆ‘éœ€è¦ä»£ç†çš„å¯¹è±¡æä¾›ä¸€ç»„ä»€ä¹ˆæ¥å£ï¼Œå¦‚æœæˆ‘æä¾›äº†ä¸€ç»„æ¥å£ç»™å®ƒï¼Œé‚£ä¹ˆè¿™ä¸ªä»£ç†å¯¹è±¡å°±å®£ç§°å®ç°äº†è¯¥æ¥å£(å¤šæ€)ï¼Œè¿™æ ·æˆ‘å°±èƒ½è°ƒç”¨è¿™ç»„æ¥å£ä¸­çš„æ–¹æ³•äº†ã€‚ Handlerï¼šInvocationHandlerå¯¹è±¡ï¼Œè¡¨ç¤ºçš„æ˜¯å½“æˆ‘è¿™ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡åœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå…³è”åˆ°å“ªä¸€ä¸ªInvocationHandlerå¯¹è±¡ä¸Šã€‚ æ‰€ä»¥æˆ‘ä»¬æ‰€è¯´çš„DynamicProxyï¼ˆåŠ¨æ€ä»£ç†ç±»ï¼‰æ˜¯è¿™æ ·ä¸€ç§classï¼šå®ƒæ˜¯åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„classï¼Œåœ¨ç”Ÿæˆå®ƒæ—¶ä½ å¿…é¡»æä¾›ä¸€ç»„interfaceç»™å®ƒï¼Œç„¶åè¯¥classå°±å®£ç§°å®ƒå®ç°äº†è¿™äº› interfaceã€‚è¿™ä¸ªDynamicProxyå…¶å®å°±æ˜¯ä¸€ä¸ªProxyï¼Œå®ƒä¸ä¼šåšå®è´¨æ€§çš„å·¥ä½œï¼Œåœ¨ç”Ÿæˆå®ƒçš„å®ä¾‹æ—¶ä½ å¿…é¡»æä¾›ä¸€ä¸ªhandlerï¼Œç”±å®ƒæ¥ç®¡å®é™…çš„å·¥ä½œã€‚\nJDKåŠ¨æ€ä»£ç†å®ä¾‹ # åˆ›å»ºæ¥å£ç±»\njavaå¤åˆ¶ä»£ç public interface HelloInterface { void sayHello(); } åˆ›å»ºè¢«ä»£ç†ç±»ï¼Œå®ç°æ¥å£\njavaå¤åˆ¶ä»£ç /** * è¢«ä»£ç†ç±» */ public class HelloImpl implements HelloInterface{ @Override public void sayHello() { System.out.println(\u0026#34;hello\u0026#34;); } } åˆ›å»ºInvocationHandlerå®ç°ç±»\njavaå¤åˆ¶ä»£ç /** * æ¯æ¬¡ç”ŸæˆåŠ¨æ€ä»£ç†ç±»å¯¹è±¡æ—¶éƒ½éœ€è¦æŒ‡å®šä¸€ä¸ªå®ç°äº†InvocationHandleræ¥å£çš„è°ƒç”¨å¤„ç†å™¨å¯¹è±¡ */ public class ProxyHandler implements InvocationHandler{ private Object subject; // è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬è¦ä»£ç†çš„çœŸå®å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯çœŸæ­£æ‰§è¡Œä¸šåŠ¡é€»è¾‘çš„ç±» public ProxyHandler(Object subject) {// é€šè¿‡æ„é€ æ–¹æ³•ä¼ å…¥è¿™ä¸ªè¢«ä»£ç†å¯¹è±¡ this.subject = subject; } /** *å½“ä»£ç†å¯¹è±¡è°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œå…¶ä¼šè‡ªåŠ¨çš„è·³è½¬åˆ°ä»£ç†å¯¹è±¡å…³è”çš„handlerå¯¹è±¡çš„invokeæ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨ */ @Override public Object invoke(Object obj, Method method, Object[] objs) throws Throwable { Object result = null; System.out.println(\u0026#34;å¯ä»¥åœ¨è°ƒç”¨å®é™…æ–¹æ³•å‰åšä¸€äº›äº‹æƒ…\u0026#34;); System.out.println(\u0026#34;å½“å‰è°ƒç”¨çš„æ–¹æ³•æ˜¯\u0026#34; + method.getName()); result = method.invoke(subject, objs);// éœ€è¦æŒ‡å®šè¢«ä»£ç†å¯¹è±¡å’Œä¼ å…¥å‚æ•° System.out.println(method.getName() + \u0026#34;æ–¹æ³•çš„è¿”å›å€¼æ˜¯\u0026#34; + result); System.out.println(\u0026#34;å¯ä»¥åœ¨è°ƒç”¨å®é™…æ–¹æ³•ååšä¸€äº›äº‹æƒ…\u0026#34;); System.out.println(\u0026#34;------------------------\u0026#34;); return result;// è¿”å›methodæ–¹æ³•æ‰§è¡Œåçš„è¿”å›å€¼ } } æµ‹è¯•\njavaå¤åˆ¶ä»£ç public class Mytest { public static void main(String[] args) { //ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºè¢«ä»£ç†å¯¹è±¡ HelloImpl hello = new HelloImpl(); //ç¬¬äºŒæ­¥ï¼šåˆ›å»ºhandler,ä¼ å…¥çœŸå®å¯¹è±¡ ProxyHandler handler = new ProxyHandler(hello); //ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºä»£ç†å¯¹è±¡ï¼Œä¼ å…¥ç±»åŠ è½½å™¨ã€æ¥å£ã€handler HelloInterface helloProxy = (HelloInterface) Proxy.newProxyInstance( HelloInterface.class.getClassLoader(), new Class[]{HelloInterface.class}, handler); //ç¬¬å››æ­¥ï¼šè°ƒç”¨æ–¹æ³• helloProxy.sayHello(); } } ç»“æœ\nmarkdownå¤åˆ¶ä»£ç å¯ä»¥åœ¨è°ƒç”¨å®é™…æ–¹æ³•å‰åšä¸€äº›äº‹æƒ… å½“å‰è°ƒç”¨çš„æ–¹æ³•æ˜¯sayHello hello sayHelloæ–¹æ³•çš„è¿”å›å€¼æ˜¯null å¯ä»¥åœ¨è°ƒç”¨å®é™…æ–¹æ³•ååšä¸€äº›äº‹æƒ… ------------------------ JDKåŠ¨æ€ä»£ç†æ­¥éª¤ # JDKåŠ¨æ€ä»£ç†åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š\næ‹¿åˆ°è¢«ä»£ç†å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶ä¸”é€šè¿‡åå°„è·å–åˆ°å®ƒçš„æ‰€æœ‰çš„æ¥å£ã€‚ é€šè¿‡JDK Proxyç±»é‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„ç±»ï¼ŒåŒæ—¶æ–°çš„ç±»è¦å®ç°è¢«ä»£ç†ç±»æ‰€å®ç°çš„æ‰€æœ‰çš„æ¥å£ã€‚ åŠ¨æ€ç”Ÿæˆ Java ä»£ç ï¼ŒæŠŠæ–°åŠ çš„ä¸šåŠ¡é€»è¾‘æ–¹æ³•ç”±ä¸€å®šçš„é€»è¾‘ä»£ç å»è°ƒç”¨ã€‚ ç¼–è¯‘æ–°ç”Ÿæˆçš„ Java ä»£ç .classã€‚ å°†æ–°ç”Ÿæˆçš„Classæ–‡ä»¶é‡æ–°åŠ è½½åˆ° JVM ä¸­è¿è¡Œã€‚ æ‰€ä»¥è¯´JDKåŠ¨æ€ä»£ç†çš„æ ¸å¿ƒæ˜¯é€šè¿‡é‡å†™è¢«ä»£ç†å¯¹è±¡æ‰€å®ç°çš„æ¥å£ä¸­çš„æ–¹æ³•æ¥é‡æ–°ç”Ÿæˆä»£ç†ç±»æ¥å®ç°çš„ï¼Œé‚£ä¹ˆå‡å¦‚è¢«ä»£ç†å¯¹è±¡æ²¡æœ‰å®ç°æ¥å£å‘¢ï¼Ÿé‚£ä¹ˆè¿™æ—¶å€™å°±éœ€è¦CGLIBåŠ¨æ€ä»£ç†äº†ã€‚\nä¸‰ã€CGLIBåŠ¨æ€ä»£ç† # JDKåŠ¨æ€ä»£ç†æ˜¯é€šè¿‡é‡å†™è¢«ä»£ç†å¯¹è±¡å®ç°çš„æ¥å£ä¸­çš„æ–¹æ³•æ¥å®ç°ï¼Œè€ŒCGLIBæ˜¯é€šè¿‡ç»§æ‰¿è¢«ä»£ç†å¯¹è±¡æ¥å®ç°ï¼Œå’ŒJDKåŠ¨æ€ä»£ç†éœ€è¦å®ç°æŒ‡å®šæ¥å£ä¸€æ ·ï¼ŒCGLIBä¹Ÿè¦æ±‚ä»£ç†å¯¹è±¡å¿…é¡»è¦å®ç°MethodInterceptoræ¥å£ï¼Œå¹¶é‡å†™å…¶å”¯ä¸€çš„æ–¹æ³•interceptã€‚\nCGLibé‡‡ç”¨äº†éå¸¸åº•å±‚çš„å­—èŠ‚ç æŠ€æœ¯ï¼Œå…¶åŸç†æ˜¯é€šè¿‡å­—èŠ‚ç æŠ€æœ¯ä¸ºä¸€ä¸ªç±»åˆ›å»ºå­ç±»ï¼Œå¹¶åœ¨å­ç±»ä¸­é‡‡ç”¨æ–¹æ³•æ‹¦æˆªçš„æŠ€æœ¯æ‹¦æˆªæ‰€æœ‰çˆ¶ç±»æ–¹æ³•çš„è°ƒç”¨ï¼Œé¡ºåŠ¿ç»‡å…¥æ¨ªåˆ‡é€»è¾‘ã€‚ï¼ˆåˆ©ç”¨ASMå¼€æºåŒ…ï¼Œå¯¹ä»£ç†å¯¹è±¡ç±»çš„classæ–‡ä»¶åŠ è½½è¿›æ¥ï¼Œé€šè¿‡ä¿®æ”¹å…¶å­—èŠ‚ç ç”Ÿæˆå­ç±»æ¥å¤„ç†ï¼‰\næ³¨æ„ï¼šå› ä¸ºCGLIBæ˜¯é€šè¿‡ç»§æ‰¿ç›®æ ‡ç±»æ¥é‡å†™å…¶æ–¹æ³•æ¥å®ç°çš„ï¼Œæ•…è€Œå¦‚æœæ˜¯finalå’Œprivateæ–¹æ³•åˆ™æ— æ³•è¢«é‡å†™ï¼Œä¹Ÿå°±æ˜¯æ— æ³•è¢«ä»£ç†ã€‚\nxmlå¤åˆ¶ä»£ç \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;cglib\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;cglib-nodep\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; CGLibæ ¸å¿ƒç±» # 1ã€ net.sf.cglib.proxy.Enhancerï¼šä¸»è¦å¢å¼ºç±»ï¼Œé€šè¿‡å­—èŠ‚ç æŠ€æœ¯åŠ¨æ€åˆ›å»ºå§”æ‰˜ç±»çš„å­ç±»å®ä¾‹ï¼›\nEnhancerå¯èƒ½æ˜¯CGLIBä¸­æœ€å¸¸ç”¨çš„ä¸€ä¸ªç±»ï¼Œå’ŒJava1.3åŠ¨æ€ä»£ç†ä¸­å¼•å…¥çš„Proxyç±»å·®ä¸å¤šã€‚å’ŒProxyä¸åŒçš„æ˜¯ï¼ŒEnhanceræ—¢èƒ½å¤Ÿä»£ç†æ™®é€šçš„classï¼Œä¹Ÿèƒ½å¤Ÿä»£ç†æ¥å£ã€‚Enhanceråˆ›å»ºä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡çš„å­ç±»å¹¶ä¸”æ‹¦æˆªæ‰€æœ‰çš„æ–¹æ³•è°ƒç”¨ï¼ˆåŒ…æ‹¬ä»Objectä¸­ç»§æ‰¿çš„toStringå’ŒhashCodeæ–¹æ³•ï¼‰ã€‚Enhancerä¸èƒ½å¤Ÿæ‹¦æˆªfinalæ–¹æ³•ï¼Œä¾‹å¦‚Object.getClass()æ–¹æ³•ï¼Œè¿™æ˜¯ç”±äºJava finalæ–¹æ³•è¯­ä¹‰å†³å®šçš„ã€‚åŸºäºåŒæ ·çš„é“ç†ï¼ŒEnhancerä¹Ÿä¸èƒ½å¯¹fianlç±»è¿›è¡Œä»£ç†æ“ä½œã€‚è¿™ä¹Ÿæ˜¯Hibernateä¸ºä»€ä¹ˆä¸èƒ½æŒä¹…åŒ–final classçš„åŸå› ã€‚\n2ã€net.sf.cglib.proxy.MethodInterceptorï¼šå¸¸ç”¨çš„æ–¹æ³•æ‹¦æˆªå™¨æ¥å£ï¼Œéœ€è¦å®ç°interceptæ–¹æ³•ï¼Œå®ç°å…·ä½“æ‹¦æˆªå¤„ç†ï¼›\njavaå¤åˆ¶ä»£ç  public java.lang.Object intercept(java.lang.Object obj, java.lang.reflect.Method method, java.lang.Object[] args, MethodProxy proxy) throws java.lang.Throwable{} objï¼šåŠ¨æ€ç”Ÿæˆçš„ä»£ç†å¯¹è±¡ method:å®é™…è°ƒç”¨çš„æ–¹æ³• argsï¼šè°ƒç”¨æ–¹æ³•å…¥å‚ net.sf.cglib.proxy.MethodProxyï¼šjava Methodç±»çš„ä»£ç†ç±»ï¼Œå¯ä»¥å®ç°å§”æ‰˜ç±»å¯¹è±¡çš„æ–¹æ³•çš„è°ƒç”¨ï¼›å¸¸ç”¨æ–¹æ³•ï¼šmethodProxy.invokeSuper(proxy, args)ï¼›åœ¨æ‹¦æˆªæ–¹æ³•å†…å¯ä»¥è°ƒç”¨å¤šæ¬¡ã€‚ CGLibä»£ç†å®ä¾‹ # åˆ›å»ºè¢«ä»£ç†ç±»\njavaå¤åˆ¶ä»£ç public class SayHello { public void say(){ System.out.println(\u0026#34;hello\u0026#34;); } } åˆ›å»ºä»£ç†ç±»\njavaå¤åˆ¶ä»£ç /** *ä»£ç†ç±» */ public class ProxyCglib implements MethodInterceptor{ private Enhancer enhancer = new Enhancer(); public Object getProxy(Class clazz){ //è®¾ç½®éœ€è¦åˆ›å»ºå­ç±»çš„ç±» enhancer.setSuperclass(clazz); enhancer.setCallback(this); //é€šè¿‡å­—èŠ‚ç æŠ€æœ¯åŠ¨æ€åˆ›å»ºå­ç±»å®ä¾‹ return enhancer.create(); } //å®ç°MethodInterceptoræ¥å£æ–¹æ³• public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable { System.out.println(\u0026#34;å¯ä»¥åœ¨è°ƒç”¨å®é™…æ–¹æ³•å‰åšä¸€äº›äº‹æƒ…\u0026#34;); //é€šè¿‡ä»£ç†ç±»è°ƒç”¨çˆ¶ç±»ä¸­çš„æ–¹æ³• Object result = proxy.invokeSuper(obj, args); System.out.println(\u0026#34;å¯ä»¥åœ¨è°ƒç”¨å®é™…æ–¹æ³•ååšä¸€äº›äº‹æƒ…\u0026#34;); return result; } } æµ‹è¯•\njavaå¤åˆ¶ä»£ç public class Mytest { public static void main(String[] args) { ProxyCglib proxy = new ProxyCglib(); //é€šè¿‡ç”Ÿæˆå­ç±»çš„æ–¹å¼åˆ›å»ºä»£ç†ç±» SayHello proxyImp = (SayHello)proxy.getProxy(SayHello.class); proxyImp.say(); } } ç»“æœ\nå¤åˆ¶ä»£ç å¯ä»¥åœ¨è°ƒç”¨å®é™…æ–¹æ³•å‰åšä¸€äº›äº‹æƒ… hello å¯ä»¥åœ¨è°ƒç”¨å®é™…æ–¹æ³•ååšä¸€äº›äº‹æƒ… CGLIBåŠ¨æ€ä»£ç†å®ç°åˆ†æ # CGLibåŠ¨æ€ä»£ç†é‡‡ç”¨äº†FastClassæœºåˆ¶ï¼Œå…¶åˆ†åˆ«ä¸ºä»£ç†ç±»å’Œè¢«ä»£ç†ç±»å„ç”Ÿæˆä¸€ä¸ªFastClassï¼Œè¿™ä¸ªFastClassç±»ä¼šä¸ºä»£ç†ç±»æˆ–è¢«ä»£ç†ç±»çš„æ–¹æ³•åˆ†é…ä¸€ä¸ª index(intç±»å‹)ã€‚è¿™ä¸ªindexå½“åšä¸€ä¸ªå…¥å‚ï¼ŒFastClass å°±å¯ä»¥ç›´æ¥å®šä½è¦è°ƒç”¨çš„æ–¹æ³•ç›´æ¥è¿›è¡Œè°ƒç”¨ï¼Œè¿™æ ·çœå»äº†åå°„è°ƒç”¨ï¼Œæ‰€ä»¥è°ƒç”¨æ•ˆç‡æ¯” JDK åŠ¨æ€ä»£ç†é€šè¿‡åå°„è°ƒç”¨æ›´é«˜ã€‚\nä½†æ˜¯æˆ‘ä»¬çœ‹ä¸Šé¢çš„æºç ä¹Ÿå¯ä»¥æ˜æ˜¾çœ‹åˆ°ï¼ŒJDKåŠ¨æ€ä»£ç†åªç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼Œè€ŒCGLIBç”Ÿæˆäº†ä¸‰ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥ç”Ÿæˆä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ä¼šæ›´å¤æ‚ã€‚\nå››ã€JDKå’ŒCGLibåŠ¨æ€ä»£ç†å¯¹æ¯” # JDK åŠ¨æ€ä»£ç†æ˜¯å®ç°äº†è¢«ä»£ç†å¯¹è±¡æ‰€å®ç°çš„æ¥å£ï¼ŒCGLibæ˜¯ç»§æ‰¿äº†è¢«ä»£ç†å¯¹è±¡ã€‚ JDKå’ŒCGLib éƒ½æ˜¯åœ¨è¿è¡ŒæœŸç”Ÿæˆå­—èŠ‚ç ,JDKæ˜¯ç›´æ¥å†™Classå­—èŠ‚ç ï¼ŒCGLib ä½¿ç”¨ ASM æ¡†æ¶å†™Classå­—èŠ‚ç ï¼ŒCglibä»£ç†å®ç°æ›´å¤æ‚ï¼Œç”Ÿæˆä»£ç†ç±»çš„æ•ˆç‡æ¯”JDKä»£ç†ä½ã€‚\nJDK è°ƒç”¨ä»£ç†æ–¹æ³•ï¼Œæ˜¯é€šè¿‡åå°„æœºåˆ¶è°ƒç”¨,CGLib æ˜¯é€šè¿‡FastClassæœºåˆ¶ç›´æ¥è°ƒç”¨æ–¹æ³•,CGLib æ‰§è¡Œæ•ˆç‡æ›´é«˜ã€‚\nåŸç†åŒºåˆ«ï¼š # javaåŠ¨æ€ä»£ç†æ˜¯åˆ©ç”¨åå°„æœºåˆ¶ç”Ÿæˆä¸€ä¸ªå®ç°ä»£ç†æ¥å£çš„åŒ¿åç±»ï¼Œåœ¨è°ƒç”¨å…·ä½“æ–¹æ³•å‰è°ƒç”¨InvokeHandleræ¥å¤„ç†ã€‚æ ¸å¿ƒæ˜¯å®ç°InvocationHandleræ¥å£ï¼Œä½¿ç”¨invoke()æ–¹æ³•è¿›è¡Œé¢å‘åˆ‡é¢çš„å¤„ç†ï¼Œè°ƒç”¨ç›¸åº”çš„é€šçŸ¥ã€‚\nè€ŒcglibåŠ¨æ€ä»£ç†æ˜¯åˆ©ç”¨asmå¼€æºåŒ…ï¼Œå¯¹ä»£ç†å¯¹è±¡ç±»çš„classæ–‡ä»¶åŠ è½½è¿›æ¥ï¼Œé€šè¿‡ä¿®æ”¹å…¶å­—èŠ‚ç ç”Ÿæˆå­ç±»æ¥å¤„ç†ã€‚æ ¸å¿ƒæ˜¯å®ç°MethodInterceptoræ¥å£ï¼Œä½¿ç”¨intercept()æ–¹æ³•è¿›è¡Œé¢å‘åˆ‡é¢çš„å¤„ç†ï¼Œè°ƒç”¨ç›¸åº”çš„é€šçŸ¥ã€‚\n1ã€å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šé‡‡ç”¨JDKçš„åŠ¨æ€ä»£ç†å®ç°AOP\n2ã€å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œå¯ä»¥å¼ºåˆ¶ä½¿ç”¨CGLIBå®ç°AOP\n3ã€å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°äº†æ¥å£ï¼Œå¿…é¡»é‡‡ç”¨CGLIBåº“ï¼Œspringä¼šè‡ªåŠ¨åœ¨JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä¹‹é—´è½¬æ¢\næ€§èƒ½åŒºåˆ«ï¼š # 1ã€CGLibåº•å±‚é‡‡ç”¨ASMå­—èŠ‚ç ç”Ÿæˆæ¡†æ¶ï¼Œä½¿ç”¨å­—èŠ‚ç æŠ€æœ¯ç”Ÿæˆä»£ç†ç±»ï¼Œåœ¨jdk6ä¹‹å‰æ¯”ä½¿ç”¨Javaåå°„æ•ˆç‡è¦é«˜ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCGLibä¸èƒ½å¯¹å£°æ˜ä¸ºfinalçš„æ–¹æ³•è¿›è¡Œä»£ç†ï¼Œå› ä¸ºCGLibåŸç†æ˜¯åŠ¨æ€ç”Ÿæˆè¢«ä»£ç†ç±»çš„å­ç±»ã€‚\n2ã€åœ¨jdk6ã€jdk7ã€jdk8é€æ­¥å¯¹JDKåŠ¨æ€ä»£ç†ä¼˜åŒ–ä¹‹åï¼Œåœ¨è°ƒç”¨æ¬¡æ•°è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼ŒJDKä»£ç†æ•ˆç‡é«˜äºCGLIBä»£ç†æ•ˆç‡ï¼Œåªæœ‰å½“è¿›è¡Œå¤§é‡è°ƒç”¨çš„æ—¶å€™ï¼Œjdk6å’Œjdk7æ¯”CGLIBä»£ç†æ•ˆç‡ä½ä¸€ç‚¹ï¼Œä½†æ˜¯åˆ°jdk8çš„æ—¶å€™ï¼Œjdkä»£ç†æ•ˆç‡é«˜äºCGLIBä»£ç†ã€‚\nå„è‡ªå±€é™ï¼š # 1ã€JDKçš„åŠ¨æ€ä»£ç†æœºåˆ¶åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»ï¼Œè€Œä¸èƒ½å®ç°æ¥å£çš„ç±»å°±ä¸èƒ½å®ç°JDKçš„åŠ¨æ€ä»£ç†ã€‚\n2ã€cglibæ˜¯é’ˆå¯¹ç±»æ¥å®ç°ä»£ç†çš„ï¼Œä»–çš„åŸç†æ˜¯å¯¹æŒ‡å®šçš„ç›®æ ‡ç±»ç”Ÿæˆä¸€ä¸ªå­ç±»ï¼Œå¹¶è¦†ç›–å…¶ä¸­æ–¹æ³•å®ç°å¢å¼ºï¼Œä½†å› ä¸ºé‡‡ç”¨çš„æ˜¯ç»§æ‰¿ï¼Œæ‰€ä»¥ä¸èƒ½å¯¹finalä¿®é¥°çš„ç±»è¿›è¡Œä»£ç†ã€‚\nç±»å‹ æœºåˆ¶ å›è°ƒæ–¹å¼ é€‚ç”¨åœºæ™¯ æ•ˆç‡ JDKåŠ¨æ€ä»£ç† å§”æ‰˜æœºåˆ¶ï¼Œä»£ç†ç±»å’Œç›®æ ‡ç±»éƒ½å®ç°äº†åŒæ ·çš„æ¥å£ï¼ŒInvocationHandleræŒæœ‰ç›®æ ‡ç±»ï¼Œä»£ç†ç±»å§”æ‰˜InvocationHandlerå»è°ƒç”¨ç›®æ ‡ç±»çš„åŸå§‹æ–¹æ³• åå°„ ç›®æ ‡ç±»æ˜¯æ¥å£ç±» æ•ˆç‡ç“¶é¢ˆåœ¨åå°„è°ƒç”¨ç¨æ…¢ CGLIBåŠ¨æ€ä»£ç† ç»§æ‰¿æœºåˆ¶ï¼Œä»£ç†ç±»ç»§æ‰¿äº†ç›®æ ‡ç±»å¹¶é‡å†™äº†ç›®æ ‡æ–¹æ³•ï¼Œé€šè¿‡å›è°ƒå‡½æ•°MethodInterceptorè°ƒç”¨çˆ¶ç±»æ–¹æ³•æ‰§è¡ŒåŸå§‹é€»è¾‘ é€šè¿‡FastClassæ–¹æ³•ç´¢å¼•è°ƒç”¨ éæ¥å£ç±»ã€éfinalç±»ï¼Œéfinalæ–¹æ³• ç¬¬ä¸€æ¬¡è°ƒç”¨å› ä¸ºè¦ç”Ÿæˆå¤šä¸ªClasså¯¹è±¡ï¼Œæ¯”JDKæ–¹å¼æ…¢ã€‚å¤šæ¬¡è°ƒç”¨å› ä¸ºæœ‰æ–¹æ³•ç´¢å¼•æ¯”åå°„å¿«ï¼Œå¦‚æœæ–¹æ³•è¿‡å¤šï¼Œswitch caseè¿‡å¤šå…¶æ•ˆç‡è¿˜éœ€æµ‹è¯• äº”ã€é™æ€ä»£ç†å’ŒåŠ¨æ€çš„æœ¬è´¨åŒºåˆ« # é™æ€ä»£ç†åªèƒ½é€šè¿‡æ‰‹åŠ¨å®Œæˆä»£ç†æ“ä½œï¼Œå¦‚æœè¢«ä»£ç†ç±»å¢åŠ æ–°çš„æ–¹æ³•ï¼Œä»£ç†ç±»éœ€è¦åŒæ­¥æ–°å¢ï¼Œè¿èƒŒå¼€é—­åŸåˆ™ã€‚ åŠ¨æ€ä»£ç†é‡‡ç”¨åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç çš„æ–¹å¼ï¼Œå–æ¶ˆäº†å¯¹è¢«ä»£ç†ç±»çš„æ‰©å±•é™åˆ¶ï¼Œéµå¾ªå¼€é—­åŸåˆ™ã€‚ è‹¥åŠ¨æ€ä»£ç†è¦å¯¹ç›®æ ‡ç±»çš„å¢å¼ºé€»è¾‘æ‰©å±•ï¼Œç»“åˆç­–ç•¥æ¨¡å¼ï¼Œåªéœ€è¦æ–°å¢ç­–ç•¥ç±»ä¾¿å¯å®Œæˆï¼Œæ— éœ€ä¿®æ”¹ä»£ç†ç±»çš„ä»£ç ã€‚ ä½œè€…ï¼šycf é“¾æ¥ï¼šhttps://juejin.cn/post/7011357346018361375 æ¥æºï¼šç¨€åœŸæ˜é‡‘ è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚\n"},{"id":32,"href":"/zh/docs/study/JVM/understanding_the_jvm/03/","title":"03åƒåœ¾æ”¶é›†å™¨ä¸å†…å­˜åˆ†é…ç­–ç•¥","section":"_æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº_","content":" å­¦ä¹ ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ï¼Œæ„Ÿè°¢ä½œè€…ï¼\nä»£ç æ¸…å•3-9 -XX:MaxTenuringThreshod=1è¯´æ˜ # Eden[8M] Survivor1[1M] Survivor2[1M] Old {10M} åˆå§‹ allocation1[0.25M]ï¼Œallocation2[4MB] 3æ‰§è¡Œæ—¶gcå¯¼è‡´çš„å˜åŒ– +allocation1[0.25M] +allocation2[4MB] 3æ‰§è¡Œå +allocation3[4MB] +allocation1[0.25M] +allocation2[4MB] 5æ‰§è¡Œæ—¶gcå¯¼è‡´çš„å˜åŒ– allocation2[4MB]ï¼Œ+allocation1[0.25M] 5æ‰§è¡Œå +allocation3[4MB] allocation2[4MB]ï¼Œ+allocation1[0.25M] ä»£ç æ¸…å•3-9 -XX:MaxTenuringThreshod=15è¯´æ˜ # Eden[8M] Survivor1[1M] Survivor2[1M] Old {10M} åˆå§‹ allocation1[0.25M]ï¼Œallocation2[4MB] 3æ‰§è¡Œæ—¶gcå¯¼è‡´çš„å˜åŒ– +allocation1[0.25M] +allocation2[4MB] 3æ‰§è¡Œå +allocation3[4MB] +allocation1[0.25M] +allocation2[4MB] 5æ‰§è¡Œæ—¶gcå¯¼è‡´çš„å˜åŒ– +allocation1[0.25M] allocation2[4MB] 5æ‰§è¡Œå +allocation3[4MB] +allocation1[0.25M] allocation2[4MB]ï¼Œ+allocation1[0.25M] ä»£ç æ¸…å•3-10 è¯´æ˜ # Eden[8M] Survivor1[1M] Survivor2[1M] Old {10M} åˆå§‹ allocation1[0.25M]ï¼Œallocation2[[0.25M]ï¼Œallocation3[4M] 4æ‰§è¡Œæ—¶gcå¯¼è‡´çš„å˜åŒ– +allocation1[0.25M]ï¼Œ+allocation2[[0.25M]ï¼Œ +allocation3[4MB] 4æ‰§è¡Œå +allocation4[4MB] +allocation1[0.25M]ï¼Œ+allocation2[[0.25M]ï¼Œ +allocation3[4MB] 6æ‰§è¡Œæ—¶gcå¯¼è‡´çš„å˜åŒ– allocation3[4MB]ï¼Œ+allocation1[0.25M]ï¼Œ+allocation2[[0.25M]ï¼Œ 6æ‰§è¡Œå +allocation4[4MB] allocation3[4MB]ï¼Œ+allocation1[0.25M]ï¼Œ+allocation2[[0.25M]ï¼Œ ä»£ç æ¸…å•3-11 è¯´æ˜ # -XX:-HandlePromotionFailure å…³ # Eden[8M] Survivor1[1M] Survivor2[1M] Old {10M} åˆå§‹ allocation1[2M]ï¼Œallocation2[2M]ï¼Œallocation3[2M]allocation1[null]ï¼Œallocation4[2M] 5æ‰§è¡Œæ—¶gcå¯¼è‡´çš„å˜åŒ– +allocation2[2M]ï¼Œ+allocation3[2M] //æ€»å…±4M 5æ‰§è¡Œå +allocation4[2M] +allocation2[2M]ï¼Œ+allocation3[2M] //æ€»å…±4M 6-\u0026gt;11 allocation4[2M]+allocation5[2M]ï¼Œ+allocation6[2M] allocation2[2M]ï¼Œallocation3[2M] //æ€»å…±4Mï¼Œæ­¤æ—¶è€å¹´ä»£è¿ç»­å¯ç”¨ç©ºé—´åœ¨6Mï¼ˆæˆ–è€…è¯´å°äº6Mï¼‰ 11æ‰§è¡Œæ—¶gcå¯¼è‡´çš„å˜åŒ– allocation3[4MB]ï¼Œ+allocation1[0.25M]ï¼Œ+allocation2[[0.25M]ï¼Œ 11æ‰§è¡Œå +allocation7[2MB] allocation3[4MB]ï¼Œ+allocation1[0.25M]ï¼Œ+allocation2[[0.25M]ï¼Œ è¯´æ˜ # ä¹¦ç±ç‰ˆæƒå½’è‘—è€…å’Œå‡ºç‰ˆç¤¾æ‰€æœ‰\næœ¬PDFæ¥è‡ªäºå„ä¸ªå¹¿æ³›çš„ä¿¡æ¯å¹³å°ï¼Œç»è¿‡æ•´ç†è€Œæˆ\næœ¬PDFä»…é™ç”¨äºéå•†ä¸šç”¨é€”æˆ–è€…ä¸ªäººäº¤æµç ”ç©¶å­¦ä¹ ä½¿ç”¨\næœ¬PDFè·å¾—è€…ä¸å¾—åœ¨äº’è”ç½‘ä¸Šä»¥ä»»ä½•ç›®çš„è¿›è¡Œä¼ æ’­ï¼Œè¿è§„è€…é€ æˆçš„æ³•å¾‹è´£ä»»å’Œåæœï¼Œè¿è§„è€…è‡ªè´Ÿ\nå¦‚æœè§‰å¾—ä¹¦ç±å†…å®¹å¾ˆèµï¼Œè¯·ä¸€å®šè´­ä¹°æ­£ç‰ˆå®ä½“ä¹¦ï¼Œå¤šå¤šæ”¯æŒç¼–å†™é«˜è´¨é‡çš„å›¾ä¹¦çš„ä½œè€…å’Œç›¸åº”çš„å‡ºç‰ˆç¤¾!å½“ç„¶ï¼Œå¦‚æœå›¾ä¹¦å†…å®¹ä¸å ªå…¥ç›®ï¼Œè´¨é‡ä½ä¸‹ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©ç‹ ç‹ æ»´æ’•è£‚æœ¬PDF\næŠ€æœ¯ç±»ä¹¦ç±æ˜¯æ‹¿æ¥è·å–çŸ¥è¯†çš„ï¼Œä¸æ˜¯æ‹¿æ¥æ”¶è—çš„ï¼Œä½ å¾—åˆ°äº†ä¹¦ç±ä¸æ„å‘³ç€ä½ å¾—åˆ°äº†çŸ¥è¯†ï¼Œæ‰€ä»¥è¯·ä¸è¦å¾—åˆ°ä¹¦ç±åå°±è§‰å¾—æ²¾æ²¾è‡ªå–œï¼Œè¦ç»å¸¸ç¿»é˜…!!ç»å¸¸ç¿»é˜…\nè¯·äºä¸‹è½½PDFå24å°æ—¶å†…ç ”ç©¶ä½¿ç”¨å¹¶åˆ æ‰æœ¬PDF\n"},{"id":33,"href":"/zh/docs/problem/JVM/2023052302/","title":"linuxä¸­è°ƒè¯•open jdk","section":"Jvm","content":" å®Œå…¨è½¬è½½è‡ªhttps://lin1997.github.io/2020/07/19/debug-openjdk-on-ubuntu.html ï¼Œä»¥é˜²ä¸¢å¤±æ•…ä½œå¤‡ä»½ï¼Œç›®å‰è¿˜æ²¡çœ‹æ‡‚ã€‚\nåœ¨Ubuntuä¸­ç¼–è¯‘å’Œè°ƒè¯•OpenJDK # OpenJDK\nUbuntu\nCLion\n2020å¹´ 07æœˆ19æ—¥\næ„å»ºç¼–è¯‘ç¯å¢ƒ # å®‰è£…GCCç¼–è¯‘å™¨ï¼š\nsudo apt install build-essential å®‰è£…OpenJDKä¾èµ–åº“ï¼š\nå·¥å…· åº“åç§° å®‰è£…å‘½ä»¤ FreeType The FreeType Project sudo apt install libfreetype6-dev CUPS Common UNIX Printing System sudo apt install libcups2-dev X11 X Window System sudo apt install libx11-dev libxext-dev libxrender-dev libxrandr-dev libxtst-dev libxt-dev ALSA Advanced Linux Sound Architecture sudo apt install libasound2-dev libffi Portable Foreign Function Interface sudo apt install libffi-dev Autoconf Extensible Package of M4 Macros sudo apt install autoconf zip/unzip unzip sudo apt install zip unzip fontconfig fontconfig sudo apt install libfontconfig1-dev å‡è®¾è¦ç¼–è¯‘å¤§ç‰ˆæœ¬å·ä¸ºNçš„JDKï¼Œæˆ‘ä»¬è¿˜è¦å®‰è£…ä¸€ä¸ªå¤§ç‰ˆæœ¬å·è‡³å°‘ä¸ºN-1çš„ã€å·²ç»ç¼–è¯‘å¥½çš„JDKä½œä¸ºâ€œBootstrap JDKâ€ï¼š\nsudo apt install openjdk-11-jdk è·å–æºç  # å¯ä»¥ç›´æ¥è®¿é—®å‡†å¤‡ä¸‹è½½çš„JDKç‰ˆæœ¬çš„ä»“åº“é¡µé¢ï¼ˆè­¬å¦‚æœ¬ä¾‹ä¸­OpenJDK 11çš„é¡µé¢ä¸ºhttps://hg.openjdk.java.net/jdk-updates/jdk11u/ï¼‰ï¼Œç„¶åç‚¹å‡»å·¦è¾¹èœå•ä¸­çš„â€œBrowseâ€ï¼Œå†ç‚¹å‡»å·¦è¾¹çš„â€œzipâ€é“¾æ¥å³å¯ä¸‹è½½å½“å‰ç‰ˆæœ¬æ‰“åŒ…å¥½çš„æºç ï¼Œåˆ°æœ¬åœ°ç›´æ¥è§£å‹å³å¯ã€‚\nä¹Ÿå¯ä»¥ä»Githubçš„é•œåƒRepositoriesä¸­è·å–ï¼ˆhttps://github.com/openjdkï¼‰ï¼Œè¿›å…¥æ‰€éœ€ç‰ˆæœ¬çš„JDKçš„é¡µé¢ï¼Œç‚¹å‡»CloneæŒ‰é’®ä¸‹çš„Download ZIPæŒ‰é’®ä¸‹è½½æ‰“åŒ…å¥½çš„æºç ï¼Œåˆ°æœ¬åœ°ç›´æ¥è§£å‹å³å¯ã€‚\nè¿›è¡Œç¼–è¯‘ # é¦–å…ˆè¿›å…¥è§£å‹åçš„æºä»£ç ç›®å½•ï¼Œæœ¬ä¾‹è§£å‹åˆ°çš„ç›®å½•ä¸º~/openjdk/ï¼š\ncd ~/openjdk è¦æƒ³å¸¦ç€è°ƒè¯•ã€å®šåˆ¶åŒ–çš„ç›®çš„å»ç¼–è¯‘ï¼Œå°±è¦ä½¿ç”¨OpenJDKæä¾›çš„ç¼–è¯‘å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨bash configure --helpæŸ¥çœ‹. æœ¬ä¾‹è¦ç¼–è¯‘SlowDebugç‰ˆã€ä»…å«Serveræ¨¡å¼çš„HotSpotè™šæ‹Ÿæœºï¼ŒåŒæ—¶æˆ‘ä»¬è¿˜å¯ä»¥ç¦æ­¢å‹ç¼©ç”Ÿæˆçš„è°ƒè¯•ç¬¦å·ä¿¡æ¯ï¼Œæ–¹ä¾¿gdbè°ƒè¯•è·å–å½“å‰æ­£åœ¨æ‰§è¡Œçš„æºä»£ç å’Œè¡Œå·ç­‰è°ƒè¯•ä¿¡æ¯. å¯¹åº”å‘½ä»¤å¦‚ä¸‹ï¼š\nbash configure --with-debug-level=slowdebug --with-jvm-variants=server --disable-zip-debug-info å¯¹äºç‰ˆæœ¬è¾ƒä½çš„OpenJDKï¼Œç¼–è¯‘è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°äº†æºç deprecatedçš„é”™è¯¯ï¼Œè¿™æ˜¯å› ä¸º\u0026gt;=2.24ç‰ˆæœ¬çš„glibcä¸­ ï¼Œreaddir_rç­‰æ–¹æ³•è¢«æ ‡è®°ä¸ºdeprecatedã€‚è‹¥è¯»è€…ä¹Ÿå‡ºç°äº†è¯¥é—®é¢˜ï¼Œè¯·åœ¨configureå‘½ä»¤åŠ ä¸Š--disable-warnings-as-errorså‚æ•°ï¼Œå¦‚ä¸‹ï¼š\nbash configure --with-debug-level=slowdebug --with-jvm-variants=server --disable-zip-debug-info --disable-warnings-as-errors æ­¤å¤–ï¼Œè‹¥è¦é‡æ–°ç¼–è¯‘ï¼Œè¯·å…ˆæ‰§è¡Œmake dist-clean\næ‰§è¡Œmakeå‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼š\nmake ç”Ÿæˆçš„JDKåœ¨build/é…ç½®åç§°/jdkä¸­ï¼Œæµ‹è¯•ä¸€ä¸‹ï¼Œå¦‚ï¼š\ncd build/linux-x86_64-normal-server-slowdebug/jdk/bin ./java -version ç”ŸæˆCompilation Database # CLionå¯ä»¥é€šè¿‡Compilation Databaseæ¥å¯¼å…¥é¡¹ç›®. åœ¨OpenJDK 11uåŠä¹‹åç‰ˆæœ¬ä¸­ï¼ŒOpenJDKå®˜æ–¹æä¾›äº†å¯¹äºIDEçš„æ”¯æŒï¼Œå¯ä»¥ä½¿ç”¨make compile-commandså‘½ä»¤ç”ŸæˆCompilation Databaseï¼š\nmake compile-commands å¯¹äºç‰ˆæœ¬è¾ƒä½çš„OpenJDKï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›å·¥å…·æ¥ç”ŸæˆCompilation Databaseï¼Œæ¯”å¦‚ï¼š\nBear scan-build compiled ç„¶åæ£€æŸ¥ä¸€ä¸‹build/é…ç½®åç§°/ä¸‹æ˜¯å¦ç”Ÿæˆäº†compile_commands.json.\ncd build/linux-x86_64-normal-server-slowdebug ls -l å¯¼å…¥é¡¹ç›®è‡³CLion # ä¼˜åŒ–CLionç´¢å¼•é€Ÿåº¦ # æé«˜Inotifyç›‘è§†æ–‡ä»¶å¥æŸ„ä¸Šé™ï¼Œä»¥ä¼˜åŒ–CLionç´¢å¼•é€Ÿåº¦ï¼š\nåœ¨/etc/sysctl.confä¸­æˆ– /etc/sysctl.d/ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª*.confæ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\nfs.inotify.max_user_watches = 524288 åº”ç”¨æ›´æ”¹ï¼š\nsudo sysctl -p --system é‡æ–°å¯åŠ¨CLion\nå¯¼å…¥é¡¹ç›® # æ‰“å¼€CLionï¼Œé€‰æ‹©Open Or Importï¼Œé€‰æ‹©ä¸Šæ–‡ç”Ÿæˆçš„build/é…ç½®åç§°/compile_commands.jsonæ–‡ä»¶ï¼Œå¼¹å‡ºæ¡†é€‰æ‹©Open as Projectï¼Œç­‰å¾…æ–‡ä»¶ç´¢å¼•å®Œæˆ.\næ¥ç€ï¼Œä¿®æ”¹é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œé€šè¿‡Tools -\u0026gt; Compilation Database -\u0026gt; Change Project RootåŠŸèƒ½ï¼Œé€‰ä¸­ä½ çš„æºç ç›®å½•.\nä¸ºäº†å‡å°‘CLionç´¢å¼•æ–‡ä»¶æ•°ï¼Œæé«˜CLionæ•ˆç‡ï¼Œå»ºè®®å°†éå¿…è¦çš„æ–‡ä»¶å¤¹æ’é™¤ï¼šMark Directory as -\u0026gt; Excluded. å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦ç´¢å¼•ä»¥ä¸‹æ–‡ä»¶å¤¹ä¸‹çš„æºç ï¼š\nsrc/hotspot src/java.base é…ç½®è°ƒè¯•é€‰é¡¹ # åˆ›å»ºè‡ªå®šä¹‰Build Target # ç‚¹å‡»Fileèœå•æ ï¼ŒSettings -\u0026gt; Build, Execution, Deployment -\u0026gt; Custom Build Targetsï¼Œç‚¹å‡»+æ–°å»ºä¸€ä¸ªTargetï¼Œé…ç½®å¦‚ä¸‹ï¼š\nNameï¼šTargetçš„åå­—ï¼Œä¹‹ååœ¨åˆ›å»ºRun/Debugé…ç½®çš„æ—¶å€™ä¼šçœ‹åˆ°è¿™ä¸ªåå­—\nç‚¹å‡»Buildæˆ–è€…Cleanå³è¾¹çš„ä¸‰ç‚¹ï¼Œå¼¹å‡ºæ¡†ä¸­ç‚¹å‡»+æ–°å»ºä¸¤ä¸ªExternal Toolé…ç½®å¦‚ä¸‹ï¼š\n# ç¬¬ä¸€ä¸ªé…ç½®å¦‚ä¸‹ï¼Œç”¨æ¥æŒ‡å®šæ„å»ºæŒ‡ä»¤ # Program å’Œ Arguments å…±åŒæ„æˆäº†æ‰€è¦æ‰§è¡Œçš„å‘½ä»¤ \u0026#34;make\u0026#34; Name: make Program: make Arguments: Working directory: {é¡¹ç›®çš„æ ¹ç›®å½•} # ç¬¬äºŒä¸ªé…ç½®å¦‚ä¸‹ï¼Œç”¨æ¥æ¸…ç†æ„å»ºè¾“å‡º # Program å’Œ Arguments å…±åŒæ„æˆäº†æ‰€è¦æ‰§è¡Œçš„å‘½ä»¤ \u0026#34;make clean\u0026#34; Name: make clean Program: make Arguments: clean Working directory: {é¡¹ç›®çš„æ ¹ç›®å½•} ToolChainé€‰æ‹©Defaultï¼›Buildé€‰æ‹©makeï¼ˆä¸Šé¢åˆ›å»ºçš„ç¬¬ä¸€ä¸ªExternal Toolï¼‰ï¼›Cleané€‰æ‹©make cleanï¼ˆä¸Šé¢åˆ›å»ºçš„ç¬¬äºŒä¸ªExternal Toolï¼‰\nåˆ›å»ºè‡ªå®šä¹‰çš„Run/Debug configuration # ç‚¹å‡»Runèœå•æ ï¼ŒEdit Configurationsï¼Œ ç‚¹å‡»+ï¼Œé€‰æ‹©Custom Build Applicationï¼Œé…ç½®å¦‚ä¸‹ï¼š\n# Executable å’Œ Program arguments å¯ä»¥æ ¹æ®éœ€è¦è°ƒè¯•çš„ä¿¡æ¯è‡ªè¡Œé€‰æ‹© # Nameï¼šConfigure çš„åç§° Name: OpenJDK # Targetï¼šé€‰æ‹©ä¸Šä¸€æ­¥åˆ›å»ºçš„ â€œCustom Build Targetâ€ Target: {ä¸Šä¸€æ­¥åˆ›å»ºçš„ â€œCustom Build Targetâ€} # Executableï¼šç¨‹åºæ‰§è¡Œå…¥å£ï¼Œä¹Ÿå°±æ˜¯éœ€è¦è°ƒè¯•çš„ç¨‹åº Executable: è¿™é‡Œæˆ‘ä»¬è°ƒè¯•`java`ï¼Œé€‰æ‹©`{source_root}/build/{build_name}/jdk/bin/java`ã€‚ # Program arguments: ä¸ â€œExecutableâ€ é…åˆä½¿ç”¨ï¼ŒæŒ‡å®šå…¶å‚æ•° Program arguments: è¿™é‡Œæˆ‘ä»¬é€‰æ‹©`-version`ï¼Œç®€å•æ‰“å°ä¸€ä¸‹`java`ç‰ˆæœ¬ã€‚ # Before luanchï¼šè¿™ä¸ªä¸‹é¢çš„Buildå¯å»å¯ä¸å»ï¼Œå»æ‰å°±ä¸ä¼šæ¯æ¬¡æ‰§è¡Œéƒ½å»Buildï¼ŒèŠ‚çœæ—¶é—´ï¼Œä½†å…¶å®OpenJDKå¢é‡ç¼–è¯‘çš„æ–¹å¼ï¼Œæ¯æ¬¡Buildéƒ½å¾ˆå¿«ï¼Œæ‰€ä»¥å°±çœ‹ä¸ªäººé€‰æ‹©äº†ã€‚ é…ç½®GDB # ç”±äºHotSpot JVMå†…éƒ¨ä½¿ç”¨äº†SEGVç­‰ä¿¡å·æ¥å®ç°ä¸€äº›åŠŸèƒ½ï¼ˆå¦‚NullPointerExceptionã€safepointsç­‰ï¼‰ï¼Œæ‰€ä»¥è°ƒè¯•è¿‡ç¨‹ä¸­ï¼ŒGDBå¯èƒ½ä¼šè¯¯æŠ¥Signal: SIGSEGV (Segmentation fault). è§£å†³åŠæ³•æ˜¯ï¼Œåœ¨ç”¨æˆ·ç›®å½•ä¸‹åˆ›å»º.gdbinitï¼Œè®©GDBæ•è·SEGVç­‰ä¿¡å·ï¼š\nvi ~/.gdbinit å°†ä»¥ä¸‹å†…å®¹è¿½åŠ åˆ°æ–‡ä»¶ä¸­å¹¶ä¿å­˜ï¼š\nhandle SIGSEGV nostop noprint pass å¼€å§‹è°ƒè¯• # ä½¿ç”¨CLionè°ƒè¯•C++å±‚é¢çš„ä»£ç  # å®Œæˆä»¥ä¸Šé…ç½®ä¹‹åï¼Œä¸€ä¸ªå¯ä¿®æ”¹ã€ç¼–è¯‘ã€è°ƒè¯•çš„HotSpotå·¥ç¨‹å°±å®Œå…¨å»ºç«‹èµ·æ¥äº†ã€‚HotSpotè™šæ‹Ÿæœºå¯åŠ¨å™¨çš„æ‰§è¡Œå…¥å£æ˜¯${source_root}/src/java.base/share/native/libjli/java.cçš„JavaMain()æ–¹æ³•ï¼Œè¯»è€…å¯ä»¥è®¾ç½®æ–­ç‚¹åç‚¹å‡»Debugå¯å¼€å§‹è°ƒè¯•.\nä½¿ç”¨GDBè°ƒè¯•æ±‡ç¼–å±‚é¢çš„ä»£ç  # è¿™é‡Œæä¾›ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨-XX:StopInterpreterAt=\u0026lt;n\u0026gt;è™šæ‹Ÿæœºå‚æ•°æ¥å®ç°ä¸­æ–­ï¼Œç¼ºç‚¹æ˜¯éœ€è¦æ‰¾åˆ°ä½ æ‰€æ„Ÿå…´è¶£çš„å­—èŠ‚ç åœ¨ç¨‹åºä¸­çš„åºå·ï¼›ç¬¬äºŒä¸ªæ–¹æ³•æ˜¯ç›´æ¥å»å¯»æ‰¾è®°å½•ç”Ÿæˆçš„æœºå™¨æŒ‡ä»¤çš„å…¥å£(EntryPoint)çš„è¡¨ï¼Œå³Interpreter::_normal_tableï¼Œåœ¨å¯¹åº”çš„å­—èŠ‚ç å…¥å£åœ°å€æ‰“æ–­ç‚¹ï¼Œä½†æ˜¯è¿™éœ€è¦è¯»è€…å¯¹æ¨¡æ¿è§£é‡Šå™¨æœ‰ä¸€å®šäº†è§£ã€‚\nä½¿ç”¨è™šæ‹Ÿæœºå‚æ•°è¿›è¡Œä¸­æ–­ # å¯¹äºæ±‡ç¼–çº§åˆ«çš„è°ƒè¯•ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ä½¿ç”¨GDBè¿›è¡Œè°ƒè¯•ï¼š\ngdb build/linux-x86_64-normal-server-slowdebug/jdk/bin/java ç”±äºç›®å‰HotSpotåœ¨ä¸»æµçš„æ“ä½œç³»ç»Ÿä¸Šï¼Œéƒ½é‡‡ç”¨æ¨¡æ¿è§£é‡Šå™¨æ¥æ‰§è¡Œå­—èŠ‚ç ï¼Œå®ƒä¸å³æ—¶ç¼–è¯‘å™¨ä¸€æ ·ï¼Œæœ€ç»ˆæ‰§è¡Œçš„æ±‡ç¼–ä»£ç éƒ½æ˜¯è¿è¡ŒæœŸé—´äº§ç”Ÿçš„ï¼Œæ— æ³•ç›´æ¥è®¾ç½®æ–­ç‚¹ï¼Œæ‰€ä»¥HotSpotå¢åŠ äº†ä¸€äº›å‚æ•°æ¥æ–¹ä¾¿å¼€å‘äººå‘˜è°ƒè¯•è§£é‡Šå™¨ã€‚\næˆ‘ä»¬å¯ä»¥å…ˆä½¿ç”¨å‚æ•°-XX:+TraceBytecodesï¼Œæ‰“å°å¹¶æ‰¾å‡ºä½ æ‰€æ„Ÿå…´è¶£çš„å­—èŠ‚ç ä½ç½®ï¼Œä¸­é€”å¯ä»¥ä½¿ç”¨Ctrl + Cé€€å‡ºï¼š\nset args -XX:+TraceBytecodes run ç„¶åï¼Œå†ä½¿ç”¨å‚æ•°-XX:StopInterpreterAt=\u0026lt;n\u0026gt;ï¼Œå½“é‡åˆ°ç¨‹åºçš„ç¬¬næ¡å­—èŠ‚ç æŒ‡ä»¤æ—¶ï¼Œä¾¿ä¼šè¿›å…¥${source_root}/src/os/linux/vm/os_linux.cppä¸­çš„ç©ºå‡½æ•°breakpoint()ï¼š\nset args -XX:+TraceBytecodes -XX:StopInterpreterAt=\u0026lt;n\u0026gt; å†é€šè¿‡GDBåœ¨${source_root}/src/hotspot/os/linux/os_linux.cppä¸­çš„breakpoint()å‡½æ•°ä¸Šæ‰“ä¸Šæ–­ç‚¹:\nbreak breakpoint ä¸ºä»€ä¹ˆè¦å°†æ–­ç‚¹æ‰“åœ¨è¿™é‡Œï¼Ÿ\nå»çœ‹${source_root}/src/hotspot/share/interpreter/templateInterpreterGenerator.cppé‡Œï¼Œå‡½æ•°TemplateInterpreterGenerator::generate_and_dispatchä¸­å¯¹stop_interpreter_at()çš„è°ƒç”¨å°±çŸ¥é“äº†.\næ¥ç€æˆ‘ä»¬å¼€å§‹è¿è¡Œhotspotï¼š\nrun å½“å‘½ä¸­æ–­ç‚¹æ—¶ï¼Œæˆ‘ä»¬å†è·³å‡ºbreakpoint()å‡½æ•°ï¼š\nfinish è¿™æ ·å°±ä¼šè¿”å›åˆ°çœŸæ­£çš„å­—èŠ‚ç çš„æ‰§è¡Œäº†ã€‚\nä¸è¿‡ï¼Œæˆ‘ä»¬è¿˜è¦è·³è¿‡å‡½æ•°TemplateInterpreterGenerator::generate_and_dispatchä¸­æ’å…¥åˆ°å­—èŠ‚ç çœŸæ­£é€»è¾‘å‰çš„ä¸€äº›ç”¨äºdebugçš„é€»è¾‘ï¼š\nif (PrintBytecodeHistogram) histogram_bytecode(t); // debugging code if (CountBytecodes || TraceBytecodes || StopInterpreterAt \u0026gt; 0) count_bytecode(); if (PrintBytecodePairHistogram) histogram_bytecode_pair(t); if (TraceBytecodes) trace_bytecode(t); if (StopInterpreterAt \u0026gt; 0) stop_interpreter_at(); æ¯”å¦‚å¼€å¯äº†å‚æ•°-XX:+TraceBytecodeså’Œ-XX:StopInterpreterAt=\u0026lt;n\u0026gt;ï¼Œåº”è¯¥è·³è¿‡çš„æŒ‡ä»¤å¦‚ä¸‹ï¼š\n# count_bytecode()å¯¹åº”æŒ‡ä»¤: 0x7fffe07e8261:\tincl 0x16901039(%rip) # 0x7ffff70e92a0 \u0026lt;BytecodeCounter::_counter_value\u0026gt; # trace_bytecode(t)å¯¹åº”æŒ‡ä»¤: 0x7fffe07e8267:\tmov %rsp,%r12 0x7fffe07e826a:\tand $0xfffffffffffffff0,%rsp 0x7fffe07e826e:\tcallq 0x7fffe07c5edf 0x7fffe07e8273:\tmov %r12,%rsp 0x7fffe07e8276:\txor %r12,%r12 # stop_interpreter_at()å¯¹åº”æŒ‡ä»¤: 0x7fffe07e8279:\tcmpl $0x66,0x1690101d(%rip) # 0x7ffff70e92a0 \u0026lt;BytecodeCounter::_counter_value\u0026gt; 0x7fffe07e8283:\tjne 0x7fffe07e828e 0x7fffe07e8289:\tcallq 0x7ffff606281a \u0026lt;os::breakpoint()\u0026gt; #\t......................... #\t......çœŸæ­£çš„å­—èŠ‚ç é€»è¾‘...... #\t......................... # dispatch_epilog(tos_out, step)å¯¹åº”æŒ‡ä»¤ï¼Œç”¨æ¥å–ä¸‹ä¸€æ¡æŒ‡ä»¤æ‰§è¡Œ... è¿›å…¥çœŸæ­£çš„å­—èŠ‚ç é€»è¾‘åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æŒ‡ä»¤çº§åˆ«çš„stepi, nextiå‘½ä»¤æ¥è¿›è¡Œè·Ÿè¸ªè°ƒè¯•äº†ã€‚ï¼ˆç”±äºæ±‡ç¼–ä»£ç éƒ½æ˜¯è¿è¡ŒæœŸäº§ç”Ÿçš„ï¼ŒGDBä¸­æ²¡æœ‰ä¸æºä»£ç çš„å¯¹åº”ç¬¦å·ä¿¡æ¯ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨C++æºç è¡Œçº§å‘½ä»¤stepä»¥åŠnextï¼‰\nå¯»æ‰¾å­—èŠ‚ç æœºå™¨æŒ‡ä»¤çš„å…¥å£æ‰‹åŠ¨æ‰“æ–­ç‚¹ # å…³äºæ¨¡æ¿è§£é‡Šå™¨ç›¸å…³çŸ¥è¯†ï¼Œå¯ä»¥é˜…è¯»ï¼šJVMä¹‹æ¨¡æ¿è§£é‡Šå™¨.\nè¿˜æ˜¯ä¸€æ ·ï¼Œè¿è¡ŒGDBï¼š\ngdb build/linux-x86_64-normal-server-slowdebug/jdk/bin/java start break JavaMain continue æˆ‘ä»¬å…ˆåœ¨${source_root}/src/hotspot/share/interpreter/templateInterpreter.cppçš„DispatchTable::set_entry(...)å‡½æ•°ä¸Šæ‰“æ¡ä»¶æ–­ç‚¹ï¼Œæ¡ä»¶æ˜¯å‡½æ•°å®å‚i == \u0026lt;å­—èŠ‚ç å¯¹åº”åå…­è¿›åˆ¶\u0026gt;ï¼Œå­—èŠ‚ç å¯¹åº”çš„åå…­è¿›åˆ¶è§ï¼š${source_root}/src/hotspot/share/interpreter/bytecodes.hppçš„Bytecodes::Code.\nbreak DispatchTable::set_entry if i==\u0026lt;å­—èŠ‚ç å¯¹åº”åå…­è¿›åˆ¶\u0026gt; ç„¶åç»§ç»­è¿è¡Œ\ncontinue å‘½ä¸­æ–­ç‚¹åï¼ŒæŸ¥çœ‹å‡½æ•°å®å‚entryæ‰€æŒ‡å‘çš„å†…å­˜åœ°å€\nprint entry åœ¨è¿™ä¸ªåœ°å€ä¸Šæ‰“æ–­ç‚¹ã€‚\nbreak *\u0026lt;å†…å­˜åœ°å€\u0026gt; ç„¶åç»§ç»­è¿è¡Œ\ncontinue å‘½ä¸­æ–­ç‚¹åï¼Œå°±è·Ÿå‰ä¸€ä¸ªæ–¹æ³•ä¸€æ ·å¯ä»¥ç›´æ¥ä½¿ç”¨æŒ‡ä»¤çº§åˆ«çš„stepi, nextiå‘½ä»¤æ¥è¿›è¡Œè·Ÿè¸ªè°ƒè¯•äº†ã€‚\né…ç½®IDEA # ä¸ºé¡¹ç›®çš„ç»‘å®šJDKæºç è·¯å¾„ # æ‰“å¼€IDEAï¼Œæ–°å»ºä¸€ä¸ªé¡¹ç›®ã€‚ç„¶åé€‰æ‹©File -\u0026gt; Project Structureï¼Œé€‰åˆ°SDKsé€‰é¡¹ï¼Œæ–°æ·»åŠ ä¸Šè‡ªå·±åˆšåˆšç¼–è¯‘ç”Ÿæˆçš„JDKï¼ŒJDK home pathä¸º${source_root}/build/é…ç½®åç§°/jdk. ç„¶ååœ¨Sourcepathä¸‹ç§»é™¤åŸæœ¬çš„æºç è·¯å¾„ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œå¹¶æ·»åŠ ä¸ºå‰é¢çš„æºä»£ç ï¼Œå¦‚${source_root}/src/java.base/share/classesç­‰. è¿™æ ·ä»¥æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨IDEAä¸­ç¼–è¾‘JDKçš„JAVAä»£ç ï¼Œæ·»åŠ è‡ªå·±çš„æ³¨é‡Šäº†ã€‚\né‡æ–°ç¼–è¯‘JDKçš„JAVAä»£ç  # åœ¨æ·»åŠ ä¸­æ–‡æ³¨é‡Šåï¼Œå†ç¼–è¯‘JDKæ—¶ä¼šæŠ¥é”™ï¼š\nerror: unmappable character (0x??) for encoding ascii\næˆ‘ä»¬å¯ä»¥åœ¨${source_root}/make/common/SetupJavaCompilers.gmkä¸­ï¼Œä¿®æ”¹ä¸¤å¤„ç¼–ç æ–¹å¼çš„è®¾ç½®ï¼Œæ›¿æ¢åŸå†…å®¹ï¼š\n-encoding ascii ä¸ºï¼š\n-encoding utf-8 è¿™æ ·ç¼–è¯‘å°±ä¸ä¼šæŠ¥é”™äº†ã€‚\nè€Œä¸”ï¼Œå¦‚æœæˆ‘ä»¬åªä¿®æ”¹äº†JAVAä»£ç ï¼Œæ— éœ€ä½¿ç”¨makeå‘½ä»¤é‡æ–°ç¼–è¯‘æ•´ä¸ªOpenJDKï¼Œè€Œåªéœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä»…ç¼–è¯‘JAVAæ¨¡å—ï¼š\nmake java ä½¿ç”¨IDEAçš„Step Intoè·Ÿè¸ªè°ƒè¯•æºç  # æˆ‘ä»¬å‘ç°ï¼Œåœ¨IDEAè°ƒè¯•JDKæºç æ—¶ï¼Œæ— æ³•ä½¿ç”¨Step Into(F7)è·Ÿè¿›JDKä¸­çš„ç›¸å…³å‡½æ•°ï¼Œè¿™æ˜¯å› ä¸ºIDEAé»˜è®¤è®¾ç½®ä¸æ­¥å…¥è¿™äº›å†…ç½®çš„æºç ã€‚å¯ä»¥åœ¨File -\u0026gt; Settings -\u0026gt; Build, Execution, Deployment -\u0026gt; Debugger -\u0026gt; Steppingä¸­ï¼Œå–æ¶ˆå‹¾é€‰Do not step into the classesæ¥å–æ¶ˆé™åˆ¶ã€‚\nå‚è€ƒæ–‡ç«  # Tips \u0026amp; Tricks: Develop OpenJDK in CLion with Pleasure OpenJDK ç¼–è¯‘è°ƒè¯•æŒ‡å—(Ubuntu 16.04 + MacOS 10.15) JVM-åœ¨MacOSç³»ç»Ÿä¸Šä½¿ç”¨CLionç¼–è¯‘å¹¶è°ƒè¯•OpenJDK12 æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼šJVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ(ç¬¬3ç‰ˆ) ç¼–è¯‘JDKæºç è¸©å‘çºªå® How to to debug the HotSpot interpreter JVMä¹‹æ¨¡æ¿è§£é‡Šå™¨ "},{"id":34,"href":"/zh/docs/problem/Linux/20230523/","title":"zshå¸è½½årootæ— æ³•ç™»å½•åŠvmæ‰©å®¹centos7æŠ¥é”™å¤„ç†","section":"Linux","content":" zshå¸è½½årootæ— æ³•ç™»å½• # ä¸»è¦å‚è€ƒæ–‡æ¡£ https://blog.csdn.net/Scoful/article/details/119746150\né‡å¯ï¼Œå¼€æœºå¼•å¯¼è¿›å…¥ä¸‹é¢çš„é‚£ä¸ªï¼ŒæŒ‰eè¿›å…¥ç¼–è¾‘æ¨¡å¼ ç§»åŠ¨å…‰æ ‡ï¼Œæ‰¾åˆ°ro crashkernel=autoï¼Œä¿®æ”¹ä¸º rw init=sysroot/bin/sh\næŒ‰ctrl+xè¿›å…¥å•ç”¨æˆ·æ¨¡å¼ç•Œé¢\nè¾“å…¥chroot /sysroot è·å–æƒé™ vim /etc/passwd ç¬¬ä¸€è¡Œ ï¼Œroot \u0026hellip;\u0026hellip;zshï¼Œä¸­/bin/zshï¼Œæ”¹ä¸º/bin/bash ç”¨touch /.autorelabelæ›´æ–°SELinuxä¿¡æ¯ ä¸¤æ¬¡exit æ¨å‡ºchroot reboot é‡å¯ï¼šéœ€è¦ä¸€å®šæ—¶é—´ï¼Œè€å¿ƒç­‰å¾… vmæ‰©å®¹centos7 # è¿™é‡Œæ˜¯å› ä¸ºæˆ‘åœ¨vmæ‰‹åŠ¨æ‰©å®¹åï¼Œè¿›å…¥centos7ç³»ç»Ÿ\u0026mdash;ç”¨äº† å¯è§†åŒ–ç•Œé¢ä¸­çš„diskè½¯ä»¶ç›´æ¥æ‰©å®¹ï¼Œå‘ç”Ÿé”™è¯¯ï¼ˆå…·ä½“é”™è¯¯æˆ‘æ²¡æ³¨æ„ï¼Œä¸€é—ªè€Œè¿‡äº†ï¼‰ï¼Œåé¢å‘¢æˆ‘å†ä½¿ç”¨å‘½ä»¤resize2fs /dev/sda3çš„æ—¶å€™ï¼Œå‘ç°æ€»æ˜¯æç¤º busy\nè§£å†³åŠæ³• # æŒ‰ç…§ä¸Šé¢çš„åŠæ³•ï¼Œè¿›å…¥åˆ°ç¬¬3æ­¥ç»“æŸä¹‹åï¼ˆæŒ‰ctrl+xè¿›å…¥å•ç”¨æˆ·æ¨¡å¼ç•Œé¢ è¦åšï¼‰\nè¾“å…¥ umount /dev/sda3 è¿›è¡Œå¸è½½\nç„¶åè¾“å…¥ä¸‹é¢è¿›è¡Œä¿®å¤ï¼ˆæä¸ºé‡è¦ï¼‰ï¼Œç„¶åå‡ºç°é—®é¢˜æ˜¯å¦ä¿®å¤ä¸€ç›´æŒ‰\u0026rsquo;y\u0026rsquo;å³å¯\nxfs_repair /dev/sda4 æ³¨ï¼šå¦‚æœä½ å½“å‰æ–‡ä»¶ç³»ç»Ÿæ˜¯ext4ï¼Œå¯ä»¥æ‰§è¡Œfsck.ext4 /dev/sda4 ç„¶åè¾“å…¥ mount /dev/sda3 / è¿›è¡ŒæŒ‚è½½ï¼ˆè¿™æ­¥å¯èƒ½ä¸éœ€è¦ï¼‰\næœ€å reboot é‡å¯ é‡å¯ä¹‹åï¼Œå†æ‰§è¡Œ resize2fs /dev/sda3 å³å¯\n"},{"id":35,"href":"/zh/docs/problem/Hexo/01/","title":"hexoåœ¨çº¿æŸ¥çœ‹pdf","section":"Hexo","content":" åœºæ™¯ # ç”±äºåœ¨çœ‹ã€Šmysqlæ˜¯å¦‚ä½•è¿è¡Œçš„ã€‹ï¼Œåšmdæ–‡ä»¶ç¬”è®°æ—¶ï¼Œå‘ç°å¥½å¤šéƒ½æ˜¯æŒ‰pdfä¸€å­—ä¸æ¼æ‰“å‡ºæ¥ã€‚æ‰€ä»¥æƒ³ç€èƒ½ä¸èƒ½ç›´æ¥æœ¬åœ°ç¼–è¾‘pdfï¼Œç„¶ååšå®¢ä¸Šæ”¯æŒåœ¨çº¿æŸ¥çœ‹ã€‚\näº‹åè§‰å¾—è¿™ä¸ªæ–¹å¼æœ‰å¾…æ–Ÿé…Œï¼Œç”µè„‘ä¸Š/å¹³æ¿ä¸ŠæŸ¥çœ‹æ²¡å•¥é—®é¢˜ï¼Œæ‰‹æœºä¸ŠæŸ¥çœ‹å­—æœ‰ç‚¹å°ï¼Œä½†ä¹Ÿè¿˜èƒ½æ¥å—ã€‚==\u0026gt;å¾…æ–Ÿé…Œ\nä¸è¿‡ä¸‹é¢çš„æ–¹æ¡ˆæ˜¯å¯è¡Œçš„ã€‚\nå‡†å¤‡ # éœ€è¦åˆ°å®˜ç½‘ä¸‹è½½ pdf.js\nhttps://github.com/mozilla/pdf.js/releases ï¼Œè¿™é‡Œé€‰æ‹© v3.4.120ä¸­çš„pdfjs-3.4.120-dist.zip ï¼Œæœ€æ–°ç‰ˆæœ¬å¥½åƒæœ‰é—®é¢˜\næ“ä½œ # pdfjså¤„ç† # åœ¨source/ä¸‹åˆ›å»ºmyjs/pdfjsæ–‡ä»¶å¤¹ï¼Œå¹¶è§£å‹åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹\nä¿®æ”¹pdfjs/web/viewer.js\nif (fileOrigin !== viewerOrigin) {//1563è¡Œå·¦å³ throw new Error(\u0026#34;file origin does not match viewer\u0026#39;s\u0026#34;); } //æ³¨é‡Šæ‰ï¼Œä¸ºäº†å¤„ç†è·¨åŸŸé—®é¢˜ï¼Œæ³¨é‡Šæ‰åå…è®¸åœ¨çº¿è®¿é—®å…¶ä»–ç½‘ç«™çš„pdf // if (fileOrigin !== viewerOrigin) { //\tthrow new Error(\u0026#34;file origin does not match viewer\u0026#39;s\u0026#34;); //} hexoé…ç½®ä¿®æ”¹ # # æ‰¾åˆ°# Directoryä¸‹çš„skip_renderé¡¹ï¼Œæ·»åŠ å¿½ç•¥æ¸²æŸ“çš„æ–‡ä»¶å¤¹ skip_render: [\u0026#39;myjs/pdfjs/**/*\u0026#39;] æ¸…ç†hexoä¸­publicåŠå…¶ä»–ç¼“å­˜æ–‡ä»¶ # hexo clean \u0026amp; hexo g æ–‡ä»¶é¢„è§ˆæµ‹è¯• # æœ¬åœ°æ–‡ä»¶ # æˆ‘ä»¬åœ¨hexoçš„sourceæ–‡ä»¶å¤¹ä¸‹ï¼Œæ”¾ç½®è¿™æ ·ä¸€ä¸ªæ–‡ä»¶ï¼š source/pdf/my.pdf\nMDæ–‡ä»¶ä¿®æ”¹ # \u0026lt;iframe src=\u0026#39;/myjs/pdfjs/web/viewer.html?file=/pdf/my.pdf\u0026#39; style=\u0026#34;padding: 0;width:100%;\u0026#34; marginwidth=\u0026#34;0\u0026#34; frameborder=\u0026#34;no\u0026#34; scrolling=\u0026#34;no\u0026#34; height=\u0026#34;2000px\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; æ“ä½œå¹¶æŸ¥çœ‹ # hexo g \u0026amp; hexo s è¿œç¨‹æ–‡ä»¶ # â€˜\nä¹Ÿå°±æ˜¯åœ¨æˆ‘çš„è´¦å·(lwmfjc)ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªä»“åº“ï¼ˆä»“åº“å pdfsï¼‰ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹åŠæ–‡ä»¶ temp/01.pdf ï¼Œè¿™ä¸ªåœ°å€æ˜¯ https://raw.githubusercontent.com/lwmfjc/pdfs/main/temp/01.pdf\næ³¨æ„ä¿®æ”¹è´¦å·ååŠä»“åº“å ï¼šlwmfjc/pdfs/\næ–‡ä»¶å¤¹åŠæ–‡ä»¶ï¼štemp/01.pdf\nMDæ–‡ä»¶ä¿®æ”¹ # \u0026lt;iframe src=\u0026#39;/myjs/pdfjs/web/viewer.html?file=https://raw.githubusercontent.com/lwmfjc/pdfs/main/mysql/01.pdf\u0026#39; style=\u0026#34;padding: 0;width:100%;\u0026#34; marginwidth=\u0026#34;0\u0026#34; frameborder=\u0026#34;no\u0026#34; scrolling=\u0026#34;no\u0026#34; height=\u0026#34;2000px\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; æ“ä½œå¹¶æŸ¥çœ‹ # hexo g \u0026amp; hexo s "},{"id":36,"href":"/zh/docs/study/MySQL/how_mysql_run/07/","title":"07B+æ•°ç´¢å¼•çš„ä½¿ç”¨","section":"_MySQLæ˜¯æ€æ ·è¿è¡Œçš„_","content":" å­¦ä¹ ã€ŠMySQLæ˜¯æ€æ ·è¿è¡Œçš„ã€‹ï¼Œæ„Ÿè°¢ä½œè€…ï¼\nInnoDBå­˜å‚¨å¼•æ“çš„B+æ ‘ç´¢å¼•ï¼šç»“è®º # æ¯ä¸ªç´¢å¼•å¯¹åº”ä¸€é¢—B+æ ‘ã€‚B+æ ‘æœ‰å¥½å¤šå±‚ï¼Œæœ€ä¸‹è¾¹ä¸€å±‚æ˜¯å¶å­èŠ‚ç‚¹ï¼Œå…¶ä½™æ˜¯å†…èŠ‚ç‚¹ã€‚æ‰€æœ‰ç”¨æˆ·è®°å½•éƒ½å­˜åœ¨B+æ ‘çš„å¶å­èŠ‚ç‚¹ï¼Œæ‰€æœ‰ç›®å½•é¡¹è®°å½•éƒ½å­˜åœ¨å†…èŠ‚ç‚¹ InnoDB å­˜å‚¨å¼•æ“ä¼šè‡ªåŠ¨ä¸ºä¸»é”®å»ºç«‹èšç°‡ç´¢å¼•(å¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šä¸»é”®æˆ–è€…æ²¡æœ‰å£°æ˜ä¸å…è®¸å­˜å‚¨NULLçš„UNIQUE é”®ï¼Œå®ƒä¼šè‡ªåŠ¨æ·»åŠ ä¸»é”®) ï¼Œ èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹åŒ…å«å®Œæ•´çš„ç”¨æˆ·è®°å½• æˆ‘ä»¬å¯ä»¥ä¸ºæ„Ÿå…´è¶£çš„åˆ—å»ºç«‹äºŒçº§ç´¢å¼•ï¼ŒäºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹åŒ…å«çš„ç”¨æˆ·è®°å½•ç”±ç´¢å¼•åˆ— å’Œä¸»é”®ç»„æˆã€‚å¦‚æœæƒ³é€šè¿‡äºŒçº§ç´¢å¼•æŸ¥æ‰¾å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œéœ€è¦æ‰§è¡Œå›è¡¨æ“ä½œï¼Œ ä¹Ÿå°±æ˜¯åœ¨é€šè¿‡äºŒçº§ç´¢å¼•æ‰¾åˆ°ä¸»é”®å€¼ä¹‹åï¼Œå†åˆ°èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾å®Œæ•´çš„ç”¨æˆ·è®°å½• B+ æ ‘ä¸­çš„æ¯å±‚èŠ‚ç‚¹éƒ½æŒ‰ç…§ç´¢å¼•åˆ—çš„å€¼ä»å°åˆ°å¤§çš„é¡ºåºæ’åºç»„æˆäº†åŒå‘é“¾è¡¨ï¼Œè€Œä¸”æ¯ä¸ªé¡µå†…çš„è®°å½•(æ— è®ºæ˜¯ç”¨æˆ·è®°å½•è¿˜æ˜¯ç›®å½•é¡¹è®°å½•)éƒ½æŒ‰ç…§ç´¢å¼•åˆ—çš„å€¼ä»å°åˆ°å¤§çš„é¡ºåºå½¢æˆäº†ä¸€ä¸ªå•å‘é“¾è¡¨ã€‚å¦‚æœæ˜¯è”åˆç´¢å¼•ï¼Œ åˆ™é¡µé¢å’Œè®°å½• å…ˆæŒ‰ç…§ç´¢å¼•åˆ—ä¸­å‰é¢çš„åˆ—çš„å€¼æ’åºï¼šå¦‚æœè¯¥åˆ—çš„å€¼ç›¸åŒï¼Œå†æŒ‰ç…§ç´¢å¼•åˆ—ä¸­åé¢çš„åˆ—çš„å€¼æ’åºã€‚æ¯”å¦‚ï¼Œ æˆ‘ä»¬å¯¹åˆ—c2 å’Œc3å»ºç«‹äº†è”åˆç´¢å¼• idx_c2_c3(c2ï¼Œ c3)ï¼Œé‚£ä¹ˆè¯¥ç´¢å¼•ä¸­çš„é¡µé¢å’Œè®°å½•å°±å…ˆæŒ‰ç…§c2 åˆ—çš„å€¼è¿›è¡Œæ’åºï¼›å¦‚æœc2 åˆ—çš„å€¼ç›¸åŒï¼Œ å†æŒ‰ç…§c3 åˆ—çš„å€¼æ’åº é€šè¿‡ç´¢å¼•æŸ¥æ‰¾è®°å½•æ—¶ï¼Œæ˜¯ä»B+ æ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹ä¸€å±‚ä¸€å±‚å‘ä¸‹æœç´¢çš„ã€‚ç”±äºæ¯ä¸ªé¡µé¢(æ— è®ºæ˜¯å†…èŠ‚ç‚¹é¡µé¢è¿˜æ˜¯å¶å­èŠ‚ç‚¹é¡µé¢ã€‰ä¸­çš„è®°å½•éƒ½åˆ’åˆ†æˆäº†è‹¥å¹²ä¸ªç»„ï¼Œ æ¯ä¸ªç»„ä¸­ç´¢å¼•åˆ—å€¼æœ€å¤§çš„è®°å½•åœ¨é¡µå†…çš„åç§»é‡ä¼šè¢«å½“ä½œæ§½ä¾æ¬¡å­˜æ”¾åœ¨é¡µç›®å½•ä¸­(å½“ç„¶ï¼Œ è§„å®šSupremum è®°å½•æ¯”ä»»ä½•ç”¨æˆ·è®°å½•éƒ½å¤§) ï¼Œå› æ­¤å¯ä»¥åœ¨é¡µç›®å½•ä¸­é€šè¿‡äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°ç´¢å¼•åˆ—ç­‰äºæŸä¸ªå€¼çš„è®°å½• å¦‚æœå¤§å®¶åœ¨é˜…è¯»ä¸Šè¿°ç»“è®ºæ—¶å“ªæ€•æœ‰ç‚¹ç–‘æƒ‘ï¼Œ é‚£ä¹ˆä¸‹é¢çš„å†…å®¹å°±ä¸é€‚åˆä½ ï¼Œè¯·å›è¿‡å¤´å»åå¤é˜…è¯»å‰é¢çš„ç« èŠ‚\nB+æ ‘ç´¢å¼•ç¤ºæ„å›¾çš„ç®€åŒ– # #åˆ›å»ºæ–°è¡¨ mysql\u0026gt; CREATE TABLE single_table( id INT NOT NULL AUTO_INCREMENT, key1 VARCHAR(100), key2 INT, key3 VARCHAR(100), key_part1 VARCHAR(100), key_part2 VARCHAR(100), key_part3 VARCHAR(100), common_field VARCHAR(100), PRIMARY KEY (id), KEY idx_key1(key1), UNIQUE KEY uk_key2(key2), KEY idx_key3(key3), KEY idx_key_part(key_part1,key_part2,key_part3) ) Engine=InnoDB CHARSET = utf8; å¦‚ä¸Šï¼Œå»ºç«‹äº†1ä¸ªèšç°‡ç´¢å¼•ï¼Œ4ä¸ªäºŒçº§ç´¢å¼•\nä¸ºidåˆ—å»ºç«‹çš„èšç°‡ç´¢å¼• ä¸ºkey1åˆ—å»ºç«‹çš„idx_key1äºŒçº§ç´¢å¼• ä¸ºkey2åˆ—å»ºç«‹çš„uk_key2äºŒçº§ç´¢å¼•ï¼Œè€Œä¸”è¯¥ç´¢å¼•æ˜¯å”¯ä¸€äºŒçº§ç´¢å¼• ä¸ºkey3åˆ—å»ºç«‹çš„idx_key3äºŒçº§ç´¢å¼• ä¸ºkey_part1ã€key_part2ã€key_part3åˆ—å»ºç«‹çš„idx_key_partäºŒçº§ç´¢å¼•ï¼Œæ˜¯ä¸€ä¸ªè”åˆç´¢å¼• æ¥ä¸‹æ¥ä¸ºè¿™ä¸ªè¡¨æ’å…¥10,000è¡Œè®°å½•\né™¤äº†idï¼Œå…¶ä½™çš„åˆ—å–éšæœºå€¼ï¼šè¯¥è¡¨åé¢ä¼šé¢‘ç¹ç”¨åˆ°\néœ€è¦ç”¨ç¨‹åºå†™ï¼Œè¿™é‡Œæš‚æ—¶è·³è¿‡ï¼ˆä¸ä¼š\u0026hellip;ï¼Œä¹¦ä¸Šä¹Ÿæ²¡å†™ï¼‰\nå›é¡¾ï¼šB+æ ‘åŒ…æ‹¬å†…èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹ï¼Œä»¥åŠå„ä¸ªèŠ‚ç‚¹ä¸­çš„è®°å½•ã€‚B+æ ‘å…¶å®æ˜¯ä¸€ä¸ªçŸ®çŸ®çš„å¤§èƒ–å­ï¼Œèƒ½å¤Ÿåˆ©ç”¨B+æ ‘å¿«é€Ÿåœ°å®šä½è®°å½•ï¼Œä¸‹é¢ç®€åŒ–ä¸€ä¸‹B+æ ‘çš„ç¤ºæ„å›¾ï¼š\nå¿½ç•¥é¡µç»“æ„ï¼Œç›´æ¥æŠŠæ‰€æœ‰å¶å­èŠ‚ç‚¹ä¸­çš„è®°å½•æ”¾ä¸€èµ· ä¸ºäº†æ–¹ä¾¿ï¼ŒæŠŠèšç°‡ç´¢å¼•å¶å­èŠ‚ç‚¹çš„è®°å½•ç§°ä¸ºèšç°‡ç´¢å¼•è®°å½•ï¼ŒæŠŠäºŒçº§ç´¢å¼•å¶å­èŠ‚ç‚¹ç§°ä¸ºäºŒçº§ç´¢å¼•è®°å½• å›é¡¾ä¸€ä¸‹ï¼š\næ ¸å¿ƒè¦ç‚¹ï¼šæŠŠä¸‹ä¸€å±‚æ¯ä¸€é¡µçš„æœ€å°å€¼ï¼Œæ”¾åˆ°ä¸Šä¸€çº§çš„ç›®å½•é¡¹è®°å½•ï¼Œä»¥keyå€¼+é¡µå·è¿™æ ·çš„ç»„åˆå­˜åœ¨\nç²¾ç®€ï¼š\nå¦‚ä¸Šï¼Œèšç°‡ç´¢å¼•è®°å½•æ˜¯æŒ‰ç…§ä¸»é”®å€¼ç”±å°åˆ°å¤§çš„é¡ºåºæ’åˆ—çš„ å¦‚ä¸‹å›¾ï¼Œé€šè¿‡B+æ ‘å®šä½åˆ°idå€¼ä¸º1438çš„è®°å½•\näºŒçº§ç´¢å¼•idx_key1å¯¹åº”çš„B+æ ‘ä¸­ä¿ç•™äº†å¶å­ç»“ç‚¹çš„è®°å½•ã€‚ä»¥key1æ’åºï¼Œå¦‚æœkey1ç›¸åŒï¼Œåˆ™æŒ‰ç…§idåˆ—æ’åº\nä¸ºäº†æ–¹ä¾¿ï¼ŒæŠŠèšç°‡ç´¢å¼•å¶å­èŠ‚ç‚¹çš„è®°å½•ç§°ä¸ºèšç°‡ç´¢å¼•è®°å½•ï¼ŒæŠŠäºŒçº§ç´¢å¼•å¶å­èŠ‚ç‚¹ç§°ä¸ºäºŒçº§ç´¢å¼•è®°å½•\nå¦‚æœè¦æŸ¥æ‰¾key1å€¼ç­‰äºæŸä¸ªå€¼çš„äºŒçº§ç´¢å¼•è®°å½•ï¼Œé€šè¿‡idx_key1å¯¹åº”çš„B+æ ‘ï¼Œå¯ä»¥å¾ˆå®¹æ˜“å®šä½åˆ°ç¬¬ä¸€æ¡key1åˆ—çš„å€¼ç­‰äºæŸä¸ªå€¼çš„äºŒçº§ç´¢å¼•è®°å½•ï¼Œç„¶åæ²¿ç€å•å‘é“¾è¡¨å‘åæ‰«æå³å¯ã€‚\nç´¢å¼•çš„ä»£ä»· # ç©ºé—´ä¸Šçš„ä»£ä»· # æ¯å»ºç«‹ä¸€ä¸ªç´¢å¼•ï¼Œéƒ½è¦ä¸ºä»–å»ºç«‹ä¸€é¢—B+æ ‘ã€‚æ¯ä¸€é¢—B+æ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªæ•°æ®é¡µï¼ˆä¸€ä¸ªæ•°æ®é¡µé»˜è®¤å ç”¨16KBï¼‰ï¼Œè€Œä¸€é¢—å¾ˆå¤§çš„B+æ ‘ç”±è®¸å¤šæ•°æ®é¡µç»„æˆï¼Œè¿™å°†å ç”¨å¾ˆå¤§çš„ç‰‡å­˜å‚¨ç©ºé—´\næ—¶é—´ä¸Šçš„ä»£ä»· # æ¯å½“å¯¹è¡¨ä¸­æ•°æ®è¿›è¡Œå¢ä¸Šæ”¹æŸ¥æ—¶ï¼Œéƒ½è¦ä¿®æ”¹å„ä¸ªB+æ ‘ç´¢å¼• æ‰§è¡ŒæŸ¥è¯¢è¯­å¥å‰ï¼Œéƒ½è¦ç”Ÿæˆä¸€ä¸ªæ‰§è¡Œè®¡åˆ’ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€æ¡æŸ¥è¯¢è¯­å¥åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æœ€å¤šç”¨åˆ°ä¸€ä¸ªäºŒçº§ç´¢å¼•ï¼ˆæœ‰ä¾‹å¤–ï¼Œ10ç« ï¼‰ï¼Œåœ¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’æ—¶éœ€è¦è®¡ç®—ä½¿ç”¨ä¸åŒç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢æ—¶æ‰€éœ€è¦çš„æˆæœ¬ï¼Œæœ€åé€‰å–æˆæœ¬æœ€ä½çš„é‚£ä¸ªç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢ï¼ˆ12ç« ï¼šå¦‚ä½•è®¡ç®—æŸ¥è¯¢æˆæœ¬ï¼‰==\u0026gt; ç´¢å¼•å¤ªå¤šå¯¼è‡´åˆ†ææ—¶é—´è¿‡é•¿ æ€»ç»“ # ç´¢å¼•è¶Šå¤šï¼Œå­˜å‚¨ç©ºé—´è¶Šå¤šï¼Œå¢åˆ æ”¹è®°å½•æˆ–è€…ç”Ÿæˆæ‰§è¡Œè®¡åˆ’æ—¶æ€§èƒ½è¶Šå·®\nä¸ºäº†å»ºç«‹åˆå¥½åˆå°‘çš„ç´¢å¼•ï¼Œå¾—å…ˆäº†è§£ç´¢å¼•åœ¨æŸ¥è¯¢æ‰§è¡ŒæœŸé—´åˆ°åº•æ˜¯å¦‚ä½•å‘æŒ¥ä½œç”¨çš„\nåº”ç”¨B+æ ‘ç´¢å¼• # å¯¹äºæŸä¸ªæŸ¥è¯¢æ¥è¯´ï¼Œæœ€ç®€å•ç²—æš´çš„æ‰§è¡Œæ–¹æ¡ˆå°±æ˜¯æ‰«æè¡¨ä¸­çš„æ‰€æœ‰è®°å½•ã€‚åˆ¤æ–­æ¯ä¸€æ¡è®°å½•æ˜¯å¦ç¬¦åˆæœç´¢æ¡ä»¶ã€‚å¦‚æœç¬¦åˆï¼Œå°±å°†å…¶å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œå¦åˆ™å°±è·³è¿‡è¯¥è®°å½•ã€‚è¿™ç§æ‰§è¡Œæ–¹æ¡ˆä¹Ÿç§°ä¸ºå…¨è¡¨æ‰«æã€‚\nå¯¹äºä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼Œå…¨è¡¨æ‰«ææ„å‘³ç€ä»èšç°‡ç´¢å¼•ç¬¬ä¸€ä¸ªå¶å­èŠ‚ç‚¹çš„ç¬¬ä¸€æ¡è®°å½•å¼€å§‹ï¼Œæ²¿ç€è®°å½•æ‰€åœ¨çš„å•å‘é“¾è¡¨å‘åæ‰«æ ç›´åˆ°æœ€åä¸€ä¸ªå¶å­èŠ‚ç‚¹çš„æœ€åä¸€æ¡è®°å½•(å¶å­èŠ‚ç‚¹ï¼šé¡µï¼Œ16KBï¼›å³é¡µå†…æœ€åä¸€æ¡)ã€‚è™½ç„¶å…¨è¡¨æ‰«ææ˜¯ä¸€ç§å¾ˆç¬¨çš„æ‰§è¡Œæ–¹æ¡ˆï¼Œä½†å´æ˜¯ä¸€ç§ä¸‡èƒ½çš„æ‰§è¡Œæ–¹æ¡ˆï¼Œæ‰€æœ‰çš„æŸ¥è¯¢éƒ½å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ¡ˆæ¥æ‰§è¡Œã€‚\næ‰«æåŒºé—´å’Œè¾¹ç•Œæ¡ä»¶ # å¯ä»¥åˆ©ç”¨B+æ ‘æŸ¥æ‰¾ç´¢å¼•å€¼ç­‰äºæŸä¸ªå€¼çš„è®°å½•=\u0026gt;å‡å°‘éœ€è¦æ‰«æçš„è®°å½•æ•°é‡ã€‚ç”±äº*B+æ ‘å¶å­èŠ‚ç‚¹ä¸­çš„è®°å½•æ˜¯æŒ‰ç…§ç´¢å¼•åˆ—å€¼ç”±å°åˆ°å¤§çš„é¡ºåºæ’åºçš„ï¼Œæ‰€ä»¥åªæ‰«ææŸä¸ªåŒºé—´æˆ–è€…æŸäº›åŒºé—´ä¸­çš„è®°å½•ä¹Ÿå¯ä»¥æ˜æ˜¾å‡å°‘éœ€è¦æ‰«æçš„è®°å½•æ•°é‡ã€‚\nç®€å•ä¾‹å­ # ä¾‹å­1ï¼ˆèšç°‡ç´¢å¼•ï¼‰ # ä¾‹å­ï¼šSELECT * FROM single_table WHERE id\u0026gt;=2 AND id \u0026lt;=100\nè¿™ä¸ªè¯­å¥å…¶å®æ˜¯è¦æ‰¾idå€¼åœ¨**[2,100]åŒºé—´ä¸­çš„æ‰€æœ‰èšç°‡ç´¢å¼•**è®°å½•ã€‚\nå¯ä»¥é€šè¿‡èšç°‡ç´¢å¼•å¯¹åº”çš„B+æ ‘å¿«é€Ÿåœ°å®šä½åˆ°idå€¼ä¸º2çš„é‚£æ¡èšç°‡ç´¢å¼•è®°å½•ï¼Œç„¶åæ²¿ç€è®°å½•æ‰€åœ¨çš„å•å‘é“¾è¡¨å‘åæ‰«æï¼Œç›´åˆ°æŸæ¡èšç°‡ç´¢å¼•è®°å½•çš„idå€¼ä¸åœ¨[2,100]åŒºé—´ä¸­ä¸ºæ­¢ï¼ˆå³idä¸å†ç¬¦åˆid\u0026lt;=100æ¡ä»¶ï¼‰ ä¸æ‰«æå…¨éƒ¨çš„èšç°‡ç´¢å¼•è®°å½•ç›¸æ¯”ï¼Œæ‰«æid å€¼åœ¨**[2,100]** åŒºé—´ä¸­çš„è®°å½•å·²ç»å¾ˆå¤§ç¨‹åº¦åœ°å‡å°‘äº†éœ€è¦æ‰«æçš„è®°å½•æ•°é‡ï¼Œ æ‰€ä»¥æå‡äº†æŸ¥è¯¢æ•ˆç‡ã€‚ç®€ä¾¿èµ·è§ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªä¾‹å­ä¸­å¾…æ‰«æè®°å½•çš„id å€¼æ‰€åœ¨çš„åŒºé—´ç§°ä¸ºæ‰«æåŒºé—´ï¼ŒæŠŠå½¢æˆè¿™ä¸ªæ‰«æåŒºé—´çš„æœç´¢æ¡ä»¶(ä¹Ÿå°±æ˜¯id \u0026gt;= 2AND \u0026gt; id \u0026lt;= 100 ) ç§°ä¸ºå½¢æˆè¿™ä¸ªæ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶. å¯¹äºå…¨è¡¨æ‰«ææ¥è¯´ï¼Œç›¸å½“äºæ‰«æidåœ¨**(-âˆ,+âˆ)** åŒºé—´ä¸­çš„è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¯´å…¨è¡¨æ‰«æå¯¹åº”çš„æ‰«æåŒºé—´æ˜¯**(-âˆ,+âˆ)**\nä¾‹å­2ï¼ˆäºŒçº§ç´¢å¼•ï¼‰ # SELECT * FROM single_table WHERE key2 IN (1438,6328 ) OR (key2 \u0026gt;=38 AND key2 \u0026lt;=79) å¯ä»¥ç›´æ¥ä½¿ç”¨å…¨è¡¨æ‰«æçš„æ–¹å¼æ‰§è¡Œè¯¥æŸ¥è¯¢ã€‚\nä½†æ˜¯æˆ‘ä»¬å‘ç°è¯¥æŸ¥è¯¢çš„æœç´¢æ¡ä»¶æ¶‰åŠkey2åˆ—ï¼Œè€Œæˆ‘ä»¬åˆæ­£å¥½ä¸ºkey2åˆ—å»ºç«‹äº†uk_key2ç´¢å¼•ã€‚å¦‚æœä½¿ç”¨uk_key2ç´¢å¼•æ‰§è¡Œè¿™ä¸ªæŸ¥è¯¢ï¼Œåˆ™ç›¸å½“äºä»ä¸‹é¢çš„3ä¸ªæ‰«æåŒºé—´ä¸­è·å–äºŒçº§ç´¢å¼•è®°å½•ï¼š\n[1438,1438] ï¼šå¯¹åº”çš„è¾¹ç•Œæ¡ä»¶å°±æ˜¯key2 IN (1438) [6328,6328]ï¼šå¯¹åº”çš„è¾¹ç•Œæ¡ä»¶å°±æ˜¯key2 IN (6328) [38,79]ï¼šå¯¹åº”çš„è¾¹ç•Œæ¡ä»¶å°±æ˜¯key2 \u0026gt;= 38 AND key2 \u0026lt;= 79 è¿™äº›æ‰«æåŒºé—´å¯¹åº”åˆ°æ•°è½´ä¸Šæ—¶ï¼Œå¦‚å›¾\næ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬æŠŠåƒ[1438,1438]ã€[6328, 6328] è¿™æ ·åªåŒ…å«ä¸€ä¸ªå€¼çš„æ‰«æåŒºé—´ç§°ä¸ºå•ç‚¹æ‰«æåŒºé—´ï¼Œ æŠŠ[38ï¼Œ 79] è¿™æ ·åŒ…å«å¤šä¸ªå€¼çš„æ‰«æåŒºé—´ç§°ä¸ºèŒƒå›´æ‰«æåŒºé—´ã€‚å¦å¤–ï¼Œç”±äºæˆ‘ä»¬çš„æŸ¥è¯¢åˆ—è¡¨æ˜¯ * ï¼Œä¹Ÿå°±æ˜¯éœ€è¦è¯»å–å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œæ‰€ä»¥ä»ä¸Šè¿°æ‰«æåŒºé—´ä¸­æ¯è·å–ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•ï¼Œ å°±éœ€è¦æ ¹æ®è¯¥äºŒçº§ç´¢å¼•è®°å½•idåˆ—çš„å€¼æ‰§è¡Œå›è¡¨æ“ä½œï¼Œä¹Ÿå°±æ˜¯åˆ°èšç°‡ç´¢å¼•ä¸­æ‰¾åˆ°ç›¸åº”çš„èšç°‡ç´¢å¼•è®°å½•ã€‚\nå…¶å®æˆ‘ä»¬ä¸ä»…ä»…å¯ä»¥ä½¿ç”¨uk_key2 æ‰§è¡Œä¸Šè¿°æŸ¥è¯¢ï¼Œ è¿˜å¯ä»¥ä½¿ç”¨idx_key1ã€idx_key3 ã€idx_key_part æ‰§è¡Œä¸Šè¿°æŸ¥è¯¢ã€‚ä»¥idx_key_1 ä¸ºä¾‹ï¼Œå¾ˆæ˜¾ç„¶æ— æ³•é€šè¿‡æœç´¢æ¡ä»¶å½¢æˆåˆé€‚çš„æ‰«æåŒºé—´æ¥å‡å°‘éœ€è¦æ‰«æçš„idx_key1 äºŒçº§ç´¢å¼•è®°å½•çš„æ•°é‡ï¼Œåªèƒ½æ‰«æidx_keyl çš„å…¨éƒ¨äºŒçº§ç´¢å¼•è®°å½•ã€‚é’ˆå¯¹è·å–åˆ°çš„æ¯ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•ï¼Œéƒ½éœ€è¦æ‰§è¡Œå›è¡¨æ“ä½œæ¥è·å–å®Œæ•´çš„ç”¨æˆ·è®°å½•.ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥è¯´ï¼Œä½¿ç”¨idx_key1 æ‰§è¡ŒæŸ¥è¯¢æ—¶å¯¹åº”çš„æ‰«æåŒºé—´å°±æ˜¯**(-âˆ,+âˆ)** è¿™æ ·è™½ç„¶è¡Œå¾—é€šï¼Œä½†æˆ‘ä»¬å›¾å•¥å‘¢ï¼Œæœ€ç®€å•ç²—æš´çš„å…¨è¡¨æ‰«ææ–¹å¼å·²ç»éœ€è¦æ‰«æå…¨éƒ¨çš„èšç°‡ç´¢å¼•è®°å½•ï¼Œ è¿™é‡Œé™¤äº†éœ€è¦è®¿é—®å…¨éƒ¨çš„èšç°‡ç´¢å¼•è®°å½•ï¼Œè¿˜è¦æ‰«æå…¨éƒ¨çš„idx_key1äºŒçº§ç´¢ å¼•è®°å½•ï¼Œè¿™ä¸æ˜¯è´¹åŠ›ä¸è®¨å¥½ä¹ˆã€‚å¯è§ï¼Œ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰å‡å°‘éœ€è¦æ‰«æçš„è®°å½•æ•°é‡ï¼Œæ•ˆ ç‡åè€Œæ¯”å…¨è¡¨æ‰«æå·®ã€‚æ‰€ä»¥å¦‚æœæƒ³ä½¿ç”¨æŸä¸ªç´¢å¼•æ¥æ‰§è¡ŒæŸ¥è¯¢ï¼Œä½†æ˜¯åˆæ— æ³•é€šè¿‡æœç´¢æ¡ä»¶ å½¢æˆåˆé€‚çš„æ‰«æåŒºé—´æ¥å‡å°‘éœ€è¦æ‰«æçš„è®°å½•æ•°é‡æ—¶ï¼Œ åˆ™ä¸è€ƒè™‘ä½¿ç”¨è¿™ä¸ªç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢ ä¾‹3 ä¸æ˜¯ç´¢å¼•çš„æœç´¢æ¡ä»¶éƒ½å¯ä»¥æˆä¸ºè¾¹ç•Œæ¡ä»¶ # SELECT * FROM single_table WHERE key1 \u0026lt; \u0026#39;a\u0026#39; AND key3 \u0026gt; \u0026#39;z\u0026#39; AND common_field = \u0026#39;abc\u0026#39; å¦‚æœä½¿ç”¨idx_key1 æ‰§è¡ŒæŸ¥è¯¢ï¼Œé‚£ä¹ˆç›¸åº”çš„æ‰«æåŒºé—´å°±æ˜¯(-âˆ,\u0026lsquo;a\u0026rsquo;)ï¼Œå½¢æˆè¯¥æ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶å°±æ˜¯key1 \u0026lt; \u0026lsquo;a\u0026rsquo;ã€‚è€Œ key3 \u0026gt; \u0026lsquo;z\u0026rsquo; AND common_field = \u0026lsquo;abc\u0026rsquo;å°±æ˜¯æ™®é€šçš„æœç´¢æ¡ä»¶ï¼Œè¿™äº›æ™®é€šçš„æœç´¢æ¡ä»¶éœ€è¦åœ¨è·å–åˆ°idx_key1çš„äºŒçº§ç´¢å¼•è®°å½•åï¼Œå†æ‰§è¡Œå›è¡¨æ“ä½œï¼Œåœ¨è·å–åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•åæ‰èƒ½å»åˆ¤æ–­å®ƒä»¬æ˜¯å¦æˆç«‹ è€Œå¦‚æœä½¿ç”¨idx_key3 æ‰§è¡ŒæŸ¥è¯¢ï¼Œé‚£ä¹ˆç›¸åº”çš„æ‰«æåŒºé—´å°±æ˜¯\u0026rsquo;z\u0026rsquo;ï¼Œå½¢æˆè¯¥æ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶å°±æ˜¯key3\u0026gt;\u0026lsquo;z\u0026rsquo;ã€‚è€Œkey1\u0026lt;\u0026lsquo;a\u0026rsquo; AND common_field=\u0026lsquo;abc\u0026rsquo;å°±æ˜¯æ™®é€šçš„æœç´¢æ¡ä»¶ï¼Œè¿™äº›æ™®é€šçš„æœç´¢æ¡ä»¶éœ€è¦åœ¨è·å–åˆ°idx_key3çš„äºŒçº§ç´¢å¼•è®°å½•åï¼Œå†æ‰§è¡Œå›è¡¨æ“ä½œï¼Œåœ¨è·å–åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•åæ‰èƒ½å»åˆ¤æ–­å®ƒä»¬æ˜¯å¦æˆç«‹ æ€»ç»“ # åœ¨ä½¿ç”¨æŸä¸ªç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œå…³é”®çš„é—®é¢˜å°±æ˜¯é€šè¿‡æœç´¢æ¡ä»¶æ‰¾å‡ºåˆé€‚çš„æ‰«æåŒºé—´ï¼Œç„¶åå†åˆ°å¯¹åº”çš„B+ æ ‘ä¸­æ‰«æç´¢å¼•åˆ—å€¼åœ¨è¿™äº›æ‰«æåŒºé—´çš„è®°å½•ã€‚å¯¹äºæ¯ä¸ªæ‰«æåŒºé—´æ¥è¯´ï¼Œä»…éœ€è¦é€šè¿‡B+ æ ‘å®šä½åˆ°è¯¥æ‰«æåŒºé—´ä¸­çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œç„¶åå°±å¯ä»¥æ²¿ç€è®°å½•æ‰€åœ¨çš„å•å‘é“¾è¡¨å‘åæ‰«æï¼Œç›´åˆ°æŸæ¡è®°å½•ä¸ç¬¦åˆå½¢æˆè¯¥æ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶ä¸ºæ­¢ã€‚å…¶å®å¯¹äºB+ æ ‘ç´¢å¼•æ¥è¯´ï¼Œåªè¦ç´¢å¼•åˆ—å’Œå¸¸æ•°ä½¿ç”¨**=ã€\u0026lt;=\u0026gt;ã€lNã€NOT INã€IS NULLã€IS NOT NULLã€\u0026gt; ã€\u0026lt;ã€=ã€\u0026lt;=ã€BETWEEN ã€! = (ä¹Ÿå¯ä»¥å†™æˆ\u0026lt; \u0026gt;)æˆ–è€…LIKE æ“ä½œç¬¦è¿æ¥èµ·æ¥ï¼Œå°±å¯ä»¥äº§ç”Ÿæ‰€è°“çš„æ‰«æåŒºé—´**ã€‚ä¸è¿‡æœ‰ä¸‹é¢å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š\nlNæ“ä½œç¬¦çš„è¯­ä¹‰ä¸è‹¥å¹²ä¸ªç­‰å€¼åŒ¹é…æ“ä½œç¬¦( =)ä¹‹é—´ç”¨OR è¿æ¥èµ·æ¥çš„è¯­ä¹‰æ˜¯ä¸€æ ·çš„ï¼Œéƒ½ä¼šäº§ç”Ÿå¤šä¸ªå•ç‚¹æ‰«æåŒºé—´ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸¤ä¸ªè¯­å¥çš„è¯­ä¹‰æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼š\nSELECT * FROM single_table WHERE key2 IN (1438,6328); #ä¸ä¸Šé¢çš„è¯­ä¹‰æ•ˆæœä¸€æ · SELECT * FROM single_table WHERE key2 = 1438 OR key2 = 6328 != äº§ç”Ÿçš„æ‰«æåŒºé—´æ¯”è¾ƒæœ‰è¶£ï¼Œå¦‚ï¼š\nSELECT * FROM single_table key1 != \u0026#39;a\u0026#39;; æ­¤æ—¶idx_key1æ‰§è¡ŒæŸ¥è¯¢æ—¶å¯¹åº”çš„æ‰«æåŒºé—´å°±æ˜¯(-âˆ,\u0026lsquo;a\u0026rsquo;) å’Œ(\u0026lsquo;a\u0026rsquo;,+âˆ)\nLIKEæ“ä½œç¬¦æ¯”è¾ƒç‰¹æ®Šï¼Œåªæœ‰åœ¨åŒ¹é…å®Œæ•´çš„å­—ç¬¦ä¸²æˆ–è€…åŒ¹é…å­—ç¬¦ä¸²å‰ç¼€æ—¶æ‰äº§ç”Ÿåˆé€‚çš„æ‰«æåŒºé—´\næ¯”è¾ƒå­—ç¬¦ä¸²çš„å¤§å°ï¼Œå…¶å®å°±ç›¸å½“äºä¸€æ¬¡æ¯”è¾ƒæ¯ä¸ªå­—ç¬¦çš„å¤§å°ã€‚å­—ç¬¦ä¸²çš„æ¯”è¾ƒè¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š\nå…ˆæ¯”è¾ƒå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼šç¬¬ä¸€ä¸ªå­—ç¬¦å°çš„é‚£ä¸ªå­—ç¬¦ä¸²å°±æ¯”è¾ƒå° å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ç›¸åŒï¼Œå†æ¯”è¾ƒç¬¬äºŒä¸ªå­—ç¬¦ï¼›ç¬¬äºŒä¸ªå­—ç¬¦æ¯”è¾ƒå°çš„é‚£ä¸ªå­—ç¬¦ä¸²å°±æ¯”è¾ƒå° å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²çš„å‰ä¸¤ä¸ªå­—ç¬¦éƒ½ç›¸åŒï¼Œé‚£ä¹ˆå°±æ¥ç€æ¯”è¾ƒç¬¬ä¸‰ä¸ªå­—ç¬¦ï¼šä¾æ­¤ç±»æ¨ å¯¹äºæŸä¸ªç´¢å¼•åˆ—æ¥è¯´ï¼Œå­—ç¬¦ä¸²å‰ç¼€ç›¸åŒçš„è®°å½•åœ¨ç”±è®°å½•ç»„æˆçš„å•å‘é“¾è¡¨ä¸­è‚¯å®šæ˜¯ç›¸é‚»çš„ã€‚\næ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªæœç´¢æ¡ä»¶æ˜¯key1 LIKE \u0026lsquo;a%\u0026rsquo;ã€‚ å¯¹äºäºŒçº§ç´¢å¼• idx_key1 æ¥è¯´ï¼Œæ‰€æœ‰å­—ç¬¦ä¸²å‰ç¼€ä¸º\u0026rsquo;a\u0026rsquo;çš„äºŒçº§ç´¢å¼•è®°å½•è‚¯å®šæ˜¯ç›¸é‚»çš„ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬åªè¦å®šä½ key1 å€¼çš„å­—ç¬¦ä¸²å‰ç¼€ä¸º\u0026rsquo;a\u0026rsquo; çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œå°±å¯ä»¥æ²¿ç€è®°å½•æ‰€åœ¨çš„å•å‘é“¾è¡¨å‘åæ‰«æï¼Œ ç›´åˆ°æŸæ¡äºŒçº§ç´¢å¼•è®°å½•çš„å­—ç¬¦ä¸²å‰ç¼€ä¸ä¸º\u0026rsquo;a\u0026rsquo; ä¸ºæ­¢ï¼Œå¦‚å›¾7-7 æ‰€ç¤ºã€‚å¾ˆæ˜¾ç„¶ key1 LIKE \u0026lsquo;a%\u0026rsquo; å½¢æˆçš„æ‰«æåŒºé—´ç›¸å½“äº**[\u0026lsquo;a\u0026rsquo;,\u0026lsquo;b\u0026rsquo;)** ç¨å¤æ‚ä¾‹å­ # æ—¥å¸¸å·¥ä½œä¸­ï¼Œä¸€ä¸ªæŸ¥è¯¢è¯­å¥ä¸­çš„WHEREå­å¥å¯èƒ½æœ‰å¤šä¸ªå°çš„æœç´¢æ¡ä»¶ï¼Œè¿™äº›æœç´¢æ¡ä»¶ä½¿ç”¨AND æˆ–è€…OR æ“ä½œç¬¦è¿æ¥èµ·æ¥ã€‚è™½ç„¶å¤§å®¶éƒ½çŸ¥é“è¿™ä¸¤ä¸ªæ“ä½œç¬¦çš„ä½œç”¨ï¼Œä½†è¿™é‡Œè¿˜æ˜¯è¦å†å¼ºè°ƒä¸€éï¼š\ncond1 AND cond2 åªæœ‰å½“cond1å’Œcond2éƒ½ä¸ºTRUE æ—¶ï¼Œæ•´ä¸ªè¡¨è¾¾å¼æ‰ä¸ºTRUE cond1 OR cond2 ï¼Œ åªè¦cond1 æˆ–è€…cond2 ä¸­æœ‰ä¸€ä¸ªä¸ºTRUEï¼Œ æ•´ä¸ªè¡¨è¾¾å¼å°±ä¸ºTRUE åœ¨æˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢è¯­å¥æ—¶ï¼Œé¦–å…ˆéœ€è¦æ‰¾å‡ºæ‰€æœ‰å¯ç”¨çš„ç´¢å¼•ä»¥åŠä½¿ç”¨å®ƒä»¬æ—¶å¯¹åº”çš„æ‰«æåŒºé—´ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ€ä¹ˆä»åŒ…å«è‹¥å¹²ä¸ªAND æˆ–OR çš„å¤æ‚æœç´¢æ¡ä»¶ä¸­æå–å‡ºæ­£ç¡®çš„æ‰«æåŒºé—´ï¼š\næ‰€æœ‰æœç´¢æ¡ä»¶éƒ½å¯ä»¥ç”Ÿæˆåˆé€‚çš„æ‰«æåŒºé—´çš„æƒ…å†µ # ANDç»“åˆ # SELECT * FROM single_table WHERE key2 \u0026gt; 100 AND key2 \u0026gt; 200; å…¶ä¸­ï¼Œæ¯ä¸ªå°çš„æœç´¢æ¡ä»¶éƒ½å¯ä»¥ç”Ÿæˆä¸€ä¸ªåˆé€‚çš„æ‰«æåŒºé—´æ¥å‡å°‘éœ€è¦æ‰«æçš„è®°å½•æ•°é‡ï¼Œæœ€ç»ˆçš„æ‰«æåŒºé—´å°±æ˜¯å¯¹è¿™ä¸¤ä¸ªå°çš„æœç´¢æ¡ä»¶å½¢æˆçš„æ‰«æåŒºé—´å–äº¤é›†åçš„ç»“æœï¼Œå–äº¤é›†çš„è¿‡ç¨‹ï¼š\nä¸Šé¢æŸ¥è¯¢è¯­å¥ä½¿ç”¨uk_key2ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢æ—¶å¯¹åº”çš„æ‰«æåŒºé—´å°±æ˜¯**(200,+âˆ)ï¼Œå½¢æˆè¯¥æ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶å°±æ˜¯key2 \u0026gt; 200**\nORç»“åˆ # ä½¿ç”¨ORæ“ä½œç¬¦å°†å¤šä¸ªæœç´¢æ¡ä»¶è¿æ¥åœ¨ä¸€èµ·ï¼š\nSELECT * FROM single_table WHERE key2 \u0026gt; 100 OR key2 \u0026gt; 200 ORæ„å‘³ç€éœ€è¦å–å„ä¸ªæ‰«æåŒºé—´çš„å¹¶é›†ï¼Œå–å¹¶é›†çš„è¿‡ç¨‹å¦‚å›¾æ‰€ç¤ºï¼š\nå³ï¼Œä¸Šé¢çš„æŸ¥è¯¢è¯­å¥åœ¨ä½¿ç”¨uk_key2ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œå¯¹åº”çš„æ‰«æåŒºé—´å°±æ˜¯**(100,+âˆ)ï¼Œå½¢æˆæ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶å°±æ˜¯key2 \u0026gt; 100**\næœ‰çš„æœç´¢æ¡ä»¶ä¸èƒ½ç”Ÿæˆåˆé€‚çš„æ‰«æåŒºé—´çš„æƒ…å†µ # ANDæƒ…å†µ # æœ‰çš„æœç´¢æ¡ä»¶ä¸èƒ½ç”Ÿæˆåˆé€‚çš„æ‰«æåŒºé—´æ¥å‡å°‘éœ€è¦æ‰«æçš„è®°å½•æ•°é‡\nSELECT * FROM single_table WHERE key2 \u0026gt; 100 AND common_field = \u0026#39;abc\u0026#39; åˆ†æï¼šä½¿ç”¨uk_key2æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œæœç´¢æ¡ä»¶key2\u0026gt;100å¯ä»¥å½¢æˆæ‰«æåŒºé—´(100,+âˆ)ã€‚ä½†æ˜¯ç”±äºuk_key2çš„äºŒçº§ç´¢å¼•å¹¶ä¸æŒ‰ç…§common_fieldåˆ—è¿›è¡Œæ’åºï¼ˆuk_key2äºŒçº§ç´¢å¼•è®°å½•ä¸­å‹æ ¹å„¿ä¸åŒ…å«common_fieldåˆ—ï¼‰ï¼Œæ‰€ä»¥ä»…å‡­æœç´¢æ¡ä»¶common_field = \u0026lsquo;abc\u0026rsquo;å¹¶ä¸èƒ½å‡å°‘éœ€è¦æ‰«æçš„äºŒçº§ç´¢å¼•è®°å½•æ•°é‡ã€‚å³è¯¥æœç´¢æ¡ä»¶ç”Ÿæˆçš„æ‰«æåŒºé—´å…¶å®æ˜¯**(-âˆ,+âˆ)ã€‚ç”±äºè¿™ä¸¤ä¸ªå°çš„æœç´¢æ¡ä»¶æ˜¯ä½¿ç”¨ANDæ“ä½œç¬¦è¿æ¥ï¼Œæ‰€ä»¥å¯¹(100,+âˆ)** å’Œ (-âˆ,+âˆ)è¿™ä¸¤ä¸ªæœç´¢åŒºé—´å–äº¤é›†åå¾—åˆ°çš„ç»“æœè‡ªç„¶æ˜¯**ï¼ˆ100ï¼Œ+âˆï¼‰ã€‚å³ä½¿ç”¨uk_key2æ‰§è¡Œä¸Šè¿°æŸ¥è¯¢ï¼Œæœ€ç»ˆå¯¹åº”çš„æ‰«æåŒºé—´å°±æ˜¯ï¼ˆ100ï¼Œ+âˆï¼‰ï¼Œå½¢æˆè¯¥æ‰«æåŒºé—´çš„æ¡ä»¶å°±æ˜¯key2\u0026gt;100\nç®€åŒ–ï¼šä½¿ç”¨uk_key2æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œåœ¨å¯»æ‰¾å¯¹åº”çš„æ‰«æåŒºé—´**çš„è¿‡ç¨‹ä¸­ï¼Œæœç´¢æ¡ä»¶ common_field = \u0026lsquo;abc\u0026rsquo;æ²¡èµ·åˆ°ä»»ä½•ä½œç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠ common_field = \u0026lsquo;abc\u0026rsquo; æœç´¢æ¡ä»¶æ›¿æ¢ä¸ºTRUEï¼Œï¼ˆTRUEå¯¹åº”çš„æ‰«æåŒºé—´ä¹Ÿæ˜¯ï¼ˆ-âˆï¼Œ+âˆï¼‰ï¼‰,å¦‚ä¸‹ï¼š\nSELECT * FROM single_table WHERE key2 \u0026gt; 100 AND TRUE # ç®€åŒ–ä¹‹å SELECT * FROM single_table WHERE key2 \u0026gt; 100 å³ä¸Šé¢çš„æŸ¥è¯¢è¯­å¥ä½¿ç”¨uk_key2æ‰§è¡ŒæŸ¥è¯¢æ—¶å¯¹åº”çš„æ‰«æåŒºé—´æ˜¯**ï¼ˆ100ï¼Œ+âˆï¼‰**\nORæƒ…å†µ # SELECT * FROM single_table WHERE key2 \u0026gt; 100 OR common_field = \u0026#39;abc\u0026#39; #æ›¿æ¢ä¹‹å SELECT * FROM single_table WHERE key2 \u0026gt; 100 OR TRUE æ‰€ä»¥ï¼Œå¦‚æœå¼ºåˆ¶ä½¿ç”¨uk_key2æ‰§è¡ŒæŸ¥è¯¢ï¼Œç”±äºè¿™ä¸¤ä¸ªå°çš„æœç´¢æ¡ä»¶æ˜¯ä½¿ç”¨ORæ“ä½œç¬¦è¿æ¥ï¼Œæ‰€ä»¥å¯¹**(100,+âˆ)** å’Œ (-âˆ,+âˆ)è¿™ä¸¤ä¸ªæœç´¢åŒºé—´å–å¹¶é›†åå¾—åˆ°çš„ç»“æœè‡ªç„¶æ˜¯**ï¼ˆ-âˆï¼Œ+âˆï¼‰ã€‚ä¹Ÿå°±æ˜¯éœ€è¦æ‰«æuk_key2çš„å…¨éƒ¨äºŒçº§ç´¢å¼•è®°å½•**ï¼Œå¹¶ä¸”å¯¹äºè·å–åˆ°çš„æ¯ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•ï¼Œéƒ½éœ€è¦æ‰§è¡Œå›è¡¨æ“ä½œã€‚è¿™ä¸ªä»£ä»·æ¯”æ‰§è¡Œå…¨è¡¨æ‰«æçš„ä»£ä»·éƒ½å¤§ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä¸è€ƒè™‘ä½¿ç”¨uk_key2æ¥æ‰§è¡ŒæŸ¥è¯¢\nä»å¤æ‚çš„æœç´¢æ¡ä»¶ä¸­æ‰¾å‡ºæ‰«æåŒºé—´ # SELECT * FROM single_table WHERE (key1 \u0026gt; \u0026#39;xyz\u0026#39; AND key2 =748) OR (key1\u0026lt;\u0026#39;abc\u0026#39; AND key1 \u0026gt; \u0026#39;lmn\u0026#39;) OR (key1 LIKE \u0026#39;%suf\u0026#39; AND key1 \u0026gt; \u0026#39;zzz\u0026#39; AND (key2 \u0026lt; 8000 OR common_field = \u0026#39;abc\u0026#39;)) åˆ†æï¼š\næ¶‰åŠåˆ°çš„åˆ—ï¼Œä»¥åŠä¸ºå“ªäº›åˆ—å»ºç«‹äº†ç´¢å¼•\nè®¾è®¡key1ï¼Œkey2ï¼Œcommon_fieldè¿™ä¸‰ä¸ªåˆ—ï¼Œå…¶ä¸­key1åˆ—æœ‰æ™®é€šäºŒçº§ç´¢å¼•idx_key1ï¼Œkey2åˆ—æœ‰å”¯ä¸€äºŒçº§ç´¢å¼•uk_key2 å¯¹äºå¯èƒ½ç”¨åˆ°çš„ç´¢å¼•ï¼Œåˆ†æå®ƒä»¬çš„æ‰«æåŒºé—´ å‡è®¾ä½¿ç”¨idx_key1æ‰§è¡ŒæŸ¥è¯¢ # æŠŠä¸èƒ½å½¢æˆåˆé€‚æ‰«æåŒºé—´çš„æœç´¢æ¡ä»¶æš‚æ—¶ç§»é™¤æ‰ï¼šç›´æ¥æ›¿æ¢ä¸ºTRUE\né™¤äº†æœ‰å…³key2å’Œcommon_fieldåˆ—çš„æœç´¢æ¡ä»¶ä¸èƒ½å½¢æˆåˆé€‚çš„æ‰«æåŒºé—´ï¼Œè¿˜æœ‰key1 LIKE \u0026lsquo;%suf\u0026rsquo;å½¢æˆçš„æ‰«æåŒºé—´æ˜¯ï¼ˆ-âˆï¼Œ+âˆï¼‰,æ‰€ä»¥ä¹Ÿéœ€è¦æ›¿æ¢æˆTRUEï¼Œè¿™äº›ä¸èƒ½å½¢æˆåˆé€‚æ‰«æåŒºé—´çš„æœç´¢æ¡ä»¶æ›¿æ¢æˆTRUEä¹‹åï¼Œæœç´¢æ¡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š\nSELECT * FROM single_table WHERE (key1 \u0026gt; \u0026#39;xyz\u0026#39; AND TRUE) OR (key1\u0026lt;\u0026#39;abc\u0026#39; AND key1 \u0026gt; \u0026#39;lmn\u0026#39;) OR (TRUE AND key1 \u0026gt; \u0026#39;zzz\u0026#39; AND (TRUE OR TRUE)) #ç®€åŒ– SELECT * FROM single_table WHERE (key1 \u0026gt; \u0026#39;xyz\u0026#39; ) OR (key1\u0026lt;\u0026#39;abc\u0026#39; AND key1 \u0026gt; \u0026#39;lmn\u0026#39;) OR (key1 \u0026gt; \u0026#39;zzz\u0026#39; AND (TRUE OR TRUE) ) #è¿›ä¸€æ­¥ç®€åŒ– SELECT * FROM single_table WHERE (key1 \u0026gt; \u0026#39;xyz\u0026#39; ) OR (key1\u0026lt;\u0026#39;abc\u0026#39; AND key1 \u0026gt; \u0026#39;lmn\u0026#39;) OR (key1 \u0026gt; \u0026#39;zzz\u0026#39;) #ç”±äºkey1\u0026lt;\u0026#39;abc\u0026#39; AND key1 \u0026gt;\u0026#39;lmn\u0026#39; æ°¸è¿œä¸ºFALSEï¼Œæ‰€ä»¥è¿›ä¸€æ­¥ç®€åŒ– SELECT * FROM single_table WHERE (key1 \u0026gt; \u0026#39;xyz\u0026#39; ) OR (key1 \u0026gt; \u0026#39;zzz\u0026#39;) #ç»§ç»­ç®€åŒ–(å–èŒƒå›´å¤§çš„ï¼Œå³å¹¶é›†) SELECT * FROM single_table WHERE key1 \u0026gt; \u0026#39;xyz\u0026#39; å³å¦‚æœä½¿ç”¨idx_key1ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢ï¼Œåˆ™å¯¹åº”æ‰«æåŒºé—´ä¸º(\u0026lsquo;xyz\u0026rsquo;,+âˆ)ã€‚\nä¹Ÿå°±æ˜¯éœ€è¦æŠŠæ‰€æœ‰æ»¡è¶³key1\u0026gt;\u0026lsquo;xyz\u0026rsquo;æ¡ä»¶çš„æ‰€æœ‰äºŒçº§ç´¢å¼•è®°å½•éƒ½å–å‡ºæ¥ï¼Œé’ˆå¯¹è·å–åˆ°çš„æ¯ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•ï¼Œéƒ½è¦ç”¨å®ƒçš„ä¸»é”®å€¼å†æ‰§è¡Œå›è¡¨æ“ä½œï¼Œåœ¨å¾—åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•ä¹‹åå†ä½¿ç”¨å…¶ä»–çš„æœç´¢æ¡ä»¶è¿›è¡Œè¿‡æ»¤\nä½¿ç”¨idx_key1æ‰§è¡Œä¸Šè¿°æŸ¥è¯¢æ—¶ï¼Œæœç´¢æ¡ä»¶key1 LIKE %sufæ¯”è¾ƒç‰¹æ®Šï¼Œè™½ç„¶ä¸èƒ½ä½œä¸ºå½¢æˆæ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶ï¼Œä½†æ˜¯idx_key1çš„äºŒçº§ç´¢å¼•è®°å½•æ˜¯åŒ…æ‹¬key1åˆ—çš„ï¼Œå› æ­¤å¯ä»¥*å…ˆåˆ¤æ–­è·å–åˆ°çš„äºŒçº§ç´¢å¼•è®°å½•æ˜¯å¦ç¬¦åˆè¿™ä¸ªæ¡ä»¶ï¼Œå¦‚æœç¬¦åˆå†æ‰§è¡Œå›è¡¨æ“ä½œï¼Œå¦‚æœä¸ç¬¦åˆåˆ™ä¸æ‰§è¡Œå›è¡¨æ“ä½œã€‚è¿™å¯å‡å°‘å› å›è¡¨æ“ä½œå¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œè¿™ç§ä¼˜åŒ–æ–¹å¼ç§°ä¸ºç´¢å¼•æ¡ä»¶ä¸‹æ¨\nå‡è®¾ä½¿ç”¨idx_key2æ‰§è¡ŒæŸ¥è¯¢ # å¯¹äºï¼š\nSELECT * FROM single_table WHERE (key1 \u0026gt; \u0026#39;xyz\u0026#39; AND key2 =748) OR (key1\u0026lt;\u0026#39;abc\u0026#39; AND key1 \u0026gt; \u0026#39;lmn\u0026#39;) OR (key1 LIKE \u0026#39;%suf\u0026#39; AND key1 \u0026gt; \u0026#39;zzz\u0026#39; AND (key2 \u0026lt; 8000 OR common_field = \u0026#39;abc\u0026#39;)) ç®€åŒ–\nSELECT * FROM single_table WHERE (TRUE AND key2 =748) OR (TRUE AND TRUE) OR (TRUE AND TRUE AND (key2 \u0026lt; 8000 OR TRUE)) #ç®€åŒ– key2 = 748 OR TRUE #è¿›ä¸€æ­¥ç®€åŒ– TRUE æ„å‘³ç€å¦‚æœè¦ä½¿ç”¨uk_key2ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢ï¼Œåˆ™å¯¹åº”çš„æ‰«æåŒºé—´å°±æ˜¯**ï¼ˆ-âˆï¼Œ+âˆï¼‰ï¼Œå³éœ€è¦æ‰«æuk_key2çš„å…¨éƒ¨äºŒçº§ç´¢å¼•è®°å½•ï¼Œé’ˆå¯¹æ¯ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•è¿˜éœ€è¦å›è¡¨**ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹ä¸ä¼šä½¿ç”¨uk_key2ç´¢å¼•\nä½¿ç”¨è”åˆç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢æ—¶å¯¹åº”çš„æ‰«æåŒºé—´ # è”åˆç´¢å¼•çš„ç´¢å¼•åŒ…å«å¤šä¸ªåˆ—ï¼ŒB+æ ‘ä¸­çš„æ¯ä¸€å±‚é¡µé¢ä»¥åŠæ¯ä¸ªé¡µé¢ä¸­é‡‡ç”¨çš„æ’åºè§„åˆ™è¾ƒä¸ºå¤æ‚ï¼Œä»¥single_tableè¡¨çš„idx_key_partè”åˆç´¢å¼•ä¸ºä¾‹ï¼Œé‡‡ç”¨çš„æ’åºè§„åˆ™å¦‚ä¸‹æ‰€ç¤ºï¼š\nå…ˆæŒ‰ç…§key_part1åˆ—çš„å€¼è¿›è¡Œæ’åº åœ¨key_part1åˆ—çš„å€¼ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œå†æŒ‰ç…§key_part2åˆ—çš„å€¼è¿›è¡Œæ’åº åœ¨key_part1åˆ—å’Œkey_part2åˆ—å€¼éƒ½ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œå†æŒ‰ç…§key_part3åˆ—çš„å€¼è¿›è¡Œæ’åºï¼Œç”»ä¸€ä¸‹idx_key_partç´¢å¼•çš„ç¤ºæ„å›¾ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š\nå¯¹äºæŸ¥è¯¢è¯­å¥Q1(å•æ¡ä»¶) # SELECT * FROM single_table WHERE key_part1 = \u0026#39;a\u0026#39;; ç”±äºäºŒçº§ç´¢å¼•è®°å½•æ˜¯å…ˆæŒ‰ç…§key_part1åˆ—æ’åºçš„ï¼Œæ‰€ä»¥ç¬¦åˆkey_part1=\u0026lsquo;a\u0026rsquo;æ¡ä»¶çš„æ‰€æœ‰è®°å½•è‚¯å®šæ˜¯ç›¸é‚»çš„ã€‚æˆ‘ä»¬å¯ä»¥å®šä½åˆ°ç¬¦åˆkey_part1=\u0026lsquo;a\u0026rsquo;æ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œç„¶åæ²¿ç€è®°å½•æ‰€åœ¨çš„å•å‘é“¾è¡¨å‘åæ‰«æ(å¦‚æœæœ¬é¡µé¢ä¸­çš„è®°å½•æ‰«æå®Œäº†ï¼Œå°±æ ¹æ®å¶å­èŠ‚ç‚¹çš„åŒå‘é“¾è¡¨æ‰¾åˆ°ä¸‹ä¸€ä¸ªé¡µé¢ä¸­çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œç»§ç»­æ²¿ç€è®°å½•æ‰€åœ¨çš„å•å‘é“¾è¡¨å‘åæ‰«æã€‚æˆ‘ä»¬ä¹‹åå°±ä¸å¼ºè°ƒå¶å­èŠ‚ç‚¹çš„åŒå‘é“¾è¡¨äº†ï¼‰ï¼Œç›´åˆ°æŸæ¡è®°å½•ä¸ç¬¦åˆkey_part=\u0026lsquo;a\u0026rsquo;æ¡ä»¶ä¸ºæ­¢ï¼ˆå½“ç„¶ï¼Œå¯¹äºè·å–åˆ°çš„æ¯ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•éƒ½è¦æ‰§è¡Œå›è¡¨æ“ä½œï¼‰ã€‚è¿‡ç¨‹å¦‚å›¾æ‰€ç¤º\nä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½¿ç”¨idx_key_partç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢è¯­å¥Q1ï¼Œå¯¹åº”çš„æ‰«æåŒºé—´æ˜¯**[\u0026lsquo;a\u0026rsquo;,\u0026lsquo;a\u0026rsquo;]ï¼Œå½¢æˆè¿™ä¸ªæ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶**å°±æ˜¯key_part=\u0026lsquo;a\u0026rsquo;\nå¯¹äºæŸ¥è¯¢æ¡ä»¶Q2(é¡ºåº2æ¡ä»¶) # SELECT * FROM single_table WHERE key_part1=\u0026#39;a\u0026#39; AND key_part2=\u0026#39;b\u0026#39;; ç”±äºäºŒçº§ç´¢å¼•è®°å½•æ˜¯å…ˆæŒ‰ç…§key_part1åˆ—çš„å€¼æ’åºçš„ï¼Œ åœ¨key_part1åˆ—çš„å€¼ç›¸ç­‰çš„æƒ…å†µä¸‹å†æŒ‰ç…§key_part2åˆ—è¿›è¡Œæ’åºï¼Œæ‰€ä»¥ç¬¦åˆkey_part1=\u0026lsquo;a\u0026rsquo; AND key_part2=\u0026lsquo;b\u0026rsquo;æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•è‚¯å®šæ˜¯ç›¸é‚»çš„ã€‚ æˆ‘ä»¬å¯ä»¥å®šä½åˆ°ç¬¦åˆkey_part1=\u0026lsquo;a\u0026rsquo; AND key_part2=\u0026lsquo;b\u0026rsquo;æ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œç„¶åæ²¿ç€è®°å½•æ‰€åœ¨çš„å•å‘é“¾è¡¨å‘åæ‰«æï¼Œç›´åˆ°æŸæ¡è®°å½•ä¸ç¬¦åˆkey_part1=\u0026lsquo;a\u0026rsquo;æ¡ä»¶æˆ–è€…key_part2=\u0026lsquo;b\u0026rsquo;æ¡ä»¶ä¸ºæ­¢(å½“ç„¶ï¼Œå¯¹äºè·å–åˆ°çš„æ¯ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•éƒ½è¦æ‰§è¡Œå›è¡¨æ“ä½œï¼Œè¿™é‡Œå°±ä¸å±•ç¤ºäº†) ï¼Œå¦‚å›¾7-12 æ‰€ç¤ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½¿ç”¨idx_key_partç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢è¯­å¥Q2 ï¼Œå¯ä»¥å½¢æˆæ‰«æåŒºé—´**[(\u0026lsquo;a\u0026rsquo;,\u0026lsquo;b\u0026rsquo;),(\u0026lsquo;a\u0026rsquo;,\u0026lsquo;b\u0026rsquo;)]**ï¼Œå½¢æˆè¿™ä¸ªæ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶å°±æ˜¯ key_part1=\u0026lsquo;a\u0026rsquo; AND key_part2=\u0026lsquo;b\u0026rsquo;\n[(\u0026lsquo;a\u0026rsquo;,\u0026lsquo;b\u0026rsquo;),(\u0026lsquo;a\u0026rsquo;,\u0026lsquo;b\u0026rsquo;)] ä»£è¡¨åœ¨idx_key_partç´¢å¼•ä¸­ï¼Œä»ç¬¬ä¸€æ¡ç¬¦åˆkey_part1=\u0026lsquo;a\u0026rsquo; AND key_part2=\u0026lsquo;b\u0026rsquo; æ¡ä»¶çš„è®°å½•å¼€å§‹ï¼Œåˆ°æœ€åä¸€æ¡ç¬¦åˆkey_part1=\u0026lsquo;a\u0026rsquo; AND key_part2=\u0026lsquo;b\u0026rsquo;æ¡ä»¶çš„è®°å½•ä¸ºæ­¢çš„æ‰€æœ‰äºŒçº§ç´¢å¼•è®°å½•ã€‚\nå¯¹äºæŸ¥è¯¢æ¡ä»¶Q3(é¡ºåº3æ¡ä»¶) # SELECT * FROM single_table WHERE key_part1=\u0026#39;a\u0026#39; AND key_part2=\u0026#39;b\u0026#39; AND key_part3=\u0026#39;c\u0026#39;; ç”±äºäºŒçº§ç´¢å¼•è®°å½•æ˜¯å…ˆæŒ‰ç…§ key_part1åˆ—çš„å€¼æ’åºçš„ï¼Œåœ¨key_part1åˆ—çš„å€¼ç›¸ç­‰çš„æƒ…å†µä¸‹å†æŒ‰ç…§key_part2åˆ—è¿›è¡Œæ’åºï¼šåœ¨key_part1å’Œkey_part2åˆ—çš„å€¼éƒ½ç›¸ç­‰çš„æƒ…å†µä¸‹ï¼Œ å†æŒ‰ç…§key_part3åˆ—è¿›è¡Œæ’åºï¼Œæ‰€ä»¥ç¬¦åˆkey_part1=\u0026lsquo;a\u0026rsquo; AND key_part2=\u0026lsquo;b\u0026rsquo; AND key_part3=\u0026lsquo;c\u0026rsquo;æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•è‚¯å®šæ˜¯ç›¸é‚»çš„ã€‚\næˆ‘ä»¬å¯ä»¥å®šä½åˆ°ç¬¦åˆkey_part1=\u0026lsquo;a\u0026rsquo; AND key_part2 = \u0026lsquo;b\u0026rsquo; AND key_part3=\u0026lsquo;c\u0026rsquo;æ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œç„¶åæ²¿ç€è®°å½•æ‰€åœ¨çš„å•å‘é“¾è¡¨å‘åæ‰«æï¼Œç›´åˆ°æŸæ¡è®°å½•ä¸ç¬¦åˆkey_part1=\u0026lsquo;a\u0026rsquo;æ¡ä»¶æˆ–è€…key_part2=\u0026lsquo;b\u0026rsquo;æ¡ä»¶æˆ–è€…key_part3æ¡ä»¶ä¸ºæ­¢(å½“ç„¶ï¼Œå¯¹äºè·å–åˆ°çš„æ¯ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•éƒ½è¦æ‰§è¡Œå›è¡¨æ“ä½œ)ã€‚è¿™é‡Œå°±ä¸å†ç”»ç¤ºæ„å›¾äº†ã€‚\nå¦‚æœä½¿ç”¨idx_key_partç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢è¯­å¥Q3 ï¼Œå¯ä»¥å½¢æˆæ‰«æåŒºé—´**[(\u0026lsquo;a\u0026rsquo;,\u0026lsquo;b\u0026rsquo;,\u0026lsquo;c\u0026rsquo;)ï¼Œ(\u0026lsquo;a\u0026rsquo;,\u0026lsquo;b\u0026rsquo;,\u0026lsquo;c\u0026rsquo;)]** ,å½¢æˆè¿™ä¸ªæ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶å°±æ˜¯key_part1=\u0026lsquo;a\u0026rsquo; AND key_part2 = \u0026lsquo;b\u0026rsquo; AND key_part3=\u0026lsquo;c\u0026rsquo;\nå¯¹äºæŸ¥è¯¢è¯­å¥Q4(å•æ¡ä»¶èŒƒå›´) # SELECT * FROM single_table WHERE key_part1 \u0026lt; \u0026#39;a\u0026#39;; ç”±äºäºŒçº§ç´¢å¼•è®°å½•æ˜¯å…ˆæŒ‰ç…§key_part1åˆ—çš„å€¼è¿›è¡Œæ’åºçš„ï¼Œæ‰€ä»¥ç¬¦åˆkey_part1\u0026lt;\u0026lsquo;a\u0026rsquo;æ¡ä»¶çš„æ‰€æœ‰è®°å½•è‚¯å®šæ˜¯ç›¸é‚»çš„ã€‚æˆ‘ä»¬å¯ä»¥å®šä½åˆ°ç¬¦åˆkey_part1\u0026lt;\u0026lsquo;a\u0026rsquo;æ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•(å…¶å®å°±æ˜¯idx_key_part ç´¢å¼•ç¬¬ä¸€ä¸ªå¶å­èŠ‚ç‚¹çš„ç¬¬ä¸€æ¡è®°å½•) ï¼Œç„¶åæ²¿ç€è®°å½•æ‰€åœ¨çš„å•å‘é“¾è¡¨å‘åæ‰«æï¼Œç›´åˆ°æŸæ¡è®°å½•ä¸ç¬¦åˆkey_part1\u0026lt; \u0026lsquo;a\u0026rsquo; æ¡ä»¶ä¸ºæ­¢(å½“ç„¶ï¼Œå¯¹äºè·å–åˆ°çš„æ¯ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•éƒ½è¦æ‰§è¡Œå›è¡¨æ“ä½œï¼Œè¿™é‡Œå°±ä¸å±•ç¤ºäº†) ï¼Œå¦‚å›¾7- 13 æ‰€ç¤º\nä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½¿ç”¨idx_key_partç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢è¯­å¥Q4ï¼Œå¯ä»¥å½¢æˆæ‰«æåŒºé—´ï¼ˆ-âˆï¼Œ\u0026lsquo;a\u0026rsquo;)ï¼Œå½¢æˆè¿™ä¸ªæ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶å°±æ˜¯key_part1\u0026lt;\u0026lsquo;a\u0026rsquo;\næŸ¥è¯¢è¯­å¥Q5ï¼ˆæ¡ä»¶1ç­‰å€¼ï¼Œæ¡ä»¶2èŒƒå›´ï¼‰ # SELECT * FROM single_table WHERE key_part1=\u0026#39;a\u0026#39; AND key_part2 \u0026gt; \u0026#39;a\u0026#39; AND key_part2 \u0026lt; \u0026#39;d\u0026#39;; ç”±äºäºŒçº§ç´¢å¼•è®°å½•æ˜¯å…ˆæŒ‰ç…§key_part1åˆ—çš„å€¼è¿›è¡Œæ’åºçš„ï¼Œåœ¨key_part1åˆ—çš„å€¼ç›¸ç­‰çš„æƒ…å†µä¸‹å†æŒ‰ç…§key_part2åˆ—è¿›è¡Œæ’åºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ç¬¦åˆkey_part1=\u0026lsquo;a\u0026rsquo;æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•ä¸­ï¼Œè¿™äº›è®°å½•æ˜¯æŒ‰ç…§key_part2 åˆ—çš„å€¼æ’åºçš„ï¼Œ é‚£ä¹ˆæ­¤æ—¶ç¬¦åˆkey_part1=\u0026lsquo;a\u0026rsquo; AND key_part2\u0026gt;\u0026lsquo;a\u0026rsquo; AND key_part2 \u0026lt; \u0026rsquo;d\u0026rsquo;æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•è‚¯å®šæ˜¯ç›¸é‚»çš„ã€‚æˆ‘ä»¬å¯ä»¥å®šä½åˆ°ç¬¦åˆ key_part1=\u0026lsquo;a\u0026rsquo; AND key_part2\u0026gt;\u0026lsquo;a\u0026rsquo; AND key_part2 \u0026lt; \u0026rsquo;d\u0026rsquo;æ¡ä»¶çš„ç¬¬-æ¡è®°å½•(å…¶å®ç¬¬ä¸€æ¡å°±æ˜¯key_part1=\u0026lsquo;a\u0026rsquo; AND key_part2 = \u0026lsquo;a\u0026rsquo; )ï¼Œ ç„¶åæ²¿ç€è®°å½•æ‰€åœ¨çš„å•å‘é“¾è¡¨å‘åæ‰«æï¼Œ ç›´åˆ°æŸæ¡è®°å½•ä¸ç¬¦åˆkey_part1=\u0026lsquo;a\u0026rsquo; æˆ–è€…key_part2\u0026gt;\u0026lsquo;a\u0026rsquo; æˆ–è€…**key_part2 \u0026lt; \u0026rsquo;d\u0026rsquo;**æ¡ä»¶ä¸ºæ­¢(å½“ç„¶ï¼Œå¯¹äºè·å–åˆ°çš„æ¯ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•éƒ½è¦æ‰§è¡Œå›è¡¨æ“ä½œï¼Œ è¿™é‡Œå°±ä¸å±•ç¤ºäº†) ï¼Œå¦‚å›¾7- 1 4 æ‰€ç¤º\nä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½¿ç”¨idx_key_partç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢è¯­å¥Q5ï¼Œå¯ä»¥å½¢æˆæ‰«æåŒºé—´**((\u0026lsquo;a\u0026rsquo;,\u0026lsquo;a\u0026rsquo;),(\u0026lsquo;a\u0026rsquo;,\u0026rsquo;d\u0026rsquo;))ï¼Œå½¢æˆè¿™ä¸ªæ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶å°±æ˜¯key_part1=\u0026lsquo;a\u0026rsquo; AND key_part2\u0026gt;\u0026lsquo;a\u0026rsquo; AND key_part2\u0026lt;\u0026rsquo;d\u0026rsquo;**ã€‚\næŸ¥è¯¢è¯­å¥Q6ï¼ˆæ¡ä»¶2ç­‰å€¼=\u0026gt;ç”¨ä¸ä¸Šç´¢å¼•ï¼‰ # ç”±äºäºŒçº§ç´¢å¼•è®°å½•ä¸æ˜¯ç›´æ¥æŒ‰ç…§key_part2åˆ—çš„å€¼æ’åºçš„ï¼Œæ‰€ä»¥ç¬¦åˆkey_part2åˆ—çš„äºŒçº§ç´¢å¼•è®°å½•å¯èƒ½å¹¶ä¸ç›¸é‚»ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬ä¸èƒ½é€šè¿‡è¿™ä¸ªkey_part2=\u0026lsquo;a\u0026rsquo; æœç´¢æ¡ä»¶æ¥å‡å°‘éœ€è¦æ‰«æçš„è®°å½•æ•°é‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯ä¸ä¼šä½¿ç”¨idx_key_part ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢çš„\næŸ¥è¯¢è¯­å¥Q7ï¼ˆæ¡ä»¶1ç­‰å€¼ï¼Œæ¡ä»¶3ç­‰å€¼=\u0026gt;åªæœ‰å‰é¢çš„æ¡ä»¶æ˜¯è¾¹ç•Œæ¡ä»¶ï¼‰ # SELECT * FROM single_table WHERE key_part=\u0026#39;a\u0026#39; AND key_part3=\u0026#39;c\u0026#39; ç”±äºäºŒçº§ç´¢å¼•è®°å½•æ˜¯å…ˆæŒ‰ç…§key_part1åˆ—çš„å€¼æ’åºçš„ï¼Œæ‰€ä»¥ç¬¦åˆkey_part1=\u0026lsquo;a\u0026rsquo;æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•è‚¯å®šæ˜¯ç›¸é‚»çš„ã€‚ä½†æ˜¯å¯¹äºç¬¦åˆkey_part3 =\u0026lsquo;c\u0026rsquo;æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•æ¥è¯´ï¼Œå¹¶ä¸æ˜¯ç›´æ¥æŒ‰ç…§key_part3åˆ—è¿›è¡Œæ’åºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸èƒ½æ ¹æ®æœç´¢æ¡ä»¶key_part3=\u0026lsquo;c\u0026rsquo;æ¥è¿›ä¸€æ­¥å‡å°‘éœ€è¦æ‰«æçš„è®°å½•æ•°é‡ã€‚é‚£ä¹ˆï¼Œå¦‚æœä½¿ç”¨idx_key_part ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢ï¼Œå¯ä»¥å®šä½åˆ°ç¬¦åˆkey_part1 = \u0026lsquo;a\u0026rsquo;æ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œç„¶åæ²¿ç€è®°å½•æ‰€åœ¨çš„å•å‘é“¾è¡¨å‘åæ‰«æï¼Œç›´åˆ°æŸæ¡è®°å½•ä¸ç¬¦åˆkey_part1 = \u0026lsquo;a\u0026rsquo;æ¡ä»¶ä¸ºæ­¢ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨idx_key_partç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢è¯­å¥Q7 çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹åº”çš„æ‰«æåŒºé—´å…¶å®æ˜¯**[\u0026lsquo;a\u0026rsquo;,\u0026lsquo;a\u0026rsquo;]ï¼Œå½¢æˆè¯¥æ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶æ˜¯ key_part1=\u0026lsquo;a\u0026rsquo;ï¼Œä¸key_part3=\u0026lsquo;c\u0026rsquo;**æ— å…³ã€‚\nç´¢å¼•æ¡ä»¶ä¸‹æ¨ç‰¹æ€§ï¼ŒMySQL5.6ä¸­å¼•å…¥ï¼Œé»˜è®¤å¼€å¯\né’ˆå¯¹è·å–åˆ°çš„æ¯ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯ç´¢å¼•æ¡ä»¶ä¸‹æ¨ç‰¹æ€§ï¼Œåˆ™å¿…é¡»å…ˆæ‰§è¡Œå›è¡¨æ“ä½œï¼Œåœ¨è·å–åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•åå†åˆ¤æ–­key_part3=\u0026lsquo;c\u0026rsquo;æ¡ä»¶æ˜¯å¦æˆç«‹ã€‚å¦‚å‘†å¼€å¯äº†ç´¢å¼•æ¡ä»¶ä¸‹æ¨ç‰¹æ€§ï¼Œå¯ä»¥ç«‹å³åˆ¤æ–­è¯¥äºŒçº§ç´¢å¼•è®°å½•æ˜¯å¦ç¬¦åˆkey_part3=\u0026lsquo;c\u0026rsquo;æ¡ä»¶ã€‚å¦‚æœç¬¦åˆè¯¥æ¡ä»¶ï¼Œåˆ™å†æ‰§è¡Œå›è¡¨æ“ä½œï¼›å¦‚æœä¸ç¬¦åˆåˆ™ä¸æ‰§è¡Œå›å†œæ“ä½œï¼Œç›´æ¥è·³åˆ°ä¸‹ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•ã€‚\næŸ¥è¯¢è¯­å¥Q8ï¼ˆæ¡ä»¶1èŒƒå›´ï¼Œæ¡ä»¶2ç­‰å€¼=\u0026gt;åªæœ‰å‰é¢çš„æ¡ä»¶æ˜¯è¾¹ç•Œæ¡ä»¶ï¼‰ # SELECT * FROM single_table WHERE key_part \u0026lt; \u0026#39;b\u0026#39; AND key_part2=\u0026#39;a\u0026#39; ç”±äºäºŒçº§ç´¢å¼•è®°å½•æ˜¯å…ˆæŒ‰ç…§key_part1åˆ—çš„å€¼æ’åºçš„ï¼Œæ‰€ä»¥ç¬¦åˆkey_part1\u0026lt;\u0026lsquo;b\u0026rsquo;æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•è‚¯å®šæ˜¯ç›¸é‚»çš„ã€‚ä½†æ˜¯å¯¹äºç¬¦åˆkey_part2 =\u0026lsquo;a\u0026rsquo;æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•æ¥è¯´ï¼Œå¹¶ä¸æ˜¯ç›´æ¥æŒ‰ç…§key_part2åˆ—è¿›è¡Œæ’åºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸èƒ½æ ¹æ®æœç´¢æ¡ä»¶key_part2=\u0026lsquo;a\u0026rsquo;æ¥è¿›ä¸€æ­¥å‡å°‘éœ€è¦æ‰«æçš„è®°å½•æ•°é‡ã€‚é‚£ä¹ˆï¼Œå¦‚æœä½¿ç”¨idx_key_part ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢ï¼Œå¯ä»¥å®šä½åˆ°ç¬¦åˆkey_part1 \u0026lt; \u0026lsquo;b\u0026rsquo;\u0026lsquo;æ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•ï¼ˆå…¶å®å°±æ˜¯idx_key_partç´¢å¼•çš„ç¬¬ä¸€ä¸ªå¶å­èŠ‚ç‚¹çš„ç¬¬ä¸€æ¡è®°å½•ï¼‰ï¼Œç„¶åæ²¿ç€è®°å½•æ‰€åœ¨çš„å•å‘é“¾è¡¨å‘åæ‰«æï¼Œç›´åˆ°æŸæ¡è®°å½•ä¸ç¬¦åˆkey_part1\u0026lt;\u0026lsquo;b\u0026rsquo;æ¡ä»¶ä¸ºæ­¢ã€‚å¦‚å›¾ï¼š\næ‰€ä»¥åœ¨ä½¿ç”¨idx_key_partç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢è¯­å¥Q8 çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹åº”çš„æ‰«é”šåŒºé—´å…¶å®æ˜¯[- âˆï¼Œ\u0026lsquo;b\u0026rsquo;]ï¼Œå½¢æˆè¯¥æ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶æ˜¯key_part1 \u0026lt; \u0026lsquo;b\u0026rsquo; ï¼Œ ä¸ key_part2=\u0026lsquo;a\u0026rsquo;æ— å…³\næŸ¥è¯¢è¯­å¥Q9ï¼ˆæ¡ä»¶1èŒƒå›´(åŒ…æ‹¬ç­‰å·)ï¼Œæ¡ä»¶2ç­‰å€¼ï¼‰ # SELECT * FROM single_table WHERE key_part1 \u0026lt;= \u0026#39;b\u0026#39; AND key_part2=\u0026#39;a\u0026#39; Q8å’ŒQ9å¾ˆåƒï¼Œä½†æ˜¯åœ¨æ¶‰åŠkey_part1æ¡ä»¶æ—¶ï¼ŒQ8ä¸­çš„æ¡ä»¶æ˜¯key_part1\u0026lt;\u0026lsquo;b\u0026rsquo;ï¼ŒQ9ä¸­çš„æ¡ä»¶æ˜¯key_part1\u0026lt;=\u0026lsquo;b\u0026rsquo;ã€‚å¾ˆæ˜¾ç„¶ï¼Œç¬¦åˆkey_part1=\u0026lsquo;b\u0026rsquo;æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•æ˜¯ç›¸é‚»çš„ã€‚ä½†æ˜¯å¯¹äºç¬¦åˆkey_part1\u0026lt;=\u0026lsquo;b\u0026rsquo;æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•æ¥è¯´ï¼Œå¹¶ä¸æ˜¯ç›´æ¥æŒ‰ç…§key_part2åˆ—æ’åºçš„ã€‚ä½†æ˜¯ï¼Œå¯¹äºç¬¦åˆkey_part1=\u0026lsquo;b\u0026rsquo;çš„äºŒçº§ç´¢å¼•è®°å½•æ¥è¯´ï¼Œæ˜¯æŒ‰ç…§key_part2åˆ—çš„å€¼æ’åºçš„ã€‚é‚£ä¹ˆåœ¨ç¡®å®šéœ€è¦æ‰«æçš„äºŒçº§ç´¢å¼•è®°å½•çš„èŒƒå›´æ—¶ï¼Œå½“äºŒçº§ç´¢å¼•è®°å½•çš„key_part1åˆ—å€¼ä¸º\u0026rsquo;b\u0026rsquo; æ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡key_part2=\u0026lsquo;b\u0026rsquo; æ¡ä»¶å‡å°‘éœ€è¦æ‰«æçš„äºŒçº§ç´¢å¼•è®°å½•èŒƒå›´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ å½“æ‰«æåˆ°ä¸ç¬¦åˆkey_part1=\u0026lsquo;b\u0026rsquo; AND key_part2=\u0026lsquo;a\u0026rsquo; æ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•æ—¶ï¼Œå°±å¯ä»¥ç»“æŸæ‰«æï¼Œè€Œä¸éœ€è¦å°†æ‰€æœ‰key_part1åˆ—å€¼ä¸º\u0026rsquo;b\u0026rsquo;çš„è®°å½•æ‰«æå®Œã€‚\næ³¨æ„ï¼Œå½“æ‰«æåˆ°è®°å½•çš„åˆ—key_part1å€¼ä¸ºbæ—¶ï¼Œä¸èƒ½ç›´æ¥å®šä½åˆ°**key_part2=\u0026lsquo;a\u0026rsquo;çš„æ•°æ®äº†ï¼Œä½†æ˜¯å¯ä»¥æ‰«æåˆ°key_part2=\u0026lsquo;a\u0026rsquo;**åœæ­¢\nä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½¿ç”¨idx_key_partç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢è¯­å¥Q9ï¼Œå¯ä»¥å½¢æˆæ‰«æåŒºé—´ï¼ˆ(-âˆï¼Œ-âˆ),(\u0026lsquo;b\u0026rsquo;,\u0026lsquo;a\u0026rsquo;)ï¼‰ï¼Œå½¢æˆè¿™ä¸ªæ‰«æåŒºé—´çš„è¾¹ç•Œæ¡ä»¶å°±æ˜¯key_part1\u0026lt;=\u0026lsquo;b\u0026rsquo; AND key_part2=\u0026lsquo;a\u0026rsquo;ã€‚è€Œåœ¨æ‰§è¡ŒæŸ¥è¯¢è¯­å¥Q8æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»å°†æ‰€æœ‰ç¬¦åˆ**key_part1\u0026lt;\u0026lsquo;b\u0026rsquo;**çš„è®°å½•éƒ½æ‰«æå®Œï¼Œ**key_part2=\u0026lsquo;a\u0026rsquo;**æ¡ä»¶åœ¨æŸ¥è¯¢è¯­å¥Q8ä¸­å¹¶ä¸èƒ½èµ·åˆ°å‡å°‘éœ€è¦æ‰«æçš„äºŒçº§ç´¢å¼•èŒƒå›´çš„ä½œç”¨\næ³¨æ„ï¼Œå¯¹äºQ9ï¼Œkey_part1\u0026lt;\u0026lsquo;b\u0026rsquo;çš„è®°å½•ä¹Ÿæ˜¯è¦æ‰«æå®Œçš„ã€‚è¿™é‡Œä»…ä»…å¯¹key_part1=\u0026lsquo;b\u0026rsquo;èµ·äº†å‡å°‘æ‰«æäºŒçº§ç´¢å¼•èŒƒå›´çš„ä½œç”¨ã€‚\nç´¢å¼•ç”¨äºæ’åº # æˆ‘ä»¬åœ¨ç¼–å†™æŸ¥è¯¢è¯­å¥æ—¶ï¼Œç»å¸¸éœ€è¦ä½¿ç”¨ORDERBYå­å¥å¯¹æŸ¥è¯¢å‡ºæ¥çš„è®°å½•æŒ‰ç…§æŸç§è§„åˆ™è¿›è¡Œæ’åºã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªèƒ½æŠŠè®°å½•åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åå†ç”¨ä¸€äº›æ’åºç®—æ³•åœ¨å†…å­˜ä¸­å¯¹è¿™äº›è®°å½•è¿›è¡Œæ’åºã€‚æœ‰æ—¶æŸ¥è¯¢çš„ç»“æœé›†å¯èƒ½å¤ªå¤§ä»¥è‡³äºæ— æ³•åœ¨å†…å­˜ä¸­è¿›è¡Œæ’åºï¼Œæ­¤æ—¶å°±éœ€è¦æš‚æ—¶å€ŸåŠ©ç£ç›˜çš„ç©ºé—´æ¥å­˜æ”¾ä¸­é—´ç»“æœï¼Œåœ¨æ’åºæ“ä½œå®Œæˆåå†æŠŠæ’å¥½åºçš„ç»“æœé›†è¿”å›å®¢æˆ·ç«¯ã€‚åœ¨MySQL ä¸­ï¼Œè¿™ç§åœ¨å†…å­˜æˆ–è€…ç£ç›˜ä¸­è¿›è¡Œæ’åºçš„æ–¹å¼ç»Ÿç§°ä¸ºæ–‡ä»¶æ’åº(fÃ¬lesort)ã€‚ä½†æ˜¯ï¼Œå¦‚æœORDERBYå­å¥ä¸­ä½¿ç”¨äº†ç´¢å¼•åˆ—ï¼Œå°±æœ‰å¯èƒ½çœå»åœ¨å†…å­˜æˆ–ç£ç›˜ä¸­æ’åºçš„æ­¥éª¤ã€‚\nä¸¾ä¾‹ï¼š\nSELECT * FROM single_table ORDER BY key_part1,key_part2,key_part3 LIMIT 10; è¿™ä¸ªæŸ¥è¯¢è¯­å¥çš„ç»“æœé›†éœ€è¦å…ˆæŒ‰ç…§key_part1 å€¼æ’åºã€‚å¦‚æœè®°å½•çš„key_part1 å€¼ç›¸åŒï¼Œå†æŒ‰ç…§key_part2å€¼æ’åºï¼Œå¦‚æœè®°å½•çš„key_part1 å’Œkey_part2å€¼éƒ½ç›¸åŒï¼Œå†æŒ‰ç…§key_part3 å€¼æ’åºã€‚å¤§å®¶å¯ä»¥å›è¿‡å¤´å»çœ‹çœ‹å›¾7-10ã€‚\nè¯¥äºŒçº§ç´¢å¼•çš„è®°å½•æœ¬èº«å°±æ˜¯æŒ‰ç…§ä¸Šè¿°è§„åˆ™æ’å¥½åºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ ä»¥ä»ç¬¬ä¸€æ¡idx_key_partäºŒçº§ç´¢å¼•è®°å½•å¼€å§‹ï¼Œæ²¿ç€è®°å½•æ‰€åœ¨çš„å•å‘é“¾è¡¨å‘åæ‰«æï¼Œå–10 æ¡äºŒçº§ç´¢å¼•è®°å½•å³å¯ã€‚å½“ç„¶ï¼Œé’ˆå¯¹è·å–åˆ°çš„æ¯ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•éƒ½æ‰§è¡Œä¸€æ¬¡å›è¡¨æ“ä½œï¼Œåœ¨è·å–åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•ä¹‹åå‘é€ç»™å®¢æˆ·ç«¯å°±å¥½äº†ã€‚è¿™æ ·æ˜¯ä¸æ˜¯å°±å˜å¾—ç®€å•å¤šäº†ï¼Œè¿˜çœå»äº†æˆ‘ä»¬ç»™10000æ¡è®°å½•æ’åºçš„æ—¶é—´\u0026ndash;ç´¢å¼•å°±æ˜¯è¿™ä¹ˆå‰å®³!\nå…³äºå›è¡¨æ“ä½œï¼š è¯·æ³¨æ„ï¼Œæœ¬ä¾‹çš„æŸ¥è¯¢è¯­å¥ä¸­åŠ äº†LIMIT å­å¥ï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœä¸é™åˆ¶éœ€è¦è·å–çš„è®°å½•æ•°é‡ï¼Œä¼šå¯¼è‡´ä¸ºå¤§é‡äºŒçº§ç´¢å¼•è®°å½•æ‰§è¡Œå›è¡¨æ“ä½œï¼Œè¿™æ ·ä¼šå½±å“æ•´ä½“çš„æŸ¥è¯¢æ€§èƒ½ã€‚å…³äºå›è¡¨æ“ä½œé€ æˆçš„å½±å“ï¼Œæˆ‘ä»¬ç¨åå†è¯¦ç»†å” å¨\nä½¿ç”¨è”åˆç´¢å¼•è¿›è¡Œæ’åºæ—¶çš„æ³¨æ„äº‹é¡¹ # ORDER BYå­å¥åé¢çš„åˆ—é¡ºåºä¹Ÿå¿…é¡»æŒ‰ç…§ç´¢å¼•åˆ—çš„é¡ºåºç»™å‡º\nå¦‚æœç»™å‡ºORDER BY key_part3,key_part2,key_part1çš„é¡ºåºï¼Œåˆ™æ— æ³•ä½¿ç”¨B+æ ‘ç´¢å¼•ã€‚\nå¦‚æœæ˜¯ORDER BY key_part1 DESC,key_part2 DESC,key_part3 DESC ï¼Œé‚£ä¹ˆåº”è¯¥æ˜¯å¯ä»¥çš„ï¼Œä¹Ÿå°±æ˜¯ORDER BY key_part1,key_part2,key_part3çš„å…¨ååº\nä¹‹æ‰€ä»¥é¢ å€’çš„æ’åºåˆ—é¡ºåºä¸èƒ½ä½¿ç”¨ç´¢å¼•ï¼ŒåŸå› è¿˜æ˜¯è”åˆç´¢å¼•ä¸­é¡µé¢å’Œè®°å½•çš„æ’åºè§„åˆ™æ˜¯å›ºå®šçš„ï¼Œä¹Ÿå°±æ˜¯å…ˆæŒ‰ç…§key_part1å€¼æ’åºï¼Œå¦‚æœkey_part1å€¼ç›¸åŒï¼Œå†æŒ‰ç…§key_part2å€¼æ’åºï¼›å¦‚æœkey_part1å’Œkey_part2å€¼éƒ½ç›¸åŒï¼Œå†æŒ‰ç…§key_part2å€¼æ’åºã€‚\nå¦‚æœORDER BYå­å¥çš„å†…å®¹æ˜¯ORDER BY key_part3 , key_part2 , key_part,é‚£å°±è¦æ±‚å…ˆè¦key_part3å€¼æ’åºï¼ˆå‡åºï¼‰ï¼Œå¦‚æœkey_part3ç›¸åŒï¼Œå†æŒ‰key_part2å‡åºï¼Œå¦‚æœkey_part3å’Œkey_part3éƒ½ç›¸åŒï¼Œå†æŒ‰ç…§key_part1å‡åº\nåŒç†ï¼Œè¿™äº›ä»…å¯¹è”åˆç´¢å¼•çš„ç´¢å¼•åˆ—ä¸­å·¦è¾¹è¿ç»­çš„åˆ—è¿›è¡Œæ’åºçš„å½¢å¼ï¼ˆå¦‚ORDER BY key_part1å’ŒORDER BY key_part1,key_part2ï¼‰ï¼Œä¹Ÿæ˜¯å¯ä»¥åˆ©ç”¨B+æ ‘ç´¢å¼•çš„ã€‚å¦å¤–ï¼Œå½“è¿ç»­ç´¢å¼•çš„ç´¢å¼•åˆ—å·¦è¾¹è¿ç»­çš„åˆ—ä¸ºå¸¸é‡æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è”åˆç´¢å¼•å¯¹å³è¾¹çš„åˆ—è¿›è¡Œæ’åº\nSELECT * FROM single_table WHERE key_part1=\u0026#39;a\u0026#39; AND key_part2=\u0026#39;b\u0026#39; ORDER BY key_part3 LIMIT 10 èƒ½ä½¿ç”¨è”åˆç´¢å¼•æ’åºï¼ŒåŸå› æ˜¯key_part1å€¼ä¸º\u0026rsquo;a\u0026rsquo;ã€key_part2å€¼ä¸º\u0026rsquo;b\u0026rsquo;çš„äºŒçº§ç´¢å¼•è®°å½•æœ¬èº«å°±æ˜¯æŒ‰ç…§key_part3åˆ—çš„å€¼è¿›è¡Œæ’åºçš„\nä¸èƒ½ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åºçš„å‡ ç§æƒ…å†µ # ASCã€DESCæ··ç”¨ # æˆ‘ä»¬è¦æ±‚å„ä¸ªæ’åºåˆ—çš„æ’åºé¡ºåºè§„åˆ™æ˜¯ä¸€è‡´çš„ï¼Œè¦ä¹ˆå„ä¸ªåˆ—éƒ½æ˜¯æŒ‰ç…§ASC(å‡åº)ï¼Œè¦ä¹ˆéƒ½æ˜¯æŒ‰ç…§DESCï¼ˆé™åºï¼‰è§„åˆ™æ’åº\nä¸ºä»€ä¹ˆå‘¢ï¼š\nidx_key_partè”åˆç´¢å¼•ä¸­çš„äºŒçº§ç´¢å¼•è®°å½•çš„æ’åºè§„åˆ™ï¼šå…ˆkey_part1å‡åºï¼Œkey_part1ç›¸åŒåˆ™key_part2å‡åºï¼Œå¦‚æœéƒ½ç›¸åŒåˆ™key_part3å‡åº\nå¦‚æœORDER BY key_part1,key_part2 LIMIT10,é‚£ä¹ˆç›´æ¥ä»è”åˆç´¢å¼•æœ€å·¦è¾¹çš„äºŒçº§ç´¢å¼•è®°å½•å¼€å§‹ï¼Œå‘å³è¯»å–10æ¡å³å¯\nå¦‚æœORDER BY key_part1 DESC,key_part2 DESC LIMIT 10ï¼Œå¯ä»¥ä»è”åˆç´¢å¼•æœ€å³è¾¹çš„é‚£æ¡äºŒçº§ç´¢å¼•è®°å½•å¼€å§‹ï¼Œå‘å·¦è¯»10æ¡\næ³¨æ„ï¼Œè¿™é‡Œæ²¡æœ‰key_part3ï¼Œä¹Ÿå¯ä»¥çš„ã€‚å¯ä»¥ç†è§£æˆï¼Œkey_part3ä¸è¦æ±‚æ’åºã€‚è€ŒæŒ‰ç…§key_part1 DESC,key_part2DESCé¡ºåºçš„è®°å½•ä¸€å®šæ˜¯è¿ç»­çš„\nå¦‚æœæ˜¯å…ˆkey_part1åˆ—å‡åºï¼Œå†key_part2åˆ—é™åºï¼Œå¦‚ï¼š\nSELECT * FROM single_table ORDER BY key_part1,key_part2 DESC LIMIT 10; æ­¤æ—¶è”åˆç´¢å¼•çš„æŸ¥è¯¢è¿‡ç¨‹å¦‚ä¸‹ï¼Œç®—æ³•è¾ƒä¸ºå¤æ‚ï¼Œä¸èƒ½é«˜æ•ˆåœ°ä½¿ç”¨ç´¢å¼•ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹æ˜¯ä¸ä¼šä½¿ç”¨è”åˆç´¢å¼•æ‰§è¡Œæ’åºæ“ä½œçš„\nMySQL8.0å¼•å…¥äº†ç§°ä¸ºDescending Indexçš„ç‰¹æ€§ï¼Œæ”¯æŒORDER BY å­å¥ä¸­ASCã€DESCæ··ç”¨çš„æƒ…å†µ\næ’åºåˆ—åŒ…å«éåŒä¸€ä¸ªç´¢å¼•çš„åˆ—ï¼Œè¿™ç§æƒ…å†µä¹Ÿä¸èƒ½ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åº # SELECT * FROM single_table ORDER BY key1,key2 LIMIT 10 å¯¹äºidx_key1çš„äºŒçº§ç´¢å¼•æ¥è¯´ï¼ŒåªæŒ‰ç…§key1åˆ—æ’åºã€‚ä¸”key1å€¼ç›¸åŒçš„æƒ…å†µä¸‹æ˜¯ä¸æŒ‰ç…§key2åˆ—çš„å€¼è¿›è¡Œæ’åºçš„ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨idx_key1ç´¢å¼•æ‰§è¡Œä¸Šè¿°æŸ¥è¯¢\næ’åºåˆ—æ˜¯æŸä¸ªè”åˆç´¢å¼•çš„ç´¢å¼•åˆ—ï¼Œä½†æ˜¯è¿™äº›æ’åºåˆ—å†è”åˆç´¢å¼•ä¸­å¹¶ä¸è¿ç»­ # SELECT * FROM single_table ORDER BY key_part1,key_part3 LIMIT 10; key_part1å€¼ç›¸åŒçš„è®°å½•å¹¶ä¸æŒ‰ç…§key_part3æ’åºï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨idx_key_partæ‰§è¡Œä¸Šè¿°æŸ¥è¯¢\nç”¨æ¥å½¢æˆæ‰«æåŒºé—´çš„ç´¢å¼•åˆ—ä¸æ’åºåˆ—ä¸åŒ # SELECT * FROM single_table WHERE key1=\u0026#39;a\u0026#39; ORDER BY key2 LIMIT 10; å¦‚æœä½¿ç”¨key1=\u0026lsquo;1\u0026rsquo;ä½œä¸ºè¾¹ç•Œæ¡ä»¶æ¥å½¢æˆæ‰«æåŒºé—´ï¼Œä¹Ÿå°±æ˜¯å†ä½¿ç”¨idx_key1æ‰§è¡Œè¯¥æŸ¥è¯¢ï¼Œä»…éœ€è¦æ‰«ækey1å€¼ä¸º\u0026rsquo;a\u0026rsquo;çš„äºŒçº§ç´¢å¼•è®°å½•ã€‚æ­¤æ—¶æ— æ³•ä½¿ç”¨uk_key2æ‰§è¡Œä¸Šè¿°æŸ¥è¯¢\n5ï¼šæ’åºåˆ—ä¸æ˜¯ä»¥å•ç‹¬åˆ—åçš„å½¢å¼å‡ºç°åœ¨ORDER BY å­å¥ä¸­\nè¦æƒ³ä½¿ç”¨ç´¢å¼•æ’åºï¼Œå¿…é¡»ä¿è¯ç´¢å¼•åˆ—æ˜¯ä»¥å•ç‹¬åˆ—åçš„å½¢å¼ï¼ˆè€Œä¸æ˜¯ä¿®é¥°è¿‡ï¼‰ï¼š\nSELECT * FROM single_table ORDER BY UPPER(key1) LIMIT 10; å› ä¸ºkey1åˆ—ä»¥UPPER(key1)å‡½æ•°è°ƒç”¨çš„å½¢å¼å‡ºç°åœ¨ORDER BYå­å¥ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨idx_key1æ‰§è¡Œä¸Šè¿°æŸ¥è¯¢\nç´¢å¼•ç”¨äºåˆ†ç»„ # ä¸ºäº†æ–¹ä¾¿ç»Ÿè®¡ï¼Œä¼šæŠŠè¡¨ä¸­è®°å½•æŒ‰ç…§æŸäº›åˆ—è¿›è¡Œåˆ†ç»„ï¼Œå¦‚ï¼š\nSELECT key_part1,key_part2,key_part3,COUNT(*) FROM single_table GROUP BY key_part1,key_part2,key_part3; å¯¹è¿™äº›å°åˆ†ç»„è¿›è¡Œç»Ÿè®¡ï¼Œä¸Šé¢çš„æŸ¥è¯¢ï¼Œå³ç»Ÿè®¡æ¯ä¸ªå°å°åˆ†ç»„åŒ…å«çš„è®°å½•æ¡æ•°ã€‚\nå¦‚æœæ²¡æœ‰idx_key_partç´¢å¼•ï¼Œå°±å¾—å»ºç«‹ä¸€ä¸ªç”¨äºç»Ÿè®¡çš„ä¸´æ—¶è¡¨ï¼Œåœ¨æ‰«æèšç°‡ç´¢å¼•çš„è®°å½•æ—¶å°†ç»Ÿè®¡çš„ä¸­é—´ç»“æœå¡«å…¥è¿™ä¸ªä¸´æ—¶è¡¨ã€‚å½“æ‰«æå®Œè®°å½•åï¼Œ å†æŠŠä¸´æ—¶è¡¨ä¸­çš„ç»“æœä½œä¸ºç»“æœé›†å‘é€ç»™å®¢æˆ·ç«¯ã€‚ å¦‚æœæœ‰äº†ç´¢å¼•idx_key_part ï¼Œæ°å·§è¿™ä¸ªåˆ†ç»„é¡ºåºåˆä¸idx_key_part çš„ç´¢å¼•åˆ—çš„é¡ºåºæ˜¯ä¸€è‡´çš„ï¼Œè€Œidx_key_part çš„äºŒçº§ç´¢å¼•è®°å½•åˆæ˜¯æŒ‰ç…§ç´¢å¼•åˆ—çš„å€¼æ’å¥½åºçš„ï¼Œè¿™å°±æ­£å¥½äº†ã€‚æ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨idx_key_part ç´¢å¼•è¿›è¡Œåˆ†ç»„ï¼Œè€Œä¸ç”¨å†å»ºç«‹ä¸´æ—¶è¡¨äº† ä¸ä½¿ç”¨B+ æ ‘ç´¢å¼•è¿›è¡Œæ’åºå·®ä¸å¤šï¼Œ åˆ†ç»„åˆ—çš„é¡ºåºä¹Ÿéœ€è¦ä¸ç´¢å¼•åˆ—çš„é¡ºåºä¸€è‡´ï¼Œä¹Ÿå¯ä»¥åªä½¿ç”¨ç´¢å¼•åˆ—ä¸­å·¦è¾¹è¿ç»­çš„åˆ—è¿¸è¡Œåˆ†ç»„\nå¦‚ä¸Šï¼Œå°±æ˜¯ç»Ÿè®¡ (\u0026lsquo;0\u0026rsquo;,\u0026lsquo;0\u0026rsquo;,\u0026lsquo;0\u0026rsquo;)çš„æœ‰å‡ æ¡ï¼Œ (\u0026lsquo;0\u0026rsquo;,\u0026lsquo;a\u0026rsquo;,\u0026lsquo;a\u0026rsquo;)çš„æœ‰å‡ æ¡ï¼Œ (\u0026lsquo;0\u0026rsquo;,\u0026lsquo;a\u0026rsquo;,\u0026lsquo;b\u0026rsquo;)çš„æœ‰å‡ æ¡ç­‰\nå›è¡¨çš„ä»£ä»· # SELECT * FROM single_table WHERE key1 \u0026gt; 'a' AND key1 \u0026lt; 'c'\næœ‰ä¸¤ç§æ–¹å¼æ¥æ‰§è¡Œä¸Šé¢è¯­å¥\nä»¥å…¨è¡¨æ‰«æçš„æ–¹å¼ # ç›´æ¥æ‰«æå…¨éƒ¨çš„èšç°‡ç´¢å¼•è®°å½•ï¼Œ é’ˆå¯¹æ¯ä¸€æ¡èšç°‡ç´¢å¼•è®°å½•ï¼Œéƒ½åˆ¤æ–­æœç´¢æ¡ä»¶æ˜¯å¦æˆç«‹ï¼Œ å¦‚æœæˆç«‹åˆ™å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œ å¦åˆ™è·³è¿‡è¯¥è®°å½•.\nä½¿ç”¨idx_key1æ‰§è¡Œè¯¥æŸ¥è¯¢ # å¯ä»¥æ ¹æ®æœç´¢æ¡ä»¶key1 \u0026gt; \u0026lsquo;a\u0026rsquo; AND key1 \u0026lt; \u0026lsquo;c\u0026rsquo; å¾—åˆ°å¯¹åº”çš„æ‰«æåŒºé—´( \u0026lsquo;a\u0026rsquo;ï¼Œ\u0026lsquo;c\u0026rsquo; )ï¼Œç„¶åæ‰«æè¯¥æ‰«æåŒºé—´ä¸­çš„äºŒçº§ç´¢å¼•è®°å½•ã€‚ç”±äºidx_key1ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œä»…åŒ…å«key1 ã€id è¿™ä¸¤ä¸ªåˆ—ï¼Œè€ŒæŸ¥è¯¢åˆ—è¡¨æ˜¯*ï¼Œ è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦è·å–æ¯æ¡äºŒçº§ç´¢å¼•è®°å½•å¯¹åº”çš„èšç°‡ç´¢å¼•è®°å½•ï¼Œ ä¹Ÿå°±æ˜¯æ‰§è¡Œå›è¡¨æ“ä½œï¼Œåœ¨è·å–åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•åå†å‘é€åˆ°å®¢æˆ·ç«¯ã€‚\nåˆ†æ # å¯¹äºä½¿ç”¨InnoDB å­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼Œ ç´¢å¼•ä¸­çš„æ•°æ®é¡µéƒ½å¿…é¡»å­˜æ”¾åœ¨ç£ç›˜ä¸­ï¼Œ ç­‰åˆ°éœ€è¦æ—¶å†åŠ è½½åˆ°å†…å­˜ä¸­ä½¿ç”¨ã€‚è¿™äº›æ•°æ®é¡µä¼šè¢«å­˜æ”¾åˆ°ç£ç›˜ä¸­çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–‡ä»¶ä¸­ï¼Œ é¡µé¢çš„é¡µå·å¯¹åº”ç€è¯¥é¡µåœ¨ç£ç›˜æ–‡ä»¶ä¸­çš„åç§»é‡ã€‚ä»¥16KBå¤§å°çš„é¡µé¢ä¸ºä¾‹ï¼Œé¡µå·ä¸º0 çš„é¡µé¢å¯¹åº”ç€è¿™äº›æ–‡ä»¶ä¸­åç§»é‡ä¸º0 çš„ä½ç½®ï¼Œé¡µå·ä¸º1çš„é¡µé¢å¯¹åº”ç€è¿™äº›æ–‡ä»¶ä¸­åç§»é‡ä¸º16KB çš„ä½ç½®ã€‚å‰é¢ç« èŠ‚è®²è¿‡ï¼Œ B+ æ ‘çš„æ¯å±‚èŠ‚ç‚¹ä¼šä½¿ç”¨åŒå‘é“¾è¡¨è¿æ¥èµ·æ¥ï¼Œ ä¸Šä¸€ä¸ªèŠ‚ç‚¹å’Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„é¡µå·å¯ä»¥ä¸å¿…ç›¸é‚»ã€‚\nä¸è¿‡åœ¨å®é™…å®ç°ä¸­ï¼Œ è®¾è®¡Inno DB çš„å¤§å”è¿˜æ˜¯å°½é‡è®©åŒä¸€ä¸ªç´¢å¼•çš„å¶å­èŠ‚ç‚¹çš„é¡µå·æŒ‰ç…§é¡ºåºæ’åˆ—ï¼Œè¿™ä¸€ç‚¹ä¼šåœ¨ç¨åè®¨è®ºè¡¨ç©ºé—´æ—¶å†è¯¦ç»†å˜´å¨\nä¹Ÿå°±æ˜¯è¯´ï¼Œidx_key1åœ¨æ‰«æåŒºé—´( \u0026lsquo;a\u0026rsquo;, \u0026lsquo;c\u0026rsquo; )ä¸­çš„äºŒçº§ç´¢å¼•è®°å½•æ‰€åœ¨çš„é¡µé¢çš„é¡µå·ä¼šå°½å¯èƒ½ç›¸é‚»\nå³ä½¿è¿™äº›é¡µé¢çš„é¡µå·ä¸ç›¸é‚»ï¼Œ ä½†èµ·ç ä¸€ä¸ªé¡µå¯ä»¥å­˜æ”¾å¾ˆå¤šè®°å½•ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨æ‰§è¡Œå®Œä¸€æ¬¡é¡µé¢I/O åï¼Œå°±å¯ä»¥æŠŠå¾ˆå¤šäºŒçº§ç´¢å¼•è®°å½•ä»ç£ç›˜åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ æ€»è€Œè¨€ä¹‹ï¼Œå°±æ˜¯è¯»å–åœ¨æ‰«æåŒºé—´( \u0026lsquo;a\u0026rsquo;ï¼Œ \u0026lsquo;c\u0026rsquo; ) ä¸­ çš„äºŒçº§ç´¢å¼•è®°å½•æ—¶ï¼Œæ‰€ä»˜å‡ºçš„ä»£ä»·è¿˜æ˜¯è¾ƒå°çš„ã€‚ä¸è¿‡æ‰«æåŒºé—´( \u0026lsquo;a\u0026rsquo;, \u0026lsquo;c\u0026rsquo; )ä¸­çš„äºŒçº§ç´¢å¼•è®°å½•å¯¹åº” çš„id å€¼çš„å¤§å°æ˜¯æ¯«æ— è§„å¾‹çš„ï¼Œ æˆ‘ä»¬æ¯è¯»å–ä¸€æ¡äºŒçº§ç´¢å¼•è®°å½•ï¼Œå°±éœ€è¦æ ¹æ®è¯¥äºŒçº§ç´¢å¼•è®°å½•çš„id å€¼åˆ°èšç°‡ç´¢å¼•ä¸­æ‰§è¡Œå›è¡¨æ“ä½œã€‚å¦‚æœå¯¹åº”çš„èšç°‡ç´¢å¼•è®°å½•æ‰€åœ¨çš„é¡µé¢ä¸åœ¨å†…å­˜ä¸­ï¼Œå°±éœ€è¦å°†è¯¥ é¡µé¢ä»ç£ç›˜åŠ è½½åˆ°å†…å­˜ä¸­.ã€‚ç”±äºè¦è¯»å–å¾ˆå¤šid å€¼å¹¶ä¸è¿ç»­çš„èšç°‡ç´¢å¼•è®°å½•ï¼Œè€Œä¸”è¿™äº›èšç°‡ç´¢å¼• è®°å½•åˆ†å¸ƒåœ¨ä¸åŒçš„æ•°æ®é¡µä¸­ï¼Œ è¿™äº›æ•°æ®é¡µçš„é¡µå·ä¹Ÿæ¯«æ— è§„å¾‹ï¼Œå› æ­¤ä¼šé€ æˆå¤§é‡çš„éšæœºI/O . éœ€è¦æ‰§è¡Œå›è¡¨æ“ä½œçš„è®°å½•è¶Šå¤šï¼Œ ä½¿ç”¨äºŒçº§ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢çš„æ€§èƒ½ä¹Ÿå°±è¶Šä½ï¼ŒæŸäº›æŸ¥è¯¢å®æ„¿ä½¿ ç”¨å…¨è¡¨æ‰«æä¹Ÿä¸ä½¿ç”¨äºŒçº§ç´¢å¼•ã€‚æ¯”å¦‚ï¼Œ å‡è®¾key1å€¼åœ¨\u0026rsquo;a\u0026rsquo;~\u0026lsquo;c\u0026rsquo; ä¹‹é—´çš„ç”¨æˆ·è®°å½•æ•°é‡****å å…¨éƒ¨è®°å½•** æ•°é‡çš„99%** ä»¥ä¸Šï¼Œå¦‚æœä½¿ç”¨idx_key1ç´¢å¼•ï¼Œåˆ™ä¼šæœ‰99% ä»¥ä¸Šçš„id å€¼éœ€è¦æ‰§è¡Œå›è¡¨æ“ä½œã€‚è¿™ ä¸æ˜¯åƒåŠ›ä¸è®¨å¥½ä¹ˆï¼Œ è¿˜ä¸å¦‚ç›´æ¥æ‰§è¡Œå…¨è¡¨æ‰«æ\nä»€ä¹ˆæ—¶å€™é‡‡ç”¨å…¨è¡¨æ‰«æï¼Œ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨äºŒçº§ç´¢å¼•+å›è¡¨çš„æ–¹å¼ # è¿™æ˜¯æŸ¥è¯¢ä¼˜åŒ–å™¨åº”è¯¥åšçš„å·¥ä½œï¼š\næŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šäº‹å…ˆé’ˆå¯¹è¡¨ä¸­çš„è®°å½•è®¡ç®—ä¸€äº›ç»Ÿè®¡æ•°æ®ï¼Œç„¶åå†åˆ©ç”¨è¿™äº›ç»Ÿè®¡æ•°æ®æˆ–è€…è®¿é—®è¡¨ä¸­çš„å°‘é‡è®°å½•æ¥è®¡ç®—éœ€è¦æ‰§è¡Œå›è¡¨æ“ä½œçš„è®°å½•æ•°ï¼Œå¦‚æœéœ€è¦æ‰§è¡Œå›è¡¨æ“ä½œçš„è®°å½•æ•°è¶Šå¤šï¼Œå°±è¶Šå€¾å‘äºä½¿ç”¨å…¨è¡¨æ‰«æï¼Œ åä¹‹åˆ™å€¾å‘äºä½¿ç”¨äºŒçº§ç´¢å¼•+å›è¡¨çš„æ–¹å¼ã€‚å½“ç„¶ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨æ‰€åšçš„åˆ†æå·¥ä½œæ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œ ä½†å¤§è‡´ä¸Šæ˜¯è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ã€‚\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯ä»¥ç»™æŸ¥è¯¢è¯­å¥æŒ‡å®šLIMIT å­å¥æ¥é™åˆ¶æŸ¥è¯¢è¿”å›çš„è®°å½•æ•°ï¼Œ è¿™å¯èƒ½ä¼šè®©æŸ¥ è¯¢ä¼˜åŒ–å™¨å€¾å‘äºé€‰æ‹©ä½¿ç”¨äºŒçº§ç´¢å¼•+å›è¡¨çš„æ–¹å¼è¿›è¡ŒæŸ¥è¯¢ï¼Œ åŸå› æ˜¯å›è¡¨çš„è®°å½•è¶Šå°‘ï¼Œ æ€§èƒ½æå‡ å°±è¶Šé«˜ã€‚æ¯”å¦‚ï¼Œä¸Šé¢çš„æŸ¥è¯¢è¯­å¥å¯ä»¥æ”¹å†™æˆä¸‹é¢è¿™æ ·\nSELECT * FROM single_table WHERE key1 \u0026gt; 'a' AND key1\u0026lt;'c' LIMIT 10\næ·»åŠ äº†LIMlT10 å­å¥åçš„æŸ¥è¯¢è¯­å¥æ›´å®¹æ˜“è®©æŸ¥è¯¢ä¼˜åŒ–å™¨é‡‡ç”¨äºŒçº§ç´¢å¼•+å›è¡¨çš„æ–¹å¼æ¥æ‰§è¡Œã€‚ å¯¹äºéœ€è¦å¯¹ç»“æœè¿›è¡Œæ’åºçš„æŸ¥è¯¢ï¼Œå¦‚æœåœ¨é‡‡ç”¨äºŒçº§ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢æ—¶éœ€è¦æ‰§è¡Œå›è¡¨æ“ä½œçš„è®° å½•ç‰¹åˆ«å¤šï¼Œä¹Ÿå€¾å‘äºä½¿ç”¨å…¨è¡¨æ‰«æ+æ–‡ä»¶æ’åºçš„æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªæŸ¥è¯¢è¯­å¥ SELECT * FROM single_table ORDER BY key1 ç”±äºæŸ¥è¯¢åˆ—è¡¨æ˜¯ *ï¼Œå¦‚æœä½¿ç”¨äºŒçº§ç´¢å¼•è¿›è¡Œæ’åºï¼Œåˆ™éœ€è¦å¯¹æ‰€æœ‰äºŒçº§ç´¢å¼•è®°å½•æ‰§è¡Œå›è¡¨æ“ä½œ. è¿™æ ·æ“ä½œçš„æˆæœ¬è¿˜ä¸å¦‚ç›´æ¥éå†èšç°‡ç´¢å¼•ç„¶åå†è¿›è¡Œæ–‡ä»¶æ’åºä½ï¼Œ æ‰€ä»¥æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šå€¾å‘äºä½¿ ç”¨å…¨è¡¨æ‰«æçš„æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢ã€‚å¦‚æœæ·»åŠ äº†LIMITå­å¥ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªæŸ¥è¯¢è¯­å¥:\nSELECT * FROM single_table ORDER BY key1 LIMIT 10; è¿™ä¸ªæŸ¥è¯¢è¯­å¥éœ€è¦æ‰§è¡Œå›è¡¨æ“ä½œçš„è®°å½•ç‰¹åˆ«å°‘ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨å°±ä¼šå€¾å‘äºä½¿ç”¨äºŒçº§ç´¢å¼•+å›è¡¨çš„ æ–¹å¼æ¥æ‰§è¡Œ\næ›´å¥½åœ°åˆ›å»ºå’Œä½¿ç”¨ç´¢å¼• # åªä¸ºç”¨äºæœç´¢ã€æ’åºæˆ–åˆ†ç»„çš„åˆ—åˆ›å»ºç´¢å¼• # SELECT common_field,key_part3 FROM single_table WHERE key1= \u0026#39;a\u0026#39;; æ²¡å¿…è¦ä¸ºcommon_field,key_part3åˆ›å»ºç´¢å¼•\nè€ƒè™‘ç´¢å¼•åˆ—ä¸­ä¸é‡å¤å€¼çš„ä¸ªæ•° # å‰æ–‡åœ¨å” å¨å›è¡¨çš„çŸ¥è¯†æ—¶ææåˆ°ï¼Œ åœ¨é€šè¿‡äºŒçº§ç´¢å¼•+å›è¡¨çš„æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼ŒæŸä¸ªæ‰«æåŒºé—´ä¸­åŒ…å«çš„äºŒçº§ç´¢å¼•è®°å½•æ•°é‡è¶Šå¤šï¼Œ å°±ä¼šå¯¼è‡´å›è¡¨æ“ä½œçš„ä»£ä»·è¶Šå¤§ã€‚æˆ‘ä»¬åœ¨ä¸ºæŸä¸ªåˆ—åˆ›å»ºç´¢å¼•æ—¶ï¼Œéœ€è¦è€ƒè™‘è¯¥åˆ—ä¸­ä¸é‡å¤å€¼çš„ä¸ªæ•°å å…¨éƒ¨è®°å½•æ¡æ•°çš„æ¯”ä¾‹ã€‚å¦‚æœæ¯”ä¾‹å¤ªä½ï¼Œåˆ™è¯´æ˜è¯¥åˆ—åŒ…å« è¿‡å¤šé‡å¤å€¼ï¼Œé‚£ä¹ˆåœ¨é€šè¿‡äºŒçº§ç´¢å¼•+å›è¡¨çš„æ–¹å¼æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œå°±æœ‰å¯èƒ½æ‰§è¡Œå¤ªå¤šæ¬¡å›è¡¨æ“ä½œ\nç´¢å¼•åˆ—çš„ç±»å‹å°½é‡å° # åœ¨å®šä¹‰è¡¨ç»“æ„æ—¶ï¼Œè¦æ˜¾å¼åœ°æŒ‡å®šåˆ—çš„ç±»å‹ ä»¥æ•´æ•°ç±»å‹ä¸ºä¾‹ï¼Œ æœ‰ TINIINTã€MEDIUMINTã€INTã€BIGINTè¿™å‡ ç§ï¼Œå®ƒä»¬å ç”¨çš„å­˜å‚¨ç©ºé—´çš„å¤§å°ä¾æ¬¡é€’å¢ã€‚ä¸‹é¢æ‰€è¯´çš„ç±»å‹å¤§å°æŒ‡çš„å°±æ˜¯è¯¥ç±»å‹å ç”¨çš„å­˜å‚¨ç©ºé—´çš„å¤§å°ã€‚åˆšæ‰æåˆ°çš„è¿™å‡ ä¸ªæ•´æ•°ç±»å‹ï¼Œå®ƒä»¬èƒ½è¡¨ç¤ºçš„æ•´æ•°èŒƒå›´å½“ç„¶ä¹Ÿæ˜¯ä¾æ¬¡é€’å¢ã€‚å¦‚æœæƒ³è¦å¯¹æŸä¸ªæ•´æ•°ç±»å‹çš„åˆ—å»ºç«‹ç´¢å¼•ï¼Œåœ¨è¡¨ç¤ºçš„æ•´æ•°èŒƒå›´å…è®¸çš„æƒ…å†µä¸‹ï¼Œå°½é‡è®©ç´¢å¼•åˆ—ä½¿ç”¨è¾ƒå°çš„ç±»å‹ï¼Œæ¯”å¦‚èƒ½ä½¿ç”¨INTå°±ä¸è¦ä½¿ç”¨BIGINTã€‚ èƒ½ä½¿ç”¨MEDIUMINT å°±ä¸è¦ä½¿ç”¨çš„INTã€‚ å› ä¸ºæ•°æ®ç±»å‹è¶Šå°ï¼Œ ç´¢å¼•å ç”¨çš„å­˜å‚¨ç©ºé—´å°±è¶Šå°‘ï¼Œåœ¨ä¸€ä¸ªæ•°æ®é¡µå†…å°±å¯ä»¥å­˜æ”¾æ›´å¤šçš„è®°å½•ï¼Œç£ç›˜1/0 å¸¦æ¥çš„æ€§èƒ½æŸè€—ä¹Ÿå°±è¶Šå°(ä¸€æ¬¡é¡µé¢I/O å¯ä»¥å°†æ›´å¤šçš„è®°å½•åŠ è½½åˆ°å†…å­˜ä¸­) è¯»å†™æ•ˆç‡ä¹Ÿå°±è¶Šé«˜ è¿™ä¸ªå»ºè®®å¯¹äºè¡¨çš„ä¸»é”®æ¥è¯´æ›´åŠ é€‚ç”¨ï¼Œå› ä¸ºä¸ä»…èšç°‡ç´¢å¼•ä¼šå­˜å‚¨ä¸»é”®å€¼ï¼Œå…¶ä»–æ‰€æœ‰çš„äºŒçº§ç´¢å¼•çš„èŠ‚ç‚¹éƒ½ä¼šå­˜å‚¨ä¸€ä»½è®°å½•çš„ä¸»é”®å€¼ã€‚å¦‚æœä¸»é”®ä½¿ç”¨æ›´å°çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿå°±æ„å‘³ç€èƒ½èŠ‚çœæ›´å¤šçš„å­˜å‚¨ç©ºé—´\nä¸ºåˆ—å‰ç¼€å»ºç«‹ç´¢å¼• # æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²å…¶å®æ˜¯ç”±è‹¥å¹²ä¸ªå­—ç¬¦ç»„æˆçš„ã€‚å¦‚æœåœ¨MySQL ä¸­ä½¿ç”¨utf8 å­—ç¬¦é›†å­˜å‚¨å­—ç¬¦ä¸²ï¼Œåˆ™éœ€è¦1 - 3 å­—èŠ‚æ¥ç¼–ç ä¸€ä¸ªå­—ç¬¦ã€‚å‡å¦‚å­—ç¬¦ä¸²å¾ˆé•¿ï¼Œé‚£ä¹ˆåœ¨å­˜å‚¨è¿™ä¸ªå­—ç¬¦ä¸²æ—¶å°±éœ€è¦å ç”¨å¾ˆå¤§çš„å­˜å‚¨ç©ºé—´ã€‚åœ¨éœ€è¦ä¸ºè¿™ä¸ªå­—ç¬¦ä¸²æ‰€åœ¨çš„åˆ—å»ºç«‹ç´¢å¼•æ—¶ï¼Œå°±æ„å‘³ç€åœ¨å¯¹åº”çš„B+ æ ‘ä¸­çš„è®°å½•ä¸­ï¼Œ éœ€è¦æŠŠè¯¥åˆ—çš„å®Œæ•´å­—ç¬¦ä¸²å­˜å‚¨èµ·æ¥ã€‚å­—ç¬¦ä¸²è¶Šé•¿ï¼Œåœ¨ç´¢å¼•ä¸­å ç”¨çš„å­˜å‚¨ç©ºé—´è¶Šå¤§ã€‚ å‰æ–‡è¯´è¿‡ï¼Œ ç´¢å¼•åˆ—çš„å­—ç¬¦ä¸²å‰ç¼€å…¶å®ä¹Ÿæ˜¯æ’å¥½åºçš„ï¼Œæ‰€ä»¥ç´¢å¼•çš„è®¾è®¡äººå‘˜æå‡ºäº†ä¸€ä¸ªæ–¹æ¡ˆã€‚ åªå°†å­—ç¬¦ä¸²çš„å‰å‡ ä¸ªå­—ç¬¦å­˜æ”¾åˆ°ç´¢å¼•ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨äºŒçº§ç´¢å¼•çš„è®°å½•ä¸­åªä¿ç•™å­—ç¬¦ä¸²çš„å‰å‡ ä¸ªå­—ç¬¦ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥è¿™æ ·ä¿®æ”¹idx_key1ç´¢å¼•ï¼Œè®©ç´¢å¼•ä¸­åªä¿ç•™å­—ç¬¦ä¸²çš„å‰10ä¸ªå­—ç¬¦:\nALTER TABLE single_table DROP INDEX idx_key1; ALTER TABLE single_table ADD INDEX idx_key1(key1(10)); å†æ‰§è¡Œä¸‹é¢çš„è¯­å¥\nSELECT * FROM single_table WHERE key1= \u0026#39;abcdefghijklmn\u0026#39; ç”±äºåœ¨idx_key1 çš„äºŒçº§ç´¢å¼•è®°å½•ä¸­åªä¿ç•™å­—ç¬¦ä¸²çš„å‰10 ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½å®šä½åˆ°å‰ç¼€ä¸º\u0026rsquo;abcdefghij\u0026rsquo; çš„äºŒçº§ç´¢å¼•è®°å½•ï¼Œåœ¨æ‰«æè¿™äº›äºŒçº§ç´¢å¼•è®°å½•æ—¶å†åˆ¤æ–­å®ƒä»¬æ˜¯å¦æ»¡è¶³key1=\u0026lsquo;abcdefghijklmn\u0026rsquo; æ¡ä»¶ã€‚å½“åˆ—ä¸­å­˜å‚¨çš„å­—ç¬¦ä¸²åŒ…å«çš„å­—ç¬¦è¾ƒå¤šæ—¶ï¼Œè¿™ç§ä¸ºåˆ—å‰ç¼€å»ºç«‹ç´¢å¼•çš„æ–¹å¼å¯ä»¥æ˜æ˜¾å‡å°‘ç´¢å¼•å¤§å°ã€‚\næ³¨æ„ï¼Œä¸Šé¢è¯´çš„æ˜¯æ‰«æè¿™äº›äºŒçº§ç´¢å¼•è®°å½•ï¼Œæ˜¯â€œäº›â€ã€‚ å¯ä»¥å‡å°‘ç´¢å¼•å¤§å°ï¼Œä½†ä¸ä¸€æ ·å‡å°‘ç´¢å¼•æ•°é‡ã€‚å¦‚æœæœ‰é‡å¤çš„ç…§æ ·ä¼šåœ¨ç´¢å¼•ä¸­å‡ºç°ï¼Œå› ä¸ºä¸æ˜¯UNIQUEçº¦æŸã€‚äºŒçº§ç´¢å¼•å€¼å¤§å°ç›¸åŒæ—¶ï¼Œä¼šæŒ‰ç…§èšç°‡ç´¢å¼•å¤§å°æ’åˆ— ä¸è¿‡ï¼Œåœ¨åªå¯¹åˆ—å‰ç¼€å»ºç«‹ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œ ä¸‹é¢è¿™ä¸ªæŸ¥è¯¢è¯­å¥å°±ä¸èƒ½ä½¿ç”¨ç´¢å¼•æ¥å®Œæˆæ’åºéœ€æ±‚äº†ï¼š SELECT * FROM single_table ORDER BY key1 LIMIT 10;\nå› ä¸ºäºŒçº§ç´¢å¼•idx_key1ä¸­ä¸åŒ…å«å®Œæ•´çš„key1åˆ—ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨ä»…ä½¿ç”¨idx_key1ç´¢å¼•æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œæ— æ³•å¯¹key1 åˆ—å‰10 ä¸ªå­—ç¬¦ç›¸åŒä½†å…¶ä½™å­—ç¬¦ä¸åŒçš„è®°å½•è¿›è¡Œæ’åºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªä¸ºåˆ—å‰ç¼€å»ºç«‹ç´¢å¼•çš„æ–¹å¼æ— æ³•æ”¯æŒä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åºçš„éœ€æ±‚ã€‚ä¸Šè¿°æŸ¥è¯¢è¯­å¥åªå¥½ä¹–ä¹–åœ°ä½¿ç”¨å…¨è¡¨æ‰«æ+æ–‡ä»¶æ’åºçš„æ–¹å¼æ¥æ‰§è¡Œäº†ã€‚\nåªä¸ºåˆ—å‰ç¼€åˆ›å»ºç´¢å¼•çš„è¿‡ç¨‹æˆ‘ä»¬å°±ä»‹ç»å®Œäº†ï¼Œè¿˜æ˜¯å°†idx_key1 æ”¹å›åŸæ¥çš„æ ·å¼ï¼š\nALTER TABLE single_table DROP INDEX idx_key1; ALTER TABLE single_table ADD INDEX idx_key1(key1); è¦†ç›–ç´¢å¼• # ä¸ºäº†å½»åº•å‘Šåˆ«å›è¡¨æ“ä½œå¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œå»ºè®®æœ€å¥½åœ¨æŸ¥è¯¢åˆ—è¡¨ä¸­åªåŒ…å«ç´¢å¼•åˆ—ï¼Œæ¯”å¦‚è¿™ä¸ªæŸ¥è¯¢è¯­å¥:\nSELECT key1,id FROM single_table WHERE key1 \u0026gt; 'a' AND key1 \u0026lt; 'c'\nç”±äºåªæŸ¥è¯¢key1åˆ—å’Œidåˆ—çš„å€¼ï¼Œè¿™é‡Œä½¿ç”¨idx_key1ç´¢å¼•æ¥æ‰«æ(\u0026lsquo;a\u0026rsquo;,\u0026lsquo;c\u0026rsquo;)åŒºé—´çš„äºŒçº§ç´¢å¼•è®°å½•æ—¶ï¼Œå¯ä»¥ç›´æ¥ä»è·å–åˆ°çš„äºŒçº§ç´¢å¼•è®°å½•ä¸­è¯»å‡ºkey1åˆ—å’Œidåˆ—çš„å€¼ï¼Œä¸éœ€è¦é€šè¿‡idå€¼åˆ°èšç°‡ç´¢å¼•æ‰§è¡Œå›è¡¨ï¼Œçœå»å›è¡¨æ“ä½œå¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚\næŠŠè¿™ç§å·²ç»åŒ…å«æ‰€æœ‰éœ€è¦è¯»å–çš„åˆ—çš„æŸ¥è¯¢æ–¹å¼ç§°ä¸ºè¦†ç›–ç´¢å¼•\næ’åºæ“ä½œä¹Ÿä¼˜å…ˆä½¿ç”¨è¦†ç›–ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ï¼š\nSELECT * FROM single_table ORDER BY key1 è™½ç„¶è¿™ä¸ªæŸ¥è¯¢è¯­å¥ä¸­æ²¡æœ‰LIMITå­æ—¬ï¼Œä½†æ˜¯ç”±äºå¯ä»¥é‡‡ç”¨è¦†ç›–ç´¢å¼•ï¼Œæ‰€ä»¥æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šç›´æ¥ä½¿ç”¨idx_key1ç´¢å¼•è¿›è¡Œæ’åº è€Œä¸éœ€è¦æ‰§è¡Œå›è¡¨æ“ä½œã€‚ å½“ç„¶ï¼Œå¦‚æœä¸šåŠ¡éœ€è¦æŸ¥è¯¢ç´¢å¼•åˆ—ä»¥å¤–çš„åˆ—ï¼Œé‚£è¿˜æ˜¯ä»¥ä¿è¯ä¸šåŠ¡éœ€æ±‚ä¸ºé‡ã€‚å¦‚æ— å¿…è¦ï¼Œ æœ€å¥½ä»…æŠŠä¸šåŠ¡ä¸­éœ€è¦çš„åˆ—æ”¾åœ¨æŸ¥è¯¢åˆ—è¡¨ä¸­ï¼Œè€Œä¸æ˜¯ç®€å•åœ°ä»¥*æ›¿ä»£\nè®©ç´¢å¼•åˆ—ä»¥åˆ—åçš„å½¢å¼åœ¨æœç´¢æ¡ä»¶ä¸­å•ç‹¬å‡ºç° # æ³¨æ„ï¼Œæ˜¯å•ç‹¬\nå¦‚ä¸‹é¢ä¸¤ä¸ªè¯­ä¹‰ä¸€æ ·çš„æœç´¢æ¡ä»¶\nSELECT * FROM single_table WHERE key2 * 2 \u0026lt; 4; SELECT * FROM single_table WHERE key2 \u0026lt; 4/2; åœ¨ç¬¬ä¸€ä¸ªæŸ¥è¯¢è¯­å¥çš„æœç´¢æ¡ä»¶ä¸­ï¼Œ key2åˆ—å¹¶ä¸æ˜¯ä»¥å•ç‹¬åˆ—åçš„å½¢å¼å‡ºç°çš„ï¼Œè€Œæ˜¯ä»¥key2 * 2è¿™æ ·çš„è¡¨è¾¾å¼çš„å½¢å¼å‡ºç°çš„ã€‚ MySQL å¹¶ä¸ä¼šå°è¯•ç®€åŒ–key2*2\u0026lt;4 è¡¨è¾¾å¼ï¼Œè€Œæ˜¯ç›´æ¥è®¤ä¸ºè¿™ä¸ªæœç´¢æ¡ä»¶ä¸èƒ½å½¢æˆåˆé€‚çš„æ‰«æåŒºé—´æ¥å‡å°‘éœ€è¦æ‰«æçš„è®°å½•æ•°é‡ï¼Œæ‰€ä»¥è¯¥æŸ¥è¯¢è¯­å¥åªèƒ½ä»¥å…¨è¡¨æ‰«é”šçš„æ–¹å¼æ¥æ‰§è¡Œã€‚ åœ¨ç¬¬äºŒä¸ªæŸ¥è¯¢è¯­å¥çš„æœç´¢æ¡ä»¶ä¸­ï¼Œ key2 åˆ—æ˜¯ä»¥å•ç‹¬åˆ—åçš„å½¢å¼å‡ºç°çš„ï¼Œ MySQL å¯ä»¥åˆ†æå‡ºå¦‚æœä½¿ç”¨uk_key2 æ‰§è¡ŒæŸ¥è¯¢ï¼Œå¯¹åº”çš„æ‰«æåŒºé—´å°±æ˜¯ï¼ˆ-âˆï¼Œ2ï¼‰ ï¼Œè¿™å¯ä»¥å‡å°‘éœ€è¦æ‰«æçš„è®°å½•æ•°é‡ã€‚ æ‰€ä»¥MySQL å¯èƒ½ä½¿ç”¨uk_key2 æ¥æ‰§è¡ŒæŸ¥è¯¢ã€‚ æ‰€ä»¥ï¼Œå¦‚æœæƒ³è®©æŸä¸ªæŸ¥è¯¢ä½¿ç”¨ç´¢å¼•æ¥æ‰§è¡Œï¼Œè¯·è®©ç´¢å¼•åˆ—ä»¥åˆ—åçš„å½¢å¼å•ç‹¬å‡ºç°åœ¨æœç´¢æ¡ä»¶ä¸­ æ–°æ’å…¥è®°å½•æ—¶ä¸»é”®å¤§å°å¯¹æ•ˆç‡çš„å½±å“ # æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºä¸€ä¸ªä½¿ç”¨lnnoDB å­˜å‚¨å¼•æ“çš„è¡¨æ¥è¯´ï¼Œåœ¨æ²¡æœ‰æ˜¾å¼åˆ›å»ºç´¢å¼•æ—¶ï¼Œ è¡¨ä¸­çš„æ•°æ®å®é™…ä¸Šå­˜å‚¨åœ¨èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­ï¼Œè€Œä¸”B+ æ ‘çš„æ¯ä¸€å±‚æ•°æ®é¡µä»¥åŠé¡µé¢ä¸­çš„è®°å½•éƒ½æ˜¯æŒ‰ç…§ä¸»é”®å€¼ä»å°åˆ°å¤§çš„é¡ºåºæ’åºçš„ã€‚å¦‚æœæ–°æ’å…¥è®°å½•çš„ä¸»é”®å€¼æ˜¯ä¾æ¬¡å¢å¤§çš„è¯ï¼Œåˆ™æ¯æ’æ»¡ä¸€ä¸ªæ•°æ®é¡µå°±æ¢åˆ°ä¸‹ä¸€ä¸ªæ•°æ®é¡µç»§ç»­æ’å…¥ã€‚å¦‚æœæ–°æ’å…¥è®°å½•çš„ä¸»é”®å€¼å¿½å¤§å¿½å°ï¼Œå°±æ¯”è¾ƒéº»çƒ¦äº†\nå‡è®¾æŸä¸ªæ•°æ®é¡µå­˜å‚¨çš„èšç°‡ç´¢å¼•è®°å½•å·²ç»æ»¡äº†ï¼Œ å®ƒå­˜å‚¨çš„ä¸»é”®å€¼åœ¨1 - 100ä¹‹é—´ï¼Œå¦‚å›¾ï¼š\næ­¤æ—¶ï¼Œå¦‚æœå†æ’å…¥ä¸€æ¡ä¸»é”®å€¼ä¸º8çš„è®°å½•ï¼Œåˆ™å®ƒæ’å…¥çš„ä½ç½®å¦‚å›¾ï¼š\nå¯è¿™ä¸ªæ•°æ®é¡µå·²ç»æ»¡äº†å•Šï¼Œ æ–°è®°å½•è¯¥æ’å…¥åˆ°å“ªé‡Œå‘¢?æˆ‘ä»¬éœ€è¦æŠŠå½“å‰é¡µé¢åˆ†è£‚æˆä¸¤ä¸ªé¡µé¢ï¼Œ æŠŠæœ¬é¡µä¸­çš„ä¸€äº›è®°å½•ç§»åŠ¨åˆ°æ–°åˆ›å»ºçš„é¡µä¸­ã€‚é¡µé¢åˆ†è£‚æ„å‘³ç€ä»€ä¹ˆ?æ„å‘³ç€æ€§èƒ½æŸè€—!æ‰€ä»¥ï¼Œ å¦‚æœæƒ³å°½é‡é¿å…è¿™ç§æ— è°“çš„æ€§èƒ½æŸè€—ï¼Œæœ€å¥½è®©æ’å…¥è®°å½•çš„ä¸»é”®å€¼ä¾æ¬¡é€’å¢ã€‚å°±åƒsingle_tableçš„ä¸»é”®id åˆ—å…·æœ‰AUTO_INCREMENT å±æ€§é‚£æ ·ã€‚ MySQL ä¼šè‡ªåŠ¨ä¸ºæ–°æ’å…¥çš„è®°å½•ç”Ÿæˆé€’å¢çš„ä¸»é”®å€¼\nå†—ä½™å’Œé‡å¤ç´¢å¼• # é’ˆå¯¹single_table è¡¨ï¼Œ å¯ä»¥å•ç‹¬é’ˆå¯¹key_part1åˆ—å»ºç«‹ä¸€ä¸ªidx_key_part1ç´¢å¼•\nALTER TABLE single_table ADD INDEX idx_key_part(key_part1); å…¶å®ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªé’ˆå¯¹key_part1ã€key_part2 ã€key_part3åˆ—å»ºç«‹çš„è”åˆç´¢å¼•idx_key_partã€‚idx_key_partç´¢å¼•çš„äºŒçº§ç´¢å¼•è®°å½•æœ¬èº«å°±æ˜¯æŒ‰ç…§key_part1 åˆ—çš„å€¼æ’åºçš„ï¼Œ æ­¤æ—¶å†å•ç‹¬ä¸ºkey_part1åˆ—å»ºç«‹ä¸€ä¸ªç´¢å¼•å…¶å®æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªæ–°å»ºçš„idx_key_part1ç´¢å¼•çœ‹ä½œæ˜¯ä¸€ä¸ªå†—ä½™ç´¢å¼•ï¼Œ è¯¥å†—ä½™ç´¢å¼•æ˜¯æ²¡æœ‰å¿…è¦çš„\næœ‰æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¯¹åŒä¸€ä¸ªåˆ—åˆ›å»ºå¤šä¸ªç´¢å¼•ï¼Œæ¯”å¦‚è¿™ä¸¤ä¸ªæ·»åŠ ç´¢å¼•çš„è¯­å¥ï¼š\nALTER TABLE single_table ADD UNIQUE KEY uk_id(id); ALTER TABLE single_table ADD INDEX idx_id(id); æˆ‘ä»¬é’ˆå¯¹id åˆ—åˆå»ºç«‹äº†ä¸€ä¸ªå”¯ä¸€äºŒçº§ç´¢å¼•uk_idï¼Œ. è¿˜å»ºç«‹äº†ä¸€ä¸ªæ™®é€šäºŒçº§ç´¢å¼•idx_idã€‚ å¯æ˜¯id åˆ—æœ¬èº«å°±æ˜¯single_table è¡¨çš„ä¸»é”®ï¼Œ InnoDB è‡ªåŠ¨ä¸ºè¯¥åˆ—å»ºç«‹äº†èšç°‡ç´¢å¼•ï¼Œ æ­¤æ—¶uk_id å’Œidx_id å°±æ˜¯é‡å¤çš„ï¼Œè¿™ç§é‡å¤ç´¢å¼•åº”è¯¥é¿å…\n"},{"id":37,"href":"/zh/docs/study/MySQL/how_mysql_run/06/","title":"06B+æ ‘ç´¢å¼•","section":"_MySQLæ˜¯æ€æ ·è¿è¡Œçš„_","content":" å­¦ä¹ ã€ŠMySQLæ˜¯æ€æ ·è¿è¡Œçš„ã€‹ï¼Œæ„Ÿè°¢ä½œè€…ï¼\næ¦‚è¿° # æ•°æ®é¡µç”±7ä¸ªç»„æˆéƒ¨åˆ†ï¼Œå„ä¸ªæ•°æ®é¡µå¯ä»¥ç»„æˆä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œæ¯ä¸ªæ•°æ®é¡µä¸­çš„è®°å½•ä¼šæŒ‰ç…§ä¸»é”®å€¼ä»å°åˆ°å¤§çš„é¡ºåºç»„æˆä¸€ä¸ªå•å‘é“¾è¡¨ã€‚æ¯ä¸ªæ•°æ®é¡µéƒ½ä¼šä¸ºå®ƒé‡Œé¢çš„è®°å½•ç”Ÿæˆä¸€ä¸ªé¡µç›®å½•ï¼Œåœ¨é€šè¿‡ä¸»é”®æŸ¥æ‰¾æŸæ¡è®°å½•çš„æ—¶å€™å¯ä»¥åœ¨é¡µç›®å½•ä¸­ä½¿ç”¨äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°å¯¹åº”çš„æ§½ï¼Œç„¶åå†éå†è¯¥æ§½å¯¹åº”åˆ†ç»„ä¸­çš„è®°å½•å³å¯å¿«é€Ÿæ‰¾åˆ°æŒ‡å®šçš„è®°å½•ã€‚é¡µå’Œè®°å½•çš„å…³ç³»\né¡µaï¼Œé¡µb å¯ä»¥ä¸åœ¨ç‰©ç†ç»“æ„ä¸Šç›¸è¿ï¼Œåªè¦é€šè¿‡åŒå‘é“¾è¡¨ç›¸å…³è”å³å¯\næ²¡æœ‰ç´¢å¼•æ—¶è¿›è¡ŒæŸ¥æ‰¾ # å‡è®¾æˆ‘ä»¬è¦æœç´¢æŸä¸ªåˆ—ç­‰äºæŸä¸ªå¸¸æ•°çš„æƒ…å†µï¼š\nSELECT [æŸ¥è¯¢åˆ—è¡¨] FROM è¡¨å WHERE åˆ—å = xxx\nåœ¨ä¸€ä¸ªé¡µä¸­æŸ¥æ‰¾ # å‡è®¾è®°å½•æå°‘ï¼Œæ‰€æœ‰è®°å½•å¯ä»¥å­˜æ”¾åˆ°ä¸€ä¸ªé¡µä¸­\nä»¥ä¸»é”®ä½æœç´¢æ¡ä»¶ï¼šé¡µç›®å½•ä¸­ä½¿ç”¨äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°å¯¹åº”çš„æ§½ï¼Œç„¶ååœ¨éå†æ§½å¯¹åº”åˆ†ç»„ä¸­çš„è®°å½•ï¼Œå³å¯å¿«é€Ÿæ‰¾åˆ°æŒ‡å®šè®°å½• å…¶ä»–åˆ—ä½œä¸ºæœç´¢æ¡ä»¶ï¼šå¯¹äºéä¸»é”®ï¼Œæ•°æ®é¡µæ²¡æœ‰ä¸ºéä¸»é”®åˆ—å»ºç«‹æ‰€è°“çš„é¡µç›®å½•ï¼Œæ‰€ä»¥æ— æ³•é€šè¿‡äºŒåˆ†æ³•å¿«é€Ÿå®šä½ç›¸åº”çš„æ§½ã€‚åªèƒ½ä»Infimumä¾æ¬¡éå†å•å‘é“¾è¡¨ä¸­çš„æ¯æ¡è®°å½•ï¼Œç„¶åå¯¹æ¯”ï¼Œæ•ˆç‡æä½ åœ¨å¾ˆå¤šé¡µä¸­æŸ¥æ‰¾ # ä¸¤ä¸ªæ­¥éª¤ï¼š\nå®šä½åˆ°è®°å½•æ‰€åœ¨çš„é¡µ ä»æ‰€åœ¨é¡µå†…æŸ¥æ‰¾ç›¸åº”çš„è®°å½• æ²¡æœ‰ç´¢å¼•æƒ…å†µä¸‹ï¼Œä¸èƒ½å¿«é€Ÿå®šä½åˆ°æ‰€åœ¨é¡µï¼Œåªèƒ½ä»ç¬¬ä¸€é¡µæ²¿ç€åŒå‘é“¾è¡¨ä¸€ç›´å¾€ä¸‹æ‰¾ï¼Œè€Œå¦‚æœæ˜¯ä¸»é”®ï¼Œæ¯ä¸€é¡µåˆ™å¯ä»¥åœ¨é¡µç›®å½•äºŒåˆ†æŸ¥æ‰¾ã€‚\nä¸è¿‡ç”±äºè¦éå†æ‰€æœ‰é¡µï¼Œæ‰€ä»¥è¶…çº§è€—æ—¶\nç´¢å¼• # #ä¾‹å­ mysql\u0026gt; CREATE TABLE index_demo( c1 INT, c2 INT, c3 CHAR(1), PRIMARY KEY(c1) ) ROW_FORMAT=COMPACT; å®Œæ•´çš„è¡Œæ ¼å¼\nç®€åŒ–çš„è¡Œæ ¼å¼\nrecord_typeï¼šè®°å½•å¤´ä¿¡æ¯çš„ä¸€é¡¹å±æ€§ï¼Œè¡¨ç¤ºè®°å½•çš„ç±»å‹ã€‚0ï¼šæ™®é€šè®°å½•ï¼Œ2ï¼šInfimumè®°å½•ï¼Œ3ï¼šSupremumè®°å½•ï¼Œ1è¿˜æ²¡ç”¨è¿‡ç­‰ä¼šå†è¯´ next_recordï¼šè®°å½•å¤´ä¿¡æ¯çš„ä¸€é¡¹å±æ€§ï¼Œè¡¨ç¤ºä»å½“å‰è®°å½•çš„çœŸå®æ•°æ®åˆ°ä¸‹ä¸€æ¡è®°å½•çœŸå®æ•°æ®çš„è·ç¦» å„ä¸ªåˆ—çš„å€¼ï¼šè¿™é‡Œåªå±•ç¤ºåœ¨index_demoè¡¨ä¸­çš„3ä¸ªåˆ—ï¼Œåˆ†åˆ«æ˜¯c1ã€c2ã€c3 å…¶ä»–ä¿¡æ¯ï¼šåŒ…æ‹¬éšè—åˆ—åŠè®°å½•çš„é¢å¤–ä¿¡æ¯ æ”¹ä¸ºç«–ç€æŸ¥çœ‹ï¼š\nä¸Šé¢å›¾6-4çš„ç®­å¤´å…¶å®æœ‰ä¸€ç‚¹ç‚¹å‡ºå…¥ï¼Œåº”è¯¥æ˜¯æŒ‡å‘zçœŸå®æ•°æ®ç¬¬1åˆ—é‚£ä¸ªä½ç½®ï¼Œå¦‚ä¸‹ ä¸€ä¸ªç®€å•çš„ç´¢å¼•æ–¹æ¡ˆ # æ€è€ƒï¼šåœ¨æ ¹æ®æŸä¸ªæ¡ä»¶æŸ¥æ‰¾ä¸€äº›è®°å½•ï¼Œä¸ºä»€ä¹ˆè¦éå†æ‰€æœ‰çš„æ•°æ®é¡µå‘¢ï¼Ÿå› ä¸ºå„ä¸ªé¡µä¸­çš„è®°å½•æ²¡æœ‰è§„å¾‹ï¼Œä¸çŸ¥é“æœç´¢æ¡ä»¶ä¼šåŒ¹é…å“ªäº›é¡µ\næ€è·¯ï¼šä¸ºå¿«é€Ÿå®šä½è®°å½•æ‰€åœ¨çš„æ•°æ®é¡µè€Œå»ºç«‹ä¸€ä¸ªåˆ«çš„ç›®å½•\næœ‰åº # ä¸‹ä¸€ä¸ªæ•°æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼å¿…é¡»å¤§äºä¸Šä¸€é¡µç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼\nå‡è®¾ä¸€é¡µåªèƒ½å­˜æ”¾3æ¡è®°å½•\n#æ’å…¥3æ¡è®°å½• mysql\u0026gt; INSERT INTO index_demo VALUES(1,4,\u0026#39;u\u0026#39;),(3,9,\u0026#39;d\u0026#39;),(5,3,\u0026#39;y\u0026#39;); Query OK, 3 rows affected (0.02 sec) Records: 3 Duplicates: 0 Warnings: 0 æ­¤æ—¶é¡µçš„æƒ…å†µ\nè®°å½•ç»„æˆäº†å•é“¾è¡¨\nå†æ’å…¥ä¸€æ¡è®°å½•\nmysql\u0026gt; INSERT INTO index_demo VALUES(4,4,\u0026#39;a\u0026#39;); Query OK, 1 row affected (0.01 sec) (æ³¨æ„ï¼Œé¡µä¹‹é—´å¯èƒ½ä¸æ˜¯è¿ç»­çš„)\nç”±äºé¡µ10ä¸­æœ€å¤§è®°å½•æ˜¯5ï¼Œè€Œé¡µ28ä¸­æœ‰ä¸€æ¡è®°å½•æ˜¯4ï¼Œå› ä¸º5\u0026gt;4ï¼Œä¸ç¬¦åˆä¸‹ä¸€ä¸ªæ•°æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼å¿…é¡»å¤§äºä¸Šä¸€é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼ï¼Œæ‰€ä»¥åœ¨æ’å…¥ä¸»é”®å€¼ä¸º4çš„è®°å½•æ—¶éœ€è¦ä¼´éšç€ä¸€æ¬¡è®°å½•ç§»åŠ¨ï¼Œä¹Ÿå°±æ˜¯æŠŠ5çš„è®°å½•ç§»åŠ¨åˆ°é¡µ28ä¸­ï¼Œå†æŠŠä¸»é”®å€¼4çš„è®°å½•æ’å…¥åˆ°é¡µ10ä¸­\nè¿™ä¸ªè¿‡ç¨‹è¡¨æ˜ï¼Œåœ¨å¯¹é¡µä¸­çš„è®°å½•è¿›è¡Œå¢åˆ æ”¹æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡ä¸€äº›è¯¸å¦‚è®°å½•ç§»åŠ¨çš„æ“ä½œæ¥å§‹ç»ˆä¿è¯è¿™ä¸ªçŠ¶æ€ä¸€ç›´æˆç«‹ï¼šä¸‹ä¸€ä¸ªæ•°æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼å¿…é¡»å¤§äºä¸Šä¸€ä¸ªé¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å€¼ã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå¯ä»¥ç§°ä¸ºé¡µåˆ†è£‚ã€‚\nç»™æ‰€æœ‰çš„é¡µå»ºç«‹ä¸€ä¸ªç›®å½•é¡¹ # å‰æï¼šindex_demoè¡¨ä¸­æœ‰å¤šæ¡è®°å½•çš„æ•ˆæœ\n1é¡µæœ‰16KBï¼Œè¿™äº›é¡µåœ¨ç£ç›˜ä¸Šå¯èƒ½å¹¶ä¸è¿ç»­ï¼Œè¦æƒ³ä»è¿™ä¹ˆå¤šé¡µä¸­æ ¹æ®ä¸»é”®å€¼å¿«é€Ÿå®šä½æŸäº›è®°å½•æ‰€åœ¨çš„é¡µï¼Œéœ€è¦ç»™ä»–ä»¬ç¼–åˆ¶ä¸€ä¸ªç›®å½•ï¼Œæ¯ä¸ªé¡µå¯¹åº”ä¸€ä¸ªç›®å½•é¡¹ï¼Œæ¯ä¸ªç›®å½•é¡¹åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼š\né¡µçš„ç”¨æˆ·è®°å½•ä¸­æœ€å°çš„ä¸»é”®å€¼ï¼Œç”¨keyè¡¨ç¤º é¡µå·ï¼Œpage_noè¡¨ç¤º å‡è®¾æˆ‘ä»¬æ­¤æ—¶æŠŠç›®å½•é¡¹åœ¨ç‰©ç†å­˜å‚¨å™¨ä¸Šè¿ç»­å­˜å‚¨ï¼Œæ¯”å¦‚æ”¾åˆ°æ•°ç»„ä¸­ï¼Œæ­¤æ—¶å°±å¯ä»¥æ ¹æ®ä¸»é”®å€¼å¿«é€ŸæŸ¥æ‰¾æŸæ¡è®°å½•\nå…ˆç”¨äºŒåˆ†æ³•å¿«é€Ÿå®šä½ä¸»é”®20çš„è®°å½•åœ¨ç›®å½•é¡¹3ä¸­ï¼ˆå› ä¸º12\u0026lt;20\u0026lt;209)ï¼Œå¯¹åº”é¡µæ˜¯9\næ ¹æ®å‰é¢è¯´çš„æ–¹å¼åœ¨é¡µ9ä¸­å®šä½å…·ä½“è®°å½•\nå…ˆåœ¨é¡µç›®å½•ä¸­äºŒåˆ†æŸ¥æ‰¾ï¼Œæ‰¾åˆ°å¯¹åº”çš„ç»„åæ²¿é“¾è¡¨éå†\nè¿™ä¸ªç›®å½•é¡¹çš„åˆ«åï¼šç´¢å¼•\nInnoDBä¸­çš„ç´¢å¼•æ–¹æ¡ˆ # ä¸Šè¿°æ–¹æ¡ˆçš„é—®é¢˜ # InnoDBä½¿ç”¨é¡µä½œä¸ºç®¡ç†å­˜å‚¨ç©ºé—´çš„åŸºæœ¬å•ä½ï¼Œå³åªèƒ½ä¿è¯16KBçš„è¿ç»­å­˜å‚¨ç©ºé—´ï¼Œå¦‚æœè®°å½•éå¸¸å¤šï¼Œåˆ™éœ€è¦çš„è¿ç»­å­˜å‚¨ç©ºé—´å°±éå¸¸å¤§ å¢åˆ æ”¹æ˜¯å¾ˆé¢‘ç¹çš„ï¼Œå¦‚æœé¡µ28çš„è®°å½•å…¨éƒ¨ç§»é™¤ï¼Œé‚£ä¹ˆç›®å½•é¡¹2å°±æ²¡æœ‰å‡ºç°çš„å¿…è¦ï¼Œå³è¦åˆ é™¤ç›®å½•é¡¹2ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ç›®å½•é¡¹éƒ½éœ€è¦å·¦ç§»/æˆ–è€…ä¸ç§»åŠ¨ï¼Œä½œä¸ºå†—ä½™æ”¾åˆ°ç›®å½•é¡¹åˆ—è¡¨ä¸­ï¼Œæµªè´¹ç©ºé—´ æ–¹æ¡ˆ # å¤ç”¨ä¹‹å‰å­˜å‚¨ç”¨æˆ·è®°å½•çš„æ•°æ®é¡µæ¥å­˜å‚¨ç›®å½•é¡¹ï¼Œç”¨äº†å’Œç”¨æˆ·è®°å½•è¿›è¡ŒåŒºåˆ†ï¼ŒæŠŠè¿™äº›ç”¨æ¥è¡¨ç¤ºç›®å½•é¡¹çš„è®°å½•ç§°ä¸ºç›®å½•é¡¹è®°å½•ã€‚å¦‚ä½•åŒºåˆ†ä¸€æ¡è®°å½•æ˜¯æ™®é€šç”¨æˆ·è®°å½•ï¼Œè¿˜æ˜¯ç›®å½•é¡¹è®°å½•ï¼šä½¿ç”¨è®°å½•å¤´ä¿¡æ¯ä¸­çš„record_typeå±æ€§\n0ï¼šæ™®é€šç”¨æˆ·è®°å½• 1ï¼šç›®å½•é¡¹è®°å½• 2ï¼šInfimumè®°å½• 3ï¼šSupremumè®°å½• å°†ç›®å½•é¡¹æ”¾åˆ°æ•°æ®é¡µä¸­\næ–°åˆ†é…äº†ä¸€ä¸ªç¼–å·ä¸º30çš„é¡µæ¥ä¸“é—¨å­˜å‚¨ç›®å½•é¡¹è®°å½•\nç›®å½•é¡¹è®°å½•å’Œæ™®é€šçš„ç”¨æˆ·è®°å½•çš„ä¸åŒç‚¹\nç›®å½•é¡¹è®°å½•çš„record_typeå€¼ä¸º1ï¼Œæ™®é€šç”¨æˆ·è®°å½•record_typeå€¼ä¸º0\nç›®å½•é¡¹è®°å½•åªæœ‰ä¸»é”®å€¼å’Œé¡µçš„ç¼–å·è¿™ä¸¤ä¸ªåˆ—ï¼Œè€Œæ™®é€šç”¨æˆ·è®°å½•çš„åˆ—æ˜¯ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ï¼Œå¯èƒ½åŒ…å«è®¸å¤šåˆ—ï¼Œå¦å¤–è¿˜æœ‰InnoDBè‡ªå·±æ·»åŠ çš„éšè—åˆ—\nè®°å½•å¤´ä¿¡æ¯ä¸­æœ‰ä¸€ä¸ªåä¸ºmin_rec_flagçš„å±æ€§ï¼Œåªæœ‰ç›®å½•é¡¹è®°å½•çš„min_rec_flagå±æ€§æ‰å¯èƒ½ä¸º1ï¼Œæ™®é€šè®°å½•çš„min_rec_flagå±æ€§éƒ½æ˜¯0\nB+ æ ‘ä¸­æ¯å±‚éå¶å­èŠ‚ç‚¹ä¸­çš„æœ€å°çš„ç›®å½•é¡¹è®°å½•éƒ½ä¼šæ·»åŠ è¯¥æ ‡è®°\nå…¶ä»–ï¼š\nå®ƒä»¬ç”¨çš„æ˜¯ä¸€æ ·çš„æ•°æ®é¡µ(é¡µé¢ç±»å‹éƒ½æ˜¯Ox45BF ï¼Œè¿™ä¸ªå±æ€§åœ¨File Header ä¸­)ï¼›é¡µçš„ç»„æˆç»“æ„ä¹Ÿæ˜¯ä¸€æ ·çš„ã€ˆå°±æ˜¯æˆ‘ä»¬å‰é¢ä»‹ç»è¿‡çš„7 ä¸ªéƒ¨åˆ†)ï¼›éƒ½ä¼šä¸ºä¸»é”®å€¼ç”ŸæˆPage Directoryï¼ˆé¡µç›®å½•ï¼‰ä»è€Œåœ¨æŒ‰ç…§ä¸»é”®å€¼è¿›è¡ŒæŸ¥æ‰¾æ—¶å¯ä»¥ä½¿ç”¨ äºŒåˆ†æ³•æ¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚\nä¸¾ä¾‹ # å•ä¸ª ç›®å½•é¡¹è®°å½•é¡µ # å…¶ä¸­ï¼Œé¡µ30ä¸­å­˜å‚¨çš„ä¸»é”®å€¼åˆ†åˆ«ä¸º1ï¼Œ5ï¼Œ12ï¼Œ209\nå‡è®¾æˆ‘ä»¬ç°åœ¨è¦æŸ¥æ‰¾ä¸»é”®å€¼ä¸º20çš„è®°å½•ï¼š\nå…ˆåˆ°å­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µï¼ˆè¿™é‡Œæ˜¯é¡µ30ï¼‰ä¸­ï¼Œï¼ˆç”±äºæœ‰é¡µç›®å½•ï¼‰é€šè¿‡äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°å¯¹åº”çš„ç›®å½•é¡¹è®°å½•ï¼Œå› ä¸º12\u0026lt;20\u0026lt;209ï¼Œæ‰€ä»¥å®šä½åˆ°å¯¹åº”çš„ç”¨æˆ·è®°å½•æ‰€åœ¨çš„é¡µå°±æ˜¯é¡µ9 å†åˆ°å­˜å‚¨ç”¨æˆ·è®°å½•çš„é¡µ9ä¸­æ ¹æ®äºŒåˆ†æ³•ï¼ˆç”±äºæœ‰é¡µç›®å½•ï¼‰ï¼‰å¿«é€Ÿå®šä½åˆ°ä¸»é”®å€¼ä¸º20çš„ç”¨æˆ·è®°å½• ç›®å½•é¡¹è®°å½•ä¸­åªå­˜å‚¨ä¸»é”®å€¼å’Œå¯¹åº”çš„é¡µå·ï¼Œå­˜å‚¨ç©ºé—´æå°ï¼Œä½†ä¸€ä¸ªé¡µåªæœ‰16KBï¼Œå­˜æ”¾çš„ç›®å½•é¡¹è®°å½•æœ‰é™ã€‚å¦‚æœè¡¨ä¸­æ•°æ®å¤ªå¤šï¼ˆé¡µå¤ªå¤šï¼‰ï¼Œä»¥è‡³äºä¸€ä¸ªæ•°æ®é¡µä¸è¶³ä»¥å­˜æ”¾æ‰€æœ‰çš„ç›®å½•é¡¹è®°å½•\nå¤šä¸ª ç›®å½•é¡¹è®°å½•çš„é¡µ # è§£å†³æ–¹æ¡ˆï¼šæ–°å¢ä¸€ä¸ªå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µ\næ­¤æ—¶å†è¿›è¡ŒæŸ¥æ‰¾\nç¡®å®šå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µ\nç°åœ¨å­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µæœ‰2ä¸ªï¼Œå³é¡µ30å’Œé¡µ32ã€‚åˆå› ä¸ºé¡µ30è¡¨ç¤ºçš„ç›®å½•é¡¹è®°å½•ä¸»é”®å€¼èŒƒå›´æ˜¯**[1ï¼Œ320)ï¼Œé¡µ32è¡¨ç¤ºçš„ç›®å½•é¡¹è®°å½•ä¸»é”®å€¼èŒƒå›´ \u0026gt; 320ã€‚æ‰€ä»¥ç¡®å®šä¸»é”®å€¼ä¸º20çš„è®°å½•å¯¹åº”çš„ç›®å½•é¡¹è®°å½•**åœ¨é¡µ30ä¸­ æŒ‰ç…§å•ä¸ª ç›®å½•é¡¹è®°å½•é¡µçš„æ–¹æ¡ˆæŸ¥æ‰¾ å¤šä¸ªç›®å½•é¡¹è®°å½•é¡µ # å¦‚æœæ•°æ®å†å¢åŠ ï¼Œåˆ™å†ç”Ÿæˆå­˜å‚¨æ›´é«˜çº§ç›®å½•é¡¹è®°å½•çš„æ•°æ®é¡µ\næ— è®ºæ˜¯å­˜æ”¾ç”¨æˆ·è®°å½•çš„æ•°æ®é¡µï¼Œè¿˜æ˜¯å­˜æ”¾ç›®å½•é¡¹è®°å½•çš„æ•°æ®é¡µï¼Œéƒ½æ”¾åˆ°B+æ ‘æ•°æ®ç»“æ„ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå°†è¿™äº›æ•°æ®é¡µç§°ä¸ºB+æ ‘çš„èŠ‚ç‚¹\nå¦‚å›¾ï¼Œæˆ‘ä»¬çœŸæ­£çš„ç”¨æˆ·è®°å½•å…¶å®éƒ½å­˜æ”¾åœ¨B+æ ‘æœ€åº•å±‚çš„èŠ‚ç‚¹ä¸Šï¼Œè¿™äº›èŠ‚ç‚¹ä¹Ÿç§°ä¸ºå¶å­èŠ‚ç‚¹æˆ–é¡µèŠ‚ç‚¹ï¼Œå…¶ä½™ç”¨æ¥å­˜æ”¾ç›®å½•é¡¹è®°å½•çš„èŠ‚ç‚¹ç§°ä¸ºéå¶å­èŠ‚ç‚¹æˆ–è€…å†…èŠ‚ç‚¹ï¼Œå…¶ä¸­B+æ ‘æœ€ä¸Šè¾¹çš„é‚£ä¸ªèŠ‚ç‚¹ä¹Ÿç§°ä¸ºæ ¹èŠ‚ç‚¹ è¿™é‡Œæˆ‘ä»¬è§„å®šï¼Œæœ€ä¸‹é¢é‚£å±‚ï¼ˆå­˜æ”¾ç”¨æˆ·è®°å½•çš„é‚£å±‚ï¼‰ä¸º0å±‚ï¼Œä¹‹åå±‚çº§ä¾æ¬¡å¾€ä¸ŠåŠ ã€‚\nè¿™é‡Œæˆ‘ä»¬å‡è®¾æ‰€æœ‰å­˜æ”¾ç”¨æˆ·è®°å½•çš„å¶å­èŠ‚ç‚¹æ‰€ä»£è¡¨çš„æ•°æ®é¡µå¯ä»¥å­˜æ”¾100æ¡ç”¨æˆ·è®°å½•ï¼ˆ16KB=16 * 1024 â‰ˆ10000 å­—èŠ‚ï¼Œå·®ä¸å¤šä¸€æ¡è®°å½•100å­—èŠ‚ï¼‰ï¼Œå‡è®¾æ‰€æœ‰å­˜æ”¾ç›®å½•é¡¹è®°å½•çš„å†…èŠ‚ç‚¹æ‰€ä»£è¡¨çš„æ•°æ®é¡µå¯ä»¥å­˜æ”¾1000æ¡ç›®å½•é¡¹è®°å½•ï¼ˆ10000å­—èŠ‚ï¼Œå‡è®¾1ä¸ªç›®å½•é¡¹10å­—èŠ‚ï¼‰ï¼Œé‚£ä¹ˆå¦‚æœ\nå¦‚æœB+æ ‘æœ‰1å±‚ï¼Œé‚£ä¹ˆåªæœ‰ä¸€ä¸ªç”¨äºå­˜æ”¾ç”¨æˆ·è®°å½•çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆèƒ½å­˜æ”¾100æ¡ç”¨æˆ·è®°å½•ï¼ˆ1ç™¾ï¼‰ å¦‚æœB+æ ‘æœ‰2å±‚ï¼Œé‚£ä¹ˆèƒ½å­˜æ”¾ 1000 * 100=100,000æ¡ç”¨æˆ·è®°å½•(10ä¸‡) å¦‚æœB+æ ‘æœ‰3å±‚ï¼Œé‚£ä¹ˆèƒ½å­˜æ”¾ 1000 * 1000 * 100=100,000,000æ¡ç”¨æˆ·è®°å½•(1äº¿) å¦‚æœB+æ ‘æœ‰4å±‚ï¼Œé‚£ä¹ˆèƒ½å­˜æ”¾ 1000 * 1000 * 1000 * 100=100,000,000,000æ¡ç”¨æˆ·è®°å½• (1000äº¿) æ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”¨åˆ°çš„B+æ ‘ä¸ä¼šè¶…è¿‡4å±‚ã€‚\nå½“æˆ‘ä»¬è¦é€šè¿‡ä¸»é”®å€¼æŸ¥æ‰¾**æŸæ¡è®°å½• **\næœ€å¤šåªéœ€è¦è¿›è¡Œ4ä¸ªé¡µé¢å†…çš„æŸ¥æ‰¾ï¼ˆæŸ¥æ‰¾3ä¸ªå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µå’Œ1ä¸ªå­˜å‚¨ç”¨æˆ·è®°å½•çš„é¡µï¼‰ æ¯ä¸ªé¡µé¢å†…å­˜åœ¨PageDirectoryï¼ˆé¡µç›®å½•ï¼‰ï¼Œæ‰€ä»¥åœ¨é¡µé¢å†…ä¹Ÿå¯ä»¥é€šè¿‡äºŒåˆ†æ³•å¿«é€Ÿå®šä½è®°å½• PageHeaderä¸­ï¼Œæœ‰ä¸€ä¸ªåä¸ºPAGE_LEVELçš„å±æ€§ï¼Œä»£è¡¨ç€è¿™ä¸ªæ•°æ®é¡µä½œä¸ºèŠ‚ç‚¹åœ¨B+æ ‘ä¸­çš„å±‚çº§\nèšç°‡ç´¢å¼• # å‰é¢ä»‹ç»çš„B+æ ‘æœ¬èº«å°±æ˜¯ä¸€ä¸ªè®°å½•ï¼Œæˆ–è€…è¯´æœ¬èº«å°±æ˜¯ä¸€ä¸ªç´¢å¼•ï¼Œæœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹ç‚¹\nä½¿ç”¨è®°å½•ä¸»é”®å€¼çš„å¤§å°è¿›è¡Œè®°å½•å’Œé¡µçš„æ’åº é¡µï¼ˆåŒ…æ‹¬å¶å­èŠ‚ç‚¹å’Œå†…èŠ‚ç‚¹ï¼‰å†…çš„è®°å½•ï¼ŒæŒ‰ç…§ä¸»é”®å¤§å°é¡ºåºæ’æˆä¸€ä¸ªå•å‘é“¾è¡¨ï¼Œé¡µå†…çš„è®°å½•è¢«åˆ’åˆ†æˆè‹¥å¹²ä¸ªç»„ï¼Œæ¯ä¸ªç»„ä¸­ä¸»é”®å€¼æœ€å¤§çš„è®°å½•åœ¨é¡µå†…çš„åç§»é‡ä¼šè¢«å½“ä½œæ§½ä¸€æ¬¡å­˜æ”¾åœ¨é¡µç›®å½•ä¸­ï¼ˆSupremumè®°å½•æ¯”ä»»ä½•ç”¨æˆ·è®°å½•éƒ½å¤§ï¼‰ä¹‹åå¯ä»¥åœ¨é¡µç›®å½•ä¸­é€šè¿‡äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°ä¸»é”®åˆ—ç­‰äºæŸä¸ªå€¼çš„è®°å½• å„ä¸ªå­˜æ”¾ç”¨æˆ·è®°å½•çš„é¡µä¹Ÿæ˜¯æ ¹æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„ä¸»é”®å¤§å°é¡ºåºæ’æˆä¸€ä¸ªåŒå‘é“¾è¡¨ å­˜æ”¾ç›®å½•é¡¹è®°å½•çš„é¡µåˆ†ä¸ºä¸åŒçš„å±‚çº§ï¼Œåœ¨åŒä¸€å±‚çº§ä¸­ä¹Ÿæ˜¯æ ¹æ®é¡µç›®å½•é¡¹è®°å½•çš„ä¸»é”®å¤§å°é¡ºåºæ’æˆä¸€ä¸ªåŒå‘é“¾è¡¨ B+æ ‘çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼ˆæŒ‡çš„æ˜¯è¿™ä¸ªè®°å½•ä¸­å­˜å‚¨äº†æ‰€æœ‰åˆ—çš„å€¼ï¼ˆåŒ…æ‹¬éšè—åˆ—ï¼‰ï¼‰ å…·æœ‰ä¸Šé¢ä¸¤ä¸ªç‰¹ç‚¹çš„B+æ ‘ç§°ä¸ºèšç°‡ç´¢å¼•ã€‚æ‰€æœ‰å®Œæ•´çš„ç”¨æˆ·è®°å½•éƒ½å­˜æ”¾åœ¨è¿™ä¸ªèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å¤„ã€‚è¿™ç§èšç°‡ç´¢å¼•ï¼Œä¸éœ€è¦æˆ‘ä»¬åœ¨MySQLè¯­å¥ä¸­æ˜¾ç¤ºä½¿ç”¨INDEXè¯­å¥å»åˆ›å»ºï¼ŒInnoDBä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºèšç°‡ç´¢å¼•\nInnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œèšç°‡ç´¢å¼•å°±æ˜¯æ•°æ®çš„å­˜å‚¨æ–¹å¼ï¼ˆæ‰€æœ‰çš„ç”¨æˆ·è®°å½•éƒ½å­˜å‚¨åœ¨äº†å¶å­èŠ‚ç‚¹ï¼‰ã€‚ç´¢å¼•å³æ•°æ®ï¼Œæ•°æ®å³ç´¢å¼•\näºŒçº§ç´¢å¼• # èšç°‡ç´¢å¼•åªèƒ½åœ¨æœç´¢æ¡ä»¶æ˜¯ä¸»é”®å€¼æ—¶æ‰å‘æŒ¥ä½œç”¨ï¼Œå¦‚æœè¦ä»¥åˆ«çš„åˆ—ä½œä¸ºæœç´¢æ¡ä»¶ï¼Œå¯ä»¥å¤šå»ºå‡ é¢—B+æ ‘ï¼Œè€Œä¸”ä¸åŒB+æ ‘ä¸­çš„æ•°æ®ï¼Œé‡‡ç”¨ä¸åŒçš„æ’åºè§„åˆ™\næ¯”å¦‚ç”¨c2åˆ—çš„å¤§å°ä½œä¸ºæ•°æ®é¡µã€é¡µä¸­è®°å½•çš„æ’åºè§„åˆ™ï¼Œå†å»ºä¸€é¢—B+æ ‘\n\u0026ldquo;å‰è¨€ï¼šc1å·²ç»æ˜¯ä¸»é”®äº†\u0026rdquo;\n#ä¾‹å­ mysql\u0026gt; CREATE TABLE index_demo( c1 INT, c2 INT, c3 CHAR(1), PRIMARY KEY(c1) ) ROW_FORMAT=COMPACT; ä¸‹é¢æ˜¯èšç°‡ç´¢å¼•ç‰¹ç‚¹ï¼š\näºŒçº§ç´¢å¼•è¯´æ˜ï¼š\nä½¿ç”¨è®°å½•c2åˆ—çš„å¤§å°è¿›è¡Œè®°å½•å’Œé¡µçš„æ’åº é¡µï¼ˆåŒ…æ‹¬å¶å­èŠ‚ç‚¹å’Œå†…èŠ‚ç‚¹ï¼‰å†…çš„è®°å½•ï¼ŒæŒ‰ç…§c2åˆ—å¤§å°é¡ºåºæ’æˆä¸€ä¸ªå•å‘é“¾è¡¨ï¼Œé¡µå†…çš„è®°å½•è¢«åˆ’åˆ†æˆè‹¥å¹²ä¸ªç»„ï¼Œæ¯ä¸ªç»„ä¸­c2åˆ—å€¼æœ€å¤§çš„è®°å½•åœ¨é¡µå†…çš„åç§»é‡ä¼šè¢«å½“ä½œæ§½ä¸€æ¬¡å­˜æ”¾åœ¨é¡µç›®å½•ä¸­ï¼ˆSupremumè®°å½•æ¯”ä»»ä½•ç”¨æˆ·è®°å½•éƒ½å¤§ï¼‰ä¹‹åå¯ä»¥åœ¨é¡µç›®å½•ä¸­é€šè¿‡äºŒåˆ†æ³•å¿«é€Ÿå®šä½åˆ°c2åˆ—å€¼ç­‰äºæŸä¸ªå€¼çš„è®°å½• å„ä¸ªå­˜æ”¾ç”¨æˆ·è®°å½•çš„é¡µä¹Ÿæ˜¯æ ¹æ®é¡µä¸­ç”¨æˆ·è®°å½•çš„c2åˆ—å¤§å°é¡ºåºæ’æˆä¸€ä¸ªåŒå‘é“¾è¡¨ å­˜æ”¾ç›®å½•é¡¹è®°å½•çš„é¡µåˆ†ä¸ºä¸åŒçš„å±‚çº§ï¼Œåœ¨åŒä¸€å±‚çº§ä¸­ä¹Ÿæ˜¯æ ¹æ®é¡µç›®å½•é¡¹è®°å½•çš„c2åˆ—å¤§å°é¡ºåºæ’æˆä¸€ä¸ªåŒå‘é“¾è¡¨ B+æ ‘çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯å¹¶ä¸æ˜¯å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œè€Œåªæ˜¯c2åˆ—+ä¸»é”®è¿™ä¸¤ä¸ªåˆ—çš„å€¼ ç›®å½•é¡¹è®°å½•ä¸­ä¸å†æ˜¯ä¸»é”®+é¡µå·çš„åŒ¹é…ï¼Œè€Œå˜æˆäº†c2åˆ—+é¡µå·çš„æ­é… B+æ ‘å¦‚ä¸‹\nä¸¾ä¾‹ # å‡è®¾è¦æŸ¥æ‰¾c2=4çš„è®°å½•ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šé¢çš„B+æ ‘ã€‚ç”±äºc2æ²¡æœ‰å”¯ä¸€æ€§çº¦æŸï¼Œæ‰€ä»¥å¯èƒ½ä¼šæœ‰å¾ˆå¤šæ¡ï¼šæˆ‘ä»¬åªéœ€è¦åœ¨è¯¥B+æ ‘çš„å¶å­èŠ‚ç‚¹å¤„å®šä½åˆ°ç¬¬ä¸€æ¡æ»¡è¶³æœç´¢æ¡ä»¶c2=4çš„é‚£æ¡ï¼Œç„¶åç”±è®°å½•ç»„æˆçš„å•å‘é“¾è¡¨ä¸€ç›´å‘åæ‰«æå³å¯ã€‚å¦å¤–ï¼Œå„ä¸ªå¶å­èŠ‚ç‚¹ç»„æˆäº†åŒå‘é“¾è¡¨ï¼Œæœç´¢å®Œäº†æœ¬é¡µé¢çš„è®°å½•åå¯ä»¥é¡ºåˆ©è·³åˆ°ä¸‹ä¸€ä¸ªé¡µé¢ä¸­çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œç„¶åæ²¿ç€è®°å½•ç»„æˆçš„å•å‘é“¾è¡¨å‘åæ‰«æ\næŸ¥æ‰¾è¿‡ç¨‹ # ç¡®å®šç¬¬ä¸€æ¡ç¬¦åˆc2=4æ¡ä»¶çš„ç›®å½•é¡¹è®°å½•æ‰€åœ¨çš„é¡µ\næ ¹æ®**æ ¹é¡µé¢ï¼ˆ44ï¼‰**å¯ä»¥å¿«é€Ÿå®šä½åˆ°ç¬¬ä¸€æ¡ç¬¦åˆc2=4æ¡ä»¶çš„ç›®å½•é¡¹è®°å½•æ‰€åœ¨é¡µä¸ºé¡µ42ï¼ˆå› ä¸º2\u0026lt;4\u0026lt;9)\né€šè¿‡ç¬¬ä¸€æ¡ç¬¦åˆc2=4æ¡ä»¶çš„ç›®å½•é¡¹è®°å½•æ‰€åœ¨çš„é¡µé¢ç¡®å®šç¬¬ä¸€æ¡ç¬¦åˆc2=4æ¡ä»¶çš„ç”¨æˆ·è®°å½•æ‰€åœ¨çš„é¡µ\næ ¹æ®é¡µ42å¯ä»¥å¿«é€Ÿå®šä½ï¼ˆé€šè¿‡é¡µç›®å½•ï¼‰åˆ°ç¬¬ä¸€æ¡ç¬¦åˆæ¡ä»¶çš„ç”¨æˆ·è®°å½•æ‰€åœ¨é¡µä¸º34æˆ–35ï¼Œå› ä¸º2\u0026lt;4\u0026lt;=4\nåœ¨çœŸæ­£å­˜å‚¨ç¬¬ä¸€æ¡ç¬¦åˆc2=4æ¡ä»¶çš„ç”¨æˆ·è®°å½•çš„é¡µä¸­å®šä½åˆ°å…·ä½“çš„è®°å½•\né¡µ34å’Œé¡µ35ä¸­å®šä½åˆ°å…·ä½“çš„ç”¨æˆ·è®°å½•ï¼ˆå¦‚æœé¡µ34ä½¿ç”¨é¡µç›®å½•å®šä½åˆ°ç¬¬ä¸€æ¡ç¬¦åˆæ¡ä»¶çš„ç”¨æˆ·è®°å½•ï¼Œå°±ä¸éœ€è¦å†åˆ°35ä¸­å»å†å®šä½ï¼Œå› ä¸ºç›´æ¥ä¸€ç›´å¾€åæŸ¥æ‰¾åˆ°ä¸ç­‰çš„è®°å½•å³å¯ï¼‰\nç”±äºè¿™ä¸ªB+æ ‘çš„å¶å­èŠ‚ç‚¹çš„è®°å½•åªå­˜å‚¨äº†c2å’Œc1ï¼ˆå³ä¸»é”®ï¼‰ä¸¤ä¸ªåˆ—ã€‚åœ¨å¶å­èŠ‚ç‚¹å®šä½åˆ°ç¬¬ä¸€æ¡ç¬¦åˆæ¡ä»¶çš„é‚£æ¡ç”¨æˆ·è®°å½•ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è¯¥çºªå½•ä¸­çš„ä¸»é”®ä¿¡æ¯ï¼Œåˆ°èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œè¿™ä¸ªé€šè¿‡æºå¸¦ä¸»é”®ä¿¡æ¯åˆ°èšç°‡ç´¢å¼•ä¸­é‡æ–°å®šä½å®Œæ•´çš„ç”¨æˆ·è®°å½•çš„è¿‡ç¨‹ä¹Ÿç§°ä¸ºå›è¡¨ ã€‚\nç„¶åå†è¿”å›åˆ°è¿™æ£µB+ æ ‘çš„å¶å­èŠ‚ç‚¹å¤„ï¼Œæ‰¾åˆ°åˆšæ‰å®šä½åˆ°çš„ç¬¦åˆæ¡ä»¶çš„é‚£æ¡ç”¨æˆ·è®°å½•ï¼Œå¹¶æ²¿ç€è®°å½•ç»„æˆçš„å•å‘é“¾è¡¨å‘åç»§ç»­æœç´¢å…¶ä»–ä¹Ÿæ»¡è¶³c2=4çš„è®°å½•**ï¼Œæ¯æ‰¾åˆ°ä¸€æ¡çš„è¯å°±ç»§ç»­è¿›è¡Œå›è¡¨æ“ä½œã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°ä¸‹ä¸€æ¡è®°å½•ä¸æ»¡è¶³c2 =4**çš„è¿™ä¸ªæ¡ä»¶ä¸ºæ­¢.\nå¦‚æœæŠŠå®Œæ•´çš„ç”¨æˆ·è®°å½•æ”¾åˆ°å¶å­èŠ‚ç‚¹æ˜¯å¯ä»¥ä¸ç”¨å›è¡¨ï¼Œä½†æ˜¯å¤ªå åœ°æ–¹äº†\nå› ä¸ºè¿™ç§ä»¥éä¸»é”®åˆ—çš„å¤§å°ä¸ºæ’åºè§„åˆ™è€Œå»ºç«‹çš„B+ æ ‘éœ€è¦æ‰§è¡Œå›è¡¨æ“ä½œæ‰å¯ä»¥å®šä½åˆ°å®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼Œæ‰€ä»¥è¿™ç§B+ æ ‘ä¹Ÿç§°ä¸ºäºŒçº§ç´¢å¼•(Secondary Index) æˆ–è¾…åŠ©ç´¢å¼•ã€‚ç”±äºæˆ‘ä»¬æ˜¯ä»¥c2 åˆ—çš„å¤§å°ä½œä¸ºB+ æ ‘çš„æ’åºè§„åˆ™ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿç§°è¿™æ£µB+ æ ‘ä¸ºä¸ºc2 åˆ—å»ºç«‹çš„ç´¢å¼•ï¼ŒæŠŠc2åˆ—ç§°ä¸ºç´¢å¼•åˆ—ã€‚äºŒçº§ç´¢å¼•è®°å½•å’Œèšç°‡ç´¢å¼•è®°å½•ä½¿ç”¨çš„æ˜¯ä¸€æ ·çš„è®°å½•è¡Œæ ¼å¼ï¼Œåªä¸è¿‡äºŒçº§ç´¢å¼•è®°å½•å­˜å‚¨çš„åˆ—ä¸åƒèšç°‡ç´¢å¼•è®°å½•é‚£ä¹ˆå®Œæ•´ã€‚\næŠŠèšç°‡ç´¢å¼•æˆ–è€…äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­çš„è®°å½•ç§°ä¸ºç”¨æˆ·è®°å½•ã€‚ä¸ºäº†åŒºåˆ†ï¼Œä¹ŸæŠŠèšç°‡ç´¢å¼•å¶å­èŠ‚ç‚¹ä¸­çš„è®°å½•ç§°ä¸ºå®Œæ•´çš„ç”¨æˆ·è®°å½•ï¼ŒæŠŠäºŒçº§ç´¢å¼•å¶å­èŠ‚ç‚¹ä¸­çš„è®°å½•ç§°ä¸ºä¸å®Œæ•´çš„ç”¨æˆ·è®°å½•\nå¦‚æœä¸ºä¸€ä¸ªå­˜å‚¨å­—ç¬¦ä¸²çš„åˆ—å»ºç«‹ç´¢å¼•ï¼Œåˆ«å¿˜äº†å‰é¢è¯´çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼Œå­—ç¬¦ä¸²ä¹Ÿæ˜¯å¯ä»¥æ¯”è¾ƒå¤§å°çš„\nè”åˆç´¢å¼• # åŒæ—¶ä»¥å¤šä¸ªåˆ—çš„å¤§å°ä½œä¸ºæ’åºè§„åˆ™ï¼Œä¹Ÿå°±æ˜¯åŒæ—¶ä¸ºå¤šä¸ªåˆ—å»ºç«‹ç´¢å¼•ï¼Œå«ä¹‰ï¼š\nå…ˆæŠŠå„ä¸ªè®°å½•å’Œé¡µæŒ‰ç…§c2åˆ—è¿›è¡Œæ’åº è®°å½•çš„c2åˆ—ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œå†é‡‡ç”¨c3è¿›è¡Œæ’åº æ¯æ¡ç›®å½•é¡¹è®°å½•éƒ½ç”±c2åˆ—ã€c3åˆ—ã€é¡µå·è¿™3ä¸ªéƒ¨åˆ†ç»„æˆã€‚å„æ¡è®°å½•å…ˆæŒ‰ç…§c2åˆ—çš„å€¼è¿›è¡Œæ’åºã€‚å¦‚æœè®°å½•çš„c2åˆ—ç›¸åŒï¼Œåˆ™æŒ‰ç…§c3åˆ—çš„å€¼è¿›è¡Œæ’åº\nè¿™é‡Œè¯´çš„æ˜¯æç‰¹æ®Šçš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯c2åˆ—ç›¸åŒçš„è®°å½•æœ‰å¾ˆå¤šå¾ˆå¤šæ¡ï¼Œå¯¼è‡´å¥½å‡ ä¸ªé¡µéƒ½æœ‰c2 = xçš„è®°å½•ï¼Œè€Œä¸”å…¶ä¸­c3åˆ—çš„å€¼è¿˜ä¸åŒï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°ç›®å½•é¡¹è®°å½•é¡µä¸­çš„ç›®å½•é¡¹c2ç›¸åŒè€Œc3ä¸ç›¸åŒ\nB+æ ‘å¶å­èŠ‚ç‚¹å¤„çš„ç”¨æˆ·è®°å½•ç”±c2åˆ—ã€c3åˆ—ã€å’Œä¸»é”®c1åˆ—ç»„æˆ\nä»¥c2 å’Œc3 åˆ—çš„å¤§å°ä¸ºæ’åºè§„åˆ™å»ºç«‹çš„B+ æ ‘ç§°ä¸ºè”åˆç´¢å¼•ï¼Œä¹Ÿç§°ä¸ºå¤åˆç´¢ å¼•æˆ–å¤šåˆ—ç´¢å¼•ã€‚å®ƒæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªäºŒçº§ç´¢å¼•ï¼Œå®ƒçš„ç´¢å¼•åˆ—åŒ…æ‹¬c2ã€c3.éœ€è¦æ³¨æ„çš„æ˜¯\u0026quot;ä»¥c2å’Œc3åˆ—çš„å¤§å°ä¸ºæ’åºè§„åˆ™å»ºç«‹è”åˆç´¢å¼•\u0026ldquo;å’Œ\u0026rdquo;åˆ†åˆ«ä¸ºc2å’Œd åˆ—å»ºç«‹ç´¢å¼•\u0026quot; çš„è¡¨è¿°æ˜¯ä¸åŒçš„ï¼Œ ä¸åŒç‚¹å¦‚ä¸‹ï¼š\nå»ºç«‹è”åˆç´¢å¼•åªä¼šå»ºç«‹å¦‚å›¾6-15 æ‰€ç¤ºçš„ä¸€æ£µB+ æ ‘ ä¸ºc2 å’Œc3 åˆ—åˆ†åˆ«å»ºç«‹ç´¢å¼•æ—¶ï¼Œåˆ™ä¼šåˆ†åˆ«ä»¥c2 å’Œc3 åˆ—çš„å¤§å°ä¸ºæ’åºè§„åˆ™å»ºç«‹ä¸¤æ£µB+ æ ‘ Innoä¸­B+æ ‘ç´¢å¼•çš„æ³¨æ„äº‹é¡¹ # æ ¹é¡µé¢ä¸‡å¹´ä¸åŠ¨çª # å‰é¢ä¸ºäº†ç†è§£æ–¹ä¾¿ï¼Œæˆ‘ä»¬å…ˆæŠŠå­˜å‚¨ç”¨æˆ·è®°å½•çš„å¶å­èŠ‚ç‚¹éƒ½ç”»å‡ºæ¥ï¼Œç„¶åå†ç”»å‡ºå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„å†…èŠ‚ç‚¹ã€‚è€Œå®é™…ä¸Šæ˜¯è¿™æ ·çš„ï¼š\næ¯å½“ä¸ºæŸä¸ªè¡¨åˆ›å»ºä¸€ä¸ªB+æ ‘ç´¢å¼•ï¼ˆèšç°‡ç´¢å¼•ä¸æ˜¯äººä¸ºåˆ›å»ºçš„ï¼Œé»˜è®¤å°±å­˜åœ¨ï¼‰æ—¶ï¼Œéƒ½ä¼šä¸ºè¿™ä¸ªç´¢å¼•åˆ›å»ºä¸€ä¸ªæ ¹èŠ‚ç‚¹é¡µé¢ã€‚\nä¸€å¼€å§‹è¡¨ä¸­æ²¡æœ‰æ•°æ®çš„æ—¶å€™ï¼Œæ¯ä¸ªB+æ ‘ç´¢å¼•å¯¹åº”çš„æ ¹èŠ‚ç‚¹ä¸­æ—¢æ²¡æœ‰ç”¨æˆ·è®°å½•ï¼Œä¹Ÿæ²¡æœ‰ç›®å½•é¡¹è®°å½• éšåå‘è¡¨ä¸­æ’å…¥ç”¨æˆ·è®°å½•æ—¶ï¼Œå…ˆæŠŠç”¨æˆ·è®°å½•å­˜å‚¨åˆ°è¿™ä¸ªæ ¹èŠ‚ç‚¹ä¸­ å½“æ ¹èŠ‚ç‚¹å¯ç”¨ç©ºé—´ç”¨å®Œæ—¶ï¼Œç»§ç»­æ’å…¥è®°å½•ï¼Œæ­¤æ—¶ä¼šå°†æ ¹èŠ‚ç‚¹ä¸­çš„æ‰€æœ‰è®°å½•å¤åˆ¶åˆ°ä¸€ä¸ªæ–°åˆ†é…çš„é¡µï¼ˆæ¯”å¦‚é¡µaï¼‰ä¸­ï¼Œç„¶åå¯¹è¿™ä¸ªæ–°é¡µè¿›è¡Œé¡µåˆ†è£‚æ“ä½œï¼Œå¾—åˆ°å¦ä¸€ä¸ªæ–°é¡µï¼ˆæ¯”å¦‚é¡µbï¼‰[å› ä¸ºä¸€ä¸ªé¡µæ”¾ä¸ä¸‹ï¼Œæ‰€ä»¥è¿˜è¦è¿™ä¸ªæ–°é¡µ]ã€‚è¿™æ—¶æ–°æ’å…¥çš„è®°å½•ä¼šæ ¹æ®é”®å€¼ï¼ˆä¹Ÿå°±æ˜¯èšç°‡ç´¢å¼•ä¸­çš„ä¸»é”®å€¼ï¼Œæˆ–è€…äºŒçº§ç´¢å¼•ä¸­å¯¹åº”çš„ç´¢å¼•åˆ—çš„å€¼ï¼‰çš„å¤§å°åˆ†é…åˆ°é¡µaæˆ–è€…é¡µbã€‚æ ¹èŠ‚ç‚¹æ­¤æ—¶ï¼Œä¾¿å‡çº§ä¸ºå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µï¼Œä¹Ÿå°±éœ€è¦æŠŠé¡µaå’Œé¡µbå¯¹åº”çš„ç›®å½•é¡¹è®°å½•æ’å…¥åˆ°æ ¹èŠ‚ç‚¹ä¸­ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œ ä¸€ä¸ªB+ æ ‘ç´¢å¼•çš„æ ¹èŠ‚ç‚¹è‡ªåˆ›å»ºä¹‹æ—¥èµ·ä¾¿ä¸ä¼šå†ç§»åŠ¨(ä¹Ÿå°±æ˜¯é¡µå·ä¸å†æ”¹å˜)ã€‚\nç”±äºè¿™ä¸ªç‰¹æ€§ï¼Œåªè¦æˆ‘ä»¬å¯¹æŸä¸ªè¡¨å»ºç«‹ä¸€ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆå®ƒçš„æ ¹èŠ‚ç‚¹çš„é¡µå·ä¾¿ä¼šè¢«è®°å½•åˆ°æŸä¸ªåœ°æ–¹ï¼Œåç»­å‡¡æ˜¯InnoDBå¼•æ“éœ€è¦ç”¨åˆ°è¿™ä¸ªç´¢å¼•ï¼Œä¼šä»é‚£ä¸ªå›ºå®šçš„åœ°æ–¹å–å‡ºæ ¹èŠ‚ç‚¹çš„é¡µå·ï¼Œä»è€Œè®¿é—®è¿™ä¸ªç´¢å¼•\n\u0026ldquo;å­˜å‚¨æŸä¸ªç´¢å¼•çš„æ ¹èŠ‚ç‚¹åœ¨å“ªä¸ªé¡µé¢ä¸­\u0026rdquo;ï¼Œå°±æ˜¯ä¼ è¯´ä¸­çš„æ•°æ®å­—å…¸ä¸­çš„ä¸€é¡¹ä¿¡æ¯\nè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¹¦ä¸Šæ²¡è¯´ï¼Œå°±æ˜¯æ ¹èŠ‚ç‚¹ä½œä¸ºaï¼Œbé¡µçš„å­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µï¼Œä¸€æ—¦åé¢é¡µè¶Šæ¥è¶Šå¤šï¼Œæ ¹èŠ‚ç‚¹æ”¾ä¸ä¸‹äº†ï¼Œæ¥ä¸‹æ¥\næˆ‘çŒœæ˜¯è¿™æ ·çš„ï¼Œä¹Ÿæ˜¯å†æ–°åˆ†é…ä¸€ä¸ªé¡µXï¼Œç„¶åå¯¹é¡µXé¡µåˆ†è£‚ï¼Œå¾—åˆ°é¡µYã€‚æŠŠæ ¹èŠ‚ç‚¹æ­¤æ—¶çš„æ‰€æœ‰ç›®å½•é¡¹å…¨å¤åˆ¶åˆ°é¡µXï¼Œç„¶åæ–°æ’å…¥çš„ç›®å½•é¡¹è®°å½•æ ¹æ®é”®å€¼åˆ†é…åˆ°é¡µXï¼Œæˆ–Yï¼Œç„¶åæ ¹èŠ‚ç‚¹åˆå˜ä¸ºå­˜å‚¨ç›®å½•é¡¹è®°å½•çš„é¡µ\nå†…èŠ‚ç‚¹ä¸­ç›®å½•é¡¹è®°å½•çš„å”¯ä¸€æ€§ # ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è¯´B+æ ‘ç´¢å¼•çš„å†…èŠ‚ç‚¹ä¸­ï¼Œç›®å½•é¡¹è®°å½•çš„å†…å®¹æ˜¯ç´¢å¼•åˆ—åŠ é¡µå·çš„æ­é…ï¼Œä½†æ˜¯è¿™ä¸ªæ­é…å¯¹äºŒçº§ç´¢å¼•æ¥è¯´æœ‰ç‚¹å„¿ä¸å¤ªä¸¥è°¨ã€‚ä»¥ä¸‹é¢è¿™ä¸ªè¡¨ä¸ºä¾‹ï¼ˆc1æ˜¯ä¸»é”®ï¼Œc2æ˜¯äºŒçº§ç´¢å¼•ï¼‰\nc1 c2 c3 1 1 \u0026lsquo;u\u0026rsquo; 3 1 \u0026rsquo;d' 5 1 \u0026lsquo;y\u0026rsquo; 7 1 \u0026lsquo;a\u0026rsquo; å¦‚æœäºŒçº§ç´¢å¼•ä¸­ï¼Œç›®å½•é¡¹è®°å½•çš„å†…å®¹åªæ˜¯ç´¢å¼•åˆ—+é¡µå·çš„åŒ¹é…ï¼Œé‚£ä¹ˆä¸ºc2åˆ—å»ºç«‹ç´¢å¼•åçš„B+æ ‘å¦‚ä¸‹å›¾6-16\nå¦‚æœæ­¤æ—¶å†æ’å…¥ä¸€æ¡è®°å½• c1=9ï¼Œc2=1ï¼Œc3=\u0026lsquo;c\u0026rsquo;ï¼Œé‚£ä¹ˆåœ¨ä¿®æ”¹ä¸ºc2åˆ—å»ºç«‹çš„äºŒçº§ç´¢å¼•å¯¹åº”çš„B+æ ‘æ—¶ï¼šç”±äºé¡µ3ä¸­å­˜å‚¨çš„ç›®å½•é¡¹è®°å½•ç”±c2åˆ—+é¡µå·æ„æˆï¼Œé¡µ3ä¸­ä¸¤æ¡ç›®å½•é¡¹è®°å½•å¯¹åº”çš„c2åˆ—éƒ½æ˜¯1ï¼Œè€Œæ–°æ’å…¥çš„è¿™æ¡è®°å½•ä¸­ï¼Œc2åˆ—ä¹Ÿæ˜¯1ï¼Œé‚£ä¹ˆè¿™æ¡æ–°æ’å…¥çš„è®°å½•åº”è¯¥æ”¾åœ¨é¡µ4è¿˜æ˜¯é¡µ5ï¼Ÿ\nä¸ºäº†ä¿è¯B+æ ‘åŒä¸€å±‚å†…èŠ‚ç‚¹çš„ç›®å½•é¡¹è®°å½•é™¤äº†é¡µå·è¿™ä¸ªå­—æ®µä»¥å¤–æ˜¯å”¯ä¸€ï¼Œæ‰€ä»¥äºŒçº§ç´¢å¼•çš„å†…èŠ‚ç‚¹çš„ç›®å½•é¡¹è®°å½•å†…å®¹å®é™…ä¸Šç”±3éƒ¨åˆ†æ„æˆï¼š ç´¢å¼•åˆ—çš„å€¼ï¼Œä¸»é”®å€¼ï¼Œé¡µå· ï¼Œå¦‚ä¸Šå›¾6-17\næ’å…¥è®°å½•ï¼ˆ9ï¼Œ1ï¼Œâ€™c\u0026rsquo;ï¼‰æ—¶ï¼Œç”±äºé¡µ3 ä¸­å­˜å‚¨çš„ç›®å½•é¡¹è®°å½•æ˜¯ç”±c2 åˆ—+ ä¸»é”®+é¡µå·æ„æˆçš„ï¼Œ å› æ­¤å¯ä»¥å…ˆæŠŠæ–°è®°å½•çš„c2 åˆ—çš„å€¼å’Œé¡µ3 ä¸­å„ç›®å½•é¡¹è®°å½•çš„c2 åˆ—çš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œ å¦‚æœc2 åˆ—çš„å€¼ç›¸åŒï¼Œå¯ä»¥æ¥ç€æ¯”è¾ƒä¸»é”®å€¼ã€‚å› ä¸ºB+ æ ‘åŒä¸€å±‚ä¸­ä¸åŒç›®å½•é¡¹è®°å½•çš„c2 åˆ—+ä¸»é”®çš„å€¼è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥æœ€åè‚¯å®šèƒ½å®šä½åˆ°å”¯ä¸€çš„ä¸€æ¡ç›®å½•é¡¹è®°å½•ã€‚ åœ¨æœ¬ä¾‹ä¸­ï¼Œ æœ€åç¡®å®šæ–°è®°å½•åº”è¯¥æ’å…¥åˆ°é¡µ5 ä¸­\nå¯¹äºäºŒçº§ç´¢å¼•ï¼Œå…ˆæŒ‰ç…§äºŒçº§ç´¢å¼•åˆ—çš„å€¼è¿›è¡Œæ’åºï¼Œå¦‚æœç›¸åŒï¼Œå†æŒ‰ç…§ä¸»é”®å€¼è¿›è¡Œæ’åºã€‚æ‰€ä»¥ï¼Œä¸ºc2åˆ—å»ºç«‹ç´¢å¼•ï¼Œç›¸å½“äºä¸ºï¼ˆc2ï¼Œc1ï¼‰åˆ—å»ºç«‹äº†ä¸€ä¸ªè”åˆç´¢å¼•ã€‚å¦å¤–ï¼Œå¯¹äºå”¯ä¸€äºŒçº§ç´¢å¼•æ¥è¯´ï¼ˆå½“æˆ‘ä»¬ä¸ºæŸä¸ªåˆ—æˆ–åˆ—ç»„åˆå£°æ˜UNIQUEå±æ€§æ—¶ï¼Œä¾¿ä¼šä¸ºè¿™ä¸ªåˆ—æˆ–ç»„åˆå»ºç«‹å”¯ä¸€ç´¢å¼•ï¼‰ï¼Œä¹Ÿå¯èƒ½å‡ºç°å¤šæ¡è®°å½•é”®å€¼ç›¸åŒçš„æƒ…å†µï¼ˆ1. å£°æ˜ä¸ºUNIQUEçš„åˆ—å¯èƒ½å­˜å‚¨å¤šä¸ªNULL 2. åé¢è¦è®²çš„MVCCæœåŠ¡ï¼‰ï¼Œå”¯ä¸€äºŒçº§ç´¢å¼•çš„å†…èŠ‚ç‚¹çš„ç›®å½•é¡¹è®°å½•ä¹Ÿä¼šåŒ…å«è®°å½•çš„ä¸»é”®å€¼\næ³¨æ„ï¼Œä¹¦ä¸Šæ²¡æœ‰è®²åˆ°åˆ é™¤çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯å‡è®¾æœ‰ä¸€ç§æƒ…å½¢ï¼šç´¢å¼•å€¼1çš„è¡Œè¢«åˆ äº†ï¼Œåé¢åˆé‡æ–°æ·»åŠ äº†ã€‚æˆ‘çš„ç†è§£æ˜¯ä¸ä¼šå‡ºç°ä¸¤æ¡ç´¢å¼•å€¼ä¸€æ ·çš„è®°å½•åœ¨æ ‘ä¸Šï¼ˆæ ¹æ®å‰é¢è®°å½•è¡Œçš„delete_flagï¼Œæœ‰å¯èƒ½é‡å¤ï¼Œä½†æ˜¯æˆ‘çŒœä¼šè¦†ç›–æ‰ï¼Œæ‰€ä»¥è¿™é‡Œæ²¡è®²åˆ°é‚£ä¸ªæƒ…å†µï¼Œæš‚æ—¶æ²¡æ‰¾åˆ°èµ„æ–™è¯æ˜ï¼‰\nä¸€ä¸ªé¡µé¢è‡³å°‘å®¹çº³2æ¡è®°å½• # å¦‚æœä¸€ä¸ªå¤§çš„ç›®å½•ä¸­åªå­˜æ”¾ä¸€ä¸ªå­ç›®å½•ï¼Œé‚£ä¹ˆç›®å½•å±‚çº§ä¼šéå¸¸å¤šï¼Œè€Œä¸”æœ€åé‚£ä¸ªå­˜æ”¾çœŸæ­£æ•°æ®çš„ç›®å½•ä¸­åªèƒ½å­˜æ”¾ä¸€æ¡è®°å½•\nå¦‚æœè®©B+æ ‘çš„å¶å­èŠ‚ç‚¹åªå­˜å‚¨ä¸€æ¡è®°å½•ï¼Œè®©å†…èŠ‚ç‚¹å­˜å‚¨å¤šæ¡è®°å½•ï¼Œä¹Ÿè¿˜æ˜¯å¯ä»¥å‘æŒ¥B+æ ‘ä½œç”¨çš„ã€‚ä¸ºäº†é¿å…B+æ ‘çš„å±‚çº§å¢é•¿è¿‡é«˜ï¼Œè¦æ±‚æ‰€æœ‰æ•°æ®é¡µéƒ½è‡³å°‘å¯ä»¥å®¹çº³2æ¡è®°å½•ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œä¼šæåŠ›é¿å…å› ä¸ºåˆ—å€¼è¿‡å¤§ã€æˆ–è€…è¿‡å¤šå¯¼è‡´å®¹çº³ä¸äº†2æ¡è®°å½•ï¼‰\nInnoDBå¯¹åˆ—çš„æ•°é‡æœ‰æ‰€é™åˆ¶ï¼Œè€Œå¦‚æœåœ¨æœ€å¤§é™åˆ¶ä¸‹ï¼Œç»“åˆ04ç« çš„ç»“è®ºï¼š\nå¦‚æœä¸€æ¡è®°å½•çš„æŸä¸ªåˆ—ä¸­å­˜å‚¨çš„æ•°æ®å ç”¨å­—èŠ‚æ•°éå¸¸å¤šï¼Œå¯¼è‡´ä¸€ä¸ªé¡µæ²¡æœ‰åŠæ³•å­˜å‚¨ä¸¤æ¡è®°å½•ï¼Œè¯¥åˆ—å°±å¯èƒ½ä¼šæˆä¸ºæº¢å‡ºåˆ—\nMyISAMä¸­çš„ç´¢å¼•æ–¹æ¡ˆç®€ä»‹ # ä¸ºäº†å†…å®¹å®Œæ•´æ€§ï¼Œä»‹ç»ä¸€ä¸‹MyISAMå­˜å‚¨å¼•æ“ä¸­çš„ç´¢å¼•æ–¹æ¡ˆ\nInnoDBä¸­ï¼Œç´¢å¼•å³æ•°æ®ï¼Œä¹Ÿå°±æ˜¯èšç°‡ç´¢å¼•çš„é‚£é¢—B+æ ‘çš„å¶å­èŠ‚ç‚¹ä¸­åŒ…å«äº†å®Œæ•´çš„ç”¨æˆ·è®°å½•ã€‚MyISAMè™½ç„¶ä¹Ÿæ˜¯æ ‘å½¢ï¼Œä½†æ˜¯ç´¢å¼•å’Œæ•°æ®æ˜¯åˆ†å¼€çš„\næ•°æ®æ–‡ä»¶ # è¡¨ä¸­çš„è®°å½•æŒ‰ç…§è®°å½•çš„æ’å…¥é¡ºåºå•ç‹¬å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ˆç§°ä¹‹ä¸ºæ•°æ®æ–‡ä»¶ï¼‰\nè¯¥æ–‡ä»¶ä¸åˆ’åˆ†è‹¥å¹²ä¸ªæ•°æ®é¡µï¼Œæœ‰å¤šå°‘è®°å½•å°±å¾€æ–‡ä»¶ä¸­å¡å¤šå°‘ã€‚é€šè¿‡è¡Œå·å¿«é€Ÿè®¿é—®åˆ°ä¸€æ¡è®°å½•\nMyISAMè®°å½•éœ€è¦è®°å½•å¤´ä¿¡æ¯æ¥å­˜å‚¨é¢å¤–æ•°æ®ï¼Œä»¥index_demoè¡¨ä¸ºä¾‹ï¼Œçœ‹ä¸€ä¸‹è¿™ä¸ªè¡¨åœ¨ä½¿ç”¨MyISAMä½œä¸ºå­˜å‚¨å¼•æ“æ—¶ï¼Œå®ƒçš„è®°å½•å¦‚ä½•åœ¨å­˜å‚¨ç©ºé—´è¡¨ç¤º\nç”±äºæ˜¯æŒ‰æ’å…¥é¡ºåºï¼Œæ²¡æœ‰æŒ‰ä¸»é”®å¤§å°æ’åºï¼Œæ‰€ä»¥ä¸èƒ½åœ¨è¿™äº›æ•°æ®ä¸Šä½¿ç”¨äºŒåˆ†æ³•\nç´¢å¼• # MyISAMå­˜å‚¨å¼•æ“ä¼šæŠŠç´¢å¼•ä¿¡æ¯å•ç‹¬å­˜å‚¨åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ˆå³ç´¢å¼•æ–‡ä»¶ï¼‰\nMyISAMä¼šä¸ºè¡¨çš„ä¸»é”®å•ç‹¬åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œåªä¸è¿‡åœ¨ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­å­˜å‚¨çš„ä¸æ˜¯å®Œæ•´ç”¨æˆ·è®°å½•ï¼Œè€Œæ˜¯ä¸»é”®å€¼ä¸è¡Œå·çš„ç»“åˆã€‚å³å…ˆé€šè¿‡ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„è¡Œå·ï¼Œå†é€šè¿‡è¡Œå·å»æ‰¾å¯¹åº”çš„è®°å½•\nä¸InnoDBä¸åŒï¼ŒInnoDBå­˜å‚¨éšæƒ…ä¸­ï¼Œåªéœ€æ ¹æ®ä¸»é”®å€¼å¯¹èšç°‡ç´¢å¼•è¿›è¡Œä¾æ¬¡æŸ¥æ‰¾å°±èƒ½æ‰¾åˆ°å¯¹åº”è®°å½•ï¼Œè€ŒMyISAMä¸­å´éœ€è¦è¿›è¡Œä¸€æ¬¡å›è¡¨æ“ä½œã€‚æ„å‘³ç€MyISAMä¸­å»ºç«‹çš„ç´¢å¼•ç›¸å½“äºéƒ½æ˜¯äºŒçº§ç´¢å¼•\nå…¶ä»–ç´¢å¼• # å¯ä»¥ä¸ºå…¶ä»–åˆ—åˆ†åˆ«å»ºç«‹ç´¢å¼•æˆ–è€…å»ºç«‹è”åˆç´¢å¼•ï¼ŒåŸç†ä¸InnoDBå·®ä¸å¤šï¼Œåªä¸è¿‡å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ç›¸åº”çš„åˆ—+è¡Œå·ï¼ˆInnoDBä¸­å­˜å‚¨çš„åˆ™æ˜¯ä¸»é”®ï¼‰ã€‚è¿™äº›ç´¢å¼•ä¹Ÿéƒ½æ˜¯äºŒçº§ç´¢å¼•ã€‚\nMyISAMè¡Œæ ¼å¼æœ‰å®šé•¿è®°å½•æ ¼å¼Staticã€å˜é•¿è®°å½•æ ¼å¼Dynamicã€å‹ç¼©è®°å½•æ ¼å¼ Compressedã€‚å›¾6-18å°±æ˜¯å®šé•¿è®°å½•æ ¼å¼ï¼Œå³ä¸€æ¡è®°å½•å ç”¨çš„å­˜å‚¨ç©ºé—´æ˜¯å›ºå®šçš„ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨è¡Œå·è½»æ¾ç®—å‡ºæŸæ¡è®°å½•åœ¨æ•°æ®æ–‡ä»¶ä¸­çš„åœ°å€åç§»é‡ï¼Œä½†æ˜¯å˜é•¿è®°å½•æ ¼å¼å°±ä¸è¡Œä¹ï¼ŒMyISAMä¼šç›´æ¥åœ¨ç´¢å¼•å¶å­èŠ‚ç‚¹å¤„å­˜å‚¨è¯¥è®°å½•åœ¨æ•°æ®æ–‡ä»¶ä¸­çš„åç§»é‡ã€‚==\u0026gt; MyISAMå›è¡¨å¿«é€Ÿï¼Œå› ä¸ºæ˜¯æ‹¿ç€åœ°å€åç§»é‡ç›´æ¥åˆ°æ–‡ä»¶ä¸­å–æ•°æ®ã€‚è€ŒInnoDBåˆ™æ˜¯è·å–ä¸»é”®åï¼Œå†å»ä»èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾ã€‚\næ€»ç»“ # InnoDBï¼šç´¢å¼•å³æ•°æ®\nMyISAMï¼šç´¢å¼•æ˜¯ç´¢å¼•ï¼Œæ•°æ®æ˜¯æ•°æ®\nMySQLä¸­åˆ›å»ºå’Œåˆ é™¤ç´¢å¼•çš„è¯­å¥ # InnoDBä¼šè‡ªåŠ¨ä¸ºä¸»é”®æˆ–è€…**å¸¦æœ‰UNIQUE **å±æ€§çš„åˆ—å»ºç«‹ç´¢å¼•\nInnoDBä¸ä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªåˆ—åˆ›å»ºç´¢å¼•ï¼Œå› ä¸ºæ¯å»ºç«‹ä¸€ä¸ªç´¢å¼•éƒ½ä¼šå»ºç«‹ä¸€é¢—B+æ ‘ï¼Œä¸”å¢åˆ æ”¹éƒ½è¦ç»´æŠ¤å„ä¸ªè®°å½•ã€æ•°æ®é¡µçš„æ’åºå…³ç³»ï¼Œè´¹æ€§èƒ½å’Œå­˜å‚¨ç©ºé—´\n#è¯­æ³• CREATE TABLE è¡¨å( å„ä¸ªåˆ—çš„ä¿¡æ¯..., (KEY|INDEX) ç´¢å¼•å (éœ€è¦è¢«ç´¢å¼•çš„å•ä¸ªåˆ—æˆ–å¤šä¸ªåˆ—); ) #ä¿®æ”¹è¡¨ç»“æ„ ALTER TABLE è¡¨å ADD (INDEX|KEY) ç´¢å¼•å (éœ€è¦è¢«ç´¢å¼•çš„å•ä¸ªåˆ—æˆ–å¤šä¸ªåˆ—); #ä¿®æ”¹è¡¨ç»“æ„çš„æ—¶å€™åˆ é™¤ç´¢å¼• ALTER TABLE è¡¨å DROP (INDEX|KEY) ç´¢å¼•å; å®ä¾‹ï¼š\nmysql\u0026gt; CREATE TABLE index_demo( c1 INT, c2 INT, c3 CHAR(1), PRIMARY KEY (c1), INDEX idx_c2_c3 (c2,c3) ); #æŸ¥çœ‹å»ºè¡¨è¯­å¥ mysql\u0026gt; SHOW CREATE TABLE index_demo; +------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ | Table | Create Table | +------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ | index_demo | CREATE TABLE `index_demo` ( `c1` int(11) NOT NULL, `c2` int(11) DEFAULT NULL, `c3` char(1) DEFAULT NULL, PRIMARY KEY (`c1`), KEY `idx_c2_c3` (`c2`,`c3`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 | +------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ 1 row in set (0.00 sec) "},{"id":38,"href":"/zh/docs/study/MySQL/how_mysql_run/05/","title":"05InnoDBæ•°æ®é¡µç»“æ„","section":"_MySQLæ˜¯æ€æ ·è¿è¡Œçš„_","content":" å­¦ä¹ ã€ŠMySQLæ˜¯æ€æ ·è¿è¡Œçš„ã€‹ï¼Œæ„Ÿè°¢ä½œè€…ï¼\nä¸åŒç±»å‹çš„é¡µç®€ä»‹ # é¡µæ˜¯InnoDBç®¡ç†å­˜å‚¨ç©ºé—´çš„åŸºæœ¬å•ä½ï¼Œ1ä¸ªé¡µçš„å¤§å°ä¸€èˆ¬æ˜¯16KB\nInnoDBä¸ºäº†ä¸åŒç›®çš„è®¾è®¡å¤šç§ä¸åŒç±»å‹çš„é¡µï¼ŒåŒ…æ‹¬å­˜æ”¾è¡¨ç©ºé—´å¤´éƒ¨ä¿¡æ¯ çš„é¡µã€å­˜æ”¾Change Buffer ä¿¡æ¯çš„é¡µã€å­˜æ”¾INODEä¿¡æ¯çš„é¡µã€å­˜æ”¾undo æ—¥å¿—ä¿¡æ¯çš„é¡µ\nè¿™é‡Œè¯´çš„æ˜¯å­˜æ”¾è¡¨ä¸­è®°å½•çš„é‚£ç§ç±»å‹çš„é¡µï¼Œè¿™ç§å­˜æ”¾è®°å½•çš„é¡µç§°ä¸ºç´¢å¼•é¡µï¼ˆINDEXé¡µï¼‰\næš‚æ—¶ç§°ä¹‹ä¸ºæ•°æ®é¡µ\næ•°æ®é¡µç»“æ„å¿«è§ˆ # 1ä¸ªé¡µæœ‰16KBï¼Œè¿™éƒ¨åˆ†å­˜å‚¨ç©ºé—´è¢«åˆ’åˆ†ä¸ºäº†å¤šä¸ªéƒ¨åˆ†ï¼ˆ7éƒ¨åˆ†ï¼‰ï¼Œä¸åŒéƒ¨åˆ†æœ‰ä¸åŒçš„åŠŸèƒ½\nåç§° ä¸­æ–‡å å ç”¨ç©ºé—´ å¤§å° File Header æ–‡ä»¶å¤´éƒ¨ 38 å­—èŠ‚ é¡µçš„ä¸€äº›é€šç”¨ä¿¡æ¯ Page Header é¡µé¢å¤´éƒ¨ 56 å­—èŠ‚ æ•°æ®é¡µä¸“æœ‰çš„ä¸€äº›ä¿¡æ¯ Infimum + Supremum é¡µé¢ä¸­çš„æœ€å°è®°å½•å’Œæœ€å¤§è®°å½• 26 å­—èŠ‚ ä¸¤ä¸ªè™šæ‹Ÿçš„è®°å½• User Records ç”¨æˆ·è®°å½• ä¸ç¡®å®š ç”¨æˆ·å­˜å‚¨çš„è®°å½•å†…å®¹ Free Space ç©ºé—²ç©ºé—´ ä¸ç¡®å®š é¡µä¸­å°šæœªä½¿ç”¨çš„ç©ºé—´ Page Directory é¡µç›®å½• ä¸ç¡®å®š æŸäº›è®°å½•çš„ç›¸å¯¹ä½ç½® File Trailer æ–‡ä»¶å°¾éƒ¨ 8 å­—èŠ‚ æ ¡éªŒé¡µæ˜¯å¦å®Œæ•´ è®°å½•åœ¨é¡µä¸­çš„å­˜å‚¨ # æ¯æ’å…¥ä¸€æ¡è®°å½•ï¼Œä»Free Spaceç”³è¯·ä¸€ä¸ªè®°å½•å¤§å°çš„ç©ºé—´ï¼Œå¹¶å°†è¿™ä¸ªç©ºé—´åˆ’åˆ†åˆ°UserRecordséƒ¨åˆ†ã€‚å½“FreeSpaceéƒ¨åˆ†çš„ç©ºé—´å…¨éƒ¨è¢«UserRecordséƒ¨åˆ†æ›¿ä»£æ‰åï¼Œæ„å‘³ç€è¯¥é¡µç”¨å®Œã€‚å¦‚æœå†æ’å…¥ï¼Œå°±éœ€è¦ç”³è¯·æ–°çš„é¡µ\nè®°å½•å¤´ä¿¡æ¯çš„ç§˜å¯† # mysql\u0026gt; CREATE TABLE page_demo( c1 INT, c2 INT, c3 VARCHAR(10000), PRIMARY KEY(c1) ) CHARSET=ascii ROW_FORMAT=COMPACT; Query OK, 0 rows affected (0.03 sec) åç§° å¤§å°ï¼ˆæ¯”ç‰¹ï¼‰ æè¿° é¢„ç•™ä½1 1 æ²¡æœ‰ä½¿ç”¨ é¢„ç•™ä½2 1 æ²¡æœ‰ä½¿ç”¨ deleted_flag 1 æ ‡å¿—è¯¥è®°å½•æ˜¯å¦è¢«åˆ é™¤ min_rec_flag 1 B+ æ ‘ä¸­æ¯å±‚éå¶å­èŠ‚ç‚¹ä¸­çš„æœ€å°çš„ç›®å½•é¡¹è®°å½•éƒ½ä¼šæ·»åŠ è¯¥æ ‡è®° n_owned 4 ä¸€ä¸ªé¡µé¢ä¸­çš„è®°å½•ä¼šè¢«åˆ†æˆè‹¥å¹²ä¸ªç»„ï¼Œæ¯ä¸ªç»„ä¸­æœ‰ä¸€ä¸ªè®°å½•æ˜¯\u0026quot;å¸¦å¤´å¤§å“¥â€œï¼Œå…¶ä½™çš„è®°å½•éƒ½æ˜¯\u0026quot;å°å¼Ÿ\u0026quot;ã€‚å¸¦å¤´å¤§å“¥\u0026quot;è®°å½•çš„n_ownedå€¼ä»£è¡¨è¯¥ç»„ä¸­æ‰€æœ‰çš„è®°å½•æ¡æ•°ï¼Œ\u0026ldquo;å°å¼Ÿ\u0026quot;è®°å½•çš„n_ownedå€¼éƒ½ä¸º0 heap_no 13 è¡¨ç¤ºå½“å‰è®°å½•åœ¨é¡µé¢å †ä¸­çš„ç›¸å¯¹ä½ç½® record_type 3 è¡¨ç¤ºå½“å‰è®°å½•çš„ç±»å‹ï¼Œ0è¡¨ç¤ºæ™®é€šè®°å½•. 1 è¡¨ç¤ºB+ æ ‘éå¶èŠ‚ç‚¹çš„ç›®å½•é¡¹è®°å½•. 2 è¡¨ç¤ºInfimum è®°å½•. 3 è¡¨ç¤ºSupremum è®°å½• next_record 16 è¡¨ç¤ºä¸‹ä¸€æ¡è®°å½•çš„ç›¸å¯¹ä½ç½® ç®€åŒ–ä¸€ä¸‹ï¼ˆå¿½ç•¥å…¶ä»–éè®²è§£çš„éƒ¨åˆ†ä¿¡æ¯ï¼‰\n#æ’å…¥4æ¡è®°å½• mysql\u0026gt; INSERT INTO page_demo VALUES(1,100,\u0026#39;aaaa\u0026#39;),(2,200,\u0026#39;bbbb\u0026#39;),(3,300,\u0026#39;cccc\u0026#39;),(4,400,\u0026#39;dddd\u0026#39;); Query OK, 4 rows affected (0.01 sec) Records: 4 Duplicates: 0 Warnings: 0 UserRecordséƒ¨åˆ†çš„å­˜å‚¨ç»“æ„\ndeleted_flag # æ ‡è®°å½“å‰è®°å½•æ˜¯å¦åˆ é™¤ï¼š0è¡¨ç¤ºæ²¡æœ‰è¢«åˆ é™¤ï¼Œ1è¡¨ç¤ºè®°å½•è¢«åˆ é™¤\nè¢«åˆ é™¤çš„è®°å½•ä¸ä»ç£ç›˜æº¢å‡ºï¼Œå› ä¸ºç§»é™¤åè¿˜éœ€è¦åœ¨ç£ç›˜ä¸Šé‡æ–°æ’åˆ—å…¶ä»–çš„è®°å½•ï¼Œå¸¦æ¥æ€§èƒ½æ¶ˆè€—\nè¢«åˆ é™¤æ‰çš„è®°å½•ä¼šç»„æˆä¸€ä¸ªåƒåœ¾é“¾è¡¨ï¼Œè®°å½•åœ¨è¿™ä¸ªé“¾è¡¨ä¸­å ç”¨çš„ç©ºé—´ç§°ä¸ºå¯é‡ç”¨ç©ºé—´ï¼Œå¦‚æœä¹‹åæœ‰æ–°çºªå½•æ’å…¥åˆ°è¡¨ä¸­ï¼Œå°±å¯èƒ½è¦†ç›–æ‰è¢«åˆ é™¤çš„è®°å½•æ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´\ndelete_flagè®¾ç½®ä¸º1å’Œå°†è¢«åˆ é™¤çš„è®°å½•åŠ å…¥åˆ°åƒåœ¾é“¾è¡¨å…¶å®æ˜¯ä¸¤ä¸ªé˜¶æ®µï¼Œåé¢ä»‹ç»undoæ—¥å¿—ä¼šè¯¦ç»†è®²è§£åˆ é™¤æ“ä½œçš„è¯¦ç»†æ‰§è¡Œè¿‡ç¨‹\nmin_rec_flag # B+æ ‘æ¯å±‚éå¶å­èŠ‚ç‚¹ä¸­çš„æœ€å°çš„ç›®å½•é¡¹è®°å½•éƒ½ä¼šæ·»åŠ è¯¥æ ‡è®°\nn_onwed # heap_no # è®°å½•ä¸€æ¡ä¸€æ¡äº²å¯†æ— é—´æ’åˆ—çš„ç»“æ„ç§°ä¹‹ä¸ºå †ï¼ˆheapï¼‰ã€‚æŠŠä¸€æ¡è®°å½•åœ¨å †ä¸­çš„ç›¸å¯¹ä½ç½®ç§°ä¹‹ä¸ºheap_no\nä¸ºäº†ç®¡ç†è¿™ä¸ªå †ï¼Œæ¯ä¸€æ¡è®°å½•åœ¨å †ä¸­çš„ç›¸å¯¹ä½ç½®ç§°ä¸ºheap_noã€‚\né¡µé¢å‰é¢çš„è®°å½•heap_noæ¯”åé¢çš„å°ï¼Œä¸”æ¯æ–°ç”³è¯·ä¸€æ¡è®°å½•çš„å­˜å‚¨ç©ºé—´ï¼Œè¯¥æ¡è®°å½•æ¯”ç‰©ç†ä½ç½®åœ¨å®ƒå‰é¢çš„é‚£æ¡è®°å½•çš„heap_noå¤§1\nç”±ä¸Šå¯çŸ¥ï¼Œ4æ¡è®°å½•çš„heap_noä¸º2ï¼Œ3ï¼Œ4ï¼Œ5\nInnoDBçš„è®¾è®¡è€…è‡ªåŠ¨ç»™æ¯ä¸ªé¡µæ·»åŠ äº†ä¸¤æ¡è®°å½•ï¼ˆç§°ä¹‹ä¼ªè®°å½•æˆ–è™šæ‹Ÿè®°å½•ï¼‰ã€‚ä¸€æ¡ä»£è¡¨é¡µé¢ä¸­çš„æœ€å°è®°å½•ï¼ˆä¹Ÿç§°Infimumè®°å½•ç¾ [Éªn'faÉªmÉ™m]ï¼‰ï¼Œä¸€æ¡ä»£è¡¨é¡µé¢ä¸­çš„æœ€å¤§è®°å½•ï¼ˆä¹Ÿç§°Supremumsu'pri: m en)ã€‚è¿™ä¸¤æ¡ä¼ªè®°å½•ä¹Ÿç®—ä½œå †çš„ä¸€éƒ¨åˆ†\næ¯”è¾ƒå®Œæ•´è®°å½•çš„å¤§å°å°±æ˜¯æ¯”è¾ƒä¸»é”®çš„å¤§å°\nè§„å®šï¼Œç”¨æˆ·çš„ä»»ä½•è®°å½•éƒ½æ¯”Infimumè®°å½•å¤§ï¼Œæ¯”supremumè®°å½•å°\nInfimumå’ŒSupremumè®°å½• # å•ç‹¬æ”¾åœ¨ä¸€ä¸ªç§°ä¸ºInfimumå’ŒSupremumçš„éƒ¨åˆ†\nå †ä¸­è®°å½•çš„heap_noå€¼åœ¨åˆ†é…ä¹‹åå°±ä¸ä¼šå‘ç”Ÿæ”¹åŠ¨äº†ï¼ˆå³ä½¿åˆ é™¤äº†å †ä¸­æŸæ¡è®°å½•ï¼‰\nrecord_type # è¡¨ç¤ºå½“å‰è®°å½•çš„ç±»å‹ï¼Œ0è¡¨ç¤ºæ™®é€šè®°å½•ï¼ˆä¸Šé¢è‡ªå·±æ’å…¥çš„è®°å½•æ˜¯ï¼‰ï¼Œ1è¡¨ç¤ºB+æ ‘éå¶èŠ‚ç‚¹çš„ç›®å½•é¡¹è®°å½•ï¼ˆåé¢ç´¢å¼•ä¼šè®²åˆ°ï¼‰ï¼Œ2è¡¨ç¤ºInfimumè®°å½•ï¼Œ3è¡¨ç¤ºSupremumè®°å½•\nnext_record # è¡¨ç¤ºä»å½“å‰è®°å½•çš„çœŸå®æ•°æ®åˆ°ä¸‹ä¸€æ¡è®°å½•çš„çœŸå®æ•°æ®çš„è·ç¦»\nå¦‚æœè¯¥å±æ€§å€¼ä¸ºæ­£æ•°ï¼Œ è¯´æ˜å½“å‰è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•åœ¨å½“å‰è®°å½•çš„åé¢: å¦‚æœè¯¥å±æ€§å€¼ä¸ºè´Ÿæ•°ï¼Œè¯´æ˜å½“å‰è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•åœ¨å½“å‰è®°å½•çš„å‰é¢\nä¸‹ä¸€æ¡è®°å½•ï¼ŒæŒ‡çš„æ˜¯æŒ‰ç…§ä¸»é”®å€¼ç”±å°åˆ°å¤§çš„é¡ºåºæ’åˆ—çš„ä¸‹ä¸€æ¡è®°å½•\nInfimumçš„ä¸‹ä¸€æ¡è®°å½•æ˜¯æœ¬é¡µä¸­ä¸»é”®å€¼æœ€å°çš„ç”¨æˆ·è®°å½•ï¼Œæœ¬é¡µä¸­ä¸»é”®å€¼æœ€å¤§çš„ç”¨æˆ·è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•å°±æ˜¯Supremumè®°å½•\nå¦‚ä¸Šï¼Œè®°å½•æŒ‰ç…§ä¸»é”®ä»å°åˆ°å¤§çš„é¡ºåºå½¢æˆäº†ä¸€ä¸ªå•å‘é“¾è¡¨\nSupremumè®°å½•çš„next_recordå€¼ä¸º0ï¼Œå³æ²¡æœ‰ä¸‹ä¸€æ¡è®°å½•äº†ï¼Œå¦‚æœåˆ é™¤å…¶ä¸­ä¸€æ¡è®°å½•\nSupremumè®°å½•çš„n_ownedç”±5å˜æˆäº†4\nInnoDBå§‹ç»ˆç»´æŠ¤è®°å½•çš„ä¸€ä¸ªå•å‘é“¾è¡¨ï¼Œé“¾è¡¨ä¸­çš„å„ä¸ªèŠ‚ç‚¹æ˜¯æŒ‰ç…§ä¸»é”®å€¼ç”±å°åˆ°å¤§çš„é¡ºåºé“¾æ¥èµ·æ¥çš„\nä¸ºå•¥next_recordæ˜¯æŒ‡å‘è®°å½•å¤´ä¿¡æ¯å’ŒçœŸå®æ•°æ®ä¹‹é—´çš„ä½ç½®ï¼Œè€Œä¸æ˜¯æ•´æ¡è®°å½•çš„å¼€å¤´ã€‚\nè¿™ä¸ªä½ç½®åˆšå¥½ï¼Œå‘å·¦æ˜¯è®°å½•å¤´ä¿¡æ¯ï¼Œå‘å³æ˜¯çœŸå®æ•°æ® ç”±äºå˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€NULLå€¼åˆ—è¡¨ä¸­çš„ä¿¡æ¯éƒ½æ˜¯é€†åºå­˜æ”¾ï¼Œè¿™æ ·å¯ä»¥ä½¿è®°å½•ä¸­é å‰çš„å­—æ®µå’Œä»–ä»¬å¯¹åº”çš„å­—æ®µé•¿åº¦ä¿¡æ¯åœ¨å†…å­˜ä¸­çš„è·ç¦»æ›´è¿‘ï¼Œæé«˜é«˜é€Ÿç¼“å­˜å‘½ä¸­ç‡ å¦‚æœç¬¬2æ¡è®°å½•è¢«é‡æ–°æ’å…¥\nPageDirectoryï¼ˆé¡µç›®å½•ï¼‰ # è§£é‡Š # ç›´æ¥éå†çš„è¯ï¼Œæ—¶é—´å¤æ‚åº¦å¤ªé«˜\nè¯´æ˜ï¼š å°†æ‰€æœ‰è®°å½•ï¼ˆåŒ…æ‹¬Infimumå’ŒSupremumè®°å½•ï¼Œä¸åŒ…æ‹¬å·²ç»ç§»é™¤åˆ°åƒåœ¾é“¾è¡¨çš„è®°å½•åˆ’åˆ†ä¸ºå‡ ä¸ªç»„\næ¯ä¸ªç»„çš„æœ€åä¸€æ¡è®°å½•ï¼ˆç»„å†…æœ€å¤§çš„é‚£æ¡è®°å½•ï¼‰ç›¸å½“äºå¸¦å¤´å¤§å“¥ï¼Œå…¶ä½™è®°å½•ç›¸å½“äºå°å¼Ÿã€‚\nå¸¦å¤´å¤§å“¥è®°å½•çš„å¤´ä¿¡æ¯ä¸­çš„n_ownedå±æ€§è¡¨ç¤ºæ”¹ç»„å†…å…±æœ‰å‡ æ¡è®°å½•\næ“ä½œï¼š\nå°†æ¯ä¸ªç»„ä¸­æœ€åä¸€æ¡è®°å½•ï¼ˆç»„å†…æœ€å¤§è®°å½•ï¼‰åœ¨é¡µé¢ä¸­çš„åœ°å€åç§»é‡(è¯¥è®°å½•çš„çœŸå®æ•°æ®ä¸é¡µé¢ä¸­ç¬¬0ä¸ªå­—èŠ‚ä¹‹é—´çš„è·ç¦»)å•ç‹¬æå–å‡ºæ¥ï¼ŒæŒ‰é¡ºåºå­˜å‚¨å€’é è¿‘é¡µå°¾éƒ¨çš„åœ°æ–¹ï¼ˆè¿™ä¸ªåœ°æ–¹å°±æ˜¯PageDirectoryï¼‰\né¡µç›®å½•çš„åç§»åœ°å€ç§°ä¸ºæ§½(Slot)ï¼Œæ¯ä¸ªæ§½å ç”¨2å­—èŠ‚ï¼Œé¡µç›®å½•ç”±å¤šä¸ªæ§½ç»„æˆ\n1é¡µæœ‰16KBï¼Œå³16384å­—èŠ‚ï¼Œè€Œ2å­—èŠ‚å¯ä»¥è¡¨ç¤ºçš„åœ°å€åç§»é‡ä¸º2^16-1=65535 \u0026gt;16384ï¼Œæ‰€ä»¥ç”¨2å­—èŠ‚è¡¨ç¤ºä¸€ä¸ªæ§½è¶³å¤Ÿäº†\nä¸¾ä¾‹ # å‡è®¾page_demoè¡¨ä¸­æœ‰6æ¡è®°å½•ï¼ˆåŒ…æ‹¬Infimumå’ŒSupremumï¼‰\næ³¨æ„ï¼ŒInfimumè®°å½•çš„n_ownedå€¼ä¸º1ï¼ŒSupremumè®°å½•çš„n_ownedå€¼ä¸º5\nä¸”æ§½å¯¹åº”çš„è®°å½•ï¼ˆå€¼ï¼‰è¶Šå°ï¼Œè¶Šé è¿‘FileTrailer\nç”¨æŒ‡é’ˆå½¢å¼è¡¨ç¤º\nåˆ’åˆ†ä¾æ®\nè§„å®šï¼šå¯¹äºInfimumè®°å½•æ‰€åœ¨çš„åˆ†ç»„åªèƒ½æœ‰1æ¡è®°å½•ï¼ŒSupremumè®°å½•æ‰€åœ¨åˆ†ç»„è®°å½•æ•°åœ¨18æ¡ä¹‹é—´ï¼Œå‰©ä¸‹çš„åˆ†ç»„ä¸­è®°å½•çš„æ¡æ•°èŒƒå›´åªèƒ½æ˜¯48æ¡ ç®€åŒ–ï¼š\næ­¥éª¤ï¼š\nåˆå§‹æƒ…å†µï¼Œæ•°æ®é¡µä¸­åªæœ‰Infimumå’ŒSupremumä¸¤æ¡è®°å½•ï¼Œåˆ†å±ä¸¤ä¸ªåˆ†ç»„\né¡µç›®å½•ä¹Ÿåªæœ‰ä¸¤ä¸ªæ§½ï¼šåˆ†åˆ«ä»£è¡¨Infimumè®°å½•å’ŒSupremumè®°å½•åœ¨é¡µä¸­çš„åç§»é‡\nä¹‹åæ¯æ’å…¥ä¸€æ¡è®°å½•ï¼Œéƒ½ä¼šä»é¡µç›®å½•ä¸­æ‰¾åˆ°å¯¹åº”è®°å½•çš„ä¸»é”®å€¼æ¯”å¾…æ’å…¥è®°å½•çš„ä¸»é”®å€¼å¤§å¹¶ä¸”å·®å€¼æœ€å°çš„æ§½ï¼ˆä»æœ¬è´¨ä¸Šçœ‹ï¼Œæ§½æ˜¯ä¸€ä¸ªç»„å†…æœ€å¤§é‚£æ¡è®°å½•åœ¨é¡µé¢ä¸­çš„åœ°å€åç§»é‡ï¼Œé€šè¿‡æ§½å¯ä»¥å¿«é€Ÿæ‰¾åˆ°å¯¹åº”çš„è®°å½•çš„ä¸»é”®å€¼)ã€‚ç„¶åæŠŠè¯¥æ§½å¯¹åº”çš„è®°å½•çš„n_ownedå€¼åŠ 1ï¼Œè¡¨ç¤ºæœ¬ç»„å†…åˆæ·»åŠ äº†ä¸€æ¡è®°å½•ï¼Œç›´åˆ°è¯¥ç»„ä¸­çš„è®°å½•æ•°ç­‰äº8\nå½“ä¸€ä¸ªç»„ä¸­çš„è®°å½•æ•°ç­‰äº8åï¼Œå†æ’å…¥ä¸€æ¡è®°å½•ï¼Œä¼šå°†ç»„ä¸­çš„è®°å½•æ‹†åˆ†æˆä¸¤ä¸ªç»„ï¼Œå…¶ä¸­ä¸€ä¸ªç»„ä¸­4æ¡è®°å½•ï¼Œå¦ä¸€ä¸ª5æ¡è®°å½•ã€‚ä¸”ä¼šåœ¨é¡µç›®å½•ä¸­æ–°å¢ä¸€ä¸ªæ§½ï¼Œè®°å½•è¿™ä¸ªæ–°å¢åˆ†ç»„ä¸­æœ€å¤§çš„é‚£æ¡è®°å½•çš„åç§»é‡\nä¸ºäº†æ¼”ç¤ºå¿«é€ŸæŸ¥æ‰¾ï¼Œå†æ·»åŠ 12æ¡è®°å½• ï¼Œæ€»å…±16æ¡\nä¸€ä¸ªæ§½å ç”¨2ä¸ªå­—èŠ‚ï¼Œä¸”æ§½ä¹‹é—´æ˜¯æŒ¨ç€çš„ï¼Œæ¯ä¸ªæ§½ä»£è¡¨çš„ä¸»é”®å€¼éƒ½æ˜¯ä»å°åˆ°å¤§æ’åºçš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨äºŒåˆ†æ³•å¿«é€ŸæŸ¥æ‰¾\nè¿™é‡Œç»™æ§½ç¼–å·ï¼š0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ã€‚æœ€ä½çš„æ§½å°±æ˜¯low=0ï¼Œæœ€é«˜çš„æ§½å°±æ˜¯high=4\nå‡è®¾æˆ‘ä»¬è¦æŸ¥æ‰¾ä¸»é”®å€¼ä¸º6çš„è®°å½•\n(0+4)/2=2ï¼Œæ§½2ä»£è¡¨çš„ä¸»é”®å€¼8\u0026gt;6ï¼Œæ‰€ä»¥high=2,lowä¸å˜=0 (0+2)/2=1ï¼Œæ§½1ä»£è¡¨çš„ä¸»é”®å€¼4\u0026lt;6ï¼Œæ‰€ä»¥low=1,highä¸å˜=2 high-low=1ï¼Œåˆå› ä¸ºæ§½è®°å½•çš„æ˜¯æœ€å¤§å€¼ï¼Œæ‰€ä»¥ä¸åœ¨æ§½1ä¸­ï¼Œè€Œæ˜¯åœ¨æ§½2ä¸­\næ²¿ç€å•é¡¹åˆ—è¡¨éå†æ§½2ä¸­çš„è®°å½•ï¼šå¦‚ä½•éå†ï¼Œå…ˆæ‰¾åˆ°æ§½1çš„åœ°å€ï¼Œç„¶åå®ƒçš„ä¸‹ä¸€æ¡è®°å½•å°±æ˜¯æ§½2ä¸­çš„æœ€å°è®°å½• å€¼ä¸º5ï¼Œä»å€¼5çš„è®°å½•å‡ºå‘éå†å³å¯ï¼ˆç”±äºä¸€ä¸ªç»„ä¸­åŒ…å«çš„è®°å½•æ¡æ•°æœ€å¤šæ˜¯8ï¼Œæ‰€ä»¥ä»£ä»·æå° æ€»ç»“\né€šè¿‡äºŒåˆ†æ³•ç¡®å®šæ§½ï¼Œæ‰¾åˆ°æ§½æ‰€åœ¨åˆ†ç»„ä¸­ä¸»é”®å€¼æœ€å°çš„é‚£æ¡è®°å½•\nç„¶åé€šè¿‡è®°å½•çš„next_recordå±æ€§éå†è¯¥æ§½æ‰€åœ¨è®°å½•çš„å„ä¸ªè®°å½•\nPageHeaderï¼ˆé¡µé¢å¤´éƒ¨ï¼‰ # é¡µç»“æ„çš„ç¬¬2éƒ¨åˆ†ï¼Œå ç”¨å›ºå®šçš„56å­—èŠ‚ï¼Œä¸“é—¨å­˜å‚¨å„ç§çŠ¶æ€ä¿¡æ¯\nPageHeaderçš„ç»“æ„åŠæè¿°\nçŠ¶æ€åç§° å ç”¨ç©ºé—´å¤§å° æè¿° PAGE_N_DlR SLOTS 2å­—èŠ‚ åœ¨é¡µç›®å½•ä¸­çš„æ§½æ•°é‡ PAGE_HEAP_TOP 2å­—èŠ‚ è¿˜æœªä½¿ç”¨çš„ç©ºé—´æœ€å°åœ°å€ï¼Œ ä¹Ÿå°±æ˜¯è¯´ä»è¯¥åœ°å€ä¹‹åå°±æ˜¯FreeSpace PAGE_N_HEAP 2å­—èŠ‚ ç¬¬1ä½è¡¨ç¤ºæœ¬è®°å½•æ˜¯å¦ä¸ºç´§å‡‘å‹çš„è®°å½•ï¼Œ å‰©ä½™çš„15 ä½è¡¨ç¤ºæœ¬é¡µçš„å †ä¸­è®°å½•çš„æ•°é‡ï¼ˆåŒ…æ‹¬lnfimum å’ŒSupremum è®°å½•ä»¥åŠæ ‡è®°ä¸º\u0026quot;å·±åˆ é™¤\u0026quot;çš„è®°å½•ï¼‰ PAGE_FREE 2å­—èŠ‚ å„ä¸ªå·±åˆ é™¤çš„è®°å½•é€šè¿‡next_record ç»„æˆä¸€ä¸ªå•å‘é“¾è¡¨ï¼Œè¿™ä¸ªå•å‘é“¾è¡¨ä¸­çš„è®°å½•æ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´å¯ä»¥è¢«é‡æ–°åˆ©ç”¨ï¼›PAGE FREE è¡¨ç¤ºè¯¥é“¾è¡¨å¤´èŠ‚ç‚¹å¯¹åº”è®°å½•åœ¨é¡µé¢ä¸­çš„åç§»é‡ PAGE_GARBAGE 2å­—èŠ‚ å·±åˆ é™¤è®°å½•å ç”¨çš„å­—èŠ‚æ•° PAGE_LAST_INSERT 2å­—èŠ‚ æœ€åæ’å…¥è®°å½•çš„ä½ç½® PAGE_DIRECTION 2å­—èŠ‚ æœ€åä¸€æ¡è®°å½•æ’å…¥çš„æ–¹å‘ PAGE_N_DIRECTION 2å­—èŠ‚ ä¸€ä¸ªæ–¹å‘è¿ç»­æ’å…¥çš„è®°å½•æ•°é‡ PAGE_N_RECS 2å­—èŠ‚ è¯¥é¡µä¸­ç”¨æˆ·è®°å½•çš„æ•°é‡ã€ˆä¸åŒ…æ‹¬Infimum å’ŒSupremumè®°å½•ä»¥åŠè¢«åˆ é™¤çš„è®°å½•) PAGE_MAX_TRX_ID 8å­—èŠ‚ ä¿®æ”¹å½“å‰é¡µçš„æœ€å¤§äº‹åŠ¡id. è¯¥å€¼ä»…åœ¨äºŒçº§ç´¢å¼•é¡µé¢ä¸­å®šä¹‰ PAGE_LEVEL 2å­—èŠ‚ å½“å‰é¡µåœ¨B+ æ ‘ä¸­æ‰€å¤„çš„å±‚çº§ PAGE_INDEX_ID 8å­—èŠ‚ ç´¢å¼•IDï¼Œ è¡¨ç¤ºå½“å‰é¡µå±äºå“ªä¸ªç´¢å¼• PAGE_BTR_SEG_LEAF 10å­—èŠ‚ B+ æ ‘å¶å­èŠ‚ç‚¹æ®µçš„å¤´éƒ¨ä¿¡æ¯ï¼Œä»…åœ¨B+ æ ‘çš„æ ¹é¡µé¢ä¸­å®šä¹‰ PAGE_BTR_SEG_TOP 10å­—èŠ‚ B+ æ ‘éå¶å­èŠ‚ç‚¹æ®µçš„å¤´éƒ¨ä¿¡æ¯ï¼Œä»…åœ¨B+ æ ‘çš„æ ¹é¡µé¢ä¸­å®šä¹‰ PAGE_N_DlR SLOTS - PAGE_N_RECS çš„ä½œç”¨åº”è¯¥æ˜¯æ¸…é™¤çš„ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªè§£é‡Šä¸€ä¸‹ï¼š\nPAGE_DIRECTIONï¼šåŠ å…¥æ–°æ’å…¥çš„ä¸€æ¡è®°å½•çš„ä¸»é”®å€¼æ¯”ä¸Šä¸€æ¡è®°å½•çš„ä¸»é”®å€¼å¤§ï¼Œæˆ‘ä»¬è¯´è¿™æ¡è®°å½•çš„æ’å…¥æ–¹å‘æ˜¯å³è¾¹ï¼Œåä¹‹åˆ™æ˜¯å·¦è¾¹ã€‚ç”¨æ¥è¡¨ç¤ºæœ€åä¸€æ¡è®°å½•æ’å…¥æ–¹å‘çš„çŠ¶æ€å°±æ˜¯PAGE_DIRECTION\nPAGE_N_DIRECTIONï¼šå‡è®¾è¿ç»­æ’å…¥æ–°è®°å½•çš„æ–¹å‘éƒ½æ˜¯ä¸€è‡´ï¼ŒInnoDBä¼šæŠŠæ²¿ç€åŒä¸€ä¸ªæ–¹å‘æ’å…¥è®°å½•çš„æ¡æ•°è®°ä¸‹æ¥ï¼Œç”¨PAGE_N_DIRECTIONè¡¨ç¤ºã€‚å¦‚æœæœ€åä¸€æ¡è®°å½•çš„æ’å…¥æ–¹å‘å‘ç”Ÿäº†æ”¹å˜ï¼Œè¿™ä¸ªçŠ¶æ€çš„å€¼ä¼šè¢«æ¸…é›¶åé‡æ–°ç»Ÿè®¡\nå…¶ä»–çš„æš‚æ—¶ä¸è®¨è®º\nFileHeaderï¼ˆæ–‡ä»¶å¤´éƒ¨ï¼‰ # PageHeaderä¸“é—¨é’ˆå¯¹çš„æ˜¯æ•°æ®é¡µè®°å½•çš„å„ç§çŠ¶æ€ä¿¡æ¯ï¼Œæ¯”å¦‚é¡µæœ‰å¤šå°‘æ¡è®°å½•ï¼Œå¤šå°‘ä¸ªæ§½ã€‚\nFileHeaderé€šç”¨äºå„ç§ç±»å‹çš„é¡µï¼Œæè¿°äº†ä¸€äº›é€šç”¨äºå„ç§é¡µçš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¿™ä¸ªé¡µçš„ç¼–å·æ˜¯å¤šå°‘ï¼Œå®ƒçš„ä¸Šä¸€ä¸ªé¡µå’Œä¸‹ä¸€ä¸ªé¡µæ˜¯è°ï¼Œå›ºå®šå ç”¨38å­—èŠ‚\næ ¡éªŒå’Œï¼ˆchecksum)ï¼šå¯¹äºå¾ˆé•¿çš„å­—èŠ‚ä¸²ï¼Œé€šè¿‡æŸç§ç®—æ³•è®¡ç®—å‡ºæ¯”è¾ƒçŸ­çš„å€¼æ¥ä»£ç¼–è¿™ä¸ªå­—èŠ‚ä¸²ï¼Œæ¯”è¾ƒä¹‹å‰å…ˆæ¯”è¾ƒè¿™ä¸ªå­—èŠ‚ä¸²ã€‚çœå»äº†ç›´æ¥æ¯”è¾ƒè¿™ä¸¤ä¸ªé•¿å­—èŠ‚ä¸²çš„æ—¶é—´æŸè€—\nInnoDBé€šè¿‡é¡µå·æ¥å”¯ä¸€å®šä½ä¸€ä¸ªé¡µ\né¡µå·ï¼ˆç¬¬nä¸ªå·ï¼‰ï¼Œ4å­—èŠ‚ï¼Œ2^(4*8)=2^32æ¬¡æ–¹ä½ =4294967296 ä¸ªé¡µ\n4294967296 * (16KB/é¡µ) =64Tï¼Œè¿™ä¹Ÿæ˜¯InnoDB å•è¡¨é™åˆ¶çš„å¤§å°\né¡µæœ‰å¥½å‡ ç§ç±»å‹ï¼Œå‰é¢ä»‹ç»çš„æ˜¯å­˜å‚¨è®°å½•çš„æ•°æ®é¡µï¼Œè¿˜æœ‰å…¶ä»–ç±»å‹çš„é¡µ\nå­˜æ”¾è®°å½•çš„æ•°æ®é¡µçš„ç±»å‹å…¶å®æ˜¯FIL_PAGE_INDEXï¼Œä¹Ÿå°±æ˜¯ç´¢å¼•é¡µ\nå‰é¢è¯´è®°å½•çš„å­˜å‚¨ç»“æ„æ—¶ï¼Œæ‰€è¯´çš„æº¢å‡ºé¡µæ˜¯FIL_PAGE_TYPE_BLOB\nå¯¹äºFIL_PAGE_PREVå’ŒFIL_PAGE_NEXTï¼šå½“å ç”¨ç©ºé—´éå¸¸å¤§æ—¶ï¼Œæ— æ³•ä¸€æ¬¡æ€§ä¸ºè¿™ä¹ˆå¤šæ•°æ®åˆ†é…ä¸€ä¸ªéå¸¸å¤§çš„å­˜å‚¨ç©ºé—´ï¼Œå¦‚æœåˆ†æ•£åˆ°å¤šä¸ªä¸è¿ç»­çš„é¡µä¸­å­˜å‚¨ï¼Œåˆ™éœ€è¦æŠŠè¿™äº›é¡µå…³è”èµ·æ¥ã€‚FIL_PAGE_PREVå’ŒFIL_PAGE_NEXTå°±åˆ†åˆ«ä»£è¡¨æœ¬æ•°æ®é¡µçš„ä¸Šä¸€ä¸ªé¡µå’Œä¸‹ä¸€ä¸ªé¡µçš„é¡µå·ã€‚ä¸æ˜¯æ‰€æœ‰ç±»å‹çš„é¡µéƒ½æœ‰ä¸Šä¸€ä¸ªé¡µå’Œä¸‹ä¸€ä¸ªé¡µå±æ€§çš„ï¼Œä¸è¿‡æ•°æ®é¡µï¼ˆFIL_PAGE_INDEXçš„é¡µï¼‰æœ‰è¿™ä¸¤ä¸ªå±æ€§ï¼Œæ‰€ä»¥å­˜å‚¨è®°å½•çš„æ•°æ®é¡µå…¶å®å¯ä»¥ç»„æˆä¸€ä¸ªåŒå‘é“¾è¡¨\nFileTrailerï¼ˆæ–‡ä»¶å°¾éƒ¨ï¼‰ # InnoDBå­˜å‚¨å¼•æ“ä¼šæŠŠæ•°æ®å­˜å‚¨å€’ç£ç›˜ï¼Œä½†ç£ç›˜é€Ÿåº¦å¤ªæ…¢ï¼Œéœ€è¦ä»¥é¡µä¸ºå•ä½æŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­å¤„ç†\nå¦‚æœåœ¨è¯¥é¡µä¸­çš„æ•°æ®åœ¨å†…å­˜ä¸­ä¿®æ”¹äº†ï¼Œåœ¨ä¿®æ”¹åæŸä¸ªæ—¶é—´è¿˜éœ€è¦æŠŠæ•°æ®åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œä½†åœ¨åˆ·æ–°è¿˜æ²¡ç»“æŸçš„æ—¶å€™æ–­ç”µäº†æ€ä¹ˆåŠã€‚ä¸ºäº†æ£€æµ‹ä¸€ä¸ªé¡µæ˜¯å¦å®Œæ•´ï¼ˆåˆ¤æ–­åˆ·æ–°æ—¶æœ‰æ²¡æœ‰ä¹‹åˆ·æ–°äº†ä¸€éƒ¨åˆ†ï¼‰ï¼Œä¸ºæ¯ä¸ªé¡µå°¾éƒ¨æ·»åŠ ä¸€ä¸ªFileTrileréƒ¨åˆ†ï¼Œç”±8ä¸ªå­—èŠ‚ç»„æˆï¼Œåˆåˆ†ä¸¤å°éƒ¨åˆ†\nå‰4 å­—èŠ‚ä»£è¡¨é¡µçš„æ ¡éªŒå’Œã€‚è¿™ä¸ªéƒ¨åˆ†ä¸File Header ä¸­çš„æ ¡éªŒå’Œç›¸å¯¹åº”ã€‚æ¯å½“ä¸€ä¸ªé¡µé¢åœ¨å†…å­˜ä¸­å‘ç”Ÿä¿®æ”¹æ—¶ï¼Œåœ¨åˆ·æ–°ä¹‹å‰å°±è¦æŠŠé¡µé¢çš„æ ¡éªŒå’Œç®—å‡ºæ¥ã€‚å› ä¸ºFile Header åœ¨é¡µé¢çš„å‰è¾¹ï¼Œæ‰€ä»¥File Header ä¸­çš„æ ¡éªŒå’Œä¼šè¢«é¦–å…ˆåˆ·æ–°åˆ°ç£ç›˜ï¼Œå½“å®Œå…¨å†™å®Œåï¼Œæ ¡éªŒå’Œä¹Ÿä¼šè¢«å†™åˆ°é¡µçš„å°¾éƒ¨ã€‚å¦‚æœé¡µé¢åˆ·æ–°æˆåŠŸï¼Œåˆ™é¡µé¦–å’Œé¡µå°¾çš„æ ¡éªŒå’Œåº”è¯¥æ˜¯ä¸€è‡´çš„ã€‚å¦‚æœåˆ·æ–°äº†ä¸€éƒ¨åˆ†åæ–­ç”µäº†ï¼Œé‚£ä¹ˆFile Header ä¸­çš„æ ¡éªŒå’Œå°±ä»£è¡¨ç€å·±ç»ä¿®æ”¹è¿‡çš„é¡µï¼Œè€ŒFile Trailer ä¸­çš„æ ¡éªŒå’Œä»£è¡¨ç€åŸå…ˆçš„é¡µï¼ˆå› ä¸ºæ–­ç”µäº†ï¼Œæ‰€ä»¥æ²¡æœ‰å®Œå…¨å†™å®Œï¼‰ï¼ŒäºŒè€…ä¸åŒåˆ™æ„å‘³ç€åˆ·æ–°æœŸé—´å‘ç”Ÿäº†é”™è¯¯. å4 å­—èŠ‚ä»£è¡¨é¡µé¢è¢«æœ€åä¿®æ”¹æ—¶å¯¹åº”çš„LSN çš„å4 å­—èŠ‚ï¼Œæ­£å¸¸æƒ…å†µä¸‹åº”è¯¥ä¸FileHeader éƒ¨åˆ†çš„FIL_PAGE_LSNçš„å4 å­—èŠ‚ç›¸åŒã€‚è¿™ä¸ªéƒ¨åˆ†ä¹Ÿæ˜¯ç”¨äºæ ¡éªŒé¡µçš„å®Œæ•´æ€§ï¼Œä¸è¿‡æˆ‘ä»¬ç›®å‰è¿˜æ²¡è¯´LSN æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæ‰€ä»¥å¤§å®¶å¯ä»¥å…ˆä¸ç”¨ç®¡è¿™ä¸ªå±æ€§ã€‚ è¿™ä¸ªFile Trailer ä¸File Header ç±»ä¼¼ï¼Œéƒ½é€šç”¨äºæ‰€æœ‰ç±»å‹çš„é¡µ\n"},{"id":39,"href":"/zh/docs/study/MySQL/how_mysql_run/04/","title":"04InnoDBè®°å½•å­˜å‚¨ç»“æ„","section":"_MySQLæ˜¯æ€æ ·è¿è¡Œçš„_","content":" å­¦ä¹ ã€ŠMySQLæ˜¯æ€æ ·è¿è¡Œçš„ã€‹ï¼Œæ„Ÿè°¢ä½œè€…ï¼\né—®é¢˜ # è¡¨æ•°æ®å­˜åœ¨å“ªï¼Œä»¥ä»€ä¹ˆæ ¼å¼å­˜æ”¾ï¼ŒMySQLä»¥ä»€ä¹ˆæ–¹å¼æ¥è®¿é—®\nå­˜å‚¨å¼•æ“ï¼šå¯¹è¡¨ä¸­æ•°æ®è¿›è¡Œå­˜å‚¨å’Œå†™å…¥\nInnoDBæ˜¯MySQLé»˜è®¤çš„å­˜å‚¨å¼•æ“ï¼Œè¿™ç« ä¸»è¦è®²InnoDBå­˜å‚¨å¼•æ“çš„è®°å½•å­˜å‚¨ç»“æ„\nInnoDBé¡µç®€ä»‹ # æ³¨æ„ï¼Œæ˜¯ç®€ä»‹\nInnoDBï¼šå°†è¡¨ä¸­çš„æ•°æ®å­˜å‚¨åˆ°ç£ç›˜ä¸Š\nçœŸæ­£å¤„ç†æ•°æ®çš„è¿‡ç¨‹ï¼šå†…å­˜ä¸­ã€‚æ‰€ä»¥éœ€è¦æŠŠç£ç›˜ä¸­æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœæ˜¯å†™å…¥æˆ–ä¿®æ”¹è¯·æ±‚ï¼Œè¿˜éœ€è¦æŠŠå†…å­˜ä¸­çš„å†…å®¹åˆ·æ–°åˆ°ç£ç›˜ä¸Š\nè·å–è®°å½•ï¼šä¸æ˜¯ä¸€æ¡æ¡ä»ç£ç›˜è¯»ï¼ŒInnoDBå°†æ•°æ®åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªé¡µï¼Œä»¥é¡µä½œä¸ºç£ç›˜å’Œå†…å­˜ä¹‹é—´äº¤äº’çš„åŸºæœ¬å•ä½ã€‚é¡µå¤§å°-\u0026gt; ä¸€èˆ¬æ˜¯16KB\nä¸€èˆ¬æƒ…å†µï¼šä¸€æ¬¡æœ€å°‘ä»ç£ç›˜è¯»å–16KBçš„å†…å®¹åˆ°å†…å­˜ä¸­ï¼Œä¸€æ¬¡æœ€å°‘æŠŠå†…å­˜ä¸­çš„16KBå†…å®¹åˆ·æ–°åˆ°ç£ç›˜ä¸­\nmysql\u0026gt; SHOW VARIABLES LIKE \u0026#39;innodb_page_size\u0026#39;; +------------------+-------+ | Variable_name | Value | +------------------+-------+ | innodb_page_size | 16384 | +------------------+-------+ 1 row in set (0.00 sec) åªèƒ½åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–MySQLæ•°æ®ç›®å½•æ—¶æŒ‡å®šï¼Œä¹‹åå†ä¹Ÿä¸èƒ½æ›´æ”¹ï¼ˆé€šè¿‡mysqld \u0026ndash;initializeåˆå§‹åŒ–æ•°æ®ç›®å½•[æ—§ç‰ˆæœ¬]ï¼‰\nInnoDBè¡Œæ ¼å¼ # ä»¥è®°å½•ä¸ºå•ä½å‘è¡¨ä¸­æ’å…¥æ•°æ®ï¼Œè€Œè¿™äº›è®°å½•åœ¨ç£ç›˜ä¸Šçš„å­˜æ”¾å½¢å¼ä¹Ÿè¢«ç§°ä¸ºè¡Œæ ¼å¼æˆ–è€…è®°å½•æ ¼å¼\nç›®å‰æœ‰4ä¸­ä¸åŒç±»å‹çš„è¡Œæ ¼å¼ï¼šCOMPACTã€REDUNDANTã€DYNAMICå’ŒCOMPRESSED\ncompact [kÉ™mËˆpÃ¦kt]å¥‘çº¦\nredundant[rÉªËˆdÊŒndÉ™nt] å†—ä½™çš„\ndynamic[daÉªËˆnÃ¦mÉªk]åŠ¨æ€çš„\ncompressed [kÉ™mËˆprest] å‹ç¼©çš„\næŒ‡å®šè¡Œæ ¼å¼çš„è¯­æ³• # CREATE TABLE è¡¨å(åˆ—çš„ä¿¡æ¯) ROW_FORMAT=è¡Œæ ¼å¼åç§°\nALTER TABLE è¡¨å ROW_FORMATE=è¡Œæ ¼å¼åç§°\nå¦‚ä¸‹ï¼Œåœ¨æ•°æ®åº“xiaohaiziä¸‹åˆ›å»ºä¸€ä¸ªè¡¨\nCREATE TABLE record_format_demo( c1 VARCHAR(10), c2 VARCHAR(10) NOT NULL, c3 CHAR(10), c4 VARCHAR(10) ) CHARSET=ascii ROW_FORMAT=COMPACT; #å›é¡¾ï¼šasciiæ¯ä¸ªå­—ç¬¦1å­—èŠ‚å³å¯è¡¨ç¤ºï¼Œä¸”åªæœ‰ç©ºæ ¼æ ‡ç‚¹æ•°å­—å­—æ¯ä¸å¯è§å­—ç¬¦ #æ’å…¥ä¸¤æ¡æ•°æ® INSERT INTO record_format_demo(c1,c2,c3,c4) VALUES(\u0026#39;aaaa\u0026#39;,\u0026#39;bbb\u0026#39;,\u0026#39;cc\u0026#39;,\u0026#39;d\u0026#39;),(\u0026#39;eeee\u0026#39;,\u0026#39;fff\u0026#39;,NULL,NULL); æŸ¥è¯¢\n#æŸ¥è¯¢ mysql\u0026gt; SELECT * FROM record_format_demo; +------+-----+------+------+ | c1 | c2 | c3 | c4 | +------+-----+------+------+ | aaaa | bbb | cc | d | | eeee | fff | NULL | NULL | +------+-----+------+------+ 2 rows in set (0.01 sec) COMPACTè¡Œæ ¼å¼ # [kÉ™mËˆpÃ¦kt]å¥‘çº¦\né¢å¤–ä¿¡æ¯ # åŒ…æ‹¬å˜é•¿å­—æ®µé•¿åº¦åˆ—è¡¨ã€NULLå€¼åˆ—è¡¨ã€è®°å½•å¤´ä¿¡æ¯\nè®°å½•çš„çœŸå®æ•°æ® # REDUNDANTè¡Œæ ¼å¼ # [rÉªËˆdÊŒndÉ™nt] å†—ä½™çš„ MySQL5.0ä¹‹å‰ä½¿ç”¨çš„ä¸€ç§è¡Œæ ¼å¼ï¼ˆå¤è€ï¼‰\nå¦‚å›¾\nä¸‹é¢ä¸»è¦å’ŒCOMPACTè¡Œæ ¼å¼åšæ¯”è¾ƒ\nå­—æ®µé•¿åº¦åç§»åˆ—è¡¨ # è®°å½•äº†æ‰€æœ‰åˆ— åç§»ï¼Œå³ä¸æ˜¯ç›´æ¥è®°å½•ï¼Œè€Œæ˜¯é€šè¿‡åŠ å‡ åŒæ ·æ˜¯é€†åºï¼Œå¦‚ç¬¬ä¸€æ¡è®°å½•\n06 0C 13 17 1A 24 25ï¼Œåˆ™\nç¬¬1åˆ—(RD_ROW_ID)ï¼š6å­—èŠ‚\nç¬¬2åˆ—(DB_TRX_ID)ï¼š6å­—èŠ‚ 0C-06=6 ç¬¬3åˆ—(DB_ROLL_POINTER)ï¼š7å­—èŠ‚ 13-0C=7 ç¬¬4åˆ—(c1)ï¼š4å­—èŠ‚\nç¬¬5åˆ—(c2)ï¼š3å­—èŠ‚\nç¬¬6åˆ—(c3)ï¼š10å­—èŠ‚\nç¬¬7åˆ—(c4)ï¼š1å­—èŠ‚\nè®°å½•å¤´ä¿¡æ¯ # ç›¸æ¯”COMPACTè¡Œæ ¼å¼ï¼Œå¤šå‡ºäº†2ä¸ªï¼Œå°‘äº†ä¸€ä¸ª\næ²¡æœ‰äº†record_typeè¿™ä¸ªå±æ€§ å¤šäº†n_fieldå’Œ1byte_offs_flagè¿™ä¸¤ä¸ªå±æ€§ï¼š\n#æŸ¥è¯¢ mysql\u0026gt; SELECT * FROM record_format_demo; +------+-----+------+------+ | c1 | c2 | c3 | c4 | +------+-----+------+------+ | aaaa | bbb | cc | d | | eeee | fff | NULL | NULL | +------+-----+------+------+ 2 rows in set (0.01 sec) ç¬¬ä¸€æ¡è®°å½•çš„å¤´ä¿¡æ¯ä¸ºï¼š00 00 10 0F 00 BC\nå³ï¼š00000000 00000000 00010000 00001111 00000000 1011 1100\nå‰é¢2å­—èŠ‚éƒ½æ˜¯0ï¼Œå³é¢„ç•™ä½1ï¼Œé¢„ç•™ä½2ï¼Œdeleted_flagï¼Œmin_rec_flagï¼Œn_ownedéƒ½æ˜¯0\nheap_noå‰é¢8ä½æ˜¯0ï¼Œå†å–5ä½ï¼šå³ 00000000 0001 0ï¼Œå³0x02\nn_fieldï¼š000 0000111ï¼Œå³0x07\n1byte_offs_flagï¼š0x01\nnext_recordï¼š00000000 1011 1100ï¼Œå³0xBC\nè®°å½•å¤´ä¿¡æ¯ä¸­çš„1byte_offs_flagçš„å€¼æ˜¯æ€ä¹ˆé€‰æ‹©çš„ # å­—æ®µé•¿åº¦åç§»åˆ—è¡¨å­˜å‚¨çš„åç§»é‡æŒ‡çš„æ˜¯æ¯ä¸ªåˆ—çš„å€¼å ç”¨çš„ç©ºé—´åœ¨è®°å½•çš„çœŸ å®æ•°æ®å¤„ç»“æŸçš„ä½ç½®\nå¦‚ä¸Šï¼Œ0x06ä»£è¡¨ç¬¬ä¸€åˆ—(DB_ROW_ID)åœ¨çœŸå®æ•°æ®çš„ç¬¬6å­—èŠ‚å¤„ç»“æŸï¼›0x0C ä»£è¡¨ç¬¬äºŒåˆ—(DB_TRX_ID)åœ¨çœŸå®æ•°æ®çš„ç¬¬12å­—èŠ‚å¤„ç»“æŸ\u0026hellip;.\nè®¨è®ºï¼šæ¯ä¸ªåˆ—å¯¹åº”çš„åç§»é‡å¯ä»¥ä½¿ç”¨1å­—èŠ‚æˆ–2å­—èŠ‚æ¥å­˜å‚¨ï¼Œé‚£ä¹ˆä»€ä¹ˆæ—¶å€™1ä»€ä¹ˆæ—¶å€™2\næ ¹æ®REDUNDANTè¡Œæ ¼å¼è®°å½•çš„çœŸå®æ•°æ®å ç”¨çš„æ€»å¤§å°æ¥åˆ¤æ–­\nå¦‚æœçœŸå®æ•°æ®å ç”¨çš„å­—èŠ‚æ•°ä¸å¤§äº127æ—¶ï¼Œæ¯ä¸ªåˆ—å¯¹åº”çš„åç§»é‡å ç”¨1å­—èŠ‚**[æ³¨æ„ï¼Œè¿™é‡Œåªç”¨åˆ°äº†1å­—èŠ‚çš„7ä½ï¼Œå³max=01111111]**\nå¦‚æœå¤§äº127ä½†ä¸å¤§äº32767 ï¼ˆ2^15-1ï¼Œä¹Ÿå°±æ˜¯15ä½çš„æœ€å¤§è¡¨ç¤ºï¼‰æ—¶ï¼Œä½¿ç”¨2å­—èŠ‚ã€‚\nå¦‚æœè¶…è¿‡32767ï¼Œåˆ™æœ¬é¡µä¸­åªä¿ç•™å‰768å­—èŠ‚å’Œ20å­—èŠ‚çš„æº¢å‡ºé¡µé¢åœ°å€ï¼ˆ20å­—èŠ‚è¿˜æœ‰åˆ«çš„ä¿¡æ¯ï¼‰ã€‚è¿™ç§æƒ…å†µä¸‹åªæ˜¯ç”¨2å­—èŠ‚å­˜å‚¨æ¯ä¸ªåˆ—å¯¹åº”çš„åç§»é‡å³å¯ï¼ˆ127\u0026lt;768\u0026lt;=32767)\nåœ¨å¤´ä¿¡æ¯ä¸­æ”¾ç½®äº†ä¸€ä¸ª1byte_offs_flagå±æ€§ï¼Œå€¼ä¸º1æ—¶è¡¨æ˜ä½¿ç”¨1å­—èŠ‚å­˜å‚¨åç§»é‡ï¼›å€¼ä¸º0æ—¶è¡¨æ˜ä½¿ç”¨2å­—èŠ‚å­˜å‚¨åç§»é‡\nREDUNDANTè¡Œæ ¼å¼ä¸­NULLå€¼çš„å¤„ç† # REDUNDANTè¡Œæ ¼å¼å¹¶æ²¡æœ‰NULLå€¼åˆ—è¡¨\nå°†åˆ—å¯¹åº”çš„åç§»é‡å€¼çš„ç¬¬ä¸€ä¸ªæ¯”ç‰¹ä½ï¼Œä½œä¸ºæ˜¯å¦ä¸ºNULLçš„ä¾æ®ï¼Œä¹Ÿç§°ä¹‹ä¸ºNULLæ¯”ç‰¹ä½ ä¸è®ºæ˜¯1å­—èŠ‚è¿˜æ˜¯2å­—èŠ‚ï¼Œéƒ½è¦ä½¿ç”¨ç¬¬1ä¸ªæ¯”ç‰¹ä½æ¥æ ‡è®°è¯¥åˆ—å€¼æ˜¯å¦ä¸ºNULL\nå¯¹äºNULLåˆ—æ¥è¯´ï¼Œè¯¥åˆ—çš„ç±»å‹æ˜¯å¦ä¸ºå˜é•¿ç±»å‹å†³å®šäº†è¯¥åˆ—åœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„çš„å­˜å‚¨æ–¹å¼ã€‚\nåˆ†æç¬¬2æ¡æ•°æ®\nå­—æ®µé•¿åº¦åç§»åˆ—è¡¨-\u0026gt;æŒ‰ç…§åˆ—çš„é¡ºåºæ’æ”¾ï¼š06 0C 13 17 1A A4 A4\nc3=NULLï¼Œä¸”c3ç±»å‹-\u0026gt;CHAR(10) ==\u0026gt;çœŸå®æ•°æ®éƒ¨åˆ†å ç”¨10å­—èŠ‚,0x00\nc3 åŸåç§»é‡ä¸º36=32+4 = 00100100-\u0026gt;0x24ï¼Œç”±äºä¸ºNULLï¼Œæ‰€ä»¥é¦–ä½(æ¯”ç‰¹)ä¸º1ï¼Œæ‰€ä»¥ï¼ˆçœŸå®ï¼‰åç§»é‡ä¸º10100100ï¼Œ0xA4\nc2åç§»é‡ä¸º0x1Aï¼Œåˆ™c2å­—èŠ‚æ•°ä¸º0x24-0x1A=36-26=10\nå¦‚æœå­˜å‚¨NULLå€¼çš„å­—æ®µä¸ºå˜é•¿æ•°æ®ç±»å‹ï¼Œåˆ™ä¸åœ¨è®°å½•çš„çœŸå®æ•°æ®éƒ¨åˆ†å ç”¨ä»»ä½•å­˜å‚¨ç©ºé—´\næ‰€ä»¥c4çš„åç§»é‡åº”è¯¥å’Œc3ç›¸åŒï¼Œéƒ½æ˜¯00100100ï¼Œä¸”ç”±äºæ˜¯NULLï¼Œæ‰€ä»¥é¦–ä½ä¸º1-\u0026gt;10100100,0xA4\nä»ç»“æœå¾€å›æ¨ç†ï¼Œc4ä¹Ÿæ˜¯0xA4ï¼Œå’Œc3ç›¸åŒï¼Œè¯´æ˜c4å’Œc3ä¸€æ ·éƒ½æ˜¯NULL\nCOMPACTè¡Œæ ¼å¼çš„è®°å½•å ç”¨çš„ç©ºé—´æ›´å°‘\nCHAR(m)åˆ—çš„å­˜å‚¨æ ¼å¼ # COMPACTä¸­ï¼Œå½“å®šé•¿ç±»å‹CHAR(M)çš„å­—ç¬¦é›†çš„æ¯ä¸ªå­—ç¬¦å ç”¨å­—èŠ‚ä¸å›ºå®šæ—¶ï¼Œæ‰ä¼šè®°å½•CHARåˆ—çš„é•¿åº¦ï¼›è€ŒREDUNDANTè¡Œæ ¼å¼ä¸­ï¼Œè¯¥åˆ—çœŸå®æ•°æ®å ç”¨çš„å­˜å‚¨ç©ºé—´å¤§å°ï¼Œå°±æ˜¯è¯¥å­—ç¬¦é›†è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦æœ€å¤šéœ€è¦çš„å­—èŠ‚æ•°å’ŒMçš„ä¹˜ç§¯ï¼šutf8çš„CHAR(10)ç±»å‹çš„åˆ—ï¼ŒçœŸå®æ•°æ®å ç”¨å­˜å‚¨ç©ºé—´å¤§å°å§‹ç»ˆä¸º30å­—èŠ‚ï¼›ä½¿ç”¨gbkå­—ç¬¦é›†çš„CHAR(10)ï¼Œå§‹ç»ˆ20å­—èŠ‚\næº¢å‡ºåˆ— # æº¢å‡ºåˆ— # #ä¸¾ä¾‹ mysql\u0026gt; CREATE TABLE off_page_demo( c VARCHAR(65532) ) CHARSET=ascii ROW_FORMAT=COMPACT; #æ’å…¥ä¸€æ¡æ•°æ® mysql\u0026gt; INSERT INTO off_page_demo(c) VALUES(REPEAT(\u0026#39;a\u0026#39;,65532)); Query OK, 1 row affected (0.06 sec) asciiå­—ç¬¦é›†ä¸­1å­—ç¬¦å ç”¨1å­—èŠ‚ï¼ŒREPEAT(\u0026lsquo;a\u0026rsquo;,65532)ç”Ÿæˆä¸€ä¸ªæŠŠå­—ç¬¦\u0026rsquo;a\u0026rsquo;é‡å¤65532æ¬¡æ•°çš„å­—ç¬¦ä¸²\n1é¡µæœ‰16kb=1024*16=16384å­—èŠ‚ï¼Œ65532å­—èŠ‚è¿œè¶…1é¡µå¤§å°\nCOMPACTå’ŒREDUNDANTè¡Œæ ¼å¼ä¸­ï¼Œå¯¹äºå­˜å‚¨ç©ºé—´å ç”¨ç‰¹åˆ«å¤šçš„åˆ—ï¼ŒçœŸå®æ•°æ®å¤„åªä¼šå­˜å‚¨è¯¥åˆ—ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå‰©ä½™æ•°æ®å­˜å‚¨åœ¨å‡ ä¸ªå…¶ä»–çš„é¡µä¸­ï¼Œåœ¨è®°å½•çš„çœŸå®æ•°æ®å¤„ç”¨20å­—èŠ‚å­˜å‚¨æŒ‡å‘è¿™äº›é¡µçš„åœ°å€ï¼ˆå½“ç„¶ï¼Œè¿™20å­—èŠ‚è¿˜åŒ…æ‹¬åˆ†æ•£åœ¨å…¶ä»–é¡µé¢ä¸­çš„æ•°æ®æ‰€å ç”¨çš„å­—èŠ‚æ•°ï¼‰\nåŸä¹¦åŠ äº†æ‹¬å·é‡Œçš„è¯ï¼Œä¸æ˜¯å¾ˆç†è§£ï¼Œæˆ‘çš„ç†è§£æ˜¯ï¼šè¿™20å­—èŠ‚æŒ‡å‘çš„é¡µä¸­ï¼ŒåŒ…æ‹¬äº†æº¢å‡ºçš„é‚£éƒ¨åˆ†æ•°æ®\nå¦‚ä¸Šï¼Œå¦‚æœåˆ—æ•°æ®éå¸¸å¤§ï¼Œåªä¼šå­˜å‚¨è¯¥åˆ—å‰768å­—èŠ‚çš„æ•°æ®ä»¥åŠä¸€ä¸ªæŒ‡å‘å…¶ä»–é¡µçš„åœ°å€ï¼ˆå­˜ç–‘ï¼Œåº”è¯¥ä¸æ­¢ä¸€ä¸ªï¼Œæœ‰æ—¶å€™1ä¸ªæ˜¯æ”¾ä¸ä¸‹æ‰€æœ‰æº¢å‡ºé¡µæ•°æ®çš„å§ï¼Ÿï¼‰\nç®€åŒ–ï¼š\nä¾‹å­ä¸­åˆ—cçš„æ•°æ®éœ€è¦ä½¿ç”¨æº¢å‡ºé¡µæ¥å­˜å‚¨ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªåˆ—ç§°ä¸ºæº¢å‡ºåˆ—ï¼Œä¸æ­¢VARCHAR(M)ï¼ŒTEXTå’ŒBLOBä¹Ÿå¯èƒ½æˆä¸ºæº¢å‡ºåˆ—\näº§ç”Ÿæº¢å‡ºåˆ—çš„ä¸´ç•Œç‚¹ # MySQLä¸­è§„å®šä¸€ä¸ªé¡µè‡³å°‘å­˜æ”¾2æ¡è®°å½•\n16KB=16384å­—èŠ‚\næ¯ä¸ªé¡µé™¤äº†è®°å½•ï¼Œè¿˜æœ‰é¢å¤–ä¿¡æ¯ï¼Œè¿™äº›é¢å¤–ä¿¡æ¯éœ€è¦132å­—èŠ‚ã€‚\næ¯ä¸ªè®°å½•éœ€è¦27å­—èŠ‚ï¼ŒåŒ…æ‹¬\né’ˆå¯¹ä¸‹é¢çš„è¡¨\nmysql\u0026gt; CREATE TABLE off_page_demo( c VARCHAR(65532) ) CHARSET=ascii ROW_FORMAT=COMPACT;\næ³¨æ„ï¼Œæ˜¯COMPACTè¡Œæ ¼å¼\nå¯¹äºæ¯ä¸€è¡Œè®°å½• å­˜å‚¨çœŸå®æ•°æ®é•¿åº¦ï¼ˆ2å­—èŠ‚ï¼‰\nå­˜å‚¨åˆ—æ˜¯å¦ä¸ºNULLå€¼ï¼ˆ1å­—èŠ‚ï¼‰\n5å­—èŠ‚å¤§å°çš„å¤´ä¿¡æ¯\n6å­—èŠ‚çš„row_idåˆ—\n6å­—èŠ‚çš„row_idåˆ—\n7å­—èŠ‚çš„roll_pointeråˆ—\n132+2*(27+n) \u0026lt;16384\nè‡³äºä¸ºç¤¾ä¹ˆä¸èƒ½ç­‰äºï¼Œè¿™æ˜¯MySQLè®¾è®¡æ—¶è§„å®šçš„ï¼ŒæœªçŸ¥ã€‚\næ­£å¸¸è®°å½•çš„é¡µå’Œæº¢å‡ºé¡µæ˜¯ä¸¤ç§ä¸åŒçš„é¡µï¼Œæ²¡æœ‰è§„å®šä¸€ä¸ªæº¢å‡ºé¡µé¡µé¢ä¸­è‡³å°‘å­˜æ”¾ä¸¤æ¡è®°å½•\nå¯¹äºè¯¥è¡¨ï¼Œå¾—å‡ºçš„è§£æ˜¯n\u0026lt;8099ï¼Œä¹Ÿå°±æ˜¯å¦‚æœä¸€ä¸ªåˆ—å­˜å‚¨çš„æ•°æ®å°äº8099ï¼Œå°±ä¸ä¼šæˆä¸ºæº¢å‡ºé¡µ\nç»“è®º # å¦‚æœä¸€æ¡è®°å½•çš„æŸä¸ªåˆ—ä¸­å­˜å‚¨çš„æ•°æ®å ç”¨å­—èŠ‚æ•°éå¸¸å¤šï¼Œå¯¼è‡´ä¸€ä¸ªé¡µæ²¡æœ‰åŠæ³•å­˜å‚¨ä¸¤æ¡è®°å½•ï¼Œè¯¥åˆ—å°±å¯èƒ½ä¼šæˆä¸ºæº¢å‡ºåˆ—\nDYNAMICè¡Œæ ¼å¼å’ŒCOMPRESSEDè¡Œæ ¼å¼ # è¿™ä¸¤ä¸ªä¸COMPACTè¡Œè®°å½•æŒºåƒï¼Œå¯¹äºå¤„ç†æº¢å‡ºåˆ—çš„æ•°æ®æœ‰åˆ†æ­§ï¼š\nä»–ä»¬ä¸ä¼šåœ¨è®°å½•çœŸå®å¤„å­˜å‚¨çœŸå®æ•°æ®çš„å‰768å­—èŠ‚ï¼Œè€Œæ˜¯æŠŠè¯¥åˆ—æ‰€æœ‰çœŸå®æ•°æ®éƒ½å­˜å‚¨åˆ°æº¢å‡ºé¡µï¼Œåªåœ¨çœŸå®è®°å½•å¤„å­˜å‚¨20å­—èŠ‚ï¼ˆæŒ‡å‘æº¢å‡ºé¡µçš„åœ°å€ï¼‰ã€‚COMPRESSEDè¡Œæ ¼å¼ä¸åŒäºDYNAMICè¡Œæ ¼å¼çš„ä¸€ç‚¹ï¼šCOMPRESSEDè¡Œæ ¼å¼ä¼šé‡‡ç”¨å‹ç¼©ç®—æ³•å¯¹é¡µé¢è¿›è¡Œå‹ç¼©\nMySQL5.7é»˜è®¤ä½¿ç”¨DYNAMICè¡Œè®°å½•\næ€»ç»“ # REDUNDANTæ˜¯ä¸€ä¸ªæ¯”è¾ƒåŸå§‹çš„è¡Œæ ¼å¼ï¼Œè¾ƒä¸ºç´§å‡‘ï¼›è€ŒCOMPACTã€DYNAMICä»¥åŠCOMPRESSEDè¡Œæ ¼å¼æ˜¯è¾ƒæ–°çš„è¡Œæ ¼å¼ï¼Œå®ƒä»¬æ˜¯ç´§å‡‘çš„ï¼ˆå ç”¨å­˜å‚¨ç©ºé—´æ›´å°‘ï¼‰\n"},{"id":40,"href":"/zh/docs/study/MySQL/how_mysql_run/03/","title":"03å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™","section":"_MySQLæ˜¯æ€æ ·è¿è¡Œçš„_","content":" å­¦ä¹ ã€ŠMySQLæ˜¯æ€æ ·è¿è¡Œçš„ã€‹ï¼Œæ„Ÿè°¢ä½œè€…ï¼\nå­—ç¬¦é›† # æŠŠå“ªäº›å­—ç¬¦æ˜ å°„æˆäºŒè¿›åˆ¶æ•°æ®ï¼šå­—ç¬¦èŒƒå›´\næ€ä¹ˆæ˜ å°„ï¼šå­—ç¬¦-\u0026gt;äºŒè¿›åˆ¶æ•°æ®ï¼Œç¼–ç ï¼›äºŒè¿›åˆ¶-\u0026gt;å­—ç¬¦ï¼Œè§£ç \nå­—ç¬¦é›†ï¼šæŸä¸ªå­—ç¬¦èŒƒå›´çš„ç¼–ç è§„åˆ™\nåŒä¸€ç§å­—ç¬¦é›†å¯ä»¥æœ‰å¤šç§æ¯”è¾ƒè§„åˆ™\né‡è¦çš„å­—ç¬¦é›† # ASCAIIå­—ç¬¦é›†ï¼š128ä¸ªï¼ŒåŒ…æ‹¬ç©ºæ ¼æ ‡ç‚¹æ•°å­—å¤§å°å†™åŠä¸å¯è§å­—ç¬¦ï¼Œä½¿ç”¨ä¸€ä¸ªå­—èŠ‚ç¼–ç \nISO 8859-1å­—ç¬¦é›†ï¼š256ä¸ªï¼ŒASCAIIåŸºç¡€æ‰©å……128ä¸ªè¥¿æ¬§å¸¸ç”¨å­—ç¬¦ï¼ˆåŒ…æ‹¬å¾·æ³•ï¼‰ï¼Œä½¿ç”¨1ä¸ªå­—èŠ‚ï¼Œåˆ«åLatin1\nGB2312å­—ç¬¦é›†ï¼šæ”¶å½•éƒ¨åˆ†æ±‰å­—ï¼Œå…¼å®¹ASCAIIå­—ç¬¦é›†ï¼Œå¦‚æœå­—ç¬¦åœ¨ASCAIIå­—ç¬¦é›†ä¸­åˆ™é‡‡ç”¨1å­—èŠ‚ï¼Œå¦åˆ™ä¸¤å­—èŠ‚ã€‚å³å˜é•¿ç¼–ç æ–¹å¼\nåŒºåˆ†æŸä¸ªå­—èŠ‚ï¼Œä»£è¡¨ä¸€ä¸ªå•ç‹¬å­—ç¬¦ï¼Œè¿˜æ˜¯æŸä¸ªå­—ç¬¦çš„ä¸€éƒ¨åˆ†ã€‚\næ¯”å¦‚0xB0AE75ï¼Œç”±äºæ˜¯16è¿›åˆ¶ï¼Œæ‰€æœ‰ä¸¤ä¸ªä»£è¡¨1ä¸ªå­—èŠ‚ã€‚æ‰€ä»¥è¿™é‡Œæœ‰ä¸‰ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­æœ€åé‚£ä¸ªå­—èŠ‚ä¸º7*16+5=117 \u0026lt; 127 æ‰€ä»¥ä»£è¡¨ä¸€ä¸ªå•ç‹¬å­—ç¬¦ã€‚è€ŒAE=10 * 16 +15=175 \u0026gt;127 ï¼Œæ‰€ä»¥æ˜¯æŸä¸ªå­—ç¬¦çš„ä¸€éƒ¨åˆ†\nGBKå­—ç¬¦é›†ï¼šå¯¹GB2312å­—ç¬¦é›†æ‰©å……ï¼Œç¼–ç æ–¹å¼å…¼å®¹GB2312\nUTF-8å­—ç¬¦é›†ï¼šå‡ ä¹æ”¶å½•æ‰€æœ‰å­—ç¬¦ï¼Œä¸”ä¸æ–­æ‰©å……ï¼Œå…¼å®¹ASCAIIå­—ç¬¦é›†ã€‚å˜é•¿ï¼šé‡‡ç”¨14å­—èŠ‚\nL-\u0026gt;0x4C 1å­—èŠ‚ï¼Œå•Š-\u0026gt;0xE5958Aï¼Œä¸¤å­—èŠ‚\nUTF-8æ˜¯Unicodeå­—ç¬¦é›†çš„ä¸€ç§ç¼–ç æ–¹æ¡ˆï¼ŒUnicodeå­—ç¬¦é›†æœ‰ä¸‰ç§æ–¹æ¡ˆï¼šUTF-8(14å­—èŠ‚ç¼–ç ä¸€ä¸ªå­—ç¬¦)ï¼ŒUTF-16(2æˆ–4å­—èŠ‚ç¼–ç ä¸€ä¸ªå­—ç¬¦)ï¼ŒUTF-32(4å­—èŠ‚ç¼–ç ä¸€ä¸ªå­—ç¬¦)\nå¯¹äº**â€œæˆ‘â€**ï¼ŒASCLLä¸­æ²¡æœ‰ï¼ŒUTF-8ä¸­é‡‡ç”¨3å­—èŠ‚ç¼–ç ï¼ŒGB22312é‡‡ç”¨2å­—èŠ‚ç¼–ç \nMySQLä¸­æ”¯æŒçš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ # MySQLä¸­ï¼ŒåŒºåˆ†utf8mb3å’Œutf8mb4ï¼Œå‰è€…åªæ˜¯ç”¨13å­—èŠ‚è¡¨ç¤ºå­—ç¬¦ï¼›åè€…ä½¿ç”¨14å­—èŠ‚è¡¨ç¤ºå­—ç¬¦ã€‚MySQLä¸­ï¼Œutf8ä»£è¡¨utf8mb3ã€‚\n#æŸ¥çœ‹å½“å‰MySQLæ”¯æŒçš„å­—ç¬¦é›†(æ³¨æ„ï¼Œæ˜¯å­—ç¬¦é›†ï¼Œåç§°éƒ½æ˜¯å°å†™) #Default collation é»˜è®¤æ¯”è¾ƒè§„åˆ™ mysql\u0026gt; SHOW CHARSET; +----------+---------------------------------+---------------------+--------+ | Charset | Description | Default collation | Maxlen | +----------+---------------------------------+---------------------+--------+ | big5 | Big5 Traditional Chinese | big5_chinese_ci | 2 | | dec8 | DEC West European | dec8_swedish_ci | 1 | | cp850 | DOS West European | cp850_general_ci | 1 | | hp8 | HP West European | hp8_english_ci | 1 | | koi8r | KOI8-R Relcom Russian | koi8r_general_ci | 1 | | latin1 | cp1252 West European | latin1_swedish_ci | 1 | \u0026lt;--- | latin2 | ISO 8859-2 Central European | latin2_general_ci | 1 | \u0026lt;--- | swe7 | 7bit Swedish | swe7_swedish_ci | 1 | | ascii | US ASCII | ascii_general_ci | 1 | \u0026lt;--- | ujis | EUC-JP Japanese | ujis_japanese_ci | 3 | | sjis | Shift-JIS Japanese | sjis_japanese_ci | 2 | | hebrew | ISO 8859-8 Hebrew | hebrew_general_ci | 1 | | tis620 | TIS620 Thai | tis620_thai_ci | 1 | | euckr | EUC-KR Korean | euckr_korean_ci | 2 | | koi8u | KOI8-U Ukrainian | koi8u_general_ci | 1 | | gb2312 | GB2312 Simplified Chinese | gb2312_chinese_ci | 2 | \u0026lt;--- | greek | ISO 8859-7 Greek | greek_general_ci | 1 | | cp1250 | Windows Central European | cp1250_general_ci | 1 | | gbk | GBK Simplified Chinese | gbk_chinese_ci | 2 | \u0026lt;--- | latin5 | ISO 8859-9 Turkish | latin5_turkish_ci | 1 | | armscii8 | ARMSCII-8 Armenian | armscii8_general_ci | 1 | | utf8 | UTF-8 Unicode | utf8_general_ci | 3 | \u0026lt;--- | ucs2 | UCS-2 Unicode | ucs2_general_ci | 2 | | cp866 | DOS Russian | cp866_general_ci | 1 | | keybcs2 | DOS Kamenicky Czech-Slovak | keybcs2_general_ci | 1 | | macce | Mac Central European | macce_general_ci | 1 | | macroman | Mac West European | macroman_general_ci | 1 | | cp852 | DOS Central European | cp852_general_ci | 1 | | latin7 | ISO 8859-13 Baltic | latin7_general_ci | 1 | | utf8mb4 | UTF-8 Unicode | utf8mb4_general_ci | 4 | \u0026lt;--- | cp1251 | Windows Cyrillic | cp1251_general_ci | 1 | | utf16 | UTF-16 Unicode | utf16_general_ci | 4 | \u0026lt;--- | utf16le | UTF-16LE Unicode | utf16le_general_ci | 4 | | cp1256 | Windows Arabic | cp1256_general_ci | 1 | | cp1257 | Windows Baltic | cp1257_general_ci | 1 | | utf32 | UTF-32 Unicode | utf32_general_ci | 4 | \u0026lt;--- | binary | Binary pseudo charset | binary | 1 | | geostd8 | GEOSTD8 Georgian | geostd8_general_ci | 1 | | cp932 | SJIS for Windows Japanese | cp932_japanese_ci | 2 | | eucjpms | UJIS for Windows Japanese | eucjpms_japanese_ci | 3 | | gb18030 | China National Standard GB18030 | gb18030_chinese_ci | 4 | +----------+---------------------------------+---------------------+--------+ 41 rows in set (0.00 sec) å­—ç¬¦é›†çš„æ¯”è¾ƒè§„åˆ™ï¼ˆè¿™é‡Œå…ˆçœ‹utf8çš„ï¼‰\nmysql\u0026gt; SHOW COLLATION LIKE \u0026#39;utf8\\_%\u0026#39;; +--------------------------+---------+-----+---------+----------+---------+ | Collation | Charset | Id | Default | Compiled | Sortlen | +--------------------------+---------+-----+---------+----------+---------+ | utf8_general_ci | utf8 | 33 | Yes | Yes | 1 | | utf8_bin | utf8 | 83 | | Yes | 1 | | utf8_unicode_ci | utf8 | 192 | | Yes | 8 | | utf8_icelandic_ci | utf8 | 193 | | Yes | 8 | | utf8_latvian_ci | utf8 | 194 | | Yes | 8 | | utf8_romanian_ci | utf8 | 195 | | Yes | 8 | | utf8_slovenian_ci | utf8 | 196 | | Yes | 8 | | utf8_polish_ci | utf8 | 197 | | Yes | 8 | | utf8_estonian_ci | utf8 | 198 | | Yes | 8 | | utf8_spanish_ci | utf8 | 199 | | Yes | 8 | | utf8_swedish_ci | utf8 | 200 | | Yes | 8 | | utf8_turkish_ci | utf8 | 201 | | Yes | 8 | | utf8_czech_ci | utf8 | 202 | | Yes | 8 | | utf8_danish_ci | utf8 | 203 | | Yes | 8 | | utf8_lithuanian_ci | utf8 | 204 | | Yes | 8 | | utf8_slovak_ci | utf8 | 205 | | Yes | 8 | | utf8_spanish2_ci | utf8 | 206 | | Yes | 8 | | utf8_roman_ci | utf8 | 207 | | Yes | 8 | | utf8_persian_ci | utf8 | 208 | | Yes | 8 | | utf8_esperanto_ci | utf8 | 209 | | Yes | 8 | | utf8_hungarian_ci | utf8 | 210 | | Yes | 8 | | utf8_sinhala_ci | utf8 | 211 | | Yes | 8 | | utf8_german2_ci | utf8 | 212 | | Yes | 8 | | utf8_croatian_ci | utf8 | 213 | | Yes | 8 | | utf8_unicode_520_ci | utf8 | 214 | | Yes | 8 | | utf8_vietnamese_ci | utf8 | 215 | | Yes | 8 | | utf8_general_mysql500_ci | utf8 | 223 | | Yes | 1 | +--------------------------+---------+-----+---------+----------+---------+ 27 rows in set (0.00 sec) utf8_polish_ci æ³¢å…°è¯­æ¯”è¾ƒè§„åˆ™ï¼› utf8_spanish_ciç­ç‰™è¯­çš„æ¯”è¾ƒè§„åˆ™ï¼›utf8_general_ciä¸€ç§é€šç”¨çš„æ¯”è¾ƒè§„åˆ™ ï¼ˆutf8çš„é»˜è®¤æ¯”è¾ƒè§„åˆ™ï¼‰\nä¸€äº›åç¼€çš„è§£é‡Šï¼š\nå­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™çš„åº”ç”¨ # MySQLæœ‰4ä¸ªçº§åˆ«çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ï¼šæœåŠ¡å™¨çº§åˆ«ã€æ•°æ®åº“çº§åˆ«ã€è¡¨çº§åˆ«ã€åˆ—çº§åˆ«\næœåŠ¡å™¨çº§åˆ« # mysql\u0026gt; SHOW VARIABLES LIKE \u0026#39;character_set_server\u0026#39;; +----------------------+--------+ | Variable_name | Value | +----------------------+--------+ | character_set_server | latin1 | +----------------------+--------+ 1 row in set (0.00 sec) mysql\u0026gt; SHOW VARIABLES LIKE \u0026#39;collation_server\u0026#39;; +------------------+-------------------+ | Variable_name | Value | +------------------+-------------------+ | collation_server | latin1_swedish_ci | +------------------+------------------- 1 row in set (0.00 sec) #centos7(è‹±è¯­è¯­è¨€)é»˜è®¤æƒ…å†µä¸‹å¦‚ä¸Š #æ‰€ä»¥æ¯”è¾ƒæ—¶ï¼Œæ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ mysql\u0026gt; select * from test; +-------+ | name | +-------+ | hello | | Hello | +-------+ 2 rows in set (0.00 sec) mysql\u0026gt; select * from test where name = \u0026#39;hello\u0026#39;; +-------+ | name | +-------+ | hello | | Hello | +-------+ ä¿®æ”¹ä¸ºutf8\nvim /etc/my.cnf #æ–°å¢ [server] character_set_server=utf8 collation_server=utf8_general_ci #é‡å¯å¹¶æŸ¥çœ‹ systemctl restart mysqld; mysql\u0026gt; SHOW VARIABLES LIKE \u0026#39;character_set_server\u0026#39;; +----------------------+-------+ | Variable_name | Value | +----------------------+-------+ | character_set_server | utf8 | +----------------------+-------+ 1 row in set (0.00 sec) mysql\u0026gt; SHOW VARIABLES LIKE \u0026#39;character_set_server\u0026#39;;^C mysql\u0026gt; SHOW VARIABLES LIKE \u0026#39;collation_server\u0026#39;; +------------------+-----------------+ | Variable_name | Value | +------------------+-----------------+ | collation_server | utf8_general_ci | +------------------+-----------------+ 1 row in set (0.00 sec) æ•°æ®åº“çº§åˆ« # #åˆ›å»ºæ•°æ®åº“å¹¶æŒ‡å®šå­—ç¬¦é›†åŠæ¯”è¾ƒè§„åˆ™ #å¦‚æœä¸è®¾ç½®ï¼Œåˆ™ä½¿ç”¨ä¸Šçº§ï¼ˆæœåŠ¡å™¨çº§åˆ«ï¼‰çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ä½œä¸ºæ•°æ®åº“çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™ CREATE DATABASE db_test CHARACTER SET gb2312 COLLATE gb2312_chinese_ci; #æ­¤æ—¶åˆ‡æ¢åˆ°db_testæ•°æ®åº“ #å†æŸ¥çœ‹ï¼Œå‘ç°å˜äº† mysql\u0026gt; use db_test; Database changed mysql\u0026gt; SHOW VARIABLES LIKE \u0026#39;character_set_database\u0026#39;; +------------------------+--------+ | Variable_name | Value | +------------------------+--------+ | character_set_database | gb2312 | +------------------------+--------+ 1 row in set (0.00 sec) mysql\u0026gt; SHOW VARIABLES LIKE \u0026#39;collation_database\u0026#39;; +--------------------+-------------------+ | Variable_name | Value | +--------------------+-------------------+ | collation_database | gb2312_chinese_ci | +--------------------+-------------------+ 1 row in set (0.00 sec) è¡¨çº§åˆ« # mysql\u0026gt; CREATE TABLE t(col VARCHAR(10)) CHARACTER SET utf8 COLLATE utf8_general_ci; Query OK, 0 rows affected (0.06 sec) mysql\u0026gt; SHOW CREATE TABLE t; +-------+------------------------------------------------------------------------------------------+ | Table | Create Table | +-------+------------------------------------------------------------------------------------------+ | t | CREATE TABLE `t` ( `col` varchar(10) DEFAULT NULL ) ENGINE=InnoDB DEFAULT CHARSET=utf8 | +-------+------------------------------------------------------------------------------------------+ 1 row in set (0.00 sec) å¦‚æœä¸æŒ‡å®šï¼Œé‚£ä¹ˆå°†ç»§æ‰¿æ‰€åœ¨æ•°æ®åº“çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™\nåˆ—çº§åˆ« # mysql\u0026gt; ALTER TABLE t MODIFY col VARCHAR(10) CHARACTER SET gbk COLLATE gbk_chinese_ci; ## ä¿®æ”¹ä¸ºå­—ç¬¦é›†gbkå’Œå¯¹åº”çš„æ’åºè§„åˆ™ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œåˆ™ä½¿ç”¨è¡¨çš„å­—ç¬¦é›†åŠè¡¨çš„æ’åºè§„åˆ™ å…¶ä»– # å¦‚æœä»…ä¿®æ”¹å­—ç¬¦é›†ï¼Œä¸ä¿®æ”¹æ¯”è¾ƒè§„åˆ™ï¼Œåˆ™æ¯”è¾ƒè§„åˆ™ä¼šè®¾ç½®ä¸ºé»˜è®¤è¯¥å­—ç¬¦é›†çš„æ¯”è¾ƒè§„åˆ™ï¼›\nå¦‚æœä»…ä¿®æ”¹æ¯”è¾ƒè§„åˆ™ï¼Œåˆ™å­—ç¬¦é›†ä¼šè®¾ç½®ä¸ºè¯¥æ¯”è¾ƒè§„åˆ™å¯¹åº”çš„å­—ç¬¦é›†\n#æŸ¥çœ‹å½“å‰æœåŠ¡å™¨å¯¹åº”è§„åˆ™ mysql\u0026gt; SHOW VARIABLES LIKE \u0026#39;character_set_server\u0026#39;; +----------------------+-------+ | Variable_name | Value | +----------------------+-------+ | character_set_server | utf8 | +----------------------+-------+ 1 row in set (0.00 sec) mysql\u0026gt; SHOW VARIABLES LIKE \u0026#39;collation_server\u0026#39;; +------------------+-----------------+ | Variable_name | Value | +------------------+-----------------+ | collation_server | utf8_general_ci | +------------------+-----------------+ 1 row in set (0.00 sec) #åªä¿®æ”¹å­—ç¬¦é›† mysql\u0026gt; SET character_set_server = gb2312; Query OK, 0 rows affected (0.00 sec) mysql\u0026gt; SHOW VARIABLES LIKE \u0026#39;collation_server\u0026#39;; +------------------+-------------------+ | Variable_name | Value | +------------------+-------------------+ | collation_server | gb2312_chinese_ci | +------------------+-------------------+ 1 row in set (0.00 sec) #ä»…ä¿®æ”¹æ¯”è¾ƒè§„åˆ™ mysql\u0026gt; SET collation_server = utf8_general_ci; Query OK, 0 rows affected (0.00 sec) mysql\u0026gt; SHOW VARIABLES LIKE \u0026#39;character_set_server\u0026#39;; +----------------------+-------+ | Variable_name | Value | +----------------------+-------+ | character_set_server | utf8 | +----------------------+-------+ 1 row in set (0.00 sec) æ ¹æ®å„ä¸ªåˆ—çš„å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™æ˜¯ä»€ä¹ˆï¼Œä»è€Œæ ¹æ®è¿™ä¸ªåˆ—çš„ç±»å‹æ¥ç¡®è®¤æ¯ä¸ªåˆ—å­˜å‚¨çš„å®é™…æ•°æ®æ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´å¤§å°\n#ä¾‹å­ mysql\u0026gt; describe t; +-------+-------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-------------+------+-----+---------+-------+ | col | varchar(10) | YES | | NULL | | +-------+-------------+------+-----+---------+-------+ 1 row in set (0.01 sec) mysql\u0026gt; INSERT INTO t(col) VALUES(\u0026#39;æˆ‘æˆ‘\u0026#39;); Query OK, 1 row affected (0.01 sec) ## å¦‚æœåˆ—colä½¿ç”¨çš„å­—ç¬¦é›†æ˜¯gbkï¼Œåˆ™æ¯ä¸ªå­—ç¬¦å ç”¨2å­—èŠ‚ï¼Œä¸¤ä¸ªå­—ç¬¦å ç”¨4å­—èŠ‚ï¼›å¦‚æœåˆ—colä½¿ç”¨å­—ç¬¦é›†ä¸ºutf8ï¼Œåˆ™ä¸¤ä¸ªå­—ç¬¦å®é™…å ç”¨çš„å­˜å‚¨ç©ºé—´ä¸º6å­—èŠ‚ å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é€šä¿¡è¿‡ç¨‹ä¸­ä½¿ç”¨çš„å­—ç¬¦é›† # ç¼–ç å’Œè§£ç ä½¿ç”¨çš„å­—ç¬¦é›†ä¸ä¸€æ · # å­—ç¬¦é›†è½¬æ¢çš„æ¦‚å¿µ # â€œæˆ‘\u0026quot; utf8\u0026ndash;\u0026gt; ç¼–ç æˆ0xE68891\næ¥æ”¶åˆ°0xE68891åï¼Œå¯¹å®ƒè§£ç ï¼Œç„¶ååˆæŒ‰ç…§GBKå­—ç¬¦é›†ç¼–ç ï¼Œç¼–ç åæ˜¯0xCED2ã€‚è¿‡ç¨‹ç§°ä¸º**â€å­—ç¬¦é›†çš„è½¬æ¢â€œ**\nMySQLä¸­å­—ç¬¦é›†è½¬æ¢è¿‡ç¨‹ # ä»ç”¨æˆ·è§’åº¦ï¼Œå®¢æˆ·å‘é€è¯·æ±‚å’ŒæœåŠ¡å™¨è¿”å›å“åº”éƒ½æ˜¯å­—ç¬¦ä¸²ï¼›ä»æœºå™¨è§’åº¦ï¼Œå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚å’ŒæœåŠ¡ç«¯è¿”å›çš„å“åº”æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå­—èŠ‚åºåˆ—ï¼Œè¿™ä¸ªè¿‡ç¨‹ç»å†äº†å¤šæ¬¡çš„å­—ç¬¦é›†è½¬æ¢\nå®¢æˆ·ç«¯å‘é€è¯·æ±‚ # #æŸ¥çœ‹å½“å‰ç³»ç»Ÿä½¿ç”¨çš„å­—ç¬¦é›† #linux #ä»¥ç¬¬ä¸€ä¸ªä¼˜å…ˆï¼Œæ²¡æœ‰ä¾æ¬¡å¾€ä¸‹å– â–¶ echo $LC_ALL root@centos7101:~ â–¶ echo $LC_CTYPE root@centos7101:~ â–¶ echo $LANG zh_CN.UTF-8 #window C:\\Users\\ly\u0026gt;chcp æ´»åŠ¨ä»£ç é¡µ: 936 -\u0026gt; GBK windowsä¸­ï¼Œä½¿ç”¨mysqlå®¢æˆ·ç«¯æ—¶ï¼Œå¯ä»¥ä½¿ç”¨mysql --default-character-set=utf8ï¼Œå®¢æˆ·ç«¯å°†ä»¥UTF-8å­—ç¬¦é›†å¯¹è¯·æ±‚çš„å­—ç¬¦ä¸²è¿›è¡Œç¼–ç \næœåŠ¡ç«¯æ¥æ”¶è¯·æ±‚ # æœåŠ¡ç«¯æ¥æ”¶åˆ°çš„åº”è¯¥æ˜¯ä¸€ä¸ªå­—èŠ‚åºåˆ—ï¼Œæ˜¯ç³»ç»Ÿå˜é‡character_set_clientä»£è¡¨çš„å­—ç¬¦é›†è¿›è¡Œç¼–ç åçš„å­—èŠ‚åºåˆ—\næ¯ä¸ªå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥åï¼ŒæœåŠ¡å™¨ä¼šä¸ºè¯¥å®¢æˆ·ç«¯ç»´æŠ¤ä¸€ä¸ªç‹¬ç«‹çš„character_set_clientå˜é‡ï¼Œæ˜¯SESSIONçº§åˆ«çš„ å®¢æˆ·ç«¯åœ¨ç¼–ç è¯·æ±‚å­—ç¬¦ä¸²æ—¶å®é™…ä½¿ç”¨çš„å­—ç¬¦é›†ï¼Œä¸æœåŠ¡å™¨åœ¨æ”¶åˆ°ä¸€ä¸ªå­—èŠ‚åºåˆ—åè®¤ä¸ºè¯¥åºåˆ—é‡‡ç”¨çš„ç¼–ç å­—ç¬¦é›†ï¼Œæ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„å­—ç¬¦é›†ã€‚è¦å°½é‡ä¿è¯è¿™ä¸¤ä¸ªå­—ç¬¦é›†æ˜¯ä¸€è‡´çš„ ä¾‹å­ï¼šå¦‚æœå®¢æˆ·ç«¯ç”¨çš„UTF8ç¼–ç \u0026quot;æˆ‘\u0026quot;ä¸º0xE68891ï¼Œå¹¶å‘ç»™æœåŠ¡ç«¯ï¼Œè€ŒæœåŠ¡ç«¯çš„character_set_client=latin1ï¼Œåˆ™æœåŠ¡ç«¯ä¼šç†è§£ä¸º\nå¦‚æœcharacter_set_clientå¯¹åº”çš„å­—ç¬¦é›†ä¸èƒ½è§£é‡Šè¯·æ±‚çš„å­—èŠ‚åºåˆ—ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å‘ç”Ÿè­¦å‘Š\nmysql\u0026gt; SET character_set_client =ascii; Query OK, 0 rows affected (0.00 sec) mysql\u0026gt; select \u0026#39;æˆ‘\u0026#39;; #utf8å°†å®ƒç¼–ç æˆäº†0xE68891å‘ç»™æœåŠ¡ç«¯ï¼Œè€ŒæœåŠ¡ç«¯ä»¥ASCIIå­—ç¬¦é›†è§£ç  +-----+ | ??? | +-----+ | ??? | +-----+ 1 row in set, 1 warning (0.00 sec) mysql\u0026gt; SHOW WARNINGS\\G *************************** 1. row *************************** Level: Warning Code: 1300 Message: Invalid ascii character string: \u0026#39;\\xE6\\x88\\x91\u0026#39; 1 row in set (0.00 sec) æœåŠ¡å™¨å¤„ç†è¯·æ±‚ # æœåŠ¡ç«¯ä¼šå°†è¯·æ±‚çš„å­—èŠ‚åºåˆ—å½“ä½œé‡‡ç”¨character_set_clientå¯¹åº”çš„å­—ç¬¦é›†è¿›è¡Œç¼–ç ï¼Œä¸è¿‡çœŸæ­£å¤„ç†è¯·æ±‚æ—¶ä¼šå°†å…¶è½¬æ¢ä¸ºSESSIONçº§åˆ«çš„ç³»ç»Ÿå˜é‡character_set_connectionå¯¹åº”çš„å­—ç¬¦é›†è¿›è¡Œç¼–ç çš„å­—ç¬¦åºåˆ—\nå‡è®¾character_set_client=utf8ï¼Œcharacter_set_connection=gbkï¼Œåˆ™å¯¹äº\u0026quot;æˆ‘\u0026quot;\u0026ndash;\u0026gt;0xE68891\u0026ndash;\u0026gt;0xCED2\næƒ…å½¢1 # ä¾‹å­ï¼š SELECT 'a' = 'A'\n#é»˜è®¤æƒ…å†µ mysql\u0026gt; SHOW VARIABLES LIKE \u0026#39;character_connection\u0026#39;; Empty set (0.00 sec) mysql\u0026gt; SHOW VARIABLES LIKE \u0026#39;collation_connection\u0026#39;; +----------------------+-----------------+ | Variable_name | Value | +----------------------+-----------------+ | collation_connection | utf8_general_ci | +----------------------+-----------------+ 1 row in set (0.00 sec) mysql\u0026gt; SELECT \u0026#39;A\u0026#39;=\u0026#39;a\u0026#39;; +---------+ | \u0026#39;A\u0026#39;=\u0026#39;a\u0026#39; | +---------+ | 1 | +---------+ 1 row in set (0.00 sec) å…¶ä»–æƒ…å†µï¼š\nmysql\u0026gt; SET character_set_connection = gbk; Query OK, 0 rows affected (0.00 sec) mysql\u0026gt; SET collation_connection=gbk_chinese_ci; Query OK, 0 rows affected (0.00 sec) mysql\u0026gt; SELECT \u0026#39;a\u0026#39;=\u0026#39;A\u0026#39;; +---------+ | \u0026#39;a\u0026#39;=\u0026#39;A\u0026#39; | +---------+ | 1 | +---------+ 1 row in set (0.00 sec) å¦ä¸€ç§æƒ…å†µï¼š\nmysql\u0026gt; SET character_set_connection = gbk; Query OK, 0 rows affected (0.00 sec) mysql\u0026gt; SET collation_connection=gbk_bin; Query OK, 0 rows affected (0.00 sec) mysql\u0026gt; SELECT \u0026#39;a\u0026#39;=\u0026#39;A\u0026#39;; +---------+ | \u0026#39;a\u0026#39;=\u0026#39;A\u0026#39; | +---------+ | 0 | +---------+ 1 row in set (0.00 sec) gbk_bin ç®€ä½“ä¸­æ–‡, äºŒè¿›åˆ¶ gbk_chinese_ci ç®€ä½“ä¸­æ–‡, ä¸åŒºåˆ†å¤§å°å†™\næƒ…å½¢2 # #åˆ›å»ºä¸€ä¸ªè¡¨ CREATE TABLE tt(c VARCHAR(100)) ENGINE=INNODB CHARSET=utf8; #å…ˆæ”¹å›æ¥ mysql\u0026gt; SET character_set_connection = utf8; Query OK, 0 rows affected (0.00 sec) mysql\u0026gt; SHOW VARIABLES LIKE \u0026#39;collation_connection\u0026#39;; +----------------------+-----------------+ | Variable_name | Value | +----------------------+-----------------+ | collation_connection | utf8_general_ci | +----------------------+-----------------+ 1 row in set (0.00 sec) #æ’å…¥ä¸€æ¡è®°å½• INSERT INTO tt(c) VALUES(\u0026#39;æˆ‘\u0026#39;); å½“å‰æ•°æ®åº“ã€è¡¨ã€åˆ—ä½¿ç”¨çš„æ˜¯utf8ï¼Œç°åœ¨æŠŠcollectionæ”¹ä¸ºgbkï¼š\nmysql\u0026gt; SET character_set_connection = gbk; Query OK, 0 rows affected (0.00 sec) mysql\u0026gt; SET collation_connection=gbk_chinese_ci; Query OK, 0 rows affected (0.00 sec) mysql\u0026gt; SELECT * FROM tt WHERE c=\u0026#39;æˆ‘\u0026#39;; +------+ | c | +------+ | æˆ‘ | +------+ 1 row in set (0.00 sec) æ­¤æ—¶SELECT * FROM tt WHERE c='æˆ‘';ä¸­ï¼Œ\u0026lsquo;æˆ‘\u0026rsquo;æ˜¯ä½¿ç”¨gbkå­—ç¬¦é›†è¿›è¡Œç¼–ç çš„ï¼Œæ¯”è¾ƒè§„åˆ™æ˜¯gbk_chinese_ciï¼›è€Œåˆ—cä½¿ç”¨utf8å­—ç¬¦é›†ç¼–ç ï¼Œæ¯”è¾ƒè§„åˆ™ä¸ºutf8_general_ciã€‚è¿™ç§æƒ…å†µä¸‹åˆ—çš„å­—ç¬¦é›†å’Œæ’åºè§„åˆ™çš„ä¼˜å…ˆçº§æ›´é«˜ï¼Œä¼šå°†gbkå­—ç¬¦é›†è½¬æ¢æˆutf8å­—ç¬¦é›†ï¼Œç„¶åä½¿ç”¨åˆ—cçš„æ¯”è¾ƒè§„åˆ™utf8_general_ciè¿›è¡Œæ¯”è¾ƒ\næœåŠ¡å™¨ç”Ÿæˆå“åº” # ç»§ç»­ä»¥æœ€è¿‘çš„ä¸Šé¢ä¾‹å­ä¸ºä¾‹SELECT * FROM tt,æ˜¯å¦æ˜¯ç›´æ¥å°†0xE68891è¯»å‡ºæ¥å‘é€åˆ°å®¢æˆ·ç«¯å‘¢ï¼Ÿä¸æ˜¯çš„ï¼Œå–å†³äºSESSIONçº§åˆ«çš„ç³»ç»Ÿå˜é‡character_set_resultçš„å€¼\nSET character_set_results=gbk; æœåŠ¡å™¨ä¼šå°†å­—ç¬¦ä¸²\u0026rsquo;æˆ‘\u0026rsquo;ä»utf8å­—ç¬¦é›†ç¼–ç çš„0xE68891è½¬æ¢ä¸ºcharacter_set_resultsç³»ç»Ÿå˜é‡å¯¹åº”çš„å­—ç¬¦é›†ç¼–ç åçš„å­—èŠ‚åºåˆ—ï¼Œå†å‘ç»™å®¢æˆ·ç«¯\næ­¤æ—¶ä¼ ç»™å®¢æˆ·ç«¯çš„å“åº”ä¸­ï¼Œå­—ç¬¦ä¸²\u0026rsquo;æˆ‘\u0026rsquo;å¯¹åº”çš„å°±æ˜¯å­—èŠ‚åºåˆ—0xCED2(\u0026lsquo;æˆ‘\u0026rsquo;çš„gbkç¼–ç å­—èŠ‚åºåˆ—)\næ€»ç»“ # æ¯ä¸ªå®¢æˆ·ç«¯åœ¨æœåŠ¡å™¨å»ºç«‹è¿æ¥åï¼ŒæœåŠ¡å™¨éƒ½ä¼šä¸ºè¿™ä¸ªè¿æ¥ç»´æŠ¤è¿™3ä¸ªå˜é‡\næ¯ä¸ªMySQLå®¢æˆ·ç«¯éƒ½ç»´æŠ¤ç€ä¸€ä¸ªå®¢æˆ·ç«¯é»˜è®¤å­—ç¬¦é›†ï¼Œå®¢æˆ·ç«¯åœ¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ£€æµ‹æ‰€åœ¨ç³»ç»Ÿ(æ˜¯å®¢æˆ·ç«¯æ‰€åœ¨ç³»ç»Ÿ)å½“å‰ä½¿ç”¨çš„å­—ç¬¦é›†ï¼Œå¹¶æŒ‰ç…§ä¸€å®šè§„åˆ™æ˜ å°„æˆï¼ˆæœ€æ¥è¿‘ï¼‰MySQLæ”¯æŒçš„å­—ç¬¦é›†ï¼Œç„¶åå°†è¯¥å­—ç¬¦é›†ä½œä¸ºå®¢æˆ·ç«¯é»˜è®¤çš„å­—ç¬¦é›†ã€‚\nå¦‚æœå¯åŠ¨MySQLå®¢æˆ·ç«¯æ—¶è®¾ç½®äº†default-character-set åˆ™å¿½ç•¥æ“ä½œç³»ç»Ÿå½“å‰ä½¿ç”¨çš„å­—ç¬¦é›†ï¼Œç›´æ¥å°†default-character-setå¯åŠ¨é€‰é¡¹ä¸­æŒ‡å®šçš„å€¼ä½œä¸ºå®¢æˆ·ç«¯é»˜è®¤å­—ç¬¦é›†\nè¿æ¥æœåŠ¡å™¨æ—¶ï¼Œå®¢æˆ·ç«¯å°†é»˜è®¤çš„å­—ç¬¦é›†ä¿¡æ¯ä¸ç”¨æˆ·å¯†ç ç­‰å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯åœ¨æ”¶åˆ°åä¼šå°†character_set_clientã€character_set_connectionã€character_set_resultsè¿™3ä¸ªç³»ç»Ÿå˜é‡çš„å€¼åˆå§‹åŒ–ä¸ºå®¢æˆ·ç«¯çš„é»˜è®¤å­—ç¬¦é›†\nå®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨SETåˆ†åˆ«ä¿®æ”¹character_set_clientã€character_set_connectionã€character_set_resultsè¿™3ä¸ªç³»ç»Ÿå˜é‡çš„å€¼(æˆ–è€…ä½¿ç”¨SET NAMES charset_nameä¸€æ¬¡æ€§ä¿®æ”¹)\nä¸ä¼šæ”¹å˜å®¢æˆ·ç«¯åœ¨ç¼–ç è¯·æ±‚å­—ç¬¦ä¸²æ—¶ä½¿ç”¨çš„å­—ç¬¦é›†ï¼Œä¹Ÿä¸ä¼šä¿®æ”¹å®¢æˆ·ç«¯çš„é»˜è®¤å­—ç¬¦é›†\nå®¢æˆ·ç«¯æ¥æ”¶åˆ°è¯·æ±‚ # å®¢æˆ·ç«¯æ”¶åˆ°çš„å“åº”å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªå­—èŠ‚åºåˆ—\nå¯¹äºç±»UNIXç³»ç»Ÿï¼Œæ”¶åˆ°çš„å­—èŠ‚åºåˆ—ç›¸å½“äºå†™åˆ°é»‘æ¡†æ¡†ä¸­ï¼Œå†ç”±é»‘æ¡†æ¡†å°†è¿™ä¸ªå­—èŠ‚åºåˆ—è§£é‡Šä¸ºäººç±»èƒ½çœ‹æ‡‚çš„å­—ç¬¦ï¼ˆç”¨æ“ä½œç³»ç»Ÿå½“å‰ä½¿ç”¨çš„å­—ç¬¦é›†æ¥è§£é‡Šï¼‰ï¼›å¯¹äºWindowsï¼Œå®¢æˆ·ç«¯ä½¿ç”¨å®¢æˆ·ç«¯çš„é»˜è®¤å­—ç¬¦é›†æ¥è§£é‡Š\nä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨linuxä¸‹æŒ‡å®šçš„default-character-setå’Œç³»ç»Ÿä¸ä¸€è‡´ï¼Œå°±ä¼šå¯¼è‡´ä¹±ç \næ•´ä¸ªè¿‡ç¨‹ï¼Œäº”ä»¶äº‹ï¼š\nå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚å­—èŠ‚åºåˆ—æ˜¯é‡‡ç”¨å“ªç§å­—ç¬¦é›†è¿›è¡Œç¼–ç çš„ [ç”±å®¢æˆ·ç«¯å¯åŠ¨é€‰é¡¹\u0026ndash;default-character-set/å…¶æ¬¡æ˜¯ç³»ç»Ÿé»˜è®¤çš„(linuxå¯èƒ½æ˜¯utf-8/windowså¯èƒ½æ˜¯gbk)] æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚å­—èŠ‚åºåˆ—åä¼šè®¤ä¸ºå®ƒæ˜¯é‡‡ç”¨å“ªç§å­—ç¬¦é›†è¿›è¡Œç¼–ç çš„[ç”±character_set_clientå†³å®šï¼Œè€Œcharacter_set_client[è¿˜æœ‰character_set_connectionã€character_set_resultsè¿™2ä¸ªç³»ç»Ÿå˜é‡]çš„å€¼åˆå§‹åŒ–ä¸ºå®¢æˆ·ç«¯çš„é»˜è®¤å­—ç¬¦é›†ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢1ä¸­çš„] æœåŠ¡å™¨åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šæŠŠè¯·æ±‚çš„å­—ç¬¦åºåˆ—è½¬æ¢ä¸ºä»¥å“ªç§å­—ç¬¦é›†ç¼–ç çš„å­—èŠ‚åºåˆ—[character_set_connection] æœåŠ¡å™¨åœ¨å‘å®¢æˆ·ç«¯è¿”å›å­—èŠ‚åºåˆ—æ—¶ï¼Œæ˜¯é‡‡ç”¨å“ªç§å­—ç¬¦é›†è¿›è¡Œç¼–ç çš„[character_set_results] ä¸Šé¢çš„character_set_clienã€character_set_connectionã€character_set_resultsè¿™3ä¸ªç³»ç»Ÿå˜é‡]çš„å€¼åœ¨å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡ç«¯ä¹‹åï¼Œéƒ½æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œä¸”éƒ½æ˜¯SESSIONçº§åˆ«çš„ å®¢æˆ·ç«¯åœ¨æ¥æ”¶åˆ°å“åº”å­—èŠ‚åºåˆ—åï¼Œæ˜¯æ€ä¹ˆæŠŠä»–ä»¬å†™åˆ°é»‘æ¡†æ¡†ä¸­çš„[windowsä¸­ç”±default-character-set/å…¶æ¬¡æ˜¯ç³»ç»Ÿé»˜è®¤] æ¯”è¾ƒè§„åˆ™çš„åº”ç”¨ # é€šå¸¸ç”¨æ¥æ¯”è¾ƒå¤§å°å’Œæ’åº\nä¾‹å­ï¼š\nmysql\u0026gt; CREATE TABLE t(col VARCHAR(100)) ENGINE=INNODB CHARSET=gbk; Query OK, 0 rows affected (0.02 sec) mysql\u0026gt; INSERT INTO t(col) VALUES(\u0026#39;a\u0026#39;),(\u0026#39;b\u0026#39;),(\u0026#39;A\u0026#39;),(\u0026#39;B\u0026#39;); Query OK, 4 rows affected (0.01 sec) Records: 4 Duplicates: 0 Warnings: 0 mysql\u0026gt; SELECT * FROM t ORDER BY col; +------+ | col | +------+ | a | | A | | b | | B | | æˆ‘ | +------+ 5 rows in set (0.00 sec) # å¦‚ä¸Šï¼Œæ’åºè§„åˆ™gbk_chinese_ciæ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ # ä¿®æ”¹ä¸ºgbk_bin; mysql\u0026gt; ALTER TABLE t MODIFY col VARCHAR(10) COLLATE gbk_bin; Query OK, 5 rows affected (0.06 sec) Records: 5 Duplicates: 0 Warnings: 0 mysql\u0026gt; SELECT * FROM t ORDER BY col; +------+ | col | +------+ | A | | B | | a | | b | | æˆ‘ | +------+ 5 rows in set (0.00 sec) è§£é‡Šï¼š\nåˆ—colå„ä¸ªå­—ç¬¦åœ¨ä½¿ç”¨gbkå­—ç¬¦é›†ç¼–ç åå¯¹åº”çš„æ•°å­—å¦‚ä¸‹ï¼š\n\u0026lsquo;A\u0026rsquo; -\u0026gt; 65\n\u0026lsquo;B\u0026rsquo;-\u0026gt;66\n\u0026lsquo;a\u0026rsquo;-\u0026gt;97\n\u0026lsquo;b\u0026rsquo;-\u0026gt;98\n\u0026lsquo;æˆ‘\u0026rsquo;-\u0026gt;52946\n"},{"id":41,"href":"/zh/docs/study/MySQL/how_mysql_run/02/","title":"02å¯åŠ¨é€‰é¡¹å’Œç³»ç»Ÿå˜é‡","section":"_MySQLæ˜¯æ€æ ·è¿è¡Œçš„_","content":" å­¦ä¹ ã€ŠMySQLæ˜¯æ€æ ·è¿è¡Œçš„ã€‹ï¼Œæ„Ÿè°¢ä½œè€…ï¼\nå¯åŠ¨é€‰é¡¹å’Œé…ç½®æ–‡ä»¶ # åœ¨ç¨‹åºå¯åŠ¨æ—¶æŒ‡å®šçš„è®¾ç½®é¡¹ï¼Œä¹Ÿç§°ä¹‹ä¸ºå¯åŠ¨é€‰é¡¹startup optionï¼ˆå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­/é…ç½®æ–‡ä»¶ä¸­ æŒ‡å®šï¼‰\nç”±äºåœ¨centos7ä¸­ä½¿ç”¨systemctl start mysqldå¯åŠ¨mysqlï¼Œæ‰€ä»¥å¥½åƒæ²¡æ³•ç”¨å‘½ä»¤è¡ŒæŒ‡å®šå¯åŠ¨é€‰é¡¹äº†\nç¨‹åº(å¯èƒ½æœ‰äº›ç¨‹åºæ–°ç‰ˆæœ¬å·²ç»æ²¡æœ‰äº†)çš„å¯¹åº”ç±»åˆ«å’Œèƒ½è¯»å–çš„ç»„ï¼š\nè¿™é‡Œè®²é…ç½®æ–‡ä»¶çš„æ–¹å¼è®¾ç½®å¯åŠ¨é€‰é¡¹ï¼š\n#æ·»åŠ é…ç½® vim /etc/my.cnf [server] skip-networking #ç¦æ­¢tcpç½‘ç»œè¿æ¥ default-storage-engine=MyISAM #å»ºè¡¨é»˜è®¤ä½¿ç”¨Mæœ‰ISAMå­˜å‚¨å¼•æ“ #æ•ˆæœ â–¶ mysql -h127.0.0.1 -uroot -p Enter password: ERROR 2003 (HY000): Can\u0026#39;t connect to MySQL server on \u0026#39;127.0.0.1\u0026#39; (111) #å»é™¤tcpç½‘ç»œè¿æ¥é™åˆ¶åæ–°å»ºä¸€ä¸ªè¡¨ â–¶ mysql -h127.0.0.1 -uroot -p #å¯ä»¥è¿æ¥ä¸Š mysql\u0026gt; create table default_storage_engine_demo(i int); Query OK, 0 rows affected (0.01 sec) mysql\u0026gt; show create table default_storage_engine_demo; +-----------------------------+----------------------------------------------------------------------------------------------------------------+ | Table | Create Table | +-----------------------------+----------------------------------------------------------------------------------------------------------------+ | default_storage_engine_demo | CREATE TABLE `default_storage_engine_demo` ( `i` int(11) DEFAULT NULL ) ENGINE=MyISAM DEFAULT CHARSET=latin1 | å¦‚æœå¤šä¸ªé…ç½®æ–‡ä»¶éƒ½é…ç½®äº†æŸä¸ªé€‰é¡¹ï¼Œå¦‚/etc/my.cnf /etc/mysql/my.cnf /usr/etc/my.cnf ~/.my.cnféƒ½é…ç½®äº†ï¼Œåˆ™ä»¥æœ€åä¸€ä¸ªé…ç½®çš„ä¸ºä¸»\nå¦‚æœåŒä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚[server]ç»„å’Œ[mysqld]ç»„éƒ½å‡ºç°äº†default-storage-engineé…ç½®ï¼Œåˆ™ä»¥åå‡ºç°çš„ç»„ä¸­çš„é…ç½®ä¸ºå‡†\nå¦‚æœä¸€ä¸ªå¯åŠ¨é€‰é¡¹æ—¢åœ¨å‘½ä»¤è¡Œä¸­å‡ºç°ï¼Œåˆåœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼Œåˆ™ä»¥å‘½ä»¤è¡Œä¸­çš„ä¸ºå‡†\nç³»ç»Ÿå˜é‡ # æŸ¥çœ‹ç³»ç»Ÿå˜é‡\nmysql\u0026gt; SHOW VARIABLES LIKE \u0026#39;default_storage_engine\u0026#39;; +------------------------+--------+ | Variable_name | Value | +------------------------+--------+ | default_storage_engine | InnoDB | +------------------------+--------+ 1 row in set (0.00 sec) mysql\u0026gt; SHOW VARIABLES LIKE \u0026#39;default%\u0026#39;; +-------------------------------+-----------------------+ | Variable_name | Value | +-------------------------------+-----------------------+ | default_authentication_plugin | mysql_native_password | | default_password_lifetime | 0 | | default_storage_engine | InnoDB | | default_tmp_storage_engine | InnoDB | | default_week_format | 0 | +-------------------------------+-----------------------+ 5 rows in set (0.00 sec) mysql\u0026gt; SHOW VARIABLES LIKE \u0026#39;max_connections\u0026#39;; +-----------------+-------+ | Variable_name | Value | +-----------------+-------+ | max_connections | 151 | +-----------------+-------+ 1 row in set (0.00 sec) å¤§éƒ¨åˆ†ç³»ç»Ÿå˜é‡ï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€ä¿®æ”¹è€Œæ— é¡»åœæ­¢å¹¶é‡å¯æœåŠ¡å™¨\nä¸åŒä½œç”¨èŒƒå›´çš„ç³»ç»Ÿå˜é‡\nGLOBALï¼ˆå…¨å±€èŒƒå›´ï¼‰ï¼šå½±å“æœåŠ¡å™¨çš„æ•´ä½“æ“ä½œ\nSESSIONï¼ˆä¼šè¯èŒƒå›´ï¼‰ï¼šå½±å“æŸä¸ªå®¢æˆ·ç«¯è¿æ¥çš„æ“ä½œ\nè®©ä¹‹åæ–°è¿æ¥åˆ°æœåŠ¡å™¨çš„å®¢æˆ·ç«¯éƒ½ç”¨MyISAMä½œä¸ºé»˜è®¤çš„å­˜å‚¨å¼•æ“\n#ä¸ä¼šå¯¹è¿™ä¹‹å‰å·²è¿æ¥çš„å®¢æˆ·ç«¯äº§ç”Ÿå½±å“ SET GLOBAL default_storage_engine=MyISAM; #systemctl restart mysqldæ—¶å€™ï¼Œè¯¥é…ç½®å°±å¤±æ•ˆäº† åªå¯¹æœ¬å®¢æˆ·ç«¯ä½¿ç”¨\nSET SESSION default_storage_engine=MyISAM;#æˆ– SET default_storage_engine=MyISAM; æŸ¥çœ‹ç³»ç»Ÿå˜é‡\nSHOW [GLOBAL|SESSION] VARIABLES [LIKE \u0026#39;åŒ¹é…çš„æ¨¡å¼\u0026#39;]; çŠ¶æ€å˜é‡ # çŠ¶æ€å˜é‡ç”¨æ¥æ˜¾ç¤ºæœåŠ¡å™¨ç¨‹åºè¿è¡ŒçŠ¶æ€\nçŠ¶æ€å˜é‡ä¹Ÿåˆ†GLOBAL|SESSION\nSHOW [GLOBAL|SESSION] STATUS [LIKE åŒ¹é…çš„æ¨¡å¼];\nmysql\u0026gt; SHOW STATUS LIKE \u0026#39;thread%\u0026#39;; +-------------------+-------+ | Variable_name | Value | +-------------------+-------+ | Threads_cached | 0 | | Threads_connected | 2 | | Threads_created | 2 | | Threads_running | 1 | +-------------------+-------+ "},{"id":42,"href":"/zh/docs/study/MySQL/how_mysql_run/01/","title":"01åˆè¯†MySQL","section":"_MySQLæ˜¯æ€æ ·è¿è¡Œçš„_","content":" å­¦ä¹ ã€ŠMySQLæ˜¯æ€æ ·è¿è¡Œçš„ã€‹ï¼Œæ„Ÿè°¢ä½œè€…ï¼\nåŸæ–‡ # ä¸‹è½½ä¸å®‰è£… # ç¯å¢ƒCentos7\næ·»åŠ MySQL5.7ä»“åº“\nsudo rpm -ivh https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm è§£å†³è¯ä¹¦é—®é¢˜\nrpm --import https://repo.mysql.com/RPM-GPG-KEY-mysql-2022 æŸ¥çœ‹æ˜¯å¦æ·»åŠ æˆåŠŸ\nsudo yum repolist all | grep mysql | grep å¯ç”¨ mysql-connectors-community/x86_64 MySQL Connectors Community å¯ç”¨: 213 mysql-tools-community/x86_64 MySQL Tools Community å¯ç”¨: 96 mysql57-community/x86_64 MySQL 5.7 Community Server å¯ç”¨: 642 MySQLå®‰è£…\nsudo yum -y install mysql-community-server è¿è¡Œä¸å¯†ç ä¿®æ”¹ # Centos7ä¸­å®‰è£…ç›®å½•æŸ¥çœ‹ï¼Œåœ¨/usr/binä¸­ï¼Œä¸Maxæœ‰æ‰€ä¸åŒ\nwhereis mysql mysql: /usr/bin/mysql /usr/lib64/mysql /usr/share/mysql /usr/share/man/man1/mysql.1.gz ls /usr/bin |grep mysql mysql mysqladmin mysqlbinlog mysqlcheck mysql_config_editor mysqld_pre_systemd mysqldump mysqldumpslow mysqlimport mysql_install_db mysql_plugin mysqlpump mysql_secure_installation mysqlshow mysqlslap mysql_ssl_rsa_setup mysql_tzinfo_to_sql mysql_upgrade æ·»åŠ mysqldç›®å½•åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼ˆè¿™é‡Œå¯çœç•¥ï¼Œå› ä¸ºmysqldé»˜è®¤åœ¨/usr/binä¸­äº†\nå¯åŠ¨MySQL(å’Œä¹¦ä¸Šè¯´çš„å¯åŠ¨æ–¹å¼æœ‰ç‚¹ä¸ä¸€æ ·ï¼ŒæŸ¥èµ„æ–™å¾—çŸ¥ï¼Œä»5.7.6èµ·ï¼Œä¸å†æ”¯æŒmysql_safeçš„å¯åŠ¨æ–¹å¼)\n# å¯åŠ¨MySQL root@centos7101:~ â–¶ systemctl start mysqld # æŸ¥çœ‹MySQLçŠ¶æ€ root@centos7101:~ â–¶ systemctl status mysqld â— mysqld.service - MySQL Server Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled) Active: active (running) since ä¸€ 2023-04-17 11:43:42 CST; 19s ago Docs: man:mysqld(8) http://dev.mysql.com/doc/refman/en/using-systemd.html Main PID: 2182 (mysqld) CGroup: /system.slice/mysqld.service â””â”€2182 /usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid 4æœˆ 17 11:43:37 centos7101 systemd[1]: Starting MySQL Server... 4æœˆ 17 11:43:42 centos7101 systemd[1]: Started MySQL Server. # è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨ root@centos7101:~ â–¶ systemctl enable mysqld æŸ¥çœ‹MySQLé»˜è®¤å¯†ç \ncat /var/log/mysqld.log |grep -i \u0026#39;temporary password\u0026#39; 2023-04-17T03:43:38.995935Z 1 [Note] A temporary password is generated for root@localhost: ampddi9+fpyQ è¿æ¥\nmysql -uroot -p123456 #æˆ–è€… mysql -uroot -p #æˆ–è€… mysql -hlocalhost -uroot -p123456 ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œä¿®æ”¹å¯†ç ä¸º123456\n# ä¿®æ”¹å¯†ç å¼ºåº¦ set global validate_password_policy=LOW; #ä¿®æ”¹å¯†ç é•¿åº¦ set global validate_password_length=6; #ä¿®æ”¹å¯†ç  ALTER USER \u0026#39;root\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED BY \u0026#39;123456\u0026#39;; #åˆ·æ–°æƒé™ flush privileges; é€€å‡º\nquit #æˆ–è€… exit #æˆ–è€… \\q å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¿æ¥è¿‡ç¨‹ # é‡‡ç”¨TCPä½œä¸ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„ç½‘ç»œé€šä¿¡åè®®\nè¿œç¨‹è¿æ¥å‰æ\n#æ·»åŠ ä¸€ä¸ªè¿œç¨‹ç”¨æˆ· CREATE USER \u0026#39;root\u0026#39;@\u0026#39;%\u0026#39; IDENTIFIED BY \u0026#39;123456.\u0026#39;; grant all on *.* to \u0026#39;root\u0026#39;@\u0026#39;%\u0026#39; identified by \u0026#34;123456.\u0026#34; with grant option; #ä¿®æ”¹ç”¨æˆ·å¯†ç  SET PASSWORD FOR \u0026#39;root\u0026#39;@\u0026#39;host\u0026#39; = password(\u0026#39;123456.\u0026#39;); ç«¯å£å·ä¿®æ”¹ä¸è¿œç¨‹è¿æ¥\n#ä¿®æ”¹MySQLå¯åŠ¨çš„ç«¯å£ vim /etc/my.cnf [mysqld] port=33062 #æ–°å¢è¯¥è¡Œå³å¯ #é‡å¯ systemctl restart mysqld #æŸ¥çœ‹çŠ¶æ€ systemctl status mysqld #æŸ¥çœ‹æœåŠ¡æ˜¯å¦å¯åŠ¨ netstat -lntup |grep mysql tcp6 0 0 :::33062 :::* LISTEN 4612/mysqld #è¿œç¨‹è¿æ¥ mysql -hnode2 -uroot -P33062 -p å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚\nå¸¸ç”¨å­˜å‚¨å¼•æ“ï¼šInnodbå’ŒMyISAM\næŸ¥çœ‹å½“å‰æœåŠ¡å™¨æ”¯æŒçš„å­˜å‚¨å¼•æ“\nåªæœ‰InnoDBæ˜¯æ”¯æŒäº‹åŠ¡çš„ä¸”æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡ã€éƒ¨åˆ†å›æ»š\nå­˜å‚¨å¼•æ“æ˜¯è´Ÿè´£å¯¹è¡¨ä¸­æ•°æ®è¿›è¡Œè¯»å–å’Œå†™å…¥çš„\n-- åˆ›å»ºè¡¨æ—¶æŒ‡å®šå­˜å‚¨å¼•æ“ CREATE TABLE engine_demo_table(i int) ENGINE = MyISAM -- æŸ¥çœ‹å»ºè¡¨è¯­å¥ mysql\u0026gt; SHOW CREATE TABLE engine_demo_table \\G *************************** 1. row *************************** Table: engine_demo_table Create Table: CREATE TABLE `engine_demo_table` ( `i` int(11) DEFAULT NULL ) ENGINE=MyISAM DEFAULT CHARSET=latin1 1 row in set (0.00 sec) -- ä¿®æ”¹å»ºè¡¨æ—¶æŒ‡å®šçš„å­˜å‚¨å¼•æ“ ALTER TABLE engine_demo_table ENGINE=InnoDB -- ä¿®æ”¹ç¼–ç  ALTER TABLE engine_demo_table CHARSET=UTF8 "},{"id":43,"href":"/zh/docs/study/Redis/redis-cluster/","title":"redisé›†ç¾¤æ­å»º","section":"Redis","content":" è½¬è½½è‡ªhttps://www.cnblogs.com/Yunya-Cnblogs/p/14608937.htmlï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\néƒ¨åˆ†å‚è€ƒè‡ª https://www.cnblogs.com/ysocean/p/12328088.html\nåŸºæœ¬å‡†å¤‡ # æ¶æ„ # é‡‡ç”¨Centos7ï¼ŒRedisç‰ˆæœ¬ä¸º6.2ï¼Œæ¶æ„å¦‚ä¸‹ï¼š\nhostsä¿®æ”¹ # vim /etc/hosts #æ·»åŠ  192.168.1.101 node1 192.168.1.102 node2 192.168.1.103 node3 é›†ç¾¤å‡†å¤‡ # å¯¹æ¯ä¸ªèŠ‚ç‚¹ # ä¸‹è½½rediså¹¶è§£å‹åˆ° /usr/local/redis-clusterä¸­\ncd /usr/local mkdir redis-cluster tar -zxvf redis* -C /usr/local/redis* è¿›å…¥redisæ ¹ç›®å½•\nmake make install å®‰è£…å®Œæ¯•\nhostsä¿®æ”¹\nvim /etc/hosts #æ·»åŠ  192.168.1.101 node1 192.168.1.102 node2 192.168.1.103 node3 é…ç½®æ–‡ä»¶ä¿®æ”¹(6ä¸ªèŠ‚ç‚¹ä¸­çš„æ¯ä¸€ä¸ª) # åˆ›å»ºå¤šçº§ç›®å½•\nmkdir -p /usr/local/redis_cluster/redis_63{79,80}/{conf,pid,logs} ç¼–å†™é…ç½®æ–‡ä»¶\nvim /usr/local/redis_cluster/redis_6379/conf/redis.conf # å‘½ä»¤è¡ŒçŠ¶æ€ä¸‹è¾“å…¥ :%d å›è½¦ï¼Œæ¸…ç©ºæ–‡ä»¶ # å†è¾“å…¥ :set paste å¤„ç†å¤šå‡ºçš„è¡Œå¸¦#çš„é—®é¢˜ # å†è¾“å…¥i ####å†…å®¹##### # å¿«é€Ÿä¿®æ”¹ï¼š:%s/6379/6380/g # å®ˆæŠ¤è¿›è¡Œæ¨¡å¼å¯åŠ¨ daemonize yes # è®¾ç½®æ•°æ®åº“æ•°é‡ï¼Œé»˜è®¤æ•°æ®åº“ä¸º0 databases 16 # ç»‘å®šåœ°å€ï¼Œéœ€è¦ä¿®æ”¹ # bind 192.168.1.101 bind node1 # ç»‘å®šç«¯å£ï¼Œéœ€è¦ä¿®æ”¹ port 6379 # pidæ–‡ä»¶å­˜å‚¨ä½ç½®ï¼Œæ–‡ä»¶åéœ€è¦ä¿®æ”¹ pidfile /usr/local/redis_cluster/redis_6379/pid/redis_6379.pid # logæ–‡ä»¶å­˜å‚¨ä½ç½®ï¼Œæ–‡ä»¶åéœ€è¦ä¿®æ”¹ logfile /usr/local/redis_cluster/redis_6379/logs/redis_6379.log # RDBå¿«ç…§å¤‡ä»½æ–‡ä»¶åï¼Œæ–‡ä»¶åéœ€è¦ä¿®æ”¹ dbfilename redis_6379.rdb # æœ¬åœ°æ•°æ®åº“å­˜å‚¨ç›®å½•ï¼Œéœ€è¦ä¿®æ”¹ dir /usr/local/redis_cluster/redis_6379 # é›†ç¾¤ç›¸å…³é…ç½® # æ˜¯å¦ä»¥é›†ç¾¤æ¨¡å¼å¯åŠ¨ cluster-enabled yes # é›†ç¾¤èŠ‚ç‚¹å›åº”æœ€é•¿æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´è¢«è®¤ä¸ºä¸‹çº¿ cluster-node-timeout 15000 # ç”Ÿæˆçš„é›†ç¾¤èŠ‚ç‚¹é…ç½®æ–‡ä»¶åï¼Œæ–‡ä»¶åéœ€è¦ä¿®æ”¹ cluster-config-file nodes_6379.conf å¤åˆ¶ç²˜è´´é…ç½®æ–‡ä»¶\ncp /usr/local/redis_cluster/redis_6379/conf/redis.conf /usr/local/redis_cluster/redis_6380/conf/redis.conf vim /usr/local/redis_cluster/redis_6380/conf/redis.conf #å‘½ä»¤è¡Œæ¨¡å¼ä¸‹ :%s/6379/6380/g æŸ¥çœ‹æ–‡ä»¶å¤¹å½“å‰æƒ…å†µ\nè¿è¡Œ # æŸ¥çœ‹ç«¯å£æ˜¯å¦è¿è¡Œ\nnetstat -lntup | grep 6379 è¿è¡Œ\nredis-server /usr/local/redis_cluster/redis_6379/conf/redis.conf \u0026amp; redis-server /usr/local/redis_cluster/redis_6380/conf/redis.conf \u0026amp; ç»“æœ\nnetstat -lntup |grep 6379 tcp 0 0 192.168.1.101:6379 0.0.0.0:* LISTEN 6538/redis-server 1 tcp 0 0 192.168.1.101:16379 0.0.0.0:* LISTEN 6538/redis-server 1 #+10000ç«¯å£å‡ºç°ï¼Œè¯´æ˜é›†ç¾¤å„ä¸ªèŠ‚ç‚¹ä¹‹é—´å¯ä»¥äº’ç›¸é€šä¿¡ ç»“æœ\ncat *6379/pid/*pid* 6538 ##å°±æ˜¯ä¸Šé¢çš„è¿›ç¨‹id cat *6379/logs/*log 6538:C 14 Apr 2023 16:37:04.893 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo 6538:C 14 Apr 2023 16:37:04.893 # Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=6538, just started 6538:C 14 Apr 2023 16:37:04.893 # Configuration loaded 6538:M 14 Apr 2023 16:37:04.895 * Increased maximum number of open files to 10032 (it was originally set to 1024). 6538:M 14 Apr 2023 16:37:04.895 * monotonic clock: POSIX clock_gettime 6538:M 14 Apr 2023 16:37:04.898 * No cluster configuration found, I\u0026#39;m e13c04818944108ee3b0690d836466b4c0eb69fd 6538:M 14 Apr 2023 16:37:04.929 * Running mode=cluster, port=6379. 6538:M 14 Apr 2023 16:37:04.929 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128. 6538:M 14 Apr 2023 16:37:04.929 # Server initialized 6538:M 14 Apr 2023 16:37:04.929 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add \u0026#39;vm.overcommit_memory = 1\u0026#39; to /etc/sysctl.conf and then reboot or run the command \u0026#39;sysctl vm.overcommit_memory=1\u0026#39; for this to take effect. 6538:M 14 Apr 2023 16:37:04.930 * Ready to accept connections é›†ç¾¤èŠ‚ç‚¹é…ç½®æ–‡ä»¶ï¼Œä¼šå‘ç°ç”Ÿæˆäº†ä¸€ç»„é›†ç¾¤ä¿¡æ¯\n# ç¬¬ä¸€æ®µä¿¡æ¯æ˜¯è¿™ä¸ªRedisæœåŠ¡ä½œä¸ºé›†ç¾¤èŠ‚ç‚¹çš„ä¸€ä¸ªèº«ä»½ç¼–ç  # åˆ«åä¸ºé›†ç¾¤çš„node-id\ncat *6379/*nodes*conf e13c04818944108ee3b0690d836466b4c0eb69fd :0@0 myself,master - 0 0 0 connected vars currentEpoch 0 lastVoteEpoch 0 ## å½“åç»­æ‰€æœ‰èŠ‚ç‚¹éƒ½è¿æ¥ä¸Šæ—¶ï¼Œå†…å®¹ä¼šå˜æˆï¼š ls conf logs nodes_6379.conf pid redis_6379.rdb root@centos7101:local/redis_cluster/redis_6379 cat nodes_6379.conf f6cf3978d3397582c87480f8c335297675d4354a 192.168.1.103:6380@16380 master - 1681470597368 1681470597337 6 connected 0-5461 f1151c2350820b35e117d3c32b59b64917688745 192.168.1.103:6379@16379 master - 1681470597369 1681470597337 5 connected 10923-16383 83bfb30e39e3040397d995a7b1f560e8fb53c6a9 192.168.1.102:6380@16380 slave f1151c2350820b35e117d3c32b59b64917688745 1681470597369 1681470597337 5 connected 4e9452afe7a8f53dc546b0436109bef570e03888 192.168.1.101:6380@16380 slave 95b2dcd681674398d22817728af08c31d4bd4872 1681470597370 1681470597337 4 connected 95b2dcd681674398d22817728af08c31d4bd4872 192.168.1.102:6379@16379 master - 1681470597370 1681470597337 4 connected 5462-10922 fd6acb4af8afa5ddd31cf559ee2c80ffcbea456f 192.168.1.101:6379@16379 myself,slave f6cf3978d3397582c87480f8c335297675d4354a 0 1681470597337 6 connected vars currentEpoch 6 lastVoteEpoch 0 é›†ç¾¤æ­å»º # æ‰‹åŠ¨æ­å»ºé›†ç¾¤ # åŠ å…¥é›†ç¾¤ # åœ¨node1:6379 æŸ¥çœ‹å½“å‰cluster\nredis-cli -h node1 -p 6379 node1:6379\u0026gt; cluster nodes e13c04818944108ee3b0690d836466b4c0eb69fd :6379@16379 myself,master - 0 0 0 connected node1:6379\u0026gt; cluster meet 192.168.1.102 6379 OK node1:6379\u0026gt; cluster nodes e13c04818944108ee3b0690d836466b4c0eb69fd 192.168.1.101:6379@16379 myself,master - 0 0 1 connected fbe66448ee1baefa6e9fbd55e778c1d09054b59a 192.168.1.102:6379@16379 master - 0 1681464479300 0 connected node1:6379\u0026gt; æ­¤æ—¶åœ¨node2:6379æŸ¥çœ‹å½“å‰cluster\nredis-cli -h node2 -p 6379 node2:6379\u0026gt; cluster nodes fbe66448ee1baefa6e9fbd55e778c1d09054b59a 192.168.1.102:6379@16379 myself,master - 0 0 0 connected e13c04818944108ee3b0690d836466b4c0eb69fd 192.168.1.101:6379@16379 master - 0 1681464547007 1 connected åˆ‡å›node1:6379ï¼Œå°†å‰©ä¸‹çš„èŠ‚ç‚¹meetä¸Š\nnode1:6379\u0026gt; cluster meet 192.168.1.103 6379 OK node1:6379\u0026gt; cluster meet 192.168.1.101 6380 OK node1:6379\u0026gt; cluster meet 192.168.1.102 6380 OK node1:6379\u0026gt; cluster meet 192.168.1.103 6380 OK node1:6379\u0026gt; clear node1:6379\u0026gt; cluster nodes 84384230f256fae73ab5bbaf34b0479b67602d6e 192.168.1.102:6380@16380 master - 0 1681464635860 4 connected e13c04818944108ee3b0690d836466b4c0eb69fd 192.168.1.101:6379@16379 myself,master - 0 1681464633000 1 connected fbe66448ee1baefa6e9fbd55e778c1d09054b59a 192.168.1.102:6379@16379 master - 0 1681464636894 0 connected 43cdb0cd626a0341cf0c9fa31832735c5341a89b 192.168.1.103:6380@16380 master - 0 1681464635000 5 connected a20b6da956145cfa06ed55159456de8259d9f246 192.168.1.103:6379@16379 master - 0 1681464637923 2 connected 4aeeaa0d87b91712576c6e995b355fe4a87b24e0 192.168.1.101:6380@16380 master - 0 1681464637000 3 connected ä¸»ä»é…ç½® # ä¸Šé¢å‘ç°çš„node-id\nhostname èŠ‚ç‚¹ node-id node1 192.168.1.101:6379 e13c04818944108ee3b0690d836466b4c0eb69fd node2 192.168.1.102:6379 fbe66448ee1baefa6e9fbd55e778c1d09054b59a node3 192.168.1.103:6379 a20b6da956145cfa06ed55159456de8259d9f246 ä¸»ä»é…ç½®\n#node1:6380-\u0026gt;node2:6379 node1:6380\u0026gt; cluster replicate 95b2dcd681674398d22817728af08c31d4bd4872 OK #node2:6380-\u0026gt;node3:6379 node2:6380\u0026gt; cluster replicate f1151c2350820b35e117d3c32b59b64917688745 OK #node3:6380-\u0026gt;node1:6379 node3:6380\u0026gt; cluster replicate fd6acb4af8afa5ddd31cf559ee2c80ffcbea456f OK å†ä¸€æ¬¡æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ï¼Œå‡ºç°äº†masterï¼Œslave\nnode3:6380\u0026gt; cluster nodes 4aeeaa0d87b91712576c6e995b355fe4a87b24e0 192.168.1.101:6380@16380 slave fbe66448ee1baefa6e9fbd55e778c1d09054b59a 0 1681465221000 0 connected 43cdb0cd626a0341cf0c9fa31832735c5341a89b 192.168.1.103:6380@16380 myself,slave e13c04818944108ee3b0690d836466b4c0eb69fd 0 1681465222000 1 connected fbe66448ee1baefa6e9fbd55e778c1d09054b59a 192.168.1.102:6379@16379 master - 0 1681465223000 0 connected e13c04818944108ee3b0690d836466b4c0eb69fd 192.168.1.101:6379@16379 master - 0 1681465222000 1 connected a20b6da956145cfa06ed55159456de8259d9f246 192.168.1.103:6379@16379 master - 0 1681465221814 2 connected 84384230f256fae73ab5bbaf34b0479b67602d6e 192.168.1.102:6380@16380 slave a20b6da956145cfa06ed55159456de8259d9f246 0 1681465223880 2 connected åˆ†é…æ§½ä½ # åªå¯¹ä¸»åº“åˆ†é…ï¼Œä»åº“ä¸è¿›è¡Œåˆ†é…\nexpr 16384 / 3 5461\nä¸‹é¢å¹³å‡åˆ†é…åˆ°3ä¸ªmasterä¸­ï¼Œå…¶ä¸­:\nèŠ‚ç‚¹ æ§½ä½æ•°é‡ node1:6379 0 - 5461 ã€å¤šåˆ†é…äº†ä¸€ä¸ªã€‘ node2:6379 5461 - 10922 node3:6379 10922 - 16383 redis-cli -h node1 -p 6379 cluster addslots {0..5461} redis-cli -h node2 -p 6379 cluster addslots {5462..10922} redis-cli -h node3 -p 6379 cluster addslots {10923..16383} redis-cli -h node3 -p 6379 node1:6379\u0026gt; cluster nodes 84384230f256fae73ab5bbaf34b0479b67602d6e 192.168.1.102:6380@16380 slave a20b6da956145cfa06ed55159456de8259d9f246 0 1681467951000 2 connected e13c04818944108ee3b0690d836466b4c0eb69fd 192.168.1.101:6379@16379 myself,master - 0 1681467948000 1 connected 0-5461 fbe66448ee1baefa6e9fbd55e778c1d09054b59a 192.168.1.102:6379@16379 master - 0 1681467949000 0 connected 5462-10922 43cdb0cd626a0341cf0c9fa31832735c5341a89b 192.168.1.103:6380@16380 slave e13c04818944108ee3b0690d836466b4c0eb69fd 0 1681467949690 1 connected a20b6da956145cfa06ed55159456de8259d9f246 192.168.1.103:6379@16379 master - 0 1681467947626 2 connected 10923-16383 4aeeaa0d87b91712576c6e995b355fe4a87b24e0 192.168.1.101:6380@16380 slave fbe66448ee1baefa6e9fbd55e778c1d09054b59a 0 1681467951745 0 connected æ£€æŸ¥é›†ç¾¤çŠ¶æ€æ˜¯å¦OK\nnode1:6379\u0026gt; cluster info cluster_state:ok cluster_slots_assigned:16384 cluster_slots_ok:16384 cluster_slots_pfail:0 cluster_slots_fail:0 cluster_known_nodes:6 cluster_size:3 cluster_current_epoch:5 cluster_my_epoch:1 cluster_stats_messages_ping_sent:3461 cluster_stats_messages_pong_sent:3530 cluster_stats_messages_meet_sent:5 cluster_stats_messages_sent:6996 cluster_stats_messages_ping_received:3530 cluster_stats_messages_pong_received:3466 cluster_stats_messages_received:6996 è‡ªåŠ¨é›†ç¾¤æ­å»º # å‡è®¾æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½å·²ç»é‡ç½®è¿‡ï¼Œæ²¡æœ‰ä¸»ä»çŠ¶æ€ï¼Œä¹ŸæœªåŠ å…¥ä»»ä½•é›†ç¾¤ã€‚\nRedis5ä¹‹å‰ä½¿ç”¨redis-trib.rbè„šæœ¬æ­å»º\nredis-trib.rbè„šæœ¬ä½¿ç”¨rubyè¯­è¨€ç¼–å†™ï¼Œæ‰€ä»¥æƒ³è¦è¿è¡Œæ¬¡è„šæœ¬ï¼Œæˆ‘ä»¬å¿…é¡»å®‰è£…Rubyç¯å¢ƒã€‚å®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š\nyum -y install centos-release-scl-rh yum -y install rh-ruby23 scl enable rh-ruby23 bash gem install redis å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ruby -v æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ã€‚\nRubyç¯å¢ƒå®‰è£…å®Œæˆåã€‚è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\nredis-trib.rb create --replicas 1 192.168.14.101:6379 192.168.14.102:6380 192.168.14.103:6381 192.168.14.101:6382 192.168.14.102:6383 192.168.14.103:6384\nå‰é¢æˆ‘ä»¬å°±è¯´è¿‡ï¼Œredis5.0ä¹‹åå·²ç»å°†redis-trib.rb è„šæœ¬çš„åŠŸèƒ½å…¨éƒ¨é›†æˆåˆ°redis-cliä¸­äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å³å¯ï¼š\nredis-cli -h node3 -p 6379 cluster reset hard\næ­¤æ—¶æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯masterä¸”å·²ç»åœ¨è¿è¡Œä¸­\næ­¤æ—¶è¿è¡Œ\n# redis-cli -a ${password} --cluster create 192.168.1.101:6379 192.168.1.102:6379 192.168.1.103:6379 192.168.1.103:6380 192.168.1.101:6380 192.168.1.102:6380 --cluster-replicas 1 # å¦‚æœæœ‰å¯†ç ï¼Œä¸€èˆ¬æƒ…å†µä¸‹é›†ç¾¤ä¸‹çš„æ‰€æœ‰èŠ‚ç‚¹ä½¿ç”¨åŒæ ·çš„å¯†ç  redis-cli --cluster create 192.168.1.101:6379 192.168.1.102:6379 192.168.1.103:6379 192.168.1.103:6380 192.168.1.101:6380 192.168.1.102:6380 --cluster-replicas 1 \u0026gt;\u0026gt;\u0026gt; Performing hash slots allocation on 6 nodes... Master[0] -\u0026gt; Slots 0 - 5460 Master[1] -\u0026gt; Slots 5461 - 10922 Master[2] -\u0026gt; Slots 10923 - 16383 Adding replica 192.168.1.102:6380 to 192.168.1.101:6379 Adding replica 192.168.1.103:6380 to 192.168.1.102:6379 Adding replica 192.168.1.101:6380 to 192.168.1.103:6379 M: 24ea7569f0a433eb9706d991f21ae49ec21e48cf 192.168.1.101:6379 slots:[0-5460] (5461 slots) master M: 518fc32f556b10d4b8f83bda420d01aaeeb25f51 192.168.1.102:6379 slots:[5461-10922] (5462 slots) master M: c021bdbaf1c3a476616781c25dbc2b3042ed6f10 192.168.1.103:6379 slots:[10923-16383] (5461 slots) master S: 25e44d3ff2d94400b3c53d66993fc99332adffe4 192.168.1.103:6380 replicates 518fc32f556b10d4b8f83bda420d01aaeeb25f51 S: a6159c5dda95017ba5433f597ea4d18780868dfc 192.168.1.101:6380 replicates c021bdbaf1c3a476616781c25dbc2b3042ed6f10 S: a0e986c4cfb914f34efc8f6ea07cb9b72b615593 192.168.1.102:6380 replicates 24ea7569f0a433eb9706d991f21ae49ec21e48cf Can I set the above configuration? (type \u0026#39;yes\u0026#39; to accept): yes \u0026gt;\u0026gt;\u0026gt; Nodes configuration updated \u0026gt;\u0026gt;\u0026gt; Assign a different config epoch to each node \u0026gt;\u0026gt;\u0026gt; Sending CLUSTER MEET messages to join the cluster Waiting for the cluster to join . \u0026gt;\u0026gt;\u0026gt; Performing Cluster Check (using node 192.168.1.101:6379) M: 24ea7569f0a433eb9706d991f21ae49ec21e48cf 192.168.1.101:6379 slots:[0-5460] (5461 slots) master 1 additional replica(s) S: a0e986c4cfb914f34efc8f6ea07cb9b72b615593 192.168.1.102:6380 slots: (0 slots) slave replicates 24ea7569f0a433eb9706d991f21ae49ec21e48cf S: 25e44d3ff2d94400b3c53d66993fc99332adffe4 192.168.1.103:6380 slots: (0 slots) slave replicates 518fc32f556b10d4b8f83bda420d01aaeeb25f51 M: c021bdbaf1c3a476616781c25dbc2b3042ed6f10 192.168.1.103:6379 slots:[10923-16383] (5461 slots) master 1 additional replica(s) S: a6159c5dda95017ba5433f597ea4d18780868dfc 192.168.1.101:6380 slots: (0 slots) slave replicates c021bdbaf1c3a476616781c25dbc2b3042ed6f10 M: 518fc32f556b10d4b8f83bda420d01aaeeb25f51 192.168.1.102:6379 slots:[5461-10922] (5462 slots) master 1 additional replica(s) [OK] All nodes agree about slots configuration. \u0026gt;\u0026gt;\u0026gt; Check for open slots... \u0026gt;\u0026gt;\u0026gt; Check slots coverage... [OK] All 16384 slots covered. #æ‰€æœ‰æ§½ä½éƒ½åˆ†é…æˆåŠŸ éšä¾¿ä½¿ç”¨ä¸€ä¸ªèŠ‚ç‚¹æŸ¥è¯¢ï¼š\nredis-cli -h node1 -p 6380 cluster nodes 25e44d3ff2d94400b3c53d66993fc99332adffe4 192.168.1.103:6380@16380 slave 518fc32f556b10d4b8f83bda420d01aaeeb25f51 0 1681482908718 2 connected 518fc32f556b10d4b8f83bda420d01aaeeb25f51 192.168.1.102:6379@16379 master - 0 1681482906668 2 connected 5461-10922 24ea7569f0a433eb9706d991f21ae49ec21e48cf 192.168.1.101:6379@16379 master - 0 1681482908000 1 connected 0-5460 c021bdbaf1c3a476616781c25dbc2b3042ed6f10 192.168.1.103:6379@16379 master - 0 1681482907000 3 connected 10923-16383 a0e986c4cfb914f34efc8f6ea07cb9b72b615593 192.168.1.102:6380@16380 slave 24ea7569f0a433eb9706d991f21ae49ec21e48cf 0 1681482909743 1 connected a6159c5dda95017ba5433f597ea4d18780868dfc 192.168.1.101:6380@16380 myself,slave c021bdbaf1c3a476616781c25dbc2b3042ed6f10 0 1681482908000 3 connected å¦‚ä¸Šï¼Œæ§½ä½éƒ½å·²ç»å¹³å‡åˆ†é…å®Œï¼Œä¸”ä¸»ä»å…³ç³»ä¹Ÿé…ç½®å¥½äº†\nå¼Šç«¯ï¼šé€šè¿‡è¯¥æ–¹å¼åˆ›å»ºçš„å¸¦æœ‰ä»èŠ‚ç‚¹çš„æœºå™¨ä¸èƒ½å¤Ÿè‡ªå·±æ‰‹åŠ¨æŒ‡å®šä¸»èŠ‚ç‚¹ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦æŒ‡å®šçš„è¯ï¼Œéœ€è¦è‡ªå·±æ‰‹åŠ¨æŒ‡å®š\na: å…ˆä½¿ç”¨redis-cli --cluster create 192.168.163.132:6379 192.168.163.132:6380 192.168.163.132:6381\nb:æˆ–```redis-cli \u0026ndash;cluster add-node 192.168.163.132:6382 192.168.163.132:6379 è¯´æ˜ï¼šb:ä¸ºä¸€ä¸ªæŒ‡å®šé›†ç¾¤æ·»åŠ èŠ‚ç‚¹ï¼Œéœ€è¦å…ˆè¿åˆ°è¯¥é›†ç¾¤çš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹IPï¼ˆ192.168.163.132:6379ï¼‰ï¼Œå†æŠŠæ–°èŠ‚ç‚¹åŠ å…¥ã€‚è¯¥2ä¸ªå‚æ•°çš„é¡ºåºæœ‰è¦æ±‚ï¼šæ–°åŠ å…¥çš„èŠ‚ç‚¹æ”¾å‰é¢ é€šè¿‡redis-cli --cluster add-node 192.168.163.132:6382 192.168.163.132:6379 --cluster-slave --cluster-master-id 117457eab5071954faab5e81c3170600d5192270æ¥å¤„ç†ã€‚ è¯´æ˜ï¼šæŠŠ6382èŠ‚ç‚¹åŠ å…¥åˆ°6379èŠ‚ç‚¹çš„é›†ç¾¤ä¸­ï¼Œå¹¶ä¸”å½“åšnode_idä¸º 117457eab5071954faab5e81c3170600d5192270 çš„ä»èŠ‚ç‚¹ã€‚å¦‚æœä¸æŒ‡å®š \u0026ndash;cluster-master-id ä¼šéšæœºåˆ†é…åˆ°ä»»æ„ä¸€ä¸ªä¸»èŠ‚ç‚¹ã€‚ æ€»ç»“ï¼šä¹Ÿå°±æ˜¯å…ˆåˆ›å»ºä¸»èŠ‚ç‚¹ï¼Œå†åˆ›å»ºä»èŠ‚ç‚¹å°±æ˜¯äº† MOVEDé‡å®šå‘ # redis-cli -h node1 -p 6379 node1:6379\u0026gt; set k1 \u0026#34;v1\u0026#34; (error) MOVED 12706 192.168.1.103:6379 node1:6379\u0026gt; get k1 (error) MOVED 12706 192.168.1.103:6379 //ä¸Šé¢æ²¡æœ‰è®¾ç½®æˆåŠŸï¼Œ(è¿æ¥æ—¶)ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼ŒRedisé›†ç¾¤ä¼šè‡ªåŠ¨è¿›è¡ŒMOVEDé‡å®šå‘\nredis-cli -c -h node1 -p 6379 node1:6379\u0026gt; get k1 -\u0026gt; Redirected to slot [12706] located at 192.168.1.103:6379 (nil) 192.168.1.103:6379\u0026gt; set k1 \u0026#34;v1\u0026#34; OK 192.168.1.103:6379\u0026gt; get k1 \u0026#34;v1\u0026#34; #å¦‚ä¸Šï¼Œä¼šè‡ªåŠ¨ç»™ä½ åˆ‡æ¢åˆ°slotå¯¹åº”çš„æœºå™¨ä¸Š //åœ¨master3çš„slave3ä¸ŠæŸ¥æ‰¾æ•°æ®\nredis-cli -h node2 -p 6380 -c node2:6380\u0026gt; keys * 1) \u0026#34;k1\u0026#34; node2:6380\u0026gt; get k1 -\u0026gt; Redirected to slot [12706] located at 192.168.1.103:6379 \u0026#34;v1\u0026#34; ## 1 åªæœ‰masteråˆ†é…äº†æ§½ä½ï¼Œæ‰€ä»¥ä¼šé‡å®šå‘åˆ°master3å»å–æ•°æ® ## 2 åŒä¸€ä¸ªæ§½ä½ä¸èƒ½åŒæ—¶åˆ†é…ç»™2ä¸ªèŠ‚ç‚¹ ## 3 åœ¨redisçš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå¯¹redis-clusteræ¶æ„ä¸Šï¼Œæœ‰è¿™æ ·çš„è¯´æ˜ï¼šåœ¨clusteræ¶æ„ä¸‹ï¼Œé»˜è®¤çš„ï¼Œä¸€èˆ¬redis-masterç”¨äºæ¥æ”¶è¯»å†™ï¼Œè€Œredis-slaveåˆ™ç”¨äºå¤‡ä»½ï¼Œå½“æœ‰è¯·æ±‚æ˜¯åœ¨å‘slaveå‘èµ·æ—¶ï¼Œä¼šç›´æ¥é‡å®šå‘åˆ°å¯¹åº”keyæ‰€åœ¨çš„masteræ¥å¤„ç†ã€‚ä½†å¦‚æœä¸ä»‹æ„è¯»å–çš„æ˜¯redis-clusterä¸­æœ‰å¯èƒ½è¿‡æœŸçš„æ•°æ®å¹¶ä¸”å¯¹å†™è¯·æ±‚ä¸æ„Ÿå…´è¶£æ—¶ï¼Œåˆ™äº¦å¯é€šè¿‡readonlyå‘½ä»¤ï¼Œå°†slaveè®¾ç½®æˆå¯è¯»ï¼Œç„¶åé€šè¿‡slaveè·å–ç›¸å…³çš„keyï¼Œè¾¾åˆ°è¯»å†™åˆ†ç¦»ã€‚ # readOnlyè®¾ç½® redis-cli -h node2 -p 6380 node2:6380\u0026gt; get k1 (error) MOVED 12706 192.168.1.103:6379 node2:6380\u0026gt; keys * 1) \u0026#34;k1\u0026#34; node2:6380\u0026gt; readonly OK node2:6380\u0026gt; keys * 1) \u0026#34;k1\u0026#34; node2:6380\u0026gt; get k1 \u0026#34;v1\u0026#34; ## é‡ç½®Readonly node2:6380\u0026gt; readwrite OK node2:6380\u0026gt; get k1 (error) MOVED 12706 192.168.1.103:6379 æ•…éšœè½¬ç§» # å…³é—­å‰\nnode2:6379\u0026gt; cluster nodes f6cf3978d3397582c87480f8c335297675d4354a 192.168.1.103:6380@16380 slave fd6acb4af8afa5ddd31cf559ee2c80ffcbea456f 0 1681470413429 0 connected fd6acb4af8afa5ddd31cf559ee2c80ffcbea456f 192.168.1.101:6379@16379 master - 0 1681470414459 0 connected 0-5461 95b2dcd681674398d22817728af08c31d4bd4872 192.168.1.102:6379@16379 myself,master - 0 1681470413000 4 connected 5462-10922 f1151c2350820b35e117d3c32b59b64917688745 192.168.1.103:6379@16379 master - 0 1681470412000 5 connected 10923-16383 83bfb30e39e3040397d995a7b1f560e8fb53c6a9 192.168.1.102:6380@16380 slave f1151c2350820b35e117d3c32b59b64917688745 0 1681470412397 5 connected 4e9452afe7a8f53dc546b0436109bef570e03888 192.168.1.101:6380@16380 slave 95b2dcd681674398d22817728af08c31d4bd4872 0 1681470411371 4 connected å…³é—­node1 master\nredis-cli -h node1 -p 6379 shutdown å¦‚ä¸‹ï¼Œnode3çš„slaveå˜æˆäº†master\nredis-cli -h node1 -p 6380 node1:6380\u0026gt; cluster nodes f6cf3978d3397582c87480f8c335297675d4354a 192.168.1.103:6380@16380 master - 0 1681470479000 6 connected 0-5461 ###è¿™é‡Œå‡çº§æˆäº†masterï¼Œæ§½ä½ä¹Ÿè½¬ç§»äº† 83bfb30e39e3040397d995a7b1f560e8fb53c6a9 192.168.1.102:6380@16380 slave f1151c2350820b35e117d3c32b59b64917688745 0 1681470479664 5 connected 4e9452afe7a8f53dc546b0436109bef570e03888 192.168.1.101:6380@16380 myself,slave 95b2dcd681674398d22817728af08c31d4bd4872 0 1681470479000 4 connected fd6acb4af8afa5ddd31cf559ee2c80ffcbea456f 192.168.1.101:6379@16379 master,fail - 1681470463058 1681470459947 0 disconnected 95b2dcd681674398d22817728af08c31d4bd4872 192.168.1.102:6379@16379 master - 0 1681470478616 4 connected 5462-10922 f1151c2350820b35e117d3c32b59b64917688745 192.168.1.103:6379@16379 master - 0 1681470480698 5 connected 10923-16383 æ­¤æ—¶å°†6379å†æ¬¡ä¸Šçº¿\nredis-server /usr/local/redis_cluster/redis_6379/conf/redis.conf ## æ­¤æ—¶node1çš„6379å˜æˆäº†node3çš„6380çš„ä»åº“ node1:6379\u0026gt; cluster nodes f6cf3978d3397582c87480f8c335297675d4354a 192.168.1.103:6380@16380 master - 0 1681470625000 6 connected 0-5461 f1151c2350820b35e117d3c32b59b64917688745 192.168.1.103:6379@16379 master - 0 1681470628003 5 connected 10923-16383 83bfb30e39e3040397d995a7b1f560e8fb53c6a9 192.168.1.102:6380@16380 slave f1151c2350820b35e117d3c32b59b64917688745 0 1681470626979 5 connected 4e9452afe7a8f53dc546b0436109bef570e03888 192.168.1.101:6380@16380 slave 95b2dcd681674398d22817728af08c31d4bd4872 0 1681470627000 4 connected 95b2dcd681674398d22817728af08c31d4bd4872 192.168.1.102:6379@16379 master - 0 1681470627000 4 connected 5462-10922 fd6acb4af8afa5ddd31cf559ee2c80ffcbea456f 192.168.1.101:6379@16379 myself,slave f6cf3978d3397582c87480f8c335297675d4354a 0 1681470625000 6 connected é›†ç¾¤æ‰©å®¹ # å½“å‰é›†ç¾¤çŠ¶æ€ # â–¶ redis-cli -h node1 -p 6379 cluster nodes f635a8cdaa48e04f2531d28c103bea9dc2d8f48d 192.168.1.102:6380@16380 slave f9d707317348314a7306fdaf91da2d153590140e 0 1681527313557 5 connected f49300c718a7e0baf6d3e8ba4bf7e9915e8051cc 192.168.1.101:6380@16380 slave 9e9613cec2fdd48000509e9c3723d157263edd87 0 1681527313000 4 connected 9ea59136c61207347657503fd7a78349f57e919e 192.168.1.103:6380@16380 slave fff7298fa77799434bc8ef6c74c974c21ebc47b4 0 1681527314000 0 connected fff7298fa77799434bc8ef6c74c974c21ebc47b4 192.168.1.101:6379@16379 myself,master - 0 1681527313000 0 connected 0-5461 9e9613cec2fdd48000509e9c3723d157263edd87 192.168.1.102:6379@16379 master - 0 1681527314579 4 connected 5462-10922 f9d707317348314a7306fdaf91da2d153590140e 192.168.1.103:6379@16379 master - 0 1681527312000 5 connected 10923-16383 æ–°å¢èŠ‚ç‚¹é…ç½®å¹¶å¯åŠ¨ # å‡†å¤‡ # å‡è®¾åœ¨node3æ–°å¢ä¸¤ä¸ªç«¯å£{6390,6391}ï¼Œä½œä¸ºæ–°èŠ‚ç‚¹\nä¸” node3:6391 replicate node3:6390\næ­¥éª¤ï¼šé€šè¿‡mkdir -p /usr/local/redis_cluster/redis_63{91,90}/{conf,pid,logs}åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œç„¶åå†confç›®å½•ä¸‹é…ç½®é›†ç¾¤é…ç½®æ–‡ä»¶\n# å®ˆæŠ¤è¿›è¡Œæ¨¡å¼å¯åŠ¨ daemonize yes # è®¾ç½®æ•°æ®åº“æ•°é‡ï¼Œé»˜è®¤æ•°æ®åº“ä¸º0 databases 16 # ç»‘å®šåœ°å€ï¼Œéœ€è¦ä¿®æ”¹ bind node3 # ç»‘å®šç«¯å£ï¼Œéœ€è¦ä¿®æ”¹ port 6390 # pidæ–‡ä»¶å­˜å‚¨ä½ç½®ï¼Œæ–‡ä»¶åéœ€è¦ä¿®æ”¹ pidfile /usr/local/redis_cluster/redis_6390/pid/redis_6390.pid # logæ–‡ä»¶å­˜å‚¨ä½ç½®ï¼Œæ–‡ä»¶åéœ€è¦ä¿®æ”¹ logfile /usr/local/redis_cluster/redis_6390/logs/redis_6390.log # RDBå¿«ç…§å¤‡ä»½æ–‡ä»¶åï¼Œæ–‡ä»¶åéœ€è¦ä¿®æ”¹ dbfilename redis_6390.rdb # æœ¬åœ°æ•°æ®åº“å­˜å‚¨ç›®å½•ï¼Œéœ€è¦ä¿®æ”¹ dir /usr/local/redis_cluster/redis_6390 # é›†ç¾¤ç›¸å…³é…ç½® # æ˜¯å¦ä»¥é›†ç¾¤æ¨¡å¼å¯åŠ¨ cluster-enabled yes # é›†ç¾¤èŠ‚ç‚¹å›åº”æœ€é•¿æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´è¢«è®¤ä¸ºä¸‹çº¿ cluster-node-timeout 15000 # ç”Ÿæˆçš„é›†ç¾¤èŠ‚ç‚¹é…ç½®æ–‡ä»¶åï¼Œæ–‡ä»¶åéœ€è¦ä¿®æ”¹ cluster-config-file nodes_6390.conf ç›®å½•ç»“æ„\nroot@centos7103:/usr/local/redis_cluster â–¶ ls redis6 redis_6379 redis_6380 redis_6390 redis_6391 â–¶ tree *90 redis_6390 â”œâ”€â”€ conf â”‚Â â””â”€â”€ redis.conf â”œâ”€â”€ logs â””â”€â”€ pid 3 directories, 1 file å¯åŠ¨èŠ‚ç‚¹\n# ä¸¤ä¸ªå­¤å„¿èŠ‚ç‚¹ root@centos7103:/usr/local/redis_cluster â‰ â–¶ redis-server /usr/local/redis_cluster/redis_6390/conf/redis.conf root@centos7103:/usr/local/redis_cluster â–¶ redis-server /usr/local/redis_cluster/redis_6391/conf/redis.conf root@centos7103:/usr/local/redis_cluster â–¶ netstat -lntup |grep redis tcp 0 0 192.168.1.103:6379 0.0.0.0:* LISTEN 3484/redis-server n tcp 0 0 192.168.1.103:6380 0.0.0.0:* LISTEN 3507/redis-server n tcp 0 0 192.168.1.103:6390 0.0.0.0:* LISTEN 5590/redis-server n tcp 0 0 192.168.1.103:6391 0.0.0.0:* LISTEN 5616/redis-server n tcp 0 0 192.168.1.103:16379 0.0.0.0:* LISTEN 3484/redis-server n tcp 0 0 192.168.1.103:16380 0.0.0.0:* LISTEN 3507/redis-server n tcp 0 0 192.168.1.103:16390 0.0.0.0:* LISTEN 5590/redis-server n tcp 0 0 192.168.1.103:16391 0.0.0.0:* LISTEN 5616/redis-server n æ·»åŠ ä¸»èŠ‚ç‚¹ # å°†æ–°èŠ‚ç‚¹åŠ å…¥åˆ°node1:6379 [0,5460]æ‰€åœ¨çš„é›†ç¾¤ä¸­\nåŠ å…¥å‰\nredis-cli -h node3 -p 6390 node3:6390\u0026gt; cluster nodes b014cfbeff6f9668ec9592cbc8aa874bda2d8d6b :6390@16390 myself,master - 0 0 0 connected åŠ å…¥\n# åœ¨node1å®¢æˆ·ç«¯æ“ä½œï¼Œå°†103:6390æ·»åŠ åˆ°101:6379æ‰€åœ¨çš„é›†ç¾¤ä¸­ redis-cli -h node1 -p 6379 --cluster add-node 192.168.1.103:6390 192.168.1.101:6379 \u0026gt;\u0026gt;\u0026gt; Adding node 192.168.1.103:6390 to cluster 192.168.1.101:6379 \u0026gt;\u0026gt;\u0026gt; Performing Cluster Check (using node 192.168.1.101:6379) M: fff7298fa77799434bc8ef6c74c974c21ebc47b4 192.168.1.101:6379 slots:[0-5461] (5462 slots) master 1 additional replica(s) S: f635a8cdaa48e04f2531d28c103bea9dc2d8f48d 192.168.1.102:6380 slots: (0 slots) slave replicates f9d707317348314a7306fdaf91da2d153590140e S: f49300c718a7e0baf6d3e8ba4bf7e9915e8051cc 192.168.1.101:6380 slots: (0 slots) slave replicates 9e9613cec2fdd48000509e9c3723d157263edd87 S: 9ea59136c61207347657503fd7a78349f57e919e 192.168.1.103:6380 slots: (0 slots) slave replicates fff7298fa77799434bc8ef6c74c974c21ebc47b4 M: 9e9613cec2fdd48000509e9c3723d157263edd87 192.168.1.102:6379 slots:[5462-10922] (5461 slots) master 1 additional replica(s) M: f9d707317348314a7306fdaf91da2d153590140e 192.168.1.103:6379 slots:[10923-16383] (5461 slots) master 1 additional replica(s) [OK] All nodes agree about slots configuration. \u0026gt;\u0026gt;\u0026gt; Check for open slots... \u0026gt;\u0026gt;\u0026gt; Check slots coverage... [OK] All 16384 slots covered. \u0026gt;\u0026gt;\u0026gt; Send CLUSTER MEET to node 192.168.1.103:6390 to make it join the cluster. [OK] New node added correctly. åŠ å…¥å\nâ–¶ redis-cli -h node1 -p 6379 cluster nodes b014cfbeff6f9668ec9592cbc8aa874bda2d8d6b 192.168.1.103:6390@16390 master - 0 1681527533967 6 connected f635a8cdaa48e04f2531d28c103bea9dc2d8f48d 192.168.1.102:6380@16380 slave f9d707317348314a7306fdaf91da2d153590140e 0 1681527534990 5 connected f49300c718a7e0baf6d3e8ba4bf7e9915e8051cc 192.168.1.101:6380@16380 slave 9e9613cec2fdd48000509e9c3723d157263edd87 0 1681527533000 4 connected 9ea59136c61207347657503fd7a78349f57e919e 192.168.1.103:6380@16380 slave fff7298fa77799434bc8ef6c74c974c21ebc47b4 0 1681527533000 0 connected fff7298fa77799434bc8ef6c74c974c21ebc47b4 192.168.1.101:6379@16379 myself,master - 0 1681527529000 0 connected 0-5461 9e9613cec2fdd48000509e9c3723d157263edd87 192.168.1.102:6379@16379 master - 0 1681527534000 4 connected 5462-10922 f9d707317348314a7306fdaf91da2d153590140e 192.168.1.103:6379@16379 master - 0 1681527533000 5 connected 10923-16383 ä¸ºä»–åˆ†é…æ§½ä½\n# æœ€åä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºåŸæ¥é›†ç¾¤ä¸­ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™é‡Œä¼šå°†æºèŠ‚ç‚¹æ‰€åœ¨é›†ç¾¤çš„ä¸€éƒ¨åˆ†åˆ†ç»™æ–°å¢èŠ‚ç‚¹ redis-cli -h node1 -p 6379 --cluster reshard 192.168.1.101:6379 ##è¿‡ç¨‹ #åé¢çš„2000è¡¨ç¤ºåˆ†é…2000ä¸ªæ§½ä½ç»™æ–°å¢èŠ‚ç‚¹ How many slots do you want to move (from 1 to 16384)? 2000 #è¾“å…¥ #è¡¨ç¤ºæ¥å—èŠ‚ç‚¹çš„NodeId,å¡«æ–°å¢èŠ‚ç‚¹6390çš„ What is the receiving node ID? b014cfbeff6f9668ec9592cbc8aa874bda2d8d6b #è¾“å…¥ #è¿™é‡Œå¡«æ§½çš„æ¥æºï¼Œè¦ä¹ˆå¡«allï¼Œè¡¨ç¤ºæ‰€æœ‰masterèŠ‚ç‚¹éƒ½æ‹¿å‡ºä¸€éƒ¨åˆ†æ§½ä½åˆ†é…ç»™æ–°å¢èŠ‚ç‚¹ï¼› #è¦ä¹ˆå¡«æŸä¸ªåŸæœ‰NodeIdï¼Œè¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹æ‹¿å‡ºä¸€éƒ¨åˆ†æ§½ä½ç»™æ–°å¢èŠ‚ç‚¹ Please enter all the source node IDs. Type \u0026#39;all\u0026#39; to use all the nodes as source nodes for the hash slots. Type \u0026#39;done\u0026#39; once you entered all the source nodes IDs. Source node #1: 7e900adc7f977cfcccef12d48c7a29b64c4344c2 Source node #2: done # è¿™é‡ŒæŠŠnode1:6379 æ‹¿å‡ºäº†2000ä¸ªæ§½ä½ç»™æ–°èŠ‚ç‚¹ ç»“æœï¼š\n? redis-cli -h node1 -p 6380 cluster nodes 259b65d7f3d1eac2716f7ae00cc6c1db27a55b27 192.168.1.103:6379@16379 master - 0 1681530641000 2 connected 10923-16383 429ed631dbf09ba846a5371b707defe17b9f8c8e 192.168.1.101:6380@16380 myself,slave 9355d72df6e9dc2643ac1c819cd2e496fb1aed60 0 1681530643000 4 connected 9355d72df6e9dc2643ac1c819cd2e496fb1aed60 192.168.1.102:6379@16379 master - 0 1681530641000 4 connected 5462-10922 81e1e03230ed7700028fa56155e9531b48791164 192.168.1.103:6390@16390 master - 0 1681530644122 6 connected 0-1999 a04347e1af8930324dab7ae85f912449475a487f 192.168.1.102:6380@16380 slave 259b65d7f3d1eac2716f7ae00cc6c1db27a55b27 0 1681530643093 2 connected 92a9d6b988dcf8a219de0247975d8e341072134d 192.168.1.103:6380@16380 slave 7e900adc7f977cfcccef12d48c7a29b64c4344c2 0 1681530643000 1 connected 7e900adc7f977cfcccef12d48c7a29b64c4344c2 192.168.1.101:6379@16379 master - 0 1681530642063 1 connected 2000-5461 æ·»åŠ ä»èŠ‚ç‚¹ # å°†èŠ‚ç‚¹æ·»åŠ åˆ°é›†ç¾¤ä¸­\nâ–¶ redis-cli -h node1 -p 6379 --cluster add-node 192.168.1.103:6391 192.168.1.101:6379 \u0026gt;\u0026gt;\u0026gt; Adding node 192.168.1.103:6391 to cluster 192.168.1.101:6379 \u0026gt;\u0026gt;\u0026gt; Performing Cluster Check (using node 192.168.1.101:6379) M: 7e900adc7f977cfcccef12d48c7a29b64c4344c2 192.168.1.101:6379 slots:[2000-5461] (3462 slots) master 1 additional replica(s) M: 9355d72df6e9dc2643ac1c819cd2e496fb1aed60 192.168.1.102:6379 slots:[5462-10922] (5461 slots) master 1 additional replica(s) S: a04347e1af8930324dab7ae85f912449475a487f 192.168.1.102:6380 slots: (0 slots) slave replicates 259b65d7f3d1eac2716f7ae00cc6c1db27a55b27 M: 259b65d7f3d1eac2716f7ae00cc6c1db27a55b27 192.168.1.103:6379 slots:[10923-16383] (5461 slots) master 1 additional replica(s) M: 81e1e03230ed7700028fa56155e9531b48791164 192.168.1.103:6390 slots:[0-1999] (2000 slots) master S: 429ed631dbf09ba846a5371b707defe17b9f8c8e 192.168.1.101:6380 slots: (0 slots) slave replicates 9355d72df6e9dc2643ac1c819cd2e496fb1aed60 S: 92a9d6b988dcf8a219de0247975d8e341072134d 192.168.1.103:6380 slots: (0 slots) slave replicates 7e900adc7f977cfcccef12d48c7a29b64c4344c2 [OK] All nodes agree about slots configuration. \u0026gt;\u0026gt;\u0026gt; Check for open slots... \u0026gt;\u0026gt;\u0026gt; Check slots coverage... [OK] All 16384 slots covered. \u0026gt;\u0026gt;\u0026gt; Send CLUSTER MEET to node 192.168.1.103:6391 to make it join the cluster. [OK] New node added correctly. å»ºç«‹ä¸»ä»å…³ç³»\nâ–¶ redis-cli -h node1 -p 6380 cluster nodes 9babc7adc86da25ba501bd5bc007300dc04743a9 192.168.1.103:6391@16391 master - 0 1681530812000 0 connected 259b65d7f3d1eac2716f7ae00cc6c1db27a55b27 192.168.1.103:6379@16379 master - 0 1681530808000 2 connected 10923-16383 429ed631dbf09ba846a5371b707defe17b9f8c8e 192.168.1.101:6380@16380 myself,slave 9355d72df6e9dc2643ac1c819cd2e496fb1aed60 0 1681530811000 4 connected 9355d72df6e9dc2643ac1c819cd2e496fb1aed60 192.168.1.102:6379@16379 master - 0 1681530810000 4 connected 5462-10922 81e1e03230ed7700028fa56155e9531b48791164 192.168.1.103:6390@16390 master - 0 1681530810000 6 connected 0-1999 a04347e1af8930324dab7ae85f912449475a487f 192.168.1.102:6380@16380 slave 259b65d7f3d1eac2716f7ae00cc6c1db27a55b27 0 1681530811246 2 connected 92a9d6b988dcf8a219de0247975d8e341072134d 192.168.1.103:6380@16380 slave 7e900adc7f977cfcccef12d48c7a29b64c4344c2 0 1681530812275 1 connected 7e900adc7f977cfcccef12d48c7a29b64c4344c2 192.168.1.101:6379@16379 master - 0 1681530809182 1 connected 2000-5461 root@centos7101:/usr/local/redis_cluster â–¶ redis-cli -h node3 -p 6391 cluster replicate 81e1e03230ed7700028fa56155e9531b48791164 OK root@centos7101:/usr/local/redis_cluster # éªŒè¯ â–¶ redis-cli -h node1 -p 6380 cluster nodes 9babc7adc86da25ba501bd5bc007300dc04743a9 192.168.1.103:6391@16391 slave 81e1e03230ed7700028fa56155e9531b48791164 0 1681530870000 6 connected 259b65d7f3d1eac2716f7ae00cc6c1db27a55b27 192.168.1.103:6379@16379 master - 0 1681530868642 2 connected 10923-16383 429ed631dbf09ba846a5371b707defe17b9f8c8e 192.168.1.101:6380@16380 myself,slave 9355d72df6e9dc2643ac1c819cd2e496fb1aed60 0 1681530867000 4 connected 9355d72df6e9dc2643ac1c819cd2e496fb1aed60 192.168.1.102:6379@16379 master - 0 1681530871715 4 connected 5462-10922 81e1e03230ed7700028fa56155e9531b48791164 192.168.1.103:6390@16390 master - 0 1681530868000 6 connected 0-1999 a04347e1af8930324dab7ae85f912449475a487f 192.168.1.102:6380@16380 slave 259b65d7f3d1eac2716f7ae00cc6c1db27a55b27 0 1681530869000 2 connected 92a9d6b988dcf8a219de0247975d8e341072134d 192.168.1.103:6380@16380 slave 7e900adc7f977cfcccef12d48c7a29b64c4344c2 0 1681530870000 1 connected 7e900adc7f977cfcccef12d48c7a29b64c4344c2 192.168.1.101:6379@16379 master - 0 1681530870693 1 connected 2000-5461 æµ‹è¯•\nnode1:6380\u0026gt; set 18 a -\u0026gt; Redirected to slot [511] located at 192.168.1.103:6390 OK 192.168.1.103:6390\u0026gt; get 18 \u0026#34;a\u0026#34; #åœ¨node3:6391ä¸Šå°è¯•-\u0026gt;è¯´æ˜ä»æœºä¸Šæ˜¯æœ‰æ•°æ®çš„ â–¶ redis-cli -h node3 -p 6391 node3:6391\u0026gt; get 18 (error) MOVED 511 192.168.1.103:6390 node3:6391\u0026gt; readonly OK node3:6391\u0026gt; get 18 \u0026#34;a\u0026#34; node3:6391\u0026gt; keys * 1) \u0026#34;18\u0026#34; é›†ç¾¤æ”¶ç¼© # è¿ç§»å¾…ç§»é™¤èŠ‚ç‚¹çš„æ§½ä½ # #å½“å‰èŠ‚ç‚¹ä¿¡æ¯ 429ed631dbf09ba846a5371b707defe17b9f8c8e 192.168.1.101:6380@16380 slave 9355d72df6e9dc2643ac1c819cd2e496fb1aed60 0 1681531264142 4 connected 7e900adc7f977cfcccef12d48c7a29b64c4344c2 192.168.1.101:6379@16379 master - 0 1681531260000 1 connected 2000-5461 9355d72df6e9dc2643ac1c819cd2e496fb1aed60 192.168.1.102:6379@16379 myself,master - 0 1681531261000 4 connected 5462-10922 259b65d7f3d1eac2716f7ae00cc6c1db27a55b27 192.168.1.103:6379@16379 master - 0 1681531262088 2 connected 10923-16383 9babc7adc86da25ba501bd5bc007300dc04743a9 192.168.1.103:6391@16391 slave 81e1e03230ed7700028fa56155e9531b48791164 0 1681531265170 6 connected 81e1e03230ed7700028fa56155e9531b48791164 192.168.1.103:6390@16390 master - 0 1681531264000 6 connected 0-1999 92a9d6b988dcf8a219de0247975d8e341072134d 192.168.1.103:6380@16380 slave 7e900adc7f977cfcccef12d48c7a29b64c4344c2 0 1681531263115 1 connected a04347e1af8930324dab7ae85f912449475a487f 192.168.1.102:6380@16380 slave 259b65d7f3d1eac2716f7ae00cc6c1db27a55b27 0 1681531260038 2 connected ç§»é™¤å¹¶å°†æ§½ä½åˆ†é…ç»™å…¶ä»–èŠ‚ç‚¹\nredis-cli -p 6379 -h node1 --cluster reshard --cluster-from bee9c03b1c4592119695a17472847736128c8603 --cluster-to 644b722eb996aeb392a8190b29cfdbe95536af9a --cluster-slots 2000 192.168.1.101:6379 # ç”¨å“ªä¸ªå®¢æˆ·ç«¯ï¼Œæœ€åçš„ip:host-\u0026gt;å¯¹è¯¥ip hostæ‰€åœ¨é›†ç¾¤çš„fromå’Œtoæ“ä½œï¼Œè¿›è¡Œè½¬ç§» # ç»“æœ redis-cli -h node1 -p 6380 cluster nodes bee9c03b1c4592119695a17472847736128c8603 192.168.1.103:6390@16390 master - 0 1681532501000 6 connected f525c38c1a78e997a96315ca982f969c51500e86 192.168.1.102:6379@16379 master - 0 1681532501000 0 connected 5462-10922 2b905b7e2480d80bb7c7aa47940e9636697a7d4c 192.168.1.103:6379@16379 master - 0 1681532503071 2 connected 10923-16383 644b722eb996aeb392a8190b29cfdbe95536af9a 192.168.1.101:6379@16379 master - 0 1681532502000 8 connected 0-5461 180113f8ceeba0b17b4a122caa62d36e99141225 192.168.1.103:6391@16391 slave 644b722eb996aeb392a8190b29cfdbe95536af9a 0 1681532503000 8 connected 576e15ed8ac1f4632e5f0917c43d41f7e26dc1e0 192.168.1.101:6380@16380 myself,slave f525c38c1a78e997a96315ca982f969c51500e86 0 1681532500000 0 connected 7ff6ce4b934027c1cdb8720169873f8e97474885 192.168.1.102:6380@16380 slave 2b905b7e2480d80bb7c7aa47940e9636697a7d4c 0 1681532504083 2 connected 75f8df2756a83c121b5637e3a381fa8ebfb9204d 192.168.1.103:6380@16380 slave 644b722eb996aeb392a8190b29cfdbe95536af9a 0 1681532501053 8 connected ## æŸ¥çœ‹ â–¶ redis-cli -h node1 -p 6379 node1:6379\u0026gt; get 18 \u0026#34;a\u0026#34; node1:6379\u0026gt; keys * 1) \u0026#34;18\u0026#34; node1:6379\u0026gt; exit ## çœ‹çœ‹è¿˜åœ¨ä¸åœ¨103:6390ä¸Š redis-cli -h node3 -p 6390 node3:6390\u0026gt; keys * (empty array) node3:6390\u0026gt; get 18 (error) MOVED 511 192.168.1.101:6379 æ§½ä½è°ƒæ•´æˆåŠŸ\næ³¨æ„ï¼Œnode3:6391åŸæœ¬replicate node3:6390ï¼Œä½†æ˜¯node3:6390æ²¡æœ‰æ§½ä½äº†ï¼Œæ‰€ä»¥ä»–å°±è·Ÿåˆ°æ§½ä½æ‰€åœ¨çš„nodeä¸Šäº†ï¼Œå³ï¼š\n644b722eb996aeb392a8190b29cfdbe95536af9a 192.168.1.101:6379@16379 master - 0 1681532502000 8 connected 0-5461 180113f8ceeba0b17b4a122caa62d36e99141225 192.168.1.103:6391@16391 slave 644b722eb996aeb392a8190b29cfdbe95536af9a 0 1681532503000 8 connected ç§»é™¤å¾…åˆ é™¤çš„ä¸»ä»èŠ‚ç‚¹ # å…ˆç§»é™¤ä»èŠ‚ç‚¹ï¼Œå†ç§»é™¤ä¸»èŠ‚ç‚¹ï¼Œé˜²æ­¢è§¦å‘é›†ç¾¤æ•…éšœè½¬ç§»(å¦‚ä¸Šï¼Œè¿™é‡Œå¯èƒ½å¹¶ä¸ä¼šï¼Œå› ä¸ºå·²ç»æ²¡æœ‰èŠ‚ç‚¹replicate node3:6390äº†)\nredis-cli -p 6379 -h node1 --cluster del-node 192.168.1.102:6380 180113f8ceeba0b17b4a122caa62d36e99141225 #ip+port :å“ªä¸ªèŠ‚ç‚¹æ‰€åœ¨çš„é›†ç¾¤ #nodeId \u0026gt;\u0026gt;\u0026gt; Removing node 180113f8ceeba0b17b4a122caa62d36e99141225 from cluster 192.168.1.102:6380 \u0026gt;\u0026gt;\u0026gt; Sending CLUSTER FORGET messages to the cluster... \u0026gt;\u0026gt;\u0026gt; Sending CLUSTER RESET SOFT to the deleted node. ç§»é™¤ä¸»èŠ‚ç‚¹\nredis-cli -p 6379 -h node1 --cluster del-node 192.168.1.102:6380 bee9c03b1c4592119695a17472847736128c8603 \u0026gt;\u0026gt;\u0026gt; Removing node bee9c03b1c4592119695a17472847736128c8603 from cluster 192.168.1.102:6380 \u0026gt;\u0026gt;\u0026gt; Sending CLUSTER FORGET messages to the cluster... \u0026gt;\u0026gt;\u0026gt; Sending CLUSTER RESET SOFT to the deleted node. æŸ¥çœ‹çŠ¶æ€ï¼ˆç§»é™¤æˆåŠŸï¼‰\nâ–¶ redis-cli -h node1 -p 6379 cluster nodes 644b722eb996aeb392a8190b29cfdbe95536af9a 192.168.1.101:6379@16379 myself,master - 0 1681533116000 8 connected 0-5461 75f8df2756a83c121b5637e3a381fa8ebfb9204d 192.168.1.103:6380@16380 slave 644b722eb996aeb392a8190b29cfdbe95536af9a 0 1681533119000 8 connected f525c38c1a78e997a96315ca982f969c51500e86 192.168.1.102:6379@16379 master - 0 1681533120514 0 connected 5462-10922 2b905b7e2480d80bb7c7aa47940e9636697a7d4c 192.168.1.103:6379@16379 master - 0 1681533119492 2 connected 10923-16383 576e15ed8ac1f4632e5f0917c43d41f7e26dc1e0 192.168.1.101:6380@16380 slave f525c38c1a78e997a96315ca982f969c51500e86 0 1681533118463 0 connected 7ff6ce4b934027c1cdb8720169873f8e97474885 192.168.1.102:6380@16380 slave 2b905b7e2480d80bb7c7aa47940e9636697a7d4c 0 1681533118000 2 connected clusterå‘½ä»¤ # ä»¥ä¸‹æ˜¯é›†ç¾¤ä¸­å¸¸ç”¨çš„å¯æ‰§è¡Œå‘½ä»¤ï¼Œå‘½ä»¤æ‰§è¡Œæ ¼å¼ä¸ºï¼š\ncluster ä¸‹è¡¨å‘½ä»¤ å‘½ä»¤å¦‚ä¸‹ï¼Œæœªå…¨ï¼Œå¦‚æœæƒ³äº†è§£æ›´å¤šè¯·æ‰§è¡Œcluster helpæ“ä½œï¼š\nå‘½ä»¤ æè¿° INFO è¿”å›å½“å‰é›†ç¾¤ä¿¡æ¯ MEET \u0026lt;ip\u0026gt; \u0026lt;port\u0026gt; [\u0026lt;bus-port\u0026gt;] æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹è‡³å½“å‰é›†ç¾¤ MYID è¿”å›å½“å‰èŠ‚ç‚¹é›†ç¾¤ID NODES è¿”å›å½“å‰èŠ‚ç‚¹çš„é›†ç¾¤ä¿¡æ¯ REPLICATE \u0026lt;node-id\u0026gt; å°†å½“å‰èŠ‚ç‚¹ä½œä¸ºæŸä¸€é›†ç¾¤èŠ‚ç‚¹çš„ä»åº“ FAILOVER [FORCE|TAKEOVER] å°†å½“å‰ä»åº“å‡çº§ä¸ºä¸»åº“ RESET [HARD|SOFT] é‡ç½®å½“å‰èŠ‚ç‚¹ä¿¡æ¯ ADDSLOTS \u0026lt;slot\u0026gt; [\u0026lt;slot\u0026gt; ...] ä¸ºå½“å‰é›†ç¾¤èŠ‚ç‚¹å¢åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæ’æ§½ä½ï¼Œæ¨èåœ¨bash shellä¸­æ‰§è¡Œï¼Œå¯é€šè¿‡{int..int}æŒ‡å®šå¤šä¸ªæ’æ§½ä½ DELSLOTS \u0026lt;slot\u0026gt; [\u0026lt;slot\u0026gt; ...] ä¸ºå½“å‰é›†ç¾¤èŠ‚ç‚¹åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæ’æ§½ä½ï¼Œæ¨èåœ¨bash shellä¸­æ‰§è¡Œï¼Œå¯é€šè¿‡{int..int}æŒ‡å®šå¤šä¸ªæ’æ§½ä½ FLUSHSLOTS åˆ é™¤å½“å‰èŠ‚ç‚¹ä¸­æ‰€æœ‰çš„æ’æ§½ä¿¡æ¯ FORGET \u0026lt;node-id\u0026gt; ä»é›†ç¾¤ä¸­åˆ é™¤æŸä¸€èŠ‚ç‚¹ COUNT-FAILURE-REPORTS \u0026lt;node-id\u0026gt; è¿”å›å½“å‰é›†ç¾¤èŠ‚ç‚¹çš„æ•…éšœæŠ¥å‘Šæ•°é‡ COUNTKEYSINSLOT \u0026lt;slot\u0026gt; è¿”å›æŸä¸€æ’æ§½ä¸­çš„é”®çš„æ•°é‡ GETKEYSINSLOT \u0026lt;slot\u0026gt; \u0026lt;count\u0026gt; è¿”å›å½“å‰èŠ‚ç‚¹å­˜å‚¨åœ¨æ’æ§½ä¸­çš„keyåç§°ã€‚ KEYSLOT \u0026lt;key\u0026gt; è¿”å›è¯¥keyçš„å“ˆå¸Œæ§½ä½ SAVECONFIG ä¿å­˜å½“å‰é›†ç¾¤é…ç½®ï¼Œè¿›è¡Œè½ç›˜æ“ä½œ SLOTS è¿”å›è¯¥æ’æ§½çš„ä¿¡æ¯ SpringBoot+RedisCluster # ä¾èµ–\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-data-redis\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; é…ç½®æ–‡ä»¶yml\nspring: redis: # å¦‚æœæ˜¯redis-cluster ä¸èƒ½ç”¨è¿™ç§å½¢å¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™,åªé€‚åˆå•æœº #Error in execution; nested exception is io.lettuce.core. #RedisCommandExecutionException: MOVED 15307 192.168.1.103:6379 #host: 192.168.1.102 #port: 6380 # ä¸‹é¢çš„é…ç½®,nodeså†™ä¸€ä¸ªæˆ–è€…å¤šä¸ªéƒ½è¡Œ cluster: nodes: # - 192.168.1.101:6379 # - 192.168.1.102:6379 # - 192.168.1.101:6380 - 192.168.1.102:6380 # - 192.168.1.103:6379 # - 192.168.1.103:6380 åºåˆ—åŒ–å¤„ç†\n@Configuration public class RedisConfig { @Bean public RedisTemplate\u0026lt;String, Object\u0026gt; redisTemplate(RedisConnectionFactory redisConnectionFactory) { RedisTemplate\u0026lt;String, Object\u0026gt; template = new RedisTemplate\u0026lt;\u0026gt;(); RedisSerializer\u0026lt;String\u0026gt; redisSerializer = new StringRedisSerializer(); template.setConnectionFactory(redisConnectionFactory); //keyåºåˆ—åŒ–æ–¹å¼ template.setKeySerializer(redisSerializer); //valueåºåˆ—åŒ– template.setValueSerializer(redisSerializer); //value hashmapåºåˆ—åŒ– template.setHashValueSerializer(redisSerializer); //key haspmapåºåˆ—åŒ– template.setHashKeySerializer(redisSerializer); // return template; } } ä½¿ç”¨\n@Autowired private RedisTemplate\u0026lt;String, Object\u0026gt; redisTemplate; @RequestMapping(\u0026#34;/redisTest\u0026#34;) public String redisTest(){ redisTemplate.opsForValue().set(\u0026#34;190\u0026#34;,\u0026#34;hello,world\u0026#34;+new Date().getTime()); Object hello = redisTemplate.opsForValue().get(\u0026#34;190\u0026#34;); return hello.toString(); } RedisClusteræ¶æ„åŸç†åˆ†æ # åŸºç¡€æ¶æ„ï¼ˆæ•°æ®åˆ†ç‰‡ï¼‰ # é›†ç¾¤åˆ†ç‰‡åŸç† # å¦‚æœæœ‰ä»»æ„1ä¸ªæ§½ä½æ²¡æœ‰è¢«åˆ†é…ï¼Œåˆ™é›†ç¾¤åˆ›å»ºä¸æˆåŠŸã€‚\nå¯åŠ¨é›†ç¾¤åŸç† # é›†ç¾¤é€šä¿¡åŸç† # "},{"id":44,"href":"/zh/docs/study/Other/kaoshi/","title":"ç§‘ç›®","section":"å…¶ä»–","content":" ç§‘ç›® # 1022/9:00-11:30\n00024 æ™®é€šé€»è¾‘ 2010 02197 æ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡ï¼ˆäºŒï¼‰2018 02318 è®¡ç®—æœºç»„æˆåŸç† 2016 02324 ç¦»æ•£æ•°å­¦ 2014 02331 æ•°æ®ç»“æ„ 2012 03709 é©¬å…‹æ€ä¸»ä¹‰åŸºæœ¬åŸç†æ¦‚è®º 2018 04747 Javaè¯­è¨€ç¨‹åºè®¾è®¡ï¼ˆä¸€ï¼‰ 2019 1022/14:30-17:00\n00023 é«˜ç­‰æ•°å­¦ï¼ˆå·¥æœ¬ï¼‰ 2019 00342 é«˜çº§è¯­è¨€ç¨‹åºè®¾è®¡ï¼ˆä¸€ï¼‰2017 02326 æ“ä½œç³»ç»Ÿ 2017 04730 ç”µå­æŠ€æœ¯åŸºç¡€ï¼ˆä¸‰ï¼‰ 2006 04735 æ•°æ®åº“ç³»ç»ŸåŸç† 2018 1023/09:00-11:30\n02325 è®¡ç®—æœºç³»ç»Ÿç»“æ„ 2012 03708 ä¸­å›½è¿‘ç°ä»£å²çº²è¦ 2018 04737 C++ç¨‹åºè®¾è®¡ 2019 1023/14:30-17:00\n0015 è‹±è¯­ï¼ˆäºŒï¼‰2012 02333 è½¯ä»¶å·¥ç¨‹ 2011 04741 è®¡ç®—æœºç½‘ç»œåŸç† 2018 "},{"id":45,"href":"/zh/docs/study/Linux/base/base/","title":"ä¸€äº›åŸºæœ¬æ“ä½œ","section":"åŸºç¡€","content":" yumæºæ›¿æ¢æˆé˜¿é‡Œäº‘ # yum install -y wget ## å¤‡ä»½ mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak ## ä¸‹è½½ wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo ## é‡å»ºç¼“å­˜ yum clean all yum makecache Javaç¯å¢ƒæ­å»º # yum search java | grep jdk yum install -y java-1.8.0-openjdk-devel.x86_64 # java -version æ­£å¸¸ # javac -version æ­£å¸¸ è§£å‹ç›¸å…³ # -zxvf\ntar -zxvf redis* -C /usr/local/redis* # z ï¼šè¡¨ç¤º tar åŒ…æ˜¯è¢« gzip å‹ç¼©è¿‡çš„ (åç¼€æ˜¯.tar.gz)ï¼Œæ‰€ä»¥è§£å‹æ—¶éœ€è¦ç”¨ gunzip è§£å‹ (.tarä¸éœ€è¦) # x ï¼šè¡¨ç¤º ä» tar åŒ…ä¸­æŠŠæ–‡ä»¶æå–å‡ºæ¥ # v ï¼šè¡¨ç¤º æ˜¾ç¤ºæ‰“åŒ…è¿‡ç¨‹è¯¦ç»†ä¿¡æ¯ # f ï¼šæŒ‡å®šè¢«å¤„ç†çš„æ–‡ä»¶æ˜¯ä»€ä¹ˆ # é€‚ç”¨äºå‚æ•°åˆ†å¼€ä½¿ç”¨çš„æƒ…å†µï¼Œè¿ç»­æ— åˆ†éš”å‚æ•°ä¸åº”è¯¥å†ä½¿ç”¨ï¼ˆæ‰€ä»¥ä¸Šé¢çš„å‘½ä»¤ä¸æ ‡å‡†ï¼‰ï¼Œ # åº”è¯¥æ˜¯ tar zxvf redis* -C /usr/local/redis* ä¸»é¢˜ä¿®æ”¹ # oh my zsh\nåœ¨çº¿ # Method Command curl sh -c \u0026quot;$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\u0026quot; wget sh -c \u0026quot;$(wget -O- https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\u0026quot; fetch sh -c \u0026quot;$(fetch -o - https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\u0026quot; æ‰‹åŠ¨å®‰è£… # yum install -y zsh #ä¸€å®šè¦å…ˆè£… sh -c \u0026#34;$(wget https://gitee.com/liu_yi_er/ohmyzsh/raw/master/tools/install.sh -O -)\u0026#34; #è‡ªå·±çš„giteeç›®å½•ï¼Œä»å®˜ç½‘ä¸‹è½½ sh install.sh ä¿®æ”¹ä¸»é¢˜ # //è¯¥ä¸»é¢˜æ ·å¼å¦‚ä¸‹\n$ vi ~/.zshrc # æ‰¾åˆ°è¿™ä¸€è¡Œï¼Œä¿®æ”¹ä¸ºè‡ªå·±å–œæ¬¢çš„ä¸»é¢˜åç§° # ZSH_THEME=\u0026#34;ys\u0026#34; ZSH_THEME=\u0026#34;avit\u0026#34; # ä¿®æ”¹ä¿å­˜åï¼Œä½¿é…ç½®ç”Ÿæ•ˆ $ source ~/.zshrc zsh homeå’Œendå¤±æ•ˆï¼Œå¯ä»¥æ”¹ç”¨ctrl+a / ctrl+e ä»£æ›¿\nVimçš„ä½¿ç”¨å¿«æ·ä½¿ç”¨ # # æ¸…ç©ºæ–‡ä»¶--å‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥ :%d å›è½¦ # å¤„ç†ç²˜è´´æ—¶å¤šå‡ºçš„è¡Œå¸¦#çš„é—®é¢˜-- å‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥ :set paste å†è¾“å…¥iè¿›è¡Œç²˜è´´ #å¿«é€Ÿä¿®æ”¹-- å‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥ :%s/6379/6380/g ï¼ˆå°†æ–‡ä»¶ä¸­æ‰€æœ‰6379æ›¿æ¢æˆ6380ï¼‰ åŸºæœ¬ç½‘ç»œå·¥å…·å®‰è£… # yum install -y net-tools æŸ¥çœ‹ç«¯å£ç›‘å¬æƒ…å†µ\nnetstat -lntup | grep redis è§£é‡Š\n-a (all)æ˜¾ç¤ºæ‰€æœ‰é€‰é¡¹ï¼Œé»˜è®¤ä¸æ˜¾ç¤ºLISTENç›¸å…³ -t (tcp)ä»…æ˜¾ç¤ºtcpç›¸å…³é€‰é¡¹ -u (udp)ä»…æ˜¾ç¤ºudpç›¸å…³é€‰é¡¹ -n æ‹’ç»æ˜¾ç¤ºåˆ«åï¼Œèƒ½æ˜¾ç¤ºæ•°å­—çš„å…¨éƒ¨è½¬åŒ–æˆæ•°å­—ã€‚ -l ä»…åˆ—å‡ºæœ‰åœ¨ Listen (ç›‘å¬) çš„æœå‹™çŠ¶æ€\n-p æ˜¾ç¤ºå»ºç«‹ç›¸å…³é“¾æ¥çš„ç¨‹åºå -r æ˜¾ç¤ºè·¯ç”±ä¿¡æ¯ï¼Œè·¯ç”±è¡¨ -e æ˜¾ç¤ºæ‰©å±•ä¿¡æ¯ï¼Œä¾‹å¦‚uidç­‰ -s æŒ‰å„ä¸ªåè®®è¿›è¡Œç»Ÿè®¡ -c æ¯éš”ä¸€ä¸ªå›ºå®šæ—¶é—´ï¼Œæ‰§è¡Œè¯¥netstatå‘½ä»¤ã€‚\næç¤ºï¼šLISTENå’ŒLISTENINGçš„çŠ¶æ€åªæœ‰ç”¨-aæˆ–è€…-læ‰èƒ½çœ‹åˆ°\npså‘½ä»¤ # ps -ef //-eè¡¨ç¤ºå…¨éƒ¨è¿›ç¨‹ ï¼Œ-fè¡¨ç¤ºå…¨éƒ¨çš„åˆ—\næ ‘å½¢ç»“æ„æŸ¥çœ‹æ–‡ä»¶å¤¹ # yum install -y tree\nå¿«æ·é”® # ctrl+w å¿«é€Ÿåˆ é™¤å…‰æ ‡å‰çš„æ•´ä¸ªå•è¯\nctrl+a å…‰æ ‡ç§»åˆ°è¡Œé¦– [xshell]\nctrl+e å…‰æ ‡ç§»åˆ°è¡Œå°¾ [xshell]\nåˆ›å»ºå¤šçº§ç›®å½• # mkdir -p /usr/local/redis_cluster/redis_63{79,80}/{conf,pid,logs}\n"},{"id":46,"href":"/zh/docs/study/Linux/base/create_clone/","title":"vmwareä¸Šlinuxä¸»æœºçš„å®‰è£…å’Œå…‹éš†","section":"åŸºç¡€","content":" å®‰è£… # è™šæ‹Ÿæœºå‘å¯¼ # å…¸å‹\u0026mdash;ç¨åå®‰è£…\u0026ndash;linux\u0026ndash;RedhatEnterpriseLinux7 64 è™šæ‹Ÿæœºåç§°rheCentos700 æ¥ä¸‹æ¥éƒ½é»˜è®¤å³å¯(20Gç¡¬ç›˜ï¼Œ2Gå†…å­˜ï¼Œç½‘ç»œé€‚é…å™¨(æ¡¥æ¥æ¨¡å¼)) å®‰è£…ç•Œé¢ # æ—¥æœŸ\u0026ndash;äºšæ´²ä¸Šæµ·ï¼Œé”®ç›˜\u0026ndash;æ±‰è¯­ï¼Œè¯­è¨€æ”¯æŒ\u0026ndash;ç®€ä½“ä¸­æ–‡(ä¸­å›½)\nè½¯ä»¶å®‰è£…\næœ€å°å®‰è£…\u0026mdash;\u0026gt; å…¼å®¹æ€§ç¨‹åºåº“+å¼€å‘å·¥å…·\nå…¶ä»–å­˜å‚¨é€‰é¡¹\u0026ndash;é…ç½®åˆ†åŒº\n/boot 1G æ ‡å‡†åˆ†åŒºï¼Œæ–‡ä»¶ç³»ç»Ÿext4 swap 2G æ ‡å‡†åˆ†åŒº ï¼Œæ–‡ä»¶ç³»ç»Ÿswap / 17G æ ‡å‡†åˆ†åŒºï¼Œæ–‡ä»¶ç³»ç»Ÿext4 ç½‘ç»œå’Œä¸»æœºå\næ‰“å¼€ç½‘ç»œ+è®¾ç½®ä¸»æœºå(rheCentos700)\nå®Œæˆ\u0026mdash;è¿‡ç¨‹ä¸­é…ç½®å¯†ç  é»˜è®¤ç”¨æˆ·root+å…¶ä»–ç”¨æˆ·ly\nå®‰è£…å®Œæˆåä¿®æ”¹ipåŠç½‘å…³ # Centos # vi /etc/sysconfig/network-scripts/ifcfg-ens**\nä¿®æ”¹éƒ¨åˆ†é”®å€¼å¯¹\nBOOTPROTO=\u0026#34;static\u0026#34; IPADDR=192.168.1.100 NETMASK=255.255.255.0 GATEWAY=192.168.1.1 DNS1=223.5.5.5 DNS2=223.6.6.6 systemctl restart network\nDebian # æŸ¥çœ‹å½“å‰ç½‘å¡\nip link #1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000 # link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 #2: ens33: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000 # link/ether 00:0c:29:ed:95:f5 brd ff:ff:ff:ff:ff:ff # altname enp2s1 å¾—çŸ¥ç½‘å¡åä¸ºens33\nvim /etc/network/interfaces æ·»åŠ å†…å®¹ï¼Œä¸ºç½‘å¡ï¼ˆens33ï¼‰è®¾ç½®é™æ€ip\n#ly-update auto ens33 iface ens33 inet static address 192.168.1.206 netmask 255.255.255.0 gateway 192.168.1.1 dns-nameservers 223.5.5.5 223.6.6.6 é‡å¯ç½‘ç»œ\nsudo service networking restart æŸ¥çœ‹ip\nip a #---------------------ç»“æœæ˜¾ç¤º 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host noprefixroute valid_lft forever preferred_lft forever 2: ens33: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether 00:0c:xx:xx:23:f5 brd ff:ff:ff:ff:ff:ff altname enp2s1 inet 192.168.1.206/24 brd 192.168.1.255 scope global ens33 valid_lft forever preferred_lft forever inet6 xxxx::20c:29ff:feed:xxxx/64 scope link valid_lft forever preferred_lft forever å…‹éš†è™šæ‹Ÿæœº # å³é”®\u0026ndash;ç®¡ç†\u0026ndash;å…‹éš†\u0026ndash;åˆ›å»ºå®Œæ•´å…‹éš†\nä¿®æ”¹MACã€ä¸»æœºåã€ipã€uuid\nå³é”®\u0026ndash;è®¾ç½®\u0026ndash;ç½‘ç»œé€‚é…å™¨\u0026ndash;é«˜çº§\u0026ndash;MACåœ°å€-\u0026gt;ç”Ÿæˆ\nvi /etc/hostnameä¿®æ”¹ä¸»æœºå\nreboot\nvi /etc/sysconfig/network-scripts/ifcfg-ens**ä¿®æ”¹ipåŠuuid\nuuidè‡ªåŠ¨ç”Ÿæˆ\nå¸¸ç”¨æ“ä½œ # å¸¸ç”¨å‘½ä»¤å®‰è£…\nyum install -y wget yumé˜¿é‡Œäº‘æºåˆ‡æ¢\nå¤‡ä»½mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak ä¸‹è½½å¹¶åˆ‡æ¢wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo æ¸…ç†yum clean all ç¼“å­˜å¤„ç†yum makecache "},{"id":47,"href":"/zh/docs/study/Review/java_guide/database/MySQL/ly0606lymysql-query-execution-plan/","title":"mysqlæ‰§è¡Œè®¡åˆ’","section":"MySQL","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\næœ¬æ–‡æ¥è‡ªå…¬å· MySQL æŠ€æœ¯ï¼ŒJavaGuide å¯¹å…¶åšäº†è¡¥å……å®Œå–„ã€‚åŸæ–‡åœ°å€ï¼šhttps://mp.weixin.qq.com/s/d5OowNLtXBGEAbT31sSH4g\nä¼˜åŒ– SQL çš„ç¬¬ä¸€æ­¥åº”è¯¥æ˜¯è¯»æ‡‚ SQL çš„æ‰§è¡Œè®¡åˆ’ã€‚æœ¬ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥å­¦ä¹ ä¸‹ MySQL EXPLAIN æ‰§è¡Œè®¡åˆ’ç›¸å…³çŸ¥è¯†ã€‚\nä»€ä¹ˆæ˜¯æ‰§è¡Œè®¡åˆ’ï¼Ÿ # æ‰§è¡Œè®¡åˆ’ æ˜¯æŒ‡ä¸€æ¡ SQL è¯­å¥åœ¨ç»è¿‡ MySQL æŸ¥è¯¢ä¼˜åŒ–å™¨ çš„ä¼˜åŒ–ä¼šåï¼Œå…·ä½“çš„æ‰§è¡Œæ–¹å¼ã€‚\næ‰§è¡Œè®¡åˆ’é€šå¸¸ç”¨äº SQL æ€§èƒ½åˆ†æã€ä¼˜åŒ–ç­‰åœºæ™¯ã€‚é€šè¿‡ EXPLAIN çš„ç»“æœï¼Œå¯ä»¥äº†è§£åˆ°å¦‚æ•°æ®è¡¨çš„æŸ¥è¯¢é¡ºåºã€æ•°æ®æŸ¥è¯¢æ“ä½œçš„æ“ä½œç±»å‹ã€å“ªäº›ç´¢å¼•å¯ä»¥è¢«å‘½ä¸­ã€å“ªäº›ç´¢å¼•å®é™…ä¼šå‘½ä¸­ã€æ¯ä¸ªæ•°æ®è¡¨æœ‰å¤šå°‘è¡Œè®°å½•è¢«æŸ¥è¯¢ç­‰ä¿¡æ¯ã€‚\nå¦‚ä½•è·å–æ‰§è¡Œè®¡åˆ’ï¼Ÿ # -- æäº¤å‡†å¤‡æ•°æ® SET NAMES utf8mb4; SET FOREIGN_KEY_CHECKS = 0; -- ---------------------------- -- Table structure for dept_emp -- ---------------------------- DROP TABLE IF EXISTS `dept_emp`; CREATE TABLE `dept_emp` ( `id` int(0) NOT NULL, `emp_no` varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL, `other1` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL, `other2` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL, PRIMARY KEY (`id`) USING BTREE, INDEX `index_emp_no`(`emp_no`) USING BTREE ) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci ROW_FORMAT = Dynamic; -- ---------------------------- -- Records of dept_emp -- ---------------------------- INSERT INTO `dept_emp` VALUES (1, \u0026#39;a1\u0026#39;, \u0026#39;o11\u0026#39;, \u0026#39;012\u0026#39;); INSERT INTO `dept_emp` VALUES (2, \u0026#39;a2\u0026#39;, \u0026#39;o21\u0026#39;, \u0026#39;o22\u0026#39;); INSERT INTO `dept_emp` VALUES (3, \u0026#39;a3\u0026#39;, \u0026#39;o31\u0026#39;, \u0026#39;o32\u0026#39;); INSERT INTO `dept_emp` VALUES (4, \u0026#39;a4\u0026#39;, \u0026#39;o41\u0026#39;, \u0026#39;o42\u0026#39;); INSERT INTO `dept_emp` VALUES (5, \u0026#39;a5\u0026#39;, \u0026#39;o51\u0026#39;, \u0026#39;o52\u0026#39;); SET FOREIGN_KEY_CHECKS = 1; MySQL ä¸ºæˆ‘ä»¬æä¾›äº† EXPLAIN å‘½ä»¤ï¼Œæ¥è·å–æ‰§è¡Œè®¡åˆ’çš„ç›¸å…³ä¿¡æ¯ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒEXPLAIN è¯­å¥å¹¶ä¸ä¼šçœŸçš„å»æ‰§è¡Œç›¸å…³çš„è¯­å¥ï¼Œè€Œæ˜¯é€šè¿‡æŸ¥è¯¢ä¼˜åŒ–å™¨å¯¹è¯­å¥è¿›è¡Œåˆ†æï¼Œæ‰¾å‡ºæœ€ä¼˜çš„æŸ¥è¯¢æ–¹æ¡ˆï¼Œå¹¶æ˜¾ç¤ºå¯¹åº”çš„ä¿¡æ¯ã€‚\nEXPLAIN æ‰§è¡Œè®¡åˆ’æ”¯æŒ SELECTã€DELETEã€INSERTã€REPLACE ä»¥åŠ UPDATE è¯­å¥ã€‚æˆ‘ä»¬ä¸€èˆ¬å¤šç”¨äºåˆ†æ SELECT æŸ¥è¯¢è¯­å¥ï¼Œä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š\nEXPLAIN + SELECT æŸ¥è¯¢è¯­å¥ï¼› æˆ‘ä»¬ç®€å•æ¥çœ‹ä¸‹ä¸€æ¡æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼š\nmysql\u0026gt; explain SELECT * FROM dept_emp WHERE emp_no IN (SELECT emp_no FROM dept_emp GROUP BY emp_no HAVING COUNT(emp_no)\u0026gt;1); +----+-------------+----------+------------+-------+-----------------+---------+---------+------+--------+----------+-------------+ | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra | +----+-------------+----------+------------+-------+-----------------+---------+---------+------+--------+----------+-------------+ | 1 | PRIMARY | dept_emp | NULL | ALL | NULL | NULL | NULL | NULL | 331143 | 100.00 | Using where | | 2 | SUBQUERY | dept_emp | NULL | index | PRIMARY,dept_no | PRIMARY | 16 | NULL | 331143 | 100.00 | Using index | +----+-------------+----------+------------+-------+-----------------+---------+---------+------+--------+----------+-------------+ å¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œè®¡åˆ’ç»“æœä¸­å…±æœ‰ 12 åˆ—ï¼Œå„åˆ—ä»£è¡¨çš„å«ä¹‰æ€»ç»“å¦‚ä¸‹è¡¨ï¼š\nåˆ—å å«ä¹‰ id SELECTæŸ¥è¯¢çš„åºåˆ—æ ‡è¯†ç¬¦ select_type SELECTå…³é”®å­—å¯¹åº”çš„æŸ¥è¯¢ç±»å‹ table ç”¨åˆ°çš„è¡¨å partitions åŒ¹é…çš„åˆ†åŒºï¼Œå¯¹äºæœªåˆ†åŒºçš„è¡¨ï¼Œå€¼ä¸º NULL type è¡¨çš„è®¿é—®æ–¹æ³• possible_keys å¯èƒ½ç”¨åˆ°çš„ç´¢å¼• key å®é™…ç”¨åˆ°çš„ç´¢å¼• key_len æ‰€é€‰ç´¢å¼•çš„é•¿åº¦ ref å½“ä½¿ç”¨ç´¢å¼•ç­‰å€¼æŸ¥è¯¢æ—¶ï¼Œä¸ç´¢å¼•ä½œæ¯”è¾ƒçš„åˆ—æˆ–å¸¸é‡ rows é¢„è®¡è¦è¯»å–çš„è¡Œæ•° filtered æŒ‰è¡¨æ¡ä»¶è¿‡æ»¤åï¼Œç•™å­˜çš„è®°å½•æ•°çš„ç™¾åˆ†æ¯” Extra é™„åŠ ä¿¡æ¯ å¦‚ä½•åˆ†æ EXPLAIN ç»“æœï¼Ÿ # ä¸ºäº†åˆ†æ EXPLAIN è¯­å¥çš„æ‰§è¡Œç»“æœï¼Œæˆ‘ä»¬éœ€è¦ææ‡‚æ‰§è¡Œè®¡åˆ’ä¸­çš„é‡è¦å­—æ®µã€‚\nid # SELECT æ ‡è¯†ç¬¦ï¼Œæ˜¯æŸ¥è¯¢ä¸­ SELECT çš„åºå·ï¼Œç”¨æ¥æ ‡è¯†æ•´ä¸ªæŸ¥è¯¢ä¸­ SELELCT è¯­å¥çš„é¡ºåºã€‚\nid å¦‚æœç›¸åŒï¼Œä»ä¸Šå¾€ä¸‹ä¾æ¬¡æ‰§è¡Œã€‚id ä¸åŒï¼Œid å€¼è¶Šå¤§ï¼Œæ‰§è¡Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œå¦‚æœè¡Œå¼•ç”¨å…¶ä»–è¡Œçš„å¹¶é›†ç»“æœï¼Œåˆ™è¯¥å€¼å¯ä»¥ä¸º NULLã€‚\nselect_type # æŸ¥è¯¢çš„ç±»å‹ï¼Œä¸»è¦ç”¨äºåŒºåˆ†æ™®é€šæŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰å¤æ‚çš„æŸ¥è¯¢ï¼Œå¸¸è§çš„å€¼æœ‰ï¼š\nSIMPLEï¼šç®€å•æŸ¥è¯¢ï¼Œä¸åŒ…å« UNION æˆ–è€…å­æŸ¥è¯¢ã€‚ PRIMARYï¼šæŸ¥è¯¢ä¸­å¦‚æœåŒ…å«å­æŸ¥è¯¢æˆ–å…¶ä»–éƒ¨åˆ†ï¼Œå¤–å±‚çš„ SELECT å°†è¢«æ ‡è®°ä¸º PRIMARYã€‚ SUBQUERYï¼šå­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ª SELECTã€‚ UNIONï¼šåœ¨ UNION è¯­å¥ä¸­ï¼ŒUNION ä¹‹åå‡ºç°çš„ SELECTã€‚ DERIVEDï¼šåœ¨ FROM ä¸­å‡ºç°çš„å­æŸ¥è¯¢å°†è¢«æ ‡è®°ä¸º DERIVEDã€‚ UNION RESULTï¼šUNION æŸ¥è¯¢çš„ç»“æœã€‚ table # æŸ¥è¯¢ç”¨åˆ°çš„è¡¨åï¼Œæ¯è¡Œéƒ½æœ‰å¯¹åº”çš„è¡¨åï¼Œè¡¨åé™¤äº†æ­£å¸¸çš„è¡¨ä¹‹å¤–ï¼Œä¹Ÿå¯èƒ½æ˜¯ä»¥ä¸‹åˆ—å‡ºçš„å€¼ï¼š\n\u0026lt;unionM,N\u0026gt; : æœ¬è¡Œå¼•ç”¨äº† id ä¸º M å’Œ N çš„è¡Œçš„ UNION ç»“æœï¼› \u0026lt;derivedN\u0026gt; : æœ¬è¡Œå¼•ç”¨äº† id ä¸º N çš„è¡¨æ‰€äº§ç”Ÿçš„çš„æ´¾ç”Ÿè¡¨ç»“æœã€‚æ´¾ç”Ÿè¡¨æœ‰å¯èƒ½äº§ç”Ÿè‡ª FROM è¯­å¥ä¸­çš„å­æŸ¥è¯¢ã€‚ -\u0026lt;subqueryN\u0026gt; : æœ¬è¡Œå¼•ç”¨äº† id ä¸º N çš„è¡¨æ‰€äº§ç”Ÿçš„çš„ç‰©åŒ–å­æŸ¥è¯¢ç»“æœã€‚ typeï¼ˆé‡è¦ï¼‰ # æŸ¥è¯¢æ‰§è¡Œçš„ç±»å‹ï¼Œæè¿°äº†æŸ¥è¯¢æ˜¯å¦‚ä½•æ‰§è¡Œçš„ã€‚æ‰€æœ‰å€¼çš„é¡ºåºä»æœ€ä¼˜åˆ°æœ€å·®æ’åºä¸ºï¼šsystem \u0026gt; const \u0026gt; eq_ref \u0026gt; ref \u0026gt; fulltext \u0026gt; ref_or_null \u0026gt; index_merge \u0026gt; unique_subquery \u0026gt; index_subquery \u0026gt; range \u0026gt; index \u0026gt; ALL\nå¸¸è§çš„å‡ ç§ç±»å‹å…·ä½“å«ä¹‰å¦‚ä¸‹ï¼š\nsystemï¼šå¦‚æœè¡¨ä½¿ç”¨çš„å¼•æ“å¯¹äºè¡¨è¡Œæ•°ç»Ÿè®¡æ˜¯ç²¾ç¡®çš„ï¼ˆå¦‚ï¼šMyISAMï¼‰ï¼Œä¸”è¡¨ä¸­åªæœ‰ä¸€è¡Œè®°å½•çš„æƒ…å†µä¸‹ï¼Œè®¿é—®æ–¹æ³•æ˜¯ system ï¼Œæ˜¯ const çš„ä¸€ç§ç‰¹ä¾‹ã€‚ constï¼šè¡¨ä¸­æœ€å¤šåªæœ‰ä¸€è¡ŒåŒ¹é…çš„è®°å½•ï¼Œä¸€æ¬¡æŸ¥è¯¢å°±å¯ä»¥æ‰¾åˆ°ï¼Œå¸¸ç”¨äºä½¿ç”¨ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•çš„æ‰€æœ‰å­—æ®µä½œä¸ºæŸ¥è¯¢æ¡ä»¶ã€‚ eq_refï¼šå½“è¿è¡¨æŸ¥è¯¢æ—¶ï¼Œå‰ä¸€å¼ è¡¨çš„è¡Œåœ¨å½“å‰è¿™å¼ è¡¨ä¸­åªæœ‰ä¸€è¡Œä¸ä¹‹å¯¹åº”ã€‚æ˜¯é™¤äº† system ä¸ const ä¹‹å¤–æœ€å¥½çš„ join æ–¹å¼ï¼Œå¸¸ç”¨äºä½¿ç”¨ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•çš„æ‰€æœ‰å­—æ®µä½œä¸ºè¿è¡¨æ¡ä»¶ã€‚ refï¼šä½¿ç”¨æ™®é€šç´¢å¼•ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼ŒæŸ¥è¯¢ç»“æœå¯èƒ½æ‰¾åˆ°å¤šä¸ªç¬¦åˆæ¡ä»¶çš„è¡Œã€‚ index_mergeï¼šå½“æŸ¥è¯¢æ¡ä»¶ä½¿ç”¨äº†å¤šä¸ªç´¢å¼•æ—¶ï¼Œè¡¨ç¤ºå¼€å¯äº† Index Merge ä¼˜åŒ–ï¼Œæ­¤æ—¶æ‰§è¡Œè®¡åˆ’ä¸­çš„ key åˆ—åˆ—å‡ºäº†ä½¿ç”¨åˆ°çš„ç´¢å¼•ã€‚ rangeï¼šå¯¹ç´¢å¼•åˆ—è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œæ‰§è¡Œè®¡åˆ’ä¸­çš„ key åˆ—è¡¨ç¤ºå“ªä¸ªç´¢å¼•è¢«ä½¿ç”¨äº†ã€‚ indexï¼šæŸ¥è¯¢éå†äº†æ•´æ£µç´¢å¼•æ ‘ï¼Œä¸ ALL ç±»ä¼¼ï¼Œåªä¸è¿‡æ‰«æçš„æ˜¯ç´¢å¼•ï¼Œè€Œç´¢å¼•ä¸€èˆ¬åœ¨å†…å­˜ä¸­ï¼Œé€Ÿåº¦æ›´å¿«ã€‚ ALLï¼šå…¨è¡¨æ‰«æã€‚ possible_keys # possible_keys åˆ—è¡¨ç¤º MySQL æ‰§è¡ŒæŸ¥è¯¢æ—¶å¯èƒ½ç”¨åˆ°çš„ç´¢å¼•ã€‚å¦‚æœè¿™ä¸€åˆ—ä¸º NULL ï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰å¯èƒ½ç”¨åˆ°çš„ç´¢å¼•ï¼›è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦æ£€æŸ¥ WHERE è¯­å¥ä¸­æ‰€ä½¿ç”¨çš„çš„åˆ—ï¼Œçœ‹æ˜¯å¦å¯ä»¥é€šè¿‡ç»™è¿™äº›åˆ—ä¸­æŸä¸ªæˆ–å¤šä¸ªæ·»åŠ ç´¢å¼•çš„æ–¹æ³•æ¥æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚\nkeyï¼ˆé‡è¦ï¼‰ # key åˆ—è¡¨ç¤º MySQL å®é™…ä½¿ç”¨åˆ°çš„ç´¢å¼•ã€‚å¦‚æœä¸º NULLï¼Œåˆ™è¡¨ç¤ºæœªç”¨åˆ°ç´¢å¼•ã€‚\nkey_len # key_len åˆ—è¡¨ç¤º MySQL å®é™…ä½¿ç”¨çš„ç´¢å¼•çš„æœ€å¤§é•¿åº¦ï¼›å½“ä½¿ç”¨åˆ°è”åˆç´¢å¼•æ—¶ï¼Œæœ‰å¯èƒ½æ˜¯å¤šä¸ªåˆ—çš„é•¿åº¦å’Œã€‚åœ¨æ»¡è¶³éœ€æ±‚çš„å‰æä¸‹è¶ŠçŸ­è¶Šå¥½ã€‚å¦‚æœ key åˆ—æ˜¾ç¤º NULL ï¼Œåˆ™ key_len åˆ—ä¹Ÿæ˜¾ç¤º NULL ã€‚\nrows # rows åˆ—è¡¨ç¤ºæ ¹æ®è¡¨ç»Ÿè®¡ä¿¡æ¯åŠé€‰ç”¨æƒ…å†µï¼Œå¤§è‡´ä¼°ç®—å‡ºæ‰¾åˆ°æ‰€éœ€çš„è®°å½•æˆ–æ‰€éœ€è¯»å–çš„è¡Œæ•°ï¼Œæ•°å€¼è¶Šå°è¶Šå¥½ã€‚\nExtraï¼ˆé‡è¦ï¼‰ # è¿™åˆ—åŒ…å«äº† MySQL è§£ææŸ¥è¯¢çš„é¢å¤–ä¿¡æ¯ï¼Œé€šè¿‡è¿™äº›ä¿¡æ¯ï¼Œå¯ä»¥æ›´å‡†ç¡®çš„ç†è§£ MySQL åˆ°åº•æ˜¯å¦‚ä½•æ‰§è¡ŒæŸ¥è¯¢çš„ã€‚å¸¸è§çš„å€¼å¦‚ä¸‹ï¼š\nUsing filesortï¼šåœ¨æ’åºæ—¶ä½¿ç”¨äº†å¤–éƒ¨çš„ç´¢å¼•æ’åºï¼Œæ²¡æœ‰ç”¨åˆ°è¡¨å†…ç´¢å¼•è¿›è¡Œæ’åºã€‚ Using temporaryï¼šMySQL éœ€è¦åˆ›å»ºä¸´æ—¶è¡¨æ¥å­˜å‚¨æŸ¥è¯¢çš„ç»“æœï¼Œå¸¸è§äº ORDER BY å’Œ GROUP BYã€‚ Using indexï¼šè¡¨æ˜æŸ¥è¯¢ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œä¸ç”¨å›è¡¨ï¼ŒæŸ¥è¯¢æ•ˆç‡éå¸¸é«˜ã€‚ Using index conditionï¼šè¡¨ç¤ºæŸ¥è¯¢ä¼˜åŒ–å™¨é€‰æ‹©ä½¿ç”¨äº†ç´¢å¼•æ¡ä»¶ä¸‹æ¨è¿™ä¸ªç‰¹æ€§ã€‚ Using whereï¼šè¡¨æ˜æŸ¥è¯¢ä½¿ç”¨äº† WHERE å­å¥è¿›è¡Œæ¡ä»¶è¿‡æ»¤ã€‚ä¸€èˆ¬åœ¨æ²¡æœ‰ä½¿ç”¨åˆ°ç´¢å¼•çš„æ—¶å€™ä¼šå‡ºç°ã€‚ Using join buffer (Block Nested Loop)ï¼šè¿è¡¨æŸ¥è¯¢çš„æ–¹å¼ï¼Œè¡¨ç¤ºå½“è¢«é©±åŠ¨è¡¨çš„æ²¡æœ‰ä½¿ç”¨ç´¢å¼•çš„æ—¶å€™ï¼ŒMySQL ä¼šå…ˆå°†é©±åŠ¨è¡¨è¯»å‡ºæ¥æ”¾åˆ° join buffer ä¸­ï¼Œå†éå†è¢«é©±åŠ¨è¡¨ä¸é©±åŠ¨è¡¨è¿›è¡ŒæŸ¥è¯¢ã€‚ è¿™é‡Œæé†’ä¸‹ï¼Œå½“ Extra åˆ—åŒ…å« Using filesort æˆ– Using temporary æ—¶ï¼ŒMySQL çš„æ€§èƒ½å¯èƒ½ä¼šå­˜åœ¨é—®é¢˜ï¼Œéœ€è¦å°½å¯èƒ½é¿å…ã€‚\nå‚è€ƒ # https://dev.mysql.com/doc/refman/5.7/en/explain-output.html https://juejin.cn/post/6953444668973514789 "},{"id":48,"href":"/zh/docs/study/Review/java_guide/database/ly0503lysql-question-01/","title":"sqlå¸¸è§é¢è¯•é¢˜æ€»ç»“01","section":"æ•°æ®åº“","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\né¢˜ç›®æ¥æºäºï¼šç‰›å®¢é¢˜éœ¸ - SQL å¿…çŸ¥å¿…ä¼š\næ£€ç´¢æ•°æ® # select ç”¨äºä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®ã€‚\nä» Customers è¡¨ä¸­æ£€ç´¢æ‰€æœ‰çš„ ID # ç°æœ‰è¡¨ Customers å¦‚ä¸‹ï¼š\ncust_id A B C ç¼–å†™ SQL è¯­å¥ï¼Œä» Customers è¡¨ä¸­æ£€ç´¢æ‰€æœ‰çš„ cust_idã€‚\nç­”æ¡ˆï¼š\nselect cust_id from Customers; æ£€ç´¢å¹¶åˆ—å‡ºå·²è®¢è´­äº§å“çš„æ¸…å• # è¡¨ OrderItems å«æœ‰éç©ºçš„åˆ— prod_id ä»£è¡¨å•†å“ idï¼ŒåŒ…å«äº†æ‰€æœ‰å·²è®¢è´­çš„å•†å“ï¼ˆæœ‰äº›å·²è¢«è®¢è´­å¤šæ¬¡ï¼‰ã€‚\nprod_id a1 a2 a3 a4 a5 a6 a7 ç¼–å†™ SQL è¯­å¥ï¼Œæ£€ç´¢å¹¶åˆ—å‡ºæ‰€æœ‰å·²è®¢è´­å•†å“ï¼ˆprod_idï¼‰çš„å»é‡åçš„æ¸…å•ã€‚\nç­”æ¡ˆï¼š\nselect distinct prod_id from OrderItems; çŸ¥è¯†ç‚¹ï¼šdistinct ç”¨äºè¿”å›åˆ—ä¸­çš„å”¯ä¸€ä¸åŒå€¼ã€‚\næ£€ç´¢æ‰€æœ‰åˆ— # ç°åœ¨æœ‰ Customers è¡¨ï¼ˆè¡¨ä¸­å«æœ‰åˆ— cust_id ä»£è¡¨å®¢æˆ· idï¼Œcust_name ä»£è¡¨å®¢æˆ·å§“åï¼‰\ncust_id cust_name a1 andy a2 ben a3 tony a4 tom a5 an a6 lee a7 hex éœ€è¦ç¼–å†™ SQL è¯­å¥ï¼Œæ£€ç´¢æ‰€æœ‰åˆ—ã€‚\nç­”æ¡ˆï¼š\nselect cust_id, cust_name from Customers; æ’åºæ£€ç´¢æ•°æ® # order by ç”¨äºå¯¹ç»“æœé›†æŒ‰ç…§ä¸€ä¸ªåˆ—æˆ–è€…å¤šä¸ªåˆ—è¿›è¡Œæ’åºã€‚é»˜è®¤æŒ‰ç…§å‡åºå¯¹è®°å½•è¿›è¡Œæ’åºï¼Œå¦‚æœéœ€è¦æŒ‰ç…§é™åºå¯¹è®°å½•è¿›è¡Œæ’åºï¼Œå¯ä»¥ä½¿ç”¨ desc å…³é”®å­—ã€‚\næ£€ç´¢é¡¾å®¢åç§°å¹¶ä¸”æ’åº # æœ‰è¡¨ Customersï¼Œcust_id ä»£è¡¨å®¢æˆ· idï¼Œcust_name ä»£è¡¨å®¢æˆ·å§“åã€‚\ncust_id cust_name a1 andy a2 ben a3 tony a4 tom a5 an a6 lee a7 hex ä» Customers ä¸­æ£€ç´¢æ‰€æœ‰çš„é¡¾å®¢åç§°ï¼ˆcust_nameï¼‰ï¼Œå¹¶æŒ‰ä» Z åˆ° A çš„é¡ºåºæ˜¾ç¤ºç»“æœã€‚\nç­”æ¡ˆï¼š\nselect cust_name from Customers order by cust_name desc å¯¹é¡¾å®¢ ID å’Œæ—¥æœŸæ’åº # æœ‰ Orders è¡¨ï¼š\ncust_id order_num order_date andy aaaa 2021-01-01 00:00:00 andy bbbb 2021-01-01 12:00:00 bob cccc 2021-01-10 12:00:00 dick dddd 2021-01-11 00:00:00 ç¼–å†™ SQL è¯­å¥ï¼Œä» Orders è¡¨ä¸­æ£€ç´¢é¡¾å®¢ IDï¼ˆcust_idï¼‰å’Œè®¢å•å·ï¼ˆorder_numï¼‰ï¼Œå¹¶å…ˆæŒ‰é¡¾å®¢ ID å¯¹ç»“æœè¿›è¡Œæ’åºï¼Œå†æŒ‰è®¢å•æ—¥æœŸå€’åºæ’åˆ—ã€‚\nç­”æ¡ˆï¼š\n# æ ¹æ®åˆ—åæ’åº # æ³¨æ„ï¼šæ˜¯ order_date é™åºï¼Œè€Œä¸æ˜¯ order_num select cust_id, order_num from Orders order by cust_id, order_date desc; çŸ¥è¯†ç‚¹ï¼šorder by å¯¹å¤šåˆ—æ’åºçš„æ—¶å€™ï¼Œå…ˆæ’åºçš„åˆ—æ”¾å‰é¢ï¼Œåæ’åºçš„åˆ—æ”¾åé¢ã€‚å¹¶ä¸”ï¼Œä¸åŒçš„åˆ—å¯ä»¥æœ‰ä¸åŒçš„æ’åºè§„åˆ™ã€‚\næŒ‰ç…§æ•°é‡å’Œä»·æ ¼æ’åº # å‡è®¾æœ‰ä¸€ä¸ª OrderItems è¡¨ï¼š\nquantity item_price 1 100 10 1003 2 500 ç¼–å†™ SQL è¯­å¥ï¼Œæ˜¾ç¤º OrderItems è¡¨ä¸­çš„æ•°é‡ï¼ˆquantityï¼‰å’Œä»·æ ¼ï¼ˆitem_priceï¼‰ï¼Œå¹¶æŒ‰æ•°é‡ç”±å¤šåˆ°å°‘ã€ä»·æ ¼ç”±é«˜åˆ°ä½æ’åºã€‚\nç­”æ¡ˆï¼š\nselect quantity, item_price from OrderItems order by quantity desc, item_price desc; æ£€æŸ¥ SQL è¯­å¥ # æœ‰ Vendors è¡¨ï¼š\nvend_name æµ·åº•æ å°é¾™å å¤§é¾™ç‡š ä¸‹é¢çš„ SQL è¯­å¥æœ‰é—®é¢˜å—ï¼Ÿå°è¯•å°†å®ƒæ”¹æ­£ç¡®ï¼Œä½¿ä¹‹èƒ½å¤Ÿæ­£ç¡®è¿è¡Œï¼Œå¹¶ä¸”è¿”å›ç»“æœæ ¹æ®vend_name é€†åºæ’åˆ—ã€‚\nSELECT vend_name, FROM Vendors ORDER vend_name DESC; æ”¹æ­£åï¼š\nselect vend_name from Vendors order by vend_name desc; çŸ¥è¯†ç‚¹ï¼š\né€—å·ä½œç”¨æ˜¯ç”¨æ¥éš”å¼€åˆ—ä¸åˆ—ä¹‹é—´çš„ã€‚ order by æ˜¯æœ‰ by çš„ï¼Œéœ€è¦æ’°å†™å®Œæ•´ï¼Œä¸”ä½ç½®æ­£ç¡®ã€‚ è¿‡æ»¤æ•°æ® # where å¯ä»¥è¿‡æ»¤è¿”å›çš„æ•°æ®ã€‚\nä¸‹é¢çš„è¿ç®—ç¬¦å¯ä»¥åœ¨ where å­å¥ä¸­ä½¿ç”¨ï¼š\nè¿ç®—ç¬¦ æè¿° = ç­‰äº \u0026lt;\u0026gt; ä¸ç­‰äºã€‚**æ³¨é‡Šï¼š**åœ¨ SQL çš„ä¸€äº›ç‰ˆæœ¬ä¸­ï¼Œè¯¥æ“ä½œç¬¦å¯è¢«å†™æˆ != \u0026gt; å¤§äº \u0026lt; å°äº \u0026gt;= å¤§äºç­‰äº \u0026lt;= å°äºç­‰äº BETWEEN åœ¨æŸä¸ªèŒƒå›´å†… LIKE æœç´¢æŸç§æ¨¡å¼ IN æŒ‡å®šé’ˆå¯¹æŸä¸ªåˆ—çš„å¤šä¸ªå¯èƒ½å€¼ è¿”å›å›ºå®šä»·æ ¼çš„äº§å“ # æœ‰è¡¨ Products ï¼š\nprod_id prod_name prod_price a0018 sockets 9.49 a0019 iphone13 600 b0018 gucci t-shirts 1000 ã€é—®é¢˜ã€‘ä» Products è¡¨ä¸­æ£€ç´¢äº§å“ IDï¼ˆprod_idï¼‰å’Œäº§å“åç§°ï¼ˆprod_nameï¼‰ï¼Œåªè¿”å›ä»·æ ¼ä¸º 9.49 ç¾å…ƒçš„äº§å“ã€‚\nç­”æ¡ˆï¼š\nselect prod_id, prod_name from Products where prod_price = 9.49; è¿”å›æ›´é«˜ä»·æ ¼çš„äº§å“ # æœ‰è¡¨ Products ï¼š\nprod_id prod_name prod_price a0018 sockets 9.49 a0019 iphone13 600 b0019 gucci t-shirts 1000 ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œä» Products è¡¨ä¸­æ£€ç´¢äº§å“ IDï¼ˆprod_idï¼‰å’Œäº§å“åç§°ï¼ˆprod_nameï¼‰ï¼Œåªè¿”å›ä»·æ ¼ä¸º 9 ç¾å…ƒæˆ–æ›´é«˜çš„äº§å“ã€‚\nç­”æ¡ˆï¼š\nselect prod_id, prod_name from Products where prod_price \u0026gt;= 9; è¿”å›äº§å“å¹¶ä¸”æŒ‰ç…§ä»·æ ¼æ’åº # æœ‰è¡¨ Products ï¼š\nprod_id prod_name prod_price a0011 egg 3 a0019 sockets 4 b0019 coffee 15 ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œè¿”å› Products è¡¨ä¸­æ‰€æœ‰ä»·æ ¼åœ¨ 3 ç¾å…ƒåˆ° 6 ç¾å…ƒä¹‹é—´çš„äº§å“çš„åç§°ï¼ˆprod_nameï¼‰å’Œä»·æ ¼ï¼ˆprod_priceï¼‰ï¼Œç„¶åæŒ‰ä»·æ ¼å¯¹ç»“æœè¿›è¡Œæ’åºã€‚\nç­”æ¡ˆï¼š\nselect prod_name, prod_price from Products where prod_price between 3 and 6 order by prod_price; # æˆ–è€… select prod_name, prod_price from Products where prod_price \u0026gt;= 3 and prod_price \u0026lt;= 6 order by prod_price; è¿”å›æ›´å¤šçš„äº§å“ # OrderItems è¡¨å«æœ‰ï¼šè®¢å•å· order_numï¼Œquantityäº§å“æ•°é‡\norder_num quantity a1 105 a2 1100 a2 200 a4 1121 a5 10 a2 19 a7 5 ã€é—®é¢˜ã€‘ä» OrderItems è¡¨ä¸­æ£€ç´¢å‡ºæ‰€æœ‰ä¸åŒä¸”ä¸é‡å¤çš„è®¢å•å·ï¼ˆorder_numï¼‰ï¼Œå…¶ä¸­æ¯ä¸ªè®¢å•éƒ½è¦åŒ…å« 100 ä¸ªæˆ–æ›´å¤šçš„äº§å“ã€‚\nç­”æ¡ˆï¼š\nselect distinct order_num from OrderItems where quantity \u0026gt;= 100; é«˜çº§æ•°æ®è¿‡æ»¤ # and å’Œ or è¿ç®—ç¬¦ç”¨äºåŸºäºä¸€ä¸ªä»¥ä¸Šçš„æ¡ä»¶å¯¹è®°å½•è¿›è¡Œè¿‡æ»¤ï¼Œä¸¤è€…å¯ä»¥ç»“åˆä½¿ç”¨ã€‚and å¿…é¡» 2 ä¸ªæ¡ä»¶éƒ½æˆç«‹ï¼Œoråªè¦ 2 ä¸ªæ¡ä»¶ä¸­çš„ä¸€ä¸ªæˆç«‹å³å¯ã€‚\næ£€ç´¢ä¾›åº”å•†åç§° # Vendors è¡¨æœ‰å­—æ®µä¾›åº”å•†åç§°ï¼ˆvend_nameï¼‰ã€ä¾›åº”å•†å›½å®¶ï¼ˆvend_countryï¼‰ã€ä¾›åº”å•†å·ï¼ˆvend_stateï¼‰\nvend_name vend_country vend_state apple USA CA vivo CNA shenzhen huawei CNA xian ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œä» Vendors è¡¨ä¸­æ£€ç´¢ä¾›åº”å•†åç§°ï¼ˆvend_nameï¼‰ï¼Œä»…è¿”å›åŠ åˆ©ç¦å°¼äºšå·çš„ä¾›åº”å•†ï¼ˆè¿™éœ€è¦æŒ‰å›½å®¶[USA]å’Œå·[CA]è¿›è¡Œè¿‡æ»¤ï¼Œæ²¡å‡†å…¶ä»–å›½å®¶ä¹Ÿå­˜åœ¨ä¸€ä¸ª CAï¼‰\nç­”æ¡ˆï¼š\nselect vend_name from Vendors where vend_country = \u0026#39;USA\u0026#39; and vend_state = \u0026#39;CA\u0026#39;; æ£€ç´¢å¹¶åˆ—å‡ºå·²è®¢è´­äº§å“çš„æ¸…å• # OrderItems è¡¨åŒ…å«äº†æ‰€æœ‰å·²è®¢è´­çš„äº§å“ï¼ˆæœ‰äº›å·²è¢«è®¢è´­å¤šæ¬¡ï¼‰ã€‚\nprod_id order_num quantity BR01 a1 105 BR02 a2 1100 BR02 a2 200 BR03 a4 1121 BR017 a5 10 BR02 a2 19 BR017 a7 5 ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼ŒæŸ¥æ‰¾æ‰€æœ‰è®¢è´­äº†æ•°é‡è‡³å°‘ 100 ä¸ªçš„ BR01ã€BR02 æˆ– BR03 çš„è®¢å•ã€‚ä½ éœ€è¦è¿”å› OrderItems è¡¨çš„è®¢å•å·ï¼ˆorder_numï¼‰ã€äº§å“ IDï¼ˆprod_idï¼‰å’Œæ•°é‡ï¼ˆquantityï¼‰ï¼Œå¹¶æŒ‰äº§å“ ID å’Œæ•°é‡è¿›è¡Œè¿‡æ»¤ã€‚\nç­”æ¡ˆï¼š\nselect order_num, prod_id, quantity from OrderItems where quantity \u0026gt;= 100 and prod_id in(\u0026#39;BR01\u0026#39;, \u0026#39;BR02\u0026#39;, \u0026#39;BR03\u0026#39;); è¿”å›æ‰€æœ‰ä»·æ ¼åœ¨ 3 ç¾å…ƒåˆ° 6 ç¾å…ƒä¹‹é—´çš„äº§å“çš„åç§°å’Œä»·æ ¼ # æœ‰è¡¨ Productsï¼š\nprod_id prod_name prod_price a0011 egg 3 a0019 sockets 4 b0019 coffee 15 ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œè¿”å›æ‰€æœ‰ä»·æ ¼åœ¨ 3 ç¾å…ƒåˆ° 6 ç¾å…ƒä¹‹é—´çš„äº§å“çš„åç§°ï¼ˆprod_nameï¼‰å’Œä»·æ ¼ï¼ˆprod_priceï¼‰ï¼Œä½¿ç”¨ AND æ“ä½œç¬¦ï¼Œç„¶åæŒ‰ä»·æ ¼å¯¹ç»“æœè¿›è¡Œå‡åºæ’åºã€‚\nç­”æ¡ˆï¼š\nselect prod_name, prod_price from Products where prod_price between 3 and 6 order by prod_price; æ£€æŸ¥ SQL è¯­å¥ # ä¾›åº”å•†è¡¨ Vendors æœ‰å­—æ®µä¾›åº”å•†åç§° vend_nameã€ä¾›åº”å•†å›½å®¶ vend_countryã€ä¾›åº”å•†çœä»½ vend_state\nvend_name vend_country vend_state apple USA CA vivo CNA shenzhen huawei CNA xian ã€é—®é¢˜ã€‘ä¿®æ”¹æ­£ç¡®ä¸‹é¢ sqlï¼Œä½¿ä¹‹æ­£ç¡®è¿”å›ã€‚\nSELECT vend_name FROM Vendors ORDER BY vend_name WHERE vend_country = \u0026#39;USA\u0026#39; AND vend_state = \u0026#39;CA\u0026#39;; ä¿®æ”¹åï¼š\nselect vend_name from Vendors where vend_country = \u0026#39;USA\u0026#39; and vend_state = \u0026#39;CA\u0026#39; order by vend_name; order by è¯­å¥å¿…é¡»æ”¾åœ¨ where ä¹‹åã€‚\nç”¨é€šé…ç¬¦è¿›è¡Œè¿‡æ»¤ # SQL é€šé…ç¬¦å¿…é¡»ä¸ LIKE è¿ç®—ç¬¦ä¸€èµ·ä½¿ç”¨\nåœ¨ SQL ä¸­ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹é€šé…ç¬¦ï¼š\né€šé…ç¬¦ æè¿° % ä»£è¡¨é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ _ ä»…æ›¿ä»£ä¸€ä¸ªå­—ç¬¦ [charlist] å­—ç¬¦åˆ—ä¸­çš„ä»»ä½•å•ä¸€å­—ç¬¦ [^charlist] æˆ–è€… [!charlist] ä¸åœ¨å­—ç¬¦åˆ—ä¸­çš„ä»»ä½•å•ä¸€å­—ç¬¦ æ£€ç´¢äº§å“åç§°å’Œæè¿°ï¼ˆä¸€ï¼‰ # Products è¡¨å¦‚ä¸‹ï¼š\nprod_name prod_desc a0011 usb a0019 iphone13 b0019 gucci t-shirts c0019 gucci toy d0019 lego toy ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œä» Products è¡¨ä¸­æ£€ç´¢äº§å“åç§°ï¼ˆprod_nameï¼‰å’Œæè¿°ï¼ˆprod_descï¼‰ï¼Œä»…è¿”å›æè¿°ä¸­åŒ…å« toy ä¸€è¯çš„äº§å“åç§°ã€‚\nç­”æ¡ˆï¼š\nselect prod_name, prod_desc from Products where prod_desc like \u0026#39;%toy%\u0026#39;; æ£€ç´¢äº§å“åç§°å’Œæè¿°ï¼ˆäºŒï¼‰ # Products è¡¨å¦‚ä¸‹ï¼š\nprod_name prod_desc a0011 usb a0019 iphone13 b0019 gucci t-shirts c0019 gucci toy d0019 lego toy ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œä» Products è¡¨ä¸­æ£€ç´¢äº§å“åç§°ï¼ˆprod_nameï¼‰å’Œæè¿°ï¼ˆprod_descï¼‰ï¼Œä»…è¿”å›æè¿°ä¸­æœªå‡ºç° toy ä¸€è¯çš„äº§å“ï¼Œæœ€åæŒ‰â€äº§å“åç§°â€œå¯¹ç»“æœè¿›è¡Œæ’åºã€‚\nç­”æ¡ˆï¼š\nselect prod_name, prod_desc from Products where prod_desc not like \u0026#39;%toy%\u0026#39; order by prod_name; æ£€ç´¢äº§å“åç§°å’Œæè¿°ï¼ˆä¸‰ï¼‰ # Products è¡¨å¦‚ä¸‹ï¼š\nprod_name prod_desc a0011 usb a0019 iphone13 b0019 gucci t-shirts c0019 gucci toy d0019 lego carrots toy ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œä» Products è¡¨ä¸­æ£€ç´¢äº§å“åç§°ï¼ˆprod_nameï¼‰å’Œæè¿°ï¼ˆprod_descï¼‰ï¼Œä»…è¿”å›æè¿°ä¸­åŒæ—¶å‡ºç° toy å’Œ carrots çš„äº§å“ã€‚æœ‰å¥½å‡ ç§æ–¹æ³•å¯ä»¥æ‰§è¡Œæ­¤æ“ä½œï¼Œä½†å¯¹äºè¿™ä¸ªæŒ‘æˆ˜é¢˜ï¼Œè¯·ä½¿ç”¨ AND å’Œä¸¤ä¸ª LIKE æ¯”è¾ƒã€‚\nç­”æ¡ˆï¼š\nselect prod_name, prod_desc from Products where prod_desc like \u0026#39;%toy%\u0026#39; and prod_desc like \u0026#34;%carrots%\u0026#34;; æ£€ç´¢äº§å“åç§°å’Œæè¿°ï¼ˆå››ï¼‰ # Products è¡¨å¦‚ä¸‹ï¼š\nprod_name prod_desc a0011 usb a0019 iphone13 b0019 gucci t-shirts c0019 gucci toy d0019 lego toy carrots ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œä» Products è¡¨ä¸­æ£€ç´¢äº§å“åç§°ï¼ˆprod_nameï¼‰å’Œæè¿°ï¼ˆprod_descï¼‰ï¼Œä»…è¿”å›åœ¨æè¿°ä¸­ä»¥å…ˆåé¡ºåºåŒæ—¶å‡ºç° toy å’Œ carrots çš„äº§å“ã€‚æç¤ºï¼šåªéœ€è¦ç”¨å¸¦æœ‰ä¸‰ä¸ª % ç¬¦å·çš„ LIKE å³å¯ã€‚\nç­”æ¡ˆï¼š\nselect prod_name, prod_desc from Products where prod_desc like \u0026#39;%toy%carrots%\u0026#39;; åˆ›å»ºè®¡ç®—å­—æ®µ # åˆ«å # åˆ«åçš„å¸¸è§ç”¨æ³•æ˜¯åœ¨æ£€ç´¢å‡ºçš„ç»“æœä¸­é‡å‘½åè¡¨çš„åˆ—å­—æ®µï¼ˆä¸ºäº†ç¬¦åˆç‰¹å®šçš„æŠ¥è¡¨è¦æ±‚æˆ–å®¢æˆ·éœ€æ±‚ï¼‰ã€‚æœ‰è¡¨ Vendors ä»£è¡¨ä¾›åº”å•†ä¿¡æ¯ï¼Œvend_id ä¾›åº”å•† idã€vend_name ä¾›åº”å•†åç§°ã€vend_address ä¾›åº”å•†åœ°å€ã€vend_city ä¾›åº”å•†åŸå¸‚ã€‚\nvend_id vend_name vend_address vend_city a001 tencent cloud address1 shenzhen a002 huawei cloud address2 dongguan a003 aliyun cloud address3 hangzhou a003 netease cloud address4 guangzhou ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œä» Vendors è¡¨ä¸­æ£€ç´¢ vend_idã€vend_nameã€vend_address å’Œ vend_cityï¼Œå°† vend_name é‡å‘½åä¸º vnameï¼Œå°† vend_city é‡å‘½åä¸º vcityï¼Œå°† vend_address é‡å‘½åä¸º vaddressï¼ŒæŒ‰ä¾›åº”å•†åç§°å¯¹ç»“æœè¿›è¡Œå‡åºæ’åºã€‚\nç­”æ¡ˆï¼š\nselect vend_id, vend_name as vname, vend_address as vaddress, vend_city as vcity from Vendors order by vname; # as å¯ä»¥çœç•¥ select vend_id, vend_name vname, vend_address vaddress, vend_city vcity from Vendors order by vname; æ‰“æŠ˜ # æˆ‘ä»¬çš„ç¤ºä¾‹å•†åº—æ­£åœ¨è¿›è¡Œæ‰“æŠ˜ä¿ƒé”€ï¼Œæ‰€æœ‰äº§å“å‡é™ä»· 10%ã€‚Products è¡¨åŒ…å« prod_id äº§å“ idã€prod_price äº§å“ä»·æ ¼ã€‚\nã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œä» Products è¡¨ä¸­è¿”å› prod_idã€prod_price å’Œ sale_priceã€‚sale_price æ˜¯ä¸€ä¸ªåŒ…å«ä¿ƒé”€ä»·æ ¼çš„è®¡ç®—å­—æ®µã€‚æç¤ºï¼šå¯ä»¥ä¹˜ä»¥ 0.9ï¼Œå¾—åˆ°åŸä»·çš„ 90%ï¼ˆå³ 10%çš„æŠ˜æ‰£ï¼‰ã€‚\nç­”æ¡ˆï¼š\nselect prod_id, prod_price, prod_price * 0.9 as sale_price from Products; æ³¨æ„ï¼šsale_price æ˜¯å¯¹è®¡ç®—ç»“æœçš„å‘½åï¼Œè€Œä¸æ˜¯åŸæœ‰çš„åˆ—åã€‚\nä½¿ç”¨å‡½æ•°å¤„ç†æ•°æ® # é¡¾å®¢ç™»å½•å # æˆ‘ä»¬çš„å•†åº—å·²ç»ä¸Šçº¿äº†ï¼Œæ­£åœ¨åˆ›å»ºé¡¾å®¢è´¦æˆ·ã€‚æ‰€æœ‰ç”¨æˆ·éƒ½éœ€è¦ç™»å½•åï¼Œé»˜è®¤ç™»å½•åæ˜¯å…¶åç§°å’Œæ‰€åœ¨åŸå¸‚çš„ç»„åˆã€‚\nç»™å‡º Customers è¡¨ å¦‚ä¸‹ï¼š\ncust_id cust_name cust_contact cust_city a1 Andy Li Andy Li Oak Park a2 Ben Liu Ben Liu Oak Park a3 Tony Dai Tony Dai Oak Park a4 Tom Chen Tom Chen Oak Park a5 An Li An Li Oak Park a6 Lee Chen Lee Chen Oak Park a7 Hex Liu Hex Liu Oak Park ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œè¿”å›é¡¾å®¢ IDï¼ˆcust_idï¼‰ã€é¡¾å®¢åç§°ï¼ˆcust_nameï¼‰å’Œç™»å½•åï¼ˆuser_loginï¼‰ï¼Œå…¶ä¸­ç™»å½•åå…¨éƒ¨ä¸ºå¤§å†™å­—æ¯ï¼Œå¹¶ç”±é¡¾å®¢è”ç³»äººçš„å‰ä¸¤ä¸ªå­—ç¬¦ï¼ˆcust_contactï¼‰å’Œå…¶æ‰€åœ¨åŸå¸‚çš„å‰ä¸‰ä¸ªå­—ç¬¦ï¼ˆcust_cityï¼‰ç»„æˆã€‚æç¤ºï¼šéœ€è¦ä½¿ç”¨å‡½æ•°ã€æ‹¼æ¥å’Œåˆ«åã€‚\nç­”æ¡ˆï¼š\nselect cust_id, cust_name, upper(concat(substring(cust_contact, 1, 2), substring(cust_city, 1, 3))) as user_login from Customers; çŸ¥è¯†ç‚¹ï¼š\næˆªå–å‡½æ•°substring()ï¼šæˆªå–å­—ç¬¦ä¸²ï¼Œsubstring(str ,n ,m)ï¼šè¿”å›å­—ç¬¦ä¸² str ä»ç¬¬ n ä¸ªå­—ç¬¦æˆªå–åˆ°ç¬¬ m ä¸ªå­—ç¬¦ï¼ˆå·¦é—­å³é—­ï¼‰ï¼›\nè¿”å›å­—ç¬¦ä¸² str ä»ç¬¬ n ä¸ªå­—ç¬¦æˆªå– m ä¸ªå­—ç¬¦ï¼ˆå·¦é—­å³é—­ï¼‰\næ‹¼æ¥å‡½æ•°concat()ï¼šå°†ä¸¤ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸²è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œselect concat(A,B) ï¼šè¿æ¥å­—ç¬¦ä¸² A å’Œ Bã€‚\nå¤§å†™å‡½æ•° upper()ï¼šå°†æŒ‡å®šå­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™ã€‚\nè¿”å› 2020 å¹´ 1 æœˆçš„æ‰€æœ‰è®¢å•çš„è®¢å•å·å’Œè®¢å•æ—¥æœŸ # Orders è®¢å•è¡¨å¦‚ä¸‹ï¼š\norder_num order_date a0001 2020-01-01 00:00:00 a0002 2020-01-02 00:00:00 a0003 2020-01-01 12:00:00 a0004 2020-02-01 00:00:00 a0005 2020-03-01 00:00:00 ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œè¿”å› 2020 å¹´ 1 æœˆçš„æ‰€æœ‰è®¢å•çš„è®¢å•å·ï¼ˆorder_numï¼‰å’Œè®¢å•æ—¥æœŸï¼ˆorder_dateï¼‰ï¼Œå¹¶æŒ‰è®¢å•æ—¥æœŸå‡åºæ’åº\nç­”æ¡ˆï¼š\nselect order_num, order_date from Orders where month(order_date) = \u0026#39;01\u0026#39; and year(order_date) = \u0026#39;2020\u0026#39; order by order_date; ä¹Ÿå¯ä»¥ç”¨é€šé…ç¬¦æ¥åšï¼š\nselect order_num, order_date from Orders where order_date like \u0026#39;2020-01%\u0026#39; order by order_date; çŸ¥è¯†ç‚¹ï¼š\næ—¥æœŸæ ¼å¼ï¼šYYYY-MM-DD æ—¶é—´æ ¼å¼ï¼šHH:MM:SS æ—¥æœŸå’Œæ—¶é—´å¤„ç†ç›¸å…³çš„å¸¸ç”¨å‡½æ•°ï¼š\nå‡½ æ•° è¯´ æ˜ adddate() å¢åŠ ä¸€ä¸ªæ—¥æœŸï¼ˆå¤©ã€å‘¨ç­‰ï¼‰ addtime() å¢åŠ ä¸€ä¸ªæ—¶é—´ï¼ˆæ—¶ã€åˆ†ç­‰ï¼‰ curdate() è¿”å›å½“å‰æ—¥æœŸ curtime() è¿”å›å½“å‰æ—¶é—´ date() è¿”å›æ—¥æœŸæ—¶é—´çš„æ—¥æœŸéƒ¨åˆ† datediff() è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹å·® date_format() è¿”å›ä¸€ä¸ªæ ¼å¼åŒ–çš„æ—¥æœŸæˆ–æ—¶é—´ä¸² day() è¿”å›ä¸€ä¸ªæ—¥æœŸçš„å¤©æ•°éƒ¨åˆ† dayofweek() å¯¹äºä¸€ä¸ªæ—¥æœŸï¼Œè¿”å›å¯¹åº”çš„æ˜ŸæœŸå‡  hour() è¿”å›ä¸€ä¸ªæ—¶é—´çš„å°æ—¶éƒ¨åˆ† minute() è¿”å›ä¸€ä¸ªæ—¶é—´çš„åˆ†é’Ÿéƒ¨åˆ† month() è¿”å›ä¸€ä¸ªæ—¥æœŸçš„æœˆä»½éƒ¨åˆ† now() è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´ second() è¿”å›ä¸€ä¸ªæ—¶é—´çš„ç§’éƒ¨åˆ† time() è¿”å›ä¸€ä¸ªæ—¥æœŸæ—¶é—´çš„æ—¶é—´éƒ¨åˆ† year() è¿”å›ä¸€ä¸ªæ—¥æœŸçš„å¹´ä»½éƒ¨åˆ† æ±‡æ€»æ•°æ® # æ±‡æ€»æ•°æ®ç›¸å…³çš„å‡½æ•°ï¼š\nå‡½ æ•° è¯´ æ˜ avg() è¿”å›æŸåˆ—çš„å¹³å‡å€¼ count() è¿”å›æŸåˆ—çš„è¡Œæ•° max() è¿”å›æŸåˆ—çš„æœ€å¤§å€¼ min() è¿”å›æŸåˆ—çš„æœ€å°å€¼ sum() è¿”å›æŸåˆ—å€¼ä¹‹å’Œ ç¡®å®šå·²å”®å‡ºäº§å“çš„æ€»æ•° # OrderItems è¡¨ä»£è¡¨å”®å‡ºçš„äº§å“ï¼Œquantity ä»£è¡¨å”®å‡ºå•†å“æ•°é‡ã€‚\nquantity 10 100 1000 10001 2 15 ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œç¡®å®šå·²å”®å‡ºäº§å“çš„æ€»æ•°ã€‚\nç­”æ¡ˆï¼š\nselect sum(quantity) as items_ordered from OrderItems; ç¡®å®šå·²å”®å‡ºäº§å“é¡¹ BR01 çš„æ€»æ•° # OrderItems è¡¨ä»£è¡¨å”®å‡ºçš„äº§å“ï¼Œquantity ä»£è¡¨å”®å‡ºå•†å“æ•°é‡ï¼Œäº§å“é¡¹ä¸º prod_idã€‚\nquantity prod_id 10 AR01 100 AR10 1000 BR01 10001 BR010 ã€é—®é¢˜ã€‘ä¿®æ”¹åˆ›å»ºçš„è¯­å¥ï¼Œç¡®å®šå·²å”®å‡ºäº§å“é¡¹ï¼ˆprod_idï¼‰ä¸º\u0026quot;BR01\u0026quot;çš„æ€»æ•°ã€‚\nç­”æ¡ˆï¼š\nselect sum(quantity) as items_ordered from OrderItems where prod_id = \u0026#39;BR01\u0026#39;; ç¡®å®š Products è¡¨ä¸­ä»·æ ¼ä¸è¶…è¿‡ 10 ç¾å…ƒçš„æœ€è´µäº§å“çš„ä»·æ ¼ # Products è¡¨å¦‚ä¸‹ï¼Œprod_price ä»£è¡¨å•†å“çš„ä»·æ ¼ã€‚\nprod_price 9.49 600 1000 ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œç¡®å®š Products è¡¨ä¸­ä»·æ ¼ä¸è¶…è¿‡ 10 ç¾å…ƒçš„æœ€è´µäº§å“çš„ä»·æ ¼ï¼ˆprod_priceï¼‰ã€‚å°†è®¡ç®—æ‰€å¾—çš„å­—æ®µå‘½åä¸º max_priceã€‚\nç­”æ¡ˆï¼š\nselect max(prod_price) as max_price from Products where prod_price \u0026lt;= 10; åˆ†ç»„æ•°æ® # group by ï¼š\ngroup by å­å¥å°†è®°å½•åˆ†ç»„åˆ°æ±‡æ€»è¡Œä¸­ã€‚ group by ä¸ºæ¯ä¸ªç»„è¿”å›ä¸€ä¸ªè®°å½•ã€‚ group by é€šå¸¸è¿˜æ¶‰åŠèšåˆcountï¼Œmaxï¼Œsumï¼Œavg ç­‰ã€‚ group by å¯ä»¥æŒ‰ä¸€åˆ—æˆ–å¤šåˆ—è¿›è¡Œåˆ†ç»„ã€‚ group by æŒ‰åˆ†ç»„å­—æ®µè¿›è¡Œæ’åºåï¼Œorder by å¯ä»¥ä»¥æ±‡æ€»å­—æ®µæ¥è¿›è¡Œæ’åºã€‚ havingï¼š\nhaving ç”¨äºå¯¹æ±‡æ€»çš„ group by ç»“æœè¿›è¡Œè¿‡æ»¤ã€‚ having å¿…é¡»è¦ä¸ group by è¿ç”¨ã€‚ where å’Œ having å¯ä»¥åœ¨ç›¸åŒçš„æŸ¥è¯¢ä¸­ã€‚ having vs whereï¼š\nwhereï¼šè¿‡æ»¤è¿‡æ»¤æŒ‡å®šçš„è¡Œï¼Œåé¢ä¸èƒ½åŠ èšåˆå‡½æ•°ï¼ˆåˆ†ç»„å‡½æ•°ï¼‰ã€‚ havingï¼šè¿‡æ»¤åˆ†ç»„ï¼Œå¿…é¡»è¦ä¸ group by è¿ç”¨ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ã€‚ è¿”å›æ¯ä¸ªè®¢å•å·å„æœ‰å¤šå°‘è¡Œæ•° # OrderItems è¡¨åŒ…å«æ¯ä¸ªè®¢å•çš„æ¯ä¸ªäº§å“\norder_num a002 a002 a002 a004 a007 ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œè¿”å›æ¯ä¸ªè®¢å•å·ï¼ˆorder_numï¼‰å„æœ‰å¤šå°‘è¡Œæ•°ï¼ˆorder_linesï¼‰ï¼Œå¹¶æŒ‰ order_lines å¯¹ç»“æœè¿›è¡Œå‡åºæ’åºã€‚\nç­”æ¡ˆï¼š\nselect order_num, count(order_num) as order_lines from OrderItems group by order_num order by order_lines; çŸ¥è¯†ç‚¹ï¼š\ncount(*),count(åˆ—å)éƒ½å¯ä»¥ï¼ŒåŒºåˆ«åœ¨äºï¼Œcount(åˆ—å)æ˜¯ç»Ÿè®¡é NULL çš„è¡Œæ•°ï¼› order by æœ€åæ‰§è¡Œï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨åˆ—åˆ«åï¼› åˆ†ç»„èšåˆä¸€å®šä¸è¦å¿˜è®°åŠ ä¸Š group by ,ä¸ç„¶åªä¼šæœ‰ä¸€è¡Œç»“æœã€‚ æ¯ä¸ªä¾›åº”å•†æˆæœ¬æœ€ä½çš„äº§å“ # æœ‰ Products è¡¨ï¼Œå«æœ‰å­—æ®µ prod_price ä»£è¡¨äº§å“ä»·æ ¼ï¼Œvend_id ä»£è¡¨ä¾›åº”å•† id\nvend_id prod_price a0011 100 a0019 0.1 b0019 1000 b0019 6980 b0019 20 ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œè¿”å›åä¸º cheapest_item çš„å­—æ®µï¼Œè¯¥å­—æ®µåŒ…å«æ¯ä¸ªä¾›åº”å•†æˆæœ¬æœ€ä½çš„äº§å“ï¼ˆä½¿ç”¨ Products è¡¨ä¸­çš„ prod_priceï¼‰ï¼Œç„¶åä»æœ€ä½æˆæœ¬åˆ°æœ€é«˜æˆæœ¬å¯¹ç»“æœè¿›è¡Œå‡åºæ’åºã€‚\nç­”æ¡ˆï¼š\nselect vend_id, min(prod_price) as cheapest_item from Products group by vend_id order by cheapest_item; è¿”å›è®¢å•æ•°é‡æ€»å’Œä¸å°äº 100 çš„æ‰€æœ‰è®¢å•çš„è®¢å•å· # OrderItems ä»£è¡¨è®¢å•å•†å“è¡¨ï¼ŒåŒ…æ‹¬ï¼šè®¢å•å· order_num å’Œè®¢å•æ•°é‡ quantityã€‚\norder_num quantity a1 105 a2 1100 a2 200 a4 1121 a5 10 a2 19 a7 5 ã€é—®é¢˜ã€‘è¯·ç¼–å†™ SQL è¯­å¥ï¼Œè¿”å›è®¢å•æ•°é‡æ€»å’Œä¸å°äº 100 çš„æ‰€æœ‰è®¢å•å·ï¼Œæœ€åç»“æœæŒ‰ç…§è®¢å•å·å‡åºæ’åºã€‚\nç­”æ¡ˆï¼š\n# ç›´æ¥èšåˆ select order_num from OrderItems group by order_num having sum(quantity) \u0026gt;= 100 order by order_num; # å­æŸ¥è¯¢ select order_num from (select order_num, sum(quantity) as sum_num from OrderItems group by order_num having sum_num \u0026gt;= 100 ) a order by order_num; çŸ¥è¯†ç‚¹ï¼š\nwhereï¼šè¿‡æ»¤è¿‡æ»¤æŒ‡å®šçš„è¡Œï¼Œåé¢ä¸èƒ½åŠ èšåˆå‡½æ•°ï¼ˆåˆ†ç»„å‡½æ•°ï¼‰ã€‚ havingï¼šè¿‡æ»¤åˆ†ç»„ï¼Œä¸ group by è¿ç”¨ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ã€‚ è®¡ç®—æ€»å’Œ # OrderItems è¡¨ä»£è¡¨è®¢å•ä¿¡æ¯ï¼ŒåŒ…æ‹¬å­—æ®µï¼šè®¢å•å· order_num å’Œ item_price å•†å“å”®å‡ºä»·æ ¼ã€quantity å•†å“æ•°é‡ã€‚\norder_num item_price quantity a1 10 105 a2 1 1100 a2 1 200 a4 2 1121 a5 5 10 a2 1 19 a7 7 5 ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œæ ¹æ®è®¢å•å·èšåˆï¼Œè¿”å›è®¢å•æ€»ä»·ä¸å°äº 1000 çš„æ‰€æœ‰è®¢å•å·ï¼Œæœ€åçš„ç»“æœæŒ‰è®¢å•å·è¿›è¡Œå‡åºæ’åºã€‚\næç¤ºï¼šæ€»ä»· = item_price ä¹˜ä»¥ quantity\nç­”æ¡ˆï¼š\nselect order_num, sum(item_price * quantity) as total_price from OrderItems group by order_num having total_price \u0026gt;= 1000 order by order_num; æ£€æŸ¥ SQL è¯­å¥ # OrderItems è¡¨å«æœ‰ order_num è®¢å•å·\norder_num a002 a002 a002 a004 a007 ã€é—®é¢˜ã€‘å°†ä¸‹é¢ä»£ç ä¿®æ”¹æ­£ç¡®åæ‰§è¡Œ\nSELECT order_num, COUNT(*) AS items FROM OrderItems GROUP BY items HAVING COUNT(*) \u0026gt;= 3 ORDER BY items, order_num; ä¿®æ”¹åï¼š\nSELECT order_num, COUNT(*) AS items FROM OrderItems GROUP BY order_num HAVING items \u0026gt;= 3 ORDER BY items, order_num; ä½¿ç”¨å­æŸ¥è¯¢ # å­æŸ¥è¯¢æ˜¯åµŒå¥—åœ¨è¾ƒå¤§æŸ¥è¯¢ä¸­çš„ SQL æŸ¥è¯¢ï¼Œä¹Ÿç§°å†…éƒ¨æŸ¥è¯¢æˆ–å†…éƒ¨é€‰æ‹©ï¼ŒåŒ…å«å­æŸ¥è¯¢çš„è¯­å¥ä¹Ÿç§°ä¸ºå¤–éƒ¨æŸ¥è¯¢æˆ–å¤–éƒ¨é€‰æ‹©ã€‚ç®€å•æ¥è¯´ï¼Œå­æŸ¥è¯¢å°±æ˜¯æŒ‡å°†ä¸€ä¸ª select æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ï¼‰çš„ç»“æœä½œä¸ºå¦ä¸€ä¸ª SQL è¯­å¥ï¼ˆä¸»æŸ¥è¯¢ï¼‰çš„æ•°æ®æ¥æºæˆ–è€…åˆ¤æ–­æ¡ä»¶ã€‚\nå­æŸ¥è¯¢å¯ä»¥åµŒå…¥ selectã€insertã€update å’Œ delete è¯­å¥ä¸­ï¼Œä¹Ÿå¯ä»¥å’Œ =ã€\u0026lt;ã€\u0026gt;ã€inã€betweenã€exists ç­‰è¿ç®—ç¬¦ä¸€èµ·ä½¿ç”¨ã€‚\nå­æŸ¥è¯¢å¸¸ç”¨åœ¨ where å­å¥å’Œ from å­å¥åè¾¹ï¼š\nå½“ç”¨äº where å­å¥æ—¶ï¼Œæ ¹æ®ä¸åŒçš„è¿ç®—ç¬¦ï¼Œå­æŸ¥è¯¢å¯ä»¥è¿”å›å•è¡Œå•åˆ—ã€å¤šè¡Œå•åˆ—ã€å•è¡Œå¤šåˆ—æ•°æ®ã€‚å­æŸ¥è¯¢å°±æ˜¯è¦è¿”å›èƒ½å¤Ÿä½œä¸º WHERE å­å¥æŸ¥è¯¢æ¡ä»¶çš„å€¼ã€‚ å½“ç”¨äº from å­å¥æ—¶ï¼Œä¸€èˆ¬è¿”å›å¤šè¡Œå¤šåˆ—æ•°æ®ï¼Œç›¸å½“äºè¿”å›ä¸€å¼ ä¸´æ—¶è¡¨ï¼Œè¿™æ ·æ‰ç¬¦åˆ from åé¢æ˜¯è¡¨çš„è§„åˆ™ã€‚è¿™ç§åšæ³•èƒ½å¤Ÿå®ç°å¤šè¡¨è”åˆæŸ¥è¯¢ã€‚ æ³¨æ„ï¼šMySQL æ•°æ®åº“ä» 4.1 ç‰ˆæœ¬æ‰å¼€å§‹æ”¯æŒå­æŸ¥è¯¢ï¼Œæ—©æœŸç‰ˆæœ¬æ˜¯ä¸æ”¯æŒçš„ã€‚\nç”¨äº where å­å¥çš„å­æŸ¥è¯¢çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š\nselect column_name [, column_name ] from table1 [, table2 ] where column_name operator (select column_name [, column_name ] from table1 [, table2 ] [where]) å­æŸ¥è¯¢éœ€è¦æ”¾åœ¨æ‹¬å·( )å†…ã€‚ operator è¡¨ç¤ºç”¨äº where å­å¥çš„è¿ç®—ç¬¦ã€‚ ç”¨äº from å­å¥çš„å­æŸ¥è¯¢çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š\nselect column_name [, column_name ] from (select column_name [, column_name ] from table1 [, table2 ] [where]) as temp_table_name where condition ç”¨äº from çš„å­æŸ¥è¯¢è¿”å›çš„ç»“æœç›¸å½“äºä¸€å¼ ä¸´æ—¶è¡¨ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ AS å…³é”®å­—ä¸ºè¯¥ä¸´æ—¶è¡¨èµ·ä¸€ä¸ªåå­—ã€‚\nè¿”å›è´­ä¹°ä»·æ ¼ä¸º 10 ç¾å…ƒæˆ–ä»¥ä¸Šäº§å“çš„é¡¾å®¢åˆ—è¡¨ # OrderItems` è¡¨ç¤ºè®¢å•å•†å“è¡¨ï¼Œå«æœ‰å­—æ®µ è®¢å•å·ï¼š`order_num`ã€ è®¢å•ä»·æ ¼ï¼š`item_price`ï¼› `Orders` è¡¨ä»£è¡¨è®¢å•ä¿¡æ¯è¡¨ï¼Œå«æœ‰ é¡¾å®¢ `idï¼šcust_id` å’Œ è®¢å•å·ï¼š`order_num OrderItems è¡¨:\norder_num item_price a1 10 a2 1 a2 1 a4 2 a5 5 a2 1 a7 7 Orders è¡¨ï¼š\norder_num cust_id a1 cust10 a2 cust1 a2 cust1 a4 cust2 a5 cust5 a2 cust1 a7 cust7 ã€é—®é¢˜ã€‘ä½¿ç”¨å­æŸ¥è¯¢ï¼Œè¿”å›è´­ä¹°ä»·æ ¼ä¸º 10 ç¾å…ƒæˆ–ä»¥ä¸Šäº§å“çš„é¡¾å®¢åˆ—è¡¨ï¼Œç»“æœæ— éœ€æ’åºã€‚\nç­”æ¡ˆï¼š\nselect cust_id from Orders where order_num in ( select order_num from OrderItems group by order_num having sum(item_price) \u0026gt;= 10 ); ç¡®å®šå“ªäº›è®¢å•è´­ä¹°äº† prod_id ä¸º BR01 çš„äº§å“ï¼ˆä¸€ï¼‰ # è¡¨ OrderItems ä»£è¡¨è®¢å•å•†å“ä¿¡æ¯è¡¨ï¼Œprod_id ä¸ºäº§å“ idï¼›Orders è¡¨ä»£è¡¨è®¢å•è¡¨æœ‰ cust_id ä»£è¡¨é¡¾å®¢ id å’Œè®¢å•æ—¥æœŸ order_date\nOrderItems è¡¨ï¼š\nprod_id order_num BR01 a0001 BR01 a0002 BR02 a0003 BR02 a0013 Orders è¡¨ï¼š\norder_num cust_id order_date a0001 cust10 2022-01-01 00:00:00 a0002 cust1 2022-01-01 00:01:00 a0003 cust1 2022-01-02 00:00:00 a0013 cust2 2022-01-01 00:20:00 ã€é—®é¢˜ã€‘\nç¼–å†™ SQL è¯­å¥ï¼Œä½¿ç”¨å­æŸ¥è¯¢æ¥ç¡®å®šå“ªäº›è®¢å•ï¼ˆåœ¨ OrderItems ä¸­ï¼‰è´­ä¹°äº† prod_id ä¸º \u0026ldquo;BR01\u0026rdquo; çš„äº§å“ï¼Œç„¶åä» Orders è¡¨ä¸­è¿”å›æ¯ä¸ªäº§å“å¯¹åº”çš„é¡¾å®¢ IDï¼ˆcust_idï¼‰å’Œè®¢å•æ—¥æœŸï¼ˆorder_dateï¼‰ï¼ŒæŒ‰è®¢è´­æ—¥æœŸå¯¹ç»“æœè¿›è¡Œå‡åºæ’åºã€‚\nç­”æ¡ˆï¼š\n# å†™æ³• 1ï¼šå­æŸ¥è¯¢ select cust_id, order_date from Orders where order_num in ( select order_num from OrderItems where prod_id = \u0026#39;BR01\u0026#39; ) order by order_date; # å†™æ³• 2: è¿æ¥è¡¨ select b.cust_id, b.order_date from OrderItems a, Orders b where a.order_num = b.order_num and a.prod_id = \u0026#39;BR01\u0026#39; order by order_date; è¿”å›è´­ä¹° prod_id ä¸º BR01 çš„äº§å“çš„æ‰€æœ‰é¡¾å®¢çš„ç”µå­é‚®ä»¶ï¼ˆä¸€ï¼‰ # ä½ æƒ³çŸ¥é“è®¢è´­ BR01 äº§å“çš„æ—¥æœŸï¼Œæœ‰è¡¨ OrderItems ä»£è¡¨è®¢å•å•†å“ä¿¡æ¯è¡¨ï¼Œprod_id ä¸ºäº§å“ idï¼›Orders è¡¨ä»£è¡¨è®¢å•è¡¨æœ‰ cust_id ä»£è¡¨é¡¾å®¢ id å’Œè®¢å•æ—¥æœŸ order_dateï¼›Customers è¡¨å«æœ‰ cust_email é¡¾å®¢é‚®ä»¶å’Œ cust_id é¡¾å®¢ id\nOrderItems è¡¨ï¼š\nprod_id order_num BR01 a0001 BR01 a0002 BR02 a0003 BR02 a0013 Orders è¡¨ï¼š\norder_num cust_id order_date a0001 cust10 2022-01-01 00:00:00 a0002 cust1 2022-01-01 00:01:00 a0003 cust1 2022-01-02 00:00:00 a0013 cust2 2022-01-01 00:20:00 Customers è¡¨ä»£è¡¨é¡¾å®¢ä¿¡æ¯ï¼Œcust_id ä¸ºé¡¾å®¢ idï¼Œcust_email ä¸ºé¡¾å®¢ email\ncust_id cust_email cust10 cust10@cust.com cust1 cust1@cust.com cust2 cust2@cust.com ã€é—®é¢˜ã€‘è¿”å›è´­ä¹° prod_id ä¸º BR01 çš„äº§å“çš„æ‰€æœ‰é¡¾å®¢çš„ç”µå­é‚®ä»¶ï¼ˆCustomers è¡¨ä¸­çš„ cust_emailï¼‰ï¼Œç»“æœæ— éœ€æ’åºã€‚\næç¤ºï¼šè¿™æ¶‰åŠ SELECT è¯­å¥ï¼Œæœ€å†…å±‚çš„ä» OrderItems è¡¨è¿”å› order_numï¼Œä¸­é—´çš„ä» Customers è¡¨è¿”å› cust_idã€‚\nç­”æ¡ˆï¼š\n# å†™æ³• 1ï¼šå­æŸ¥è¯¢ select cust_email from Customers where cust_id in ( select cust_id from Orders where order_num in ( select order_num from OrderItems where prod_id = \u0026#39;BR01\u0026#39; ) ); # å†™æ³• 2: è¿æ¥è¡¨ï¼ˆinner joinï¼‰ select c.cust_email from OrderItems a, Orders b, Customers c where a.order_num = b.order_num and b.cust_id = c.cust_id and a.prod_id = \u0026#39;BR01\u0026#39;; # å†™æ³• 3ï¼šè¿æ¥è¡¨ï¼ˆleft joinï¼‰ select c.cust_email from Orders a left join OrderItems b on a.order_num = b.order_num left join Customers c on a.cust_id = c.cust_id where b.prod_id = \u0026#39;BR01\u0026#39;; è¿”å›æ¯ä¸ªé¡¾å®¢ä¸åŒè®¢å•çš„æ€»é‡‘é¢ # æˆ‘ä»¬éœ€è¦ä¸€ä¸ªé¡¾å®¢ ID åˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«ä»–ä»¬å·²è®¢è´­çš„æ€»é‡‘é¢ã€‚\nOrderItems è¡¨ä»£è¡¨è®¢å•ä¿¡æ¯ï¼ŒOrderItems è¡¨æœ‰è®¢å•å·ï¼šorder_num å’Œå•†å“å”®å‡ºä»·æ ¼ï¼šitem_priceã€å•†å“æ•°é‡ï¼šquantityã€‚\norder_num item_price quantity a0001 10 105 a0002 1 1100 a0002 1 200 a0013 2 1121 a0003 5 10 a0003 1 19 a0003 7 5 Orders` è¡¨è®¢å•å·ï¼š`order_num`ã€é¡¾å®¢ idï¼š`cust_id order_num cust_id a0001 cust10 a0002 cust1 a0003 cust1 a0013 cust2 ã€é—®é¢˜ã€‘\nç¼–å†™ SQL è¯­å¥ï¼Œè¿”å›é¡¾å®¢ IDï¼ˆOrders è¡¨ä¸­çš„ cust_idï¼‰ï¼Œå¹¶ä½¿ç”¨å­æŸ¥è¯¢è¿”å› total_ordered ä»¥ä¾¿è¿”å›æ¯ä¸ªé¡¾å®¢çš„è®¢å•æ€»æ•°ï¼Œå°†ç»“æœæŒ‰é‡‘é¢ä»å¤§åˆ°å°æ’åºã€‚\nç­”æ¡ˆï¼š\n# å†™æ³• 1ï¼šå­æŸ¥è¯¢ SELECT o.cust_id cust_id, tb.total_ordered total_ordered FROM ( SELECT order_num, SUM(item_price * quantity) total_ordered FROM OrderItems GROUP BY order_num ) as tb, Orders o WHERE tb.order_num = o.order_num ORDER BY total_ordered DESC; # å†™æ³• 2ï¼šè¿æ¥è¡¨ select b.cust_id, sum(a.quantity * a.item_price) as total_ordered from OrderItems a, Orders b where a.order_num = b.order_num group by cust_id order by total_ordered desc; ä» Products è¡¨ä¸­æ£€ç´¢æ‰€æœ‰çš„äº§å“åç§°ä»¥åŠå¯¹åº”çš„é”€å”®æ€»æ•° # Products` è¡¨ä¸­æ£€ç´¢æ‰€æœ‰çš„äº§å“åç§°ï¼š`prod_name`ã€äº§å“ idï¼š`prod_id prod_id prod_name a0001 egg a0002 sockets a0013 coffee a0003 cola OrderItems` ä»£è¡¨è®¢å•å•†å“è¡¨ï¼Œè®¢å•äº§å“ï¼š`prod_id`ã€å”®å‡ºæ•°é‡ï¼š`quantity prod_id quantity a0001 105 a0002 1100 a0002 200 a0013 1121 a0003 10 a0003 19 a0003 5 ã€é—®é¢˜ã€‘\nç¼–å†™ SQL è¯­å¥ï¼Œä» Products è¡¨ä¸­æ£€ç´¢æ‰€æœ‰çš„äº§å“åç§°ï¼ˆprod_nameï¼‰ï¼Œä»¥åŠåä¸º quant_sold çš„è®¡ç®—åˆ—ï¼Œå…¶ä¸­åŒ…å«æ‰€å”®äº§å“çš„æ€»æ•°ï¼ˆåœ¨ OrderItems è¡¨ä¸Šä½¿ç”¨å­æŸ¥è¯¢å’Œ SUM(quantity) æ£€ç´¢ï¼‰ã€‚\nç­”æ¡ˆï¼š\n# å†™æ³• 1ï¼šå­æŸ¥è¯¢ select p.prod_name, tb.quant_sold from ( select prod_id, sum(quantity) as quant_sold from OrderItems group by prod_id ) as tb, Products p where tb.prod_id = p.prod_id; # å†™æ³• 2ï¼šè¿æ¥è¡¨ select p.prod_name, sum(o.quantity) as quant_sold from Products p, OrderItems o where p.prod_id = o.prod_id group by p.prod_name;ï¼ˆè¿™é‡Œä¸èƒ½ç”¨ p.prod_idï¼Œä¼šæŠ¥é”™ï¼‰ è¿æ¥è¡¨ # JOIN æ˜¯â€œè¿æ¥â€çš„æ„æ€ï¼Œé¡¾åæ€ä¹‰ï¼ŒSQL JOIN å­å¥ç”¨äºå°†ä¸¤ä¸ªæˆ–è€…å¤šä¸ªè¡¨è”åˆèµ·æ¥è¿›è¡ŒæŸ¥è¯¢ã€‚\nè¿æ¥è¡¨æ—¶éœ€è¦åœ¨æ¯ä¸ªè¡¨ä¸­é€‰æ‹©ä¸€ä¸ªå­—æ®µï¼Œå¹¶å¯¹è¿™äº›å­—æ®µçš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå€¼ç›¸åŒçš„ä¸¤æ¡è®°å½•å°†åˆå¹¶ä¸ºä¸€æ¡ã€‚è¿æ¥è¡¨çš„æœ¬è´¨å°±æ˜¯å°†ä¸åŒè¡¨çš„è®°å½•åˆå¹¶èµ·æ¥ï¼Œå½¢æˆä¸€å¼ æ–°è¡¨ã€‚å½“ç„¶ï¼Œè¿™å¼ æ–°è¡¨åªæ˜¯ä¸´æ—¶çš„ï¼Œå®ƒä»…å­˜åœ¨äºæœ¬æ¬¡æŸ¥è¯¢æœŸé—´ã€‚\nä½¿ç”¨ JOIN è¿æ¥ä¸¤ä¸ªè¡¨çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š\nselect table1.column1, table2.column2... from table1 join table2 on table1.common_column1 = table2.common_column2; table1.common_column1 = table2.common_column2 æ˜¯è¿æ¥æ¡ä»¶ï¼Œåªæœ‰æ»¡è¶³æ­¤æ¡ä»¶çš„è®°å½•æ‰ä¼šåˆå¹¶ä¸ºä¸€è¡Œã€‚æ‚¨å¯ä»¥ä½¿ç”¨å¤šä¸ªè¿ç®—ç¬¦æ¥è¿æ¥è¡¨ï¼Œä¾‹å¦‚ =ã€\u0026gt;ã€\u0026lt;ã€\u0026lt;\u0026gt;ã€\u0026lt;=ã€\u0026gt;=ã€!=ã€betweenã€like æˆ–è€… notï¼Œä½†æ˜¯æœ€å¸¸è§çš„æ˜¯ä½¿ç”¨ =ã€‚\nå½“ä¸¤ä¸ªè¡¨ä¸­æœ‰åŒåçš„å­—æ®µæ—¶ï¼Œä¸ºäº†å¸®åŠ©æ•°æ®åº“å¼•æ“åŒºåˆ†æ˜¯å“ªä¸ªè¡¨çš„å­—æ®µï¼Œåœ¨ä¹¦å†™åŒåå­—æ®µåæ—¶éœ€è¦åŠ ä¸Šè¡¨åã€‚å½“ç„¶ï¼Œå¦‚æœä¹¦å†™çš„å­—æ®µååœ¨ä¸¤ä¸ªè¡¨ä¸­æ˜¯å”¯ä¸€çš„ï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä»¥ä¸Šæ ¼å¼ï¼Œåªå†™å­—æ®µåå³å¯ã€‚\nå¦å¤–ï¼Œå¦‚æœä¸¤å¼ è¡¨çš„å…³è”å­—æ®µåç›¸åŒï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ USINGå­å¥æ¥ä»£æ›¿ ONï¼Œä¸¾ä¸ªä¾‹å­ï¼š\n# join....on select c.cust_name, o.order_num from Customers c inner join Orders o on c.cust_id = o.cust_id order by c.cust_name; # å¦‚æœä¸¤å¼ è¡¨çš„å…³è”å­—æ®µåç›¸åŒï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨USINGå­å¥ï¼šjoin....using() select c.cust_name, o.order_num from Customers c inner join Orders o using(cust_id) order by c.cust_name; ON å’Œ WHERE çš„åŒºåˆ«ï¼š\nè¿æ¥è¡¨æ—¶ï¼ŒSQL ä¼šæ ¹æ®è¿æ¥æ¡ä»¶ç”Ÿæˆä¸€å¼ æ–°çš„ä¸´æ—¶è¡¨ã€‚ON å°±æ˜¯è¿æ¥æ¡ä»¶ï¼Œå®ƒå†³å®šä¸´æ—¶è¡¨çš„ç”Ÿæˆã€‚ WHERE æ˜¯åœ¨ä¸´æ—¶è¡¨ç”Ÿæˆä»¥åï¼Œå†å¯¹ä¸´æ—¶è¡¨ä¸­çš„æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œç”Ÿæˆæœ€ç»ˆçš„ç»“æœé›†ï¼Œè¿™ä¸ªæ—¶å€™å·²ç»æ²¡æœ‰ JOIN-ON äº†ã€‚ æ‰€ä»¥æ€»ç»“æ¥è¯´å°±æ˜¯ï¼šSQL å…ˆæ ¹æ® ON ç”Ÿæˆä¸€å¼ ä¸´æ—¶è¡¨ï¼Œç„¶åå†æ ¹æ® WHERE å¯¹ä¸´æ—¶è¡¨è¿›è¡Œç­›é€‰ã€‚\nSQL å…è®¸åœ¨ JOIN å·¦è¾¹åŠ ä¸Šä¸€äº›ä¿®é¥°æ€§çš„å…³é”®è¯ï¼Œä»è€Œå½¢æˆä¸åŒç±»å‹çš„è¿æ¥ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š\nè¿æ¥ç±»å‹ è¯´æ˜ INNER JOIN å†…è¿æ¥ ï¼ˆé»˜è®¤è¿æ¥æ–¹å¼ï¼‰åªæœ‰å½“ä¸¤ä¸ªè¡¨éƒ½å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„è®°å½•æ—¶æ‰ä¼šè¿”å›è¡Œã€‚ LEFT JOIN / LEFT OUTER JOIN å·¦(å¤–)è¿æ¥ è¿”å›å·¦è¡¨ä¸­çš„æ‰€æœ‰è¡Œï¼Œå³ä½¿å³è¡¨ä¸­æ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚ RIGHT JOIN / RIGHT OUTER JOIN å³(å¤–)è¿æ¥ è¿”å›å³è¡¨ä¸­çš„æ‰€æœ‰è¡Œï¼Œå³ä½¿å·¦è¡¨ä¸­æ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚ FULL JOIN / FULL OUTER JOIN å…¨(å¤–)è¿æ¥ åªè¦å…¶ä¸­æœ‰ä¸€ä¸ªè¡¨å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå°±è¿”å›è¡Œã€‚ SELF JOIN å°†ä¸€ä¸ªè¡¨è¿æ¥åˆ°è‡ªèº«ï¼Œå°±åƒè¯¥è¡¨æ˜¯ä¸¤ä¸ªè¡¨ä¸€æ ·ã€‚ä¸ºäº†åŒºåˆ†ä¸¤ä¸ªè¡¨ï¼Œåœ¨ SQL è¯­å¥ä¸­éœ€è¦è‡³å°‘é‡å‘½åä¸€ä¸ªè¡¨ã€‚ CROSS JOIN äº¤å‰è¿æ¥ï¼Œä»ä¸¤ä¸ªæˆ–è€…å¤šä¸ªè¿æ¥è¡¨ä¸­è¿”å›è®°å½•é›†çš„ç¬›å¡å°”ç§¯ã€‚ ä¸‹å›¾å±•ç¤ºäº† LEFT JOINã€RIGHT JOINã€INNER JOINã€OUTER JOIN ç›¸å…³çš„ 7 ç§ç”¨æ³•ã€‚\nå¦‚æœä¸åŠ ä»»ä½•ä¿®é¥°è¯ï¼Œåªå†™ JOINï¼Œé‚£ä¹ˆé»˜è®¤ä¸º INNER JOIN\nå¯¹äº INNER JOIN æ¥è¯´ï¼Œè¿˜æœ‰ä¸€ç§éšå¼çš„å†™æ³•ï¼Œç§°ä¸º â€œéšå¼å†…è¿æ¥â€ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ INNER JOIN å…³é”®å­—ï¼Œä½¿ç”¨ WHERE è¯­å¥å®ç°å†…è¿æ¥çš„åŠŸèƒ½\n# éšå¼å†…è¿æ¥ select c.cust_name, o.order_num from Customers c, Orders o where c.cust_id = o.cust_id order by c.cust_name; # æ˜¾å¼å†…è¿æ¥ select c.cust_name, o.order_num from Customers c inner join Orders o using(cust_id) order by c.cust_name; è¿”å›é¡¾å®¢åç§°å’Œç›¸å…³è®¢å•å· # Customers` è¡¨æœ‰å­—æ®µé¡¾å®¢åç§° `cust_name`ã€é¡¾å®¢ id `cust_id cust_id cust_name cust10 andy cust1 ben cust2 tony cust22 tom cust221 an cust2217 hex Orders è®¢å•ä¿¡æ¯è¡¨ï¼Œå«æœ‰å­—æ®µ order_num è®¢å•å·ã€cust_id é¡¾å®¢ id\norder_num cust_id a1 cust10 a2 cust1 a3 cust2 a4 cust22 a5 cust221 a7 cust2217 ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œè¿”å› Customers è¡¨ä¸­çš„é¡¾å®¢åç§°ï¼ˆcust_nameï¼‰å’Œ Orders è¡¨ä¸­çš„ç›¸å…³è®¢å•å·ï¼ˆorder_numï¼‰ï¼Œå¹¶æŒ‰é¡¾å®¢åç§°å†æŒ‰è®¢å•å·å¯¹ç»“æœè¿›è¡Œå‡åºæ’åºã€‚ä½ å¯ä»¥å°è¯•ç”¨ä¸¤ä¸ªä¸åŒçš„å†™æ³•ï¼Œä¸€ä¸ªä½¿ç”¨ç®€å•çš„ç­‰è¿æ¥è¯­æ³•ï¼Œå¦å¤–ä¸€ä¸ªä½¿ç”¨ INNER JOINã€‚\nç­”æ¡ˆï¼š\n# éšå¼å†…è¿æ¥ select c.cust_name, o.order_num from Customers c, Orders o where c.cust_id = o.cust_id order by c.cust_name; # æ˜¾å¼å†…è¿æ¥ select c.cust_name, o.order_num from Customers c inner join Orders o using(cust_id) order by c.cust_name; è¿”å›é¡¾å®¢åç§°å’Œç›¸å…³è®¢å•å·ä»¥åŠæ¯ä¸ªè®¢å•çš„æ€»ä»· # Customers` è¡¨æœ‰å­—æ®µï¼Œé¡¾å®¢åç§°ï¼š`cust_name`ã€é¡¾å®¢ idï¼š`cust_id cust_id cust_name cust10 andy cust1 ben cust2 tony cust22 tom cust221 an cust2217 hex Orders` è®¢å•ä¿¡æ¯è¡¨ï¼Œå«æœ‰å­—æ®µï¼Œè®¢å•å·ï¼š`order_num`ã€é¡¾å®¢ idï¼š`cust_id order_num cust_id a1 cust10 a2 cust1 a3 cust2 a4 cust22 a5 cust221 a7 cust2217 OrderItems` è¡¨æœ‰å­—æ®µï¼Œå•†å“è®¢å•å·ï¼š`order_num`ã€å•†å“æ•°é‡ï¼š`quantity`ã€å•†å“ä»·æ ¼ï¼š`item_price order_num quantity item_price a1 1000 10 a2 200 10 a3 10 15 a4 25 50 a5 15 25 a7 7 7 ã€é—®é¢˜ã€‘é™¤äº†è¿”å›é¡¾å®¢åç§°å’Œè®¢å•å·ï¼Œè¿”å› Customers è¡¨ä¸­çš„é¡¾å®¢åç§°ï¼ˆcust_nameï¼‰å’Œ Orders è¡¨ä¸­çš„ç›¸å…³è®¢å•å·ï¼ˆorder_numï¼‰ï¼Œæ·»åŠ ç¬¬ä¸‰åˆ— OrderTotalï¼Œå…¶ä¸­åŒ…å«æ¯ä¸ªè®¢å•çš„æ€»ä»·ï¼Œå¹¶æŒ‰é¡¾å®¢åç§°å†æŒ‰è®¢å•å·å¯¹ç»“æœè¿›è¡Œå‡åºæ’åºã€‚\n# ç®€å•çš„ç­‰è¿æ¥è¯­æ³• select c.cust_name, o.order_num, sum(quantity * item_price) as OrderTotal from Customers c, Orders o, OrderItems oi where c.cust_id = o.cust_id and o.order_num = oi.order_num group by c.cust_name, o.order_num order by c.cust_name, o.order_num; æ³¨æ„ï¼Œå¯èƒ½æœ‰å°ä¼™ä¼´ä¼šè¿™æ ·å†™ï¼š\nselect c.cust_name, o.order_num, sum(quantity * item_price) as OrderTotal from Customers c, Orders o, OrderItems oi where c.cust_id = o.cust_id and o.order_num = oi.order_num group by c.cust_name order by c.cust_name, o.order_num; è¿™æ˜¯é”™è¯¯çš„ï¼åªå¯¹ cust_name è¿›è¡Œèšç±»ç¡®å®ç¬¦åˆé¢˜æ„ï¼Œä½†æ˜¯ä¸ç¬¦åˆ group by çš„è¯­æ³•ã€‚\nselect è¯­å¥ä¸­ï¼Œå¦‚æœæ²¡æœ‰ group by è¯­å¥ï¼Œé‚£ä¹ˆ cust_nameã€order_num ä¼šè¿”å›è‹¥å¹²ä¸ªå€¼ï¼Œè€Œ sum(quantity _ item_price) åªè¿”å›ä¸€ä¸ªå€¼ï¼Œé€šè¿‡ group by cust_name å¯ä»¥è®© cust_name å’Œ sum(quantity _ item_price) ä¸€ä¸€å¯¹åº”èµ·æ¥ï¼Œæˆ–è€…è¯´èšç±»ï¼Œæ‰€ä»¥åŒæ ·çš„ï¼Œä¹Ÿè¦å¯¹ order_num è¿›è¡Œèšç±»ã€‚\nä¸€å¥è¯ï¼Œselect ä¸­çš„å­—æ®µè¦ä¹ˆéƒ½èšç±»ï¼Œè¦ä¹ˆéƒ½ä¸èšç±»\nç¡®å®šå“ªäº›è®¢å•è´­ä¹°äº† prod_id ä¸º BR01 çš„äº§å“ï¼ˆäºŒï¼‰ # è¡¨ OrderItems ä»£è¡¨è®¢å•å•†å“ä¿¡æ¯è¡¨ï¼Œprod_id ä¸ºäº§å“ idï¼›Orders è¡¨ä»£è¡¨è®¢å•è¡¨æœ‰ cust_id ä»£è¡¨é¡¾å®¢ id å’Œè®¢å•æ—¥æœŸ order_date\nOrderItems è¡¨ï¼š\nprod_id order_num BR01 a0001 BR01 a0002 BR02 a0003 BR02 a0013 Orders è¡¨ï¼š\norder_num cust_id order_date a0001 cust10 2022-01-01 00:00:00 a0002 cust1 2022-01-01 00:01:00 a0003 cust1 2022-01-02 00:00:00 a0013 cust2 2022-01-01 00:20:00 ã€é—®é¢˜ã€‘\nç¼–å†™ SQL è¯­å¥ï¼Œä½¿ç”¨å­æŸ¥è¯¢æ¥ç¡®å®šå“ªäº›è®¢å•ï¼ˆåœ¨ OrderItems ä¸­ï¼‰è´­ä¹°äº† prod_id ä¸º \u0026ldquo;BR01\u0026rdquo; çš„äº§å“ï¼Œç„¶åä» Orders è¡¨ä¸­è¿”å›æ¯ä¸ªäº§å“å¯¹åº”çš„é¡¾å®¢ IDï¼ˆcust_idï¼‰å’Œè®¢å•æ—¥æœŸï¼ˆorder_dateï¼‰ï¼ŒæŒ‰è®¢è´­æ—¥æœŸå¯¹ç»“æœè¿›è¡Œå‡åºæ’åºã€‚\næç¤ºï¼šè¿™ä¸€æ¬¡ä½¿ç”¨è¿æ¥å’Œç®€å•çš„ç­‰è¿æ¥è¯­æ³•ã€‚\n# å†™æ³• 1ï¼šå­æŸ¥è¯¢ select cust_id, order_date from Orders where order_num in ( select order_num from OrderItems where prod_id = \u0026#39;BR01\u0026#39; ) order by order_date; # å†™æ³• 2ï¼šè¿æ¥è¡¨ inner join select cust_id, order_date from Orders o inner join ( select order_num from OrderItems where prod_id = \u0026#39;BR01\u0026#39; ) tb on o.order_num = tb.order_num order by order_date; # å†™æ³• 3ï¼šå†™æ³• 2 çš„ç®€åŒ–ç‰ˆ select cust_id, order_date from Orders inner join OrderItems using(order_num) where OrderItems.prod_id = \u0026#39;BR01\u0026#39; order by order_date; è¿”å›è´­ä¹° prod_id ä¸º BR01 çš„äº§å“çš„æ‰€æœ‰é¡¾å®¢çš„ç”µå­é‚®ä»¶ï¼ˆäºŒï¼‰ # æœ‰è¡¨ OrderItems ä»£è¡¨è®¢å•å•†å“ä¿¡æ¯è¡¨ï¼Œprod_id ä¸ºäº§å“ idï¼›Orders è¡¨ä»£è¡¨è®¢å•è¡¨æœ‰ cust_id ä»£è¡¨é¡¾å®¢ id å’Œè®¢å•æ—¥æœŸ order_dateï¼›Customers è¡¨å«æœ‰ cust_email é¡¾å®¢é‚®ä»¶å’Œ cust_id é¡¾å®¢ id\nOrderItems è¡¨ï¼š\nprod_id order_num BR01 a0001 BR01 a0002 BR02 a0003 BR02 a0013 Orders è¡¨ï¼š\norder_num cust_id order_date a0001 cust10 2022-01-01 00:00:00 a0002 cust1 2022-01-01 00:01:00 a0003 cust1 2022-01-02 00:00:00 a0013 cust2 2022-01-01 00:20:00 Customers è¡¨ä»£è¡¨é¡¾å®¢ä¿¡æ¯ï¼Œcust_id ä¸ºé¡¾å®¢ idï¼Œcust_email ä¸ºé¡¾å®¢ email\ncust_id cust_email cust10 cust10@cust.com cust1 cust1@cust.com cust2 cust2@cust.com ã€é—®é¢˜ã€‘è¿”å›è´­ä¹° prod_id ä¸º BR01 çš„äº§å“çš„æ‰€æœ‰é¡¾å®¢çš„ç”µå­é‚®ä»¶ï¼ˆCustomers è¡¨ä¸­çš„ cust_emailï¼‰ï¼Œç»“æœæ— éœ€æ’åºã€‚\næç¤ºï¼šæ¶‰åŠåˆ° SELECT è¯­å¥ï¼Œæœ€å†…å±‚çš„ä» OrderItems è¡¨è¿”å› order_numï¼Œä¸­é—´çš„ä» Customers è¡¨è¿”å› cust_idï¼Œä½†æ˜¯å¿…é¡»ä½¿ç”¨ INNER JOIN è¯­æ³•ã€‚\nselect cust_email from Customers inner join Orders using(cust_id) inner join OrderItems using(order_num) where OrderItems.prod_id = \u0026#39;BR01\u0026#39;; ç¡®å®šæœ€ä½³é¡¾å®¢çš„å¦ä¸€ç§æ–¹å¼ï¼ˆäºŒï¼‰ # OrderItems è¡¨ä»£è¡¨è®¢å•ä¿¡æ¯ï¼Œç¡®å®šæœ€ä½³é¡¾å®¢çš„å¦ä¸€ç§æ–¹å¼æ˜¯çœ‹ä»–ä»¬èŠ±äº†å¤šå°‘é’±ï¼ŒOrderItems è¡¨æœ‰è®¢å•å· order_num å’Œ item_price å•†å“å”®å‡ºä»·æ ¼ã€quantity å•†å“æ•°é‡\norder_num item_price quantity a1 10 105 a2 1 1100 a2 1 200 a4 2 1121 a5 5 10 a2 1 19 a7 7 5 Orders è¡¨å«æœ‰å­—æ®µ order_num è®¢å•å·ã€cust_id é¡¾å®¢ id\norder_num cust_id a1 cust10 a2 cust1 a3 cust2 a4 cust22 a5 cust221 a7 cust2217 é¡¾å®¢è¡¨ Customers æœ‰å­—æ®µ cust_id å®¢æˆ· idã€cust_name å®¢æˆ·å§“å\ncust_id cust_name cust10 andy cust1 ben cust2 tony cust22 tom cust221 an cust2217 hex ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œè¿”å›è®¢å•æ€»ä»·ä¸å°äº 1000 çš„å®¢æˆ·åç§°å’Œæ€»é¢ï¼ˆOrderItems è¡¨ä¸­çš„ order_numï¼‰ã€‚\næç¤ºï¼šéœ€è¦è®¡ç®—æ€»å’Œï¼ˆitem_price ä¹˜ä»¥ quantityï¼‰ã€‚æŒ‰æ€»é¢å¯¹ç»“æœè¿›è¡Œæ’åºï¼Œè¯·ä½¿ç”¨ INNER JOIN è¯­æ³•ã€‚\nselect cust_name, sum(item_price * quantity) as total_price from Customers inner join Orders using(cust_id) inner join OrderItems using(order_num) group by cust_name having total_price \u0026gt;= 1000 order by total_price; åˆ›å»ºé«˜çº§è¿æ¥ # æ£€ç´¢æ¯ä¸ªé¡¾å®¢çš„åç§°å’Œæ‰€æœ‰çš„è®¢å•å·ï¼ˆä¸€ï¼‰ # Customers` è¡¨ä»£è¡¨é¡¾å®¢ä¿¡æ¯å«æœ‰é¡¾å®¢ id `cust_id` å’Œ é¡¾å®¢åç§° `cust_name cust_id cust_name cust10 andy cust1 ben cust2 tony cust22 tom cust221 an cust2217 hex Orders` è¡¨ä»£è¡¨è®¢å•ä¿¡æ¯å«æœ‰è®¢å•å· `order_num` å’Œé¡¾å®¢ id `cust_id order_num cust_id a1 cust10 a2 cust1 a3 cust2 a4 cust22 a5 cust221 a7 cust2217 ã€é—®é¢˜ã€‘ä½¿ç”¨ INNER JOIN ç¼–å†™ SQL è¯­å¥ï¼Œæ£€ç´¢æ¯ä¸ªé¡¾å®¢çš„åç§°ï¼ˆCustomers è¡¨ä¸­çš„ cust_nameï¼‰å’Œæ‰€æœ‰çš„è®¢å•å·ï¼ˆOrders è¡¨ä¸­çš„ order_numï¼‰ï¼Œæœ€åæ ¹æ®é¡¾å®¢å§“å cust_name å‡åºè¿”å›ã€‚\nselect cust_name, order_num from Customers inner join Orders using(cust_id) order by cust_name; æ£€ç´¢æ¯ä¸ªé¡¾å®¢çš„åç§°å’Œæ‰€æœ‰çš„è®¢å•å·ï¼ˆäºŒï¼‰ # Orders` è¡¨ä»£è¡¨è®¢å•ä¿¡æ¯å«æœ‰è®¢å•å· `order_num` å’Œé¡¾å®¢ id `cust_id order_num cust_id a1 cust10 a2 cust1 a3 cust2 a4 cust22 a5 cust221 a7 cust2217 Customers` è¡¨ä»£è¡¨é¡¾å®¢ä¿¡æ¯å«æœ‰é¡¾å®¢ id `cust_id` å’Œ é¡¾å®¢åç§° `cust_name cust_id cust_name cust10 andy cust1 ben cust2 tony cust22 tom cust221 an cust2217 hex cust40 ace ã€é—®é¢˜ã€‘æ£€ç´¢æ¯ä¸ªé¡¾å®¢çš„åç§°ï¼ˆCustomers è¡¨ä¸­çš„ cust_nameï¼‰å’Œæ‰€æœ‰çš„è®¢å•å·ï¼ˆOrders è¡¨ä¸­çš„ order_numï¼‰ï¼Œåˆ—å‡ºæ‰€æœ‰çš„é¡¾å®¢ï¼Œå³ä½¿ä»–ä»¬æ²¡æœ‰ä¸‹è¿‡è®¢å•ã€‚æœ€åæ ¹æ®é¡¾å®¢å§“å cust_name å‡åºè¿”å›ã€‚\nselect cust_name, order_num from Customers left join Orders using(cust_id) order by cust_name; è¿”å›äº§å“åç§°å’Œä¸ä¹‹ç›¸å…³çš„è®¢å•å· # Products è¡¨ä¸ºäº§å“ä¿¡æ¯è¡¨å«æœ‰å­—æ®µ prod_id äº§å“ idã€prod_name äº§å“åç§°\nprod_id prod_name a0001 egg a0002 sockets a0013 coffee a0003 cola a0023 soda OrderItems` è¡¨ä¸ºè®¢å•ä¿¡æ¯è¡¨å«æœ‰å­—æ®µ `order_num` è®¢å•å·å’Œäº§å“ id `prod_id prod_id order_num a0001 a105 a0002 a1100 a0002 a200 a0013 a1121 a0003 a10 a0003 a19 a0003 a5 ã€é—®é¢˜ã€‘ä½¿ç”¨å¤–è¿æ¥ï¼ˆleft joinã€ right joinã€full joinï¼‰è”ç»“ Products è¡¨å’Œ OrderItems è¡¨ï¼Œè¿”å›äº§å“åç§°ï¼ˆprod_nameï¼‰å’Œä¸ä¹‹ç›¸å…³çš„è®¢å•å·ï¼ˆorder_numï¼‰çš„åˆ—è¡¨ï¼Œå¹¶æŒ‰ç…§äº§å“åç§°å‡åºæ’åºã€‚\nselect prod_name, order_num from Products left join OrderItems using(prod_id) order by prod_name; è¿”å›äº§å“åç§°å’Œæ¯ä¸€é¡¹äº§å“çš„æ€»è®¢å•æ•° # Products è¡¨ä¸ºäº§å“ä¿¡æ¯è¡¨å«æœ‰å­—æ®µ prod_id äº§å“ idã€prod_name äº§å“åç§°\nprod_id prod_name a0001 egg a0002 sockets a0013 coffee a0003 cola a0023 soda OrderItems` è¡¨ä¸ºè®¢å•ä¿¡æ¯è¡¨å«æœ‰å­—æ®µ `order_num` è®¢å•å·å’Œäº§å“ id `prod_id prod_id order_num a0001 a105 a0002 a1100 a0002 a200 a0013 a1121 a0003 a10 a0003 a19 a0003 a5 ã€é—®é¢˜ã€‘\nä½¿ç”¨ OUTER JOIN è”ç»“ Products è¡¨å’Œ OrderItems è¡¨ï¼Œè¿”å›äº§å“åç§°ï¼ˆprod_nameï¼‰å’Œæ¯ä¸€é¡¹äº§å“çš„æ€»è®¢å•æ•°ï¼ˆä¸æ˜¯è®¢å•å·ï¼‰ï¼Œå¹¶æŒ‰äº§å“åç§°å‡åºæ’åºã€‚\nselect prod_name, count(order_num) as orders from Products left join OrderItems using(prod_id) group by prod_name order by prod_name; åˆ—å‡ºä¾›åº”å•†åŠå…¶å¯ä¾›äº§å“çš„æ•°é‡ # æœ‰ Vendors è¡¨å«æœ‰ vend_id ï¼ˆä¾›åº”å•† idï¼‰\nvend_id a0002 a0013 a0003 a0010 æœ‰ Products è¡¨å«æœ‰ vend_idï¼ˆä¾›åº”å•† idï¼‰å’Œ prod_idï¼ˆä¾›åº”äº§å“ idï¼‰\nvend_id prod_id a0001 egg a0002 prod_id_iphone a00113 prod_id_tea a0003 prod_id_vivo phone a0010 prod_id_huawei phone ã€é—®é¢˜ã€‘åˆ—å‡ºä¾›åº”å•†ï¼ˆVendors è¡¨ä¸­çš„ vend_idï¼‰åŠå…¶å¯ä¾›äº§å“çš„æ•°é‡ï¼ŒåŒ…æ‹¬æ²¡æœ‰äº§å“çš„ä¾›åº”å•†ã€‚ä½ éœ€è¦ä½¿ç”¨ OUTER JOIN å’Œ COUNT()èšåˆå‡½æ•°æ¥è®¡ç®— Products è¡¨ä¸­æ¯ç§äº§å“çš„æ•°é‡ï¼Œæœ€åæ ¹æ® vend_id å‡åºæ’åºã€‚\næ³¨æ„ï¼švend_id åˆ—ä¼šæ˜¾ç¤ºåœ¨å¤šä¸ªè¡¨ä¸­ï¼Œå› æ­¤åœ¨æ¯æ¬¡å¼•ç”¨å®ƒæ—¶éƒ½éœ€è¦å®Œå…¨é™å®šå®ƒã€‚\nselect vend_id, count(prod_id) as prod_id from Vendors left join Products using(vend_id) group by vend_id order by vend_id; ç»„åˆæŸ¥è¯¢ # UNION è¿ç®—ç¬¦å°†ä¸¤ä¸ªæˆ–æ›´å¤šæŸ¥è¯¢çš„ç»“æœç»„åˆèµ·æ¥ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªç»“æœé›†ï¼Œå…¶ä¸­åŒ…å«æ¥è‡ª UNION ä¸­å‚ä¸æŸ¥è¯¢çš„æå–è¡Œã€‚\nUNION åŸºæœ¬è§„åˆ™ï¼š\næ‰€æœ‰æŸ¥è¯¢çš„åˆ—æ•°å’Œåˆ—é¡ºåºå¿…é¡»ç›¸åŒã€‚ æ¯ä¸ªæŸ¥è¯¢ä¸­æ¶‰åŠè¡¨çš„åˆ—çš„æ•°æ®ç±»å‹å¿…é¡»ç›¸åŒæˆ–å…¼å®¹ã€‚ é€šå¸¸è¿”å›çš„åˆ—åå–è‡ªç¬¬ä¸€ä¸ªæŸ¥è¯¢ã€‚ é»˜è®¤åœ°ï¼ŒUNION æ“ä½œç¬¦é€‰å–ä¸åŒçš„å€¼ã€‚å¦‚æœå…è®¸é‡å¤çš„å€¼ï¼Œè¯·ä½¿ç”¨ UNION ALLã€‚\nSELECT column_name(s) FROM table1 UNION ALL SELECT column_name(s) FROM table2; UNION ç»“æœé›†ä¸­çš„åˆ—åæ€»æ˜¯ç­‰äº UNION ä¸­ç¬¬ä¸€ä¸ª SELECT è¯­å¥ä¸­çš„åˆ—åã€‚\nJOIN vs UNIONï¼š\nJOIN ä¸­è¿æ¥è¡¨çš„åˆ—å¯èƒ½ä¸åŒï¼Œä½†åœ¨ UNION ä¸­ï¼Œæ‰€æœ‰æŸ¥è¯¢çš„åˆ—æ•°å’Œåˆ—é¡ºåºå¿…é¡»ç›¸åŒã€‚ UNION å°†æŸ¥è¯¢ä¹‹åçš„è¡Œæ”¾åœ¨ä¸€èµ·ï¼ˆå‚ç›´æ”¾ç½®ï¼‰ï¼Œä½† JOIN å°†æŸ¥è¯¢ä¹‹åçš„åˆ—æ”¾åœ¨ä¸€èµ·ï¼ˆæ°´å¹³æ”¾ç½®ï¼‰ï¼Œå³å®ƒæ„æˆä¸€ä¸ªç¬›å¡å°”ç§¯ã€‚ å°†ä¸¤ä¸ª SELECT è¯­å¥ç»“åˆèµ·æ¥ï¼ˆä¸€ï¼‰ # è¡¨ OrderItems åŒ…å«è®¢å•äº§å“ä¿¡æ¯ï¼Œå­—æ®µ prod_id ä»£è¡¨äº§å“ idã€quantity ä»£è¡¨äº§å“æ•°é‡\nprod_id quantity a0001 105 a0002 100 a0002 200 a0013 1121 a0003 10 a0003 19 a0003 5 BNBG 10002 ã€é—®é¢˜ã€‘å°†ä¸¤ä¸ª SELECT è¯­å¥ç»“åˆèµ·æ¥ï¼Œä»¥ä¾¿ä» OrderItems è¡¨ä¸­æ£€ç´¢äº§å“ idï¼ˆprod_idï¼‰å’Œ quantityã€‚å…¶ä¸­ï¼Œä¸€ä¸ª SELECT è¯­å¥è¿‡æ»¤æ•°é‡ä¸º 100 çš„è¡Œï¼Œå¦ä¸€ä¸ª SELECT è¯­å¥è¿‡æ»¤ id ä»¥ BNBG å¼€å¤´çš„äº§å“ï¼Œæœ€åæŒ‰äº§å“ id å¯¹ç»“æœè¿›è¡Œå‡åºæ’åºã€‚\nselect prod_id, quantity from OrderItems where quantity = 100 union select prod_id, quantity from OrderItems where prod_id like \u0026#39;BNBG%\u0026#39;; å°†ä¸¤ä¸ª SELECT è¯­å¥ç»“åˆèµ·æ¥ï¼ˆäºŒï¼‰ # è¡¨ OrderItems åŒ…å«è®¢å•äº§å“ä¿¡æ¯ï¼Œå­—æ®µ prod_id ä»£è¡¨äº§å“ idã€quantity ä»£è¡¨äº§å“æ•°é‡ã€‚\nprod_id quantity a0001 105 a0002 100 a0002 200 a0013 1121 a0003 10 a0003 19 a0003 5 BNBG 10002 ã€é—®é¢˜ã€‘å°†ä¸¤ä¸ª SELECT è¯­å¥ç»“åˆèµ·æ¥ï¼Œä»¥ä¾¿ä» OrderItems è¡¨ä¸­æ£€ç´¢äº§å“ idï¼ˆprod_idï¼‰å’Œ quantityã€‚å…¶ä¸­ï¼Œä¸€ä¸ª SELECT è¯­å¥è¿‡æ»¤æ•°é‡ä¸º 100 çš„è¡Œï¼Œå¦ä¸€ä¸ª SELECT è¯­å¥è¿‡æ»¤ id ä»¥ BNBG å¼€å¤´çš„äº§å“ï¼Œæœ€åæŒ‰äº§å“ id å¯¹ç»“æœè¿›è¡Œå‡åºæ’åºã€‚ æ³¨æ„ï¼šè¿™æ¬¡ä»…ä½¿ç”¨å•ä¸ª SELECT è¯­å¥ã€‚\nç­”æ¡ˆï¼š\nè¦æ±‚åªç”¨ä¸€æ¡ select è¯­å¥ï¼Œé‚£å°±ç”¨ or ä¸ç”¨ union äº†ã€‚\nselect prod_id, quantity from OrderItems where quantity = 100 or prod_id like \u0026#39;BNBG%\u0026#39;; ç»„åˆ Products è¡¨ä¸­çš„äº§å“åç§°å’Œ Customers è¡¨ä¸­çš„é¡¾å®¢åç§° # Products è¡¨å«æœ‰å­—æ®µ prod_name ä»£è¡¨äº§å“åç§°\nprod_name flower rice ring umbrella Customers è¡¨ä»£è¡¨é¡¾å®¢ä¿¡æ¯ï¼Œcust_name ä»£è¡¨é¡¾å®¢åç§°\ncust_name andy ben tony tom an lee hex ã€é—®é¢˜ã€‘ç¼–å†™ SQL è¯­å¥ï¼Œç»„åˆ Products è¡¨ä¸­çš„äº§å“åç§°ï¼ˆprod_nameï¼‰å’Œ Customers è¡¨ä¸­çš„é¡¾å®¢åç§°ï¼ˆcust_nameï¼‰å¹¶è¿”å›ï¼Œç„¶åæŒ‰äº§å“åç§°å¯¹ç»“æœè¿›è¡Œå‡åºæ’åºã€‚\n# UNION ç»“æœé›†ä¸­çš„åˆ—åæ€»æ˜¯ç­‰äº UNION ä¸­ç¬¬ä¸€ä¸ª SELECT è¯­å¥ä¸­çš„åˆ—åã€‚ select prod_name from Products union select cust_name from Customers order by prod_name; æ£€æŸ¥ SQL è¯­å¥ # è¡¨ Customers å«æœ‰å­—æ®µ cust_name é¡¾å®¢åã€cust_contact é¡¾å®¢è”ç³»æ–¹å¼ã€cust_state é¡¾å®¢å·ã€cust_email é¡¾å®¢ email\ncust_name cust_contact cust_state cust_email cust10 8695192 MI cust10@cust.com cust1 8695193 MI cust1@cust.com cust2 8695194 IL cust2@cust.com ã€é—®é¢˜ã€‘ä¿®æ­£ä¸‹é¢é”™è¯¯çš„ SQL\nSELECT cust_name, cust_contact, cust_email FROM Customers WHERE cust_state = \u0026#39;MI\u0026#39; ORDER BY cust_name; UNION SELECT cust_name, cust_contact, cust_email FROM Customers WHERE cust_state = \u0026#39;IL\u0026#39;ORDER BY cust_name; ä¿®æ­£åï¼š\nSELECT cust_name, cust_contact, cust_email FROM Customers WHERE cust_state = \u0026#39;MI\u0026#39; UNION SELECT cust_name, cust_contact, cust_email FROM Customers WHERE cust_state = \u0026#39;IL\u0026#39; ORDER BY cust_name; ä½¿ç”¨ union ç»„åˆæŸ¥è¯¢æ—¶ï¼Œåªèƒ½ä½¿ç”¨ä¸€æ¡ order by å­—å¥ï¼Œä»–å¿…é¡»ä½äºæœ€åä¸€æ¡ select è¯­å¥ä¹‹å\næˆ–è€…ç›´æ¥ç”¨ or æ¥åšï¼š\nSELECT cust_name, cust_contact, cust_email FROM Customers WHERE cust_state = \u0026#39;MI\u0026#39; or cust_state = \u0026#39;IL\u0026#39; ORDER BY cust_name; "},{"id":49,"href":"/zh/docs/study/Review/java_guide/database/ly0504lysql-syntax-summary/","title":"sqlè¯­æ³•åŸºç¡€çŸ¥è¯†æ€»ç»“","section":"æ•°æ®åº“","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\næœ¬æ–‡æ•´ç†å®Œå–„è‡ªä¸‹é¢è¿™ä¸¤ä»½èµ„æ–™ï¼š\nSQL è¯­æ³•é€Ÿæˆæ‰‹å†Œ MySQL è¶…å…¨æ•™ç¨‹ åŸºæœ¬æ¦‚å¿µ # æ•°æ®åº“æœ¯è¯­ # æ•°æ®åº“ï¼ˆdatabaseï¼‰ - ä¿å­˜æœ‰ç»„ç»‡çš„æ•°æ®çš„å®¹å™¨ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªæ–‡ä»¶æˆ–ä¸€ç»„æ–‡ä»¶ï¼‰ã€‚ æ•°æ®è¡¨ï¼ˆtableï¼‰ - æŸç§ç‰¹å®šç±»å‹æ•°æ®çš„ç»“æ„åŒ–æ¸…å•ã€‚ æ¨¡å¼ï¼ˆschemaï¼‰ - å…³äºæ•°æ®åº“å’Œè¡¨çš„å¸ƒå±€åŠç‰¹æ€§çš„ä¿¡æ¯ã€‚æ¨¡å¼å®šä¹‰äº†æ•°æ®åœ¨è¡¨ä¸­å¦‚ä½•å­˜å‚¨ï¼ŒåŒ…å«å­˜å‚¨ä»€ä¹ˆæ ·çš„æ•°æ®ï¼Œæ•°æ®å¦‚ä½•åˆ†è§£ï¼Œå„éƒ¨åˆ†ä¿¡æ¯å¦‚ä½•å‘½åç­‰ä¿¡æ¯ã€‚æ•°æ®åº“å’Œè¡¨éƒ½æœ‰æ¨¡å¼ã€‚ åˆ—ï¼ˆcolumnï¼‰ - è¡¨ä¸­çš„ä¸€ä¸ªå­—æ®µã€‚æ‰€æœ‰è¡¨éƒ½æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—ç»„æˆçš„ã€‚ è¡Œï¼ˆrowï¼‰ - è¡¨ä¸­çš„ä¸€ä¸ªè®°å½•ã€‚ ä¸»é”®ï¼ˆprimary keyï¼‰ - ä¸€åˆ—ï¼ˆæˆ–ä¸€ç»„åˆ—ï¼‰ï¼Œå…¶å€¼èƒ½å¤Ÿå”¯ä¸€æ ‡è¯†è¡¨ä¸­æ¯ä¸€è¡Œã€‚ SQL è¯­æ³• # SQLï¼ˆStructured Query Language)ï¼Œæ ‡å‡† SQL ç”± ANSI æ ‡å‡†å§”å‘˜ä¼šç®¡ç†ï¼Œä»è€Œç§°ä¸º ANSI SQLã€‚å„ä¸ª DBMS éƒ½æœ‰è‡ªå·±çš„å®ç°ï¼Œå¦‚ PL/SQLã€Transact-SQL ç­‰ã€‚\nSQL è¯­æ³•ç»“æ„ # SQL è¯­æ³•ç»“æ„åŒ…æ‹¬ï¼š\nå­å¥ - æ˜¯è¯­å¥å’ŒæŸ¥è¯¢çš„ç»„æˆæˆåˆ†ã€‚ï¼ˆåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™äº›éƒ½æ˜¯å¯é€‰çš„ã€‚ï¼‰ è¡¨è¾¾å¼ - å¯ä»¥äº§ç”Ÿä»»ä½•æ ‡é‡å€¼ï¼Œæˆ–ç”±åˆ—å’Œè¡Œçš„æ•°æ®åº“è¡¨ è°“è¯ - ç»™éœ€è¦è¯„ä¼°çš„ SQL ä¸‰å€¼é€»è¾‘ï¼ˆ3VLï¼‰ï¼ˆtrue/false/unknownï¼‰æˆ–å¸ƒå°”çœŸå€¼æŒ‡å®šæ¡ä»¶ï¼Œå¹¶é™åˆ¶è¯­å¥å’ŒæŸ¥è¯¢çš„æ•ˆæœï¼Œæˆ–æ”¹å˜ç¨‹åºæµç¨‹ã€‚ æŸ¥è¯¢ - åŸºäºç‰¹å®šæ¡ä»¶æ£€ç´¢æ•°æ®ã€‚è¿™æ˜¯ SQL çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ã€‚ è¯­å¥ - å¯ä»¥æŒä¹…åœ°å½±å“çº²è¦å’Œæ•°æ®ï¼Œä¹Ÿå¯ä»¥æ§åˆ¶æ•°æ®åº“äº‹åŠ¡ã€ç¨‹åºæµç¨‹ã€è¿æ¥ã€ä¼šè¯æˆ–è¯Šæ–­ã€‚ SQL è¯­æ³•è¦ç‚¹ # SQL è¯­å¥ä¸åŒºåˆ†å¤§å°å†™ï¼Œä½†æ˜¯æ•°æ®åº“è¡¨åã€åˆ—åå’Œå€¼æ˜¯å¦åŒºåˆ†ï¼Œä¾èµ–äºå…·ä½“çš„ DBMS ä»¥åŠé…ç½®ã€‚ä¾‹å¦‚ï¼šSELECT ä¸ select ã€Select æ˜¯ç›¸åŒçš„ã€‚ å¤šæ¡ SQL è¯­å¥å¿…é¡»ä»¥åˆ†å·ï¼ˆ;ï¼‰åˆ†éš”ã€‚ å¤„ç† SQL è¯­å¥æ—¶ï¼Œæ‰€æœ‰ç©ºæ ¼éƒ½è¢«å¿½ç•¥ã€‚ SQL è¯­å¥å¯ä»¥å†™æˆä¸€è¡Œï¼Œä¹Ÿå¯ä»¥åˆ†å†™ä¸ºå¤šè¡Œã€‚\n-- ä¸€è¡Œ SQL è¯­å¥ UPDATE user SET username=\u0026#39;robot\u0026#39;, password=\u0026#39;robot\u0026#39; WHERE username = \u0026#39;root\u0026#39;; -- å¤šè¡Œ SQL è¯­å¥ UPDATE user SET username=\u0026#39;robot\u0026#39;, password=\u0026#39;robot\u0026#39; WHERE username = \u0026#39;root\u0026#39;; SQL æ”¯æŒä¸‰ç§æ³¨é‡Šï¼š\n## æ³¨é‡Š1 -- æ³¨é‡Š2 /* æ³¨é‡Š3 */ SQL åˆ†ç±» # æ•°æ®å®šä¹‰è¯­è¨€ï¼ˆDDLï¼‰ # æ•°æ®å®šä¹‰è¯­è¨€ï¼ˆData Definition Languageï¼ŒDDLï¼‰æ˜¯ SQL è¯­è¨€é›†ä¸­è´Ÿè´£æ•°æ®ç»“æ„å®šä¹‰ä¸æ•°æ®åº“å¯¹è±¡å®šä¹‰çš„è¯­è¨€ã€‚\nDDL çš„ä¸»è¦åŠŸèƒ½æ˜¯å®šä¹‰æ•°æ®åº“å¯¹è±¡ã€‚\nDDL çš„æ ¸å¿ƒæŒ‡ä»¤æ˜¯ CREATEã€ALTERã€DROPã€‚\næ•°æ®æ“çºµè¯­è¨€ï¼ˆDMLï¼‰ # æ•°æ®æ“çºµè¯­è¨€ï¼ˆData Manipulation Language, DMLï¼‰æ˜¯ç”¨äºæ•°æ®åº“æ“ä½œï¼Œå¯¹æ•°æ®åº“å…¶ä¸­çš„å¯¹è±¡å’Œæ•°æ®è¿è¡Œè®¿é—®å·¥ä½œçš„ç¼–ç¨‹è¯­å¥ã€‚\nDML çš„ä¸»è¦åŠŸèƒ½æ˜¯ è®¿é—®æ•°æ®ï¼Œå› æ­¤å…¶è¯­æ³•éƒ½æ˜¯ä»¥è¯»å†™æ•°æ®åº“ä¸ºä¸»ã€‚\nDML çš„æ ¸å¿ƒæŒ‡ä»¤æ˜¯ INSERTã€UPDATEã€DELETEã€SELECTã€‚è¿™å››ä¸ªæŒ‡ä»¤åˆç§° CRUD(Create, Read, Update, Delete)ï¼Œå³å¢åˆ æ”¹æŸ¥ã€‚\näº‹åŠ¡æ§åˆ¶è¯­è¨€ï¼ˆTCLï¼‰ # äº‹åŠ¡æ§åˆ¶è¯­è¨€ (Transaction Control Language, TCL) ç”¨äºç®¡ç†æ•°æ®åº“ä¸­çš„äº‹åŠ¡ã€‚è¿™äº›ç”¨äºç®¡ç†ç”± DML è¯­å¥æ‰€åšçš„æ›´æ”¹ã€‚å®ƒè¿˜å…è®¸å°†è¯­å¥åˆ†ç»„ä¸ºé€»è¾‘äº‹åŠ¡ã€‚\nTCL çš„æ ¸å¿ƒæŒ‡ä»¤æ˜¯ COMMITã€ROLLBACKã€‚\næ•°æ®æ§åˆ¶è¯­è¨€ï¼ˆDCLï¼‰ # æ•°æ®æ§åˆ¶è¯­è¨€ (Data Control Language, DCL) æ˜¯ä¸€ç§å¯å¯¹æ•°æ®è®¿é—®æƒè¿›è¡Œæ§åˆ¶çš„æŒ‡ä»¤ï¼Œå®ƒå¯ä»¥æ§åˆ¶ç‰¹å®šç”¨æˆ·è´¦æˆ·å¯¹æ•°æ®è¡¨ã€æŸ¥çœ‹è¡¨ã€é¢„å­˜ç¨‹åºã€ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ç­‰æ•°æ®åº“å¯¹è±¡çš„æ§åˆ¶æƒã€‚\nDCL çš„æ ¸å¿ƒæŒ‡ä»¤æ˜¯ GRANTã€REVOKEã€‚\nDCL ä»¥æ§åˆ¶ç”¨æˆ·çš„è®¿é—®æƒé™ä¸ºä¸»ï¼Œå› æ­¤å…¶æŒ‡ä»¤ä½œæ³•å¹¶ä¸å¤æ‚ï¼Œå¯åˆ©ç”¨ DCL æ§åˆ¶çš„æƒé™æœ‰ï¼šCONNECTã€SELECTã€INSERTã€UPDATEã€DELETEã€EXECUTEã€USAGEã€REFERENCESã€‚\næ ¹æ®ä¸åŒçš„ DBMS ä»¥åŠä¸åŒçš„å®‰å…¨æ€§å®ä½“ï¼Œå…¶æ”¯æŒçš„æƒé™æ§åˆ¶ä¹Ÿæœ‰æ‰€ä¸åŒã€‚\næˆ‘ä»¬å…ˆæ¥ä»‹ç» DML è¯­å¥ç”¨æ³•ã€‚ DML çš„ä¸»è¦åŠŸèƒ½æ˜¯è¯»å†™æ•°æ®åº“å®ç°å¢åˆ æ”¹æŸ¥ã€‚\nå¢åˆ æ”¹æŸ¥ # å¢åˆ æ”¹æŸ¥ï¼Œåˆç§°ä¸º CRUDï¼Œæ•°æ®åº“åŸºæœ¬æ“ä½œä¸­çš„åŸºæœ¬æ“ä½œã€‚\næ’å…¥æ•°æ® # INSERT INTO è¯­å¥ç”¨äºå‘è¡¨ä¸­æ’å…¥æ–°è®°å½•ã€‚\næ’å…¥å®Œæ•´çš„è¡Œ\n# æ’å…¥ä¸€è¡Œ INSERT INTO user VALUES (10, \u0026#39;root\u0026#39;, \u0026#39;root\u0026#39;, \u0026#39;xxxx@163.com\u0026#39;); # æ’å…¥å¤šè¡Œ INSERT INTO user VALUES (10, \u0026#39;root\u0026#39;, \u0026#39;root\u0026#39;, \u0026#39;xxxx@163.com\u0026#39;), (12, \u0026#39;user1\u0026#39;, \u0026#39;user1\u0026#39;, \u0026#39;xxxx@163.com\u0026#39;), (18, \u0026#39;user2\u0026#39;, \u0026#39;user2\u0026#39;, \u0026#39;xxxx@163.com\u0026#39;); æ’å…¥è¡Œçš„ä¸€éƒ¨åˆ†\nINSERT INTO user(username, password, email) VALUES (\u0026#39;admin\u0026#39;, \u0026#39;admin\u0026#39;, \u0026#39;xxxx@163.com\u0026#39;); æ’å…¥æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®\nINSERT INTO user(username) SELECT name FROM account; æ›´æ–°æ•°æ® # UPDATE è¯­å¥ç”¨äºæ›´æ–°è¡¨ä¸­çš„è®°å½•ã€‚\nUPDATE user SET username=\u0026#39;robot\u0026#39;, password=\u0026#39;robot\u0026#39; WHERE username = \u0026#39;root\u0026#39;; åˆ é™¤æ•°æ® # DELETE è¯­å¥ç”¨äºåˆ é™¤è¡¨ä¸­çš„è®°å½•ã€‚ TRUNCATE TABLE å¯ä»¥æ¸…ç©ºè¡¨ï¼Œä¹Ÿå°±æ˜¯åˆ é™¤æ‰€æœ‰è¡Œã€‚ åˆ é™¤è¡¨ä¸­çš„æŒ‡å®šæ•°æ®\nDELETE FROM user WHERE username = \u0026#39;robot\u0026#39;; æ¸…ç©ºè¡¨ä¸­çš„æ•°æ®\nTRUNCATE TABLE user; æŸ¥è¯¢æ•°æ® # SELECT è¯­å¥ç”¨äºä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®ã€‚\nDISTINCT ç”¨äºè¿”å›å”¯ä¸€ä¸åŒçš„å€¼ã€‚å®ƒä½œç”¨äºæ‰€æœ‰åˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰åˆ—çš„å€¼éƒ½ç›¸åŒæ‰ç®—ç›¸åŒã€‚\nLIMIT é™åˆ¶è¿”å›çš„è¡Œæ•°ã€‚å¯ä»¥æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºèµ·å§‹è¡Œï¼Œä» 0 å¼€å§‹ï¼›ç¬¬äºŒä¸ªå‚æ•°ä¸ºè¿”å›çš„æ€»è¡Œæ•°ã€‚\nASC ï¼šå‡åºï¼ˆé»˜è®¤ï¼‰ DESC ï¼šé™åº æŸ¥è¯¢å•åˆ—\nSELECT prod_name FROM products; æŸ¥è¯¢å¤šåˆ—\nSELECT prod_id, prod_name, prod_price FROM products; æŸ¥è¯¢æ‰€æœ‰åˆ—\nELECT * FROM products; æŸ¥è¯¢ä¸åŒçš„å€¼\nSELECT DISTINCT vend_id FROM products; é™åˆ¶æŸ¥è¯¢ç»“æœ\n-- è¿”å›å‰ 5 è¡Œ SELECT * FROM mytable LIMIT 5; SELECT * FROM mytable LIMIT 0, 5; -- è¿”å›ç¬¬ 3 ~ 5 è¡Œ SELECT * FROM mytable LIMIT 2, 3; æ’åº # order by ç”¨äºå¯¹ç»“æœé›†æŒ‰ç…§ä¸€ä¸ªåˆ—æˆ–è€…å¤šä¸ªåˆ—è¿›è¡Œæ’åºã€‚é»˜è®¤æŒ‰ç…§å‡åºå¯¹è®°å½•è¿›è¡Œæ’åºï¼Œå¦‚æœéœ€è¦æŒ‰ç…§é™åºå¯¹è®°å½•è¿›è¡Œæ’åºï¼Œå¯ä»¥ä½¿ç”¨ desc å…³é”®å­—ã€‚\norder by å¯¹å¤šåˆ—æ’åºçš„æ—¶å€™ï¼Œå…ˆæ’åºçš„åˆ—æ”¾å‰é¢ï¼Œåæ’åºçš„åˆ—æ”¾åé¢ã€‚å¹¶ä¸”ï¼Œä¸åŒçš„åˆ—å¯ä»¥æœ‰ä¸åŒçš„æ’åºè§„åˆ™ã€‚\nSELECT * FROM products ORDER BY prod_price DESC, prod_name ASC; åˆ†ç»„ # group by ï¼š\ngroup by å­å¥å°†è®°å½•åˆ†ç»„åˆ°æ±‡æ€»è¡Œä¸­ã€‚ group by ä¸ºæ¯ä¸ªç»„è¿”å›ä¸€ä¸ªè®°å½•ã€‚ group by é€šå¸¸è¿˜æ¶‰åŠèšåˆcountï¼Œmaxï¼Œsumï¼Œavg ç­‰ã€‚ group by å¯ä»¥æŒ‰ä¸€åˆ—æˆ–å¤šåˆ—è¿›è¡Œåˆ†ç»„ã€‚ group by æŒ‰åˆ†ç»„å­—æ®µè¿›è¡Œæ’åºåï¼Œorder by å¯ä»¥ä»¥æ±‡æ€»å­—æ®µæ¥è¿›è¡Œæ’åºã€‚ åˆ†ç»„\nSELECT cust_name, COUNT(cust_address) AS addr_num FROM Customers GROUP BY cust_name; åˆ†ç»„åæ’åº\nSELECT cust_name, COUNT(cust_address) AS addr_num FROM Customers GROUP BY cust_name ORDER BY cust_name DESC; havingï¼š\nhaving ç”¨äºå¯¹æ±‡æ€»çš„ group by ç»“æœè¿›è¡Œè¿‡æ»¤ã€‚ having ä¸€èˆ¬éƒ½æ˜¯å’Œ group by è¿ç”¨ã€‚ where å’Œ having å¯ä»¥åœ¨ç›¸åŒçš„æŸ¥è¯¢ä¸­ã€‚ ä½¿ç”¨ WHERE å’Œ HAVING è¿‡æ»¤æ•°æ®\nSELECT cust_name, COUNT(*) AS num FROM Customers WHERE cust_email IS NOT NULL GROUP BY cust_name HAVING COUNT(*) \u0026gt;= 1; having vs where ï¼š\nwhereï¼šè¿‡æ»¤è¿‡æ»¤æŒ‡å®šçš„è¡Œï¼Œåé¢ä¸èƒ½åŠ èšåˆå‡½æ•°ï¼ˆåˆ†ç»„å‡½æ•°ï¼‰ã€‚where åœ¨group by å‰ã€‚ havingï¼šè¿‡æ»¤åˆ†ç»„ï¼Œä¸€èˆ¬éƒ½æ˜¯å’Œ group by è¿ç”¨ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ã€‚having åœ¨ group by ä¹‹åã€‚ å­æŸ¥è¯¢ # å­æŸ¥è¯¢æ˜¯åµŒå¥—åœ¨è¾ƒå¤§æŸ¥è¯¢ä¸­çš„ SQL æŸ¥è¯¢ï¼Œä¹Ÿç§°å†…éƒ¨æŸ¥è¯¢æˆ–å†…éƒ¨é€‰æ‹©ï¼ŒåŒ…å«å­æŸ¥è¯¢çš„è¯­å¥ä¹Ÿç§°ä¸ºå¤–éƒ¨æŸ¥è¯¢æˆ–å¤–éƒ¨é€‰æ‹©ã€‚ç®€å•æ¥è¯´ï¼Œå­æŸ¥è¯¢å°±æ˜¯æŒ‡å°†ä¸€ä¸ª select æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ï¼‰çš„ç»“æœä½œä¸ºå¦ä¸€ä¸ª SQL è¯­å¥ï¼ˆä¸»æŸ¥è¯¢ï¼‰çš„æ•°æ®æ¥æºæˆ–è€…åˆ¤æ–­æ¡ä»¶ã€‚\nå­æŸ¥è¯¢å¯ä»¥åµŒå…¥ SELECTã€INSERTã€UPDATE å’Œ DELETE è¯­å¥ä¸­ï¼Œä¹Ÿå¯ä»¥å’Œ =ã€\u0026lt;ã€\u0026gt;ã€INã€BETWEENã€EXISTS ç­‰è¿ç®—ç¬¦ä¸€èµ·ä½¿ç”¨ã€‚\nå­æŸ¥è¯¢å¸¸ç”¨åœ¨ WHERE å­å¥å’Œ FROM å­å¥åè¾¹ï¼š\nå½“ç”¨äº WHERE å­å¥æ—¶ï¼Œæ ¹æ®ä¸åŒçš„è¿ç®—ç¬¦ï¼Œå­æŸ¥è¯¢å¯ä»¥è¿”å›å•è¡Œå•åˆ—ã€å¤šè¡Œå•åˆ—ã€å•è¡Œå¤šåˆ—æ•°æ®ã€‚å­æŸ¥è¯¢å°±æ˜¯è¦è¿”å›èƒ½å¤Ÿä½œä¸º WHERE å­å¥æŸ¥è¯¢æ¡ä»¶çš„å€¼ã€‚ å½“ç”¨äº FROM å­å¥æ—¶ï¼Œä¸€èˆ¬è¿”å›å¤šè¡Œå¤šåˆ—æ•°æ®ï¼Œç›¸å½“äºè¿”å›ä¸€å¼ ä¸´æ—¶è¡¨ï¼Œè¿™æ ·æ‰ç¬¦åˆ FROM åé¢æ˜¯è¡¨çš„è§„åˆ™ã€‚è¿™ç§åšæ³•èƒ½å¤Ÿå®ç°å¤šè¡¨è”åˆæŸ¥è¯¢ã€‚ æ³¨æ„ï¼šMYSQL æ•°æ®åº“ä» 4.1 ç‰ˆæœ¬æ‰å¼€å§‹æ”¯æŒå­æŸ¥è¯¢ï¼Œæ—©æœŸç‰ˆæœ¬æ˜¯ä¸æ”¯æŒçš„ã€‚\nç”¨äº WHERE å­å¥çš„å­æŸ¥è¯¢çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š\nselect column_name [, column_name ] from table1 [, table2 ] where column_name operator (select column_name [, column_name ] from table1 [, table2 ] [where]) å­æŸ¥è¯¢éœ€è¦æ”¾åœ¨æ‹¬å·( )å†…ã€‚ operator è¡¨ç¤ºç”¨äº where å­å¥çš„è¿ç®—ç¬¦ã€‚ ç”¨äº FROM å­å¥çš„å­æŸ¥è¯¢çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š\nselect column_name [, column_name ] from (select column_name [, column_name ] from table1 [, table2 ] [where]) as temp_table_name where condition ç”¨äº FROM çš„å­æŸ¥è¯¢è¿”å›çš„ç»“æœç›¸å½“äºä¸€å¼ ä¸´æ—¶è¡¨ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ AS å…³é”®å­—ä¸ºè¯¥ä¸´æ—¶è¡¨èµ·ä¸€ä¸ªåå­—ã€‚\nå­æŸ¥è¯¢çš„å­æŸ¥è¯¢\nSELECT cust_name, cust_contact FROM customers WHERE cust_id IN (SELECT cust_id FROM orders WHERE order_num IN (SELECT order_num FROM orderitems WHERE prod_id = \u0026#39;RGAN01\u0026#39;)); å†…éƒ¨æŸ¥è¯¢é¦–å…ˆåœ¨å…¶çˆ¶æŸ¥è¯¢ä¹‹å‰æ‰§è¡Œï¼Œä»¥ä¾¿å¯ä»¥å°†å†…éƒ¨æŸ¥è¯¢çš„ç»“æœä¼ é€’ç»™å¤–éƒ¨æŸ¥è¯¢ã€‚æ‰§è¡Œè¿‡ç¨‹å¯ä»¥å‚è€ƒä¸‹å›¾ï¼š\nWHERE # WHERE å­å¥ç”¨äºè¿‡æ»¤è®°å½•ï¼Œå³ç¼©å°è®¿é—®æ•°æ®çš„èŒƒå›´ã€‚ WHERE åè·Ÿä¸€ä¸ªè¿”å› true æˆ– false çš„æ¡ä»¶ã€‚ WHERE å¯ä»¥ä¸ SELECTï¼ŒUPDATE å’Œ DELETE ä¸€èµ·ä½¿ç”¨ã€‚ å¯ä»¥åœ¨ WHERE å­å¥ä¸­ä½¿ç”¨çš„æ“ä½œç¬¦ã€‚ è¿ç®—ç¬¦ æè¿° = ç­‰äº \u0026lt;\u0026gt; ä¸ç­‰äºã€‚æ³¨é‡Šï¼šåœ¨ SQL çš„ä¸€äº›ç‰ˆæœ¬ä¸­ï¼Œè¯¥æ“ä½œç¬¦å¯è¢«å†™æˆ != \u0026gt; å¤§äº \u0026lt; å°äº \u0026gt;= å¤§äºç­‰äº \u0026lt;= å°äºç­‰äº BETWEEN åœ¨æŸä¸ªèŒƒå›´å†… LIKE æœç´¢æŸç§æ¨¡å¼ IN æŒ‡å®šé’ˆå¯¹æŸä¸ªåˆ—çš„å¤šä¸ªå¯èƒ½å€¼ SELECT è¯­å¥ä¸­çš„ WHERE å­å¥\nSELECT * FROM Customers WHERE cust_name = \u0026#39;Kids Place\u0026#39;; UPDATE è¯­å¥ä¸­çš„ WHERE å­å¥\nUPDATE Customers SET cust_name = \u0026#39;Jack Jones\u0026#39; WHERE cust_name = \u0026#39;Kids Place\u0026#39;; DELETE è¯­å¥ä¸­çš„ WHERE å­å¥\nDELETE FROM Customers WHERE cust_name = \u0026#39;Kids Place\u0026#39;; IN å’Œ BETWEEN # IN æ“ä½œç¬¦åœ¨ WHERE å­å¥ä¸­ä½¿ç”¨ï¼Œä½œç”¨æ˜¯åœ¨æŒ‡å®šçš„å‡ ä¸ªç‰¹å®šå€¼ä¸­ä»»é€‰ä¸€ä¸ªå€¼ã€‚ BETWEEN æ“ä½œç¬¦åœ¨ WHERE å­å¥ä¸­ä½¿ç”¨ï¼Œä½œç”¨æ˜¯é€‰å–ä»‹äºæŸä¸ªèŒƒå›´å†…çš„å€¼ã€‚ IN ç¤ºä¾‹\nSELECT * FROM products WHERE vend_id IN (\u0026#39;DLL01\u0026#39;, \u0026#39;BRS01\u0026#39;); BETWEEN ç¤ºä¾‹\nSELECT * FROM products WHERE prod_price BETWEEN 3 AND 5; ANDã€ORã€NOT # ANDã€ORã€NOT æ˜¯ç”¨äºå¯¹è¿‡æ»¤æ¡ä»¶çš„é€»è¾‘å¤„ç†æŒ‡ä»¤ã€‚ AND ä¼˜å…ˆçº§é«˜äº ORï¼Œä¸ºäº†æ˜ç¡®å¤„ç†é¡ºåºï¼Œå¯ä»¥ä½¿ç”¨ ()ã€‚ AND æ“ä½œç¬¦è¡¨ç¤ºå·¦å³æ¡ä»¶éƒ½è¦æ»¡è¶³ã€‚ OR æ“ä½œç¬¦è¡¨ç¤ºå·¦å³æ¡ä»¶æ»¡è¶³ä»»æ„ä¸€ä¸ªå³å¯ã€‚ NOT æ“ä½œç¬¦ç”¨äºå¦å®šä¸€ä¸ªæ¡ä»¶ã€‚ AND ç¤ºä¾‹\nSELECT prod_id, prod_name, prod_price FROM products WHERE vend_id = \u0026#39;DLL01\u0026#39; AND prod_price \u0026lt;= 4; OR ç¤ºä¾‹\nSELECT prod_id, prod_name, prod_price FROM products WHERE vend_id = \u0026#39;DLL01\u0026#39; OR vend_id = \u0026#39;BRS01\u0026#39;; NOT ç¤ºä¾‹\nSELECT * FROM products WHERE prod_price NOT BETWEEN 3 AND 5; LIKE # LIKE æ“ä½œç¬¦åœ¨ WHERE å­å¥ä¸­ä½¿ç”¨ï¼Œä½œç”¨æ˜¯ç¡®å®šå­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…æ¨¡å¼ã€‚ åªæœ‰å­—æ®µæ˜¯æ–‡æœ¬å€¼æ—¶æ‰ä½¿ç”¨ LIKEã€‚ LIKE æ”¯æŒä¸¤ä¸ªé€šé…ç¬¦åŒ¹é…é€‰é¡¹ï¼š% å’Œ _ã€‚ ä¸è¦æ»¥ç”¨é€šé…ç¬¦ï¼Œé€šé…ç¬¦ä½äºå¼€å¤´å¤„åŒ¹é…ä¼šéå¸¸æ…¢ã€‚ % è¡¨ç¤ºä»»ä½•å­—ç¬¦å‡ºç°ä»»æ„æ¬¡æ•°ã€‚ _ è¡¨ç¤ºä»»ä½•å­—ç¬¦å‡ºç°ä¸€æ¬¡ã€‚ % ç¤ºä¾‹\nSELECT prod_id, prod_name, prod_price FROM products WHERE prod_name LIKE \u0026#39;%bean bag%\u0026#39;; _ ç¤ºä¾‹\nSELECT prod_id, prod_name, prod_price FROM products WHERE prod_name LIKE \u0026#39;__ inch teddy bear\u0026#39;; è¿æ¥ # JOIN æ˜¯â€œè¿æ¥â€çš„æ„æ€ï¼Œé¡¾åæ€ä¹‰ï¼ŒSQL JOIN å­å¥ç”¨äºå°†ä¸¤ä¸ªæˆ–è€…å¤šä¸ªè¡¨è”åˆèµ·æ¥è¿›è¡ŒæŸ¥è¯¢ã€‚\nè¿æ¥è¡¨æ—¶éœ€è¦åœ¨æ¯ä¸ªè¡¨ä¸­é€‰æ‹©ä¸€ä¸ªå­—æ®µï¼Œå¹¶å¯¹è¿™äº›å­—æ®µçš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå€¼ç›¸åŒçš„ä¸¤æ¡è®°å½•å°†åˆå¹¶ä¸ºä¸€æ¡ã€‚è¿æ¥è¡¨çš„æœ¬è´¨å°±æ˜¯å°†ä¸åŒè¡¨çš„è®°å½•åˆå¹¶èµ·æ¥ï¼Œå½¢æˆä¸€å¼ æ–°è¡¨ã€‚å½“ç„¶ï¼Œè¿™å¼ æ–°è¡¨åªæ˜¯ä¸´æ—¶çš„ï¼Œå®ƒä»…å­˜åœ¨äºæœ¬æ¬¡æŸ¥è¯¢æœŸé—´ã€‚\nä½¿ç”¨ JOIN è¿æ¥ä¸¤ä¸ªè¡¨çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š\nselect table1.column1, table2.column2... from table1 join table2 on table1.common_column1 = table2.common_column2; table1.common_column1 = table2.common_column2 æ˜¯è¿æ¥æ¡ä»¶ï¼Œåªæœ‰æ»¡è¶³æ­¤æ¡ä»¶çš„è®°å½•æ‰ä¼šåˆå¹¶ä¸ºä¸€è¡Œã€‚æ‚¨å¯ä»¥ä½¿ç”¨å¤šä¸ªè¿ç®—ç¬¦æ¥è¿æ¥è¡¨ï¼Œä¾‹å¦‚ =ã€\u0026gt;ã€\u0026lt;ã€\u0026lt;\u0026gt;ã€\u0026lt;=ã€\u0026gt;=ã€!=ã€betweenã€like æˆ–è€… notï¼Œä½†æ˜¯æœ€å¸¸è§çš„æ˜¯ä½¿ç”¨ =ã€‚\nå½“ä¸¤ä¸ªè¡¨ä¸­æœ‰åŒåçš„å­—æ®µæ—¶ï¼Œä¸ºäº†å¸®åŠ©æ•°æ®åº“å¼•æ“åŒºåˆ†æ˜¯å“ªä¸ªè¡¨çš„å­—æ®µï¼Œåœ¨ä¹¦å†™åŒåå­—æ®µåæ—¶éœ€è¦åŠ ä¸Šè¡¨åã€‚å½“ç„¶ï¼Œå¦‚æœä¹¦å†™çš„å­—æ®µååœ¨ä¸¤ä¸ªè¡¨ä¸­æ˜¯å”¯ä¸€çš„ï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä»¥ä¸Šæ ¼å¼ï¼Œåªå†™å­—æ®µåå³å¯ã€‚\nå¦å¤–ï¼Œå¦‚æœä¸¤å¼ è¡¨çš„å…³è”å­—æ®µåç›¸åŒï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ USINGå­å¥æ¥ä»£æ›¿ ONï¼Œä¸¾ä¸ªä¾‹å­ï¼š\n# join....on select c.cust_name, o.order_num from Customers c inner join Orders o on c.cust_id = o.cust_id order by c.cust_name; # å¦‚æœä¸¤å¼ è¡¨çš„å…³è”å­—æ®µåç›¸åŒï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨USINGå­å¥ï¼šjoin....using() select c.cust_name, o.order_num from Customers c inner join Orders o using(cust_id) order by c.cust_name; ON å’Œ WHERE çš„åŒºåˆ«ï¼š\nè¿æ¥è¡¨æ—¶ï¼ŒSQL ä¼šæ ¹æ®è¿æ¥æ¡ä»¶ç”Ÿæˆä¸€å¼ æ–°çš„ä¸´æ—¶è¡¨ã€‚ON å°±æ˜¯è¿æ¥æ¡ä»¶ï¼Œå®ƒå†³å®šä¸´æ—¶è¡¨çš„ç”Ÿæˆã€‚ WHERE æ˜¯åœ¨ä¸´æ—¶è¡¨ç”Ÿæˆä»¥åï¼Œå†å¯¹ä¸´æ—¶è¡¨ä¸­çš„æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œç”Ÿæˆæœ€ç»ˆçš„ç»“æœé›†ï¼Œè¿™ä¸ªæ—¶å€™å·²ç»æ²¡æœ‰ JOIN-ON äº†ã€‚ æ‰€ä»¥æ€»ç»“æ¥è¯´å°±æ˜¯ï¼šSQL å…ˆæ ¹æ® ON ç”Ÿæˆä¸€å¼ ä¸´æ—¶è¡¨ï¼Œç„¶åå†æ ¹æ® WHERE å¯¹ä¸´æ—¶è¡¨è¿›è¡Œç­›é€‰ã€‚\nSQL å…è®¸åœ¨ JOIN å·¦è¾¹åŠ ä¸Šä¸€äº›ä¿®é¥°æ€§çš„å…³é”®è¯ï¼Œä»è€Œå½¢æˆä¸åŒç±»å‹çš„è¿æ¥ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š\nè¿æ¥ç±»å‹ è¯´æ˜ INNER JOIN å†…è¿æ¥ ï¼ˆé»˜è®¤è¿æ¥æ–¹å¼ï¼‰åªæœ‰å½“ä¸¤ä¸ªè¡¨éƒ½å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„è®°å½•æ—¶æ‰ä¼šè¿”å›è¡Œã€‚ LEFT JOIN / LEFT OUTER JOIN å·¦(å¤–)è¿æ¥ è¿”å›å·¦è¡¨ä¸­çš„æ‰€æœ‰è¡Œï¼Œå³ä½¿å³è¡¨ä¸­æ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚ RIGHT JOIN / RIGHT OUTER JOIN å³(å¤–)è¿æ¥ è¿”å›å³è¡¨ä¸­çš„æ‰€æœ‰è¡Œï¼Œå³ä½¿å·¦è¡¨ä¸­æ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚ FULL JOIN / FULL OUTER JOIN å…¨(å¤–)è¿æ¥ åªè¦å…¶ä¸­æœ‰ä¸€ä¸ªè¡¨å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå°±è¿”å›è¡Œã€‚ SELF JOIN å°†ä¸€ä¸ªè¡¨è¿æ¥åˆ°è‡ªèº«ï¼Œå°±åƒè¯¥è¡¨æ˜¯ä¸¤ä¸ªè¡¨ä¸€æ ·ã€‚ä¸ºäº†åŒºåˆ†ä¸¤ä¸ªè¡¨ï¼Œåœ¨ SQL è¯­å¥ä¸­éœ€è¦è‡³å°‘é‡å‘½åä¸€ä¸ªè¡¨ã€‚ CROSS JOIN äº¤å‰è¿æ¥ï¼Œä»ä¸¤ä¸ªæˆ–è€…å¤šä¸ªè¿æ¥è¡¨ä¸­è¿”å›è®°å½•é›†çš„ç¬›å¡å°”ç§¯ã€‚ ä¸‹å›¾å±•ç¤ºäº† LEFT JOINã€RIGHT JOINã€INNER JOINã€OUTER JOIN ç›¸å…³çš„ 7 ç§ç”¨æ³•ã€‚\nå¦‚æœä¸åŠ ä»»ä½•ä¿®é¥°è¯ï¼Œåªå†™ JOINï¼Œé‚£ä¹ˆé»˜è®¤ä¸º INNER JOIIN\nå¯¹äº INNER JOIIN æ¥è¯´ï¼Œè¿˜æœ‰ä¸€ç§éšå¼çš„å†™æ³•ï¼Œç§°ä¸º â€œéšå¼å†…è¿æ¥â€ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ INNER JOIIN å…³é”®å­—ï¼Œä½¿ç”¨ WHERE è¯­å¥å®ç°å†…è¿æ¥çš„åŠŸèƒ½\n# éšå¼å†…è¿æ¥ select c.cust_name, o.order_num from Customers c, Orders o where c.cust_id = o.cust_id order by c.cust_name; # æ˜¾å¼å†…è¿æ¥ select c.cust_name, o.order_num from Customers c inner join Orders o using(cust_id) order by c.cust_name; ç»„åˆ # UNION è¿ç®—ç¬¦å°†ä¸¤ä¸ªæˆ–æ›´å¤šæŸ¥è¯¢çš„ç»“æœç»„åˆèµ·æ¥ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªç»“æœé›†ï¼Œå…¶ä¸­åŒ…å«æ¥è‡ª UNION ä¸­å‚ä¸æŸ¥è¯¢çš„æå–è¡Œã€‚\nUNION åŸºæœ¬è§„åˆ™ï¼š\næ‰€æœ‰æŸ¥è¯¢çš„åˆ—æ•°å’Œåˆ—é¡ºåºå¿…é¡»ç›¸åŒã€‚ æ¯ä¸ªæŸ¥è¯¢ä¸­æ¶‰åŠè¡¨çš„åˆ—çš„æ•°æ®ç±»å‹å¿…é¡»ç›¸åŒæˆ–å…¼å®¹ã€‚ é€šå¸¸è¿”å›çš„åˆ—åå–è‡ªç¬¬ä¸€ä¸ªæŸ¥è¯¢ã€‚ é»˜è®¤åœ°ï¼ŒUNION æ“ä½œç¬¦é€‰å–ä¸åŒçš„å€¼ã€‚å¦‚æœå…è®¸é‡å¤çš„å€¼ï¼Œè¯·ä½¿ç”¨ UNION ALLã€‚\nSELECT column_name(s) FROM table1 UNION ALL SELECT column_name(s) FROM table2; UNION ç»“æœé›†ä¸­çš„åˆ—åæ€»æ˜¯ç­‰äº UNION ä¸­ç¬¬ä¸€ä¸ª SELECT è¯­å¥ä¸­çš„åˆ—åã€‚\nJOIN vs UNIONï¼š\nJOIN ä¸­è¿æ¥è¡¨çš„åˆ—å¯èƒ½ä¸åŒï¼Œä½†åœ¨ UNION ä¸­ï¼Œæ‰€æœ‰æŸ¥è¯¢çš„åˆ—æ•°å’Œåˆ—é¡ºåºå¿…é¡»ç›¸åŒã€‚ UNION å°†æŸ¥è¯¢ä¹‹åçš„è¡Œæ”¾åœ¨ä¸€èµ·ï¼ˆå‚ç›´æ”¾ç½®ï¼‰ï¼Œä½† JOIN å°†æŸ¥è¯¢ä¹‹åçš„åˆ—æ”¾åœ¨ä¸€èµ·ï¼ˆæ°´å¹³æ”¾ç½®ï¼‰ï¼Œå³å®ƒæ„æˆä¸€ä¸ªç¬›å¡å°”ç§¯ã€‚ å‡½æ•° # ä¸åŒæ•°æ®åº“çš„å‡½æ•°å¾€å¾€å„ä¸ç›¸åŒï¼Œå› æ­¤ä¸å¯ç§»æ¤ã€‚æœ¬èŠ‚ä¸»è¦ä»¥ MysSQL çš„å‡½æ•°ä¸ºä¾‹ã€‚\næ–‡æœ¬å¤„ç† # å‡½æ•° è¯´æ˜ LEFT()ã€RIGHT() å·¦è¾¹æˆ–è€…å³è¾¹çš„å­—ç¬¦ LOWER()ã€UPPER() è½¬æ¢ä¸ºå°å†™æˆ–è€…å¤§å†™ LTRIM()ã€RTIM() å»é™¤å·¦è¾¹æˆ–è€…å³è¾¹çš„ç©ºæ ¼ LENGTH() é•¿åº¦ SOUNDEX() è½¬æ¢ä¸ºè¯­éŸ³å€¼ å…¶ä¸­ï¼Œ SOUNDEX() å¯ä»¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºæè¿°å…¶è¯­éŸ³è¡¨ç¤ºçš„å­—æ¯æ•°å­—æ¨¡å¼ã€‚\nSELECT * FROM mytable WHERE SOUNDEX(col1) = SOUNDEX(\u0026#39;apple\u0026#39;) æ—¥æœŸå’Œæ—¶é—´å¤„ç† # æ—¥æœŸæ ¼å¼ï¼šYYYY-MM-DD æ—¶é—´æ ¼å¼ï¼šHH:MM:SS å‡½ æ•° è¯´ æ˜ AddDate() å¢åŠ ä¸€ä¸ªæ—¥æœŸï¼ˆå¤©ã€å‘¨ç­‰ï¼‰ AddTime() å¢åŠ ä¸€ä¸ªæ—¶é—´ï¼ˆæ—¶ã€åˆ†ç­‰ï¼‰ CurDate() è¿”å›å½“å‰æ—¥æœŸ CurTime() è¿”å›å½“å‰æ—¶é—´ Date() è¿”å›æ—¥æœŸæ—¶é—´çš„æ—¥æœŸéƒ¨åˆ† DateDiff() è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹å·® Date_Add() é«˜åº¦çµæ´»çš„æ—¥æœŸè¿ç®—å‡½æ•° Date_Format() è¿”å›ä¸€ä¸ªæ ¼å¼åŒ–çš„æ—¥æœŸæˆ–æ—¶é—´ä¸² Day() è¿”å›ä¸€ä¸ªæ—¥æœŸçš„å¤©æ•°éƒ¨åˆ† DayOfWeek() å¯¹äºä¸€ä¸ªæ—¥æœŸï¼Œè¿”å›å¯¹åº”çš„æ˜ŸæœŸå‡  Hour() è¿”å›ä¸€ä¸ªæ—¶é—´çš„å°æ—¶éƒ¨åˆ† Minute() è¿”å›ä¸€ä¸ªæ—¶é—´çš„åˆ†é’Ÿéƒ¨åˆ† Month() è¿”å›ä¸€ä¸ªæ—¥æœŸçš„æœˆä»½éƒ¨åˆ† Now() è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´ Second() è¿”å›ä¸€ä¸ªæ—¶é—´çš„ç§’éƒ¨åˆ† Time() è¿”å›ä¸€ä¸ªæ—¥æœŸæ—¶é—´çš„æ—¶é—´éƒ¨åˆ† Year() è¿”å›ä¸€ä¸ªæ—¥æœŸçš„å¹´ä»½éƒ¨åˆ† æ•°å€¼å¤„ç† # å‡½æ•° è¯´æ˜ SIN() æ­£å¼¦ COS() ä½™å¼¦ TAN() æ­£åˆ‡ ABS() ç»å¯¹å€¼ SQRT() å¹³æ–¹æ ¹ MOD() ä½™æ•° EXP() æŒ‡æ•° PI() åœ†å‘¨ç‡ RAND() éšæœºæ•° æ±‡æ€» # å‡½ æ•° è¯´ æ˜ AVG() è¿”å›æŸåˆ—çš„å¹³å‡å€¼ COUNT() è¿”å›æŸåˆ—çš„è¡Œæ•° MAX() è¿”å›æŸåˆ—çš„æœ€å¤§å€¼ MIN() è¿”å›æŸåˆ—çš„æœ€å°å€¼ SUM() è¿”å›æŸåˆ—å€¼ä¹‹å’Œ AVG() ä¼šå¿½ç•¥ NULL è¡Œã€‚\nä½¿ç”¨ DISTINCT å¯ä»¥è®©æ±‡æ€»å‡½æ•°å€¼æ±‡æ€»ä¸åŒçš„å€¼ã€‚\nSELECT AVG(DISTINCT col1) AS avg_col FROM mytable æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ä»‹ç» DDL è¯­å¥ç”¨æ³•ã€‚DDL çš„ä¸»è¦åŠŸèƒ½æ˜¯å®šä¹‰æ•°æ®åº“å¯¹è±¡ï¼ˆå¦‚ï¼šæ•°æ®åº“ã€æ•°æ®è¡¨ã€è§†å›¾ã€ç´¢å¼•ç­‰ï¼‰\næ•°æ®å®šä¹‰ # æ•°æ®åº“ï¼ˆDATABASEï¼‰ # åˆ›å»ºæ•°æ®åº“ # CREATE DATABASE test; åˆ é™¤æ•°æ®åº“ # DROP DATABASE test; é€‰æ‹©æ•°æ®åº“ # USE test; æ•°æ®è¡¨ï¼ˆTABLEï¼‰ # åˆ›å»ºæ•°æ®è¡¨ # æ™®é€šåˆ›å»º\nCREATE TABLE user ( id int(10) unsigned NOT NULL COMMENT \u0026#39;Id\u0026#39;, username varchar(64) NOT NULL DEFAULT \u0026#39;default\u0026#39; COMMENT \u0026#39;ç”¨æˆ·å\u0026#39;, password varchar(64) NOT NULL DEFAULT \u0026#39;default\u0026#39; COMMENT \u0026#39;å¯†ç \u0026#39;, email varchar(64) NOT NULL DEFAULT \u0026#39;default\u0026#39; COMMENT \u0026#39;é‚®ç®±\u0026#39; ) COMMENT=\u0026#39;ç”¨æˆ·è¡¨\u0026#39;; æ ¹æ®å·²æœ‰çš„è¡¨åˆ›å»ºæ–°è¡¨\nCREATE TABLE vip_user AS SELECT * FROM user; åˆ é™¤æ•°æ®è¡¨ # DROP TABLE user; ä¿®æ”¹æ•°æ®è¡¨ # æ·»åŠ åˆ—\nALTER TABLE user ADD age int(3); åˆ é™¤åˆ—\nALTER TABLE user DROP COLUMN age; ä¿®æ”¹åˆ—\nALTER TABLE `user` MODIFY COLUMN age tinyint; æ·»åŠ ä¸»é”®\nALTER TABLE user ADD PRIMARY KEY (id); åˆ é™¤ä¸»é”®\nALTER TABLE user DROP PRIMARY KEY; è§†å›¾ï¼ˆVIEWï¼‰ # å®šä¹‰ï¼š\nè§†å›¾æ˜¯åŸºäº SQL è¯­å¥çš„ç»“æœé›†çš„å¯è§†åŒ–çš„è¡¨ã€‚ è§†å›¾æ˜¯è™šæ‹Ÿçš„è¡¨ï¼Œæœ¬èº«ä¸åŒ…å«æ•°æ®ï¼Œä¹Ÿå°±ä¸èƒ½å¯¹å…¶è¿›è¡Œç´¢å¼•æ“ä½œã€‚å¯¹è§†å›¾çš„æ“ä½œå’Œå¯¹æ™®é€šè¡¨çš„æ“ä½œä¸€æ ·ã€‚ ä½œç”¨ï¼š\nç®€åŒ–å¤æ‚çš„ SQL æ“ä½œï¼Œæ¯”å¦‚å¤æ‚çš„è”ç»“ï¼› åªä½¿ç”¨å®é™…è¡¨çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼› é€šè¿‡åªç»™ç”¨æˆ·è®¿é—®è§†å›¾çš„æƒé™ï¼Œä¿è¯æ•°æ®çš„å®‰å…¨æ€§ï¼› æ›´æ”¹æ•°æ®æ ¼å¼å’Œè¡¨ç¤ºã€‚ åˆ›å»ºè§†å›¾ # CREATE VIEW top_10_user_view AS SELECT id, username FROM user WHERE id \u0026lt; 10; åˆ é™¤è§†å›¾ # DROP VIEW top_10_user_view; ç´¢å¼•ï¼ˆINDEXï¼‰ # ç´¢å¼•æ˜¯ä¸€ç§ç”¨äºå¿«é€ŸæŸ¥è¯¢å’Œæ£€ç´¢æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œå…¶æœ¬è´¨å¯ä»¥çœ‹æˆæ˜¯ä¸€ç§æ’åºå¥½çš„æ•°æ®ç»“æ„ã€‚\nç´¢å¼•çš„ä½œç”¨å°±ç›¸å½“äºä¹¦çš„ç›®å½•ã€‚æ‰“ä¸ªæ¯”æ–¹: æˆ‘ä»¬åœ¨æŸ¥å­—å…¸çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰ç›®å½•ï¼Œé‚£æˆ‘ä»¬å°±åªèƒ½ä¸€é¡µä¸€é¡µçš„å»æ‰¾æˆ‘ä»¬éœ€è¦æŸ¥çš„é‚£ä¸ªå­—ï¼Œé€Ÿåº¦å¾ˆæ…¢ã€‚å¦‚æœæœ‰ç›®å½•äº†ï¼Œæˆ‘ä»¬åªéœ€è¦å…ˆå»ç›®å½•é‡ŒæŸ¥æ‰¾å­—çš„ä½ç½®ï¼Œç„¶åç›´æ¥ç¿»åˆ°é‚£ä¸€é¡µå°±è¡Œäº†ã€‚\nä¼˜ç‚¹ ï¼š\nä½¿ç”¨ç´¢å¼•å¯ä»¥å¤§å¤§åŠ å¿« æ•°æ®çš„æ£€ç´¢é€Ÿåº¦ï¼ˆå¤§å¤§å‡å°‘æ£€ç´¢çš„æ•°æ®é‡ï¼‰, è¿™ä¹Ÿæ˜¯åˆ›å»ºç´¢å¼•çš„æœ€ä¸»è¦çš„åŸå› ã€‚ é€šè¿‡åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•ï¼Œå¯ä»¥ä¿è¯æ•°æ®åº“è¡¨ä¸­æ¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ€§ã€‚ ç¼ºç‚¹ ï¼š\nåˆ›å»ºç´¢å¼•å’Œç»´æŠ¤ç´¢å¼•éœ€è¦è€—è´¹è®¸å¤šæ—¶é—´ã€‚å½“å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢åˆ æ”¹çš„æ—¶å€™ï¼Œå¦‚æœæ•°æ®æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆç´¢å¼•ä¹Ÿéœ€è¦åŠ¨æ€çš„ä¿®æ”¹ï¼Œä¼šé™ä½ SQL æ‰§è¡Œæ•ˆç‡ã€‚ ç´¢å¼•éœ€è¦ä½¿ç”¨ç‰©ç†æ–‡ä»¶å­˜å‚¨ï¼Œä¹Ÿä¼šè€—è´¹ä¸€å®šç©ºé—´ã€‚ ä½†æ˜¯ï¼Œä½¿ç”¨ç´¢å¼•ä¸€å®šèƒ½æé«˜æŸ¥è¯¢æ€§èƒ½å—?\nå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç´¢å¼•æŸ¥è¯¢éƒ½æ˜¯æ¯”å…¨è¡¨æ‰«æè¦å¿«çš„ã€‚ä½†æ˜¯å¦‚æœæ•°æ®åº“çš„æ•°æ®é‡ä¸å¤§ï¼Œé‚£ä¹ˆä½¿ç”¨ç´¢å¼•ä¹Ÿä¸ä¸€å®šèƒ½å¤Ÿå¸¦æ¥å¾ˆå¤§æå‡ã€‚\nå…³äºç´¢å¼•çš„è¯¦ç»†ä»‹ç»ï¼Œè¯·çœ‹æˆ‘å†™çš„ MySQL ç´¢å¼•è¯¦è§£ è¿™ç¯‡æ–‡ç« ã€‚\nåˆ›å»ºç´¢å¼• # CREATE INDEX user_index ON user (id); æ·»åŠ ç´¢å¼• # ALTER table user ADD INDEX user_index(id) åˆ›å»ºå”¯ä¸€ç´¢å¼• # CREATE UNIQUE INDEX user_index ON user (id); åˆ é™¤ç´¢å¼• # ALTER TABLE user DROP INDEX user_index; çº¦æŸ # SQL çº¦æŸç”¨äºè§„å®šè¡¨ä¸­çš„æ•°æ®è§„åˆ™ã€‚\nå¦‚æœå­˜åœ¨è¿åçº¦æŸçš„æ•°æ®è¡Œä¸ºï¼Œè¡Œä¸ºä¼šè¢«çº¦æŸç»ˆæ­¢ã€‚\nçº¦æŸå¯ä»¥åœ¨åˆ›å»ºè¡¨æ—¶è§„å®šï¼ˆé€šè¿‡ CREATE TABLE è¯­å¥ï¼‰ï¼Œæˆ–è€…åœ¨è¡¨åˆ›å»ºä¹‹åè§„å®šï¼ˆé€šè¿‡ ALTER TABLE è¯­å¥ï¼‰ã€‚\nçº¦æŸç±»å‹ï¼š\nNOT NULL - æŒ‡ç¤ºæŸåˆ—ä¸èƒ½å­˜å‚¨ NULL å€¼ã€‚ UNIQUE - ä¿è¯æŸåˆ—çš„æ¯è¡Œå¿…é¡»æœ‰å”¯ä¸€çš„å€¼ã€‚ PRIMARY KEY - NOT NULL å’Œ UNIQUE çš„ç»“åˆã€‚ç¡®ä¿æŸåˆ—ï¼ˆæˆ–ä¸¤ä¸ªåˆ—å¤šä¸ªåˆ—çš„ç»“åˆï¼‰æœ‰å”¯ä¸€æ ‡è¯†ï¼Œæœ‰åŠ©äºæ›´å®¹æ˜“æ›´å¿«é€Ÿåœ°æ‰¾åˆ°è¡¨ä¸­çš„ä¸€ä¸ªç‰¹å®šçš„è®°å½•ã€‚ FOREIGN KEY - ä¿è¯ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®åŒ¹é…å¦ä¸€ä¸ªè¡¨ä¸­çš„å€¼çš„å‚ç…§å®Œæ•´æ€§ã€‚ CHECK - ä¿è¯åˆ—ä¸­çš„å€¼ç¬¦åˆæŒ‡å®šçš„æ¡ä»¶ã€‚ DEFAULT - è§„å®šæ²¡æœ‰ç»™åˆ—èµ‹å€¼æ—¶çš„é»˜è®¤å€¼ã€‚ åˆ›å»ºè¡¨æ—¶ä½¿ç”¨çº¦æŸæ¡ä»¶ï¼š\nCREATE TABLE Users ( Id INT(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT \u0026#39;è‡ªå¢Id\u0026#39;, Username VARCHAR(64) NOT NULL UNIQUE DEFAULT \u0026#39;default\u0026#39; COMMENT \u0026#39;ç”¨æˆ·å\u0026#39;, Password VARCHAR(64) NOT NULL DEFAULT \u0026#39;default\u0026#39; COMMENT \u0026#39;å¯†ç \u0026#39;, Email VARCHAR(64) NOT NULL DEFAULT \u0026#39;default\u0026#39; COMMENT \u0026#39;é‚®ç®±åœ°å€\u0026#39;, Enabled TINYINT(4) DEFAULT NULL COMMENT \u0026#39;æ˜¯å¦æœ‰æ•ˆ\u0026#39;, PRIMARY KEY (Id) ) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COMMENT=\u0026#39;ç”¨æˆ·è¡¨\u0026#39;; æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ä»‹ç» TCL è¯­å¥ç”¨æ³•ã€‚TCL çš„ä¸»è¦åŠŸèƒ½æ˜¯ç®¡ç†æ•°æ®åº“ä¸­çš„äº‹åŠ¡ã€‚\näº‹åŠ¡å¤„ç† # ä¸èƒ½å›é€€ SELECT è¯­å¥ï¼Œå›é€€ SELECT è¯­å¥ä¹Ÿæ²¡æ„ä¹‰ï¼›ä¹Ÿä¸èƒ½å›é€€ CREATE å’Œ DROP è¯­å¥ã€‚\nMySQL é»˜è®¤æ˜¯éšå¼æäº¤ï¼Œæ¯æ‰§è¡Œä¸€æ¡è¯­å¥å°±æŠŠè¿™æ¡è¯­å¥å½“æˆä¸€ä¸ªäº‹åŠ¡ç„¶åè¿›è¡Œæäº¤ã€‚å½“å‡ºç° START TRANSACTION è¯­å¥æ—¶ï¼Œä¼šå…³é—­éšå¼æäº¤ï¼›å½“ COMMIT æˆ– ROLLBACK è¯­å¥æ‰§è¡Œåï¼Œäº‹åŠ¡ä¼šè‡ªåŠ¨å…³é—­ï¼Œé‡æ–°æ¢å¤éšå¼æäº¤ã€‚\né€šè¿‡ set autocommit=0 å¯ä»¥å–æ¶ˆè‡ªåŠ¨æäº¤ï¼Œç›´åˆ° set autocommit=1 æ‰ä¼šæäº¤ï¼›autocommit æ ‡è®°æ˜¯é’ˆå¯¹æ¯ä¸ªè¿æ¥è€Œä¸æ˜¯é’ˆå¯¹æœåŠ¡å™¨çš„ã€‚\næŒ‡ä»¤ï¼š\nSTART TRANSACTION - æŒ‡ä»¤ç”¨äºæ ‡è®°äº‹åŠ¡çš„èµ·å§‹ç‚¹ã€‚ SAVEPOINT - æŒ‡ä»¤ç”¨äºåˆ›å»ºä¿ç•™ç‚¹ã€‚ ROLLBACK TO - æŒ‡ä»¤ç”¨äºå›æ»šåˆ°æŒ‡å®šçš„ä¿ç•™ç‚¹ï¼›å¦‚æœæ²¡æœ‰è®¾ç½®ä¿ç•™ç‚¹ï¼Œåˆ™å›é€€åˆ° START TRANSACTION è¯­å¥å¤„ã€‚ COMMIT - æäº¤äº‹åŠ¡ã€‚ -- å¼€å§‹äº‹åŠ¡ START TRANSACTION; -- æ’å…¥æ“ä½œ A INSERT INTO `user` VALUES (1, \u0026#39;root1\u0026#39;, \u0026#39;root1\u0026#39;, \u0026#39;xxxx@163.com\u0026#39;); -- åˆ›å»ºä¿ç•™ç‚¹ updateA SAVEPOINT updateA; -- æ’å…¥æ“ä½œ B INSERT INTO `user` VALUES (2, \u0026#39;root2\u0026#39;, \u0026#39;root2\u0026#39;, \u0026#39;xxxx@163.com\u0026#39;); -- å›æ»šåˆ°ä¿ç•™ç‚¹ updateA ROLLBACK TO updateA; -- æäº¤äº‹åŠ¡ï¼Œåªæœ‰æ“ä½œ A ç”Ÿæ•ˆ COMMIT; æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ä»‹ç» DCL è¯­å¥ç”¨æ³•ã€‚DCL çš„ä¸»è¦åŠŸèƒ½æ˜¯æ§åˆ¶ç”¨æˆ·çš„è®¿é—®æƒé™ã€‚\næƒé™æ§åˆ¶ # è¦æˆäºˆç”¨æˆ·å¸æˆ·æƒé™ï¼Œå¯ä»¥ç”¨GRANTå‘½ä»¤ã€‚æœ‰æ’¤é”€ç”¨æˆ·çš„æƒé™ï¼Œå¯ä»¥ç”¨REVOKEå‘½ä»¤ã€‚è¿™é‡Œä»¥ MySQl ä¸ºä¾‹ï¼Œä»‹ç»æƒé™æ§åˆ¶å®é™…åº”ç”¨ã€‚\nGRANTæˆäºˆæƒé™è¯­æ³•ï¼š\nGRANT privilege,[privilege],.. ON privilege_level TO user [IDENTIFIED BY password] [REQUIRE tsl_option] [WITH [GRANT_OPTION | resource_option]]; ç®€å•è§£é‡Šä¸€ä¸‹ï¼š\nåœ¨GRANTå…³é”®å­—åæŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªæƒé™ã€‚å¦‚æœæˆäºˆç”¨æˆ·å¤šä¸ªæƒé™ï¼Œåˆ™æ¯ä¸ªæƒé™ç”±é€—å·åˆ†éš”ã€‚ ON privilege_level ç¡®å®šæƒé™åº”ç”¨çº§åˆ«ã€‚MySQL æ”¯æŒ globalï¼ˆ*.*ï¼‰ï¼Œdatabaseï¼ˆdatabase.*ï¼‰ï¼Œtableï¼ˆdatabase.tableï¼‰å’Œåˆ—çº§åˆ«ã€‚å¦‚æœä½¿ç”¨åˆ—æƒé™çº§åˆ«ï¼Œåˆ™å¿…é¡»åœ¨æ¯ä¸ªæƒé™ä¹‹åæŒ‡å®šä¸€ä¸ªæˆ–é€—å·åˆ†éš”åˆ—çš„åˆ—è¡¨ã€‚ user æ˜¯è¦æˆäºˆæƒé™çš„ç”¨æˆ·ã€‚å¦‚æœç”¨æˆ·å·²å­˜åœ¨ï¼Œåˆ™GRANTè¯­å¥å°†ä¿®æ”¹å…¶æƒé™ã€‚å¦åˆ™ï¼ŒGRANTè¯­å¥å°†åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·ã€‚å¯é€‰å­å¥IDENTIFIED BYå…è®¸æ‚¨ä¸ºç”¨æˆ·è®¾ç½®æ–°çš„å¯†ç ã€‚ REQUIRE tsl_optionæŒ‡å®šç”¨æˆ·æ˜¯å¦å¿…é¡»é€šè¿‡ SSLï¼ŒX059 ç­‰å®‰å…¨è¿æ¥è¿æ¥åˆ°æ•°æ®åº“æœåŠ¡å™¨ã€‚ å¯é€‰ WITH GRANT OPTION å­å¥å…è®¸æ‚¨æˆäºˆå…¶ä»–ç”¨æˆ·æˆ–ä»å…¶ä»–ç”¨æˆ·ä¸­åˆ é™¤æ‚¨æ‹¥æœ‰çš„æƒé™ã€‚æ­¤å¤–ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨WITHå­å¥åˆ†é… MySQL æ•°æ®åº“æœåŠ¡å™¨çš„èµ„æºï¼Œä¾‹å¦‚ï¼Œè®¾ç½®ç”¨æˆ·æ¯å°æ—¶å¯ä»¥ä½¿ç”¨çš„è¿æ¥æ•°æˆ–è¯­å¥æ•°ã€‚è¿™åœ¨ MySQL å…±äº«æ‰˜ç®¡ç­‰å…±äº«ç¯å¢ƒä¸­éå¸¸æœ‰ç”¨ã€‚ REVOKE æ’¤é”€æƒé™è¯­æ³•ï¼š\nREVOKE privilege_type [(column_list)] [, priv_type [(column_list)]]... ON [object_type] privilege_level FROM user [, user]... ç®€å•è§£é‡Šä¸€ä¸‹ï¼š\nåœ¨ REVOKE å…³é”®å­—åé¢æŒ‡å®šè¦ä»ç”¨æˆ·æ’¤æ¶ˆçš„æƒé™åˆ—è¡¨ã€‚æ‚¨éœ€è¦ç”¨é€—å·åˆ†éš”æƒé™ã€‚ æŒ‡å®šåœ¨ ON å­å¥ä¸­æ’¤é”€ç‰¹æƒçš„ç‰¹æƒçº§åˆ«ã€‚ æŒ‡å®šè¦æ’¤æ¶ˆ FROM å­å¥ä¸­çš„æƒé™çš„ç”¨æˆ·å¸æˆ·ã€‚ GRANT å’Œ REVOKE å¯åœ¨å‡ ä¸ªå±‚æ¬¡ä¸Šæ§åˆ¶è®¿é—®æƒé™ï¼š\næ•´ä¸ªæœåŠ¡å™¨ï¼Œä½¿ç”¨ GRANT ALL å’Œ REVOKE ALLï¼› æ•´ä¸ªæ•°æ®åº“ï¼Œä½¿ç”¨ ON database.*ï¼› ç‰¹å®šçš„è¡¨ï¼Œä½¿ç”¨ ON database.tableï¼› ç‰¹å®šçš„åˆ—ï¼› ç‰¹å®šçš„å­˜å‚¨è¿‡ç¨‹ã€‚ æ–°åˆ›å»ºçš„è´¦æˆ·æ²¡æœ‰ä»»ä½•æƒé™ã€‚è´¦æˆ·ç”¨ username@host çš„å½¢å¼å®šä¹‰ï¼Œusername@% ä½¿ç”¨çš„æ˜¯é»˜è®¤ä¸»æœºåã€‚MySQL çš„è´¦æˆ·ä¿¡æ¯ä¿å­˜åœ¨ mysql è¿™ä¸ªæ•°æ®åº“ä¸­ã€‚\nUSE mysql; SELECT user FROM user; ä¸‹è¡¨è¯´æ˜äº†å¯ç”¨äºGRANTå’ŒREVOKEè¯­å¥çš„æ‰€æœ‰å…è®¸æƒé™ï¼š\nç‰¹æƒ è¯´æ˜ çº§åˆ« å…¨å±€ æ•°æ®åº“ è¡¨ åˆ— ç¨‹åº ä»£ç† ALL [PRIVILEGES] æˆäºˆé™¤ GRANT OPTION ä¹‹å¤–çš„æŒ‡å®šè®¿é—®çº§åˆ«çš„æ‰€æœ‰æƒé™ ALTER å…è®¸ç”¨æˆ·ä½¿ç”¨ ALTER TABLE è¯­å¥ X X X ALTER ROUTINE å…è®¸ç”¨æˆ·æ›´æ”¹æˆ–åˆ é™¤å­˜å‚¨çš„ä¾‹ç¨‹ X X X CREATE å…è®¸ç”¨æˆ·åˆ›å»ºæ•°æ®åº“å’Œè¡¨ X X X CREATE ROUTINE å…è®¸ç”¨æˆ·åˆ›å»ºå­˜å‚¨çš„ä¾‹ç¨‹ X X CREATE TABLESPACE å…è®¸ç”¨æˆ·åˆ›å»ºï¼Œæ›´æ”¹æˆ–åˆ é™¤è¡¨ç©ºé—´å’Œæ—¥å¿—æ–‡ä»¶ç»„ X CREATE TEMPORARY TABLES å…è®¸ç”¨æˆ·ä½¿ç”¨ CREATE TEMPORARY TABLE åˆ›å»ºä¸´æ—¶è¡¨ X X CREATE USER å…è®¸ç”¨æˆ·ä½¿ç”¨ CREATE USERï¼ŒDROP USERï¼ŒRENAME USER å’Œ REVOKE ALL PRIVILEGES è¯­å¥ã€‚ X CREATE VIEW å…è®¸ç”¨æˆ·åˆ›å»ºæˆ–ä¿®æ”¹è§†å›¾ã€‚ X X X DELETE å…è®¸ç”¨æˆ·ä½¿ç”¨ DELETE X X X DROP å…è®¸ç”¨æˆ·åˆ é™¤æ•°æ®åº“ï¼Œè¡¨å’Œè§†å›¾ X X X EVENT å¯ç”¨äº‹ä»¶è®¡åˆ’ç¨‹åºçš„äº‹ä»¶ä½¿ç”¨ã€‚ X X EXECUTE å…è®¸ç”¨æˆ·æ‰§è¡Œå­˜å‚¨çš„ä¾‹ç¨‹ X X X FILE å…è®¸ç”¨æˆ·è¯»å–æ•°æ®åº“ç›®å½•ä¸­çš„ä»»ä½•æ–‡ä»¶ã€‚ X GRANT OPTION å…è®¸ç”¨æˆ·æ‹¥æœ‰æˆäºˆæˆ–æ’¤æ¶ˆå…¶ä»–å¸æˆ·æƒé™çš„æƒé™ã€‚ X X X X X INDEX å…è®¸ç”¨æˆ·åˆ›å»ºæˆ–åˆ é™¤ç´¢å¼•ã€‚ X X X INSERT å…è®¸ç”¨æˆ·ä½¿ç”¨ INSERT è¯­å¥ X X X X LOCK TABLES å…è®¸ç”¨æˆ·å¯¹å…·æœ‰ SELECT æƒé™çš„è¡¨ä½¿ç”¨ LOCK TABLES X X PROCESS å…è®¸ç”¨æˆ·ä½¿ç”¨ SHOW PROCESSLIST è¯­å¥æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹ã€‚ X PROXY å¯ç”¨ç”¨æˆ·ä»£ç†ã€‚ REFERENCES å…è®¸ç”¨æˆ·åˆ›å»ºå¤–é”® X X X X RELOAD å…è®¸ç”¨æˆ·ä½¿ç”¨ FLUSH æ“ä½œ X REPLICATION CLIENT å…è®¸ç”¨æˆ·æŸ¥è¯¢ä»¥æŸ¥çœ‹ä¸»æœåŠ¡å™¨æˆ–ä»å±æœåŠ¡å™¨çš„ä½ç½® X REPLICATION SLAVE å…è®¸ç”¨æˆ·ä½¿ç”¨å¤åˆ¶ä»å±ä»ä¸»æœåŠ¡å™¨è¯»å–äºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶ã€‚ X SELECT å…è®¸ç”¨æˆ·ä½¿ç”¨ SELECT è¯­å¥ X X X X SHOW DATABASES å…è®¸ç”¨æˆ·æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“ X SHOW VIEW å…è®¸ç”¨æˆ·ä½¿ç”¨ SHOW CREATE VIEW è¯­å¥ X X X SHUTDOWN å…è®¸ç”¨æˆ·ä½¿ç”¨ mysqladmin shutdown å‘½ä»¤ X SUPER å…è®¸ç”¨æˆ·ä½¿ç”¨å…¶ä»–ç®¡ç†æ“ä½œï¼Œä¾‹å¦‚ CHANGE MASTER TOï¼ŒKILLï¼ŒPURGE BINARY LOGSï¼ŒSET GLOBAL å’Œ mysqladmin å‘½ä»¤ X TRIGGER å…è®¸ç”¨æˆ·ä½¿ç”¨ TRIGGER æ“ä½œã€‚ X X X UPDATE å…è®¸ç”¨æˆ·ä½¿ç”¨ UPDATE è¯­å¥ X X X X USAGE ç›¸å½“äºâ€œæ²¡æœ‰ç‰¹æƒâ€ åˆ›å»ºè´¦æˆ· # CREATE USER myuser IDENTIFIED BY \u0026#39;mypassword\u0026#39;; ä¿®æ”¹è´¦æˆ·å # UPDATE user SET user=\u0026#39;newuser\u0026#39; WHERE user=\u0026#39;myuser\u0026#39;; FLUSH PRIVILEGES; åˆ é™¤è´¦æˆ· # DROP USER myuser; æŸ¥çœ‹æƒé™ # SHOW GRANTS FOR myuser; æˆäºˆæƒé™ # GRANT SELECT, INSERT ON *.* TO myuser; åˆ é™¤æƒé™ # REVOKE SELECT, INSERT ON *.* FROM myuser; æ›´æ”¹å¯†ç  # SET PASSWORD FOR myuser = \u0026#39;mypass\u0026#39;; å­˜å‚¨è¿‡ç¨‹ # å­˜å‚¨è¿‡ç¨‹å¯ä»¥çœ‹æˆæ˜¯å¯¹ä¸€ç³»åˆ— SQL æ“ä½œçš„æ‰¹å¤„ç†ã€‚å­˜å‚¨è¿‡ç¨‹å¯ä»¥ç”±è§¦å‘å™¨ï¼Œå…¶ä»–å­˜å‚¨è¿‡ç¨‹ä»¥åŠ Javaï¼Œ Pythonï¼ŒPHP ç­‰åº”ç”¨ç¨‹åºè°ƒç”¨ã€‚\nä½¿ç”¨å­˜å‚¨è¿‡ç¨‹çš„å¥½å¤„ï¼š\nä»£ç å°è£…ï¼Œä¿è¯äº†ä¸€å®šçš„å®‰å…¨æ€§ï¼› ä»£ç å¤ç”¨ï¼› ç”±äºæ˜¯é¢„å…ˆç¼–è¯‘ï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„æ€§èƒ½ã€‚ åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ï¼š\nå‘½ä»¤è¡Œä¸­åˆ›å»ºå­˜å‚¨è¿‡ç¨‹éœ€è¦è‡ªå®šä¹‰åˆ†éš”ç¬¦ï¼Œå› ä¸ºå‘½ä»¤è¡Œæ˜¯ä»¥ ; ä¸ºç»“æŸç¬¦ï¼Œè€Œå­˜å‚¨è¿‡ç¨‹ä¸­ä¹ŸåŒ…å«äº†åˆ†å·ï¼Œå› æ­¤ä¼šé”™è¯¯æŠŠè¿™éƒ¨åˆ†åˆ†å·å½“æˆæ˜¯ç»“æŸç¬¦ï¼Œé€ æˆè¯­æ³•é”™è¯¯ã€‚ åŒ…å« inã€out å’Œ inout ä¸‰ç§å‚æ•°ã€‚ ç»™å˜é‡èµ‹å€¼éƒ½éœ€è¦ç”¨ select into è¯­å¥ã€‚ æ¯æ¬¡åªèƒ½ç»™ä¸€ä¸ªå˜é‡èµ‹å€¼ï¼Œä¸æ”¯æŒé›†åˆçš„æ“ä½œã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼šé˜¿é‡Œå·´å·´ã€ŠJava å¼€å‘æ‰‹å†Œã€‹å¼ºåˆ¶ç¦æ­¢ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ã€‚å› ä¸ºå­˜å‚¨è¿‡ç¨‹éš¾ä»¥è°ƒè¯•å’Œæ‰©å±•ï¼Œæ›´æ²¡æœ‰ç§»æ¤æ€§ã€‚\nè‡³äºåˆ°åº•è¦ä¸è¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œè¿˜æ˜¯è¦çœ‹é¡¹ç›®å®é™…éœ€æ±‚ï¼Œæƒè¡¡å¥½åˆ©å¼Šå³å¯ï¼\nåˆ›å»ºå­˜å‚¨è¿‡ç¨‹ # DROP PROCEDURE IF EXISTS `proc_adder`; DELIMITER ;; CREATE DEFINER=`root`@`localhost` PROCEDURE `proc_adder`(IN a int, IN b int, OUT sum int) BEGIN DECLARE c int; if a is null then set a = 0; end if; if b is null then set b = 0; end if; set sum = a + b; END ;; DELIMITER ; ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ # set @b=5; call proc_adder(2,@b,@s); select @s as sum; æ¸¸æ ‡ # æ¸¸æ ‡ï¼ˆcursorï¼‰æ˜¯ä¸€ä¸ªå­˜å‚¨åœ¨ DBMS æœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“æŸ¥è¯¢ï¼Œå®ƒä¸æ˜¯ä¸€æ¡ SELECT è¯­å¥ï¼Œè€Œæ˜¯è¢«è¯¥è¯­å¥æ£€ç´¢å‡ºæ¥çš„ç»“æœé›†ã€‚\nåœ¨å­˜å‚¨è¿‡ç¨‹ä¸­ä½¿ç”¨æ¸¸æ ‡å¯ä»¥å¯¹ä¸€ä¸ªç»“æœé›†è¿›è¡Œç§»åŠ¨éå†ã€‚\næ¸¸æ ‡ä¸»è¦ç”¨äºäº¤äº’å¼åº”ç”¨ï¼Œå…¶ä¸­ç”¨æˆ·éœ€è¦æ»šåŠ¨å±å¹•ä¸Šçš„æ•°æ®ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæµè§ˆæˆ–åšå‡ºæ›´æ”¹ã€‚\nä½¿ç”¨æ¸¸æ ‡çš„å‡ ä¸ªæ˜ç¡®æ­¥éª¤ï¼š\nåœ¨ä½¿ç”¨æ¸¸æ ‡å‰ï¼Œå¿…é¡»å£°æ˜(å®šä¹‰)å®ƒã€‚è¿™ä¸ªè¿‡ç¨‹å®é™…ä¸Šæ²¡æœ‰æ£€ç´¢æ•°æ®ï¼Œ å®ƒåªæ˜¯å®šä¹‰è¦ä½¿ç”¨çš„ SELECT è¯­å¥å’Œæ¸¸æ ‡é€‰é¡¹ã€‚\nä¸€æ—¦å£°æ˜ï¼Œå°±å¿…é¡»æ‰“å¼€æ¸¸æ ‡ä»¥ä¾›ä½¿ç”¨ã€‚è¿™ä¸ªè¿‡ç¨‹ç”¨å‰é¢å®šä¹‰çš„ SELECT è¯­å¥æŠŠæ•°æ®å®é™…æ£€ç´¢å‡ºæ¥ã€‚\nå¯¹äºå¡«æœ‰æ•°æ®çš„æ¸¸æ ‡ï¼Œæ ¹æ®éœ€è¦å–å‡º(æ£€ç´¢)å„è¡Œã€‚\nåœ¨ç»“æŸæ¸¸æ ‡ä½¿ç”¨æ—¶ï¼Œå¿…é¡»å…³é—­æ¸¸æ ‡ï¼Œå¯èƒ½çš„è¯ï¼Œé‡Šæ”¾æ¸¸æ ‡(æœ‰èµ–äºå…·\nä½“çš„ DBMS)ã€‚\nDELIMITER $ CREATE PROCEDURE getTotal() BEGIN DECLARE total INT; -- åˆ›å»ºæ¥æ”¶æ¸¸æ ‡æ•°æ®çš„å˜é‡ DECLARE sid INT; DECLARE sname VARCHAR(10); -- åˆ›å»ºæ€»æ•°å˜é‡ DECLARE sage INT; -- åˆ›å»ºç»“æŸæ ‡å¿—å˜é‡ DECLARE done INT DEFAULT false; -- åˆ›å»ºæ¸¸æ ‡ DECLARE cur CURSOR FOR SELECT id,name,age from cursor_table where age\u0026gt;30; -- æŒ‡å®šæ¸¸æ ‡å¾ªç¯ç»“æŸæ—¶çš„è¿”å›å€¼ DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = true; SET total = 0; OPEN cur; FETCH cur INTO sid, sname, sage; WHILE(NOT done) DO SET total = total + 1; FETCH cur INTO sid, sname, sage; END WHILE; CLOSE cur; SELECT total; END $ DELIMITER ; -- è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ call getTotal(); è§¦å‘å™¨ # è§¦å‘å™¨æ˜¯ä¸€ç§ä¸è¡¨æ“ä½œæœ‰å…³çš„æ•°æ®åº“å¯¹è±¡ï¼Œå½“è§¦å‘å™¨æ‰€åœ¨è¡¨ä¸Šå‡ºç°æŒ‡å®šäº‹ä»¶æ—¶ï¼Œå°†è°ƒç”¨è¯¥å¯¹è±¡ï¼Œå³è¡¨çš„æ“ä½œäº‹ä»¶è§¦å‘è¡¨ä¸Šçš„è§¦å‘å™¨çš„æ‰§è¡Œã€‚\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨è§¦å‘å™¨æ¥è¿›è¡Œå®¡è®¡è·Ÿè¸ªï¼ŒæŠŠä¿®æ”¹è®°å½•åˆ°å¦å¤–ä¸€å¼ è¡¨ä¸­ã€‚\nä½¿ç”¨è§¦å‘å™¨çš„ä¼˜ç‚¹ï¼š\nSQL è§¦å‘å™¨æä¾›äº†å¦ä¸€ç§æ£€æŸ¥æ•°æ®å®Œæ•´æ€§çš„æ–¹æ³•ã€‚ SQL è§¦å‘å™¨å¯ä»¥æ•è·æ•°æ®åº“å±‚ä¸­ä¸šåŠ¡é€»è¾‘ä¸­çš„é”™è¯¯ã€‚ SQL è§¦å‘å™¨æä¾›äº†å¦ä¸€ç§è¿è¡Œè®¡åˆ’ä»»åŠ¡çš„æ–¹æ³•ã€‚é€šè¿‡ä½¿ç”¨ SQL è§¦å‘å™¨ï¼Œæ‚¨ä¸å¿…ç­‰å¾…è¿è¡Œè®¡åˆ’ä»»åŠ¡ï¼Œå› ä¸ºåœ¨å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œæ›´æ”¹ä¹‹å‰æˆ–ä¹‹åä¼šè‡ªåŠ¨è°ƒç”¨è§¦å‘å™¨ã€‚ SQL è§¦å‘å™¨å¯¹äºå®¡è®¡è¡¨ä¸­æ•°æ®çš„æ›´æ”¹éå¸¸æœ‰ç”¨ã€‚ ä½¿ç”¨è§¦å‘å™¨çš„ç¼ºç‚¹ï¼š\nSQL è§¦å‘å™¨åªèƒ½æä¾›æ‰©å±•éªŒè¯ï¼Œå¹¶ä¸”ä¸èƒ½æ›¿æ¢æ‰€æœ‰éªŒè¯ã€‚å¿…é¡»åœ¨åº”ç”¨ç¨‹åºå±‚ä¸­å®Œæˆä¸€äº›ç®€å•çš„éªŒè¯ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ JavaScript åœ¨å®¢æˆ·ç«¯éªŒè¯ç”¨æˆ·çš„è¾“å…¥ï¼Œæˆ–è€…ä½¿ç”¨æœåŠ¡å™¨ç«¯è„šæœ¬è¯­è¨€ï¼ˆå¦‚ JSPï¼ŒPHPï¼ŒASP.NETï¼ŒPerlï¼‰åœ¨æœåŠ¡å™¨ç«¯éªŒè¯ç”¨æˆ·çš„è¾“å…¥ã€‚ ä»å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºè°ƒç”¨å’Œæ‰§è¡Œ SQL è§¦å‘å™¨æ˜¯ä¸å¯è§çš„ï¼Œå› æ­¤å¾ˆéš¾å¼„æ¸…æ¥šæ•°æ®åº“å±‚ä¸­å‘ç”Ÿäº†ä»€ä¹ˆã€‚ SQL è§¦å‘å™¨å¯èƒ½ä¼šå¢åŠ æ•°æ®åº“æœåŠ¡å™¨çš„å¼€é”€ã€‚ MySQL ä¸å…è®¸åœ¨è§¦å‘å™¨ä¸­ä½¿ç”¨ CALL è¯­å¥ ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ã€‚\næ³¨æ„ï¼šåœ¨ MySQL ä¸­ï¼Œåˆ†å· ; æ˜¯è¯­å¥ç»“æŸçš„æ ‡è¯†ç¬¦ï¼Œé‡åˆ°åˆ†å·è¡¨ç¤ºè¯¥æ®µè¯­å¥å·²ç»ç»“æŸï¼ŒMySQL å¯ä»¥å¼€å§‹æ‰§è¡Œäº†ã€‚å› æ­¤ï¼Œè§£é‡Šå™¨é‡åˆ°è§¦å‘å™¨æ‰§è¡ŒåŠ¨ä½œä¸­çš„åˆ†å·åå°±å¼€å§‹æ‰§è¡Œï¼Œç„¶åä¼šæŠ¥é”™ï¼Œå› ä¸ºæ²¡æœ‰æ‰¾åˆ°å’Œ BEGIN åŒ¹é…çš„ ENDã€‚\nè¿™æ—¶å°±ä¼šç”¨åˆ° DELIMITER å‘½ä»¤ï¼ˆDELIMITER æ˜¯å®šç•Œç¬¦ï¼Œåˆ†éš”ç¬¦çš„æ„æ€ï¼‰ã€‚å®ƒæ˜¯ä¸€æ¡å‘½ä»¤ï¼Œä¸éœ€è¦è¯­å¥ç»“æŸæ ‡è¯†ï¼Œè¯­æ³•ä¸ºï¼šDELIMITER new_delemiterã€‚new_delemiter å¯ä»¥è®¾ä¸º 1 ä¸ªæˆ–å¤šä¸ªé•¿åº¦çš„ç¬¦å·ï¼Œé»˜è®¤çš„æ˜¯åˆ†å· ;ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒä¿®æ”¹ä¸ºå…¶ä»–ç¬¦å·ï¼Œå¦‚ $ - DELIMITER $ ã€‚åœ¨è¿™ä¹‹åçš„è¯­å¥ï¼Œä»¥åˆ†å·ç»“æŸï¼Œè§£é‡Šå™¨ä¸ä¼šæœ‰ä»€ä¹ˆååº”ï¼Œåªæœ‰é‡åˆ°äº† $ï¼Œæ‰è®¤ä¸ºæ˜¯è¯­å¥ç»“æŸã€‚æ³¨æ„ï¼Œä½¿ç”¨å®Œä¹‹åï¼Œæˆ‘ä»¬è¿˜åº”è¯¥è®°å¾—æŠŠå®ƒç»™ä¿®æ”¹å›æ¥ã€‚\nåœ¨ MySQL 5.7.2 ç‰ˆä¹‹å‰ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªè¡¨å®šä¹‰æœ€å¤šå…­ä¸ªè§¦å‘å™¨ã€‚\nBEFORE INSERT - åœ¨å°†æ•°æ®æ’å…¥è¡¨æ ¼ä¹‹å‰æ¿€æ´»ã€‚ AFTER INSERT - å°†æ•°æ®æ’å…¥è¡¨æ ¼åæ¿€æ´»ã€‚ BEFORE UPDATE - åœ¨æ›´æ–°è¡¨ä¸­çš„æ•°æ®ä¹‹å‰æ¿€æ´»ã€‚ AFTER UPDATE - æ›´æ–°è¡¨ä¸­çš„æ•°æ®åæ¿€æ´»ã€‚ BEFORE DELETE - åœ¨ä»è¡¨ä¸­åˆ é™¤æ•°æ®ä¹‹å‰æ¿€æ´»ã€‚ AFTER DELETE - ä»è¡¨ä¸­åˆ é™¤æ•°æ®åæ¿€æ´»ã€‚ ä½†æ˜¯ï¼Œä» MySQL ç‰ˆæœ¬ 5.7.2+å¼€å§‹ï¼Œå¯ä»¥ä¸ºåŒä¸€è§¦å‘äº‹ä»¶å’Œæ“ä½œæ—¶é—´å®šä¹‰å¤šä¸ªè§¦å‘å™¨ã€‚\nNEW å’Œ OLD ï¼š\nMySQL ä¸­å®šä¹‰äº† NEW å’Œ OLD å…³é”®å­—ï¼Œç”¨æ¥è¡¨ç¤ºè§¦å‘å™¨çš„æ‰€åœ¨è¡¨ä¸­ï¼Œè§¦å‘äº†è§¦å‘å™¨çš„é‚£ä¸€è¡Œæ•°æ®ã€‚ åœ¨ INSERT å‹è§¦å‘å™¨ä¸­ï¼ŒNEW ç”¨æ¥è¡¨ç¤ºå°†è¦ï¼ˆBEFOREï¼‰æˆ–å·²ç»ï¼ˆAFTERï¼‰æ’å…¥çš„æ–°æ•°æ®ï¼› åœ¨ UPDATE å‹è§¦å‘å™¨ä¸­ï¼ŒOLD ç”¨æ¥è¡¨ç¤ºå°†è¦æˆ–å·²ç»è¢«ä¿®æ”¹çš„åŸæ•°æ®ï¼ŒNEW ç”¨æ¥è¡¨ç¤ºå°†è¦æˆ–å·²ç»ä¿®æ”¹ä¸ºçš„æ–°æ•°æ®ï¼› åœ¨ DELETE å‹è§¦å‘å™¨ä¸­ï¼ŒOLD ç”¨æ¥è¡¨ç¤ºå°†è¦æˆ–å·²ç»è¢«åˆ é™¤çš„åŸæ•°æ®ï¼› ä½¿ç”¨æ–¹æ³•ï¼š NEW.columnName ï¼ˆcolumnName ä¸ºç›¸åº”æ•°æ®è¡¨æŸä¸€åˆ—åï¼‰ åˆ›å»ºè§¦å‘å™¨ # æç¤ºï¼šä¸ºäº†ç†è§£è§¦å‘å™¨çš„è¦ç‚¹ï¼Œæœ‰å¿…è¦å…ˆäº†è§£ä¸€ä¸‹åˆ›å»ºè§¦å‘å™¨çš„æŒ‡ä»¤ã€‚\nCREATE TRIGGER æŒ‡ä»¤ç”¨äºåˆ›å»ºè§¦å‘å™¨ã€‚\nè¯­æ³•ï¼š\nCREATE TRIGGER trigger_name trigger_time trigger_event ON table_name FOR EACH ROW BEGIN trigger_statements END; è¯´æ˜ï¼š\ntrigger_name ï¼šè§¦å‘å™¨å trigger_time : è§¦å‘å™¨çš„è§¦å‘æ—¶æœºã€‚å–å€¼ä¸º BEFORE æˆ– AFTERã€‚ trigger_event : è§¦å‘å™¨çš„ç›‘å¬äº‹ä»¶ã€‚å–å€¼ä¸º INSERTã€UPDATE æˆ– DELETEã€‚ table_name : è§¦å‘å™¨çš„ç›‘å¬ç›®æ ‡ã€‚æŒ‡å®šåœ¨å“ªå¼ è¡¨ä¸Šå»ºç«‹è§¦å‘å™¨ã€‚ FOR EACH ROW: è¡Œçº§ç›‘è§†ï¼ŒMysql å›ºå®šå†™æ³•ï¼Œå…¶ä»– DBMS ä¸åŒã€‚ trigger_statements: è§¦å‘å™¨æ‰§è¡ŒåŠ¨ä½œã€‚æ˜¯ä¸€æ¡æˆ–å¤šæ¡ SQL è¯­å¥çš„åˆ—è¡¨ï¼Œåˆ—è¡¨å†…çš„æ¯æ¡è¯­å¥éƒ½å¿…é¡»ç”¨åˆ†å· ; æ¥ç»“å°¾ã€‚ å½“è§¦å‘å™¨çš„è§¦å‘æ¡ä»¶æ»¡è¶³æ—¶ï¼Œå°†ä¼šæ‰§è¡Œ BEGIN å’Œ END ä¹‹é—´çš„è§¦å‘å™¨æ‰§è¡ŒåŠ¨ä½œã€‚\nç¤ºä¾‹ï¼š\nDELIMITER $ CREATE TRIGGER `trigger_insert_user` AFTER INSERT ON `user` FOR EACH ROW BEGIN INSERT INTO `user_history`(user_id, operate_type, operate_time) VALUES (NEW.id, \u0026#39;add a user\u0026#39;, now()); END $ DELIMITER ; æŸ¥çœ‹è§¦å‘å™¨ # SHOW TRIGGERS; åˆ é™¤è§¦å‘å™¨ # DROP TRIGGER IF EXISTS trigger_insert_user; æ–‡ç« æ¨è # åç«¯ç¨‹åºå‘˜å¿…å¤‡ï¼šSQLé«˜æ€§èƒ½ä¼˜åŒ–æŒ‡å—ï¼35+æ¡ä¼˜åŒ–å»ºè®®ç«‹é©¬GET! åç«¯ç¨‹åºå‘˜å¿…å¤‡ï¼šä¹¦å†™é«˜è´¨é‡SQLçš„30æ¡å»ºè®® "},{"id":50,"href":"/zh/docs/study/Review/java_guide/database/Redis/diagram/","title":"redisé—®é¢˜å›¾è§£","section":"Redis","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nä¸»ä»å¤åˆ¶åŸç†\nå“¨å…µæ¨¡å¼(ç®€å•)\nå“¨å…µæ¨¡å¼è¯¦è§£\nå…ˆé…ç½®ä¸»ä»æ¨¡å¼ï¼Œå†é…ç½®å“¨å…µæ¨¡å¼\næ‰€æœ‰çš„å“¨å…µ sentinel.conf éƒ½æ˜¯é…ç½®ä¸ºç›‘å¬master\u0026ndash;\u0026gt; 192.168.14.101ï¼Œå¦‚æœä¸»æœºå®•æœºï¼Œsentinel.conf ä¸­çš„é…ç½®ä¹Ÿä¼šè‡ªåŠ¨æ›´æ”¹ä¸ºé€‰ä¸¾åçš„\nJavaå®¢æˆ·ç«¯è¿æ¥åŸç†\nå®¢æˆ·ç«¯æ˜¯å’ŒSentinelæ¥è¿›è¡Œäº¤äº’çš„,é€šè¿‡Sentinelæ¥è·å–çœŸæ­£çš„RedisèŠ‚ç‚¹ä¿¡æ¯,ç„¶åæ¥æ“ä½œ.å®é™…å·¥ä½œæ—¶,Sentinel å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªä¸»é¢˜é˜Ÿåˆ—,ç”¨æ¥ä¿å­˜Redisçš„èŠ‚ç‚¹ä¿¡æ¯,å¹¶å®æ—¶æ›´æ–°,å®¢æˆ·ç«¯è®¢é˜…äº†è¿™ä¸ªä¸»é¢˜,ç„¶åå®æ—¶çš„å»è·å–è¿™ä¸ªé˜Ÿåˆ—çš„RedisèŠ‚ç‚¹ä¿¡æ¯.\n/** ä»£ç ç›¸å¯¹æ¯”è¾ƒç®€å• **/ //1.è®¾ç½®sentinel å„ä¸ªèŠ‚ç‚¹é›†åˆ Set\u0026lt;String\u0026gt; sentinelSet = new HashSet\u0026lt;\u0026gt;(); sentinelSet.add(\u0026#34;192.168.14.101:26379\u0026#34;); sentinelSet.add(\u0026#34;192.168.14.102:26380\u0026#34;); sentinelSet.add(\u0026#34;192.168.14.103:26381\u0026#34;); //2.è®¾ç½®jedispool è¿æ¥æ± é…ç½®æ–‡ä»¶ JedisPoolConfig config = new JedisPoolConfig(); config.setMaxTotal(10); config.setMaxWaitMillis(1000); //3.è®¾ç½®mastername,sentinelNodeé›†åˆ,é…ç½®æ–‡ä»¶,Redisç™»å½•å¯†ç  JedisSentinelPool jedisSentinelPool = new JedisSentinelPool(\u0026#34;mymaster\u0026#34;,sentinelSet,config,\u0026#34;123\u0026#34;); Jedis jedis = null; try { jedis = jedisSentinelPool.getResource(); //è·å–Redisä¸­key=helloçš„å€¼ String value = jedis.get(\u0026#34;hello\u0026#34;); System.out.println(value); } catch (Exception e) { e.printStackTrace(); } finally { if(jedis != null){ jedis.close(); } } å“¨å…µå·¥ä½œåŸç†\nä¸»è§‚å®•æœºï¼šsentinelè‡ªè®¤ä¸ºredisä¸å¯ç”¨\nå®¢è§‚å®•æœºï¼šsentinelé›†ç¾¤è®¤ä¸ºredisä¸å¯ç”¨\næ•…éšœè½¬ç§»\n"},{"id":51,"href":"/zh/docs/study/Review/java_guide/database/Redis/ly0703ly3-commonly-used-cache-read-and-write-strategies/","title":"3ç§å¸¸ç”¨çš„ç¼“å­˜è¯»å†™ç­–ç•¥è¯¦è§£","section":"Redis","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nçœ‹åˆ°å¾ˆå¤šå°ä¼™ä¼´ç®€å†ä¸Šå†™äº†â€œç†Ÿç»ƒä½¿ç”¨ç¼“å­˜â€ï¼Œä½†æ˜¯è¢«æˆ‘é—®åˆ°â€œç¼“å­˜å¸¸ç”¨çš„3ç§è¯»å†™ç­–ç•¥â€çš„æ—¶å€™å´ä¸€è„¸æ‡µé€¼ã€‚\nåœ¨æˆ‘çœ‹æ¥ï¼Œé€ æˆè¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯æˆ‘ä»¬åœ¨å­¦ä¹  Redis çš„æ—¶å€™ï¼Œå¯èƒ½åªæ˜¯ç®€å•äº†å†™ä¸€äº› Demoï¼Œå¹¶æ²¡æœ‰å»å…³æ³¨ç¼“å­˜çš„è¯»å†™ç­–ç•¥ï¼Œæˆ–è€…è¯´å‹æ ¹ä¸çŸ¥é“è¿™å›äº‹ã€‚\nä½†æ˜¯ï¼Œææ‡‚3ç§å¸¸è§çš„ç¼“å­˜è¯»å†™ç­–ç•¥å¯¹äºå®é™…å·¥ä½œä¸­ä½¿ç”¨ç¼“å­˜ä»¥åŠé¢è¯•ä¸­è¢«é—®åˆ°ç¼“å­˜éƒ½æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ï¼\nä¸‹é¢ä»‹ç»åˆ°çš„ä¸‰ç§æ¨¡å¼å„æœ‰ä¼˜åŠ£ï¼Œä¸å­˜åœ¨æœ€ä½³æ¨¡å¼ï¼Œæ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯é€‰æ‹©é€‚åˆè‡ªå·±çš„ç¼“å­˜è¯»å†™æ¨¡å¼ã€‚\nCache Aside Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰ # Cache Aside Pattern æ˜¯æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨æ¯”è¾ƒå¤šçš„ä¸€ä¸ªç¼“å­˜è¯»å†™æ¨¡å¼ï¼Œæ¯”è¾ƒé€‚åˆè¯»è¯·æ±‚æ¯”è¾ƒå¤šçš„åœºæ™¯ã€‚\nCache Aside Pattern ä¸­æœåŠ¡ç«¯éœ€è¦åŒæ—¶ç»´ç³» db å’Œ cacheï¼Œå¹¶ä¸”æ˜¯ä»¥ db çš„ç»“æœä¸ºå‡†ã€‚\nä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªç­–ç•¥æ¨¡å¼ä¸‹çš„ç¼“å­˜è¯»å†™æ­¥éª¤ã€‚\nå†™ ï¼š\nå…ˆæ›´æ–° db ç„¶åç›´æ¥åˆ é™¤ cache ã€‚ ç®€å•ç”»äº†ä¸€å¼ å›¾å¸®åŠ©å¤§å®¶ç†è§£å†™çš„æ­¥éª¤ã€‚\nè¯» :\nä» cache ä¸­è¯»å–æ•°æ®ï¼Œè¯»å–åˆ°å°±ç›´æ¥è¿”å› cache ä¸­è¯»å–ä¸åˆ°çš„è¯ï¼Œå°±ä» db ä¸­è¯»å–æ•°æ®è¿”å› å†æŠŠæ•°æ®æ”¾åˆ° cache ä¸­ã€‚ ç®€å•ç”»äº†ä¸€å¼ å›¾å¸®åŠ©å¤§å®¶ç†è§£è¯»çš„æ­¥éª¤ã€‚\nä½ ä»…ä»…äº†è§£äº†ä¸Šé¢è¿™äº›å†…å®¹çš„è¯æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬è¿˜è¦ææ‡‚å…¶ä¸­çš„åŸç†ã€‚\næ¯”å¦‚è¯´é¢è¯•å®˜å¾ˆå¯èƒ½ä¼šè¿½é—®ï¼šâ€œåœ¨å†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å…ˆåˆ é™¤ cache ï¼Œåæ›´æ–° db ä¹ˆï¼Ÿâ€\nç­”æ¡ˆï¼š é‚£è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼å› ä¸ºè¿™æ ·å¯èƒ½ä¼šé€ æˆ æ•°æ®åº“ï¼ˆdbï¼‰å’Œç¼“å­˜ï¼ˆCacheï¼‰æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚\nä¸¾ä¾‹ï¼šè¯·æ±‚ 1 å…ˆå†™æ•°æ® Aï¼Œè¯·æ±‚ 2 éšåè¯»æ•°æ® A çš„è¯ï¼Œå°±å¾ˆæœ‰å¯èƒ½äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´æ€§çš„é—®é¢˜ã€‚\nè¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç®€å•æè¿°ä¸ºï¼š\nè¯·æ±‚ 1 å…ˆæŠŠ cache ä¸­çš„ A æ•°æ®åˆ é™¤ -\u0026gt; è¯·æ±‚ 2 ä» db ä¸­è¯»å–æ•°æ®ã€æ­¤æ—¶è¯·æ±‚2æŠŠè„æ•°æ®(å¯¹äºè¯·æ±‚1æ¥è¯´æ˜¯)æ›´æ–°åˆ°ç¼“å­˜å»äº†ã€‘-\u0026gt;è¯·æ±‚ 1 å†æŠŠ db ä¸­çš„ A æ•°æ®æ›´æ–°ï¼Œå³è¯·æ±‚1çš„æ“ä½œéåŸå­\nå½“ä½ è¿™æ ·å›ç­”ä¹‹åï¼Œé¢è¯•å®˜å¯èƒ½ä¼šç´§æ¥ç€å°±è¿½é—®ï¼šâ€œåœ¨å†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆæ›´æ–° dbï¼Œååˆ é™¤ cache å°±æ²¡æœ‰é—®é¢˜äº†ä¹ˆï¼Ÿâ€\nç­”æ¡ˆï¼š ç†è®ºä¸Šæ¥è¯´è¿˜æ˜¯å¯èƒ½ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œä¸è¿‡æ¦‚ç‡éå¸¸å°ï¼Œå› ä¸ºç¼“å­˜çš„å†™å…¥é€Ÿåº¦æ˜¯æ¯”æ•°æ®åº“çš„å†™å…¥é€Ÿåº¦å¿«å¾ˆå¤šã€‚\nä¸¾ä¾‹ï¼šè¯·æ±‚ 1 å…ˆè¯»æ•°æ® Aï¼Œè¯·æ±‚ 2 éšåå†™æ•°æ® Aï¼Œå¹¶ä¸”æ•°æ® A åœ¨è¯·æ±‚ 1 è¯·æ±‚ä¹‹å‰ä¸åœ¨ç¼“å­˜ä¸­çš„è¯ï¼Œä¹Ÿæœ‰å¯èƒ½äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´æ€§çš„é—®é¢˜ã€‚\nè¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç®€å•æè¿°ä¸ºï¼š\nè¯·æ±‚ 1 ä» db è¯»æ•°æ® A-\u0026gt; è¯·æ±‚ 2 æ›´æ–° db ä¸­çš„æ•°æ® Aï¼ˆæ­¤æ—¶ç¼“å­˜ä¸­æ— æ•°æ® A ï¼Œæ•…ä¸ç”¨æ‰§è¡Œåˆ é™¤ç¼“å­˜æ“ä½œ ï¼‰ -\u0026gt; è¯·æ±‚ 1 å°†æ•°æ® A å†™å…¥ cache\nç°åœ¨æˆ‘ä»¬å†æ¥åˆ†æä¸€ä¸‹ Cache Aside Pattern çš„ç¼ºé™·ã€‚\nç¼ºé™· 1ï¼šé¦–æ¬¡è¯·æ±‚æ•°æ®ä¸€å®šä¸åœ¨ cache çš„é—®é¢˜\nè§£å†³åŠæ³•ï¼šå¯ä»¥å°†çƒ­ç‚¹æ•°æ®å¯ä»¥æå‰æ”¾å…¥ cache ä¸­ã€‚\nç¼ºé™· 2ï¼šå†™æ“ä½œæ¯”è¾ƒé¢‘ç¹çš„è¯å¯¼è‡´ cache ä¸­çš„æ•°æ®ä¼šè¢«é¢‘ç¹è¢«åˆ é™¤ï¼Œè¿™æ ·ä¼šå½±å“ç¼“å­˜å‘½ä¸­ç‡ ã€‚\nè§£å†³åŠæ³•ï¼š\næ•°æ®åº“å’Œç¼“å­˜æ•°æ®å¼ºä¸€è‡´åœºæ™¯ ï¼šæ›´æ–° db çš„æ—¶å€™åŒæ ·æ›´æ–° cacheï¼Œä¸è¿‡æˆ‘ä»¬éœ€è¦åŠ ä¸€ä¸ªé”/åˆ†å¸ƒå¼é”æ¥ä¿è¯æ›´æ–° cache çš„æ—¶å€™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ å¯ä»¥çŸ­æš‚åœ°å…è®¸æ•°æ®åº“å’Œç¼“å­˜æ•°æ®ä¸ä¸€è‡´çš„åœºæ™¯ ï¼šæ›´æ–° db çš„æ—¶å€™åŒæ ·æ›´æ–° cacheï¼Œä½†æ˜¯ç»™ç¼“å­˜åŠ ä¸€ä¸ªæ¯”è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥ä¿è¯å³ä½¿æ•°æ®ä¸ä¸€è‡´çš„è¯å½±å“ä¹Ÿæ¯”è¾ƒå°ã€‚ Read/Write Through Patternï¼ˆè¯»å†™ç©¿é€ï¼‰ # Read/Write Through Pattern ä¸­æœåŠ¡ç«¯æŠŠ cache è§†ä¸ºä¸»è¦æ•°æ®å­˜å‚¨ï¼Œä»ä¸­è¯»å–æ•°æ®å¹¶å°†æ•°æ®å†™å…¥å…¶ä¸­ã€‚cache æœåŠ¡è´Ÿè´£å°†æ­¤æ•°æ®è¯»å–å’Œå†™å…¥ dbï¼Œä»è€Œå‡è½»äº†åº”ç”¨ç¨‹åºçš„èŒè´£ã€‚\nè¿™ç§ç¼“å­˜è¯»å†™ç­–ç•¥å°ä¼™ä¼´ä»¬åº”è¯¥ä¹Ÿå‘ç°äº†åœ¨å¹³æ—¶åœ¨å¼€å‘è¿‡ç¨‹ä¸­éå¸¸å°‘è§ã€‚æŠ›å»æ€§èƒ½æ–¹é¢çš„å½±å“ï¼Œå¤§æ¦‚ç‡æ˜¯å› ä¸ºæˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„åˆ†å¸ƒå¼ç¼“å­˜ Redis å¹¶æ²¡æœ‰æä¾› cache å°†æ•°æ®å†™å…¥ db çš„åŠŸèƒ½ã€‚\nå†™ï¼ˆWrite Throughï¼‰ï¼š\nå…ˆæŸ¥ cacheï¼Œcache ä¸­ä¸å­˜åœ¨ï¼Œç›´æ¥æ›´æ–° dbã€‚ cache ä¸­å­˜åœ¨ï¼Œåˆ™å…ˆæ›´æ–° cacheï¼Œç„¶å cache æœåŠ¡è‡ªå·±æ›´æ–° dbï¼ˆåŒæ­¥æ›´æ–° cache å’Œ dbï¼‰ã€‚ ç®€å•ç”»äº†ä¸€å¼ å›¾å¸®åŠ©å¤§å®¶ç†è§£å†™çš„æ­¥éª¤ã€‚\nè¯»(Read Through)ï¼š\nä» cache ä¸­è¯»å–æ•°æ®ï¼Œè¯»å–åˆ°å°±ç›´æ¥è¿”å› ã€‚ è¯»å–ä¸åˆ°çš„è¯ï¼Œå…ˆä» db åŠ è½½ï¼Œå†™å…¥åˆ° cache åè¿”å›å“åº”ã€‚ ç®€å•ç”»äº†ä¸€å¼ å›¾å¸®åŠ©å¤§å®¶ç†è§£è¯»çš„æ­¥éª¤ã€‚\nRead-Through Pattern å®é™…åªæ˜¯åœ¨ Cache-Aside Pattern ä¹‹ä¸Šè¿›è¡Œäº†å°è£…ã€‚åœ¨ Cache-Aside Pattern ä¸‹ï¼Œå‘ç”Ÿè¯»è¯·æ±‚çš„æ—¶å€™ï¼Œå¦‚æœ cache ä¸­ä¸å­˜åœ¨å¯¹åº”çš„æ•°æ®ï¼Œæ˜¯ç”±å®¢æˆ·ç«¯è‡ªå·±è´Ÿè´£æŠŠæ•°æ®å†™å…¥ cacheï¼Œè€Œ Read Through Pattern åˆ™æ˜¯ cache æœåŠ¡è‡ªå·±æ¥å†™å…¥ç¼“å­˜çš„ï¼Œè¿™å¯¹å®¢æˆ·ç«¯æ˜¯é€æ˜çš„ã€‚\nå’Œ Cache Aside Pattern ä¸€æ ·ï¼Œ Read-Through Pattern ä¹Ÿæœ‰é¦–æ¬¡è¯·æ±‚æ•°æ®ä¸€å®šä¸å† cache çš„é—®é¢˜ï¼Œå¯¹äºçƒ­ç‚¹æ•°æ®å¯ä»¥æå‰æ”¾å…¥ç¼“å­˜ä¸­ã€‚\nWrite Behind Patternï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰ # Write Behind Pattern å’Œ Read/Write Through Pattern å¾ˆç›¸ä¼¼ï¼Œä¸¤è€…éƒ½æ˜¯ç”± cache æœåŠ¡æ¥è´Ÿè´£ cache å’Œ db çš„è¯»å†™ã€‚\nä½†æ˜¯ï¼Œä¸¤ä¸ªåˆæœ‰å¾ˆå¤§çš„ä¸åŒï¼šRead/Write Through æ˜¯åŒæ­¥æ›´æ–° cache å’Œ dbï¼Œè€Œ Write Behind åˆ™æ˜¯åªæ›´æ–°ç¼“å­˜ï¼Œä¸ç›´æ¥æ›´æ–° dbï¼Œè€Œæ˜¯æ”¹ä¸ºå¼‚æ­¥æ‰¹é‡çš„æ–¹å¼æ¥æ›´æ–° dbã€‚\nå¾ˆæ˜æ˜¾ï¼Œè¿™ç§æ–¹å¼å¯¹æ•°æ®ä¸€è‡´æ€§å¸¦æ¥äº†æ›´å¤§çš„æŒ‘æˆ˜ï¼Œæ¯”å¦‚ cache æ•°æ®å¯èƒ½è¿˜æ²¡å¼‚æ­¥æ›´æ–° db çš„è¯ï¼Œcache æœåŠ¡å¯èƒ½å°±å°±æŒ‚æ‰äº†ã€‚\nè¿™ç§ç­–ç•¥åœ¨æˆ‘ä»¬å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­ä¹Ÿéå¸¸éå¸¸å°‘è§ï¼Œä½†æ˜¯ä¸ä»£è¡¨å®ƒçš„åº”ç”¨åœºæ™¯å°‘ï¼Œæ¯”å¦‚æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„å¼‚æ­¥å†™å…¥ç£ç›˜ã€MySQL çš„ Innodb Buffer Pool æœºåˆ¶éƒ½ç”¨åˆ°äº†è¿™ç§ç­–ç•¥ã€‚\nWrite Behind Pattern ä¸‹ db çš„å†™æ€§èƒ½éå¸¸é«˜ï¼Œéå¸¸é€‚åˆä¸€äº›æ•°æ®ç»å¸¸å˜åŒ–åˆå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚æ²¡é‚£ä¹ˆé«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚æµè§ˆé‡ã€ç‚¹èµé‡ã€‚\n"},{"id":52,"href":"/zh/docs/study/Review/java_guide/database/Redis/ly0704lyredis-memory-fragmentation/","title":"rediså†…å­˜ç¢ç‰‡","section":"Redis","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nä»€ä¹ˆæ˜¯å†…å­˜ç¢ç‰‡? # ä½ å¯ä»¥å°†å†…å­˜ç¢ç‰‡ç®€å•åœ°ç†è§£ä¸ºé‚£äº›ä¸å¯ç”¨çš„ç©ºé—²å†…å­˜ã€‚\nä¸¾ä¸ªä¾‹å­ï¼šæ“ä½œç³»ç»Ÿä¸ºä½ åˆ†é…äº† 32 å­—èŠ‚çš„è¿ç»­å†…å­˜ç©ºé—´ï¼Œè€Œä½ å­˜å‚¨æ•°æ®å®é™…åªéœ€è¦ä½¿ç”¨ 24 å­—èŠ‚å†…å­˜ç©ºé—´ï¼Œé‚£è¿™å¤šä½™å‡ºæ¥çš„ 8 å­—èŠ‚å†…å­˜ç©ºé—´å¦‚æœåç»­æ²¡åŠæ³•å†è¢«åˆ†é…å­˜å‚¨å…¶ä»–æ•°æ®çš„è¯ï¼Œå°±å¯ä»¥è¢«ç§°ä¸ºå†…å­˜ç¢ç‰‡ã€‚\nRedis å†…å­˜ç¢ç‰‡è™½ç„¶ä¸ä¼šå½±å“ Redis æ€§èƒ½ï¼Œä½†æ˜¯ä¼šå¢åŠ å†…å­˜æ¶ˆè€—ã€‚\nä¸ºä»€ä¹ˆä¼šæœ‰ Redis å†…å­˜ç¢ç‰‡? # Redis å†…å­˜ç¢ç‰‡äº§ç”Ÿæ¯”è¾ƒå¸¸è§çš„ 2 ä¸ªåŸå› ï¼š\n1ã€Redis å­˜å‚¨å­˜å‚¨æ•°æ®çš„æ—¶å€™å‘æ“ä½œç³»ç»Ÿç”³è¯·çš„å†…å­˜ç©ºé—´å¯èƒ½ä¼šå¤§äºæ•°æ®å®é™…éœ€è¦çš„å­˜å‚¨ç©ºé—´ã€‚\nä»¥ä¸‹æ˜¯è¿™æ®µ Redis å®˜æ–¹çš„åŸè¯ï¼š\nTo store user keys, Redis allocates at most as much memory as the maxmemory setting enables (however there are small extra allocations possible).\nRedis ä½¿ç”¨ zmalloc æ–¹æ³•(Redis è‡ªå·±å®ç°çš„å†…å­˜åˆ†é…æ–¹æ³•)è¿›è¡Œå†…å­˜åˆ†é…çš„æ—¶å€™ï¼Œé™¤äº†è¦åˆ†é… size å¤§å°çš„å†…å­˜ä¹‹å¤–ï¼Œè¿˜ä¼šå¤šåˆ†é… PREFIX_SIZE å¤§å°çš„å†…å­˜ã€‚\nzmalloc æ–¹æ³•æºç å¦‚ä¸‹ï¼ˆæºç åœ°å€ï¼šhttps://github.com/antirez/redis-tools/blob/master/zmalloc.cï¼‰ï¼š\nvoid *zmalloc(size_t size) { // åˆ†é…æŒ‡å®šå¤§å°çš„å†…å­˜ void *ptr = malloc(size+PREFIX_SIZE); if (!ptr) zmalloc_oom_handler(size); #ifdef HAVE_MALLOC_SIZE update_zmalloc_stat_alloc(zmalloc_size(ptr)); return ptr; #else *((size_t*)ptr) = size; update_zmalloc_stat_alloc(size+PREFIX_SIZE); return (char*)ptr+PREFIX_SIZE; #endif } å¦å¤–ï¼ŒRedis å¯ä»¥ä½¿ç”¨å¤šç§å†…å­˜åˆ†é…å™¨æ¥åˆ†é…å†…å­˜ï¼ˆ libcã€jemallocã€tcmallocï¼‰ï¼Œé»˜è®¤ä½¿ç”¨ jemallocï¼Œè€Œ jemalloc æŒ‰ç…§ä¸€ç³»åˆ—å›ºå®šçš„å¤§å°ï¼ˆ8 å­—èŠ‚ã€16 å­—èŠ‚ã€32 å­—èŠ‚\u0026hellip;\u0026hellip;ï¼‰æ¥åˆ†é…å†…å­˜çš„ã€‚jemalloc åˆ’åˆ†çš„å†…å­˜å•å…ƒå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nå½“ç¨‹åºç”³è¯·çš„å†…å­˜æœ€æ¥è¿‘æŸä¸ªå›ºå®šå€¼æ—¶ï¼Œjemalloc ä¼šç»™å®ƒåˆ†é…ç›¸åº”å¤§å°çš„ç©ºé—´ï¼Œå°±æ¯”å¦‚è¯´ç¨‹åºéœ€è¦ç”³è¯· 17 å­—èŠ‚çš„å†…å­˜ï¼Œjemalloc ä¼šç›´æ¥ç»™å®ƒåˆ†é… 32 å­—èŠ‚çš„å†…å­˜ï¼Œè¿™æ ·ä¼šå¯¼è‡´æœ‰ 15 å­—èŠ‚å†…å­˜çš„æµªè´¹ã€‚ä¸è¿‡ï¼Œjemalloc ä¸“é—¨é’ˆå¯¹å†…å­˜ç¢ç‰‡é—®é¢˜åšäº†ä¼˜åŒ–ï¼Œä¸€èˆ¬ä¸ä¼šå­˜åœ¨è¿‡åº¦ç¢ç‰‡åŒ–çš„é—®é¢˜ã€‚\n2ã€é¢‘ç¹ä¿®æ”¹ Redis ä¸­çš„æ•°æ®ä¹Ÿä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚\nå½“ Redis ä¸­çš„æŸä¸ªæ•°æ®åˆ é™¤æ—¶ï¼ŒRedis é€šå¸¸ä¸ä¼šè½»æ˜“é‡Šæ”¾å†…å­˜ç»™æ“ä½œç³»ç»Ÿã€‚\nè¿™ä¸ªåœ¨ Redis å®˜æ–¹æ–‡æ¡£ä¸­ä¹Ÿæœ‰å¯¹åº”çš„åŸè¯:\næ–‡æ¡£åœ°å€ï¼šhttps://redis.io/topics/memory-optimization ã€‚\nå¦‚ä½•æŸ¥çœ‹ Redis å†…å­˜ç¢ç‰‡çš„ä¿¡æ¯ï¼Ÿ # ä½¿ç”¨ info memory å‘½ä»¤å³å¯æŸ¥çœ‹ Redis å†…å­˜ç›¸å…³çš„ä¿¡æ¯ã€‚ä¸‹å›¾ä¸­æ¯ä¸ªå‚æ•°å…·ä½“çš„å«ä¹‰ï¼ŒRedis å®˜æ–¹æ–‡æ¡£æœ‰è¯¦ç»†çš„ä»‹ç»ï¼šhttps://redis.io/commands/INFO ã€‚\n]\nRedis å†…å­˜ç¢ç‰‡ç‡çš„è®¡ç®—å…¬å¼ï¼šmem_fragmentation_ratio ï¼ˆå†…å­˜ç¢ç‰‡ç‡ï¼‰= used_memory_rss (æ“ä½œç³»ç»Ÿå®é™…åˆ†é…ç»™ Redis çš„ç‰©ç†å†…å­˜ç©ºé—´å¤§å°)/ used_memory(Redis å†…å­˜åˆ†é…å™¨ä¸ºäº†å­˜å‚¨æ•°æ®å®é™…ç”³è¯·ä½¿ç”¨çš„å†…å­˜ç©ºé—´å¤§å°)\nä¹Ÿå°±æ˜¯è¯´ï¼Œmem_fragmentation_ratio ï¼ˆå†…å­˜ç¢ç‰‡ç‡ï¼‰çš„å€¼è¶Šå¤§ä»£è¡¨å†…å­˜ç¢ç‰‡ç‡è¶Šä¸¥é‡ã€‚\nä¸€å®šä¸è¦è¯¯è®¤ä¸ºused_memory_rss å‡å» used_memoryå€¼å°±æ˜¯å†…å­˜ç¢ç‰‡çš„å¤§å°ï¼ï¼ï¼è¿™ä¸ä»…åŒ…æ‹¬å†…å­˜ç¢ç‰‡ï¼Œè¿˜åŒ…æ‹¬å…¶ä»–è¿›ç¨‹å¼€é”€ï¼Œä»¥åŠå…±äº«åº“ã€å †æ ˆç­‰çš„å¼€é”€ã€‚\nå¾ˆå¤šå°ä¼™ä¼´å¯èƒ½è¦é—®äº†ï¼šâ€œå¤šå¤§çš„å†…å­˜ç¢ç‰‡ç‡æ‰æ˜¯éœ€è¦æ¸…ç†å‘¢ï¼Ÿâ€ã€‚\né€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è®¤ä¸º mem_fragmentation_ratio \u0026gt; 1.5 çš„è¯æ‰éœ€è¦æ¸…ç†å†…å­˜ç¢ç‰‡ã€‚ mem_fragmentation_ratio \u0026gt; 1.5 æ„å‘³ç€ä½ ä½¿ç”¨ Redis å­˜å‚¨å®é™…å¤§å° 2G çš„æ•°æ®éœ€è¦ä½¿ç”¨å¤§äº 3G çš„å†…å­˜ã€‚\nå¦‚æœæƒ³è¦å¿«é€ŸæŸ¥çœ‹å†…å­˜ç¢ç‰‡ç‡çš„è¯ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡ä¸‹é¢è¿™ä¸ªå‘½ä»¤ï¼š\n\u0026gt; redis-cli -p 6379 info | grep mem_fragmentation_ratio å¦å¤–ï¼Œå†…å­˜ç¢ç‰‡ç‡å¯èƒ½å­˜åœ¨å°äº 1 çš„æƒ…å†µã€‚è¿™ç§æƒ…å†µæˆ‘åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­è¿˜æ²¡æœ‰é‡åˆ°è¿‡ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç«  æ•…éšœåˆ†æ | Redis å†…å­˜ç¢ç‰‡ç‡å¤ªä½è¯¥æ€ä¹ˆåŠï¼Ÿ- çˆ±å¯ç”Ÿå¼€æºç¤¾åŒº ã€‚\nå¦‚ä½•æ¸…ç† Redis å†…å­˜ç¢ç‰‡ï¼Ÿ # Redis4.0-RC3 ç‰ˆæœ¬ä»¥åè‡ªå¸¦äº†å†…å­˜æ•´ç†ï¼Œå¯ä»¥é¿å…å†…å­˜ç¢ç‰‡ç‡è¿‡å¤§çš„é—®é¢˜ã€‚\nç›´æ¥é€šè¿‡ config set å‘½ä»¤å°† activedefrag é…ç½®é¡¹è®¾ç½®ä¸º yes å³å¯ã€‚\nconfig set activedefrag yes å…·ä½“ä»€ä¹ˆæ—¶å€™æ¸…ç†éœ€è¦é€šè¿‡ä¸‹é¢ä¸¤ä¸ªå‚æ•°æ§åˆ¶ï¼š\n# å†…å­˜ç¢ç‰‡å ç”¨ç©ºé—´è¾¾åˆ° 500mb çš„æ—¶å€™å¼€å§‹æ¸…ç† config set active-defrag-ignore-bytes 500mb # å†…å­˜ç¢ç‰‡ç‡å¤§äº 1.5 çš„æ—¶å€™å¼€å§‹æ¸…ç† config set active-defrag-threshold-lower 50 é€šè¿‡ Redis è‡ªåŠ¨å†…å­˜ç¢ç‰‡æ¸…ç†æœºåˆ¶å¯èƒ½ä¼šå¯¹ Redis çš„æ€§èƒ½äº§ç”Ÿå½±å“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤ä¸ªå‚æ•°æ¥å‡å°‘å¯¹ Redis æ€§èƒ½çš„å½±å“ï¼š\n# å†…å­˜ç¢ç‰‡æ¸…ç†æ‰€å ç”¨ CPU æ—¶é—´çš„æ¯”ä¾‹ä¸ä½äº 20% config set active-defrag-cycle-min 20 # å†…å­˜ç¢ç‰‡æ¸…ç†æ‰€å ç”¨ CPU æ—¶é—´çš„æ¯”ä¾‹ä¸é«˜äº 50% config set active-defrag-cycle-max 50 å¦å¤–ï¼Œé‡å¯èŠ‚ç‚¹å¯ä»¥åšåˆ°å†…å­˜ç¢ç‰‡é‡æ–°æ•´ç†ã€‚å¦‚æœä½ é‡‡ç”¨çš„æ˜¯é«˜å¯ç”¨æ¶æ„çš„ Redis é›†ç¾¤çš„è¯ï¼Œä½ å¯ä»¥å°†ç¢ç‰‡ç‡è¿‡é«˜çš„ä¸»èŠ‚ç‚¹è½¬æ¢ä¸ºä»èŠ‚ç‚¹ï¼Œä»¥ä¾¿è¿›è¡Œå®‰å…¨é‡å¯ã€‚\nå‚è€ƒ # Redis å®˜æ–¹æ–‡æ¡£ï¼šhttps://redis.io/topics/memory-optimization Redis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ - æå®¢æ—¶é—´ - åˆ é™¤æ•°æ®åï¼Œä¸ºä»€ä¹ˆå†…å­˜å ç”¨ç‡è¿˜æ˜¯å¾ˆé«˜ï¼Ÿï¼šhttps://time.geekbang.org/column/article/289140 Redis æºç è§£æâ€”â€”å†…å­˜åˆ†é…ï¼šhttps://shinerio.cc/2020/05/17/redis/Redis%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E2%80%94%E2%80%94%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/ "},{"id":53,"href":"/zh/docs/study/Review/java_guide/database/Redis/ly0702lyredis-spec-data-structure/","title":"redisç‰¹æ®Šæ•°æ®ç»“æ„","section":"Redis","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\né™¤äº† 5 ç§åŸºæœ¬çš„æ•°æ®ç»“æ„ä¹‹å¤–ï¼ŒRedis è¿˜æ”¯æŒ 3 ç§ç‰¹æ®Šçš„æ•°æ®ç»“æ„ ï¼šBitmapã€HyperLogLogã€GEOã€‚\nBitmap # ä»‹ç» # Bitmap å­˜å‚¨çš„æ˜¯è¿ç»­çš„äºŒè¿›åˆ¶æ•°å­—ï¼ˆ0 å’Œ 1ï¼‰ï¼Œé€šè¿‡ Bitmap, åªéœ€è¦ä¸€ä¸ª bit ä½æ¥è¡¨ç¤ºæŸä¸ªå…ƒç´ å¯¹åº”çš„å€¼æˆ–è€…çŠ¶æ€ï¼Œkey å°±æ˜¯å¯¹åº”å…ƒç´ æœ¬èº« ã€‚æˆ‘ä»¬çŸ¥é“ 8 ä¸ª bit å¯ä»¥ç»„æˆä¸€ä¸ª byteï¼Œæ‰€ä»¥ Bitmap æœ¬èº«ä¼šæå¤§çš„èŠ‚çœå‚¨å­˜ç©ºé—´ã€‚\nä½ å¯ä»¥å°† Bitmap çœ‹ä½œæ˜¯ä¸€ä¸ªå­˜å‚¨äºŒè¿›åˆ¶æ•°å­—ï¼ˆ0 å’Œ 1ï¼‰çš„æ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„ä¸‹æ ‡å«åš offsetï¼ˆåç§»é‡ï¼‰ã€‚\nå¸¸ç”¨å‘½ä»¤ # å‘½ä»¤ ä»‹ç» SETBIT key offset value è®¾ç½®æŒ‡å®š offset ä½ç½®çš„å€¼ GETBIT key offset è·å–æŒ‡å®š offset ä½ç½®çš„å€¼ BITCOUNT key start end è·å– start å’Œ end ä¹‹å‰å€¼ä¸º 1 çš„å…ƒç´ ä¸ªæ•° BITOP operation destkey key1 key2 \u0026hellip; å¯¹ä¸€ä¸ªæˆ–å¤šä¸ª Bitmap è¿›è¡Œè¿ç®—ï¼Œå¯ç”¨è¿ç®—ç¬¦æœ‰ AND, OR, XOR ä»¥åŠ NOT Bitmap åŸºæœ¬æ“ä½œæ¼”ç¤º ï¼š\n# SETBIT ä¼šè¿”å›ä¹‹å‰ä½çš„å€¼ï¼ˆé»˜è®¤æ˜¯ 0ï¼‰è¿™é‡Œä¼šç”Ÿæˆ 7 ä¸ªä½ \u0026gt; SETBIT mykey 7 1 (integer) 0 \u0026gt; SETBIT mykey 7 0 (integer) 1 \u0026gt; GETBIT mykey 7 (integer) 0 \u0026gt; SETBIT mykey 6 1 (integer) 0 \u0026gt; SETBIT mykey 8 1 (integer) 0 # é€šè¿‡ bitcount ç»Ÿè®¡è¢«è¢«è®¾ç½®ä¸º 1 çš„ä½çš„æ•°é‡ã€‚ \u0026gt; BITCOUNT mykey (integer) 2 åº”ç”¨åœºæ™¯ # éœ€è¦ä¿å­˜çŠ¶æ€ä¿¡æ¯ï¼ˆ0/1 å³å¯è¡¨ç¤ºï¼‰çš„åœºæ™¯\nä¸¾ä¾‹ ï¼šç”¨æˆ·ç­¾åˆ°æƒ…å†µã€æ´»è·ƒç”¨æˆ·æƒ…å†µã€ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡ï¼ˆæ¯”å¦‚æ˜¯å¦ç‚¹èµè¿‡æŸä¸ªè§†é¢‘ï¼‰ã€‚ ç›¸å…³å‘½ä»¤ ï¼šSETBITã€GETBITã€BITCOUNTã€BITOPã€‚ HyperLogLog # ä»‹ç» # HyperLogLog æ˜¯ä¸€ç§æœ‰åçš„åŸºæ•°è®¡æ•°æ¦‚ç‡ç®—æ³• ï¼ŒåŸºäº LogLog Counting(LLC)ä¼˜åŒ–æ”¹è¿›å¾—æ¥ï¼Œå¹¶ä¸æ˜¯ Redis ç‰¹æœ‰çš„ï¼ŒRedis åªæ˜¯å®ç°äº†è¿™ä¸ªç®—æ³•å¹¶æä¾›äº†ä¸€äº›å¼€ç®±å³ç”¨çš„ APIã€‚\nRedis æä¾›çš„ HyperLogLog å ç”¨ç©ºé—´éå¸¸éå¸¸å°ï¼Œåªéœ€è¦ 12k çš„ç©ºé—´å°±èƒ½å­˜å‚¨æ¥è¿‘2^64ä¸ªä¸åŒå…ƒç´ ã€‚è¿™æ˜¯çœŸçš„å‰å®³ï¼Œè¿™å°±æ˜¯æ•°å­¦çš„é­…åŠ›ä¹ˆï¼å¹¶ä¸”ï¼ŒRedis å¯¹ HyperLogLog çš„å­˜å‚¨ç»“æ„åšäº†ä¼˜åŒ–ï¼Œé‡‡ç”¨ä¸¤ç§æ–¹å¼è®¡æ•°ï¼š\nç¨€ç–çŸ©é˜µ ï¼šè®¡æ•°è¾ƒå°‘çš„æ—¶å€™ï¼Œå ç”¨ç©ºé—´å¾ˆå°ã€‚ ç¨ å¯†çŸ©é˜µ ï¼šè®¡æ•°è¾¾åˆ°æŸä¸ªé˜ˆå€¼çš„æ—¶å€™ï¼Œå ç”¨ 12k çš„ç©ºé—´ã€‚ Redis å®˜æ–¹æ–‡æ¡£ä¸­æœ‰å¯¹åº”çš„è¯¦ç»†è¯´æ˜ï¼š\nåŸºæ•°è®¡æ•°æ¦‚ç‡ç®—æ³•ä¸ºäº†èŠ‚çœå†…å­˜å¹¶ä¸ä¼šç›´æ¥å­˜å‚¨å…ƒæ•°æ®ï¼Œè€Œæ˜¯é€šè¿‡ä¸€å®šçš„æ¦‚ç‡ç»Ÿè®¡æ–¹æ³•é¢„ä¼°åŸºæ•°å€¼ï¼ˆé›†åˆä¸­åŒ…å«å…ƒç´ çš„ä¸ªæ•°ï¼‰ã€‚å› æ­¤ï¼Œ HyperLogLog çš„è®¡æ•°ç»“æœå¹¶ä¸æ˜¯ä¸€ä¸ªç²¾ç¡®å€¼ï¼Œå­˜åœ¨ä¸€å®šçš„è¯¯å·®ï¼ˆæ ‡å‡†è¯¯å·®ä¸º 0.81% ã€‚ï¼‰ã€‚\nHyperLogLog çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œä½†åŸç†éå¸¸å¤æ‚ã€‚HyperLogLog çš„åŸç†ä»¥åŠåœ¨ Redis ä¸­çš„å®ç°å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼šHyperLogLog ç®—æ³•çš„åŸç†è®²è§£ä»¥åŠ Redis æ˜¯å¦‚ä½•åº”ç”¨å®ƒçš„ ã€‚\nå†æ¨èä¸€ä¸ªå¯ä»¥å¸®åŠ©ç†è§£ HyperLogLog åŸç†çš„å·¥å…·ï¼šSketch of the Day: HyperLogLog â€” Cornerstone of a Big Data Infrastructure ã€‚\nå¸¸ç”¨å‘½ä»¤ # HyperLogLog ç›¸å…³çš„å‘½ä»¤éå¸¸å°‘ï¼Œæœ€å¸¸ç”¨çš„ä¹Ÿå°± 3 ä¸ªã€‚\nå‘½ä»¤ ä»‹ç» PFADD key element1 element2 \u0026hellip; æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ åˆ° HyperLogLog ä¸­ PFCOUNT key1 key2 è·å–ä¸€ä¸ªæˆ–è€…å¤šä¸ª HyperLogLog çš„å”¯ä¸€è®¡æ•°ã€‚ PFMERGE destkey sourcekey1 sourcekey2 \u0026hellip; å°†å¤šä¸ª HyperLogLog åˆå¹¶åˆ° destkey ä¸­ï¼Œdestkey ä¼šç»“åˆå¤šä¸ªæºï¼Œç®—å‡ºå¯¹åº”çš„å”¯ä¸€è®¡æ•°ã€‚ HyperLogLog åŸºæœ¬æ“ä½œæ¼”ç¤º ï¼š\n\u0026gt; PFADD hll foo bar zap (integer) 1 \u0026gt; PFADD hll zap zap zap (integer) 0 \u0026gt; PFADD hll foo bar (integer) 0 \u0026gt; PFCOUNT hll (integer) 3 \u0026gt; PFADD some-other-hll 1 2 3 (integer) 1 \u0026gt; PFCOUNT hll some-other-hll (integer) 6 \u0026gt; PFMERGE desthll hll some-other-hll \u0026#34;OK\u0026#34; \u0026gt; PFCOUNT desthll (integer) 6 åº”ç”¨åœºæ™¯ # æ•°é‡é‡å·¨å¤§ï¼ˆç™¾ä¸‡ã€åƒä¸‡çº§åˆ«ä»¥ä¸Šï¼‰çš„è®¡æ•°åœºæ™¯\nä¸¾ä¾‹ ï¼šçƒ­é—¨ç½‘ç«™æ¯æ—¥/æ¯å‘¨/æ¯æœˆè®¿é—® ip æ•°ç»Ÿè®¡ã€çƒ­é—¨å¸–å­ uv ç»Ÿè®¡ã€ ç›¸å…³å‘½ä»¤ ï¼šPFADDã€PFCOUNT ã€‚ Geospatial index # ä»‹ç» # Geospatial indexï¼ˆåœ°ç†ç©ºé—´ç´¢å¼•ï¼Œç®€ç§° GEOï¼‰ ä¸»è¦ç”¨äºå­˜å‚¨åœ°ç†ä½ç½®ä¿¡æ¯ï¼ŒåŸºäº Sorted Set å®ç°ã€‚\né€šè¿‡ GEO æˆ‘ä»¬å¯ä»¥è½»æ¾å®ç°ä¸¤ä¸ªä½ç½®è·ç¦»çš„è®¡ç®—ã€è·å–æŒ‡å®šä½ç½®é™„è¿‘çš„å…ƒç´ ç­‰åŠŸèƒ½ã€‚\nå¸¸ç”¨å‘½ä»¤ # å‘½ä»¤ ä»‹ç» GEOADD key longitude1 latitude1 member1 \u0026hellip; æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ å¯¹åº”çš„ç»çº¬åº¦ä¿¡æ¯åˆ° GEO ä¸­ GEOPOS key member1 member2 \u0026hellip; è¿”å›ç»™å®šå…ƒç´ çš„ç»çº¬åº¦ä¿¡æ¯ GEODIST key member1 member2 M/KM/FT/MI è¿”å›ä¸¤ä¸ªç»™å®šå…ƒç´ ä¹‹é—´çš„è·ç¦» GEORADIUS key longitude latitude radius distance è·å–æŒ‡å®šä½ç½®é™„è¿‘ distance èŒƒå›´å†…çš„å…¶ä»–å…ƒç´ ï¼Œæ”¯æŒ ASC(ç”±è¿‘åˆ°è¿œ)ã€DESCï¼ˆç”±è¿œåˆ°è¿‘ï¼‰ã€Count(æ•°é‡) ç­‰å‚æ•° GEORADIUSBYMEMBER key member radius distance ç±»ä¼¼äº GEORADIUS å‘½ä»¤ï¼Œåªæ˜¯å‚ç…§çš„ä¸­å¿ƒç‚¹æ˜¯ GEO ä¸­çš„å…ƒç´  åŸºæœ¬æ“ä½œ ï¼š\n\u0026gt; GEOADD personLocation 116.33 39.89 user1 116.34 39.90 user2 116.35 39.88 user3 3 \u0026gt; GEOPOS personLocation user1 116.3299986720085144 39.89000061669732844 \u0026gt; GEODIST personLocation user1 user2 km 1.4018 é€šè¿‡ Redis å¯è§†åŒ–å·¥å…·æŸ¥çœ‹ personLocation ï¼Œæœä¸å…¶ç„¶ï¼Œåº•å±‚å°±æ˜¯ Sorted Setã€‚\nGEO ä¸­å­˜å‚¨çš„åœ°ç†ä½ç½®ä¿¡æ¯çš„ç»çº¬åº¦æ•°æ®é€šè¿‡ GeoHash ç®—æ³•è½¬æ¢æˆäº†ä¸€ä¸ªæ•´æ•°ï¼Œè¿™ä¸ªæ•´æ•°ä½œä¸º Sorted Set çš„ score(æƒé‡å‚æ•°)ä½¿ç”¨ã€‚\nè·å–æŒ‡å®šä½ç½®èŒƒå›´å†…çš„å…¶ä»–å…ƒç´  ï¼š\n\u0026gt; GEORADIUS personLocation 116.33 39.87 3 km user3 user1 \u0026gt; GEORADIUS personLocation 116.33 39.87 2 km \u0026gt; GEORADIUS personLocation 116.33 39.87 5 km user3 user1 user2 \u0026gt; GEORADIUSBYMEMBER personLocation user1 5 km user3 user1 user2 \u0026gt; GEORADIUSBYMEMBER personLocation user1 2 km user1 user2 GEORADIUS å‘½ä»¤çš„åº•å±‚åŸç†è§£æå¯ä»¥çœ‹çœ‹é˜¿é‡Œçš„è¿™ç¯‡æ–‡ç« ï¼šRedis åˆ°åº•æ˜¯æ€ä¹ˆå®ç°â€œé™„è¿‘çš„äººâ€è¿™ä¸ªåŠŸèƒ½çš„å‘¢ï¼Ÿ ã€‚\nç§»é™¤å…ƒç´  ï¼š\nGEO åº•å±‚æ˜¯ Sorted Set ï¼Œä½ å¯ä»¥å¯¹ GEO ä½¿ç”¨ Sorted Set ç›¸å…³çš„å‘½ä»¤ã€‚\n\u0026gt; ZREM personLocation user1 1 \u0026gt; ZRANGE personLocation 0 -1 user3 user2 \u0026gt; ZSCORE personLocation user2 4069879562983946 åº”ç”¨åœºæ™¯ # éœ€è¦ç®¡ç†ä½¿ç”¨åœ°ç†ç©ºé—´æ•°æ®çš„åœºæ™¯\nä¸¾ä¾‹ï¼šé™„è¿‘çš„äººã€‚ ç›¸å…³å‘½ä»¤: GEOADDã€GEORADIUSã€GEORADIUSBYMEMBER ã€‚ å‚è€ƒ # Redis Data Structures ï¼šhttps://redis.com/redis-enterprise/data-structures/ ã€‚ ã€ŠRedis æ·±åº¦å†é™©ï¼šæ ¸å¿ƒåŸç†ä¸åº”ç”¨å®è·µã€‹1.6 å››ä¸¤æ‹¨åƒæ–¤â€”â€”HyperLogLog å¸ƒéš†è¿‡æ»¤å™¨,ä½å›¾,HyperLogLogï¼šhttps://hogwartsrico.github.io/2020/06/08/BloomFilter-HyperLogLog-BitMap/index.html "},{"id":54,"href":"/zh/docs/study/Review/java_guide/database/Redis/ly0701lyredis-base-data-structures/","title":"redisåŸºæœ¬æ•°æ®ç»“æ„","section":"Redis","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nRedis å…±æœ‰ 5 ç§åŸºæœ¬æ•°æ®ç»“æ„ï¼šStringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€Listï¼ˆåˆ—è¡¨ï¼‰ã€Setï¼ˆé›†åˆï¼‰ã€Hashï¼ˆæ•£åˆ—ï¼‰ã€Zsetï¼ˆæœ‰åºé›†åˆï¼‰ã€‚\nè¿™ 5 ç§æ•°æ®ç»“æ„æ˜¯ç›´æ¥æä¾›ç»™ç”¨æˆ·ä½¿ç”¨çš„ï¼Œæ˜¯æ•°æ®çš„ä¿å­˜å½¢å¼ï¼Œå…¶åº•å±‚å®ç°ä¸»è¦ä¾èµ–è¿™ 8 ç§æ•°æ®ç»“æ„ï¼šç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSDSï¼‰ã€LinkedListï¼ˆåŒå‘é“¾è¡¨ï¼‰ã€Hash Tableï¼ˆå“ˆå¸Œè¡¨ï¼‰ã€SkipListï¼ˆè·³è·ƒè¡¨ï¼‰ã€Intsetï¼ˆæ•´æ•°é›†åˆï¼‰ã€ZipListï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰ã€QuickListï¼ˆå¿«é€Ÿåˆ—è¡¨ï¼‰ã€‚\nRedis åŸºæœ¬æ•°æ®ç»“æ„çš„åº•å±‚æ•°æ®ç»“æ„å®ç°å¦‚ä¸‹ï¼š\nString List Hash Set Zset SDS LinkedList/ZipList/QuickList Hash Tableã€ZipList ZipListã€Intset ZipListã€SkipList Redis 3.2 ä¹‹å‰ï¼ŒList åº•å±‚å®ç°æ˜¯ LinkedList æˆ–è€… ZipListã€‚ Redis 3.2 ä¹‹åï¼Œå¼•å…¥äº† LinkedList å’Œ ZipList çš„ç»“åˆ QuickListï¼ŒList çš„åº•å±‚å®ç°å˜ä¸º QuickListã€‚\nä½ å¯ä»¥åœ¨ Redis å®˜ç½‘ä¸Šæ‰¾åˆ° Redis æ•°æ®ç»“æ„éå¸¸è¯¦ç»†çš„ä»‹ç»ï¼š\nRedis Data Structures Redis Data types tutorial æœªæ¥éšç€ Redis æ–°ç‰ˆæœ¬çš„å‘å¸ƒï¼Œå¯èƒ½ä¼šæœ‰æ–°çš„æ•°æ®ç»“æ„å‡ºç°ï¼Œé€šè¿‡æŸ¥é˜… Redis å®˜ç½‘å¯¹åº”çš„ä»‹ç»ï¼Œä½ æ€»èƒ½è·å–åˆ°æœ€é è°±çš„ä¿¡æ¯ã€‚\nStringï¼ˆå­—ç¬¦ä¸²ï¼‰ # ä»‹ç» # String æ˜¯ Redis ä¸­æœ€ç®€å•åŒæ—¶ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ä¸€ä¸ªæ•°æ®ç»“æ„ã€‚\nString æ˜¯ä¸€ç§äºŒè¿›åˆ¶å®‰å…¨çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥ç”¨æ¥å­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®æ¯”å¦‚å­—ç¬¦ä¸²ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€å›¾ç‰‡ï¼ˆå›¾ç‰‡çš„ base64 ç¼–ç æˆ–è€…è§£ç æˆ–è€…å›¾ç‰‡çš„è·¯å¾„ï¼‰ã€åºåˆ—åŒ–åçš„å¯¹è±¡ã€‚\nè™½ç„¶ Redis æ˜¯ç”¨ C è¯­è¨€å†™çš„ï¼Œä½†æ˜¯ Redis å¹¶æ²¡æœ‰ä½¿ç”¨ C çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œè€Œæ˜¯è‡ªå·±æ„å»ºäº†ä¸€ç§ ç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSimple Dynamic Stringï¼ŒSDSï¼‰ã€‚ç›¸æ¯”äº C çš„åŸç”Ÿå­—ç¬¦ä¸²ï¼ŒRedis çš„ SDS ä¸å…‰å¯ä»¥ä¿å­˜æ–‡æœ¬æ•°æ®è¿˜å¯ä»¥ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶ä¸”è·å–å­—ç¬¦ä¸²é•¿åº¦å¤æ‚åº¦ä¸º O(1)ï¼ˆC å­—ç¬¦ä¸²ä¸º O(N)ï¼‰,é™¤æ­¤ä¹‹å¤–ï¼ŒRedis çš„ SDS API æ˜¯å®‰å…¨çš„ï¼Œä¸ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºã€‚\nå¸¸ç”¨å‘½ä»¤ # å‘½ä»¤ ä»‹ç» SET key value è®¾ç½®æŒ‡å®š key çš„å€¼ SETNX key value åªæœ‰åœ¨ key ä¸å­˜åœ¨æ—¶è®¾ç½® key çš„å€¼ GET key è·å–æŒ‡å®š key çš„å€¼ MSET key1 value1 key2 value2 â€¦ è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®š key çš„å€¼ MGET key1 key2 \u0026hellip; è·å–ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®š key çš„å€¼ STRLEN key è¿”å› key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼çš„é•¿åº¦ INCR key å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢ä¸€ DECR key å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å‡ä¸€ EXISTS key åˆ¤æ–­æŒ‡å®š key æ˜¯å¦å­˜åœ¨ DEL keyï¼ˆé€šç”¨ï¼‰ åˆ é™¤æŒ‡å®šçš„ key EXPIRE key secondsï¼ˆé€šç”¨ï¼‰ ç»™æŒ‡å®š key è®¾ç½®è¿‡æœŸæ—¶é—´ æ›´å¤š Redis String å‘½ä»¤ä»¥åŠè¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œè¯·æŸ¥çœ‹ Redis å®˜ç½‘å¯¹åº”çš„ä»‹ç»ï¼šhttps://redis.io/commands/?group=string ã€‚\nåŸºæœ¬æ“ä½œ ï¼š\n\u0026gt; SET key value OK \u0026gt; GET key \u0026#34;value\u0026#34; \u0026gt; EXISTS key (integer) 1 \u0026gt; STRLEN key (integer) 5 \u0026gt; DEL key (integer) 1 \u0026gt; GET key (nil) æ‰¹é‡è®¾ç½® ï¼š\n\u0026gt; MSET key1 value1 key2 value2 OK \u0026gt; MGET key1 key2 # æ‰¹é‡è·å–å¤šä¸ª key å¯¹åº”çš„ value 1) \u0026#34;value1\u0026#34; 2) \u0026#34;value2\u0026#34; è®¡æ•°å™¨ï¼ˆå­—ç¬¦ä¸²çš„å†…å®¹ä¸ºæ•´æ•°çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ï¼‰ï¼š\n\u0026gt; SET number 1 OK \u0026gt; INCR number # å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢ä¸€ (integer) 2 \u0026gt; GET number \u0026#34;2\u0026#34; \u0026gt; DECR number # å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å‡ä¸€ (integer) 1 \u0026gt; GET number \u0026#34;1\u0026#34; è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆé»˜è®¤ä¸ºæ°¸ä¸è¿‡æœŸï¼‰ï¼š\n\u0026gt; EXPIRE key 60 (integer) 1 \u0026gt; SETNX key 60 value # è®¾ç½®å€¼å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ OK \u0026gt; TTL key (integer) 56 åº”ç”¨åœºæ™¯ # éœ€è¦å­˜å‚¨å¸¸è§„æ•°æ®çš„åœºæ™¯\nä¸¾ä¾‹ ï¼šç¼“å­˜ sessionã€tokenã€å›¾ç‰‡åœ°å€ã€åºåˆ—åŒ–åçš„å¯¹è±¡(ç›¸æ¯”è¾ƒäº Hash å­˜å‚¨æ›´èŠ‚çœå†…å­˜)ã€‚ ç›¸å…³å‘½ä»¤ ï¼š SETã€GETã€‚ éœ€è¦è®¡æ•°çš„åœºæ™¯\nä¸¾ä¾‹ ï¼šç”¨æˆ·å•ä½æ—¶é—´çš„è¯·æ±‚æ•°ï¼ˆç®€å•é™æµå¯ä»¥ç”¨åˆ°ï¼‰ã€é¡µé¢å•ä½æ—¶é—´çš„è®¿é—®æ•°ã€‚ ç›¸å…³å‘½ä»¤ ï¼šSETã€GETã€ INCRã€DECR ã€‚ åˆ†å¸ƒå¼é”\nåˆ©ç”¨ SETNX key value å‘½ä»¤å¯ä»¥å®ç°ä¸€ä¸ªæœ€ç®€æ˜“çš„åˆ†å¸ƒå¼é”ï¼ˆå­˜åœ¨ä¸€äº›ç¼ºé™·ï¼Œé€šå¸¸ä¸å»ºè®®è¿™æ ·å®ç°åˆ†å¸ƒå¼é”ï¼‰ã€‚\nListï¼ˆåˆ—è¡¨ï¼‰ # ä»‹ç» # Redis ä¸­çš„ List å…¶å®å°±æ˜¯é“¾è¡¨æ•°æ®ç»“æ„çš„å®ç°ã€‚æˆ‘åœ¨ çº¿æ€§æ•°æ®ç»“æ„ :æ•°ç»„ã€é“¾è¡¨ã€æ ˆã€é˜Ÿåˆ— è¿™ç¯‡æ–‡ç« ä¸­è¯¦ç»†ä»‹ç»äº†é“¾è¡¨è¿™ç§æ•°æ®ç»“æ„ï¼Œæˆ‘è¿™é‡Œå°±ä¸å¤šåšä»‹ç»äº†ã€‚\nè®¸å¤šé«˜çº§ç¼–ç¨‹è¯­è¨€éƒ½å†…ç½®äº†é“¾è¡¨çš„å®ç°æ¯”å¦‚ Java ä¸­çš„ LinkedListï¼Œä½†æ˜¯ C è¯­è¨€å¹¶æ²¡æœ‰å®ç°é“¾è¡¨ï¼Œæ‰€ä»¥ Redis å®ç°äº†è‡ªå·±çš„é“¾è¡¨æ•°æ®ç»“æ„ã€‚Redis çš„ List çš„å®ç°ä¸ºä¸€ä¸ª åŒå‘é“¾è¡¨ï¼Œå³å¯ä»¥æ”¯æŒåå‘æŸ¥æ‰¾å’Œéå†ï¼Œæ›´æ–¹ä¾¿æ“ä½œï¼Œä¸è¿‡å¸¦æ¥äº†éƒ¨åˆ†é¢å¤–çš„å†…å­˜å¼€é”€ã€‚\nå¸¸ç”¨å‘½ä»¤ # å‘½ä»¤ ä»‹ç» RPUSH key value1 value2 \u0026hellip; åœ¨æŒ‡å®šåˆ—è¡¨çš„å°¾éƒ¨ï¼ˆå³è¾¹ï¼‰æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´  LPUSH key value1 value2 \u0026hellip; åœ¨æŒ‡å®šåˆ—è¡¨çš„å¤´éƒ¨ï¼ˆå·¦è¾¹ï¼‰æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´  LSET key index value å°†æŒ‡å®šåˆ—è¡¨ç´¢å¼• index ä½ç½®çš„å€¼è®¾ç½®ä¸º value LPOP key ç§»é™¤å¹¶è·å–æŒ‡å®šåˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ (æœ€å·¦è¾¹) RPOP key ç§»é™¤å¹¶è·å–æŒ‡å®šåˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ (æœ€å³è¾¹) LLEN key è·å–åˆ—è¡¨å…ƒç´ æ•°é‡ LRANGE key start end è·å–åˆ—è¡¨ start å’Œ end ä¹‹é—´ çš„å…ƒç´  æ›´å¤š Redis List å‘½ä»¤ä»¥åŠè¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œè¯·æŸ¥çœ‹ Redis å®˜ç½‘å¯¹åº”çš„ä»‹ç»ï¼šhttps://redis.io/commands/?group=list ã€‚\né€šè¿‡ RPUSH/LPOP æˆ–è€… LPUSH/RPOPå®ç°é˜Ÿåˆ— ï¼š\n\u0026gt; RPUSH myList value1 (integer) 1 \u0026gt; RPUSH myList value2 value3 (integer) 3 \u0026gt; LPOP myList \u0026#34;value1\u0026#34; \u0026gt; LRANGE myList 0 1 1) \u0026#34;value2\u0026#34; 2) \u0026#34;value3\u0026#34; \u0026gt; LRANGE myList 0 -1 1) \u0026#34;value2\u0026#34; 2) \u0026#34;value3\u0026#34; é€šè¿‡ RPUSH/RPOPæˆ–è€…LPUSH/LPOP å®ç°æ ˆ ï¼š\n\u0026gt; RPUSH myList2 value1 value2 value3 (integer) 3 \u0026gt; RPOP myList2 # å°† listçš„å¤´éƒ¨(æœ€å³è¾¹)å…ƒç´ å–å‡º \u0026#34;value3\u0026#34; æˆ‘ä¸“é—¨ç”»äº†ä¸€ä¸ªå›¾æ–¹ä¾¿å¤§å®¶ç†è§£ RPUSH , LPOP , lpush , RPOP å‘½ä»¤ï¼š\né€šè¿‡ LRANGE æŸ¥çœ‹å¯¹åº”ä¸‹æ ‡èŒƒå›´çš„åˆ—è¡¨å…ƒç´  ï¼š\n\u0026gt; RPUSH myList value1 value2 value3 (integer) 3 \u0026gt; LRANGE myList 0 1 1) \u0026#34;value1\u0026#34; 2) \u0026#34;value2\u0026#34; \u0026gt; LRANGE myList 0 -1 1) \u0026#34;value1\u0026#34; 2) \u0026#34;value2\u0026#34; 3) \u0026#34;value3\u0026#34; é€šè¿‡ LRANGE å‘½ä»¤ï¼Œä½ å¯ä»¥åŸºäº List å®ç°åˆ†é¡µæŸ¥è¯¢ï¼Œæ€§èƒ½éå¸¸é«˜ï¼\né€šè¿‡ LLEN æŸ¥çœ‹é“¾è¡¨é•¿åº¦ ï¼š\n\u0026gt; LLEN myList (integer) 3 åº”ç”¨åœºæ™¯ # ä¿¡æ¯æµå±•ç¤º\nä¸¾ä¾‹ ï¼šæœ€æ–°æ–‡ç« ã€æœ€æ–°åŠ¨æ€ã€‚ ç›¸å…³å‘½ä»¤ ï¼š LPUSHã€LRANGEã€‚ æ¶ˆæ¯é˜Ÿåˆ—\nRedis List æ•°æ®ç»“æ„å¯ä»¥ç”¨æ¥åšæ¶ˆæ¯é˜Ÿåˆ—ï¼Œåªæ˜¯åŠŸèƒ½è¿‡äºç®€å•ä¸”å­˜åœ¨å¾ˆå¤šç¼ºé™·ï¼Œä¸å»ºè®®è¿™æ ·åšã€‚\nç›¸å¯¹æ¥è¯´ï¼ŒRedis 5.0 æ–°å¢åŠ çš„ä¸€ä¸ªæ•°æ®ç»“æ„ Stream æ›´é€‚åˆåšæ¶ˆæ¯é˜Ÿåˆ—ä¸€äº›ï¼Œåªæ˜¯åŠŸèƒ½ä¾ç„¶éå¸¸ç®€é™‹ã€‚å’Œä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—ç›¸æ¯”ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šæ¬ ç¼ºçš„åœ°æ–¹æ¯”å¦‚æ¶ˆæ¯ä¸¢å¤±å’Œå †ç§¯é—®é¢˜ä¸å¥½è§£å†³ã€‚\nHashï¼ˆå“ˆå¸Œï¼‰ # ä»‹ç» # Redis ä¸­çš„ Hash æ˜¯ä¸€ä¸ª String ç±»å‹çš„ field-valueï¼ˆé”®å€¼å¯¹ï¼‰ çš„æ˜ å°„è¡¨ï¼Œç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ï¼Œåç»­æ“ä½œçš„æ—¶å€™ï¼Œä½ å¯ä»¥ç›´æ¥ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ä¸­çš„æŸäº›å­—æ®µçš„å€¼ã€‚\nHash ç±»ä¼¼äº JDK1.8 å‰çš„ HashMapï¼Œå†…éƒ¨å®ç°ä¹Ÿå·®ä¸å¤š(æ•°ç»„ + é“¾è¡¨)ã€‚ä¸è¿‡ï¼ŒRedis çš„ Hash åšäº†æ›´å¤šä¼˜åŒ–ã€‚\nå¸¸ç”¨å‘½ä»¤ # å‘½ä»¤ ä»‹ç» HSET key field value è®¾ç½®æŒ‡å®šå“ˆå¸Œè¡¨ä¸­æŒ‡å®šå­—æ®µçš„å€¼ HSETNX key field value åªæœ‰æŒ‡å®šå­—æ®µä¸å­˜åœ¨æ—¶è®¾ç½®æŒ‡å®šå­—æ®µçš„å€¼ HMSET key field1 value1 field2 value2 \u0026hellip; åŒæ—¶å°†ä¸€ä¸ªæˆ–å¤šä¸ª field-value (åŸŸ-å€¼)å¯¹è®¾ç½®åˆ°æŒ‡å®šå“ˆå¸Œè¡¨ä¸­ HGET key field è·å–æŒ‡å®šå“ˆå¸Œè¡¨ä¸­æŒ‡å®šå­—æ®µçš„å€¼ HMGET key field1 field2 \u0026hellip; è·å–æŒ‡å®šå“ˆå¸Œè¡¨ä¸­ä¸€ä¸ªæˆ–è€…å¤šä¸ªæŒ‡å®šå­—æ®µçš„å€¼ HGETALL key è·å–æŒ‡å®šå“ˆå¸Œè¡¨ä¸­æ‰€æœ‰çš„é”®å€¼å¯¹ HEXISTS key field æŸ¥çœ‹æŒ‡å®šå“ˆå¸Œè¡¨ä¸­æŒ‡å®šçš„å­—æ®µæ˜¯å¦å­˜åœ¨ HDEL key field1 field2 \u0026hellip; åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå“ˆå¸Œè¡¨å­—æ®µ HLEN key è·å–æŒ‡å®šå“ˆå¸Œè¡¨ä¸­å­—æ®µçš„æ•°é‡ HINCRBY key field increment å¯¹æŒ‡å®šå“ˆå¸Œä¸­çš„æŒ‡å®šå­—æ®µåšè¿ç®—æ“ä½œï¼ˆæ­£æ•°ä¸ºåŠ ï¼Œè´Ÿæ•°ä¸ºå‡ï¼‰ æ›´å¤š Redis Hash å‘½ä»¤ä»¥åŠè¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œè¯·æŸ¥çœ‹ Redis å®˜ç½‘å¯¹åº”çš„ä»‹ç»ï¼šhttps://redis.io/commands/?group=hash ã€‚\næ¨¡æ‹Ÿå¯¹è±¡æ•°æ®å­˜å‚¨ ï¼š\n\u0026gt; HMSET userInfoKey name \u0026#34;guide\u0026#34; description \u0026#34;dev\u0026#34; age 24 OK \u0026gt; HEXISTS userInfoKey name # æŸ¥çœ‹ key å¯¹åº”çš„ valueä¸­æŒ‡å®šçš„å­—æ®µæ˜¯å¦å­˜åœ¨ã€‚ (integer) 1 \u0026gt; HGET userInfoKey name # è·å–å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®šå­—æ®µçš„å€¼ã€‚ \u0026#34;guide\u0026#34; \u0026gt; HGET userInfoKey age \u0026#34;24\u0026#34; \u0026gt; HGETALL userInfoKey # è·å–åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®š key çš„æ‰€æœ‰å­—æ®µå’Œå€¼ 1) \u0026#34;name\u0026#34; 2) \u0026#34;guide\u0026#34; 3) \u0026#34;description\u0026#34; 4) \u0026#34;dev\u0026#34; 5) \u0026#34;age\u0026#34; 6) \u0026#34;24\u0026#34; \u0026gt; HSET userInfoKey name \u0026#34;GuideGeGe\u0026#34; \u0026gt; HGET userInfoKey name \u0026#34;GuideGeGe\u0026#34; \u0026gt; HINCRBY userInfoKey age 2 (integer) 26 åº”ç”¨åœºæ™¯ # å¯¹è±¡æ•°æ®å­˜å‚¨åœºæ™¯\nä¸¾ä¾‹ ï¼šç”¨æˆ·ä¿¡æ¯ã€å•†å“ä¿¡æ¯ã€æ–‡ç« ä¿¡æ¯ã€è´­ç‰©è½¦ä¿¡æ¯ã€‚ ç›¸å…³å‘½ä»¤ ï¼šHSET ï¼ˆè®¾ç½®å•ä¸ªå­—æ®µçš„å€¼ï¼‰ã€HMSETï¼ˆè®¾ç½®å¤šä¸ªå­—æ®µçš„å€¼ï¼‰ã€HGETï¼ˆè·å–å•ä¸ªå­—æ®µçš„å€¼ï¼‰ã€HMGETï¼ˆè·å–å¤šä¸ªå­—æ®µçš„å€¼ï¼‰ã€‚ Setï¼ˆé›†åˆï¼‰ # ä»‹ç» # Redis ä¸­çš„ Set ç±»å‹æ˜¯ä¸€ç§æ— åºé›†åˆï¼Œé›†åˆä¸­çš„å…ƒç´ æ²¡æœ‰å…ˆåé¡ºåºä½†éƒ½å”¯ä¸€ï¼Œæœ‰ç‚¹ç±»ä¼¼äº Java ä¸­çš„ HashSet ã€‚å½“ä½ éœ€è¦å­˜å‚¨ä¸€ä¸ªåˆ—è¡¨æ•°æ®ï¼Œåˆä¸å¸Œæœ›å‡ºç°é‡å¤æ•°æ®æ—¶ï¼ŒSet æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå¹¶ä¸” Set æä¾›äº†åˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ª Set é›†åˆå†…çš„é‡è¦æ¥å£ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ List æ‰€ä¸èƒ½æä¾›çš„ã€‚\nä½ å¯ä»¥åŸºäº Set è½»æ˜“å®ç°äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„æ“ä½œï¼Œæ¯”å¦‚ä½ å¯ä»¥å°†ä¸€ä¸ªç”¨æˆ·æ‰€æœ‰çš„å…³æ³¨äººå­˜åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œå°†å…¶æ‰€æœ‰ç²‰ä¸å­˜åœ¨ä¸€ä¸ªé›†åˆã€‚è¿™æ ·çš„è¯ï¼ŒSet å¯ä»¥éå¸¸æ–¹ä¾¿çš„å®ç°å¦‚å…±åŒå…³æ³¨ã€å…±åŒç²‰ä¸ã€å…±åŒå–œå¥½ç­‰åŠŸèƒ½ã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå°±æ˜¯æ±‚äº¤é›†çš„è¿‡ç¨‹ã€‚\nå¸¸ç”¨å‘½ä»¤ # å‘½ä»¤ ä»‹ç» SADD key member1 member2 \u0026hellip; å‘æŒ‡å®šé›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´  SMEMBERS key è·å–æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´  SCARD key è·å–æŒ‡å®šé›†åˆçš„å…ƒç´ æ•°é‡ SISMEMBER key member åˆ¤æ–­æŒ‡å®šå…ƒç´ æ˜¯å¦åœ¨æŒ‡å®šé›†åˆä¸­ SINTER key1 key2 \u0026hellip; è·å–ç»™å®šæ‰€æœ‰é›†åˆçš„äº¤é›† SINTERSTORE destination key1 key2 \u0026hellip; å°†ç»™å®šæ‰€æœ‰é›†åˆçš„äº¤é›†å­˜å‚¨åœ¨ destination ä¸­ SUNION key1 key2 \u0026hellip; è·å–ç»™å®šæ‰€æœ‰é›†åˆçš„å¹¶é›† SUNIONSTORE destination key1 key2 \u0026hellip; å°†ç»™å®šæ‰€æœ‰é›†åˆçš„å¹¶é›†å­˜å‚¨åœ¨ destination ä¸­ SDIFF key1 key2 \u0026hellip; è·å–ç»™å®šæ‰€æœ‰é›†åˆçš„å·®é›† SDIFFSTORE destination key1 key2 \u0026hellip; å°†ç»™å®šæ‰€æœ‰é›†åˆçš„å·®é›†å­˜å‚¨åœ¨ destination ä¸­ SPOP key count éšæœºç§»é™¤å¹¶è·å–æŒ‡å®šé›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´  SRANDMEMBER key count éšæœºè·å–æŒ‡å®šé›†åˆä¸­æŒ‡å®šæ•°é‡çš„å…ƒç´  æ›´å¤š Redis Set å‘½ä»¤ä»¥åŠè¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œè¯·æŸ¥çœ‹ Redis å®˜ç½‘å¯¹åº”çš„ä»‹ç»ï¼šhttps://redis.io/commands/?group=set ã€‚\nåŸºæœ¬æ“ä½œ ï¼š\n\u0026gt; SADD mySet value1 value2 (integer) 2 \u0026gt; SADD mySet value1 # ä¸å…è®¸æœ‰é‡å¤å…ƒç´ ï¼Œå› æ­¤æ·»åŠ å¤±è´¥ (integer) 0 \u0026gt; SMEMBERS mySet 1) \u0026#34;value1\u0026#34; 2) \u0026#34;value2\u0026#34; \u0026gt; SCARD mySet (integer) 2 \u0026gt; SISMEMBER mySet value1 (integer) 1 \u0026gt; SADD mySet2 value2 value3 (integer) 2 mySet : value1ã€value2 ã€‚ mySet2 ï¼š value2 ã€value3 ã€‚ æ±‚äº¤é›† ï¼š\n\u0026gt; SINTERSTORE mySet3 mySet mySet2 (integer) 1 \u0026gt; SMEMBERS mySet3 1) \u0026#34;value2\u0026#34; æ±‚å¹¶é›† ï¼š\n\u0026gt; SUNION mySet mySet2 1) \u0026#34;value3\u0026#34; 2) \u0026#34;value2\u0026#34; 3) \u0026#34;value1\u0026#34; æ±‚å·®é›† ï¼š\n\u0026gt; SDIFF mySet mySet2 # å·®é›†æ˜¯ç”±æ‰€æœ‰å±äº mySet ä½†ä¸å±äº A çš„å…ƒç´ ç»„æˆçš„é›†åˆ 1) \u0026#34;value1\u0026#34; åº”ç”¨åœºæ™¯ # éœ€è¦å­˜æ”¾çš„æ•°æ®ä¸èƒ½é‡å¤çš„åœºæ™¯\nä¸¾ä¾‹ï¼šç½‘ç«™ UV ç»Ÿè®¡ï¼ˆæ•°æ®é‡å·¨å¤§çš„åœºæ™¯è¿˜æ˜¯ HyperLogLogæ›´é€‚åˆä¸€äº›ï¼‰ã€æ–‡ç« ç‚¹èµã€åŠ¨æ€ç‚¹èµç­‰åœºæ™¯ã€‚ ç›¸å…³å‘½ä»¤ï¼šSCARDï¼ˆè·å–é›†åˆæ•°é‡ï¼‰ ã€‚ éœ€è¦è·å–å¤šä¸ªæ•°æ®æºäº¤é›†ã€å¹¶é›†å’Œå·®é›†çš„åœºæ™¯\nä¸¾ä¾‹ ï¼š**å…±åŒå¥½å‹(**äº¤é›†)ã€å…±åŒç²‰ä¸(äº¤é›†)ã€å…±åŒå…³æ³¨(äº¤é›†)ã€å¥½å‹æ¨èï¼ˆå·®é›†ï¼‰ã€éŸ³ä¹æ¨èï¼ˆå·®é›†ï¼‰ ã€è®¢é˜…å·æ¨èï¼ˆå·®é›†+äº¤é›†ï¼‰ ç­‰åœºæ™¯ã€‚ ç›¸å…³å‘½ä»¤ï¼šSINTERï¼ˆäº¤é›†ï¼‰ã€SINTERSTORE ï¼ˆäº¤é›†ï¼‰ã€SUNION ï¼ˆå¹¶é›†ï¼‰ã€SUNIONSTOREï¼ˆå¹¶é›†ï¼‰ã€SDIFFï¼ˆå·®é›†ï¼‰ã€SDIFFSTORE ï¼ˆå·®é›†ï¼‰ã€‚ éœ€è¦éšæœºè·å–æ•°æ®æºä¸­çš„å…ƒç´ çš„åœºæ™¯\nä¸¾ä¾‹ ï¼šæŠ½å¥–ç³»ç»Ÿã€éšæœºã€‚ ç›¸å…³å‘½ä»¤ï¼šSPOPï¼ˆéšæœºè·å–é›†åˆä¸­çš„å…ƒç´ å¹¶ç§»é™¤ï¼Œé€‚åˆä¸å…è®¸é‡å¤ä¸­å¥–çš„åœºæ™¯ï¼‰ã€SRANDMEMBERï¼ˆéšæœºè·å–é›†åˆä¸­çš„å…ƒç´ ï¼Œé€‚åˆå…è®¸é‡å¤ä¸­å¥–çš„åœºæ™¯ï¼‰ã€‚ Sorted Setï¼ˆæœ‰åºé›†åˆï¼‰ # ä»‹ç» # Sorted Set ç±»ä¼¼äº Setï¼Œä½†å’Œ Set ç›¸æ¯”ï¼ŒSorted Set å¢åŠ äº†ä¸€ä¸ªæƒé‡å‚æ•° scoreï¼Œä½¿å¾—é›†åˆä¸­çš„å…ƒç´ èƒ½å¤ŸæŒ‰ score è¿›è¡Œæœ‰åºæ’åˆ—ï¼Œè¿˜å¯ä»¥é€šè¿‡ score çš„èŒƒå›´æ¥è·å–å…ƒç´ çš„åˆ—è¡¨ã€‚æœ‰ç‚¹åƒæ˜¯ Java ä¸­ HashMap å’Œ TreeSet çš„ç»“åˆä½“ã€‚\nå¸¸ç”¨å‘½ä»¤ # å‘½ä»¤ ä»‹ç» ZADD key score1 member1 score2 member2 \u0026hellip; å‘æŒ‡å®šæœ‰åºé›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´  ZCARD KEY è·å–æŒ‡å®šæœ‰åºé›†åˆçš„å…ƒç´ æ•°é‡ ZSCORE key member è·å–æŒ‡å®šæœ‰åºé›†åˆä¸­æŒ‡å®šå…ƒç´ çš„ score å€¼ ZINTERSTORE destination numkeys key1 key2 \u0026hellip; å°†ç»™å®šæ‰€æœ‰æœ‰åºé›†åˆçš„äº¤é›†å­˜å‚¨åœ¨ destination ä¸­ï¼Œå¯¹ç›¸åŒå…ƒç´ å¯¹åº”çš„ score å€¼è¿›è¡Œ SUM èšåˆæ“ä½œï¼Œnumkeys ä¸ºé›†åˆæ•°é‡ ZUNIONSTORE destination numkeys key1 key2 \u0026hellip; æ±‚å¹¶é›†ï¼Œå…¶å®ƒå’Œ ZINTERSTORE ç±»ä¼¼ ZDIFF destination numkeys key1 key2 \u0026hellip; æ±‚å·®é›†ï¼Œå…¶å®ƒå’Œ ZINTERSTORE ç±»ä¼¼ ZRANGE key start end è·å–æŒ‡å®šæœ‰åºé›†åˆ start å’Œ end ä¹‹é—´çš„å…ƒç´ ï¼ˆscore ä»ä½åˆ°é«˜ï¼‰ ZREVRANGE key start end è·å–æŒ‡å®šæœ‰åºé›†åˆ start å’Œ end ä¹‹é—´çš„å…ƒç´ ï¼ˆscore ä»é«˜åˆ°åº•ï¼‰ ZREVRANK key member è·å–æŒ‡å®šæœ‰åºé›†åˆä¸­æŒ‡å®šå…ƒç´ çš„æ’å(score ä»å¤§åˆ°å°æ’åº) æ›´å¤š Redis Sorted Set å‘½ä»¤ä»¥åŠè¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œè¯·æŸ¥çœ‹ Redis å®˜ç½‘å¯¹åº”çš„ä»‹ç»ï¼šhttps://redis.io/commands/?group=sorted-set ã€‚\nåŸºæœ¬æ“ä½œ ï¼š\n\u0026gt; ZADD myZset 2.0 value1 1.0 value2 (integer) 2 \u0026gt; ZCARD myZset 2 \u0026gt; ZSCORE myZset value1 2.0 \u0026gt; ZRANGE myZset 0 1 1) \u0026#34;value2\u0026#34; 2) \u0026#34;value1\u0026#34; \u0026gt; ZREVRANGE myZset 0 1 1) \u0026#34;value1\u0026#34; 2) \u0026#34;value2\u0026#34; \u0026gt; ZADD myZset2 4.0 value2 3.0 value3 (integer) 2 myZset : value1(2.0)ã€value2(1.0) ã€‚ myZset2 ï¼š value2 ï¼ˆ4.0ï¼‰ã€value3(3.0) ã€‚ è·å–æŒ‡å®šå…ƒç´ çš„æ’å ï¼š\n\u0026gt; ZREVRANK myZset value1 0 \u0026gt; ZREVRANK myZset value2 1 æ±‚äº¤é›† ï¼š\n\u0026gt; ZINTERSTORE myZset3 2 myZset myZset2 1 \u0026gt; ZRANGE myZset3 0 1 WITHSCORES value2 5 æ±‚å¹¶é›† ï¼š\n\u0026gt; ZUNIONSTORE myZset4 2 myZset myZset2 3 \u0026gt; ZRANGE myZset4 0 2 WITHSCORES value1 2 value3 3 value2 5 æ±‚å·®é›† ï¼š\n\u0026gt; ZDIFF 2 myZset myZset2 WITHSCORES value1 2 åº”ç”¨åœºæ™¯ # éœ€è¦éšæœºè·å–æ•°æ®æºä¸­çš„å…ƒç´ æ ¹æ®æŸä¸ªæƒé‡è¿›è¡Œæ’åºçš„åœºæ™¯\nä¸¾ä¾‹ ï¼šå„ç§æ’è¡Œæ¦œæ¯”å¦‚ç›´æ’­é—´é€ç¤¼ç‰©çš„æ’è¡Œæ¦œã€æœ‹å‹åœˆçš„å¾®ä¿¡æ­¥æ•°æ’è¡Œæ¦œã€ç‹è€…è£è€€ä¸­çš„æ®µä½æ’è¡Œæ¦œã€è¯é¢˜çƒ­åº¦æ’è¡Œæ¦œç­‰ç­‰ã€‚ ç›¸å…³å‘½ä»¤ ï¼šZRANGE (ä»å°åˆ°å¤§æ’åº) ã€ ZREVRANGE ï¼ˆä»å¤§åˆ°å°æ’åºï¼‰ã€ZREVRANK (æŒ‡å®šå…ƒç´ æ’å)ã€‚ ã€ŠJava é¢è¯•æŒ‡åŒ—ã€‹ çš„ã€ŒæŠ€æœ¯é¢è¯•é¢˜ç¯‡ã€å°±æœ‰ä¸€ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Sorted Set æ¥è®¾è®¡åˆ¶ä½œä¸€ä¸ªæ’è¡Œæ¦œã€‚\néœ€è¦å­˜å‚¨çš„æ•°æ®æœ‰ä¼˜å…ˆçº§æˆ–è€…é‡è¦ç¨‹åº¦çš„åœºæ™¯ æ¯”å¦‚ä¼˜å…ˆçº§ä»»åŠ¡é˜Ÿåˆ—ã€‚\nä¸¾ä¾‹ ï¼šä¼˜å…ˆçº§ä»»åŠ¡é˜Ÿåˆ—ã€‚ ç›¸å…³å‘½ä»¤ ï¼šZRANGE (ä»å°åˆ°å¤§æ’åº) ã€ ZREVRANGE ï¼ˆä»å¤§åˆ°å°æ’åºï¼‰ã€ZREVRANK (æŒ‡å®šå…ƒç´ æ’å)ã€‚ å‚è€ƒ # Redis Data Structures ï¼šhttps://redis.com/redis-enterprise/data-structures/ ã€‚ Redis Commands ï¼š https://redis.io/commands/ ã€‚ Redis Data types tutorialï¼šhttps://redis.io/docs/manual/data-types/data-types-tutorial/ ã€‚ Redis å­˜å‚¨å¯¹è±¡ä¿¡æ¯æ˜¯ç”¨ Hash è¿˜æ˜¯ String : https://segmentfault.com/a/1190000040032006 "},{"id":55,"href":"/zh/docs/study/Review/java_guide/database/Redis/ly0706lyredis-questions-02/","title":"redisé¢è¯•é¢˜02","section":"Redis","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nRedis äº‹åŠ¡ # å¦‚ä½•ä½¿ç”¨ Redis äº‹åŠ¡ï¼Ÿ # Redis å¯ä»¥é€šè¿‡ MULTIï¼ŒEXECï¼ŒDISCARD å’Œ WATCH ç­‰å‘½ä»¤æ¥å®ç°äº‹åŠ¡(transaction)åŠŸèƒ½ã€‚\n\u0026gt; MULTI OK \u0026gt; SET PROJECT \u0026#34;JavaGuide\u0026#34; QUEUED \u0026gt; GET PROJECT QUEUED \u0026gt; EXEC 1) OK 2) \u0026#34;JavaGuide\u0026#34; MULTI å‘½ä»¤åå¯ä»¥è¾“å…¥å¤šä¸ªå‘½ä»¤ï¼ŒRedis ä¸ä¼šç«‹å³æ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œè€Œæ˜¯å°†å®ƒä»¬æ”¾åˆ°é˜Ÿåˆ—ï¼Œå½“è°ƒç”¨äº† EXEC å‘½ä»¤åï¼Œå†æ‰§è¡Œæ‰€æœ‰çš„å‘½ä»¤ã€‚\nè¿™ä¸ªè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š\nå¼€å§‹äº‹åŠ¡ï¼ˆMULTIï¼‰ï¼› å‘½ä»¤å…¥é˜Ÿ(æ‰¹é‡æ“ä½œ Redis çš„å‘½ä»¤ï¼Œå…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„é¡ºåºæ‰§è¡Œ)ï¼› æ‰§è¡Œäº‹åŠ¡(EXEC)ã€‚ ä½ ä¹Ÿå¯ä»¥é€šè¿‡ DISCARD å‘½ä»¤å–æ¶ˆä¸€ä¸ªäº‹åŠ¡ï¼Œå®ƒä¼šæ¸…ç©ºäº‹åŠ¡é˜Ÿåˆ—ä¸­ä¿å­˜çš„æ‰€æœ‰å‘½ä»¤ã€‚\n\u0026gt; MULTI OK \u0026gt; SET PROJECT \u0026#34;JavaGuide\u0026#34; QUEUED \u0026gt; GET PROJECT QUEUED \u0026gt; DISCARD OK ä½ å¯ä»¥é€šè¿‡WATCH å‘½ä»¤ç›‘å¬æŒ‡å®šçš„ Keyï¼Œå½“è°ƒç”¨ EXEC å‘½ä»¤æ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œå¦‚æœä¸€ä¸ªè¢« WATCH å‘½ä»¤ç›‘è§†çš„ Key è¢« å…¶ä»–å®¢æˆ·ç«¯/Session ä¿®æ”¹çš„è¯ï¼Œæ•´ä¸ªäº‹åŠ¡éƒ½ä¸ä¼šè¢«æ‰§è¡Œã€‚\n# å®¢æˆ·ç«¯ 1 \u0026gt; SET PROJECT \u0026#34;RustGuide\u0026#34; OK \u0026gt; WATCH PROJECT OK \u0026gt; MULTI OK \u0026gt; SET PROJECT \u0026#34;JavaGuide\u0026#34; QUEUED # å®¢æˆ·ç«¯ 2 # åœ¨å®¢æˆ·ç«¯ 1 æ‰§è¡Œ EXEC å‘½ä»¤æäº¤äº‹åŠ¡ä¹‹å‰ä¿®æ”¹ PROJECT çš„å€¼ \u0026gt; SET PROJECT \u0026#34;GoGuide\u0026#34; # å®¢æˆ·ç«¯ 1 # ä¿®æ”¹å¤±è´¥ï¼Œå› ä¸º PROJECT çš„å€¼è¢«å®¢æˆ·ç«¯2ä¿®æ”¹äº† \u0026gt; EXEC (nil) \u0026gt; GET PROJECT \u0026#34;GoGuide\u0026#34; ä¸è¿‡ï¼Œå¦‚æœ WATCH ä¸ äº‹åŠ¡ åœ¨åŒä¸€ä¸ª Session é‡Œï¼Œå¹¶ä¸”è¢« WATCH ç›‘è§†çš„ Key è¢«ä¿®æ”¹çš„æ“ä½œå‘ç”Ÿåœ¨äº‹åŠ¡å†…éƒ¨ï¼Œè¿™ä¸ªäº‹åŠ¡æ˜¯å¯ä»¥è¢«æ‰§è¡ŒæˆåŠŸçš„ï¼ˆç›¸å…³ issue ï¼šWATCH å‘½ä»¤ç¢°åˆ° MULTI å‘½ä»¤æ—¶çš„ä¸åŒæ•ˆæœï¼‰ã€‚\näº‹åŠ¡å†…éƒ¨ä¿®æ”¹ WATCH ç›‘è§†çš„ Keyï¼š\n\u0026gt; SET PROJECT \u0026#34;JavaGuide\u0026#34; OK \u0026gt; WATCH PROJECT OK \u0026gt; MULTI OK \u0026gt; SET PROJECT \u0026#34;JavaGuide1\u0026#34; QUEUED \u0026gt; SET PROJECT \u0026#34;JavaGuide2\u0026#34; QUEUED \u0026gt; SET PROJECT \u0026#34;JavaGuide3\u0026#34; QUEUED \u0026gt; EXEC 1) OK 2) OK 3) OK 127.0.0.1:6379\u0026gt; GET PROJECT \u0026#34;JavaGuide3\u0026#34; äº‹åŠ¡å¤–éƒ¨ä¿®æ”¹ WATCH ç›‘è§†çš„ Keyï¼š\n\u0026gt; SET PROJECT \u0026#34;JavaGuide\u0026#34; OK \u0026gt; WATCH PROJECT OK \u0026gt; SET PROJECT \u0026#34;JavaGuide2\u0026#34; OK \u0026gt; MULTI OK \u0026gt; GET USER QUEUED \u0026gt; EXEC (nil) Redis å®˜ç½‘ç›¸å…³ä»‹ç» https://redis.io/topics/transactions å¦‚ä¸‹ï¼š\nRedis æ”¯æŒåŸå­æ€§å—ï¼Ÿ # Redis çš„äº‹åŠ¡å’Œæˆ‘ä»¬å¹³æ—¶ç†è§£çš„å…³ç³»å‹æ•°æ®åº“çš„äº‹åŠ¡ä¸åŒã€‚æˆ‘ä»¬çŸ¥é“äº‹åŠ¡å…·æœ‰å››å¤§ç‰¹æ€§ï¼š 1. åŸå­æ€§ï¼Œ2. éš”ç¦»æ€§ï¼Œ3. æŒä¹…æ€§ï¼Œ4. ä¸€è‡´æ€§ã€‚\nåŸå­æ€§ï¼ˆAtomicityï¼‰ï¼š äº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ï¼› éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼š å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸è¢«å…¶ä»–äº‹åŠ¡æ‰€å¹²æ‰°ï¼Œå„å¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®åº“æ˜¯ç‹¬ç«‹çš„ï¼› æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼š ä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚ ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼š æ‰§è¡Œäº‹åŠ¡å‰åï¼Œæ•°æ®ä¿æŒä¸€è‡´ï¼Œå¤šä¸ªäº‹åŠ¡å¯¹åŒä¸€ä¸ªæ•°æ®è¯»å–çš„ç»“æœæ˜¯ç›¸åŒçš„ï¼› Redis äº‹åŠ¡åœ¨è¿è¡Œé”™è¯¯çš„æƒ…å†µä¸‹ï¼Œé™¤äº†æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯çš„å‘½ä»¤å¤–ï¼Œå…¶ä»–å‘½ä»¤éƒ½èƒ½æ­£å¸¸æ‰§è¡Œã€‚å¹¶ä¸”ï¼ŒRedis æ˜¯ä¸æ”¯æŒå›æ»šï¼ˆroll backï¼‰æ“ä½œçš„ã€‚å› æ­¤ï¼ŒRedis äº‹åŠ¡å…¶å®æ˜¯ä¸æ»¡è¶³åŸå­æ€§çš„ï¼ˆè€Œä¸”ä¸æ»¡è¶³æŒä¹…æ€§ï¼‰ã€‚\nRedis å®˜ç½‘ä¹Ÿè§£é‡Šäº†è‡ªå·±ä¸ºå•¥ä¸æ”¯æŒå›æ»šã€‚ç®€å•æ¥è¯´å°±æ˜¯ Redis å¼€å‘è€…ä»¬è§‰å¾—æ²¡å¿…è¦æ”¯æŒå›æ»šï¼Œè¿™æ ·æ›´ç®€å•ä¾¿æ·å¹¶ä¸”æ€§èƒ½æ›´å¥½ã€‚Redis å¼€å‘è€…è§‰å¾—å³ä½¿å‘½ä»¤æ‰§è¡Œé”™è¯¯ä¹Ÿåº”è¯¥åœ¨å¼€å‘è¿‡ç¨‹ä¸­å°±è¢«å‘ç°è€Œä¸æ˜¯ç”Ÿäº§è¿‡ç¨‹ä¸­ã€‚\nä½ å¯ä»¥å°† Redis ä¸­çš„äº‹åŠ¡å°±ç†è§£ä¸º ï¼šRedis äº‹åŠ¡æä¾›äº†ä¸€ç§å°†å¤šä¸ªå‘½ä»¤è¯·æ±‚æ‰“åŒ…çš„åŠŸèƒ½ã€‚ç„¶åï¼Œå†æŒ‰é¡ºåºæ‰§è¡Œæ‰“åŒ…çš„æ‰€æœ‰å‘½ä»¤ï¼Œå¹¶ä¸”ä¸ä¼šè¢«ä¸­é€”æ‰“æ–­ã€‚\né™¤äº†ä¸æ»¡è¶³åŸå­æ€§ä¹‹å¤–ï¼Œäº‹åŠ¡ä¸­çš„æ¯æ¡å‘½ä»¤éƒ½ä¼šä¸ Redis æœåŠ¡å™¨è¿›è¡Œç½‘ç»œäº¤äº’ï¼Œè¿™æ˜¯æ¯”è¾ƒæµªè´¹èµ„æºçš„è¡Œä¸ºã€‚æ˜æ˜ä¸€æ¬¡æ‰¹é‡æ‰§è¡Œå¤šä¸ªå‘½ä»¤å°±å¯ä»¥äº†ï¼Œè¿™ç§æ“ä½œå®åœ¨æ˜¯çœ‹ä¸æ‡‚ã€‚\nå› æ­¤ï¼ŒRedis äº‹åŠ¡æ˜¯ä¸å»ºè®®åœ¨æ—¥å¸¸å¼€å‘ä¸­ä½¿ç”¨çš„ã€‚\nç›¸å…³ issue :\nissue452: å…³äº Redis äº‹åŠ¡ä¸æ»¡è¶³åŸå­æ€§çš„é—®é¢˜ ã€‚ Issue491:å…³äº redis æ²¡æœ‰äº‹åŠ¡å›æ»šï¼Ÿ å¦‚ä½•è§£å†³ Redis äº‹åŠ¡çš„ç¼ºé™·ï¼Ÿ # Redis ä» 2.6 ç‰ˆæœ¬å¼€å§‹æ”¯æŒæ‰§è¡Œ Lua è„šæœ¬ï¼Œå®ƒçš„åŠŸèƒ½å’Œäº‹åŠ¡éå¸¸ç±»ä¼¼ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Lua è„šæœ¬æ¥æ‰¹é‡æ‰§è¡Œå¤šæ¡ Redis å‘½ä»¤ï¼Œè¿™äº› Redis å‘½ä»¤ä¼šè¢«æäº¤åˆ° Redis æœåŠ¡å™¨ä¸€æ¬¡æ€§æ‰§è¡Œå®Œæˆï¼Œå¤§å¹…å‡å°äº†ç½‘ç»œå¼€é”€ã€‚\nä¸€æ®µ Lua è„šæœ¬å¯ä»¥è§†ä½œä¸€æ¡å‘½ä»¤æ‰§è¡Œï¼Œä¸€æ®µ Lua è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šæœ‰å…¶ä»–è„šæœ¬æˆ– Redis å‘½ä»¤åŒæ—¶æ‰§è¡Œï¼Œä¿è¯äº†æ“ä½œä¸ä¼šè¢«å…¶ä»–æŒ‡ä»¤æ’å…¥æˆ–æ‰“æ‰°ã€‚\nå¦‚æœ Lua è„šæœ¬è¿è¡Œæ—¶å‡ºé”™å¹¶ä¸­é€”ç»“æŸï¼Œå‡ºé”™ä¹‹åçš„å‘½ä»¤æ˜¯ä¸ä¼šè¢«æ‰§è¡Œçš„ã€‚å¹¶ä¸”ï¼Œå‡ºé”™ä¹‹å‰æ‰§è¡Œçš„å‘½ä»¤æ˜¯æ— æ³•è¢«æ’¤é”€çš„ã€‚å› æ­¤ï¼Œä¸¥æ ¼æ¥è¯´ï¼Œé€šè¿‡ Lua è„šæœ¬æ¥æ‰¹é‡æ‰§è¡Œ Redis å‘½ä»¤ä¹Ÿæ˜¯ä¸æ»¡è¶³åŸå­æ€§çš„ã€‚\nå¦å¤–ï¼ŒRedis 7.0 æ–°å¢äº† Redis functions ç‰¹æ€§ï¼Œä½ å¯ä»¥å°† Redis functions çœ‹ä½œæ˜¯æ¯” Lua æ›´å¼ºå¤§çš„è„šæœ¬ã€‚\nRedis æ€§èƒ½ä¼˜åŒ– # Redis bigkey # ä»€ä¹ˆæ˜¯ bigkeyï¼Ÿ # ç®€å•æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ª key å¯¹åº”çš„ value æ‰€å ç”¨çš„å†…å­˜æ¯”è¾ƒå¤§ï¼Œé‚£è¿™ä¸ª key å°±å¯ä»¥çœ‹ä½œæ˜¯ bigkeyã€‚å…·ä½“å¤šå¤§æ‰ç®—å¤§å‘¢ï¼Ÿæœ‰ä¸€ä¸ªä¸æ˜¯ç‰¹åˆ«ç²¾ç¡®çš„å‚è€ƒæ ‡å‡†ï¼šstring ç±»å‹çš„ value è¶…è¿‡ 10 kbï¼Œå¤åˆç±»å‹çš„ value åŒ…å«çš„å…ƒç´ è¶…è¿‡ 5000 ä¸ªï¼ˆå¯¹äºå¤åˆç±»å‹çš„ value æ¥è¯´ï¼Œä¸ä¸€å®šåŒ…å«çš„å…ƒç´ è¶Šå¤šï¼Œå ç”¨çš„å†…å­˜å°±è¶Šå¤šï¼‰ã€‚\nbigkey æœ‰ä»€ä¹ˆå±å®³ï¼Ÿ # é™¤äº†ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼Œbigkey å¯¹æ€§èƒ½ä¹Ÿä¼šæœ‰æ¯”è¾ƒå¤§çš„å½±å“ã€‚\nå› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡é¿å…å†™å…¥ bigkeyï¼\nå¦‚ä½•å‘ç° bigkeyï¼Ÿ # 1ã€ä½¿ç”¨ Redis è‡ªå¸¦çš„ --bigkeys å‚æ•°æ¥æŸ¥æ‰¾ã€‚\n# redis-cli -p 6379 --bigkeys # Scanning the entire keyspace to find biggest keys as well as # average sizes per key type. You can use -i 0.1 to sleep 0.1 sec # per 100 SCAN commands (not usually needed). [00.00%] Biggest string found so far \u0026#39;\u0026#34;ballcat:oauth:refresh_auth:f6cdb384-9a9d-4f2f-af01-dc3f28057c20\u0026#34;\u0026#39; with 4437 bytes [00.00%] Biggest list found so far \u0026#39;\u0026#34;my-list\u0026#34;\u0026#39; with 17 items -------- summary ------- Sampled 5 keys in the keyspace! Total key length in bytes is 264 (avg len 52.80) Biggest list found \u0026#39;\u0026#34;my-list\u0026#34;\u0026#39; has 17 items Biggest string found \u0026#39;\u0026#34;ballcat:oauth:refresh_auth:f6cdb384-9a9d-4f2f-af01-dc3f28057c20\u0026#34;\u0026#39; has 4437 bytes 1 lists with 17 items (20.00% of keys, avg size 17.00) 0 hashs with 0 fields (00.00% of keys, avg size 0.00) 4 strings with 4831 bytes (80.00% of keys, avg size 1207.75) 0 streams with 0 entries (00.00% of keys, avg size 0.00) 0 sets with 0 members (00.00% of keys, avg size 0.00) 0 zsets with 0 members (00.00% of keys, avg size 0.00 ä»è¿™ä¸ªå‘½ä»¤çš„è¿è¡Œç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼šè¿™ä¸ªå‘½ä»¤ä¼šæ‰«æ(Scan) Redis ä¸­çš„æ‰€æœ‰ key ï¼Œä¼šå¯¹ Redis çš„æ€§èƒ½æœ‰ä¸€ç‚¹å½±å“ã€‚å¹¶ä¸”ï¼Œè¿™ç§æ–¹å¼åªèƒ½æ‰¾å‡ºæ¯ç§æ•°æ®ç»“æ„ top 1 bigkeyï¼ˆå ç”¨å†…å­˜æœ€å¤§çš„ string æ•°æ®ç±»å‹ï¼ŒåŒ…å«å…ƒç´ æœ€å¤šçš„å¤åˆæ•°æ®ç±»å‹ï¼‰ã€‚\n2ã€åˆ†æ RDB æ–‡ä»¶\né€šè¿‡åˆ†æ RDB æ–‡ä»¶æ¥æ‰¾å‡º big keyã€‚è¿™ç§æ–¹æ¡ˆçš„å‰ææ˜¯ä½ çš„ Redis é‡‡ç”¨çš„æ˜¯ RDB æŒä¹…åŒ–ã€‚\nç½‘ä¸Šæœ‰ç°æˆçš„ä»£ç /å·¥å…·å¯ä»¥ç›´æ¥æ‹¿æ¥ä½¿ç”¨ï¼š\nredis-rdb-tools ï¼šPython è¯­è¨€å†™çš„ç”¨æ¥åˆ†æ Redis çš„ RDB å¿«ç…§æ–‡ä»¶ç”¨çš„å·¥å…· rdb_bigkeys : Go è¯­è¨€å†™çš„ç”¨æ¥åˆ†æ Redis çš„ RDB å¿«ç…§æ–‡ä»¶ç”¨çš„å·¥å…·ï¼Œæ€§èƒ½æ›´å¥½ã€‚ å¤§é‡ key é›†ä¸­è¿‡æœŸé—®é¢˜ # æˆ‘åœ¨ä¸Šé¢æåˆ°è¿‡ï¼šå¯¹äºè¿‡æœŸ keyï¼ŒRedis é‡‡ç”¨çš„æ˜¯ å®šæœŸåˆ é™¤+æƒ°æ€§/æ‡’æ±‰å¼åˆ é™¤ ç­–ç•¥ã€‚\nå®šæœŸåˆ é™¤æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœçªç„¶é‡åˆ°å¤§é‡è¿‡æœŸ key çš„è¯ï¼Œå®¢æˆ·ç«¯è¯·æ±‚å¿…é¡»ç­‰å¾…å®šæœŸæ¸…ç†è¿‡æœŸ key ä»»åŠ¡çº¿ç¨‹æ‰§è¡Œå®Œæˆï¼Œå› ä¸ºè¿™ä¸ªè¿™ä¸ªå®šæœŸä»»åŠ¡çº¿ç¨‹æ˜¯åœ¨ Redis ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œçš„ã€‚è¿™å°±å¯¼è‡´å®¢æˆ·ç«¯è¯·æ±‚æ²¡åŠæ³•è¢«åŠæ—¶å¤„ç†ï¼Œå“åº”é€Ÿåº¦ä¼šæ¯”è¾ƒæ…¢ã€‚\nå¦‚ä½•è§£å†³å‘¢ï¼Ÿä¸‹é¢æ˜¯ä¸¤ç§å¸¸è§çš„æ–¹æ³•ï¼š\nç»™ key è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´ã€‚ å¼€å¯ lazy-freeï¼ˆæƒ°æ€§åˆ é™¤/å»¶è¿Ÿé‡Šæ”¾ï¼‰ ã€‚lazy-free ç‰¹æ€§æ˜¯ Redis 4.0 å¼€å§‹å¼•å…¥çš„ï¼ŒæŒ‡çš„æ˜¯è®© Redis é‡‡ç”¨å¼‚æ­¥æ–¹å¼å»¶è¿Ÿé‡Šæ”¾ key ä½¿ç”¨çš„å†…å­˜ï¼Œå°†è¯¥æ“ä½œäº¤ç»™å•ç‹¬çš„å­çº¿ç¨‹å¤„ç†ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚ ä¸ªäººå»ºè®®ä¸ç®¡æ˜¯å¦å¼€å¯ lazy-freeï¼Œæˆ‘ä»¬éƒ½å°½é‡ç»™ key è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´ã€‚\nRedis ç”Ÿäº§é—®é¢˜ # ç¼“å­˜ç©¿é€ # ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿ # ç¼“å­˜ç©¿é€è¯´ç®€å•ç‚¹å°±æ˜¯å¤§é‡è¯·æ±‚çš„ key æ˜¯ä¸åˆç†çš„ï¼Œæ ¹æœ¬ä¸å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œä¹Ÿä¸å­˜åœ¨äºæ•°æ®åº“ä¸­ ã€‚è¿™å°±å¯¼è‡´è¿™äº›è¯·æ±‚ç›´æ¥åˆ°äº†æ•°æ®åº“ä¸Šï¼Œæ ¹æœ¬æ²¡æœ‰ç»è¿‡ç¼“å­˜è¿™ä¸€å±‚ï¼Œå¯¹æ•°æ®åº“é€ æˆäº†å·¨å¤§çš„å‹åŠ›ï¼Œå¯èƒ½ç›´æ¥å°±è¢«è¿™ä¹ˆå¤šè¯·æ±‚å¼„å®•æœºäº†ã€‚\nä¸¾ä¸ªä¾‹å­ï¼šæŸä¸ªé»‘å®¢æ•…æ„åˆ¶é€ ä¸€äº›éæ³•çš„ key å‘èµ·å¤§é‡è¯·æ±‚ï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚è½åˆ°æ•°æ®åº“ï¼Œç»“æœæ•°æ®åº“ä¸Šä¹Ÿæ²¡æœ‰æŸ¥åˆ°å¯¹åº”çš„æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™äº›è¯·æ±‚æœ€ç»ˆéƒ½è½åˆ°äº†æ•°æ®åº“ä¸Šï¼Œå¯¹æ•°æ®åº“é€ æˆäº†å·¨å¤§çš„å‹åŠ›ã€‚\næœ‰å“ªäº›è§£å†³åŠæ³•ï¼Ÿ # æœ€åŸºæœ¬çš„å°±æ˜¯é¦–å…ˆåšå¥½å‚æ•°æ ¡éªŒï¼Œä¸€äº›ä¸åˆæ³•çš„å‚æ•°è¯·æ±‚ç›´æ¥æŠ›å‡ºå¼‚å¸¸ä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯ã€‚æ¯”å¦‚æŸ¥è¯¢çš„æ•°æ®åº“ id ä¸èƒ½å°äº 0ã€ä¼ å…¥çš„é‚®ç®±æ ¼å¼ä¸å¯¹çš„æ—¶å€™ç›´æ¥è¿”å›é”™è¯¯æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ç­‰ç­‰ã€‚\n1ï¼‰ç¼“å­˜æ— æ•ˆ key\nå¦‚æœç¼“å­˜å’Œæ•°æ®åº“éƒ½æŸ¥ä¸åˆ°æŸä¸ª key çš„æ•°æ®å°±å†™ä¸€ä¸ªåˆ° Redis ä¸­å»å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š SET key value EX 10086 ã€‚è¿™ç§æ–¹å¼å¯ä»¥è§£å†³è¯·æ±‚çš„ key å˜åŒ–ä¸é¢‘ç¹çš„æƒ…å†µï¼Œå¦‚æœé»‘å®¢æ¶æ„æ”»å‡»ï¼Œæ¯æ¬¡æ„å»ºä¸åŒçš„è¯·æ±‚ keyï¼Œä¼šå¯¼è‡´ Redis ä¸­ç¼“å­˜å¤§é‡æ— æ•ˆçš„ key ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™ç§æ–¹æ¡ˆå¹¶ä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³æ­¤é—®é¢˜ã€‚å¦‚æœéè¦ç”¨è¿™ç§æ–¹å¼æ¥è§£å†³ç©¿é€é—®é¢˜çš„è¯ï¼Œå°½é‡å°†æ— æ•ˆçš„ key çš„è¿‡æœŸæ—¶é—´è®¾ç½®çŸ­ä¸€ç‚¹æ¯”å¦‚ 1 åˆ†é’Ÿã€‚\nå¦å¤–ï¼Œè¿™é‡Œå¤šè¯´ä¸€å˜´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬æ˜¯è¿™æ ·è®¾è®¡ key çš„ï¼š è¡¨å:åˆ—å:ä¸»é”®å:ä¸»é”®å€¼ ã€‚\nå¦‚æœç”¨ Java ä»£ç å±•ç¤ºçš„è¯ï¼Œå·®ä¸å¤šæ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š\npublic Object getObjectInclNullById(Integer id) { // ä»ç¼“å­˜ä¸­è·å–æ•°æ® Object cacheValue = cache.get(id); // ç¼“å­˜ä¸ºç©º if (cacheValue == null) { // ä»æ•°æ®åº“ä¸­è·å– Object storageValue = storage.get(key); // ç¼“å­˜ç©ºå¯¹è±¡ cache.set(key, storageValue); // å¦‚æœå­˜å‚¨æ•°æ®ä¸ºç©ºï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´(300ç§’) if (storageValue == null) { // å¿…é¡»è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¦åˆ™æœ‰è¢«æ”»å‡»çš„é£é™© cache.expire(key, 60 * 5); } return storageValue; } return cacheValue; } 2ï¼‰å¸ƒéš†è¿‡æ»¤å™¨\nå¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ä¸ªéå¸¸ç¥å¥‡çš„æ•°æ®ç»“æ„ï¼Œé€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿åœ°åˆ¤æ–­ä¸€ä¸ªç»™å®šæ•°æ®æ˜¯å¦å­˜åœ¨äºæµ·é‡æ•°æ®ä¸­ã€‚æˆ‘ä»¬éœ€è¦çš„å°±æ˜¯åˆ¤æ–­ key æ˜¯å¦åˆæ³•ï¼Œæœ‰æ²¡æœ‰æ„Ÿè§‰å¸ƒéš†è¿‡æ»¤å™¨å°±æ˜¯æˆ‘ä»¬æƒ³è¦æ‰¾çš„é‚£ä¸ªâ€œäººâ€ã€‚\nå…·ä½“æ˜¯è¿™æ ·åšçš„ï¼šæŠŠæ‰€æœ‰å¯èƒ½å­˜åœ¨çš„è¯·æ±‚çš„å€¼éƒ½å­˜æ”¾åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå½“ç”¨æˆ·è¯·æ±‚è¿‡æ¥ï¼Œå…ˆåˆ¤æ–­ç”¨æˆ·å‘æ¥çš„è¯·æ±‚çš„å€¼æ˜¯å¦å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚ä¸å­˜åœ¨çš„è¯ï¼Œç›´æ¥è¿”å›è¯·æ±‚å‚æ•°é”™è¯¯ä¿¡æ¯ç»™å®¢æˆ·ç«¯ï¼Œå­˜åœ¨çš„è¯æ‰ä¼šèµ°ä¸‹é¢çš„æµç¨‹ã€‚\nåŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨ä¹‹åçš„ç¼“å­˜å¤„ç†æµç¨‹å›¾å¦‚ä¸‹ã€‚\nä½†æ˜¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¸ƒéš†è¿‡æ»¤å™¨å¯èƒ½ä¼šå­˜åœ¨è¯¯åˆ¤çš„æƒ…å†µã€‚æ€»ç»“æ¥è¯´å°±æ˜¯ï¼š å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ å­˜åœ¨ï¼Œå°æ¦‚ç‡ä¼šè¯¯åˆ¤ã€‚å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ ä¸åœ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ ä¸€å®šä¸åœ¨ã€‚\nä¸ºä»€ä¹ˆä¼šå‡ºç°è¯¯åˆ¤çš„æƒ…å†µå‘¢? æˆ‘ä»¬è¿˜è¦ä»å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†æ¥è¯´ï¼\næˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ï¼Œå½“ä¸€ä¸ªå…ƒç´ åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œå“ªäº›æ“ä½œï¼š\nä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„å“ˆå¸Œå‡½æ•°å¯¹å…ƒç´ å€¼è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°å“ˆå¸Œå€¼ï¼ˆæœ‰å‡ ä¸ªå“ˆå¸Œå‡½æ•°å¾—åˆ°å‡ ä¸ªå“ˆå¸Œå€¼ï¼‰ã€‚ æ ¹æ®å¾—åˆ°çš„å“ˆå¸Œå€¼ï¼Œåœ¨ä½æ•°ç»„ä¸­æŠŠå¯¹åº”ä¸‹æ ‡çš„å€¼ç½®ä¸º 1ã€‚ æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œå“ªäº›æ“ä½œï¼š\nå¯¹ç»™å®šå…ƒç´ å†æ¬¡è¿›è¡Œç›¸åŒçš„å“ˆå¸Œè®¡ç®—ï¼› å¾—åˆ°å€¼ä¹‹ååˆ¤æ–­ä½æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯å¦éƒ½ä¸º 1ï¼Œå¦‚æœå€¼éƒ½ä¸º 1ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªå€¼åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªå€¼ä¸ä¸º 1ï¼Œè¯´æ˜è¯¥å…ƒç´ ä¸åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚ ç„¶åï¼Œä¸€å®šä¼šå‡ºç°è¿™æ ·ä¸€ç§æƒ…å†µï¼šä¸åŒçš„å­—ç¬¦ä¸²å¯èƒ½å“ˆå¸Œå‡ºæ¥çš„ä½ç½®ç›¸åŒã€‚ ï¼ˆå¯ä»¥é€‚å½“å¢åŠ ä½æ•°ç»„å¤§å°æˆ–è€…è°ƒæ•´æˆ‘ä»¬çš„å“ˆå¸Œå‡½æ•°æ¥é™ä½æ¦‚ç‡ï¼‰\næ›´å¤šå…³äºå¸ƒéš†è¿‡æ»¤å™¨çš„å†…å®¹å¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡åŸåˆ›ï¼šã€Šä¸äº†è§£å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿä¸€æ–‡ç»™ä½ æ•´çš„æ˜æ˜ç™½ç™½ï¼ã€‹ ï¼Œå¼ºçƒˆæ¨èï¼Œä¸ªäººæ„Ÿè§‰ç½‘ä¸Šåº”è¯¥æ‰¾ä¸åˆ°æ€»ç»“çš„è¿™ä¹ˆæ˜æ˜ç™½ç™½çš„æ–‡ç« äº†ã€‚\nç¼“å­˜å‡»ç©¿ # ä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿ï¼Ÿ # ç¼“å­˜å‡»ç©¿ä¸­ï¼Œè¯·æ±‚çš„ key å¯¹åº”çš„æ˜¯ çƒ­ç‚¹æ•°æ® ï¼Œè¯¥æ•°æ® å­˜åœ¨äºæ•°æ®åº“ä¸­ï¼Œä½†ä¸å­˜åœ¨äºç¼“å­˜ä¸­ï¼ˆé€šå¸¸æ˜¯å› ä¸ºç¼“å­˜ä¸­çš„é‚£ä»½æ•°æ®å·²ç»è¿‡æœŸï¼‰ ã€‚è¿™å°±å¯èƒ½ä¼šå¯¼è‡´ç¬æ—¶å¤§é‡çš„è¯·æ±‚ç›´æ¥æ‰“åˆ°äº†æ•°æ®åº“ä¸Šï¼Œå¯¹æ•°æ®åº“é€ æˆäº†å·¨å¤§çš„å‹åŠ›ï¼Œå¯èƒ½ç›´æ¥å°±è¢«è¿™ä¹ˆå¤šè¯·æ±‚å¼„å®•æœºäº†ã€‚\nä¸¾ä¸ªä¾‹å­ ï¼šç§’æ€è¿›è¡Œè¿‡ç¨‹ä¸­ï¼Œç¼“å­˜ä¸­çš„æŸä¸ªç§’æ€å•†å“çš„æ•°æ®çªç„¶è¿‡æœŸï¼Œè¿™å°±å¯¼è‡´ç¬æ—¶å¤§é‡å¯¹è¯¥å•†å“çš„è¯·æ±‚ç›´æ¥è½åˆ°æ•°æ®åº“ä¸Šï¼Œå¯¹æ•°æ®åº“é€ æˆäº†å·¨å¤§çš„å‹åŠ›ã€‚\næœ‰å“ªäº›è§£å†³åŠæ³•ï¼Ÿ # è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸæˆ–è€…è¿‡æœŸæ—¶é—´æ¯”è¾ƒé•¿ã€‚ é’ˆå¯¹çƒ­ç‚¹æ•°æ®æå‰é¢„çƒ­ï¼Œå°†å…¶å­˜å…¥ç¼“å­˜ä¸­å¹¶è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´æ¯”å¦‚ç§’æ€åœºæ™¯ä¸‹çš„æ•°æ®åœ¨ç§’æ€ç»“æŸä¹‹å‰ä¸è¿‡æœŸã€‚ è¯·æ±‚æ•°æ®åº“å†™æ•°æ®åˆ°ç¼“å­˜ä¹‹å‰ï¼Œå…ˆè·å–äº’æ–¥é”ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªè¯·æ±‚ä¼šè½åˆ°æ•°æ®åº“ä¸Šï¼Œå‡å°‘æ•°æ®åº“çš„å‹åŠ›ã€‚ ç¼“å­˜ç©¿é€å’Œç¼“å­˜å‡»ç©¿æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ # ç¼“å­˜ç©¿é€ä¸­ï¼Œè¯·æ±‚çš„ key æ—¢ä¸å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œä¹Ÿä¸å­˜åœ¨äºæ•°æ®åº“ä¸­ã€‚\nç¼“å­˜å‡»ç©¿ä¸­ï¼Œè¯·æ±‚çš„ key å¯¹åº”çš„æ˜¯ çƒ­ç‚¹æ•°æ® ï¼Œè¯¥æ•°æ® å­˜åœ¨äºæ•°æ®åº“ä¸­ï¼Œä½†ä¸å­˜åœ¨äºç¼“å­˜ä¸­ï¼ˆé€šå¸¸æ˜¯å› ä¸ºç¼“å­˜ä¸­çš„é‚£ä»½æ•°æ®å·²ç»è¿‡æœŸï¼‰ ã€‚\nç¼“å­˜é›ªå´© # ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ # æˆ‘å‘ç°ç¼“å­˜é›ªå´©è¿™åå­—èµ·çš„æœ‰ç‚¹æ„æ€ï¼Œå“ˆå“ˆã€‚\nå®é™…ä¸Šï¼Œç¼“å­˜é›ªå´©æè¿°çš„å°±æ˜¯è¿™æ ·ä¸€ä¸ªç®€å•çš„åœºæ™¯ï¼šç¼“å­˜åœ¨åŒä¸€æ—¶é—´å¤§é¢ç§¯çš„å¤±æ•ˆï¼Œå¯¼è‡´å¤§é‡çš„è¯·æ±‚éƒ½ç›´æ¥è½åˆ°äº†æ•°æ®åº“ä¸Šï¼Œå¯¹æ•°æ®åº“é€ æˆäº†å·¨å¤§çš„å‹åŠ›ã€‚ è¿™å°±å¥½æ¯”é›ªå´©ä¸€æ ·ï¼Œæ‘§æ¯æ‹‰æœ½ä¹‹åŠ¿ï¼Œæ•°æ®åº“çš„å‹åŠ›å¯æƒ³è€ŒçŸ¥ï¼Œå¯èƒ½ç›´æ¥å°±è¢«è¿™ä¹ˆå¤šè¯·æ±‚å¼„å®•æœºäº†ã€‚\nå¦å¤–ï¼Œç¼“å­˜æœåŠ¡å®•æœºä¹Ÿä¼šå¯¼è‡´ç¼“å­˜é›ªå´©ç°è±¡ï¼Œå¯¼è‡´æ‰€æœ‰çš„è¯·æ±‚éƒ½è½åˆ°äº†æ•°æ®åº“ä¸Šã€‚\nä¸¾ä¸ªä¾‹å­ ï¼šæ•°æ®åº“ä¸­çš„å¤§é‡æ•°æ®åœ¨åŒä¸€æ—¶é—´è¿‡æœŸï¼Œè¿™ä¸ªæ—¶å€™çªç„¶æœ‰å¤§é‡çš„è¯·æ±‚éœ€è¦è®¿é—®è¿™äº›è¿‡æœŸçš„æ•°æ®ã€‚è¿™å°±å¯¼è‡´å¤§é‡çš„è¯·æ±‚ç›´æ¥è½åˆ°æ•°æ®åº“ä¸Šï¼Œå¯¹æ•°æ®åº“é€ æˆäº†å·¨å¤§çš„å‹åŠ›ã€‚\næœ‰å“ªäº›è§£å†³åŠæ³•ï¼Ÿ # é’ˆå¯¹ Redis æœåŠ¡ä¸å¯ç”¨çš„æƒ…å†µï¼š\né‡‡ç”¨ Redis é›†ç¾¤ï¼Œé¿å…å•æœºå‡ºç°é—®é¢˜æ•´ä¸ªç¼“å­˜æœåŠ¡éƒ½æ²¡åŠæ³•ä½¿ç”¨ã€‚ é™æµï¼Œé¿å…åŒæ—¶å¤„ç†å¤§é‡çš„è¯·æ±‚ã€‚ é’ˆå¯¹çƒ­ç‚¹ç¼“å­˜å¤±æ•ˆçš„æƒ…å†µï¼š\nè®¾ç½®ä¸åŒçš„å¤±æ•ˆæ—¶é—´æ¯”å¦‚éšæœºè®¾ç½®ç¼“å­˜çš„å¤±æ•ˆæ—¶é—´ã€‚ ç¼“å­˜æ°¸ä¸å¤±æ•ˆï¼ˆä¸å¤ªæ¨èï¼Œå®ç”¨æ€§å¤ªå·®ï¼‰ã€‚ è®¾ç½®äºŒçº§ç¼“å­˜ã€‚ ç¼“å­˜é›ªå´©å’Œç¼“å­˜å‡»ç©¿æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ # ç¼“å­˜é›ªå´©å’Œç¼“å­˜å‡»ç©¿æ¯”è¾ƒåƒï¼Œä½†ç¼“å­˜é›ªå´©å¯¼è‡´çš„åŸå› æ˜¯ç¼“å­˜ä¸­çš„å¤§é‡æˆ–è€…æ‰€æœ‰æ•°æ®å¤±æ•ˆï¼Œç¼“å­˜å‡»ç©¿å¯¼è‡´çš„åŸå› ä¸»è¦æ˜¯æŸä¸ªçƒ­ç‚¹æ•°æ®ä¸å­˜åœ¨äºç¼“å­˜ä¸­ï¼ˆé€šå¸¸æ˜¯å› ä¸ºç¼“å­˜ä¸­çš„é‚£ä»½æ•°æ®å·²ç»è¿‡æœŸï¼‰ã€‚\nå¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§ï¼Ÿ # ç»†è¯´çš„è¯å¯ä»¥æ‰¯å¾ˆå¤šï¼Œä½†æ˜¯æˆ‘è§‰å¾—å…¶å®æ²¡å¤ªå¤§å¿…è¦ï¼ˆå°å£° BBï¼šå¾ˆå¤šè§£å†³æ–¹æ¡ˆæˆ‘ä¹Ÿæ²¡å¤ªå¼„æ˜ç™½ï¼‰ã€‚æˆ‘ä¸ªäººè§‰å¾—å¼•å…¥ç¼“å­˜ä¹‹åï¼Œå¦‚æœä¸ºäº†çŸ­æ—¶é—´çš„ä¸ä¸€è‡´æ€§é—®é¢˜ï¼Œé€‰æ‹©è®©ç³»ç»Ÿè®¾è®¡å˜å¾—æ›´åŠ å¤æ‚çš„è¯ï¼Œå®Œå…¨æ²¡å¿…è¦ã€‚\nä¸‹é¢å•ç‹¬å¯¹ Cache Aside Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰ æ¥èŠèŠã€‚\nCache Aside Pattern ä¸­é‡åˆ°å†™è¯·æ±‚æ˜¯è¿™æ ·çš„ï¼šæ›´æ–° DBï¼Œç„¶åç›´æ¥åˆ é™¤ cache ã€‚\nå¦‚æœæ›´æ–°æ•°æ®åº“æˆåŠŸï¼Œè€Œåˆ é™¤ç¼“å­˜è¿™ä¸€æ­¥å¤±è´¥çš„æƒ…å†µçš„è¯ï¼Œç®€å•è¯´ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆï¼š\nç¼“å­˜å¤±æ•ˆæ—¶é—´å˜çŸ­ï¼ˆä¸æ¨èï¼Œæ²»æ ‡ä¸æ²»æœ¬ï¼‰ ï¼šæˆ‘ä»¬è®©ç¼“å­˜æ•°æ®çš„è¿‡æœŸæ—¶é—´å˜çŸ­ï¼Œè¿™æ ·çš„è¯ç¼“å­˜å°±ä¼šä»æ•°æ®åº“ä¸­åŠ è½½æ•°æ®ã€‚å¦å¤–ï¼Œè¿™ç§è§£å†³åŠæ³•å¯¹äºå…ˆæ“ä½œç¼“å­˜åæ“ä½œæ•°æ®åº“çš„åœºæ™¯ä¸é€‚ç”¨ã€‚ å¢åŠ  cache æ›´æ–°é‡è¯•æœºåˆ¶ï¼ˆå¸¸ç”¨ï¼‰ï¼š å¦‚æœ cache æœåŠ¡å½“å‰ä¸å¯ç”¨å¯¼è‡´ç¼“å­˜åˆ é™¤å¤±è´¥çš„è¯ï¼Œæˆ‘ä»¬å°±éš”ä¸€æ®µæ—¶é—´è¿›è¡Œé‡è¯•ï¼Œé‡è¯•æ¬¡æ•°å¯ä»¥è‡ªå·±å®šã€‚å¦‚æœå¤šæ¬¡é‡è¯•è¿˜æ˜¯å¤±è´¥çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå½“å‰æ›´æ–°å¤±è´¥çš„ key å­˜å…¥é˜Ÿåˆ—ä¸­ï¼Œç­‰ç¼“å­˜æœåŠ¡å¯ç”¨ä¹‹åï¼Œå†å°†ç¼“å­˜ä¸­å¯¹åº”çš„ key åˆ é™¤å³å¯ã€‚ ç›¸å…³æ–‡ç« æ¨èï¼šç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§é—®é¢˜ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº† - æ°´æ»´ä¸é“¶å¼¹\nRedis é›†ç¾¤ # Redis Sentinel ï¼š\nä»€ä¹ˆæ˜¯ Sentinelï¼Ÿ æœ‰ä»€ä¹ˆç”¨ï¼Ÿ Sentinel å¦‚ä½•æ£€æµ‹èŠ‚ç‚¹æ˜¯å¦ä¸‹çº¿ï¼Ÿä¸»è§‚ä¸‹çº¿ä¸å®¢è§‚ä¸‹çº¿çš„åŒºåˆ«? Sentinel æ˜¯å¦‚ä½•å®ç°æ•…éšœè½¬ç§»çš„ï¼Ÿ ä¸ºä»€ä¹ˆå»ºè®®éƒ¨ç½²å¤šä¸ª sentinel èŠ‚ç‚¹ï¼ˆå“¨å…µé›†ç¾¤ï¼‰ï¼Ÿ Sentinel å¦‚ä½•é€‰æ‹©å‡ºæ–°çš„ masterï¼ˆé€‰ä¸¾æœºåˆ¶ï¼‰? å¦‚ä½•ä» Sentinel é›†ç¾¤ä¸­é€‰æ‹©å‡º Leader ï¼Ÿ Sentinel å¯ä»¥é˜²æ­¢è„‘è£‚å—ï¼Ÿ Redis Cluster ï¼š\nä¸ºä»€ä¹ˆéœ€è¦ Redis Clusterï¼Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ Redis Cluster æ˜¯å¦‚ä½•åˆ†ç‰‡çš„ï¼Ÿ ä¸ºä»€ä¹ˆ Redis Cluster çš„å“ˆå¸Œæ§½æ˜¯ 16384 ä¸ª? å¦‚ä½•ç¡®å®šç»™å®š key çš„åº”è¯¥åˆ†å¸ƒåˆ°å“ªä¸ªå“ˆå¸Œæ§½ä¸­ï¼Ÿ Redis Cluster æ”¯æŒé‡æ–°åˆ†é…å“ˆå¸Œæ§½å—ï¼Ÿ Redis Cluster æ‰©å®¹ç¼©å®¹æœŸé—´å¯ä»¥æä¾›æœåŠ¡å—ï¼Ÿ Redis Cluster ä¸­çš„èŠ‚ç‚¹æ˜¯æ€ä¹ˆè¿›è¡Œé€šä¿¡çš„ï¼Ÿ å‚è€ƒç­”æ¡ˆ ï¼šRedis é›†ç¾¤è¯¦è§£ï¼ˆä»˜è´¹ï¼‰ã€‚\nå‚è€ƒ # ã€ŠRedis å¼€å‘ä¸è¿ç»´ã€‹ ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹ Redis Transactions : https://redis.io/docs/manual/transactions/ ã€‚ "},{"id":56,"href":"/zh/docs/study/Review/java_guide/database/Redis/ly0705lyredis-questions-01/","title":"redisé¢è¯•é¢˜01","section":"Redis","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nRedis åŸºç¡€ # ä»€ä¹ˆæ˜¯ Redisï¼Ÿ # Redis æ˜¯ä¸€ä¸ªåŸºäº C è¯­è¨€å¼€å‘çš„å¼€æºæ•°æ®åº“ï¼ˆBSD è®¸å¯ï¼‰ï¼Œä¸ä¼ ç»Ÿæ•°æ®åº“ä¸åŒçš„æ˜¯ Redis çš„æ•°æ®æ˜¯å­˜åœ¨å†…å­˜ä¸­çš„ï¼ˆå†…å­˜æ•°æ®åº“ï¼‰ï¼Œè¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œè¢«å¹¿æ³›åº”ç”¨äºç¼“å­˜æ–¹å‘ã€‚å¹¶ä¸”ï¼ŒRedis å­˜å‚¨çš„æ˜¯ KV é”®å€¼å¯¹æ•°æ®ã€‚\nä¸ºäº†æ»¡è¶³ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼ŒRedis å†…ç½®äº†å¤šç§æ•°æ®ç±»å‹å®ç°ï¼ˆæ¯”å¦‚ Stringã€Hashã€ã€Listã€Setã€ã€‘Sorted Setã€Bitmapï¼‰ã€‚å¹¶ä¸”ï¼ŒRedis è¿˜æ”¯æŒäº‹åŠ¡ ã€æŒä¹…åŒ–ã€Lua è„šæœ¬ã€å¤šç§å¼€ç®±å³ç”¨çš„é›†ç¾¤æ–¹æ¡ˆï¼ˆRedis Sentinelã€Redis Clusterï¼‰ã€‚\nRedis æ²¡æœ‰å¤–éƒ¨ä¾èµ–ï¼ŒLinux å’Œ OS X æ˜¯ Redis å¼€å‘å’Œæµ‹è¯•æœ€å¤šçš„ä¸¤ä¸ªæ“ä½œç³»ç»Ÿï¼Œå®˜æ–¹æ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Linux éƒ¨ç½² Redisã€‚\nä¸ªäººå­¦ä¹ çš„è¯ï¼Œä½ å¯ä»¥è‡ªå·±æœ¬æœºå®‰è£… Redis æˆ–è€…é€šè¿‡ Redis å®˜ç½‘æä¾›çš„åœ¨çº¿ Redis ç¯å¢ƒæ¥å®é™…ä½“éªŒ Redisã€‚\nå…¨ä¸–ç•Œæœ‰éå¸¸å¤šçš„ç½‘ç«™ä½¿ç”¨åˆ°äº† Redis ï¼Œtechstacks.io ä¸“é—¨ç»´æŠ¤äº†ä¸€ä¸ªä½¿ç”¨ Redis çš„çƒ­é—¨ç«™ç‚¹åˆ—è¡¨ ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥çœ‹çœ‹ã€‚\nRedis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ # Redis å†…éƒ¨åšäº†éå¸¸å¤šçš„æ€§èƒ½ä¼˜åŒ–ï¼Œæ¯”è¾ƒé‡è¦çš„ä¸»è¦æœ‰ä¸‹é¢ 3 ç‚¹ï¼š\nRedis åŸºäºå†…å­˜ï¼Œå†…å­˜çš„è®¿é—®é€Ÿåº¦æ˜¯ç£ç›˜çš„ä¸Šåƒå€ï¼› Redis åŸºäº Reactor æ¨¡å¼è®¾è®¡å¼€å‘äº†ä¸€å¥—é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å‹ï¼Œä¸»è¦æ˜¯å•çº¿ç¨‹äº‹ä»¶å¾ªç¯å’Œ IO å¤šè·¯å¤ç”¨ï¼ˆRedis çº¿ç¨‹æ¨¡å¼åé¢ä¼šè¯¦ç»†ä»‹ç»åˆ°ï¼‰ï¼› Redis å†…ç½®äº†å¤šç§ä¼˜åŒ–è¿‡åçš„æ•°æ®ç»“æ„å®ç°ï¼Œæ€§èƒ½éå¸¸é«˜ã€‚ ä¸‹é¢è¿™å¼ å›¾ç‰‡æ€»ç»“çš„æŒºä¸é”™çš„ï¼Œåˆ†äº«ä¸€ä¸‹ï¼Œå‡ºè‡ª Why is Redis so fast? ã€‚\nåˆ†å¸ƒå¼ç¼“å­˜å¸¸è§çš„æŠ€æœ¯é€‰å‹æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ # åˆ†å¸ƒå¼ç¼“å­˜çš„è¯ï¼Œæ¯”è¾ƒè€ç‰ŒåŒæ—¶ä¹Ÿæ˜¯ä½¿ç”¨çš„æ¯”è¾ƒå¤šçš„è¿˜æ˜¯ Memcached å’Œ Redisã€‚ä¸è¿‡ï¼Œç°åœ¨åŸºæœ¬æ²¡æœ‰çœ‹è¿‡è¿˜æœ‰é¡¹ç›®ä½¿ç”¨ Memcached æ¥åšç¼“å­˜ï¼Œéƒ½æ˜¯ç›´æ¥ç”¨ Redisã€‚\nMemcached æ˜¯åˆ†å¸ƒå¼ç¼“å­˜æœ€å¼€å§‹å…´èµ·çš„é‚£ä¼šï¼Œæ¯”è¾ƒå¸¸ç”¨çš„ã€‚åæ¥ï¼Œéšç€ Redis çš„å‘å±•ï¼Œå¤§å®¶æ…¢æ…¢éƒ½è½¬è€Œä½¿ç”¨æ›´åŠ å¼ºå¤§çš„ Redis äº†ã€‚\nå¦å¤–ï¼Œè…¾è®¯ä¹Ÿå¼€æºäº†ä¸€æ¬¾ç±»ä¼¼äº Redis çš„åˆ†å¸ƒå¼é«˜æ€§èƒ½ KV å­˜å‚¨æ•°æ®åº“ï¼ŒåŸºäºçŸ¥åçš„å¼€æºé¡¹ç›® RocksDB ä½œä¸ºå­˜å‚¨å¼•æ“ ï¼Œ100% å…¼å®¹ Redis åè®®å’Œ Redis4.0 æ‰€æœ‰æ•°æ®æ¨¡å‹ï¼Œåä¸º Tendis ï¼ˆè…¾è®¯çš„ï¼‰ã€‚\nå…³äº Redis å’Œ Tendis çš„å¯¹æ¯”ï¼Œè…¾è®¯å®˜æ–¹æ›¾ç»å‘è¿‡ä¸€ç¯‡æ–‡ç« ï¼šRedis vs Tendisï¼šå†·çƒ­æ··åˆå­˜å‚¨ç‰ˆæ¶æ„æ­ç§˜ ï¼Œå¯ä»¥ç®€å•å‚è€ƒä¸€ä¸‹ã€‚\nä»è¿™ä¸ªé¡¹ç›®çš„ Github æäº¤è®°å½•å¯ä»¥çœ‹å‡ºï¼ŒTendis å¼€æºç‰ˆå‡ ä¹å·²ç»æ²¡æœ‰è¢«ç»´æŠ¤æ›´æ–°äº†ï¼ŒåŠ ä¸Šå…¶å…³æ³¨åº¦å¹¶ä¸é«˜ï¼Œä½¿ç”¨çš„å…¬å¸ä¹Ÿæ¯”è¾ƒå°‘ã€‚å› æ­¤ï¼Œä¸å»ºè®®ä½ ä½¿ç”¨ Tendis æ¥å®ç°åˆ†å¸ƒå¼ç¼“å­˜ã€‚\nè¯´ä¸€ä¸‹ Redis å’Œ Memcached çš„åŒºåˆ«å’Œå…±åŒç‚¹ # ç°åœ¨å…¬å¸ä¸€èˆ¬éƒ½æ˜¯ç”¨ Redis æ¥å®ç°ç¼“å­˜ï¼Œè€Œä¸” Redis è‡ªèº«ä¹Ÿè¶Šæ¥è¶Šå¼ºå¤§äº†ï¼ä¸è¿‡ï¼Œäº†è§£ Redis å’Œ Memcached çš„åŒºåˆ«å’Œå…±åŒç‚¹ï¼Œæœ‰åŠ©äºæˆ‘ä»¬åœ¨åšç›¸åº”çš„æŠ€æœ¯é€‰å‹çš„æ—¶å€™ï¼Œèƒ½å¤Ÿåšåˆ°æœ‰ç†æœ‰æ®ï¼\nå…±åŒç‚¹ ï¼š\néƒ½æ˜¯åŸºäºå†…å­˜çš„æ•°æ®åº“ï¼Œä¸€èˆ¬éƒ½ç”¨æ¥å½“åšç¼“å­˜ä½¿ç”¨ã€‚ éƒ½æœ‰è¿‡æœŸç­–ç•¥ã€‚ ä¸¤è€…çš„æ€§èƒ½éƒ½éå¸¸é«˜ã€‚ åŒºåˆ« ï¼š\nRedis æ”¯æŒæ›´ä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼ˆæ”¯æŒæ›´å¤æ‚çš„åº”ç”¨åœºæ™¯ï¼‰ã€‚Redis ä¸ä»…ä»…æ”¯æŒç®€å•ï¼ˆstringï¼‰çš„ k/v ç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜æä¾› listï¼Œsetï¼Œzsetï¼Œhash ç­‰æ•°æ®ç»“æ„çš„å­˜å‚¨ã€‚Memcached åªæ”¯æŒæœ€ç®€å•çš„ k/v æ•°æ®ç±»å‹ã€‚\nRedis æ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿æŒåœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨,è€Œ Memcached æŠŠæ•°æ®å…¨éƒ¨å­˜åœ¨å†…å­˜ä¹‹ä¸­ã€‚\nRedis æœ‰ç¾éš¾æ¢å¤æœºåˆ¶ã€‚ å› ä¸ºå¯ä»¥æŠŠç¼“å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šã€‚\nRedis åœ¨æœåŠ¡å™¨å†…å­˜ä½¿ç”¨å®Œä¹‹åï¼Œå¯ä»¥å°†ä¸ç”¨çš„æ•°æ®æ”¾åˆ°ç£ç›˜ä¸Šã€‚ä½†æ˜¯ï¼ŒMemcached åœ¨æœåŠ¡å™¨å†…å­˜ä½¿ç”¨å®Œä¹‹åï¼Œå°±ä¼šç›´æ¥æŠ¥å¼‚å¸¸ã€‚\nMemcached æ²¡æœ‰åŸç”Ÿçš„é›†ç¾¤æ¨¡å¼ï¼Œéœ€è¦ä¾é å®¢æˆ·ç«¯æ¥å®ç°å¾€é›†ç¾¤ä¸­åˆ†ç‰‡å†™å…¥æ•°æ®ï¼›ä½†æ˜¯ Redis ç›®å‰æ˜¯åŸç”Ÿæ”¯æŒ cluster æ¨¡å¼çš„ã€‚\nMemcached æ˜¯å¤šçº¿ç¨‹ï¼Œéé˜»å¡ IO å¤ç”¨çš„ç½‘ç»œæ¨¡å‹ï¼›Redis ä½¿ç”¨å•çº¿ç¨‹çš„å¤šè·¯ IO å¤ç”¨æ¨¡å‹ã€‚ ï¼ˆRedis 6.0 å¼•å…¥äº†å¤šçº¿ç¨‹ IO ï¼‰\néé˜»å¡çš„ IOå¤ç”¨\nå•çº¿ç¨‹çš„å¤šè·¯IOå¤ç”¨\nRedis æ”¯æŒå‘å¸ƒè®¢é˜…æ¨¡å‹ã€Lua è„šæœ¬ã€äº‹åŠ¡ç­‰åŠŸèƒ½ï¼Œè€Œ Memcached ä¸æ”¯æŒã€‚å¹¶ä¸”ï¼ŒRedis æ”¯æŒæ›´å¤šçš„ç¼–ç¨‹è¯­è¨€ã€‚\nMemcached è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥åªç”¨äº†æƒ°æ€§åˆ é™¤ï¼Œè€Œ Redis åŒæ—¶ä½¿ç”¨äº†æƒ°æ€§åˆ é™¤ä¸å®šæœŸåˆ é™¤ã€‚\nç›¸ä¿¡çœ‹äº†ä¸Šé¢çš„å¯¹æ¯”ä¹‹åï¼Œæˆ‘ä»¬å·²ç»æ²¡æœ‰ä»€ä¹ˆç†ç”±å¯ä»¥é€‰æ‹©ä½¿ç”¨ Memcached æ¥ä½œä¸ºè‡ªå·±é¡¹ç›®çš„åˆ†å¸ƒå¼ç¼“å­˜äº†ã€‚\nä¸ºä»€ä¹ˆè¦ç”¨ Redis/ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜ï¼Ÿ # ä¸‹é¢æˆ‘ä»¬ä¸»è¦ä»â€œé«˜æ€§èƒ½â€å’Œâ€œé«˜å¹¶å‘â€è¿™ä¸¤ç‚¹æ¥å›ç­”è¿™ä¸ªé—®é¢˜ã€‚\né«˜æ€§èƒ½\nå‡å¦‚ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®æ•°æ®åº“ä¸­çš„æŸäº›æ•°æ®çš„è¯ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯æ¯”è¾ƒæ…¢ï¼Œæ¯•ç«Ÿæ˜¯ä»ç¡¬ç›˜ä¸­è¯»å–çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¯´ï¼Œç”¨æˆ·è®¿é—®çš„æ•°æ®å±äºé«˜é¢‘æ•°æ®å¹¶ä¸”ä¸ä¼šç»å¸¸æ”¹å˜çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¾ˆæ”¾å¿ƒåœ°å°†è¯¥ç”¨æˆ·è®¿é—®çš„æ•°æ®å­˜åœ¨ç¼“å­˜ä¸­ã€‚\nè¿™æ ·æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ é‚£å°±æ˜¯ä¿è¯ç”¨æˆ·ä¸‹ä¸€æ¬¡å†è®¿é—®è¿™äº›æ•°æ®çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­è·å–äº†ã€‚æ“ä½œç¼“å­˜å°±æ˜¯ç›´æ¥æ“ä½œå†…å­˜ï¼Œæ‰€ä»¥é€Ÿåº¦ç›¸å½“å¿«ã€‚\né«˜å¹¶å‘\nä¸€èˆ¬åƒ MySQL è¿™ç±»çš„æ•°æ®åº“çš„ QPS å¤§æ¦‚éƒ½åœ¨ 1w å·¦å³ï¼ˆ4 æ ¸ 8gï¼‰ ï¼Œä½†æ˜¯ä½¿ç”¨ Redis ç¼“å­˜ä¹‹åå¾ˆå®¹æ˜“è¾¾åˆ° 10w+ï¼Œç”šè‡³æœ€é«˜èƒ½è¾¾åˆ° 30w+ï¼ˆå°±å•æœº Redis çš„æƒ…å†µï¼ŒRedis é›†ç¾¤çš„è¯ä¼šæ›´é«˜ï¼‰ã€‚\nQPSï¼ˆQuery Per Secondï¼‰ï¼šæœåŠ¡å™¨æ¯ç§’å¯ä»¥æ‰§è¡Œçš„æŸ¥è¯¢æ¬¡æ•°ï¼›\nç”±æ­¤å¯è§ï¼Œç›´æ¥æ“ä½œç¼“å­˜èƒ½å¤Ÿæ‰¿å—çš„æ•°æ®åº“è¯·æ±‚æ•°é‡æ˜¯è¿œè¿œå¤§äºç›´æ¥è®¿é—®æ•°æ®åº“çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘æŠŠæ•°æ®åº“ä¸­çš„éƒ¨åˆ†æ•°æ®è½¬ç§»åˆ°ç¼“å­˜ä¸­å»ï¼Œè¿™æ ·ç”¨æˆ·çš„ä¸€éƒ¨åˆ†è¯·æ±‚ä¼šç›´æ¥åˆ°ç¼“å­˜è¿™é‡Œè€Œä¸ç”¨ç»è¿‡æ•°æ®åº“ã€‚è¿›è€Œï¼Œæˆ‘ä»¬ä¹Ÿå°±æé«˜äº†ç³»ç»Ÿæ•´ä½“çš„å¹¶å‘ã€‚\nRedis é™¤äº†åšç¼“å­˜ï¼Œè¿˜èƒ½åšä»€ä¹ˆï¼Ÿ # åˆ†å¸ƒå¼é” ï¼š é€šè¿‡ Redis æ¥åšåˆ†å¸ƒå¼é”æ˜¯ä¸€ç§æ¯”è¾ƒå¸¸è§çš„æ–¹å¼ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯åŸºäº Redisson æ¥å®ç°åˆ†å¸ƒå¼é”ã€‚å…³äº Redis å®ç°åˆ†å¸ƒå¼é”çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥çœ‹æˆ‘å†™çš„è¿™ç¯‡æ–‡ç« ï¼šåˆ†å¸ƒå¼é”è¯¦è§£ ã€‚ é™æµ ï¼šä¸€èˆ¬æ˜¯é€šè¿‡ Redis + Lua è„šæœ¬çš„æ–¹å¼æ¥å®ç°é™æµã€‚ç›¸å…³é˜…è¯»ï¼šã€Šæˆ‘å¸ç”¨äº† 6 å¹´çš„ Redis åˆ†å¸ƒå¼é™æµå™¨ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸å‰å®³äº†ï¼ã€‹ã€‚ æ¶ˆæ¯é˜Ÿåˆ— ï¼šRedis è‡ªå¸¦çš„ list æ•°æ®ç»“æ„å¯ä»¥ä½œä¸ºä¸€ä¸ªç®€å•çš„é˜Ÿåˆ—ä½¿ç”¨ã€‚Redis 5.0 ä¸­å¢åŠ çš„ Stream ç±»å‹çš„æ•°æ®ç»“æ„æ›´åŠ é€‚åˆç”¨æ¥åšæ¶ˆæ¯é˜Ÿåˆ—ã€‚å®ƒæ¯”è¾ƒç±»ä¼¼äº Kafkaï¼Œæœ‰ä¸»é¢˜å’Œæ¶ˆè´¹ç»„çš„æ¦‚å¿µï¼Œæ”¯æŒæ¶ˆæ¯æŒä¹…åŒ–ä»¥åŠ ACK æœºåˆ¶ã€‚ å¤æ‚ä¸šåŠ¡åœºæ™¯ ï¼šé€šè¿‡ Redis ä»¥åŠ Redis æ‰©å±•ï¼ˆæ¯”å¦‚ Redissonï¼‰æä¾›çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®Œæˆå¾ˆå¤šå¤æ‚çš„ä¸šåŠ¡åœºæ™¯æ¯”å¦‚é€šè¿‡ bitmap ç»Ÿè®¡æ´»è·ƒç”¨æˆ·ã€é€šè¿‡ sorted set ç»´æŠ¤æ’è¡Œæ¦œã€‚ \u0026hellip;\u0026hellip; Redis å¯ä»¥åšæ¶ˆæ¯é˜Ÿåˆ—ä¹ˆï¼Ÿ # Redis 5.0 æ–°å¢åŠ çš„ä¸€ä¸ªæ•°æ®ç»“æ„ Stream å¯ä»¥ç”¨æ¥åšæ¶ˆæ¯é˜Ÿåˆ—ï¼ŒStream æ”¯æŒï¼š\nå‘å¸ƒ / è®¢é˜…æ¨¡å¼ æŒ‰ç…§æ¶ˆè´¹è€…ç»„è¿›è¡Œæ¶ˆè´¹ æ¶ˆæ¯æŒä¹…åŒ–ï¼ˆ RDB å’Œ AOFï¼‰ ä¸è¿‡ï¼Œå’Œä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—ç›¸æ¯”ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šæ¬ ç¼ºçš„åœ°æ–¹æ¯”å¦‚æ¶ˆæ¯ä¸¢å¤±å’Œå †ç§¯é—®é¢˜ä¸å¥½è§£å†³ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€šå¸¸å»ºè®®æ˜¯ä¸ä½¿ç”¨ Redis æ¥åšæ¶ˆæ¯é˜Ÿåˆ—çš„ï¼Œä½ å®Œå…¨å¯ä»¥é€‰æ‹©å¸‚é¢ä¸Šæ¯”è¾ƒæˆç†Ÿçš„ä¸€äº›æ¶ˆæ¯é˜Ÿåˆ—æ¯”å¦‚ RocketMQã€Kafkaã€‚\nç›¸å…³æ–‡ç« æ¨èï¼šRedis æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸‰ç§æ–¹æ¡ˆï¼ˆListã€Streamsã€Pub/Subï¼‰ã€‚\nå¦‚ä½•åŸºäº Redis å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ # å…³äº Redis å®ç°åˆ†å¸ƒå¼é”çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥çœ‹æˆ‘å†™çš„è¿™ç¯‡æ–‡ç« ï¼šåˆ†å¸ƒå¼é”è¯¦è§£ ã€‚\nRedis æ•°æ®ç»“æ„ # Redis å¸¸ç”¨çš„æ•°æ®ç»“æ„æœ‰å“ªäº›ï¼Ÿ # 5 ç§åŸºç¡€æ•°æ®ç»“æ„ ï¼šStringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€Listï¼ˆåˆ—è¡¨ï¼‰ã€Setï¼ˆé›†åˆï¼‰ã€Hashï¼ˆæ•£åˆ—ï¼‰ã€Zsetï¼ˆæœ‰åºé›†åˆï¼‰ã€‚ 3 ç§ç‰¹æ®Šæ•°æ®ç»“æ„ ï¼šHyperLogLogsï¼ˆåŸºæ•°ç»Ÿè®¡ï¼‰ã€Bitmap ï¼ˆä½å­˜å‚¨ï¼‰ã€Geospatial (åœ°ç†ä½ç½®)ã€‚ å…³äº 5 ç§åŸºç¡€æ•°æ®ç»“æ„çš„è¯¦ç»†ä»‹ç»è¯·çœ‹è¿™ç¯‡æ–‡ç« ï¼šRedis 5 ç§åŸºæœ¬æ•°æ®ç»“æ„è¯¦è§£ã€‚\nå…³äº 3 ç§ç‰¹æ®Šæ•°æ®ç»“æ„çš„è¯¦ç»†ä»‹ç»è¯·çœ‹è¿™ç¯‡æ–‡ç« ï¼šRedis 3 ç§ç‰¹æ®Šæ•°æ®ç»“æ„è¯¦è§£ã€‚\nString çš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ # å¸¸è§„æ•°æ®ï¼ˆæ¯”å¦‚ sessionã€tokenã€ã€åºåˆ—åŒ–åçš„å¯¹è±¡ï¼‰çš„ç¼“å­˜ï¼› è®¡æ•°æ¯”å¦‚ç”¨æˆ·å•ä½æ—¶é—´çš„è¯·æ±‚æ•°ï¼ˆç®€å•é™æµå¯ä»¥ç”¨åˆ°ï¼‰ã€é¡µé¢å•ä½æ—¶é—´çš„è®¿é—®æ•°ï¼› åˆ†å¸ƒå¼é”(åˆ©ç”¨ SETNX key value å‘½ä»¤å¯ä»¥å®ç°ä¸€ä¸ªæœ€ç®€æ˜“çš„åˆ†å¸ƒå¼é”)ï¼› \u0026hellip;\u0026hellip; å…³äº String çš„è¯¦ç»†ä»‹ç»è¯·çœ‹è¿™ç¯‡æ–‡ç« ï¼šRedis 5 ç§åŸºæœ¬æ•°æ®ç»“æ„è¯¦è§£ã€‚\nString è¿˜æ˜¯ Hash å­˜å‚¨å¯¹è±¡æ•°æ®æ›´å¥½å‘¢ï¼Ÿ # String å­˜å‚¨çš„æ˜¯åºåˆ—åŒ–åçš„å¯¹è±¡æ•°æ®ï¼Œå­˜æ”¾çš„æ˜¯æ•´ä¸ªå¯¹è±¡ã€‚Hash æ˜¯å¯¹å¯¹è±¡çš„æ¯ä¸ªå­—æ®µå•ç‹¬å­˜å‚¨ï¼Œå¯ä»¥è·å–éƒ¨åˆ†å­—æ®µçš„ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹æˆ–è€…æ·»åŠ éƒ¨åˆ†å­—æ®µï¼ŒèŠ‚çœç½‘ç»œæµé‡ã€‚å¦‚æœå¯¹è±¡ä¸­æŸäº›å­—æ®µéœ€è¦ç»å¸¸å˜åŠ¨æˆ–è€…ç»å¸¸éœ€è¦å•ç‹¬æŸ¥è¯¢å¯¹è±¡ä¸­çš„ä¸ªåˆ«å­—æ®µä¿¡æ¯ï¼ŒHash å°±éå¸¸é€‚åˆã€‚ String å­˜å‚¨ç›¸å¯¹æ¥è¯´æ›´åŠ èŠ‚çœå†…å­˜ï¼Œç¼“å­˜ç›¸åŒæ•°é‡çš„å¯¹è±¡æ•°æ®ï¼ŒString æ¶ˆè€—çš„å†…å­˜çº¦æ˜¯ Hash çš„ä¸€åŠã€‚å¹¶ä¸”ï¼Œå­˜å‚¨å…·æœ‰å¤šå±‚åµŒå¥—çš„å¯¹è±¡æ—¶ä¹Ÿæ–¹ä¾¿å¾ˆå¤šã€‚å¦‚æœç³»ç»Ÿå¯¹æ€§èƒ½å’Œèµ„æºæ¶ˆè€—éå¸¸æ•æ„Ÿçš„è¯ï¼ŒString å°±éå¸¸é€‚åˆã€‚ åœ¨ç»å¤§éƒ¨åˆ†æƒ…å†µï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ String æ¥å­˜å‚¨å¯¹è±¡æ•°æ®å³å¯ï¼\nString çš„åº•å±‚å®ç°æ˜¯ä»€ä¹ˆï¼Ÿ # Redis æ˜¯åŸºäº C è¯­è¨€ç¼–å†™çš„ï¼Œä½† Redis çš„ String ç±»å‹çš„åº•å±‚å®ç°å¹¶ä¸æ˜¯ C è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²ï¼ˆå³ä»¥ç©ºå­—ç¬¦ \\0 ç»“å°¾çš„å­—ç¬¦æ•°ç»„ï¼‰ï¼Œè€Œæ˜¯è‡ªå·±ç¼–å†™äº† SDSï¼ˆSimple Dynamic Stringï¼Œç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼‰ æ¥ä½œä¸ºåº•å±‚å®ç°ã€‚\n[daÉªËˆnÃ¦mÉªk] åŠ¨æ€çš„\nSDS æœ€æ—©æ˜¯ Redis ä½œè€…ä¸ºæ—¥å¸¸ C è¯­è¨€å¼€å‘è€Œè®¾è®¡çš„ C å­—ç¬¦ä¸²ï¼Œåæ¥è¢«åº”ç”¨åˆ°äº† Redis ä¸Šï¼Œå¹¶ç»è¿‡äº†å¤§é‡çš„ä¿®æ”¹å®Œå–„ä»¥é€‚åˆé«˜æ€§èƒ½æ“ä½œã€‚\nRedis7.0 çš„ SDS çš„éƒ¨åˆ†æºç å¦‚ä¸‹ï¼ˆhttps://github.com/redis/redis/blob/7.0/src/sds.hï¼‰ï¼š\n/* Note: sdshdr5 is never used, we just access the flags byte directly. * However is here to document the layout of type 5 SDS strings. */ struct __attribute__ ((__packed__)) sdshdr5 { unsigned char flags; /* 3 lsb of type, and 5 msb of string length */ char buf[]; }; struct __attribute__ ((__packed__)) sdshdr8 { uint8_t len; /* used */ uint8_t alloc; /* excluding the header and null terminator */ unsigned char flags; /* 3 lsb of type, 5 unused bits */ char buf[]; }; struct __attribute__ ((__packed__)) sdshdr16 { uint16_t len; /* used */ uint16_t alloc; /* excluding the header and null terminator */ unsigned char flags; /* 3 lsb of type, 5 unused bits */ char buf[]; }; struct __attribute__ ((__packed__)) sdshdr32 { uint32_t len; /* used */ uint32_t alloc; /* excluding the header and null terminator */ unsigned char flags; /* 3 lsb of type, 5 unused bits */ char buf[]; }; struct __attribute__ ((__packed__)) sdshdr64 { uint64_t len; /* used */ uint64_t alloc; /* excluding the header and null terminator */ unsigned char flags; /* 3 lsb of type, 5 unused bits */ char buf[]; }; é€šè¿‡æºç å¯ä»¥çœ‹å‡ºï¼ŒSDS å…±æœ‰äº”ç§å®ç°æ–¹å¼ SDS_TYPE_5ï¼ˆå¹¶æœªç”¨åˆ°ï¼‰ã€SDS_TYPE_8ã€SDS_TYPE_16ã€SDS_TYPE_32ã€SDS_TYPE_64ï¼Œå…¶ä¸­åªæœ‰åå››ç§å®é™…ç”¨åˆ°ã€‚Redis ä¼šæ ¹æ®åˆå§‹åŒ–çš„é•¿åº¦å†³å®šä½¿ç”¨å“ªç§ç±»å‹ï¼Œä»è€Œå‡å°‘å†…å­˜çš„ä½¿ç”¨ã€‚\nç±»å‹ å­—èŠ‚ ä½ sdshdr5 \u0026lt; 1 \u0026lt;8 sdshdr8 1 8 sdshdr16 2 16 sdshdr32 4 32 sdshdr64 8 64 å¯¹äºåå››ç§å®ç°éƒ½åŒ…å«äº†ä¸‹é¢è¿™ 4 ä¸ªå±æ€§ï¼š\nlen ï¼šå­—ç¬¦ä¸²çš„é•¿åº¦ä¹Ÿå°±æ˜¯å·²ç»ä½¿ç”¨çš„å­—èŠ‚æ•° allocï¼šæ€»å…±å¯ç”¨çš„å­—ç¬¦ç©ºé—´å¤§å°ï¼Œalloc-len å°±æ˜¯ SDS å‰©ä½™çš„ç©ºé—´å¤§å° buf[] ï¼šå®é™…å­˜å‚¨å­—ç¬¦ä¸²çš„æ•°ç»„ flags ï¼šä½ä¸‰ä½ä¿å­˜ç±»å‹æ ‡å¿— SDS ç›¸æ¯”äº C è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²æœ‰å¦‚ä¸‹æå‡ï¼š\nå¯ä»¥é¿å…ç¼“å†²åŒºæº¢å‡º ï¼šC è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²è¢«ä¿®æ”¹ï¼ˆæ¯”å¦‚æ‹¼æ¥ï¼‰æ—¶ï¼Œä¸€æ—¦æ²¡æœ‰åˆ†é…è¶³å¤Ÿé•¿åº¦çš„å†…å­˜ç©ºé—´ï¼Œå°±ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºã€‚SDS è¢«ä¿®æ”¹æ—¶ï¼Œä¼šå…ˆæ ¹æ® len å±æ€§æ£€æŸ¥ç©ºé—´å¤§å°æ˜¯å¦æ»¡è¶³è¦æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œåˆ™å…ˆæ‰©å±•è‡³æ‰€éœ€å¤§å°å†è¿›è¡Œä¿®æ”¹æ“ä½œã€‚ è·å–å­—ç¬¦ä¸²é•¿åº¦çš„å¤æ‚åº¦è¾ƒä½ ï¼š C è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²çš„é•¿åº¦é€šå¸¸æ˜¯ç»è¿‡éå†è®¡æ•°æ¥å®ç°çš„ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚SDS çš„é•¿åº¦è·å–ç›´æ¥è¯»å– len å±æ€§å³å¯ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚ å‡å°‘å†…å­˜åˆ†é…æ¬¡æ•° ï¼š ä¸ºäº†é¿å…ä¿®æ”¹ï¼ˆå¢åŠ /å‡å°‘ï¼‰å­—ç¬¦ä¸²æ—¶ï¼Œæ¯æ¬¡éƒ½éœ€è¦é‡æ–°åˆ†é…å†…å­˜ï¼ˆC è¯­è¨€çš„å­—ç¬¦ä¸²æ˜¯è¿™æ ·çš„ï¼‰ï¼ŒSDS å®ç°äº†ç©ºé—´é¢„åˆ†é…å’Œæƒ°æ€§ç©ºé—´é‡Šæ”¾ä¸¤ç§ä¼˜åŒ–ç­–ç•¥ã€‚å½“ SDS éœ€è¦å¢åŠ å­—ç¬¦ä¸²æ—¶ï¼ŒRedis ä¼šä¸º SDS åˆ†é…å¥½å†…å­˜ï¼Œå¹¶ä¸”æ ¹æ®ç‰¹å®šçš„ç®—æ³•åˆ†é…å¤šä½™çš„å†…å­˜ï¼Œè¿™æ ·å¯ä»¥å‡å°‘è¿ç»­æ‰§è¡Œå­—ç¬¦ä¸²å¢é•¿æ“ä½œæ‰€éœ€çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°ã€‚å½“ SDS éœ€è¦å‡å°‘å­—ç¬¦ä¸²æ—¶ï¼Œè¿™éƒ¨åˆ†å†…å­˜ä¸ä¼šç«‹å³è¢«å›æ”¶ï¼Œä¼šè¢«è®°å½•ä¸‹æ¥ï¼Œç­‰å¾…åç»­ä½¿ç”¨ï¼ˆæ”¯æŒæ‰‹åŠ¨é‡Šæ”¾ï¼Œæœ‰å¯¹åº”çš„ APIï¼‰ã€‚ äºŒè¿›åˆ¶å®‰å…¨ ï¼šC è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²ä»¥ç©ºå­—ç¬¦ \\0 ä½œä¸ºå­—ç¬¦ä¸²ç»“æŸçš„æ ‡è¯†ï¼Œè¿™å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œåƒä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ¯”å¦‚å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ï¼‰å°±å¯èƒ½åŒ…æ‹¬ç©ºå­—ç¬¦ï¼ŒC å­—ç¬¦ä¸²æ— æ³•æ­£ç¡®ä¿å­˜ã€‚SDS ä½¿ç”¨ len å±æ€§åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç»“æŸï¼Œä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚ å¤šæä¸€å˜´ï¼Œå¾ˆå¤šæ–‡ç« é‡Œ SDS çš„å®šä¹‰æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š\nstruct sdshdr { unsigned int len; unsigned int free; char buf[]; }; è¿™ä¸ªä¹Ÿæ²¡é”™ï¼ŒRedis 3.2 ä¹‹å‰å°±æ˜¯è¿™æ ·å®šä¹‰çš„ã€‚åæ¥ï¼Œç”±äºè¿™ç§æ–¹å¼çš„å®šä¹‰å­˜åœ¨é—®é¢˜ï¼Œlen å’Œ free çš„å®šä¹‰ç”¨äº† 4 ä¸ªå­—èŠ‚ï¼Œé€ æˆäº†æµªè´¹ã€‚Redis 3.2 ä¹‹åï¼ŒRedis æ”¹è¿›äº† SDS çš„å®šä¹‰ï¼Œå°†å…¶åˆ’åˆ†ä¸ºäº†ç°åœ¨çš„ 5 ç§ç±»å‹ã€‚\nè´­ç‰©è½¦ä¿¡æ¯ç”¨ String è¿˜æ˜¯ Hash å­˜å‚¨æ›´å¥½å‘¢? # ç”±äºè´­ç‰©è½¦ä¸­çš„å•†å“é¢‘ç¹ä¿®æ”¹å’Œå˜åŠ¨ï¼Œè´­ç‰©è½¦ä¿¡æ¯å»ºè®®ä½¿ç”¨ Hash å­˜å‚¨ï¼š\nç”¨æˆ· id ä¸º key å•†å“ id ä¸º fieldï¼Œå•†å“æ•°é‡ä¸º value é‚£ç”¨æˆ·è´­ç‰©è½¦ä¿¡æ¯çš„ç»´æŠ¤å…·ä½“åº”è¯¥æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿ\nç”¨æˆ·æ·»åŠ å•†å“å°±æ˜¯å¾€ Hash é‡Œé¢å¢åŠ æ–°çš„ field ä¸ valueï¼› æŸ¥è¯¢è´­ç‰©è½¦ä¿¡æ¯å°±æ˜¯éå†å¯¹åº”çš„ Hashï¼› æ›´æ”¹å•†å“æ•°é‡ç›´æ¥ä¿®æ”¹å¯¹åº”çš„ value å€¼ï¼ˆç›´æ¥ set æˆ–è€…åšè¿ç®—çš†å¯ï¼‰ï¼› åˆ é™¤å•†å“å°±æ˜¯åˆ é™¤ Hash ä¸­å¯¹åº”çš„ fieldï¼› æ¸…ç©ºè´­ç‰©è½¦ç›´æ¥åˆ é™¤å¯¹åº”çš„ key å³å¯ã€‚ è¿™é‡Œåªæ˜¯ä»¥ä¸šåŠ¡æ¯”è¾ƒç®€å•çš„è´­ç‰©è½¦åœºæ™¯ä¸¾ä¾‹ï¼Œå®é™…ç”µå•†åœºæ™¯ä¸‹ï¼Œfield åªä¿å­˜ä¸€ä¸ªå•†å“ id æ˜¯æ²¡åŠæ³•æ»¡è¶³éœ€æ±‚çš„ã€‚\nä½¿ç”¨ Redis å®ç°ä¸€ä¸ªæ’è¡Œæ¦œæ€ä¹ˆåšï¼Ÿ # Redis ä¸­æœ‰ä¸€ä¸ªå«åš sorted set çš„æ•°æ®ç»“æ„ç»å¸¸è¢«ç”¨åœ¨å„ç§æ’è¡Œæ¦œçš„åœºæ™¯ï¼Œæ¯”å¦‚ç›´æ’­é—´é€ç¤¼ç‰©çš„æ’è¡Œæ¦œã€æœ‹å‹åœˆçš„å¾®ä¿¡æ­¥æ•°æ’è¡Œæ¦œã€ç‹è€…è£è€€ä¸­çš„æ®µä½æ’è¡Œæ¦œã€è¯é¢˜çƒ­åº¦æ’è¡Œæ¦œç­‰ç­‰ã€‚\nç›¸å…³çš„ä¸€äº› Redis å‘½ä»¤: ZRANGE (ä»å°åˆ°å¤§æ’åº) ã€ ZREVRANGE ï¼ˆä»å¤§åˆ°å°æ’åºï¼‰ã€ZREVRANK (æŒ‡å®šå…ƒç´ æ’å)ã€‚\nã€ŠJava é¢è¯•æŒ‡åŒ—ã€‹\nä½¿ç”¨ Set å®ç°æŠ½å¥–ç³»ç»Ÿéœ€è¦ç”¨åˆ°ä»€ä¹ˆå‘½ä»¤ï¼Ÿ # SPOP key count ï¼š éšæœºç§»é™¤å¹¶è·å–æŒ‡å®šé›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼Œé€‚åˆä¸å…è®¸é‡å¤ä¸­å¥–çš„åœºæ™¯ã€‚\nSRANDMEMBER key count : éšæœºè·å–æŒ‡å®šé›†åˆä¸­æŒ‡å®šæ•°é‡çš„å…ƒç´ ï¼Œé€‚åˆå…è®¸é‡å¤ä¸­å¥–çš„åœºæ™¯ã€‚\né‡å¤ä¸­å¥–ï¼Œè¿™é‡Œè¯´çš„æ˜¯ç¬¬ä¸€æ¬¡ä¸­çš„æ˜¯aï¼Œç¬¬äºŒæ¬¡å¯èƒ½ä¹Ÿæ˜¯aã€‚è€Œä¸æ˜¯è¯´ä¸€æ¬¡ä¸­å°†çš„äººæœ‰ä¸¤ä¸ªa\nä½¿ç”¨ Bitmap ç»Ÿè®¡æ´»è·ƒç”¨æˆ·æ€ä¹ˆåšï¼Ÿ # ä½¿ç”¨æ—¥æœŸï¼ˆç²¾ç¡®åˆ°å¤©ï¼‰ä½œä¸º keyï¼Œç„¶åç”¨æˆ· ID ä¸º offsetï¼Œå¦‚æœå½“æ—¥æ´»è·ƒè¿‡å°±è®¾ç½®ä¸º 1ã€‚\nåˆå§‹åŒ–æ•°æ®ï¼š\n\u0026gt; SETBIT 20210308 1 1 (integer) 0 \u0026gt; SETBIT 20210308 2 1 (integer) 0 \u0026gt; SETBIT 20210309 1 1 (integer) 0 ç»Ÿè®¡ 20210308~20210309 æ€»æ´»è·ƒç”¨æˆ·æ•°:\n\u0026gt; BITOP and desk1 20210308 20210309 (integer) 1 \u0026gt; BITCOUNT desk1 (integer) 1 ç»Ÿè®¡ 20210308~20210309 åœ¨çº¿æ´»è·ƒç”¨æˆ·æ•°:\n\u0026gt; BITOP or desk2 20210308 20210309 (integer) 1 \u0026gt; BITCOUNT desk2 (integer) 2 ä½¿ç”¨ HyperLogLog ç»Ÿè®¡é¡µé¢ UV æ€ä¹ˆåšï¼Ÿ # Unique Visitorï¼Œå³æœ‰å¤šå°‘ä¸ªç”¨æˆ·è®¿é—®äº†æˆ‘ä»¬çš„ç½‘ç«™\n1ã€å°†è®¿é—®æŒ‡å®šé¡µé¢çš„æ¯ä¸ªç”¨æˆ· ID æ·»åŠ åˆ° HyperLogLog ä¸­ã€‚\nPFADD PAGE_1:UV USER1 USER2 ...... USERn 2ã€ç»Ÿè®¡æŒ‡å®šé¡µé¢çš„ UVã€‚\nPFCOUNT PAGE_1:UV #ä¼šè‡ªåŠ¨æ‰£é™¤é‡å¤çš„ Redis çº¿ç¨‹æ¨¡å‹ # å¯¹äºè¯»å†™å‘½ä»¤æ¥è¯´ï¼ŒRedis ä¸€ç›´æ˜¯å•çº¿ç¨‹æ¨¡å‹ã€‚ä¸è¿‡ï¼Œåœ¨ Redis 4.0 ç‰ˆæœ¬ä¹‹åå¼•å…¥äº†å¤šçº¿ç¨‹æ¥æ‰§è¡Œä¸€äº›å¤§é”®å€¼å¯¹çš„å¼‚æ­¥åˆ é™¤æ“ä½œï¼Œ Redis 6.0 ç‰ˆæœ¬ä¹‹åå¼•å…¥äº†å¤šçº¿ç¨‹æ¥å¤„ç†ç½‘ç»œè¯·æ±‚ï¼ˆæé«˜ç½‘ç»œ IO è¯»å†™æ€§èƒ½ï¼‰ã€‚\nRedis å•çº¿ç¨‹æ¨¡å‹äº†è§£å—ï¼Ÿ # Redis åŸºäº Reactor æ¨¡å¼è®¾è®¡å¼€å‘äº†ä¸€å¥—é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å‹ ï¼ˆNetty çš„çº¿ç¨‹æ¨¡å‹ä¹ŸåŸºäº Reactor æ¨¡å¼ï¼ŒReactor æ¨¡å¼ä¸æ„§æ˜¯é«˜æ€§èƒ½ IO çš„åŸºçŸ³ï¼‰ï¼Œè¿™å¥—äº‹ä»¶å¤„ç†æ¨¡å‹å¯¹åº”çš„æ˜¯ Redis ä¸­çš„æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰ã€‚ç”±äº**æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰**æ˜¯å•çº¿ç¨‹æ–¹å¼è¿è¡Œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬éƒ½è¯´ Redis æ˜¯å•çº¿ç¨‹æ¨¡å‹ã€‚\nã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹æœ‰ä¸€æ®µè¯æ˜¯å¦‚æ˜¯ä»‹ç»æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨çš„ï¼Œæˆ‘è§‰å¾—å†™å¾—æŒºä¸é”™ã€‚\nRedis åŸºäº Reactor æ¨¡å¼å¼€å‘äº†è‡ªå·±çš„ç½‘ç»œäº‹ä»¶å¤„ç†å™¨ï¼šè¿™ä¸ªå¤„ç†å™¨è¢«ç§°ä¸ºæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰ã€‚\næ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨ï¼ˆmultiplexingï¼‰ç¨‹åºæ¥åŒæ—¶ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œå¹¶æ ¹æ®å¥—æ¥å­—ç›®å‰æ‰§è¡Œçš„ä»»åŠ¡æ¥ä¸ºå¥—æ¥å­—å…³è”ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨ã€‚ å½“è¢«ç›‘å¬çš„å¥—æ¥å­—å‡†å¤‡å¥½æ‰§è¡Œè¿æ¥åº”ç­”ï¼ˆacceptï¼‰ã€è¯»å–ï¼ˆreadï¼‰ã€å†™å…¥ï¼ˆwriteï¼‰ã€å…³ é—­ï¼ˆcloseï¼‰ç­‰æ“ä½œæ—¶ï¼Œä¸æ“ä½œç›¸å¯¹åº”çš„æ–‡ä»¶äº‹ä»¶å°±ä¼šäº§ç”Ÿï¼Œè¿™æ—¶æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨å°±ä¼šè°ƒç”¨å¥—æ¥å­—ä¹‹å‰å…³è”å¥½çš„äº‹ä»¶å¤„ç†å™¨æ¥å¤„ç†è¿™äº›äº‹ä»¶ã€‚ è™½ç„¶æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä»¥å•çº¿ç¨‹æ–¹å¼è¿è¡Œï¼Œä½†é€šè¿‡ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨ç¨‹åºæ¥ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨æ—¢å®ç°äº†é«˜æ€§èƒ½çš„ç½‘ç»œé€šä¿¡æ¨¡å‹ï¼Œåˆå¯ä»¥å¾ˆå¥½åœ°ä¸ Redis æœåŠ¡å™¨ä¸­å…¶ä»–åŒæ ·ä»¥å•çº¿ç¨‹æ–¹å¼è¿è¡Œçš„æ¨¡å—è¿›è¡Œå¯¹æ¥ï¼Œè¿™ä¿æŒäº† Redis å†…éƒ¨å•çº¿ç¨‹è®¾è®¡çš„ç®€å•æ€§ã€‚\næ—¢ç„¶æ˜¯å•çº¿ç¨‹ï¼Œé‚£æ€ä¹ˆç›‘å¬å¤§é‡çš„å®¢æˆ·ç«¯è¿æ¥å‘¢ï¼Ÿ\nRedis é€šè¿‡ IO å¤šè·¯å¤ç”¨ç¨‹åº æ¥ç›‘å¬æ¥è‡ªå®¢æˆ·ç«¯çš„å¤§é‡è¿æ¥ï¼ˆæˆ–è€…è¯´æ˜¯ç›‘å¬å¤šä¸ª socketï¼‰ï¼Œå®ƒä¼šå°†æ„Ÿå…´è¶£çš„äº‹ä»¶åŠç±»å‹ï¼ˆè¯»ã€å†™ï¼‰æ³¨å†Œåˆ°å†…æ ¸ä¸­å¹¶ç›‘å¬æ¯ä¸ªäº‹ä»¶æ˜¯å¦å‘ç”Ÿã€‚\nè¿™æ ·çš„å¥½å¤„éå¸¸æ˜æ˜¾ï¼š I/O å¤šè·¯å¤ç”¨æŠ€æœ¯çš„ä½¿ç”¨è®© Redis ä¸éœ€è¦é¢å¤–åˆ›å»ºå¤šä½™çš„çº¿ç¨‹æ¥ç›‘å¬å®¢æˆ·ç«¯çš„å¤§é‡è¿æ¥ï¼Œé™ä½äº†èµ„æºçš„æ¶ˆè€—ï¼ˆå’Œ NIO ä¸­çš„ Selector ç»„ä»¶å¾ˆåƒï¼‰ã€‚\næ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼ˆfile event handlerï¼‰ä¸»è¦æ˜¯åŒ…å« 4 ä¸ªéƒ¨åˆ†ï¼š\nå¤šä¸ª socketï¼ˆå®¢æˆ·ç«¯è¿æ¥ï¼‰\nIO å¤šè·¯å¤ç”¨ç¨‹åºï¼ˆæ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯è¿æ¥çš„å…³é”®ï¼‰\næ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ï¼ˆå°† socket å…³è”åˆ°ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ï¼‰\näº‹ä»¶å¤„ç†å™¨ï¼ˆè¿æ¥åº”ç­”å¤„ç†å™¨ã€å‘½ä»¤è¯·æ±‚å¤„ç†å™¨ã€å‘½ä»¤å›å¤å¤„ç†å™¨ï¼‰\nç›¸å…³é˜…è¯»ï¼šRedis äº‹ä»¶æœºåˆ¶è¯¦è§£ ã€‚\nRedis6.0 ä¹‹å‰ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ # è™½ç„¶è¯´ Redis æ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œä½†æ˜¯ï¼Œå®é™…ä¸Šï¼ŒRedis åœ¨ 4.0 ä¹‹åçš„ç‰ˆæœ¬ä¸­å°±å·²ç»åŠ å…¥äº†å¯¹å¤šçº¿ç¨‹çš„æ”¯æŒã€‚\nä¸è¿‡ï¼ŒRedis 4.0 å¢åŠ çš„å¤šçº¿ç¨‹ä¸»è¦æ˜¯é’ˆå¯¹ä¸€äº›å¤§é”®å€¼å¯¹çš„åˆ é™¤æ“ä½œçš„å‘½ä»¤ï¼Œä½¿ç”¨è¿™äº›å‘½ä»¤å°±ä¼šä½¿ç”¨ä¸»çº¿ç¨‹ä¹‹å¤–çš„å…¶ä»–çº¿ç¨‹æ¥â€œå¼‚æ­¥å¤„ç†â€ã€‚\nä¸ºæ­¤ï¼ŒRedis 4.0 ä¹‹åæ–°å¢äº†**UNLINKï¼ˆå¯ä»¥çœ‹ä½œæ˜¯ DEL çš„å¼‚æ­¥ç‰ˆæœ¬ï¼‰ã€FLUSHALL ASYNCï¼ˆæ¸…ç©ºæ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰ keyï¼Œä¸ä»…ä»…æ˜¯å½“å‰ SELECT çš„æ•°æ®åº“ï¼‰ã€FLUSHDB ASYNC**ï¼ˆæ¸…ç©ºå½“å‰ SELECT æ•°æ®åº“ä¸­çš„æ‰€æœ‰ keyï¼‰ç­‰å¼‚æ­¥å‘½ä»¤ã€‚\nå¤§ä½“ä¸Šæ¥è¯´ï¼ŒRedis 6.0 ä¹‹å‰ä¸»è¦è¿˜æ˜¯å•çº¿ç¨‹å¤„ç†ã€‚\né‚£ Redis6.0 ä¹‹å‰ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ æˆ‘è§‰å¾—ä¸»è¦åŸå› æœ‰ 3 ç‚¹ï¼š\nå•çº¿ç¨‹ç¼–ç¨‹å®¹æ˜“å¹¶ä¸”æ›´å®¹æ˜“ç»´æŠ¤ï¼› Redis çš„æ€§èƒ½ç“¶é¢ˆä¸åœ¨ CPU ï¼Œä¸»è¦åœ¨å†…å­˜å’Œç½‘ç»œï¼› å¤šçº¿ç¨‹å°±ä¼šå­˜åœ¨æ­»é”ã€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ç­‰é—®é¢˜ï¼Œç”šè‡³ä¼šå½±å“æ€§èƒ½ã€‚ ç›¸å…³é˜…è¯»ï¼šä¸ºä»€ä¹ˆ Redis é€‰æ‹©å•çº¿ç¨‹æ¨¡å‹ ã€‚\nRedis6.0 ä¹‹åä¸ºä½•å¼•å…¥äº†å¤šçº¿ç¨‹ï¼Ÿ # Redis6.0 å¼•å…¥å¤šçº¿ç¨‹ä¸»è¦æ˜¯ä¸ºäº†æé«˜ç½‘ç»œ IO è¯»å†™æ€§èƒ½ï¼Œå› ä¸ºè¿™ä¸ªç®—æ˜¯ Redis ä¸­çš„ä¸€ä¸ªæ€§èƒ½ç“¶é¢ˆï¼ˆRedis çš„ç“¶é¢ˆä¸»è¦å—é™äºå†…å­˜å’Œç½‘ç»œï¼‰ã€‚\nè™½ç„¶ï¼ŒRedis6.0 å¼•å…¥äº†å¤šçº¿ç¨‹ï¼Œä½†æ˜¯ Redis çš„å¤šçº¿ç¨‹åªæ˜¯åœ¨ç½‘ç»œæ•°æ®çš„è¯»å†™è¿™ç±»è€—æ—¶æ“ä½œä¸Šä½¿ç”¨äº†ï¼Œæ‰§è¡Œå‘½ä»¤ä»ç„¶æ˜¯å•çº¿ç¨‹é¡ºåºæ‰§è¡Œã€‚å› æ­¤ï¼Œä½ ä¹Ÿä¸éœ€è¦æ‹…å¿ƒçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚\nRedis6.0 çš„å¤šçº¿ç¨‹é»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œåªä½¿ç”¨ä¸»çº¿ç¨‹ã€‚å¦‚éœ€å¼€å¯éœ€è¦è®¾ç½®IOçº¿ç¨‹æ•° \u0026gt; 1ï¼Œéœ€è¦ä¿®æ”¹ redis é…ç½®æ–‡ä»¶ redis.conf ï¼š\nio-threads 4 #è®¾ç½®1çš„è¯åªä¼šå¼€å¯ä¸»çº¿ç¨‹ï¼Œå®˜ç½‘å»ºè®®4æ ¸çš„æœºå™¨å»ºè®®è®¾ç½®ä¸º2æˆ–3ä¸ªçº¿ç¨‹ï¼Œ8æ ¸çš„å»ºè®®è®¾ç½®ä¸º6ä¸ªçº¿ç¨‹ å¦å¤–ï¼š\nio-threadsçš„ä¸ªæ•°ä¸€æ—¦è®¾ç½®ï¼Œä¸èƒ½é€šè¿‡configåŠ¨æ€è®¾ç½® å½“è®¾ç½®sslåï¼Œio-threadså°†ä¸å·¥ä½œ å¼€å¯å¤šçº¿ç¨‹åï¼Œé»˜è®¤åªä¼šä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡ŒIOå†™å…¥writesï¼Œå³å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯ï¼Œå¦‚æœéœ€è¦å¼€å¯å¤šçº¿ç¨‹IOè¯»å–readsï¼ŒåŒæ ·éœ€è¦ä¿®æ”¹ redis é…ç½®æ–‡ä»¶ redis.conf :\nio-threads-do-reads yes ä½†æ˜¯å®˜ç½‘æè¿°å¼€å¯å¤šçº¿ç¨‹è¯»å¹¶ä¸èƒ½æœ‰å¤ªå¤§æå‡ï¼Œå› æ­¤ä¸€èˆ¬æƒ…å†µä¸‹å¹¶ä¸å»ºè®®å¼€å¯\nç›¸å…³é˜…è¯»ï¼š\nRedis 6.0 æ–°ç‰¹æ€§-å¤šçº¿ç¨‹è¿ç¯ 13 é—®ï¼ Redis å¤šçº¿ç¨‹ç½‘ç»œæ¨¡å‹å…¨é¢æ­ç§˜ï¼ˆæ¨èï¼‰ Redis å†…å­˜ç®¡ç† # Redis ç»™ç¼“å­˜æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´æœ‰å•¥ç”¨ï¼Ÿ # ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è®¾ç½®ä¿å­˜çš„ç¼“å­˜æ•°æ®çš„æ—¶å€™éƒ½ä¼šè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\nå› ä¸ºå†…å­˜æ˜¯æœ‰é™çš„ï¼Œå¦‚æœç¼“å­˜ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½æ˜¯ä¸€ç›´ä¿å­˜çš„è¯ï¼Œåˆ†åˆ†é’Ÿç›´æ¥ Out of memoryã€‚\nRedis è‡ªå¸¦äº†ç»™ç¼“å­˜æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š\n127.0.0.1:6379\u0026gt; expire key 60 # æ•°æ®åœ¨ 60s åè¿‡æœŸ (integer) 1 127.0.0.1:6379\u0026gt; setex key 60 value # æ•°æ®åœ¨ 60s åè¿‡æœŸ (setex:[set] + [ex]pire) OK 127.0.0.1:6379\u0026gt; ttl key # æŸ¥çœ‹æ•°æ®è¿˜æœ‰å¤šä¹…è¿‡æœŸ (integer) 56 æ³¨æ„ï¼šRedis ä¸­é™¤äº†å­—ç¬¦ä¸²ç±»å‹æœ‰è‡ªå·±ç‹¬æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´çš„å‘½ä»¤ setex å¤–ï¼Œå…¶ä»–æ–¹æ³•éƒ½éœ€è¦ä¾é  expire å‘½ä»¤æ¥è®¾ç½®è¿‡æœŸæ—¶é—´ ã€‚å¦å¤–ï¼Œ persist å‘½ä»¤å¯ä»¥ç§»é™¤ä¸€ä¸ªé”®çš„è¿‡æœŸæ—¶é—´ã€‚\nè¿‡æœŸæ—¶é—´é™¤äº†æœ‰åŠ©äºç¼“è§£å†…å­˜çš„æ¶ˆè€—ï¼Œè¿˜æœ‰ä»€ä¹ˆå…¶ä»–ç”¨ä¹ˆï¼Ÿ\nå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯å°±æ˜¯éœ€è¦æŸä¸ªæ•°æ®åªåœ¨æŸä¸€æ—¶é—´æ®µå†…å­˜åœ¨ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„çŸ­ä¿¡éªŒè¯ç å¯èƒ½åªåœ¨ 1 åˆ†é’Ÿå†…æœ‰æ•ˆï¼Œç”¨æˆ·ç™»å½•çš„ token å¯èƒ½åªåœ¨ 1 å¤©å†…æœ‰æ•ˆã€‚\nå¦‚æœä½¿ç”¨ä¼ ç»Ÿçš„æ•°æ®åº“æ¥å¤„ç†çš„è¯ï¼Œä¸€èˆ¬éƒ½æ˜¯è‡ªå·±åˆ¤æ–­è¿‡æœŸï¼Œè¿™æ ·æ›´éº»çƒ¦å¹¶ä¸”æ€§èƒ½è¦å·®å¾ˆå¤šã€‚\nRedis æ˜¯å¦‚ä½•åˆ¤æ–­æ•°æ®æ˜¯å¦è¿‡æœŸçš„å‘¢ï¼Ÿ # Redis é€šè¿‡ä¸€ä¸ªå«åšè¿‡æœŸå­—å…¸ï¼ˆå¯ä»¥çœ‹ä½œæ˜¯ hash è¡¨ï¼‰æ¥ä¿å­˜æ•°æ®è¿‡æœŸçš„æ—¶é—´ã€‚è¿‡æœŸå­—å…¸çš„é”®æŒ‡å‘ Redis æ•°æ®åº“ä¸­çš„æŸä¸ª key(é”®)ï¼Œè¿‡æœŸå­—å…¸çš„å€¼æ˜¯ä¸€ä¸ª long long ç±»å‹çš„æ•´æ•°ï¼Œè¿™ä¸ªæ•´æ•°ä¿å­˜äº† key æ‰€æŒ‡å‘çš„æ•°æ®åº“é”®çš„è¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ç²¾åº¦çš„ UNIX æ—¶é—´æˆ³ï¼‰ã€‚\nè¿‡æœŸå­—å…¸æ˜¯å­˜å‚¨åœ¨ redisDb è¿™ä¸ªç»“æ„é‡Œçš„ï¼š\ntypedef struct redisDb { ... dict *dict; //æ•°æ®åº“é”®ç©ºé—´,ä¿å­˜ç€æ•°æ®åº“ä¸­æ‰€æœ‰é”®å€¼å¯¹ dict *expires // è¿‡æœŸå­—å…¸,ä¿å­˜ç€é”®çš„è¿‡æœŸæ—¶é—´ ... } redisDb; è¿‡æœŸçš„æ•°æ®çš„åˆ é™¤ç­–ç•¥äº†è§£ä¹ˆï¼Ÿ # å¦‚æœå‡è®¾ä½ è®¾ç½®äº†ä¸€æ‰¹ key åªèƒ½å­˜æ´» 1 åˆ†é’Ÿï¼Œé‚£ä¹ˆ 1 åˆ†é’Ÿåï¼ŒRedis æ˜¯æ€ä¹ˆå¯¹è¿™æ‰¹ key è¿›è¡Œåˆ é™¤çš„å‘¢ï¼Ÿ\nå¸¸ç”¨çš„è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥å°±ä¸¤ä¸ªï¼ˆé‡è¦ï¼è‡ªå·±é€ ç¼“å­˜è½®å­çš„æ—¶å€™éœ€è¦æ ¼å¤–è€ƒè™‘çš„ä¸œè¥¿ï¼‰ï¼š\næƒ°æ€§åˆ é™¤ ï¼šåªä¼šåœ¨å–å‡º key çš„æ—¶å€™æ‰å¯¹æ•°æ®è¿›è¡Œè¿‡æœŸæ£€æŸ¥ã€‚è¿™æ ·å¯¹ CPU æœ€å‹å¥½ï¼Œä½†æ˜¯å¯èƒ½ä¼šé€ æˆå¤ªå¤šè¿‡æœŸ key æ²¡æœ‰è¢«åˆ é™¤ã€‚ å®šæœŸåˆ é™¤ ï¼š æ¯éš”ä¸€æ®µæ—¶é—´æŠ½å–ä¸€æ‰¹ key æ‰§è¡Œåˆ é™¤è¿‡æœŸ key æ“ä½œã€‚å¹¶ä¸”ï¼ŒRedis åº•å±‚ä¼šé€šè¿‡é™åˆ¶åˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡æ¥å‡å°‘åˆ é™¤æ“ä½œå¯¹ CPU æ—¶é—´çš„å½±å“ã€‚ å®šæœŸåˆ é™¤å¯¹å†…å­˜æ›´åŠ å‹å¥½ï¼Œæƒ°æ€§åˆ é™¤å¯¹ CPU æ›´åŠ å‹å¥½ã€‚ä¸¤è€…å„æœ‰åƒç§‹ï¼Œæ‰€ä»¥ Redis é‡‡ç”¨çš„æ˜¯ å®šæœŸåˆ é™¤+æƒ°æ€§/æ‡’æ±‰å¼åˆ é™¤ ã€‚\nä½†æ˜¯ï¼Œä»…ä»…é€šè¿‡ç»™ key è®¾ç½®è¿‡æœŸæ—¶é—´è¿˜æ˜¯æœ‰é—®é¢˜çš„ã€‚å› ä¸ºè¿˜æ˜¯å¯èƒ½å­˜åœ¨å®šæœŸåˆ é™¤å’Œæƒ°æ€§åˆ é™¤æ¼æ‰äº†å¾ˆå¤šè¿‡æœŸ key çš„æƒ…å†µã€‚è¿™æ ·å°±å¯¼è‡´å¤§é‡è¿‡æœŸ key å †ç§¯åœ¨å†…å­˜é‡Œï¼Œç„¶åå°± Out of memory äº†ã€‚\næ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ï¼šRedis å†…å­˜æ·˜æ±°æœºåˆ¶ã€‚\nRedis å†…å­˜æ·˜æ±°æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ # ç›¸å…³é—®é¢˜ï¼šMySQL é‡Œæœ‰ 2000w æ•°æ®ï¼ŒRedis ä¸­åªå­˜ 20w çš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯ Redis ä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®?\nå½“ç¼“å­˜æ•°æ®è¶Šæ¥è¶Šå¤šï¼ŒRedis ä¸å¯é¿å…çš„ä¼šè¢«å†™æ»¡ï¼Œè¿™æ—¶å€™å°±æ¶‰åŠåˆ° Redis çš„å†…å­˜æ·˜æ±°æœºåˆ¶äº†\nRedis æä¾› 6 ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼š\nvolatile-lruï¼ˆleast recently usedï¼‰ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±° volatile-ttlï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±° volatile-randomï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±° allkeys-lruï¼ˆleast recently usedï¼‰ï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ keyï¼ˆè¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„ï¼‰ allkeys-randomï¼šä»æ•°æ®é›†ï¼ˆserver.db[i].dictï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±° no-evictionï¼šç¦æ­¢é©±é€æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œæ–°å†™å…¥æ“ä½œä¼šæŠ¥é”™ã€‚è¿™ä¸ªåº”è¯¥æ²¡äººä½¿ç”¨å§ï¼ 4.0 ç‰ˆæœ¬åå¢åŠ ä»¥ä¸‹ä¸¤ç§ï¼š\nvolatile-lfuï¼ˆleast frequently usedï¼‰ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰æœ€ä¸ç»å¸¸ä½¿ç”¨çš„æ•°æ®æ·˜æ±° allkeys-lfuï¼ˆleast frequently usedï¼‰ï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€ä¸ç»å¸¸ä½¿ç”¨çš„ key å…³äºæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼š\né“¾è¡¨å°¾éƒ¨çš„æ•°æ®ä¼šè¢«ä¸¢å¼ƒ\né•¿æœŸä¸è¢«ä½¿ç”¨çš„æ•°æ®ï¼Œåœ¨æœªæ¥è¢«ç”¨åˆ°çš„å‡ ç‡ä¹Ÿä¸å¤§ã€‚å› æ­¤ï¼Œå½“æ•°æ®æ‰€å å†…å­˜è¾¾åˆ°ä¸€å®šé˜ˆå€¼æ—¶ï¼Œè¦ç§»é™¤æ‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®ã€‚\nå…³äºç¿»è¯‘é—®é¢˜ï¼šleastï¼Œç¨‹åº¦æœ€è½»çš„ã€‚recentlyï¼Œæœ€è¿‘çš„ã€‚å…¶å®ç¿»è¯‘åº”è¯¥æ˜¯â€œéæœ€è¿‘çš„ï¼Œè¶Šè¿œè¶Šè¦æ·˜æ±°â€\njavaç®—æ³•å®ç°\npublic class LRUCache { class DLinkedNode { int key; int value; DLinkedNode prev; DLinkedNode next; public DLinkedNode() {} public DLinkedNode(int _key, int _value) {key = _key; value = _value;} } private Map\u0026lt;Integer, DLinkedNode\u0026gt; cache = new HashMap\u0026lt;Integer, DLinkedNode\u0026gt;(); private int size; private int capacity; private DLinkedNode head, tail; public LRUCache(int capacity) { this.size = 0; this.capacity = capacity; // ä½¿ç”¨ä¼ªå¤´éƒ¨å’Œä¼ªå°¾éƒ¨èŠ‚ç‚¹ head = new DLinkedNode(); tail = new DLinkedNode(); head.next = tail; tail.prev = head; } public int get(int key) { DLinkedNode node = cache.get(key); if (node == null) { return -1; } // å¦‚æœ key å­˜åœ¨ï¼Œå…ˆé€šè¿‡å“ˆå¸Œè¡¨å®šä½ï¼Œå†ç§»åˆ°å¤´éƒ¨ moveToHead(node); return node.value; } public void put(int key, int value) { DLinkedNode node = cache.get(key); if (node == null) { // å¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ DLinkedNode newNode = new DLinkedNode(key, value); // æ·»åŠ è¿›å“ˆå¸Œè¡¨ cache.put(key, newNode); // æ·»åŠ è‡³åŒå‘é“¾è¡¨çš„å¤´éƒ¨ addToHead(newNode); ++size; if (size \u0026gt; capacity) { // å¦‚æœè¶…å‡ºå®¹é‡ï¼Œåˆ é™¤åŒå‘é“¾è¡¨çš„å°¾éƒ¨èŠ‚ç‚¹ DLinkedNode tail = removeTail(); // åˆ é™¤å“ˆå¸Œè¡¨ä¸­å¯¹åº”çš„é¡¹ cache.remove(tail.key); --size; } } else { // å¦‚æœ key å­˜åœ¨ï¼Œå…ˆé€šè¿‡å“ˆå¸Œè¡¨å®šä½ï¼Œå†ä¿®æ”¹ valueï¼Œå¹¶ç§»åˆ°å¤´éƒ¨ node.value = value; moveToHead(node); } } private void addToHead(DLinkedNode node) { node.prev = head; node.next = head.next; head.next.prev = node; head.next = node; } private void removeNode(DLinkedNode node) { node.prev.next = node.next; node.next.prev = node.prev; } private void moveToHead(DLinkedNode node) { removeNode(node); addToHead(node); } private DLinkedNode removeTail() { DLinkedNode res = tail.prev; removeNode(res); return res; } } Redis æŒä¹…åŒ–æœºåˆ¶ # æ€ä¹ˆä¿è¯ Redis æŒ‚æ‰ä¹‹åå†é‡å¯æ•°æ®å¯ä»¥è¿›è¡Œæ¢å¤ï¼Ÿ # å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦æŒä¹…åŒ–æ•°æ®ä¹Ÿå°±æ˜¯å°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥åˆ°ç¡¬ç›˜é‡Œé¢ï¼Œå¤§éƒ¨åˆ†åŸå› æ˜¯ä¸ºäº†ä¹‹åé‡ç”¨æ•°æ®ï¼ˆæ¯”å¦‚é‡å¯æœºå™¨ã€æœºå™¨æ•…éšœä¹‹åæ¢å¤æ•°æ®ï¼‰ï¼Œæˆ–è€…æ˜¯ä¸ºäº†é˜²æ­¢ç³»ç»Ÿæ•…éšœè€Œå°†æ•°æ®å¤‡ä»½åˆ°ä¸€ä¸ªè¿œç¨‹ä½ç½®ã€‚\nRedis ä¸åŒäº Memcached çš„å¾ˆé‡è¦ä¸€ç‚¹å°±æ˜¯ï¼ŒRedis æ”¯æŒæŒä¹…åŒ–ï¼Œè€Œä¸”æ”¯æŒä¸¤ç§ä¸åŒçš„æŒä¹…åŒ–æ“ä½œã€‚Redis çš„ä¸€ç§æŒä¹…åŒ–æ–¹å¼å«å¿«ç…§ï¼ˆsnapshottingï¼ŒRDBï¼‰ï¼Œå¦ä¸€ç§æ–¹å¼æ˜¯åªè¿½åŠ æ–‡ä»¶ï¼ˆappend-only file, AOFï¼‰ã€‚è¿™ä¸¤ç§æ–¹æ³•å„æœ‰åƒç§‹ï¼Œä¸‹é¢æˆ‘ä¼šè¯¦ç»†è¿™ä¸¤ç§æŒä¹…åŒ–æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆç”¨ï¼Œå¦‚ä½•é€‰æ‹©é€‚åˆè‡ªå·±çš„æŒä¹…åŒ–æ–¹æ³•ã€‚\nä»€ä¹ˆæ˜¯ RDB æŒä¹…åŒ–ï¼Ÿ # Redis å¯ä»¥é€šè¿‡åˆ›å»ºå¿«ç…§æ¥è·å¾—å­˜å‚¨åœ¨å†…å­˜é‡Œé¢çš„æ•°æ®åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„å‰¯æœ¬ã€‚Redis åˆ›å»ºå¿«ç…§ä¹‹åï¼Œå¯ä»¥å¯¹å¿«ç…§è¿›è¡Œå¤‡ä»½ï¼Œå¯ä»¥å°†å¿«ç…§å¤åˆ¶åˆ°å…¶ä»–æœåŠ¡å™¨ä»è€Œåˆ›å»ºå…·æœ‰ç›¸åŒæ•°æ®çš„æœåŠ¡å™¨å‰¯æœ¬ï¼ˆRedis ä¸»ä»ç»“æ„ï¼Œä¸»è¦ç”¨æ¥æé«˜ Redis æ€§èƒ½ï¼‰ï¼Œè¿˜å¯ä»¥å°†å¿«ç…§ç•™åœ¨åŸåœ°ä»¥ä¾¿é‡å¯æœåŠ¡å™¨çš„æ—¶å€™ä½¿ç”¨ã€‚\nå¿«ç…§æŒä¹…åŒ–æ˜¯ Redis é»˜è®¤é‡‡ç”¨çš„æŒä¹…åŒ–æ–¹å¼ï¼Œåœ¨ redis.conf é…ç½®æ–‡ä»¶ä¸­é»˜è®¤æœ‰æ­¤ä¸‹é…ç½®ï¼š\nsave 900 1 #åœ¨900ç§’(15åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰1ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘bgsaveå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚ save 300 10 #åœ¨300ç§’(5åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰10ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘bgsaveå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚ save 60 10000 #åœ¨60ç§’(1åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰10000ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘bgsaveå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚ RDB åˆ›å»ºå¿«ç…§æ—¶ä¼šé˜»å¡ä¸»çº¿ç¨‹å—ï¼Ÿ # Redis æä¾›äº†ä¸¤ä¸ªå‘½ä»¤æ¥ç”Ÿæˆ RDB å¿«ç…§æ–‡ä»¶ï¼š\nsave : ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼› bgsave : å­çº¿ç¨‹æ‰§è¡Œï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œé»˜è®¤é€‰é¡¹ã€‚ ä»€ä¹ˆæ˜¯ AOF æŒä¹…åŒ–ï¼Ÿ # ä¸å¿«ç…§æŒä¹…åŒ–ç›¸æ¯”ï¼ŒAOF æŒä¹…åŒ–çš„å®æ—¶æ€§æ›´å¥½ï¼Œå› æ­¤å·²æˆä¸ºä¸»æµçš„æŒä¹…åŒ–æ–¹æ¡ˆã€‚é»˜è®¤æƒ…å†µä¸‹ Redis æ²¡æœ‰å¼€å¯ AOFï¼ˆappend only fileï¼‰æ–¹å¼çš„æŒä¹…åŒ–ï¼Œå¯ä»¥é€šè¿‡ appendonly å‚æ•°å¼€å¯ï¼š\nappendonly yes å¼€å¯ AOF æŒä¹…åŒ–åæ¯æ‰§è¡Œä¸€æ¡ä¼šæ›´æ”¹ Redis ä¸­çš„æ•°æ®çš„å‘½ä»¤ï¼ŒRedis å°±ä¼šå°†è¯¥å‘½ä»¤å†™å…¥åˆ°å†…å­˜ç¼“å­˜ server.aof_buf ä¸­ï¼Œç„¶åå†æ ¹æ® appendfsync é…ç½®æ¥å†³å®šä½•æ—¶å°†å…¶åŒæ­¥åˆ°ç¡¬ç›˜ä¸­çš„ AOF æ–‡ä»¶ã€‚\nAOF æ–‡ä»¶çš„ä¿å­˜ä½ç½®å’Œ RDB æ–‡ä»¶çš„ä½ç½®ç›¸åŒï¼Œéƒ½æ˜¯é€šè¿‡ dir å‚æ•°è®¾ç½®çš„ï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯ appendonly.aofã€‚\nåœ¨ Redis çš„é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨ä¸‰ç§ä¸åŒçš„ AOF æŒä¹…åŒ–æ–¹å¼ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š\nappendfsync always #æ¯æ¬¡æœ‰æ•°æ®ä¿®æ”¹å‘ç”Ÿæ—¶éƒ½ä¼šå†™å…¥AOFæ–‡ä»¶,è¿™æ ·ä¼šä¸¥é‡é™ä½Redisçš„é€Ÿåº¦ appendfsync everysec #æ¯ç§’é’ŸåŒæ­¥ä¸€æ¬¡ï¼Œæ˜¾å¼åœ°å°†å¤šä¸ªå†™å‘½ä»¤åŒæ­¥åˆ°ç¡¬ç›˜ appendfsync no #è®©æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶è¿›è¡ŒåŒæ­¥ ä¸ºäº†å…¼é¡¾æ•°æ®å’Œå†™å…¥æ€§èƒ½ï¼Œç”¨æˆ·å¯ä»¥è€ƒè™‘ appendfsync everysec é€‰é¡¹ ï¼Œè®© Redis æ¯ç§’åŒæ­¥ä¸€æ¬¡ AOF æ–‡ä»¶ï¼ŒRedis æ€§èƒ½å‡ ä¹æ²¡å—åˆ°ä»»ä½•å½±å“ã€‚è€Œä¸”è¿™æ ·å³ä½¿å‡ºç°ç³»ç»Ÿå´©æºƒï¼Œç”¨æˆ·æœ€å¤šåªä¼šä¸¢å¤±ä¸€ç§’ä¹‹å†…äº§ç”Ÿçš„æ•°æ®ã€‚å½“ç¡¬ç›˜å¿™äºæ‰§è¡Œå†™å…¥æ“ä½œçš„æ—¶å€™ï¼ŒRedis è¿˜ä¼šä¼˜é›…çš„æ”¾æ…¢è‡ªå·±çš„é€Ÿåº¦ä»¥ä¾¿é€‚åº”ç¡¬ç›˜çš„æœ€å¤§å†™å…¥é€Ÿåº¦ã€‚\nç›¸å…³ issue ï¼š\nRedis çš„ AOF æ–¹å¼ #783 Redis AOF é‡å†™æè¿°ä¸å‡†ç¡® #1439 AOF æ—¥å¿—æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ # å…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚ MySQLï¼‰é€šå¸¸éƒ½æ˜¯æ‰§è¡Œå‘½ä»¤ä¹‹å‰è®°å½•æ—¥å¿—ï¼ˆæ–¹ä¾¿æ•…éšœæ¢å¤ï¼‰ï¼Œè€Œ Redis AOF æŒä¹…åŒ–æœºåˆ¶æ˜¯åœ¨æ‰§è¡Œå®Œå‘½ä»¤ä¹‹åå†è®°å½•æ—¥å¿—ã€‚\nä¸ºä»€ä¹ˆæ˜¯åœ¨æ‰§è¡Œå®Œå‘½ä»¤ä¹‹åè®°å½•æ—¥å¿—å‘¢ï¼Ÿ\né¿å…é¢å¤–çš„æ£€æŸ¥å¼€é”€ï¼ŒAOF è®°å½•æ—¥å¿—ä¸ä¼šå¯¹å‘½ä»¤è¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼› åœ¨å‘½ä»¤æ‰§è¡Œå®Œä¹‹åå†è®°å½•ï¼Œä¸ä¼šé˜»å¡å½“å‰çš„å‘½ä»¤æ‰§è¡Œã€‚ è¿™æ ·ä¹Ÿå¸¦æ¥äº†é£é™©ï¼ˆæˆ‘åœ¨å‰é¢ä»‹ç» AOF æŒä¹…åŒ–çš„æ—¶å€™ä¹Ÿæåˆ°è¿‡ï¼‰ï¼š\nå¦‚æœåˆšæ‰§è¡Œå®Œå‘½ä»¤ Redis å°±å®•æœºä¼šå¯¼è‡´å¯¹åº”çš„ä¿®æ”¹ä¸¢å¤±ï¼› å¯èƒ½ä¼šé˜»å¡åç»­å…¶ä»–å‘½ä»¤çš„æ‰§è¡Œï¼ˆAOF è®°å½•æ—¥å¿—æ˜¯åœ¨ Redis ä¸»çº¿ç¨‹ä¸­è¿›è¡Œçš„ï¼‰ã€‚ AOF é‡å†™äº†è§£å—ï¼Ÿ # å½“ AOF å˜å¾—å¤ªå¤§æ—¶ï¼ŒRedis èƒ½å¤Ÿåœ¨åå°è‡ªåŠ¨é‡å†™ AOF äº§ç”Ÿä¸€ä¸ªæ–°çš„ AOF æ–‡ä»¶ï¼Œè¿™ä¸ªæ–°çš„ AOF æ–‡ä»¶å’ŒåŸæœ‰çš„ AOF æ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€ä¸€æ ·ï¼Œä½†ä½“ç§¯æ›´å°ã€‚\nAOF é‡å†™æ˜¯ä¸€ä¸ªæœ‰æ­§ä¹‰çš„åå­—ï¼Œè¯¥åŠŸèƒ½æ˜¯é€šè¿‡è¯»å–æ•°æ®åº“ä¸­çš„é”®å€¼å¯¹æ¥å®ç°çš„ï¼Œç¨‹åºæ— é¡»å¯¹ç°æœ‰ AOF æ–‡ä»¶è¿›è¡Œä»»ä½•è¯»å…¥ã€åˆ†ææˆ–è€…å†™å…¥æ“ä½œã€‚\nåœ¨æ‰§è¡Œ BGREWRITEAOF å‘½ä»¤æ—¶ï¼ŒRedis æœåŠ¡å™¨ä¼šç»´æŠ¤ä¸€ä¸ª AOF é‡å†™ç¼“å†²åŒºï¼Œè¯¥ç¼“å†²åŒºä¼šåœ¨å­è¿›ç¨‹åˆ›å»ºæ–° AOF æ–‡ä»¶æœŸé—´ï¼Œè®°å½•æœåŠ¡å™¨æ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤ã€‚å½“å­è¿›ç¨‹å®Œæˆåˆ›å»ºæ–° AOF æ–‡ä»¶çš„å·¥ä½œä¹‹åï¼ŒæœåŠ¡å™¨ä¼šå°†é‡å†™ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹è¿½åŠ åˆ°æ–° AOF æ–‡ä»¶çš„æœ«å°¾ï¼Œä½¿å¾—æ–°çš„ AOF æ–‡ä»¶ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€ä¸ç°æœ‰çš„æ•°æ®åº“çŠ¶æ€ä¸€è‡´ã€‚æœ€åï¼ŒæœåŠ¡å™¨ç”¨æ–°çš„ AOF æ–‡ä»¶æ›¿æ¢æ—§çš„ AOF æ–‡ä»¶ï¼Œä»¥æ­¤æ¥å®Œæˆ AOF æ–‡ä»¶é‡å†™æ“ä½œã€‚\nRedis 7.0 ç‰ˆæœ¬ä¹‹å‰ï¼Œå¦‚æœåœ¨é‡å†™æœŸé—´æœ‰å†™å…¥å‘½ä»¤ï¼ŒAOF å¯èƒ½ä¼šä½¿ç”¨å¤§é‡å†…å­˜ï¼Œé‡å†™æœŸé—´åˆ°è¾¾çš„æ‰€æœ‰å†™å…¥å‘½ä»¤éƒ½ä¼šå†™å…¥ç£ç›˜ä¸¤æ¬¡ã€‚\naof æ–‡ä»¶é‡å†™æ˜¯å°† redis ä¸­çš„æ•°æ®è½¬æ¢ä¸º å†™å‘½ä»¤åŒæ­¥æ›´æ–°åˆ° aof æ–‡ä»¶çš„è¿‡ç¨‹ã€‚\né‡å†™ aof å ä¸ºä»€ä¹ˆä¹ˆå¯ä»¥å˜å°\næ¸…é™¤äº†ä¸€äº›æ— æ•ˆå‘½ä»¤ eg. del srem è¿›ç¨‹å†…è¶…æ—¶çš„æ•°æ®ä¸å†å†™å…¥ aof æ–‡ä»¶ å¤šæ¡å†™å‘½ä»¤å¯ä»¥åˆå¹¶ä¸ºæ‰¹é‡å†™å‘½ä»¤ eg. lpush list v1 lpush list v2 lpush list v3 åˆå¹¶ä¸ºä¸€æ¡å†™å…¥å‘½ä»¤ lpush list v1 v2 v3 å¦‚ä½•é€‰æ‹© RDB å’Œ AOFï¼Ÿ # å…³äº RDB å’Œ AOF çš„ä¼˜ç¼ºç‚¹ï¼Œå®˜ç½‘ä¸Šé¢ä¹Ÿç»™äº†æ¯”è¾ƒè¯¦ç»†çš„è¯´æ˜Redis persistenceï¼Œè¿™é‡Œç»“åˆè‡ªå·±çš„ç†è§£ç®€å•æ€»ç»“ä¸€ä¸‹ã€‚\nRDB æ¯” AOF ä¼˜ç§€çš„åœ°æ–¹ ï¼š\nRDB æ–‡ä»¶å­˜å‚¨çš„å†…å®¹æ˜¯ç»è¿‡å‹ç¼©çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œ ä¿å­˜ç€æŸä¸ªæ—¶é—´ç‚¹çš„æ•°æ®é›†ï¼Œæ–‡ä»¶å¾ˆå°ï¼Œé€‚åˆåšæ•°æ®çš„å¤‡ä»½ï¼Œç¾éš¾æ¢å¤ã€‚AOF æ–‡ä»¶å­˜å‚¨çš„æ˜¯æ¯ä¸€æ¬¡å†™å‘½ä»¤ï¼Œç±»ä¼¼äº MySQL çš„ binlog æ—¥å¿—ï¼Œé€šå¸¸ä¼šå¿… RDB æ–‡ä»¶å¤§å¾ˆå¤šã€‚å½“ AOF å˜å¾—å¤ªå¤§æ—¶ï¼ŒRedis èƒ½å¤Ÿåœ¨åå°è‡ªåŠ¨é‡å†™ AOFã€‚æ–°çš„ AOF æ–‡ä»¶å’ŒåŸæœ‰çš„ AOF æ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€ä¸€æ ·ï¼Œä½†ä½“ç§¯æ›´å°ã€‚ä¸è¿‡ï¼Œ Redis 7.0 ç‰ˆæœ¬ä¹‹å‰ï¼Œå¦‚æœåœ¨é‡å†™æœŸé—´æœ‰å†™å…¥å‘½ä»¤ï¼ŒAOF å¯èƒ½ä¼šä½¿ç”¨å¤§é‡å†…å­˜ï¼Œé‡å†™æœŸé—´åˆ°è¾¾çš„æ‰€æœ‰å†™å…¥å‘½ä»¤éƒ½ä¼šå†™å…¥ç£ç›˜ä¸¤æ¬¡ã€‚ ä½¿ç”¨ RDB æ–‡ä»¶æ¢å¤æ•°æ®ï¼Œç›´æ¥è§£æè¿˜åŸæ•°æ®å³å¯ï¼Œä¸éœ€è¦ä¸€æ¡ä¸€æ¡åœ°æ‰§è¡Œå‘½ä»¤ï¼Œé€Ÿåº¦éå¸¸å¿«ã€‚è€Œ AOF åˆ™éœ€è¦ä¾æ¬¡æ‰§è¡Œæ¯ä¸ªå†™å‘½ä»¤ï¼Œé€Ÿåº¦éå¸¸æ…¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ AOF ç›¸æ¯”ï¼Œæ¢å¤å¤§æ•°æ®é›†çš„æ—¶å€™ï¼ŒRDB é€Ÿåº¦æ›´å¿«ã€‚ AOF æ¯” RDB ä¼˜ç§€çš„åœ°æ–¹ ï¼š\nRDB çš„æ•°æ®å®‰å…¨æ€§ä¸å¦‚ AOFï¼Œæ²¡æœ‰åŠæ³•å®æ—¶æˆ–è€…ç§’çº§æŒä¹…åŒ–æ•°æ®ã€‚ç”Ÿæˆ RDB æ–‡ä»¶çš„è¿‡ç¨‹æ˜¯æ¯”ç¹é‡çš„ï¼Œ è™½ç„¶ BGSAVE å­è¿›ç¨‹å†™å…¥ RDB æ–‡ä»¶çš„å·¥ä½œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œä½†ä¼šå¯¹æœºå™¨çš„ CPU èµ„æºå’Œå†…å­˜èµ„æºäº§ç”Ÿå½±å“ï¼Œä¸¥é‡çš„æƒ…å†µä¸‹ç”šè‡³ä¼šç›´æ¥æŠŠ Redis æœåŠ¡å¹²å®•æœºã€‚AOF æ”¯æŒç§’çº§æ•°æ®ä¸¢å¤±ï¼ˆå–å†³ fsync ç­–ç•¥ï¼Œå¦‚æœæ˜¯ everysecï¼Œæœ€å¤šä¸¢å¤± 1 ç§’çš„æ•°æ®ï¼‰ï¼Œä»…ä»…æ˜¯è¿½åŠ å‘½ä»¤åˆ° AOF æ–‡ä»¶ï¼Œæ“ä½œè½»é‡ã€‚ RDB æ–‡ä»¶æ˜¯ä»¥ç‰¹å®šçš„äºŒè¿›åˆ¶æ ¼å¼ä¿å­˜çš„ï¼Œå¹¶ä¸”åœ¨ Redis ç‰ˆæœ¬æ¼”è¿›ä¸­æœ‰å¤šä¸ªç‰ˆæœ¬çš„ RDBï¼Œæ‰€ä»¥å­˜åœ¨è€ç‰ˆæœ¬çš„ Redis æœåŠ¡ä¸å…¼å®¹æ–°ç‰ˆæœ¬çš„ RDB æ ¼å¼çš„é—®é¢˜ã€‚ AOF ä»¥ä¸€ç§æ˜“äºç†è§£å’Œè§£æçš„æ ¼å¼åŒ…å«æ‰€æœ‰æ“ä½œçš„æ—¥å¿—ã€‚ä½ å¯ä»¥è½»æ¾åœ°å¯¼å‡º AOF æ–‡ä»¶è¿›è¡Œåˆ†æï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥æ“ä½œ AOF æ–‡ä»¶æ¥è§£å†³ä¸€äº›é—®é¢˜ã€‚æ¯”å¦‚ï¼Œå¦‚æœæ‰§è¡ŒFLUSHALLå‘½ä»¤æ„å¤–åœ°åˆ·æ–°äº†æ‰€æœ‰å†…å®¹åï¼Œåªè¦ AOF æ–‡ä»¶æ²¡æœ‰è¢«é‡å†™ï¼Œåˆ é™¤æœ€æ–°å‘½ä»¤å¹¶é‡å¯å³å¯æ¢å¤ä¹‹å‰çš„çŠ¶æ€ã€‚ Redis 4.0 å¯¹äºæŒä¹…åŒ–æœºåˆ¶åšäº†ä»€ä¹ˆä¼˜åŒ–ï¼Ÿ # ç”±äº RDB å’Œ AOF å„æœ‰ä¼˜åŠ¿ï¼Œäºæ˜¯ï¼ŒRedis 4.0 å¼€å§‹æ”¯æŒ RDB å’Œ AOF çš„æ··åˆæŒä¹…åŒ–ï¼ˆé»˜è®¤å…³é—­ï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹ aof-use-rdb-preamble å¼€å¯ï¼‰ã€‚\nå¦‚æœæŠŠæ··åˆæŒä¹…åŒ–æ‰“å¼€ï¼ŒAOF é‡å†™çš„æ—¶å€™å°±ç›´æ¥æŠŠ RDB çš„å†…å®¹å†™åˆ° AOF æ–‡ä»¶å¼€å¤´ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥ç»“åˆ RDB å’Œ AOF çš„ä¼˜ç‚¹, å¿«é€ŸåŠ è½½åŒæ—¶é¿å…ä¸¢å¤±è¿‡å¤šçš„æ•°æ®ã€‚å½“ç„¶ç¼ºç‚¹ä¹Ÿæ˜¯æœ‰çš„ï¼Œ AOF é‡Œé¢çš„ RDB éƒ¨åˆ†æ˜¯å‹ç¼©æ ¼å¼ä¸å†æ˜¯ AOF æ ¼å¼ï¼Œå¯è¯»æ€§è¾ƒå·®ã€‚\nå®˜æ–¹æ–‡æ¡£åœ°å€ï¼šhttps://redis.io/topics/persistence\nå‚è€ƒ # ã€ŠRedis å¼€å‘ä¸è¿ç»´ã€‹ ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹ Redis å‘½ä»¤æ‰‹å†Œï¼šhttps://www.redis.com.cn/commands.html WHY Redis choose single thread (vs multi threads): https://medium.com/@jychen7/sharing-redis-single-thread-vs-multi-threads-5870bd44d153 The difference between AOF and RDB persistenceï¼šhttps://www.sobyte.net/post/2022-04/redis-rdb-and-aof/ "},{"id":57,"href":"/zh/docs/study/Review/java_guide/lycly_system-design/web-real-time-message-push/","title":"web-real-time-message-push","section":"ç³»ç»Ÿè®¾è®¡","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nåŸæ–‡åœ°å€ï¼šhttps://juejin.cn/post/7122014462181113887ï¼ŒJavaGuide å¯¹æœ¬æ–‡è¿›è¡Œäº†å®Œå–„æ€»ç»“ã€‚\næˆ‘æœ‰ä¸€ä¸ªæœ‹å‹åšäº†ä¸€ä¸ªå°ç ´ç«™ï¼Œç°åœ¨è¦å®ç°ä¸€ä¸ªç«™å†…ä¿¡ Web æ¶ˆæ¯æ¨é€çš„åŠŸèƒ½ï¼Œå¯¹ï¼Œå°±æ˜¯ä¸‹å›¾è¿™ä¸ªå°çº¢ç‚¹ï¼Œä¸€ä¸ªå¾ˆå¸¸ç”¨çš„åŠŸèƒ½ã€‚\nä¸è¿‡ä»–è¿˜æ²¡æƒ³å¥½ç”¨ä»€ä¹ˆæ–¹å¼åšï¼Œè¿™é‡Œæˆ‘å¸®ä»–æ•´ç†äº†ä¸€ä¸‹å‡ ç§æ–¹æ¡ˆï¼Œå¹¶ç®€å•åšäº†å®ç°ã€‚\n# ä»€ä¹ˆæ˜¯æ¶ˆæ¯æ¨é€ï¼Ÿ # æ¨é€çš„åœºæ™¯æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚æœ‰äººå…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼Œè¿™æ—¶æˆ‘å°±ä¼šæ”¶åˆ°ä¸€æ¡æ¨é€æ¶ˆæ¯ï¼Œä»¥æ­¤æ¥å¸å¼•æˆ‘ç‚¹å‡»æ‰“å¼€åº”ç”¨ã€‚\næ¶ˆæ¯æ¨é€é€šå¸¸æ˜¯æŒ‡ç½‘ç«™çš„è¿è¥å·¥ä½œç­‰äººå‘˜ï¼Œé€šè¿‡æŸç§å·¥å…·å¯¹ç”¨æˆ·å½“å‰ç½‘é¡µæˆ–ç§»åŠ¨è®¾å¤‡ APP è¿›è¡Œçš„ä¸»åŠ¨æ¶ˆæ¯æ¨é€ã€‚\næ¶ˆæ¯æ¨é€ä¸€èˆ¬åˆåˆ†ä¸º Web ç«¯æ¶ˆæ¯æ¨é€å’Œç§»åŠ¨ç«¯æ¶ˆæ¯æ¨é€ã€‚\nç§»åŠ¨ç«¯æ¶ˆæ¯æ¨é€ç¤ºä¾‹ ï¼š\nWeb ç«¯æ¶ˆæ¯æ¨é€ç¤ºä¾‹ï¼š\nåœ¨å…·ä½“å®ç°ä¹‹å‰ï¼Œå’±ä»¬å†æ¥åˆ†æä¸€ä¸‹å‰è¾¹çš„éœ€æ±‚ï¼Œå…¶å®åŠŸèƒ½å¾ˆç®€å•ï¼Œåªè¦è§¦å‘æŸä¸ªäº‹ä»¶ï¼ˆä¸»åŠ¨åˆ†äº«äº†èµ„æºæˆ–è€…åå°ä¸»åŠ¨æ¨é€æ¶ˆæ¯ï¼‰ï¼ŒWeb é¡µé¢çš„é€šçŸ¥å°çº¢ç‚¹å°±ä¼šå®æ—¶çš„ +1 å°±å¯ä»¥äº†ã€‚\né€šå¸¸åœ¨æœåŠ¡ç«¯ä¼šæœ‰è‹¥å¹²å¼ æ¶ˆæ¯æ¨é€è¡¨ï¼Œç”¨æ¥è®°å½•ç”¨æˆ·è§¦å‘ä¸åŒäº‹ä»¶æ‰€æ¨é€ä¸åŒç±»å‹çš„æ¶ˆæ¯ï¼Œå‰ç«¯ä¸»åŠ¨æŸ¥è¯¢ï¼ˆæ‹‰ï¼‰æˆ–è€…è¢«åŠ¨æ¥æ”¶ï¼ˆæ¨ï¼‰ç”¨æˆ·æ‰€æœ‰æœªè¯»çš„æ¶ˆæ¯æ•°ã€‚\næ¶ˆæ¯æ¨é€æ— éæ˜¯æ¨ï¼ˆpushï¼‰å’Œæ‹‰ï¼ˆpullï¼‰ä¸¤ç§å½¢å¼ï¼Œä¸‹è¾¹æˆ‘ä»¬é€ä¸ªäº†è§£ä¸‹ã€‚\n# æ¶ˆæ¯æ¨é€å¸¸è§æ–¹æ¡ˆ # # çŸ­è½®è¯¢ # è½®è¯¢(polling) åº”è¯¥æ˜¯å®ç°æ¶ˆæ¯æ¨é€æ–¹æ¡ˆä¸­æœ€ç®€å•çš„ä¸€ç§ï¼Œè¿™é‡Œæˆ‘ä»¬æš‚ä¸”å°†è½®è¯¢åˆ†ä¸ºçŸ­è½®è¯¢å’Œé•¿è½®è¯¢ã€‚\nçŸ­è½®è¯¢å¾ˆå¥½ç†è§£ï¼ŒæŒ‡å®šçš„æ—¶é—´é—´éš”ï¼Œç”±æµè§ˆå™¨å‘æœåŠ¡å™¨å‘å‡º HTTP è¯·æ±‚ï¼ŒæœåŠ¡å™¨å®æ—¶è¿”å›æœªè¯»æ¶ˆæ¯æ•°æ®ç»™å®¢æˆ·ç«¯ï¼Œæµè§ˆå™¨å†åšæ¸²æŸ“æ˜¾ç¤ºã€‚\nä¸€ä¸ªç®€å•çš„ JS å®šæ—¶å™¨å°±å¯ä»¥æå®šï¼Œæ¯ç§’é’Ÿè¯·æ±‚ä¸€æ¬¡æœªè¯»æ¶ˆæ¯æ•°æ¥å£ï¼Œè¿”å›çš„æ•°æ®å±•ç¤ºå³å¯ã€‚\nsetInterval(() =\u0026gt; { // æ–¹æ³•è¯·æ±‚ messageCount().then((res) =\u0026gt; { if (res.code === 200) { this.messageCount = res.data } }) }, 1000); æ•ˆæœè¿˜æ˜¯å¯ä»¥çš„ï¼ŒçŸ­è½®è¯¢å®ç°å›ºç„¶ç®€å•ï¼Œç¼ºç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§ï¼Œç”±äºæ¨é€æ•°æ®å¹¶ä¸ä¼šé¢‘ç¹å˜æ›´ï¼Œæ— è®ºåç«¯æ­¤æ—¶æ˜¯å¦æœ‰æ–°çš„æ¶ˆæ¯äº§ç”Ÿï¼Œå®¢æˆ·ç«¯éƒ½ä¼šè¿›è¡Œè¯·æ±‚ï¼ŒåŠ¿å¿…ä¼šå¯¹æœåŠ¡ç«¯é€ æˆå¾ˆå¤§å‹åŠ›ï¼Œæµªè´¹å¸¦å®½å’ŒæœåŠ¡å™¨èµ„æºã€‚\n# é•¿è½®è¯¢ # é•¿è½®è¯¢æ˜¯å¯¹ä¸Šè¾¹çŸ­è½®è¯¢çš„ä¸€ç§æ”¹è¿›ç‰ˆæœ¬ï¼Œåœ¨å°½å¯èƒ½å‡å°‘å¯¹æœåŠ¡å™¨èµ„æºæµªè´¹çš„åŒæ—¶ï¼Œä¿è¯æ¶ˆæ¯çš„ç›¸å¯¹å®æ—¶æ€§ã€‚é•¿è½®è¯¢åœ¨ä¸­é—´ä»¶ä¸­åº”ç”¨çš„å¾ˆå¹¿æ³›ï¼Œæ¯”å¦‚ Nacos å’Œ Apollo é…ç½®ä¸­å¿ƒï¼Œæ¶ˆæ¯é˜Ÿåˆ— Kafkaã€RocketMQ ä¸­éƒ½æœ‰ç”¨åˆ°é•¿è½®è¯¢ã€‚\nNacos é…ç½®ä¸­å¿ƒäº¤äº’æ¨¡å‹æ˜¯ push è¿˜æ˜¯ pullï¼Ÿopen in new windowä¸€æ–‡ä¸­æˆ‘è¯¦ç»†ä»‹ç»è¿‡ Nacos é•¿è½®è¯¢çš„å®ç°åŸç†ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥ç…ç…ã€‚\né•¿è½®è¯¢å…¶å®åŸç†è·Ÿè½®è¯¢å·®ä¸å¤šï¼Œéƒ½æ˜¯é‡‡ç”¨è½®è¯¢çš„æ–¹å¼ã€‚ä¸è¿‡ï¼Œå¦‚æœæœåŠ¡ç«¯çš„æ•°æ®æ²¡æœ‰å‘ç”Ÿå˜æ›´ï¼Œä¼š ä¸€ç›´ hold ä½è¯·æ±‚ï¼Œç›´åˆ°æœåŠ¡ç«¯çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæˆ–è€…ç­‰å¾…ä¸€å®šæ—¶é—´è¶…æ—¶æ‰ä¼šè¿”å›ã€‚è¿”å›åï¼Œå®¢æˆ·ç«¯åˆä¼šç«‹å³å†æ¬¡å‘èµ·ä¸‹ä¸€æ¬¡é•¿è½®è¯¢ã€‚\nè¿™æ¬¡æˆ‘ä½¿ç”¨ Apollo é…ç½®ä¸­å¿ƒå®ç°é•¿è½®è¯¢çš„æ–¹å¼ï¼Œåº”ç”¨äº†ä¸€ä¸ªç±»DeferredResultï¼Œå®ƒæ˜¯åœ¨ Servelet3.0 åç»è¿‡ Spring å°è£…æä¾›çš„ä¸€ç§å¼‚æ­¥è¯·æ±‚æœºåˆ¶ï¼Œç›´æ„å°±æ˜¯å»¶è¿Ÿç»“æœã€‚\nDeferredResultå¯ä»¥å…è®¸å®¹å™¨çº¿ç¨‹å¿«é€Ÿé‡Šæ”¾å ç”¨çš„èµ„æºï¼Œä¸é˜»å¡è¯·æ±‚çº¿ç¨‹ï¼Œä»¥æ­¤æ¥å—æ›´å¤šçš„è¯·æ±‚æå‡ç³»ç»Ÿçš„ååé‡ï¼Œç„¶åå¯åŠ¨å¼‚æ­¥å·¥ä½œçº¿ç¨‹å¤„ç†çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¤„ç†å®Œæˆè°ƒç”¨DeferredResult.setResult(200)æäº¤å“åº”ç»“æœã€‚\nä¸‹è¾¹æˆ‘ä»¬ç”¨é•¿è½®è¯¢æ¥å®ç°æ¶ˆæ¯æ¨é€ã€‚\nå› ä¸ºä¸€ä¸ª ID å¯èƒ½ä¼šè¢«å¤šä¸ªé•¿è½®è¯¢è¯·æ±‚ç›‘å¬ï¼Œæ‰€ä»¥æˆ‘é‡‡ç”¨äº† Guava åŒ…æä¾›çš„Multimapç»“æ„å­˜æ”¾é•¿è½®è¯¢ï¼Œä¸€ä¸ª key å¯ä»¥å¯¹åº”å¤šä¸ª valueã€‚ä¸€æ—¦ç›‘å¬åˆ° key å‘ç”Ÿå˜åŒ–ï¼Œå¯¹åº”çš„æ‰€æœ‰é•¿è½®è¯¢éƒ½ä¼šå“åº”ã€‚å‰ç«¯å¾—åˆ°éè¯·æ±‚è¶…æ—¶çš„çŠ¶æ€ç ï¼ŒçŸ¥æ™“æ•°æ®å˜æ›´ï¼Œä¸»åŠ¨æŸ¥è¯¢æœªè¯»æ¶ˆæ¯æ•°æ¥å£ï¼Œæ›´æ–°é¡µé¢æ•°æ®ã€‚\n@Controller @RequestMapping(\u0026#34;/polling\u0026#34;) public class PollingController { // å­˜æ”¾ç›‘å¬æŸä¸ªIdçš„é•¿è½®è¯¢é›†åˆ // çº¿ç¨‹åŒæ­¥ç»“æ„ public static Multimap\u0026lt;String, DeferredResult\u0026lt;String\u0026gt;\u0026gt; watchRequests = Multimaps.synchronizedMultimap(HashMultimap.create()); /** * è®¾ç½®ç›‘å¬ */ @GetMapping(path = \u0026#34;watch/{id}\u0026#34;) @ResponseBody public DeferredResult\u0026lt;String\u0026gt; watch(@PathVariable String id) { // å»¶è¿Ÿå¯¹è±¡è®¾ç½®è¶…æ—¶æ—¶é—´ DeferredResult\u0026lt;String\u0026gt; deferredResult = new DeferredResult\u0026lt;\u0026gt;(TIME_OUT); // å¼‚æ­¥è¯·æ±‚å®Œæˆæ—¶ç§»é™¤ keyï¼Œé˜²æ­¢å†…å­˜æº¢å‡º deferredResult.onCompletion(() -\u0026gt; { watchRequests.remove(id, deferredResult); }); // æ³¨å†Œé•¿è½®è¯¢è¯·æ±‚ watchRequests.put(id, deferredResult); return deferredResult; } /** * å˜æ›´æ•°æ® */ @GetMapping(path = \u0026#34;publish/{id}\u0026#34;) @ResponseBody public String publish(@PathVariable String id) { // æ•°æ®å˜æ›´ å–å‡ºç›‘å¬IDçš„æ‰€æœ‰é•¿è½®è¯¢è¯·æ±‚ï¼Œå¹¶ä¸€ä¸€å“åº”å¤„ç† if (watchRequests.containsKey(id)) { Collection\u0026lt;DeferredResult\u0026lt;String\u0026gt;\u0026gt; deferredResults = watchRequests.get(id); for (DeferredResult\u0026lt;String\u0026gt; deferredResult : deferredResults) { deferredResult.setResult(\u0026#34;æˆ‘æ›´æ–°äº†\u0026#34; + new Date()); } } return \u0026#34;success\u0026#34;; } å½“è¯·æ±‚è¶…è¿‡è®¾ç½®çš„è¶…æ—¶æ—¶é—´ï¼Œä¼šæŠ›å‡ºAsyncRequestTimeoutExceptionå¼‚å¸¸ï¼Œè¿™é‡Œç›´æ¥ç”¨@ControllerAdviceå…¨å±€æ•è·ç»Ÿä¸€è¿”å›å³å¯ï¼Œå‰ç«¯è·å–çº¦å®šå¥½çš„çŠ¶æ€ç åå†æ¬¡å‘èµ·é•¿è½®è¯¢è¯·æ±‚ï¼Œå¦‚æ­¤å¾€å¤è°ƒç”¨ã€‚\n@ControllerAdvice public class AsyncRequestTimeoutHandler { @ResponseStatus(HttpStatus.NOT_MODIFIED) @ResponseBody @ExceptionHandler(AsyncRequestTimeoutException.class) public String asyncRequestTimeoutHandler(AsyncRequestTimeoutException e) { System.out.println(\u0026#34;å¼‚æ­¥è¯·æ±‚è¶…æ—¶\u0026#34;); return \u0026#34;304\u0026#34;; } } æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œé¦–å…ˆé¡µé¢å‘èµ·é•¿è½®è¯¢è¯·æ±‚/polling/watch/10086ç›‘å¬æ¶ˆæ¯æ›´å˜ï¼Œè¯·æ±‚è¢«æŒ‚èµ·ï¼Œä¸å˜æ›´æ•°æ®ç›´è‡³è¶…æ—¶ï¼Œå†æ¬¡å‘èµ·äº†é•¿è½®è¯¢è¯·æ±‚ï¼›ç´§æ¥ç€æ‰‹åŠ¨å˜æ›´æ•°æ®/polling/publish/10086ï¼Œé•¿è½®è¯¢å¾—åˆ°å“åº”ï¼Œå‰ç«¯å¤„ç†ä¸šåŠ¡é€»è¾‘å®Œæˆåå†æ¬¡å‘èµ·è¯·æ±‚ï¼Œå¦‚æ­¤å¾ªç¯å¾€å¤ã€‚\né•¿è½®è¯¢ç›¸æ¯”äºçŸ­è½®è¯¢åœ¨æ€§èƒ½ä¸Šæå‡äº†å¾ˆå¤šï¼Œä½†ä¾ç„¶ä¼šäº§ç”Ÿè¾ƒå¤šçš„è¯·æ±‚ï¼Œè¿™æ˜¯å®ƒçš„ä¸€ç‚¹ä¸å®Œç¾çš„åœ°æ–¹ã€‚\n# iframe æµ # iframe æµå°±æ˜¯åœ¨é¡µé¢ä¸­æ’å…¥ä¸€ä¸ªéšè—çš„\u0026lt;iframe\u0026gt;æ ‡ç­¾ï¼Œé€šè¿‡åœ¨srcä¸­è¯·æ±‚æ¶ˆæ¯æ•°é‡ API æ¥å£ï¼Œç”±æ­¤åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´åˆ›å»ºä¸€æ¡é•¿è¿æ¥ï¼ŒæœåŠ¡ç«¯æŒç»­å‘iframeä¼ è¾“æ•°æ®ã€‚\nä¼ è¾“çš„æ•°æ®é€šå¸¸æ˜¯ HTMLã€æˆ–æ˜¯å†…åµŒçš„JavaScript è„šæœ¬ï¼Œæ¥è¾¾åˆ°å®æ—¶æ›´æ–°é¡µé¢çš„æ•ˆæœã€‚\nè¿™ç§æ–¹å¼å®ç°ç®€å•ï¼Œå‰ç«¯åªè¦ä¸€ä¸ª\u0026lt;iframe\u0026gt;æ ‡ç­¾æå®šäº†\n\u0026lt;iframe src=\u0026#34;/iframe/message\u0026#34; style=\u0026#34;display:none\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; æœåŠ¡ç«¯ç›´æ¥ç»„è£… HTMLã€JS è„šæœ¬æ•°æ®å‘ response å†™å…¥å°±è¡Œäº†\n@Controller @RequestMapping(\u0026#34;/iframe\u0026#34;) public class IframeController { @GetMapping(path = \u0026#34;message\u0026#34;) public void message(HttpServletResponse response) throws IOException, InterruptedException { while (true) { response.setHeader(\u0026#34;Pragma\u0026#34;, \u0026#34;no-cache\u0026#34;); response.setDateHeader(\u0026#34;Expires\u0026#34;, 0); response.setHeader(\u0026#34;Cache-Control\u0026#34;, \u0026#34;no-cache,no-store\u0026#34;); response.setStatus(HttpServletResponse.SC_OK); response.getWriter().print(\u0026#34; \u0026lt;script type=\\\u0026#34;text/javascript\\\u0026#34;\u0026gt;\\n\u0026#34; + \u0026#34;parent.document.getElementById(\u0026#39;clock\u0026#39;).innerHTML = \\\u0026#34;\u0026#34; + count.get() + \u0026#34;\\\u0026#34;;\u0026#34; + \u0026#34;parent.document.getElementById(\u0026#39;count\u0026#39;).innerHTML = \\\u0026#34;\u0026#34; + count.get() + \u0026#34;\\\u0026#34;;\u0026#34; + \u0026#34;\u0026lt;/script\u0026gt;\u0026#34;); } } } iframe æµçš„æœåŠ¡å™¨å¼€é”€å¾ˆå¤§ï¼Œè€Œä¸”IEã€Chromeç­‰æµè§ˆå™¨ä¸€ç›´ä¼šå¤„äº loading çŠ¶æ€ï¼Œå›¾æ ‡ä¼šä¸åœæ—‹è½¬ï¼Œç®€ç›´æ˜¯å¼ºè¿«ç—‡æ€æ‰‹ã€‚\niframe æµéå¸¸ä¸å‹å¥½ï¼Œå¼ºçƒˆä¸æ¨èã€‚\n# SSE (æˆ‘çš„æ–¹å¼) # å¾ˆå¤šäººå¯èƒ½ä¸çŸ¥é“ï¼ŒæœåŠ¡ç«¯å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯ï¼Œå…¶å®é™¤äº†å¯ä»¥ç”¨WebSocketè¿™ç§è€³ç†Ÿèƒ½è¯¦çš„æœºåˆ¶å¤–ï¼Œè¿˜æœ‰ä¸€ç§æœåŠ¡å™¨å‘é€äº‹ä»¶(Server-Sent Events)ï¼Œç®€ç§° SSEã€‚è¿™æ˜¯ä¸€ç§æœåŠ¡å™¨ç«¯åˆ°å®¢æˆ·ç«¯(æµè§ˆå™¨)çš„å•å‘æ¶ˆæ¯æ¨é€ã€‚\nSSE åŸºäº HTTP åè®®çš„ï¼Œæˆ‘ä»¬çŸ¥é“ä¸€èˆ¬æ„ä¹‰ä¸Šçš„ HTTP åè®®æ˜¯æ— æ³•åšåˆ°æœåŠ¡ç«¯ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯çš„ï¼Œä½† SSE æ˜¯ä¸ªä¾‹å¤–ï¼Œå®ƒå˜æ¢äº†ä¸€ç§æ€è·¯ã€‚\nSSE åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´æ‰“å¼€ä¸€ä¸ªå•å‘é€šé“ï¼ŒæœåŠ¡ç«¯å“åº”çš„ä¸å†æ˜¯ä¸€æ¬¡æ€§çš„æ•°æ®åŒ…è€Œæ˜¯text/event-streamç±»å‹çš„æ•°æ®æµä¿¡æ¯ï¼Œåœ¨æœ‰æ•°æ®å˜æ›´æ—¶ä»æœåŠ¡å™¨æµå¼ä¼ è¾“åˆ°å®¢æˆ·ç«¯ã€‚\næ•´ä½“çš„å®ç°æ€è·¯æœ‰ç‚¹ç±»ä¼¼äºåœ¨çº¿è§†é¢‘æ’­æ”¾ï¼Œè§†é¢‘æµä¼šè¿ç»­ä¸æ–­çš„æ¨é€åˆ°æµè§ˆå™¨ï¼Œä½ ä¹Ÿå¯ä»¥ç†è§£æˆï¼Œå®¢æˆ·ç«¯åœ¨å®Œæˆä¸€æ¬¡ç”¨æ—¶å¾ˆé•¿ï¼ˆç½‘ç»œä¸ç•…ï¼‰çš„ä¸‹è½½ã€‚\nSSE ä¸ WebSocket ä½œç”¨ç›¸ä¼¼ï¼Œéƒ½å¯ä»¥å»ºç«‹æœåŠ¡ç«¯ä¸æµè§ˆå™¨ä¹‹é—´çš„é€šä¿¡ï¼Œå®ç°æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯ï¼Œä½†è¿˜æ˜¯æœ‰äº›è®¸ä¸åŒï¼š\nSSE æ˜¯åŸºäº HTTP åè®®çš„ï¼Œå®ƒä»¬ä¸éœ€è¦ç‰¹æ®Šçš„åè®®æˆ–æœåŠ¡å™¨å®ç°å³å¯å·¥ä½œï¼›WebSocket éœ€å•ç‹¬æœåŠ¡å™¨æ¥å¤„ç†åè®®ã€‚ SSE å•å‘é€šä¿¡ï¼Œåªèƒ½ç”±æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å•å‘é€šä¿¡ï¼›WebSocket å…¨åŒå·¥é€šä¿¡ï¼Œå³é€šä¿¡çš„åŒæ–¹å¯ä»¥åŒæ—¶å‘é€å’Œæ¥å—ä¿¡æ¯ã€‚ SSE å®ç°ç®€å•å¼€å‘æˆæœ¬ä½ï¼Œæ— éœ€å¼•å…¥å…¶ä»–ç»„ä»¶ï¼›WebSocket ä¼ è¾“æ•°æ®éœ€åšäºŒæ¬¡è§£æï¼Œå¼€å‘é—¨æ§›é«˜ä¸€äº›ã€‚ SSE é»˜è®¤æ”¯æŒæ–­çº¿é‡è¿ï¼›WebSocket åˆ™éœ€è¦è‡ªå·±å®ç°ã€‚ SSE åªèƒ½ä¼ é€æ–‡æœ¬æ¶ˆæ¯ï¼ŒäºŒè¿›åˆ¶æ•°æ®éœ€è¦ç»è¿‡ç¼–ç åä¼ é€ï¼›WebSocket é»˜è®¤æ”¯æŒä¼ é€äºŒè¿›åˆ¶æ•°æ®ã€‚ SSE ä¸ WebSocket è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ\næŠ€æœ¯å¹¶æ²¡æœ‰å¥½åä¹‹åˆ†ï¼Œåªæœ‰å“ªä¸ªæ›´åˆé€‚\nSSE å¥½åƒä¸€ç›´ä¸è¢«å¤§å®¶æ‰€ç†ŸçŸ¥ï¼Œä¸€éƒ¨åˆ†åŸå› æ˜¯å‡ºç°äº† WebSocketï¼Œè¿™ä¸ªæä¾›äº†æ›´ä¸°å¯Œçš„åè®®æ¥æ‰§è¡ŒåŒå‘ã€å…¨åŒå·¥é€šä¿¡ã€‚å¯¹äºæ¸¸æˆã€å³æ—¶é€šä¿¡ä»¥åŠéœ€è¦åŒå‘è¿‘ä¹å®æ—¶æ›´æ–°çš„åœºæ™¯ï¼Œæ‹¥æœ‰åŒå‘é€šé“æ›´å…·å¸å¼•åŠ›ã€‚\nä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸éœ€è¦ä»å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚è€Œä½ åªéœ€è¦ä¸€äº›æœåŠ¡å™¨æ“ä½œçš„æ›´æ–°ã€‚æ¯”å¦‚ï¼šç«™å†…ä¿¡ã€æœªè¯»æ¶ˆæ¯æ•°ã€çŠ¶æ€æ›´æ–°ã€è‚¡ç¥¨è¡Œæƒ…ã€ç›‘æ§æ•°é‡ç­‰åœºæ™¯ï¼ŒSEE ä¸ç®¡æ˜¯ä»å®ç°çš„éš¾æ˜“å’Œæˆæœ¬ä¸Šéƒ½æ›´åŠ æœ‰ä¼˜åŠ¿ã€‚æ­¤å¤–ï¼ŒSSE å…·æœ‰ WebSocket åœ¨è®¾è®¡ä¸Šç¼ºä¹çš„å¤šç§åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šè‡ªåŠ¨é‡æ–°è¿æ¥ã€äº‹ä»¶ ID å’Œå‘é€ä»»æ„äº‹ä»¶çš„èƒ½åŠ›ã€‚\nå‰ç«¯åªéœ€è¿›è¡Œä¸€æ¬¡ HTTP è¯·æ±‚ï¼Œå¸¦ä¸Šå”¯ä¸€ IDï¼Œæ‰“å¼€äº‹ä»¶æµï¼Œç›‘å¬æœåŠ¡ç«¯æ¨é€çš„äº‹ä»¶å°±å¯ä»¥äº†\n\u0026lt;script\u0026gt; let source = null; let userId = 7777 if (window.EventSource) { // å»ºç«‹è¿æ¥ source = new EventSource(\u0026#39;http://localhost:7777/sse/sub/\u0026#39;+userId); setMessageInnerHTML(\u0026#34;è¿æ¥ç”¨æˆ·=\u0026#34; + userId); /** * è¿æ¥ä¸€æ—¦å»ºç«‹ï¼Œå°±ä¼šè§¦å‘openäº‹ä»¶ * å¦ä¸€ç§å†™æ³•ï¼šsource.onopen = function (event) {} */ source.addEventListener(\u0026#39;open\u0026#39;, function (e) { setMessageInnerHTML(\u0026#34;å»ºç«‹è¿æ¥ã€‚ã€‚ã€‚\u0026#34;); }, false); /** * å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨å‘æ¥çš„æ•°æ® * å¦ä¸€ç§å†™æ³•ï¼šsource.onmessage = function (event) {} */ source.addEventListener(\u0026#39;message\u0026#39;, function (e) { setMessageInnerHTML(e.data); }); } else { setMessageInnerHTML(\u0026#34;ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒSSE\u0026#34;); } \u0026lt;/script\u0026gt; æœåŠ¡ç«¯çš„å®ç°æ›´ç®€å•ï¼Œåˆ›å»ºä¸€ä¸ªSseEmitterå¯¹è±¡æ”¾å…¥sseEmitterMapè¿›è¡Œç®¡ç†\nprivate static Map\u0026lt;String, SseEmitter\u0026gt; sseEmitterMap = new ConcurrentHashMap\u0026lt;\u0026gt;(); /** * åˆ›å»ºè¿æ¥ */ public static SseEmitter connect(String userId) { try { // è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œ0è¡¨ç¤ºä¸è¿‡æœŸã€‚é»˜è®¤30ç§’ SseEmitter sseEmitter = new SseEmitter(0L); // æ³¨å†Œå›è°ƒ sseEmitter.onCompletion(completionCallBack(userId)); sseEmitter.onError(errorCallBack(userId)); sseEmitter.onTimeout(timeoutCallBack(userId)); sseEmitterMap.put(userId, sseEmitter); count.getAndIncrement(); return sseEmitter; } catch (Exception e) { log.info(\u0026#34;åˆ›å»ºæ–°çš„sseè¿æ¥å¼‚å¸¸ï¼Œå½“å‰ç”¨æˆ·ï¼š{}\u0026#34;, userId); } return null; } /** * ç»™æŒ‡å®šç”¨æˆ·å‘é€æ¶ˆæ¯ */ public static void sendMessage(String userId, String message) { if (sseEmitterMap.containsKey(userId)) { try { sseEmitterMap.get(userId).send(message); } catch (IOException e) { log.error(\u0026#34;ç”¨æˆ·[{}]æ¨é€å¼‚å¸¸:{}\u0026#34;, userId, e.getMessage()); removeUser(userId); } } } æ³¨æ„ï¼š SSE ä¸æ”¯æŒ IE æµè§ˆå™¨ï¼Œå¯¹å…¶ä»–ä¸»æµæµè§ˆå™¨å…¼å®¹æ€§åšçš„è¿˜ä¸é”™ã€‚\n# Websocket # Websocket åº”è¯¥æ˜¯å¤§å®¶éƒ½æ¯”è¾ƒç†Ÿæ‚‰çš„ä¸€ç§å®ç°æ¶ˆæ¯æ¨é€çš„æ–¹å¼ï¼Œä¸Šè¾¹æˆ‘ä»¬åœ¨è®² SSE çš„æ—¶å€™ä¹Ÿå’Œ Websocket è¿›è¡Œè¿‡æ¯”è¾ƒã€‚\næ˜¯ä¸€ç§åœ¨ TCP è¿æ¥ä¸Šè¿›è¡Œå…¨åŒå·¥é€šä¿¡çš„åè®®ï¼Œå»ºç«‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ¸ é“ã€‚æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä»…éœ€ä¸€æ¬¡æ¡æ‰‹ï¼Œä¸¤è€…ä¹‹é—´å°±ç›´æ¥å¯ä»¥åˆ›å»ºæŒä¹…æ€§çš„è¿æ¥ï¼Œå¹¶è¿›è¡ŒåŒå‘æ•°æ®ä¼ è¾“ã€‚\nSpringBoot æ•´åˆ Websocketï¼Œå…ˆå¼•å…¥ Websocket ç›¸å…³çš„å·¥å…·åŒ…ï¼Œå’Œ SSE ç›¸æ¯”é¢å¤–çš„å¼€å‘æˆæœ¬ã€‚\n\u0026lt;!-- å¼•å…¥websocket --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-websocket\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!--å¯èƒ½éœ€è¦æ’é™¤springbootè‡ªå¸¦çš„tomcat--\u0026gt; æœåŠ¡ç«¯ä½¿ç”¨@ServerEndpointæ³¨è§£æ ‡æ³¨å½“å‰ç±»ä¸ºä¸€ä¸ª WebSocket æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ws://localhost:7777/webSocket/10086æ¥è¿æ¥åˆ° WebSocket æœåŠ¡å™¨ç«¯ã€‚\n@Component @Slf4j @ServerEndpoint(\u0026#34;/websocket/{userId}\u0026#34;) public class MyWebSocket { //ä¸æŸä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ä¼šè¯ï¼Œéœ€è¦é€šè¿‡å®ƒæ¥ç»™å®¢æˆ·ç«¯å‘é€æ•°æ® private Session session; private static final CopyOnWriteArraySet\u0026lt;MyWebSocket\u0026gt; webSockets = new CopyOnWriteArraySet\u0026lt;\u0026gt;(); // ç”¨æ¥å­˜åœ¨çº¿è¿æ¥æ•° private static final Map\u0026lt;String, Session\u0026gt; sessionPool = new HashMap\u0026lt;String, Session\u0026gt;(); /** * é“¾æ¥æˆåŠŸè°ƒç”¨çš„æ–¹æ³• */ @OnOpen public void onOpen(Session session, @PathParam(value = \u0026#34;userId\u0026#34;) String userId) { try { this.session = session; webSockets.add(this); sessionPool.put(userId, session); log.info(\u0026#34;websocketæ¶ˆæ¯: æœ‰æ–°çš„è¿æ¥ï¼Œæ€»æ•°ä¸º:\u0026#34; + webSockets.size()); } catch (Exception e) { } } /** * æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯åè°ƒç”¨çš„æ–¹æ³• */ @OnMessage public void onMessage(String message) { log.info(\u0026#34;websocketæ¶ˆæ¯: æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯:\u0026#34; + message); } /** * æ­¤ä¸ºå•ç‚¹æ¶ˆæ¯ */ public void sendOneMessage(String userId, String message) { Session session = sessionPool.get(userId); if (session != null \u0026amp;\u0026amp; session.isOpen()) { try { log.info(\u0026#34;websocketæ¶ˆ: å•ç‚¹æ¶ˆæ¯:\u0026#34; + message); session.getAsyncRemote().sendText(message); } catch (Exception e) { e.printStackTrace(); } } } } å‰ç«¯åˆå§‹åŒ–æ‰“å¼€ WebSocket è¿æ¥ï¼Œå¹¶ç›‘å¬è¿æ¥çŠ¶æ€ï¼Œæ¥æ”¶æœåŠ¡ç«¯æ•°æ®æˆ–å‘æœåŠ¡ç«¯å‘é€æ•°æ®ã€‚\n\u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;websocketæµ‹è¯•\u0026lt;/title\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; /\u0026gt; \u0026lt;script src=\u0026#34;https://code.jquery.com/jquery-3.1.1.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;message\u0026#34;\u0026gt; \u0026lt;button onclick=\u0026#34;sendMessage()\u0026#34;\u0026gt;æµ‹è¯•\u0026lt;/button\u0026gt; \u0026lt;script\u0026gt; //æ³¨æ„ï¼Œåœ°å€ä¸è¦å¡«é”™äº† var ws = new WebSocket(\u0026#39;ws://localhost:8089/websocket/10086\u0026#39;); // è·å–è¿æ¥çŠ¶æ€ console.log(\u0026#39;wsè¿æ¥çŠ¶æ€ï¼š\u0026#39; + ws.readyState); //ç›‘å¬æ˜¯å¦è¿æ¥æˆåŠŸ ws.onopen = function () { console.log(\u0026#39;wsè¿æ¥çŠ¶æ€ï¼š\u0026#39; + ws.readyState); //è¿æ¥æˆåŠŸåˆ™å‘é€ä¸€ä¸ªæ•°æ® ws.send(\u0026#39;test1\u0026#39;); } // æ¥å¬æœåŠ¡å™¨å‘å›çš„ä¿¡æ¯å¹¶å¤„ç†å±•ç¤º ws.onmessage = function (data) { console.log(\u0026#39;æ¥æ”¶åˆ°æ¥è‡ªæœåŠ¡å™¨çš„æ¶ˆæ¯ï¼š\u0026#39;); console.log(data); //å®Œæˆé€šä¿¡åå…³é—­WebSocketè¿æ¥(è¿™é‡Œä¸è¦å…³é—­ï¼Œè®©ä»–æŒç»­å‘ï¼‰ //ws.close(); } // ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶ ws.onclose = function () { // ç›‘å¬æ•´ä¸ªè¿‡ç¨‹ä¸­websocketçš„çŠ¶æ€ console.log(\u0026#39;wsè¿æ¥çŠ¶æ€ï¼š\u0026#39; + ws.readyState); } // ç›‘å¬å¹¶å¤„ç†erroräº‹ä»¶ ws.onerror = function (error) { console.log(error); } //å¦‚æœæ–°å¼€ä¸€ä¸ªçª—å£ï¼Œå¯ä»¥æ‰‹åŠ¨è®¿é—®http://192.168.2.26:8089/socket/publish?userId=10086\u0026amp;message=abcde,é‚£ä¹ˆå°±å¯ä»¥å‘é€æ¶ˆæ¯å•¦ï¼ˆåŸçª—å£å¯ä»¥ç»§ç»­æ¥æ”¶æ¶ˆæ¯ï¼‰ function sendMessage() { var content = $(\u0026#34;#message\u0026#34;).val(); //è¿™é‡Œéœ€è¦åå°æä¾›/socket/publishæ¥å£ $.ajax({ url: \u0026#39;http://192.168.2.26:8089/socket/publish?userId=10086\u0026amp;message=\u0026#39; + content, type: \u0026#39;GET\u0026#39;, data: { \u0026#34;id\u0026#34;: \u0026#34;7777\u0026#34;, \u0026#34;content\u0026#34;: content }, success: function (data) { console.log(data) } }) } \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; é¡µé¢åˆå§‹åŒ–å»ºç«‹ WebSocket è¿æ¥ï¼Œä¹‹åå°±å¯ä»¥è¿›è¡ŒåŒå‘é€šä¿¡äº†ï¼Œæ•ˆæœè¿˜ä¸é”™ã€‚\n# MQTT # ä»€ä¹ˆæ˜¯ MQTT åè®®ï¼Ÿ\nMQTT (Message Queue Telemetry Transport)æ˜¯ä¸€ç§åŸºäºå‘å¸ƒ/è®¢é˜…ï¼ˆpublish/subscribeï¼‰æ¨¡å¼çš„è½»é‡çº§é€šè®¯åè®®ï¼Œé€šè¿‡è®¢é˜…ç›¸åº”çš„ä¸»é¢˜æ¥è·å–æ¶ˆæ¯ï¼Œæ˜¯ç‰©è”ç½‘ï¼ˆInternet of Thingï¼‰ä¸­çš„ä¸€ä¸ªæ ‡å‡†ä¼ è¾“åè®®ã€‚\nè¯¥åè®®å°†æ¶ˆæ¯çš„å‘å¸ƒè€…ï¼ˆpublisherï¼‰ä¸è®¢é˜…è€…ï¼ˆsubscriberï¼‰è¿›è¡Œåˆ†ç¦»ï¼Œå› æ­¤å¯ä»¥åœ¨ä¸å¯é çš„ç½‘ç»œç¯å¢ƒä¸­ï¼Œä¸ºè¿œç¨‹è¿æ¥çš„è®¾å¤‡æä¾›å¯é çš„æ¶ˆæ¯æœåŠ¡ï¼Œä½¿ç”¨æ–¹å¼ä¸ä¼ ç»Ÿçš„ MQ æœ‰ç‚¹ç±»ä¼¼ã€‚\nTCP åè®®ä½äºä¼ è¾“å±‚ï¼ŒMQTT åè®®ä½äºåº”ç”¨å±‚ï¼ŒMQTT åè®®æ„å»ºäº TCP/IP åè®®ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦æ”¯æŒ TCP/IP åè®®æ ˆçš„åœ°æ–¹ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ MQTT åè®®ã€‚\nä¸ºä»€ä¹ˆè¦ç”¨ MQTT åè®®ï¼Ÿ\nMQTT åè®®ä¸ºä»€ä¹ˆåœ¨ç‰©è”ç½‘ï¼ˆIOTï¼‰ä¸­å¦‚æ­¤å—åçˆ±ï¼Ÿè€Œä¸æ˜¯å…¶å®ƒåè®®ï¼Œæ¯”å¦‚æˆ‘ä»¬æ›´ä¸ºç†Ÿæ‚‰çš„ HTTP åè®®å‘¢ï¼Ÿ\né¦–å…ˆ HTTP åè®®å®ƒæ˜¯ä¸€ç§åŒæ­¥åè®®ï¼Œå®¢æˆ·ç«¯è¯·æ±‚åéœ€è¦ç­‰å¾…æœåŠ¡å™¨çš„å“åº”ã€‚è€Œåœ¨ç‰©è”ç½‘ï¼ˆIOTï¼‰ç¯å¢ƒä¸­ï¼Œè®¾å¤‡ä¼šå¾ˆå—åˆ¶äºç¯å¢ƒçš„å½±å“ï¼Œæ¯”å¦‚å¸¦å®½ä½ã€ç½‘ç»œå»¶è¿Ÿé«˜ã€ç½‘ç»œé€šä¿¡ä¸ç¨³å®šç­‰ï¼Œæ˜¾ç„¶å¼‚æ­¥æ¶ˆæ¯åè®®æ›´ä¸ºé€‚åˆ IOT åº”ç”¨ç¨‹åºã€‚ HTTP æ˜¯å•å‘çš„ï¼Œå¦‚æœè¦è·å–æ¶ˆæ¯å®¢æˆ·ç«¯å¿…é¡»å‘èµ·è¿æ¥ï¼Œè€Œåœ¨ç‰©è”ç½‘ï¼ˆIOTï¼‰åº”ç”¨ç¨‹åºä¸­ï¼Œè®¾å¤‡æˆ–ä¼ æ„Ÿå™¨å¾€å¾€éƒ½æ˜¯å®¢æˆ·ç«¯ï¼Œè¿™æ„å‘³ç€å®ƒä»¬æ— æ³•è¢«åŠ¨åœ°æ¥æ”¶æ¥è‡ªç½‘ç»œçš„å‘½ä»¤ã€‚ é€šå¸¸éœ€è¦å°†ä¸€æ¡å‘½ä»¤æˆ–è€…æ¶ˆæ¯ï¼Œå‘é€åˆ°ç½‘ç»œä¸Šçš„æ‰€æœ‰è®¾å¤‡ä¸Šã€‚HTTP è¦å®ç°è¿™æ ·çš„åŠŸèƒ½ä¸ä½†å¾ˆå›°éš¾ï¼Œè€Œä¸”æˆæœ¬æé«˜ã€‚ å…·ä½“çš„ MQTT åè®®ä»‹ç»å’Œå®è·µï¼Œè¿™é‡Œæˆ‘å°±ä¸å†èµ˜è¿°äº†ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„ä¸¤ç¯‡æ–‡ç« ï¼Œé‡Œè¾¹å†™çš„ä¹Ÿéƒ½å¾ˆè¯¦ç»†äº†ã€‚\nMQTT åè®®çš„ä»‹ç»ï¼šæˆ‘ä¹Ÿæ²¡æƒ³åˆ° SpringBoot + RabbitMQ åšæ™ºèƒ½å®¶å±…ï¼Œä¼šè¿™ä¹ˆç®€å•open in new window MQTT å®ç°æ¶ˆæ¯æ¨é€ï¼šæœªè¯»æ¶ˆæ¯ï¼ˆå°çº¢ç‚¹ï¼‰ï¼Œå‰ç«¯ ä¸ RabbitMQ å®æ—¶æ¶ˆæ¯æ¨é€å®è·µï¼Œè´¼ç®€å•~open in new window # æ€»ç»“ # ä»¥ä¸‹å†…å®¹ä¸º JavaGuide è¡¥å……\nä»‹ç» ä¼˜ç‚¹ ç¼ºç‚¹ çŸ­è½®è¯¢ å®¢æˆ·ç«¯å®šæ—¶å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ç›´æ¥è¿”å›å“åº”æ•°æ®ï¼ˆå³ä½¿æ²¡æœ‰æ•°æ®æ›´æ–°ï¼‰ ç®€å•ã€æ˜“ç†è§£ã€æ˜“å®ç° å®æ—¶æ€§å¤ªå·®ï¼Œæ— æ•ˆè¯·æ±‚å¤ªå¤šï¼Œé¢‘ç¹å»ºç«‹è¿æ¥å¤ªè€—è´¹èµ„æº é•¿è½®è¯¢ ä¸çŸ­è½®è¯¢ä¸åŒæ˜¯ï¼Œé•¿è½®è¯¢æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚ä¹‹åç­‰åˆ°æœ‰æ•°æ®æ›´æ–°æ‰è¿”å›è¯·æ±‚ å‡å°‘äº†æ— æ•ˆè¯·æ±‚ æŒ‚èµ·è¯·æ±‚ä¼šå¯¼è‡´èµ„æºæµªè´¹ iframe æµ æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´åˆ›å»ºä¸€æ¡é•¿è¿æ¥ï¼ŒæœåŠ¡ç«¯æŒç»­å‘iframeä¼ è¾“æ•°æ®ã€‚ ç®€å•ã€æ˜“ç†è§£ã€æ˜“å®ç° ç»´æŠ¤ä¸€ä¸ªé•¿è¿æ¥ä¼šå¢åŠ å¼€é”€ï¼Œæ•ˆæœå¤ªå·®ï¼ˆå›¾æ ‡ä¼šä¸åœæ—‹è½¬ï¼‰ SSE ä¸€ç§æœåŠ¡å™¨ç«¯åˆ°å®¢æˆ·ç«¯(æµè§ˆå™¨)çš„å•å‘æ¶ˆæ¯æ¨é€ã€‚ ç®€å•ã€æ˜“å®ç°ï¼ŒåŠŸèƒ½ä¸°å¯Œ ä¸æ”¯æŒåŒå‘é€šä¿¡ WebSocket é™¤äº†æœ€åˆå»ºç«‹è¿æ¥æ—¶ç”¨ HTTP åè®®ï¼Œå…¶ä»–æ—¶å€™éƒ½æ˜¯ç›´æ¥åŸºäº TCP åè®®è¿›è¡Œé€šä¿¡çš„ï¼Œå¯ä»¥å®ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„å…¨åŒå·¥é€šä¿¡ã€‚ æ€§èƒ½é«˜ã€å¼€é”€å° å¯¹å¼€å‘äººå‘˜è¦æ±‚æ›´é«˜ï¼Œå®ç°ç›¸å¯¹å¤æ‚ä¸€äº› MQTT åŸºäºå‘å¸ƒ/è®¢é˜…ï¼ˆpublish/subscribeï¼‰æ¨¡å¼çš„è½»é‡çº§é€šè®¯åè®®ï¼Œé€šè¿‡è®¢é˜…ç›¸åº”çš„ä¸»é¢˜æ¥è·å–æ¶ˆæ¯ã€‚ æˆç†Ÿç¨³å®šï¼Œè½»é‡çº§ å¯¹å¼€å‘äººå‘˜è¦æ±‚æ›´é«˜ï¼Œå®ç°ç›¸å¯¹å¤æ‚ä¸€äº› è‘—ä½œæƒå½’æ‰€æœ‰ åŸæ–‡é“¾æ¥ï¼šhttps://javaguide.cn/system-design/web-real-time-message-push.html\n"},{"id":58,"href":"/zh/docs/study/Review/java_guide/lycly_system-design/schedule-task/","title":"Javaå®šæ—¶ä»»åŠ¡è¯¦è§£","section":"ç³»ç»Ÿè®¾è®¡","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nä¸ºä»€ä¹ˆéœ€è¦å®šæ—¶ä»»åŠ¡ï¼Ÿ # æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å‡ ä¸ªéå¸¸å¸¸è§çš„ä¸šåŠ¡åœºæ™¯ï¼š\næŸç³»ç»Ÿå‡Œæ™¨è¦è¿›è¡Œæ•°æ®å¤‡ä»½ã€‚ æŸç”µå•†å¹³å°ï¼Œç”¨æˆ·ä¸‹å•åŠä¸ªå°æ—¶æœªæ”¯ä»˜çš„æƒ…å†µä¸‹éœ€è¦è‡ªåŠ¨å–æ¶ˆè®¢å•ã€‚ æŸåª’ä½“èšåˆå¹³å°ï¼Œæ¯ 10 åˆ†é’ŸåŠ¨æ€æŠ“å–æŸæŸç½‘ç«™çš„æ•°æ®ä¸ºè‡ªå·±æ‰€ç”¨ã€‚ æŸåšå®¢å¹³å°ï¼Œæ”¯æŒå®šæ—¶å‘é€æ–‡ç« ã€‚ æŸåŸºé‡‘å¹³å°ï¼Œæ¯æ™šå®šæ—¶è®¡ç®—ç”¨æˆ·å½“æ—¥æ”¶ç›Šæƒ…å†µå¹¶æ¨é€ç»™ç”¨æˆ·æœ€æ–°çš„æ•°æ®ã€‚ \u0026hellip;\u0026hellip; è¿™äº›åœºæ™¯å¾€å¾€éƒ½è¦æ±‚æˆ‘ä»¬åœ¨æŸä¸ªç‰¹å®šçš„æ—¶é—´å»åšæŸä¸ªäº‹æƒ…ã€‚\nå•æœºå®šæ—¶ä»»åŠ¡æŠ€æœ¯é€‰å‹ # Timer # java.util.Timeræ˜¯ JDK 1.3 å¼€å§‹å°±å·²ç»æ”¯æŒçš„ä¸€ç§å®šæ—¶ä»»åŠ¡çš„å®ç°æ–¹å¼ã€‚\nTimer å†…éƒ¨ä½¿ç”¨ä¸€ä¸ªå«åš TaskQueue çš„ç±»å­˜æ”¾å®šæ—¶ä»»åŠ¡ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäºæœ€å°å †å®ç°çš„ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚TaskQueue ä¼šæŒ‰ç…§ä»»åŠ¡è·ç¦»ä¸‹ä¸€æ¬¡æ‰§è¡Œæ—¶é—´çš„å¤§å°å°†ä»»åŠ¡æ’åºï¼Œä¿è¯åœ¨å †é¡¶çš„ä»»åŠ¡æœ€å…ˆæ‰§è¡Œã€‚è¿™æ ·åœ¨éœ€è¦æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œæ¯æ¬¡åªéœ€è¦å–å‡ºå †é¡¶çš„ä»»åŠ¡è¿è¡Œå³å¯ï¼\nTimer ä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œé€šè¿‡ä¸‹é¢çš„æ–¹å¼æˆ‘ä»¬å°±èƒ½åˆ›å»ºä¸€ä¸ª 1s ä¹‹åæ‰§è¡Œçš„å®šæ—¶ä»»åŠ¡ã€‚\n// ç¤ºä¾‹ä»£ç ï¼š TimerTask task = new TimerTask() { public void run() { System.out.println(\u0026#34;å½“å‰æ—¶é—´: \u0026#34; + new Date() + \u0026#34;n\u0026#34; + \u0026#34;çº¿ç¨‹åç§°: \u0026#34; + Thread.currentThread().getName()); } }; System.out.println(\u0026#34;å½“å‰æ—¶é—´: \u0026#34; + new Date() + \u0026#34;n\u0026#34; + \u0026#34;çº¿ç¨‹åç§°: \u0026#34; + Thread.currentThread().getName()); Timer timer = new Timer(\u0026#34;Timer\u0026#34;); long delay = 1000L; timer.schedule(task, delay); //è¾“å‡ºï¼š å½“å‰æ—¶é—´: Fri May 28 15:18:47 CST 2021nçº¿ç¨‹åç§°: main å½“å‰æ—¶é—´: Fri May 28 15:18:48 CST 2021nçº¿ç¨‹åç§°: Timer ä¸è¿‡å…¶ç¼ºé™·è¾ƒå¤šï¼Œæ¯”å¦‚ä¸€ä¸ª Timer ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™å°±å¯¼è‡´ Timer çš„ä»»åŠ¡çš„æ‰§è¡Œåªèƒ½ä¸²è¡Œæ‰§è¡Œï¼Œä¸€ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿çš„è¯ä¼šå½±å“å…¶ä»–ä»»åŠ¡ï¼ˆæ€§èƒ½éå¸¸å·®ï¼‰ï¼Œå†æ¯”å¦‚å‘ç”Ÿå¼‚å¸¸æ—¶ä»»åŠ¡ç›´æ¥åœæ­¢ï¼ˆTimer åªæ•è·äº† InterruptedException ï¼‰ã€‚\nTimer ç±»ä¸Šçš„æœ‰ä¸€æ®µæ³¨é‡Šæ˜¯è¿™æ ·å†™çš„ï¼š\n* This class does not offer real-time guarantees: it schedules * tasks using the \u0026lt;tt\u0026gt;Object.wait(long)\u0026lt;/tt\u0026gt; method. *Java 5.0 introduced the {@code java.util.concurrent} package and * one of the concurrency utilities therein is the {@link * java.util.concurrent.ScheduledThreadPoolExecutor * ScheduledThreadPoolExecutor} which is a thread pool for repeatedly * executing tasks at a given rate or delay. It is effectively a more * versatile replacement for the {@code Timer}/{@code TimerTask} * combination, as it allows multiple service threads, accepts various * time units, and doesn\u0026#39;t require subclassing {@code TimerTask} (just * implement {@code Runnable}). Configuring {@code * ScheduledThreadPoolExecutor} with one thread makes it equivalent to * {@code Timer}. å¤§æ¦‚çš„æ„æ€å°±æ˜¯ï¼š ScheduledThreadPoolExecutor æ”¯æŒå¤šçº¿ç¨‹æ‰§è¡Œå®šæ—¶ä»»åŠ¡å¹¶ä¸”åŠŸèƒ½æ›´å¼ºå¤§ï¼Œæ˜¯ Timer çš„æ›¿ä»£å“ã€‚\nScheduledExecutorService # ScheduledExecutorService æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæœ‰å¤šä¸ªå®ç°ç±»ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ ScheduledThreadPoolExecutor ã€‚\nScheduledThreadPoolExecutor æœ¬èº«å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œæ”¯æŒä»»åŠ¡å¹¶å‘æ‰§è¡Œã€‚å¹¶ä¸”ï¼Œå…¶å†…éƒ¨ä½¿ç”¨ DelayedWorkQueue ä½œä¸ºä»»åŠ¡é˜Ÿåˆ—ã€‚\n// ç¤ºä¾‹ä»£ç ï¼š TimerTask repeatedTask = new TimerTask() { @SneakyThrows public void run() { System.out.println(\u0026#34;å½“å‰æ—¶é—´: \u0026#34; + new Date() + \u0026#34;n\u0026#34; + \u0026#34;çº¿ç¨‹åç§°: \u0026#34; + Thread.currentThread().getName()); } }; System.out.println(\u0026#34;å½“å‰æ—¶é—´: \u0026#34; + new Date() + \u0026#34;n\u0026#34; + \u0026#34;çº¿ç¨‹åç§°: \u0026#34; + Thread.currentThread().getName()); ScheduledExecutorService executor = Executors.newScheduledThreadPool(3); long delay = 1000L; long period = 1000L; executor.scheduleAtFixedRate(repeatedTask, delay, period, TimeUnit.MILLISECONDS); Thread.sleep(delay + period * 5); executor.shutdown(); //è¾“å‡ºï¼š å½“å‰æ—¶é—´: Fri May 28 15:40:46 CST 2021nçº¿ç¨‹åç§°: main å½“å‰æ—¶é—´: Fri May 28 15:40:47 CST 2021nçº¿ç¨‹åç§°: pool-1-thread-1 å½“å‰æ—¶é—´: Fri May 28 15:40:48 CST 2021nçº¿ç¨‹åç§°: pool-1-thread-1 å½“å‰æ—¶é—´: Fri May 28 15:40:49 CST 2021nçº¿ç¨‹åç§°: pool-1-thread-2 å½“å‰æ—¶é—´: Fri May 28 15:40:50 CST 2021nçº¿ç¨‹åç§°: pool-1-thread-2 å½“å‰æ—¶é—´: Fri May 28 15:40:51 CST 2021nçº¿ç¨‹åç§°: pool-1-thread-2 å½“å‰æ—¶é—´: Fri May 28 15:40:52 CST 2021nçº¿ç¨‹åç§°: pool-1-thread-2 ä¸è®ºæ˜¯ä½¿ç”¨ Timer è¿˜æ˜¯ ScheduledExecutorService éƒ½æ— æ³•ä½¿ç”¨ Cron è¡¨è¾¾å¼æŒ‡å®šä»»åŠ¡æ‰§è¡Œçš„å…·ä½“æ—¶é—´ã€‚\nSpring Task # [krÉ‘n] cron\næˆ‘ä»¬ç›´æ¥é€šè¿‡ Spring æä¾›çš„ @Scheduled æ³¨è§£å³å¯å®šä¹‰å®šæ—¶ä»»åŠ¡ï¼Œéå¸¸æ–¹ä¾¿ï¼\n/** * cronï¼šä½¿ç”¨Cronè¡¨è¾¾å¼ã€‚ã€€æ¯åˆ†é’Ÿçš„1ï¼Œ2ç§’è¿è¡Œ */ @Scheduled(cron = \u0026#34;1-2 * * * * ? \u0026#34;) public void reportCurrentTimeWithCronExpression() { log.info(\u0026#34;Cron Expression: The time is now {}\u0026#34;, dateFormat.format(new Date())); } æˆ‘åœ¨å¤§å­¦é‚£ä¼šåšçš„ä¸€ä¸ª SSM çš„ä¼ä¸šçº§é¡¹ç›®ï¼Œå°±æ˜¯ç”¨çš„ Spring Task æ¥åšçš„å®šæ—¶ä»»åŠ¡ã€‚\nå¹¶ä¸”ï¼ŒSpring Task è¿˜æ˜¯æ”¯æŒ Cron è¡¨è¾¾å¼ çš„ã€‚Cron è¡¨è¾¾å¼ä¸»è¦ç”¨äºå®šæ—¶ä½œä¸š(å®šæ—¶ä»»åŠ¡)ç³»ç»Ÿå®šä¹‰æ‰§è¡Œæ—¶é—´æˆ–æ‰§è¡Œé¢‘ç‡çš„è¡¨è¾¾å¼ï¼Œéå¸¸å‰å®³ï¼Œä½ å¯ä»¥é€šè¿‡ Cron è¡¨è¾¾å¼è¿›è¡Œè®¾ç½®å®šæ—¶ä»»åŠ¡æ¯å¤©æˆ–è€…æ¯ä¸ªæœˆä»€ä¹ˆæ—¶å€™æ‰§è¡Œç­‰ç­‰æ“ä½œã€‚å’±ä»¬è¦å­¦ä¹ å®šæ—¶ä»»åŠ¡çš„è¯ï¼ŒCron è¡¨è¾¾å¼æ˜¯ä¸€å®šæ˜¯è¦é‡ç‚¹å…³æ³¨çš„ã€‚æ¨èä¸€ä¸ªåœ¨çº¿ Cron è¡¨è¾¾å¼ç”Ÿæˆå™¨ï¼šhttp://cron.qqe2.com/ ã€‚\nä½†æ˜¯ï¼ŒSpring è‡ªå¸¦çš„å®šæ—¶è°ƒåº¦åªæ”¯æŒå•æœºï¼Œå¹¶ä¸”æä¾›çš„åŠŸèƒ½æ¯”è¾ƒå•ä¸€ã€‚ä¹‹å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« :ã€Š5 åˆ†é’Ÿææ‡‚å¦‚ä½•åœ¨ Spring Boot ä¸­ Schedule Tasksã€‹ ï¼Œä¸äº†è§£çš„å°ä¼™ä¼´å¯ä»¥å‚è€ƒä¸€ä¸‹ã€‚\nSpring Task åº•å±‚æ˜¯åŸºäº JDK çš„ ScheduledThreadPoolExecutor çº¿ç¨‹æ± æ¥å®ç°çš„ã€‚\nä¼˜ç¼ºç‚¹æ€»ç»“ï¼š\nä¼˜ç‚¹ï¼š ç®€å•ï¼Œè½»é‡ï¼Œæ”¯æŒ Cron è¡¨è¾¾å¼ ç¼ºç‚¹ ï¼šåŠŸèƒ½å•ä¸€ æ—¶é—´è½® # Kafkaã€Dubboã€ZooKeeperã€Netty ã€Caffeine ã€Akka ä¸­éƒ½æœ‰å¯¹æ—¶é—´è½®çš„å®ç°ã€‚\næ—¶é—´è½®ç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªç¯å½¢çš„é˜Ÿåˆ—ï¼ˆåº•å±‚ä¸€èˆ¬åŸºäºæ•°ç»„å®ç°ï¼‰ï¼Œé˜Ÿåˆ—ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼ˆæ—¶é—´æ ¼ï¼‰éƒ½å¯ä»¥å­˜æ”¾ä¸€ä¸ªå®šæ—¶ä»»åŠ¡åˆ—è¡¨ã€‚\næ—¶é—´è½®ä¸­çš„æ¯ä¸ªæ—¶é—´æ ¼ä»£è¡¨äº†æ—¶é—´è½®çš„åŸºæœ¬æ—¶é—´è·¨åº¦æˆ–è€…è¯´æ—¶é—´ç²¾åº¦ï¼ŒåŠ å…¥æ—¶é—´ä¸€ç§’èµ°ä¸€ä¸ªæ—¶é—´æ ¼çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶é—´è½®çš„æœ€é«˜ç²¾åº¦å°±æ˜¯ 1 ç§’ï¼ˆä¹Ÿå°±æ˜¯è¯´ 3 s å’Œ 3.9s ä¼šåœ¨åŒä¸€ä¸ªæ—¶é—´æ ¼ä¸­ï¼‰ã€‚\nä¸‹å›¾æ˜¯ä¸€ä¸ªæœ‰ 12 ä¸ªæ—¶é—´æ ¼çš„æ—¶é—´è½®ï¼Œè½¬å®Œä¸€åœˆéœ€è¦ 12 sã€‚å½“æˆ‘ä»¬éœ€è¦æ–°å»ºä¸€ä¸ª 3s åæ‰§è¡Œçš„å®šæ—¶ä»»åŠ¡ï¼Œåªéœ€è¦å°†å®šæ—¶ä»»åŠ¡æ”¾åœ¨ä¸‹æ ‡ä¸º 3 çš„æ—¶é—´æ ¼ä¸­å³å¯ã€‚å½“æˆ‘ä»¬éœ€è¦æ–°å»ºä¸€ä¸ª 9s åæ‰§è¡Œçš„å®šæ—¶ä»»åŠ¡ï¼Œåªéœ€è¦å°†å®šæ—¶ä»»åŠ¡æ”¾åœ¨ä¸‹æ ‡ä¸º 9 çš„æ—¶é—´æ ¼ä¸­å³å¯ã€‚\né‚£å½“æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª 13s åæ‰§è¡Œçš„å®šæ—¶ä»»åŠ¡æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™å¯ä»¥å¼•å…¥ä¸€å«åš åœˆæ•°/è½®æ•° çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªä»»åŠ¡è¿˜æ˜¯æ”¾åœ¨ä¸‹æ ‡ä¸º 3 çš„æ—¶é—´æ ¼ä¸­ï¼Œ ä¸è¿‡å®ƒçš„åœˆæ•°ä¸º 2 ã€‚\né™¤äº†å¢åŠ åœˆæ•°è¿™ç§æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§ å¤šå±‚æ¬¡æ—¶é—´è½® ï¼ˆç±»ä¼¼æ‰‹è¡¨ï¼‰ï¼ŒKafka é‡‡ç”¨çš„å°±æ˜¯è¿™ç§æ–¹æ¡ˆã€‚\né’ˆå¯¹ä¸‹å›¾çš„æ—¶é—´è½®ï¼Œæˆ‘æ¥ä¸¾ä¸€ä¸ªä¾‹å­ä¾¿äºå¤§å®¶ç†è§£ã€‚\nä¸Šå›¾çš„æ—¶é—´è½®ï¼Œç¬¬ 1 å±‚çš„æ—¶é—´ç²¾åº¦ä¸º 1 ï¼Œç¬¬ 2 å±‚çš„æ—¶é—´ç²¾åº¦ä¸º 20 ï¼Œç¬¬ 3 å±‚çš„æ—¶é—´ç²¾åº¦ä¸º 400ã€‚å‡å¦‚æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ª 350s åæ‰§è¡Œçš„ä»»åŠ¡ A çš„è¯ï¼ˆå½“å‰æ—¶é—´æ˜¯ 0sï¼‰ï¼Œè¿™ä¸ªä»»åŠ¡ä¼šè¢«æ”¾åœ¨ç¬¬ 2 å±‚ï¼ˆå› ä¸ºç¬¬äºŒå±‚çš„æ—¶é—´è·¨åº¦ä¸º 20*20=400\u0026gt;350ï¼‰çš„ç¬¬ 350/20=17 ä¸ªæ—¶é—´æ ¼å­ã€‚\nå½“ç¬¬ä¸€å±‚è½¬äº† 17 åœˆä¹‹åï¼Œæ—¶é—´è¿‡å»äº† 340s ï¼Œç¬¬ 2 å±‚çš„æŒ‡é’ˆæ­¤æ—¶æ¥åˆ°ç¬¬ 17 ä¸ªæ—¶é—´æ ¼å­ã€‚æ­¤æ—¶ï¼Œç¬¬ 2 å±‚ç¬¬ 17 ä¸ªæ ¼å­çš„ä»»åŠ¡ä¼šè¢«ç§»åŠ¨åˆ°ç¬¬ 1 å±‚ã€‚\nä»»åŠ¡ A å½“å‰æ˜¯ 10s ä¹‹åæ‰§è¡Œï¼Œå› æ­¤å®ƒä¼šè¢«ç§»åŠ¨åˆ°ç¬¬ 1 å±‚çš„ç¬¬ 10 ä¸ªæ—¶é—´æ ¼å­ã€‚\nè¿™é‡Œåœ¨å±‚ä¸å±‚ä¹‹é—´çš„ç§»åŠ¨ä¹Ÿå«åšæ—¶é—´è½®çš„å‡é™çº§ã€‚å‚è€ƒæ‰‹è¡¨æ¥ç†è§£å°±å¥½ï¼\næ—¶é—´è½®æ¯”è¾ƒé€‚åˆä»»åŠ¡æ•°é‡æ¯”è¾ƒå¤šçš„å®šæ—¶ä»»åŠ¡åœºæ™¯ï¼Œå®ƒçš„ä»»åŠ¡å†™å…¥å’Œæ‰§è¡Œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ 0ï¼ˆ1ï¼‰ã€‚\nåˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡æŠ€æœ¯é€‰å‹ # ä¸Šé¢æåˆ°çš„ä¸€äº›å®šæ—¶ä»»åŠ¡çš„è§£å†³æ–¹æ¡ˆéƒ½æ˜¯åœ¨å•æœºä¸‹æ‰§è¡Œçš„ï¼Œé€‚ç”¨äºæ¯”è¾ƒç®€å•çš„å®šæ—¶ä»»åŠ¡åœºæ™¯æ¯”å¦‚æ¯å¤©å‡Œæ™¨å¤‡ä»½ä¸€æ¬¡æ•°æ®ã€‚\nå¦‚æœæˆ‘ä»¬éœ€è¦ä¸€äº›é«˜çº§ç‰¹æ€§æ¯”å¦‚æ”¯æŒä»»åŠ¡åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„åˆ†ç‰‡å’Œé«˜å¯ç”¨çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æ¡†æ¶äº†ã€‚\né€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œå¾€å¾€æ¶‰åŠåˆ°ä¸‹é¢è¿™äº›è§’è‰²ï¼š\nä»»åŠ¡ ï¼š é¦–å…ˆè‚¯å®šæ˜¯è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡å°±æ˜¯å…·ä½“çš„ä¸šåŠ¡é€»è¾‘æ¯”å¦‚å®šæ—¶å‘é€æ–‡ç« ã€‚ è°ƒåº¦å™¨ ï¼šå…¶æ¬¡æ˜¯è°ƒåº¦ä¸­å¿ƒï¼Œè°ƒåº¦ä¸­å¿ƒä¸»è¦è´Ÿè´£ä»»åŠ¡ç®¡ç†ï¼Œä¼šåˆ†é…ä»»åŠ¡ç»™æ‰§è¡Œå™¨ã€‚ æ‰§è¡Œå™¨ ï¼š æœ€åå°±æ˜¯æ‰§è¡Œå™¨ï¼Œæ‰§è¡Œå™¨æ¥æ”¶è°ƒåº¦å™¨åˆ†æ´¾çš„ä»»åŠ¡å¹¶æ‰§è¡Œã€‚ Quartz # ä¸€ä¸ªå¾ˆç«çš„å¼€æºä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼Œå®Œå…¨ç”±Javaå†™æˆã€‚Quartz å¯ä»¥è¯´æ˜¯ Java å®šæ—¶ä»»åŠ¡é¢†åŸŸçš„è€å¤§å“¥æˆ–è€…è¯´å‚è€ƒæ ‡å‡†ï¼Œå…¶ä»–çš„ä»»åŠ¡è°ƒåº¦æ¡†æ¶åŸºæœ¬éƒ½æ˜¯åŸºäº Quartz å¼€å‘çš„ï¼Œæ¯”å¦‚å½“å½“ç½‘çš„elastic-jobå°±æ˜¯åŸºäºquartzäºŒæ¬¡å¼€å‘ä¹‹åçš„åˆ†å¸ƒå¼è°ƒåº¦è§£å†³æ–¹æ¡ˆã€‚\nä½¿ç”¨ Quartz å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¸ Spring é›†æˆï¼Œå¹¶ä¸”æ”¯æŒåŠ¨æ€æ·»åŠ ä»»åŠ¡å’Œé›†ç¾¤ã€‚ä½†æ˜¯ï¼ŒQuartz ä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼ŒAPI ç¹çã€‚\nå¹¶ä¸”ï¼ŒQuzrtz å¹¶æ²¡æœ‰å†…ç½® UI ç®¡ç†æ§åˆ¶å°ï¼Œä¸è¿‡ä½ å¯ä»¥ä½¿ç”¨ quartzui è¿™ä¸ªå¼€æºé¡¹ç›®æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\nå¦å¤–ï¼ŒQuartz è™½ç„¶ä¹Ÿæ”¯æŒåˆ†å¸ƒå¼ä»»åŠ¡ã€‚ä½†æ˜¯ï¼Œå®ƒæ˜¯åœ¨æ•°æ®åº“å±‚é¢ï¼Œé€šè¿‡æ•°æ®åº“çš„é”æœºåˆ¶åšçš„ï¼Œæœ‰éå¸¸å¤šçš„å¼Šç«¯æ¯”å¦‚ç³»ç»Ÿä¾µå…¥æ€§ä¸¥é‡ã€èŠ‚ç‚¹è´Ÿè½½ä¸å‡è¡¡ã€‚æœ‰ç‚¹ä¼ªåˆ†å¸ƒå¼çš„å‘³é“ã€‚\nä¼˜ç¼ºç‚¹æ€»ç»“ï¼š\nä¼˜ç‚¹ï¼š å¯ä»¥ä¸ Spring é›†æˆï¼Œå¹¶ä¸”æ”¯æŒåŠ¨æ€æ·»åŠ ä»»åŠ¡å’Œé›†ç¾¤ã€‚ ç¼ºç‚¹ ï¼šåˆ†å¸ƒå¼æ”¯æŒä¸å‹å¥½ï¼Œæ²¡æœ‰å†…ç½® UI ç®¡ç†æ§åˆ¶å°ã€ä½¿ç”¨éº»çƒ¦ï¼ˆç›¸æ¯”äºå…¶ä»–åŒç±»å‹æ¡†æ¶æ¥è¯´ï¼‰ Elastic-Job # Elastic-Job æ˜¯å½“å½“ç½‘å¼€æºçš„ä¸€ä¸ªåŸºäºQuartzå’ŒZooKeeperçš„åˆ†å¸ƒå¼è°ƒåº¦è§£å†³æ–¹æ¡ˆï¼Œç”±ä¸¤ä¸ªç›¸äº’ç‹¬ç«‹çš„å­é¡¹ç›® Elastic-Job-Lite å’Œ Elastic-Job-Cloud ç»„æˆï¼Œä¸€èˆ¬æˆ‘ä»¬åªè¦ä½¿ç”¨ Elastic-Job-Lite å°±å¥½ã€‚\nElasticJob æ”¯æŒä»»åŠ¡åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„åˆ†ç‰‡å’Œé«˜å¯ç”¨ã€ä»»åŠ¡å¯è§†åŒ–ç®¡ç†ç­‰åŠŸèƒ½ã€‚\nElasticJob-Lite çš„æ¶æ„è®¾è®¡å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒElastic-Job æ²¡æœ‰è°ƒåº¦ä¸­å¿ƒè¿™ä¸€æ¦‚å¿µï¼Œè€Œæ˜¯ä½¿ç”¨ ZooKeeper ä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œæ³¨å†Œä¸­å¿ƒè´Ÿè´£åè°ƒåˆ†é…ä»»åŠ¡åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šã€‚\nElastic-Job ä¸­çš„å®šæ—¶è°ƒåº¦éƒ½æ˜¯ç”±æ‰§è¡Œå™¨è‡ªè¡Œè§¦å‘ï¼Œè¿™ç§è®¾è®¡ä¹Ÿè¢«ç§°ä¸ºå»ä¸­å¿ƒåŒ–è®¾è®¡ï¼ˆè°ƒåº¦å’Œå¤„ç†éƒ½æ˜¯æ‰§è¡Œå™¨å•ç‹¬å®Œæˆï¼‰ã€‚\n@Component @ElasticJobConf(name = \u0026#34;dayJob\u0026#34;, cron = \u0026#34;0/10 * * * * ?\u0026#34;, shardingTotalCount = 2, shardingItemParameters = \u0026#34;0=AAAA,1=BBBB\u0026#34;, description = \u0026#34;ç®€å•ä»»åŠ¡\u0026#34;, failover = true) public class TestJob implements SimpleJob { @Override public void execute(ShardingContext shardingContext) { log.info(\u0026#34;TestJobä»»åŠ¡åï¼šã€{}ã€‘, ç‰‡æ•°ï¼šã€{}ã€‘, param=ã€{}ã€‘\u0026#34;, shardingContext.getJobName(), shardingContext.getShardingTotalCount(), shardingContext.getShardingParameter()); } } ç›¸å…³åœ°å€ï¼š\nGithub åœ°å€ï¼šhttps://github.com/apache/shardingsphere-elasticjobã€‚ å®˜æ–¹ç½‘ç«™ï¼šhttps://shardingsphere.apache.org/elasticjob/index_zh.html ã€‚ ä¼˜ç¼ºç‚¹æ€»ç»“ï¼š\nä¼˜ç‚¹ ï¼šå¯ä»¥ä¸ Spring é›†æˆã€æ”¯æŒåˆ†å¸ƒå¼ã€æ”¯æŒé›†ç¾¤ã€æ€§èƒ½ä¸é”™ ç¼ºç‚¹ ï¼šä¾èµ–äº†é¢å¤–çš„ä¸­é—´ä»¶æ¯”å¦‚ Zookeeperï¼ˆå¤æ‚åº¦å¢åŠ ï¼Œå¯é æ€§é™ä½ã€ç»´æŠ¤æˆæœ¬å˜é«˜ï¼‰ XXL-JOB # XXL-JOB äº 2015 å¹´å¼€æºï¼Œæ˜¯ä¸€æ¬¾ä¼˜ç§€çš„è½»é‡çº§åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼Œæ”¯æŒä»»åŠ¡å¯è§†åŒ–ç®¡ç†ã€å¼¹æ€§æ‰©å®¹ç¼©å®¹ã€ä»»åŠ¡å¤±è´¥é‡è¯•å’Œå‘Šè­¦ã€ä»»åŠ¡åˆ†ç‰‡ç­‰åŠŸèƒ½ï¼Œ\næ ¹æ® XXL-JOB å®˜ç½‘ä»‹ç»ï¼Œå…¶è§£å†³äº†å¾ˆå¤š Quartz çš„ä¸è¶³ã€‚\nXXL-JOB çš„æ¶æ„è®¾è®¡å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒXXL-JOB ç”± è°ƒåº¦ä¸­å¿ƒ å’Œ æ‰§è¡Œå™¨ ä¸¤å¤§éƒ¨åˆ†ç»„æˆã€‚è°ƒåº¦ä¸­å¿ƒä¸»è¦è´Ÿè´£ä»»åŠ¡ç®¡ç†ã€æ‰§è¡Œå™¨ç®¡ç†ä»¥åŠæ—¥å¿—ç®¡ç†ã€‚æ‰§è¡Œå™¨ä¸»è¦æ˜¯æ¥æ”¶è°ƒåº¦ä¿¡å·å¹¶å¤„ç†ã€‚å¦å¤–ï¼Œè°ƒåº¦ä¸­å¿ƒè¿›è¡Œä»»åŠ¡è°ƒåº¦æ—¶ï¼Œæ˜¯é€šè¿‡è‡ªç ” RPC æ¥å®ç°çš„ã€‚\nä¸åŒäº Elastic-Job çš„å»ä¸­å¿ƒåŒ–è®¾è®¡ï¼Œ XXL-JOB çš„è¿™ç§è®¾è®¡ä¹Ÿè¢«ç§°ä¸ºä¸­å¿ƒåŒ–è®¾è®¡ï¼ˆè°ƒåº¦ä¸­å¿ƒè°ƒåº¦å¤šä¸ªæ‰§è¡Œå™¨æ‰§è¡Œä»»åŠ¡ï¼‰ã€‚\nå’Œ Quzrtz ç±»ä¼¼ XXL-JOB ä¹Ÿæ˜¯åŸºäºæ•°æ®åº“é”è°ƒåº¦ä»»åŠ¡ï¼Œå­˜åœ¨æ€§èƒ½ç“¶é¢ˆã€‚ä¸è¿‡ï¼Œä¸€èˆ¬åœ¨ä»»åŠ¡é‡ä¸æ˜¯ç‰¹åˆ«å¤§çš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰ä»€ä¹ˆå½±å“çš„ï¼Œå¯ä»¥æ»¡è¶³ç»å¤§éƒ¨åˆ†å…¬å¸çš„è¦æ±‚ã€‚\nä¸è¦è¢« XXL-JOB çš„æ¶æ„å›¾ç»™å“ç€äº†ï¼Œå®é™…ä¸Šï¼Œæˆ‘ä»¬è¦ç”¨ XXL-JOB çš„è¯ï¼Œåªéœ€è¦é‡å†™ IJobHandler è‡ªå®šä¹‰ä»»åŠ¡æ‰§è¡Œé€»è¾‘å°±å¯ä»¥äº†ï¼Œéå¸¸æ˜“ç”¨ï¼\n@JobHandler(value=\u0026#34;myApiJobHandler\u0026#34;) @Component public class MyApiJobHandler extends IJobHandler { @Override public ReturnT\u0026lt;String\u0026gt; execute(String param) throws Exception { //...... return ReturnT.SUCCESS; } } è¿˜å¯ä»¥ç›´æ¥åŸºäºæ³¨è§£å®šä¹‰ä»»åŠ¡ã€‚\n@XxlJob(\u0026#34;myAnnotationJobHandler\u0026#34;) public ReturnT\u0026lt;String\u0026gt; myAnnotationJobHandler(String param) throws Exception { //...... return ReturnT.SUCCESS; } ç›¸å…³åœ°å€ï¼š\nGithub åœ°å€ï¼šhttps://github.com/xuxueli/xxl-job/ã€‚ å®˜æ–¹ä»‹ç»ï¼šhttps://www.xuxueli.com/xxl-job/ ã€‚ ä¼˜ç¼ºç‚¹æ€»ç»“ï¼š\nä¼˜ç‚¹ï¼šå¼€ç®±å³ç”¨ï¼ˆå­¦ä¹ æˆæœ¬æ¯”è¾ƒä½ï¼‰ã€ä¸ Spring é›†æˆã€æ”¯æŒåˆ†å¸ƒå¼ã€æ”¯æŒé›†ç¾¤ã€å†…ç½®äº† UI ç®¡ç†æ§åˆ¶å°ã€‚ ç¼ºç‚¹ï¼šä¸æ”¯æŒåŠ¨æ€æ·»åŠ ä»»åŠ¡ï¼ˆå¦‚æœä¸€å®šæƒ³è¦åŠ¨æ€åˆ›å»ºä»»åŠ¡ä¹Ÿæ˜¯æ”¯æŒçš„ï¼Œå‚è§ï¼šxxl-job issue277ï¼‰ã€‚ PowerJob # éå¸¸å€¼å¾—å…³æ³¨çš„ä¸€ä¸ªåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼Œåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦é¢†åŸŸçš„æ–°æ˜Ÿã€‚ç›®å‰ï¼Œå·²ç»æœ‰å¾ˆå¤šå…¬å¸æ¥å…¥æ¯”å¦‚ OPPOã€äº¬ä¸œã€ä¸­é€šã€æ€ç§‘ã€‚\nè¿™ä¸ªæ¡†æ¶çš„è¯ç”Ÿä¹ŸæŒºæœ‰æ„æ€çš„ï¼ŒPowerJob çš„ä½œè€…å½“æ—¶åœ¨é˜¿é‡Œå·´å·´å®ä¹ è¿‡ï¼Œé˜¿é‡Œå·´å·´é‚£ä¼šä½¿ç”¨çš„æ˜¯å†…éƒ¨è‡ªç ”çš„ SchedulerXï¼ˆé˜¿é‡Œäº‘ä»˜è´¹äº§å“ï¼‰ã€‚å®ä¹ æœŸæ»¡ä¹‹åï¼ŒPowerJob çš„ä½œè€…ç¦»å¼€äº†é˜¿é‡Œå·´å·´ã€‚æƒ³ç€è¯´è‡ªç ”ä¸€ä¸ª SchedulerXï¼Œé˜²æ­¢å“ªå¤© SchedulerX æ»¡è¶³ä¸äº†éœ€æ±‚ï¼Œäºæ˜¯ PowerJob å°±è¯ç”Ÿäº†ã€‚\næ›´å¤šå…³äº PowerJob çš„æ•…äº‹ï¼Œå°ä¼™ä¼´ä»¬å¯ä»¥å»çœ‹çœ‹ PowerJob ä½œè€…çš„è§†é¢‘ ã€Šæˆ‘å’Œæˆ‘çš„ä»»åŠ¡è°ƒåº¦ä¸­é—´ä»¶ã€‹ã€‚ç®€å•ç‚¹æ¦‚æ‹¬å°±æ˜¯ï¼šâ€œæ¸¸æˆæ²¡å•¥æ„æ€äº†ï¼Œæˆ‘è¦æ‰›èµ·äº†æ–°ä¸€ä»£åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ä¸è®¡ç®—æ¡†æ¶çš„å¤§æ——ï¼â€ã€‚\nç”±äº SchedulerX å±äºäººæ°‘å¸äº§å“ï¼Œæˆ‘è¿™é‡Œå°±ä¸è¿‡å¤šä»‹ç»ã€‚PowerJob å®˜æ–¹ä¹Ÿå¯¹æ¯”è¿‡å…¶å’Œ QuartZã€XXL-JOB ä»¥åŠ SchedulerXã€‚\næ€»ç»“ # è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¸»è¦ä»‹ç»äº†ï¼š\nå®šæ—¶ä»»åŠ¡çš„ç›¸å…³æ¦‚å¿µ ï¼šä¸ºä»€ä¹ˆéœ€è¦å®šæ—¶ä»»åŠ¡ã€å®šæ—¶ä»»åŠ¡ä¸­çš„æ ¸å¿ƒè§’è‰²ã€åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ã€‚ å®šæ—¶ä»»åŠ¡çš„æŠ€æœ¯é€‰å‹ ï¼š XXL-JOB 2015 å¹´æ¨å‡ºï¼Œå·²ç»ç»è¿‡äº†å¾ˆå¤šå¹´çš„è€ƒéªŒã€‚XXL-JOB è½»é‡çº§ï¼Œå¹¶ä¸”ä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ã€‚è™½ç„¶å­˜åœ¨æ€§èƒ½ç“¶é¢ˆï¼Œä½†æ˜¯ï¼Œåœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹äºä¼ä¸šçš„åŸºæœ¬éœ€æ±‚æ¥è¯´æ˜¯æ²¡æœ‰å½±å“çš„ã€‚PowerJob å±äºåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦é¢†åŸŸé‡Œçš„æ–°æ˜Ÿï¼Œå…¶ç¨³å®šæ€§è¿˜æœ‰å¾…ç»§ç»­è€ƒå¯Ÿã€‚ElasticJob ç”±äºåœ¨æ¶æ„è®¾è®¡ä¸Šæ˜¯åŸºäº Zookeeper ï¼Œè€Œ XXL-JOB æ˜¯åŸºäºæ•°æ®åº“ï¼Œæ€§èƒ½æ–¹é¢çš„è¯ï¼ŒElasticJob ç•¥èƒœä¸€ç­¹ã€‚ è¿™ç¯‡æ–‡ç« å¹¶æ²¡æœ‰ä»‹ç»åˆ°å®é™…ä½¿ç”¨ï¼Œä½†æ˜¯ï¼Œå¹¶ä¸ä»£è¡¨å®é™…ä½¿ç”¨ä¸é‡è¦ã€‚æˆ‘åœ¨å†™è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œå·²ç»åŠ¨æ‰‹å†™è¿‡ç›¸åº”çš„ Demoã€‚åƒ Quartzï¼Œæˆ‘åœ¨å¤§å­¦é‚£ä¼šå°±ç”¨è¿‡ã€‚ä¸è¿‡ï¼Œå½“æ—¶ç”¨çš„æ˜¯ Spring ã€‚ä¸ºäº†èƒ½å¤Ÿæ›´å¥½åœ°ä½“éªŒï¼Œæˆ‘è‡ªå·±åˆåœ¨ Spring Boot ä¸Šå®é™…ä½“éªŒäº†ä¸€ä¸‹ã€‚å¦‚æœä½ å¹¶æ²¡æœ‰å®é™…ä½¿ç”¨æŸä¸ªæ¡†æ¶ï¼Œå°±ç›´æ¥è¯´å®ƒå¹¶ä¸å¥½ç”¨çš„è¯ï¼Œæ˜¯ç«™ä¸ä½è„šçš„ã€‚\næœ€åï¼Œè¿™ç¯‡æ–‡ç« è¦æ„Ÿè°¢è‰¿è‰¿çš„å¸®åŠ©ï¼Œå†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™å‘è‰¿è‰¿è¯¢é—®è¿‡ä¸€äº›é—®é¢˜ã€‚æ¨èä¸€ç¯‡è‰¿è‰¿å†™çš„åå®æˆ˜ç±»å‹çš„ç¡¬æ ¸æ–‡ç« ï¼šã€ŠSpring Jobï¼ŸQuartzï¼ŸXXL-Jobï¼Ÿå¹´è½»äººæ‰åšé€‰æ‹©ï¼Œè‰¿è‰¿å…¨è½~ã€‹ ã€‚\n"},{"id":59,"href":"/zh/docs/study/Review/java_guide/lycly_system-design/security/ly06ly_sentive-words-filter/","title":"æ•æ„Ÿè¯è¿‡æ»¤æ–¹æ¡ˆæ€»ç»“","section":"å®‰å…¨","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nç³»ç»Ÿéœ€è¦å¯¹ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬è¿›è¡Œæ•æ„Ÿè¯è¿‡æ»¤å¦‚è‰²æƒ…ã€æ”¿æ²»ã€æš´åŠ›ç›¸å…³çš„è¯æ±‡ã€‚\næ•æ„Ÿè¯è¿‡æ»¤ç”¨çš„ä½¿ç”¨æ¯”è¾ƒå¤šçš„ Trie æ ‘ç®—æ³• å’Œ DFA ç®—æ³•ã€‚\nç®—æ³•å®ç° # Trie æ ‘ # Trie æ ‘ ä¹Ÿç§°ä¸ºå­—å…¸æ ‘ã€å•è¯æŸ¥æ‰¾æ ‘ï¼Œå“ˆç³»æ ‘(è¿™é‡Œæ˜¯ä¸æ˜¯å†™é”™äº†ï¼Œå“ˆå¸Œæ ‘ï¼Ÿ)çš„ä¸€ç§å˜ç§ï¼Œé€šå¸¸è¢«ç”¨äºå­—ç¬¦ä¸²åŒ¹é…ï¼Œç”¨æ¥è§£å†³åœ¨ä¸€ç»„å­—ç¬¦ä¸²é›†åˆä¸­å¿«é€ŸæŸ¥æ‰¾æŸä¸ªå­—ç¬¦ä¸²çš„é—®é¢˜ã€‚åƒæµè§ˆå™¨æœç´¢çš„å…³é”®è¯æç¤ºä¸€èˆ¬å°±æ˜¯åŸºäº Trie æ ‘æ¥åšçš„ã€‚\nå‡å¦‚æˆ‘ä»¬çš„æ•æ„Ÿè¯åº“ä¸­æœ‰ä»¥ä¸‹æ•æ„Ÿè¯ï¼š\né«˜æ¸…æœ‰ç  é«˜æ¸… AV ä¸œäº¬å†· ä¸œäº¬çƒ­ æˆ‘ä»¬æ„é€ å‡ºæ¥çš„æ•æ„Ÿè¯ Trie æ ‘å°±æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š\nå½“æˆ‘ä»¬è¦æŸ¥æ‰¾å¯¹åº”çš„å­—ç¬¦ä¸²â€œä¸œäº¬çƒ­â€çš„è¯ï¼Œæˆ‘ä»¬ä¼šæŠŠè¿™ä¸ªå­—ç¬¦ä¸²åˆ‡å‰²æˆå•ä¸ªçš„å­—ç¬¦â€œä¸œâ€ã€â€œäº¬â€ã€â€œçƒ­â€ï¼Œç„¶åæˆ‘ä»¬ä» Trie æ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹åŒ¹é…ã€‚\nå¯ä»¥çœ‹å‡ºï¼Œ Trie æ ‘çš„æ ¸å¿ƒåŸç†å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯é€šè¿‡å…¬å…±å‰ç¼€æ¥æé«˜å­—ç¬¦ä¸²åŒ¹é…æ•ˆç‡ã€‚\nApache Commons Collecions è¿™ä¸ªåº“ä¸­å°±æœ‰ Trie æ ‘å®ç°ï¼š\nTrie\u0026lt;String, String\u0026gt; trie = new PatriciaTrie\u0026lt;\u0026gt;(); trie.put(\u0026#34;Abigail\u0026#34;, \u0026#34;student\u0026#34;); trie.put(\u0026#34;Abi\u0026#34;, \u0026#34;doctor\u0026#34;); trie.put(\u0026#34;Annabel\u0026#34;, \u0026#34;teacher\u0026#34;); trie.put(\u0026#34;Christina\u0026#34;, \u0026#34;student\u0026#34;); trie.put(\u0026#34;Chris\u0026#34;, \u0026#34;doctor\u0026#34;); Assertions.assertTrue(trie.containsKey(\u0026#34;Abigail\u0026#34;)); assertEquals(\u0026#34;{Abi=doctor, Abigail=student}\u0026#34;, trie.prefixMap(\u0026#34;Abi\u0026#34;).toString()); assertEquals(\u0026#34;{Chris=doctor, Christina=student}\u0026#34;, trie.prefixMap(\u0026#34;Chr\u0026#34;).toString()); Aho-Corasickï¼ˆACï¼‰è‡ªåŠ¨æœºæ˜¯ä¸€ç§å»ºç«‹åœ¨ Trie æ ‘ä¸Šçš„ä¸€ç§æ”¹è¿›ç®—æ³•ï¼Œæ˜¯ä¸€ç§å¤šæ¨¡å¼åŒ¹é…ç®—æ³•ï¼Œç”±è´å°”å®éªŒå®¤çš„ç ”ç©¶äººå‘˜ Alfred V. Aho å’Œ Margaret J.Corasick å‘æ˜ã€‚\nAC è‡ªåŠ¨æœºç®—æ³•ä½¿ç”¨ Trie æ ‘æ¥å­˜æ”¾æ¨¡å¼ä¸²çš„å‰ç¼€ï¼Œé€šè¿‡å¤±è´¥åŒ¹é…æŒ‡é’ˆï¼ˆå¤±é…æŒ‡é’ˆï¼‰æ¥å¤„ç†åŒ¹é…å¤±è´¥çš„è·³è½¬ã€‚\nç›¸å…³é˜…è¯»ï¼šåœ°é“ååˆ†é’Ÿ | AC è‡ªåŠ¨æœº\nDFA # DFAï¼ˆDeterministic Finite Automata)å³ç¡®å®šæœ‰ç©·è‡ªåŠ¨æœºï¼Œä¸ä¹‹å¯¹åº”çš„æ˜¯ NFAï¼ˆNon-Deterministic Finite Automataï¼Œæœ‰ç©·è‡ªåŠ¨æœº)ã€‚\nå…³äº DFA çš„è¯¦ç»†ä»‹ç»å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼šæœ‰ç©·è‡ªåŠ¨æœº DFA\u0026amp;NFA (å­¦ä¹ ç¬”è®°) - å°èœ—ç‰›çš„æ–‡ç«  - çŸ¥ä¹ ã€‚\nHutool æä¾›äº† DFA ç®—æ³•çš„å®ç°ï¼š\nWordTree wordTree = new WordTree(); wordTree.addWord(\u0026#34;å¤§\u0026#34;); wordTree.addWord(\u0026#34;å¤§æ†¨æ†¨\u0026#34;); wordTree.addWord(\u0026#34;æ†¨æ†¨\u0026#34;); String text = \u0026#34;é‚£äººçœŸæ˜¯ä¸ªå¤§æ†¨æ†¨ï¼\u0026#34;; // è·å¾—ç¬¬ä¸€ä¸ªåŒ¹é…çš„å…³é”®å­— String matchStr = wordTree.match(text); System.out.println(matchStr); // æ ‡å‡†åŒ¹é…ï¼ŒåŒ¹é…åˆ°æœ€çŸ­å…³é”®è¯ï¼Œå¹¶è·³è¿‡å·²ç»åŒ¹é…çš„å…³é”®è¯ List\u0026lt;String\u0026gt; matchStrList = wordTree.matchAll(text, -1, false, false); System.out.println(matchStrList); //åŒ¹é…åˆ°æœ€é•¿å…³é”®è¯ï¼Œè·³è¿‡å·²ç»åŒ¹é…çš„å…³é”®è¯ List\u0026lt;String\u0026gt; matchStrList2 = wordTree.matchAll(text, -1, false, true); System.out.println(matchStrList2); è¾“å‡ºï¼š\nå¤§ [å¤§, æ†¨æ†¨] [å¤§, å¤§æ†¨æ†¨] å¼€æºé¡¹ç›® # ToolGood.Words ï¼šä¸€æ¬¾é«˜æ€§èƒ½æ•æ„Ÿè¯(éæ³•è¯/è„å­—)æ£€æµ‹è¿‡æ»¤ç»„ä»¶ï¼Œé™„å¸¦ç¹ä½“ç®€ä½“äº’æ¢ï¼Œæ”¯æŒå…¨è§’åŠè§’äº’æ¢ï¼Œæ±‰å­—è½¬æ‹¼éŸ³ï¼Œæ¨¡ç³Šæœç´¢ç­‰åŠŸèƒ½ã€‚ sensitive-words-filter ï¼šæ•æ„Ÿè¯è¿‡æ»¤é¡¹ç›®ï¼Œæä¾› TTMPã€DFAã€DATã€hash bucketã€Tire ç®—æ³•æ”¯æŒè¿‡æ»¤ã€‚å¯ä»¥æ”¯æŒæ–‡æœ¬çš„é«˜äº®ã€è¿‡æ»¤ã€åˆ¤è¯ã€æ›¿æ¢çš„æ¥å£æ”¯æŒã€‚ è®ºæ–‡ # ä¸€ç§æ•æ„Ÿè¯è‡ªåŠ¨è¿‡æ»¤ç®¡ç†ç³»ç»Ÿ ä¸€ç§ç½‘ç»œæ¸¸æˆä¸­æ•æ„Ÿè¯è¿‡æ»¤æ–¹æ³•åŠç³»ç»Ÿ "},{"id":60,"href":"/zh/docs/study/Review/java_guide/lycly_system-design/security/ly05ly_design-of-authority-system/","title":"æƒé™ç³»ç»Ÿè®¾è®¡è¯¦è§£","section":"å®‰å…¨","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nä½œè€…ï¼šè½¬è½¬æŠ€æœ¯å›¢é˜Ÿ\nåŸæ–‡ï¼šhttps://mp.weixin.qq.com/s/ONMuELjdHYa0yQceTj01Iw\nlyï¼šæ¯”è¾ƒç¹çï¼Œå¤§æ¦‚çœ‹äº†å‰é¢çš„éƒ¨åˆ†\nè€æƒé™ç³»ç»Ÿçš„é—®é¢˜ä¸ç°çŠ¶ # è½¬è½¬å…¬å¸åœ¨è¿‡å»å¹¶æ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„æƒé™ç®¡ç†ç³»ç»Ÿï¼Œæƒé™ç®¡ç†ç”±å„ä¸šåŠ¡è‡ªè¡Œç ”å‘æˆ–æ˜¯ä½¿ç”¨å…¶ä»–ä¸šåŠ¡çš„æƒé™ç³»ç»Ÿï¼Œæƒé™ç®¡ç†çš„ä¸ç»Ÿä¸€å¸¦æ¥äº†ä¸å°‘é—®é¢˜ï¼š\nå„ä¸šåŠ¡é‡å¤é€ è½®å­ï¼Œç»´æŠ¤æˆæœ¬é«˜ å„ç³»ç»Ÿåªè§£å†³éƒ¨åˆ†åœºæ™¯é—®é¢˜ï¼Œæ–¹æ¡ˆä¸å¤Ÿé€šç”¨ï¼Œæ–°é¡¹ç›®é€‰å‹æ—¶æ²¡æœ‰å¯é çš„æƒé™ç®¡ç†æ–¹æ¡ˆ ç¼ºä¹ç»Ÿä¸€çš„æ—¥å¿—ç®¡ç†ä¸å®¡æ‰¹æµç¨‹ï¼Œåœ¨æˆæƒä¿¡æ¯è¿½æº¯ä¸Šååˆ†å›°éš¾ åŸºäºä¸Šè¿°é—®é¢˜ï¼Œå»å¹´åº•å…¬å¸å¯åŠ¨å»ºè®¾è½¬è½¬ç»Ÿä¸€æƒé™ç³»ç»Ÿï¼Œç›®æ ‡æ˜¯å¼€å‘ä¸€å¥—çµæ´»ã€æ˜“ç”¨ã€å®‰å…¨çš„æƒé™ç®¡ç†ç³»ç»Ÿï¼Œä¾›å„ä¸šåŠ¡ä½¿ç”¨ã€‚\nä¸šç•Œæƒé™ç³»ç»Ÿçš„è®¾è®¡æ–¹å¼ # ç›®å‰ä¸šç•Œä¸»æµçš„æƒé™æ¨¡å‹æœ‰ä¸¤ç§ï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸‹ï¼š\nåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰ åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼ˆABACï¼‰ RBAC æ¨¡å‹ # åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRole-Based Access Controlï¼Œç®€ç§° RBACï¼‰ æŒ‡çš„æ˜¯é€šè¿‡ç”¨æˆ·çš„è§’è‰²ï¼ˆRoleï¼‰æˆæƒå…¶ç›¸å…³æƒé™ï¼Œå®ç°äº†çµæ´»çš„è®¿é—®æ§åˆ¶ï¼Œç›¸æ¯”ç›´æ¥æˆäºˆç”¨æˆ·æƒé™ï¼Œè¦æ›´åŠ ç®€å•ã€é«˜æ•ˆã€å¯æ‰©å±•ã€‚\nä¸€ä¸ªç”¨æˆ·å¯ä»¥æ‹¥æœ‰è‹¥å¹²è§’è‰²ï¼Œæ¯ä¸€ä¸ªè§’è‰²åˆå¯ä»¥è¢«åˆ†é…è‹¥å¹²æƒé™è¿™æ ·ï¼Œå°±æ„é€ æˆâ€œç”¨æˆ·-è§’è‰²-æƒé™â€ çš„æˆæƒæ¨¡å‹ã€‚åœ¨è¿™ç§æ¨¡å‹ä¸­ï¼Œç”¨æˆ·ä¸è§’è‰²ã€è§’è‰²ä¸æƒé™ä¹‹é—´æ„æˆäº†å¤šå¯¹å¤šçš„å…³ç³»ã€‚\nç”¨ä¸€ä¸ªå›¾æ¥æè¿°å¦‚ä¸‹ï¼š\nå½“ä½¿ç”¨ RBACæ¨¡å‹ æ—¶ï¼Œé€šè¿‡åˆ†æç”¨æˆ·çš„å®é™…æƒ…å†µï¼ŒåŸºäºå…±åŒçš„èŒè´£å’Œéœ€æ±‚ï¼Œæˆäºˆä»–ä»¬ä¸åŒè§’è‰²ã€‚è¿™ç§ ç”¨æˆ· -\u0026gt; è§’è‰² -\u0026gt; æƒé™ é—´çš„å…³ç³»ï¼Œè®©æˆ‘ä»¬å¯ä»¥ä¸ç”¨å†å•ç‹¬ç®¡ç†å•ä¸ªç”¨æˆ·æƒé™ï¼Œç”¨æˆ·ä»æˆäºˆçš„è§’è‰²é‡Œé¢è·å–æ‰€éœ€çš„æƒé™ã€‚\nä»¥ä¸€ä¸ªç®€å•çš„åœºæ™¯ï¼ˆGitlab çš„æƒé™ç³»ç»Ÿï¼‰ä¸ºä¾‹ï¼Œç”¨æˆ·ç³»ç»Ÿä¸­æœ‰ Adminã€Maintainerã€Operator ä¸‰ç§è§’è‰²ï¼Œè¿™ä¸‰ç§è§’è‰²åˆ†åˆ«å…·å¤‡ä¸åŒçš„æƒé™ï¼Œæ¯”å¦‚åªæœ‰ Admin å…·å¤‡åˆ›å»ºä»£ç ä»“åº“ã€åˆ é™¤ä»£ç ä»“åº“çš„æƒé™ï¼Œå…¶ä»–çš„è§’è‰²éƒ½ä¸å…·å¤‡ã€‚æˆ‘ä»¬æˆäºˆæŸä¸ªç”¨æˆ· Admin è¿™ä¸ªè§’è‰²ï¼Œä»–å°±å…·å¤‡äº† åˆ›å»ºä»£ç ä»“åº“ å’Œ åˆ é™¤ä»£ç ä»“åº“ è¿™ä¸¤ä¸ªæƒé™ã€‚\né€šè¿‡ RBACæ¨¡å‹ ï¼Œå½“å­˜åœ¨å¤šä¸ªç”¨æˆ·æ‹¥æœ‰ç›¸åŒæƒé™æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºå¥½æ‹¥æœ‰è¯¥æƒé™çš„è§’è‰²ï¼Œç„¶åç»™ä¸åŒçš„ç”¨æˆ·åˆ†é…ä¸åŒçš„è§’è‰²ï¼Œåç»­åªéœ€è¦ä¿®æ”¹è§’è‰²çš„æƒé™ï¼Œå°±èƒ½è‡ªåŠ¨ä¿®æ”¹è§’è‰²å†…æ‰€æœ‰ç”¨æˆ·çš„æƒé™ã€‚\nABAC æ¨¡å‹ # åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼ˆAttribute-Based Access Controlï¼Œç®€ç§° ABACï¼‰ æ˜¯ä¸€ç§æ¯” RBACæ¨¡å‹ æ›´åŠ çµæ´»çš„æˆæƒæ¨¡å‹ï¼Œå®ƒçš„åŸç†æ˜¯é€šè¿‡å„ç§å±æ€§æ¥åŠ¨æ€åˆ¤æ–­ä¸€ä¸ªæ“ä½œæ˜¯å¦å¯ä»¥è¢«å…è®¸ã€‚è¿™ä¸ªæ¨¡å‹åœ¨äº‘ç³»ç»Ÿä¸­ä½¿ç”¨çš„æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚ AWSï¼Œé˜¿é‡Œäº‘ç­‰ã€‚\nè€ƒè™‘ä¸‹é¢è¿™äº›åœºæ™¯çš„æƒé™æ§åˆ¶ï¼š\næˆæƒæŸä¸ªäººå…·ä½“æŸæœ¬ä¹¦çš„ç¼–è¾‘æƒé™ å½“ä¸€ä¸ªæ–‡æ¡£çš„æ‰€å±éƒ¨é—¨è·Ÿç”¨æˆ·çš„éƒ¨é—¨ç›¸åŒæ—¶ï¼Œç”¨æˆ·å¯ä»¥è®¿é—®è¿™ä¸ªæ–‡æ¡£ å½“ç”¨æˆ·æ˜¯ä¸€ä¸ªæ–‡æ¡£çš„æ‹¥æœ‰è€…å¹¶ä¸”æ–‡æ¡£çš„çŠ¶æ€æ˜¯è‰ç¨¿ï¼Œç”¨æˆ·å¯ä»¥ç¼–è¾‘è¿™ä¸ªæ–‡æ¡£ æ—©ä¸Šä¹ç‚¹å‰ç¦æ­¢ A éƒ¨é—¨çš„äººè®¿é—® B ç³»ç»Ÿ åœ¨é™¤äº†ä¸Šæµ·ä»¥å¤–çš„åœ°æ–¹ç¦æ­¢ä»¥ç®¡ç†å‘˜èº«ä»½è®¿é—® A ç³»ç»Ÿ ç”¨æˆ·å¯¹ 2022-06-07 ä¹‹å‰åˆ›å»ºçš„è®¢å•æœ‰æ“ä½œæƒé™ å¯ä»¥å‘ç°ä¸Šè¿°çš„åœºæ™¯é€šè¿‡ RBACæ¨¡å‹ å¾ˆéš¾å»å®ç°ï¼Œå› ä¸º RBACæ¨¡å‹ ä»…ä»…æè¿°äº†ç”¨æˆ·å¯ä»¥åšä»€ä¹ˆæ“ä½œï¼Œä½†æ˜¯æ“ä½œçš„æ¡ä»¶ï¼Œä»¥åŠæ“ä½œçš„æ•°æ®ï¼ŒRBACæ¨¡å‹ æœ¬èº«æ˜¯æ²¡æœ‰è¿™äº›é™åˆ¶çš„ã€‚ä½†è¿™æ°æ°æ˜¯ ABACæ¨¡å‹ çš„é•¿å¤„ï¼ŒABACæ¨¡å‹ çš„æ€æƒ³æ˜¯åŸºäºç”¨æˆ·ã€è®¿é—®çš„æ•°æ®çš„å±æ€§ã€ä»¥åŠå„ç§ç¯å¢ƒå› ç´ å»åŠ¨æ€è®¡ç®—ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è¿›è¡Œæ“ä½œã€‚\nABAC æ¨¡å‹çš„åŸç† # åœ¨ ABACæ¨¡å‹ ä¸­ï¼Œä¸€ä¸ªæ“ä½œæ˜¯å¦è¢«å…è®¸æ˜¯åŸºäºå¯¹è±¡ã€èµ„æºã€æ“ä½œå’Œç¯å¢ƒä¿¡æ¯å…±åŒåŠ¨æ€è®¡ç®—å†³å®šçš„ã€‚\nå¯¹è±¡ï¼šå¯¹è±¡æ˜¯å½“å‰è¯·æ±‚è®¿é—®èµ„æºçš„ç”¨æˆ·ã€‚ç”¨æˆ·çš„å±æ€§åŒ…æ‹¬ IDï¼Œä¸ªäººèµ„æºï¼Œè§’è‰²ï¼Œéƒ¨é—¨å’Œç»„ç»‡æˆå‘˜èº«ä»½ç­‰ èµ„æºï¼šèµ„æºæ˜¯å½“å‰ç”¨æˆ·è¦è®¿é—®çš„èµ„äº§æˆ–å¯¹è±¡ï¼Œä¾‹å¦‚æ–‡ä»¶ï¼Œæ•°æ®ï¼ŒæœåŠ¡å™¨ï¼Œç”šè‡³ API æ“ä½œï¼šæ“ä½œæ˜¯ç”¨æˆ·è¯•å›¾å¯¹èµ„æºè¿›è¡Œçš„æ“ä½œã€‚å¸¸è§çš„æ“ä½œåŒ…æ‹¬â€œè¯»å–â€ï¼Œâ€œå†™å…¥â€ï¼Œâ€œç¼–è¾‘â€ï¼Œâ€œå¤åˆ¶â€å’Œâ€œåˆ é™¤â€ ç¯å¢ƒï¼šç¯å¢ƒæ˜¯æ¯ä¸ªè®¿é—®è¯·æ±‚çš„ä¸Šä¸‹æ–‡ã€‚ç¯å¢ƒå±æ€§åŒ…å«è®¿é—®çš„æ—¶é—´å’Œä½ç½®ï¼Œå¯¹è±¡çš„è®¾å¤‡ï¼Œé€šä¿¡åè®®å’ŒåŠ å¯†å¼ºåº¦ç­‰ åœ¨ ABACæ¨¡å‹ çš„å†³ç­–è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå†³ç­–å¼•æ“ä¼šæ ¹æ®å®šä¹‰å¥½çš„å†³ç­–è¯­å¥ï¼Œç»“åˆå¯¹è±¡ã€èµ„æºã€æ“ä½œã€ç¯å¢ƒç­‰å› ç´ åŠ¨æ€è®¡ç®—å‡ºå†³ç­–ç»“æœã€‚æ¯å½“å‘ç”Ÿè®¿é—®è¯·æ±‚æ—¶ï¼ŒABACæ¨¡å‹ å†³ç­–ç³»ç»Ÿéƒ½ä¼šåˆ†æå±æ€§å€¼æ˜¯å¦ä¸å·²å»ºç«‹çš„ç­–ç•¥åŒ¹é…ã€‚å¦‚æœæœ‰åŒ¹é…çš„ç­–ç•¥ï¼Œè®¿é—®è¯·æ±‚å°±ä¼šè¢«é€šè¿‡ã€‚\næ–°æƒé™ç³»ç»Ÿçš„è®¾è®¡æ€æƒ³ # ç»“åˆè½¬è½¬çš„ä¸šåŠ¡ç°çŠ¶ï¼ŒRBACæ¨¡å‹ æ»¡è¶³äº†è½¬è½¬ç»å¤§éƒ¨åˆ†ä¸šåŠ¡åœºæ™¯ï¼Œå¹¶ä¸”å¼€å‘æˆæœ¬è¿œä½äº ABACæ¨¡å‹ çš„æƒé™ç³»ç»Ÿï¼Œæ‰€ä»¥æ–°æƒé™ç³»ç»Ÿé€‰æ‹©äº†åŸºäº RBACæ¨¡å‹ æ¥å®ç°ã€‚å¯¹äºå®åœ¨æ— æ³•æ»¡è¶³çš„ä¸šåŠ¡ç³»ç»Ÿï¼Œæˆ‘ä»¬é€‰æ‹©äº†æš‚æ—¶æ€§ä¸æ”¯æŒï¼Œè¿™æ ·å¯ä»¥ä¿éšœæ–°æƒé™ç³»ç»Ÿçš„å¿«é€Ÿè½åœ°ï¼Œæ›´å¿«çš„è®©ä¸šåŠ¡ä½¿ç”¨èµ·æ¥ã€‚\næ ‡å‡†çš„ RBACæ¨¡å‹ æ˜¯å®Œå…¨éµå®ˆ ç”¨æˆ· -\u0026gt; è§’è‰² -\u0026gt; æƒé™ è¿™ä¸ªé“¾è·¯çš„ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·çš„æƒé™å®Œå…¨ç”±ä»–æ‰€æ‹¥æœ‰çš„è§’è‰²æ¥æ§åˆ¶ï¼Œä½†æ˜¯è¿™æ ·ä¼šæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯ç»™ç”¨æˆ·åŠ æƒé™å¿…é¡»æ–°å¢ä¸€ä¸ªè§’è‰²ï¼Œå¯¼è‡´å®é™…æ“ä½œèµ·æ¥æ•ˆç‡æ¯”è¾ƒä½ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨ RBACæ¨¡å‹ çš„åŸºç¡€ä¸Šï¼Œæ–°å¢äº†ç»™ç”¨æˆ·ç›´æ¥å¢åŠ æƒé™çš„èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯è¯´æ—¢å¯ä»¥ç»™ç”¨æˆ·æ·»åŠ è§’è‰²ï¼Œä¹Ÿå¯ä»¥ç»™ç”¨æˆ·ç›´æ¥æ·»åŠ æƒé™ã€‚æœ€ç»ˆç”¨æˆ·çš„æƒé™æ˜¯ç”±æ‹¥æœ‰çš„è§’è‰²å’Œæƒé™ç‚¹ç»„åˆè€Œæˆã€‚\næ–°æƒé™ç³»ç»Ÿçš„æƒé™æ¨¡å‹ï¼šç”¨æˆ·æœ€ç»ˆæƒé™ = ç”¨æˆ·æ‹¥æœ‰çš„è§’è‰²å¸¦æ¥çš„æƒé™ + ç”¨æˆ·ç‹¬ç«‹é…ç½®çš„æƒé™ï¼Œä¸¤è€…å–å¹¶é›†ã€‚\næ–°æƒé™ç³»ç»Ÿæ–¹æ¡ˆå¦‚ä¸‹å›¾ ï¼š\né¦–å…ˆï¼Œå°†é›†å›¢æ‰€æœ‰çš„ç”¨æˆ·ï¼ˆåŒ…æ‹¬å¤–éƒ¨ç”¨æˆ·ï¼‰ï¼Œé€šè¿‡ ç»Ÿä¸€ç™»å½•ä¸æ³¨å†Œ åŠŸèƒ½å®ç°äº†ç»Ÿä¸€ç®¡ç†ï¼ŒåŒæ—¶ä¸å…¬å¸çš„ç»„ç»‡æ¶æ„ä¿¡æ¯æ¨¡å—æ‰“é€šï¼Œå®ç°äº†åŒä¸€ä¸ªäººå‘˜åœ¨æ‰€æœ‰ç³»ç»Ÿä¸­ä¿¡æ¯çš„ä¸€è‡´ï¼Œè¿™ä¹Ÿä¸ºåç»­åŸºäºç»„ç»‡æ¶æ„è¿›è¡Œæƒé™ç®¡ç†æä¾›äº†å¯è¡Œæ€§ã€‚ å…¶æ¬¡ï¼Œå› ä¸ºæ–°æƒé™ç³»ç»Ÿéœ€è¦æœåŠ¡é›†å›¢æ‰€æœ‰ä¸šåŠ¡ï¼Œæ‰€ä»¥éœ€è¦æ”¯æŒå¤šç³»ç»Ÿæƒé™ç®¡ç†ã€‚ç”¨æˆ·è¿›è¡Œæƒé™ç®¡ç†å‰ï¼Œéœ€è¦å…ˆé€‰æ‹©ç›¸åº”çš„ç³»ç»Ÿï¼Œç„¶åé…ç½®è¯¥ç³»ç»Ÿçš„ èœå•æƒé™ å’Œ æ•°æ®æƒé™ ä¿¡æ¯ï¼Œå»ºç«‹å¥½ç³»ç»Ÿçš„å„ä¸ªæƒé™ç‚¹ã€‚PSï¼šèœå•æƒé™å’Œæ•°æ®æƒé™çš„å…·ä½“è¯´æ˜ï¼Œä¸‹æ–‡ä¼šè¯¦ç»†ä»‹ç»ã€‚ æœ€åï¼Œåˆ›å»ºè¯¥ç³»ç»Ÿä¸‹çš„ä¸åŒè§’è‰²ï¼Œç»™ä¸åŒè§’è‰²é…ç½®å¥½æƒé™ç‚¹ã€‚æ¯”å¦‚åº—é•¿è§’è‰²ï¼Œæ‹¥æœ‰åº—å‘˜æ“ä½œæƒé™ã€æœ¬åº—æ•°æ®æŸ¥çœ‹æƒé™ç­‰ï¼Œé…ç½®å¥½è¿™ä¸ªè§’è‰²åï¼Œåç»­åªéœ€è¦ç»™åº—é•¿å¢åŠ è¿™ä¸ªè§’è‰²ï¼Œå°±å¯ä»¥è®©ä»–æ‹¥æœ‰å¯¹åº”çš„æƒé™ã€‚ å®Œæˆä¸Šè¿°é…ç½®åï¼Œå°±å¯ä»¥è¿›è¡Œç”¨æˆ·çš„æƒé™ç®¡ç†äº†ã€‚æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥ç»™ç”¨æˆ·åŠ æƒé™ï¼š\nå…ˆé€‰ç”¨æˆ·ï¼Œç„¶åæ·»åŠ æƒé™ã€‚è¯¥æ–¹å¼å¯ä»¥ç»™ç”¨æˆ·æ·»åŠ ä»»æ„è§’è‰²æˆ–æ˜¯èœå•/æ•°æ®æƒé™ç‚¹ã€‚ å…ˆé€‰æ‹©è§’è‰²ï¼Œç„¶åå…³è”ç”¨æˆ·ã€‚è¯¥æ–¹å¼åªå¯ç»™ç”¨æˆ·æ·»åŠ è§’è‰²ï¼Œä¸èƒ½å•ç‹¬æ·»åŠ èœå•/æ•°æ®æƒé™ç‚¹ã€‚ è¿™ä¸¤ç§æ–¹å¼çš„å…·ä½“è®¾è®¡æ–¹æ¡ˆï¼Œåæ–‡ä¼šè¯¦ç»†è¯´æ˜ã€‚\næƒé™ç³»ç»Ÿè‡ªèº«çš„æƒé™ç®¡ç† # å¯¹äºæƒé™ç³»ç»Ÿæ¥è¯´ï¼Œé¦–å…ˆéœ€è¦è®¾è®¡å¥½ç³»ç»Ÿè‡ªèº«çš„æƒé™ç®¡ç†ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ç®¡ç†å¥½ â€è°å¯ä»¥è¿›å…¥æƒé™ç³»ç»Ÿï¼Œè°å¯ä»¥ç®¡ç†å…¶ä»–ç³»ç»Ÿçš„æƒé™â€œï¼Œå¯¹äºæƒé™ç³»ç»Ÿè‡ªèº«çš„ç”¨æˆ·ï¼Œä¼šåˆ†ä¸ºä¸‰ç±»ï¼š\nè¶…çº§ç®¡ç†å‘˜ï¼šæ‹¥æœ‰æƒé™ç³»ç»Ÿçš„å…¨éƒ¨æ“ä½œæƒé™ï¼Œå¯ä»¥è¿›è¡Œç³»ç»Ÿè‡ªèº«çš„ä»»ä½•æ“ä½œï¼Œä¹Ÿå¯ä»¥ç®¡ç†æ¥å…¥æƒé™çš„åº”ç”¨ç³»ç»Ÿçš„ç®¡ç†æ“ä½œã€‚ æƒé™æ“ä½œç”¨æˆ·ï¼šæ‹¥æœ‰è‡³å°‘ä¸€ä¸ªå·²æ¥å…¥çš„åº”ç”¨ç³»ç»Ÿçš„è¶…çº§ç®¡ç†å‘˜è§’è‰²çš„ç”¨æˆ·ã€‚è¯¥ç”¨æˆ·èƒ½è¿›è¡Œçš„æ“ä½œé™å®šåœ¨æ‰€æ‹¥æœ‰çš„åº”ç”¨ç³»ç»Ÿæƒé™èŒƒå›´å†…ã€‚æƒé™æ“ä½œç”¨æˆ·æ˜¯ä¸€ç§èº«ä»½ï¼Œæ— éœ€åˆ†é…ï¼Œè€Œæ˜¯æ ¹æ®è§„åˆ™è‡ªåŠ¨è·å¾—çš„ã€‚ æ™®é€šç”¨æˆ·ï¼šæ™®é€šç”¨æˆ·ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç§èº«ä»½ï¼Œé™¤å»ä¸Šè¿° 2 ç±»äººï¼Œå…¶ä½™çš„éƒ½ä¸ºæ™®é€šç”¨æˆ·ã€‚ä»–ä»¬åªèƒ½ç”³è¯·æ¥å…¥ç³»ç»Ÿä»¥åŠè®¿é—®æƒé™ç”³è¯·é¡µé¢ã€‚ æƒé™ç±»å‹çš„å®šä¹‰ # æ–°æƒé™ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬æŠŠæƒé™åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œåˆ†åˆ«æ˜¯ ï¼š\nèœå•åŠŸèƒ½æƒé™ï¼šåŒ…æ‹¬ç³»ç»Ÿçš„ç›®å½•å¯¼èˆªã€èœå•çš„è®¿é—®æƒé™ï¼Œä»¥åŠæŒ‰é’®å’Œ API æ“ä½œçš„æƒé™ æ•°æ®æƒé™ï¼šåŒ…æ‹¬å®šä¹‰æ•°æ®çš„æŸ¥è¯¢èŒƒå›´æƒé™ï¼Œåœ¨ä¸åŒç³»ç»Ÿä¸­ï¼Œé€šå¸¸å«åš â€œç»„ç»‡â€ã€â€ç«™ç‚¹â€œç­‰ï¼Œåœ¨æ–°æƒé™ç³»ç»Ÿä¸­ï¼Œç»Ÿä¸€ç§°ä½œ â€ç»„ç»‡â€œ æ¥ç®¡ç†æ•°æ®æƒé™ é»˜è®¤è§’è‰²çš„åˆ†ç±» # æ¯ä¸ªç³»ç»Ÿä¸­è®¾è®¡äº†ä¸‰ä¸ªé»˜è®¤è§’è‰²ï¼Œç”¨æ¥æ»¡è¶³åŸºæœ¬çš„æƒé™ç®¡ç†éœ€æ±‚ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š\nè¶…çº§ç®¡ç†å‘˜ï¼šè¯¥è§’è‰²æ‹¥æœ‰è¯¥ç³»ç»Ÿçš„å…¨éƒ¨æƒé™ï¼Œå¯ä»¥ä¿®æ”¹ç³»ç»Ÿçš„è§’è‰²æƒé™ç­‰é…ç½®ï¼Œå¯ä»¥ç»™å…¶ä»–ç”¨æˆ·æˆæƒã€‚ ç³»ç»Ÿç®¡ç†å‘˜ï¼šè¯¥è§’è‰²æ‹¥æœ‰ç»™å…¶ä»–ç”¨æˆ·æˆæƒä»¥åŠä¿®æ”¹ç³»ç»Ÿçš„è§’è‰²æƒé™ç­‰é…ç½®èƒ½åŠ›ï¼Œä½†è§’è‰²æœ¬èº«ä¸å…·æœ‰ä»»ä½•æƒé™ã€‚ æˆæƒç®¡ç†å‘˜ï¼šè¯¥è§’è‰²æ‹¥æœ‰ç»™å…¶ä»–ç”¨æˆ·æˆæƒçš„èƒ½åŠ›ã€‚ä½†æ˜¯æˆæƒçš„èŒƒå›´ä¸è¶…å‡ºè‡ªå·±æ‰€æ‹¥æœ‰çš„æƒé™ã€‚ ä¸¾ä¸ªæ —å­ï¼šæˆæƒç®¡ç†å‘˜ A å¯ä»¥ç»™ B ç”¨æˆ·æ·»åŠ æƒé™ï¼Œä½†æ·»åŠ çš„èŒƒå›´ å°äºç­‰äº A ç”¨æˆ·å·²æ‹¥æœ‰çš„æƒé™ã€‚\nç»è¿‡è¿™ä¹ˆåŒºåˆ†ï¼ŒæŠŠ æ‹¥æœ‰æƒé™ å’Œ æ‹¥æœ‰æˆæƒèƒ½åŠ› ï¼Œè¿™ä¸¤éƒ¨åˆ†ç»™åˆ†éš”å¼€æ¥ï¼Œå¯ä»¥æ»¡è¶³æ‰€æœ‰çš„æƒé™æ§åˆ¶çš„åœºæ™¯ã€‚\næ–°æƒé™ç³»ç»Ÿçš„æ ¸å¿ƒæ¨¡å—è®¾è®¡ # ä¸Šé¢ä»‹ç»äº†æ–°æƒé™ç³»ç»Ÿçš„æ•´ä½“è®¾è®¡æ€æƒ³ï¼Œæ¥ä¸‹æ¥åˆ†åˆ«ä»‹ç»ä¸‹æ ¸å¿ƒæ¨¡å—çš„è®¾è®¡\nç³»ç»Ÿ/èœå•/æ•°æ®æƒé™ç®¡ç† # æŠŠä¸€ä¸ªæ–°ç³»ç»Ÿæ¥å…¥æƒé™ç³»ç»Ÿæœ‰ä¸‹åˆ—æ­¥éª¤ï¼š\nåˆ›å»ºç³»ç»Ÿ é…ç½®èœå•åŠŸèƒ½æƒé™ é…ç½®æ•°æ®æƒé™ï¼ˆå¯é€‰ï¼‰ åˆ›å»ºç³»ç»Ÿçš„è§’è‰² å…¶ä¸­ï¼Œ1ã€2ã€3 çš„æ­¥éª¤ï¼Œéƒ½æ˜¯åœ¨ç³»ç»Ÿç®¡ç†æ¨¡å—å®Œæˆï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹å›¾:\nç”¨æˆ·å¯ä»¥å¯¹ç³»ç»Ÿçš„åŸºæœ¬ä¿¡æ¯è¿›è¡Œå¢åˆ æ”¹æŸ¥çš„æ“ä½œï¼Œä¸åŒç³»ç»Ÿä¹‹é—´é€šè¿‡ ç³»ç»Ÿç¼–ç  ä½œä¸ºå”¯ä¸€åŒºåˆ†ã€‚åŒæ—¶ ç³»ç»Ÿç¼–ç  ä¹Ÿä¼šç”¨ä½œäºèœå•å’Œæ•°æ®æƒé™ç¼–ç çš„å‰ç¼€ï¼Œé€šè¿‡è¿™æ ·çš„è®¾è®¡ä¿è¯æƒé™ç¼–ç å…¨å±€å”¯ä¸€æ€§ã€‚\nä¾‹å¦‚ç³»ç»Ÿçš„ç¼–ç ä¸º test_onlineï¼Œé‚£ä¹ˆè¯¥ç³»ç»Ÿçš„èœå•ç¼–ç æ ¼å¼ä¾¿ä¸º test_online:m_xxxã€‚\nç³»ç»Ÿç®¡ç†ç•Œé¢è®¾è®¡å¦‚ä¸‹ï¼š\nèœå•ç®¡ç† # æ–°æƒé™ç³»ç»Ÿé¦–å…ˆå¯¹èœå•è¿›è¡Œäº†åˆ†ç±»ï¼Œåˆ†åˆ«æ˜¯ ç›®å½•ã€èœå• å’Œ æ“ä½œï¼Œç¤ºæ„å¦‚ä¸‹å›¾\nå®ƒä»¬åˆ†åˆ«ä»£è¡¨çš„å«ä¹‰æ˜¯ï¼š\nç›®å½• ï¼šæŒ‡çš„æ˜¯åº”ç”¨ç³»ç»Ÿä¸­æœ€é¡¶éƒ¨çš„ä¸€çº§ç›®å½•ï¼Œé€šå¸¸åœ¨ç³»ç»Ÿ Logo çš„å³è¾¹ èœå• ï¼šæŒ‡çš„æ˜¯åº”ç”¨ç³»ç»Ÿå·¦ä¾§çš„å¤šå±‚çº§èœå•ï¼Œé€šå¸¸åœ¨ç³»ç»Ÿ Logo çš„ä¸‹é¢ï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„èœå•ç»“æ„ æ“ä½œ ï¼šæŒ‡é¡µé¢ä¸­çš„æŒ‰é’®ã€æ¥å£ç­‰ä¸€ç³»åˆ—å¯ä»¥å®šä¹‰ä¸ºæ“ä½œæˆ–é¡µé¢å…ƒç´ çš„éƒ¨åˆ†ã€‚ èœå•ç®¡ç†ç•Œé¢è®¾è®¡å¦‚ä¸‹ï¼š èœå•æƒé™æ•°æ®çš„ä½¿ç”¨ï¼Œä¹Ÿæä¾›ä¸¤ç§æ–¹å¼ï¼š\nåŠ¨æ€èœå•æ¨¡å¼ ï¼šè¿™ç§æ¨¡å¼ä¸‹ï¼Œèœå•çš„å¢åˆ å®Œå…¨ç”±æƒé™ç³»ç»Ÿæ¥ç®¡ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨æƒé™ç³»ç»Ÿå¢åŠ èœå•ï¼Œåº”ç”¨ç³»ç»Ÿä¼šåŒæ­¥å¢åŠ ã€‚è¿™ç§æ¨¡å¼å¥½å¤„æ˜¯ä¿®æ”¹èœå•æ— éœ€é¡¹ç›®ä¸Šçº¿ã€‚ é™æ€èœå•æ¨¡å¼ ï¼šèœå•çš„å¢åˆ ç”±åº”ç”¨ç³»ç»Ÿçš„å‰ç«¯æ§åˆ¶ï¼Œæƒé™ç³»ç»Ÿåªæ§åˆ¶è®¿é—®æƒé™ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œæƒé™ç³»ç»Ÿåªèƒ½æ ‡è¯†å‡ºç”¨æˆ·æ˜¯å¦æ‹¥æœ‰å½“å‰èœå•çš„æƒé™ï¼Œè€Œå…·ä½“çš„æ˜¾ç¤ºæ§åˆ¶æ˜¯ç”±å‰ç«¯æ ¹æ®æƒé™æ•°æ®æ¥å†³å®šã€‚ è§’è‰²ä¸ç”¨æˆ·ç®¡ç† # è§’è‰²ä¸ç”¨æˆ·ç®¡ç†éƒ½æ˜¯å¯ä»¥ç›´æ¥æ”¹å˜ç”¨æˆ·æƒé™çš„æ ¸å¿ƒæ¨¡å—ï¼Œæ•´ä¸ªè®¾è®¡æ€è·¯å¦‚ä¸‹å›¾ï¼š\nè¿™ä¸ªæ¨¡å—è®¾è®¡é‡ç‚¹æ˜¯éœ€è¦è€ƒè™‘åˆ°æ‰¹é‡æ“ä½œã€‚æ— è®ºæ˜¯é€šè¿‡è§’è‰²å…³è”ç”¨æˆ·ï¼Œè¿˜æ˜¯ç»™ç”¨æˆ·æ‰¹é‡å¢åŠ /åˆ é™¤/é‡ç½®æƒé™ï¼Œæ‰¹é‡æ“ä½œçš„åœºæ™¯éƒ½æ˜¯ç³»ç»Ÿéœ€è¦è®¾è®¡å¥½çš„ã€‚\næƒé™ç”³è¯· # é™¤äº†ç»™å…¶ä»–ç”¨æˆ·æ·»åŠ æƒé™å¤–ï¼Œæ–°æƒé™ç³»ç»ŸåŒæ—¶æ”¯æŒäº†ç”¨æˆ·è‡ªä¸»ç”³è¯·æƒé™ã€‚è¿™ä¸ªæ¨¡å—é™¤äº†å¸¸è§„çš„å®¡æ‰¹æµï¼ˆç”³è¯·ã€å®¡æ‰¹ã€æŸ¥çœ‹ï¼‰ç­‰ï¼Œæœ‰ä¸€ä¸ªæ¯”è¾ƒç‰¹åˆ«çš„åŠŸèƒ½ï¼Œå°±æ˜¯å¦‚ä½•è®©ç”¨æˆ·èƒ½é€‰å¯¹è‡ªå·±è¦çš„æƒé™ã€‚æ‰€ä»¥åœ¨è¯¥æ¨¡å—çš„è®¾è®¡ä¸Šï¼Œé™¤äº†ç›´æ¥é€‰æ‹©è§’è‰²å¤–ï¼Œè¿˜æ”¯æŒé€šè¿‡èœå•/æ•°æ®æƒé™ç‚¹ï¼Œåå‘é€‰æ‹©è§’è‰²ï¼Œå¦‚ä¸‹å›¾ï¼š\næ“ä½œæ—¥å¿— # ç³»ç»Ÿæ“ä½œæ—¥å¿—ä¼šåˆ†ä¸ºä¸¤å¤§ç±»ï¼š\næ“ä½œæµæ°´æ—¥å¿— ï¼šç”¨æˆ·å¯çœ‹ã€å¯æŸ¥çš„å…³é”®æ“ä½œæ—¥å¿— æœåŠ¡ Log æ—¥å¿— ï¼šç³»ç»ŸæœåŠ¡è¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ Log æ—¥å¿—,å…¶ä¸­ï¼ŒæœåŠ¡ Log æ—¥å¿—ä¿¡æ¯é‡å¤§äºæ“ä½œæµæ°´æ—¥å¿—ï¼Œä½†æ˜¯ä¸æ–¹ä¾¿æœç´¢æŸ¥çœ‹ã€‚æ‰€ä»¥æƒé™ç³»ç»Ÿéœ€è¦æä¾›æ“ä½œæµæ°´æ—¥å¿—åŠŸèƒ½ã€‚ åœ¨æ–°æƒé™ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·æ‰€æœ‰çš„æ“ä½œå¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼Œåˆ†åˆ«ä¸ºæ–°å¢ã€æ›´æ–°ã€åˆ é™¤ã€‚æ‰€æœ‰çš„æ¨¡å—ä¹Ÿå¯æšä¸¾ï¼Œä¾‹å¦‚ç”¨æˆ·ç®¡ç†ã€è§’è‰²ç®¡ç†ã€èœå•ç®¡ç†ç­‰ã€‚æ˜ç¡®è¿™äº›ä¿¡æ¯åï¼Œé‚£ä¹ˆä¸€æ¡æ—¥å¿—å°±å¯ä»¥æŠ½è±¡ä¸ºï¼šä»€ä¹ˆäºº(Who)åœ¨ä»€ä¹ˆæ—¶é—´(When)å¯¹å“ªäº›äºº(Target)çš„å“ªäº›æ¨¡å—åšäº†å“ªäº›æ“ä½œã€‚ è¿™æ ·æŠŠæ‰€æœ‰çš„è®°å½•éƒ½å…¥åº“ï¼Œå°±å¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œæ—¥å¿—çš„æŸ¥çœ‹å’Œç­›é€‰äº†ã€‚\næ€»ç»“ä¸å±•æœ› # è‡³æ­¤ï¼Œæ–°æƒé™ç³»ç»Ÿçš„æ ¸å¿ƒè®¾è®¡æ€è·¯ä¸æ¨¡å—éƒ½å·²ä»‹ç»å®Œæˆï¼Œæ–°ç³»ç»Ÿåœ¨è½¬è½¬å†…éƒ¨æœ‰å¤§é‡çš„ä¸šåŠ¡æ¥å…¥ä½¿ç”¨ï¼Œæƒé™ç®¡ç†ç›¸æ¯”ä»¥å‰æ–¹ä¾¿äº†è®¸å¤šã€‚æƒé™ç³»ç»Ÿä½œä¸ºæ¯å®¶å…¬å¸çš„ä¸€ä¸ªåŸºç¡€ç³»ç»Ÿï¼Œçµæ´»ä¸”å®Œå¤‡çš„è®¾è®¡å¯ä»¥åŠ©åŠ›æ—¥åä¸šåŠ¡çš„å‘å±•æ›´åŠ é«˜æ•ˆã€‚\nåç»­ä¸¤ç¯‡ï¼š\nè½¬è½¬ç»Ÿä¸€æƒé™ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°ï¼ˆåç«¯å®ç°ç¯‡ï¼‰ è½¬è½¬ç»Ÿä¸€æƒé™ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°ï¼ˆå‰ç«¯å®ç°ç¯‡ï¼‰ å‚è€ƒ # é€‰æ‹©åˆé€‚çš„æƒé™æ¨¡å‹ï¼šhttps://docs.authing.cn/v2/guides/access-control/choose-the-right-access-control-model.html "},{"id":61,"href":"/zh/docs/study/Review/java_guide/lycly_system-design/security/ly04ly_sso-intro/","title":"ssoå•ç‚¹ç™»å½•","section":"å®‰å…¨","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\næœ¬æ–‡æˆæƒè½¬è½½è‡ª ï¼š https://ken.io/note/sso-design-implement ä½œè€…ï¼šken.io\nSSO ä»‹ç» # ä»€ä¹ˆæ˜¯ SSOï¼Ÿ # SSO è‹±æ–‡å…¨ç§° Single Sign Onï¼Œå•ç‚¹ç™»å½•ã€‚SSO æ˜¯åœ¨å¤šä¸ªåº”ç”¨ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·åªéœ€è¦ç™»å½•ä¸€æ¬¡å°±å¯ä»¥è®¿é—®æ‰€æœ‰ç›¸äº’ä¿¡ä»»çš„åº”ç”¨ç³»ç»Ÿã€‚\nä¾‹å¦‚ä½ ç™»å½•ç½‘æ˜“è´¦å·ä¸­å¿ƒï¼ˆhttps://reg.163.com/ ï¼‰ä¹‹åè®¿é—®ä»¥ä¸‹ç«™ç‚¹éƒ½æ˜¯ç™»å½•çŠ¶æ€ã€‚\nç½‘æ˜“ç›´æ’­ https://v.163.com ç½‘æ˜“åšå®¢ https://blog.163.com ç½‘æ˜“èŠ±ç”° https://love.163.com ç½‘æ˜“è€ƒæ‹‰ https://www.kaola.com ç½‘æ˜“ Lofter http://www.lofter.com SSO æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ # ç”¨æˆ·è§’åº¦ :ç”¨æˆ·èƒ½å¤Ÿåšåˆ°ä¸€æ¬¡ç™»å½•å¤šæ¬¡ä½¿ç”¨ï¼Œæ— éœ€è®°å½•å¤šå¥—ç”¨æˆ·åå’Œå¯†ç ï¼Œçœå¿ƒã€‚ ç³»ç»Ÿç®¡ç†å‘˜è§’åº¦ : ç®¡ç†å‘˜åªéœ€ç»´æŠ¤å¥½ä¸€ä¸ªç»Ÿä¸€çš„è´¦å·ä¸­å¿ƒå°±å¯ä»¥äº†ï¼Œæ–¹ä¾¿ã€‚ æ–°ç³»ç»Ÿå¼€å‘è§’åº¦: æ–°ç³»ç»Ÿå¼€å‘æ—¶åªéœ€ç›´æ¥å¯¹æ¥ç»Ÿä¸€çš„è´¦å·ä¸­å¿ƒå³å¯ï¼Œç®€åŒ–å¼€å‘æµç¨‹ï¼Œçœæ—¶ã€‚ SSO è®¾è®¡ä¸å®ç° # æœ¬ç¯‡æ–‡ç« ä¹Ÿä¸»è¦æ˜¯ä¸ºäº†æ¢è®¨å¦‚ä½•è®¾è®¡\u0026amp;å®ç°ä¸€ä¸ª SSO ç³»ç»Ÿ\nä»¥ä¸‹ä¸ºéœ€è¦å®ç°çš„æ ¸å¿ƒåŠŸèƒ½ï¼š\nå•ç‚¹ç™»å½• å•ç‚¹ç™»å‡º æ”¯æŒè·¨åŸŸå•ç‚¹ç™»å½• æ”¯æŒè·¨åŸŸå•ç‚¹ç™»å‡º æ ¸å¿ƒåº”ç”¨ä¸ä¾èµ– # åº”ç”¨/æ¨¡å—/å¯¹è±¡ è¯´æ˜ å‰å°ç«™ç‚¹ éœ€è¦ç™»å½•çš„ç«™ç‚¹ SSO ç«™ç‚¹-ç™»å½• æä¾›ç™»å½•çš„é¡µé¢ SSO ç«™ç‚¹-ç™»å‡º æä¾›æ³¨é”€ç™»å½•çš„å…¥å£ SSO æœåŠ¡-ç™»å½• æä¾›ç™»å½•æœåŠ¡ SSO æœåŠ¡-ç™»å½•çŠ¶æ€ æä¾›ç™»å½•çŠ¶æ€æ ¡éªŒ/ç™»å½•ä¿¡æ¯æŸ¥è¯¢çš„æœåŠ¡ SSO æœåŠ¡-ç™»å‡º æä¾›ç”¨æˆ·æ³¨é”€ç™»å½•çš„æœåŠ¡ æ•°æ®åº“ å­˜å‚¨ç”¨æˆ·è´¦æˆ·ä¿¡æ¯ ç¼“å­˜ å­˜å‚¨ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼Œé€šå¸¸ä½¿ç”¨ Redis ç”¨æˆ·ç™»å½•çŠ¶æ€çš„å­˜å‚¨ä¸æ ¡éªŒ # å¸¸è§çš„ Web æ¡†æ¶å¯¹äº Session çš„å®ç°éƒ½æ˜¯ç”Ÿæˆä¸€ä¸ª SessionId å­˜å‚¨åœ¨æµè§ˆå™¨ Cookie ä¸­ã€‚ç„¶åå°† Session å†…å®¹å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯å†…å­˜ä¸­ï¼Œè¿™ä¸ª ken.io åœ¨ä¹‹å‰Session å·¥ä½œåŸç†ä¸­ä¹Ÿæåˆ°è¿‡ã€‚æ•´ä½“ä¹Ÿæ˜¯å€Ÿé‰´è¿™ä¸ªæ€è·¯ã€‚\nç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œç”Ÿæˆ AuthToken äº¤ç»™å®¢æˆ·ç«¯ä¿å­˜ã€‚å¦‚æœæ˜¯æµè§ˆå™¨ï¼Œå°±ä¿å­˜åœ¨ Cookie ä¸­ã€‚å¦‚æœæ˜¯æ‰‹æœº App å°±ä¿å­˜åœ¨ App æœ¬åœ°ç¼“å­˜ä¸­ã€‚æœ¬ç¯‡ä¸»è¦æ¢è®¨åŸºäº Web ç«™ç‚¹çš„ SSOã€‚\nç”¨æˆ·åœ¨æµè§ˆéœ€è¦ç™»å½•çš„é¡µé¢æ—¶ï¼Œå®¢æˆ·ç«¯å°† AuthToken æäº¤ç»™ SSO æœåŠ¡æ ¡éªŒç™»å½•çŠ¶æ€/è·å–ç”¨æˆ·ç™»å½•ä¿¡æ¯\nå¯¹äºç™»å½•ä¿¡æ¯çš„å­˜å‚¨ï¼Œå»ºè®®é‡‡ç”¨ Redisï¼Œä½¿ç”¨ Redis é›†ç¾¤æ¥å­˜å‚¨ç™»å½•ä¿¡æ¯ï¼Œæ—¢å¯ä»¥ä¿è¯é«˜å¯ç”¨ï¼Œåˆå¯ä»¥çº¿æ€§æ‰©å……ã€‚åŒæ—¶ä¹Ÿå¯ä»¥è®© SSO æœåŠ¡æ»¡è¶³è´Ÿè½½å‡è¡¡/å¯ä¼¸ç¼©çš„éœ€æ±‚ã€‚\nå¯¹è±¡ è¯´æ˜ AuthToken ç›´æ¥ä½¿ç”¨ UUID/GUID å³å¯ï¼Œå¦‚æœæœ‰éªŒè¯ AuthToken åˆæ³•æ€§éœ€æ±‚ï¼Œå¯ä»¥å°† UserName+æ—¶é—´æˆ³åŠ å¯†ç”Ÿæˆï¼ŒæœåŠ¡ç«¯è§£å¯†ä¹‹åéªŒè¯åˆæ³•æ€§ ç™»å½•ä¿¡æ¯ é€šå¸¸æ˜¯å°† UserIdï¼ŒUserName ç¼“å­˜èµ·æ¥ ç”¨æˆ·ç™»å½•/ç™»å½•æ ¡éªŒ # ç™»å½•æ—¶åºå›¾\næŒ‰ç…§ä¸Šå›¾ï¼Œç”¨æˆ·ç™»å½•å AuthToken ä¿å­˜åœ¨ Cookie ä¸­ã€‚ domain=test.com æµè§ˆå™¨ä¼šå°† domain è®¾ç½®æˆ .test.comï¼Œ\nè¿™æ ·è®¿é—®æ‰€æœ‰ .test.com çš„ web ç«™ç‚¹ï¼Œéƒ½ä¼šå°† AuthToken æºå¸¦åˆ°æœåŠ¡å™¨ç«¯*ã€‚ ç„¶åé€šè¿‡ SSO æœåŠ¡ï¼Œå®Œæˆå¯¹ç”¨æˆ·çŠ¶æ€çš„æ ¡éªŒ/ç”¨æˆ·ç™»å½•ä¿¡æ¯çš„è·å–\nç™»å½•ä¿¡æ¯è·å–/ç™»å½•çŠ¶æ€æ ¡éªŒ\nç”¨æˆ·ç™»å‡º # ç”¨æˆ·ç™»å‡ºæ—¶è¦åšçš„äº‹æƒ…å¾ˆç®€å•ï¼š\næœåŠ¡ç«¯æ¸…é™¤ç¼“å­˜ï¼ˆRedisï¼‰ä¸­çš„ç™»å½•çŠ¶æ€ å®¢æˆ·ç«¯æ¸…é™¤å­˜å‚¨çš„ AuthToken ç™»å‡ºæ—¶åºå›¾\nè·¨åŸŸç™»å½•ã€ç™»å‡º # å‰é¢æåˆ°è¿‡ï¼Œæ ¸å¿ƒæ€è·¯æ˜¯å®¢æˆ·ç«¯å­˜å‚¨ AuthTokenï¼ŒæœåŠ¡å™¨ç«¯é€šè¿‡ Redis å­˜å‚¨ç™»å½•ä¿¡æ¯ã€‚ç”±äºå®¢æˆ·ç«¯æ˜¯å°† AuthToken å­˜å‚¨åœ¨ Cookie ä¸­çš„ã€‚æ‰€ä»¥è·¨åŸŸè¦è§£å†³çš„é—®é¢˜ï¼Œå°±æ˜¯å¦‚ä½•è§£å†³ Cookie çš„è·¨åŸŸè¯»å†™é—®é¢˜ã€‚\nè§£å†³è·¨åŸŸçš„æ ¸å¿ƒæ€è·¯å°±æ˜¯ï¼š\nç™»å½•å®Œæˆä¹‹åé€šè¿‡å›è°ƒçš„æ–¹å¼ï¼Œå°† AuthToken ä¼ é€’ç»™ä¸»åŸŸåä¹‹å¤–çš„ç«™ç‚¹ï¼Œè¯¥ç«™ç‚¹è‡ªè¡Œå°† AuthToken ä¿å­˜åœ¨å½“å‰åŸŸä¸‹çš„ Cookie ä¸­ã€‚ ç™»å‡ºå®Œæˆä¹‹åé€šè¿‡å›è°ƒçš„æ–¹å¼ï¼Œè°ƒç”¨éä¸»åŸŸåç«™ç‚¹çš„ç™»å‡ºé¡µé¢ï¼Œå®Œæˆè®¾ç½® Cookie ä¸­çš„ AuthToken è¿‡æœŸçš„æ“ä½œã€‚(è¿‡æœŸï¼šå…ˆè®©ä¸»åŸŸåè¿‡æœŸï¼Œå†è®©éä¸»åŸŸåè¿‡æœŸ[tokenå¤±æ•ˆ]) è·¨åŸŸç™»å½•ï¼ˆä¸»åŸŸåå·²ç™»å½•ï¼‰ è·¨åŸŸç™»å½•ï¼ˆä¸»åŸŸåæœªç™»å½•ï¼‰\nè·¨åŸŸç™»å‡º\nè¯´æ˜ # å…³äºæ–¹æ¡ˆ ï¼šè¿™æ¬¡è®¾è®¡æ–¹æ¡ˆæ›´å¤šæ˜¯æä¾›å®ç°æ€è·¯ã€‚å¦‚æœæ¶‰åŠåˆ° APP ç”¨æˆ·ç™»å½•ç­‰æƒ…å†µï¼Œåœ¨è®¿é—® SSO æœåŠ¡æ—¶ï¼Œå¢åŠ å¯¹ APP çš„ç­¾åéªŒè¯å°±å¥½äº†ã€‚å½“ç„¶ï¼Œå¦‚æœæœ‰æ— çº¿ç½‘å…³ï¼ŒéªŒè¯ç­¾åä¸æ˜¯é—®é¢˜ã€‚ å…³äºæ—¶åºå›¾ï¼šæ—¶åºå›¾ä¸­å¹¶æ²¡æœ‰åŒ…å«æ‰€æœ‰åœºæ™¯ï¼Œåªåˆ—ä¸¾äº†æ ¸å¿ƒ/ä¸»è¦åœºæ™¯ï¼Œå¦å¤–å¯¹äºä¸€äº›ä¸å½±å“ç†è§£æ€è·¯çš„æ¶ˆæ¯èƒ½çœå°±çœäº†ã€‚ "},{"id":62,"href":"/zh/docs/study/Review/java_guide/lycly_system-design/security/ly03ly_jwt-advantages-disadvantages/","title":"jwtèº«ä»½è®¤è¯ä¼˜ç¼ºç‚¹","section":"å®‰å…¨","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nåœ¨ JWT åŸºæœ¬æ¦‚å¿µè¯¦è§£è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»‹ç»äº†ï¼š\nä»€ä¹ˆæ˜¯ JWT? JWT ç”±å“ªäº›éƒ¨åˆ†ç»„æˆï¼Ÿ å¦‚ä½•åŸºäº JWT è¿›è¡Œèº«ä»½éªŒè¯ï¼Ÿ JWT å¦‚ä½•é˜²æ­¢ Token è¢«ç¯¡æ”¹ï¼Ÿ å¦‚ä½•åŠ å¼º JWT çš„å®‰å…¨æ€§ï¼Ÿ è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬ä¸€èµ·æ¢è®¨ä¸€ä¸‹ JWT èº«ä»½è®¤è¯çš„ä¼˜ç¼ºç‚¹ä»¥åŠå¸¸è§é—®é¢˜çš„è§£å†³åŠæ³•ã€‚\nJWT çš„ä¼˜åŠ¿ # ç›¸æ¯”äº Session è®¤è¯çš„æ–¹å¼æ¥è¯´ï¼Œä½¿ç”¨ JWT è¿›è¡Œèº«ä»½è®¤è¯ä¸»è¦æœ‰ä¸‹é¢ 4 ä¸ªä¼˜åŠ¿ã€‚\næ— çŠ¶æ€ # JWT è‡ªèº«åŒ…å«äº†èº«ä»½éªŒè¯æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬çš„æœåŠ¡å™¨ä¸éœ€è¦å­˜å‚¨ Session ä¿¡æ¯ã€‚è¿™æ˜¾ç„¶å¢åŠ äº†ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œä¼¸ç¼©æ€§ï¼Œå¤§å¤§å‡è½»äº†æœåŠ¡ç«¯çš„å‹åŠ›ã€‚\nä¸è¿‡ï¼Œä¹Ÿæ­£æ˜¯ç”±äº JWT çš„æ— çŠ¶æ€ï¼Œä¹Ÿå¯¼è‡´äº†å®ƒæœ€å¤§çš„ç¼ºç‚¹ï¼šä¸å¯æ§ï¼\nå°±æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æƒ³è¦åœ¨ JWT æœ‰æ•ˆæœŸå†…åºŸå¼ƒä¸€ä¸ª JWT æˆ–è€…æ›´æ”¹å®ƒçš„æƒé™çš„è¯ï¼Œå¹¶ä¸ä¼šç«‹å³ç”Ÿæ•ˆï¼Œé€šå¸¸éœ€è¦ç­‰åˆ°æœ‰æ•ˆæœŸè¿‡åæ‰å¯ä»¥ã€‚å†æ¯”å¦‚è¯´ï¼Œå½“ç”¨æˆ· Logout çš„è¯ï¼ŒJWT ä¹Ÿè¿˜æœ‰æ•ˆã€‚é™¤éï¼Œæˆ‘ä»¬åœ¨åç«¯å¢åŠ é¢å¤–çš„å¤„ç†é€»è¾‘æ¯”å¦‚å°†å¤±æ•ˆçš„ JWT å­˜å‚¨èµ·æ¥ï¼Œåç«¯å…ˆéªŒè¯ JWT æ˜¯å¦æœ‰æ•ˆå†è¿›è¡Œå¤„ç†ã€‚å…·ä½“çš„è§£å†³åŠæ³•ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢çš„å†…å®¹ä¸­è¯¦ç»†ä»‹ç»åˆ°ï¼Œè¿™é‡Œåªæ˜¯ç®€å•æä¸€ä¸‹ã€‚\næœ‰æ•ˆé¿å…äº† CSRF æ”»å‡» # [ËˆfÉ”ËdÊ’É™ri] forgery ä¼ªé€ \nCSRFï¼ˆCross Site Request Forgeryï¼‰ ä¸€èˆ¬è¢«ç¿»è¯‘ä¸º è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œå±äºç½‘ç»œæ”»å‡»é¢†åŸŸèŒƒå›´ã€‚ç›¸æ¯”äº SQL è„šæœ¬æ³¨å…¥ã€XSS ç­‰å®‰å…¨æ”»å‡»æ–¹å¼ï¼ŒCSRF çš„çŸ¥ååº¦å¹¶æ²¡æœ‰å®ƒä»¬é«˜ã€‚ä½†æ˜¯ï¼Œå®ƒçš„ç¡®æ˜¯æˆ‘ä»¬å¼€å‘ç³»ç»Ÿæ—¶å¿…é¡»è¦è€ƒè™‘çš„å®‰å…¨éšæ‚£ã€‚å°±è¿ä¸šå†…æŠ€æœ¯æ ‡æ† Google çš„äº§å“ Gmail ä¹Ÿæ›¾åœ¨ 2007 å¹´çš„æ—¶å€™çˆ†å‡ºè¿‡ CSRF æ¼æ´ï¼Œè¿™ç»™ Gmail çš„ç”¨æˆ·é€ æˆäº†å¾ˆå¤§çš„æŸå¤±ã€‚\né‚£ä¹ˆç©¶ç«Ÿä»€ä¹ˆæ˜¯è·¨ç«™è¯·æ±‚ä¼ªé€ å‘¢ï¼Ÿ ç®€å•æ¥è¯´å°±æ˜¯ç”¨ä½ çš„èº«ä»½å»åšä¸€äº›ä¸å¥½çš„äº‹æƒ…ï¼ˆå‘é€ä¸€äº›å¯¹ä½ ä¸å‹å¥½çš„è¯·æ±‚æ¯”å¦‚æ¶æ„è½¬è´¦ï¼‰ã€‚\nä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼šå°å£®ç™»å½•äº†æŸç½‘ä¸Šé“¶è¡Œï¼Œä»–æ¥åˆ°äº†ç½‘ä¸Šé“¶è¡Œçš„å¸–å­åŒºï¼Œçœ‹åˆ°ä¸€ä¸ªå¸–å­ä¸‹é¢æœ‰ä¸€ä¸ªé“¾æ¥å†™ç€â€œç§‘å­¦ç†è´¢ï¼Œå¹´ç›ˆåˆ©ç‡è¿‡ä¸‡â€ï¼Œå°å£®å¥½å¥‡çš„ç‚¹å¼€äº†è¿™ä¸ªé“¾æ¥ï¼Œç»“æœå‘ç°è‡ªå·±çš„è´¦æˆ·å°‘äº† 10000 å…ƒã€‚è¿™æ˜¯è¿™ä¹ˆå›äº‹å‘¢ï¼ŸåŸæ¥é»‘å®¢åœ¨é“¾æ¥ä¸­è—äº†ä¸€ä¸ªè¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚ç›´æ¥åˆ©ç”¨å°å£®çš„èº«ä»½ç»™é“¶è¡Œå‘é€äº†ä¸€ä¸ªè½¬è´¦è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ä½ çš„ Cookie å‘é“¶è¡Œå‘å‡ºè¯·æ±‚ã€‚\n\u0026lt;a src=\u0026#34;http://www.mybank.com/Transfer?bankId=11\u0026amp;money=10000\u0026#34;\u0026gt;ç§‘å­¦ç†è´¢ï¼Œå¹´ç›ˆåˆ©ç‡è¿‡ä¸‡\u0026lt;/a\u0026gt; CSRF æ”»å‡»éœ€è¦ä¾èµ– Cookie ï¼ŒSession è®¤è¯ä¸­ Cookie ä¸­çš„ SessionID æ˜¯ç”±æµè§ˆå™¨å‘é€åˆ°æœåŠ¡ç«¯çš„ï¼Œåªè¦å‘å‡ºè¯·æ±‚ï¼ŒCookie å°±ä¼šè¢«æºå¸¦ã€‚å€ŸåŠ©è¿™ä¸ªç‰¹æ€§ï¼Œå³ä½¿é»‘å®¢æ— æ³•è·å–ä½ çš„ SessionIDï¼Œåªè¦è®©ä½ è¯¯ç‚¹æ”»å‡»é“¾æ¥ï¼Œå°±å¯ä»¥è¾¾åˆ°æ”»å‡»æ•ˆæœã€‚\nå¦å¤–ï¼Œå¹¶ä¸æ˜¯å¿…é¡»ç‚¹å‡»é“¾æ¥æ‰å¯ä»¥è¾¾åˆ°æ”»å‡»æ•ˆæœï¼Œå¾ˆå¤šæ—¶å€™ï¼Œåªè¦ä½ æ‰“å¼€äº†æŸä¸ªé¡µé¢ï¼ŒCSRF æ”»å‡»å°±ä¼šå‘ç”Ÿã€‚\n\u0026lt;img src=\u0026#34;http://www.mybank.com/Transfer?bankId=11\u0026amp;money=10000\u0026#34; /\u0026gt; é‚£ä¸ºä»€ä¹ˆ JWT ä¸ä¼šå­˜åœ¨è¿™ç§é—®é¢˜å‘¢ï¼Ÿ\nä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä½¿ç”¨ JWT çš„è¯ï¼Œåœ¨æˆ‘ä»¬ç™»å½•æˆåŠŸè·å¾— JWT ä¹‹åï¼Œä¸€èˆ¬ä¼šé€‰æ‹©å­˜æ”¾åœ¨ localStorage ä¸­ã€‚å‰ç«¯çš„æ¯ä¸€ä¸ªè¯·æ±‚åç»­éƒ½ä¼šé™„å¸¦ä¸Šè¿™ä¸ª JWTï¼Œæ•´ä¸ªè¿‡ç¨‹å‹æ ¹ä¸ä¼šæ¶‰åŠåˆ° Cookieã€‚å› æ­¤ï¼Œå³ä½¿ä½ ç‚¹å‡»äº†éæ³•é“¾æ¥å‘é€äº†è¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼Œè¿™ä¸ªéæ³•è¯·æ±‚ä¹Ÿæ˜¯ä¸ä¼šæºå¸¦ JWT çš„ï¼Œæ‰€ä»¥è¿™ä¸ªè¯·æ±‚å°†æ˜¯éæ³•çš„ã€‚\næ€»ç»“æ¥è¯´å°±ä¸€å¥è¯ï¼šä½¿ç”¨ JWT è¿›è¡Œèº«ä»½éªŒè¯ä¸éœ€è¦ä¾èµ– Cookie ï¼Œå› æ­¤å¯ä»¥é¿å… CSRF æ”»å‡»ã€‚\nä¸è¿‡ï¼Œè¿™æ ·ä¹Ÿä¼šå­˜åœ¨ XSS æ”»å‡»çš„é£é™©ã€‚ä¸ºäº†é¿å… XSS æ”»å‡»ï¼Œä½ å¯ä»¥é€‰æ‹©å°† JWT å­˜å‚¨åœ¨æ ‡è®°ä¸ºhttpOnly çš„ Cookie ä¸­ã€‚ä½†æ˜¯ï¼Œè¿™æ ·åˆå¯¼è‡´äº†ä½ å¿…é¡»è‡ªå·±æä¾› CSRF ä¿æŠ¤ï¼Œå› æ­¤ï¼Œå®é™…é¡¹ç›®ä¸­æˆ‘ä»¬é€šå¸¸ä¹Ÿä¸ä¼šè¿™ä¹ˆåšã€‚\nXSSæ”»å‡»åˆç§°ä¸ºè·¨ç«™è„šæœ¬ï¼ŒXSSçš„é‡ç‚¹ä¸åœ¨äºè·¨ç«™ç‚¹ï¼Œè€Œæ˜¯åœ¨äºè„šæœ¬çš„æ‰§è¡Œã€‚XSSæ˜¯ä¸€ç§ç»å¸¸å‡ºç°åœ¨Webåº”ç”¨ç¨‹åºä¸­çš„è®¡ç®—æœºå®‰å…¨æ¼æ´ï¼Œæ˜¯ç”±äºWebåº”ç”¨ç¨‹åºå¯¹ç”¨æˆ·çš„è¾“å…¥è¿‡æ»¤ä¸è¶³è€Œäº§ç”Ÿçš„ï¼Œå®ƒå…è®¸æ¶æ„webç”¨æˆ·å°†ä»£ç æ¤å…¥åˆ°æä¾›ç»™å…¶å®ƒç”¨æˆ·ä½¿ç”¨çš„é¡µé¢ä¸­ã€‚\nå¸¸è§çš„é¿å… XSS æ”»å‡»çš„æ–¹å¼æ˜¯è¿‡æ»¤æ‰è¯·æ±‚ä¸­å­˜åœ¨ XSS æ”»å‡»é£é™©çš„å¯ç–‘å­—ç¬¦ä¸²ã€‚\nåœ¨ Spring é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯é€šè¿‡åˆ›å»º XSS è¿‡æ»¤å™¨æ¥å®ç°çš„ã€‚\n@Component @Order(Ordered.HIGHEST_PRECEDENCE) public class XSSFilter implements Filter { @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException { XSSRequestWrapper wrappedRequest = new XSSRequestWrapper((HttpServletRequest) request); chain.doFilter(wrappedRequest, response); } // other methods } é€‚åˆç§»åŠ¨ç«¯åº”ç”¨ # ä½¿ç”¨ Session è¿›è¡Œèº«ä»½è®¤è¯çš„è¯ï¼Œéœ€è¦ä¿å­˜ä¸€ä»½ä¿¡æ¯åœ¨æœåŠ¡å™¨ç«¯ï¼Œè€Œä¸”è¿™ç§æ–¹å¼ä¼šä¾èµ–åˆ° Cookieï¼ˆéœ€è¦ Cookie ä¿å­˜ SessionIdï¼‰ï¼Œæ‰€ä»¥ä¸é€‚åˆç§»åŠ¨ç«¯ã€‚\nä½†æ˜¯ï¼Œä½¿ç”¨ JWT è¿›è¡Œèº«ä»½è®¤è¯å°±ä¸ä¼šå­˜åœ¨è¿™ç§é—®é¢˜ï¼Œå› ä¸ºåªè¦ JWT å¯ä»¥è¢«å®¢æˆ·ç«¯å­˜å‚¨å°±èƒ½å¤Ÿä½¿ç”¨ï¼Œè€Œä¸” JWT è¿˜å¯ä»¥è·¨è¯­è¨€ä½¿ç”¨ã€‚\nå•ç‚¹ç™»å½•å‹å¥½ # ä½¿ç”¨ Session è¿›è¡Œèº«ä»½è®¤è¯çš„è¯ï¼Œå®ç°å•ç‚¹ç™»å½•ï¼Œéœ€è¦æˆ‘ä»¬æŠŠç”¨æˆ·çš„ Session ä¿¡æ¯ä¿å­˜åœ¨ä¸€å°ç”µè„‘ä¸Šï¼Œå¹¶ä¸”è¿˜ä¼šé‡åˆ°å¸¸è§çš„ Cookie è·¨åŸŸçš„é—®é¢˜ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨ JWT è¿›è¡Œè®¤è¯çš„è¯ï¼Œ JWT è¢«ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œä¸ä¼šå­˜åœ¨è¿™äº›é—®é¢˜ã€‚\nJWT èº«ä»½è®¤è¯å¸¸è§é—®é¢˜åŠè§£å†³åŠæ³• # æ³¨é”€ç™»å½•ç­‰åœºæ™¯ä¸‹ JWT è¿˜æœ‰æ•ˆ # ä¸ä¹‹ç±»ä¼¼çš„å…·ä½“ç›¸å…³åœºæ™¯æœ‰ï¼š\né€€å‡ºç™»å½•; ä¿®æ”¹å¯†ç ; æœåŠ¡ç«¯ä¿®æ”¹äº†æŸä¸ªç”¨æˆ·å…·æœ‰çš„æƒé™æˆ–è€…è§’è‰²ï¼› ç”¨æˆ·çš„å¸æˆ·è¢«å°ç¦/åˆ é™¤ï¼› ç”¨æˆ·è¢«æœåŠ¡ç«¯å¼ºåˆ¶æ³¨é”€ï¼› ç”¨æˆ·è¢«è¸¢ä¸‹çº¿ï¼› \u0026hellip;\u0026hellip; è¿™ä¸ªé—®é¢˜ä¸å­˜åœ¨äº Session è®¤è¯æ–¹å¼ä¸­ï¼Œå› ä¸ºåœ¨ Session è®¤è¯æ–¹å¼ä¸­ï¼Œé‡åˆ°è¿™ç§æƒ…å†µçš„è¯æœåŠ¡ç«¯åˆ é™¤å¯¹åº”çš„ Session è®°å½•å³å¯ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨ JWT è®¤è¯çš„æ–¹å¼å°±ä¸å¥½è§£å†³äº†ã€‚æˆ‘ä»¬ä¹Ÿè¯´è¿‡äº†ï¼ŒJWT ä¸€æ—¦æ´¾å‘å‡ºå»ï¼Œå¦‚æœåç«¯ä¸å¢åŠ å…¶ä»–é€»è¾‘çš„è¯ï¼Œå®ƒåœ¨å¤±æ•ˆä¹‹å‰éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚\né‚£æˆ‘ä»¬å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼ŸæŸ¥é˜…äº†å¾ˆå¤šèµ„æ–™ï¼Œæˆ‘ç®€å•æ€»ç»“äº†ä¸‹é¢ 4 ç§æ–¹æ¡ˆï¼š\n1ã€å°† JWT å­˜å…¥å†…å­˜æ•°æ®åº“\nå°† JWT å­˜å…¥ DB ä¸­ï¼ŒRedis å†…å­˜æ•°æ®åº“åœ¨è¿™é‡Œæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚å¦‚æœéœ€è¦è®©æŸä¸ª JWT å¤±æ•ˆå°±ç›´æ¥ä» Redis ä¸­åˆ é™¤è¿™ä¸ª JWT å³å¯ã€‚ä½†æ˜¯ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ¯æ¬¡ä½¿ç”¨ JWT å‘é€è¯·æ±‚éƒ½è¦å…ˆä» DB ä¸­æŸ¥è¯¢ JWT æ˜¯å¦å­˜åœ¨çš„æ­¥éª¤ï¼Œè€Œä¸”è¿èƒŒäº† JWT çš„æ— çŠ¶æ€åŸåˆ™ã€‚\n2ã€é»‘åå•æœºåˆ¶\nå’Œä¸Šé¢çš„æ–¹å¼ç±»ä¼¼ï¼Œä½¿ç”¨å†…å­˜æ•°æ®åº“æ¯”å¦‚ Redis ç»´æŠ¤ä¸€ä¸ªé»‘åå•ï¼Œå¦‚æœæƒ³è®©æŸä¸ª JWT å¤±æ•ˆçš„è¯å°±ç›´æ¥å°†è¿™ä¸ª JWT åŠ å…¥åˆ° é»‘åå• å³å¯ã€‚ç„¶åï¼Œæ¯æ¬¡ä½¿ç”¨ JWT è¿›è¡Œè¯·æ±‚çš„è¯éƒ½ä¼šå…ˆåˆ¤æ–­è¿™ä¸ª JWT æ˜¯å¦å­˜åœ¨äºé»‘åå•ä¸­ã€‚\nå‰ä¸¤ç§æ–¹æ¡ˆçš„æ ¸å¿ƒåœ¨äºå°†æœ‰æ•ˆçš„ JWT å­˜å‚¨èµ·æ¥æˆ–è€…å°†æŒ‡å®šçš„ JWT æ‹‰å…¥é»‘åå•ã€‚\nè™½ç„¶è¿™ä¸¤ç§æ–¹æ¡ˆéƒ½è¿èƒŒäº† JWT çš„æ— çŠ¶æ€åŸåˆ™ï¼Œä½†æ˜¯ä¸€èˆ¬å®é™…é¡¹ç›®ä¸­æˆ‘ä»¬é€šå¸¸è¿˜æ˜¯ä¼šä½¿ç”¨è¿™ä¸¤ç§æ–¹æ¡ˆã€‚\n3ã€ä¿®æ”¹å¯†é’¥ (Secret) :\næˆ‘ä»¬ä¸ºæ¯ä¸ªç”¨æˆ·éƒ½åˆ›å»ºä¸€ä¸ªä¸“å±å¯†é’¥ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è®©æŸä¸ª JWT å¤±æ•ˆï¼Œæˆ‘ä»¬ç›´æ¥ä¿®æ”¹å¯¹åº”ç”¨æˆ·çš„å¯†é’¥å³å¯ã€‚ä½†æ˜¯ï¼Œè¿™æ ·ç›¸æ¯”äºå‰ä¸¤ç§å¼•å…¥å†…å­˜æ•°æ®åº“å¸¦æ¥äº†å±å®³æ›´å¤§ï¼š\nå¦‚æœæœåŠ¡æ˜¯åˆ†å¸ƒå¼çš„ï¼Œåˆ™æ¯æ¬¡å‘å‡ºæ–°çš„ JWT æ—¶éƒ½å¿…é¡»åœ¨å¤šå°æœºå™¨åŒæ­¥å¯†é’¥ã€‚ä¸ºæ­¤ï¼Œä½ éœ€è¦å°†å¯†é’¥å­˜å‚¨åœ¨æ•°æ®åº“æˆ–å…¶ä»–å¤–éƒ¨æœåŠ¡ä¸­ï¼Œè¿™æ ·å’Œ Session è®¤è¯å°±æ²¡å¤ªå¤§åŒºåˆ«äº†ã€‚ å¦‚æœç”¨æˆ·åŒæ—¶åœ¨ä¸¤ä¸ªæµè§ˆå™¨æ‰“å¼€ç³»ç»Ÿï¼Œæˆ–è€…åœ¨æ‰‹æœºç«¯ä¹Ÿæ‰“å¼€äº†ç³»ç»Ÿï¼Œå¦‚æœå®ƒä»ä¸€ä¸ªåœ°æ–¹å°†è´¦å·é€€å‡ºï¼Œé‚£ä¹ˆå…¶ä»–åœ°æ–¹éƒ½è¦é‡æ–°è¿›è¡Œç™»å½•ï¼Œè¿™æ˜¯ä¸å¯å–çš„ã€‚ 4ã€ä¿æŒä»¤ç‰Œçš„æœ‰æ•ˆæœŸé™çŸ­å¹¶ç»å¸¸è½®æ¢\nå¾ˆç®€å•çš„ä¸€ç§æ–¹å¼ã€‚ä½†æ˜¯ï¼Œä¼šå¯¼è‡´ç”¨æˆ·ç™»å½•çŠ¶æ€ä¸ä¼šè¢«æŒä¹…è®°å½•ï¼Œè€Œä¸”éœ€è¦ç”¨æˆ·ç»å¸¸ç™»å½•ã€‚\nå¦å¤–ï¼Œå¯¹äºä¿®æ”¹å¯†ç å JWT è¿˜æœ‰æ•ˆé—®é¢˜çš„è§£å†³è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ã€‚è¯´ä¸€ç§æˆ‘è§‰å¾—æ¯”è¾ƒå¥½çš„æ–¹å¼ï¼šä½¿ç”¨ç”¨æˆ·çš„å¯†ç çš„å“ˆå¸Œå€¼å¯¹ JWT è¿›è¡Œç­¾åã€‚å› æ­¤ï¼Œå¦‚æœå¯†ç æ›´æ”¹ï¼Œåˆ™ä»»ä½•å…ˆå‰çš„ä»¤ç‰Œå°†è‡ªåŠ¨æ— æ³•éªŒè¯ã€‚\nJWT çš„ç»­ç­¾é—®é¢˜ # JWT æœ‰æ•ˆæœŸä¸€èˆ¬éƒ½å»ºè®®è®¾ç½®çš„ä¸å¤ªé•¿ï¼Œé‚£ä¹ˆ JWT è¿‡æœŸåå¦‚ä½•è®¤è¯ï¼Œå¦‚ä½•å®ç°åŠ¨æ€åˆ·æ–° JWTï¼Œé¿å…ç”¨æˆ·ç»å¸¸éœ€è¦é‡æ–°ç™»å½•ï¼Ÿ\næˆ‘ä»¬å…ˆæ¥çœ‹çœ‹åœ¨ Session è®¤è¯ä¸­ä¸€èˆ¬çš„åšæ³•ï¼šå‡å¦‚ Session çš„æœ‰æ•ˆæœŸ 30 åˆ†é’Ÿï¼Œå¦‚æœ 30 åˆ†é’Ÿå†…ç”¨æˆ·æœ‰è®¿é—®ï¼Œå°±æŠŠ Session æœ‰æ•ˆæœŸå»¶é•¿ 30 åˆ†é’Ÿã€‚\nJWT è®¤è¯çš„è¯ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•è§£å†³ç»­ç­¾é—®é¢˜å‘¢ï¼ŸæŸ¥é˜…äº†å¾ˆå¤šèµ„æ–™ï¼Œæˆ‘ç®€å•æ€»ç»“äº†ä¸‹é¢ 4 ç§æ–¹æ¡ˆï¼š\n1ã€ç±»ä¼¼äº Session è®¤è¯ä¸­çš„åšæ³•\nè¿™ç§æ–¹æ¡ˆæ»¡è¶³äºå¤§éƒ¨åˆ†åœºæ™¯ã€‚å‡è®¾æœåŠ¡ç«¯ç»™çš„ JWT æœ‰æ•ˆæœŸè®¾ç½®ä¸º 30 åˆ†é’Ÿï¼ŒæœåŠ¡ç«¯æ¯æ¬¡è¿›è¡Œæ ¡éªŒæ—¶ï¼Œå¦‚æœå‘ç° JWT çš„æœ‰æ•ˆæœŸé©¬ä¸Šå¿«è¿‡æœŸäº†ï¼ŒæœåŠ¡ç«¯å°±é‡æ–°ç”Ÿæˆ JWT ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚éƒ½æ£€æŸ¥æ–°æ—§ JWTï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œåˆ™æ›´æ–°æœ¬åœ°çš„ JWTã€‚è¿™ç§åšæ³•çš„é—®é¢˜æ˜¯ä»…ä»…åœ¨å¿«è¿‡æœŸçš„æ—¶å€™è¯·æ±‚æ‰ä¼šæ›´æ–° JWT ,å¯¹å®¢æˆ·ç«¯ä¸æ˜¯å¾ˆå‹å¥½ã€‚\n2ã€æ¯æ¬¡è¯·æ±‚éƒ½è¿”å›æ–° JWT\nè¿™ç§æ–¹æ¡ˆçš„çš„æ€è·¯å¾ˆç®€å•ï¼Œä½†æ˜¯ï¼Œå¼€é”€ä¼šæ¯”è¾ƒå¤§ï¼Œå°¤å…¶æ˜¯åœ¨æœåŠ¡ç«¯è¦å­˜å‚¨ç»´æŠ¤ JWT çš„æƒ…å†µä¸‹ã€‚\n3ã€JWT æœ‰æ•ˆæœŸè®¾ç½®åˆ°åŠå¤œ\nè¿™ç§æ–¹æ¡ˆæ˜¯ä¸€ç§æŠ˜è¡·çš„æ–¹æ¡ˆï¼Œä¿è¯äº†å¤§éƒ¨åˆ†ç”¨æˆ·ç™½å¤©å¯ä»¥æ­£å¸¸ç™»å½•ï¼Œé€‚ç”¨äºå¯¹å®‰å…¨æ€§è¦æ±‚ä¸é«˜çš„ç³»ç»Ÿã€‚\n4ã€ç”¨æˆ·ç™»å½•è¿”å›ä¸¤ä¸ª JWT\nç¬¬ä¸€ä¸ªæ˜¯ accessJWT ï¼Œå®ƒçš„è¿‡æœŸæ—¶é—´ JWT æœ¬èº«çš„è¿‡æœŸæ—¶é—´æ¯”å¦‚åŠä¸ªå°æ—¶ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ refreshJWT å®ƒçš„è¿‡æœŸæ—¶é—´æ›´é•¿ä¸€ç‚¹æ¯”å¦‚ä¸º 1 å¤©ã€‚å®¢æˆ·ç«¯ç™»å½•åï¼Œå°† accessJWT å’Œ refreshJWT ä¿å­˜åœ¨æœ¬åœ°ï¼Œæ¯æ¬¡è®¿é—®å°† accessJWT ä¼ ç»™æœåŠ¡ç«¯ã€‚æœåŠ¡ç«¯æ ¡éªŒ accessJWT çš„æœ‰æ•ˆæ€§ï¼Œå¦‚æœè¿‡æœŸçš„è¯ï¼Œå°±å°† refreshJWT ä¼ ç»™æœåŠ¡ç«¯ã€‚å¦‚æœæœ‰æ•ˆï¼ŒæœåŠ¡ç«¯å°±ç”Ÿæˆæ–°çš„ accessJWT ç»™å®¢æˆ·ç«¯ã€‚å¦åˆ™ï¼Œå®¢æˆ·ç«¯å°±é‡æ–°ç™»å½•å³å¯ã€‚\nè¿™ç§æ–¹æ¡ˆçš„ä¸è¶³æ˜¯ï¼š\néœ€è¦å®¢æˆ·ç«¯æ¥é…åˆï¼›\nç”¨æˆ·æ³¨é”€çš„æ—¶å€™éœ€è¦åŒæ—¶ä¿è¯ä¸¤ä¸ª JWT éƒ½æ— æ•ˆï¼›\né‡æ–°è¯·æ±‚è·å– JWT çš„è¿‡ç¨‹ä¸­ä¼šæœ‰çŸ­æš‚ JWT ä¸å¯ç”¨çš„æƒ…å†µï¼ˆå¯ä»¥é€šè¿‡åœ¨å®¢æˆ·ç«¯è®¾ç½®å®šæ—¶å™¨ï¼Œå½“ accessJWT å¿«è¿‡æœŸçš„æ—¶å€™ï¼Œæå‰å»é€šè¿‡ refreshJWT è·å–æ–°çš„ accessJWTï¼‰;\nè¿™é‡Œè¯´çš„çŸ­æš‚ï¼Œå°±æ˜¯accessJWTå¤±æ•ˆè€ŒrefreshJWTæˆåŠŸçš„é‚£ç§æƒ…å†µ\nå­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œåªè¦æ‹¿åˆ°äº†æœªè¿‡æœŸçš„ refreshJWT å°±ä¸€ç›´å¯ä»¥è·å–åˆ° accessJWTã€‚\næ€»ç»“ # JWT å…¶ä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„ä¼˜åŠ¿æ˜¯æ— çŠ¶æ€ï¼Œä½†å®é™…ä¸Šï¼Œæˆ‘ä»¬æƒ³è¦åœ¨å®é™…é¡¹ç›®ä¸­åˆç†ä½¿ç”¨ JWT çš„è¯ï¼Œä¹Ÿè¿˜æ˜¯éœ€è¦ä¿å­˜ JWT ä¿¡æ¯ã€‚\nJWT ä¹Ÿä¸æ˜¯é“¶å¼¹ï¼Œä¹Ÿæœ‰å¾ˆå¤šç¼ºé™·ï¼Œå…·ä½“æ˜¯é€‰æ‹© JWT è¿˜æ˜¯ Session æ–¹æ¡ˆè¿˜æ˜¯è¦çœ‹é¡¹ç›®çš„å…·ä½“éœ€æ±‚ã€‚ä¸‡ä¸‡ä¸å¯å°¬å¹ JWTï¼Œè€Œçœ‹ä¸èµ·å…¶ä»–èº«ä»½è®¤è¯æ–¹æ¡ˆã€‚\nå¦å¤–ï¼Œä¸ç”¨ JWT ç›´æ¥ä½¿ç”¨æ™®é€šçš„ Token(éšæœºç”Ÿæˆï¼Œä¸åŒ…å«å…·ä½“çš„ä¿¡æ¯) ç»“åˆ Redis æ¥åšèº«ä»½è®¤è¯ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚æˆ‘åœ¨ ã€Œä¼˜è´¨å¼€æºé¡¹ç›®æ¨èã€çš„ç¬¬ 8 æœŸæ¨èè¿‡çš„ Sa-Token è¿™ä¸ªé¡¹ç›®æ˜¯ä¸€ä¸ªæ¯”è¾ƒå®Œå–„çš„ åŸºäº JWT çš„èº«ä»½è®¤è¯è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒè‡ªåŠ¨ç»­ç­¾ã€è¸¢äººä¸‹çº¿ã€è´¦å·å°ç¦ã€åŒç«¯äº’æ–¥ç™»å½•ç­‰åŠŸèƒ½ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥çœ‹çœ‹ã€‚\nå‚è€ƒ # JWT è¶…è¯¦ç»†åˆ†æï¼šhttps://learnku.com/articles/17883 How to log out when using JWTï¼šhttps://medium.com/devgorilla/how-to-log-out-when-using-jwt-a8c7823e8a6 CSRF protection with JSON Web JWTsï¼šhttps://medium.com/@agungsantoso/csrf-protection-with-json-web-JWTs-83e0f2fcbcc Invalidating JSON Web JWTsï¼šhttps://stackoverflow.com/questions/21978658/invalidating-json-web-JWTs "},{"id":63,"href":"/zh/docs/study/Review/java_guide/lycly_system-design/security/ly02ly_jwt-intro/","title":"jwt-intro","section":"å®‰å…¨","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nä»€ä¹ˆæ˜¯ JWT? # JWT ï¼ˆJSON Web Tokenï¼‰ æ˜¯ç›®å‰æœ€æµè¡Œçš„è·¨åŸŸè®¤è¯è§£å†³æ–¹æ¡ˆï¼Œæ˜¯ä¸€ç§åŸºäº Token çš„è®¤è¯æˆæƒæœºåˆ¶ã€‚ ä» JWT çš„å…¨ç§°å¯ä»¥çœ‹å‡ºï¼ŒJWT æœ¬èº«ä¹Ÿæ˜¯ Tokenï¼Œä¸€ç§è§„èŒƒåŒ–ä¹‹åçš„ JSON ç»“æ„çš„ Tokenã€‚\nè·¨åŸŸè®¤è¯çš„é—®é¢˜\näº’è”ç½‘æœåŠ¡ç¦»ä¸å¼€ç”¨æˆ·è®¤è¯ã€‚ä¸€èˆ¬æµç¨‹æ˜¯ä¸‹é¢è¿™æ ·ã€‚\nè¿™ç§æ¨¡å¼çš„é—®é¢˜åœ¨äºï¼Œæ‰©å±•æ€§ï¼ˆscalingï¼‰ä¸å¥½ã€‚å•æœºå½“ç„¶æ²¡æœ‰é—®é¢˜ï¼Œå¦‚æœæ˜¯æœåŠ¡å™¨é›†ç¾¤ï¼Œæˆ–è€…æ˜¯è·¨åŸŸçš„æœåŠ¡å¯¼å‘æ¶æ„ï¼Œå°±è¦æ±‚ session æ•°æ®å…±äº«ï¼Œæ¯å°æœåŠ¡å™¨éƒ½èƒ½å¤Ÿè¯»å– sessionã€‚\nä¸¾ä¾‹æ¥è¯´ï¼ŒA ç½‘ç«™å’Œ B ç½‘ç«™æ˜¯åŒä¸€å®¶å…¬å¸çš„å…³è”æœåŠ¡ã€‚ç°åœ¨è¦æ±‚ï¼Œç”¨æˆ·åªè¦åœ¨å…¶ä¸­ä¸€ä¸ªç½‘ç«™ç™»å½•ï¼Œå†è®¿é—®å¦ä¸€ä¸ªç½‘ç«™å°±ä¼šè‡ªåŠ¨ç™»å½•ï¼Œè¯·é—®æ€ä¹ˆå®ç°ï¼Ÿ\nä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ session æ•°æ®æŒä¹…åŒ–ï¼Œå†™å…¥æ•°æ®åº“æˆ–åˆ«çš„æŒä¹…å±‚ã€‚å„ç§æœåŠ¡æ”¶åˆ°è¯·æ±‚åï¼Œéƒ½å‘æŒä¹…å±‚è¯·æ±‚æ•°æ®ã€‚è¿™ç§æ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯æ¶æ„æ¸…æ™°ï¼Œç¼ºç‚¹æ˜¯å·¥ç¨‹é‡æ¯”è¾ƒå¤§ã€‚å¦å¤–ï¼ŒæŒä¹…å±‚ä¸‡ä¸€æŒ‚äº†ï¼Œå°±ä¼šå•ç‚¹å¤±è´¥ã€‚\nå¦ä¸€ç§æ–¹æ¡ˆæ˜¯æœåŠ¡å™¨ç´¢æ€§ä¸ä¿å­˜ session æ•°æ®äº†ï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å‘å›æœåŠ¡å™¨ã€‚JWT å°±æ˜¯è¿™ç§æ–¹æ¡ˆçš„ä¸€ä¸ªä»£è¡¨ã€‚\nJWT è‡ªèº«åŒ…å«äº†èº«ä»½éªŒè¯æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬çš„æœåŠ¡å™¨ä¸éœ€è¦å­˜å‚¨ Session ä¿¡æ¯ã€‚è¿™æ˜¾ç„¶å¢åŠ äº†ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œä¼¸ç¼©æ€§ï¼Œå¤§å¤§å‡è½»äº†æœåŠ¡ç«¯çš„å‹åŠ›ã€‚\nlyï¼šæˆ‘è§‰å¾—è¿™é‡Œçš„é‡ç‚¹å°±æ˜¯ï¼ŒæœåŠ¡å™¨ä¸å­˜å‚¨Sessionä»¥ç»´æŠ¤\u0026quot;ç”¨æˆ·\u0026quot;å’Œcookie(session id)çš„å…³ç³»äº†\nå¯ä»¥çœ‹å‡ºï¼ŒJWT æ›´ç¬¦åˆè®¾è®¡ RESTful API æ—¶çš„ã€ŒStatelessï¼ˆæ— çŠ¶æ€ï¼‰ã€åŸåˆ™ ã€‚\nå¹¶ä¸”ï¼Œ ä½¿ç”¨ JWT è®¤è¯å¯ä»¥æœ‰æ•ˆé¿å… CSRF æ”»å‡»ï¼Œå› ä¸º JWT ä¸€èˆ¬æ˜¯å­˜åœ¨åœ¨ localStorage ä¸­ï¼Œä½¿ç”¨ JWT è¿›è¡Œèº«ä»½éªŒè¯çš„è¿‡ç¨‹ä¸­æ˜¯ä¸ä¼šæ¶‰åŠåˆ° Cookie çš„ã€‚\næˆ‘åœ¨ JWT ä¼˜ç¼ºç‚¹åˆ†æè¿™ç¯‡æ–‡ç« ä¸­æœ‰è¯¦ç»†ä»‹ç»åˆ°ä½¿ç”¨ JWT åšèº«ä»½è®¤è¯çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ã€‚\nä¸‹é¢æ˜¯ RFC 7519 å¯¹ JWT åšçš„è¾ƒä¸ºæ­£å¼çš„å®šä¹‰ã€‚\nJSON Web Token (JWT) is a compact, URL-safe means of representing claims to be transferred between two parties. The claims in a JWT are encoded as a JSON object that is used as the payload of a JSON Web Signature (JWS) structure or as the plaintext of a JSON Web Encryption (JWE) structure, enabling the claims to be digitally signed or integrity protected with a Message Authentication Code (MAC) and/or encrypted. â€”â€”JSON Web Token (JWT)\nJWT ç”±å“ªäº›éƒ¨åˆ†ç»„æˆï¼Ÿ # JWT æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç»„å­—ä¸²ï¼Œé€šè¿‡ï¼ˆ.ï¼‰åˆ‡åˆ†æˆä¸‰ä¸ªä¸º Base64 ç¼–ç çš„éƒ¨åˆ†ï¼š\nHeader : æè¿° JWT çš„å…ƒæ•°æ®ï¼Œå®šä¹‰äº†ç”Ÿæˆç­¾åçš„ç®—æ³•ä»¥åŠ Token çš„ç±»å‹ã€‚ Payload : ç”¨æ¥å­˜æ”¾å®é™…éœ€è¦ä¼ é€’çš„æ•°æ® Signatureï¼ˆç­¾åï¼‰ ï¼šæœåŠ¡å™¨é€šè¿‡ Payloadã€Header å’Œ**ä¸€ä¸ªå¯†é’¥(Secret)**ä½¿ç”¨ Header é‡Œé¢æŒ‡å®šçš„ç­¾åç®—æ³•ï¼ˆé»˜è®¤æ˜¯ HMAC SHA256ï¼‰ç”Ÿæˆã€‚ JWT é€šå¸¸æ˜¯è¿™æ ·çš„ï¼šxxxxx.yyyyy.zzzzzã€‚\nç¤ºä¾‹ï¼š\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9. eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ. SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c ä½ å¯ä»¥åœ¨ jwt.io è¿™ä¸ªç½‘ç«™ä¸Šå¯¹å…¶ JWT è¿›è¡Œè§£ç ï¼Œè§£ç ä¹‹åå¾—åˆ°çš„å°±æ˜¯ Headerã€Payloadã€Signature è¿™ä¸‰éƒ¨åˆ†ã€‚\nHeader å’Œ Payload éƒ½æ˜¯ JSON æ ¼å¼çš„æ•°æ®ï¼ŒSignature ç”± Payloadã€Header å’Œ **Secret(å¯†é’¥)**é€šè¿‡ç‰¹å®šçš„è®¡ç®—å…¬å¼å’ŒåŠ å¯†ç®—æ³•å¾—åˆ°ã€‚\nHeader # Header é€šå¸¸ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š\ntypï¼ˆTypeï¼‰ï¼šä»¤ç‰Œç±»å‹ï¼Œä¹Ÿå°±æ˜¯ JWTã€‚ algï¼ˆAlgorithmï¼‰ ï¼šç­¾åç®—æ³•ï¼Œæ¯”å¦‚ HS256ã€‚ ç¤ºä¾‹ï¼š\n{ \u0026#34;alg\u0026#34;: \u0026#34;HS256\u0026#34;, \u0026#34;typ\u0026#34;: \u0026#34;JWT\u0026#34; } JSON å½¢å¼çš„ Header è¢«è½¬æ¢æˆ Base64 ç¼–ç ï¼Œæˆä¸º JWT çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚\nPayload # Payload ä¹Ÿæ˜¯ JSON æ ¼å¼æ•°æ®ï¼Œå…¶ä¸­åŒ…å«äº† Claims(å£°æ˜ï¼ŒåŒ…å« JWT çš„ç›¸å…³ä¿¡æ¯)ã€‚\nClaims åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š\nRegistered Claimsï¼ˆæ³¨å†Œå£°æ˜ï¼‰ ï¼šé¢„å®šä¹‰çš„ä¸€äº›å£°æ˜ï¼Œå»ºè®®ä½¿ç”¨ï¼Œä½†ä¸æ˜¯å¼ºåˆ¶æ€§çš„ã€‚ Public Claimsï¼ˆå…¬æœ‰å£°æ˜ï¼‰ ï¼šJWT ç­¾å‘æ–¹å¯ä»¥è‡ªå®šä¹‰çš„å£°æ˜ï¼Œä½†æ˜¯ä¸ºäº†é¿å…å†²çªï¼Œåº”è¯¥åœ¨ IANA JSON Web Token Registry ä¸­å®šä¹‰å®ƒä»¬ã€‚ Private Claimsï¼ˆç§æœ‰å£°æ˜ï¼‰ ï¼šJWT ç­¾å‘æ–¹å› ä¸ºé¡¹ç›®éœ€è¦è€Œè‡ªå®šä¹‰çš„å£°æ˜ï¼Œæ›´ç¬¦åˆå®é™…é¡¹ç›®åœºæ™¯ä½¿ç”¨ã€‚ ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„æ³¨å†Œå£°æ˜ï¼š\nissï¼ˆissuerï¼‰ï¼šJWT ç­¾å‘æ–¹ã€‚ iatï¼ˆissued at timeï¼‰ï¼šJWT ç­¾å‘æ—¶é—´ã€‚ subï¼ˆsubjectï¼‰ï¼šJWT ä¸»é¢˜ã€‚ audï¼ˆaudienceï¼‰ï¼šJWT æ¥æ”¶æ–¹ã€‚ expï¼ˆexpiration timeï¼‰ï¼šJWT çš„è¿‡æœŸæ—¶é—´ã€‚ nbfï¼ˆnot before timeï¼‰ï¼šJWT ç”Ÿæ•ˆæ—¶é—´ï¼Œæ—©äºè¯¥å®šä¹‰çš„æ—¶é—´çš„ JWT ä¸èƒ½è¢«æ¥å—å¤„ç†ã€‚ jtiï¼ˆJWT IDï¼‰ï¼šJWT å”¯ä¸€æ ‡è¯†ã€‚ ç¤ºä¾‹ï¼š\n{ \u0026#34;uid\u0026#34;: \u0026#34;ff1212f5-d8d1-4496-bf41-d2dda73de19a\u0026#34;, \u0026#34;sub\u0026#34;: \u0026#34;1234567890\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;John Doe\u0026#34;, \u0026#34;exp\u0026#34;: 15323232, \u0026#34;iat\u0026#34;: 1516239022, \u0026#34;scope\u0026#34;: [\u0026#34;admin\u0026#34;, \u0026#34;user\u0026#34;] } Payload éƒ¨åˆ†é»˜è®¤æ˜¯ä¸åŠ å¯†çš„ï¼Œä¸€å®šä¸è¦å°†éšç§ä¿¡æ¯å­˜æ”¾åœ¨ Payload å½“ä¸­ï¼ï¼ï¼\nJSON å½¢å¼çš„ Payload è¢«è½¬æ¢æˆ Base64 ç¼–ç ï¼Œæˆä¸º JWT çš„ç¬¬äºŒéƒ¨åˆ†ã€‚\nSignature # Signature éƒ¨åˆ†æ˜¯å¯¹å‰ä¸¤éƒ¨åˆ†çš„ç­¾åï¼Œä½œç”¨æ˜¯é˜²æ­¢ JWTï¼ˆä¸»è¦æ˜¯ payloadï¼‰ è¢«ç¯¡æ”¹ã€‚\nè¿™ä¸ªç­¾åçš„ç”Ÿæˆéœ€è¦ç”¨åˆ°ï¼š\nHeader + Payloadã€‚ å­˜æ”¾åœ¨æœåŠ¡ç«¯çš„å¯†é’¥(ä¸€å®šä¸è¦æ³„éœ²å‡ºå»)ã€‚ ç­¾åç®—æ³•ã€‚ ç­¾åçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š\nHMACSHA256( base64UrlEncode(header) + \u0026#34;.\u0026#34; + base64UrlEncode(payload), secret) ç®—å‡ºç­¾åä»¥åï¼ŒæŠŠ Headerã€Payloadã€Signature ä¸‰ä¸ªéƒ¨åˆ†æ‹¼æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªéƒ¨åˆ†ä¹‹é—´ç”¨\u0026quot;ç‚¹\u0026quot;ï¼ˆ.ï¼‰åˆ†éš”ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ JWT ã€‚\nå¦‚ä½•åŸºäº JWT è¿›è¡Œèº«ä»½éªŒè¯ï¼Ÿ # åœ¨åŸºäº JWT è¿›è¡Œèº«ä»½éªŒè¯çš„çš„åº”ç”¨ç¨‹åºä¸­ï¼ŒæœåŠ¡å™¨é€šè¿‡ Payloadã€Header å’Œ Secret(å¯†é’¥)åˆ›å»º JWT å¹¶å°† JWT å‘é€ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ¥æ”¶åˆ° JWT ä¹‹åï¼Œä¼šå°†å…¶ä¿å­˜åœ¨ Cookie æˆ–è€… localStorage é‡Œé¢ï¼Œä»¥åå®¢æˆ·ç«¯å‘å‡ºçš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šæºå¸¦è¿™ä¸ªä»¤ç‰Œã€‚\nç®€åŒ–åçš„æ­¥éª¤å¦‚ä¸‹ï¼š\nç”¨æˆ·å‘æœåŠ¡å™¨å‘é€ç”¨æˆ·åã€å¯†ç ä»¥åŠéªŒè¯ç ç”¨äºç™»é™†ç³»ç»Ÿã€‚\nå¦‚æœç”¨æˆ·ç”¨æˆ·åã€å¯†ç ä»¥åŠéªŒè¯ç æ ¡éªŒæ­£ç¡®çš„è¯ï¼ŒæœåŠ¡ç«¯ä¼šè¿”å›å·²ç»ç­¾åçš„ Tokenï¼Œä¹Ÿå°±æ˜¯ JWTã€‚\næ³¨æ„ï¼Œå¾ˆé‡è¦ï¼Œâ˜…â˜… JWTæ˜¯æœåŠ¡å™¨ç”Ÿæˆçš„ï¼\nç”¨æˆ·ä»¥åæ¯æ¬¡å‘åç«¯å‘è¯·æ±‚éƒ½åœ¨ Header ä¸­å¸¦ä¸Šè¿™ä¸ª JWT ã€‚\næœåŠ¡ç«¯æ£€æŸ¥ JWT å¹¶ä»ä¸­è·å–ç”¨æˆ·ç›¸å…³ä¿¡æ¯ã€‚\nä¸¤ç‚¹å»ºè®®ï¼š\nå»ºè®®å°† JWT å­˜æ”¾åœ¨ localStorage ä¸­ï¼Œæ”¾åœ¨ Cookie ä¸­ä¼šæœ‰ CSRF é£é™©ã€‚ è¯·æ±‚æœåŠ¡ç«¯å¹¶æºå¸¦ JWT çš„å¸¸è§åšæ³•æ˜¯å°†å…¶æ”¾åœ¨ HTTP Header çš„ Authorization å­—æ®µä¸­ï¼ˆAuthorization: Bearer Tokenï¼‰ã€‚ spring-security-jwt-guide å°±æ˜¯ä¸€ä¸ªåŸºäº JWT æ¥åšèº«ä»½è®¤è¯çš„ç®€å•æ¡ˆä¾‹ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹ã€‚\nå¦‚ä½•é˜²æ­¢ JWT è¢«ç¯¡æ”¹ï¼Ÿ # æœ‰äº†ç­¾åä¹‹åï¼Œå³ä½¿ JWT è¢«æ³„éœ²æˆ–è€…æˆªè·ï¼Œé»‘å®¢ä¹Ÿæ²¡åŠæ³•åŒæ—¶ç¯¡æ”¹ Signature ã€Header ã€Payloadã€‚\nè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæœåŠ¡ç«¯æ‹¿åˆ° JWT ä¹‹åï¼Œä¼šè§£æå‡ºå…¶ä¸­åŒ…å«çš„ Headerã€Payload ä»¥åŠ Signature ã€‚æœåŠ¡ç«¯ä¼šæ ¹æ® Headerã€Payloadã€å¯†é’¥å†æ¬¡ç”Ÿæˆä¸€ä¸ª Signatureã€‚æ‹¿æ–°ç”Ÿæˆçš„ Signature å’Œ JWT ä¸­çš„ Signature ä½œå¯¹æ¯”ï¼Œå¦‚æœä¸€æ ·å°±è¯´æ˜ Header å’Œ Payload æ²¡æœ‰è¢«ä¿®æ”¹ã€‚\nä¸è¿‡ï¼Œå¦‚æœæœåŠ¡ç«¯çš„ç§˜é’¥ä¹Ÿè¢«æ³„éœ²çš„è¯ï¼Œé»‘å®¢å°±å¯ä»¥åŒæ—¶ç¯¡æ”¹ Signature ã€Header ã€Payload äº†ã€‚é»‘å®¢ç›´æ¥ä¿®æ”¹äº† Header å’Œ Payload ä¹‹åï¼Œå†é‡æ–°ç”Ÿæˆä¸€ä¸ª Signature å°±å¯ä»¥äº†ã€‚\nå¯†é’¥ä¸€å®šä¿ç®¡å¥½ï¼Œä¸€å®šä¸è¦æ³„éœ²å‡ºå»ã€‚JWT å®‰å…¨çš„æ ¸å¿ƒåœ¨äºç­¾åï¼Œç­¾åå®‰å…¨çš„æ ¸å¿ƒåœ¨å¯†é’¥ã€‚\nå¦‚ä½•åŠ å¼º JWT çš„å®‰å…¨æ€§ï¼Ÿ # ä½¿ç”¨å®‰å…¨ç³»æ•°é«˜çš„åŠ å¯†ç®—æ³•ã€‚ ä½¿ç”¨æˆç†Ÿçš„å¼€æºåº“ï¼Œæ²¡å¿…è¦é€ è½®å­ã€‚ JWT å­˜æ”¾åœ¨ localStorage ä¸­è€Œä¸æ˜¯ Cookie ä¸­ï¼Œé¿å… CSRF é£é™©ã€‚ ä¸€å®šä¸è¦å°†éšç§ä¿¡æ¯å­˜æ”¾åœ¨ Payload å½“ä¸­ã€‚ å¯†é’¥ä¸€å®šä¿ç®¡å¥½ï¼Œä¸€å®šä¸è¦æ³„éœ²å‡ºå»ã€‚JWT å®‰å…¨çš„æ ¸å¿ƒåœ¨äºç­¾åï¼Œç­¾åå®‰å…¨çš„æ ¸å¿ƒåœ¨å¯†é’¥ã€‚ Payload è¦åŠ å…¥ exp ï¼ˆJWT çš„è¿‡æœŸæ—¶é—´ï¼‰ï¼Œæ°¸ä¹…æœ‰æ•ˆçš„ JWT ä¸åˆç†ã€‚å¹¶ä¸”ï¼ŒJWT çš„è¿‡æœŸæ—¶é—´ä¸æ˜“è¿‡é•¿ã€‚ \u0026hellip;\u0026hellip; "},{"id":64,"href":"/zh/docs/study/Review/java_guide/lycly_system-design/security/ly01ly_basis-of-authority-certification/","title":"è®¤è¯æˆæƒåŸºç¡€æ¦‚å¿µè¯¦è§£","section":"å®‰å…¨","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nè®¤è¯ (Authentication) å’Œæˆæƒ (Authorization)çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ # è¿™æ˜¯ä¸€ä¸ªç»å¤§å¤šæ•°äººéƒ½ä¼šæ··æ·†çš„é—®é¢˜ã€‚é¦–å…ˆå…ˆä»è¯»éŸ³ä¸Šæ¥è®¤è¯†è¿™ä¸¤ä¸ªåè¯ï¼Œå¾ˆå¤šäººéƒ½ä¼šæŠŠå®ƒä¿©çš„è¯»éŸ³ææ··ï¼Œæ‰€ä»¥æˆ‘å»ºè®®ä½ å…ˆå…ˆå»æŸ¥ä¸€æŸ¥è¿™ä¸¤ä¸ªå•è¯åˆ°åº•è¯¥æ€ä¹ˆè¯»ï¼Œä»–ä»¬çš„å…·ä½“å«ä¹‰æ˜¯ä»€ä¹ˆã€‚\nè¯´ç®€å•ç‚¹å°±æ˜¯ï¼š\nè®¤è¯ (Authentication)ï¼š ä½ æ˜¯è°ã€‚[É”ËËŒÎ¸entÉªËˆkeÉªÊƒn] èº«ä»½éªŒè¯ æˆæƒ (Authorization)ï¼š ä½ æœ‰æƒé™å¹²ä»€ä¹ˆã€‚[ËŒÉ”ËÎ¸É™raÉªËˆzeÉªÊƒn] æˆæƒ ç¨å¾®æ­£å¼ç‚¹ï¼ˆå•°å—¦ç‚¹ï¼‰çš„è¯´æ³•å°±æ˜¯ ï¼š\nAuthenticationï¼ˆè®¤è¯ï¼‰ æ˜¯éªŒè¯æ‚¨çš„èº«ä»½çš„å‡­æ®ï¼ˆä¾‹å¦‚ç”¨æˆ·å/ç”¨æˆ· ID å’Œå¯†ç ï¼‰ï¼Œé€šè¿‡è¿™ä¸ªå‡­æ®ï¼Œç³»ç»Ÿå¾—ä»¥çŸ¥é“ä½ å°±æ˜¯ä½ ï¼Œä¹Ÿå°±æ˜¯è¯´ç³»ç»Ÿå­˜åœ¨ä½ è¿™ä¸ªç”¨æˆ·ã€‚æ‰€ä»¥ï¼ŒAuthentication è¢«ç§°ä¸ºèº«ä»½/ç”¨æˆ·éªŒè¯ã€‚ Authorizationï¼ˆæˆæƒï¼‰ å‘ç”Ÿåœ¨ Authenticationï¼ˆè®¤è¯ï¼‰ ä¹‹åã€‚æˆæƒå˜›ï¼Œå…‰çœ‹æ„æ€å¤§å®¶åº”è¯¥å°±æ˜ç™½ï¼Œå®ƒä¸»è¦æŒç®¡æˆ‘ä»¬è®¿é—®ç³»ç»Ÿçš„æƒé™ã€‚æ¯”å¦‚æœ‰äº›ç‰¹å®šèµ„æºåªèƒ½å…·æœ‰ç‰¹å®šæƒé™çš„äººæ‰èƒ½è®¿é—®æ¯”å¦‚ adminï¼Œæœ‰äº›å¯¹ç³»ç»Ÿèµ„æºæ“ä½œæ¯”å¦‚åˆ é™¤ã€æ·»åŠ ã€æ›´æ–°åªèƒ½ç‰¹å®šäººæ‰å…·æœ‰ã€‚ è®¤è¯ ï¼š\næˆæƒï¼š\nè¿™ä¸¤ä¸ªä¸€èˆ¬åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­è¢«ç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†ä¿æŠ¤æˆ‘ä»¬ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚\nRBAC æ¨¡å‹äº†è§£å—ï¼Ÿ # ç³»ç»Ÿæƒé™æ§åˆ¶æœ€å¸¸é‡‡ç”¨çš„è®¿é—®æ§åˆ¶æ¨¡å‹å°±æ˜¯ RBAC æ¨¡å‹ ã€‚\nä»€ä¹ˆæ˜¯ RBAC å‘¢ï¼Ÿ\nRBAC å³åŸºäºè§’è‰²çš„æƒé™è®¿é—®æ§åˆ¶ï¼ˆRole-Based Access Controlï¼‰ã€‚è¿™æ˜¯ä¸€ç§é€šè¿‡è§’è‰²å…³è”æƒé™ï¼Œè§’è‰²åŒæ—¶åˆå…³è”ç”¨æˆ·çš„æˆæƒçš„æ–¹å¼ã€‚\nç®€å•åœ°è¯´ï¼šä¸€ä¸ªç”¨æˆ·å¯ä»¥æ‹¥æœ‰è‹¥å¹²è§’è‰²ï¼Œæ¯ä¸€ä¸ªè§’è‰²åˆå¯ä»¥è¢«åˆ†é…è‹¥å¹²æƒé™ï¼Œè¿™æ ·å°±æ„é€ æˆâ€œç”¨æˆ·-è§’è‰²-æƒé™â€ çš„æˆæƒæ¨¡å‹ã€‚åœ¨è¿™ç§æ¨¡å‹ä¸­ï¼Œç”¨æˆ·ä¸è§’è‰²ã€è§’è‰²ä¸æƒé™ä¹‹é—´æ„æˆäº†å¤šå¯¹å¤šçš„å…³ç³»ï¼Œå¦‚ä¸‹å›¾\nåœ¨ RBAC ä¸­ï¼Œæƒé™ä¸è§’è‰²ç›¸å…³è”ï¼Œç”¨æˆ·é€šè¿‡æˆä¸ºé€‚å½“è§’è‰²çš„æˆå‘˜è€Œå¾—åˆ°è¿™äº›è§’è‰²çš„æƒé™ã€‚è¿™å°±æå¤§åœ°ç®€åŒ–äº†æƒé™çš„ç®¡ç†ã€‚\næœ¬ç³»ç»Ÿçš„æƒé™è®¾è®¡ç›¸å…³çš„è¡¨å¦‚ä¸‹ï¼ˆä¸€å…± 5 å¼ è¡¨ï¼Œ2 å¼ ç”¨æˆ·å»ºç«‹è¡¨ä¹‹é—´çš„è”ç³»ï¼‰ï¼š\né€šè¿‡è¿™ä¸ªæƒé™æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸åŒçš„è§’è‰²å¹¶ä¸ºä¸åŒçš„è§’è‰²åˆ†é…ä¸åŒçš„æƒé™èŒƒå›´ï¼ˆèœå•ï¼‰ã€‚\né€šå¸¸æ¥è¯´ï¼Œå¦‚æœç³»ç»Ÿå¯¹äºæƒé™æ§åˆ¶è¦æ±‚æ¯”è¾ƒä¸¥æ ¼çš„è¯ï¼Œä¸€èˆ¬éƒ½ä¼šé€‰æ‹©ä½¿ç”¨ RBAC æ¨¡å‹æ¥åšæƒé™æ§åˆ¶ã€‚\nä»€ä¹ˆæ˜¯ Cookie ? Cookie çš„ä½œç”¨æ˜¯ä»€ä¹ˆ? # lyï¼šå¦‚ä¸Šï¼Œå¯ä»¥çœ‹å‡º cookieçš„é™„å±æ˜¯åŸŸå\nCookie å’Œ Session éƒ½æ˜¯ç”¨æ¥è·Ÿè¸ªæµè§ˆå™¨ç”¨æˆ·èº«ä»½çš„ä¼šè¯æ–¹å¼ï¼Œä½†æ˜¯ä¸¤è€…çš„åº”ç”¨åœºæ™¯ä¸å¤ªä¸€æ ·ã€‚\nç»´åŸºç™¾ç§‘æ˜¯è¿™æ ·å®šä¹‰ Cookie çš„ï¼š\nCookies æ˜¯æŸäº›ç½‘ç«™ä¸ºäº†è¾¨åˆ«ç”¨æˆ·èº«ä»½è€Œå‚¨å­˜åœ¨ç”¨æˆ·æœ¬åœ°ç»ˆç«¯ä¸Šçš„æ•°æ®ï¼ˆé€šå¸¸ç»è¿‡åŠ å¯†ï¼‰ã€‚\nç®€å•æ¥è¯´ï¼š Cookie å­˜æ”¾åœ¨å®¢æˆ·ç«¯ï¼Œä¸€èˆ¬ç”¨æ¥ä¿å­˜ç”¨æˆ·ä¿¡æ¯ã€‚\nä¸‹é¢æ˜¯ Cookie çš„ä¸€äº›åº”ç”¨æ¡ˆä¾‹ï¼š\næˆ‘ä»¬åœ¨ Cookie ä¸­ä¿å­˜å·²ç»ç™»å½•è¿‡çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä¸‹æ¬¡è®¿é—®ç½‘ç«™çš„æ—¶å€™é¡µé¢å¯ä»¥è‡ªåŠ¨å¸®ä½ ç™»å½•çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ç»™å¡«äº†ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒCookie è¿˜èƒ½ä¿å­˜ç”¨æˆ·é¦–é€‰é¡¹ï¼Œä¸»é¢˜å’Œå…¶ä»–è®¾ç½®ä¿¡æ¯ã€‚\nä½¿ç”¨ Cookie ä¿å­˜ SessionId æˆ–è€… Token ï¼Œå‘åç«¯å‘é€è¯·æ±‚çš„æ—¶å€™å¸¦ä¸Š Cookieï¼Œè¿™æ ·åç«¯å°±èƒ½å–åˆ° Session æˆ–è€… Token äº†ã€‚è¿™æ ·å°±èƒ½è®°å½•ç”¨æˆ·å½“å‰çš„çŠ¶æ€äº†ï¼Œå› ä¸º HTTP åè®®æ˜¯æ— çŠ¶æ€çš„ã€‚\næ— çŠ¶æ€çš„æ„æ€å°±æ˜¯é€šè¿‡httpå‘çš„å¤šæ¬¡è¯·æ±‚ï¼Œæ²¡æœ‰ç‰¹æ®Šå¤„ç†çš„è¯æˆ‘ä»¬æ˜¯ä¸çŸ¥é“æ˜¯å¦æ˜¯åŒä¸€ä¸ªç”¨æˆ·å‘çš„ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ç”¨æˆ·çŠ¶æ€ã€‚\nCookie è¿˜å¯ä»¥ç”¨æ¥è®°å½•å’Œåˆ†æç”¨æˆ·è¡Œä¸ºã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ä½ åœ¨ç½‘ä¸Šè´­ç‰©çš„æ—¶å€™ï¼Œå› ä¸º HTTP åè®®æ˜¯æ²¡æœ‰çŠ¶æ€çš„ï¼Œå¦‚æœæœåŠ¡å™¨æƒ³è¦è·å–ä½ åœ¨æŸä¸ªé¡µé¢çš„åœç•™çŠ¶æ€æˆ–è€…çœ‹äº†å“ªäº›å•†å“ï¼Œä¸€ç§å¸¸ç”¨çš„å®ç°æ–¹å¼å°±æ˜¯å°†è¿™äº›ä¿¡æ¯å­˜æ”¾åœ¨ Cookie\n\u0026hellip;\u0026hellip;\nå¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Cookie å‘¢ï¼Ÿ # æˆ‘è¿™é‡Œä»¥ Spring Boot é¡¹ç›®ä¸ºä¾‹ã€‚\n1)è®¾ç½® Cookie è¿”å›ç»™å®¢æˆ·ç«¯\n@GetMapping(\u0026#34;/change-username\u0026#34;) public String setCookie(HttpServletResponse response) { // åˆ›å»ºä¸€ä¸ª cookie Cookie cookie = new Cookie(\u0026#34;username\u0026#34;, \u0026#34;Jovan\u0026#34;); //è®¾ç½® cookieè¿‡æœŸæ—¶é—´ cookie.setMaxAge(7 * 24 * 60 * 60); // expires in 7 days //æ·»åŠ åˆ° response ä¸­ response.addCookie(cookie); return \u0026#34;Username is changed!\u0026#34;; } 2) ä½¿ç”¨ Spring æ¡†æ¶æä¾›çš„ @CookieValue æ³¨è§£è·å–ç‰¹å®šçš„ cookie çš„å€¼\n@GetMapping(\u0026#34;/\u0026#34;) public String readCookie(@CookieValue(value = \u0026#34;username\u0026#34;, defaultValue = \u0026#34;Atta\u0026#34;) String username) { return \u0026#34;Hey! My username is \u0026#34; + username; } 3) è¯»å–æ‰€æœ‰çš„ Cookie å€¼\n@GetMapping(\u0026#34;/all-cookies\u0026#34;) public String readAllCookies(HttpServletRequest request) { Cookie[] cookies = request.getCookies(); if (cookies != null) { return Arrays.stream(cookies) .map(c -\u0026gt; c.getName() + \u0026#34;=\u0026#34; + c.getValue()).collect(Collectors.joining(\u0026#34;, \u0026#34;)); } return \u0026#34;No cookies\u0026#34;; } æ›´å¤šå…³äºå¦‚ä½•åœ¨ Spring Boot ä¸­ä½¿ç”¨ Cookie çš„å†…å®¹å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼šHow to use cookies in Spring Boot ã€‚\nCookie å’Œ Session æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ # Session çš„ä¸»è¦ä½œç”¨å°±æ˜¯é€šè¿‡æœåŠ¡ç«¯è®°å½•ç”¨æˆ·çš„çŠ¶æ€ã€‚ å…¸å‹çš„åœºæ™¯æ˜¯è´­ç‰©è½¦ï¼Œå½“ä½ è¦æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦çš„æ—¶å€™ï¼Œâ˜…â˜…é‡è¦ï¼šç³»ç»Ÿä¸çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·æ“ä½œçš„ï¼Œå› ä¸º HTTP åè®®æ˜¯æ— çŠ¶æ€çš„ã€‚æœåŠ¡ç«¯ç»™ç‰¹å®šçš„ç”¨æˆ·åˆ›å»ºç‰¹å®šçš„ Session ä¹‹åå°±å¯ä»¥æ ‡è¯†è¿™ä¸ªç”¨æˆ·å¹¶ä¸”è·Ÿè¸ªè¿™ä¸ªç”¨æˆ·äº†ã€‚\nCookie æ•°æ®ä¿å­˜åœ¨å®¢æˆ·ç«¯(æµè§ˆå™¨ç«¯)ï¼ŒSession æ•°æ®ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ã€‚ç›¸å¯¹æ¥è¯´ Session å®‰å…¨æ€§æ›´é«˜ã€‚å¦‚æœä½¿ç”¨ Cookie çš„ä¸€äº›æ•æ„Ÿä¿¡æ¯ä¸è¦å†™å…¥ Cookie ä¸­ï¼Œæœ€å¥½èƒ½å°† Cookie ä¿¡æ¯åŠ å¯†ç„¶åä½¿ç”¨åˆ°çš„æ—¶å€™å†å»æœåŠ¡å™¨ç«¯è§£å¯†ã€‚\né‚£ä¹ˆï¼Œå¦‚ä½•ä½¿ç”¨ Session è¿›è¡Œèº«ä»½éªŒè¯ï¼Ÿ\nå¦‚ä½•ä½¿ç”¨ Session-Cookie æ–¹æ¡ˆè¿›è¡Œèº«ä»½éªŒè¯ï¼Ÿ # å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½æ˜¯é€šè¿‡ SessionID æ¥å®ç°ç‰¹å®šçš„ç”¨æˆ·ï¼ŒSessionID ä¸€èˆ¬ä¼šé€‰æ‹©å­˜æ”¾åœ¨ Redis ä¸­ã€‚ä¸¾ä¸ªä¾‹å­ï¼š\nç”¨æˆ·æˆåŠŸç™»é™†ç³»ç»Ÿï¼Œç„¶åè¿”å›ç»™å®¢æˆ·ç«¯å…·æœ‰ SessionID çš„ Cookie ã€‚ å½“ç”¨æˆ·å‘åç«¯å‘èµ·è¯·æ±‚çš„æ—¶å€™ä¼šæŠŠ SessionID å¸¦ä¸Šï¼Œè¿™æ ·åç«¯å°±çŸ¥é“ä½ çš„èº«ä»½çŠ¶æ€äº†ã€‚ å…³äºè¿™ç§è®¤è¯æ–¹å¼æ›´è¯¦ç»†çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š\nç”¨æˆ·å‘æœåŠ¡å™¨å‘é€ç”¨æˆ·åã€å¯†ç ã€éªŒè¯ç ç”¨äºç™»é™†ç³»ç»Ÿã€‚ æœåŠ¡å™¨éªŒè¯é€šè¿‡åï¼ŒæœåŠ¡å™¨ä¸ºç”¨æˆ·åˆ›å»ºä¸€ä¸ª Sessionï¼Œå¹¶å°† Session ä¿¡æ¯å­˜å‚¨èµ·æ¥ï¼ˆä¸€èˆ¬æ˜¯Redisï¼‰ã€‚ æœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›ä¸€ä¸ª SessionIDï¼Œå†™å…¥ç”¨æˆ·çš„ Cookieã€‚ å½“ç”¨æˆ·ä¿æŒç™»å½•çŠ¶æ€æ—¶ï¼ŒCookie å°†ä¸æ¯ä¸ªåç»­è¯·æ±‚ä¸€èµ·è¢«å‘é€å‡ºå»ã€‚ æœåŠ¡å™¨å¯ä»¥å°†å­˜å‚¨åœ¨ Cookie ä¸Šçš„ SessionID ä¸å­˜å‚¨åœ¨å†…å­˜ä¸­æˆ–è€…æ•°æ®åº“ä¸­çš„ Session ä¿¡æ¯è¿›è¡Œæ¯”è¾ƒï¼Œä»¥éªŒè¯ç”¨æˆ·çš„èº«ä»½ï¼Œè¿”å›ç»™ç”¨æˆ·å®¢æˆ·ç«¯å“åº”ä¿¡æ¯çš„æ—¶å€™ä¼šé™„å¸¦ç”¨æˆ·å½“å‰çš„çŠ¶æ€ã€‚ ä½¿ç”¨ Session çš„æ—¶å€™éœ€è¦æ³¨æ„ä¸‹é¢å‡ ä¸ªç‚¹ï¼š\nä¾èµ– Session çš„å…³é”®ä¸šåŠ¡ä¸€å®šè¦ç¡®ä¿å®¢æˆ·ç«¯å¼€å¯äº† Cookieã€‚ æ³¨æ„ Session çš„è¿‡æœŸæ—¶é—´ã€‚ å¦å¤–ï¼ŒSpring Session æä¾›äº†ä¸€ç§è·¨å¤šä¸ªåº”ç”¨ç¨‹åºæˆ–å®ä¾‹ç®¡ç†ç”¨æˆ·ä¼šè¯ä¿¡æ¯çš„æœºåˆ¶ã€‚å¦‚æœæƒ³è¯¦ç»†äº†è§£å¯ä»¥æŸ¥çœ‹ä¸‹é¢å‡ ç¯‡å¾ˆä¸é”™çš„æ–‡ç« ï¼š\nGetting Started with Spring Session Guide to Spring Session Sticky Sessions with Spring Session \u0026amp; Redis å¤šæœåŠ¡å™¨èŠ‚ç‚¹ä¸‹ Session-Cookie æ–¹æ¡ˆå¦‚ä½•åšï¼Ÿ # Session-Cookie æ–¹æ¡ˆåœ¨å•ä½“ç¯å¢ƒæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„èº«ä»½è®¤è¯æ–¹æ¡ˆã€‚ä½†æ˜¯ï¼Œå½“æœåŠ¡å™¨æ°´å¹³æ‹“å±•æˆå¤šèŠ‚ç‚¹æ—¶ï¼ŒSession-Cookie æ–¹æ¡ˆå°±è¦é¢ä¸´æŒ‘æˆ˜äº†ã€‚\nä¸¾ä¸ªä¾‹å­ï¼šå‡å¦‚æˆ‘ä»¬éƒ¨ç½²äº†ä¸¤ä»½ç›¸åŒçš„æœåŠ¡ Aï¼ŒBï¼Œç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»é™†çš„æ—¶å€™ ï¼ŒNginx é€šè¿‡è´Ÿè½½å‡è¡¡æœºåˆ¶å°†ç”¨æˆ·è¯·æ±‚è½¬å‘åˆ° A æœåŠ¡å™¨ï¼Œæ­¤æ—¶ç”¨æˆ·çš„ Session ä¿¡æ¯ä¿å­˜åœ¨ A æœåŠ¡å™¨ã€‚ç»“æœï¼Œç”¨æˆ·ç¬¬äºŒæ¬¡è®¿é—®çš„æ—¶å€™ Nginx å°†è¯·æ±‚è·¯ç”±åˆ° B æœåŠ¡å™¨ï¼Œç”±äº B æœåŠ¡å™¨æ²¡æœ‰ä¿å­˜ ç”¨æˆ·çš„ Session ä¿¡æ¯ï¼Œå¯¼è‡´ç”¨æˆ·éœ€è¦é‡æ–°è¿›è¡Œç™»é™†ã€‚\næˆ‘ä»¬åº”è¯¥å¦‚ä½•é¿å…ä¸Šé¢è¿™ç§æƒ…å†µçš„å‡ºç°å‘¢ï¼Ÿ\næœ‰å‡ ä¸ªæ–¹æ¡ˆå¯ä¾›å¤§å®¶å‚è€ƒï¼š\næŸä¸ªç”¨æˆ·çš„æ‰€æœ‰è¯·æ±‚éƒ½é€šè¿‡ç‰¹æ€§çš„å“ˆå¸Œç­–ç•¥åˆ†é…ç»™åŒä¸€ä¸ªæœåŠ¡å™¨å¤„ç†ã€‚è¿™æ ·çš„è¯ï¼Œæ¯ä¸ªæœåŠ¡å™¨éƒ½ä¿å­˜äº†ä¸€éƒ¨åˆ†ç”¨æˆ·çš„ Session ä¿¡æ¯ã€‚æœåŠ¡å™¨å®•æœºï¼Œå…¶ä¿å­˜çš„æ‰€æœ‰ Session ä¿¡æ¯å°±å®Œå…¨ä¸¢å¤±äº†ã€‚ æ¯ä¸€ä¸ªæœåŠ¡å™¨ä¿å­˜çš„ Session ä¿¡æ¯éƒ½æ˜¯äº’ç›¸åŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸€ä¸ªæœåŠ¡å™¨éƒ½ä¿å­˜äº†å…¨é‡çš„ Session ä¿¡æ¯ã€‚æ¯å½“ä¸€ä¸ªæœåŠ¡å™¨çš„ Session ä¿¡æ¯å‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬å°±å°†å…¶åŒæ­¥åˆ°å…¶ä»–æœåŠ¡å™¨ã€‚è¿™ç§æ–¹æ¡ˆæˆæœ¬å¤ªå¤§ï¼Œå¹¶ä¸”ï¼ŒèŠ‚ç‚¹è¶Šå¤šæ—¶ï¼ŒåŒæ­¥æˆæœ¬ä¹Ÿè¶Šé«˜ã€‚ å•ç‹¬ä½¿ç”¨ä¸€ä¸ªæ‰€æœ‰æœåŠ¡å™¨éƒ½èƒ½è®¿é—®åˆ°çš„æ•°æ®èŠ‚ç‚¹ï¼ˆæ¯”å¦‚ç¼“å­˜ï¼‰æ¥å­˜æ”¾ Session ä¿¡æ¯ã€‚ä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œæ•°æ®èŠ‚ç‚¹å°½é‡è¦é¿å…æ˜¯å•ç‚¹ã€‚ å¦‚æœæ²¡æœ‰ Cookie çš„è¯ Session è¿˜èƒ½ç”¨å—ï¼Ÿ # è¿™æ˜¯ä¸€é“ç»å…¸çš„é¢è¯•é¢˜ï¼\nä¸€èˆ¬æ˜¯é€šè¿‡ Cookie æ¥ä¿å­˜ SessionID ï¼Œå‡å¦‚ä½ ä½¿ç”¨äº† Cookie ä¿å­˜ SessionID çš„æ–¹æ¡ˆçš„è¯ï¼Œ å¦‚æœå®¢æˆ·ç«¯ç¦ç”¨äº† Cookieï¼Œé‚£ä¹ˆ Session å°±æ— æ³•æ­£å¸¸å·¥ä½œã€‚\nä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯æ²¡æœ‰ Cookie ä¹‹åå°±ä¸èƒ½ç”¨ Session äº†ï¼Œæ¯”å¦‚ä½ å¯ä»¥å°† SessionID æ”¾åœ¨è¯·æ±‚çš„ url é‡Œé¢https://javaguide.cn/?Session_id=xxx ã€‚è¿™ç§æ–¹æ¡ˆçš„è¯å¯è¡Œï¼Œä½†æ˜¯å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒæ„Ÿé™ä½ã€‚å½“ç„¶ï¼Œä¸ºäº†ä½ ä¹Ÿå¯ä»¥å¯¹ SessionID è¿›è¡Œä¸€æ¬¡åŠ å¯†ä¹‹åå†ä¼ å…¥åç«¯ã€‚\nä¸ªäººè§‰å¾—localstorageä¹Ÿæ˜¯å¯ä»¥çš„\nä¸ºä»€ä¹ˆ Cookie æ— æ³•é˜²æ­¢ CSRF æ”»å‡»ï¼Œè€Œ Token å¯ä»¥ï¼Ÿ # CSRF(Cross Site Request Forgery) ä¸€èˆ¬è¢«ç¿»è¯‘ä¸º è·¨ç«™è¯·æ±‚ä¼ªé€  ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯ è·¨ç«™è¯·æ±‚ä¼ªé€  å‘¢ï¼Ÿè¯´ç®€å•ç”¨ä½ çš„èº«ä»½å»å‘é€ä¸€äº›å¯¹ä½ ä¸å‹å¥½çš„è¯·æ±‚ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š\nå°å£®ç™»å½•äº†æŸç½‘ä¸Šé“¶è¡Œï¼Œä»–æ¥åˆ°äº†ç½‘ä¸Šé“¶è¡Œçš„å¸–å­åŒºï¼Œçœ‹åˆ°ä¸€ä¸ªå¸–å­ä¸‹é¢æœ‰ä¸€ä¸ªé“¾æ¥å†™ç€â€œç§‘å­¦ç†è´¢ï¼Œå¹´ç›ˆåˆ©ç‡è¿‡ä¸‡â€ï¼Œå°å£®å¥½å¥‡çš„ç‚¹å¼€äº†è¿™ä¸ªé“¾æ¥ï¼Œç»“æœå‘ç°è‡ªå·±çš„è´¦æˆ·å°‘äº† 10000 å…ƒã€‚è¿™æ˜¯è¿™ä¹ˆå›äº‹å‘¢ï¼ŸåŸæ¥é»‘å®¢åœ¨é“¾æ¥ä¸­è—äº†ä¸€ä¸ªè¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚ç›´æ¥åˆ©ç”¨å°å£®çš„èº«ä»½ç»™é“¶è¡Œå‘é€äº†ä¸€ä¸ªè½¬è´¦è¯·æ±‚,ä¹Ÿå°±æ˜¯é€šè¿‡ä½ çš„ Cookie å‘é“¶è¡Œå‘å‡ºè¯·æ±‚ã€‚\n\u0026lt;a src=http://www.mybank.com/Transfer?bankId=11\u0026amp;money=10000\u0026gt;ç§‘å­¦ç†è´¢ï¼Œå¹´ç›ˆåˆ©ç‡è¿‡ä¸‡\u0026lt;/\u0026gt; ä¸Šé¢ä¹Ÿæåˆ°è¿‡ï¼Œè¿›è¡Œ Session è®¤è¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ Cookie æ¥å­˜å‚¨ SessionId,å½“æˆ‘ä»¬ç™»é™†ååç«¯ç”Ÿæˆä¸€ä¸ª SessionId æ”¾åœ¨ Cookie ä¸­è¿”å›ç»™å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯é€šè¿‡ Redis æˆ–è€…å…¶ä»–å­˜å‚¨å·¥å…·è®°å½•ä¿å­˜ç€è¿™ä¸ª SessionIdï¼Œå®¢æˆ·ç«¯ç™»å½•ä»¥åæ¯æ¬¡è¯·æ±‚éƒ½ä¼šå¸¦ä¸Šè¿™ä¸ª SessionIdï¼ŒæœåŠ¡ç«¯é€šè¿‡è¿™ä¸ª SessionId æ¥æ ‡ç¤ºä½ è¿™ä¸ªäººã€‚å¦‚æœåˆ«äººé€šè¿‡ Cookie æ‹¿åˆ°äº† SessionId åå°±å¯ä»¥ä»£æ›¿ä½ çš„èº«ä»½è®¿é—®ç³»ç»Ÿäº†ã€‚\nSession è®¤è¯ä¸­ Cookie ä¸­çš„ SessionId æ˜¯ç”±æµè§ˆå™¨å‘é€åˆ°æœåŠ¡ç«¯çš„ï¼Œå€ŸåŠ©è¿™ä¸ªç‰¹æ€§ï¼Œæ”»å‡»è€…å°±å¯ä»¥é€šè¿‡è®©ç”¨æˆ·è¯¯ç‚¹æ”»å‡»é“¾æ¥ï¼Œè¾¾åˆ°æ”»å‡»æ•ˆæœã€‚\nä½†æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ Token çš„è¯å°±ä¸ä¼šå­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œåœ¨æˆ‘ä»¬ç™»å½•æˆåŠŸè·å¾— Token ä¹‹åï¼Œä¸€èˆ¬ä¼šé€‰æ‹©å­˜æ”¾åœ¨ localStorage ï¼ˆæµè§ˆå™¨æœ¬åœ°å­˜å‚¨ï¼‰ä¸­ã€‚ç„¶åæˆ‘ä»¬åœ¨å‰ç«¯é€šè¿‡æŸäº›æ–¹å¼ä¼šç»™æ¯ä¸ªå‘åˆ°åç«¯çš„è¯·æ±‚åŠ ä¸Šè¿™ä¸ª Token,è¿™æ ·å°±ä¸ä¼šå‡ºç° CSRF æ¼æ´çš„é—®é¢˜ã€‚å› ä¸ºï¼Œå³ä½¿æœ‰ä¸ªä½ ç‚¹å‡»äº†éæ³•é“¾æ¥å‘é€äº†è¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼Œè¿™ä¸ªéæ³•è¯·æ±‚æ˜¯ä¸ä¼šæºå¸¦ Token çš„ï¼Œæ‰€ä»¥è¿™ä¸ªè¯·æ±‚å°†æ˜¯éæ³•çš„ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸è®ºæ˜¯ Cookie è¿˜æ˜¯ Token éƒ½æ— æ³•é¿å… è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆCross Site Scriptingï¼‰XSS ã€‚\nè·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆCross Site Scriptingï¼‰ç¼©å†™ä¸º CSS ä½†è¿™ä¼šä¸å±‚å æ ·å¼è¡¨ï¼ˆCascading Style Sheetsï¼ŒCSSï¼‰çš„ç¼©å†™æ··æ·†ã€‚å› æ­¤ï¼Œæœ‰äººå°†è·¨ç«™è„šæœ¬æ”»å‡»ç¼©å†™ä¸º XSSã€‚\nXSS ä¸­æ”»å‡»è€…ä¼šç”¨å„ç§æ–¹å¼å°†æ¶æ„ä»£ç æ³¨å…¥åˆ°å…¶ä»–ç”¨æˆ·çš„é¡µé¢ä¸­ã€‚å°±å¯ä»¥é€šè¿‡è„šæœ¬ç›—ç”¨ä¿¡æ¯æ¯”å¦‚ Cookie ã€‚\næ¨èé˜…è¯»ï¼šå¦‚ä½•é˜²æ­¢ CSRF æ”»å‡»ï¼Ÿâ€”ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ\nä»€ä¹ˆæ˜¯ JWT?JWT ç”±å“ªäº›éƒ¨åˆ†ç»„æˆï¼Ÿ # JWT åŸºç¡€æ¦‚å¿µè¯¦è§£\nå¦‚ä½•åŸºäº JWT è¿›è¡Œèº«ä»½éªŒè¯ï¼Ÿ å¦‚ä½•é˜²æ­¢ JWT è¢«ç¯¡æ”¹ï¼Ÿ # JWT åŸºç¡€æ¦‚å¿µè¯¦è§£\nä»€ä¹ˆæ˜¯ SSO? # SSO(Single Sign On)å³å•ç‚¹ç™»å½•è¯´çš„æ˜¯ç”¨æˆ·ç™»é™†å¤šä¸ªå­ç³»ç»Ÿçš„å…¶ä¸­ä¸€ä¸ªå°±æœ‰æƒè®¿é—®ä¸å…¶ç›¸å…³çš„å…¶ä»–ç³»ç»Ÿã€‚ä¸¾ä¸ªä¾‹å­æˆ‘ä»¬åœ¨ç™»é™†äº†äº¬ä¸œé‡‘èä¹‹åï¼Œæˆ‘ä»¬åŒæ—¶ä¹ŸæˆåŠŸç™»é™†äº¬ä¸œçš„äº¬ä¸œè¶…å¸‚ã€äº¬ä¸œå›½é™…ã€äº¬ä¸œç”Ÿé²œç­‰å­ç³»ç»Ÿã€‚\nSSO æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ # ç”¨æˆ·è§’åº¦ :ç”¨æˆ·èƒ½å¤Ÿåšåˆ°ä¸€æ¬¡ç™»å½•å¤šæ¬¡ä½¿ç”¨ï¼Œæ— éœ€è®°å½•å¤šå¥—ç”¨æˆ·åå’Œå¯†ç ï¼Œçœå¿ƒã€‚ ç³»ç»Ÿç®¡ç†å‘˜è§’åº¦ : ç®¡ç†å‘˜åªéœ€ç»´æŠ¤å¥½ä¸€ä¸ªç»Ÿä¸€çš„è´¦å·ä¸­å¿ƒå°±å¯ä»¥äº†ï¼Œæ–¹ä¾¿ã€‚ æ–°ç³»ç»Ÿå¼€å‘è§’åº¦: æ–°ç³»ç»Ÿå¼€å‘æ—¶åªéœ€ç›´æ¥å¯¹æ¥ç»Ÿä¸€çš„è´¦å·ä¸­å¿ƒå³å¯ï¼Œç®€åŒ–å¼€å‘æµç¨‹ï¼Œçœæ—¶ã€‚ å¦‚ä½•è®¾è®¡å®ç°ä¸€ä¸ª SSO ç³»ç»Ÿ? # SSO å•ç‚¹ç™»å½•è¯¦è§£\nä»€ä¹ˆæ˜¯ OAuth 2.0ï¼Ÿ # OAuth æ˜¯ä¸€ä¸ªè¡Œä¸šçš„æ ‡å‡†æˆæƒåè®®ï¼Œä¸»è¦ç”¨æ¥æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨è·å–æœ‰é™çš„æƒé™ã€‚è€Œ OAuth 2.0 æ˜¯å¯¹ OAuth 1.0 çš„å®Œå…¨é‡æ–°è®¾è®¡ï¼ŒOAuth 2.0 æ›´å¿«ï¼Œæ›´å®¹æ˜“å®ç°ï¼ŒOAuth 1.0 å·²ç»è¢«åºŸå¼ƒã€‚è¯¦æƒ…è¯·è§ï¼šrfc6749ã€‚\nå®é™…ä¸Šå®ƒå°±æ˜¯ä¸€ç§æˆæƒæœºåˆ¶ï¼Œå®ƒçš„æœ€ç»ˆç›®çš„æ˜¯ä¸ºç¬¬ä¸‰æ–¹åº”ç”¨é¢å‘ä¸€ä¸ªæœ‰æ—¶æ•ˆæ€§çš„ä»¤ç‰Œ Tokenï¼Œä½¿å¾—ç¬¬ä¸‰æ–¹åº”ç”¨èƒ½å¤Ÿé€šè¿‡è¯¥ä»¤ç‰Œè·å–ç›¸å…³çš„èµ„æºã€‚\nOAuth 2.0 æ¯”è¾ƒå¸¸ç”¨çš„åœºæ™¯å°±æ˜¯ç¬¬ä¸‰æ–¹ç™»å½•ï¼Œå½“ä½ çš„ç½‘ç«™æ¥å…¥äº†ç¬¬ä¸‰æ–¹ç™»å½•çš„æ—¶å€™ä¸€èˆ¬å°±æ˜¯ä½¿ç”¨çš„ OAuth 2.0 åè®®ã€‚\nå¦å¤–ï¼Œç°åœ¨ OAuth 2.0 ä¹Ÿå¸¸è§äºæ”¯ä»˜åœºæ™¯ï¼ˆå¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®æ”¯ä»˜ï¼‰å’Œå¼€å‘å¹³å°ï¼ˆå¾®ä¿¡å¼€æ”¾å¹³å°ã€é˜¿é‡Œå¼€æ”¾å¹³å°ç­‰ç­‰ï¼‰ã€‚\nä¸‹å›¾æ˜¯ Slack OAuth 2.0 ç¬¬ä¸‰æ–¹ç™»å½•çš„ç¤ºæ„å›¾ï¼š\næ¨èé˜…è¯»ï¼š\nOAuth 2.0 çš„ä¸€ä¸ªç®€å•è§£é‡Š 10 åˆ†é’Ÿç†è§£ä»€ä¹ˆæ˜¯ OAuth 2.0 åè®® OAuth 2.0 çš„å››ç§æ–¹å¼ GitHub OAuth ç¬¬ä¸‰æ–¹ç™»å½•ç¤ºä¾‹æ•™ç¨‹ å‚è€ƒ # ä¸è¦ç”¨ JWT æ›¿ä»£ session ç®¡ç†ï¼ˆä¸Šï¼‰ï¼šå…¨é¢äº†è§£ Token,JWT,OAuth,SAML,SSOï¼šhttps://zhuanlan.zhihu.com/p/38942172 Introduction to JSON Web Tokensï¼šhttps://jwt.io/introduction JSON Web Token Claimsï¼šhttps://auth0.com/docs/secure/tokens/json-web-tokens/json-web-token-claims "},{"id":65,"href":"/zh/docs/study/Review/java_guide/lycly_system-design/basis/unit-test/","title":"å•å…ƒæµ‹è¯•","section":"åŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nä½•è°“å•å…ƒæµ‹è¯•ï¼Ÿ # ç»´åŸºç™¾ç§‘æ˜¯è¿™æ ·ä»‹ç»å•å…ƒæµ‹è¯•çš„ï¼š\nåœ¨è®¡ç®—æœºç¼–ç¨‹ä¸­ï¼Œå•å…ƒæµ‹è¯•ï¼ˆUnit Testingï¼‰æ˜¯é’ˆå¯¹ç¨‹åºæ¨¡å—ï¼ˆè½¯ä»¶è®¾è®¡çš„æœ€å°å•ä½ï¼‰è¿›è¡Œçš„æ­£ç¡®æ€§æ£€éªŒæµ‹è¯•å·¥ä½œã€‚\nç¨‹åºå•å…ƒæ˜¯åº”ç”¨çš„ æœ€å°å¯æµ‹è¯•éƒ¨ä»¶ ã€‚åœ¨è¿‡ç¨‹åŒ–ç¼–ç¨‹ä¸­ï¼Œä¸€ä¸ªå•å…ƒå°±æ˜¯å•ä¸ªç¨‹åºã€å‡½æ•°ã€è¿‡ç¨‹ç­‰ï¼›å¯¹äºé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œæœ€å°å•å…ƒå°±æ˜¯æ–¹æ³•ï¼ŒåŒ…æ‹¬åŸºç±»ï¼ˆè¶…ç±»ï¼‰ã€æŠ½è±¡ç±»ã€æˆ–è€…æ´¾ç”Ÿç±»ï¼ˆå­ç±»ï¼‰ä¸­çš„æ–¹æ³•ã€‚\nç”±äºæ¯ä¸ªå•å…ƒæœ‰ç‹¬ç«‹çš„é€»è¾‘ï¼Œåœ¨åšå•å…ƒæµ‹è¯•æ—¶ï¼Œä¸ºäº†éš”ç¦»å¤–éƒ¨ä¾èµ–ï¼Œç¡®ä¿è¿™äº›ä¾èµ–ä¸å½±å“éªŒè¯é€»è¾‘ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šç”¨åˆ° Fakeã€Stub ä¸ Mock ã€‚\nå…³äº Fakeã€Mock ä¸ Stub è¿™å‡ ä¸ªæ¦‚å¿µçš„è§£è¯»ï¼Œå¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼šæµ‹è¯•ä¸­ Fakesã€Mocks ä»¥åŠ Stubs æ¦‚å¿µæ˜æ™° - ç‹ä¸‹é‚€æœˆç†Š - 2018 ã€‚\nä¸ºä»€ä¹ˆéœ€è¦å•å…ƒæµ‹è¯•ï¼Ÿ # ä¸ºé‡æ„ä¿é©¾æŠ¤èˆª # æˆ‘åœ¨é‡æ„è¿™ç¯‡æ–‡ç« ä¸­è¿™æ ·å†™åˆ°ï¼š\nå•å…ƒæµ‹è¯•å¯ä»¥ä¸ºé‡æ„æä¾›ä¿¡å¿ƒï¼Œé™ä½é‡æ„çš„æˆæœ¬ã€‚æˆ‘ä»¬è¦åƒé‡è§†ç”Ÿäº§ä»£ç é‚£æ ·ï¼Œé‡è§†å•å…ƒæµ‹è¯•ã€‚\næ¯ä¸ªå¼€å‘è€…éƒ½ä¼šç»å†é‡æ„ï¼Œé‡æ„åæŠŠä»£ç æ”¹åäº†çš„æƒ…å†µå¹¶ä¸å°‘è§ï¼Œå¾ˆå¯èƒ½ä½ åªæ˜¯ä¿®æ”¹äº†ä¸€ä¸ªå¾ˆç®€å•çš„æ–¹æ³•å°±å¯¼è‡´ç³»ç»Ÿå‡ºç°äº†ä¸€ä¸ªæ¯”è¾ƒä¸¥é‡çš„é”™è¯¯ã€‚\nå¦‚æœæœ‰äº†å•å…ƒæµ‹è¯•çš„è¯ï¼Œå°±ä¸ä¼šå­˜åœ¨è¿™ä¸ªéšæ‚£äº†ã€‚å†™å®Œä¸€ä¸ªç±»ï¼ŒæŠŠå•å…ƒæµ‹è¯•å†™äº†ï¼Œç¡®ä¿è¿™ä¸ªç±»é€»è¾‘æ­£ç¡®ï¼›å†™ç¬¬äºŒä¸ªç±»ï¼Œå•å…ƒæµ‹è¯•\u0026hellip;..å†™ 100 ä¸ªç±»ï¼Œé“ç†ä¸€æ ·ï¼Œæ¯ä¸ªç±»åšåˆ°ç¬¬ä¸€ç‚¹â€œä¿è¯é€»è¾‘æ­£ç¡®æ€§â€ï¼Œ100 ä¸ªç±»æ‹¼åœ¨ä¸€èµ·è‚¯å®šä¸å‡ºé—®é¢˜ã€‚ä½ å¤§å¯ä»¥æ”¾å¿ƒä¸€è¾¹é‡æ„ï¼Œä¸€è¾¹è¿è¡Œ APPï¼›è€Œä¸æ˜¯æ•´ä½“é‡æ„å®Œï¼Œæå¿ƒåŠèƒ†åœ° runã€‚\næé«˜ä»£ç è´¨é‡ # ç”±äºæ¯ä¸ªå•å…ƒæœ‰ç‹¬ç«‹çš„é€»è¾‘ï¼Œåšå•å…ƒæµ‹è¯•æ—¶éœ€è¦éš”ç¦»å¤–éƒ¨ä¾èµ–ï¼Œç¡®ä¿è¿™äº›ä¾èµ–ä¸å½±å“éªŒè¯é€»è¾‘ã€‚å› ä¸ºè¦æŠŠå„ç§ä¾èµ–åˆ†ç¦»ï¼Œå•å…ƒæµ‹è¯•ä¼šä¿ƒè¿›å·¥ç¨‹è¿›è¡Œç»„ä»¶æ‹†åˆ†ï¼Œæ•´ç†å·¥ç¨‹ä¾èµ–å…³ç³»ï¼Œæ›´å¤§ç¨‹åº¦å‡å°‘ä»£ç è€¦åˆã€‚è¿™æ ·å†™å‡ºæ¥çš„ä»£ç ï¼Œæ›´å¥½ç»´æŠ¤ï¼Œæ›´å¥½æ‰©å±•ï¼Œä»è€Œæé«˜ä»£ç è´¨é‡ã€‚\nå‡å°‘ bug # ä¸€ä¸ªæœºå™¨ï¼Œç”±å„ç§ç»†å°çš„é›¶ä»¶ç»„æˆï¼Œå¦‚æœå…¶ä¸­æŸä»¶é›¶ä»¶åäº†ï¼Œæœºå™¨è¿è¡Œæ•…éšœã€‚å¿…é¡»ä¿è¯æ¯ä¸ªé›¶ä»¶éƒ½æŒ‰è®¾è®¡å›¾è¦æ±‚çš„è§„æ ¼ï¼Œæœºå™¨æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚\nä¸€ä¸ªå¯å•å…ƒæµ‹è¯•çš„å·¥ç¨‹ï¼Œä¼šæŠŠä¸šåŠ¡ã€åŠŸèƒ½åˆ†å‰²æˆè§„æ¨¡æ›´å°ã€æœ‰ç‹¬ç«‹çš„é€»è¾‘éƒ¨ä»¶ï¼Œç§°ä¸ºå•å…ƒã€‚å•å…ƒæµ‹è¯•çš„ç›®æ ‡ï¼Œå°±æ˜¯ä¿è¯å„ä¸ªå•å…ƒçš„é€»è¾‘æ­£ç¡®æ€§ã€‚å•å…ƒæµ‹è¯•ä¿éšœå·¥ç¨‹å„ä¸ªâ€œé›¶ä»¶â€æŒ‰â€œè§„æ ¼â€ï¼ˆéœ€æ±‚ï¼‰æ‰§è¡Œï¼Œä»è€Œä¿è¯æ•´ä¸ªâ€œæœºå™¨â€ï¼ˆé¡¹ç›®ï¼‰è¿è¡Œæ­£ç¡®ï¼Œæœ€å¤§é™åº¦å‡å°‘ bugã€‚\nå¿«é€Ÿå®šä½ bug # å¦‚æœç¨‹åºæœ‰ bugï¼Œæˆ‘ä»¬è¿è¡Œä¸€æ¬¡å…¨éƒ¨å•å…ƒæµ‹è¯•ï¼Œæ‰¾åˆ°ä¸é€šè¿‡çš„æµ‹è¯•ï¼Œå¯ä»¥å¾ˆå¿«åœ°å®šä½å¯¹åº”çš„æ‰§è¡Œä»£ç ã€‚ä¿®å¤ä»£ç åï¼Œè¿è¡Œå¯¹åº”çš„å•å…ƒæµ‹è¯•ï¼›å¦‚è¿˜ä¸é€šè¿‡ï¼Œç»§ç»­ä¿®æ”¹ï¼Œè¿è¡Œæµ‹è¯•\u0026hellip;..ç›´åˆ°æµ‹è¯•é€šè¿‡ã€‚\næŒç»­é›†æˆä¾èµ–å•å…ƒæµ‹è¯• # æŒç»­é›†æˆéœ€è¦ä¾èµ–å•å…ƒæµ‹è¯•ï¼Œå½“æŒç»­é›†æˆæœåŠ¡è‡ªåŠ¨æ„å»ºæ–°ä»£ç ä¹‹åï¼Œä¼šè‡ªåŠ¨è¿è¡Œå•å…ƒæµ‹è¯•æ¥å‘ç°ä»£ç é”™è¯¯ã€‚\nè°é€¼ä½ å†™å•å…ƒæµ‹è¯•ï¼Ÿ # é¢†å¯¼è¦æ±‚ # æœ‰äº›ç»éªŒä¸°å¯Œçš„é¢†å¯¼ï¼Œæˆ–å¤šæˆ–å°‘éƒ½ä¼šè¦æ±‚å›¢é˜Ÿå†™å•å…ƒæµ‹è¯•ã€‚å¯¹äºæœ‰ä¸€å®šå·¥ä½œç»éªŒçš„é˜Ÿå‹ï¼Œè¿™è¦æ±‚æŒºåˆç†ï¼›å¯¹äºç»éªŒå°šæµ…çš„ã€æ¯•ä¸šç”Ÿï¼Œææ€•è¦æ­»è¦æ´»äº†ï¼Œè¿ä»£ç éƒ½å†™ä¸å¥½ï¼Œè¿˜è¦å†™å•å…ƒæµ‹è¯•ï¼Œare you kidding meï¼Ÿ\nåŸ¹è®­æ–°äººå•å…ƒæµ‹è¯•ç”¨æ³•ï¼Œæ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚æ–°äººä»£ç é£æ ¼æœªå½¢æˆï¼Œä¹Ÿä¸çŸ¥é“å•å…ƒæµ‹è¯•å¤šé‡è¦ï¼Œå¼ºåˆ¶å•å…ƒæµ‹è¯•ä¼šè®©ä»–ä»¬æ„Ÿåˆ°å›°æƒ‘ï¼Œæ²¡åŠæ³•æŒ‰è‡ªå·±æ€è·¯å†™ä»£ç ã€‚\nå¤§ç‰›éƒ½å†™å•å…ƒæµ‹è¯• # å›½å¤–å¾ˆå¤šå®¶å–»æˆ·æ™“çš„å¼€æºé¡¹ç›®ï¼Œéƒ½æœ‰å¤§é‡å•å…ƒæµ‹è¯•ã€‚ä¾‹å¦‚ï¼Œretrofitã€okhttpã€butterknife\u0026hellip;. å›½å¤–å¤§ç‰›éƒ½å†™å•å…ƒæµ‹è¯•ï¼Œæˆ‘ä»¬ä¹Ÿå†™å§ï¼\nå¾ˆå¤šè¯»è€…éƒ½æœ‰è¿™ç§æƒ³æ³•ï¼Œä¸€å¼€å§‹æ»¡è…”çƒ­è¡€ã€‚å½“çœŸè¦å¯¹è‡ªå·±é¡¹ç›®å•å…ƒæµ‹è¯•æ—¶ï¼Œä¾¿å›°éš¾é‡é‡ï¼Œå¾ˆå¤§åŸå› æ˜¯é¡¹ç›®å¯¹å•å…ƒæµ‹è¯•ä¸å‹å¥½ã€‚æœ€ååªèƒ½å¯¹ä¸€äº›ä¸ç—›ä¸ç—’çš„å·¥å…·ç±»åšå•å…ƒæµ‹è¯•ï¼Œä¹…è€Œä¹…ä¹‹ï¼Œå½“åˆç¾å¥½æ„¿æœ›ä¹Ÿä¸äº†äº†ä¹‹ã€‚\nä¿ä½é¢å­ # éƒ½æ˜¯æœ‰äº›è®¸å¹´ç»éªŒçš„è€é¸Ÿï¼Œè¿˜å¤©å¤©è¢«æµ‹è¯•åŒå­¦è¿½ bugï¼Œå¥½æ„æ€ä¹ˆï¼ŸèŠ±å¤šä¸€ç‚¹æ—¶é—´å†™å•å…ƒæµ‹è¯•ï¼Œç¡®ä¿æ²¡ä½çº§ bugï¼Œè¿˜èƒ½å½°æ˜¾å¤§ç‰›é£èŒƒï¼Œä½•ä¹è€Œä¸ä¸ºï¼Ÿ\nå¿ƒè™š # ç¬”è€…ä¹Ÿæ˜¯ä¸ªä¸å¤ªç›¸ä¿¡è‡ªå·±ä»£ç çš„äººï¼Œæ€»è§‰å¾—å“ªé‡Œä¼šçªç„¶å†’å‡ºè«åå…¶å¦™çš„ bugï¼Œä¹Ÿæ€•åˆ«äººä¸å°å¿ƒæ”¹äº†è‡ªå·±çš„ä»£ç ï¼ˆè¢«å®³å¦„æƒ³ç—‡ï¼‰ï¼Œæ–°ç‰ˆæœ¬ä¸Šçº¿æå¿ƒåŠèƒ†\u0026hellip;\u0026hellip;èŠ±ç‚¹æ—¶é—´å†™å•å…ƒæµ‹è¯•ï¼Œæœ‰äº‹æ²¡äº‹è·‘ä¸€ä¸‹æµ‹è¯•ï¼Œç¡®ä¿åŸé€»è¾‘æ²¡é—®é¢˜ï¼Œè‡³å°‘èƒ½ç¡å®‰ç¨³ä¸€ç‚¹ã€‚\nTDD æµ‹è¯•é©±åŠ¨å¼€å‘ # ä½•è°“ TDDï¼Ÿ # TDD å³ Test-Driven Developmentï¼ˆ æµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰ï¼Œè¿™æ˜¯æ•æ·å¼€å‘çš„ä¸€é¡¹æ ¸å¿ƒå®è·µå’ŒæŠ€æœ¯ï¼Œä¹Ÿæ˜¯ä¸€ç§è®¾è®¡æ–¹æ³•è®ºã€‚\nTDD åŸç†æ˜¯å¼€å‘åŠŸèƒ½ä»£ç ä¹‹å‰ï¼Œå…ˆç¼–å†™æµ‹è¯•ç”¨ä¾‹ä»£ç ï¼Œç„¶åé’ˆå¯¹æµ‹è¯•ç”¨ä¾‹ç¼–å†™åŠŸèƒ½ä»£ç ï¼Œä½¿å…¶èƒ½å¤Ÿé€šè¿‡ã€‚\nTDD çš„èŠ‚å¥ï¼šâ€œçº¢ - ç»¿ - é‡æ„â€ã€‚\nç”±äº TDD å¯¹å¼€å‘äººå‘˜è¦æ±‚éå¸¸é«˜ï¼Œè·Ÿä¼ ç»Ÿå¼€å‘æ€ç»´ä¸ä¸€æ ·ï¼Œå› æ­¤å®æ–½èµ·æ¥ç›¸å½“å›°éš¾ã€‚\nTDD åœ¨å¾ˆå¤šäººçœ¼ä¸­æ˜¯ä¸å®ç”¨çš„ï¼Œä¸€æ¥ä»–ä»¬å¹¶ä¸ç†è§£æµ‹è¯•â€œé©±åŠ¨â€å¼€å‘çš„å«ä¹‰ï¼Œä½†æ›´é‡è¦çš„æ˜¯ï¼Œä»–ä»¬å¾ˆå°‘ä¼šåšä»»åŠ¡åˆ†è§£ã€‚è€Œä»»åŠ¡åˆ†è§£æ˜¯åšå¥½ TDD çš„å…³é”®ç‚¹ã€‚åªæœ‰æŠŠä»»åŠ¡åˆ†è§£åˆ°å¯ä»¥æµ‹è¯•çš„åœ°æ­¥ï¼Œæ‰èƒ½å¤Ÿæœ‰é’ˆå¯¹æ€§åœ°å†™æµ‹è¯•ã€‚\nTDD ä¼˜ç¼ºç‚¹åˆ†æ # æµ‹è¯•é©±åŠ¨å¼€å‘æœ‰å¥½å¤„ä¹Ÿæœ‰åå¤„ã€‚å› ä¸ºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½æ˜¯æ ¹æ®éœ€æ±‚æ¥çš„ï¼Œæˆ–è€…è¯´æŠŠä¸€ä¸ªå¤§éœ€æ±‚åˆ†è§£æˆè‹¥å¹²å°éœ€æ±‚ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œæ‰€ä»¥æµ‹è¯•ç”¨ä¾‹å†™å‡ºæ¥åï¼Œå¼€å‘è€…å†™çš„æ‰§è¡Œä»£ç ï¼Œå¿…é¡»æ»¡è¶³æµ‹è¯•ç”¨ä¾‹ã€‚å¦‚æœæµ‹è¯•ä¸é€šè¿‡ï¼Œåˆ™ä¿®æ”¹æ‰§è¡Œä»£ç ï¼Œç›´åˆ°æµ‹è¯•ç”¨ä¾‹é€šè¿‡ã€‚\nä¼˜ç‚¹ ï¼š\nå¸®ä½ æ•´ç†éœ€æ±‚ï¼Œæ¢³ç†æ€è·¯ï¼› å¸®ä½ è®¾è®¡å‡ºæ›´åˆç†çš„æ¥å£ï¼ˆç©ºæƒ³çš„è¯å¾ˆå®¹æ˜“è®¾è®¡å‡ºå±ï¼‰ï¼› å‡å°ä»£ç å‡ºç° bug çš„æ¦‚ç‡ï¼› æé«˜å¼€å‘æ•ˆç‡ï¼ˆå‰ææ˜¯æ­£ç¡®ä¸”ç†Ÿç»ƒä½¿ç”¨ TDDï¼‰ã€‚ ç¼ºç‚¹ ï¼š\nèƒ½ç”¨å¥½ TDD çš„äººéå¸¸å°‘ï¼Œçœ‹ä¼¼ç®€å•ï¼Œå®åˆ™é—¨æ§›å¾ˆé«˜ï¼› æŠ•å…¥å¼€å‘èµ„æºï¼ˆæ—¶é—´å’Œç²¾åŠ›ï¼‰é€šå¸¸ä¼šæ›´å¤šï¼› ç”±äºæµ‹è¯•ç”¨ä¾‹åœ¨æœªè¿›è¡Œä»£ç è®¾è®¡å‰å†™ï¼›å¾ˆæœ‰å¯èƒ½é™åˆ¶å¼€å‘è€…å¯¹ä»£ç æ•´ä½“è®¾è®¡ï¼› å¯èƒ½å¼•èµ·å¼€å‘äººå‘˜ä¸æ»¡æƒ…ç»ªï¼Œæˆ‘è§‰å¾—è¿™ç‚¹å¾ˆä¸¥é‡ï¼Œæ¯•ç«Ÿä¸æ˜¯äººäººéƒ½å–œæ¬¢å•å…ƒæµ‹è¯•ï¼Œå°½ç®¡å•å…ƒæµ‹è¯•ä¼šå¸¦ç»™æˆ‘ä»¬ç›¸å½“å¤šçš„å¥½å¤„ã€‚ ç›¸å…³é˜…è¯»ï¼šå¦‚ä½•ç”¨æ­£ç¡®çš„å§¿åŠ¿æ‰“å¼€ TDDï¼Ÿ - é™ˆå¤© - 2017 ã€‚\næ€»ç»“ # å•å…ƒæµ‹è¯•ç¡®å®ä¼šå¸¦ç»™ä½ ç›¸å½“å¤šçš„å¥½å¤„ï¼Œä½†ä¸æ˜¯ç«‹åˆ»ä½“éªŒå‡ºæ¥ã€‚æ­£å¦‚ä¹°é‡ç–¾ä¿é™©ï¼Œäº¤äº†å¾ˆå¤šä¿è´¹ï¼Œæ²¡ç—…æ²¡ç—›ï¼Œåå‡ å¹´ç”šè‡³å‡ åå¹´éƒ½ç”¨ä¸ä¸Šï¼Œæœ€å¥½å°±æ˜¯ä¸€è¾ˆå­ç”¨ä¸ä¸Šç†èµ”ï¼Œèº«ä½“å¥åº·æœ€é‡è¦ã€‚å•å…ƒæµ‹è¯•ä¹Ÿä¸€æ ·ï¼Œå†™äº†å¯ä»¥ä¹°ä¸ªæ”¾å¿ƒï¼Œå¯¹ä»£ç çš„ä¸€ç§ä¿éšœï¼Œæœ‰ bug å°½å¿«æµ‹å‡ºæ¥ï¼Œæ²¡ bug å°±æœ€å¥½ï¼Œæ€»ä¸èƒ½è¯´â€œå†™é‚£ä¹ˆå¤šå•å…ƒæµ‹è¯•ï¼Œç»“æœæµ‹ä¸å‡º bugï¼Œæµªè´¹æ—¶é—´â€å§ï¼Ÿ\nä»¥ä¸‹æ˜¯ä¸ªäººå¯¹å•å…ƒæµ‹è¯•ä¸€äº›å»ºè®®ï¼š\nè¶Šé‡è¦çš„ä»£ç ï¼Œè¶Šè¦å†™å•å…ƒæµ‹è¯•ï¼› ä»£ç åšä¸åˆ°å•å…ƒæµ‹è¯•ï¼Œå¤šæ€è€ƒå¦‚ä½•æ”¹è¿›ï¼Œè€Œä¸æ˜¯æ”¾å¼ƒï¼› è¾¹å†™ä¸šåŠ¡ä»£ç ï¼Œè¾¹å†™å•å…ƒæµ‹è¯•ï¼Œè€Œä¸æ˜¯å®Œæˆæ•´ä¸ªæ–°åŠŸèƒ½åå†å†™ï¼› å¤šæ€è€ƒå¦‚ä½•æ”¹è¿›ã€ç®€åŒ–æµ‹è¯•ä»£ç ã€‚ æµ‹è¯•ä»£ç éœ€è¦éšç€ç”Ÿäº§ä»£ç çš„æ¼”è¿›è€Œé‡æ„æˆ–è€…ä¿®æ”¹ï¼Œå¦‚æœæµ‹è¯•ä¸èƒ½ä¿æŒæ•´æ´ï¼Œåªä¼šè¶Šæ¥è¶Šéš¾ä¿®æ”¹ã€‚ ä½œä¸ºä¸€åç»éªŒä¸°å¯Œçš„ç¨‹åºå‘˜ï¼Œå†™å•å…ƒæµ‹è¯•æ›´å¤šçš„æ˜¯å¯¹è‡ªå·±çš„ä»£ç è´Ÿè´£ã€‚æœ‰æµ‹è¯•ç”¨ä¾‹çš„ä»£ç ï¼Œåˆ«äººæ›´å®¹æ˜“çœ‹æ‡‚ï¼Œä»¥ååˆ«äººæ¥æ‰‹ä½ çš„ä»£ç æ—¶ï¼Œä¹Ÿå¯èƒ½æ”¾å¿ƒåšæ”¹åŠ¨ã€‚\nå¤šæ•²ä»£ç å®è·µï¼Œå¤šè·Ÿæœ‰å•å…ƒæµ‹è¯•ç»éªŒçš„å·¥ç¨‹å¸ˆäº¤æµï¼Œä½ ä¼šå‘ç°å†™å•å…ƒæµ‹è¯•è·å¾—çš„æ”¶ç›Šä¼šæ›´å¤šã€‚\n"},{"id":66,"href":"/zh/docs/study/Review/java_guide/lycly_system-design/basis/refactoring/","title":"ä»£ç é‡æ„æŒ‡å—","section":"åŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nå‰æ®µæ—¶é—´é‡è¯»äº†ã€Šé‡æ„ï¼šæ”¹å–„ä»£ç æ—¢æœ‰è®¾è®¡ã€‹ï¼Œæ”¶è´§é¢‡å¤šã€‚äºæ˜¯ï¼Œç®€å•å†™äº†ä¸€ç¯‡æ–‡ç« æ¥èŠèŠæˆ‘å¯¹é‡æ„çš„çœ‹æ³•ã€‚\nä½•è°“é‡æ„ï¼Ÿ # å­¦ä¹ é‡æ„å¿…çœ‹çš„ä¸€æœ¬ç¥ä¹¦ã€Šé‡æ„ï¼šæ”¹å–„ä»£ç æ—¢æœ‰è®¾è®¡ã€‹ä»ä¸¤ä¸ªè§’åº¦ç»™å‡ºäº†é‡æ„çš„å®šä¹‰ï¼š\né‡æ„ï¼ˆåè¯ï¼‰ï¼šå¯¹è½¯ä»¶å†…éƒ¨ç»“æ„çš„ä¸€ç§è°ƒæ•´ï¼Œç›®çš„æ˜¯åœ¨ä¸æ”¹å˜è½¯ä»¶å¯è§‚å¯Ÿè¡Œä¸ºçš„å‰æä¸‹ï¼Œæé«˜å…¶å¯ç†è§£æ€§ï¼Œé™ä½å…¶ä¿®æ”¹æˆæœ¬ã€‚ é‡æ„ï¼ˆåŠ¨è¯ï¼‰ï¼šä½¿ç”¨ä¸€ç³»åˆ—é‡æ„æ‰‹æ³•ï¼Œåœ¨ä¸æ”¹å˜è½¯ä»¶å¯è§‚å¯Ÿè¡Œä¸ºçš„å‰æä¸‹ï¼Œè°ƒæ•´å…¶ç»“æ„ã€‚ ç”¨æ›´è´´è¿‘å·¥ç¨‹å¸ˆçš„è¯­è¨€æ¥è¯´ï¼š é‡æ„å°±æ˜¯åˆ©ç”¨è®¾è®¡æ¨¡å¼(å¦‚ç»„åˆæ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ã€è´£ä»»é“¾æ¨¡å¼)ã€è½¯ä»¶è®¾è®¡åŸåˆ™ï¼ˆå¦‚ SOLID åŸåˆ™ã€YAGNI åŸåˆ™ã€KISS åŸåˆ™ï¼‰å’Œé‡æ„æ‰‹æ®µï¼ˆå¦‚å°è£…ã€ç»§æ‰¿ã€æ„å»ºæµ‹è¯•ä½“ç³»ï¼‰æ¥è®©ä»£ç æ›´å®¹æ˜“ç†è§£ï¼Œæ›´æ˜“äºä¿®æ”¹ã€‚\nè½¯ä»¶è®¾è®¡åŸåˆ™æŒ‡å¯¼ç€æˆ‘ä»¬ç»„ç»‡å’Œè§„èŒƒä»£ç ï¼ŒåŒæ—¶ï¼Œé‡æ„ä¹Ÿæ˜¯ä¸ºäº†èƒ½å¤Ÿå°½é‡è®¾è®¡å‡ºå°½é‡æ»¡è¶³è½¯ä»¶è®¾è®¡åŸåˆ™çš„è½¯ä»¶ã€‚\næ­£ç¡®é‡æ„çš„æ ¸å¿ƒåœ¨äº æ­¥å­ä¸€å®šè¦å°ï¼Œæ¯ä¸€æ­¥çš„é‡æ„éƒ½ä¸ä¼šå½±å“è½¯ä»¶çš„æ­£å¸¸è¿è¡Œï¼Œå¯ä»¥éšæ—¶åœæ­¢é‡æ„ã€‚\nå¸¸è§çš„è®¾è®¡æ¨¡å¼å¦‚ä¸‹ ï¼š\næ›´å…¨é¢çš„è®¾è®¡æ¨¡å¼æ€»ç»“ï¼Œå¯ä»¥çœ‹ java-design-patterns è¿™ä¸ªå¼€æºé¡¹ç›®ã€‚\nå¸¸è§çš„è½¯ä»¶è®¾è®¡åŸåˆ™å¦‚ä¸‹ ï¼š\næ›´å…¨é¢çš„è®¾è®¡åŸåˆ™æ€»ç»“ï¼Œå¯ä»¥çœ‹ java-design-patterns å’Œ hacker-laws-zh è¿™ä¸¤ä¸ªå¼€æºé¡¹ç›®ã€‚\nä¸ºä»€ä¹ˆè¦é‡æ„ï¼Ÿ # åœ¨ä¸Šé¢ä»‹ç»é‡æ„å®šä¹‰çš„æ—¶å€™ï¼Œæˆ‘ä»æ¯”è¾ƒæŠ½è±¡çš„è§’åº¦ä»‹ç»äº†é‡æ„çš„å¥½å¤„ï¼šé‡æ„çš„ä¸»è¦ç›®çš„ä¸»è¦æ˜¯æå‡ä»£ç \u0026amp;æ¶æ„çš„çµæ´»æ€§/å¯æ‰©å±•æ€§ä»¥åŠå¤ç”¨æ€§ã€‚\nå¦‚æœå¯¹åº”åˆ°ä¸€ä¸ªçœŸå®çš„é¡¹ç›®ï¼Œé‡æ„å…·ä½“èƒ½ä¸ºæˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ\nè®©ä»£ç æ›´å®¹æ˜“ç†è§£ ï¼š é€šè¿‡æ·»åŠ æ³¨é‡Šã€å‘½åè§„èŒƒã€é€»è¾‘ä¼˜åŒ–ç­‰æ‰‹æ®µå¯ä»¥è®©æˆ‘ä»¬çš„ä»£ç æ›´å®¹æ˜“è¢«ç†è§£ï¼› é¿å…ä»£ç è…åŒ– ï¼šé€šè¿‡é‡æ„å¹²æ‰åå‘³é“ä»£ç ï¼› åŠ æ·±å¯¹ä»£ç çš„ç†è§£ ï¼šé‡æ„ä»£ç çš„è¿‡ç¨‹ä¼šåŠ æ·±ä½ å¯¹æŸéƒ¨åˆ†ä»£ç çš„ç†è§£ï¼› å‘ç°æ½œåœ¨ bug ï¼šæ˜¯è¿™æ ·çš„ï¼Œå¾ˆå¤šæ½œåœ¨çš„ bug ï¼Œéƒ½æ˜¯æˆ‘ä»¬åœ¨é‡æ„çš„è¿‡ç¨‹ä¸­å‘ç°çš„ï¼› \u0026hellip;\u0026hellip; çœ‹äº†ä¸Šé¢ä»‹ç»çš„å…³äºé‡æ„å¸¦æ¥çš„å¥½å¤„ä¹‹åï¼Œä½ ä¼šå‘ç°é‡æ„çš„æœ€ç»ˆç›®æ ‡æ˜¯ æé«˜è½¯ä»¶å¼€å‘é€Ÿåº¦å’Œè´¨é‡ ã€‚\né‡æ„å¹¶ä¸ä¼šå‡æ…¢è½¯ä»¶å¼€å‘é€Ÿåº¦ï¼Œç›¸åï¼Œå¦‚æœä»£ç è´¨é‡å’Œè½¯ä»¶è®¾è®¡è¾ƒå·®ï¼Œå½“æˆ‘ä»¬æƒ³è¦æ·»åŠ æ–°åŠŸèƒ½çš„è¯ï¼Œå¼€å‘é€Ÿåº¦ä¼šè¶Šæ¥è¶Šæ…¢ã€‚åˆ°äº†æœ€åï¼Œç”šè‡³éƒ½æœ‰æƒ³è¦é‡å†™æ•´ä¸ªç³»ç»Ÿçš„å†²åŠ¨ã€‚\n[\nã€Šé‡æ„ï¼šæ”¹å–„ä»£ç æ—¢æœ‰è®¾è®¡ã€‹è¿™æœ¬ä¹¦ä¸­è¿™æ ·è¯´ï¼š\né‡æ„çš„å”¯ä¸€ç›®çš„å°±æ˜¯è®©æˆ‘ä»¬å¼€å‘æ›´å¿«ï¼Œç”¨æ›´å°‘çš„å·¥ä½œé‡åˆ›é€ æ›´å¤§çš„ä»·å€¼ã€‚\nä½•æ—¶è¿›è¡Œé‡æ„ï¼Ÿ # é‡æ„åœ¨æ˜¯å¼€å‘è¿‡ç¨‹ä¸­éšæ—¶å¯ä»¥è¿›è¡Œçš„ï¼Œè§æœºè¡Œäº‹å³å¯ï¼Œå¹¶ä¸éœ€è¦å•ç‹¬åˆ†é…ä¸€ä¸¤å¤©çš„æ—¶é—´ä¸“é—¨ç”¨æ¥é‡æ„ã€‚\næäº¤ä»£ç ä¹‹å‰ # ã€Šé‡æ„ï¼šæ”¹å–„ä»£ç æ—¢æœ‰è®¾è®¡ã€‹è¿™æœ¬ä¹¦ä»‹ç»äº†ä¸€ä¸ª è¥åœ°æ³•åˆ™ çš„æ¦‚å¿µ:\nç¼–ç¨‹æ—¶ï¼Œéœ€è¦éµå¾ªè¥åœ°æ³•åˆ™ï¼šä¿è¯ä½ ç¦»å¼€æ—¶çš„ä»£ç åº“ä¸€å®šæ¯”æ¥æ—¶æ›´å¥åº·ã€‚\nè¿™ä¸ªæ¦‚å¿µè¡¨è¾¾çš„æ ¸å¿ƒæ€æƒ³å…¶å®å¾ˆç®€å•ï¼šåœ¨ä½ æäº¤ä»£ç çš„ä¹‹å‰ï¼ŒèŠ±ä¸€ä¼šæ—¶é—´æƒ³ä¸€æƒ³ï¼Œæˆ‘è¿™æ¬¡çš„æäº¤æ˜¯è®©é¡¹ç›®ä»£ç å˜å¾—æ›´å¥åº·äº†ï¼Œè¿˜æ˜¯æ›´è…åŒ–äº†ï¼Œæˆ–è€…è¯´æ²¡ä»€ä¹ˆå˜åŒ–ï¼Ÿ\né¡¹ç›®å›¢é˜Ÿçš„æ¯ä¸€ä¸ªäººåªæœ‰ä¿è¯è‡ªå·±çš„æäº¤æ²¡æœ‰è®©é¡¹ç›®ä»£ç å˜å¾—æ›´è…åŒ–ï¼Œé¡¹ç›®ä»£ç æ‰ä¼šæœç€å¥åº·çš„æ–¹å‘å‘å±•ã€‚\nå½“æˆ‘ä»¬ç¦»å¼€è¥åœ°ï¼ˆé¡¹ç›®ä»£ç ï¼‰çš„æ—¶å€™ï¼Œè¯·ä¸è¦ç•™ä¸‹åƒåœ¾ï¼ˆä»£ç åå‘³é“ï¼‰ï¼å°½é‡ç¡®ä¿è¥åœ°å˜å¾—æ›´å¹²å‡€äº†ï¼\nå¼€å‘ä¸€ä¸ªæ–°åŠŸèƒ½ä¹‹å\u0026amp;ä¹‹å‰ # åœ¨å¼€å‘ä¸€ä¸ªæ–°åŠŸèƒ½ä¹‹åï¼Œæˆ‘ä»¬åº”è¯¥å›è¿‡å¤´çœ‹çœ‹æ˜¯ä¸æ˜¯æœ‰å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ã€‚åœ¨æ·»åŠ ä¸€ä¸ªæ–°åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥æ€è€ƒä¸€ä¸‹è‡ªå·±æ˜¯å¦å¯ä»¥é‡æ„ä»£ç ä»¥è®©æ–°åŠŸèƒ½çš„å¼€å‘æ›´å®¹æ˜“ã€‚\nä¸€ä¸ªæ–°åŠŸèƒ½çš„å¼€å‘ä¸åº”è¯¥ä»…ä»…åªæœ‰åŠŸèƒ½éªŒè¯é€šè¿‡é‚£ä¹ˆç®€å•ï¼Œæˆ‘ä»¬è¿˜åº”è¯¥å°½é‡ä¿è¯ä»£ç è´¨é‡ã€‚\næœ‰ä¸€ä¸ªä¸¤é¡¶å¸½å­çš„æ¯”å–»ï¼šåœ¨æˆ‘å¼€å‘æ–°åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘å‘ç°é‡æ„å¯ä»¥è®©æ–°åŠŸèƒ½çš„å¼€å‘æ›´å®¹æ˜“ï¼Œäºæ˜¯æˆ‘æˆ´ä¸Šäº†é‡æ„çš„å¸½å­ã€‚é‡æ„ä¹‹åï¼Œæˆ‘æ¢å›åŸæ¥çš„å¸½å­ï¼Œç»§ç»­å¼€å‘æ–°èƒ½åŠŸèƒ½ã€‚æ–°åŠŸèƒ½å¼€å‘å®Œæˆä¹‹åï¼Œæˆ‘åˆå‘ç°è‡ªå·±çš„ä»£ç éš¾ä»¥ç†è§£ï¼Œäºæ˜¯æˆ‘åˆæˆ´ä¸Šäº†é‡æ„å¸½å­ã€‚æ¯”è¾ƒå¥½çš„å¼€å‘çŠ¶æ€å°±æ˜¯å°±æ˜¯è¿™æ ·åœ¨é‡æ„å’Œå¼€å‘æ–°åŠŸèƒ½ä¹‹é—´æ¥å›åˆ‡æ¢ã€‚\nCode Review ä¹‹å # Code Review å¯ä»¥éå¸¸æœ‰æ•ˆæé«˜ä»£ç çš„æ•´ä½“è´¨é‡ï¼Œå®ƒä¼šå¸®åŠ©æˆ‘ä»¬å‘ç°ä»£ç ä¸­çš„åå‘³é“ä»¥åŠå¯èƒ½å­˜åœ¨é—®é¢˜çš„åœ°æ–¹ã€‚å¹¶ä¸”ï¼Œ Code Review å¯ä»¥å¸®åŠ©é¡¹ç›®å›¢é˜Ÿå…¶ä»–ç¨‹åºå‘˜ç†è§£ä½ è´Ÿè´£çš„ä¸šåŠ¡æ¨¡å—ï¼Œæœ‰æ•ˆé¿å…äººå‘˜æ–¹é¢çš„å•ç‚¹é£é™©ã€‚\nç»å†ä¸€æ¬¡ Code Review ï¼Œä½ çš„ä»£ç å¯èƒ½ä¼šæ”¶åˆ°å¾ˆå¤šæ”¹è¿›å»ºè®®ã€‚\næ¡åƒåœ¾å¼é‡æ„ # å½“æˆ‘ä»¬å‘ç°åå‘³é“ä»£ç ï¼ˆåƒåœ¾ï¼‰çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬ä¸æƒ³åœä¸‹æ‰‹å¤´è‡ªå·±æ­£åœ¨åšçš„å·¥ä½œï¼Œä½†åˆä¸æƒ³æ”¾ç€åƒåœ¾ä¸ç®¡ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š\nå¦‚æœè¿™ä¸ªåƒåœ¾å¾ˆå®¹æ˜“é‡æ„çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç«‹å³é‡æ„å®ƒã€‚ å¦‚æœè¿™ä¸ªåƒåœ¾ä¸å¤ªå®¹æ˜“é‡æ„çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè®°å½•ä¸‹æ¥ï¼Œå½“****é‡æ„å®ƒã€‚ é˜…è¯»ç†è§£ä»£ç çš„æ—¶å€™ # æå¼€å‘çš„å°ä¼™ä¼´åº”è¯¥éå¸¸æœ‰ä½“ä¼šï¼šæˆ‘ä»¬ç»å¸¸éœ€è¦é˜…è¯»é¡¹ç›®å›¢é˜Ÿä¸­å…¶ä»–äººå†™çš„ä»£ç ï¼Œä¹Ÿç»å¸¸éœ€è¦é˜…è¯»è‡ªå·±è¿‡å»å†™çš„ä»£ç ã€‚é˜…è¯»ä»£ç çš„æ—¶å€™ï¼Œé€šå¸¸è¦æ¯”æˆ‘ä»¬å†™ä»£ç çš„æ—¶é—´è¿˜è¦å¤šå¾ˆå¤šã€‚\næˆ‘ä»¬åœ¨é˜…è¯»ç†è§£ä»£ç çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°ä¸€äº›åå‘³é“çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹å…¶è¿›è¡Œé‡æ„ã€‚\nå°±æ¯”å¦‚è¯´ä½ åœ¨é˜…è¯»å¼ ä¸‰å†™çš„æŸæ®µä»£ç çš„æ—¶å€™ï¼Œä½ å‘ç°è¿™æ®µä»£ç é€»è¾‘è¿‡äºå¤æ‚éš¾ä»¥ç†è§£ï¼Œä½ æœ‰æ›´å¥½çš„å†™æ³•ï¼Œé‚£ä½ å°±å¯ä»¥å¯¹å¼ ä¸‰çš„è¿™æ®µä»£ç é€»è¾‘è¿›è¡Œé‡æ„ã€‚\né‡æ„æœ‰å“ªäº›æ³¨æ„äº‹é¡¹ï¼Ÿ # å•å…ƒæµ‹è¯•æ˜¯é‡æ„çš„ä¿æŠ¤ç½‘ # å•å…ƒæµ‹è¯•å¯ä»¥ä¸ºé‡æ„æä¾›ä¿¡å¿ƒï¼Œé™ä½é‡æ„çš„æˆæœ¬ã€‚æˆ‘ä»¬è¦åƒé‡è§†ç”Ÿäº§ä»£ç é‚£æ ·ï¼Œé‡è§†å•å…ƒæµ‹è¯•ã€‚\nå¦å¤–ï¼Œå¤šæä¸€å¥ï¼šæŒç»­é›†æˆä¹Ÿè¦ä¾èµ–å•å…ƒæµ‹è¯•ï¼Œå½“æŒç»­é›†æˆæœåŠ¡è‡ªåŠ¨æ„å»ºæ–°ä»£ç ä¹‹åï¼Œä¼šè‡ªåŠ¨è¿è¡Œå•å…ƒæµ‹è¯•æ¥å‘ç°ä»£ç é”™è¯¯ã€‚\næ€æ ·æ‰èƒ½ç®—å•å…ƒæµ‹è¯•å‘¢ï¼Ÿ ç½‘ä¸Šçš„å®šä¹‰å¾ˆå¤šï¼Œå¾ˆæŠ½è±¡ï¼Œå¾ˆå®¹æ˜“æŠŠäººç»™çœ‹è¿·ç³Šäº†ã€‚æˆ‘è§‰å¾—å¯¹äºå•å…ƒæµ‹è¯•çš„å®šä¹‰ä¸»è¦å–å†³äºä½ çš„é¡¹ç›®ï¼Œä¸€ä¸ªå‡½æ•°ç”šè‡³æ˜¯ä¸€ä¸ªç±»éƒ½å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå•å…ƒã€‚å°±æ¯”å¦‚è¯´æˆ‘ä»¬å†™äº†ä¸€ä¸ªè®¡ç®—ä¸ªäººè‚¡ç¥¨æ”¶ç›Šç‡çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸ºäº†éªŒè¯å®ƒçš„æ­£ç¡®æ€§ä¸“é—¨ä¸ºå®ƒå†™äº†ä¸€ä¸ªå•å…ƒæµ‹è¯•ã€‚å†æ¯”å¦‚è¯´æˆ‘ä»¬ä»£ç æœ‰ä¸€ä¸ªç±»ä¸“é—¨è´Ÿè´£æ•°æ®è„±æ•ï¼Œæˆ‘ä»¬ä¸ºäº†éªŒè¯è„±æ•æ˜¯å¦ç¬¦åˆé¢„æœŸä¸“é—¨ä¸ºè¿™ä¸ªç±»å†™äº†ä¸€ä¸ªå•å…ƒæµ‹è¯•ã€‚\nå•å…ƒæµ‹è¯•ä¹Ÿæ˜¯éœ€è¦é‡æ„æˆ–è€…ä¿®æ”¹çš„ã€‚ ã€Šä»£ç æ•´æ´ä¹‹é“:æ•æ·è½¯ä»¶å¼€å‘æ‰‹å†Œã€‹è¿™æœ¬ä¹¦è¿™æ ·å†™åˆ°ï¼š\næµ‹è¯•ä»£ç éœ€è¦éšç€ç”Ÿäº§ä»£ç çš„æ¼”è¿›è€Œä¿®æ”¹ï¼Œå¦‚æœæµ‹è¯•ä¸èƒ½ä¿æŒæ•´æ´ï¼Œåªä¼šè¶Šæ¥è¶Šéš¾ä¿®æ”¹ã€‚\nä¸è¦ä¸ºäº†é‡æ„è€Œé‡æ„ # é‡æ„ä¸€å®šæ˜¯è¦ä¸ºé¡¹ç›®å¸¦æ¥ä»·å€¼çš„ï¼ æŸäº›æƒ…å†µä¸‹æˆ‘ä»¬ä¸åº”è¯¥è¿›è¡Œé‡æ„ï¼š\nå­¦ä¹ äº†æŸä¸ªè®¾è®¡æ¨¡å¼/å·¥ç¨‹å®è·µä¹‹åï¼Œä¸é¡¾é¡¹ç›®å®é™…æƒ…å†µï¼Œåˆ»æ„ä½¿ç”¨åœ¨é¡¹ç›®ä¸Šï¼ˆé¿å…è´§ç‰©å´‡æ‹œç¼–ç¨‹ï¼‰ï¼› é¡¹ç›®è¿›å±•æ¯”è¾ƒæ€¥çš„æ—¶å€™ï¼Œé‡æ„é¡¹ç›®è°ƒç”¨çš„æŸä¸ª API çš„åº•å±‚ä»£ç ï¼ˆé‡æ„ä¹‹åå¯¹é¡¹ç›®è°ƒç”¨è¿™ä¸ª API å¹¶æ²¡æœ‰å¸¦æ¥ä»€ä¹ˆä»·å€¼ï¼‰ï¼› é‡å†™æ¯”é‡æ„æ›´å®¹æ˜“æ›´çœäº‹ï¼› \u0026hellip;\u0026hellip; éµå¾ªæ–¹æ³• # ã€Šé‡æ„ï¼šæ”¹å–„ä»£ç æ—¢æœ‰è®¾è®¡ã€‹è¿™æœ¬ä¹¦ä¸­åˆ—ä¸¾é™¤äº†ä»£ç å¸¸è§çš„ä¸€äº›åå‘³é“ï¼ˆæ¯”å¦‚é‡å¤ä»£ç ã€è¿‡é•¿å‡½æ•°ï¼‰å’Œé‡æ„æ‰‹æ®µï¼ˆå¦‚æç‚¼å‡½æ•°ã€æç‚¼å˜é‡ã€æç‚¼ç±»ï¼‰ã€‚æˆ‘ä»¬åº”è¯¥èŠ±æ—¶é—´å»å­¦ä¹ è¿™äº›é‡æ„ç›¸å…³çš„ç†è®ºçŸ¥è¯†ï¼Œå¹¶åœ¨ä»£ç ä¸­å»å®è·µè¿™äº›é‡æ„ç†è®ºã€‚\nå¦‚ä½•ç»ƒä¹ é‡æ„ï¼Ÿ # é™¤äº†å¯ä»¥åœ¨é‡æ„é¡¹ç›®ä»£ç çš„è¿‡ç¨‹ä¸­ç»ƒä¹ ç²¾è¿›é‡æ„ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥æœ‰ä¸‹é¢è¿™äº›æ‰‹æ®µï¼š\né‡æ„å®æˆ˜ç»ƒä¹  ï¼šé€šè¿‡å‡ ä¸ªå°æ¡ˆä¾‹ä¸€æ­¥ä¸€æ­¥å¸¦ä½ å­¦ä¹ é‡æ„ï¼ è®¾è®¡æ¨¡å¼+é‡æ„å­¦ä¹ ç½‘ç«™ ï¼šå…è´¹åœ¨çº¿å­¦ä¹ ä»£ç é‡æ„ã€ è®¾è®¡æ¨¡å¼ã€ SOLID åŸåˆ™ ï¼ˆå•ä¸€èŒè´£ã€ å¼€é—­åŸåˆ™ã€ é‡Œæ°æ›¿æ¢ã€ æ¥å£éš”ç¦»ä»¥åŠä¾èµ–åè½¬ï¼‰ ã€‚ IDEA å®˜æ–¹æ–‡æ¡£çš„ä»£ç é‡æ„æ•™ç¨‹ ï¼š æ•™ä½ å¦‚ä½•ä½¿ç”¨ IDEA è¿›è¡Œé‡æ„ã€‚ å‚è€ƒ # å†è¯»ã€Šé‡æ„ã€‹- ThoughtWorks æ´è§ - 2020 ï¼šè¯¦ç»†ä»‹ç»äº†é‡æ„çš„è¦ç‚¹æ¯”å¦‚å°æ­¥é‡æ„ã€æ¡åƒåœ¾å¼çš„é‡æ„ï¼Œä¸»è¦æ˜¯é‡æ„æ¦‚å¿µç›¸å…³çš„ä»‹ç»ã€‚ å¸¸è§ä»£ç é‡æ„æŠ€å·§ - VectorJin - 2021 ï¼šä»è½¯ä»¶è®¾è®¡åŸåˆ™ã€è®¾è®¡æ¨¡å¼ã€ä»£ç åˆ†å±‚ã€å‘½åè§„èŒƒç­‰è§’åº¦ä»‹ç»äº†å¦‚ä½•è¿›è¡Œé‡æ„ï¼Œæ¯”è¾ƒåå®æˆ˜ã€‚ "},{"id":67,"href":"/zh/docs/study/Review/java_guide/lycly_system-design/basis/naming/","title":"ä»£ç å‘½åæŒ‡å—","section":"åŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\næˆ‘è¿˜è®°å¾—æˆ‘åˆšå·¥ä½œé‚£ä¸€æ®µæ—¶é—´ï¼Œ é¡¹ç›® Code Review çš„æ—¶å€™ï¼Œæˆ‘ç»å¸¸å› ä¸ºå˜é‡å‘½åä¸è§„èŒƒè€Œè¢« â€œdissâ€!\nç©¶å…¶åŸå› è¿˜æ˜¯è‡ªå·±é‚£ä¼šç»éªŒä¸è¶³ï¼Œè€Œä¸”ï¼Œå¤§å­¦é‚£ä¼šå†™é¡¹ç›®çš„æ—¶å€™ä¸å¤ªæ³¨æ„è¿™äº›é—®é¢˜ï¼Œæƒ³ç€åªè¦æŠŠåŠŸèƒ½å®ç°å‡ºæ¥å°±è¡Œäº†ã€‚\nä½†æ˜¯ï¼Œå·¥ä½œä¸­å°±ä¸ä¸€æ ·ï¼Œä¸ºäº†ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§ï¼Œé¡¹ç›®ç»„å¯¹äºä»£ç è´¨é‡çš„è¦æ±‚è¿˜æ˜¯å¾ˆé«˜çš„ï¼\nå‰æ®µæ—¶é—´ï¼Œé¡¹ç›®ç»„æ–°æ¥çš„ä¸€ä¸ªå®ä¹ ç”Ÿä¹Ÿç»å¸¸åœ¨ Code Review å› ä¸ºå˜é‡å‘½åä¸è§„èŒƒè€Œè¢« â€œdissâ€ï¼Œè¿™è®©æˆ‘æƒ³åˆ°è‡ªå·±åˆšåˆ°å…¬å¸å†™ä»£ç é‚£ä¼šçš„æ—¥å­ã€‚\näºæ˜¯ï¼Œæˆ‘å°±ç®€å•å†™äº†è¿™ç¯‡å…³äºå˜é‡å‘½åè§„èŒƒçš„æ–‡ç« ï¼Œå¸Œæœ›èƒ½å¯¹åŒæ ·æœ‰æ­¤å›°æ‰°çš„å°ä¼™ä¼´æä¾›ä¸€äº›å¸®åŠ©ã€‚\nç¡®å®ï¼Œç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œæœ‰å¤ªå¤šå¤ªå¤šè®©æˆ‘ä»¬å¤´ç–¼çš„äº‹æƒ…äº†ï¼Œæ¯”å¦‚å‘½åã€ç»´æŠ¤å…¶ä»–äººçš„ä»£ç ã€å†™æµ‹è¯•ã€ä¸å…¶ä»–äººæ²Ÿé€šäº¤æµç­‰ç­‰ã€‚\næ®è¯´ä¹‹å‰åœ¨ Quora ç½‘ç«™ï¼Œç”±æ¥è¿‘ 5000 åç¨‹åºå‘˜ç¥¨é€‰å‡ºæ¥çš„æœ€éš¾çš„äº‹æƒ…å°±æ˜¯â€œå‘½åâ€ã€‚\nå¤§åé¼é¼çš„ã€Šé‡æ„ã€‹çš„ä½œè€…è€é©¬ï¼ˆMartin Fowlerï¼‰æ›¾ç»åœ¨TwoHardThingsè¿™ç¯‡æ–‡ç« ä¸­æåˆ°è¿‡CS é¢†åŸŸæœ‰ä¸¤å¤§æœ€éš¾çš„äº‹æƒ…ï¼šä¸€æ˜¯ ç¼“å­˜å¤±æ•ˆ ï¼Œä¸€æ˜¯ ç¨‹åºå‘½å ã€‚\nè¿™ä¸ªå¥è¯å®é™…ä¸Šä¹Ÿæ˜¯è€é©¬å¼•ç”¨åˆ«äººçš„ï¼Œç±»ä¼¼çš„è¡¨è¾¾è¿˜æœ‰å¾ˆå¤šã€‚æ¯”å¦‚åˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸæœ‰ä¸¤å¤§æœ€éš¾çš„äº‹æƒ…ï¼šä¸€æ˜¯ ä¿è¯æ¶ˆæ¯é¡ºåº ï¼Œä¸€æ˜¯ ä¸¥æ ¼ä¸€æ¬¡ä¼ é€’ ã€‚\nä»Šå¤©å’±ä»¬å°±å•ç‹¬æ‹å‡º â€œå‘½åâ€ æ¥èŠèŠï¼\nè¿™ç¯‡æ–‡ç« é…åˆæˆ‘ä¹‹å‰å‘çš„ ã€Šç¼–ç  5 åˆ†é’Ÿï¼Œå‘½å 2 å°æ—¶ï¼Ÿå²ä¸Šæœ€å…¨çš„ Java å‘½åè§„èŒƒå‚è€ƒï¼ã€‹ è¿™ç¯‡æ–‡ç« é˜…è¯»æ•ˆæœæ›´ä½³å“¦ï¼\nä¸ºä»€ä¹ˆéœ€è¦é‡è§†å‘½åï¼Ÿ # å’±ä»¬éœ€è¦å…ˆææ‡‚ä¸ºä»€ä¹ˆè¦é‡è§†ç¼–ç¨‹ä¸­çš„å‘½åè¿™ä¸€è¡Œä¸ºï¼Œå®ƒå¯¹äºæˆ‘ä»¬çš„ç¼–ç å·¥ä½œæœ‰ç€ä»€ä¹ˆæ„ä¹‰ã€‚\nä¸ºä»€ä¹ˆå‘½åå¾ˆé‡è¦å‘¢ï¼Ÿ è¿™æ˜¯å› ä¸º å¥½çš„å‘½åå³æ˜¯æ³¨é‡Šï¼Œåˆ«äººä¸€çœ‹åˆ°ä½ çš„å‘½åå°±çŸ¥é“ä½ çš„å˜é‡ã€æ–¹æ³•æˆ–è€…ç±»æ˜¯åšä»€ä¹ˆçš„ï¼\nç®€å•æ¥è¯´å°±æ˜¯ åˆ«äººæ ¹æ®ä½ çš„å‘½åå°±èƒ½çŸ¥é“ä½ çš„ä»£ç è¦è¡¨è¾¾çš„æ„æ€ ï¼ˆä¸è¿‡ï¼Œå‰æè¿™ä¸ªäººä¹Ÿè¦æœ‰åŸºæœ¬çš„è‹±è¯­çŸ¥è¯†ï¼Œå¯¹äºä¸€äº›ç¼–ç¨‹ä¸­å¸¸è§çš„å•è¯æ¯”è¾ƒç†Ÿæ‚‰ï¼‰ã€‚\nç®€å•ä¸¾ä¸ªä¾‹å­è¯´æ˜ä¸€ä¸‹å‘½åçš„é‡è¦æ€§ã€‚\nã€ŠClean Codeã€‹è¿™æœ¬ä¹¦æ˜ç¡®æŒ‡å‡ºï¼š\nå¥½çš„ä»£ç æœ¬èº«å°±æ˜¯æ³¨é‡Šï¼Œæˆ‘ä»¬è¦å°½é‡è§„èŒƒå’Œç¾åŒ–è‡ªå·±çš„ä»£ç æ¥å‡å°‘ä¸å¿…è¦çš„æ³¨é‡Šã€‚\nè‹¥ç¼–ç¨‹è¯­è¨€è¶³å¤Ÿæœ‰è¡¨è¾¾åŠ›ï¼Œå°±ä¸éœ€è¦æ³¨é‡Šï¼Œå°½é‡é€šè¿‡ä»£ç æ¥é˜è¿°ã€‚\nä¸¾ä¸ªä¾‹å­ï¼š\nå»æ‰ä¸‹é¢å¤æ‚çš„æ³¨é‡Šï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªä¸æ³¨é‡Šæ‰€è¨€åŒä¸€äº‹ç‰©çš„å‡½æ•°å³å¯\n// check to see if the employee is eligible for full benefits if ((employee.flags \u0026amp; HOURLY_FLAG) \u0026amp;\u0026amp; (employee.age \u0026gt; 65)) åº”æ›¿æ¢ä¸º\nif (employee.isEligibleForFullBenefits()) å¸¸è§å‘½åè§„åˆ™ä»¥åŠé€‚ç”¨åœºæ™¯ # è¿™é‡Œåªä»‹ç» 3 ç§æœ€å¸¸è§çš„å‘½åè§„èŒƒã€‚\né©¼å³°å‘½åæ³•ï¼ˆCamelCaseï¼‰ # é©¼å³°å‘½åæ³•åº”è¯¥æˆ‘ä»¬æœ€å¸¸è§çš„ä¸€ä¸ªï¼Œè¿™ç§å‘½åæ–¹å¼ä½¿ç”¨å¤§å°å†™æ··åˆçš„æ ¼å¼æ¥åŒºåˆ«å„ä¸ªå•è¯ï¼Œå¹¶ä¸”å•è¯ä¹‹é—´ä¸ä½¿ç”¨ç©ºæ ¼éš”å¼€æˆ–è€…è¿æ¥å­—ç¬¦è¿æ¥çš„å‘½åæ–¹å¼\nå¤§é©¼å³°å‘½åæ³•ï¼ˆUpperCamelCaseï¼‰ # ç±»åéœ€è¦ä½¿ç”¨å¤§é©¼å³°å‘½åæ³•ï¼ˆUpperCamelCaseï¼‰\næ­£ä¾‹ï¼š\nServiceDiscoveryã€ServiceInstanceã€LruCacheFactory åä¾‹ï¼š\nserviceDiscoveryã€Serviceinstanceã€LRUCacheFactory å°é©¼å³°å‘½åæ³•ï¼ˆlowerCamelCaseï¼‰ # æ–¹æ³•åã€å‚æ•°åã€æˆå‘˜å˜é‡ã€å±€éƒ¨å˜é‡éœ€è¦ä½¿ç”¨å°é©¼å³°å‘½åæ³•ï¼ˆlowerCamelCaseï¼‰ã€‚\næ­£ä¾‹ï¼š\ngetUserInfo() createCustomThreadPool() setNameFormat(String nameFormat) Uservice userService; åä¾‹ï¼š\nGetUserInfo()ã€CreateCustomThreadPool()ã€setNameFormat(String NameFormat) Uservice user_service è›‡å½¢å‘½åæ³•ï¼ˆsnake_caseï¼‰ # æµ‹è¯•æ–¹æ³•åã€å¸¸é‡ã€æšä¸¾åç§°éœ€è¦ä½¿ç”¨è›‡å½¢å‘½åæ³•ï¼ˆsnake_caseï¼‰\nåœ¨è›‡å½¢å‘½åæ³•ä¸­ï¼Œå„ä¸ªå•è¯ä¹‹é—´é€šè¿‡**ä¸‹åˆ’çº¿â€œ_â€**è¿æ¥ï¼Œæ¯”å¦‚should_get_200_status_code_when_request_is_validã€CLIENT_CONNECT_SERVER_FAILUREã€‚\nè›‡å½¢å‘½åæ³•çš„ä¼˜åŠ¿æ˜¯å‘½åæ‰€éœ€è¦çš„å•è¯æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œæ¯”å¦‚æˆ‘æŠŠä¸Šé¢çš„å‘½åé€šè¿‡å°é©¼å³°å‘½åæ³•ç»™å¤§å®¶çœ‹ä¸€ä¸‹ï¼šâ€œshouldGet200StatusCodeWhenRequestIsValidâ€ã€‚\næ„Ÿè§‰å¦‚ä½•ï¼Ÿ ç›¸æ¯”äºä½¿ç”¨è›‡å½¢å‘½åæ³•ï¼ˆsnake_caseï¼‰æ¥è¯´æ˜¯ä¸æ˜¯ä¸é‚£ä¹ˆæ˜“è¯»ï¼Ÿ\næ­£ä¾‹ï¼š\n@Test void should_get_200_status_code_when_request_is_valid() { ...... } åä¾‹ï¼š\n@Test void shouldGet200StatusCodeWhenRequestIsValid() { ...... } ä¸²å¼å‘½åæ³•ï¼ˆkebab-caseï¼‰ # åœ¨ä¸²å¼å‘½åæ³•ä¸­ï¼Œå„ä¸ªå•è¯ä¹‹é—´é€šè¿‡è¿æ¥ç¬¦â€œ-â€è¿æ¥ï¼Œæ¯”å¦‚dubbo-registryã€‚\nå»ºè®®é¡¹ç›®æ–‡ä»¶å¤¹åç§°ä½¿ç”¨ä¸²å¼å‘½åæ³•ï¼ˆkebab-caseï¼‰ï¼Œæ¯”å¦‚ dubbo é¡¹ç›®çš„å„ä¸ªæ¨¡å—çš„å‘½åæ˜¯ä¸‹é¢è¿™æ ·çš„ã€‚\nå¸¸è§å‘½åè§„èŒƒ # Java è¯­è¨€åŸºæœ¬å‘½åè§„èŒƒ # 1ã€ç±»åéœ€è¦ä½¿ç”¨å¤§é©¼å³°å‘½åæ³•ï¼ˆUpperCamelCaseï¼‰é£æ ¼ã€‚æ–¹æ³•åã€å‚æ•°åã€æˆå‘˜å˜é‡ã€å±€éƒ¨å˜é‡éœ€è¦ä½¿ç”¨å°é©¼å³°å‘½åæ³•ï¼ˆlowerCamelCaseï¼‰ã€‚\n2ã€æµ‹è¯•æ–¹æ³•åã€å¸¸é‡ã€æšä¸¾åç§°éœ€è¦ä½¿ç”¨è›‡å½¢å‘½åæ³•ï¼ˆsnake_caseï¼‰ï¼Œæ¯”å¦‚should_get_200_status_code_when_request_is_validã€CLIENT_CONNECT_SERVER_FAILUREã€‚å¹¶ä¸”ï¼Œæµ‹è¯•æ–¹æ³•åç§°è¦æ±‚å…¨éƒ¨å°å†™ï¼Œå¸¸é‡ä»¥åŠæšä¸¾åç§°éœ€è¦å…¨éƒ¨å¤§å†™ã€‚\n3ã€é¡¹ç›®æ–‡ä»¶å¤¹åç§°ä½¿ç”¨ä¸²å¼å‘½åæ³•ï¼ˆkebab-caseï¼‰ï¼Œæ¯”å¦‚dubbo-registryã€‚\n4ã€åŒ…åç»Ÿä¸€ä½¿ç”¨å°å†™ï¼Œå°½é‡ä½¿ç”¨å•ä¸ªåè¯ä½œä¸ºåŒ…åï¼Œå„ä¸ªå•è¯é€šè¿‡ \u0026ldquo;.\u0026rdquo; åˆ†éš”ç¬¦è¿æ¥ï¼Œå¹¶ä¸”å„ä¸ªå•è¯å¿…é¡»ä¸ºå•æ•°ã€‚\næ­£ä¾‹ï¼š org.apache.dubbo.common.threadlocal\nåä¾‹ï¼š org.apache_dubbo.Common.threadLocals\n5ã€æŠ½è±¡ç±»å‘½åä½¿ç”¨ Abstract å¼€å¤´ã€‚\n//ä¸ºè¿œç¨‹ä¼ è¾“éƒ¨åˆ†æŠ½è±¡å‡ºæ¥çš„ä¸€ä¸ªæŠ½è±¡ç±»ï¼ˆå‡ºå¤„ï¼šDubboæºç ï¼‰ public abstract class AbstractClient extends AbstractEndpoint implements Client { } 6ã€å¼‚å¸¸ç±»å‘½åä½¿ç”¨ Exception ç»“å°¾ã€‚\n//è‡ªå®šä¹‰çš„ NoSuchMethodExceptionï¼ˆå‡ºå¤„ï¼šDubboæºç ï¼‰ public class NoSuchMethodException extends RuntimeException { private static final long serialVersionUID = -2725364246023268766L; public NoSuchMethodException() { super(); } public NoSuchMethodException(String msg) { super(msg); } } 7ã€æµ‹è¯•ç±»å‘½åä»¥å®ƒè¦æµ‹è¯•çš„ç±»çš„åç§°å¼€å§‹ï¼Œä»¥ Test ç»“å°¾ã€‚\n//ä¸º AnnotationUtils ç±»å†™çš„æµ‹è¯•ç±»ï¼ˆå‡ºå¤„ï¼šDubboæºç ï¼‰ public class AnnotationUtilsTest { ...... } POJO ç±»ä¸­å¸ƒå°”ç±»å‹çš„å˜é‡ï¼Œéƒ½ä¸è¦åŠ  is å‰ç¼€ï¼Œå¦åˆ™éƒ¨åˆ†æ¡†æ¶è§£æä¼šå¼•èµ·åºåˆ—åŒ–é”™è¯¯ã€‚\nå¦‚æœæ¨¡å—ã€æ¥å£ã€ç±»ã€æ–¹æ³•ä½¿ç”¨äº†è®¾è®¡æ¨¡å¼ï¼Œåœ¨å‘½åæ—¶éœ€ä½“ç°å‡ºå…·ä½“æ¨¡å¼ã€‚\nå‘½åæ˜“è¯»æ€§è§„èŒƒ # 1ã€ä¸ºäº†èƒ½è®©å‘½åæ›´åŠ æ˜“æ‡‚å’Œæ˜“è¯»ï¼Œå°½é‡ä¸è¦ç¼©å†™/ç®€å†™å•è¯ï¼Œé™¤éè¿™äº›å•è¯å·²ç»è¢«å…¬è®¤å¯ä»¥è¢«è¿™æ ·ç¼©å†™/ç®€å†™ã€‚æ¯”å¦‚ CustomThreadFactory ä¸å¯ä»¥è¢«å†™æˆ ~~CustomTF ã€‚\n2ã€å‘½åä¸åƒå‡½æ•°ä¸€æ ·è¦å°½é‡è¿½æ±‚çŸ­ï¼Œå¯è¯»æ€§å¼ºçš„åå­—ä¼˜å…ˆäºç®€çŸ­çš„åå­—ï¼Œè™½ç„¶å¯è¯»æ€§å¼ºçš„åå­—ä¼šæ¯”è¾ƒé•¿ä¸€ç‚¹ã€‚ è¿™ä¸ªå¯¹åº”æˆ‘ä»¬ä¸Šé¢è¯´çš„ç¬¬ 1 ç‚¹ã€‚\n3ã€é¿å…æ— æ„ä¹‰çš„å‘½åï¼Œä½ èµ·çš„æ¯ä¸€ä¸ªåå­—éƒ½è¦èƒ½è¡¨æ˜æ„æ€ã€‚\næ­£ä¾‹ï¼šUserService userService; int userCount;\nåä¾‹: UserService service int count\n4ã€é¿å…å‘½åè¿‡é•¿ï¼ˆ50 ä¸ªå­—ç¬¦ä»¥å†…æœ€å¥½ï¼‰ï¼Œè¿‡é•¿çš„å‘½åéš¾ä»¥é˜…è¯»å¹¶ä¸”ä¸‘é™‹ã€‚\n5ã€ä¸è¦ä½¿ç”¨æ‹¼éŸ³ï¼Œæ›´ä¸è¦ä½¿ç”¨ä¸­æ–‡ã€‚ ä¸è¿‡åƒ alibaba ã€wuhanã€taobao è¿™ç§å›½é™…é€šç”¨åè¯å¯ä»¥å½“åšè‹±æ–‡æ¥çœ‹å¾…ã€‚\næ­£ä¾‹ï¼šdiscount\nåä¾‹ï¼šdazhe\nCodelf:å˜é‡å‘½åç¥å™¨? # è¿™æ˜¯ä¸€ä¸ªç”±å›½äººå¼€å‘çš„ç½‘ç«™ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šäººç§°å…¶ä¸ºå˜é‡å‘½åç¥å™¨ï¼Œ æˆ‘åœ¨å®é™…ä½¿ç”¨äº†å‡ å¤©ä¹‹åæ„Ÿè§‰æ²¡é‚£ä¹ˆå¥½ç”¨ã€‚å°ä¼™ä¼´ä»¬å¯ä»¥è‡ªè¡Œä½“éªŒä¸€ä¸‹ï¼Œç„¶åå†ç»™å‡ºè‡ªå·±çš„åˆ¤æ–­ã€‚\nCodelf æä¾›äº†åœ¨çº¿ç½‘ç«™ç‰ˆæœ¬ï¼Œç½‘å€ï¼šhttps://unbug.github.io/codelf/ï¼Œå…·ä½“ä½¿ç”¨æƒ…å†µå¦‚ä¸‹ï¼š\næˆ‘é€‰æ‹©äº† Java ç¼–ç¨‹è¯­è¨€ï¼Œç„¶åæœç´¢äº†â€œåºåˆ—åŒ–â€è¿™ä¸ªå…³é”®è¯ï¼Œç„¶åå®ƒå°±è¿”å›äº†å¾ˆå¤šå…³äºåºåˆ—åŒ–çš„å‘½åã€‚\nå¹¶ä¸”ï¼ŒCodelf è¿˜æä¾›äº† VS code æ’ä»¶ï¼Œçœ‹è¿™ä¸ªè¯„ä»·ï¼Œçœ‹æ¥å¤§å®¶è¿˜æ˜¯å¾ˆå–œæ¬¢è¿™æ¬¾å‘½åå·¥å…·çš„ã€‚\nç›¸å…³é˜…è¯»æ¨è # ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹ ã€ŠClean Codeã€‹ Google Java ä»£ç æŒ‡å—ï¼šhttps://google.github.io/styleguide/javaguide.html å‘Šåˆ«ç¼–ç 5åˆ†é’Ÿï¼Œå‘½å2å°æ—¶ï¼å²ä¸Šæœ€å…¨çš„Javaå‘½åè§„èŒƒå‚è€ƒï¼šhttps://www.cnblogs.com/liqiangchn/p/12000361.html æ€»ç»“ # ä½œä¸ºä¸€ä¸ªåˆæ ¼çš„ç¨‹åºå‘˜ï¼Œå°ä¼™ä¼´ä»¬åº”è¯¥éƒ½çŸ¥é“ä»£ç è¡¨ä¹‰çš„é‡è¦æ€§ã€‚æƒ³è¦å†™å‡ºé«˜è´¨é‡ä»£ç ï¼Œå¥½çš„å‘½åå°±æ˜¯ç¬¬ä¸€æ­¥ï¼\nå¥½çš„å‘½åå¯¹äºå…¶ä»–äººï¼ˆåŒ…æ‹¬ä½ è‡ªå·±ï¼‰ç†è§£ä½ çš„ä»£ç æœ‰ç€å¾ˆå¤§çš„å¸®åŠ©ï¼ä½ çš„ä»£ç è¶Šå®¹æ˜“è¢«ç†è§£ï¼Œå¯ç»´æŠ¤æ€§å°±è¶Šå¼ºï¼Œä¾§é¢ä¹Ÿå°±è¯´æ˜ä½ çš„ä»£ç è®¾è®¡çš„ä¹Ÿå°±è¶Šå¥½ï¼\nåœ¨æ—¥å¸¸ç¼–ç è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è°¨è®°å¸¸è§å‘½åè§„èŒƒæ¯”å¦‚ç±»åéœ€è¦ä½¿ç”¨å¤§é©¼å³°å‘½åæ³•ã€ä¸è¦ä½¿ç”¨æ‹¼éŸ³ï¼Œæ›´ä¸è¦ä½¿ç”¨ä¸­æ–‡\u0026hellip;\u0026hellip;ã€‚\nå¦å¤–ï¼Œå›½äººå¼€å‘çš„ä¸€ä¸ªå«åš Codelf çš„ç½‘ç«™è¢«å¾ˆå¤šäººç§°ä¸ºâ€œå˜é‡å‘½åç¥å™¨â€ï¼Œå½“ä½ ä¸ºå‘½åè€Œå¤´ç–¼çš„æ—¶å€™ï¼Œä½ å¯ä»¥å»å‚è€ƒä¸€ä¸‹ä¸Šé¢æä¾›çš„ä¸€äº›å‘½åç¤ºä¾‹ã€‚\næœ€åï¼Œç¥æ„¿å¤§å®¶éƒ½ä¸ç”¨å†ä¸ºå‘½åè€Œå›°æ‰°!\n"},{"id":68,"href":"/zh/docs/study/Review/java_guide/lycly_system-design/basis/software-engineering/","title":"è½¯ä»¶å·¥ç¨‹ç®€æ˜æ•™ç¨‹","section":"åŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nå¤§éƒ¨åˆ†è½¯ä»¶å¼€å‘ä»ä¸šè€…ï¼Œéƒ½ä¼šå¿½ç•¥è½¯ä»¶å¼€å‘ä¸­çš„ä¸€äº›æœ€åŸºç¡€ã€æœ€åº•å±‚çš„ä¸€äº›æ¦‚å¿µã€‚ä½†æ˜¯ï¼Œè¿™äº›è½¯ä»¶å¼€å‘çš„æ¦‚å¿µå¯¹äºè½¯ä»¶å¼€å‘æ¥è¯´éå¸¸é‡è¦ï¼Œå°±åƒæ˜¯è½¯ä»¶å¼€å‘çš„åŸºçŸ³ä¸€æ ·ã€‚è¿™ä¹Ÿæ˜¯æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„åŸå› ã€‚\nä½•ä¸ºè½¯ä»¶å·¥ç¨‹ï¼Ÿ # 1968 å¹´ NATOï¼ˆåŒ—å¤§è¥¿æ´‹å…¬çº¦ç»„ç»‡ï¼‰æå‡ºäº†è½¯ä»¶å±æœºï¼ˆSoftware crisisï¼‰ä¸€è¯ã€‚åŒå¹´ï¼Œä¸ºäº†è§£å†³è½¯ä»¶å±æœºé—®é¢˜ï¼Œâ€œè½¯ä»¶å·¥ç¨‹â€çš„æ¦‚å¿µè¯ç”Ÿäº†ã€‚ä¸€é—¨å«åšè½¯ä»¶å·¥ç¨‹çš„å­¦ç§‘ä¹Ÿå°±åº”è¿è€Œç”Ÿã€‚\néšç€æ—¶é—´çš„æ¨ç§»ï¼Œè½¯ä»¶å·¥ç¨‹è¿™é—¨å­¦ç§‘ä¹Ÿç»å†äº†ä¸€è½®åˆä¸€è½®çš„å®Œå–„ï¼Œå…¶ä¸­çš„ä¸€äº›æ ¸å¿ƒå†…å®¹æ¯”å¦‚è½¯ä»¶å¼€å‘æ¨¡å‹è¶Šæ¥è¶Šä¸°å¯Œå®ç”¨ï¼\nä»€ä¹ˆæ˜¯è½¯ä»¶å±æœºå‘¢ï¼Ÿ\nç®€å•æ¥è¯´ï¼Œè½¯ä»¶å±æœºæè¿°äº†å½“æ—¶è½¯ä»¶å¼€å‘çš„ä¸€ä¸ªç—›ç‚¹ï¼šæˆ‘ä»¬å¾ˆéš¾é«˜æ•ˆåœ°å¼€å‘å‡ºè´¨é‡é«˜çš„è½¯ä»¶ã€‚\nDijkstraï¼ˆDijkstraç®—æ³•çš„ä½œè€…ï¼‰ åœ¨ 1972å¹´å›¾çµå¥–è·å¥–æ„Ÿè¨€ä¸­ä¹Ÿæé«˜è¿‡è½¯ä»¶å±æœºï¼Œä»–æ˜¯è¿™æ ·è¯´çš„ï¼šâ€œå¯¼è‡´è½¯ä»¶å±æœºçš„ä¸»è¦åŸå› æ˜¯æœºå™¨å˜å¾—åŠŸèƒ½å¼ºå¤§äº†å‡ ä¸ªæ•°é‡çº§ï¼å¦ç‡åœ°è¯´ï¼šåªè¦æ²¡æœ‰æœºå™¨ï¼Œç¼–ç¨‹å°±å®Œå…¨æ²¡æœ‰é—®é¢˜ã€‚å½“æˆ‘ä»¬æœ‰ä¸€äº›å¼±å°çš„è®¡ç®—æœºæ—¶ï¼Œç¼–ç¨‹æˆä¸ºä¸€ä¸ªæ¸©å’Œçš„é—®é¢˜ï¼Œè€Œç°åœ¨æˆ‘ä»¬æœ‰äº†åºå¤§çš„è®¡ç®—æœºï¼Œç¼–ç¨‹ä¹ŸåŒæ ·æˆä¸ºä¸€ä¸ªå·¨å¤§çš„é—®é¢˜â€ã€‚\nè¯´äº†è¿™ä¹ˆå¤šï¼Œåˆ°åº•ä»€ä¹ˆæ˜¯è½¯ä»¶å·¥ç¨‹å‘¢ï¼Ÿ\nå·¥ç¨‹æ˜¯ä¸ºäº†è§£å†³å®é™…çš„é—®é¢˜å°†ç†è®ºåº”ç”¨äºå®è·µã€‚è½¯ä»¶å·¥ç¨‹æŒ‡çš„å°±æ˜¯å°†å·¥ç¨‹æ€æƒ³åº”ç”¨äºè½¯ä»¶å¼€å‘ã€‚\nä¸Šé¢æ˜¯æˆ‘å¯¹è½¯ä»¶å·¥ç¨‹çš„å®šä¹‰ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹æ¯”è¾ƒæƒå¨çš„å®šä¹‰ã€‚IEEE è½¯ä»¶å·¥ç¨‹æ±‡åˆŠç»™å‡ºçš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼šã€€(1)å°†ç³»ç»ŸåŒ–çš„ã€è§„èŒƒçš„ã€å¯é‡åŒ–çš„æ–¹æ³•åº”ç”¨åˆ°è½¯ä»¶çš„å¼€å‘ã€è¿è¡ŒåŠç»´æŠ¤ä¸­ï¼Œå³å°†å·¥ç¨‹åŒ–æ–¹æ³•åº”ç”¨äºè½¯ä»¶ã€‚ã€€(2)åœ¨(1)ä¸­æ‰€è¿°æ–¹æ³•çš„ç ”ç©¶ã€‚\næ€»ä¹‹ï¼Œè½¯ä»¶å·¥ç¨‹çš„ç»ˆæç›®æ ‡å°±æ˜¯ï¼šåœ¨æ›´å°‘èµ„æºæ¶ˆè€—çš„æƒ…å†µä¸‹ï¼Œåˆ›é€ å‡ºæ›´å¥½ã€æ›´å®¹æ˜“ç»´æŠ¤çš„è½¯ä»¶ã€‚\nè½¯ä»¶å¼€å‘è¿‡ç¨‹ # ç»´åŸºç™¾ç§‘æ˜¯è¿™æ ·å®šä¹‰è½¯ä»¶å¼€å‘è¿‡ç¨‹çš„ï¼š\nè½¯ä»¶å¼€å‘è¿‡ç¨‹ï¼ˆè‹±è¯­ï¼šsoftware development processï¼‰ï¼Œæˆ–è½¯ä»¶è¿‡ç¨‹ï¼ˆè‹±è¯­ï¼šsoftware processï¼‰ï¼Œæ˜¯è½¯ä»¶å¼€å‘çš„å¼€å‘ç”Ÿå‘½å‘¨æœŸï¼ˆsoftware development life cycleï¼‰ï¼Œå…¶å„ä¸ªé˜¶æ®µå®ç°äº†è½¯ä»¶çš„éœ€æ±‚å®šä¹‰ä¸åˆ†æã€è®¾è®¡ã€å®ç°ã€æµ‹è¯•ã€äº¤ä»˜å’Œç»´æŠ¤ã€‚è½¯ä»¶è¿‡ç¨‹æ˜¯åœ¨å¼€å‘ä¸æ„å»ºç³»ç»Ÿæ—¶åº”éµå¾ªçš„æ­¥éª¤ï¼Œæ˜¯è½¯ä»¶å¼€å‘çš„è·¯çº¿å›¾ã€‚\néœ€æ±‚åˆ†æ ï¼šåˆ†æç”¨æˆ·çš„éœ€æ±‚ï¼Œå»ºç«‹é€»è¾‘æ¨¡å‹ã€‚ è½¯ä»¶è®¾è®¡ ï¼š æ ¹æ®éœ€æ±‚åˆ†æçš„ç»“æœå¯¹è½¯ä»¶æ¶æ„è¿›è¡Œè®¾è®¡ã€‚ ç¼–ç  ï¼šç¼–å†™ç¨‹åºè¿è¡Œçš„æºä»£ç ã€‚ æµ‹è¯• : ç¡®å®šæµ‹è¯•ç”¨ä¾‹ï¼Œç¼–å†™æµ‹è¯•æŠ¥å‘Šã€‚ äº¤ä»˜ ï¼šå°†åšå¥½çš„è½¯ä»¶äº¤ä»˜ç»™å®¢æˆ·ã€‚ ç»´æŠ¤ ï¼šå¯¹è½¯ä»¶è¿›è¡Œç»´æŠ¤æ¯”å¦‚è§£å†³ bugï¼Œå®Œå–„åŠŸèƒ½ã€‚ è½¯ä»¶å¼€å‘è¿‡ç¨‹åªæ˜¯æ¯”è¾ƒç¬¼ç»Ÿçš„å±‚é¢ä¸Šï¼Œä¸€å®šä¹‰äº†ä¸€ä¸ªè½¯ä»¶å¼€å‘å¯èƒ½æ¶‰åŠåˆ°çš„ä¸€äº›æµç¨‹ã€‚\nè½¯ä»¶å¼€å‘æ¨¡å‹æ›´å…·ä½“åœ°å®šä¹‰äº†è½¯ä»¶å¼€å‘è¿‡ç¨‹ï¼Œå¯¹å¼€å‘è¿‡ç¨‹æä¾›äº†å¼ºæœ‰åŠ›çš„ç†è®ºæ”¯æŒã€‚\nè½¯ä»¶å¼€å‘æ¨¡å‹ # è½¯ä»¶å¼€å‘æ¨¡å‹æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚ç€‘å¸ƒæ¨¡å‹ï¼ˆWaterfall Modelï¼‰ã€å¿«é€ŸåŸå‹æ¨¡å‹ï¼ˆRapid Prototype Modelï¼‰ã€Væ¨¡å‹ï¼ˆV-modelï¼‰ã€Wæ¨¡å‹ï¼ˆW-modelï¼‰ã€æ•æ·å¼€å‘æ¨¡å‹ã€‚å…¶ä¸­æœ€å…·æœ‰ä»£è¡¨æ€§çš„è¿˜æ˜¯ ç€‘å¸ƒæ¨¡å‹ å’Œ æ•æ·å¼€å‘ ã€‚\nç€‘å¸ƒæ¨¡å‹ å®šä¹‰äº†ä¸€å¥—å®Œæˆçš„è½¯ä»¶å¼€å‘å‘¨æœŸï¼Œå®Œæ•´åœ°å±•ç¤ºäº†ä¸€ä¸ªè½¯ä»¶çš„çš„ç”Ÿå‘½å‘¨æœŸã€‚\næ•æ·å¼€å‘æ¨¡å‹ æ˜¯ç›®å‰ä½¿ç”¨çš„æœ€å¤šçš„ä¸€ç§è½¯ä»¶å¼€å‘æ¨¡å‹ã€‚MBAæ™ºåº“ç™¾ç§‘å¯¹æ•æ·å¼€å‘çš„æè¿°æ˜¯è¿™æ ·çš„:\næ•æ·å¼€å‘ æ˜¯ä¸€ç§ä»¥äººä¸ºæ ¸å¿ƒã€è¿­ä»£ã€å¾ªåºæ¸è¿›çš„å¼€å‘æ–¹æ³•ã€‚åœ¨æ•æ·å¼€å‘ä¸­ï¼Œè½¯ä»¶é¡¹ç›®çš„æ„å»ºè¢«åˆ‡åˆ†æˆå¤šä¸ªå­é¡¹ç›®ï¼Œå„ä¸ªå­é¡¹ç›®çš„æˆæœéƒ½ç»è¿‡æµ‹è¯•ï¼Œå…·å¤‡é›†æˆå’Œå¯è¿è¡Œçš„ç‰¹å¾ã€‚æ¢è¨€ä¹‹ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªå¤§é¡¹ç›®åˆ†ä¸ºå¤šä¸ªç›¸äº’è”ç³»ï¼Œä½†ä¹Ÿå¯ç‹¬ç«‹è¿è¡Œçš„å°é¡¹ç›®ï¼Œå¹¶åˆ†åˆ«å®Œæˆï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­è½¯ä»¶ä¸€ç›´å¤„äºå¯ä½¿ç”¨çŠ¶æ€ã€‚\nåƒç°åœ¨æ¯”è¾ƒå¸¸è§çš„ä¸€äº›æ¦‚å¿µæ¯”å¦‚ æŒç»­é›†æˆ ã€é‡æ„ ã€å°ç‰ˆæœ¬å‘å¸ƒ ã€ä½æ–‡æ¡£ ã€ç«™ä¼š ã€ç»“å¯¹ç¼–ç¨‹ ã€æµ‹è¯•é©±åŠ¨å¼€å‘ éƒ½æ˜¯æ•æ·å¼€å‘çš„æ ¸å¿ƒã€‚\nè½¯ä»¶å¼€å‘çš„åŸºæœ¬ç­–ç•¥ # è½¯ä»¶å¤ç”¨ # æˆ‘ä»¬åœ¨æ„å»ºä¸€ä¸ªæ–°çš„è½¯ä»¶çš„æ—¶å€™ï¼Œä¸éœ€è¦ä»é›¶å¼€å§‹ï¼Œé€šè¿‡å¤ç”¨å·²æœ‰çš„ä¸€äº›è½®å­ï¼ˆæ¡†æ¶ã€ç¬¬ä¸‰æ–¹åº“ç­‰ï¼‰ã€è®¾è®¡æ¨¡å¼ã€è®¾è®¡åŸåˆ™ç­‰ç­‰ç°æˆçš„ç‰©æ–™ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¿«åœ°æ„å»ºå‡ºä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„è½¯ä»¶ã€‚\nåƒæˆ‘ä»¬å¹³æ—¶æ¥è§¦çš„å¼€æºé¡¹ç›®å°±æ˜¯æœ€å¥½çš„ä¾‹å­ã€‚æˆ‘æƒ³ï¼Œå¦‚æœä¸æ˜¯å¼€æºï¼Œæˆ‘ä»¬æ„å»ºå‡ºä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„è½¯ä»¶ï¼Œè€—è´¹çš„ç²¾åŠ›å’Œæ—¶é—´è¦æ¯”ç°åœ¨å¤šçš„å¤šï¼\nåˆ†è€Œæ²»ä¹‹ # æ„å»ºè½¯ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°å¾ˆå¤šé—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥å°†ä¸€äº›æ¯”è¾ƒå¤æ‚çš„é—®é¢˜æ‹†è§£ä¸ºä¸€äº›å°é—®é¢˜ï¼Œç„¶åï¼Œä¸€ä¸€æ”»å…‹ã€‚\næˆ‘ç»“åˆç°åœ¨æ¯”è¾ƒç«çš„è½¯ä»¶è®¾è®¡æ–¹æ³•â€”**é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDomain Driven Designï¼Œç®€ç§° DDDï¼‰**æ¥è¯´è¯´ã€‚\nåœ¨é¢†åŸŸé©±åŠ¨è®¾è®¡ä¸­ï¼Œå¾ˆé‡è¦çš„ä¸€ä¸ªæ¦‚å¿µå°±æ˜¯é¢†åŸŸï¼ˆDomainï¼‰ï¼Œå®ƒå°±æ˜¯æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜ã€‚åœ¨é¢†åŸŸé©±åŠ¨è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯æŠŠæ¯”è¾ƒå¤§çš„é¢†åŸŸï¼ˆé—®é¢˜ï¼‰æ‹†è§£ä¸ºè‹¥å¹²çš„å°é¢†åŸŸï¼ˆå­åŸŸï¼‰ã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œåˆ†è€Œæ²»ä¹‹ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„ç®—æ³•æ€æƒ³ï¼Œå¯¹åº”çš„å°±æ˜¯åˆ†æ²»ç®—æ³•ã€‚å¦‚æœä½ æƒ³äº†è§£åˆ†æ²»ç®—æ³•çš„è¯ï¼Œæ¨èä½ çœ‹ä¸€ä¸‹åŒ—å¤§çš„ã€Šç®—æ³•è®¾è®¡ä¸åˆ†æ Design and Analysis of Algorithmsã€‹ã€‚\né€æ­¥æ¼”è¿› # è½¯ä»¶å¼€å‘æ˜¯ä¸€ä¸ªé€æ­¥æ¼”è¿›çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸æ–­è¿›è¡Œè¿­ä»£å¼å¢é‡å¼€å‘ï¼Œæœ€ç»ˆäº¤ä»˜ç¬¦åˆå®¢æˆ·ä»·å€¼çš„äº§å“ã€‚\nè¿™é‡Œè¡¥å……ä¸€ä¸ªåœ¨è½¯ä»¶å¼€å‘é¢†åŸŸï¼Œéå¸¸é‡è¦çš„æ¦‚å¿µï¼šMVPï¼ˆMinimum Viable Productï¼Œæœ€å°å¯è¡Œäº§å“ï¼‰ã€‚\nè¿™ä¸ªæœ€å°å¯è¡Œäº§å“ï¼Œå¯ä»¥ç†è§£ä¸ºåˆšå¥½èƒ½å¤Ÿæ»¡è¶³å®¢æˆ·éœ€æ±‚çš„äº§å“ã€‚ä¸‹é¢è¿™å¼ å›¾ç‰‡æŠŠè¿™ä¸ªæ€æƒ³å±•ç¤ºçš„éå¸¸ç²¾é«“ã€‚\nåˆ©ç”¨æœ€å°å¯è¡Œäº§å“ï¼Œæˆ‘ä»¬å¯ä»¥ä¹Ÿå¯ä»¥ææ—©è¿›è¡Œå¸‚åœºåˆ†æï¼Œè¿™å¯¹äºæˆ‘ä»¬åœ¨æ¢ç´¢äº§å“ä¸ç¡®å®šæ€§çš„é“è·¯ä¸Šéå¸¸æœ‰å¸®åŠ©ã€‚å¯ä»¥éå¸¸æœ‰æ•ˆåœ°æŒ‡å¯¼æˆ‘ä»¬ä¸‹ä¸€æ­¥è¯¥å¾€å“ªé‡Œèµ°ã€‚\nä¼˜åŒ–æŠ˜ä¸­ # è½¯ä»¶å¼€å‘æ˜¯ä¸€ä¸ªä¸æ–­ä¼˜åŒ–æ”¹è¿›çš„è¿‡ç¨‹ã€‚ä»»ä½•è½¯ä»¶éƒ½æœ‰å¾ˆå¤šå¯ä»¥ä¼˜åŒ–çš„ç‚¹ï¼Œä¸å¯èƒ½å®Œç¾ã€‚æˆ‘ä»¬éœ€è¦ä¸æ–­æ”¹è¿›å’Œæå‡è½¯ä»¶çš„è´¨é‡ã€‚\nä½†æ˜¯ï¼Œä¹Ÿä¸è¦é™·å…¥è¿™ä¸ªæ€ªåœˆã€‚è¦å­¦ä¼šæŠ˜ä¸­ï¼Œåœ¨æœ‰é™çš„æŠ•å…¥å†…ï¼Œä»¥æœ€æœ‰æ•ˆçš„æ–¹å¼æé«˜ç°æœ‰è½¯ä»¶çš„è´¨é‡ã€‚\nå‚è€ƒ # è½¯ä»¶å·¥ç¨‹çš„åŸºæœ¬æ¦‚å¿µ-æ¸…åå¤§å­¦è½¯ä»¶å­¦é™¢ åˆ˜å¼ºï¼šhttps://www.xuetangx.com/course/THU08091000367 è½¯ä»¶å¼€å‘è¿‡ç¨‹-ç»´åŸºç™¾ç§‘ ï¼šhttps://zh.wikipedia.org/wiki/è½¯ä»¶å¼€å‘è¿‡ç¨‹ "},{"id":69,"href":"/zh/docs/study/Review/java_guide/lycly_system-design/basis/restful/","title":"restFul","section":"åŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nè¿™ç¯‡æ–‡ç« ç®€å•èŠèŠåç«¯ç¨‹åºå‘˜å¿…å¤‡çš„ RESTful API ç›¸å…³çš„çŸ¥è¯†ã€‚\nå¼€å§‹æ­£å¼ä»‹ç» RESTful API ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆææ¸… ï¼šAPI åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ\n# ä½•ä¸º APIï¼Ÿ # APIï¼ˆApplication Programming Interfaceï¼‰ ç¿»è¯‘è¿‡æ¥æ˜¯åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£çš„æ„æ€ã€‚\næˆ‘ä»¬åœ¨è¿›è¡Œåç«¯å¼€å‘çš„æ—¶å€™ï¼Œä¸»è¦çš„å·¥ä½œå°±æ˜¯ä¸ºå‰ç«¯æˆ–è€…å…¶ä»–åç«¯æœåŠ¡æä¾› API æ¯”å¦‚æŸ¥è¯¢ç”¨æˆ·æ•°æ®çš„ API ã€‚\nä½†æ˜¯ï¼Œ API ä¸ä»…ä»…ä»£è¡¨åç«¯ç³»ç»Ÿæš´éœ²çš„æ¥å£ï¼Œåƒæ¡†æ¶ä¸­æä¾›çš„æ–¹æ³•ä¹Ÿå±äº API çš„èŒƒç•´ã€‚\nä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£ï¼Œæˆ‘å†åˆ—ä¸¾å‡ ä¸ªä¾‹å­ ğŸŒ°ï¼š\nä½ é€šè¿‡æŸç”µå•†ç½‘ç«™æœç´¢æŸæŸå•†å“ï¼Œç”µå•†ç½‘ç«™çš„å‰ç«¯å°±è°ƒç”¨äº†åç«¯æä¾›äº†æœç´¢å•†å“ç›¸å…³çš„ APIã€‚ ä½ ä½¿ç”¨ JDK å¼€å‘ Java ç¨‹åºï¼Œæƒ³è¦è¯»å–ç”¨æˆ·çš„è¾“å…¥çš„è¯ï¼Œä½ å°±éœ€è¦ä½¿ç”¨ JDK æä¾›çš„ IO ç›¸å…³çš„ APIã€‚ \u0026hellip;\u0026hellip; ä½ å¯ä»¥æŠŠ API ç†è§£ä¸ºç¨‹åºä¸ç¨‹åºä¹‹é—´é€šä¿¡çš„æ¡¥æ¢ï¼Œå…¶æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå‡½æ•°è€Œå·²ã€‚å¦å¤–ï¼ŒAPI çš„ä½¿ç”¨ä¹Ÿä¸æ˜¯æ²¡æœ‰ç« æ³•çš„ï¼Œå®ƒçš„è§„åˆ™ç”±ï¼ˆæ¯”å¦‚æ•°æ®è¾“å…¥å’Œè¾“å‡ºçš„æ ¼å¼ï¼‰API æä¾›æ–¹åˆ¶å®šã€‚\n# ä½•ä¸º RESTful APIï¼Ÿ # RESTful API ç»å¸¸ä¹Ÿè¢«å«åš REST APIï¼Œå®ƒæ˜¯åŸºäº REST æ„å»ºçš„ APIã€‚è¿™ä¸ª REST åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬åæ–‡åœ¨è®²ï¼Œæ¶‰åŠåˆ°çš„æ¦‚å¿µæ¯”è¾ƒå¤šã€‚\nå¦‚æœä½ çœ‹ RESTful API ç›¸å…³çš„æ–‡ç« çš„è¯ä¸€èˆ¬éƒ½æ¯”è¾ƒæ™¦æ¶©éš¾æ‡‚ï¼Œä¸»è¦æ˜¯å› ä¸º REST æ¶‰åŠåˆ°çš„ä¸€äº›æ¦‚å¿µæ¯”è¾ƒéš¾ä»¥ç†è§£ã€‚ä½†æ˜¯ï¼Œå®é™…ä¸Šï¼Œæˆ‘ä»¬å¹³æ—¶å¼€å‘ç”¨åˆ°çš„ RESTful API çš„çŸ¥è¯†éå¸¸ç®€å•ä¹Ÿå¾ˆå®¹æ˜“æ¦‚æ‹¬ï¼\nä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ç»™ä½ ä¸‹é¢ä¸¤ä¸ª API ä½ æ˜¯ä¸æ˜¯ç«‹é©¬èƒ½çŸ¥é“å®ƒä»¬æ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼è¿™å°±æ˜¯ RESTful API çš„å¼ºå¤§ä¹‹å¤„ï¼\nGET /classesï¼šåˆ—å‡ºæ‰€æœ‰ç­çº§ POST /classesï¼šæ–°å»ºä¸€ä¸ªç­çº§ RESTful API å¯ä»¥è®©ä½ çœ‹åˆ° URL+Http Method å°±çŸ¥é“è¿™ä¸ª URL æ˜¯å¹²ä»€ä¹ˆçš„ï¼Œè®©ä½ çœ‹åˆ°äº† HTTP çŠ¶æ€ç ï¼ˆstatus codeï¼‰å°±çŸ¥é“è¯·æ±‚ç»“æœå¦‚ä½•ã€‚\nåƒå’±ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­è®¾è®¡ API çš„æ—¶å€™ä¹Ÿåº”è¯¥è‡³å°‘è¦æ»¡è¶³ RESTful API çš„æœ€åŸºæœ¬çš„è¦æ±‚ï¼ˆæ¯”å¦‚æ¥å£ä¸­å°½é‡ä½¿ç”¨åè¯ï¼Œä½¿ç”¨ POST è¯·æ±‚åˆ›å»ºèµ„æºï¼ŒDELETE è¯·æ±‚åˆ é™¤èµ„æºç­‰ç­‰ï¼Œç¤ºä¾‹ï¼šGET /notes/idï¼šè·å–æŸä¸ªæŒ‡å®š id çš„ç¬”è®°çš„ä¿¡æ¯ï¼‰ã€‚\n# è§£è¯» REST # REST æ˜¯ REpresentational State Transfer çš„ç¼©å†™ã€‚è¿™ä¸ªè¯ç»„çš„ç¿»è¯‘è¿‡æ¥å°±æ˜¯â€œè¡¨ç°å±‚çŠ¶æ€è½¬åŒ–â€ã€‚\nè¿™æ ·ç†è§£èµ·æ¥ç”šæ˜¯æ™¦æ¶©ï¼Œå®é™…ä¸Š REST çš„å…¨ç§°æ˜¯ Resource Representational State Transfer ï¼Œç›´ç™½åœ°ç¿»è¯‘è¿‡æ¥å°±æ˜¯ â€œèµ„æºâ€åœ¨ç½‘ç»œä¼ è¾“ä¸­ä»¥æŸç§â€œè¡¨ç°å½¢å¼â€è¿›è¡Œâ€œçŠ¶æ€è½¬ç§»â€ ã€‚å¦‚æœè¿˜æ˜¯ä¸èƒ½ç»§ç»­ç†è§£ï¼Œè¯·ç»§ç»­å¾€ä¸‹çœ‹ï¼Œç›¸ä¿¡ä¸‹é¢çš„è®²è§£ä¸€å®šèƒ½è®©ä½ ç†è§£åˆ°åº•å•¥æ˜¯ REST ã€‚\næˆ‘ä»¬åˆ†åˆ«å¯¹ä¸Šé¢æ¶‰åŠåˆ°çš„æ¦‚å¿µè¿›è¡Œè§£è¯»ï¼Œä»¥ä¾¿åŠ æ·±ç†è§£ï¼Œå®é™…ä¸Šä½ ä¸éœ€è¦ææ‡‚ä¸‹é¢è¿™äº›æ¦‚å¿µï¼Œä¹Ÿèƒ½çœ‹æ‡‚æˆ‘ä¸‹ä¸€éƒ¨åˆ†è¦ä»‹ç»åˆ°çš„å†…å®¹ã€‚ä¸è¿‡ï¼Œä¸ºäº†æ›´å¥½åœ°èƒ½è·Ÿåˆ«äººæ‰¯æ‰¯ â€œRESTful APIâ€æˆ‘å»ºè®®ä½ è¿˜æ˜¯è¦å¥½å¥½ç†è§£ä¸€ä¸‹ï¼\nèµ„æºï¼ˆResourceï¼‰ ï¼šæˆ‘ä»¬å¯ä»¥æŠŠçœŸå®çš„å¯¹è±¡æ•°æ®ç§°ä¸ºèµ„æºã€‚ä¸€ä¸ªèµ„æºæ—¢å¯ä»¥æ˜¯ä¸€ä¸ªé›†åˆï¼Œä¹Ÿå¯ä»¥æ˜¯å•ä¸ªä¸ªä½“ã€‚æ¯”å¦‚æˆ‘ä»¬çš„ç­çº§ classes æ˜¯ä»£è¡¨ä¸€ä¸ªé›†åˆå½¢å¼çš„èµ„æºï¼Œè€Œç‰¹å®šçš„ class ä»£è¡¨å•ä¸ªä¸ªä½“èµ„æºã€‚æ¯ä¸€ç§èµ„æºéƒ½æœ‰ç‰¹å®šçš„ URIï¼ˆç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼‰ä¸ä¹‹å¯¹åº”ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è·å–è¿™ä¸ªèµ„æºï¼Œè®¿é—®è¿™ä¸ª URI å°±å¯ä»¥äº†ï¼Œæ¯”å¦‚è·å–ç‰¹å®šçš„ç­çº§ï¼š/class/12ã€‚å¦å¤–ï¼Œèµ„æºä¹Ÿå¯ä»¥åŒ…å«å­èµ„æºï¼Œæ¯”å¦‚ /classes/classId/teachersï¼šåˆ—å‡ºæŸä¸ªæŒ‡å®šç­çº§çš„æ‰€æœ‰è€å¸ˆçš„ä¿¡æ¯ è¡¨ç°å½¢å¼ï¼ˆRepresentationalï¼‰ï¼š\u0026ldquo;èµ„æº\u0026quot;æ˜¯ä¸€ç§ä¿¡æ¯å®ä½“ï¼Œå®ƒå¯ä»¥æœ‰å¤šç§å¤–åœ¨è¡¨ç°å½¢å¼ã€‚æˆ‘ä»¬æŠŠ\u0026quot;èµ„æº\u0026quot;å…·ä½“å‘ˆç°å‡ºæ¥çš„å½¢å¼æ¯”å¦‚ jsonï¼Œxmlï¼Œimage,txt ç­‰ç­‰å«åšå®ƒçš„**\u0026ldquo;è¡¨ç°å±‚/è¡¨ç°å½¢å¼\u0026rdquo;**ã€‚ çŠ¶æ€è½¬ç§»ï¼ˆState Transferï¼‰ ï¼šå¤§å®¶ç¬¬ä¸€çœ¼çœ‹åˆ°è¿™ä¸ªè¯è¯­ä¸€å®šä¼šå¾ˆæ‡µé€¼ï¼Ÿå†…å¿ƒ BBï¼šè¿™å°¼ç›æ˜¯å•¥å•Šï¼Ÿ å¤§ç™½è¯æ¥è¯´ REST ä¸­çš„çŠ¶æ€è½¬ç§»æ›´å¤šåœ°æè¿°çš„æœåŠ¡å™¨ç«¯èµ„æºçš„çŠ¶æ€ï¼Œæ¯”å¦‚ä½ é€šè¿‡å¢åˆ æ”¹æŸ¥ï¼ˆé€šè¿‡ HTTP åŠ¨è¯å®ç°ï¼‰å¼•èµ·èµ„æºçŠ¶æ€çš„æ”¹å˜ã€‚ps:äº’è”ç½‘é€šä¿¡åè®® HTTP åè®®ï¼Œæ˜¯ä¸€ä¸ªæ— çŠ¶æ€åè®®ï¼Œæ‰€æœ‰çš„èµ„æºçŠ¶æ€éƒ½ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ã€‚ ç»¼åˆä¸Šé¢çš„è§£é‡Šï¼Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ä»€ä¹ˆæ˜¯ RESTful æ¶æ„ï¼š\næ¯ä¸€ä¸ª URI ä»£è¡¨ä¸€ç§èµ„æºï¼› å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ï¼Œä¼ é€’è¿™ç§èµ„æºçš„æŸç§è¡¨ç°å½¢å¼æ¯”å¦‚ jsonï¼Œxmlï¼Œimage,txt ç­‰ç­‰ï¼› å®¢æˆ·ç«¯é€šè¿‡ç‰¹å®šçš„ HTTP åŠ¨è¯ï¼Œå¯¹æœåŠ¡å™¨ç«¯èµ„æºè¿›è¡Œæ“ä½œï¼Œå®ç°**\u0026ldquo;è¡¨ç°å±‚çŠ¶æ€è½¬åŒ–\u0026rdquo;**ã€‚ # RESTful API è§„èŒƒ # # åŠ¨ä½œ # GETï¼šè¯·æ±‚ä»æœåŠ¡å™¨è·å–ç‰¹å®šèµ„æºã€‚ä¸¾ä¸ªä¾‹å­ï¼šGET /classesï¼ˆè·å–æ‰€æœ‰ç­çº§ï¼‰ POST ï¼šåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„èµ„æºã€‚ä¸¾ä¸ªä¾‹å­ï¼šPOST /classesï¼ˆåˆ›å»ºç­çº§ï¼‰ PUT ï¼šæ›´æ–°æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ›´æ–°åçš„æ•´ä¸ªèµ„æºï¼‰ã€‚ä¸¾ä¸ªä¾‹å­ï¼šPUT /classes/12ï¼ˆæ›´æ–°ç¼–å·ä¸º 12 çš„ç­çº§ï¼‰ DELETE ï¼šä»æœåŠ¡å™¨åˆ é™¤ç‰¹å®šçš„èµ„æºã€‚ä¸¾ä¸ªä¾‹å­ï¼šDELETE /classes/12ï¼ˆåˆ é™¤ç¼–å·ä¸º 12 çš„ç­çº§ï¼‰ PATCH ï¼šæ›´æ–°æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ›´æ”¹çš„å±æ€§ï¼Œå¯ä»¥çœ‹åšä½œæ˜¯éƒ¨åˆ†æ›´æ–°ï¼‰ï¼Œä½¿ç”¨çš„æ¯”è¾ƒå°‘ï¼Œè¿™é‡Œå°±ä¸ä¸¾ä¾‹å­äº†ã€‚ # è·¯å¾„ï¼ˆæ¥å£å‘½åï¼‰ # è·¯å¾„åˆç§°\u0026quot;ç»ˆç‚¹\u0026rdquo;ï¼ˆendpointï¼‰ï¼Œè¡¨ç¤º API çš„å…·ä½“ç½‘å€ã€‚å®é™…å¼€å‘ä¸­å¸¸è§çš„è§„èŒƒå¦‚ä¸‹ï¼š\nç½‘å€ä¸­ä¸èƒ½æœ‰åŠ¨è¯ï¼Œåªèƒ½æœ‰åè¯ï¼ŒAPI ä¸­çš„åè¯ä¹Ÿåº”è¯¥ä½¿ç”¨å¤æ•°ã€‚ å› ä¸º REST ä¸­çš„èµ„æºå¾€å¾€å’Œæ•°æ®åº“ä¸­çš„è¡¨å¯¹åº”ï¼Œè€Œæ•°æ®åº“ä¸­çš„è¡¨éƒ½æ˜¯åŒç§è®°å½•çš„\u0026quot;é›†åˆ\u0026quot;ï¼ˆcollectionï¼‰ã€‚å¦‚æœ API è°ƒç”¨å¹¶ä¸æ¶‰åŠèµ„æºï¼ˆå¦‚è®¡ç®—ï¼Œç¿»è¯‘ç­‰æ“ä½œï¼‰çš„è¯ï¼Œå¯ä»¥ç”¨åŠ¨è¯ã€‚æ¯”å¦‚ï¼šGET /calculate?param1=11\u0026amp;param2=33 ã€‚ ä¸ç”¨å¤§å†™å­—æ¯ï¼Œå»ºè®®ç”¨ä¸­æ  - ä¸ç”¨ä¸‹æ  _ ã€‚æ¯”å¦‚é‚€è¯·ç å†™æˆ invitation-codeè€Œä¸æ˜¯ invitation_code ã€‚ å–„ç”¨ç‰ˆæœ¬åŒ– APIã€‚å½“æˆ‘ä»¬çš„ API å‘ç”Ÿäº†é‡å¤§æ”¹å˜è€Œä¸å…¼å®¹å‰æœŸç‰ˆæœ¬çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ URL æ¥å®ç°ç‰ˆæœ¬åŒ–ï¼Œæ¯”å¦‚ http://api.example.com/v1ã€http://apiv1.example.com ã€‚ç‰ˆæœ¬ä¸å¿…éè¦æ˜¯æ•°å­—ï¼Œåªæ˜¯æ•°å­—ç”¨çš„æœ€å¤šï¼Œæ—¥æœŸã€å­£èŠ‚éƒ½å¯ä»¥ä½œä¸ºç‰ˆæœ¬æ ‡è¯†ç¬¦ï¼Œé¡¹ç›®å›¢é˜Ÿè¾¾æˆå…±è¯†å°±å¯ã€‚ æ¥å£å°½é‡ä½¿ç”¨åè¯ï¼Œé¿å…ä½¿ç”¨åŠ¨è¯ã€‚ RESTful API æ“ä½œï¼ˆHTTP Methodï¼‰çš„æ˜¯èµ„æºï¼ˆåè¯ï¼‰è€Œä¸æ˜¯åŠ¨ä½œï¼ˆåŠ¨è¯ï¼‰ã€‚ Talk is cheapï¼æ¥ä¸¾ä¸ªå®é™…çš„ä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹å§ï¼ç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ª API æä¾›ç­çº§ï¼ˆclassï¼‰çš„ä¿¡æ¯ï¼Œè¿˜åŒ…æ‹¬ç­çº§ä¸­çš„å­¦ç”Ÿå’Œæ•™å¸ˆçš„ä¿¡æ¯ï¼Œåˆ™å®ƒçš„è·¯å¾„åº”è¯¥è®¾è®¡æˆä¸‹é¢è¿™æ ·ã€‚\nGET /classesï¼šåˆ—å‡ºæ‰€æœ‰ç­çº§ POST /classesï¼šæ–°å»ºä¸€ä¸ªç­çº§ GET /classes/{classId}ï¼šè·å–æŸä¸ªæŒ‡å®šç­çº§çš„ä¿¡æ¯ PUT /classes/{classId}ï¼šæ›´æ–°æŸä¸ªæŒ‡å®šç­çº§çš„ä¿¡æ¯ï¼ˆä¸€èˆ¬å€¾å‘æ•´ä½“æ›´æ–°ï¼‰ PATCH /classes/{classId}ï¼šæ›´æ–°æŸä¸ªæŒ‡å®šç­çº§çš„ä¿¡æ¯ï¼ˆä¸€èˆ¬å€¾å‘éƒ¨åˆ†æ›´æ–°ï¼‰ DELETE /classes/{classId}ï¼šåˆ é™¤æŸä¸ªç­çº§ GET /classes/{classId}/teachersï¼šåˆ—å‡ºæŸä¸ªæŒ‡å®šç­çº§çš„æ‰€æœ‰è€å¸ˆçš„ä¿¡æ¯ GET /classes/{classId}/studentsï¼šåˆ—å‡ºæŸä¸ªæŒ‡å®šç­çº§çš„æ‰€æœ‰å­¦ç”Ÿçš„ä¿¡æ¯ DELETE /classes/{classId}/teachers/{ID}ï¼šåˆ é™¤æŸä¸ªæŒ‡å®šç­çº§ä¸‹çš„æŒ‡å®šçš„è€å¸ˆçš„ä¿¡æ¯ åä¾‹ï¼š\n/getAllclasses /createNewclass /deleteAllActiveclasses ç†æ¸…èµ„æºçš„å±‚æ¬¡ç»“æ„ï¼Œæ¯”å¦‚ä¸šåŠ¡é’ˆå¯¹çš„èŒƒå›´æ˜¯å­¦æ ¡ï¼Œé‚£ä¹ˆå­¦æ ¡ä¼šæ˜¯ä¸€çº§èµ„æº:/schoolsï¼Œè€å¸ˆ: /schools/teachersï¼Œå­¦ç”Ÿ: /schools/students å°±æ˜¯äºŒçº§èµ„æºã€‚\n# è¿‡æ»¤ä¿¡æ¯ï¼ˆFilteringï¼‰ # å¦‚æœæˆ‘ä»¬åœ¨æŸ¥è¯¢çš„æ—¶å€™éœ€è¦æ·»åŠ ç‰¹å®šæ¡ä»¶çš„è¯ï¼Œå»ºè®®ä½¿ç”¨ url å‚æ•°çš„å½¢å¼ã€‚æ¯”å¦‚æˆ‘ä»¬è¦æŸ¥è¯¢ state çŠ¶æ€ä¸º active å¹¶ä¸” name ä¸º guidegege çš„ç­çº§ï¼š\nGET /classes?state=active\u0026amp;name=guidegege æ¯”å¦‚æˆ‘ä»¬è¦å®ç°åˆ†é¡µæŸ¥è¯¢ï¼š\nGET /classes?page=1\u0026amp;size=10 //æŒ‡å®šç¬¬1é¡µï¼Œæ¯é¡µ10ä¸ªæ•°æ® # çŠ¶æ€ç ï¼ˆStatus Codesï¼‰ # çŠ¶æ€ç èŒƒå›´ï¼š\n2xxï¼šæˆåŠŸ 3xxï¼šé‡å®šå‘ 4xxï¼šå®¢æˆ·ç«¯é”™è¯¯ 5xxï¼šæœåŠ¡å™¨é”™è¯¯ 200 æˆåŠŸ 301 æ°¸ä¹…é‡å®šå‘ 400 é”™è¯¯è¯·æ±‚ 500 æœåŠ¡å™¨é”™è¯¯ 201 åˆ›å»º 304 èµ„æºæœªä¿®æ”¹ 401 æœªæˆæƒ 502 ç½‘å…³é”™è¯¯ 403 ç¦æ­¢è®¿é—® 504 ç½‘å…³è¶…æ—¶ 404 æœªæ‰¾åˆ° 405 è¯·æ±‚æ–¹æ³•ä¸å¯¹ # RESTful çš„æè‡´ HATEOAS # RESTful çš„æè‡´æ˜¯ hateoas ï¼Œä½†æ˜¯è¿™ä¸ªåŸºæœ¬ä¸ä¼šåœ¨å®é™…é¡¹ç›®ä¸­ç”¨åˆ°ã€‚\nä¸Šé¢æ˜¯ RESTful API æœ€åŸºæœ¬çš„ä¸œè¥¿ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­æœ€å®¹æ˜“å®è·µåˆ°çš„ã€‚å®é™…ä¸Šï¼ŒRESTful API æœ€å¥½åšåˆ° Hypermediaï¼Œå³è¿”å›ç»“æœä¸­æä¾›é“¾æ¥ï¼Œè¿å‘å…¶ä»– API æ–¹æ³•ï¼Œä½¿å¾—ç”¨æˆ·ä¸æŸ¥æ–‡æ¡£ï¼Œä¹ŸçŸ¥é“ä¸‹ä¸€æ­¥åº”è¯¥åšä»€ä¹ˆã€‚\næ¯”å¦‚ï¼Œå½“ç”¨æˆ·å‘ api.example.com çš„æ ¹ç›®å½•å‘å‡ºè¯·æ±‚ï¼Œä¼šå¾—åˆ°è¿™æ ·ä¸€ä¸ªè¿”å›ç»“æœ\n{\u0026#34;link\u0026#34;: { \u0026#34;rel\u0026#34;: \u0026#34;collection https://www.example.com/classes\u0026#34;, \u0026#34;href\u0026#34;: \u0026#34;https://api.example.com/classes\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;List of classes\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;application/vnd.yourformat+json\u0026#34; }} ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œæ–‡æ¡£ä¸­æœ‰ä¸€ä¸ª link å±æ€§ï¼Œç”¨æˆ·è¯»å–è¿™ä¸ªå±æ€§å°±çŸ¥é“ä¸‹ä¸€æ­¥è¯¥è°ƒç”¨ä»€ä¹ˆ API äº†ã€‚rel è¡¨ç¤ºè¿™ä¸ª API ä¸å½“å‰ç½‘å€çš„å…³ç³»ï¼ˆcollection å…³ç³»ï¼Œå¹¶ç»™å‡ºè¯¥ collection çš„ç½‘å€ï¼‰ï¼Œhref è¡¨ç¤º API çš„è·¯å¾„ï¼Œtitle è¡¨ç¤º API çš„æ ‡é¢˜ï¼Œtype è¡¨ç¤ºè¿”å›ç±»å‹ Hypermedia API çš„è®¾è®¡è¢«ç§°ä¸ºHATEOASopen in new windowã€‚\nåœ¨ Spring ä¸­æœ‰ä¸€ä¸ªå«åš HATEOAS çš„ API åº“ï¼Œé€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥æ›´è½»æ¾çš„åˆ›å»ºå‡ºç¬¦åˆ HATEOAS è®¾è®¡çš„ APIã€‚ç›¸å…³æ–‡ç« ï¼š\nåœ¨ Spring Boot ä¸­ä½¿ç”¨ HATEOASopen in new window Building REST services with Springopen in new window (Spring å®˜ç½‘ ) An Intro to Spring HATEOASopen in new window spring-hateoas-examplesopen in new window Spring HATEOASopen in new window (Spring å®˜ç½‘ ) # å‚è€ƒ # https://RESTfulapi.net/ https://www.ruanyifeng.com/blog/2014/05/restful_api.html https://juejin.im/entry/59e460c951882542f578f2f0 https://phauer.com/2016/testing-RESTful-services-java-best-practices/ https://www.seobility.net/en/wiki/REST_API https://dev.to/duomly/rest-api-vs-graphql-comparison-3j6g è‘—ä½œæƒå½’æ‰€æœ‰ åŸæ–‡é“¾æ¥ï¼šhttps://javaguide.cn/system-design/basis/RESTfulAPI.html\n"},{"id":70,"href":"/zh/docs/study/Review/java_guide/lyfly_high-availability/ly05ly_performance-test/","title":"æ€§èƒ½æµ‹è¯•å…¥é—¨","section":"é«˜å¯ç”¨","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\næ€§èƒ½æµ‹è¯•ä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯ç”±æµ‹è¯•è¿™ä¸ªèŒä½å»åšçš„ï¼Œé‚£è¿˜éœ€è¦æˆ‘ä»¬å¼€å‘å­¦è¿™ä¸ªå¹²å˜›å‘¢ï¼Ÿäº†è§£æ€§èƒ½æµ‹è¯•çš„æŒ‡æ ‡ã€åˆ†ç±»ä»¥åŠå·¥å…·ç­‰çŸ¥è¯†æœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½åœ°å»å†™å‡ºæ€§èƒ½æ›´å¥½çš„ç¨‹åºï¼Œå¦å¤–ä½œä¸ºå¼€å‘è¿™ä¸ªè§’è‰²ï¼Œå¦‚æœä½ ä¼šæ€§èƒ½æµ‹è¯•çš„è¯ï¼Œç›¸ä¿¡ä¹Ÿä¼šä¸ºä½ çš„å±¥å†åŠ åˆ†ä¸å°‘ã€‚\nè¿™ç¯‡æ–‡ç« æ˜¯æˆ‘ä¼šç»“åˆè‡ªå·±çš„å®é™…ç»å†ä»¥åŠåœ¨æµ‹è¯•è¿™é‡Œå–çš„ç»æ‰€å¾—ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘è¿˜å€Ÿé‰´äº†ä¸€äº›ä¼˜ç§€ä¹¦ç±ï¼Œå¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©ã€‚\næœ¬æ–‡æ€ç»´å¯¼å›¾ï¼š\n# ä¸€ ä¸åŒè§’è‰²çœ‹ç½‘ç«™æ€§èƒ½ # # 1.1 ç”¨æˆ· # å½“ç”¨æˆ·æ‰“å¼€ä¸€ä¸ªç½‘ç«™çš„æ—¶å€™ï¼Œæœ€å…³æ³¨çš„æ˜¯ä»€ä¹ˆï¼Ÿå½“ç„¶æ˜¯ç½‘ç«™å“åº”é€Ÿåº¦çš„å¿«æ…¢ã€‚æ¯”å¦‚æˆ‘ä»¬ç‚¹å‡»äº†æ·˜å®çš„ä¸»é¡µï¼Œæ·˜å®éœ€è¦å¤šä¹…å°†é¦–é¡µçš„å†…å®¹å‘ˆç°åœ¨æˆ‘çš„é¢å‰ï¼Œæˆ‘ç‚¹å‡»äº†æäº¤è®¢å•æŒ‰é’®éœ€è¦å¤šä¹…è¿”å›ç»“æœç­‰ç­‰ã€‚\næ‰€ä»¥ï¼Œç”¨æˆ·åœ¨ä½“éªŒæˆ‘ä»¬ç³»ç»Ÿçš„æ—¶å€™å¾€å¾€æ ¹æ®ä½ çš„å“åº”é€Ÿåº¦çš„å¿«æ…¢æ¥è¯„åˆ¤ä½ çš„ç½‘ç«™çš„æ€§èƒ½ã€‚\n# 1.2 å¼€å‘äººå‘˜ # ç”¨æˆ·ä¸å¼€å‘äººå‘˜éƒ½å…³æ³¨é€Ÿåº¦ï¼Œè¿™ä¸ªé€Ÿåº¦å®é™…ä¸Šå°±æ˜¯æˆ‘ä»¬çš„ç³»ç»Ÿå¤„ç†ç”¨æˆ·è¯·æ±‚çš„é€Ÿåº¦ã€‚\nå¼€å‘äººå‘˜ä¸€èˆ¬æƒ…å†µä¸‹å¾ˆéš¾ç›´è§‚çš„å»è¯„åˆ¤è‡ªå·±ç½‘ç«™çš„æ€§èƒ½ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šæ ¹æ®ç½‘ç«™å½“å‰çš„æ¶æ„ä»¥åŠåŸºç¡€è®¾æ–½æƒ…å†µç»™ä¸€ä¸ªå¤§æ¦‚çš„å€¼,æ¯”å¦‚ï¼š\né¡¹ç›®æ¶æ„æ˜¯åˆ†å¸ƒå¼çš„å—ï¼Ÿ ç”¨åˆ°äº†ç¼“å­˜å’Œæ¶ˆæ¯é˜Ÿåˆ—æ²¡æœ‰ï¼Ÿ é«˜å¹¶å‘çš„ä¸šåŠ¡æœ‰æ²¡æœ‰ç‰¹æ®Šå¤„ç†ï¼Ÿ æ•°æ®åº“è®¾è®¡æ˜¯å¦åˆç†ï¼Ÿ ç³»ç»Ÿç”¨åˆ°çš„ç®—æ³•æ˜¯å¦è¿˜éœ€è¦ä¼˜åŒ–ï¼Ÿ ç³»ç»Ÿæ˜¯å¦å­˜åœ¨å†…å­˜æ³„éœ²çš„é—®é¢˜ï¼Ÿ é¡¹ç›®ä½¿ç”¨çš„ Redis ç¼“å­˜å¤šå¤§ï¼ŸæœåŠ¡å™¨æ€§èƒ½å¦‚ä½•ï¼Ÿç”¨çš„æ˜¯æœºæ¢°ç¡¬ç›˜è¿˜æ˜¯å›ºæ€ç¡¬ç›˜ï¼Ÿ \u0026hellip;\u0026hellip; # 1.3 æµ‹è¯•äººå‘˜ # æµ‹è¯•äººå‘˜ä¸€èˆ¬ä¼šæ ¹æ®æ€§èƒ½æµ‹è¯•å·¥å…·æ¥æµ‹è¯•ï¼Œç„¶åä¸€èˆ¬ä¼šåšå‡ºä¸€ä¸ªè¡¨æ ¼ã€‚è¿™ä¸ªè¡¨æ ¼å¯èƒ½ä¼šæ¶µç›–ä¸‹é¢è¿™äº›é‡è¦çš„å†…å®¹ï¼š\nå“åº”æ—¶é—´ï¼› è¯·æ±‚æˆåŠŸç‡ï¼› ååé‡ï¼› \u0026hellip;\u0026hellip; # 1.4 è¿ç»´äººå‘˜ # è¿ç»´äººå‘˜ä¼šå€¾å‘äºæ ¹æ®åŸºç¡€è®¾æ–½å’Œèµ„æºçš„åˆ©ç”¨ç‡æ¥åˆ¤æ–­ç½‘ç«™çš„æ€§èƒ½ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„æœåŠ¡å™¨èµ„æºä½¿ç”¨æ˜¯å¦åˆç†ã€æ•°æ®åº“èµ„æºæ˜¯å¦å­˜åœ¨æ»¥ç”¨çš„æƒ…å†µã€å½“ç„¶ï¼Œè¿™æ˜¯ä¼ ç»Ÿçš„è¿ç»´äººå‘˜ï¼Œç°åœ¨ Devpos ç«èµ·æ¥åï¼Œå•çº¯å¹²è¿ç»´çš„å¾ˆå°‘äº†ã€‚æˆ‘ä»¬è¿™é‡Œæš‚ä¸”è¿˜ä¿ç•™æœ‰è¿™ä¸ªè§’è‰²ã€‚\n# äºŒ æ€§èƒ½æµ‹è¯•éœ€è¦æ³¨æ„çš„ç‚¹ # å‡ ä¹æ²¡æœ‰æ–‡ç« åœ¨è®²æ€§èƒ½æµ‹è¯•çš„æ—¶å€™æåˆ°è¿™ä¸ªé—®é¢˜ï¼Œå¤§å®¶éƒ½ä¼šè®²å¦‚ä½•å»æ€§èƒ½æµ‹è¯•ï¼Œæœ‰å“ªäº›æ€§èƒ½æµ‹è¯•æŒ‡æ ‡è¿™äº›ä¸œè¥¿ã€‚\n# 2.1 äº†è§£ç³»ç»Ÿçš„ä¸šåŠ¡åœºæ™¯ # æ€§èƒ½æµ‹è¯•ä¹‹å‰æ›´éœ€è¦ä½ äº†è§£å½“å‰çš„ç³»ç»Ÿçš„ä¸šåŠ¡åœºæ™¯ã€‚ å¯¹ç³»ç»Ÿä¸šåŠ¡äº†è§£çš„ä¸å¤Ÿæ·±åˆ»ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“çŠ¯æµ‹è¯•æ–¹å‘åæ‰§çš„é”™è¯¯ï¼Œä»è€Œå¯¼è‡´æˆ‘ä»¬å¿½ç•¥äº†å¯¹ç³»ç»ŸæŸäº›æ›´éœ€è¦æ€§èƒ½æµ‹è¯•çš„åœ°æ–¹è¿›è¡Œæµ‹è¯•ã€‚æ¯”å¦‚æˆ‘ä»¬çš„ç³»ç»Ÿå¯ä»¥ä¸ºç”¨æˆ·æä¾›å‘é€é‚®ä»¶çš„åŠŸèƒ½ï¼Œç”¨æˆ·é…ç½®æˆåŠŸé‚®ç®±ååªéœ€è¾“å…¥ç›¸åº”çš„é‚®ç®±ä¹‹åå°±èƒ½å‘é€ï¼Œç³»ç»Ÿæ¯å¤©å¤§æ¦‚èƒ½å¤„ç†ä¸Šä¸‡æ¬¡å‘é‚®ä»¶çš„è¯·æ±‚ã€‚å¾ˆå¤šäººçœ‹åˆ°è¿™ä¸ªå¯èƒ½å°±ç›´æ¥å¼€å§‹ä½¿ç”¨ç›¸å…³å·¥å…·æµ‹è¯•é‚®ç®±å‘é€æ¥å£ï¼Œä½†æ˜¯ï¼Œå‘é€é‚®ä»¶è¿™ä¸ªåœºæ™¯å¯èƒ½ä¸æ˜¯å½“å‰ç³»ç»Ÿçš„æ€§èƒ½ç“¶é¢ˆï¼Œè¿™ä¹ˆå¤šäººç”¨æˆ‘ä»¬çš„ç³»ç»Ÿå‘é‚®ä»¶ï¼Œ è¿˜å¯èƒ½æœ‰å¾ˆå¤šäººä¸€èµ·å‘é‚®ä»¶ï¼Œå•å•è¿™ä¸ªåœºæ™¯å°±è¿™ä¹ˆäººç”¨ï¼Œé‚£ç”¨æˆ·ç®¡ç†å¯èƒ½æ‰æ˜¯æ€§èƒ½ç“¶é¢ˆå§ï¼\n# 2.2 å†å²æ•°æ®éå¸¸æœ‰ç”¨ # å½“å‰ç³»ç»Ÿæ‰€ç•™ä¸‹çš„å†å²æ•°æ®éå¸¸é‡è¦ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›¸åº”çš„äº›å†å²æ•°æ®åˆæ­¥åˆ¤å®šè¿™ä¸ªç³»ç»Ÿå“ªäº›æ¥å£è°ƒç”¨çš„æ¯”è¾ƒå¤šã€å“ªäº› service æ‰¿å—çš„å‹åŠ›æœ€å¤§ï¼Œè¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é’ˆå¯¹è¿™äº›åœ°æ–¹è¿›è¡Œæ›´ç»†è‡´çš„æ€§èƒ½æµ‹è¯•ä¸åˆ†æã€‚\nå¦å¤–ï¼Œè¿™äº›åœ°æ–¹ä¹Ÿå°±åƒè¿™ä¸ªç³»ç»Ÿçš„ä¸€ä¸ªçŸ­æ¿ä¸€æ ·ï¼Œä¼˜åŒ–å¥½äº†è¿™äº›åœ°æ–¹ä¼šä¸ºæˆ‘ä»¬çš„ç³»ç»Ÿå¸¦æ¥è´¨çš„æå‡ã€‚\n# ä¸‰ æ€§èƒ½æµ‹è¯•çš„æŒ‡æ ‡ # # 3.1 å“åº”æ—¶é—´ # å“åº”æ—¶é—´å°±æ˜¯ç”¨æˆ·å‘å‡ºè¯·æ±‚åˆ°ç”¨æˆ·æ”¶åˆ°ç³»ç»Ÿå¤„ç†ç»“æœæ‰€éœ€è¦çš„æ—¶é—´ã€‚ é‡è¦å—ï¼Ÿå®åœ¨å¤ªé‡è¦ï¼\næ¯”è¾ƒå‡ºåçš„ 2-5-8 åŸåˆ™æ˜¯è¿™æ ·æè¿°çš„ï¼šé€šå¸¸æ¥è¯´ï¼Œ2åˆ°5ç§’ï¼Œé¡µé¢ä½“éªŒä¼šæ¯”è¾ƒå¥½ï¼Œ5åˆ°8ç§’è¿˜å¯ä»¥æ¥å—ï¼Œ8ç§’ä»¥ä¸ŠåŸºæœ¬å°±å¾ˆéš¾æ¥å—äº†ã€‚å¦å¤–ï¼Œæ®ç»Ÿè®¡å½“ç½‘ç«™æ…¢ä¸€ç§’å°±ä¼šæµå¤±ååˆ†ä¹‹ä¸€çš„å®¢æˆ·ã€‚\nä½†æ˜¯ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹æˆ‘ä»¬ä¹Ÿå¹¶ä¸éœ€è¦å¤ªçœ‹é‡ 2-5-8 åŸåˆ™ ï¼Œæ¯”å¦‚æˆ‘è§‰å¾—ç³»ç»Ÿå¯¼å‡ºå¯¼å…¥å¤§æ•°æ®é‡è¿™ç§å°±ä¸éœ€è¦ï¼Œç³»ç»Ÿç”Ÿæˆç³»ç»ŸæŠ¥å‘Šè¿™ç§ä¹Ÿä¸éœ€è¦ã€‚\n# 3.2 å¹¶å‘æ•° # å¹¶å‘æ•°æ˜¯ç³»ç»Ÿèƒ½åŒæ—¶å¤„ç†è¯·æ±‚çš„æ•°ç›®å³åŒæ—¶æäº¤è¯·æ±‚çš„ç”¨æˆ·æ•°ç›®ã€‚\nä¸å¾—ä¸è¯´ï¼Œé«˜å¹¶å‘æ˜¯ç°åœ¨åç«¯æ¶æ„ä¸­éå¸¸éå¸¸ç«çƒ­çš„ä¸€ä¸ªè¯äº†ï¼Œè¿™ä¸ªä¸å½“å‰çš„äº’è”ç½‘ç¯å¢ƒä»¥åŠä¸­å›½æ•´ä½“çš„äº’è”ç½‘ç”¨æˆ·é‡éƒ½æœ‰å¾ˆå¤§å…³ç³»ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½ çš„ç³»ç»Ÿå¹¶å‘é‡è¶Šå¤§ï¼Œè¯´æ˜ä½ çš„äº§å“åšçš„å°±è¶Šå¤§ã€‚ä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªç³»ç»Ÿéƒ½éœ€è¦è¾¾åˆ°åƒæ·˜å®ã€12306 è¿™ç§äº¿çº§å¹¶å‘é‡çš„ã€‚\n# 3.3 ååé‡ # ååé‡æŒ‡çš„æ˜¯ç³»ç»Ÿå•ä½æ—¶é—´å†…ç³»ç»Ÿå¤„ç†çš„è¯·æ±‚æ•°é‡ã€‚è¡¡é‡ååé‡æœ‰å‡ ä¸ªé‡è¦çš„å‚æ•°ï¼šQPSï¼ˆTPSï¼‰ã€å¹¶å‘æ•°ã€å“åº”æ—¶é—´ã€‚\nQPSï¼ˆQuery Per Secondï¼‰ï¼šæœåŠ¡å™¨æ¯ç§’å¯ä»¥æ‰§è¡Œçš„æŸ¥è¯¢æ¬¡æ•°ï¼› TPSï¼ˆTransaction Per Secondï¼‰ï¼šæœåŠ¡å™¨æ¯ç§’å¤„ç†çš„äº‹åŠ¡æ•°ï¼ˆè¿™é‡Œçš„ä¸€ä¸ªäº‹åŠ¡å¯ä»¥ç†è§£ä¸ºå®¢æˆ·å‘å‡ºè¯·æ±‚åˆ°æ”¶åˆ°æœåŠ¡å™¨çš„è¿‡ç¨‹ï¼‰ï¼› å¹¶å‘æ•°ï¼›ç³»ç»Ÿèƒ½åŒæ—¶å¤„ç†è¯·æ±‚çš„æ•°ç›®å³åŒæ—¶æäº¤è¯·æ±‚çš„ç”¨æˆ·æ•°ç›®ã€‚ å“åº”æ—¶é—´ï¼š ä¸€èˆ¬å–å¤šæ¬¡è¯·æ±‚çš„å¹³å‡å“åº”æ—¶é—´ ç†æ¸…ä»–ä»¬çš„æ¦‚å¿µï¼Œå°±å¾ˆå®¹æ˜“ææ¸…æ¥šä»–ä»¬ä¹‹é—´çš„å…³ç³»äº†ã€‚\nQPSï¼ˆTPSï¼‰ = å¹¶å‘æ•°/å¹³å‡å“åº”æ—¶é—´ å¹¶å‘æ•° = QPS*å¹³å‡å“åº”æ—¶é—´ ä¹¦ä¸­æ˜¯è¿™æ ·æè¿° QPS å’Œ TPS çš„åŒºåˆ«çš„ã€‚\nQPS vs TPSï¼šQPS åŸºæœ¬ç±»ä¼¼äº TPSï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯ï¼Œå¯¹äºä¸€ä¸ªé¡µé¢çš„ä¸€æ¬¡è®¿é—®ï¼Œå½¢æˆä¸€ä¸ªTPSï¼›ä½†ä¸€æ¬¡é¡µé¢è¯·æ±‚ï¼Œå¯èƒ½äº§ç”Ÿå¤šæ¬¡å¯¹æœåŠ¡å™¨çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯¹è¿™äº›è¯·æ±‚ï¼Œå°±å¯è®¡å…¥â€œQPSâ€ä¹‹ä¸­ã€‚å¦‚ï¼Œè®¿é—®ä¸€ä¸ªé¡µé¢ä¼šè¯·æ±‚æœåŠ¡å™¨2æ¬¡ï¼Œä¸€æ¬¡è®¿é—®ï¼Œäº§ç”Ÿä¸€ä¸ªâ€œTâ€ï¼Œäº§ç”Ÿ2ä¸ªâ€œQâ€ã€‚\n# 3.4 æ€§èƒ½è®¡æ•°å™¨ # æ€§èƒ½è®¡æ•°å™¨æ˜¯æè¿°æœåŠ¡å™¨æˆ–è€…æ“ä½œç³»ç»Ÿçš„ä¸€äº›æ•°æ®æŒ‡æ ‡å¦‚å†…å­˜ä½¿ç”¨ã€CPUä½¿ç”¨ã€ç£ç›˜ä¸ç½‘ç»œI/Oç­‰æƒ…å†µã€‚\n# å›› å‡ ç§å¸¸è§çš„æ€§èƒ½æµ‹è¯• # # æ€§èƒ½æµ‹è¯• # æ€§èƒ½æµ‹è¯•æ–¹æ³•æ˜¯é€šè¿‡æµ‹è¯•å·¥å…·æ¨¡æ‹Ÿç”¨æˆ·è¯·æ±‚ç³»ç»Ÿï¼Œç›®çš„ä¸»è¦æ˜¯ä¸ºäº†æµ‹è¯•ç³»ç»Ÿçš„æ€§èƒ½æ˜¯å¦æ»¡è¶³è¦æ±‚ã€‚é€šä¿—åœ°è¯´ï¼Œè¿™ç§æ–¹æ³•å°±æ˜¯è¦åœ¨ç‰¹å®šçš„è¿è¡Œæ¡ä»¶ä¸‹éªŒè¯ç³»ç»Ÿçš„èƒ½åŠ›çŠ¶æ€ã€‚\næ€§èƒ½æµ‹è¯•æ˜¯ä½ åœ¨å¯¹ç³»ç»Ÿæ€§èƒ½å·²ç»æœ‰äº†è§£çš„å‰æä¹‹åè¿›è¡Œçš„ï¼Œå¹¶ä¸”æœ‰æ˜ç¡®çš„æ€§èƒ½æŒ‡æ ‡ã€‚\n# è´Ÿè½½æµ‹è¯• # å¯¹è¢«æµ‹è¯•çš„ç³»ç»Ÿç»§ç»­åŠ å¤§è¯·æ±‚å‹åŠ›ï¼Œç›´åˆ°æœåŠ¡å™¨çš„æŸä¸ªèµ„æºå·²ç»è¾¾åˆ°é¥±å’Œäº†ï¼Œæ¯”å¦‚ç³»ç»Ÿçš„ç¼“å­˜å·²ç»ä¸å¤Ÿç”¨äº†æˆ–è€…ç³»ç»Ÿçš„å“åº”æ—¶é—´å·²ç»ä¸æ»¡è¶³è¦æ±‚äº†ã€‚\nè´Ÿè½½æµ‹è¯•è¯´ç™½ç‚¹å°±æ˜¯æµ‹è¯•ç³»ç»Ÿçš„ä¸Šé™ã€‚\n# å‹åŠ›æµ‹è¯• # ä¸å»ç®¡ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œå¯¹ç³»ç»Ÿç»§ç»­åŠ å¤§è¯·æ±‚å‹åŠ›ï¼Œç›´åˆ°æœåŠ¡å™¨å´©æºƒæ— æ³•å†ç»§ç»­æä¾›æœåŠ¡ã€‚\n# ç¨³å®šæ€§æµ‹è¯• # æ¨¡æ‹ŸçœŸå®åœºæ™¯ï¼Œç»™ç³»ç»Ÿä¸€å®šå‹åŠ›ï¼Œçœ‹çœ‹ä¸šåŠ¡æ˜¯å¦èƒ½ç¨³å®šè¿è¡Œã€‚\n# äº” å¸¸ç”¨æ€§èƒ½æµ‹è¯•å·¥å…· # è¿™é‡Œå°±ä¸å¤šæ‰©å±•äº†ï¼Œæœ‰æ—¶é—´çš„è¯ä¼šå•ç‹¬æ‹ä¸€ä¸ªç†Ÿæ‚‰çš„è¯´ä¸€ä¸‹ã€‚\n# 5.1 åç«¯å¸¸ç”¨ # æ²¡è®°é”™çš„è¯ï¼Œé™¤äº† LoadRunner å…¶ä»–å‡ æ¬¾æ€§èƒ½æµ‹è¯•å·¥å…·éƒ½æ˜¯å¼€æºå…è´¹çš„ã€‚\nJmeter ï¼šApache JMeter æ˜¯ JAVA å¼€å‘çš„æ€§èƒ½æµ‹è¯•å·¥å…·ã€‚ LoadRunnerï¼šä¸€æ¬¾å•†ä¸šçš„æ€§èƒ½æµ‹è¯•å·¥å…·ã€‚ Galtling ï¼šä¸€æ¬¾åŸºäºScala å¼€å‘çš„é«˜æ€§èƒ½æœåŠ¡å™¨æ€§èƒ½æµ‹è¯•å·¥å…·ã€‚ ab ï¼šå…¨ç§°ä¸º Apache Bench ã€‚Apache æ——ä¸‹çš„ä¸€æ¬¾æµ‹è¯•å·¥å…·ï¼Œéå¸¸å®ç”¨ã€‚ # 5.2 å‰ç«¯å¸¸ç”¨ # Fiddlerï¼šæŠ“åŒ…å·¥å…·ï¼Œå®ƒå¯ä»¥ä¿®æ”¹è¯·æ±‚çš„æ•°æ®ï¼Œç”šè‡³å¯ä»¥ä¿®æ”¹æœåŠ¡å™¨è¿”å›çš„æ•°æ®ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œæ˜¯Web è°ƒè¯•çš„åˆ©å™¨ã€‚ HttpWatch: å¯ç”¨äºå½•åˆ¶HTTPè¯·æ±‚ä¿¡æ¯çš„å·¥å…·ã€‚ # å…­ å¸¸è§çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ # æ€§èƒ½ä¼˜åŒ–ä¹‹å‰æˆ‘ä»¬éœ€è¦å¯¹è¯·æ±‚ç»å†çš„å„ä¸ªç¯èŠ‚è¿›è¡Œåˆ†æï¼Œæ’æŸ¥å‡ºå¯èƒ½å‡ºç°æ€§èƒ½ç“¶é¢ˆçš„åœ°æ–¹ï¼Œå®šä½é—®é¢˜ã€‚\nä¸‹é¢æ˜¯ä¸€äº›æ€§èƒ½ä¼˜åŒ–æ—¶ï¼Œæˆ‘ç»å¸¸æ‹¿æ¥è‡ªé—®çš„ä¸€äº›é—®é¢˜ï¼š\nç³»ç»Ÿæ˜¯å¦éœ€è¦ç¼“å­˜ï¼Ÿ ç³»ç»Ÿæ¶æ„æœ¬èº«æ˜¯ä¸æ˜¯å°±æœ‰é—®é¢˜ï¼Ÿ ç³»ç»Ÿæ˜¯å¦å­˜åœ¨æ­»é”çš„åœ°æ–¹ï¼Ÿ ç³»ç»Ÿæ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼ï¼Ÿï¼ˆJava çš„è‡ªåŠ¨å›æ”¶å†…å­˜è™½ç„¶å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯ï¼Œæœ‰æ—¶å€™ä»£ç å†™çš„ä¸å¥½çœŸçš„ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼‰ æ•°æ®åº“ç´¢å¼•ä½¿ç”¨æ˜¯å¦åˆç†ï¼Ÿ \u0026hellip;\u0026hellip; è‘—ä½œæƒå½’æ‰€æœ‰ åŸæ–‡é“¾æ¥ï¼šhttps://javaguide.cn/high-availability/performance-test.html\n"},{"id":71,"href":"/zh/docs/study/Review/java_guide/lyfly_high-availability/ly04ly_timout-and-retry/","title":"è¶…æ—¶\u0026é‡è¯•è¯¦è§£","section":"é«˜å¯ç”¨","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nç”±äºç½‘ç»œé—®é¢˜ã€ç³»ç»Ÿæˆ–è€…æœåŠ¡å†…éƒ¨çš„ Bugã€æœåŠ¡å™¨å®•æœºã€æ“ä½œç³»ç»Ÿå´©æºƒç­‰é—®é¢˜çš„ä¸ç¡®å®šæ€§ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿæˆ–è€…æœåŠ¡æ°¸è¿œä¸å¯èƒ½ä¿è¯æ—¶åˆ»éƒ½æ˜¯å¯ç”¨çš„çŠ¶æ€ã€‚\nä¸ºäº†æœ€å¤§é™åº¦çš„å‡å°ç³»ç»Ÿæˆ–è€…æœåŠ¡å‡ºç°æ•…éšœä¹‹åå¸¦æ¥çš„å½±å“ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„ è¶…æ—¶ï¼ˆTimeoutï¼‰ å’Œ é‡è¯•ï¼ˆRetryï¼‰ æœºåˆ¶ã€‚\næƒ³è¦æŠŠè¶…æ—¶å’Œé‡è¯•æœºåˆ¶è®²æ¸…æ¥šå…¶å®å¾ˆç®€å•ï¼Œå› ä¸ºå®ƒä¿©æœ¬èº«å°±ä¸æ˜¯ä»€ä¹ˆé«˜æ·±çš„æ¦‚å¿µã€‚\nè™½ç„¶è¶…æ—¶å’Œé‡è¯•æœºåˆ¶çš„æ€æƒ³å¾ˆç®€å•ï¼Œä½†æ˜¯å®ƒä¿©æ˜¯çœŸçš„éå¸¸å®ç”¨ã€‚ä½ å¹³æ—¶æ¥è§¦åˆ°çš„ç»å¤§éƒ¨åˆ†æ¶‰åŠåˆ°è¿œç¨‹è°ƒç”¨çš„ç³»ç»Ÿæˆ–è€…æœåŠ¡éƒ½ä¼šåº”ç”¨è¶…æ—¶å’Œé‡è¯•æœºåˆ¶ã€‚å°¤å…¶æ˜¯å¯¹äºå¾®æœåŠ¡ç³»ç»Ÿæ¥è¯´ï¼Œæ­£ç¡®è®¾ç½®è¶…æ—¶å’Œé‡è¯•éå¸¸é‡è¦ã€‚å•ä½“æœåŠ¡é€šå¸¸åªæ¶‰åŠæ•°æ®åº“ã€ç¼“å­˜ã€ç¬¬ä¸‰æ–¹ APIã€ä¸­é—´ä»¶ç­‰çš„ç½‘ç»œè°ƒç”¨ï¼Œè€Œå¾®æœåŠ¡ç³»ç»Ÿå†…éƒ¨å„ä¸ªæœåŠ¡ä¹‹é—´è¿˜å­˜åœ¨ç€ç½‘ç»œè°ƒç”¨ã€‚\n# è¶…æ—¶æœºåˆ¶ # # ä»€ä¹ˆæ˜¯è¶…æ—¶æœºåˆ¶ï¼Ÿ # è¶…æ—¶æœºåˆ¶è¯´çš„æ˜¯å½“ä¸€ä¸ªè¯·æ±‚è¶…è¿‡æŒ‡å®šçš„æ—¶é—´ï¼ˆæ¯”å¦‚ 1sï¼‰è¿˜æ²¡æœ‰è¢«å¤„ç†çš„è¯ï¼Œè¿™ä¸ªè¯·æ±‚å°±ä¼šç›´æ¥è¢«å–æ¶ˆå¹¶æŠ›å‡ºæŒ‡å®šçš„å¼‚å¸¸æˆ–è€…é”™è¯¯ï¼ˆæ¯”å¦‚ 504 Gateway Timeoutï¼‰ã€‚\næˆ‘ä»¬å¹³æ—¶æ¥è§¦åˆ°çš„è¶…æ—¶å¯ä»¥ç®€å•åˆ†ä¸ºä¸‹é¢ 2 ç§ï¼š\nè¿æ¥è¶…æ—¶ï¼ˆConnectTimeoutï¼‰ ï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥çš„æœ€é•¿ç­‰å¾…æ—¶é—´ã€‚ è¯»å–è¶…æ—¶ï¼ˆReadTimeoutï¼‰ ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å·²ç»å»ºç«‹è¿æ¥ï¼Œå®¢æˆ·ç«¯ç­‰å¾…æœåŠ¡ç«¯å¤„ç†å®Œè¯·æ±‚çš„æœ€é•¿æ—¶é—´ã€‚å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å…³æ³¨æ¯”è¾ƒå¤šçš„è¿˜æ˜¯è¯»å–è¶…æ—¶ã€‚ ä¸€äº›è¿æ¥æ± å®¢æˆ·ç«¯æ¡†æ¶ä¸­å¯èƒ½è¿˜ä¼šæœ‰è·å–è¿æ¥è¶…æ—¶å’Œç©ºé—²è¿æ¥æ¸…ç†è¶…æ—¶**ã€‚\nå¦‚æœæ²¡æœ‰è®¾ç½®è¶…æ—¶çš„è¯ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡ç«¯è¿æ¥æ•°çˆ†ç‚¸å’Œå¤§é‡è¯·æ±‚å †ç§¯çš„é—®é¢˜ã€‚\nè¿™äº›å †ç§¯çš„è¿æ¥å’Œè¯·æ±‚ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œå½±å“æ–°æ”¶åˆ°çš„è¯·æ±‚çš„å¤„ç†ã€‚ä¸¥é‡çš„æƒ…å†µä¸‹ï¼Œç”šè‡³ä¼šæ‹–å®æ•´ä¸ªç³»ç»Ÿæˆ–è€…æœåŠ¡ã€‚\næˆ‘ä¹‹å‰åœ¨å®é™…é¡¹ç›®å°±é‡åˆ°è¿‡ç±»ä¼¼çš„é—®é¢˜ï¼Œæ•´ä¸ªç½‘ç«™æ— æ³•æ­£å¸¸å¤„ç†è¯·æ±‚ï¼ŒæœåŠ¡å™¨è´Ÿè½½ç›´æ¥å¿«è¢«æ‹‰æ»¡ã€‚åé¢å‘ç°åŸå› æ˜¯é¡¹ç›®è¶…æ—¶è®¾ç½®é”™è¯¯åŠ ä¸Šå®¢æˆ·ç«¯è¯·æ±‚å¤„ç†å¼‚å¸¸ï¼Œå¯¼è‡´æœåŠ¡ç«¯è¿æ¥æ•°ç›´æ¥æ¥è¿‘ 40w+ï¼Œè¿™ä¹ˆå¤šå †ç§¯çš„è¿æ¥ç›´æ¥æŠŠç³»ç»Ÿå¹²è¶´äº†ã€‚\n# è¶…æ—¶æ—¶é—´åº”è¯¥å¦‚ä½•è®¾ç½®ï¼Ÿ # è¶…æ—¶åˆ°åº•è®¾ç½®å¤šé•¿æ—¶é—´æ˜¯ä¸€ä¸ªéš¾é¢˜ï¼è¶…æ—¶å€¼è®¾ç½®å¤ªé«˜æˆ–è€…å¤ªä½éƒ½æœ‰é£é™©ã€‚å¦‚æœè®¾ç½®å¤ªé«˜çš„è¯ï¼Œä¼šé™ä½è¶…æ—¶æœºåˆ¶çš„æœ‰æ•ˆæ€§ï¼Œæ¯”å¦‚ä½ è®¾ç½®è¶…æ—¶ä¸º 10s çš„è¯ï¼Œé‚£è®¾ç½®è¶…æ—¶å°±æ²¡å•¥æ„ä¹‰äº†ï¼Œç³»ç»Ÿä¾ç„¶å¯èƒ½ä¼šå‡ºç°å¤§é‡æ…¢è¯·æ±‚å †ç§¯çš„é—®é¢˜ã€‚å¦‚æœè®¾ç½®å¤ªä½çš„è¯ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´åœ¨ç³»ç»Ÿæˆ–è€…æœåŠ¡åœ¨æŸäº›å¤„ç†è¯·æ±‚é€Ÿåº¦å˜æ…¢çš„æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚è¯·æ±‚çªç„¶å¢å¤šï¼‰ï¼Œå¤§é‡è¯·æ±‚é‡è¯•ï¼ˆè¶…æ—¶é€šå¸¸ä¼šç»“åˆé‡è¯•ï¼‰ç»§ç»­åŠ é‡ç³»ç»Ÿæˆ–è€…æœåŠ¡çš„å‹åŠ›ï¼Œè¿›è€Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿæˆ–è€…æœåŠ¡è¢«æ‹–å®çš„é—®é¢˜ã€‚\né€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å»ºè®®è¯»å–è¶…æ—¶è®¾ç½®ä¸º 1500ms ,è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ™®é€‚çš„å€¼ã€‚å¦‚æœä½ çš„ç³»ç»Ÿæˆ–è€…æœåŠ¡å¯¹äºå»¶è¿Ÿæ¯”è¾ƒæ•æ„Ÿçš„è¯ï¼Œé‚£è¯»å–è¶…æ—¶å€¼å¯ä»¥é€‚å½“åœ¨ 1500ms çš„åŸºç¡€ä¸Šè¿›è¡Œç¼©çŸ­ã€‚åä¹‹ï¼Œè¯»å–è¶…æ—¶å€¼ä¹Ÿå¯ä»¥åœ¨ 1500ms çš„åŸºç¡€ä¸Šè¿›è¡ŒåŠ é•¿ï¼Œä¸è¿‡ï¼Œå°½é‡è¿˜æ˜¯ä¸è¦è¶…è¿‡ 1500ms ã€‚è¿æ¥è¶…æ—¶å¯ä»¥é€‚å½“è®¾ç½®é•¿ä¸€äº›ï¼Œå»ºè®®åœ¨ 1000ms ~ 5000ms ä¹‹å†…ã€‚\næ²¡æœ‰é“¶å¼¹ï¼è¶…æ—¶å€¼å…·ä½“è¯¥è®¾ç½®å¤šå¤§ï¼Œè¿˜æ˜¯è¦æ ¹æ®å®é™…é¡¹ç›®çš„éœ€æ±‚å’Œæƒ…å†µæ…¢æ…¢è°ƒæ•´ä¼˜åŒ–å¾—åˆ°ã€‚\næ›´ä¸Šä¸€å±‚ï¼Œå‚è€ƒç¾å›¢çš„Javaçº¿ç¨‹æ± å‚æ•°åŠ¨æ€é…ç½®open in new windowæ€æƒ³ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è¶…æ—¶å¼„æˆå¯é…ç½®åŒ–çš„å‚æ•°è€Œä¸æ˜¯å›ºå®šçš„ï¼Œæ¯”è¾ƒç®€å•çš„ä¸€ç§åŠæ³•å°±æ˜¯å°†è¶…æ—¶çš„å€¼æ”¾åœ¨é…ç½®ä¸­å¿ƒä¸­ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®ç³»ç»Ÿæˆ–è€…æœåŠ¡çš„çŠ¶æ€åŠ¨æ€è°ƒæ•´è¶…æ—¶å€¼äº†ã€‚\n# é‡è¯•æœºåˆ¶ # # ä»€ä¹ˆæ˜¯é‡è¯•æœºåˆ¶ï¼Ÿ # é‡è¯•æœºåˆ¶ä¸€èˆ¬é…åˆè¶…æ—¶æœºåˆ¶ä¸€èµ·ä½¿ç”¨ï¼ŒæŒ‡çš„æ˜¯å¤šæ¬¡å‘é€ç›¸åŒçš„è¯·æ±‚æ¥é¿å…ç¬æ€æ•…éšœå’Œå¶ç„¶æ€§æ•…éšœã€‚\nç¬æ€æ•…éšœå¯ä»¥ç®€å•ç†è§£ä¸ºæŸä¸€ç¬é—´ç³»ç»Ÿå¶ç„¶å‡ºç°çš„æ•…éšœï¼Œå¹¶ä¸ä¼šæŒä¹…ã€‚å¶ç„¶æ€§æ•…éšœå¯ä»¥ç†è§£ä¸ºå“ªäº›åœ¨æŸäº›æƒ…å†µä¸‹å¶å°”å‡ºç°çš„æ•…éšœï¼Œé¢‘ç‡é€šå¸¸è¾ƒä½ã€‚\né‡è¯•çš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡æ¶ˆè€—æœåŠ¡å™¨çš„èµ„æºæ¥å°½å¯èƒ½è·å¾—è¯·æ±‚æ›´å¤§æ¦‚ç‡è¢«æˆåŠŸå¤„ç†ã€‚ç”±äºç¬æ€æ•…éšœå’Œå¶ç„¶æ€§æ•…éšœæ˜¯å¾ˆå°‘å‘ç”Ÿçš„ï¼Œå› æ­¤ï¼Œé‡è¯•å¯¹äºæœåŠ¡å™¨çš„èµ„æºæ¶ˆè€—å‡ ä¹æ˜¯å¯ä»¥è¢«å¿½ç•¥çš„ã€‚\n# é‡è¯•çš„æ¬¡æ•°å¦‚ä½•è®¾ç½®ï¼Ÿ # é‡è¯•çš„æ¬¡æ•°ä¸å®œè¿‡å¤šï¼Œå¦åˆ™ä¾ç„¶ä¼šå¯¹ç³»ç»Ÿè´Ÿè½½é€ æˆæ¯”è¾ƒå¤§çš„å‹åŠ›ã€‚\né‡è¯•çš„æ¬¡æ•°é€šå¸¸å»ºè®®è®¾ä¸º 3 æ¬¡ã€‚å¹¶ä¸”ï¼Œæˆ‘ä»¬é€šå¸¸è¿˜ä¼šè®¾ç½®é‡è¯•çš„é—´éš”ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬è¦é‡è¯• 3 æ¬¡çš„è¯ï¼Œç¬¬ 1 æ¬¡è¯·æ±‚å¤±è´¥åï¼Œç­‰å¾… 1 ç§’å†è¿›è¡Œé‡è¯•ï¼Œç¬¬ 2 æ¬¡è¯·æ±‚å¤±è´¥åï¼Œç­‰å¾… 2 ç§’å†è¿›è¡Œé‡è¯•ï¼Œç¬¬ 3 æ¬¡è¯·æ±‚å¤±è´¥åï¼Œç­‰å¾… 3 ç§’å†è¿›è¡Œé‡è¯•ã€‚\n# é‡è¯•å¹‚ç­‰ # è¶…æ—¶å’Œé‡è¯•æœºåˆ¶åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨çš„è¯ï¼Œéœ€è¦æ³¨æ„ä¿è¯åŒä¸€ä¸ªè¯·æ±‚æ²¡æœ‰è¢«å¤šæ¬¡æ‰§è¡Œã€‚\nè¿™é‡Œè¯´çš„åŒä¸€ä¸ªè¯·æ±‚ï¼ŒæŒ‡çš„æ˜¯\u0026quot;\u0026ldquo;ä¸šåŠ¡ä¸Šçš„æ¦‚å¿µ\u0026rdquo;\u0026quot;\nä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°ä¸€ä¸ªè¯·æ±‚è¢«å¤šæ¬¡æ‰§è¡Œå‘¢ï¼Ÿå®¢æˆ·ç«¯ç­‰å¾…æœåŠ¡ç«¯å®Œæˆè¯·æ±‚å®Œæˆè¶…æ—¶ä½†æ­¤æ—¶æœåŠ¡ç«¯å·²ç»æ‰§è¡Œäº†è¯·æ±‚ï¼Œåªæ˜¯ç”±äºçŸ­æš‚çš„ç½‘ç»œæ³¢åŠ¨å¯¼è‡´å“åº”åœ¨å‘é€ç»™å®¢æˆ·ç«¯çš„è¿‡ç¨‹ä¸­å»¶è¿Ÿäº†ã€‚\nä¸¾ä¸ªä¾‹å­ï¼šç”¨æˆ·æ”¯ä»˜è´­ä¹°æŸä¸ªè¯¾ç¨‹ï¼Œç»“æœç”¨æˆ·æ”¯ä»˜çš„è¯·æ±‚ç”±äºé‡è¯•çš„é—®é¢˜å¯¼è‡´ç”¨æˆ·è´­ä¹°åŒä¸€é—¨è¯¾ç¨‹æ”¯ä»˜äº†ä¸¤æ¬¡ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬åœ¨æ‰§è¡Œç”¨æˆ·è´­ä¹°è¯¾ç¨‹çš„è¯·æ±‚çš„æ—¶å€™éœ€è¦åˆ¤æ–­ä¸€ä¸‹ç”¨æˆ·æ˜¯å¦å·²ç»è´­ä¹°è¿‡ã€‚è¿™æ ·çš„è¯ï¼Œå°±ä¸ä¼šå› ä¸ºé‡è¯•çš„é—®é¢˜å¯¼è‡´é‡å¤è´­ä¹°äº†ã€‚\n# å‚è€ƒ # å¾®æœåŠ¡ä¹‹é—´è°ƒç”¨è¶…æ—¶çš„è®¾ç½®æ²»ç†ï¼šhttps://www.infoq.cn/article/eyrslar53l6hjm5yjgyx è¶…æ—¶ã€é‡è¯•å’ŒæŠ–åŠ¨å›é€€ï¼šhttps://aws.amazon.com/cn/builders-library/timeouts-retries-and-backoff-with-jitter/ è‘—ä½œæƒå½’æ‰€æœ‰ åŸæ–‡é“¾æ¥ï¼šhttps://javaguide.cn/high-availability/timeout-and-retry.html\n"},{"id":72,"href":"/zh/docs/study/Review/java_guide/lyfly_high-availability/ly03ly_limit-request/","title":"æœåŠ¡é™æµè¯¦è§£","section":"é«˜å¯ç”¨","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\né’ˆå¯¹è½¯ä»¶ç³»ç»Ÿæ¥è¯´ï¼Œé™æµå°±æ˜¯å¯¹è¯·æ±‚çš„é€Ÿç‡è¿›è¡Œé™åˆ¶ï¼Œé¿å…ç¬æ—¶çš„å¤§é‡è¯·æ±‚å‡»å®è½¯ä»¶ç³»ç»Ÿã€‚æ¯•ç«Ÿï¼Œè½¯ä»¶ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›æ˜¯æœ‰é™çš„ã€‚å¦‚æœè¯´è¶…è¿‡äº†å…¶å¤„ç†èƒ½åŠ›çš„èŒƒå›´ï¼Œè½¯ä»¶ç³»ç»Ÿå¯èƒ½ç›´æ¥å°±æŒ‚æ‰äº†ã€‚\né™æµå¯èƒ½ä¼šå¯¼è‡´ç”¨æˆ·çš„è¯·æ±‚æ— æ³•è¢«æ­£ç¡®å¤„ç†ï¼Œä¸è¿‡ï¼Œè¿™å¾€å¾€ä¹Ÿæ˜¯æƒè¡¡äº†è½¯ä»¶ç³»ç»Ÿçš„ç¨³å®šæ€§ä¹‹åå¾—åˆ°çš„æœ€ä¼˜è§£ã€‚\nç°å®ç”Ÿæ´»ä¸­ï¼Œå¤„å¤„éƒ½æœ‰é™æµçš„å®é™…åº”ç”¨ï¼Œå°±æ¯”å¦‚æ’é˜Ÿä¹°ç¥¨æ˜¯ä¸ºäº†é¿å…å¤§é‡ç”¨æˆ·æ¶Œå…¥è´­ç¥¨è€Œå¯¼è‡´å”®ç¥¨å‘˜æ— æ³•å¤„ç†ã€‚\nå¸¸è§é™æµç®—æ³•æœ‰å“ªäº›ï¼Ÿ # ç®€å•ä»‹ç» 4 ç§éå¸¸å¥½ç†è§£å¹¶ä¸”å®¹æ˜“å®ç°çš„é™æµç®—æ³•ï¼\nå›¾ç‰‡æ¥æºäº InfoQ çš„ä¸€ç¯‡æ–‡ç« ã€Šåˆ†å¸ƒå¼æœåŠ¡é™æµå®æˆ˜ï¼Œå·²ç»ä¸ºä½ æ’å¥½å‘äº†ã€‹ã€‚\nå›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³• # å›ºå®šçª—å£å…¶å®å°±æ˜¯æ—¶é—´çª—å£ã€‚å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³• è§„å®šäº†æˆ‘ä»¬å•ä½æ—¶é—´å¤„ç†çš„è¯·æ±‚æ•°é‡ã€‚\nå‡å¦‚æˆ‘ä»¬è§„å®šç³»ç»Ÿä¸­æŸä¸ªæ¥å£ 1 åˆ†é’Ÿåªèƒ½è®¿é—® 33 æ¬¡çš„è¯ï¼Œä½¿ç”¨å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•çš„å®ç°æ€è·¯å¦‚ä¸‹ï¼š\nç»™å®šä¸€ä¸ªå˜é‡ counter æ¥è®°å½•å½“å‰æ¥å£å¤„ç†çš„è¯·æ±‚æ•°é‡ï¼Œåˆå§‹å€¼ä¸º 0ï¼ˆä»£è¡¨æ¥å£å½“å‰ 1 åˆ†é’Ÿå†…è¿˜æœªå¤„ç†è¯·æ±‚ï¼‰ã€‚ 1 åˆ†é’Ÿä¹‹å†…æ¯å¤„ç†ä¸€ä¸ªè¯·æ±‚ä¹‹åå°±å°† counter+1 ï¼Œå½“ counter=33 ä¹‹åï¼ˆä¹Ÿå°±æ˜¯è¯´åœ¨è¿™ 1 åˆ†é’Ÿå†…æ¥å£å·²ç»è¢«è®¿é—® 33 æ¬¡çš„è¯ï¼‰ï¼Œåç»­çš„è¯·æ±‚å°±ä¼šè¢«å…¨éƒ¨æ‹’ç»ã€‚ ç­‰åˆ° 1 åˆ†é’Ÿç»“æŸåï¼Œå°† counter é‡ç½® 0ï¼Œé‡æ–°å¼€å§‹è®¡æ•°ã€‚ è¿™ç§é™æµç®—æ³•æ— æ³•ä¿è¯é™æµé€Ÿç‡ï¼Œå› è€Œæ— æ³•ä¿è¯çªç„¶æ¿€å¢çš„æµé‡ã€‚\nå°±æ¯”å¦‚è¯´æˆ‘ä»¬é™åˆ¶æŸä¸ªæ¥å£ 1 åˆ†é’Ÿåªèƒ½è®¿é—® 1000 æ¬¡ï¼Œè¯¥æ¥å£çš„ QPS ä¸º 500ï¼Œå‰ 55s è¿™ä¸ªæ¥å£ 1 ä¸ªè¯·æ±‚æ²¡æœ‰æ¥æ”¶ï¼Œå 1s çªç„¶æ¥æ”¶äº† 1000 ä¸ªè¯·æ±‚ã€‚ç„¶åï¼Œåœ¨å½“å‰åœºæ™¯ä¸‹ï¼Œè¿™ 1000 ä¸ªè¯·æ±‚åœ¨ 1s å†…æ˜¯æ²¡åŠæ³•è¢«å¤„ç†çš„ï¼Œç³»ç»Ÿç›´æ¥å°±è¢«ç¬æ—¶çš„å¤§é‡è¯·æ±‚ç»™å‡»å®äº†ã€‚\næ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³• # æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³• ç®—çš„ä¸Šæ˜¯å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•çš„å‡çº§ç‰ˆã€‚\næ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•ç›¸æ¯”äºå›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•çš„ä¼˜åŒ–åœ¨äºï¼šå®ƒæŠŠæ—¶é—´ä»¥ä¸€å®šæ¯”ä¾‹åˆ†ç‰‡(å³åˆ†ç‰‡ååº”ç”¨\u0026quot;å›ºå®šçª—å£è®¡æ•°å™¨\u0026quot;ç®—æ³•) ã€‚\nä¾‹å¦‚æˆ‘ä»¬çš„æ¥å£é™æµæ¯åˆ†é’Ÿå¤„ç† 60 ä¸ªè¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ 1 åˆ†é’Ÿåˆ†ä¸º 60 ä¸ªçª—å£(æ¯ä¸ªçª—å£æ—¶1ç§’)ã€‚æ¯éš” 1 ç§’ç§»åŠ¨ä¸€æ¬¡ï¼Œæ¯ä¸ªçª—å£ä¸€ç§’åªèƒ½å¤„ç† ä¸å¤§äº 60(è¯·æ±‚æ•°)/60ï¼ˆçª—å£æ•°ï¼‰ çš„è¯·æ±‚ï¼Œ å¦‚æœå½“å‰çª—å£çš„è¯·æ±‚è®¡æ•°æ€»å’Œè¶…è¿‡äº†é™åˆ¶çš„æ•°é‡çš„è¯å°±ä¸å†å¤„ç†å…¶ä»–è¯·æ±‚ã€‚\næ„Ÿè§‰ä¸Šé¢çš„ä¾‹å­å’Œå›¾æ²¡åŒ¹é…ä¸Šï¼Œåº”è¯¥æ˜¯\nä¾‹å¦‚æˆ‘ä»¬çš„æ¥å£é™æµæ¯åˆ†é’Ÿå¤„ç† 300 ä¸ªè¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ 1 åˆ†é’Ÿåˆ†ä¸º 60 ä¸ªçª—å£(æ¯ä¸ªçª—å£æ—¶1ç§’)ã€‚æ¯éš” 1 ç§’ç§»åŠ¨ä¸€æ¬¡ï¼Œæ¯ä¸ªçª—å£ä¸€ç§’åªèƒ½å¤„ç† ä¸å¤§äº 300(è¯·æ±‚æ•°)/60ï¼ˆçª—å£æ•°ï¼‰ çš„è¯·æ±‚ï¼Œ å¦‚æœå½“å‰çª—å£çš„è¯·æ±‚è®¡æ•°æ€»å’Œè¶…è¿‡äº†é™åˆ¶çš„æ•°é‡çš„è¯å°±ä¸å†å¤„ç†å…¶ä»–è¯·æ±‚ã€‚\nå¾ˆæ˜¾ç„¶ï¼Œ å½“æ»‘åŠ¨çª—å£çš„æ ¼å­åˆ’åˆ†çš„è¶Šå¤šï¼Œæ»‘åŠ¨çª—å£çš„æ»šåŠ¨å°±è¶Šå¹³æ»‘ï¼Œé™æµçš„ç»Ÿè®¡å°±ä¼šè¶Šç²¾ç¡®ã€‚\n]\næ¼æ¡¶ç®—æ³• # æˆ‘ä»¬å¯ä»¥æŠŠå‘è¯·æ±‚çš„åŠ¨ä½œæ¯”ä½œæˆæ³¨æ°´åˆ°æ¡¶ä¸­ï¼Œæˆ‘ä»¬å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹å¯ä»¥æ¯”å–»ä¸ºæ¼æ¡¶æ¼æ°´ã€‚æˆ‘ä»¬å¾€æ¡¶ä¸­ä»¥ä»»æ„é€Ÿç‡æµå…¥æ°´ï¼Œä»¥ä¸€å®šé€Ÿç‡æµå‡ºæ°´ã€‚å½“æ°´è¶…è¿‡æ¡¶æµé‡åˆ™ä¸¢å¼ƒï¼Œå› ä¸ºæ¡¶å®¹é‡æ˜¯ä¸å˜çš„ï¼Œä¿è¯äº†æ•´ä½“çš„é€Ÿç‡ã€‚\nå¦‚æœæƒ³è¦å®ç°è¿™ä¸ªç®—æ³•çš„è¯ä¹Ÿå¾ˆç®€å•ï¼Œå‡†å¤‡ä¸€ä¸ªé˜Ÿåˆ—ç”¨æ¥ä¿å­˜è¯·æ±‚ï¼Œç„¶åæˆ‘ä»¬å®šæœŸä»é˜Ÿåˆ—ä¸­æ‹¿è¯·æ±‚æ¥æ‰§è¡Œå°±å¥½äº†ï¼ˆå’Œæ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°/é™æµçš„æ€æƒ³æ˜¯ä¸€æ ·çš„ï¼‰ã€‚\nä»¤ç‰Œæ¡¶ç®—æ³• # ä»¤ç‰Œæ¡¶ç®—æ³•ä¹Ÿæ¯”è¾ƒç®€å•ã€‚å’Œæ¼æ¡¶ç®—æ³•ç®—æ³•ä¸€æ ·ï¼Œæˆ‘ä»¬çš„ä¸»è§’è¿˜æ˜¯æ¡¶ï¼ˆè¿™é™æµç®—æ³•å’Œæ¡¶è¿‡ä¸å»å•Šï¼‰ã€‚ä¸è¿‡ç°åœ¨æ¡¶é‡Œè£…çš„æ˜¯ä»¤ç‰Œäº†ï¼Œè¯·æ±‚åœ¨è¢«å¤„ç†ä¹‹å‰éœ€è¦æ‹¿åˆ°ä¸€ä¸ªä»¤ç‰Œï¼Œè¯·æ±‚å¤„ç†å®Œæ¯•ä¹‹åå°†è¿™ä¸ªä»¤ç‰Œä¸¢å¼ƒï¼ˆåˆ é™¤ï¼‰ã€‚æˆ‘ä»¬æ ¹æ®é™æµå¤§å°ï¼ŒæŒ‰ç…§ä¸€å®šçš„é€Ÿç‡å¾€æ¡¶é‡Œæ·»åŠ ä»¤ç‰Œã€‚å¦‚æœæ¡¶è£…æ»¡äº†ï¼Œå°±ä¸èƒ½ç»§ç»­å¾€é‡Œé¢ç»§ç»­æ·»åŠ ä»¤ç‰Œäº†ã€‚\nå•æœºé™æµæ€ä¹ˆåšï¼Ÿ # å•æœºé™æµé’ˆå¯¹çš„æ˜¯å•ä½“æ¶æ„åº”ç”¨ã€‚\nå•æœºé™æµå¯ä»¥ç›´æ¥ä½¿ç”¨ Google Guava è‡ªå¸¦çš„é™æµå·¥å…·ç±» RateLimiter ã€‚ RateLimiter åŸºäºä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œå¯ä»¥åº”å¯¹çªå‘æµé‡ã€‚\nGuava åœ°å€ï¼šhttps://github.com/google/guava\né™¤äº†æœ€åŸºæœ¬çš„ä»¤ç‰Œæ¡¶ç®—æ³•(å¹³æ»‘çªå‘é™æµ)å®ç°ä¹‹å¤–ï¼ŒGuava çš„RateLimiterè¿˜æä¾›äº† å¹³æ»‘é¢„çƒ­é™æµ çš„ç®—æ³•å®ç°ã€‚\nå¹³æ»‘çªå‘é™æµå°±æ˜¯æŒ‰ç…§æŒ‡å®šçš„é€Ÿç‡æ”¾ä»¤ç‰Œåˆ°æ¡¶é‡Œï¼Œè€Œå¹³æ»‘é¢„çƒ­é™æµä¼šæœ‰ä¸€æ®µé¢„çƒ­æ—¶é—´ï¼Œé¢„çƒ­æ—¶é—´ä¹‹å†…ï¼Œé€Ÿç‡ä¼šé€æ¸æå‡åˆ°é…ç½®çš„é€Ÿç‡ã€‚\næˆ‘ä»¬ä¸‹é¢é€šè¿‡ä¸¤ä¸ªç®€å•çš„å°ä¾‹å­æ¥è¯¦ç»†äº†è§£å§ï¼\næˆ‘ä»¬ç›´æ¥åœ¨é¡¹ç›®ä¸­å¼•å…¥ Guava ç›¸å…³çš„ä¾èµ–å³å¯ä½¿ç”¨ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.google.guava\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;guava\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;31.0.1-jre\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Guava å¹³æ»‘çªå‘é™æµçš„ Demoã€‚\nimport com.google.common.util.concurrent.RateLimiter; /** * å¾®ä¿¡æœ JavaGuide å›å¤\u0026#34;é¢è¯•çªå‡»\u0026#34;å³å¯å…è´¹é¢†å–ä¸ªäººåŸåˆ›çš„ Java é¢è¯•æ‰‹å†Œ * * @author Guideå“¥ * @date 2021/10/08 19:12 **/ public class RateLimiterDemo { public static void main(String[] args) { // 1s æ”¾ 5 ä¸ªä»¤ç‰Œåˆ°æ¡¶é‡Œä¹Ÿå°±æ˜¯ 0.2s æ”¾ 1ä¸ªä»¤ç‰Œåˆ°æ¡¶é‡Œ //ä¹Ÿå°±æ˜¯1sæ”¾å‡ ä¸ª //public static RateLimiter create(double permitsPerSecond) {} RateLimiter rateLimiter = RateLimiter.create(5); for (int i = 0; i \u0026lt; 10; i++) { //é˜»å¡ç›´åˆ°å¾—åˆ°ä¸€ä¸ªä»¤ç‰Œ ,ä¼šè¿”å›é˜»å¡çš„æ—¶é—´ double sleepingTime = rateLimiter.acquire(1); System.out.printf(\u0026#34;get 1 tokens: %ss%n\u0026#34;, sleepingTime); } } } //æºç  /** * Creates a {@code RateLimiter} with the specified stable throughput, given as \u0026#34;permits per * second\u0026#34; (commonly referred to as \u0026lt;i\u0026gt;QPS\u0026lt;/i\u0026gt;, queries per second). * * \u0026lt;p\u0026gt;The returned {@code RateLimiter} ensures that on average no more than {@code * permitsPerSecond} are issued during any given second, with sustained requests being smoothly * spread over each second. When the incoming request rate exceeds {@code permitsPerSecond} the * rate limiter will release one permit every {@code (1.0 / permitsPerSecond)} seconds. When the * rate limiter is unused, bursts of up to {@code permitsPerSecond} permits will be allowed, with * subsequent requests being smoothly limited at the stable rate of {@code permitsPerSecond}. * * @param permitsPerSecond the rate of the returned {@code RateLimiter}, measured in how many * permits become available per second * @throws IllegalArgumentException if {@code permitsPerSecond} is negative or zero */ // TODO(user): \u0026#34;This is equivalent to // {@code createWithCapacity(permitsPerSecond, 1, TimeUnit.SECONDS)}\u0026#34;. // public static RateLimiter create(double permitsPerSecond) {} //æºç  /** * Acquires the given number of permits from this {@code RateLimiter}, blocking until the request * can be granted. Tells the amount of time slept, if any. * * @param permits the number of permits to acquire * @return time spent sleeping to enforce rate, in seconds; 0.0 if not rate-limited * @throws IllegalArgumentException if the requested number of permits is negative or zero * @since 16.0 (present in 13.0 with {@code void} return type}) */ /* @CanIgnoreReturnValue public double acquire(int permits) { long microsToWait = reserve(permits); stopwatch.sleepMicrosUninterruptibly(microsToWait); return 1.0 * microsToWait / SECONDS.toMicros(1L); } */ è¾“å‡ºï¼š\nget 1 tokens: 0.0s get 1 tokens: 0.188413s get 1 tokens: 0.197811s get 1 tokens: 0.198316s get 1 tokens: 0.19864s get 1 tokens: 0.199363s get 1 tokens: 0.193997s get 1 tokens: 0.199623s get 1 tokens: 0.199357s get 1 tokens: 0.195676s ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Guava å¹³æ»‘é¢„çƒ­é™æµçš„ Demoã€‚\nimport com.google.common.util.concurrent.RateLimiter; import java.util.concurrent.TimeUnit; /** * å¾®ä¿¡æœ JavaGuide å›å¤\u0026#34;é¢è¯•çªå‡»\u0026#34;å³å¯å…è´¹é¢†å–ä¸ªäººåŸåˆ›çš„ Java é¢è¯•æ‰‹å†Œ * * @author Guideå“¥ * @date 2021/10/08 19:12 **/ public class RateLimiterDemo { public static void main(String[] args) { // 1s æ”¾ 5 ä¸ªä»¤ç‰Œåˆ°æ¡¶é‡Œä¹Ÿå°±æ˜¯ 0.2s æ”¾ 1ä¸ªä»¤ç‰Œåˆ°æ¡¶é‡Œ // é¢„çƒ­æ—¶é—´ä¸º3s,ä¹Ÿå°±è¯´åˆšå¼€å§‹çš„ 3s å†…å‘ç‰Œé€Ÿç‡ä¼šé€æ¸æå‡åˆ° 0.2s æ”¾ 1 ä¸ªä»¤ç‰Œåˆ°æ¡¶é‡Œ(æ‰€ä»¥å‰é¢çš„é€Ÿç‡æ¯”è¾ƒå°ï¼Œè·å–éœ€è¦çš„æ—¶é—´æ¯”è¾ƒé•¿) RateLimiter rateLimiter = RateLimiter.create(5, 3, TimeUnit.SECONDS); for (int i = 0; i \u0026lt; 20; i++) { double sleepingTime = rateLimiter.acquire(1); System.out.printf(\u0026#34;get 1 tokens: %sds%n\u0026#34;, sleepingTime); } } } è¾“å‡ºï¼š\nget 1 tokens: 0.0s get 1 tokens: 0.561919s get 1 tokens: 0.516931s get 1 tokens: 0.463798s get 1 tokens: 0.41286s get 1 tokens: 0.356172s get 1 tokens: 0.300489s get 1 tokens: 0.252545s get 1 tokens: 0.203996s get 1 tokens: 0.198359s å¦å¤–ï¼ŒBucket4j æ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„åŸºäºä»¤ç‰Œ/æ¼æ¡¶ç®—æ³•çš„é™æµåº“ã€‚\nBucket4j åœ°å€ï¼šhttps://github.com/vladimir-bukhtoyarov/bucket4j\nç›¸å¯¹äºï¼ŒGuava çš„é™æµå·¥å…·ç±»æ¥è¯´ï¼ŒBucket4j æä¾›çš„é™æµåŠŸèƒ½æ›´åŠ å…¨é¢ã€‚ä¸ä»…æ”¯æŒå•æœºé™æµå’Œåˆ†å¸ƒå¼é™æµï¼Œè¿˜å¯ä»¥é›†æˆç›‘æ§ï¼Œæ­é… Prometheus å’Œ Grafana ä½¿ç”¨ã€‚\nä¸è¿‡ï¼Œæ¯•ç«Ÿ Guava ä¹Ÿåªæ˜¯ä¸€ä¸ªåŠŸèƒ½å…¨é¢çš„å·¥å…·ç±»åº“ï¼Œå…¶æä¾›çš„å¼€ç®±å³ç”¨çš„é™æµåŠŸèƒ½åœ¨å¾ˆå¤šå•æœºåœºæ™¯ä¸‹è¿˜æ˜¯æ¯”è¾ƒå®ç”¨çš„ã€‚\nSpring Cloud Gateway ä¸­è‡ªå¸¦çš„å•æœºé™æµçš„æ—©æœŸç‰ˆæœ¬å°±æ˜¯åŸºäº Bucket4j å®ç°çš„ã€‚åæ¥ï¼Œæ›¿æ¢æˆäº† Resilience4jã€‚\nResilience4j æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å®¹é”™ç»„ä»¶ï¼Œå…¶çµæ„Ÿæ¥è‡ªäº Hystrixã€‚è‡ªNetflix å®£å¸ƒä¸å†ç§¯æå¼€å‘ Hystrix ä¹‹åï¼ŒSpring å®˜æ–¹å’Œ Netflix éƒ½æ›´æ¨èä½¿ç”¨ Resilience4j æ¥åšé™æµç†”æ–­ã€‚\nResilience4j åœ°å€: https://github.com/resilience4j/resilience4j\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨ï¼Œé¡¹ç›®çš„é™æµå’Œç†”æ–­éƒ½æ˜¯è¦ä¸€èµ·åšçš„ã€‚\nResilience4j ä¸ä»…æä¾›é™æµï¼Œè¿˜æä¾›äº†ç†”æ–­ã€è´Ÿè½½ä¿æŠ¤ã€è‡ªåŠ¨é‡è¯•ç­‰ä¿éšœç³»ç»Ÿé«˜å¯ç”¨å¼€ç®±å³ç”¨çš„åŠŸèƒ½ã€‚å¹¶ä¸”ï¼ŒResilience4j çš„ç”Ÿæ€ä¹Ÿæ›´å¥½ï¼Œå¾ˆå¤šç½‘å…³éƒ½ä½¿ç”¨ Resilience4j æ¥åšé™æµç†”æ–­çš„ã€‚\nå› æ­¤ï¼Œåœ¨ç»å¤§éƒ¨åˆ†åœºæ™¯ä¸‹ Resilience4j æˆ–è®¸ä¼šæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚å¦‚æœæ˜¯ä¸€äº›æ¯”è¾ƒç®€å•çš„é™æµåœºæ™¯çš„è¯ï¼ŒGuava æˆ–è€… Bucket4j ä¹Ÿæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚\nåˆ†å¸ƒå¼é™æµæ€ä¹ˆåšï¼Ÿ # åˆ†å¸ƒå¼é™æµé’ˆå¯¹çš„åˆ†å¸ƒå¼/å¾®æœåŠ¡åº”ç”¨æ¶æ„åº”ç”¨ï¼Œåœ¨è¿™ç§æ¶æ„ä¸‹ï¼Œå•æœºé™æµå°±ä¸é€‚ç”¨äº†ï¼Œå› ä¸ºä¼šå­˜åœ¨å¤šç§æœåŠ¡ï¼Œå¹¶ä¸”ä¸€ç§æœåŠ¡ä¹Ÿå¯èƒ½ä¼šè¢«éƒ¨ç½²å¤šä»½ã€‚\nåˆ†å¸ƒå¼é™æµå¸¸è§çš„æ–¹æ¡ˆï¼š\nå€ŸåŠ©ä¸­é—´ä»¶æ¶é™æµ ï¼šå¯ä»¥å€ŸåŠ© Sentinel æˆ–è€…ä½¿ç”¨ Redis æ¥è‡ªå·±å®ç°å¯¹åº”çš„é™æµé€»è¾‘ã€‚ ç½‘å…³å±‚é™æµ ï¼šæ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§æ–¹æ¡ˆï¼Œç›´æ¥åœ¨ç½‘å…³å±‚æŠŠé™æµç»™å®‰æ’ä¸Šäº†ã€‚ä¸è¿‡ï¼Œé€šå¸¸ç½‘å…³å±‚é™æµé€šå¸¸ä¹Ÿéœ€è¦å€ŸåŠ©åˆ°ä¸­é—´ä»¶/æ¡†æ¶ã€‚å°±æ¯”å¦‚ Spring Cloud Gateway çš„åˆ†å¸ƒå¼é™æµå®ç°**RedisRateLimiter**å°±æ˜¯åŸºäº Redis+Lua æ¥å®ç°çš„ï¼Œå†æ¯”å¦‚ Spring Cloud Gateway è¿˜å¯ä»¥æ•´åˆ Sentinel æ¥åšé™æµã€‚ å¦‚æœä½ è¦åŸºäº Redis æ¥æ‰‹åŠ¨å®ç°é™æµé€»è¾‘çš„è¯ï¼Œå»ºè®®é…åˆ Lua è„šæœ¬æ¥åšã€‚\nä¸ºä»€ä¹ˆå»ºè®® Redis+Lua çš„æ–¹å¼ï¼Ÿ ä¸»è¦æœ‰ä¸¤ç‚¹åŸå› ï¼š\nå‡å°‘äº†ç½‘ç»œå¼€é”€ ï¼šæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Lua è„šæœ¬æ¥æ‰¹é‡æ‰§è¡Œå¤šæ¡ Redis å‘½ä»¤ï¼Œè¿™äº› Redis å‘½ä»¤ä¼šè¢«æäº¤åˆ° Redis æœåŠ¡å™¨ä¸€æ¬¡æ€§æ‰§è¡Œå®Œæˆï¼Œå¤§å¹…å‡å°äº†ç½‘ç»œå¼€é”€ã€‚ åŸå­æ€§ ï¼šä¸€æ®µ Lua è„šæœ¬å¯ä»¥è§†ä½œä¸€æ¡å‘½ä»¤æ‰§è¡Œï¼Œä¸€æ®µ Lua è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šæœ‰å…¶ä»–è„šæœ¬æˆ– Redis å‘½ä»¤åŒæ—¶æ‰§è¡Œï¼Œä¿è¯äº†æ“ä½œä¸ä¼šè¢«å…¶ä»–æŒ‡ä»¤æ’å…¥æˆ–æ‰“æ‰°ã€‚ æˆ‘è¿™é‡Œå°±ä¸æ”¾å…·ä½“çš„é™æµè„šæœ¬ä»£ç äº†ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šç°æˆçš„ä¼˜ç§€çš„é™æµè„šæœ¬ä¾›ä½ å‚è€ƒï¼Œå°±æ¯”å¦‚ Apache ç½‘å…³é¡¹ç›® ShenYu çš„ RateLimiter é™æµæ’ä»¶å°±åŸºäº Redis + Lua å®ç°äº†ä»¤ç‰Œæ¡¶ç®—æ³•/å¹¶å‘ä»¤ç‰Œæ¡¶ç®—æ³•ã€æ¼æ¡¶ç®—æ³•ã€æ»‘åŠ¨çª—å£ç®—æ³•ã€‚\nShenYu åœ°å€: https://github.com/apache/incubator-shenyu\næœåŠ¡æ²»ç†ä¹‹è½»é‡çº§ç†”æ–­æ¡†æ¶ Resilience4j ï¼šhttps://xie.infoq.cn/article/14786e571c1a4143ad1ef8f19 è¶…è¯¦ç»†çš„ Guava RateLimiter é™æµåŸç†è§£æï¼šhttps://cloud.tencent.com/developer/article/1408819 å®æˆ˜ Spring Cloud Gateway ä¹‹é™æµç¯‡ ğŸ‘ï¼šhttps://www.aneasystone.com/archives/2020/08/spring-cloud-gateway-current-limiting.html "},{"id":73,"href":"/zh/docs/study/Review/java_guide/lyfly_high-availability/ly02ly_redundancy/","title":"å†—ä½™è®¾è®¡","section":"é«˜å¯ç”¨","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\ntitle category å†—ä½™è®¾è®¡è¯¦è§£ é«˜å¯ç”¨ å†—ä½™è®¾è®¡æ˜¯ä¿è¯ç³»ç»Ÿå’Œæ•°æ®é«˜å¯ç”¨çš„æœ€å¸¸çš„æ‰‹æ®µã€‚\nå¯¹äºæœåŠ¡æ¥è¯´ï¼Œå†—ä½™çš„æ€æƒ³å°±æ˜¯ç›¸åŒçš„æœåŠ¡éƒ¨ç½²å¤šä»½ï¼Œå¦‚æœæ­£åœ¨ä½¿ç”¨çš„æœåŠ¡çªç„¶æŒ‚æ‰çš„è¯ï¼Œç³»ç»Ÿå¯ä»¥å¾ˆå¿«åˆ‡æ¢åˆ°å¤‡ä»½æœåŠ¡ä¸Šï¼Œå¤§å¤§å‡å°‘ç³»ç»Ÿçš„ä¸å¯ç”¨æ—¶é—´ï¼Œæé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚\nå¯¹äºæ•°æ®æ¥è¯´ï¼Œå†—ä½™çš„æ€æƒ³å°±æ˜¯ç›¸åŒçš„æ•°æ®å¤‡ä»½å¤šä»½ï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆç®€å•åœ°æé«˜æ•°æ®çš„å®‰å…¨æ€§ã€‚\nå®é™…ä¸Šï¼Œæ—¥å¸¸ç”Ÿæ´»ä¸­å°±æœ‰éå¸¸å¤šçš„å†—ä½™æ€æƒ³çš„åº”ç”¨ã€‚\næ‹¿æˆ‘è‡ªå·±æ¥è¯´ï¼Œæˆ‘å¯¹äºé‡è¦æ–‡ä»¶çš„ä¿å­˜æ–¹æ³•å°±æ˜¯å†—ä½™æ€æƒ³çš„åº”ç”¨ã€‚æˆ‘æ—¥å¸¸æ‰€ä½¿ç”¨çš„é‡è¦æ–‡ä»¶éƒ½ä¼šåŒæ­¥ä¸€ä»½åœ¨ Github ä»¥åŠä¸ªäººäº‘ç›˜ä¸Šï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯å³ä½¿ç”µè„‘ç¡¬ç›˜æŸåï¼Œæˆ‘ä¹Ÿå¯ä»¥é€šè¿‡ Github æˆ–è€…ä¸ªäººäº‘ç›˜æ‰¾å›è‡ªå·±çš„é‡è¦æ–‡ä»¶ã€‚\né«˜å¯ç”¨é›†ç¾¤ï¼ˆHigh Availability Clusterï¼Œç®€ç§° HA Clusterï¼‰ã€åŒåŸç¾å¤‡ã€å¼‚åœ°ç¾å¤‡ã€åŒåŸå¤šæ´»å’Œå¼‚åœ°å¤šæ´»æ˜¯å†—ä½™æ€æƒ³åœ¨é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡ä¸­æœ€å…¸å‹çš„åº”ç”¨ã€‚\né«˜å¯ç”¨é›†ç¾¤ : åŒä¸€ä»½æœåŠ¡éƒ¨ç½²ä¸¤ä»½æˆ–è€…å¤šä»½ï¼Œå½“æ­£åœ¨ä½¿ç”¨çš„æœåŠ¡çªç„¶æŒ‚æ‰çš„è¯ï¼Œå¯ä»¥åˆ‡æ¢åˆ°å¦å¤–ä¸€å°æœåŠ¡ï¼Œä»è€Œä¿è¯æœåŠ¡çš„é«˜å¯ç”¨ã€‚ åŒåŸç¾å¤‡ ï¼šä¸€æ•´ä¸ªé›†ç¾¤å¯ä»¥éƒ¨ç½²åœ¨åŒä¸€ä¸ªæœºæˆ¿ï¼Œè€ŒåŒåŸç¾å¤‡ä¸­ç›¸åŒæœåŠ¡éƒ¨ç½²åœ¨åŒä¸€ä¸ªåŸå¸‚çš„ä¸åŒæœºæˆ¿ä¸­ã€‚å¹¶ä¸”ï¼Œå¤‡ç”¨æœåŠ¡ä¸å¤„ç†è¯·æ±‚ã€‚è¿™æ ·å¯ä»¥é¿å…æœºæˆ¿å‡ºç°æ„å¤–æƒ…å†µæ¯”å¦‚åœç”µã€ç«ç¾ã€‚ å¼‚åœ°ç¾å¤‡ ï¼šç±»ä¼¼äºåŒåŸç¾å¤‡ï¼Œä¸åŒçš„æ˜¯ï¼Œç›¸åŒæœåŠ¡éƒ¨ç½²åœ¨å¼‚åœ°ï¼ˆé€šå¸¸è·ç¦»è¾ƒè¿œï¼Œç”šè‡³æ˜¯åœ¨ä¸åŒçš„åŸå¸‚æˆ–è€…å›½å®¶ï¼‰çš„ä¸åŒæœºæˆ¿ä¸­ åŒåŸå¤šæ´» ï¼šç±»ä¼¼äºåŒåŸç¾å¤‡ï¼Œä½†å¤‡ç”¨æœåŠ¡å¯ä»¥å¤„ç†è¯·æ±‚ï¼Œè¿™æ ·å¯ä»¥å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºï¼Œæé«˜ç³»ç»Ÿçš„å¹¶å‘ã€‚ å¼‚åœ°å¤šæ´» : å°†æœåŠ¡éƒ¨ç½²åœ¨å¼‚åœ°çš„ä¸åŒæœºæˆ¿ä¸­ï¼Œå¹¶ä¸”ï¼Œå®ƒä»¬å¯ä»¥åŒæ—¶å¯¹å¤–æä¾›æœåŠ¡ã€‚ é«˜å¯ç”¨é›†ç¾¤å•çº¯æ˜¯æœåŠ¡çš„å†—ä½™ï¼Œå¹¶æ²¡æœ‰å¼ºè°ƒåœ°åŸŸã€‚åŒåŸç¾å¤‡ã€å¼‚åœ°ç¾å¤‡ã€åŒåŸå¤šæ´»å’Œå¼‚åœ°å¤šæ´»å®ç°äº†åœ°åŸŸä¸Šçš„å†—ä½™ã€‚\nåŒåŸå’Œå¼‚åœ°çš„ä¸»è¦åŒºåˆ«åœ¨äºæœºæˆ¿ä¹‹é—´çš„è·ç¦»ã€‚å¼‚åœ°é€šå¸¸è·ç¦»è¾ƒè¿œï¼Œç”šè‡³æ˜¯åœ¨ä¸åŒçš„åŸå¸‚æˆ–è€…å›½å®¶ã€‚\nå’Œä¼ ç»Ÿçš„ç¾å¤‡è®¾è®¡ç›¸æ¯”ï¼ŒåŒåŸå¤šæ´»å’Œå¼‚åœ°å¤šæ´»æœ€æ˜æ˜¾çš„æ”¹å˜åœ¨äº**â€œå¤šæ´»â€ï¼Œå³æ‰€æœ‰ç«™ç‚¹éƒ½æ˜¯åŒæ—¶åœ¨å¯¹å¤–æä¾›æœåŠ¡çš„ã€‚å¼‚åœ°å¤šæ´»æ˜¯ä¸ºäº†åº”å¯¹çªå‘çŠ¶å†µæ¯”å¦‚ç«ç¾**ã€åœ°éœ‡ç­‰è‡ªç„¶æˆ–è€…äººä¸ºç¾å®³ã€‚\nå…‰åšå¥½å†—ä½™è¿˜ä¸å¤Ÿï¼Œå¿…é¡»è¦é…åˆä¸Š æ•…éšœè½¬ç§» æ‰å¯ä»¥ï¼ æ‰€è°“æ•…éšœè½¬ç§»ï¼Œç®€å•æ¥è¯´å°±æ˜¯å®ç°ä¸å¯ç”¨æœåŠ¡å¿«é€Ÿä¸”è‡ªåŠ¨åœ°åˆ‡æ¢åˆ°å¯ç”¨æœåŠ¡ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸éœ€è¦äººä¸ºå¹²æ¶‰ã€‚\nä¸¾ä¸ªä¾‹å­ï¼šå“¨å…µæ¨¡å¼çš„ Redis é›†ç¾¤ä¸­ï¼Œå¦‚æœ Sentinelï¼ˆå“¨å…µï¼‰ æ£€æµ‹åˆ° master èŠ‚ç‚¹å‡ºç°æ•…éšœçš„è¯ï¼Œ å®ƒå°±ä¼šå¸®åŠ©æˆ‘ä»¬å®ç°æ•…éšœè½¬ç§»ï¼Œè‡ªåŠ¨å°†æŸä¸€å° slave å‡çº§ä¸º masterï¼Œç¡®ä¿æ•´ä¸ª Redis ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚æ•´ä¸ªè¿‡ç¨‹å®Œå…¨è‡ªåŠ¨ï¼Œä¸éœ€è¦äººå·¥ä»‹å…¥ã€‚æˆ‘åœ¨ã€ŠJava é¢è¯•æŒ‡åŒ—ã€‹çš„ã€ŒæŠ€æœ¯é¢è¯•é¢˜ç¯‡ã€ä¸­çš„æ•°æ®åº“éƒ¨åˆ†è¯¦ç»†ä»‹ç»äº† Redis é›†ç¾¤ç›¸å…³çš„çŸ¥è¯†ç‚¹\u0026amp;é¢è¯•é¢˜ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥çœ‹çœ‹ã€‚\nå†ä¸¾ä¸ªä¾‹å­ï¼šNginx å¯ä»¥ç»“åˆ Keepalived æ¥å®ç°é«˜å¯ç”¨ã€‚å¦‚æœ Nginx ä¸»æœåŠ¡å™¨å®•æœºçš„è¯ï¼ŒKeepalived å¯ä»¥è‡ªåŠ¨è¿›è¡Œæ•…éšœè½¬ç§»ï¼Œå¤‡ç”¨ Nginx ä¸»æœåŠ¡å™¨å‡çº§ä¸ºä¸»æœåŠ¡ã€‚å¹¶ä¸”ï¼Œè¿™ä¸ªåˆ‡æ¢å¯¹å¤–æ˜¯é€æ˜çš„ï¼Œå› ä¸ºä½¿ç”¨çš„è™šæ‹Ÿ IPï¼Œè™šæ‹Ÿ IP ä¸ä¼šæ”¹å˜ã€‚æˆ‘åœ¨ã€ŠJava é¢è¯•æŒ‡åŒ—ã€‹çš„ã€ŒæŠ€æœ¯é¢è¯•é¢˜ç¯‡ã€ä¸­çš„ã€ŒæœåŠ¡å™¨ã€éƒ¨åˆ†è¯¦ç»†ä»‹ç»äº† Nginx ç›¸å…³çš„çŸ¥è¯†ç‚¹\u0026amp;é¢è¯•é¢˜ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥çœ‹çœ‹ã€‚\nå¼‚åœ°å¤šæ´»æ¶æ„å®æ–½èµ·æ¥éå¸¸éš¾ï¼Œéœ€è¦è€ƒè™‘çš„å› ç´ éå¸¸å¤šã€‚æœ¬äººä¸æ‰ï¼Œå®é™…é¡¹ç›®ä¸­å¹¶æ²¡æœ‰å®è·µè¿‡å¼‚åœ°å¤šæ´»æ¶æ„ï¼Œæˆ‘å¯¹å…¶äº†è§£è¿˜åœç•™åœ¨ä¹¦æœ¬çŸ¥è¯†ã€‚\nå¦‚æœä½ æƒ³è¦æ·±å…¥å­¦ä¹ å¼‚åœ°å¤šæ´»ç›¸å…³çš„çŸ¥è¯†ï¼Œæˆ‘è¿™é‡Œæ¨èå‡ ç¯‡æˆ‘è§‰å¾—è¿˜ä¸é”™çš„æ–‡ç« ï¼š\nææ‡‚å¼‚åœ°å¤šæ´»ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº†- æ°´æ»´ä¸é“¶å¼¹ - 2021 å››æ­¥æ„å»ºå¼‚åœ°å¤šæ´» ã€Šä»é›¶å¼€å§‹å­¦æ¶æ„ã€‹â€” 28 | ä¸šåŠ¡é«˜å¯ç”¨çš„ä¿éšœï¼šå¼‚åœ°å¤šæ´»æ¶æ„ ä¸è¿‡ï¼Œè¿™äº›æ–‡ç« å¤§å¤šä¹Ÿéƒ½æ˜¯åœ¨ä»‹ç»æ¦‚å¿µçŸ¥è¯†ã€‚ç›®å‰ï¼Œç½‘ä¸Šè¿˜ç¼ºå°‘çœŸæ­£ä»‹ç»å…·ä½“è¦å¦‚ä½•å»å®è·µè½åœ°å¼‚åœ°å¤šæ´»æ¶æ„çš„èµ„æ–™ã€‚\nç¾å¤‡ = å®¹ç¾+å¤‡ä»½ã€‚\nå¤‡ä»½ ï¼š å°†ç³»ç»Ÿæ‰€äº§ç”Ÿçš„çš„æ‰€æœ‰é‡è¦æ•°æ®å¤šå¤‡ä»½å‡ ä»½ã€‚ å®¹ç¾ ï¼š åœ¨å¼‚åœ°å»ºç«‹ä¸¤ä¸ªå®Œå…¨ç›¸åŒçš„ç³»ç»Ÿã€‚å½“æŸä¸ªåœ°æ–¹çš„ç³»ç»Ÿçªç„¶æŒ‚æ‰ï¼Œæ•´ä¸ªåº”ç”¨ç³»ç»Ÿå¯ä»¥åˆ‡æ¢åˆ°å¦ä¸€ä¸ªï¼Œè¿™æ ·ç³»ç»Ÿå°±å¯ä»¥æ­£å¸¸æä¾›æœåŠ¡äº†ã€‚ å¼‚åœ°å¤šæ´» æè¿°çš„æ˜¯å°†æœåŠ¡éƒ¨ç½²åœ¨å¼‚åœ°å¹¶ä¸”æœåŠ¡åŒæ—¶å¯¹å¤–æä¾›æœåŠ¡ã€‚å’Œä¼ ç»Ÿçš„ç¾å¤‡è®¾è®¡çš„æœ€ä¸»è¦åŒºåˆ«åœ¨äºâ€œå¤šæ´»â€ï¼Œå³æ‰€æœ‰ç«™ç‚¹éƒ½æ˜¯åŒæ—¶åœ¨å¯¹å¤–æä¾›æœåŠ¡çš„ã€‚å¼‚åœ°å¤šæ´»æ˜¯ä¸ºäº†åº”å¯¹çªå‘çŠ¶å†µæ¯”å¦‚ç«ç¾ã€åœ°éœ‡ç­‰è‡ªç„¶æˆ–è€…äººä¸ºç¾å®³ã€‚\n"},{"id":74,"href":"/zh/docs/study/Review/java_guide/lyfly_high-availability/ly01ly_high-availability-system-design/","title":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡æŒ‡å—","section":"é«˜å¯ç”¨","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nä»€ä¹ˆæ˜¯é«˜å¯ç”¨ï¼Ÿå¯ç”¨æ€§çš„åˆ¤æ–­æ ‡å‡†æ˜¯å•¥ï¼Ÿ # é«˜å¯ç”¨æè¿°çš„æ˜¯ä¸€ä¸ªç³»ç»Ÿåœ¨å¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯å¯ç”¨çš„ï¼Œå¯ä»¥ä¸ºæˆ‘ä»¬æä¾›æœåŠ¡çš„ã€‚é«˜å¯ç”¨ä»£è¡¨ç³»ç»Ÿå³ä½¿åœ¨å‘ç”Ÿç¡¬ä»¶æ•…éšœæˆ–è€…ç³»ç»Ÿå‡çº§çš„æ—¶å€™ï¼ŒæœåŠ¡ä»ç„¶æ˜¯å¯ç”¨çš„ã€‚\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨å¤šå°‘ä¸ª 9 æ¥è¯„åˆ¤ä¸€ä¸ªç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œæ¯”å¦‚ 99.9999% å°±æ˜¯ä»£è¡¨è¯¥ç³»ç»Ÿåœ¨æ‰€æœ‰çš„è¿è¡Œæ—¶é—´ä¸­åªæœ‰ 0.0001% çš„æ—¶é—´æ˜¯ä¸å¯ç”¨çš„ï¼Œè¿™æ ·çš„ç³»ç»Ÿå°±æ˜¯éå¸¸éå¸¸é«˜å¯ç”¨çš„äº†ï¼å½“ç„¶ï¼Œä¹Ÿä¼šæœ‰ç³»ç»Ÿå¦‚æœå¯ç”¨æ€§ä¸å¤ªå¥½çš„è¯ï¼Œå¯èƒ½è¿ 9 éƒ½ä¸Šä¸äº†ã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œç³»ç»Ÿçš„å¯ç”¨æ€§è¿˜å¯ä»¥ç”¨æŸåŠŸèƒ½çš„å¤±è´¥æ¬¡æ•°ä¸æ€»çš„è¯·æ±‚æ¬¡æ•°ä¹‹æ¯”æ¥è¡¡é‡ï¼Œæ¯”å¦‚å¯¹ç½‘ç«™è¯·æ±‚ 1000 æ¬¡ï¼Œå…¶ä¸­æœ‰ 10 æ¬¡è¯·æ±‚å¤±è´¥ï¼Œé‚£ä¹ˆå¯ç”¨æ€§å°±æ˜¯ 99%ã€‚\nå“ªäº›æƒ…å†µä¼šå¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨ï¼Ÿ # é»‘å®¢æ”»å‡»ï¼› ç¡¬ä»¶æ•…éšœï¼Œæ¯”å¦‚æœåŠ¡å™¨åæ‰ã€‚ å¹¶å‘é‡/ç”¨æˆ·è¯·æ±‚é‡æ¿€å¢å¯¼è‡´æ•´ä¸ªæœåŠ¡å®•æ‰æˆ–è€…éƒ¨åˆ†æœåŠ¡ä¸å¯ç”¨ã€‚ ä»£ç ä¸­çš„åå‘³é“å¯¼è‡´å†…å­˜æ³„æ¼æˆ–è€…å…¶ä»–é—®é¢˜å¯¼è‡´ç¨‹åºæŒ‚æ‰ã€‚ ç½‘ç«™æ¶æ„æŸä¸ªé‡è¦çš„è§’è‰²æ¯”å¦‚ Nginx æˆ–è€…æ•°æ®åº“çªç„¶ä¸å¯ç”¨ã€‚ è‡ªç„¶ç¾å®³æˆ–è€…äººä¸ºç ´åã€‚ \u0026hellip;\u0026hellip; æœ‰å“ªäº›æé«˜ç³»ç»Ÿå¯ç”¨æ€§çš„æ–¹æ³•ï¼Ÿ # æ³¨é‡ä»£ç è´¨é‡ï¼Œæµ‹è¯•ä¸¥æ ¼æŠŠå…³ # æˆ‘è§‰å¾—è¿™ä¸ªæ˜¯æœ€æœ€æœ€é‡è¦çš„ï¼Œä»£ç è´¨é‡æœ‰é—®é¢˜æ¯”å¦‚æ¯”è¾ƒå¸¸è§çš„å†…å­˜æ³„æ¼ã€å¾ªç¯ä¾èµ–éƒ½æ˜¯å¯¹ç³»ç»Ÿå¯ç”¨æ€§æå¤§çš„æŸå®³ã€‚å¤§å®¶éƒ½å–œæ¬¢è°ˆé™æµã€é™çº§ã€ç†”æ–­ï¼Œä½†æ˜¯æˆ‘è§‰å¾—ä»ä»£ç è´¨é‡è¿™ä¸ªæºå¤´æŠŠå…³æ˜¯é¦–å…ˆè¦åšå¥½çš„ä¸€ä»¶å¾ˆé‡è¦çš„äº‹æƒ…ã€‚å¦‚ä½•æé«˜ä»£ç è´¨é‡ï¼Ÿæ¯”è¾ƒå®é™…å¯ç”¨çš„å°±æ˜¯ CodeReviewï¼Œä¸è¦åœ¨ä¹æ¯å¤©å¤šèŠ±çš„é‚£ 1 ä¸ªå°æ—¶å·¦å³çš„æ—¶é—´ï¼Œä½œç”¨å¯å¤§ç€å‘¢ï¼\nå¦å¤–ï¼Œå®‰åˆ©å‡ ä¸ªå¯¹æé«˜ä»£ç è´¨é‡æœ‰å®é™…æ•ˆæœçš„ç¥å™¨ï¼š\nSonarqubeï¼› Alibaba å¼€æºçš„ Java è¯Šæ–­å·¥å…· Arthasï¼› é˜¿é‡Œå·´å·´ Java ä»£ç è§„èŒƒï¼ˆAlibaba Java Code Guidelinesï¼‰ï¼› IDEA è‡ªå¸¦çš„ä»£ç åˆ†æç­‰å·¥å…·ã€‚ ä½¿ç”¨é›†ç¾¤ï¼Œå‡å°‘å•ç‚¹æ•…éšœ # å…ˆæ‹¿å¸¸ç”¨çš„ Redis ä¸¾ä¸ªä¾‹å­ï¼æˆ‘ä»¬å¦‚ä½•ä¿è¯æˆ‘ä»¬çš„ Redis ç¼“å­˜é«˜å¯ç”¨å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ä½¿ç”¨é›†ç¾¤ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚å½“æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª Redis å®ä¾‹ä½œä¸ºç¼“å­˜çš„æ—¶å€™ï¼Œè¿™ä¸ª Redis å®ä¾‹æŒ‚äº†ä¹‹åï¼Œæ•´ä¸ªç¼“å­˜æœåŠ¡å¯èƒ½å°±æŒ‚äº†ã€‚ä½¿ç”¨äº†é›†ç¾¤ä¹‹åï¼Œå³ä½¿ä¸€å° Redis å®ä¾‹æŒ‚äº†ï¼Œä¸åˆ°ä¸€ç§’å°±ä¼šæœ‰å¦å¤–ä¸€å° Redis å®ä¾‹é¡¶ä¸Šã€‚\né™æµ # æµé‡æ§åˆ¶ï¼ˆflow controlï¼‰ï¼Œå…¶åŸç†æ˜¯ç›‘æ§åº”ç”¨æµé‡çš„ QPS æˆ–å¹¶å‘çº¿ç¨‹æ•°ç­‰æŒ‡æ ‡ï¼Œå½“è¾¾åˆ°æŒ‡å®šçš„é˜ˆå€¼æ—¶å¯¹æµé‡è¿›è¡Œæ§åˆ¶ï¼Œä»¥é¿å…è¢«ç¬æ—¶çš„æµé‡é«˜å³°å†²å®ï¼Œä»è€Œä¿éšœåº”ç”¨çš„é«˜å¯ç”¨æ€§ã€‚â€”â€”æ¥è‡ª alibaba-Sentinel çš„ wikiã€‚\nè¶…æ—¶å’Œé‡è¯•æœºåˆ¶è®¾ç½® # ä¸€æ—¦ç”¨æˆ·è¯·æ±‚è¶…è¿‡æŸä¸ªæ—¶é—´çš„å¾—ä¸åˆ°å“åº”ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚è¿™ä¸ªæ˜¯éå¸¸é‡è¦çš„ï¼Œå¾ˆå¤šçº¿ä¸Šç³»ç»Ÿæ•…éšœéƒ½æ˜¯å› ä¸ºæ²¡æœ‰è¿›è¡Œè¶…æ—¶è®¾ç½®æˆ–è€…è¶…æ—¶è®¾ç½®çš„æ–¹å¼ä¸å¯¹å¯¼è‡´çš„ã€‚æˆ‘ä»¬åœ¨è¯»å–ç¬¬ä¸‰æ–¹æœåŠ¡çš„æ—¶å€™ï¼Œå°¤å…¶é€‚åˆè®¾ç½®è¶…æ—¶å’Œé‡è¯•æœºåˆ¶ã€‚ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨ä¸€äº› RPC æ¡†æ¶çš„æ—¶å€™ï¼Œè¿™äº›æ¡†æ¶éƒ½è‡ªå¸¦çš„è¶…æ—¶é‡è¯•çš„é…ç½®ã€‚å¦‚æœä¸è¿›è¡Œè¶…æ—¶è®¾ç½®å¯èƒ½ä¼šå¯¼è‡´è¯·æ±‚å“åº”é€Ÿåº¦æ…¢ï¼Œç”šè‡³å¯¼è‡´è¯·æ±‚å †ç§¯è¿›è€Œè®©ç³»ç»Ÿæ— æ³•å†å¤„ç†è¯·æ±‚ã€‚é‡è¯•çš„æ¬¡æ•°ä¸€èˆ¬è®¾ä¸º 3 æ¬¡ï¼Œå†å¤šæ¬¡çš„é‡è¯•æ²¡æœ‰å¥½å¤„ï¼Œåè€Œä¼šåŠ é‡æœåŠ¡å™¨å‹åŠ›ï¼ˆéƒ¨åˆ†åœºæ™¯ä½¿ç”¨å¤±è´¥é‡è¯•æœºåˆ¶ä¼šä¸å¤ªé€‚åˆï¼‰ã€‚\nç†”æ–­æœºåˆ¶ # è¶…æ—¶å’Œé‡è¯•æœºåˆ¶è®¾ç½®ä¹‹å¤–ï¼Œç†”æ–­æœºåˆ¶ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ã€‚ ç†”æ–­æœºåˆ¶è¯´çš„æ˜¯ç³»ç»Ÿè‡ªåŠ¨æ”¶é›†æ‰€ä¾èµ–æœåŠ¡çš„èµ„æºä½¿ç”¨æƒ…å†µå’Œæ€§èƒ½æŒ‡æ ‡ï¼Œå½“æ‰€ä¾èµ–çš„æœåŠ¡æ¶åŒ–æˆ–è€…è°ƒç”¨å¤±è´¥æ¬¡æ•°è¾¾åˆ°æŸä¸ªé˜ˆå€¼çš„æ—¶å€™å°±è¿…é€Ÿå¤±è´¥ï¼Œè®©å½“å‰ç³»ç»Ÿç«‹å³åˆ‡æ¢ä¾èµ–å…¶ä»–å¤‡ç”¨æœåŠ¡ã€‚ æ¯”è¾ƒå¸¸ç”¨çš„æµé‡æ§åˆ¶å’Œç†”æ–­é™çº§æ¡†æ¶æ˜¯ Netflix çš„ Hystrix å’Œ alibaba çš„ Sentinelã€‚\nå¼‚æ­¥è°ƒç”¨ # å¼‚æ­¥è°ƒç”¨çš„è¯æˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒæœ€åçš„ç»“æœï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç”¨æˆ·è¯·æ±‚å®Œæˆä¹‹åå°±ç«‹å³è¿”å›ç»“æœï¼Œå…·ä½“å¤„ç†æˆ‘ä»¬å¯ä»¥åç»­å†åšï¼Œç§’æ€åœºæ™¯ç”¨è¿™ä¸ªè¿˜æ˜¯è›®å¤šçš„ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨å¼‚æ­¥ä¹‹åæˆ‘ä»¬å¯èƒ½éœ€è¦ é€‚å½“ä¿®æ”¹ä¸šåŠ¡æµç¨‹è¿›è¡Œé…åˆï¼Œæ¯”å¦‚ç”¨æˆ·åœ¨æäº¤è®¢å•ä¹‹åï¼Œä¸èƒ½ç«‹å³è¿”å›ç”¨æˆ·è®¢å•æäº¤æˆåŠŸï¼Œéœ€è¦åœ¨æ¶ˆæ¯é˜Ÿåˆ—çš„è®¢å•æ¶ˆè´¹è€…è¿›ç¨‹çœŸæ­£å¤„ç†å®Œè¯¥è®¢å•ä¹‹åï¼Œç”šè‡³å‡ºåº“åï¼Œå†é€šè¿‡ç”µå­é‚®ä»¶æˆ–çŸ­ä¿¡é€šçŸ¥ç”¨æˆ·è®¢å•æˆåŠŸã€‚é™¤äº†å¯ä»¥åœ¨ç¨‹åºä¸­å®ç°å¼‚æ­¥ä¹‹å¤–ï¼Œæˆ‘ä»¬å¸¸å¸¸è¿˜ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥é€šè¿‡å¼‚æ­¥å¤„ç†æé«˜ç³»ç»Ÿæ€§èƒ½ï¼ˆå‰Šå³°ã€å‡å°‘å“åº”æ‰€éœ€æ—¶é—´ï¼‰å¹¶ä¸”å¯ä»¥é™ä½ç³»ç»Ÿè€¦åˆæ€§ã€‚\nä½¿ç”¨ç¼“å­˜ # å¦‚æœæˆ‘ä»¬çš„ç³»ç»Ÿå±äºå¹¶å‘é‡æ¯”è¾ƒé«˜çš„è¯ï¼Œå¦‚æœæˆ‘ä»¬å•çº¯ä½¿ç”¨æ•°æ®åº“çš„è¯ï¼Œå½“å¤§é‡è¯·æ±‚ç›´æ¥è½åˆ°æ•°æ®åº“å¯èƒ½æ•°æ®åº“å°±ä¼šç›´æ¥æŒ‚æ‰ã€‚ä½¿ç”¨ç¼“å­˜ç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼Œå› ä¸ºç¼“å­˜å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥é€Ÿåº¦ç›¸å½“åœ°å¿«ï¼\nå…¶ä»– # æ ¸å¿ƒåº”ç”¨å’ŒæœåŠ¡ä¼˜å…ˆä½¿ç”¨æ›´å¥½çš„ç¡¬ä»¶ ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µå¢åŠ æŠ¥è­¦è®¾ç½®ã€‚ æ³¨æ„å¤‡ä»½ï¼Œå¿…è¦æ—¶å€™å›æ»šã€‚ ç°åº¦å‘å¸ƒï¼š å°†æœåŠ¡å™¨é›†ç¾¤åˆ†æˆè‹¥å¹²éƒ¨åˆ†ï¼Œæ¯å¤©åªå‘å¸ƒä¸€éƒ¨åˆ†æœºå™¨ï¼Œè§‚å¯Ÿè¿è¡Œç¨³å®šæ²¡æœ‰æ•…éšœï¼Œç¬¬äºŒå¤©ç»§ç»­å‘å¸ƒä¸€éƒ¨åˆ†æœºå™¨ï¼ŒæŒç»­å‡ å¤©æ‰æŠŠæ•´ä¸ªé›†ç¾¤å…¨éƒ¨å‘å¸ƒå®Œæ¯•ï¼ŒæœŸé—´å¦‚æœå‘ç°é—®é¢˜ï¼Œåªéœ€è¦å›æ»šå·²å‘å¸ƒçš„ä¸€éƒ¨åˆ†æœåŠ¡å™¨å³å¯ å®šæœŸæ£€æŸ¥/æ›´æ¢ç¡¬ä»¶ï¼š å¦‚æœä¸æ˜¯è´­ä¹°çš„äº‘æœåŠ¡çš„è¯ï¼Œå®šæœŸè¿˜æ˜¯éœ€è¦å¯¹ç¡¬ä»¶è¿›è¡Œä¸€æ³¢æ£€æŸ¥çš„ï¼Œå¯¹äºä¸€äº›éœ€è¦æ›´æ¢æˆ–è€…å‡çº§çš„ç¡¬ä»¶ï¼Œè¦åŠæ—¶æ›´æ¢æˆ–è€…å‡çº§ã€‚ \u0026hellip;.. "},{"id":75,"href":"/zh/docs/study/Review/java_guide/lyely_high-performance/message-mq/rocketmq-questions/","title":"rocketmqå¸¸è§é¢è¯•é¢˜","section":"RocketMQ","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\næœ¬æ–‡æ¥è‡ªè¯»è€… PRã€‚\nä¸»è¦æ˜¯rocket mqçš„å‡ ä¸ªé—®é¢˜\n1 å•æœºç‰ˆæ¶ˆæ¯ä¸­å¿ƒ # ä¸€ä¸ªæ¶ˆæ¯ä¸­å¿ƒï¼Œæœ€åŸºæœ¬çš„éœ€è¦æ”¯æŒå¤šç”Ÿäº§è€…ã€å¤šæ¶ˆè´¹è€…ï¼Œä¾‹å¦‚ä¸‹ï¼š\nclass Scratch { public static void main(String[] args) { // å®é™…ä¸­ä¼šæœ‰ nameserver æœåŠ¡æ¥æ‰¾åˆ° broker å…·ä½“ä½ç½®ä»¥åŠ broker ä¸»ä»ä¿¡æ¯ Broker broker = new Broker(); Producer producer1 = new Producer(); producer1.connectBroker(broker); Producer producer2 = new Producer(); producer2.connectBroker(broker); Consumer consumer1 = new Consumer(); consumer1.connectBroker(broker); Consumer consumer2 = new Consumer(); consumer2.connectBroker(broker); for (int i = 0; i \u0026lt; 2; i++) { producer1.asyncSendMsg(\u0026#34;producer1 send msg\u0026#34; + i); producer2.asyncSendMsg(\u0026#34;producer2 send msg\u0026#34; + i); } System.out.println(\u0026#34;broker has msg:\u0026#34; + broker.getAllMagByDisk()); for (int i = 0; i \u0026lt; 1; i++) { System.out.println(\u0026#34;consumer1 consume msgï¼š\u0026#34; + consumer1.syncPullMsg()); } for (int i = 0; i \u0026lt; 3; i++) { System.out.println(\u0026#34;consumer2 consume msgï¼š\u0026#34; + consumer2.syncPullMsg()); } } } class Producer { private Broker broker; public void connectBroker(Broker broker) { this.broker = broker; } public void asyncSendMsg(String msg) { if (broker == null) { throw new RuntimeException(\u0026#34;please connect broker first\u0026#34;); } new Thread(() -\u0026gt; { broker.sendMsg(msg); }).start(); } } class Consumer { private Broker broker; public void connectBroker(Broker broker) { this.broker = broker; } public String syncPullMsg() { return broker.getMsg(); } } class Broker { // å¯¹åº” RocketMQ ä¸­ MessageQueueï¼Œé»˜è®¤æƒ…å†µä¸‹ 1 ä¸ª Topic åŒ…å« 4 ä¸ª MessageQueue private LinkedBlockingQueue\u0026lt;String\u0026gt; messageQueue = new LinkedBlockingQueue(Integer.MAX_VALUE); // å®é™…å‘é€æ¶ˆæ¯åˆ° broker æœåŠ¡å™¨ä½¿ç”¨ Netty å‘é€ public void sendMsg(String msg) { try { messageQueue.put(msg); // å®é™…ä¼šåŒæ­¥æˆ–å¼‚æ­¥è½ç›˜ï¼Œå¼‚æ­¥è½ç›˜ä½¿ç”¨çš„å®šæ—¶ä»»åŠ¡å®šæ—¶æ‰«æè½ç›˜ } catch (InterruptedException e) { } } public String getMsg() { try { return messageQueue.take(); } catch (InterruptedException e) { } return null; } public String getAllMagByDisk() { StringBuilder sb = new StringBuilder(\u0026#34;\\n\u0026#34;); messageQueue.iterator().forEachRemaining((msg) -\u0026gt; { sb.append(msg + \u0026#34;\\n\u0026#34;); }); return sb.toString(); } } é—®é¢˜ï¼š\næ²¡æœ‰å®ç°çœŸæ­£æ‰§è¡Œæ¶ˆæ¯å­˜å‚¨è½ç›˜ æ²¡æœ‰å®ç° NameServer å»ä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œå®šä½æœåŠ¡ ä½¿ç”¨ LinkedBlockingQueue ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ³¨æ„ï¼Œå‚æ•°æ˜¯æ— é™å¤§ï¼Œåœ¨çœŸæ­£ RocketMQ ä¹Ÿæ˜¯å¦‚æ­¤æ˜¯æ— é™å¤§ï¼Œç†è®ºä¸Šä¸ä¼šå‡ºç°å¯¹è¿›æ¥çš„æ•°æ®è¿›è¡ŒæŠ›å¼ƒï¼Œä½†æ˜¯ä¼šæœ‰å†…å­˜æ³„æ¼é—®é¢˜ï¼ˆé˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œä¹Ÿå› ä¸ºè¿™ä¸ªé—®é¢˜ï¼Œå»ºè®®æˆ‘ä»¬ä½¿ç”¨è‡ªåˆ¶çº¿ç¨‹æ± ï¼‰ æ²¡æœ‰ä½¿ç”¨å¤šä¸ªé˜Ÿåˆ—ï¼ˆå³å¤šä¸ª LinkedBlockingQueueï¼‰ï¼ŒRocketMQ çš„é¡ºåºæ¶ˆæ¯æ˜¯é€šè¿‡ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…åŒæ—¶ä½¿ç”¨åŒä¸€ä¸ª MessageQueue æ¥å®ç°ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬åªæœ‰ä¸€ä¸ª MessageQueueï¼Œé‚£æˆ‘ä»¬å¤©ç„¶å°±æ”¯æŒé¡ºåºæ¶ˆæ¯ æ²¡æœ‰ä½¿ç”¨ MappedByteBuffer æ¥å®ç°æ–‡ä»¶æ˜ å°„ä»è€Œä½¿æ¶ˆæ¯æ•°æ®è½ç›˜éå¸¸çš„å¿«ï¼ˆå®é™… RocketMQ ä½¿ç”¨çš„æ˜¯ FileChannel+DirectBufferï¼‰ 2 åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­å¿ƒ # 2.1 é—®é¢˜ä¸è§£å†³ # 2.1.1 æ¶ˆæ¯ä¸¢å¤±çš„é—®é¢˜ # å½“ä½ ç³»ç»Ÿéœ€è¦ä¿è¯ç™¾åˆ†ç™¾æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œä½ å¯ä»¥ä½¿ç”¨ç”Ÿäº§è€…æ¯å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼ŒBroker åŒæ­¥è¿”å›ä¸€ä¸ªæ¶ˆæ¯å‘é€æˆåŠŸçš„åé¦ˆæ¶ˆæ¯ å³æ¯å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼ŒåŒæ­¥è½ç›˜åæ‰è¿”å›ç”Ÿäº§è€…æ¶ˆæ¯å‘é€æˆåŠŸï¼Œè¿™æ ·åªè¦ç”Ÿäº§è€…å¾—åˆ°äº†æ¶ˆæ¯å‘é€ç”Ÿæˆçš„è¿”å›ï¼Œäº‹åé™¤äº†ç¡¬ç›˜æŸåï¼Œéƒ½å¯ä»¥ä¿è¯ä¸ä¼šæ¶ˆæ¯ä¸¢å¤± ä½†æ˜¯è¿™åŒæ—¶å¼•å…¥äº†ä¸€ä¸ªé—®é¢˜ï¼ŒåŒæ­¥è½ç›˜æ€ä¹ˆæ‰èƒ½å¿«ï¼Ÿ 2.1.2 åŒæ­¥è½ç›˜æ€ä¹ˆæ‰èƒ½å¿« # ä½¿ç”¨ FileChannel + DirectBuffer æ± ï¼Œä½¿ç”¨å †å¤–å†…å­˜ï¼ŒåŠ å¿«å†…å­˜æ‹·è´ ä½¿ç”¨æ•°æ®å’Œç´¢å¼•åˆ†ç¦»ï¼Œå½“æ¶ˆæ¯éœ€è¦å†™å…¥æ—¶ï¼Œä½¿ç”¨ commitlog æ–‡ä»¶é¡ºåºå†™ï¼Œå½“éœ€è¦å®šä½æŸä¸ªæ¶ˆæ¯æ—¶ï¼ŒæŸ¥è¯¢index æ–‡ä»¶æ¥å®šä½ï¼Œä»è€Œå‡å°‘æ–‡ä»¶IOéšæœºè¯»å†™çš„æ€§èƒ½æŸè€— 2.1.3 æ¶ˆæ¯å †ç§¯çš„é—®é¢˜ # åå°å®šæ—¶ä»»åŠ¡æ¯éš”72å°æ—¶ï¼Œåˆ é™¤æ—§çš„æ²¡æœ‰ä½¿ç”¨è¿‡çš„æ¶ˆæ¯ä¿¡æ¯ æ ¹æ®ä¸åŒçš„ä¸šåŠ¡å®ç°ä¸åŒçš„ä¸¢å¼ƒä»»åŠ¡ï¼Œå…·ä½“å‚è€ƒçº¿ç¨‹æ± çš„ AbortPolicyï¼Œä¾‹å¦‚FIFO/LRUç­‰ï¼ˆRocketMQæ²¡æœ‰æ­¤ç­–ç•¥ï¼‰ æ¶ˆæ¯å®šæ—¶è½¬ç§»ï¼Œæˆ–è€…å¯¹æŸäº›é‡è¦çš„ TAG å‹ï¼ˆæ”¯ä»˜å‹ï¼‰æ¶ˆæ¯çœŸæ­£è½åº“ 2.1.4 å®šæ—¶æ¶ˆæ¯çš„å®ç° # å®é™… RocketMQ æ²¡æœ‰å®ç°ä»»æ„ç²¾åº¦çš„å®šæ—¶æ¶ˆæ¯ï¼Œå®ƒåªæ”¯æŒæŸäº›ç‰¹å®šçš„æ—¶é—´ç²¾åº¦çš„å®šæ—¶æ¶ˆæ¯ å®ç°å®šæ—¶æ¶ˆæ¯çš„åŸç†æ˜¯ï¼šåˆ›å»ºç‰¹å®šæ—¶é—´ç²¾åº¦çš„ MessageQueueï¼Œä¾‹å¦‚ç”Ÿäº§è€…éœ€è¦å®šæ—¶1sä¹‹åè¢«æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œä½ åªéœ€è¦å°†æ­¤æ¶ˆæ¯å‘é€åˆ°ç‰¹å®šçš„ Topicï¼Œä¾‹å¦‚ï¼šMessageQueue-1 è¡¨ç¤ºè¿™ä¸ª MessageQueue é‡Œé¢çš„æ¶ˆæ¯éƒ½ä¼šå»¶è¿Ÿä¸€ç§’è¢«æ¶ˆè´¹ï¼Œç„¶å Broker ä¼šåœ¨ 1s åå‘é€åˆ°æ¶ˆè´¹è€…æ¶ˆè´¹æ­¤æ¶ˆæ¯ï¼Œä½¿ç”¨ newSingleThreadScheduledExecutor å®ç° 2.1.5 é¡ºåºæ¶ˆæ¯çš„å®ç° # ä¸å®šæ—¶æ¶ˆæ¯åŒåŸç†ï¼Œç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯æ—¶æŒ‡å®šç‰¹å®šçš„ MessageQueue ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œæ¶ˆè´¹ç‰¹å®šçš„ MessageQueueï¼Œå…¶å®å•æœºç‰ˆçš„æ¶ˆæ¯ä¸­å¿ƒåœ¨ä¸€ä¸ª MessageQueue å°±å¤©ç„¶æ”¯æŒäº†é¡ºåºæ¶ˆæ¯ æ³¨æ„ï¼šåŒä¸€ä¸ª MessageQueue ä¿è¯é‡Œé¢çš„æ¶ˆæ¯æ˜¯é¡ºåºæ¶ˆè´¹çš„å‰ææ˜¯ï¼šæ¶ˆè´¹è€…æ˜¯ä¸²è¡Œçš„æ¶ˆè´¹è¯¥ MessageQueueï¼Œå› ä¸ºå°±ç®— MessageQueue æ˜¯é¡ºåºçš„ï¼Œä½†æ˜¯å½“å¹¶è¡Œæ¶ˆè´¹æ—¶ï¼Œè¿˜æ˜¯ä¼šæœ‰é¡ºåºé—®é¢˜ï¼Œä½†æ˜¯ä¸²è¡Œæ¶ˆè´¹ä¹ŸåŒæ—¶å¼•å…¥äº†ä¸¤ä¸ªé—®é¢˜ï¼š å¼•å…¥é”æ¥å®ç°ä¸²è¡Œ å‰ä¸€ä¸ªæ¶ˆè´¹é˜»å¡æ—¶åé¢éƒ½ä¼šè¢«é˜»å¡ 2.1.6 åˆ†å¸ƒå¼æ¶ˆæ¯çš„å®ç° # éœ€è¦å‰ç½®çŸ¥è¯†ï¼š2PC RocketMQ4.3 èµ·æ”¯æŒï¼ŒåŸç†ä¸º2PCï¼Œå³ä¸¤é˜¶æ®µæäº¤ï¼Œprepared-\u0026gt;commit/rollback ç”Ÿäº§è€…å‘é€äº‹åŠ¡æ¶ˆæ¯ï¼Œå‡è®¾è¯¥äº‹åŠ¡æ¶ˆæ¯ Topic ä¸º Topic1-Transï¼ŒBroker å¾—åˆ°åé¦–å…ˆæ›´æ”¹è¯¥æ¶ˆæ¯çš„ Topic ä¸º Topic1-Preparedï¼Œè¯¥ Topic1-Prepared å¯¹æ¶ˆè´¹è€…ä¸å¯è§ã€‚ç„¶åå®šæ—¶å›è°ƒç”Ÿäº§è€…çš„æœ¬åœ°äº‹åŠ¡Aæ‰§è¡ŒçŠ¶æ€ï¼Œæ ¹æ®æœ¬åœ°äº‹åŠ¡Aæ‰§è¡ŒçŠ¶æ€ï¼Œæ¥æ˜¯å¦å°†è¯¥æ¶ˆæ¯ä¿®æ”¹ä¸º Topic1-Commit æˆ– Topic1-Rollbackï¼Œæ¶ˆè´¹è€…å°±å¯ä»¥æ­£å¸¸æ‰¾åˆ°è¯¥äº‹åŠ¡æ¶ˆæ¯æˆ–è€…ä¸æ‰§è¡Œç­‰ æ³¨æ„ï¼Œå°±ç®—æ˜¯äº‹åŠ¡æ¶ˆæ¯æœ€åå›æ»šäº†ä¹Ÿä¸ä¼šç‰©ç†åˆ é™¤ï¼Œåªä¼šé€»è¾‘åˆ é™¤è¯¥æ¶ˆæ¯\n2.1.7 æ¶ˆæ¯çš„ push å®ç° # æ³¨æ„ï¼ŒRocketMQ å·²ç»è¯´äº†è‡ªå·±ä¼šæœ‰ä½å»¶è¿Ÿé—®é¢˜ï¼Œå…¶ä¸­å°±åŒ…æ‹¬è¿™ä¸ªæ¶ˆæ¯çš„ push å»¶è¿Ÿé—®é¢˜ å› ä¸ºè¿™å¹¶ä¸æ˜¯çœŸæ­£çš„å°†æ¶ˆæ¯ä¸»åŠ¨çš„æ¨é€åˆ°æ¶ˆè´¹è€…ï¼Œè€Œæ˜¯ Broker å®šæ—¶ä»»åŠ¡æ¯5så°†æ¶ˆæ¯æ¨é€åˆ°æ¶ˆè´¹è€… pullæ¨¡å¼éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è°ƒç”¨consumeræ‹‰æ¶ˆæ¯ï¼Œè€Œpushæ¨¡å¼åˆ™åªéœ€è¦æˆ‘ä»¬æä¾›ä¸€ä¸ªlistenerå³å¯å®ç°å¯¹æ¶ˆæ¯çš„ç›‘å¬ï¼Œè€Œå®é™…ä¸Šï¼ŒRocketMQçš„pushæ¨¡å¼æ˜¯åŸºäºpullæ¨¡å¼å®ç°çš„ï¼Œå®ƒæ²¡æœ‰å®ç°çœŸæ­£çš„pushã€‚ pushæ–¹å¼é‡Œï¼ŒconsumeræŠŠè½®è¯¢è¿‡ç¨‹å°è£…äº†ï¼Œå¹¶æ³¨å†ŒMessageListenerç›‘å¬å™¨ï¼Œå–åˆ°æ¶ˆæ¯åï¼Œå”¤é†’MessageListenerçš„consumeMessage()æ¥æ¶ˆè´¹ï¼Œå¯¹ç”¨æˆ·è€Œè¨€ï¼Œæ„Ÿè§‰æ¶ˆæ¯æ˜¯è¢«æ¨é€è¿‡æ¥çš„ã€‚ 2.1.8 æ¶ˆæ¯é‡å¤å‘é€çš„é¿å… # RocketMQ ä¼šå‡ºç°æ¶ˆæ¯é‡å¤å‘é€çš„é—®é¢˜ï¼Œå› ä¸ºåœ¨ç½‘ç»œå»¶è¿Ÿçš„æƒ…å†µä¸‹ï¼Œè¿™ç§é—®é¢˜ä¸å¯é¿å…çš„å‘ç”Ÿï¼Œå¦‚æœéè¦å®ç°æ¶ˆæ¯ä¸å¯é‡å¤å‘é€ï¼Œé‚£åŸºæœ¬å¤ªéš¾ï¼Œå› ä¸ºç½‘ç»œç¯å¢ƒæ— æ³•é¢„çŸ¥ï¼Œè¿˜ä¼šä½¿ç¨‹åºå¤æ‚åº¦åŠ å¤§ï¼Œå› æ­¤é»˜è®¤å…è®¸æ¶ˆæ¯é‡å¤å‘é€ RocketMQ è®©ä½¿ç”¨è€…åœ¨æ¶ˆè´¹è€…ç«¯å»è§£å†³è¯¥é—®é¢˜ï¼Œå³éœ€è¦æ¶ˆè´¹è€…ç«¯åœ¨æ¶ˆè´¹æ¶ˆæ¯æ—¶æ”¯æŒå¹‚ç­‰æ€§çš„å»æ¶ˆè´¹æ¶ˆæ¯ æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯æ¯æ¡æ¶ˆè´¹è®°å½•æœ‰ä¸ªæ¶ˆè´¹çŠ¶æ€å­—æ®µï¼Œæ ¹æ®è¿™ä¸ªæ¶ˆè´¹çŠ¶æ€å­—æ®µæ¥åˆ¤æ–­æ˜¯å¦æ¶ˆè´¹æˆ–è€…ä½¿ç”¨ä¸€ä¸ªé›†ä¸­å¼çš„è¡¨ï¼Œæ¥å­˜å‚¨æ‰€æœ‰æ¶ˆæ¯çš„æ¶ˆè´¹çŠ¶æ€ï¼Œä»è€Œé¿å…é‡å¤æ¶ˆè´¹ å…·ä½“å®ç°å¯ä»¥æŸ¥è¯¢å…³äºæ¶ˆæ¯å¹‚ç­‰æ¶ˆè´¹çš„è§£å†³æ–¹æ¡ˆ 2.1.9 å¹¿æ’­æ¶ˆè´¹ä¸é›†ç¾¤æ¶ˆè´¹ # æ¶ˆæ¯æ¶ˆè´¹åŒºåˆ«ï¼šå¹¿æ’­æ¶ˆè´¹ï¼Œè®¢é˜…è¯¥ Topic çš„æ¶ˆæ¯è€…ä»¬éƒ½ä¼šæ¶ˆè´¹æ¯ä¸ªæ¶ˆæ¯ã€‚é›†ç¾¤æ¶ˆè´¹ï¼Œè®¢é˜…è¯¥ Topic çš„æ¶ˆæ¯è€…ä»¬åªä¼šæœ‰ä¸€ä¸ªå»æ¶ˆè´¹æŸä¸ªæ¶ˆæ¯ æ¶ˆæ¯è½ç›˜åŒºåˆ«ï¼šå…·ä½“è¡¨ç°åœ¨æ¶ˆæ¯æ¶ˆè´¹è¿›åº¦çš„ä¿å­˜ä¸Šã€‚å¹¿æ’­æ¶ˆè´¹ï¼Œç”±äºæ¯ä¸ªæ¶ˆè´¹è€…éƒ½ç‹¬ç«‹çš„å»æ¶ˆè´¹æ¯ä¸ªæ¶ˆæ¯ï¼Œå› æ­¤æ¯ä¸ªæ¶ˆè´¹è€…å„è‡ªä¿å­˜è‡ªå·±çš„æ¶ˆæ¯æ¶ˆè´¹è¿›åº¦ã€‚è€Œé›†ç¾¤æ¶ˆè´¹ä¸‹ï¼Œè®¢é˜…äº†æŸä¸ª Topicï¼Œè€Œæ——ä¸‹åˆæœ‰å¤šä¸ª MessageQueueï¼Œæ¯ä¸ªæ¶ˆè´¹è€…éƒ½å¯èƒ½ä¼šå»æ¶ˆè´¹ä¸åŒçš„ MessageQueueï¼Œå› æ­¤æ€»ä½“çš„æ¶ˆè´¹è¿›åº¦ä¿å­˜åœ¨ Broker ä¸Šé›†ä¸­çš„ç®¡ç† 2.1.10 RocketMQ ä¸ä½¿ç”¨ ZooKeeper ä½œä¸ºæ³¨å†Œä¸­å¿ƒçš„åŸå› ï¼Œä»¥åŠè‡ªåˆ¶çš„ NameServer ä¼˜ç¼ºç‚¹ï¼Ÿ # ZooKeeper ä½œä¸ºæ”¯æŒé¡ºåºä¸€è‡´æ€§çš„ä¸­é—´ä»¶ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ƒä¸ºäº†æ»¡è¶³ä¸€è‡´æ€§ï¼Œä¼šä¸¢å¤±ä¸€å®šæ—¶é—´å†…çš„å¯ç”¨æ€§ï¼ŒRocketMQ éœ€è¦æ³¨å†Œä¸­å¿ƒåªæ˜¯ä¸ºäº†å‘ç°ç»„ä»¶åœ°å€ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒRocketMQ çš„æ³¨å†Œä¸­å¿ƒå¯ä»¥å‡ºç°æ•°æ®ä¸ä¸€è‡´æ€§ï¼Œè¿™åŒæ—¶ä¹Ÿæ˜¯ NameServer çš„ç¼ºç‚¹ï¼Œå› ä¸º NameServer é›†ç¾¤é—´äº’ä¸é€šä¿¡ï¼Œå®ƒä»¬ä¹‹é—´çš„æ³¨å†Œä¿¡æ¯å¯èƒ½ä¼šä¸ä¸€è‡´ å¦å¤–ï¼Œå½“æœ‰æ–°çš„æœåŠ¡å™¨åŠ å…¥æ—¶ï¼ŒNameServer å¹¶ä¸ä¼šç«‹é©¬é€šçŸ¥åˆ° Producerï¼Œè€Œæ˜¯ç”± Producer å®šæ—¶å»è¯·æ±‚ NameServer è·å–æœ€æ–°çš„ Broker/Consumer ä¿¡æ¯ï¼ˆè¿™ç§æƒ…å†µæ˜¯é€šè¿‡ Producer å‘é€æ¶ˆæ¯æ—¶ï¼Œè´Ÿè½½å‡è¡¡è§£å†³ï¼‰ 2.1.11 å…¶å®ƒ # åŠ åˆ†é¡¹å’¯\nåŒ…æ‹¬ç»„ä»¶é€šä¿¡é—´ä½¿ç”¨ Netty çš„è‡ªå®šä¹‰åè®® æ¶ˆæ¯é‡è¯•è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆå…·ä½“å‚è€ƒ Dubbo è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼‰ æ¶ˆæ¯è¿‡æ»¤å™¨ï¼ˆProducer å‘é€æ¶ˆæ¯åˆ° Brokerï¼ŒBroker å­˜å‚¨æ¶ˆæ¯ä¿¡æ¯ï¼ŒConsumer æ¶ˆè´¹æ—¶è¯·æ±‚ Broker ç«¯ä»ç£ç›˜æ–‡ä»¶æŸ¥è¯¢æ¶ˆæ¯æ–‡ä»¶æ—¶,åœ¨ Broker ç«¯å°±ä½¿ç”¨è¿‡æ»¤æœåŠ¡å™¨è¿›è¡Œè¿‡æ»¤ï¼‰ Broker åŒæ­¥åŒå†™å’Œå¼‚æ­¥åŒå†™ä¸­ Master å’Œ Slave çš„äº¤äº’ Broker åœ¨ 4.5.0 ç‰ˆæœ¬æ›´æ–°ä¸­å¼•å…¥äº†åŸºäº Raft åè®®çš„å¤šå‰¯æœ¬é€‰ä¸¾ï¼Œä¹‹å‰è¿™æ˜¯å•†ä¸šç‰ˆæ‰æœ‰çš„ç‰¹æ€§ ISSUE-1046 3 å‚è€ƒ # ã€ŠRocketMQæŠ€æœ¯å†…å¹•ã€‹ï¼šhttps://blog.csdn.net/prestigeding/article/details/85233529 å…³äº RocketMQ å¯¹ MappedByteBuffer çš„ä¸€ç‚¹ä¼˜åŒ–ï¼šhttps://lishoubo.github.io/2017/09/27/MappedByteBuffer%E7%9A%84%E4%B8%80%E7%82%B9%E4%BC%98%E5%8C%96/ ååˆ†é’Ÿå…¥é—¨RocketMQï¼šhttps://developer.aliyun.com/article/66101 åˆ†å¸ƒå¼äº‹åŠ¡çš„ç§ç±»ä»¥åŠ RocketMQ æ”¯æŒçš„åˆ†å¸ƒå¼æ¶ˆæ¯ï¼šhttps://www.infoq.cn/article/2018/08/rocketmq-4.3-release æ»´æ»´å‡ºè¡ŒåŸºäºRocketMQæ„å»ºä¼ä¸šçº§æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡çš„å®è·µï¼šhttps://yq.aliyun.com/articles/664608 åŸºäºã€ŠRocketMQæŠ€æœ¯å†…å¹•ã€‹æºç æ³¨é‡Šï¼šhttps://github.com/LiWenGu/awesome-rocketmq "},{"id":76,"href":"/zh/docs/study/Review/java_guide/lyely_high-performance/message-mq/rocketmq-intro/","title":"rocketmqä»‹ç»","section":"RocketMQ","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\næ¶ˆæ¯é˜Ÿåˆ—æ‰«ç›² # æ¶ˆæ¯é˜Ÿåˆ—é¡¾åæ€ä¹‰å°±æ˜¯å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—æˆ‘å°±ä¸è§£é‡Šäº†ï¼Œåˆ«å‘Šè¯‰æˆ‘ä½ è¿é˜Ÿåˆ—éƒ½ä¸çŸ¥é“æ˜¯å•¥å§ï¼Ÿ\næ‰€ä»¥é—®é¢˜å¹¶ä¸æ˜¯æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä»€ä¹ˆï¼Œè€Œæ˜¯ æ¶ˆæ¯é˜Ÿåˆ—ä¸ºä»€ä¹ˆä¼šå‡ºç°ï¼Ÿæ¶ˆæ¯é˜Ÿåˆ—èƒ½ç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿç”¨å®ƒæ¥å¹²è¿™äº›äº‹ä¼šå¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼Ÿæ¶ˆæ¯é˜Ÿåˆ—ä¼šå¸¦æ¥å‰¯ä½œç”¨å—ï¼Ÿ\n# æ¶ˆæ¯é˜Ÿåˆ—ä¸ºä»€ä¹ˆä¼šå‡ºç°ï¼Ÿ # æ¶ˆæ¯é˜Ÿåˆ—ç®—æ˜¯ä½œä¸ºåç«¯ç¨‹åºå‘˜çš„ä¸€ä¸ªå¿…å¤‡æŠ€èƒ½å§ï¼Œå› ä¸ºåˆ†å¸ƒå¼åº”ç”¨å¿…å®šæ¶‰åŠåˆ°å„ä¸ªç³»ç»Ÿä¹‹é—´çš„é€šä¿¡é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™æ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿåº”è¿è€Œç”Ÿäº†ã€‚å¯ä»¥è¯´åˆ†å¸ƒå¼çš„äº§ç”Ÿæ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„åŸºç¡€ï¼Œè€Œåˆ†å¸ƒå¼æ€•æ˜¯ä¸€ä¸ªå¾ˆå¤è€çš„æ¦‚å¿µäº†å§ï¼Œæ‰€ä»¥æ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¤è€çš„ä¸­é—´ä»¶äº†ã€‚\n# æ¶ˆæ¯é˜Ÿåˆ—èƒ½ç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿ # # å¼‚æ­¥ # ä½ å¯èƒ½ä¼šåé©³æˆ‘ï¼Œåº”ç”¨ä¹‹é—´çš„é€šä¿¡åˆä¸æ˜¯åªèƒ½ç”±æ¶ˆæ¯é˜Ÿåˆ—è§£å†³ï¼Œå¥½å¥½çš„é€šä¿¡ä¸ºä»€ä¹ˆä¸­é—´éè¦æ’ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—å‘¢ï¼Ÿæˆ‘ä¸èƒ½ç›´æ¥è¿›è¡Œé€šä¿¡å—ï¼Ÿ\nå¾ˆå¥½ğŸ‘ï¼Œä½ åˆæå‡ºäº†ä¸€ä¸ªæ¦‚å¿µï¼ŒåŒæ­¥é€šä¿¡ã€‚å°±æ¯”å¦‚ç°åœ¨ä¸šç•Œä½¿ç”¨æ¯”è¾ƒå¤šçš„ Dubbo å°±æ˜¯ä¸€ä¸ªé€‚ç”¨äºå„ä¸ªç³»ç»Ÿä¹‹é—´åŒæ­¥é€šä¿¡çš„ RPC æ¡†æ¶ã€‚\næˆ‘æ¥ä¸¾ä¸ªğŸŒ°å§ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªè´­ç¥¨ç³»ç»Ÿï¼Œéœ€æ±‚æ˜¯ç”¨æˆ·åœ¨è´­ä¹°å®Œä¹‹åèƒ½æ¥æ”¶åˆ°è´­ä¹°å®Œæˆçš„çŸ­ä¿¡ã€‚\næˆ‘ä»¬çœç•¥ä¸­é—´çš„ç½‘ç»œé€šä¿¡æ—¶é—´æ¶ˆè€—ï¼Œå‡å¦‚è´­ç¥¨ç³»ç»Ÿå¤„ç†éœ€è¦ 150ms ï¼ŒçŸ­ä¿¡ç³»ç»Ÿå¤„ç†éœ€è¦ 200ms ï¼Œé‚£ä¹ˆæ•´ä¸ªå¤„ç†æµç¨‹çš„æ—¶é—´æ¶ˆè€—å°±æ˜¯ 150ms + 200ms = 350msã€‚\nå½“ç„¶ï¼Œä¹çœ‹æ²¡ä»€ä¹ˆé—®é¢˜ã€‚å¯æ˜¯ä»”ç»†ä¸€æƒ³ä½ å°±æ„Ÿè§‰æœ‰ç‚¹é—®é¢˜ï¼Œæˆ‘ç”¨æˆ·è´­ç¥¨åœ¨è´­ç¥¨ç³»ç»Ÿçš„æ—¶å€™å…¶å®å°±å·²ç»å®Œæˆäº†è´­ä¹°ï¼Œè€Œæˆ‘ç°åœ¨é€šè¿‡åŒæ­¥è°ƒç”¨éè¦è®©æ•´ä¸ªè¯·æ±‚æ‹‰é•¿æ—¶é—´ï¼Œè€ŒçŸ­ä¿¡ç³»ç»Ÿè¿™ç©æ„åˆä¸æ˜¯å¾ˆæœ‰å¿…è¦ï¼Œå®ƒä»…ä»…æ˜¯ä¸€ä¸ªè¾…åŠ©åŠŸèƒ½å¢å¼ºç”¨æˆ·ä½“éªŒæ„Ÿè€Œå·²ã€‚æˆ‘ç°åœ¨æ•´ä¸ªè°ƒç”¨æµç¨‹å°±æœ‰ç‚¹ å¤´é‡è„šè½» çš„æ„Ÿè§‰äº†ï¼Œè´­ç¥¨æ˜¯ä¸€ä¸ªä¸å¤ªè€—æ—¶çš„æµç¨‹ï¼Œè€Œæˆ‘ç°åœ¨å› ä¸ºåŒæ­¥è°ƒç”¨ï¼Œéè¦ç­‰å¾…å‘é€çŸ­ä¿¡è¿™ä¸ªæ¯”è¾ƒè€—æ—¶çš„æ“ä½œæ‰è¿”å›ç»“æœã€‚é‚£æˆ‘å¦‚æœå†åŠ ä¸€ä¸ªå‘é€é‚®ä»¶å‘¢ï¼Ÿ\nè¿™æ ·æ•´ä¸ªç³»ç»Ÿçš„è°ƒç”¨é“¾åˆå˜é•¿äº†ï¼Œæ•´ä¸ªæ—¶é—´å°±å˜æˆäº†550msã€‚\nå½“æˆ‘ä»¬åœ¨å­¦ç”Ÿæ—¶ä»£éœ€è¦åœ¨é£Ÿå ‚æ’é˜Ÿçš„æ—¶å€™ï¼Œæˆ‘ä»¬å’Œé£Ÿå ‚å¤§å¦ˆå°±æ˜¯ä¸€ä¸ªåŒæ­¥çš„æ¨¡å‹ã€‚\næˆ‘ä»¬éœ€è¦å‘Šè¯‰é£Ÿå ‚å¤§å¦ˆï¼šâ€œå§å§ï¼Œç»™æˆ‘åŠ ä¸ªé¸¡è…¿ï¼Œå†åŠ ä¸ªé…¸è¾£åœŸè±†ä¸ï¼Œå¸®æˆ‘æµ‡ç‚¹æ±ä¸Šå»ï¼Œå¤šæ‰“ç‚¹é¥­å“¦ğŸ˜‹ğŸ˜‹ğŸ˜‹â€ å’¦~~~ ä¸ºäº†å¤šåƒç‚¹ï¼ŒçœŸæ¶å¿ƒã€‚\nç„¶åå¤§å¦ˆå¸®æˆ‘ä»¬æ‰“é¥­é…èœï¼Œæˆ‘ä»¬çœ‹ç€å¤§å¦ˆé‚£é¢¤æŠ–çš„æ‰‹å’Œæ‰è½çš„åœŸè±†ä¸ä¸ç¦å’½äº†å’½å£æ°´ã€‚\næœ€ç»ˆæˆ‘ä»¬ä»å¤§å¦ˆæ‰‹ä¸­æ¥è¿‡é¥­èœç„¶åå»å¯»æ‰¾åº§ä½äº†\u0026hellip;\nå›æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬åœ¨ç»™å¤§å¦ˆå‘é€éœ€è¦çš„ä¿¡æ¯ä¹‹åæˆ‘ä»¬æ˜¯ åŒæ­¥ç­‰å¾…å¤§å¦ˆç»™æˆ‘é…å¥½é¥­èœ çš„ï¼Œä¸Šé¢æˆ‘ä»¬åªæ˜¯åŠ äº†é¸¡è…¿å’ŒåœŸè±†ä¸ï¼Œä¸‡ä¸€æˆ‘å†åŠ ä¸€ä¸ªç•ªèŒ„ç‰›è…©ï¼ŒéŸ­èœé¸¡è›‹ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯å¤§å¦ˆæ‰“é¥­é…èœçš„æµç¨‹å°±ä¼šå˜é•¿ï¼Œæˆ‘ä»¬ç­‰å¾…çš„æ—¶é—´ä¹Ÿä¼šç›¸åº”çš„å˜é•¿ã€‚\né‚£åæ¥ï¼Œæˆ‘ä»¬å·¥ä½œèµšé’±äº†æœ‰é’±å»é¥­åº—åƒé¥­äº†ï¼Œæˆ‘ä»¬å‘Šè¯‰æœåŠ¡å‘˜æ¥ä¸€ç¢—ç‰›è‚‰é¢åŠ ä¸ªè·åŒ…è›‹ (ä¼ è¾¾ä¸€ä¸ªæ¶ˆæ¯) ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨é¥­æ¡Œä¸Šå®‰å¿ƒçš„ç©æ‰‹æœºäº† (å¹²è‡ªå·±å…¶ä»–äº‹æƒ…) ï¼Œç­‰åˆ°æˆ‘ä»¬çš„ç‰›è‚‰é¢ä¸Šäº†æˆ‘ä»¬å°±å¯ä»¥åƒäº†ã€‚è¿™å…¶ä¸­æˆ‘ä»¬ä¹Ÿå°±ä¼ è¾¾äº†ä¸€ä¸ªæ¶ˆæ¯ï¼Œç„¶åæˆ‘ä»¬åˆè½¬è¿‡å¤´å¹²å…¶ä»–äº‹æƒ…äº†ã€‚è¿™å…¶ä¸­è™½ç„¶åšé¢çš„æ—¶é—´æ²¡æœ‰å˜çŸ­ï¼Œä½†æ˜¯æˆ‘ä»¬åªéœ€è¦ä¼ è¾¾ä¸€ä¸ªæ¶ˆæ¯å°±å¯ä»¥å¹²å…¶ä»–äº‹æƒ…äº†ï¼Œè¿™æ˜¯ä¸€ä¸ª å¼‚æ­¥ çš„æ¦‚å¿µã€‚\næ‰€ä»¥ï¼Œä¸ºäº†è§£å†³è¿™ä¸€ä¸ªé—®é¢˜ï¼Œèªæ˜çš„ç¨‹åºå‘˜åœ¨ä¸­é—´ä¹ŸåŠ äº†ä¸ªç±»ä¼¼äºæœåŠ¡å‘˜çš„ä¸­é—´ä»¶â€”â€”æ¶ˆæ¯é˜Ÿåˆ—ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥æŠŠæ¨¡å‹ç»™æ”¹é€ äº†ã€‚\nè¿™æ ·ï¼Œæˆ‘ä»¬åœ¨å°†æ¶ˆæ¯å­˜å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¹‹åæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è¿”å›äº†(æˆ‘ä»¬å‘Šè¯‰æœåŠ¡å‘˜æˆ‘ä»¬è¦åƒä»€ä¹ˆç„¶åç©æ‰‹æœº)ï¼Œæ‰€ä»¥æ•´ä¸ªè€—æ—¶åªæ˜¯ 150ms + 10ms = 160msã€‚\nä½†æ˜¯ä½ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ•´ä¸ªæµç¨‹çš„æ—¶é•¿æ˜¯æ²¡å˜çš„ï¼Œå°±åƒä½ ä»…ä»…å‘Šè¯‰æœåŠ¡å‘˜è¦åƒä»€ä¹ˆæ˜¯ä¸ä¼šå½±å“åˆ°åšé¢çš„é€Ÿåº¦çš„ã€‚\n# è§£è€¦ # å›åˆ°æœ€åˆåŒæ­¥è°ƒç”¨çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å†™ä¸ªä¼ªä»£ç ç®€å•æ¦‚æ‹¬ä¸€ä¸‹ã€‚\né‚£ä¹ˆç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬åˆæ·»åŠ äº†ä¸€ä¸ªå‘é€é‚®ä»¶ï¼Œæˆ‘ä»¬å°±å¾—é‡æ–°å»ä¿®æ”¹ä»£ç ï¼Œå¦‚æœæˆ‘ä»¬åˆåŠ ä¸€ä¸ªéœ€æ±‚ï¼šç”¨æˆ·è´­ä¹°å®Œè¿˜éœ€è¦ç»™ä»–åŠ ç§¯åˆ†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ˜¯ä¸æ˜¯åˆå¾—æ”¹ä»£ç ï¼Ÿ\nå¦‚æœä½ è§‰å¾—è¿˜è¡Œï¼Œé‚£ä¹ˆæˆ‘è¿™ä¸ªæ—¶å€™ä¸è¦å‘é‚®ä»¶è¿™ä¸ªæœåŠ¡äº†å‘¢ï¼Œæˆ‘æ˜¯ä¸æ˜¯åˆå¾—æ”¹ä»£ç ï¼Œåˆå¾—é‡å¯åº”ç”¨ï¼Ÿ\nè¿™æ ·æ”¹æ¥æ”¹å»æ˜¯ä¸æ˜¯å¾ˆéº»çƒ¦ï¼Œé‚£ä¹ˆ æ­¤æ—¶æˆ‘ä»¬å°±ç”¨ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—åœ¨ä¸­é—´è¿›è¡Œè§£è€¦ ã€‚ä½ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åé¢çš„å‘é€çŸ­ä¿¡ã€å‘é€é‚®ä»¶ã€æ·»åŠ ç§¯åˆ†ç­‰ä¸€äº›æ“ä½œéƒ½ä¾èµ–äºä¸Šé¢çš„ result ï¼Œè¿™ä¸œè¥¿æŠ½è±¡å‡ºæ¥å°±æ˜¯è´­ç¥¨çš„å¤„ç†ç»“æœå‘€ï¼Œæ¯”å¦‚è®¢å•å·ï¼Œç”¨æˆ·è´¦å·ç­‰ç­‰ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åé¢çš„ä¸€ç³»åˆ—æœåŠ¡éƒ½æ˜¯éœ€è¦åŒæ ·çš„æ¶ˆæ¯æ¥è¿›è¡Œå¤„ç†ã€‚æ—¢ç„¶è¿™æ ·ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥é€šè¿‡ â€œå¹¿æ’­æ¶ˆæ¯â€ æ¥å®ç°ã€‚\næˆ‘ä¸Šé¢æ‰€è®²çš„â€œå¹¿æ’­â€å¹¶ä¸æ˜¯çœŸæ­£çš„å¹¿æ’­ï¼Œè€Œæ˜¯æ¥ä¸‹æ¥çš„ç³»ç»Ÿä½œä¸ºæ¶ˆè´¹è€…å» è®¢é˜… ç‰¹å®šçš„ä¸»é¢˜ã€‚æ¯”å¦‚æˆ‘ä»¬è¿™é‡Œçš„ä¸»é¢˜å°±å¯ä»¥å«åš è®¢ç¥¨ ï¼Œæˆ‘ä»¬è´­ä¹°ç³»ç»Ÿä½œä¸ºä¸€ä¸ªç”Ÿäº§è€…å»ç”Ÿäº§è¿™æ¡æ¶ˆæ¯æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶åæ¶ˆè´¹è€…è®¢é˜…äº†è¿™ä¸ªä¸»é¢˜ï¼Œä¼šä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ‹‰å–æ¶ˆæ¯å¹¶æ¶ˆè´¹ã€‚å°±æ¯”å¦‚æˆ‘ä»¬åˆšåˆšç”»çš„é‚£å¼ å›¾ï¼Œä½ ä¼šå‘ç°ï¼Œåœ¨ç”Ÿäº§è€…è¿™è¾¹æˆ‘ä»¬åªéœ€è¦å…³æ³¨ ç”Ÿäº§æ¶ˆæ¯åˆ°æŒ‡å®šä¸»é¢˜ä¸­ ï¼Œè€Œ æ¶ˆè´¹è€…åªéœ€è¦å…³æ³¨ä»æŒ‡å®šä¸»é¢˜ä¸­æ‹‰å–æ¶ˆæ¯ å°±è¡Œäº†ã€‚\nå¦‚æœæ²¡æœ‰æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¯å½“ä¸€ä¸ªæ–°çš„ä¸šåŠ¡æ¥å…¥ï¼Œæˆ‘ä»¬éƒ½è¦åœ¨ä¸»ç³»ç»Ÿè°ƒç”¨æ–°æ¥å£ã€æˆ–è€…å½“æˆ‘ä»¬å–æ¶ˆæŸäº›ä¸šåŠ¡ï¼Œæˆ‘ä»¬ä¹Ÿå¾—åœ¨ä¸»ç³»ç»Ÿåˆ é™¤æŸäº›æ¥å£è°ƒç”¨ã€‚æœ‰äº†æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæˆ‘ä»¬åªéœ€è¦å…³å¿ƒæ¶ˆæ¯æ˜¯å¦é€è¾¾äº†é˜Ÿåˆ—ï¼Œè‡³äºè°å¸Œæœ›è®¢é˜…ï¼Œæ¥ä¸‹æ¥æ”¶åˆ°æ¶ˆæ¯å¦‚ä½•å¤„ç†ï¼Œæ˜¯ä¸‹æ¸¸çš„äº‹æƒ…ï¼Œæ— ç–‘æå¤§åœ°å‡å°‘äº†å¼€å‘å’Œè”è°ƒçš„å·¥ä½œé‡ã€‚\n# å‰Šå³°ï¼ˆxue 1) # æˆ‘ä»¬å†æ¬¡å›åˆ°ä¸€å¼€å§‹æˆ‘ä»¬ä½¿ç”¨åŒæ­¥è°ƒç”¨ç³»ç»Ÿçš„æƒ…å†µï¼Œå¹¶ä¸”æ€è€ƒä¸€ä¸‹ï¼Œå¦‚æœæ­¤æ—¶æœ‰å¤§é‡ç”¨æˆ·è¯·æ±‚è´­ç¥¨æ•´ä¸ªç³»ç»Ÿä¼šå˜æˆä»€ä¹ˆæ ·ï¼Ÿ\nå¦‚æœï¼Œæ­¤æ—¶æœ‰ä¸€ä¸‡çš„è¯·æ±‚è¿›å…¥è´­ç¥¨ç³»ç»Ÿï¼Œæˆ‘ä»¬çŸ¥é“è¿è¡Œæˆ‘ä»¬ä¸»ä¸šåŠ¡çš„æœåŠ¡å™¨é…ç½®ä¸€èˆ¬ä¼šæ¯”è¾ƒå¥½ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å‡è®¾è´­ç¥¨ç³»ç»Ÿèƒ½æ‰¿å—è¿™ä¸€ä¸‡çš„ç”¨æˆ·è¯·æ±‚ï¼Œé‚£ä¹ˆä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬åŒæ—¶ä¹Ÿä¼šå‡ºç°ä¸€ä¸‡è°ƒç”¨å‘çŸ­ä¿¡æœåŠ¡çš„è¯·æ±‚ã€‚è€Œå¯¹äºçŸ­ä¿¡ç³»ç»Ÿæ¥è¯´å¹¶ä¸æ˜¯æˆ‘ä»¬çš„ä¸»è¦ä¸šåŠ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬é…å¤‡çš„ç¡¬ä»¶èµ„æºå¹¶ä¸ä¼šå¤ªé«˜ï¼Œé‚£ä¹ˆä½ è§‰å¾—ç°åœ¨è¿™ä¸ªçŸ­ä¿¡ç³»ç»Ÿèƒ½æ‰¿å—è¿™ä¸€ä¸‡çš„å³°å€¼ä¹ˆï¼Œä¸”ä¸è¯´èƒ½ä¸èƒ½æ‰¿å—ï¼Œç³»ç»Ÿä¼šä¸ä¼š ç›´æ¥å´©æºƒ äº†ï¼Ÿ\nçŸ­ä¿¡ä¸šåŠ¡åˆä¸æ˜¯æˆ‘ä»¬çš„ä¸»ä¸šåŠ¡ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½ æŠ˜ä¸­å¤„ç† å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬æŠŠè´­ä¹°å®Œæˆçš„ä¿¡æ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œè€ŒçŸ­ä¿¡ç³»ç»Ÿ å°½è‡ªå·±æ‰€èƒ½åœ°å»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–æ¶ˆæ¯å’Œæ¶ˆè´¹æ¶ˆæ¯ ï¼Œå³ä½¿å¤„ç†é€Ÿåº¦æ…¢ä¸€ç‚¹ä¹Ÿæ— æ‰€è°“ï¼Œåªè¦æˆ‘ä»¬çš„ç³»ç»Ÿæ²¡æœ‰å´©æºƒå°±è¡Œäº†ã€‚\nç•™å¾—æ±Ÿå±±åœ¨ï¼Œè¿˜æ€•æ²¡æŸ´çƒ§ï¼Ÿä½ æ•¢è¯´æ¯æ¬¡å‘é€éªŒè¯ç çš„æ—¶å€™æ˜¯ä¸€å‘ä½ å°±æ”¶åˆ°äº†çš„ä¹ˆï¼Ÿ\n# æ¶ˆæ¯é˜Ÿåˆ—èƒ½å¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼Ÿ # å…¶å®ä¸Šé¢æˆ‘å·²ç»è¯´äº†ã€‚å¼‚æ­¥ã€è§£è€¦ã€å‰Šå³°ã€‚ å“ªæ€•ä½ ä¸Šé¢çš„éƒ½æ²¡çœ‹æ‡‚ä¹Ÿåƒä¸‡è¦è®°ä½è¿™å…­ä¸ªå­—ï¼Œå› ä¸ºä»–ä¸ä»…æ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„ç²¾åï¼Œæ›´æ˜¯ç¼–ç¨‹å’Œæ¶æ„çš„ç²¾åã€‚\n# æ¶ˆæ¯é˜Ÿåˆ—ä¼šå¸¦æ¥å‰¯ä½œç”¨å—ï¼Ÿ # æ²¡æœ‰å“ªä¸€é—¨æŠ€æœ¯æ˜¯â€œé“¶å¼¹â€ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿæœ‰å®ƒçš„å‰¯ä½œç”¨ã€‚\næ¯”å¦‚ï¼Œæœ¬æ¥å¥½å¥½çš„ä¸¤ä¸ªç³»ç»Ÿä¹‹é—´çš„è°ƒç”¨ï¼Œæˆ‘ä¸­é—´åŠ äº†ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚æœæ¶ˆæ¯é˜Ÿåˆ—æŒ‚äº†æ€ä¹ˆåŠå‘¢ï¼Ÿæ˜¯ä¸æ˜¯ é™ä½äº†ç³»ç»Ÿçš„å¯ç”¨æ€§ ï¼Ÿ\né‚£è¿™æ ·æ˜¯ä¸æ˜¯è¦ä¿è¯HA(é«˜å¯ç”¨)ï¼Ÿæ˜¯ä¸æ˜¯è¦æé›†ç¾¤ï¼Ÿé‚£ä¹ˆæˆ‘ æ•´ä¸ªç³»ç»Ÿçš„å¤æ‚åº¦æ˜¯ä¸æ˜¯ä¸Šå‡äº† ï¼Ÿ\næŠ›å¼€ä¸Šé¢çš„é—®é¢˜ä¸è®²ï¼Œä¸‡ä¸€æˆ‘å‘é€æ–¹å‘é€å¤±è´¥äº†ï¼Œç„¶åæ‰§è¡Œé‡è¯•ï¼Œè¿™æ ·å°±å¯èƒ½äº§ç”Ÿé‡å¤çš„æ¶ˆæ¯ã€‚\næˆ–è€…æˆ‘æ¶ˆè´¹ç«¯å¤„ç†å¤±è´¥äº†ï¼Œè¯·æ±‚é‡å‘ï¼Œè¿™æ ·ä¹Ÿä¼šäº§ç”Ÿé‡å¤çš„æ¶ˆæ¯ã€‚\nå¯¹äºä¸€äº›å¾®æœåŠ¡æ¥è¯´ï¼Œæ¶ˆè´¹é‡å¤æ¶ˆæ¯ä¼šå¸¦æ¥æ›´å¤§çš„éº»çƒ¦ï¼Œæ¯”å¦‚å¢åŠ ç§¯åˆ†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘åŠ äº†å¤šæ¬¡æ˜¯ä¸æ˜¯å¯¹å…¶ä»–ç”¨æˆ·ä¸å…¬å¹³ï¼Ÿ\né‚£ä¹ˆï¼Œåˆ å¦‚ä½•è§£å†³é‡å¤æ¶ˆè´¹æ¶ˆæ¯çš„é—®é¢˜ å‘¢ï¼Ÿ\nå¦‚æœæˆ‘ä»¬æ­¤æ—¶çš„æ¶ˆæ¯éœ€è¦ä¿è¯ä¸¥æ ¼çš„é¡ºåºæ€§æ€ä¹ˆåŠå‘¢ï¼Ÿæ¯”å¦‚ç”Ÿäº§è€…ç”Ÿäº§äº†ä¸€ç³»åˆ—çš„æœ‰åºæ¶ˆæ¯(å¯¹ä¸€ä¸ªidä¸º1çš„è®°å½•è¿›è¡Œåˆ é™¤å¢åŠ ä¿®æ”¹)ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“åœ¨å‘å¸ƒè®¢é˜…æ¨¡å‹ä¸­ï¼Œå¯¹äºä¸»é¢˜æ˜¯æ— é¡ºåºçš„ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±ä¼šå¯¼è‡´å¯¹äºæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯çš„æ—¶å€™æ²¡æœ‰æŒ‰ç…§ç”Ÿäº§è€…çš„å‘é€é¡ºåºæ¶ˆè´¹ï¼Œæ¯”å¦‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ¶ˆè´¹çš„é¡ºåºä¸ºä¿®æ”¹åˆ é™¤å¢åŠ ï¼Œå¦‚æœè¯¥è®°å½•æ¶‰åŠåˆ°é‡‘é¢çš„è¯æ˜¯ä¸æ˜¯ä¼šå‡ºå¤§äº‹æƒ…ï¼Ÿ\né‚£ä¹ˆï¼Œåˆ å¦‚ä½•è§£å†³æ¶ˆæ¯çš„é¡ºåºæ¶ˆè´¹é—®é¢˜ å‘¢ï¼Ÿ\nå°±æ‹¿æˆ‘ä»¬ä¸Šé¢æ‰€è®²çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œç”¨æˆ·è´­ç¥¨å®Œæˆä¹‹åæ˜¯ä¸æ˜¯éœ€è¦å¢åŠ è´¦æˆ·ç§¯åˆ†ï¼Ÿåœ¨åŒä¸€ä¸ªç³»ç»Ÿä¸­æˆ‘ä»¬ä¸€èˆ¬ä¼šä½¿ç”¨äº‹åŠ¡æ¥è¿›è¡Œè§£å†³ï¼Œå¦‚æœç”¨ Spring çš„è¯æˆ‘ä»¬åœ¨ä¸Šé¢ä¼ªä»£ç ä¸­åŠ å…¥ @Transactional æ³¨è§£å°±å¥½äº†ã€‚ä½†æ˜¯åœ¨ä¸åŒç³»ç»Ÿä¸­å¦‚ä½•ä¿è¯äº‹åŠ¡å‘¢ï¼Ÿæ€»ä¸èƒ½è¿™ä¸ªç³»ç»Ÿæˆ‘æ‰£é’±æˆåŠŸäº†ä½ é‚£ç§¯åˆ†ç³»ç»Ÿç§¯åˆ†æ²¡åŠ å§ï¼Ÿæˆ–è€…è¯´æˆ‘è¿™æ‰£é’±æ˜æ˜å¤±è´¥äº†ï¼Œä½ é‚£ç§¯åˆ†ç³»ç»Ÿç»™æˆ‘åŠ äº†ç§¯åˆ†ã€‚\né‚£ä¹ˆï¼Œåˆå¦‚ä½• è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ å‘¢ï¼Ÿ\næˆ‘ä»¬åˆšåˆšè¯´äº†ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥è¿›è¡Œå‰Šå³°æ“ä½œï¼Œé‚£å¦‚æœæˆ‘çš„æ¶ˆè´¹è€…å¦‚æœæ¶ˆè´¹å¾ˆæ…¢æˆ–è€…ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯å¾ˆå¿«ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯ä¼šå°†æ¶ˆæ¯å †ç§¯åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Ÿ\né‚£ä¹ˆï¼Œåˆå¦‚ä½• è§£å†³æ¶ˆæ¯å †ç§¯çš„é—®é¢˜ å‘¢ï¼Ÿ\nå¯ç”¨æ€§é™ä½ï¼Œå¤æ‚åº¦ä¸Šå‡ï¼Œåˆå¸¦æ¥ä¸€ç³»åˆ—çš„é‡å¤æ¶ˆè´¹ï¼Œé¡ºåºæ¶ˆè´¹ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæ¶ˆæ¯å †ç§¯çš„é—®é¢˜ï¼Œè¿™æ¶ˆæ¯é˜Ÿåˆ—è¿˜æ€ä¹ˆç”¨å•ŠğŸ˜µï¼Ÿ\nåˆ«æ€¥ï¼ŒåŠæ³•æ€»æ˜¯æœ‰çš„ã€‚\n# RocketMQæ˜¯ä»€ä¹ˆï¼Ÿ # åŸç† æ¥æºï¼š https://www.bilibili.com/video/BV1GY4y1F7og\nå“‡ï¼Œä½ ä¸ªæ··è›‹ï¼ä¸Šé¢ç»™æˆ‘æŠ›å‡ºé‚£ä¹ˆå¤šé—®é¢˜ï¼Œä½ ç°åœ¨åˆè®² RocketMQ ï¼Œè¿˜è®©ä¸è®©äººæ´»äº†ï¼Ÿï¼ğŸ¤¬\nåˆ«æ€¥åˆ«æ€¥ï¼Œè¯è¯´ä½ ç°åœ¨æ¸…æ¥š MQ çš„æ„é€ å—ï¼Œæˆ‘è¿˜æ²¡è®²å‘¢ï¼Œæˆ‘ä»¬å…ˆææ˜ç™½ MQ çš„å†…éƒ¨æ„é€ ï¼Œå†æ¥çœ‹çœ‹å¦‚ä½•è§£å†³ä¸Šé¢çš„ä¸€ç³»åˆ—é—®é¢˜å§ï¼Œä¸è¿‡ä½ æœ€å¥½å¸¦ç€é—®é¢˜å»é˜…è¯»å’Œäº†è§£å–”ã€‚\nRocketMQ æ˜¯ä¸€ä¸ª é˜Ÿåˆ—æ¨¡å‹ çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå…·æœ‰é«˜æ€§èƒ½ã€é«˜å¯é ã€é«˜å®æ—¶ã€åˆ†å¸ƒå¼ çš„ç‰¹ç‚¹ã€‚å®ƒæ˜¯ä¸€ä¸ªé‡‡ç”¨ Java è¯­è¨€å¼€å‘çš„åˆ†å¸ƒå¼çš„æ¶ˆæ¯ç³»ç»Ÿï¼Œç”±é˜¿é‡Œå·´å·´å›¢é˜Ÿå¼€å‘ï¼Œåœ¨2016å¹´åº•è´¡çŒ®ç»™ Apacheï¼Œæˆä¸ºäº† Apache çš„ä¸€ä¸ªé¡¶çº§é¡¹ç›®ã€‚ åœ¨é˜¿é‡Œå†…éƒ¨ï¼ŒRocketMQ å¾ˆå¥½åœ°æœåŠ¡äº†é›†å›¢å¤§å¤§å°å°ä¸Šåƒä¸ªåº”ç”¨ï¼Œåœ¨æ¯å¹´çš„åŒåä¸€å½“å¤©ï¼Œæ›´æœ‰ä¸å¯æ€è®®çš„ä¸‡äº¿çº§æ¶ˆæ¯é€šè¿‡ RocketMQ æµè½¬ã€‚\nåºŸè¯ä¸å¤šè¯´ï¼Œæƒ³è¦äº†è§£ RocketMQ å†å²çš„åŒå­¦å¯ä»¥è‡ªå·±å»æœå¯»èµ„æ–™ã€‚å¬å®Œä¸Šé¢çš„ä»‹ç»ï¼Œä½ åªè¦çŸ¥é“ RocketMQ å¾ˆå¿«ã€å¾ˆç‰›ã€è€Œä¸”ç»å†è¿‡åŒåä¸€çš„å®è·µå°±è¡Œäº†ï¼\n# é˜Ÿåˆ—æ¨¡å‹å’Œä¸»é¢˜æ¨¡å‹ # åœ¨è°ˆ RocketMQ çš„æŠ€æœ¯æ¶æ„ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ä¸¤ä¸ªåè¯æ¦‚å¿µâ€”â€”é˜Ÿåˆ—æ¨¡å‹ å’Œ ä¸»é¢˜æ¨¡å‹ ã€‚\né¦–å…ˆæˆ‘é—®ä¸€ä¸ªé—®é¢˜ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¸ºä»€ä¹ˆè¦å«æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ\nä½ å¯èƒ½è§‰å¾—å¾ˆå¼±æ™ºï¼Œè¿™ç©æ„ä¸å°±æ˜¯å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—å˜›ï¼Ÿä¸å«æ¶ˆæ¯é˜Ÿåˆ—å«ä»€ä¹ˆï¼Ÿ\nçš„ç¡®ï¼Œæ—©æœŸçš„æ¶ˆæ¯ä¸­é—´ä»¶æ˜¯é€šè¿‡ é˜Ÿåˆ— è¿™ä¸€æ¨¡å‹æ¥å®ç°çš„ï¼Œå¯èƒ½æ˜¯å†å²åŸå› ï¼Œæˆ‘ä»¬éƒ½ä¹ æƒ¯æŠŠæ¶ˆæ¯ä¸­é—´ä»¶ç§°ä¸ºæ¶ˆæ¯é˜Ÿåˆ—ã€‚\nä½†æ˜¯ï¼Œå¦‚ä»Šä¾‹å¦‚ RocketMQ ã€Kafka è¿™äº›ä¼˜ç§€çš„æ¶ˆæ¯ä¸­é—´ä»¶ä¸ä»…ä»…æ˜¯é€šè¿‡ä¸€ä¸ª é˜Ÿåˆ— æ¥å®ç°æ¶ˆæ¯å­˜å‚¨çš„ã€‚\n# é˜Ÿåˆ—æ¨¡å‹ # å°±åƒæˆ‘ä»¬ç†è§£é˜Ÿåˆ—ä¸€æ ·ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶çš„é˜Ÿåˆ—æ¨¡å‹å°±çœŸçš„åªæ˜¯ä¸€ä¸ªé˜Ÿåˆ—ã€‚ã€‚ã€‚æˆ‘ç”»ä¸€å¼ å›¾ç»™å¤§å®¶ç†è§£ã€‚\nåœ¨ä¸€å¼€å§‹æˆ‘è·Ÿä½ æåˆ°äº†ä¸€ä¸ª â€œå¹¿æ’­â€ çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬æ­¤æ—¶æˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªæ¶ˆæ¯å‘é€ç»™å¤šä¸ªæ¶ˆè´¹è€…(æ¯”å¦‚æ­¤æ—¶æˆ‘éœ€è¦å°†ä¿¡æ¯å‘é€ç»™çŸ­ä¿¡ç³»ç»Ÿå’Œé‚®ä»¶ç³»ç»Ÿ)ï¼Œè¿™ä¸ªæ—¶å€™å•ä¸ªé˜Ÿåˆ—å³ä¸èƒ½æ»¡è¶³éœ€æ±‚äº†ã€‚\nå½“ç„¶ä½ å¯ä»¥è®© Producer ç”Ÿäº§æ¶ˆæ¯æ”¾å…¥å¤šä¸ªé˜Ÿåˆ—ä¸­ï¼Œç„¶åæ¯ä¸ªé˜Ÿåˆ—å»å¯¹åº”æ¯ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚é—®é¢˜æ˜¯å¯ä»¥è§£å†³ï¼Œåˆ›å»ºå¤šä¸ªé˜Ÿåˆ—å¹¶ä¸”å¤åˆ¶å¤šä»½æ¶ˆæ¯æ˜¯ä¼šå¾ˆå½±å“èµ„æºå’Œæ€§èƒ½çš„ã€‚è€Œä¸”ï¼Œè¿™æ ·å­å°±ä¼šå¯¼è‡´ç”Ÿäº§è€…éœ€è¦çŸ¥é“å…·ä½“æ¶ˆè´¹è€…ä¸ªæ•°ç„¶åå»å¤åˆ¶å¯¹åº”æ•°é‡çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™å°±è¿èƒŒæˆ‘ä»¬æ¶ˆæ¯ä¸­é—´ä»¶çš„ è§£è€¦ è¿™ä¸€åŸåˆ™ã€‚\n# ä¸»é¢˜æ¨¡å‹ # é‚£ä¹ˆæœ‰æ²¡æœ‰å¥½çš„æ–¹æ³•å»è§£å†³è¿™ä¸€ä¸ªé—®é¢˜å‘¢ï¼Ÿæœ‰ï¼Œé‚£å°±æ˜¯ ä¸»é¢˜æ¨¡å‹ æˆ–è€…å¯ä»¥ç§°ä¸º å‘å¸ƒè®¢é˜…æ¨¡å‹ ã€‚\næ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»äº†è§£ä¸€ä¸‹è®¾è®¡æ¨¡å¼é‡Œé¢çš„è§‚å¯Ÿè€…æ¨¡å¼å¹¶ä¸”æ‰‹åŠ¨å®ç°ä¸€ä¸‹ï¼Œæˆ‘ç›¸ä¿¡ä½ ä¼šæœ‰æ‰€æ”¶è·çš„ã€‚\nåœ¨ä¸»é¢˜æ¨¡å‹ä¸­ï¼Œæ¶ˆæ¯çš„ç”Ÿäº§è€…ç§°ä¸º å‘å¸ƒè€…(Publisher) ï¼Œæ¶ˆæ¯çš„æ¶ˆè´¹è€…ç§°ä¸º è®¢é˜…è€…(Subscriber) ï¼Œå­˜æ”¾æ¶ˆæ¯çš„å®¹å™¨ç§°ä¸º ä¸»é¢˜(Topic) ã€‚\nå…¶ä¸­ï¼Œå‘å¸ƒè€…å°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šä¸»é¢˜ä¸­ï¼Œè®¢é˜…è€…éœ€è¦ æå‰è®¢é˜…ä¸»é¢˜ æ‰èƒ½æ¥å—ç‰¹å®šä¸»é¢˜çš„æ¶ˆæ¯ã€‚\n# RocketMQä¸­çš„æ¶ˆæ¯æ¨¡å‹ # RocketMQ ä¸­çš„æ¶ˆæ¯æ¨¡å‹å°±æ˜¯æŒ‰ç…§ ä¸»é¢˜æ¨¡å‹ æ‰€å®ç°çš„ã€‚ä½ å¯èƒ½ä¼šå¥½å¥‡è¿™ä¸ª ä¸»é¢˜ åˆ°åº•æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿä½ ä¸Šé¢ä¹Ÿæ²¡æœ‰è®²åˆ°å‘€ï¼\nå…¶å®å¯¹äºä¸»é¢˜æ¨¡å‹çš„å®ç°æ¥è¯´æ¯ä¸ªæ¶ˆæ¯ä¸­é—´ä»¶çš„åº•å±‚è®¾è®¡éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œå°±æ¯”å¦‚ Kafka ä¸­çš„ åˆ†åŒº ï¼ŒRocketMQ ä¸­çš„ é˜Ÿåˆ— ï¼ŒRabbitMQ ä¸­çš„ Exchange ã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸º ä¸»é¢˜æ¨¡å‹/å‘å¸ƒè®¢é˜…æ¨¡å‹ å°±æ˜¯ä¸€ä¸ªæ ‡å‡†ï¼Œé‚£äº›ä¸­é—´ä»¶åªä¸è¿‡ç…§ç€è¿™ä¸ªæ ‡å‡†å»å®ç°è€Œå·²ã€‚\næ‰€ä»¥ï¼ŒRocketMQ ä¸­çš„ ä¸»é¢˜æ¨¡å‹ åˆ°åº•æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿé¦–å…ˆæˆ‘ç”»ä¸€å¼ å›¾ï¼Œå¤§å®¶å°è¯•ç€å»ç†è§£ä¸€ä¸‹ã€‚\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨æ•´ä¸ªå›¾ä¸­æœ‰ Producer Group ã€Topic ã€Consumer Group ä¸‰ä¸ªè§’è‰²ï¼Œæˆ‘æ¥åˆ†åˆ«ä»‹ç»ä¸€ä¸‹ä»–ä»¬ã€‚\nProducer Group ç”Ÿäº§è€…ç»„ï¼š ä»£è¡¨æŸä¸€ç±»çš„ç”Ÿäº§è€…ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰å¤šä¸ªç§’æ€ç³»ç»Ÿä½œä¸ºç”Ÿäº§è€…ï¼Œè¿™å¤šä¸ªåˆåœ¨ä¸€èµ·å°±æ˜¯ä¸€ä¸ª Producer Group ç”Ÿäº§è€…ç»„ï¼Œå®ƒä»¬ä¸€èˆ¬ç”Ÿäº§ç›¸åŒçš„æ¶ˆæ¯ã€‚ Consumer Group æ¶ˆè´¹è€…ç»„ï¼š ä»£è¡¨æŸä¸€ç±»çš„æ¶ˆè´¹è€…ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰å¤šä¸ªçŸ­ä¿¡ç³»ç»Ÿä½œä¸ºæ¶ˆè´¹è€…ï¼Œè¿™å¤šä¸ªåˆåœ¨ä¸€èµ·å°±æ˜¯ä¸€ä¸ª Consumer Group æ¶ˆè´¹è€…ç»„ï¼Œå®ƒä»¬ä¸€èˆ¬æ¶ˆè´¹ç›¸åŒçš„æ¶ˆæ¯ã€‚ Topic ä¸»é¢˜ï¼š ä»£è¡¨ä¸€ç±»æ¶ˆæ¯ï¼Œæ¯”å¦‚è®¢å•æ¶ˆæ¯ï¼Œç‰©æµæ¶ˆæ¯ç­‰ç­‰ã€‚ ä½ å¯ä»¥çœ‹åˆ°å›¾ä¸­ç”Ÿäº§è€…ç»„ä¸­çš„ç”Ÿäº§è€…ä¼šå‘ä¸»é¢˜å‘é€æ¶ˆæ¯ï¼Œè€Œ ä¸»é¢˜ä¸­å­˜åœ¨å¤šä¸ªé˜Ÿåˆ—ï¼Œç”Ÿäº§è€…æ¯æ¬¡ç”Ÿäº§æ¶ˆæ¯ä¹‹åæ˜¯æŒ‡å®šä¸»é¢˜ä¸­çš„æŸä¸ªé˜Ÿåˆ—å‘é€æ¶ˆæ¯çš„ã€‚\nlyï¼šæˆ‘çš„ç†è§£æ˜¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒåŒä¸€ä¸ªç”Ÿäº§è€…ç»„ç”Ÿäº§çš„æ¶ˆæ¯ï¼Œä¼šå‘åˆ°åŒä¸€ä¸ªtopicä¸­\næ¯ä¸ªä¸»é¢˜ä¸­éƒ½æœ‰å¤šä¸ªé˜Ÿåˆ—(è¿™é‡Œè¿˜ä¸æ¶‰åŠåˆ°Â Broker)ï¼Œé›†ç¾¤æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…é›†ç¾¤å¤šå°æœºå™¨å…±åŒæ¶ˆè´¹ä¸€ä¸ª topic çš„å¤šä¸ªé˜Ÿåˆ—ï¼Œä¸€ä¸ªé˜Ÿåˆ—åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ã€‚å¦‚æœæŸä¸ªæ¶ˆè´¹è€…æŒ‚æ‰ï¼Œåˆ†ç»„å†…å…¶å®ƒæ¶ˆè´¹è€…ä¼šæ¥æ›¿æŒ‚æ‰çš„æ¶ˆè´¹è€…ç»§ç»­æ¶ˆè´¹ã€‚å°±åƒä¸Šå›¾ä¸­ Consumer1 å’Œ Consumer2 åˆ†åˆ«å¯¹åº”ç€ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œè€Œ Consumer3 æ˜¯æ²¡æœ‰é˜Ÿåˆ—å¯¹åº”çš„ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¥è®²è¦æ§åˆ¶ æ¶ˆè´¹è€…ç»„ä¸­çš„æ¶ˆè´¹è€…ä¸ªæ•°å’Œä¸»é¢˜ä¸­é˜Ÿåˆ—ä¸ªæ•°ç›¸åŒ ã€‚\nå½“ç„¶ä¹Ÿå¯ä»¥æ¶ˆè´¹è€…ä¸ªæ•°å°äºé˜Ÿåˆ—ä¸ªæ•°ï¼Œåªä¸è¿‡ä¸å¤ªå»ºè®®ã€‚å¦‚ä¸‹å›¾ã€‚\næ¯ä¸ªæ¶ˆè´¹ç»„åœ¨æ¯ä¸ªé˜Ÿåˆ—ä¸Šç»´æŠ¤ä¸€ä¸ªæ¶ˆè´¹ä½ç½® ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\nå› ä¸ºæˆ‘ä»¬åˆšåˆšç”»çš„ä»…ä»…æ˜¯ä¸€ä¸ªæ¶ˆè´¹è€…ç»„ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨å‘å¸ƒè®¢é˜…æ¨¡å¼ä¸­ä¸€èˆ¬ä¼šæ¶‰åŠåˆ°å¤šä¸ªæ¶ˆè´¹è€…ç»„ï¼Œè€Œæ¯ä¸ªæ¶ˆè´¹è€…ç»„åœ¨æ¯ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆè´¹ä½ç½®éƒ½æ˜¯ä¸åŒçš„ã€‚å¦‚æœæ­¤æ—¶æœ‰å¤šä¸ªæ¶ˆè´¹è€…ç»„ï¼Œé‚£ä¹ˆæ¶ˆæ¯è¢«ä¸€ä¸ªæ¶ˆè´¹è€…ç»„æ¶ˆè´¹å®Œä¹‹åæ˜¯ä¸ä¼šåˆ é™¤çš„(å› ä¸ºå…¶å®ƒæ¶ˆè´¹è€…ç»„ä¹Ÿéœ€è¦å‘€ ã€æ³¨æ„é‡ç‚¹ï¼Œæ˜¯æ¶ˆè´¹å®Œä¹‹åã€‘)ï¼Œå®ƒä»…ä»…æ˜¯ä¸ºæ¯ä¸ªæ¶ˆè´¹è€…ç»„ç»´æŠ¤ä¸€ä¸ª æ¶ˆè´¹ä½ç§»(offset) ï¼Œæ¯æ¬¡æ¶ˆè´¹è€…ç»„æ¶ˆè´¹å®Œä¼šè¿”å›ä¸€ä¸ªæˆåŠŸçš„å“åº”ï¼Œç„¶åé˜Ÿåˆ—å†æŠŠç»´æŠ¤çš„æ¶ˆè´¹ä½ç§»åŠ ä¸€ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°åˆšåˆšæ¶ˆè´¹è¿‡çš„æ¶ˆæ¯å†ä¸€æ¬¡è¢«æ¶ˆè´¹äº†ã€‚\nå¯èƒ½ä½ è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆä¸€ä¸ªä¸»é¢˜ä¸­éœ€è¦ç»´æŠ¤å¤šä¸ªé˜Ÿåˆ— ï¼Ÿ\nç­”æ¡ˆæ˜¯ æé«˜å¹¶å‘èƒ½åŠ› ã€‚çš„ç¡®ï¼Œæ¯ä¸ªä¸»é¢˜ä¸­åªå­˜åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚ä½ æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæ¯ä¸ªä¸»é¢˜ä¸­åªå­˜åœ¨ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—ä¸­ä¹Ÿç»´æŠ¤ç€æ¯ä¸ªæ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹ä½ç½®ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥åšåˆ° å‘å¸ƒè®¢é˜…æ¨¡å¼ ã€‚å¦‚ä¸‹å›¾ã€‚\nä½†æ˜¯ï¼Œè¿™æ ·æˆ‘ç”Ÿäº§è€…æ˜¯ä¸æ˜¯åªèƒ½å‘ä¸€ä¸ªé˜Ÿåˆ—å‘é€æ¶ˆæ¯ï¼Ÿåˆå› ä¸ºéœ€è¦ç»´æŠ¤æ¶ˆè´¹ä½ç½®æ‰€ä»¥ä¸€ä¸ªé˜Ÿåˆ—åªèƒ½å¯¹åº”ä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­çš„æ¶ˆè´¹è€…ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯å…¶ä»–çš„ Consumer å°±æ²¡æœ‰ç”¨æ­¦ä¹‹åœ°äº†ï¼Ÿä»è¿™ä¸¤ä¸ªè§’åº¦æ¥è®²ï¼Œå¹¶å‘åº¦ä¸€ä¸‹å­å°±å°äº†å¾ˆå¤šã€‚\næ‰€ä»¥æ€»ç»“æ¥è¯´ï¼ŒRocketMQ é€šè¿‡ä½¿ç”¨åœ¨ä¸€ä¸ª Topic ä¸­é…ç½®å¤šä¸ªé˜Ÿåˆ—å¹¶ä¸”æ¯ä¸ªé˜Ÿåˆ—ç»´æŠ¤æ¯ä¸ªæ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹ä½ç½® å®ç°äº† ä¸»é¢˜æ¨¡å¼/å‘å¸ƒè®¢é˜…æ¨¡å¼ ã€‚\n# RocketMQçš„æ¶æ„å›¾ # è®²å®Œäº†æ¶ˆæ¯æ¨¡å‹ï¼Œæˆ‘ä»¬ç†è§£èµ· RocketMQ çš„æŠ€æœ¯æ¶æ„èµ·æ¥å°±å®¹æ˜“å¤šäº†ã€‚\nRocketMQ æŠ€æœ¯æ¶æ„ä¸­æœ‰å››å¤§è§’è‰² NameServer ã€Broker ã€Producer ã€Consumer ã€‚æˆ‘æ¥å‘å¤§å®¶åˆ†åˆ«è§£é‡Šä¸€ä¸‹è¿™å››ä¸ªè§’è‰²æ˜¯å¹²å•¥çš„ã€‚\nBrokerï¼š ä¸»è¦è´Ÿè´£æ¶ˆæ¯çš„å­˜å‚¨ã€æŠ•é€’å’ŒæŸ¥è¯¢ä»¥åŠæœåŠ¡é«˜å¯ç”¨ä¿è¯ã€‚è¯´ç™½äº†å°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨å˜›ï¼Œç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯åˆ° Broker ï¼Œæ¶ˆè´¹è€…ä» Broker æ‹‰å–æ¶ˆæ¯å¹¶æ¶ˆè´¹ã€‚\nè¿™é‡Œï¼Œæˆ‘è¿˜å¾—æ™®åŠä¸€ä¸‹å…³äº Broker ã€Topic å’Œ é˜Ÿåˆ—çš„å…³ç³»ã€‚ä¸Šé¢æˆ‘è®²è§£äº† Topic å’Œé˜Ÿåˆ—çš„å…³ç³»â€”â€”ä¸€ä¸ª Topic ä¸­å­˜åœ¨å¤šä¸ªé˜Ÿåˆ—ï¼Œé‚£ä¹ˆè¿™ä¸ª Topic å’Œé˜Ÿåˆ—å­˜æ”¾åœ¨å“ªå‘¢ï¼Ÿ\nä¸€ä¸ª Topic åˆ†å¸ƒåœ¨å¤šä¸ª Brokerä¸Šï¼Œä¸€ä¸ª Broker å¯ä»¥é…ç½®å¤šä¸ª Topic ï¼Œå®ƒä»¬æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ã€‚\nå¦‚æœæŸä¸ª Topic æ¶ˆæ¯é‡å¾ˆå¤§ï¼Œåº”è¯¥ç»™å®ƒå¤šé…ç½®å‡ ä¸ªé˜Ÿåˆ—(ä¸Šæ–‡ä¸­æåˆ°äº†æé«˜å¹¶å‘èƒ½åŠ›)ï¼Œå¹¶ä¸” å°½é‡å¤šåˆ†å¸ƒåœ¨ä¸åŒ Broker ä¸Šï¼Œä»¥å‡è½»æŸä¸ª Broker çš„å‹åŠ› ã€‚\nTopic æ¶ˆæ¯é‡éƒ½æ¯”è¾ƒå‡åŒ€çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæŸä¸ª broker ä¸Šçš„é˜Ÿåˆ—è¶Šå¤šï¼Œåˆ™è¯¥ broker å‹åŠ›è¶Šå¤§ã€‚\næ„Ÿè§‰ä¸‹é¢è¿™ä¸ªå›¾æœ‰ä¸€ç‚¹ç‚¹è¯¯è§£ï¼Œå°±æ˜¯Queue é‡å¤ï¼ˆæ¯”å¦‚å¤šä¸ªQueueï¼‰ï¼Œæˆ‘è§‰å¾—åŒä¸€ä¸ªQueueä¸ä¼šåˆ†å¸ƒåœ¨å¤šä¸ªTopicä¸Šé¢çš„\næ‰€ä»¥è¯´æˆ‘ä»¬éœ€è¦é…ç½®å¤šä¸ªBrokerã€‚\nNameServerï¼š ä¸çŸ¥é“ä½ ä»¬æœ‰æ²¡æœ‰æ¥è§¦è¿‡ ZooKeeper å’Œ Spring Cloud ä¸­çš„ Eureka ï¼Œå®ƒå…¶å®ä¹Ÿæ˜¯ä¸€ä¸ª æ³¨å†Œä¸­å¿ƒ ï¼Œä¸»è¦æä¾›ä¸¤ä¸ªåŠŸèƒ½ï¼šBrokerç®¡ç† å’Œ è·¯ç”±ä¿¡æ¯ç®¡ç† ã€‚è¯´ç™½äº†å°±æ˜¯ Broker ä¼šå°†è‡ªå·±çš„ä¿¡æ¯æ³¨å†Œåˆ° NameServer ä¸­ï¼Œæ­¤æ—¶ NameServer å°±å­˜æ”¾äº†å¾ˆå¤š Broker çš„ä¿¡æ¯(Brokerçš„è·¯ç”±è¡¨)ï¼Œæ¶ˆè´¹è€…å’Œç”Ÿäº§è€…å°±ä» NameServer ä¸­è·å–è·¯ç”±è¡¨ç„¶åç…§ç€è·¯ç”±è¡¨çš„ä¿¡æ¯å’Œå¯¹åº”çš„ Broker è¿›è¡Œé€šä¿¡(ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å®šæœŸä¼šå‘ NameServer å»æŸ¥è¯¢ç›¸å…³çš„ Broker çš„ä¿¡æ¯)ã€‚\nProducerï¼š æ¶ˆæ¯å‘å¸ƒçš„è§’è‰²ï¼Œæ”¯æŒåˆ†å¸ƒå¼é›†ç¾¤æ–¹å¼éƒ¨ç½²ã€‚è¯´ç™½äº†å°±æ˜¯ç”Ÿäº§è€…ã€‚\nConsumerï¼š æ¶ˆæ¯æ¶ˆè´¹çš„è§’è‰²ï¼Œæ”¯æŒåˆ†å¸ƒå¼é›†ç¾¤æ–¹å¼éƒ¨ç½²ã€‚æ”¯æŒä»¥pushæ¨ï¼Œpullæ‹‰ä¸¤ç§æ¨¡å¼å¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ã€‚åŒæ—¶ä¹Ÿæ”¯æŒé›†ç¾¤æ–¹å¼å’Œå¹¿æ’­æ–¹å¼çš„æ¶ˆè´¹ï¼Œå®ƒæä¾›å®æ—¶æ¶ˆæ¯è®¢é˜…æœºåˆ¶ã€‚è¯´ç™½äº†å°±æ˜¯æ¶ˆè´¹è€…ã€‚\nå¬å®Œäº†ä¸Šé¢çš„è§£é‡Šä½ å¯èƒ½ä¼šè§‰å¾—ï¼Œè¿™ç©æ„å¥½ç®€å•ã€‚ä¸å°±æ˜¯è¿™æ ·çš„ä¹ˆï¼Ÿ\nå—¯ï¼Ÿä½ å¯èƒ½ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œè¿™è€å®¶ä¼™ NameServer å¹²å•¥ç”¨çš„ï¼Œè¿™ä¸å¤šä½™å—ï¼Ÿç›´æ¥ Producer ã€Consumer å’Œ Broker ç›´æ¥è¿›è¡Œç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹æ¶ˆæ¯ä¸å°±å¥½äº†ä¹ˆï¼Ÿ\nä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸Šæ–‡æåˆ°è¿‡ Broker æ˜¯éœ€è¦ä¿è¯é«˜å¯ç”¨çš„ï¼Œå¦‚æœæ•´ä¸ªç³»ç»Ÿä»…ä»…é ç€ä¸€ä¸ª Broker æ¥ç»´æŒçš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ª Broker çš„å‹åŠ›ä¼šä¸ä¼šå¾ˆå¤§ï¼Ÿæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨å¤šä¸ª Broker æ¥ä¿è¯ è´Ÿè½½å‡è¡¡ ã€‚\nå¦‚æœè¯´ï¼Œæˆ‘ä»¬çš„æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…ç›´æ¥å’Œå¤šä¸ª Broker ç›¸è¿ï¼Œé‚£ä¹ˆå½“ Broker ä¿®æ”¹çš„æ—¶å€™å¿…å®šä¼šç‰µè¿ç€æ¯ä¸ªç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œè¿™æ ·å°±ä¼šäº§ç”Ÿè€¦åˆé—®é¢˜ï¼Œè€Œ NameServer æ³¨å†Œä¸­å¿ƒå°±æ˜¯ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚\nå¦‚æœè¿˜ä¸æ˜¯å¾ˆç†è§£çš„è¯ï¼Œå¯ä»¥å»çœ‹æˆ‘ä»‹ç» Spring Cloud çš„é‚£ç¯‡æ–‡ç« ï¼Œå…¶ä¸­ä»‹ç»äº† Eureka æ³¨å†Œä¸­å¿ƒã€‚\nå½“ç„¶ï¼ŒRocketMQ ä¸­çš„æŠ€æœ¯æ¶æ„è‚¯å®šä¸æ­¢å‰é¢é‚£ä¹ˆç®€å•ï¼Œå› ä¸ºä¸Šé¢å›¾ä¸­çš„å››ä¸ªè§’è‰²éƒ½æ˜¯éœ€è¦åšé›†ç¾¤çš„ã€‚æˆ‘ç»™å‡ºä¸€å¼ å®˜ç½‘çš„æ¶æ„å›¾ï¼Œå¤§å®¶å°è¯•ç†è§£ä¸€ä¸‹ã€‚\nå…¶å®å’Œæˆ‘ä»¬æœ€å¼€å§‹ç”»çš„é‚£å¼ ä¹ä¸ç‰ˆçš„æ¶æ„å›¾ä¹Ÿæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œä¸»è¦æ˜¯ä¸€äº›ç»†èŠ‚ä¸Šçš„å·®åˆ«ã€‚å¬æˆ‘ç»†ç»†é“æ¥ğŸ¤¨ã€‚\nç¬¬ä¸€ã€æˆ‘ä»¬çš„ Broker åšäº†é›†ç¾¤å¹¶ä¸”è¿˜è¿›è¡Œäº†ä¸»ä»éƒ¨ç½² ï¼Œç”±äºæ¶ˆæ¯åˆ†å¸ƒåœ¨å„ä¸ª Broker ä¸Šï¼Œä¸€æ—¦æŸä¸ª Broker å®•æœºï¼Œåˆ™è¯¥Broker ä¸Šçš„æ¶ˆæ¯è¯»å†™éƒ½ä¼šå—åˆ°å½±å“ã€‚æ‰€ä»¥ Rocketmq æä¾›äº† master/slave çš„ç»“æ„ï¼Œ salve å®šæ—¶ä» master åŒæ­¥æ•°æ®(åŒæ­¥åˆ·ç›˜æˆ–è€…å¼‚æ­¥åˆ·ç›˜)ï¼Œå¦‚æœ master å®•æœºï¼Œåˆ™ slave æä¾›æ¶ˆè´¹æœåŠ¡ï¼Œä½†æ˜¯ä¸èƒ½å†™å…¥æ¶ˆæ¯ (åé¢æˆ‘è¿˜ä¼šæåˆ°å“¦)ã€‚\nç¬¬äºŒã€ä¸ºäº†ä¿è¯ HA ï¼Œæˆ‘ä»¬çš„ NameServer ä¹Ÿåšäº†é›†ç¾¤éƒ¨ç½²ï¼Œä½†æ˜¯è¯·æ³¨æ„å®ƒæ˜¯ å»ä¸­å¿ƒåŒ– çš„ã€‚ä¹Ÿå°±æ„å‘³ç€å®ƒæ²¡æœ‰ä¸»èŠ‚ç‚¹ï¼Œä½ å¯ä»¥å¾ˆæ˜æ˜¾åœ°çœ‹å‡º NameServer çš„æ‰€æœ‰èŠ‚ç‚¹æ˜¯æ²¡æœ‰è¿›è¡Œ Info Replicate çš„ï¼Œåœ¨ RocketMQ ä¸­æ˜¯é€šè¿‡ å•ä¸ªBrokerå’Œæ‰€æœ‰NameServerä¿æŒé•¿è¿æ¥ ï¼Œå¹¶ä¸”åœ¨æ¯éš”30ç§’ Broker ä¼šå‘æ‰€æœ‰ Nameserver å‘é€å¿ƒè·³ï¼Œå¿ƒè·³åŒ…å«äº†è‡ªèº«çš„ Topic é…ç½®ä¿¡æ¯ï¼Œè¿™ä¸ªæ­¥éª¤å°±å¯¹åº”è¿™ä¸Šé¢çš„ Routing Info ã€‚\nç¬¬ä¸‰ã€åœ¨ç”Ÿäº§è€…éœ€è¦å‘ Broker å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œéœ€è¦å…ˆä» NameServer è·å–å…³äº Broker çš„è·¯ç”±ä¿¡æ¯ï¼Œç„¶åé€šè¿‡ è½®è¯¢ çš„æ–¹æ³•å»å‘æ¯ä¸ªé˜Ÿåˆ—ä¸­ç”Ÿäº§æ•°æ®ä»¥è¾¾åˆ° è´Ÿè½½å‡è¡¡ çš„æ•ˆæœã€‚\nç¬¬å››ã€æ¶ˆè´¹è€…é€šè¿‡ NameServer è·å–æ‰€æœ‰ Broker çš„è·¯ç”±ä¿¡æ¯åï¼Œå‘ Broker å‘é€ Pull è¯·æ±‚æ¥è·å–æ¶ˆæ¯æ•°æ®ã€‚Consumer å¯ä»¥ä»¥ä¸¤ç§æ¨¡å¼å¯åŠ¨â€”â€” å¹¿æ’­ï¼ˆBroadcastï¼‰å’Œé›†ç¾¤ï¼ˆClusterï¼‰ã€‚å¹¿æ’­æ¨¡å¼ä¸‹ï¼Œä¸€æ¡æ¶ˆæ¯ä¼šå‘é€ç»™ åŒä¸€ä¸ªæ¶ˆè´¹ç»„ä¸­çš„æ‰€æœ‰æ¶ˆè´¹è€… ï¼Œé›†ç¾¤æ¨¡å¼ä¸‹æ¶ˆæ¯åªä¼šå‘é€ç»™ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚\n# å¦‚ä½•è§£å†³ é¡ºåºæ¶ˆè´¹ã€é‡å¤æ¶ˆè´¹ # å…¶å®ï¼Œè¿™äº›ä¸œè¥¿éƒ½æ˜¯æˆ‘åœ¨ä»‹ç»æ¶ˆæ¯é˜Ÿåˆ—å¸¦æ¥çš„ä¸€äº›å‰¯ä½œç”¨çš„æ—¶å€™æåˆ°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›é—®é¢˜ä¸ä»…ä»…æŒ‚é’©äº RocketMQ ï¼Œè€Œæ˜¯åº”è¯¥æ¯ä¸ªæ¶ˆæ¯ä¸­é—´ä»¶éƒ½éœ€è¦å»è§£å†³çš„ã€‚\nåœ¨ä¸Šé¢æˆ‘ä»‹ç» RocketMQ çš„æŠ€æœ¯æ¶æ„çš„æ—¶å€™æˆ‘å·²ç»å‘ä½ å±•ç¤ºäº† å®ƒæ˜¯å¦‚ä½•ä¿è¯é«˜å¯ç”¨çš„ ï¼Œè¿™é‡Œä¸æ¶‰åŠè¿ç»´æ–¹é¢çš„æ­å»ºï¼Œå¦‚æœä½ æ„Ÿå…´è¶£å¯ä»¥è‡ªå·±å»å®˜ç½‘ä¸Šç…§ç€ä¾‹å­æ­å»ºå±äºä½ è‡ªå·±çš„ RocketMQ é›†ç¾¤ã€‚\nå…¶å® Kafka çš„æ¶æ„åŸºæœ¬å’Œ RocketMQ ç±»ä¼¼ï¼Œåªæ˜¯å®ƒæ³¨å†Œä¸­å¿ƒä½¿ç”¨äº† Zookeeper ã€å®ƒçš„ åˆ†åŒº å°±ç›¸å½“äº RocketMQ ä¸­çš„ é˜Ÿåˆ— ã€‚è¿˜æœ‰ä¸€äº›å°ç»†èŠ‚ä¸åŒä¼šåœ¨åé¢æåˆ°ã€‚\n# é¡ºåºæ¶ˆè´¹ # åœ¨ä¸Šé¢çš„æŠ€æœ¯æ¶æ„ä»‹ç»ä¸­ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº† RocketMQ åœ¨ä¸»é¢˜ä¸Šæ˜¯æ— åºçš„ã€å®ƒåªæœ‰åœ¨é˜Ÿåˆ—å±‚é¢æ‰æ˜¯ä¿è¯æœ‰åº çš„ã€‚\nè¿™åˆæ‰¯åˆ°ä¸¤ä¸ªæ¦‚å¿µâ€”â€”æ™®é€šé¡ºåº å’Œ ä¸¥æ ¼é¡ºåº ã€‚\næ‰€è°“æ™®é€šé¡ºåºæ˜¯æŒ‡ æ¶ˆè´¹è€…é€šè¿‡ åŒä¸€ä¸ªæ¶ˆè´¹é˜Ÿåˆ—æ”¶åˆ°çš„æ¶ˆæ¯æ˜¯æœ‰é¡ºåºçš„ ï¼Œä¸åŒæ¶ˆæ¯é˜Ÿåˆ—æ”¶åˆ°çš„æ¶ˆæ¯åˆ™å¯èƒ½æ˜¯æ— é¡ºåºçš„ã€‚æ™®é€šé¡ºåºæ¶ˆæ¯åœ¨ Broker é‡å¯æƒ…å†µä¸‹ä¸ä¼šä¿è¯æ¶ˆæ¯é¡ºåºæ€§ (çŸ­æš‚æ—¶é—´) ã€‚\næ‰€è°“ä¸¥æ ¼é¡ºåºæ˜¯æŒ‡ æ¶ˆè´¹è€…æ”¶åˆ°çš„ æ‰€æœ‰æ¶ˆæ¯ å‡æ˜¯æœ‰é¡ºåºçš„ã€‚ä¸¥æ ¼é¡ºåºæ¶ˆæ¯ å³ä½¿åœ¨å¼‚å¸¸æƒ…å†µä¸‹ä¹Ÿä¼šä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ ã€‚\nä½†æ˜¯ï¼Œä¸¥æ ¼é¡ºåºçœ‹èµ·æ¥è™½å¥½ï¼Œå®ç°å®ƒå¯ä¼šä»˜å‡ºå·¨å¤§çš„ä»£ä»·ã€‚å¦‚æœä½ ä½¿ç”¨ä¸¥æ ¼é¡ºåºæ¨¡å¼ï¼ŒBroker é›†ç¾¤ä¸­åªè¦æœ‰ä¸€å°æœºå™¨ä¸å¯ç”¨ï¼Œåˆ™æ•´ä¸ªé›†ç¾¤éƒ½ä¸å¯ç”¨ã€‚ä½ è¿˜ç”¨å•¥ï¼Ÿç°åœ¨ä¸»è¦åœºæ™¯ä¹Ÿå°±åœ¨ binlog åŒæ­¥ã€‚\nä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬çš„ MQ éƒ½æ˜¯èƒ½å®¹å¿çŸ­æš‚çš„ä¹±åºï¼Œæ‰€ä»¥æ¨èä½¿ç”¨æ™®é€šé¡ºåºæ¨¡å¼ã€‚\né‚£ä¹ˆï¼Œæˆ‘ä»¬ç°åœ¨ä½¿ç”¨äº† æ™®é€šé¡ºåºæ¨¡å¼ ï¼Œæˆ‘ä»¬ä»ä¸Šé¢å­¦ä¹ çŸ¥é“äº†åœ¨ Producer ç”Ÿäº§æ¶ˆæ¯çš„æ—¶å€™ä¼šè¿›è¡Œè½®è¯¢(å–å†³ä½ çš„è´Ÿè½½å‡è¡¡ç­–ç•¥)æ¥å‘åŒä¸€ä¸»é¢˜çš„ä¸åŒæ¶ˆæ¯é˜Ÿåˆ—å‘é€æ¶ˆæ¯ã€‚é‚£ä¹ˆå¦‚æœæ­¤æ—¶æˆ‘æœ‰å‡ ä¸ªæ¶ˆæ¯åˆ†åˆ«æ˜¯åŒä¸€ä¸ªè®¢å•çš„åˆ›å»ºã€æ”¯ä»˜ã€å‘è´§ï¼Œåœ¨è½®è¯¢çš„ç­–ç•¥ä¸‹è¿™ ä¸‰ä¸ªæ¶ˆæ¯ä¼šè¢«å‘é€åˆ°ä¸åŒé˜Ÿåˆ— ï¼Œå› ä¸ºåœ¨ä¸åŒçš„é˜Ÿåˆ—æ­¤æ—¶å°±æ— æ³•ä½¿ç”¨ RocketMQ å¸¦æ¥çš„é˜Ÿåˆ—æœ‰åºç‰¹æ€§æ¥ä¿è¯æ¶ˆæ¯æœ‰åºæ€§äº†ã€‚\né‚£ä¹ˆï¼Œæ€ä¹ˆè§£å†³å‘¢ï¼Ÿ\nå…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬éœ€è¦å¤„ç†çš„ä»…ä»…æ˜¯å°†åŒä¸€è¯­ä¹‰ä¸‹çš„æ¶ˆæ¯æ”¾å…¥åŒä¸€ä¸ªé˜Ÿåˆ—(æ¯”å¦‚è¿™é‡Œæ˜¯åŒä¸€ä¸ªè®¢å•)ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ Hashå–æ¨¡æ³• æ¥ä¿è¯åŒä¸€ä¸ªè®¢å•åœ¨åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­å°±è¡Œäº†ã€‚\n# é‡å¤æ¶ˆè´¹ # emmmï¼Œå°±ä¸¤ä¸ªå­—â€”â€” å¹‚ç­‰ ã€‚åœ¨ç¼–ç¨‹ä¸­ä¸€ä¸ªå¹‚ç­‰ æ“ä½œçš„ç‰¹ç‚¹æ˜¯å…¶ä»»æ„å¤šæ¬¡æ‰§è¡Œæ‰€äº§ç”Ÿçš„å½±å“å‡ä¸ä¸€æ¬¡æ‰§è¡Œçš„å½±å“ç›¸åŒã€‚æ¯”å¦‚è¯´ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æœ‰ä¸€ä¸ªè®¢å•çš„å¤„ç†ç§¯åˆ†çš„ç³»ç»Ÿï¼Œæ¯å½“æ¥ä¸€ä¸ªæ¶ˆæ¯çš„æ—¶å€™å®ƒå°±è´Ÿè´£ä¸ºåˆ›å»ºè¿™ä¸ªè®¢å•çš„ç”¨æˆ·çš„ç§¯åˆ†åŠ ä¸Šç›¸åº”çš„æ•°å€¼ã€‚å¯æ˜¯æœ‰ä¸€æ¬¡ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å‘é€ç»™è®¢å•ç³»ç»Ÿ FrancisQ çš„è®¢å•ä¿¡æ¯ï¼Œå…¶è¦æ±‚æ˜¯ç»™ FrancisQ çš„ç§¯åˆ†åŠ ä¸Š 500ã€‚ä½†æ˜¯ç§¯åˆ†ç³»ç»Ÿåœ¨æ”¶åˆ° FrancisQ çš„è®¢å•ä¿¡æ¯å¤„ç†å®Œæˆä¹‹åè¿”å›ç»™æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†æˆåŠŸçš„ä¿¡æ¯çš„æ—¶å€™å‡ºç°äº†ç½‘ç»œæ³¢åŠ¨(å½“ç„¶è¿˜æœ‰å¾ˆå¤šç§æƒ…å†µï¼Œæ¯”å¦‚Brokeræ„å¤–é‡å¯ç­‰ç­‰)ï¼Œè¿™æ¡å›åº”æ²¡æœ‰å‘é€æˆåŠŸã€‚\né‚£ä¹ˆï¼Œæ¶ˆæ¯é˜Ÿåˆ—æ²¡æ”¶åˆ°ç§¯åˆ†ç³»ç»Ÿçš„å›åº”ä¼šä¸ä¼šå°è¯•é‡å‘è¿™ä¸ªæ¶ˆæ¯ï¼Ÿé—®é¢˜å°±æ¥äº†ï¼Œæˆ‘å†å‘è¿™ä¸ªæ¶ˆæ¯ï¼Œä¸‡ä¸€å®ƒåˆç»™ FrancisQ çš„è´¦æˆ·åŠ ä¸Š 500 ç§¯åˆ†æ€ä¹ˆåŠå‘¢ï¼Ÿ\næ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»™æˆ‘ä»¬çš„æ¶ˆè´¹è€…å®ç° å¹‚ç­‰ ï¼Œä¹Ÿå°±æ˜¯å¯¹åŒä¸€ä¸ªæ¶ˆæ¯çš„å¤„ç†ç»“æœï¼Œæ‰§è¡Œå¤šå°‘æ¬¡éƒ½ä¸å˜ã€‚\né‚£ä¹ˆå¦‚ä½•ç»™ä¸šåŠ¡å®ç°å¹‚ç­‰å‘¢ï¼Ÿè¿™ä¸ªè¿˜æ˜¯éœ€è¦ç»“åˆå…·ä½“çš„ä¸šåŠ¡çš„ã€‚ä½ å¯ä»¥ä½¿ç”¨ å†™å…¥ Redis æ¥ä¿è¯ï¼Œå› ä¸º Redis çš„ key å’Œ value å°±æ˜¯å¤©ç„¶æ”¯æŒå¹‚ç­‰çš„ï¼ˆå¦‚æœmqå¤„ç†è¿‡å°±ç»™redisè®¾ç½®å€¼ï¼Œè€Œåæ¯æ¬¡mqå¤„ç†ä¹‹å‰æŸ¥è¯¢ä¸€ä¸‹redisæ‰çŸ¥é“mqæ˜¯å¦å·²ç»å¤„ç†è¿‡ï¼‰ã€‚å½“ç„¶è¿˜æœ‰ä½¿ç”¨ æ•°æ®åº“æ’å…¥æ³• ï¼ŒåŸºäºæ•°æ®åº“çš„å”¯ä¸€é”®æ¥ä¿è¯é‡å¤æ•°æ®ä¸ä¼šè¢«æ’å…¥å¤šæ¡ã€‚\nä¸è¿‡æœ€ä¸»è¦çš„è¿˜æ˜¯éœ€è¦ æ ¹æ®ç‰¹å®šåœºæ™¯ä½¿ç”¨ç‰¹å®šçš„è§£å†³æ–¹æ¡ˆ ï¼Œä½ è¦çŸ¥é“ä½ çš„æ¶ˆæ¯æ¶ˆè´¹æ˜¯å¦æ˜¯å®Œå…¨ä¸å¯é‡å¤æ¶ˆè´¹è¿˜æ˜¯å¯ä»¥å¿å—é‡å¤æ¶ˆè´¹çš„ï¼Œç„¶åå†é€‰æ‹©å¼ºæ ¡éªŒå’Œå¼±æ ¡éªŒçš„æ–¹å¼ã€‚æ¯•ç«Ÿåœ¨ CS é¢†åŸŸè¿˜æ˜¯å¾ˆå°‘æœ‰æŠ€æœ¯é“¶å¼¹çš„è¯´æ³•ã€‚\nè€Œåœ¨æ•´ä¸ªäº’è”ç½‘é¢†åŸŸï¼Œå¹‚ç­‰ä¸ä»…ä»…é€‚ç”¨äºæ¶ˆæ¯é˜Ÿåˆ—çš„é‡å¤æ¶ˆè´¹é—®é¢˜ï¼Œè¿™äº›å®ç°å¹‚ç­‰çš„æ–¹æ³•ï¼Œä¹ŸåŒæ ·é€‚ç”¨äºï¼Œåœ¨å…¶ä»–åœºæ™¯ä¸­æ¥è§£å†³é‡å¤è¯·æ±‚æˆ–è€…é‡å¤è°ƒç”¨çš„é—®é¢˜ ã€‚æ¯”å¦‚å°†HTTPæœåŠ¡è®¾è®¡æˆå¹‚ç­‰çš„ï¼Œè§£å†³å‰ç«¯æˆ–è€…APPé‡å¤æäº¤è¡¨å•æ•°æ®çš„é—®é¢˜ ï¼Œä¹Ÿå¯ä»¥å°†ä¸€ä¸ªå¾®æœåŠ¡è®¾è®¡æˆå¹‚ç­‰çš„ï¼Œè§£å†³ RPC æ¡†æ¶è‡ªåŠ¨é‡è¯•å¯¼è‡´çš„ é‡å¤è°ƒç”¨é—®é¢˜ ã€‚\n# åˆ†å¸ƒå¼äº‹åŠ¡ # å¦‚ä½•è§£é‡Šåˆ†å¸ƒå¼äº‹åŠ¡å‘¢ï¼Ÿäº‹åŠ¡å¤§å®¶éƒ½çŸ¥é“å§ï¼Ÿè¦ä¹ˆéƒ½æ‰§è¡Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ ã€‚åœ¨åŒä¸€ä¸ªç³»ç»Ÿä¸­æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å®ç°äº‹åŠ¡ï¼Œä½†æ˜¯åœ¨åˆ†å¸ƒå¼æ¶æ„ä¸­ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šæœåŠ¡æ˜¯éƒ¨ç½²åœ¨ä¸åŒç³»ç»Ÿä¹‹é—´çš„ï¼Œè€Œä¸åŒæœåŠ¡ä¹‹é—´åˆéœ€è¦è¿›è¡Œè°ƒç”¨ã€‚æ¯”å¦‚æ­¤æ—¶æˆ‘ä¸‹è®¢å•ç„¶åå¢åŠ ç§¯åˆ†ï¼Œå¦‚æœä¿è¯ä¸äº†åˆ†å¸ƒå¼äº‹åŠ¡çš„è¯ï¼Œå°±ä¼šå‡ºç°Aç³»ç»Ÿä¸‹äº†è®¢å•ï¼Œä½†æ˜¯Bç³»ç»Ÿå¢åŠ ç§¯åˆ†å¤±è´¥æˆ–è€…Aç³»ç»Ÿæ²¡æœ‰ä¸‹è®¢å•ï¼ŒBç³»ç»Ÿå´å¢åŠ äº†ç§¯åˆ†ã€‚å‰è€…å¯¹ç”¨æˆ·ä¸å‹å¥½ï¼Œåè€…å¯¹è¿è¥å•†ä¸åˆ©ï¼Œè¿™æ˜¯æˆ‘ä»¬éƒ½ä¸æ„¿æ„è§åˆ°çš„ã€‚\né‚£ä¹ˆï¼Œå¦‚ä½•å»è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ\nå¦‚ä»Šæ¯”è¾ƒå¸¸è§çš„åˆ†å¸ƒå¼äº‹åŠ¡å®ç°æœ‰ 2PCã€TCC å’Œäº‹åŠ¡æ¶ˆæ¯(half åŠæ¶ˆæ¯æœºåˆ¶)ã€‚æ¯ä¸€ç§å®ç°éƒ½æœ‰å…¶ç‰¹å®šçš„ä½¿ç”¨åœºæ™¯ï¼Œä½†æ˜¯ä¹Ÿæœ‰å„è‡ªçš„é—®é¢˜ï¼Œéƒ½ä¸æ˜¯å®Œç¾çš„è§£å†³æ–¹æ¡ˆã€‚\nåœ¨ RocketMQ ä¸­ä½¿ç”¨çš„æ˜¯ äº‹åŠ¡æ¶ˆæ¯åŠ ä¸Šäº‹åŠ¡åæŸ¥æœºåˆ¶ æ¥è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜çš„ã€‚æˆ‘ç”»äº†å¼ å›¾ï¼Œå¤§å®¶å¯ä»¥å¯¹ç…§ç€å›¾è¿›è¡Œç†è§£ã€‚\nåœ¨ç¬¬ä¸€æ­¥å‘é€çš„ half æ¶ˆæ¯ ï¼Œå®ƒçš„æ„æ€æ˜¯ åœ¨äº‹åŠ¡æäº¤ä¹‹å‰ï¼Œå¯¹äºæ¶ˆè´¹è€…æ¥è¯´ï¼Œè¿™ä¸ªæ¶ˆæ¯æ˜¯ä¸å¯è§çš„ ã€‚\né‚£ä¹ˆï¼Œå¦‚ä½•åšåˆ°å†™å…¥æ¶ˆæ¯ä½†æ˜¯å¯¹ç”¨æˆ·ä¸å¯è§å‘¢ï¼ŸRocketMQäº‹åŠ¡æ¶ˆæ¯çš„åšæ³•æ˜¯ï¼šå¦‚æœæ¶ˆæ¯æ˜¯halfæ¶ˆæ¯ï¼Œå°†å¤‡ä»½åŸæ¶ˆæ¯çš„ä¸»é¢˜ä¸æ¶ˆæ¯æ¶ˆè´¹é˜Ÿåˆ—ï¼Œç„¶å æ”¹å˜ä¸»é¢˜ ä¸ºRMQ_SYS_TRANS_HALF_TOPICã€‚ç”±äºæ¶ˆè´¹ç»„æœªè®¢é˜…è¯¥ä¸»é¢˜ï¼Œæ•…æ¶ˆè´¹ç«¯æ— æ³•æ¶ˆè´¹halfç±»å‹çš„æ¶ˆæ¯ï¼Œç„¶åRocketMQä¼šå¼€å¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œä»Topicä¸ºRMQ_SYS_TRANS_HALF_TOPICä¸­æ‹‰å–æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼Œæ ¹æ®ç”Ÿäº§è€…ç»„è·å–ä¸€ä¸ªæœåŠ¡æä¾›è€…å‘é€å›æŸ¥äº‹åŠ¡çŠ¶æ€è¯·æ±‚ï¼Œæ ¹æ®äº‹åŠ¡çŠ¶æ€æ¥å†³å®šæ˜¯æäº¤æˆ–å›æ»šæ¶ˆæ¯ã€‚\nä½ å¯ä»¥è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰ä»ç¬¬5æ­¥å¼€å§‹çš„ äº‹åŠ¡åæŸ¥æœºåˆ¶ ï¼Œå¦‚æœå‡ºç°ç½‘è·¯æ³¢åŠ¨ç¬¬4æ­¥æ²¡æœ‰å‘é€æˆåŠŸï¼Œè¿™æ ·å°±ä¼šäº§ç”Ÿ MQ ä¸çŸ¥é“æ˜¯ä¸æ˜¯éœ€è¦ç»™æ¶ˆè´¹è€…æ¶ˆè´¹çš„é—®é¢˜ï¼Œä»–å°±åƒä¸€ä¸ªæ— å¤´è‹è‡ä¸€æ ·ã€‚åœ¨ RocketMQ ä¸­å°±æ˜¯ä½¿ç”¨çš„ä¸Šè¿°çš„äº‹åŠ¡åæŸ¥æ¥è§£å†³çš„ï¼Œè€Œåœ¨ Kafka ä¸­é€šå¸¸æ˜¯ç›´æ¥æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸è®©ç”¨æˆ·æ¥è‡ªè¡Œè§£å†³ã€‚\nä½ è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ MQ Server æŒ‡å‘ç³»ç»ŸBçš„æ“ä½œå·²ç»å’Œç³»ç»ŸAä¸ç›¸å…³äº†ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯â€”â€”æœ¬åœ°äº‹åŠ¡å’Œå­˜å‚¨æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—æ‰æ˜¯åŒä¸€ä¸ªäº‹åŠ¡ã€‚è¿™æ ·ä¹Ÿå°±äº§ç”Ÿäº†äº‹åŠ¡çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œå› ä¸ºæ•´ä¸ªè¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œæ¯ä¸ªç³»ç»Ÿåªè¦ä¿è¯å®ƒè‡ªå·±é‚£ä¸€éƒ¨åˆ†çš„äº‹åŠ¡å°±è¡Œäº†ã€‚ # æ¶ˆæ¯å †ç§¯é—®é¢˜ # åœ¨ä¸Šé¢æˆ‘ä»¬æåˆ°äº†æ¶ˆæ¯é˜Ÿåˆ—ä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½â€”â€”å‰Šå³° ã€‚é‚£ä¹ˆå¦‚æœè¿™ä¸ªå³°å€¼å¤ªå¤§äº†å¯¼è‡´æ¶ˆæ¯å †ç§¯åœ¨é˜Ÿåˆ—ä¸­æ€ä¹ˆåŠå‘¢ï¼Ÿ\nå…¶å®è¿™ä¸ªé—®é¢˜å¯ä»¥å°†å®ƒå¹¿ä¹‰åŒ–ï¼Œå› ä¸ºäº§ç”Ÿæ¶ˆæ¯å †ç§¯çš„æ ¹æºå…¶å®å°±åªæœ‰ä¸¤ä¸ªâ€”â€”ç”Ÿäº§è€…ç”Ÿäº§å¤ªå¿«æˆ–è€…æ¶ˆè´¹è€…æ¶ˆè´¹å¤ªæ…¢ã€‚\næˆ‘ä»¬å¯ä»¥ä»å¤šä¸ªè§’åº¦å»æ€è€ƒè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå½“æµé‡åˆ°å³°å€¼çš„æ—¶å€™æ˜¯å› ä¸ºç”Ÿäº§è€…ç”Ÿäº§å¤ªå¿«ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº› é™æµé™çº§ çš„æ–¹æ³•ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å¢åŠ å¤šä¸ªæ¶ˆè´¹è€…å®ä¾‹å»æ°´å¹³æ‰©å±•å¢åŠ æ¶ˆè´¹èƒ½åŠ›æ¥åŒ¹é…ç”Ÿäº§çš„æ¿€å¢ã€‚å¦‚æœæ¶ˆè´¹è€…æ¶ˆè´¹è¿‡æ…¢çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ£€æŸ¥ æ˜¯å¦æ˜¯æ¶ˆè´¹è€…å‡ºç°äº†å¤§é‡çš„æ¶ˆè´¹é”™è¯¯ ï¼Œæˆ–è€…æ‰“å°ä¸€ä¸‹æ—¥å¿—æŸ¥çœ‹æ˜¯å¦æ˜¯å“ªä¸€ä¸ªçº¿ç¨‹å¡æ­»ï¼Œå‡ºç°äº†é”èµ„æºä¸é‡Šæ”¾ç­‰ç­‰çš„é—®é¢˜ã€‚\nå½“ç„¶ï¼Œæœ€å¿«é€Ÿè§£å†³æ¶ˆæ¯å †ç§¯é—®é¢˜çš„æ–¹æ³•è¿˜æ˜¯å¢åŠ æ¶ˆè´¹è€…å®ä¾‹ï¼Œä¸è¿‡ åŒæ—¶ä½ è¿˜éœ€è¦å¢åŠ æ¯ä¸ªä¸»é¢˜çš„é˜Ÿåˆ—æ•°é‡ ã€‚\nåˆ«å¿˜äº†åœ¨ RocketMQ ä¸­ï¼Œä¸€ä¸ªé˜Ÿåˆ—åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ ï¼Œå¦‚æœä½ ä»…ä»…æ˜¯å¢åŠ æ¶ˆè´¹è€…å®ä¾‹å°±ä¼šå‡ºç°æˆ‘ä¸€å¼€å§‹ç»™ä½ ç”»æ¶æ„å›¾çš„é‚£ç§æƒ…å†µã€‚\n# å›æº¯æ¶ˆè´¹ # å›æº¯æ¶ˆè´¹æ˜¯æŒ‡ Consumer å·²ç»æ¶ˆè´¹æˆåŠŸçš„æ¶ˆæ¯ï¼Œç”±äºä¸šåŠ¡ä¸Šéœ€æ±‚éœ€è¦é‡æ–°æ¶ˆè´¹ï¼Œåœ¨RocketMQ ä¸­ï¼Œ Broker åœ¨å‘Consumer æŠ•é€’æˆåŠŸæ¶ˆæ¯åï¼Œæ¶ˆæ¯ä»ç„¶éœ€è¦ä¿ç•™ ã€‚å¹¶ä¸”é‡æ–°æ¶ˆè´¹ä¸€èˆ¬æ˜¯æŒ‰ç…§æ—¶é—´ç»´åº¦ï¼Œä¾‹å¦‚ç”±äº Consumer ç³»ç»Ÿæ•…éšœï¼Œæ¢å¤åéœ€è¦é‡æ–°æ¶ˆè´¹1å°æ—¶å‰çš„æ•°æ®ï¼Œé‚£ä¹ˆ Broker è¦æä¾›ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥æŒ‰ç…§æ—¶é—´ç»´åº¦æ¥å›é€€æ¶ˆè´¹è¿›åº¦ã€‚RocketMQ æ”¯æŒæŒ‰ç…§æ—¶é—´å›æº¯æ¶ˆè´¹ï¼Œæ—¶é—´ç»´åº¦ç²¾ç¡®åˆ°æ¯«ç§’ã€‚\nè¿™æ˜¯å®˜æ–¹æ–‡æ¡£çš„è§£é‡Šï¼Œæˆ‘ç›´æ¥ç…§æ¬è¿‡æ¥å°±å½“ç§‘æ™®äº†ğŸ˜ğŸ˜ğŸ˜ã€‚\n# RocketMQ çš„åˆ·ç›˜æœºåˆ¶ # ä¸Šé¢æˆ‘è®²äº†é‚£ä¹ˆå¤šçš„ RocketMQ çš„æ¶æ„å’Œè®¾è®¡åŸç†ï¼Œä½ æœ‰æ²¡æœ‰å¥½å¥‡\nåœ¨ Topic ä¸­çš„ é˜Ÿåˆ—æ˜¯ä»¥ä»€ä¹ˆæ ·çš„å½¢å¼å­˜åœ¨çš„ï¼Ÿ\né˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯åˆæ˜¯å¦‚ä½•è¿›è¡Œå­˜å‚¨æŒä¹…åŒ–çš„å‘¢ï¼Ÿ\næˆ‘åœ¨ä¸Šæ–‡ä¸­æåˆ°çš„ åŒæ­¥åˆ·ç›˜ å’Œ å¼‚æ­¥åˆ·ç›˜ åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒä»¬ä¼šç»™æŒä¹…åŒ–å¸¦æ¥ä»€ä¹ˆæ ·çš„å½±å“å‘¢ï¼Ÿ\nä¸‹é¢æˆ‘å°†ç»™ä½ ä»¬ä¸€ä¸€è§£é‡Šã€‚\n# åŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜ # å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨åŒæ­¥åˆ·ç›˜ä¸­éœ€è¦ç­‰å¾…ä¸€ä¸ªåˆ·ç›˜æˆåŠŸçš„ ACK ï¼ŒåŒæ­¥åˆ·ç›˜å¯¹ MQ æ¶ˆæ¯å¯é æ€§æ¥è¯´æ˜¯ä¸€ç§ä¸é”™çš„ä¿éšœï¼Œä½†æ˜¯ æ€§èƒ½ä¸Šä¼šæœ‰è¾ƒå¤§å½±å“ ï¼Œä¸€èˆ¬åœ°é€‚ç”¨äºé‡‘èç­‰ç‰¹å®šä¸šåŠ¡åœºæ™¯ã€‚\nè€Œå¼‚æ­¥åˆ·ç›˜å¾€å¾€æ˜¯å¼€å¯ä¸€ä¸ªçº¿ç¨‹å»å¼‚æ­¥åœ°æ‰§è¡Œåˆ·ç›˜æ“ä½œã€‚æ¶ˆæ¯åˆ·ç›˜é‡‡ç”¨åå°å¼‚æ­¥çº¿ç¨‹æäº¤çš„æ–¹å¼è¿›è¡Œï¼Œ é™ä½äº†è¯»å†™å»¶è¿Ÿ ï¼Œæé«˜äº† MQ çš„æ€§èƒ½å’Œååé‡ï¼Œä¸€èˆ¬é€‚ç”¨äºå¦‚å‘éªŒè¯ç ç­‰å¯¹äºæ¶ˆæ¯ä¿è¯è¦æ±‚ä¸å¤ªé«˜çš„ä¸šåŠ¡åœºæ™¯ã€‚\nä¸€èˆ¬åœ°ï¼Œå¼‚æ­¥åˆ·ç›˜åªæœ‰åœ¨ Broker æ„å¤–å®•æœºçš„æ—¶å€™ä¼šä¸¢å¤±éƒ¨åˆ†æ•°æ®ï¼Œä½ å¯ä»¥è®¾ç½® Broker çš„å‚æ•° FlushDiskType æ¥è°ƒæ•´ä½ çš„åˆ·ç›˜ç­–ç•¥(ASYNC_FLUSH æˆ–è€… SYNC_FLUSH)ã€‚\n# åŒæ­¥å¤åˆ¶å’Œå¼‚æ­¥å¤åˆ¶ # ä¸Šé¢çš„åŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜æ˜¯åœ¨å•ä¸ªç»“ç‚¹å±‚é¢çš„ï¼Œè€ŒåŒæ­¥å¤åˆ¶å’Œå¼‚æ­¥å¤åˆ¶ä¸»è¦æ˜¯æŒ‡çš„ Borker ä¸»ä»æ¨¡å¼ä¸‹ï¼Œä¸»èŠ‚ç‚¹è¿”å›æ¶ˆæ¯ç»™å®¢æˆ·ç«¯çš„æ—¶å€™æ˜¯å¦éœ€è¦åŒæ­¥ä»èŠ‚ç‚¹ã€‚\nåŒæ­¥å¤åˆ¶ï¼š ä¹Ÿå« â€œåŒæ­¥åŒå†™â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰æ¶ˆæ¯åŒæ­¥åŒå†™åˆ°ä¸»ä»èŠ‚ç‚¹ä¸Šæ—¶æ‰è¿”å›å†™å…¥æˆåŠŸ ã€‚ å¼‚æ­¥å¤åˆ¶ï¼š æ¶ˆæ¯å†™å…¥ä¸»èŠ‚ç‚¹ä¹‹åå°±ç›´æ¥è¿”å›å†™å…¥æˆåŠŸ ã€‚ ç„¶è€Œï¼Œå¾ˆå¤šäº‹æƒ…æ˜¯æ²¡æœ‰å®Œç¾çš„æ–¹æ¡ˆçš„ï¼Œå°±æ¯”å¦‚æˆ‘ä»¬è¿›è¡Œæ¶ˆæ¯å†™å…¥çš„èŠ‚ç‚¹è¶Šå¤šå°±æ›´èƒ½ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Œä½†æ˜¯éšä¹‹çš„æ€§èƒ½ä¹Ÿä¼šä¸‹é™ï¼Œæ‰€ä»¥éœ€è¦ç¨‹åºå‘˜æ ¹æ®ç‰¹å®šä¸šåŠ¡åœºæ™¯å»é€‰æ‹©é€‚åº”çš„ä¸»ä»å¤åˆ¶æ–¹æ¡ˆã€‚\né‚£ä¹ˆï¼Œå¼‚æ­¥å¤åˆ¶ä¼šä¸ä¼šä¹Ÿåƒå¼‚æ­¥åˆ·ç›˜é‚£æ ·å½±å“æ¶ˆæ¯çš„å¯é æ€§å‘¢ï¼Ÿ\nç­”æ¡ˆæ˜¯ä¸ä¼šçš„ï¼Œå› ä¸ºä¸¤è€…å°±æ˜¯ä¸åŒçš„æ¦‚å¿µï¼Œå¯¹äºæ¶ˆæ¯å¯é æ€§æ˜¯é€šè¿‡ä¸åŒçš„åˆ·ç›˜ç­–ç•¥ä¿è¯çš„ï¼Œè€Œåƒå¼‚æ­¥åŒæ­¥å¤åˆ¶ç­–ç•¥ä»…ä»…æ˜¯å½±å“åˆ°äº† å¯ç”¨æ€§ ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå…¶ä¸»è¦åŸå› æ˜¯ RocketMQ æ˜¯ä¸æ”¯æŒè‡ªåŠ¨ä¸»ä»åˆ‡æ¢çš„ï¼Œå½“ä¸»èŠ‚ç‚¹æŒ‚æ‰ä¹‹åï¼Œç”Ÿäº§è€…å°±ä¸èƒ½å†ç»™è¿™ä¸ªä¸»èŠ‚ç‚¹ç”Ÿäº§æ¶ˆæ¯äº†ã€‚\næ¯”å¦‚è¿™ä¸ªæ—¶å€™é‡‡ç”¨å¼‚æ­¥å¤åˆ¶çš„æ–¹å¼ï¼Œåœ¨ä¸»èŠ‚ç‚¹è¿˜æœªå‘é€å®Œéœ€è¦åŒæ­¥çš„æ¶ˆæ¯çš„æ—¶å€™ä¸»èŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œè¿™ä¸ªæ—¶å€™ä»èŠ‚ç‚¹å°±å°‘äº†ä¸€éƒ¨åˆ†æ¶ˆæ¯ã€‚ä½†æ˜¯æ­¤æ—¶ç”Ÿäº§è€…æ— æ³•å†ç»™ä¸»èŠ‚ç‚¹ç”Ÿäº§æ¶ˆæ¯äº†ï¼Œæ¶ˆè´¹è€…å¯ä»¥è‡ªåŠ¨åˆ‡æ¢åˆ°ä»èŠ‚ç‚¹è¿›è¡Œæ¶ˆè´¹(ä»…ä»…æ˜¯æ¶ˆè´¹)ï¼Œæ‰€ä»¥åœ¨ä¸»èŠ‚ç‚¹æŒ‚æ‰çš„æ—¶é—´åªä¼šäº§ç”Ÿä¸»ä»ç»“ç‚¹çŸ­æš‚çš„æ¶ˆæ¯ä¸ä¸€è‡´çš„æƒ…å†µï¼Œé™ä½äº†å¯ç”¨æ€§ï¼Œè€Œå½“ä¸»èŠ‚ç‚¹é‡å¯ä¹‹åï¼Œä»èŠ‚ç‚¹é‚£éƒ¨åˆ†æœªæ¥å¾—åŠå¤åˆ¶çš„æ¶ˆæ¯è¿˜ä¼šç»§ç»­å¤åˆ¶ã€‚\nåœ¨å•ä¸»ä»æ¶æ„ä¸­ï¼Œå¦‚æœä¸€ä¸ªä¸»èŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œé‚£ä¹ˆä¹Ÿå°±æ„å‘³ç€æ•´ä¸ªç³»ç»Ÿä¸èƒ½å†ç”Ÿäº§äº†ã€‚é‚£ä¹ˆè¿™ä¸ªå¯ç”¨æ€§çš„é—®é¢˜èƒ½å¦è§£å†³å‘¢ï¼Ÿä¸€ä¸ªä¸»ä»ä¸è¡Œé‚£å°±å¤šä¸ªä¸»ä»çš„å‘—ï¼Œåˆ«å¿˜äº†åœ¨æˆ‘ä»¬æœ€åˆçš„æ¶æ„å›¾ä¸­ï¼Œæ¯ä¸ª Topic æ˜¯åˆ†å¸ƒåœ¨ä¸åŒ Broker ä¸­çš„ã€‚\nä½†æ˜¯è¿™ç§å¤åˆ¶æ–¹å¼åŒæ ·ä¹Ÿä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯æ— æ³•ä¿è¯ ä¸¥æ ¼é¡ºåº ã€‚åœ¨ä¸Šæ–‡ä¸­æˆ‘ä»¬æåˆ°äº†å¦‚ä½•ä¿è¯çš„æ¶ˆæ¯é¡ºåºæ€§æ˜¯é€šè¿‡å°†ä¸€ä¸ªè¯­ä¹‰çš„æ¶ˆæ¯å‘é€åœ¨åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œä½¿ç”¨ Topic ä¸‹çš„é˜Ÿåˆ—æ¥ä¿è¯é¡ºåºæ€§çš„ã€‚å¦‚æœæ­¤æ—¶æˆ‘ä»¬ä¸»èŠ‚ç‚¹Aè´Ÿè´£çš„æ˜¯è®¢å•Açš„ä¸€ç³»åˆ—è¯­ä¹‰æ¶ˆæ¯ï¼Œç„¶åå®ƒæŒ‚äº†ï¼Œè¿™æ ·å…¶ä»–èŠ‚ç‚¹æ˜¯æ— æ³•ä»£æ›¿ä¸»èŠ‚ç‚¹Açš„ï¼Œå¦‚æœæˆ‘ä»¬ä»»æ„èŠ‚ç‚¹éƒ½å¯ä»¥å­˜å…¥ä»»ä½•æ¶ˆæ¯ï¼Œé‚£å°±æ²¡æœ‰é¡ºåºæ€§å¯è¨€äº†ã€‚\nè€Œåœ¨ RocketMQ ä¸­é‡‡ç”¨äº† Dledger è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä»–è¦æ±‚åœ¨å†™å…¥æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¦æ±‚è‡³å°‘æ¶ˆæ¯å¤åˆ¶åˆ°åŠæ•°ä»¥ä¸Šçš„èŠ‚ç‚¹ä¹‹åï¼Œæ‰ç»™å®¢â¼¾ç«¯è¿”å›å†™â¼ŠæˆåŠŸï¼Œå¹¶ä¸”å®ƒæ˜¯â½€æŒé€šè¿‡é€‰ä¸¾æ¥åŠ¨æ€åˆ‡æ¢ä¸»èŠ‚ç‚¹çš„ã€‚è¿™é‡Œæˆ‘å°±ä¸å±•å¼€è¯´æ˜äº†ï¼Œè¯»è€…å¯ä»¥è‡ªå·±å»äº†è§£ã€‚\nä¹Ÿä¸æ˜¯è¯´ Dledger æ˜¯ä¸ªå®Œç¾çš„æ–¹æ¡ˆï¼Œè‡³å°‘åœ¨ Dledger é€‰ä¸¾è¿‡ç¨‹ä¸­æ˜¯æ— æ³•æä¾›æœåŠ¡çš„ï¼Œè€Œä¸”ä»–å¿…é¡»è¦ä½¿ç”¨ä¸‰ä¸ªèŠ‚ç‚¹æˆ–ä»¥ä¸Šï¼Œå¦‚æœå¤šæ•°èŠ‚ç‚¹åŒæ—¶æŒ‚æ‰ä»–ä¹Ÿæ˜¯æ— æ³•ä¿è¯å¯ç”¨æ€§çš„ï¼Œè€Œä¸”è¦æ±‚æ¶ˆæ¯å¤åˆ¶åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹çš„æ•ˆç‡å’Œç›´æ¥å¼‚æ­¥å¤åˆ¶è¿˜æ˜¯æœ‰ä¸€å®šçš„å·®è·çš„ã€‚\n# å­˜å‚¨æœºåˆ¶ # lyï¼šè¯¦ç»†çš„æœ‰ç‚¹å¤æ‚ï¼Œæš‚æ—¶è·³è¿‡ã€‚å¤§æ¦‚å°±æ˜¯æœ‰ä¸‰ä¸ªä¸œè¥¿ï¼ŒCommitLogï¼ˆå®é™…å­˜å‚¨æ¶ˆæ¯çš„ä¸œè¥¿ï¼‰ï¼ŒConsumeQueueï¼ˆç›¸å½“äºCommitLogçš„ç´¢å¼•ï¼‰\nè¿˜è®°å¾—ä¸Šé¢æˆ‘ä»¬ä¸€å¼€å§‹çš„ä¸‰ä¸ªé—®é¢˜å—ï¼Ÿåˆ°è¿™é‡Œç¬¬ä¸‰ä¸ªé—®é¢˜å·²ç»è§£å†³äº†ã€‚\nä½†æ˜¯ï¼Œåœ¨ Topic ä¸­çš„ é˜Ÿåˆ—æ˜¯ä»¥ä»€ä¹ˆæ ·çš„å½¢å¼å­˜åœ¨çš„ï¼Ÿé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯åˆæ˜¯å¦‚ä½•è¿›è¡Œå­˜å‚¨æŒä¹…åŒ–çš„å‘¢ï¼Ÿ è¿˜æœªè§£å†³ï¼Œå…¶å®è¿™é‡Œæ¶‰åŠåˆ°äº† RocketMQ æ˜¯å¦‚ä½•è®¾è®¡å®ƒçš„å­˜å‚¨ç»“æ„äº†ã€‚æˆ‘é¦–å…ˆæƒ³å¤§å®¶ä»‹ç» RocketMQ æ¶ˆæ¯å­˜å‚¨æ¶æ„ä¸­çš„ä¸‰å¤§è§’è‰²â€”â€”CommitLog ã€ConsumeQueue å’Œ IndexFile ã€‚\nCommitLogï¼š æ¶ˆæ¯ä¸»ä½“ä»¥åŠå…ƒæ•°æ®çš„å­˜å‚¨ä¸»ä½“ï¼Œå­˜å‚¨ Producer ç«¯å†™å…¥çš„æ¶ˆæ¯ä¸»ä½“å†…å®¹,æ¶ˆæ¯å†…å®¹ä¸æ˜¯å®šé•¿çš„ã€‚å•ä¸ªæ–‡ä»¶å¤§å°é»˜è®¤1G ï¼Œæ–‡ä»¶åé•¿åº¦ä¸º20ä½ï¼Œå·¦è¾¹è¡¥é›¶ï¼Œå‰©ä½™ä¸ºèµ·å§‹åç§»é‡ï¼Œæ¯”å¦‚00000000000000000000ä»£è¡¨äº†ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼Œèµ·å§‹åç§»é‡ä¸º0ï¼Œæ–‡ä»¶å¤§å°ä¸º1G=1073741824ï¼›å½“ç¬¬ä¸€ä¸ªæ–‡ä»¶å†™æ»¡äº†ï¼Œç¬¬äºŒä¸ªæ–‡ä»¶ä¸º00000000001073741824ï¼Œèµ·å§‹åç§»é‡ä¸º1073741824ï¼Œä»¥æ­¤ç±»æ¨ã€‚æ¶ˆæ¯ä¸»è¦æ˜¯é¡ºåºå†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œå½“æ–‡ä»¶æ»¡äº†ï¼Œå†™å…¥ä¸‹ä¸€ä¸ªæ–‡ä»¶ã€‚\nConsumeQueueï¼š æ¶ˆæ¯æ¶ˆè´¹é˜Ÿåˆ—ï¼Œå¼•å…¥çš„ç›®çš„ä¸»è¦æ˜¯æé«˜æ¶ˆæ¯æ¶ˆè´¹çš„æ€§èƒ½(æˆ‘ä»¬å†å‰é¢ä¹Ÿè®²äº†)ï¼Œç”±äºRocketMQ æ˜¯åŸºäºä¸»é¢˜ Topic çš„è®¢é˜…æ¨¡å¼ï¼Œæ¶ˆæ¯æ¶ˆè´¹æ˜¯é’ˆå¯¹ä¸»é¢˜è¿›è¡Œçš„ï¼Œå¦‚æœè¦éå† commitlog æ–‡ä»¶ä¸­æ ¹æ® Topic æ£€ç´¢æ¶ˆæ¯æ˜¯éå¸¸ä½æ•ˆçš„ã€‚Consumer å³å¯æ ¹æ® ConsumeQueue æ¥æŸ¥æ‰¾å¾…æ¶ˆè´¹çš„æ¶ˆæ¯ã€‚å…¶ä¸­ï¼ŒConsumeQueueï¼ˆé€»è¾‘æ¶ˆè´¹é˜Ÿåˆ—ï¼‰ä½œä¸ºæ¶ˆè´¹æ¶ˆæ¯çš„ç´¢å¼•ï¼Œä¿å­˜äº†æŒ‡å®š Topic ä¸‹çš„é˜Ÿåˆ—æ¶ˆæ¯åœ¨ CommitLog ä¸­çš„èµ·å§‹ç‰©ç†åç§»é‡ offset *ï¼Œæ¶ˆæ¯å¤§å° size å’Œæ¶ˆæ¯ Tag çš„ HashCode å€¼ã€‚*consumequeue æ–‡ä»¶å¯ä»¥çœ‹æˆæ˜¯åŸºäº topic çš„ commitlog ç´¢å¼•æ–‡ä»¶ï¼Œæ•… consumequeue æ–‡ä»¶å¤¹çš„ç»„ç»‡æ–¹å¼å¦‚ä¸‹ï¼štopic/queue/fileä¸‰å±‚ç»„ç»‡ç»“æ„ï¼Œå…·ä½“å­˜å‚¨è·¯å¾„ä¸ºï¼š$HOME/store/consumequeue/{topic}/{queueId}/{fileName}ã€‚åŒæ · consumequeue æ–‡ä»¶é‡‡å–å®šé•¿è®¾è®¡ï¼Œæ¯ä¸€ä¸ªæ¡ç›®å…±20ä¸ªå­—èŠ‚ï¼Œåˆ†åˆ«ä¸º8å­—èŠ‚çš„ commitlog ç‰©ç†åç§»é‡ã€4å­—èŠ‚çš„æ¶ˆæ¯é•¿åº¦ã€8å­—èŠ‚tag hashcodeï¼Œå•ä¸ªæ–‡ä»¶ç”±30Wä¸ªæ¡ç›®ç»„æˆï¼Œå¯ä»¥åƒæ•°ç»„ä¸€æ ·éšæœºè®¿é—®æ¯ä¸€ä¸ªæ¡ç›®ï¼Œæ¯ä¸ª ConsumeQueueæ–‡ä»¶å¤§å°çº¦5.72Mï¼›\nä¿å­˜äº†æŒ‡å®š Topic ä¸‹çš„é˜Ÿåˆ—æ¶ˆæ¯åœ¨ CommitLog ä¸­çš„**èµ·å§‹ç‰©ç†åç§»é‡ offset **ï¼Œæ¶ˆæ¯å¤§å° size å’Œæ¶ˆæ¯ Tag çš„ HashCode å€¼\nIndexFileï¼š IndexFileï¼ˆç´¢å¼•æ–‡ä»¶ï¼‰æä¾›äº†ä¸€ç§å¯ä»¥é€šè¿‡keyæˆ–æ—¶é—´åŒºé—´æ¥æŸ¥è¯¢æ¶ˆæ¯çš„æ–¹æ³•ã€‚è¿™é‡Œåªåšç§‘æ™®ä¸åšè¯¦ç»†ä»‹ç»ã€‚\næ€»ç»“æ¥è¯´ï¼Œæ•´ä¸ªæ¶ˆæ¯å­˜å‚¨çš„ç»“æ„ï¼Œæœ€ä¸»è¦çš„å°±æ˜¯ CommitLoq å’Œ ConsumeQueue ã€‚è€Œ ConsumeQueue ä½ å¯ä»¥å¤§æ¦‚ç†è§£ä¸º Topic ä¸­çš„é˜Ÿåˆ—ã€‚\næˆ‘çš„ç†è§£æ˜¯ï¼Œé€šè¿‡ConsumeQueue fileså»æŸ¥è¯¢CommitLog\nRocketMQ é‡‡ç”¨çš„æ˜¯ æ··åˆå‹çš„å­˜å‚¨ç»“æ„ ï¼Œå³ä¸º Broker å•ä¸ªå®ä¾‹ä¸‹æ‰€æœ‰çš„é˜Ÿåˆ—å…±ç”¨ä¸€ä¸ªæ—¥å¿—æ•°æ®æ–‡ä»¶æ¥å­˜å‚¨æ¶ˆæ¯ã€‚æœ‰æ„æ€çš„æ˜¯åœ¨åŒæ ·é«˜å¹¶å‘çš„ Kafka ä¸­ä¼šä¸ºæ¯ä¸ª Topic åˆ†é…ä¸€ä¸ªå­˜å‚¨æ–‡ä»¶ã€‚è¿™å°±æœ‰ç‚¹ç±»ä¼¼äºæˆ‘ä»¬æœ‰ä¸€å¤§å †ä¹¦éœ€è¦è£…ä¸Šä¹¦æ¶ï¼ŒRockeMQ æ˜¯ä¸åˆ†ä¹¦çš„ç§ç±»ç›´æ¥æˆæ‰¹çš„å¡ä¸Šå»çš„ï¼Œè€Œ Kafka æ˜¯å°†ä¹¦æœ¬æ”¾å…¥æŒ‡å®šçš„åˆ†ç±»åŒºåŸŸçš„ã€‚\nè€Œ RocketMQ ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼ŸåŸå› æ˜¯ æé«˜æ•°æ®çš„å†™å…¥æ•ˆç‡ ï¼Œä¸åˆ† Topic æ„å‘³ç€æˆ‘ä»¬æœ‰æ›´å¤§çš„å‡ ç‡è·å– æˆæ‰¹ çš„æ¶ˆæ¯è¿›è¡Œæ•°æ®å†™å…¥ï¼Œä½†ä¹Ÿä¼šå¸¦æ¥ä¸€ä¸ªéº»çƒ¦å°±æ˜¯è¯»å–æ¶ˆæ¯çš„æ—¶å€™éœ€è¦éå†æ•´ä¸ªå¤§æ–‡ä»¶ï¼Œè¿™æ˜¯éå¸¸è€—æ—¶çš„ã€‚\næ‰€ä»¥ï¼Œåœ¨ RocketMQ ä¸­åˆä½¿ç”¨äº† ConsumeQueue ä½œä¸ºæ¯ä¸ªé˜Ÿåˆ—çš„ç´¢å¼•æ–‡ä»¶æ¥ æå‡è¯»å–æ¶ˆæ¯çš„æ•ˆç‡ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥æ ¹æ®é˜Ÿåˆ—çš„æ¶ˆæ¯åºå·ï¼Œè®¡ç®—å‡ºç´¢å¼•çš„å…¨å±€ä½ç½®ï¼ˆç´¢å¼•åºå·*ç´¢å¼•å›ºå®šâ»“åº¦20ï¼‰ï¼Œç„¶åç›´æ¥è¯»å–è¿™æ¡ç´¢å¼•ï¼Œå†æ ¹æ®ç´¢å¼•ä¸­è®°å½•çš„æ¶ˆæ¯çš„å…¨å±€ä½ç½®ï¼Œæ‰¾åˆ°æ¶ˆæ¯ã€‚\nè®²åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½å¯¹ RockeMQ çš„å­˜å‚¨æ¶æ„è¿˜æœ‰äº›æ¨¡ç³Šï¼Œæ²¡äº‹ï¼Œæˆ‘ä»¬ç»“åˆç€å›¾æ¥ç†è§£ä¸€ä¸‹ã€‚\nemmmï¼Œæ˜¯ä¸æ˜¯æœ‰ä¸€ç‚¹å¤æ‚ğŸ¤£ï¼Œçœ‹è‹±æ–‡å›¾ç‰‡å’Œè‹±æ–‡æ–‡æ¡£çš„æ—¶å€™å°±ä¸è¦æ€‚ï¼Œç¡¬ç€å¤´çš®å¾€ä¸‹çœ‹å°±è¡Œã€‚\nå¦‚æœä¸Šé¢æ²¡çœ‹æ‡‚çš„è¯»è€…ä¸€å®šè¦è®¤çœŸçœ‹ä¸‹é¢çš„æµç¨‹åˆ†æï¼\né¦–å…ˆï¼Œåœ¨æœ€ä¸Šé¢çš„é‚£ä¸€å—å°±æ˜¯æˆ‘åˆšåˆšè®²çš„ä½ ç°åœ¨å¯ä»¥ç›´æ¥ æŠŠ ConsumerQueue ç†è§£ä¸º Queueã€‚\nåœ¨å›¾ä¸­æœ€å·¦è¾¹è¯´æ˜äº†çº¢è‰²æ–¹å—ä»£è¡¨è¢«å†™å…¥çš„æ¶ˆæ¯ï¼Œè™šçº¿æ–¹å—ä»£è¡¨ç­‰å¾…è¢«å†™å…¥çš„ã€‚å·¦è¾¹çš„ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ä¼šæŒ‡å®š Topic ã€QueueId å’Œå…·ä½“æ¶ˆæ¯å†…å®¹ï¼Œè€Œåœ¨ Broker ä¸­ç®¡ä½ æ˜¯å“ªé—¨å­æ¶ˆæ¯ï¼Œä»–ç›´æ¥ å…¨éƒ¨é¡ºåºå­˜å‚¨åˆ°äº† CommitLogã€‚è€Œæ ¹æ®ç”Ÿäº§è€…æŒ‡å®šçš„ Topic å’Œ QueueId å°†è¿™æ¡æ¶ˆæ¯æœ¬èº«åœ¨ CommitLog çš„åç§»(offset)ï¼Œæ¶ˆæ¯æœ¬èº«å¤§å°ï¼Œå’Œtagçš„hashå€¼å­˜å…¥å¯¹åº”çš„ ConsumeQueue ç´¢å¼•æ–‡ä»¶ä¸­ã€‚è€Œåœ¨æ¯ä¸ªé˜Ÿåˆ—ä¸­éƒ½ä¿å­˜äº† ConsumeOffset å³æ¯ä¸ªæ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹ä½ç½®(æˆ‘åœ¨æ¶æ„é‚£é‡Œæåˆ°äº†ï¼Œå¿˜äº†çš„åŒå­¦å¯ä»¥å›å»çœ‹ä¸€ä¸‹)ï¼Œè€Œæ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹çš„æ—¶å€™åªéœ€è¦æ ¹æ® ConsumeOffset è·å–ä¸‹ä¸€ä¸ªæœªè¢«æ¶ˆè´¹çš„æ¶ˆæ¯å°±è¡Œäº†ã€‚\nä¸Šè¿°å°±æ˜¯æˆ‘å¯¹äºæ•´ä¸ªæ¶ˆæ¯å­˜å‚¨æ¶æ„çš„å¤§æ¦‚ç†è§£(è¿™é‡Œä¸æ¶‰åŠåˆ°ä¸€äº›ç»†èŠ‚è®¨è®ºï¼Œæ¯”å¦‚ç¨€ç–ç´¢å¼•ç­‰ç­‰é—®é¢˜)ï¼Œå¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©ã€‚\nå› ä¸ºæœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹å› ä¸ºå†™å—¨äº†å¿˜è®²äº†ï¼Œæƒ³æƒ³åœ¨å“ªé‡ŒåŠ ä¹Ÿä¸å¥½ï¼Œæ‰€ä»¥æˆ‘ç•™ç»™å¤§å®¶å»æ€è€ƒğŸ¤”ğŸ¤”ä¸€ä¸‹å§ã€‚\nä¸ºä»€ä¹ˆ CommitLog æ–‡ä»¶è¦è®¾è®¡æˆå›ºå®šå¤§å°çš„é•¿åº¦å‘¢ï¼Ÿæé†’ï¼šå†…å­˜æ˜ å°„æœºåˆ¶ã€‚\n# æ€»ç»“ # æ€»ç®—æŠŠè¿™ç¯‡åšå®¢å†™å®Œäº†ã€‚æˆ‘è®²çš„ä½ ä»¬è¿˜è®°å¾—å—ğŸ˜…ï¼Ÿ\nè¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä¸»è¦æƒ³å¤§å®¶ä»‹ç»äº†\næ¶ˆæ¯é˜Ÿåˆ—å‡ºç°çš„åŸå›  æ¶ˆæ¯é˜Ÿåˆ—çš„ä½œç”¨(å¼‚æ­¥ï¼Œè§£è€¦ï¼Œå‰Šå³°) æ¶ˆæ¯é˜Ÿåˆ—å¸¦æ¥çš„ä¸€ç³»åˆ—é—®é¢˜(æ¶ˆæ¯å †ç§¯ã€é‡å¤æ¶ˆè´¹ã€é¡ºåºæ¶ˆè´¹ã€åˆ†å¸ƒå¼äº‹åŠ¡ç­‰ç­‰) æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸¤ç§æ¶ˆæ¯æ¨¡å‹â€”â€”é˜Ÿåˆ—å’Œä¸»é¢˜æ¨¡å¼ åˆ†æäº† RocketMQ çš„æŠ€æœ¯æ¶æ„(NameServer ã€Broker ã€Producer ã€Comsumer) ç»“åˆ RocketMQ å›ç­”äº†æ¶ˆæ¯é˜Ÿåˆ—å‰¯ä½œç”¨çš„è§£å†³æ–¹æ¡ˆ ä»‹ç»äº† RocketMQ çš„å­˜å‚¨æœºåˆ¶å’Œåˆ·ç›˜ç­–ç•¥ã€‚ ç­‰ç­‰ã€‚ã€‚ã€‚\nå¦‚æœå–œæ¬¢å¯ä»¥ç‚¹èµå“ŸğŸ‘ğŸ‘ğŸ‘ã€‚\nè‘—ä½œæƒå½’æ‰€æœ‰ åŸæ–‡é“¾æ¥ï¼šhttps://javaguide.cn/high-performance/message-queue/rocketmq-intro.html\n"},{"id":77,"href":"/zh/docs/study/Review/java_guide/lyely_high-performance/message-mq/base/","title":"message-queue","section":"RocketMQ","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nâ€œRabbitMQï¼Ÿâ€â€œKafkaï¼Ÿâ€â€œRocketMQï¼Ÿâ€\u0026hellip;åœ¨æ—¥å¸¸å­¦ä¹ ä¸å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸å¬åˆ°æ¶ˆæ¯é˜Ÿåˆ—è¿™ä¸ªå…³é”®è¯ã€‚æˆ‘ä¹Ÿåœ¨æˆ‘çš„å¤šç¯‡æ–‡ç« ä¸­æåˆ°äº†è¿™ä¸ªæ¦‚å¿µã€‚å¯èƒ½ä½ æ˜¯ç†Ÿç»ƒä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„è€æ‰‹ï¼Œåˆæˆ–è€…ä½ æ˜¯ä¸æ‡‚æ¶ˆæ¯é˜Ÿåˆ—çš„æ–°æ‰‹ï¼Œä¸è®ºä½ äº†ä¸äº†è§£æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæœ¬æ–‡éƒ½å°†å¸¦ä½ ææ‡‚æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸€äº›åŸºæœ¬ç†è®ºã€‚\nå¦‚æœä½ æ˜¯è€æ‰‹ï¼Œä½ å¯èƒ½ä»æœ¬æ–‡å­¦åˆ°ä½ ä¹‹å‰ä¸æ›¾æ³¨æ„çš„ä¸€äº›å…³äºæ¶ˆæ¯é˜Ÿåˆ—çš„é‡è¦æ¦‚å¿µï¼Œå¦‚æœä½ æ˜¯æ–°æ‰‹ï¼Œç›¸ä¿¡æœ¬æ–‡å°†æ˜¯ä½ æ‰“å¼€æ¶ˆæ¯é˜Ÿåˆ—å¤§é—¨çš„ä¸€æ¿ç –ã€‚\nä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ # æˆ‘ä»¬å¯ä»¥æŠŠæ¶ˆæ¯é˜Ÿåˆ—çœ‹ä½œæ˜¯ä¸€ä¸ªå­˜æ”¾æ¶ˆæ¯çš„å®¹å™¨ï¼Œå½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨æ¶ˆæ¯çš„æ—¶å€™ï¼Œç›´æ¥ä»å®¹å™¨ä¸­å–å‡ºæ¶ˆæ¯ä¾›è‡ªå·±ä½¿ç”¨å³å¯ã€‚ç”±äºé˜Ÿåˆ— Queue æ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºçš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥æ¶ˆè´¹æ¶ˆæ¯æ—¶ä¹Ÿæ˜¯æŒ‰ç…§é¡ºåºæ¥æ¶ˆè´¹çš„ã€‚\nå‚ä¸æ¶ˆæ¯ä¼ é€’çš„åŒæ–¹ç§°ä¸ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…è´Ÿè´£å‘é€æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…è´Ÿè´£å¤„ç†æ¶ˆæ¯ã€‚\næˆ‘ä»¬çŸ¥é“æ“ä½œç³»ç»Ÿä¸­çš„è¿›ç¨‹é€šä¿¡çš„ä¸€ç§å¾ˆé‡è¦çš„æ–¹å¼å°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ã€‚æˆ‘ä»¬è¿™é‡Œæåˆ°çš„æ¶ˆæ¯é˜Ÿåˆ—ç¨å¾®æœ‰ç‚¹åŒºåˆ«ï¼Œæ›´å¤šæŒ‡çš„æ˜¯å„ä¸ªæœåŠ¡ä»¥åŠç³»ç»Ÿå†…éƒ¨å„ä¸ªç»„ä»¶/æ¨¡å—ä¹‹å‰çš„é€šä¿¡ï¼Œå±äºä¸€ç§ä¸­é—´ä»¶ã€‚\néšç€åˆ†å¸ƒå¼å’Œå¾®æœåŠ¡ç³»ç»Ÿçš„å‘å±•ï¼Œæ¶ˆæ¯é˜Ÿåˆ—åœ¨ç³»ç»Ÿè®¾è®¡ä¸­æœ‰äº†æ›´å¤§çš„å‘æŒ¥ç©ºé—´ï¼Œä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥é™ä½ç³»ç»Ÿè€¦åˆæ€§ã€å®ç°ä»»åŠ¡å¼‚æ­¥ã€æœ‰æ•ˆåœ°è¿›è¡Œæµé‡å‰Šå³°ï¼Œæ˜¯åˆ†å¸ƒå¼å’Œå¾®æœåŠ¡ç³»ç»Ÿä¸­é‡è¦çš„ç»„ä»¶ä¹‹ä¸€ã€‚\næ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆç”¨ï¼Ÿ # é€šå¸¸æ¥è¯´ï¼Œä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—èƒ½ä¸ºæˆ‘ä»¬çš„ç³»ç»Ÿå¸¦æ¥ä¸‹é¢ä¸‰ç‚¹å¥½å¤„ï¼š\né€šè¿‡å¼‚æ­¥å¤„ç†æé«˜ç³»ç»Ÿæ€§èƒ½ï¼ˆå‡å°‘å“åº”æ‰€éœ€æ—¶é—´ï¼‰ã€‚ å‰Šå³°/é™æµ é™ä½ç³»ç»Ÿè€¦åˆæ€§ã€‚ å¦‚æœåœ¨é¢è¯•çš„æ—¶å€™ä½ è¢«é¢è¯•å®˜é—®åˆ°è¿™ä¸ªé—®é¢˜çš„è¯ï¼Œä¸€èˆ¬æƒ…å†µæ˜¯ä½ åœ¨ä½ çš„ç®€å†ä¸Šæ¶‰åŠåˆ°æ¶ˆæ¯é˜Ÿåˆ—è¿™æ–¹é¢çš„å†…å®¹ï¼Œè¿™ä¸ªæ—¶å€™æ¨èä½ ç»“åˆä½ è‡ªå·±çš„é¡¹ç›®æ¥å›ç­”ã€‚\né€šè¿‡å¼‚æ­¥å¤„ç†æé«˜ç³»ç»Ÿæ€§èƒ½ï¼ˆå‡å°‘å“åº”æ‰€éœ€æ—¶é—´ï¼‰ # å°†ç”¨æˆ·çš„è¯·æ±‚æ•°æ®å­˜å‚¨åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¹‹åå°±ç«‹å³è¿”å›ç»“æœã€‚éšåï¼Œç³»ç»Ÿå†å¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ã€‚\nå› ä¸ºç”¨æˆ·è¯·æ±‚æ•°æ®å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¹‹åå°±ç«‹å³è¿”å›ç»™ç”¨æˆ·äº†ï¼Œä½†æ˜¯è¯·æ±‚æ•°æ®åœ¨åç»­çš„ä¸šåŠ¡æ ¡éªŒã€å†™æ•°æ®åº“ç­‰æ“ä½œä¸­å¯èƒ½å¤±è´¥ã€‚å› æ­¤ï¼Œä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œå¼‚æ­¥å¤„ç†ä¹‹åï¼Œéœ€è¦é€‚å½“ä¿®æ”¹ä¸šåŠ¡æµç¨‹è¿›è¡Œé…åˆï¼Œæ¯”å¦‚ç”¨æˆ·åœ¨æäº¤è®¢å•ä¹‹åï¼Œè®¢å•æ•°æ®å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸èƒ½ç«‹å³è¿”å›ç”¨æˆ·è®¢å•æäº¤æˆåŠŸï¼Œéœ€è¦åœ¨æ¶ˆæ¯é˜Ÿåˆ—çš„è®¢å•æ¶ˆè´¹è€…è¿›ç¨‹çœŸæ­£å¤„ç†å®Œè¯¥è®¢å•ä¹‹åï¼Œç”šè‡³å‡ºåº“åï¼Œå†é€šè¿‡ç”µå­é‚®ä»¶æˆ–çŸ­ä¿¡é€šçŸ¥ç”¨æˆ·è®¢å•æˆåŠŸï¼Œä»¥å…äº¤æ˜“çº çº·ã€‚è¿™å°±ç±»ä¼¼æˆ‘ä»¬å¹³æ—¶æ‰‹æœºè®¢ç«è½¦ç¥¨å’Œç”µå½±ç¥¨ã€‚\nå‰Šå³°/é™æµ # å…ˆå°†çŸ­æ—¶é—´é«˜å¹¶å‘äº§ç”Ÿçš„äº‹åŠ¡æ¶ˆæ¯å­˜å‚¨åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç„¶ååç«¯æœåŠ¡å†æ…¢æ…¢æ ¹æ®è‡ªå·±çš„èƒ½åŠ›å»æ¶ˆè´¹è¿™äº›æ¶ˆæ¯ï¼Œè¿™æ ·å°±é¿å…ç›´æ¥æŠŠåç«¯æœåŠ¡æ‰“å®æ‰ã€‚\nä¸¾ä¾‹ï¼šåœ¨ç”µå­å•†åŠ¡ä¸€äº›ç§’æ€ã€ä¿ƒé”€æ´»åŠ¨ä¸­ï¼Œåˆç†ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥æœ‰æ•ˆæŠµå¾¡ä¿ƒé”€æ´»åŠ¨åˆšå¼€å§‹å¤§é‡è®¢å•æ¶Œå…¥å¯¹ç³»ç»Ÿçš„å†²å‡»ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\né™ä½ç³»ç»Ÿè€¦åˆæ€§ # ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿˜å¯ä»¥é™ä½ç³»ç»Ÿè€¦åˆæ€§ã€‚æˆ‘ä»¬çŸ¥é“å¦‚æœæ¨¡å—ä¹‹é—´ä¸å­˜åœ¨ç›´æ¥è°ƒç”¨ï¼Œé‚£ä¹ˆæ–°å¢æ¨¡å—æˆ–è€…ä¿®æ”¹æ¨¡å—å°±å¯¹å…¶ä»–æ¨¡å—å½±å“è¾ƒå°ï¼Œè¿™æ ·ç³»ç»Ÿçš„å¯æ‰©å±•æ€§æ— ç–‘æ›´å¥½ä¸€äº›ã€‚è¿˜æ˜¯ç›´æ¥ä¸Šå›¾å§ï¼š\nç”Ÿäº§è€…ï¼ˆå®¢æˆ·ç«¯ï¼‰å‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­å»ï¼Œæ¥å—è€…ï¼ˆæœåŠ¡ç«¯ï¼‰å¤„ç†æ¶ˆæ¯ï¼Œéœ€è¦æ¶ˆè´¹çš„ç³»ç»Ÿç›´æ¥å»æ¶ˆæ¯é˜Ÿåˆ—å–æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹å³å¯è€Œä¸éœ€è¦å’Œå…¶ä»–ç³»ç»Ÿæœ‰è€¦åˆï¼Œè¿™æ˜¾ç„¶ä¹Ÿæé«˜äº†ç³»ç»Ÿçš„æ‰©å±•æ€§ã€‚\næ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨å‘å¸ƒ-è®¢é˜…æ¨¡å¼å·¥ä½œï¼Œæ¶ˆæ¯å‘é€è€…ï¼ˆç”Ÿäº§è€…ï¼‰å‘å¸ƒæ¶ˆæ¯ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆæ¯æ¥å—è€…ï¼ˆæ¶ˆè´¹è€…ï¼‰è®¢é˜…æ¶ˆæ¯ã€‚ ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°æ¶ˆæ¯å‘é€è€…ï¼ˆç”Ÿäº§è€…ï¼‰å’Œæ¶ˆæ¯æ¥å—è€…ï¼ˆæ¶ˆè´¹è€…ï¼‰ä¹‹é—´æ²¡æœ‰ç›´æ¥è€¦åˆï¼Œæ¶ˆæ¯å‘é€è€…å°†æ¶ˆæ¯å‘é€è‡³åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—å³ç»“æŸå¯¹æ¶ˆæ¯çš„å¤„ç†ï¼Œæ¶ˆæ¯æ¥å—è€…ä»åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—è·å–è¯¥æ¶ˆæ¯åè¿›è¡Œåç»­å¤„ç†ï¼Œå¹¶ä¸éœ€è¦çŸ¥é“è¯¥æ¶ˆæ¯ä»ä½•è€Œæ¥ã€‚å¯¹æ–°å¢ä¸šåŠ¡ï¼Œåªè¦å¯¹è¯¥ç±»æ¶ˆæ¯æ„Ÿå…´è¶£ï¼Œå³å¯è®¢é˜…è¯¥æ¶ˆæ¯ï¼Œå¯¹åŸæœ‰ç³»ç»Ÿå’Œä¸šåŠ¡æ²¡æœ‰ä»»ä½•å½±å“ï¼Œä»è€Œå®ç°ç½‘ç«™ä¸šåŠ¡çš„å¯æ‰©å±•æ€§è®¾è®¡ã€‚\næ¶ˆæ¯æ¥å—è€…å¯¹æ¶ˆæ¯è¿›è¡Œè¿‡æ»¤ã€å¤„ç†ã€åŒ…è£…åï¼Œæ„é€ æˆä¸€ä¸ªæ–°çš„æ¶ˆæ¯ç±»å‹ï¼Œå°†æ¶ˆæ¯ç»§ç»­å‘é€å‡ºå»ï¼Œç­‰å¾…å…¶ä»–æ¶ˆæ¯æ¥å—è€…è®¢é˜…è¯¥æ¶ˆæ¯ã€‚å› æ­¤åŸºäºäº‹ä»¶ï¼ˆæ¶ˆæ¯å¯¹è±¡ï¼‰é©±åŠ¨çš„ä¸šåŠ¡æ¶æ„å¯ä»¥æ˜¯ä¸€ç³»åˆ—æµç¨‹ã€‚\nå¦å¤–ï¼Œä¸ºäº†é¿å…æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨å®•æœºé€ æˆæ¶ˆæ¯ä¸¢å¤±ï¼Œä¼šå°†æˆåŠŸå‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯å­˜å‚¨åœ¨æ¶ˆæ¯ç”Ÿäº§è€…æœåŠ¡å™¨ä¸Šï¼Œç­‰æ¶ˆæ¯çœŸæ­£è¢«æ¶ˆè´¹è€…æœåŠ¡å™¨å¤„ç†åæ‰åˆ é™¤æ¶ˆæ¯ã€‚åœ¨æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨å®•æœºåï¼Œç”Ÿäº§è€…æœåŠ¡å™¨ä¼šé€‰æ‹©åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨é›†ç¾¤ä¸­çš„å…¶ä»–æœåŠ¡å™¨å‘å¸ƒæ¶ˆæ¯ã€‚\nå¤‡æ³¨ï¼š ä¸è¦è®¤ä¸ºæ¶ˆæ¯é˜Ÿåˆ—åªèƒ½åˆ©ç”¨å‘å¸ƒ-è®¢é˜…æ¨¡å¼å·¥ä½œï¼Œåªä¸è¿‡åœ¨è§£è€¦è¿™ä¸ªç‰¹å®šä¸šåŠ¡ç¯å¢ƒä¸‹æ˜¯ä½¿ç”¨å‘å¸ƒ-è®¢é˜…æ¨¡å¼çš„ã€‚é™¤äº†å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œè¿˜æœ‰ç‚¹å¯¹ç‚¹è®¢é˜…æ¨¡å¼ï¼ˆä¸€ä¸ªæ¶ˆæ¯åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ï¼‰ï¼Œæˆ‘ä»¬æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯å‘å¸ƒ-è®¢é˜…æ¨¡å¼ã€‚å¦å¤–ï¼Œè¿™ä¸¤ç§æ¶ˆæ¯æ¨¡å‹æ˜¯ JMS æä¾›çš„ï¼ŒAMQP åè®®è¿˜æä¾›äº† 5 ç§æ¶ˆæ¯æ¨¡å‹ã€‚\nä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å“ªäº›é—®é¢˜ï¼Ÿ # ç³»ç»Ÿå¯ç”¨æ€§é™ä½ï¼š ç³»ç»Ÿå¯ç”¨æ€§åœ¨æŸç§ç¨‹åº¦ä¸Šé™ä½ï¼Œä¸ºä»€ä¹ˆè¿™æ ·è¯´å‘¢ï¼Ÿåœ¨åŠ å…¥ MQ ä¹‹å‰ï¼Œä½ ä¸ç”¨è€ƒè™‘æ¶ˆæ¯ä¸¢å¤±æˆ–è€…è¯´ MQ æŒ‚æ‰ç­‰ç­‰çš„æƒ…å†µï¼Œä½†æ˜¯ï¼Œå¼•å…¥ MQ ä¹‹åä½ å°±éœ€è¦å»è€ƒè™‘äº†ï¼ ç³»ç»Ÿå¤æ‚æ€§æé«˜ï¼š åŠ å…¥ MQ ä¹‹åï¼Œä½ éœ€è¦ä¿è¯æ¶ˆæ¯æ²¡æœ‰è¢«é‡å¤æ¶ˆè´¹ã€å¤„ç†æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µã€ä¿è¯æ¶ˆæ¯ä¼ é€’çš„é¡ºåºæ€§ç­‰ç­‰é—®é¢˜ï¼ ä¸€è‡´æ€§é—®é¢˜ï¼š æˆ‘ä¸Šé¢è®²äº†æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å®ç°å¼‚æ­¥ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¸¦æ¥çš„å¼‚æ­¥ç¡®å®å¯ä»¥æé«˜ç³»ç»Ÿå“åº”é€Ÿåº¦ã€‚ä½†æ˜¯ï¼Œä¸‡ä¸€æ¶ˆæ¯çš„çœŸæ­£æ¶ˆè´¹è€…å¹¶æ²¡æœ‰æ­£ç¡®æ¶ˆè´¹æ¶ˆæ¯æ€ä¹ˆåŠï¼Ÿè¿™æ ·å°±ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µäº†! JMS å’Œ AMQP # JMS æ˜¯ä»€ä¹ˆï¼Ÿ # JMSï¼ˆJAVA Message Service,java æ¶ˆæ¯æœåŠ¡ï¼‰æ˜¯ java çš„æ¶ˆæ¯æœåŠ¡ï¼ŒJMS çš„å®¢æˆ·ç«¯ä¹‹é—´å¯ä»¥é€šè¿‡ JMS æœåŠ¡è¿›è¡Œå¼‚æ­¥çš„æ¶ˆæ¯ä¼ è¾“ã€‚JMSï¼ˆJAVA Message Serviceï¼ŒJava æ¶ˆæ¯æœåŠ¡ï¼‰API æ˜¯ä¸€ä¸ªæ¶ˆæ¯æœåŠ¡çš„æ ‡å‡†æˆ–è€…è¯´æ˜¯è§„èŒƒï¼Œå…è®¸åº”ç”¨ç¨‹åºç»„ä»¶åŸºäº JavaEE å¹³å°åˆ›å»ºã€å‘é€ã€æ¥æ”¶å’Œè¯»å–æ¶ˆæ¯ã€‚å®ƒä½¿åˆ†å¸ƒå¼é€šä¿¡è€¦åˆåº¦æ›´ä½ï¼Œæ¶ˆæ¯æœåŠ¡æ›´åŠ å¯é ä»¥åŠå¼‚æ­¥æ€§ã€‚\nJMS å®šä¹‰äº†äº”ç§ä¸åŒçš„æ¶ˆæ¯æ­£æ–‡æ ¼å¼ä»¥åŠè°ƒç”¨çš„æ¶ˆæ¯ç±»å‹ï¼Œå…è®¸ä½ å‘é€å¹¶æ¥æ”¶ä»¥ä¸€äº›ä¸åŒå½¢å¼çš„æ•°æ®ï¼š\nStreamMessageï¼šJava åŸå§‹å€¼çš„æ•°æ®æµ MapMessageï¼šä¸€å¥—åç§°-å€¼å¯¹ TextMessageï¼šä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ ObjectMessageï¼šä¸€ä¸ªåºåˆ—åŒ–çš„ Java å¯¹è±¡ BytesMessageï¼šä¸€ä¸ªå­—èŠ‚çš„æ•°æ®æµ ActiveMQï¼ˆå·²è¢«æ·˜æ±°ï¼‰ å°±æ˜¯åŸºäº JMS è§„èŒƒå®ç°çš„ã€‚\nJMS ä¸¤ç§æ¶ˆæ¯æ¨¡å‹ # ç‚¹åˆ°ç‚¹ï¼ˆP2Pï¼‰æ¨¡å‹ # ä½¿ç”¨**é˜Ÿåˆ—ï¼ˆQueueï¼‰*ä½œä¸ºæ¶ˆæ¯é€šä¿¡è½½ä½“ï¼›æ»¡è¶³*ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…æ¨¡å¼ï¼Œä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…ä½¿ç”¨ï¼Œæœªè¢«æ¶ˆè´¹çš„æ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­ä¿ç•™ç›´åˆ°è¢«æ¶ˆè´¹æˆ–è¶…æ—¶ã€‚æ¯”å¦‚ï¼šæˆ‘ä»¬ç”Ÿäº§è€…å‘é€ 100 æ¡æ¶ˆæ¯çš„è¯ï¼Œä¸¤ä¸ªæ¶ˆè´¹è€…æ¥æ¶ˆè´¹ä¸€èˆ¬æƒ…å†µä¸‹ä¸¤ä¸ªæ¶ˆè´¹è€…ä¼šæŒ‰ç…§æ¶ˆæ¯å‘é€çš„é¡ºåºå„è‡ªæ¶ˆè´¹ä¸€åŠï¼ˆä¹Ÿå°±æ˜¯ä½ ä¸€ä¸ªæˆ‘ä¸€ä¸ªçš„æ¶ˆè´¹ã€‚ï¼‰\nå‘å¸ƒ/è®¢é˜…ï¼ˆPub/Subï¼‰æ¨¡å‹ # å‘å¸ƒè®¢é˜…æ¨¡å‹ï¼ˆPub/Subï¼‰ ä½¿ç”¨**ä¸»é¢˜ï¼ˆTopicï¼‰*ä½œä¸ºæ¶ˆæ¯é€šä¿¡è½½ä½“ï¼Œç±»ä¼¼äº*å¹¿æ’­æ¨¡å¼ï¼›å‘å¸ƒè€…å‘å¸ƒä¸€æ¡æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯é€šè¿‡ä¸»é¢˜ä¼ é€’ç»™æ‰€æœ‰çš„è®¢é˜…è€…ï¼Œåœ¨ä¸€æ¡æ¶ˆæ¯å¹¿æ’­ä¹‹åæ‰è®¢é˜…çš„ç”¨æˆ·åˆ™æ˜¯æ”¶ä¸åˆ°è¯¥æ¡æ¶ˆæ¯çš„ã€‚\nAMQP æ˜¯ä»€ä¹ˆï¼Ÿ # AMQPï¼Œå³ Advanced Message Queuing Protocolï¼Œä¸€ä¸ªæä¾›ç»Ÿä¸€æ¶ˆæ¯æœåŠ¡çš„åº”ç”¨å±‚æ ‡å‡† é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼ˆäºŒè¿›åˆ¶åº”ç”¨å±‚åè®®ï¼‰ï¼Œæ˜¯åº”ç”¨å±‚åè®®çš„ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼Œä¸ºé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶è®¾è®¡ï¼Œå…¼å®¹ JMSã€‚åŸºäºæ­¤åè®®çš„å®¢æˆ·ç«¯ä¸æ¶ˆæ¯ä¸­é—´ä»¶å¯ä¼ é€’æ¶ˆæ¯ï¼Œå¹¶ä¸å—å®¢æˆ·ç«¯/ä¸­é—´ä»¶åŒäº§å“ï¼Œä¸åŒçš„å¼€å‘è¯­è¨€ç­‰æ¡ä»¶çš„é™åˆ¶ã€‚\nRabbitMQ å°±æ˜¯åŸºäº AMQP åè®®å®ç°çš„ã€‚\nJMS vs AMQP # å¯¹æ¯”æ–¹å‘ JMS AMQP å®šä¹‰ Java API åè®® è·¨è¯­è¨€ å¦ æ˜¯ è·¨å¹³å° å¦ æ˜¯ æ”¯æŒæ¶ˆæ¯ç±»å‹ æä¾›ä¸¤ç§æ¶ˆæ¯æ¨¡å‹ï¼šâ‘ Peer-2-Peer;â‘¡Pub/sub æä¾›äº†äº”ç§æ¶ˆæ¯æ¨¡å‹ï¼šâ‘ direct exchangeï¼›â‘¡fanout exchangeï¼›â‘¢topic changeï¼›â‘£headers exchangeï¼›â‘¤system exchangeã€‚æœ¬è´¨æ¥è®²ï¼Œåå››ç§å’Œ JMS çš„ pub/sub æ¨¡å‹æ²¡æœ‰å¤ªå¤§å·®åˆ«ï¼Œä»…æ˜¯åœ¨è·¯ç”±æœºåˆ¶ä¸Šåšäº†æ›´è¯¦ç»†çš„åˆ’åˆ†ï¼› æ”¯æŒæ¶ˆæ¯ç±»å‹ æ”¯æŒå¤šç§æ¶ˆæ¯ç±»å‹ ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢æåˆ°è¿‡ byte[]ï¼ˆäºŒè¿›åˆ¶ï¼‰ æ€»ç»“ï¼š\nAMQP ä¸ºæ¶ˆæ¯å®šä¹‰äº†çº¿è·¯å±‚ï¼ˆwire-level protocolï¼‰çš„åè®®ï¼Œè€Œ JMS æ‰€å®šä¹‰çš„æ˜¯ API è§„èŒƒã€‚åœ¨ Java ä½“ç³»ä¸­ï¼Œå¤šä¸ª client å‡å¯ä»¥é€šè¿‡ JMS è¿›è¡Œäº¤äº’ï¼Œä¸éœ€è¦åº”ç”¨ä¿®æ”¹ä»£ç ï¼Œä½†æ˜¯å…¶å¯¹è·¨å¹³å°çš„æ”¯æŒè¾ƒå·®ã€‚è€Œ AMQP å¤©ç„¶å…·æœ‰è·¨å¹³å°ã€è·¨è¯­è¨€ç‰¹æ€§ã€‚ JMS æ”¯æŒ TextMessageã€MapMessage ç­‰å¤æ‚çš„æ¶ˆæ¯ç±»å‹ï¼›è€Œ AMQP ä»…æ”¯æŒ byte[] æ¶ˆæ¯ç±»å‹ï¼ˆå¤æ‚çš„ç±»å‹å¯åºåˆ—åŒ–åå‘é€ï¼‰ã€‚ ç”±äº Exchange æä¾›çš„è·¯ç”±ç®—æ³•ï¼ŒAMQP å¯ä»¥æä¾›å¤šæ ·åŒ–çš„è·¯ç”±æ–¹å¼æ¥ä¼ é€’æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè€Œ JMS ä»…æ”¯æŒ é˜Ÿåˆ— å’Œ ä¸»é¢˜/è®¢é˜… æ–¹å¼ä¸¤ç§ã€‚ æ¶ˆæ¯é˜Ÿåˆ—æŠ€æœ¯é€‰å‹ # å¸¸è§çš„æ¶ˆæ¯é˜Ÿåˆ—æœ‰å“ªäº›ï¼Ÿ # Kafka # Kafka æ˜¯ LinkedIn å¼€æºçš„ä¸€ä¸ªåˆ†å¸ƒå¼æµå¼å¤„ç†å¹³å°ï¼Œå·²ç»æˆä¸º Apache é¡¶çº§é¡¹ç›®ï¼Œæ—©æœŸè¢«ç”¨æ¥ç”¨äºå¤„ç†æµ·é‡çš„æ—¥å¿—ï¼Œåé¢æ‰æ…¢æ…¢å‘å±•æˆäº†ä¸€æ¬¾åŠŸèƒ½å…¨é¢çš„é«˜æ€§èƒ½æ¶ˆæ¯é˜Ÿåˆ—ã€‚\næµå¼å¤„ç†å¹³å°å…·æœ‰ä¸‰ä¸ªå…³é”®åŠŸèƒ½ï¼š\næ¶ˆæ¯é˜Ÿåˆ—ï¼šå‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯æµï¼Œè¿™ä¸ªåŠŸèƒ½ç±»ä¼¼äºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™ä¹Ÿæ˜¯ Kafka ä¹Ÿè¢«å½’ç±»ä¸ºæ¶ˆæ¯é˜Ÿåˆ—çš„åŸå› ã€‚ å®¹é”™çš„æŒä¹…æ–¹å¼å­˜å‚¨è®°å½•æ¶ˆæ¯æµï¼š Kafka ä¼šæŠŠæ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæœ‰æ•ˆé¿å…äº†æ¶ˆæ¯ä¸¢å¤±çš„é£é™©ã€‚ æµå¼å¤„ç†å¹³å°ï¼š åœ¨æ¶ˆæ¯å‘å¸ƒçš„æ—¶å€™è¿›è¡Œå¤„ç†ï¼ŒKafka æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„æµå¼å¤„ç†ç±»åº“ã€‚ Kafka æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œç”±é€šè¿‡é«˜æ€§èƒ½ TCP ç½‘ç»œåè®®è¿›è¡Œé€šä¿¡çš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ç»„æˆï¼Œå¯ä»¥éƒ¨ç½²åœ¨åœ¨æœ¬åœ°å’Œäº‘ç¯å¢ƒä¸­çš„è£¸æœºç¡¬ä»¶ã€è™šæ‹Ÿæœºå’Œå®¹å™¨ä¸Šã€‚\nåœ¨ Kafka 2.8 ä¹‹å‰ï¼ŒKafka æœ€è¢«å¤§å®¶è¯Ÿç—…çš„å°±æ˜¯å…¶é‡åº¦ä¾èµ–äº Zookeeper åšå…ƒæ•°æ®ç®¡ç†å’Œé›†ç¾¤çš„é«˜å¯ç”¨ã€‚åœ¨ Kafka 2.8 ä¹‹åï¼Œå¼•å…¥äº†åŸºäº Raft åè®®çš„ KRaft æ¨¡å¼ï¼Œä¸å†ä¾èµ– Zookeeperï¼Œå¤§å¤§ç®€åŒ–äº† Kafka çš„æ¶æ„ï¼Œè®©ä½ å¯ä»¥ä»¥ä¸€ç§è½»é‡çº§çš„æ–¹å¼æ¥ä½¿ç”¨ Kafkaã€‚\nä¸è¿‡ï¼Œè¦æç¤ºä¸€ä¸‹ï¼šå¦‚æœè¦ä½¿ç”¨ KRaft æ¨¡å¼çš„è¯ï¼Œå»ºè®®é€‰æ‹©è¾ƒé«˜ç‰ˆæœ¬çš„ Kafkaï¼Œå› ä¸ºè¿™ä¸ªåŠŸèƒ½è¿˜åœ¨æŒç»­å®Œå–„ä¼˜åŒ–ä¸­ã€‚Kafka 3.3.1 ç‰ˆæœ¬æ˜¯ç¬¬ä¸€ä¸ªå°† KRaftï¼ˆKafka Raftï¼‰å…±è¯†åè®®æ ‡è®°ä¸ºç”Ÿäº§å°±ç»ªçš„ç‰ˆæœ¬ã€‚\nKafka å®˜ç½‘ï¼šhttp://kafka.apache.org/\nKafka æ›´æ–°è®°å½•ï¼ˆå¯ä»¥ç›´è§‚çœ‹åˆ°é¡¹ç›®æ˜¯å¦è¿˜åœ¨ç»´æŠ¤ï¼‰ï¼šhttps://kafka.apache.org/downloads\nRocketMQ # RocketMQ æ˜¯é˜¿é‡Œå¼€æºçš„ä¸€æ¬¾äº‘åŸç”Ÿâ€œæ¶ˆæ¯ã€äº‹ä»¶ã€æµâ€å®æ—¶æ•°æ®å¤„ç†å¹³å°ï¼Œå€Ÿé‰´äº† Kafkaï¼Œå·²ç»æˆä¸º Apache é¡¶çº§é¡¹ç›®ã€‚\nRocketMQ çš„æ ¸å¿ƒç‰¹æ€§ï¼ˆæ‘˜è‡ª RocketMQ å®˜ç½‘ï¼‰ï¼š\näº‘åŸç”Ÿï¼šç”Ÿä¸äº‘ï¼Œé•¿ä¸äº‘ï¼Œæ— é™å¼¹æ€§æ‰©ç¼©ï¼ŒK8s å‹å¥½ é«˜ååï¼šä¸‡äº¿çº§ååä¿è¯ï¼ŒåŒæ—¶æ»¡è¶³å¾®æœåŠ¡ä¸å¤§æ•°æ®åœºæ™¯ã€‚ æµå¤„ç†ï¼šæä¾›è½»é‡ã€é«˜æ‰©å±•ã€é«˜æ€§èƒ½å’Œä¸°å¯ŒåŠŸèƒ½çš„æµè®¡ç®—å¼•æ“ã€‚ é‡‘èçº§ï¼šé‡‘èçº§çš„ç¨³å®šæ€§ï¼Œå¹¿æ³›ç”¨äºäº¤æ˜“æ ¸å¿ƒé“¾è·¯ã€‚ æ¶æ„æç®€ï¼šé›¶å¤–éƒ¨ä¾èµ–ï¼ŒShared-nothing æ¶æ„ã€‚ ç”Ÿæ€å‹å¥½ï¼šæ— ç¼å¯¹æ¥å¾®æœåŠ¡ã€å®æ—¶è®¡ç®—ã€æ•°æ®æ¹–ç­‰å‘¨è¾¹ç”Ÿæ€ã€‚ æ ¹æ®å®˜ç½‘ä»‹ç»ï¼š\nApache RocketMQ è‡ªè¯ç”Ÿä»¥æ¥ï¼Œå› å…¶æ¶æ„ç®€å•ã€ä¸šåŠ¡åŠŸèƒ½ä¸°å¯Œã€å…·å¤‡æå¼ºå¯æ‰©å±•æ€§ç­‰ç‰¹ç‚¹è¢«ä¼—å¤šä¼ä¸šå¼€å‘è€…ä»¥åŠäº‘å‚å•†å¹¿æ³›é‡‡ç”¨ã€‚å†ç»åä½™å¹´çš„å¤§è§„æ¨¡åœºæ™¯æ‰“ç£¨ï¼ŒRocketMQ å·²ç»æˆä¸ºä¸šå†…å…±è¯†çš„é‡‘èçº§å¯é ä¸šåŠ¡æ¶ˆæ¯é¦–é€‰æ–¹æ¡ˆï¼Œè¢«å¹¿æ³›åº”ç”¨äºäº’è”ç½‘ã€å¤§æ•°æ®ã€ç§»åŠ¨äº’è”ç½‘ã€ç‰©è”ç½‘ç­‰é¢†åŸŸçš„ä¸šåŠ¡åœºæ™¯ã€‚\nRocketMQ å®˜ç½‘ï¼šhttps://rocketmq.apache.org/ ï¼ˆæ–‡æ¡£å¾ˆè¯¦ç»†ï¼Œæ¨èé˜…è¯»ï¼‰\nRocketMQ æ›´æ–°è®°å½•ï¼ˆå¯ä»¥ç›´è§‚çœ‹åˆ°é¡¹ç›®æ˜¯å¦è¿˜åœ¨ç»´æŠ¤ï¼‰ï¼šhttps://github.com/apache/rocketmq/releases\nRabbitMQ # RabbitMQ æ˜¯é‡‡ç”¨ Erlang è¯­è¨€å®ç° AMQP(Advanced Message Queuing Protocolï¼Œé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå®ƒæœ€åˆèµ·æºäºé‡‘èç³»ç»Ÿï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å­˜å‚¨è½¬å‘æ¶ˆæ¯ã€‚\nRabbitMQ å‘å±•åˆ°ä»Šå¤©ï¼Œè¢«è¶Šæ¥è¶Šå¤šçš„äººè®¤å¯ï¼Œè¿™å’Œå®ƒåœ¨æ˜“ç”¨æ€§ã€æ‰©å±•æ€§ã€å¯é æ€§å’Œé«˜å¯ç”¨æ€§ç­‰æ–¹é¢çš„å“è‘—è¡¨ç°æ˜¯åˆ†ä¸å¼€çš„ã€‚RabbitMQ çš„å…·ä½“ç‰¹ç‚¹å¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š\nå¯é æ€§ï¼š RabbitMQ ä½¿ç”¨ä¸€äº›æœºåˆ¶æ¥ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Œå¦‚æŒä¹…åŒ–ã€ä¼ è¾“ç¡®è®¤åŠå‘å¸ƒç¡®è®¤ç­‰ã€‚ çµæ´»çš„è·¯ç”±ï¼š åœ¨æ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—ä¹‹å‰ï¼Œé€šè¿‡äº¤æ¢å™¨æ¥è·¯ç”±æ¶ˆæ¯ã€‚å¯¹äºå…¸å‹çš„è·¯ç”±åŠŸèƒ½ï¼ŒRabbitMQ å·±ç»æä¾›äº†ä¸€äº›å†…ç½®çš„äº¤æ¢å™¨æ¥å®ç°ã€‚é’ˆå¯¹æ›´å¤æ‚çš„è·¯ç”±åŠŸèƒ½ï¼Œå¯ä»¥å°†å¤šä¸ªäº¤æ¢å™¨ç»‘å®šåœ¨ä¸€èµ·ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ’ä»¶æœºåˆ¶æ¥å®ç°è‡ªå·±çš„äº¤æ¢å™¨ã€‚è¿™ä¸ªåé¢ä¼šåœ¨æˆ‘ä»¬è®² RabbitMQ æ ¸å¿ƒæ¦‚å¿µçš„æ—¶å€™è¯¦ç»†ä»‹ç»åˆ°ã€‚ æ‰©å±•æ€§ï¼š å¤šä¸ª RabbitMQ èŠ‚ç‚¹å¯ä»¥ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å®é™…ä¸šåŠ¡æƒ…å†µåŠ¨æ€åœ°æ‰©å±•é›†ç¾¤ä¸­èŠ‚ç‚¹ã€‚ é«˜å¯ç”¨æ€§ï¼š é˜Ÿåˆ—å¯ä»¥åœ¨é›†ç¾¤ä¸­çš„æœºå™¨ä¸Šè®¾ç½®é•œåƒï¼Œä½¿å¾—åœ¨éƒ¨åˆ†èŠ‚ç‚¹å‡ºç°é—®é¢˜çš„æƒ…å†µä¸‹é˜Ÿåˆ—ä»ç„¶å¯ç”¨ã€‚ æ”¯æŒå¤šç§åè®®ï¼š RabbitMQ é™¤äº†åŸç”Ÿæ”¯æŒ AMQP åè®®ï¼Œè¿˜æ”¯æŒ STOMPã€MQTT ç­‰å¤šç§æ¶ˆæ¯ä¸­é—´ä»¶åè®®ã€‚ å¤šè¯­è¨€å®¢æˆ·ç«¯ï¼š RabbitMQ å‡ ä¹æ”¯æŒæ‰€æœ‰å¸¸ç”¨è¯­è¨€ï¼Œæ¯”å¦‚ Javaã€Pythonã€Rubyã€PHPã€C#ã€JavaScript ç­‰ã€‚ æ˜“ç”¨çš„ç®¡ç†ç•Œé¢ï¼š RabbitMQ æä¾›äº†ä¸€ä¸ªæ˜“ç”¨çš„ç”¨æˆ·ç•Œé¢ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥ç›‘æ§å’Œç®¡ç†æ¶ˆæ¯ã€é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ç­‰ã€‚åœ¨å®‰è£… RabbitMQ çš„æ—¶å€™ä¼šä»‹ç»åˆ°ï¼Œå®‰è£…å¥½ RabbitMQ å°±è‡ªå¸¦ç®¡ç†ç•Œé¢ã€‚ æ’ä»¶æœºåˆ¶ï¼š RabbitMQ æä¾›äº†è®¸å¤šæ’ä»¶ï¼Œä»¥å®ç°ä»å¤šæ–¹é¢è¿›è¡Œæ‰©å±•ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç¼–å†™è‡ªå·±çš„æ’ä»¶ã€‚æ„Ÿè§‰è¿™ä¸ªæœ‰ç‚¹ç±»ä¼¼ Dubbo çš„ SPI æœºåˆ¶ RabbitMQ å®˜ç½‘ï¼šhttps://www.rabbitmq.com/ ã€‚\nRabbitMQ æ›´æ–°è®°å½•ï¼ˆå¯ä»¥ç›´è§‚çœ‹åˆ°é¡¹ç›®æ˜¯å¦è¿˜åœ¨ç»´æŠ¤ï¼‰ï¼šhttps://www.rabbitmq.com/news.html\nPulsar # Pulsar æ˜¯ä¸‹ä¸€ä»£äº‘åŸç”Ÿåˆ†å¸ƒå¼æ¶ˆæ¯æµå¹³å°ï¼Œæœ€åˆç”± Yahoo å¼€å‘ ï¼Œå·²ç»æˆä¸º Apache é¡¶çº§é¡¹ç›®ã€‚\nPulsar é›†æ¶ˆæ¯ã€å­˜å‚¨ã€è½»é‡åŒ–å‡½æ•°å¼è®¡ç®—ä¸ºä¸€ä½“ï¼Œé‡‡ç”¨è®¡ç®—ä¸å­˜å‚¨åˆ†ç¦»æ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¤šç§Ÿæˆ·ã€æŒä¹…åŒ–å­˜å‚¨ã€å¤šæœºæˆ¿è·¨åŒºåŸŸæ•°æ®å¤åˆ¶ï¼Œå…·æœ‰å¼ºä¸€è‡´æ€§ã€é«˜ååã€ä½å»¶æ—¶åŠé«˜å¯æ‰©å±•æ€§ç­‰æµæ•°æ®å­˜å‚¨ç‰¹æ€§ï¼Œè¢«çœ‹ä½œæ˜¯äº‘åŸç”Ÿæ—¶ä»£å®æ—¶æ¶ˆæ¯æµä¼ è¾“ã€å­˜å‚¨å’Œè®¡ç®—æœ€ä½³è§£å†³æ–¹æ¡ˆã€‚\nPulsar çš„å…³é”®ç‰¹æ€§å¦‚ä¸‹ï¼ˆæ‘˜è‡ªå®˜ç½‘ï¼‰ï¼š\næ˜¯ä¸‹ä¸€ä»£äº‘åŸç”Ÿåˆ†å¸ƒå¼æ¶ˆæ¯æµå¹³å°ã€‚ Pulsar çš„å•ä¸ªå®ä¾‹åŸç”Ÿæ”¯æŒå¤šä¸ªé›†ç¾¤ï¼Œå¯è·¨æœºæˆ¿åœ¨é›†ç¾¤é—´æ— ç¼åœ°å®Œæˆæ¶ˆæ¯å¤åˆ¶ã€‚ æä½çš„å‘å¸ƒå»¶è¿Ÿå’Œç«¯åˆ°ç«¯å»¶è¿Ÿã€‚ å¯æ— ç¼æ‰©å±•åˆ°è¶…è¿‡ä¸€ç™¾ä¸‡ä¸ª topicã€‚ ç®€å•çš„å®¢æˆ·ç«¯ APIï¼Œæ”¯æŒ Javaã€Goã€Python å’Œ C++ã€‚ ä¸»é¢˜çš„å¤šç§è®¢é˜…æ¨¡å¼ï¼ˆç‹¬å ã€å…±äº«å’Œæ•…éšœè½¬ç§»ï¼‰ã€‚ é€šè¿‡ Apache BookKeeper æä¾›çš„æŒä¹…åŒ–æ¶ˆæ¯å­˜å‚¨æœºåˆ¶ä¿è¯æ¶ˆæ¯ä¼ é€’ ã€‚ ç”±è½»é‡çº§çš„ serverless è®¡ç®—æ¡†æ¶ Pulsar Functions å®ç°æµåŸç”Ÿçš„æ•°æ®å¤„ç†ã€‚ åŸºäº Pulsar Functions çš„ serverless connector æ¡†æ¶ Pulsar IO ä½¿å¾—æ•°æ®æ›´æ˜“ç§»å…¥ã€ç§»å‡º Apache Pulsarã€‚ åˆ†å±‚å¼å­˜å‚¨å¯åœ¨æ•°æ®é™ˆæ—§æ—¶ï¼Œå°†æ•°æ®ä»çƒ­å­˜å‚¨å¸è½½åˆ°å†·/é•¿æœŸå­˜å‚¨ï¼ˆå¦‚ S3ã€GCSï¼‰ä¸­ã€‚ Pulsar å®˜ç½‘ï¼šhttps://pulsar.apache.org/\nPulsar æ›´æ–°è®°å½•ï¼ˆå¯ä»¥ç›´è§‚çœ‹åˆ°é¡¹ç›®æ˜¯å¦è¿˜åœ¨ç»´æŠ¤ï¼‰ï¼šhttps://github.com/apache/pulsar/releases\nActiveMQ # ç›®å‰å·²ç»è¢«æ·˜æ±°ï¼Œä¸æ¨èä½¿ç”¨ï¼Œä¸å»ºè®®å­¦ä¹ ã€‚\nå¦‚ä½•é€‰æ‹©ï¼Ÿ # å‚è€ƒã€ŠJava å·¥ç¨‹å¸ˆé¢è¯•çªå‡»ç¬¬ 1 å­£-ä¸­åçŸ³æ‰è€å¸ˆã€‹\nå¯¹æ¯”æ–¹å‘ æ¦‚è¦ ååé‡ ä¸‡çº§çš„ ActiveMQ å’Œ RabbitMQ çš„ååé‡ï¼ˆActiveMQ çš„æ€§èƒ½æœ€å·®ï¼‰è¦æ¯”åä¸‡çº§ç”šè‡³æ˜¯ç™¾ä¸‡çº§çš„ RocketMQ å’Œ Kafka ä½ä¸€ä¸ªæ•°é‡çº§ã€‚ å¯ç”¨æ€§ éƒ½å¯ä»¥å®ç°é«˜å¯ç”¨ã€‚ActiveMQ å’Œ RabbitMQ éƒ½æ˜¯åŸºäºä¸»ä»æ¶æ„å®ç°é«˜å¯ç”¨æ€§ã€‚RocketMQ åŸºäºåˆ†å¸ƒå¼æ¶æ„ã€‚ Kafka ä¹Ÿæ˜¯åˆ†å¸ƒå¼çš„ï¼Œä¸€ä¸ªæ•°æ®å¤šä¸ªå‰¯æœ¬ï¼Œå°‘æ•°æœºå™¨å®•æœºï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œä¸ä¼šå¯¼è‡´ä¸å¯ç”¨ æ—¶æ•ˆæ€§ RabbitMQ åŸºäº Erlang å¼€å‘ï¼Œæ‰€ä»¥å¹¶å‘èƒ½åŠ›å¾ˆå¼ºï¼Œæ€§èƒ½æå…¶å¥½ï¼Œå»¶æ—¶å¾ˆä½ï¼Œè¾¾åˆ°å¾®ç§’çº§ï¼Œå…¶ä»–å‡ ä¸ªéƒ½æ˜¯ ms çº§ã€‚ åŠŸèƒ½æ”¯æŒ Pulsar çš„åŠŸèƒ½æ›´å…¨é¢ï¼Œæ”¯æŒå¤šç§Ÿæˆ·ã€å¤šç§æ¶ˆè´¹æ¨¡å¼å’ŒæŒä¹…æ€§æ¨¡å¼ç­‰åŠŸèƒ½ï¼Œæ˜¯ä¸‹ä¸€ä»£äº‘åŸç”Ÿåˆ†å¸ƒå¼æ¶ˆæ¯æµå¹³å°ã€‚ æ¶ˆæ¯ä¸¢å¤± ActiveMQ å’Œ RabbitMQ ä¸¢å¤±çš„å¯èƒ½æ€§éå¸¸ä½ï¼Œ Kafkaã€RocketMQ å’Œ Pulsar ç†è®ºä¸Šå¯ä»¥åšåˆ° 0 ä¸¢å¤±ã€‚ æ€»ç»“ï¼š\nActiveMQ çš„ç¤¾åŒºç®—æ˜¯æ¯”è¾ƒæˆç†Ÿï¼Œä½†æ˜¯è¾ƒç›®å‰æ¥è¯´ï¼ŒActiveMQ çš„æ€§èƒ½æ¯”è¾ƒå·®ï¼Œè€Œä¸”ç‰ˆæœ¬è¿­ä»£å¾ˆæ…¢ï¼Œä¸æ¨èä½¿ç”¨ï¼Œå·²ç»è¢«æ·˜æ±°äº†ã€‚ RabbitMQ åœ¨ååé‡æ–¹é¢è™½ç„¶ç¨é€Šäº Kafka ã€RocketMQ å’Œ Pulsarï¼Œä½†æ˜¯ç”±äºå®ƒåŸºäº Erlang å¼€å‘ï¼Œæ‰€ä»¥å¹¶å‘èƒ½åŠ›å¾ˆå¼ºï¼Œæ€§èƒ½æå…¶å¥½ï¼Œå»¶æ—¶å¾ˆä½ï¼Œè¾¾åˆ°å¾®ç§’çº§ã€‚ä½†æ˜¯ä¹Ÿå› ä¸º RabbitMQ åŸºäº Erlang å¼€å‘ï¼Œæ‰€ä»¥å›½å†…å¾ˆå°‘æœ‰å…¬å¸æœ‰å®åŠ›åš Erlang æºç çº§åˆ«çš„ç ”ç©¶å’Œå®šåˆ¶ã€‚å¦‚æœä¸šåŠ¡åœºæ™¯å¯¹å¹¶å‘é‡è¦æ±‚ä¸æ˜¯å¤ªé«˜ï¼ˆåä¸‡çº§ã€ç™¾ä¸‡çº§ï¼‰ï¼Œé‚£è¿™å‡ ç§æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼ŒRabbitMQ æˆ–è®¸æ˜¯ä½ çš„é¦–é€‰ã€‚ RocketMQ å’Œ Pulsar æ”¯æŒå¼ºä¸€è‡´æ€§ï¼Œå¯¹æ¶ˆæ¯ä¸€è‡´æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯å¯ä»¥ä½¿ç”¨ã€‚ RocketMQ é˜¿é‡Œå‡ºå“ï¼ŒJava ç³»å¼€æºé¡¹ç›®ï¼Œæºä»£ç æˆ‘ä»¬å¯ä»¥ç›´æ¥é˜…è¯»ï¼Œç„¶åå¯ä»¥å®šåˆ¶è‡ªå·±å…¬å¸çš„ MQï¼Œå¹¶ä¸” RocketMQ æœ‰é˜¿é‡Œå·´å·´çš„å®é™…ä¸šåŠ¡åœºæ™¯çš„å®æˆ˜è€ƒéªŒã€‚ Kafka çš„ç‰¹ç‚¹å…¶å®å¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯ä»…ä»…æä¾›è¾ƒå°‘çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä½†æ˜¯æä¾›è¶…é«˜çš„ååé‡ï¼Œms çº§çš„å»¶è¿Ÿï¼Œæé«˜çš„å¯ç”¨æ€§ä»¥åŠå¯é æ€§ï¼Œè€Œä¸”åˆ†å¸ƒå¼å¯ä»¥ä»»æ„æ‰©å±•ã€‚åŒæ—¶ kafka æœ€å¥½æ˜¯æ”¯æ’‘è¾ƒå°‘çš„ topic æ•°é‡å³å¯ï¼Œä¿è¯å…¶è¶…é«˜ååé‡ã€‚Kafka å”¯ä¸€çš„ä¸€ç‚¹åŠ£åŠ¿æ˜¯æœ‰å¯èƒ½æ¶ˆæ¯é‡å¤æ¶ˆè´¹ï¼Œé‚£ä¹ˆå¯¹æ•°æ®å‡†ç¡®æ€§ä¼šé€ æˆæå…¶è½»å¾®çš„å½±å“ï¼Œåœ¨å¤§æ•°æ®é¢†åŸŸä¸­ä»¥åŠæ—¥å¿—é‡‡é›†ä¸­ï¼Œè¿™ç‚¹è½»å¾®å½±å“å¯ä»¥å¿½ç•¥è¿™ä¸ªç‰¹æ€§å¤©ç„¶é€‚åˆå¤§æ•°æ®å®æ—¶è®¡ç®—ä»¥åŠæ—¥å¿—æ”¶é›†ã€‚å¦‚æœæ˜¯å¤§æ•°æ®é¢†åŸŸçš„å®æ—¶è®¡ç®—ã€æ—¥å¿—é‡‡é›†ç­‰åœºæ™¯ï¼Œç”¨ Kafka æ˜¯ä¸šå†…æ ‡å‡†çš„ï¼Œç»å¯¹æ²¡é—®é¢˜ï¼Œç¤¾åŒºæ´»è·ƒåº¦å¾ˆé«˜ï¼Œç»å¯¹ä¸ä¼šé»„ï¼Œä½•å†µå‡ ä¹æ˜¯å…¨ä¸–ç•Œè¿™ä¸ªé¢†åŸŸçš„äº‹å®æ€§è§„èŒƒã€‚ å‚è€ƒ # KRaft: Apache Kafka Without ZooKeeperï¼šhttps://developer.confluent.io/learn/kraft/ "},{"id":78,"href":"/zh/docs/study/Review/java_guide/lyely_high-performance/ly02ly_cdn/","title":"cdn","section":"é«˜æ€§èƒ½","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nä»€ä¹ˆæ˜¯ CDN ï¼Ÿ # CDN å…¨ç§°æ˜¯ Content Delivery Network/Content Distribution Networkï¼Œç¿»è¯‘è¿‡çš„æ„æ€æ˜¯ å†…å®¹åˆ†å‘ç½‘ç»œ ã€‚\næˆ‘ä»¬å¯ä»¥å°†å†…å®¹åˆ†å‘ç½‘ç»œæ‹†å¼€æ¥çœ‹ï¼š\nå†…å®¹ ï¼šæŒ‡çš„æ˜¯é™æ€èµ„æºæ¯”å¦‚å›¾ç‰‡ã€è§†é¢‘ã€æ–‡æ¡£ã€JSã€CSSã€HTMLã€‚ åˆ†å‘ç½‘ç»œ ï¼šæŒ‡çš„æ˜¯å°†è¿™äº›é™æ€èµ„æºåˆ†å‘åˆ°ä½äºå¤šä¸ªä¸åŒçš„åœ°ç†ä½ç½®æœºæˆ¿ä¸­çš„æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥å®ç°é™æ€èµ„æºçš„å°±è¿‘è®¿é—®æ¯”å¦‚åŒ—äº¬çš„ç”¨æˆ·ç›´æ¥è®¿é—®åŒ—äº¬æœºæˆ¿çš„æ•°æ®ã€‚ æ‰€ä»¥ï¼Œç®€å•æ¥è¯´ï¼ŒCDN å°±æ˜¯å°†é™æ€èµ„æºåˆ†å‘åˆ°å¤šä¸ªä¸åŒçš„åœ°æ–¹ä»¥å®ç°å°±è¿‘è®¿é—®ï¼Œè¿›è€ŒåŠ å¿«é™æ€èµ„æºçš„è®¿é—®é€Ÿåº¦ï¼Œå‡è½»æœåŠ¡å™¨ä»¥åŠå¸¦å®½çš„è´Ÿæ‹…ã€‚\nç±»ä¼¼äºäº¬ä¸œå»ºç«‹çš„åºå¤§çš„ä»“å‚¨è¿è¾“ä½“ç³»ï¼Œäº¬ä¸œç‰©æµåœ¨å…¨å›½æ‹¥æœ‰éå¸¸å¤šçš„ä»“åº“ï¼Œä»“å‚¨ç½‘ç»œå‡ ä¹è¦†ç›–å…¨å›½æ‰€æœ‰åŒºå¿ã€‚è¿™æ ·çš„è¯ï¼Œç”¨æˆ·ä¸‹å•çš„ç¬¬ä¸€æ—¶é—´ï¼Œå•†å“å°±ä»è·ç¦»ç”¨æˆ·æœ€è¿‘çš„ä»“åº“ï¼Œç›´æ¥å‘å¾€å¯¹åº”çš„é…é€ç«™ï¼Œå†ç”±äº¬ä¸œå°å“¥é€åˆ°ä½ å®¶ã€‚\nä½ å¯ä»¥å°† CDN çœ‹ä½œæ˜¯æœåŠ¡ä¸Šä¸€å±‚çš„ç‰¹æ®Šç¼“å­˜æœåŠ¡ï¼Œåˆ†å¸ƒåœ¨å…¨å›½å„åœ°ï¼Œä¸»è¦ç”¨æ¥å¤„ç†é™æ€èµ„æºçš„è¯·æ±‚ã€‚\næˆ‘ä»¬ç»å¸¸æ‹¿å…¨ç«™åŠ é€Ÿå’Œå†…å®¹åˆ†å‘ç½‘ç»œåšå¯¹æ¯”ï¼Œä¸è¦æŠŠä¸¤è€…ææ··äº†ï¼å…¨ç«™åŠ é€Ÿï¼ˆä¸åŒäº‘æœåŠ¡å•†å«æ³•ä¸åŒï¼Œè…¾è®¯äº‘å« ECDNã€é˜¿é‡Œäº‘å« DCDNï¼‰æ—¢å¯ä»¥åŠ é€Ÿé™æ€èµ„æºåˆå¯ä»¥åŠ é€ŸåŠ¨æ€èµ„æºï¼Œ**å†…å®¹åˆ†å‘ç½‘ç»œï¼ˆCDNï¼‰**ä¸»è¦é’ˆå¯¹çš„æ˜¯ é™æ€èµ„æº ã€‚\nç»å¤§éƒ¨åˆ†å…¬å¸éƒ½ä¼šåœ¨é¡¹ç›®å¼€å‘ä¸­äº¤ä½¿ç”¨ CDN æœåŠ¡ï¼Œä½†å¾ˆå°‘ä¼šæœ‰è‡ªå»º CDN æœåŠ¡çš„å…¬å¸ã€‚åŸºäºæˆæœ¬ã€ç¨³å®šæ€§å’Œæ˜“ç”¨æ€§è€ƒè™‘ï¼Œå»ºè®®ç›´æ¥é€‰æ‹©ä¸“ä¸šçš„äº‘å‚å•†ï¼ˆæ¯”å¦‚é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€åä¸ºäº‘ã€é’äº‘ï¼‰æˆ–è€… CDN å‚å•†ï¼ˆæ¯”å¦‚ç½‘å®¿ã€è“æ±›ï¼‰æä¾›çš„å¼€ç®±å³ç”¨çš„ CDN æœåŠ¡ã€‚\nå¾ˆå¤šæœ‹å‹å¯èƒ½è¦é—®äº†ï¼šæ—¢ç„¶æ˜¯å°±è¿‘è®¿é—®ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥å°†æœåŠ¡éƒ¨ç½²åœ¨å¤šä¸ªä¸åŒçš„åœ°æ–¹å‘¢ï¼Ÿ\næˆæœ¬å¤ªé«˜ï¼Œéœ€è¦éƒ¨ç½²å¤šä»½ç›¸åŒçš„æœåŠ¡ã€‚ é™æ€èµ„æºé€šå¸¸å ç”¨ç©ºé—´æ¯”è¾ƒå¤§ä¸”ç»å¸¸ä¼šè¢«è®¿é—®åˆ°ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨æœåŠ¡å™¨æˆ–è€…ç¼“å­˜æ¥å¤„ç†é™æ€èµ„æºè¯·æ±‚çš„è¯ï¼Œå¯¹ç³»ç»Ÿèµ„æºæ¶ˆè€—éå¸¸å¤§ï¼Œå¯èƒ½ä¼šå½±å“åˆ°ç³»ç»Ÿå…¶ä»–æœåŠ¡çš„æ­£å¸¸è¿è¡Œã€‚ åŒä¸€ä¸ªæœåŠ¡åœ¨åœ¨å¤šä¸ªä¸åŒçš„åœ°æ–¹éƒ¨ç½²å¤šä»½ï¼ˆæ¯”å¦‚åŒåŸç¾å¤‡ã€å¼‚åœ°ç¾å¤‡ã€åŒåŸå¤šæ´»ã€å¼‚åœ°å¤šæ´»ï¼‰æ˜¯ä¸ºäº†å®ç°ç³»ç»Ÿçš„é«˜å¯ç”¨è€Œä¸æ˜¯å°±è¿‘è®¿é—®ã€‚\nCDN å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ # ææ‡‚ä¸‹é¢ 3 ä¸ªé—®é¢˜ä¹Ÿå°±ææ‡‚äº† CDN çš„å·¥ä½œåŸç†ï¼š\né™æ€èµ„æºæ˜¯å¦‚ä½•è¢«ç¼“å­˜åˆ° CDN èŠ‚ç‚¹ä¸­çš„ï¼Ÿ å¦‚ä½•æ‰¾åˆ°æœ€åˆé€‚çš„ CDN èŠ‚ç‚¹ï¼Ÿ å¦‚ä½•é˜²æ­¢é™æ€èµ„æºè¢«ç›—ç”¨ï¼Ÿ é™æ€èµ„æºæ˜¯å¦‚ä½•è¢«ç¼“å­˜åˆ° CDN èŠ‚ç‚¹ä¸­çš„ï¼Ÿ # ä½ å¯ä»¥é€šè¿‡é¢„çƒ­çš„æ–¹å¼å°†æºç«™çš„èµ„æºåŒæ­¥åˆ° CDN çš„èŠ‚ç‚¹ä¸­ã€‚è¿™æ ·çš„è¯ï¼Œç”¨æˆ·é¦–æ¬¡è¯·æ±‚èµ„æºå¯ä»¥ç›´æ¥ä» CDN èŠ‚ç‚¹ä¸­å–ï¼Œæ— éœ€å›æºã€‚è¿™æ ·å¯ä»¥é™ä½æºç«™å‹åŠ›ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚\nå¦‚æœä¸é¢„çƒ­çš„è¯ï¼Œä½ è®¿é—®çš„èµ„æºå¯èƒ½ä¸å† CDN èŠ‚ç‚¹ä¸­ï¼Œè¿™ä¸ªæ—¶å€™ CDN èŠ‚ç‚¹å°†è¯·æ±‚æºç«™è·å–èµ„æºï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¤§å®¶ç»å¸¸è¯´çš„ å›æºã€‚\nå‘½ä¸­ç‡ å’Œ å›æºç‡ æ˜¯è¡¡é‡ CDN æœåŠ¡è´¨é‡ä¸¤ä¸ªé‡è¦æŒ‡æ ‡ã€‚å‘½ä¸­ç‡è¶Šé«˜è¶Šå¥½ï¼Œå›æºç‡è¶Šä½è¶Šå¥½ã€‚\nå¦‚æœèµ„æºæœ‰æ›´æ–°çš„è¯ï¼Œä½ ä¹Ÿå¯ä»¥å¯¹å…¶ åˆ·æ–° ï¼Œåˆ é™¤ CDN èŠ‚ç‚¹ä¸Šç¼“å­˜çš„èµ„æºï¼Œå½“ç”¨æˆ·è®¿é—®å¯¹åº”çš„èµ„æºæ—¶ç›´æ¥å›æºè·å–æœ€æ–°çš„èµ„æºï¼Œå¹¶é‡æ–°ç¼“å­˜ã€‚\nå¦‚ä½•æ‰¾åˆ°æœ€åˆé€‚çš„ CDN èŠ‚ç‚¹ï¼Ÿ # **GSLB ï¼ˆGlobal Server Load Balanceï¼Œå…¨å±€è´Ÿè½½å‡è¡¡ï¼‰**æ˜¯ CDN çš„å¤§è„‘ï¼Œè´Ÿè´£å¤šä¸ªCDNèŠ‚ç‚¹ä¹‹é—´ç›¸äº’åä½œï¼Œæœ€å¸¸ç”¨çš„æ˜¯åŸºäº DNS çš„ GSLBã€‚\nCDN ä¼šé€šè¿‡ GSLB æ‰¾åˆ°æœ€åˆé€‚çš„ CDN èŠ‚ç‚¹ï¼Œæ›´å…·ä½“ç‚¹æ¥è¯´æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š\næµè§ˆå™¨å‘ DNS æœåŠ¡å™¨å‘é€åŸŸåè¯·æ±‚ï¼› DNS æœåŠ¡å™¨å‘æ ¹æ® CNAME( Canonical Name ) åˆ«åè®°å½•å‘ GSLB å‘é€è¯·æ±‚ï¼› GSLB è¿”å›æ€§èƒ½æœ€å¥½ï¼ˆé€šå¸¸è·ç¦»è¯·æ±‚åœ°å€æœ€è¿‘ï¼‰çš„ CDN èŠ‚ç‚¹ï¼ˆè¾¹ç¼˜æœåŠ¡å™¨ï¼ŒçœŸæ­£ç¼“å­˜å†…å®¹çš„åœ°æ–¹ï¼‰çš„åœ°å€ç»™æµè§ˆå™¨ï¼› æµè§ˆå™¨ç›´æ¥è®¿é—®æŒ‡å®šçš„ CDN èŠ‚ç‚¹ã€‚ ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œä¸Šå›¾å…¶å®åšäº†ä¸€ç‚¹ç®€åŒ–ã€‚GSLB å†…éƒ¨å¯ä»¥çœ‹ä½œæ˜¯ CDN ä¸“ç”¨ DNS æœåŠ¡å™¨å’Œè´Ÿè½½å‡è¡¡ç³»ç»Ÿç»„åˆã€‚CDN ä¸“ç”¨ DNS æœåŠ¡å™¨ä¼šè¿”å›è´Ÿè½½å‡è¡¡ç³»ç»Ÿ IP åœ°å€ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨ä½¿ç”¨ IP åœ°å€è¯·æ±‚è´Ÿè½½å‡è¡¡ç³»ç»Ÿè¿›è€Œæ‰¾åˆ°å¯¹åº”çš„ CDN èŠ‚ç‚¹ã€‚\nGSLB æ˜¯å¦‚ä½•é€‰æ‹©å‡ºæœ€åˆé€‚çš„ CDN èŠ‚ç‚¹å‘¢ï¼Ÿ GSLB ä¼šæ ¹æ®è¯·æ±‚çš„ IP åœ°å€ã€CDN èŠ‚ç‚¹çŠ¶æ€ï¼ˆæ¯”å¦‚è´Ÿè½½æƒ…å†µã€æ€§èƒ½ã€å“åº”æ—¶é—´ã€å¸¦å®½ï¼‰ç­‰æŒ‡æ ‡æ¥ç»¼åˆåˆ¤æ–­å…·ä½“è¿”å›å“ªä¸€ä¸ª CDN èŠ‚ç‚¹çš„åœ°å€ã€‚\nå¦‚ä½•é˜²æ­¢èµ„æºè¢«ç›—åˆ·ï¼Ÿ # å¦‚æœæˆ‘ä»¬çš„èµ„æºè¢«å…¶ä»–ç”¨æˆ·æˆ–è€…ç½‘ç«™éæ³•ç›—åˆ·çš„è¯ï¼Œå°†ä¼šæ˜¯ä¸€ç¬”ä¸å°çš„å¼€æ”¯ã€‚\nè§£å†³è¿™ä¸ªé—®é¢˜æœ€å¸¸ç”¨æœ€ç®€å•çš„åŠæ³•è®¾ç½® Referer é˜²ç›—é“¾ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯æ ¹æ® HTTP è¯·æ±‚çš„å¤´ä¿¡æ¯é‡Œé¢çš„ Referer å­—æ®µå¯¹è¯·æ±‚è¿›è¡Œé™åˆ¶ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ Referer å­—æ®µè·å–åˆ°å½“å‰è¯·æ±‚é¡µé¢çš„æ¥æºé¡µé¢çš„ç½‘ç«™åœ°å€ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½ç¡®å®šè¯·æ±‚æ˜¯å¦æ¥è‡ªåˆæ³•çš„ç½‘ç«™ã€‚\nCDN æœåŠ¡æä¾›å•†å‡ ä¹éƒ½æä¾›äº†è¿™ç§æ¯”è¾ƒåŸºç¡€çš„é˜²ç›—é“¾æœºåˆ¶ã€‚\nä¸è¿‡ï¼Œå¦‚æœç«™ç‚¹çš„é˜²ç›—é“¾é…ç½®å…è®¸ Referer ä¸ºç©ºçš„è¯ï¼Œé€šè¿‡éšè— Refererï¼Œå¯ä»¥ç›´æ¥ç»•å¼€é˜²ç›—é“¾ã€‚\né€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé…åˆå…¶ä»–æœºåˆ¶æ¥ç¡®ä¿é™æ€èµ„æºè¢«ç›—ç”¨ï¼Œä¸€ç§å¸¸ç”¨çš„æœºåˆ¶æ˜¯ æ—¶é—´æˆ³é˜²ç›—é“¾ ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œæ—¶é—´æˆ³é˜²ç›—é“¾ çš„å®‰å…¨æ€§æ›´å¼ºä¸€äº›ã€‚æ—¶é—´æˆ³é˜²ç›—é“¾åŠ å¯†çš„ URL å…·æœ‰æ—¶æ•ˆæ€§ï¼Œè¿‡æœŸä¹‹åå°±æ— æ³•å†è¢«å…è®¸è®¿é—®ã€‚\næ—¶é—´æˆ³é˜²ç›—é“¾çš„ URL é€šå¸¸ä¼šæœ‰ä¸¤ä¸ªå‚æ•°ä¸€ä¸ªæ˜¯ç­¾åå­—ç¬¦ä¸²ï¼Œä¸€ä¸ªæ˜¯è¿‡æœŸæ—¶é—´ã€‚ç­¾åå­—ç¬¦ä¸²ä¸€èˆ¬æ˜¯é€šè¿‡å¯¹ç”¨æˆ·è®¾å®šçš„åŠ å¯†å­—ç¬¦ä¸²ã€è¯·æ±‚è·¯å¾„ã€è¿‡æœŸæ—¶é—´é€šè¿‡ MD5 å“ˆå¸Œç®—æ³•å–å“ˆå¸Œçš„æ–¹å¼è·å¾—ã€‚\næ³¨æ„ï¼Œè¿™ä¸ªç”¨æˆ·è®¾å®šçš„åŠ å¯†å­—ç¬¦ä¸²ï¼Œæ˜¯åœ¨åå°é…ç½®çš„ï¼Œè€Œç­¾åæ˜¯åå°ç»™å‰ç«¯çš„\nï¼ˆ1ï¼‰ç”¨æˆ·ç®¡ç†å‘˜åœ¨ä¸ƒç‰› CDN æ§åˆ¶å° é…ç½® key ï¼Œå¹¶å°† keyé…ç½®è¿›ä¸šåŠ¡æœåŠ¡å™¨ã€‚ ï¼ˆ2ï¼‰å½“å®¢æˆ·ç«¯è¯·æ±‚èµ„æºæ—¶ï¼Œå°†åŸå§‹ url å‘é€è‡³ä¸šåŠ¡æœåŠ¡å™¨ã€‚ ï¼ˆ3ï¼‰ä¸šåŠ¡æœåŠ¡å™¨æ ¹æ®è®¡ç®—é€»è¾‘ï¼Œå°†å¸¦æœ‰æ—¶é—´æˆ³ç­¾åçš„ url è¿”å›è‡³å®¢æˆ·ç«¯ã€‚ ï¼ˆ4ï¼‰å®¢æˆ·ç«¯ä½¿ç”¨å¸¦æœ‰æ—¶é—´æˆ³ç­¾åçš„ url è¯·æ±‚èµ„æºã€‚ ï¼ˆ5ï¼‰CDN æ£€æŸ¥ url ç­¾åçš„åˆæ³•æ€§ã€‚\næ—¶é—´æˆ³é˜²ç›—é“¾ URLç¤ºä¾‹ï¼š\nhttp://cdn.wangsu.com/4/123.mp3? wsSecret=79aead3bd7b5db4adeffb93a010298b5\u0026amp;wsTime=1601026312 wsSecret ï¼šç­¾åå­—ç¬¦ä¸²ã€‚ wsTime: è¿‡æœŸæ—¶é—´ã€‚ æ—¶é—´æˆ³é˜²ç›—é“¾çš„å®ç°ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå¹¶ä¸”å¯é æ€§è¾ƒé«˜ï¼Œæ¨èä½¿ç”¨ã€‚å¹¶ä¸”ï¼Œç»å¤§éƒ¨åˆ† CDN æœåŠ¡æä¾›å•†éƒ½æä¾›äº†å¼€ç®±å³ç”¨çš„æ—¶é—´æˆ³é˜²ç›—é“¾æœºåˆ¶ã€‚\né™¤äº† Referer é˜²ç›—é“¾å’Œæ—¶é—´æˆ³é˜²ç›—é“¾ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥ IP é»‘ç™½åå•é…ç½®ã€IP è®¿é—®é™é¢‘é…ç½®ç­‰æœºåˆ¶æ¥é˜²ç›—åˆ·ã€‚\næ€»ç»“ # CDN å°±æ˜¯å°†é™æ€èµ„æºåˆ†å‘åˆ°å¤šä¸ªä¸åŒçš„åœ°æ–¹ä»¥å®ç°å°±è¿‘è®¿é—®ï¼Œè¿›è€ŒåŠ å¿«é™æ€èµ„æºçš„è®¿é—®é€Ÿåº¦ï¼Œå‡è½»æœåŠ¡å™¨ä»¥åŠå¸¦å®½çš„è´Ÿæ‹…ã€‚ åŸºäºæˆæœ¬ã€ç¨³å®šæ€§å’Œæ˜“ç”¨æ€§è€ƒè™‘ï¼Œå»ºè®®ç›´æ¥é€‰æ‹©ä¸“ä¸šçš„äº‘å‚å•†ï¼ˆæ¯”å¦‚é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€åä¸ºäº‘ã€é’äº‘ï¼‰æˆ–è€… CDN å‚å•†ï¼ˆæ¯”å¦‚ç½‘å®¿ã€è“æ±›ï¼‰æä¾›çš„å¼€ç®±å³ç”¨çš„ CDN æœåŠ¡ã€‚ GSLB ï¼ˆGlobal Server Load Balanceï¼Œå…¨å±€è´Ÿè½½å‡è¡¡ï¼‰æ˜¯ CDN çš„å¤§è„‘ï¼Œè´Ÿè´£å¤šä¸ª CDN èŠ‚ç‚¹ä¹‹é—´ç›¸äº’åä½œï¼Œæœ€å¸¸ç”¨çš„æ˜¯åŸºäº DNS çš„ GSLBã€‚CDN ä¼šé€šè¿‡ GSLB æ‰¾åˆ°æœ€åˆé€‚çš„ CDN èŠ‚ç‚¹ã€‚ ä¸ºäº†é˜²æ­¢é™æ€èµ„æºè¢«ç›—ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Referer é˜²ç›—é“¾ + æ—¶é—´æˆ³é˜²ç›—é“¾ ã€‚ å‚è€ƒ # æ—¶é—´æˆ³é˜²ç›—é“¾ - ä¸ƒç‰›äº‘ CDNï¼šhttps://developer.qiniu.com/fusion/kb/1670/timestamp-hotlinking-prevention CDNæ˜¯ä¸ªå•¥ç©æ„ï¼Ÿä¸€æ–‡è¯´ä¸ªæ˜ç™½ï¼šhttps://mp.weixin.qq.com/s/Pp0C8ALUXsmYCUkM5QnkQw ã€Šé€è§† HTTP åè®®ã€‹- 37 | CDNï¼šåŠ é€Ÿæˆ‘ä»¬çš„ç½‘ç»œæœåŠ¡ï¼šhttp://gk.link/a/11yOG "},{"id":79,"href":"/zh/docs/study/Review/java_guide/lyely_high-performance/ly01ly_read-and-write-separation-and-library-subtable/","title":"æ•°æ®åº“è¯»å†™åˆ†ç¦»\u0026åˆ†åº“åˆ†è¡¨è¯¦è§£","section":"é«˜æ€§èƒ½","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nè¯»å†™åˆ†ç¦» # ä»€ä¹ˆæ˜¯è¯»å†™åˆ†ç¦»ï¼Ÿ # è§åæ€æ„ï¼Œæ ¹æ®è¯»å†™åˆ†ç¦»çš„åå­—ï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ï¼šè¯»å†™åˆ†ç¦»ä¸»è¦æ˜¯ä¸ºäº†å°†å¯¹æ•°æ®åº“çš„è¯»å†™æ“ä½œåˆ†æ•£åˆ°ä¸åŒçš„æ•°æ®åº“èŠ‚ç‚¹ä¸Šã€‚ è¿™æ ·çš„è¯ï¼Œå°±èƒ½å¤Ÿå°å¹…æå‡å†™æ€§èƒ½ï¼Œå¤§å¹…æå‡è¯»æ€§èƒ½ã€‚\næˆ‘ç®€å•ç”»äº†ä¸€å¼ å›¾æ¥å¸®åŠ©ä¸å¤ªæ¸…æ¥šè¯»å†™åˆ†ç¦»çš„å°ä¼™ä¼´ç†è§£ã€‚\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½ä¼šé€‰æ‹©ä¸€ä¸»å¤šä»ï¼Œä¹Ÿå°±æ˜¯ä¸€å°ä¸»æ•°æ®åº“è´Ÿè´£å†™ï¼Œå…¶ä»–çš„ä»æ•°æ®åº“è´Ÿè´£è¯»ã€‚ä¸»åº“å’Œä»åº“ä¹‹é—´ä¼šè¿›è¡Œæ•°æ®åŒæ­¥ï¼Œä»¥ä¿è¯ä»åº“ä¸­æ•°æ®çš„å‡†ç¡®æ€§ã€‚è¿™æ ·çš„æ¶æ„å®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œå¹¶ä¸”ä¹Ÿç¬¦åˆç³»ç»Ÿçš„å†™å°‘è¯»å¤šçš„ç‰¹ç‚¹ã€‚\nè¯»å†™åˆ†ç¦»ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ # è¯»å†™åˆ†ç¦»å¯¹äºæå‡æ•°æ®åº“çš„å¹¶å‘éå¸¸æœ‰æ•ˆï¼Œä½†æ˜¯ï¼ŒåŒæ—¶ä¹Ÿä¼šå¼•æ¥ä¸€ä¸ªé—®é¢˜ï¼šä¸»åº“å’Œä»åº“çš„æ•°æ®å­˜åœ¨å»¶è¿Ÿï¼Œæ¯”å¦‚ä½ å†™å®Œä¸»åº“ä¹‹åï¼Œä¸»åº“çš„æ•°æ®åŒæ­¥åˆ°ä»åº“æ˜¯éœ€è¦æ—¶é—´çš„ï¼Œè¿™ä¸ªæ—¶é—´å·®å°±å¯¼è‡´äº†ä¸»åº“å’Œä»åº“çš„æ•°æ®ä¸ä¸€è‡´æ€§é—®é¢˜ã€‚è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸è¯´çš„ ä¸»ä»åŒæ­¥å»¶è¿Ÿ ã€‚\nä¸»ä»åŒæ­¥å»¶è¿Ÿé—®é¢˜çš„è§£å†³ï¼Œæ²¡æœ‰ç‰¹åˆ«å¥½çš„ä¸€ç§æ–¹æ¡ˆï¼ˆå¯èƒ½æ˜¯æˆ‘å¤ªèœäº†ï¼Œæ¬¢è¿è¯„è®ºåŒºè¡¥å……ï¼‰ã€‚ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡åœºæ™¯ï¼Œå‚è€ƒä¸€ä¸‹ä¸‹é¢å‡ ç§è§£å†³åŠæ³•ã€‚\n1.å¼ºåˆ¶å°†è¯»è¯·æ±‚è·¯ç”±åˆ°ä¸»åº“å¤„ç†ã€‚\næ—¢ç„¶ä½ ä»åº“çš„æ•°æ®è¿‡æœŸäº†ï¼Œé‚£æˆ‘å°±ç›´æ¥ä»ä¸»åº“è¯»å–å˜›ï¼è¿™ç§æ–¹æ¡ˆè™½ç„¶ä¼šå¢åŠ ä¸»åº“çš„å‹åŠ›ï¼Œä½†æ˜¯ï¼Œå®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä¹Ÿæ˜¯æˆ‘äº†è§£åˆ°çš„ä½¿ç”¨æœ€å¤šçš„ä¸€ç§æ–¹å¼ã€‚\næ¯”å¦‚ Sharding-JDBC å°±æ˜¯é‡‡ç”¨çš„è¿™ç§æ–¹æ¡ˆã€‚é€šè¿‡ä½¿ç”¨ Sharding-JDBC çš„ HintManager åˆ†ç‰‡é”®å€¼ç®¡ç†å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å¼ºåˆ¶ä½¿ç”¨ä¸»åº“ã€‚\nHintManager hintManager = HintManager.getInstance(); hintManager.setMasterRouteOnly(); // ç»§ç»­JDBCæ“ä½œ å¯¹äºè¿™ç§æ–¹æ¡ˆï¼Œä½ å¯ä»¥å°†é‚£äº›å¿…é¡»è·å–æœ€æ–°æ•°æ®çš„è¯»è¯·æ±‚éƒ½äº¤ç»™ä¸»åº“å¤„ç†ã€‚\n2.å»¶è¿Ÿè¯»å–ã€‚\nè¿˜æœ‰ä¸€äº›æœ‹å‹è‚¯å®šä¼šæƒ³æ—¢ç„¶ä¸»ä»åŒæ­¥å­˜åœ¨å»¶è¿Ÿï¼Œé‚£æˆ‘å°±åœ¨å»¶è¿Ÿä¹‹åè¯»å–å•Šï¼Œæ¯”å¦‚ä¸»ä»åŒæ­¥å»¶è¿Ÿ 0.5s,é‚£æˆ‘å°± 1s ä¹‹åå†è¯»å–æ•°æ®ã€‚è¿™æ ·å¤šæ–¹ä¾¿å•Šï¼æ–¹ä¾¿æ˜¯æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿå¾ˆæ‰¯æ·¡ã€‚\nä¸è¿‡ï¼Œå¦‚æœä½ æ˜¯è¿™æ ·è®¾è®¡ä¸šåŠ¡æµç¨‹å°±ä¼šå¥½å¾ˆå¤šï¼šå¯¹äºä¸€äº›å¯¹æ•°æ®æ¯”è¾ƒæ•æ„Ÿçš„åœºæ™¯ï¼Œä½ å¯ä»¥åœ¨å®Œæˆå†™è¯·æ±‚ä¹‹åï¼Œé¿å…ç«‹å³è¿›è¡Œè¯·æ±‚æ“ä½œã€‚æ¯”å¦‚ä½ æ”¯ä»˜æˆåŠŸä¹‹åï¼Œè·³è½¬åˆ°ä¸€ä¸ªæ”¯ä»˜æˆåŠŸçš„é¡µé¢ï¼Œå½“ä½ ç‚¹å‡»è¿”å›ä¹‹åæ‰è¿”å›è‡ªå·±çš„è´¦æˆ·ã€‚\nå¦å¤–ï¼Œã€ŠMySQL å®æˆ˜ 45 è®²ã€‹è¿™ä¸ªä¸“æ ä¸­çš„ã€Šè¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘ï¼Ÿã€‹è¿™ç¯‡æ–‡ç« è¿˜ä»‹ç»äº†å¾ˆå¤šå…¶ä»–æ¯”è¾ƒå®é™…çš„è§£å†³åŠæ³•ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œç ”ç©¶ä¸€ä¸‹ã€‚\nå¦‚ä½•å®ç°è¯»å†™åˆ†ç¦»ï¼Ÿ # ä¸è®ºæ˜¯ä½¿ç”¨å“ªä¸€ç§è¯»å†™åˆ†ç¦»å…·ä½“çš„å®ç°æ–¹æ¡ˆï¼Œæƒ³è¦å®ç°è¯»å†™åˆ†ç¦»ä¸€èˆ¬åŒ…å«å¦‚ä¸‹å‡ æ­¥ï¼š\néƒ¨ç½²å¤šå°æ•°æ®åº“ï¼Œé€‰æ‹©å…¶ä¸­çš„ä¸€å°ä½œä¸ºä¸»æ•°æ®åº“ï¼Œå…¶ä»–çš„ä¸€å°æˆ–è€…å¤šå°ä½œä¸ºä»æ•°æ®åº“ã€‚ ä¿è¯ä¸»æ•°æ®åº“å’Œä»æ•°æ®åº“ä¹‹é—´çš„æ•°æ®æ˜¯å®æ—¶åŒæ­¥çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ä¸»ä»å¤åˆ¶ã€‚ ç³»ç»Ÿå°†å†™è¯·æ±‚äº¤ç»™ä¸»æ•°æ®åº“å¤„ç†ï¼Œè¯»è¯·æ±‚äº¤ç»™ä»æ•°æ®åº“å¤„ç†ã€‚[ ä½¿ç”¨ä¸Š ] è½å®åˆ°é¡¹ç›®æœ¬èº«çš„è¯ï¼Œå¸¸ç”¨çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š\n1.ä»£ç†æ–¹å¼\næˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨å’Œæ•°æ®ä¸­é—´åŠ äº†ä¸€ä¸ªä»£ç†å±‚ã€‚åº”ç”¨ç¨‹åºæ‰€æœ‰çš„æ•°æ®è¯·æ±‚éƒ½äº¤ç»™ä»£ç†å±‚å¤„ç†ï¼Œä»£ç†å±‚è´Ÿè´£åˆ†ç¦»è¯»å†™è¯·æ±‚ï¼Œå°†å®ƒä»¬è·¯ç”±åˆ°å¯¹åº”çš„æ•°æ®åº“ä¸­ã€‚\næä¾›ç±»ä¼¼åŠŸèƒ½çš„ä¸­é—´ä»¶æœ‰ MySQL Routerï¼ˆå®˜æ–¹ï¼‰ã€Atlasï¼ˆåŸºäº MySQL Proxyï¼‰ã€Maxscaleã€MyCatã€‚\n2.ç»„ä»¶æ–¹å¼\nåœ¨è¿™ç§æ–¹å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¼•å…¥ç¬¬ä¸‰æ–¹ç»„ä»¶æ¥å¸®åŠ©æˆ‘ä»¬è¯»å†™è¯·æ±‚ã€‚\nè¿™ä¹Ÿæ˜¯æˆ‘æ¯”è¾ƒæ¨èçš„ä¸€ç§æ–¹å¼ã€‚è¿™ç§æ–¹å¼ç›®å‰åœ¨å„ç§äº’è”ç½‘å…¬å¸ä¸­ç”¨çš„æœ€å¤šçš„ï¼Œç›¸å…³çš„å®é™…çš„æ¡ˆä¾‹ä¹Ÿéå¸¸å¤šã€‚å¦‚æœä½ è¦é‡‡ç”¨è¿™ç§æ–¹å¼çš„è¯ï¼Œæ¨èä½¿ç”¨ sharding-jdbc ï¼Œç›´æ¥å¼•å…¥ jar åŒ…å³å¯ä½¿ç”¨ï¼Œéå¸¸æ–¹ä¾¿ã€‚åŒæ—¶ï¼Œä¹ŸèŠ‚çœäº†å¾ˆå¤šè¿ç»´çš„æˆæœ¬ã€‚\nä½ å¯ä»¥åœ¨ shardingsphere å®˜æ–¹æ‰¾åˆ° sharding-jdbc å…³äºè¯»å†™åˆ†ç¦»çš„æ“ä½œã€‚\nä¸»ä»å¤åˆ¶åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ # MySQL binlog(binary log å³äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶) ä¸»è¦è®°å½•äº† MySQL æ•°æ®åº“ä¸­æ•°æ®çš„æ‰€æœ‰å˜åŒ–(æ•°æ®åº“æ‰§è¡Œçš„æ‰€æœ‰ DDL å’Œ DML è¯­å¥)ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ ¹æ®ä¸»åº“çš„ MySQL binlog æ—¥å¿—å°±èƒ½å¤Ÿå°†ä¸»åº“çš„æ•°æ®åŒæ­¥åˆ°ä»åº“ä¸­ã€‚\næ›´å…·ä½“å’Œè¯¦ç»†çš„è¿‡ç¨‹æ˜¯è¿™ä¸ªæ ·å­çš„ï¼ˆå›¾ç‰‡æ¥è‡ªäºï¼šã€ŠMySQL Master-Slave Replication on the Same Machineã€‹ï¼‰ï¼š\nä¸»åº“å°†æ•°æ®åº“ä¸­æ•°æ®çš„å˜åŒ–å†™å…¥åˆ° binlog ä»åº“è¿æ¥ä¸»åº“ ä»åº“ä¼šåˆ›å»ºä¸€ä¸ª I/O çº¿ç¨‹å‘ä¸»åº“è¯·æ±‚æ›´æ–°çš„ binlog ä¸»åº“ä¼šåˆ›å»ºä¸€ä¸ª binlog dump çº¿ç¨‹æ¥å‘é€ binlog ï¼Œä»åº“ä¸­çš„ I/O çº¿ç¨‹è´Ÿè´£æ¥æ”¶ ä»åº“çš„ I/O çº¿ç¨‹å°†æ¥æ”¶çš„ binlog å†™å…¥åˆ° relay log ä¸­ã€‚ ä»åº“çš„ SQL çº¿ç¨‹è¯»å– relay log åŒæ­¥æ•°æ®æœ¬åœ°ï¼ˆä¹Ÿå°±æ˜¯å†æ‰§è¡Œä¸€é SQL ï¼‰ã€‚ æ€ä¹ˆæ ·ï¼Ÿçœ‹äº†æˆ‘å¯¹ä¸»ä»å¤åˆ¶è¿™ä¸ªè¿‡ç¨‹çš„è®²è§£ï¼Œä½ åº”è¯¥ææ˜ç™½äº†å§!\nä½ ä¸€èˆ¬çœ‹åˆ° binlog å°±è¦æƒ³åˆ°ä¸»ä»å¤åˆ¶ã€‚å½“ç„¶ï¼Œé™¤äº†ä¸»ä»å¤åˆ¶ä¹‹å¤–ï¼Œbinlog è¿˜èƒ½å¸®åŠ©æˆ‘ä»¬å®ç°æ•°æ®æ¢å¤ã€‚\nğŸŒˆ æ‹“å±•ä¸€ä¸‹ï¼š\nä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰ä½¿ç”¨è¿‡é˜¿é‡Œå¼€æºçš„ä¸€ä¸ªå«åš canal çš„å·¥å…·ã€‚è¿™ä¸ªå·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç° MySQL å’Œå…¶ä»–æ•°æ®æºæ¯”å¦‚ Elasticsearch æˆ–è€…å¦å¤–ä¸€å° MySQL æ•°æ®åº“ä¹‹é—´çš„æ•°æ®åŒæ­¥ã€‚å¾ˆæ˜¾ç„¶ï¼Œè¿™ä¸ªå·¥å…·çš„åº•å±‚åŸç†è‚¯å®šä¹Ÿæ˜¯ä¾èµ– binlogã€‚canal çš„åŸç†å°±æ˜¯æ¨¡æ‹Ÿ MySQL ä¸»ä»å¤åˆ¶çš„è¿‡ç¨‹ï¼Œè§£æ binlog å°†æ•°æ®åŒæ­¥åˆ°å…¶ä»–çš„æ•°æ®æºã€‚\nå¦å¤–ï¼Œåƒå’±ä»¬å¸¸ç”¨çš„åˆ†å¸ƒå¼ç¼“å­˜ç»„ä»¶ Redis ä¹Ÿæ˜¯é€šè¿‡ä¸»ä»å¤åˆ¶å®ç°çš„è¯»å†™åˆ†ç¦»ã€‚\nğŸŒ• ç®€å•æ€»ç»“ä¸€ä¸‹ï¼š\nMySQL ä¸»ä»å¤åˆ¶æ˜¯ä¾èµ–äº binlog ã€‚å¦å¤–ï¼Œå¸¸è§çš„ä¸€äº›åŒæ­¥ MySQL æ•°æ®åˆ°å…¶ä»–æ•°æ®æºçš„å·¥å…·ï¼ˆæ¯”å¦‚ canalï¼‰çš„åº•å±‚ä¸€èˆ¬ä¹Ÿæ˜¯ä¾èµ– binlog ã€‚\nåˆ†åº“åˆ†è¡¨ # è¯»å†™åˆ†ç¦»ä¸»è¦åº”å¯¹çš„æ˜¯æ•°æ®åº“è¯»å¹¶å‘ï¼Œæ²¡æœ‰è§£å†³æ•°æ®åº“å­˜å‚¨é—®é¢˜ã€‚è¯•æƒ³ä¸€ä¸‹ï¼šå¦‚æœ MySQL ä¸€å¼ è¡¨çš„æ•°æ®é‡è¿‡å¤§æ€ä¹ˆåŠ?\næ¢è¨€ä¹‹ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•è§£å†³ MySQL çš„å­˜å‚¨å‹åŠ›å‘¢ï¼Ÿ\nç­”æ¡ˆä¹‹ä¸€å°±æ˜¯ åˆ†åº“åˆ†è¡¨ã€‚\nä»€ä¹ˆæ˜¯åˆ†åº“ï¼Ÿ # åˆ†åº“ å°±æ˜¯å°†æ•°æ®åº“ä¸­çš„æ•°æ®åˆ†æ•£åˆ°ä¸åŒçš„æ•°æ®åº“ä¸Šï¼Œå¯ä»¥å‚ç›´åˆ†åº“ï¼Œä¹Ÿå¯ä»¥æ°´å¹³åˆ†åº“ã€‚\nå‚ç›´åˆ†åº“ å°±æ˜¯æŠŠå•ä¸€æ•°æ®åº“æŒ‰ç…§ä¸šåŠ¡è¿›è¡Œåˆ’åˆ†ï¼Œä¸åŒçš„ä¸šåŠ¡ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“ï¼Œè¿›è€Œå°†ä¸€ä¸ªæ•°æ®åº“çš„å‹åŠ›åˆ†æ‹…åˆ°å¤šä¸ªæ•°æ®åº“ã€‚\nä¸¾ä¸ªä¾‹å­ï¼šè¯´ä½ å°†æ•°æ®åº“ä¸­çš„ç”¨æˆ·è¡¨ã€è®¢å•è¡¨å’Œå•†å“è¡¨åˆ†åˆ«å•ç‹¬æ‹†åˆ†ä¸ºç”¨æˆ·æ•°æ®åº“ã€è®¢å•æ•°æ®åº“å’Œå•†å“æ•°æ®åº“ã€‚\næ°´å¹³åˆ†åº“ æ˜¯æŠŠåŒä¸€ä¸ªè¡¨æŒ‰ä¸€å®šè§„åˆ™æ‹†åˆ†åˆ°ä¸åŒçš„æ•°æ®åº“ä¸­ï¼Œæ¯ä¸ªåº“å¯ä»¥ä½äºä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·å°±å®ç°äº†æ°´å¹³æ‰©å±•ï¼Œè§£å†³äº†å•è¡¨çš„å­˜å‚¨å’Œæ€§èƒ½ç“¶é¢ˆçš„é—®é¢˜ã€‚\nä¸¾ä¸ªä¾‹å­ï¼šè®¢å•è¡¨æ•°æ®é‡å¤ªå¤§ï¼Œä½ å¯¹è®¢å•è¡¨è¿›è¡Œäº†æ°´å¹³åˆ‡åˆ†ï¼ˆæ°´å¹³åˆ†è¡¨ï¼‰ï¼Œç„¶åå°†åˆ‡åˆ†åçš„ 2 å¼ è®¢å•è¡¨åˆ†åˆ«æ”¾åœ¨ä¸¤ä¸ªä¸åŒçš„æ•°æ®åº“ã€‚\nä»€ä¹ˆæ˜¯åˆ†è¡¨ï¼Ÿ # åˆ†è¡¨ å°±æ˜¯å¯¹å•è¡¨çš„æ•°æ®è¿›è¡Œæ‹†åˆ†ï¼Œå¯ä»¥æ˜¯å‚ç›´æ‹†åˆ†ï¼Œä¹Ÿå¯ä»¥æ˜¯æ°´å¹³æ‹†åˆ†ã€‚\nå‚ç›´åˆ†è¡¨ æ˜¯å¯¹æ•°æ®è¡¨åˆ—çš„æ‹†åˆ†ï¼ŒæŠŠä¸€å¼ åˆ—æ¯”è¾ƒå¤šçš„è¡¨æ‹†åˆ†ä¸ºå¤šå¼ è¡¨ã€‚\nä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯è¡¨ä¸­çš„ä¸€äº›åˆ—å•ç‹¬æŠ½å‡ºæ¥ä½œä¸ºä¸€ä¸ªè¡¨ã€‚\næ°´å¹³åˆ†è¡¨ æ˜¯å¯¹æ•°æ®è¡¨è¡Œçš„æ‹†åˆ†ï¼ŒæŠŠä¸€å¼ è¡Œæ¯”è¾ƒå¤šçš„è¡¨æ‹†åˆ†ä¸ºå¤šå¼ è¡¨ï¼Œå¯ä»¥è§£å†³å•ä¸€è¡¨æ•°æ®é‡è¿‡å¤§çš„é—®é¢˜ã€‚\nä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯è¡¨æ‹†åˆ†æˆå¤šä¸ªç”¨æˆ·ä¿¡æ¯è¡¨ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å•ä¸€è¡¨æ•°æ®é‡è¿‡å¤§å¯¹æ€§èƒ½é€ æˆå½±å“ã€‚\næ°´å¹³æ‹†åˆ†åªèƒ½è§£å†³å•è¡¨æ•°æ®é‡å¤§çš„é—®é¢˜ï¼Œä¸ºäº†æå‡æ€§èƒ½ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé€‰æ‹©å°†æ‹†åˆ†åçš„å¤šå¼ è¡¨æ”¾åœ¨ä¸åŒçš„æ•°æ®åº“ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ°´å¹³åˆ†è¡¨é€šå¸¸å’Œæ°´å¹³åˆ†åº“åŒæ—¶å‡ºç°ã€‚\nä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦åˆ†åº“åˆ†è¡¨ï¼Ÿ # é‡åˆ°ä¸‹é¢å‡ ç§åœºæ™¯å¯ä»¥è€ƒè™‘åˆ†åº“åˆ†è¡¨ï¼š\nå•è¡¨çš„æ•°æ®è¾¾åˆ°åƒä¸‡çº§åˆ«ä»¥ä¸Šï¼Œæ•°æ®åº“è¯»å†™é€Ÿåº¦æ¯”è¾ƒç¼“æ…¢ã€‚ æ•°æ®åº“ä¸­çš„æ•°æ®å ç”¨çš„ç©ºé—´è¶Šæ¥è¶Šå¤§ï¼Œå¤‡ä»½æ—¶é—´è¶Šæ¥è¶Šé•¿ã€‚ åº”ç”¨çš„å¹¶å‘é‡å¤ªå¤§ã€‚ å¸¸è§çš„åˆ†ç‰‡ç®—æ³•æœ‰å“ªäº›ï¼Ÿ # åˆ†ç‰‡ç®—æ³•ä¸»è¦è§£å†³äº†æ•°æ®è¢«æ°´å¹³åˆ†ç‰‡ä¹‹åï¼Œæ•°æ®ç©¶ç«Ÿè¯¥å­˜æ”¾åœ¨å“ªä¸ªè¡¨çš„é—®é¢˜ã€‚\nå“ˆå¸Œåˆ†ç‰‡ ï¼šæ±‚æŒ‡å®š keyï¼ˆæ¯”å¦‚ idï¼‰ çš„å“ˆå¸Œï¼Œç„¶åæ ¹æ®å“ˆå¸Œå€¼ç¡®å®šæ•°æ®åº”è¢«æ”¾ç½®åœ¨å“ªä¸ªè¡¨ä¸­ã€‚å“ˆå¸Œåˆ†ç‰‡æ¯”è¾ƒé€‚åˆéšæœºè¯»å†™çš„åœºæ™¯ï¼Œä¸å¤ªé€‚åˆç»å¸¸éœ€è¦èŒƒå›´æŸ¥è¯¢çš„åœºæ™¯ã€‚ èŒƒå›´åˆ†ç‰‡ ï¼šæŒ‰ç…§ç‰¹æ€§çš„èŒƒå›´åŒºé—´ï¼ˆæ¯”å¦‚æ—¶é—´åŒºé—´ã€IDåŒºé—´ï¼‰æ¥åˆ†é…æ•°æ®ï¼Œæ¯”å¦‚ å°† id ä¸º 1~299999 çš„è®°å½•åˆ†åˆ°ç¬¬ä¸€ä¸ªåº“ï¼Œ 300000~599999 çš„åˆ†åˆ°ç¬¬äºŒä¸ªåº“ã€‚èŒƒå›´åˆ†ç‰‡é€‚åˆéœ€è¦ç»å¸¸è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾çš„åœºæ™¯ï¼Œä¸å¤ªé€‚åˆéšæœºè¯»å†™çš„åœºæ™¯ï¼ˆæ•°æ®æœªè¢«åˆ†æ•£ï¼Œå®¹æ˜“å‡ºç°çƒ­ç‚¹æ•°æ®çš„é—®é¢˜ï¼‰ã€‚ åœ°ç†ä½ç½®åˆ†ç‰‡ ï¼šå¾ˆå¤š NewSQL æ•°æ®åº“éƒ½æ”¯æŒåœ°ç†ä½ç½®åˆ†ç‰‡ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯æ ¹æ®åœ°ç†ä½ç½®ï¼ˆå¦‚åŸå¸‚ã€åœ°åŸŸï¼‰æ¥åˆ†é…æ•°æ®ã€‚ èåˆç®—æ³• ï¼šçµæ´»ç»„åˆå¤šç§åˆ†ç‰‡ç®—æ³•ï¼Œæ¯”å¦‚å°†å“ˆå¸Œåˆ†ç‰‡å’ŒèŒƒå›´åˆ†ç‰‡ç»„åˆã€‚ \u0026hellip;\u0026hellip; åˆ†åº“åˆ†è¡¨ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ # è®°ä½ï¼Œä½ åœ¨å…¬å¸åšçš„ä»»ä½•æŠ€æœ¯å†³ç­–ï¼Œä¸å…‰æ˜¯è¦è€ƒè™‘è¿™ä¸ªæŠ€æœ¯èƒ½ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ï¼Œæ˜¯å¦é€‚åˆå½“å‰ä¸šåŠ¡åœºæ™¯ï¼Œè¿˜è¦é‡ç‚¹è€ƒè™‘å…¶å¸¦æ¥çš„æˆæœ¬ã€‚\nå¼•å…¥åˆ†åº“åˆ†è¡¨ä¹‹åï¼Œä¼šç»™ç³»ç»Ÿå¸¦æ¥ä»€ä¹ˆæŒ‘æˆ˜å‘¢ï¼Ÿ\njoin æ“ä½œ ï¼š åŒä¸€ä¸ªæ•°æ®åº“ä¸­çš„è¡¨åˆ†å¸ƒåœ¨äº†ä¸åŒçš„æ•°æ®åº“ä¸­ï¼Œå¯¼è‡´æ— æ³•ä½¿ç”¨ join æ“ä½œã€‚è¿™æ ·å°±å¯¼è‡´æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è¿›è¡Œæ•°æ®çš„å°è£…ï¼Œæ¯”å¦‚ä½ åœ¨ä¸€ä¸ªæ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°ä¸€ä¸ªæ•°æ®ä¹‹åï¼Œå†æ ¹æ®è¿™ä¸ªæ•°æ®å»å¦å¤–ä¸€ä¸ªæ•°æ®åº“ä¸­æ‰¾å¯¹åº”çš„æ•°æ®ã€‚ äº‹åŠ¡é—®é¢˜ ï¼šåŒä¸€ä¸ªæ•°æ®åº“ä¸­çš„è¡¨åˆ†å¸ƒåœ¨äº†ä¸åŒçš„æ•°æ®åº“ä¸­ï¼Œå¦‚æœå•ä¸ªæ“ä½œæ¶‰åŠåˆ°å¤šä¸ªæ•°æ®åº“ï¼Œé‚£ä¹ˆæ•°æ®åº“è‡ªå¸¦çš„äº‹åŠ¡å°±æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚äº†ã€‚ åˆ†å¸ƒå¼ id ï¼šåˆ†åº“ä¹‹åï¼Œ æ•°æ®éå¸ƒåœ¨ä¸åŒæœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“ï¼Œæ•°æ®åº“çš„è‡ªå¢ä¸»é”®å·²ç»æ²¡åŠæ³•æ»¡è¶³ç”Ÿæˆçš„ä¸»é”®å”¯ä¸€äº†ã€‚æˆ‘ä»¬å¦‚ä½•ä¸ºä¸åŒçš„æ•°æ®èŠ‚ç‚¹ç”Ÿæˆå…¨å±€å”¯ä¸€ä¸»é”®å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸ºæˆ‘ä»¬çš„ç³»ç»Ÿå¼•å…¥åˆ†å¸ƒå¼ id äº†ã€‚ \u0026hellip;\u0026hellip; å¦å¤–ï¼Œå¼•å…¥åˆ†åº“åˆ†è¡¨ä¹‹åï¼Œä¸€èˆ¬éœ€è¦ DBA çš„å‚ä¸ï¼ŒåŒæ—¶è¿˜éœ€è¦æ›´å¤šçš„æ•°æ®åº“æœåŠ¡å™¨ï¼Œè¿™äº›éƒ½å±äºæˆæœ¬ã€‚\nåˆ†åº“åˆ†è¡¨æœ‰æ²¡æœ‰ä»€ä¹ˆæ¯”è¾ƒæ¨èçš„æ–¹æ¡ˆï¼Ÿ # ShardingSphere é¡¹ç›®ï¼ˆåŒ…æ‹¬ Sharding-JDBCã€Sharding-Proxy å’Œ Sharding-Sidecarï¼‰æ˜¯å½“å½“æå…¥ Apache çš„ï¼Œç›®å‰ä¸»è¦ç”±äº¬ä¸œæ•°ç§‘çš„ä¸€äº›å·¨ä½¬ç»´æŠ¤ã€‚\nShardingSphere ç»å¯¹å¯ä»¥è¯´æ˜¯å½“å‰åˆ†åº“åˆ†è¡¨çš„é¦–é€‰ï¼ShardingSphere çš„åŠŸèƒ½å®Œå–„ï¼Œé™¤äº†æ”¯æŒè¯»å†™åˆ†ç¦»å’Œåˆ†åº“åˆ†è¡¨ï¼Œè¿˜æä¾›åˆ†å¸ƒå¼äº‹åŠ¡ã€æ•°æ®åº“æ²»ç†ç­‰åŠŸèƒ½ã€‚\nå¦å¤–ï¼ŒShardingSphere çš„ç”Ÿæ€ä½“ç³»å®Œå–„ï¼Œç¤¾åŒºæ´»è·ƒï¼Œæ–‡æ¡£å®Œå–„ï¼Œæ›´æ–°å’Œå‘å¸ƒæ¯”è¾ƒé¢‘ç¹ã€‚\nè‰¿è‰¿ä¹‹å‰å†™äº†ä¸€ç¯‡åˆ†åº“åˆ†è¡¨çš„å®æˆ˜æ–‡ç« ï¼Œå„ä½æœ‹å‹å¯ä»¥çœ‹çœ‹ï¼šã€ŠèŠ‹é“ Spring Boot åˆ†åº“åˆ†è¡¨å…¥é—¨ã€‹ ã€‚\nåˆ†åº“åˆ†è¡¨åï¼Œæ•°æ®æ€ä¹ˆè¿ç§»å‘¢ï¼Ÿ # åˆ†åº“åˆ†è¡¨ä¹‹åï¼Œæˆ‘ä»¬å¦‚ä½•å°†è€åº“ï¼ˆå•åº“å•è¡¨ï¼‰çš„æ•°æ®è¿ç§»åˆ°æ–°åº“ï¼ˆåˆ†åº“åˆ†è¡¨åçš„æ•°æ®åº“ç³»ç»Ÿï¼‰å‘¢ï¼Ÿ\næ¯”è¾ƒç®€å•åŒæ—¶ä¹Ÿæ˜¯éå¸¸å¸¸ç”¨çš„æ–¹æ¡ˆå°±æ˜¯åœæœºè¿ç§»ï¼Œå†™ä¸ªè„šæœ¬è€åº“çš„æ•°æ®å†™åˆ°æ–°åº“ä¸­ã€‚æ¯”å¦‚ä½ åœ¨å‡Œæ™¨ 2 ç‚¹ï¼Œç³»ç»Ÿä½¿ç”¨çš„äººæ•°éå¸¸å°‘çš„æ—¶å€™ï¼ŒæŒ‚ä¸€ä¸ªå…¬å‘Šè¯´ç³»ç»Ÿè¦ç»´æŠ¤å‡çº§é¢„è®¡ 1 å°æ—¶ã€‚ç„¶åï¼Œä½ å†™ä¸€ä¸ªè„šæœ¬å°†è€åº“çš„æ•°æ®éƒ½åŒæ­¥åˆ°æ–°åº“ä¸­ã€‚\nå¦‚æœä½ ä¸æƒ³åœæœºè¿ç§»æ•°æ®çš„è¯ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘åŒå†™æ–¹æ¡ˆã€‚åŒå†™æ–¹æ¡ˆæ˜¯é’ˆå¯¹é‚£ç§ä¸èƒ½åœæœºè¿ç§»çš„åœºæ™¯ï¼Œå®ç°èµ·æ¥è¦ç¨å¾®éº»çƒ¦ä¸€äº›ã€‚å…·ä½“åŸç†æ˜¯è¿™æ ·çš„ï¼š\næˆ‘ä»¬å¯¹è€åº“çš„æ›´æ–°æ“ä½œï¼ˆå¢åˆ æ”¹ï¼‰ï¼ŒåŒæ—¶ä¹Ÿè¦å†™å…¥æ–°åº“ï¼ˆåŒå†™ï¼‰ã€‚å¦‚æœæ“ä½œçš„æ•°æ®ä¸å­˜åœ¨äºæ–°åº“çš„è¯ï¼Œéœ€è¦æ’å…¥åˆ°æ–°åº“ä¸­ã€‚ è¿™æ ·å°±èƒ½ä¿è¯ï¼Œå’±ä»¬æ–°åº“é‡Œçš„æ•°æ®æ˜¯æœ€æ–°çš„ã€‚ åœ¨è¿ç§»è¿‡ç¨‹ï¼ŒåŒå†™åªä¼šè®©è¢«æ›´æ–°æ“ä½œè¿‡çš„è€åº“ä¸­çš„æ•°æ®åŒæ­¥åˆ°æ–°åº“ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è‡ªå·±å†™è„šæœ¬å°†è€åº“ä¸­çš„æ•°æ®(è¿™é‡Œè¯´çš„å°±æ˜¯åŸæ¥è€åº“ä¸­çš„æ•°æ®ä½†æ˜¯æ²¡æœ‰è®¾è®¡æ›´æ–°æ“ä½œ)å’Œæ–°åº“çš„æ•°æ®åšæ¯”å¯¹ã€‚å¦‚æœæ–°åº“ä¸­æ²¡æœ‰ï¼Œé‚£å’±ä»¬å°±æŠŠæ•°æ®æ’å…¥åˆ°æ–°åº“ã€‚å¦‚æœæ–°åº“æœ‰ï¼Œæ—§åº“æ²¡æœ‰ï¼Œå°±æŠŠæ–°åº“å¯¹åº”çš„æ•°æ®åˆ é™¤ï¼ˆå†—ä½™æ•°æ®æ¸…ç†ï¼‰ã€‚ é‡å¤ä¸Šä¸€æ­¥çš„æ“ä½œï¼Œç›´åˆ°è€åº“å’Œæ–°åº“çš„æ•°æ®ä¸€è‡´ä¸ºæ­¢ã€‚ æƒ³è¦åœ¨é¡¹ç›®ä¸­å®æ–½åŒå†™è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œå¾ˆå®¹æ˜“ä¼šå‡ºç°é—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥å€ŸåŠ©ä¸Šé¢æåˆ°çš„æ•°æ®åº“åŒæ­¥å·¥å…· Canal åšå¢é‡æ•°æ®è¿ç§»ï¼ˆè¿˜æ˜¯ä¾èµ– binlogï¼Œå¼€å‘å’Œç»´æŠ¤æˆæœ¬è¾ƒä½ï¼‰ã€‚\næ€»ç»“ # è¯»å†™åˆ†ç¦»ä¸»è¦æ˜¯ä¸ºäº†å°†å¯¹æ•°æ®åº“çš„è¯»å†™æ“ä½œåˆ†æ•£åˆ°ä¸åŒçš„æ•°æ®åº“èŠ‚ç‚¹ä¸Šã€‚ è¿™æ ·çš„è¯ï¼Œå°±èƒ½å¤Ÿå°å¹…æå‡å†™æ€§èƒ½ï¼Œå¤§å¹…æå‡è¯»æ€§èƒ½ã€‚ è¯»å†™åˆ†ç¦»åŸºäºä¸»ä»å¤åˆ¶ï¼ŒMySQL ä¸»ä»å¤åˆ¶æ˜¯ä¾èµ–äº binlog ã€‚ åˆ†åº“ å°±æ˜¯å°†æ•°æ®åº“ä¸­çš„æ•°æ®åˆ†æ•£åˆ°ä¸åŒçš„æ•°æ®åº“ä¸Šã€‚åˆ†è¡¨ å°±æ˜¯å¯¹å•è¡¨çš„æ•°æ®è¿›è¡Œæ‹†åˆ†ï¼Œå¯ä»¥æ˜¯å‚ç›´æ‹†åˆ†ï¼Œä¹Ÿå¯ä»¥æ˜¯æ°´å¹³æ‹†åˆ†ã€‚ å¼•å…¥åˆ†åº“åˆ†è¡¨ä¹‹åï¼Œéœ€è¦ç³»ç»Ÿè§£å†³äº‹åŠ¡ã€åˆ†å¸ƒå¼ idã€æ— æ³• join æ“ä½œé—®é¢˜ã€‚ ShardingSphere ç»å¯¹å¯ä»¥è¯´æ˜¯å½“å‰åˆ†åº“åˆ†è¡¨çš„é¦–é€‰ï¼ShardingSphere çš„åŠŸèƒ½å®Œå–„ï¼Œé™¤äº†æ”¯æŒè¯»å†™åˆ†ç¦»å’Œåˆ†åº“åˆ†è¡¨ï¼Œè¿˜æä¾›åˆ†å¸ƒå¼äº‹åŠ¡ã€æ•°æ®åº“æ²»ç†ç­‰åŠŸèƒ½ã€‚å¦å¤–ï¼ŒShardingSphere çš„ç”Ÿæ€ä½“ç³»å®Œå–„ï¼Œç¤¾åŒºæ´»è·ƒï¼Œæ–‡æ¡£å®Œå–„ï¼Œæ›´æ–°å’Œå‘å¸ƒæ¯”è¾ƒé¢‘ç¹ã€‚ "},{"id":80,"href":"/zh/docs/study/Review/java_guide/lydly_distributed_system/ly08ly_zookeeper-in-action/","title":"zookeeperå®æˆ˜","section":"åˆ†å¸ƒå¼ç³»ç»Ÿ","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\n1. å‰è¨€ # è¿™ç¯‡æ–‡ç« ç®€å•ç»™æ¼”ç¤ºä¸€ä¸‹ ZooKeeper å¸¸è§å‘½ä»¤çš„ä½¿ç”¨ä»¥åŠ ZooKeeper Javaå®¢æˆ·ç«¯ Curator çš„åŸºæœ¬ä½¿ç”¨ã€‚ä»‹ç»åˆ°çš„å†…å®¹éƒ½æ˜¯æœ€åŸºæœ¬çš„æ“ä½œï¼Œèƒ½æ»¡è¶³æ—¥å¸¸å·¥ä½œçš„åŸºæœ¬éœ€è¦ã€‚\nå¦‚æœæ–‡ç« æœ‰ä»»ä½•éœ€è¦æ”¹å–„å’Œå®Œå–„çš„åœ°æ–¹ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡å‡ºï¼Œå…±åŒè¿›æ­¥ï¼\n2. ZooKeeper å®‰è£…å’Œä½¿ç”¨ # 2.1. ä½¿ç”¨Docker å®‰è£… zookeeper # a.ä½¿ç”¨ Docker ä¸‹è½½ ZooKeeper\ndocker pull zookeeper:3.5.8 b.è¿è¡Œ ZooKeeper\ndocker run -d --name zookeeper -p 2181:2181 zookeeper:3.5.8 2.2. è¿æ¥ ZooKeeper æœåŠ¡ # a.è¿›å…¥ZooKeeperå®¹å™¨ä¸­\nå…ˆä½¿ç”¨ docker ps æŸ¥çœ‹ ZooKeeper çš„ ContainerIDï¼Œç„¶åä½¿ç”¨ docker exec -it ContainerID /bin/bash å‘½ä»¤è¿›å…¥å®¹å™¨ä¸­ã€‚\nb.å…ˆè¿›å…¥ bin ç›®å½•,ç„¶åé€šè¿‡ ./zkCli.sh -server 127.0.0.1:2181å‘½ä»¤è¿æ¥ZooKeeper æœåŠ¡\nroot@eaf70fc620cb:/apache-zookeeper-3.5.8-bin# cd bin å¦‚æœä½ çœ‹åˆ°æ§åˆ¶å°æˆåŠŸæ‰“å°å‡ºå¦‚ä¸‹ä¿¡æ¯çš„è¯ï¼Œè¯´æ˜ä½ å·²ç»æˆåŠŸè¿æ¥ ZooKeeper æœåŠ¡ã€‚\n2.3. å¸¸ç”¨å‘½ä»¤æ¼”ç¤º # 2.3.1. æŸ¥çœ‹å¸¸ç”¨å‘½ä»¤(help å‘½ä»¤) # é€šè¿‡ help å‘½ä»¤æŸ¥çœ‹ ZooKeeper å¸¸ç”¨å‘½ä»¤\n2.3.2. åˆ›å»ºèŠ‚ç‚¹(create å‘½ä»¤) # é€šè¿‡ create å‘½ä»¤åœ¨æ ¹ç›®å½•åˆ›å»ºäº† node1 èŠ‚ç‚¹ï¼Œä¸å®ƒå…³è”çš„å­—ç¬¦ä¸²æ˜¯\u0026quot;node1\u0026quot;\n[zk: 127.0.0.1:2181(CONNECTED) 34] create /node1 â€œnode1â€ é€šè¿‡ create å‘½ä»¤åœ¨æ ¹ç›®å½•åˆ›å»ºäº† node1 èŠ‚ç‚¹ï¼Œä¸å®ƒå…³è”çš„å†…å®¹æ˜¯æ•°å­— 123\nè¿™ä¸ªæ˜¯ä¸æ˜¯å†™é”™äº†ï¼Œåº”è¯¥æ˜¯åœ¨node1ç›®å½•ä¸‹ ï¼Œåˆ›å»ºäº† node1.1èŠ‚ç‚¹\n[zk: 127.0.0.1:2181(CONNECTED) 1] create /node1/node1.1 123 Created /node1/node1.1 2.3.3. æ›´æ–°èŠ‚ç‚¹æ•°æ®å†…å®¹(set å‘½ä»¤) # [zk: 127.0.0.1:2181(CONNECTED) 11] set /node1 \u0026#34;set node1\u0026#34; 2.3.4. è·å–èŠ‚ç‚¹çš„æ•°æ®(get å‘½ä»¤) # get å‘½ä»¤å¯ä»¥è·å–æŒ‡å®šèŠ‚ç‚¹çš„æ•°æ®å†…å®¹å’ŒèŠ‚ç‚¹çš„çŠ¶æ€,å¯ä»¥çœ‹å‡ºæˆ‘ä»¬é€šè¿‡ set å‘½ä»¤å·²ç»å°†èŠ‚ç‚¹æ•°æ®å†…å®¹æ”¹ä¸º \u0026ldquo;set node1\u0026rdquo;ã€‚\nset node1 cZxid = 0x47 ctime = Sun Jan 20 10:22:59 CST 2019 mZxid = 0x4b mtime = Sun Jan 20 10:41:10 CST 2019 pZxid = 0x4a cversion = 1 dataVersion = 1 aclVersion = 0 ephemeralOwner = 0x0 dataLength = 9 numChildren = 1 2.3.5. æŸ¥çœ‹æŸä¸ªç›®å½•ä¸‹çš„å­èŠ‚ç‚¹(ls å‘½ä»¤) # é€šè¿‡ ls å‘½ä»¤æŸ¥çœ‹æ ¹ç›®å½•ä¸‹çš„èŠ‚ç‚¹\n[zk: 127.0.0.1:2181(CONNECTED) 37] ls / [dubbo, ZooKeeper, node1] é€šè¿‡ ls å‘½ä»¤æŸ¥çœ‹ node1 ç›®å½•ä¸‹çš„èŠ‚ç‚¹\n[zk: 127.0.0.1:2181(CONNECTED) 5] ls /node1 [node1.1] ZooKeeper ä¸­çš„ ls å‘½ä»¤å’Œ linux å‘½ä»¤ä¸­çš„ ls ç±»ä¼¼ï¼Œ è¿™ä¸ªå‘½ä»¤å°†åˆ—å‡ºç»å¯¹è·¯å¾„ path ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹ä¿¡æ¯ï¼ˆåˆ—å‡º 1 çº§ï¼Œå¹¶ä¸é€’å½’ï¼‰\n2.3.6. æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€(stat å‘½ä»¤) # é€šè¿‡ stat å‘½ä»¤æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€\n[zk: 127.0.0.1:2181(CONNECTED) 10] stat /node1 cZxid = 0x47 ctime = Sun Jan 20 10:22:59 CST 2019 mZxid = 0x47 mtime = Sun Jan 20 10:22:59 CST 2019 pZxid = 0x4a cversion = 1 dataVersion = 0 aclVersion = 0 ephemeralOwner = 0x0 dataLength = 11 numChildren = 1 ä¸Šé¢æ˜¾ç¤ºçš„ä¸€äº›ä¿¡æ¯æ¯”å¦‚ cversionã€aclVersionã€numChildren ç­‰ç­‰ï¼Œæˆ‘åœ¨ä¸Šé¢ â€œZooKeeper ç›¸å…³æ¦‚å¿µæ€»ç»“(å…¥é—¨)â€ è¿™ç¯‡æ–‡ç« ä¸­å·²ç»ä»‹ç»åˆ°ã€‚\n2.3.7. æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯å’ŒçŠ¶æ€(ls2 å‘½ä»¤) # ls2 å‘½ä»¤æ›´åƒæ˜¯ ls å‘½ä»¤å’Œ stat å‘½ä»¤çš„ç»“åˆã€‚ ls2 å‘½ä»¤è¿”å›çš„ä¿¡æ¯åŒ…æ‹¬ 2 éƒ¨åˆ†ï¼š\nå­èŠ‚ç‚¹åˆ—è¡¨ å½“å‰èŠ‚ç‚¹çš„ stat ä¿¡æ¯ã€‚ [zk: 127.0.0.1:2181(CONNECTED) 7] ls2 /node1 [node1.1] cZxid = 0x47 ctime = Sun Jan 20 10:22:59 CST 2019 mZxid = 0x47 mtime = Sun Jan 20 10:22:59 CST 2019 pZxid = 0x4a cversion = 1 dataVersion = 0 aclVersion = 0 ephemeralOwner = 0x0 dataLength = 11 numChildren = 1 2.3.8. åˆ é™¤èŠ‚ç‚¹(delete å‘½ä»¤) # è¿™ä¸ªå‘½ä»¤å¾ˆç®€å•ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯å¦‚æœä½ è¦åˆ é™¤æŸä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å¿…é¡»æ— å­èŠ‚ç‚¹æ‰è¡Œã€‚\n[zk: 127.0.0.1:2181(CONNECTED) 3] delete /node1/node1.1 åœ¨åé¢æˆ‘ä¼šä»‹ç»åˆ° Java å®¢æˆ·ç«¯ API çš„ä½¿ç”¨ä»¥åŠå¼€æº ZooKeeper å®¢æˆ·ç«¯ ZkClient å’Œ Curator çš„ä½¿ç”¨ã€‚\n3. ZooKeeper Javaå®¢æˆ·ç«¯ Curatorç®€å•ä½¿ç”¨ # Curator æ˜¯Netflixå…¬å¸å¼€æºçš„ä¸€å¥— ZooKeeper Javaå®¢æˆ·ç«¯æ¡†æ¶ï¼Œç›¸æ¯”äº Zookeeper è‡ªå¸¦çš„å®¢æˆ·ç«¯ zookeeper æ¥è¯´ï¼ŒCurator çš„å°è£…æ›´åŠ å®Œå–„ï¼Œå„ç§ API éƒ½å¯ä»¥æ¯”è¾ƒæ–¹ä¾¿åœ°ä½¿ç”¨ã€‚\nä¸‹é¢æˆ‘ä»¬å°±æ¥ç®€å•åœ°æ¼”ç¤ºä¸€ä¸‹ Curator çš„ä½¿ç”¨å§ï¼\nCurator4.0+ç‰ˆæœ¬å¯¹ZooKeeper 3.5.xæ”¯æŒæ¯”è¾ƒå¥½ã€‚å¼€å§‹ä¹‹å‰ï¼Œè¯·å…ˆå°†ä¸‹é¢çš„ä¾èµ–æ·»åŠ è¿›ä½ çš„é¡¹ç›®ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.curator\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;curator-framework\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.2.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.curator\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;curator-recipes\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.2.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; 3.1. è¿æ¥ ZooKeeper å®¢æˆ·ç«¯ # é€šè¿‡ CuratorFrameworkFactory åˆ›å»º CuratorFramework å¯¹è±¡ï¼Œç„¶åå†è°ƒç”¨ CuratorFramework å¯¹è±¡çš„ start() æ–¹æ³•å³å¯ï¼\nprivate static final int BASE_SLEEP_TIME = 1000; private static final int MAX_RETRIES = 3; // Retry strategy. Retry 3 times, and will increase the sleep time between retries. RetryPolicy retryPolicy = new ExponentialBackoffRetry(BASE_SLEEP_TIME, MAX_RETRIES); CuratorFramework zkClient = CuratorFrameworkFactory.builder() // the server to connect to (can be a server list) .connectString(\u0026#34;127.0.0.1:2181\u0026#34;). .retryPolicy(retryPolicy) .build(); zkClient.start(); å¯¹äºä¸€äº›åŸºæœ¬å‚æ•°çš„è¯´æ˜ï¼š\nbaseSleepTimeMsï¼šé‡è¯•ä¹‹é—´ç­‰å¾…çš„åˆå§‹æ—¶é—´ maxRetries ï¼šæœ€å¤§é‡è¯•æ¬¡æ•° connectString ï¼šè¦è¿æ¥çš„æœåŠ¡å™¨åˆ—è¡¨ retryPolicy ï¼šé‡è¯•ç­–ç•¥ 3.2. æ•°æ®èŠ‚ç‚¹çš„å¢åˆ æ”¹æŸ¥ # 3.2.1. åˆ›å»ºèŠ‚ç‚¹ # æˆ‘ä»¬åœ¨ ZooKeeperå¸¸è§æ¦‚å¿µè§£è¯» ä¸­ä»‹ç»åˆ°ï¼Œæˆ‘ä»¬é€šå¸¸æ˜¯å°† znode åˆ†ä¸º 4 å¤§ç±»ï¼š\næŒä¹…ï¼ˆPERSISTENTï¼‰èŠ‚ç‚¹ ï¼šä¸€æ—¦åˆ›å»ºå°±ä¸€ç›´å­˜åœ¨å³ä½¿ ZooKeeper é›†ç¾¤å®•æœºï¼Œç›´åˆ°å°†å…¶åˆ é™¤ã€‚ ä¸´æ—¶ï¼ˆEPHEMERALï¼‰èŠ‚ç‚¹ ï¼šä¸´æ—¶èŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸ å®¢æˆ·ç«¯ä¼šè¯ï¼ˆsessionï¼‰ ç»‘å®šçš„ï¼Œä¼šè¯æ¶ˆå¤±åˆ™èŠ‚ç‚¹æ¶ˆå¤± ã€‚å¹¶ä¸”ï¼Œä¸´æ—¶èŠ‚ç‚¹ åªèƒ½åšå¶å­èŠ‚ç‚¹ ï¼Œä¸èƒ½åˆ›å»ºå­èŠ‚ç‚¹ã€‚ æŒä¹…é¡ºåºï¼ˆPERSISTENT_SEQUENTIALï¼‰èŠ‚ç‚¹ ï¼šé™¤äº†å…·æœ‰æŒä¹…ï¼ˆPERSISTENTï¼‰èŠ‚ç‚¹çš„ç‰¹æ€§ä¹‹å¤–ï¼Œ å­èŠ‚ç‚¹çš„åç§°è¿˜å…·æœ‰é¡ºåºæ€§ã€‚æ¯”å¦‚ /node1/app0000000001 ã€/node1/app0000000002 ã€‚ ä¸´æ—¶é¡ºåºï¼ˆEPHEMERAL_SEQUENTIALï¼‰èŠ‚ç‚¹ ï¼šé™¤äº†å…·å¤‡ä¸´æ—¶ï¼ˆEPHEMERALï¼‰èŠ‚ç‚¹çš„ç‰¹æ€§ä¹‹å¤–ï¼Œå­èŠ‚ç‚¹çš„åç§°è¿˜å…·æœ‰é¡ºåºæ€§ã€‚ ä½ åœ¨ä½¿ç”¨çš„ZooKeeper çš„æ—¶å€™ï¼Œä¼šå‘ç° CreateMode ç±»ä¸­å®é™…æœ‰ 7ç§ znode ç±»å‹ ï¼Œä½†æ˜¯ç”¨çš„æœ€å¤šçš„è¿˜æ˜¯ä¸Šé¢ä»‹ç»çš„ 4 ç§ã€‚\na.åˆ›å»ºæŒä¹…åŒ–èŠ‚ç‚¹\nä½ å¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤ç§æ–¹å¼åˆ›å»ºæŒä¹…åŒ–çš„èŠ‚ç‚¹ã€‚\n//æ³¨æ„:ä¸‹é¢çš„ä»£ç ä¼šæŠ¥é”™ï¼Œä¸‹æ–‡è¯´äº†å…·ä½“åŸå›  zkClient.create().forPath(\u0026#34;/node1/00001\u0026#34;); zkClient.create().withMode(CreateMode.PERSISTENT).forPath(\u0026#34;/node1/00002\u0026#34;); ä½†æ˜¯ï¼Œä½ è¿è¡Œä¸Šé¢çš„ä»£ç ä¼šæŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸ºçš„çˆ¶èŠ‚ç‚¹node1è¿˜æœªåˆ›å»ºã€‚\nä½ å¯ä»¥å…ˆåˆ›å»ºçˆ¶èŠ‚ç‚¹ node1 ï¼Œç„¶åå†æ‰§è¡Œä¸Šé¢çš„ä»£ç å°±ä¸ä¼šæŠ¥é”™äº†ã€‚\nzkClient.create().forPath(\u0026#34;/node1\u0026#34;); æ›´æ¨èçš„æ–¹å¼æ˜¯é€šè¿‡ä¸‹é¢è¿™è¡Œä»£ç ï¼Œ creatingParentsIfNeeded() å¯ä»¥ä¿è¯çˆ¶èŠ‚ç‚¹ä¸å­˜åœ¨çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºçˆ¶èŠ‚ç‚¹ï¼Œè¿™æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚\nzkClient.create().creatingParentsIfNeeded().withMode(CreateMode.PERSISTENT).forPath(\u0026#34;/node1/00001\u0026#34;); b.åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹\nzkClient.create().creatingParentsIfNeeded().withMode(CreateMode.EPHEMERAL).forPath(\u0026#34;/node1/00001\u0026#34;); c.åˆ›å»ºèŠ‚ç‚¹å¹¶æŒ‡å®šæ•°æ®å†…å®¹\nzkClient.create().creatingParentsIfNeeded().withMode(CreateMode.EPHEMERAL).forPath(\u0026#34;/node1/00001\u0026#34;,\u0026#34;java\u0026#34;.getBytes()); zkClient.getData().forPath(\u0026#34;/node1/00001\u0026#34;);//è·å–èŠ‚ç‚¹çš„æ•°æ®å†…å®¹ï¼Œè·å–åˆ°çš„æ˜¯ byteæ•°ç»„ d.æ£€æµ‹èŠ‚ç‚¹æ˜¯å¦åˆ›å»ºæˆåŠŸ\nzkClient.checkExists().forPath(\u0026#34;/node1/00001\u0026#34;);//ä¸ä¸ºnullçš„è¯ï¼Œè¯´æ˜èŠ‚ç‚¹åˆ›å»ºæˆåŠŸ 3.2.2. åˆ é™¤èŠ‚ç‚¹ # a.åˆ é™¤ä¸€ä¸ªå­èŠ‚ç‚¹\nzkClient.delete().forPath(\u0026#34;/node1/00001\u0026#34;); b.åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ä»¥åŠå…¶ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹\nzkClient.delete().deletingChildrenIfNeeded().forPath(\u0026#34;/node1\u0026#34;); 3.2.3. è·å–/æ›´æ–°èŠ‚ç‚¹æ•°æ®å†…å®¹ # zkClient.create().creatingParentsIfNeeded().withMode(CreateMode.EPHEMERAL).forPath(\u0026#34;/node1/00001\u0026#34;,\u0026#34;java\u0026#34;.getBytes()); zkClient.getData().forPath(\u0026#34;/node1/00001\u0026#34;);//è·å–èŠ‚ç‚¹çš„æ•°æ®å†…å®¹ zkClient.setData().forPath(\u0026#34;/node1/00001\u0026#34;,\u0026#34;c++\u0026#34;.getBytes());//æ›´æ–°èŠ‚ç‚¹æ•°æ®å†…å®¹ 3.2.4. è·å–æŸä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹è·¯å¾„ # List\u0026lt;String\u0026gt; childrenPaths = zkClient.getChildren().forPath(\u0026#34;/node1\u0026#34;); "},{"id":81,"href":"/zh/docs/study/Review/java_guide/lydly_distributed_system/ly07ly_zookeeper-plus/","title":"zookeeperè¿›é˜¶","section":"åˆ†å¸ƒå¼ç³»ç»Ÿ","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nFrancisQ æŠ•ç¨¿ã€‚\n1. å¥½ä¹…ä¸è§ # ç¦»ä¸Šä¸€ç¯‡æ–‡ç« çš„å‘å¸ƒä¹Ÿå¿«ä¸€ä¸ªæœˆäº†ï¼Œæƒ³æƒ³å·²ç»å¿«ä¸€ä¸ªæœˆæ²¡å†™ä¸œè¥¿äº†ï¼Œå…¶ä¸­å¯èƒ½æœ‰æœŸæœ«è€ƒè¯•ã€è¯¾ç¨‹è®¾è®¡å’Œé©¾ç…§è€ƒè¯•ï¼Œä½†è¿™éƒ½ä¸æ˜¯å€Ÿå£ï¼\nä¸€åˆ°å†¬å¤©å°±æ‡’çš„ä¸è¡Œï¼Œæœ›å¹¿å¤§æ˜å‹ç£ä¿ƒæˆ‘ğŸ™„ğŸ™„âœï¸âœï¸ã€‚\næ–‡ç« å¾ˆé•¿ï¼Œå…ˆèµåçœ‹ï¼Œå…»æˆä¹ æƒ¯ã€‚â¤ï¸ ğŸ§¡ ğŸ’› ğŸ’š ğŸ’™ ğŸ’œ\n2. ä»€ä¹ˆæ˜¯ZooKeeper # ZooKeeper ç”± Yahoo å¼€å‘ï¼Œåæ¥æèµ ç»™äº† Apache ï¼Œç°å·²æˆä¸º Apache é¡¶çº§é¡¹ç›®ã€‚ZooKeeper æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºåè°ƒæœåŠ¡å™¨ï¼Œå…¶ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›ä¸€è‡´æ€§æœåŠ¡ã€‚å…¶ä¸€è‡´æ€§æ˜¯é€šè¿‡åŸºäº Paxos ç®—æ³•çš„ ZAB åè®®å®Œæˆçš„ã€‚å…¶ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼šé…ç½®ç»´æŠ¤ã€åˆ†å¸ƒå¼åŒæ­¥ã€é›†ç¾¤ç®¡ç†ã€åˆ†å¸ƒå¼äº‹åŠ¡ç­‰ã€‚\nç®€å•æ¥è¯´ï¼Œ ZooKeeper æ˜¯ä¸€ä¸ª åˆ†å¸ƒå¼åè°ƒæœåŠ¡æ¡†æ¶ ã€‚åˆ†å¸ƒå¼ï¼Ÿåè°ƒæœåŠ¡ï¼Ÿè¿™å•¥ç©æ„ï¼ŸğŸ¤”ğŸ¤”\nå…¶å®è§£é‡Šåˆ°åˆ†å¸ƒå¼è¿™ä¸ªæ¦‚å¿µçš„æ—¶å€™ï¼Œæˆ‘å‘ç°æœ‰äº›åŒå­¦å¹¶ä¸æ˜¯èƒ½æŠŠ åˆ†å¸ƒå¼å’Œé›†ç¾¤ è¿™ä¸¤ä¸ªæ¦‚å¿µå¾ˆå¥½çš„ç†è§£é€ã€‚å‰æ®µæ—¶é—´æœ‰åŒå­¦å’Œæˆ‘æ¢è®¨èµ·åˆ†å¸ƒå¼çš„ä¸œè¥¿ï¼Œä»–è¯´åˆ†å¸ƒå¼ä¸å°±æ˜¯åŠ æœºå™¨å—ï¼Ÿä¸€å°æœºå™¨ä¸å¤Ÿç”¨å†åŠ ä¸€å°æŠ—å‹å‘—ã€‚å½“ç„¶åŠ æœºå™¨è¿™ç§è¯´æ³•ä¹Ÿæ— å¯åšéï¼Œä½ ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿå¿…å®šæ¶‰åŠåˆ°å¤šä¸ªæœºå™¨ï¼Œä½†æ˜¯ä½ åˆ«å¿˜äº†ï¼Œè®¡ç®—æœºå­¦ç§‘ä¸­è¿˜æœ‰ä¸€ä¸ªç›¸ä¼¼çš„æ¦‚å¿µâ€”â€” Cluster ï¼Œé›†ç¾¤ä¸ä¹Ÿæ˜¯åŠ æœºå™¨å—ï¼Ÿä½†æ˜¯ é›†ç¾¤ å’Œ åˆ†å¸ƒå¼ å…¶å®å°±æ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„æ¦‚å¿µã€‚\næ¯”å¦‚ï¼Œæˆ‘ç°åœ¨æœ‰ä¸€ä¸ªç§’æ€æœåŠ¡ï¼Œå¹¶å‘é‡å¤ªå¤§å•æœºç³»ç»Ÿæ‰¿å—ä¸ä½ï¼Œé‚£æˆ‘åŠ å‡ å°æœåŠ¡å™¨ä¹Ÿ ä¸€æ · æä¾›ç§’æ€æœåŠ¡ï¼Œè¿™ä¸ªæ—¶å€™å°±æ˜¯ Cluster é›†ç¾¤ ã€‚\nä½†æ˜¯ï¼Œæˆ‘ç°åœ¨æ¢ä¸€ç§æ–¹å¼ï¼Œæˆ‘å°†ä¸€ä¸ªç§’æ€æœåŠ¡ æ‹†åˆ†æˆå¤šä¸ªå­æœåŠ¡ ï¼Œæ¯”å¦‚åˆ›å»ºè®¢å•æœåŠ¡ï¼Œå¢åŠ ç§¯åˆ†æœåŠ¡ï¼Œæ‰£ä¼˜æƒ åˆ¸æœåŠ¡ç­‰ç­‰ï¼Œç„¶åæˆ‘å°†è¿™äº›å­æœåŠ¡éƒ½éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Š ï¼Œè¿™ä¸ªæ—¶å€™å°±æ˜¯ Distributed åˆ†å¸ƒå¼ ã€‚\nè€Œæˆ‘ä¸ºä»€ä¹ˆåé©³åŒå­¦æ‰€è¯´çš„åˆ†å¸ƒå¼å°±æ˜¯åŠ æœºå™¨å‘¢ï¼Ÿå› ä¸ºæˆ‘è®¤ä¸ºåŠ æœºå™¨æ›´åŠ é€‚ç”¨äºæ„å»ºé›†ç¾¤ï¼Œå› ä¸ºå®ƒçœŸæ˜¯åªæœ‰åŠ æœºå™¨ã€‚è€Œå¯¹äºåˆ†å¸ƒå¼æ¥è¯´ï¼Œä½ é¦–å…ˆéœ€è¦å°†ä¸šåŠ¡è¿›è¡Œæ‹†åˆ†ï¼Œç„¶åå†åŠ æœºå™¨ï¼ˆä¸ä»…ä»…æ˜¯åŠ æœºå™¨é‚£ä¹ˆç®€å•ï¼‰ï¼ŒåŒæ—¶ä½ è¿˜è¦å»è§£å†³åˆ†å¸ƒå¼å¸¦æ¥çš„ä¸€ç³»åˆ—é—®é¢˜ã€‚\næ¯”å¦‚å„ä¸ªåˆ†å¸ƒå¼ç»„ä»¶å¦‚ä½•åè°ƒèµ·æ¥ï¼Œå¦‚ä½•å‡å°‘å„ä¸ªç³»ç»Ÿä¹‹é—´çš„è€¦åˆåº¦ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡çš„å¤„ç†ï¼Œå¦‚ä½•å»é…ç½®æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿç­‰ç­‰ã€‚ZooKeeper ä¸»è¦å°±æ˜¯è§£å†³è¿™äº›é—®é¢˜çš„ã€‚\n3. ä¸€è‡´æ€§é—®é¢˜ # è®¾è®¡ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿå¿…å®šä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜â€”â€” å› ä¸ºåˆ†åŒºå®¹å¿æ€§ï¼ˆpartition toleranceï¼‰çš„å­˜åœ¨ï¼Œå°±å¿…å®šè¦æ±‚æˆ‘ä»¬éœ€è¦åœ¨ç³»ç»Ÿå¯ç”¨æ€§ï¼ˆavailabilityï¼‰å’Œæ•°æ®ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰ä¸­åšå‡ºæƒè¡¡ ã€‚è¿™å°±æ˜¯è‘—åçš„ CAP å®šç†ã€‚\nç†è§£èµ·æ¥å…¶å®å¾ˆç®€å•ï¼Œæ¯”å¦‚è¯´æŠŠä¸€ä¸ªç­çº§ä½œä¸ºæ•´ä¸ªç³»ç»Ÿï¼Œè€Œå­¦ç”Ÿæ˜¯ç³»ç»Ÿä¸­çš„ä¸€ä¸ªä¸ªç‹¬ç«‹çš„å­ç³»ç»Ÿã€‚è¿™ä¸ªæ—¶å€™ç­é‡Œçš„å°çº¢å°æ˜å·å·è°ˆæ‹çˆ±è¢«ç­é‡Œçš„å¤§å˜´å·´å°èŠ±å‘ç°äº†ï¼Œå°èŠ±æ¬£å–œè‹¥ç‹‚å‘Šè¯‰äº†å‘¨å›´çš„äººï¼Œç„¶åå°çº¢å°æ˜è°ˆæ‹çˆ±çš„æ¶ˆæ¯åœ¨ç­çº§é‡Œä¼ æ’­èµ·æ¥äº†ã€‚å½“åœ¨æ¶ˆæ¯çš„ä¼ æ’­ï¼ˆæ•£å¸ƒï¼‰è¿‡ç¨‹ä¸­ï¼Œä½ æŠ“åˆ°ä¸€ä¸ªåŒå­¦é—®ä»–ä»¬çš„æƒ…å†µï¼Œå¦‚æœå›ç­”ä½ ä¸çŸ¥é“ï¼ˆæˆ–è€…è¯´çš„æ˜¯ä»–ä»¬çš„å‰ç”·/å¥³æœ‹å‹ï¼Œä¹Ÿå°±æ˜¯æ¶ˆæ¯ä¸ä¸€è‡´ï¼‰ï¼Œé‚£ä¹ˆè¯´æ˜æ•´ä¸ªç­çº§ç³»ç»Ÿå‡ºç°äº†æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼ˆå› ä¸ºå°èŠ±å·²ç»çŸ¥é“è¿™ä¸ªæ¶ˆæ¯äº†ï¼‰ã€‚è€Œå¦‚æœä»–ç›´æ¥ä¸å›ç­”ä½ ï¼Œå› ä¸ºæ•´ä¸ªç­çº§æœ‰æ¶ˆæ¯åœ¨è¿›è¡Œä¼ æ’­ï¼ˆä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œéœ€è¦æ‰€æœ‰äººéƒ½çŸ¥é“æ‰å¯æä¾›æœåŠ¡ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™å°±å‡ºç°äº†ç³»ç»Ÿçš„å¯ç”¨æ€§é—®é¢˜ã€‚\nè€Œä¸Šè¿°å‰è€…å°±æ˜¯ Eureka çš„å¤„ç†æ–¹å¼ï¼Œå®ƒä¿è¯äº†APï¼ˆå¯ç”¨æ€§ï¼‰ï¼Œåè€…å°±æ˜¯æˆ‘ä»¬ä»Šå¤©æ‰€è¦è®²çš„ ZooKeeper çš„å¤„ç†æ–¹å¼ï¼Œå®ƒä¿è¯äº†CPï¼ˆæ•°æ®ä¸€è‡´æ€§(å³åŒæ­¥æœŸé—´ä¸å¯ç”¨)ï¼‰ã€‚\nã€lyæ€»ç»“ã€‘ä¹Ÿå°±æ˜¯è¯´ä¸¤å°æœºå™¨åŒæ­¥æœŸé—´ï¼Œå¦‚æœè¦ä¿è¯å¯ç”¨æ€§ï¼Œé‚£ä¹ˆå¿…ç„¶ä¼šå‡ºç°ä¸€è‡´æ€§é—®é¢˜ï¼›è€Œå¦‚æœè¦ä¿è¯ä¸€è‡´æ€§ï¼Œé‚£å¿…ç„¶è¦ç­‰åˆ°å®Œå…¨åŒæ­¥å®Œï¼ˆä¹Ÿå°±æ˜¯æœŸé—´ä¼šè®©è¯·æ±‚ä¸å¯ç”¨ï¼‰\n4. ä¸€è‡´æ€§åè®®å’Œç®—æ³• # è€Œä¸ºäº†è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œåœ¨ç§‘å­¦å®¶å’Œç¨‹åºå‘˜çš„ä¸æ–­æ¢ç´¢ä¸­ï¼Œå°±å‡ºç°äº†å¾ˆå¤šçš„ä¸€è‡´æ€§åè®®å’Œç®—æ³•ã€‚æ¯”å¦‚ 2PCï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰ï¼Œ3PCï¼ˆä¸‰é˜¶æ®µæäº¤ï¼‰ï¼ŒPaxosç®—æ³•ç­‰ç­‰ã€‚\nè¿™æ—¶å€™è¯·ä½ æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼ŒåŒå­¦ä¹‹é—´å¦‚æœé‡‡ç”¨ä¼ çº¸æ¡çš„æ–¹å¼å»ä¼ æ’­æ¶ˆæ¯ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜â€”â€”æˆ‘å’‹çŸ¥é“æˆ‘çš„å°çº¸æ¡æœ‰æ²¡æœ‰ä¼ åˆ°æˆ‘æƒ³è¦ä¼ é€’çš„é‚£ä¸ªäººæ‰‹ä¸­å‘¢ï¼Ÿä¸‡ä¸€è¢«å“ªä¸ªå°å®¶ä¼™ç»™åŠ«æŒç¯¡æ”¹äº†å‘¢ï¼Œå¯¹å§ï¼Ÿ\nè¿™ä¸ªæ—¶å€™å°±å¼•ç”³å‡ºä¸€ä¸ªæ¦‚å¿µâ€”â€” æ‹œå åº­å°†å†›é—®é¢˜ ã€‚å®ƒæ„æŒ‡ åœ¨ä¸å¯é ä¿¡é“ä¸Šè¯•å›¾é€šè¿‡æ¶ˆæ¯ä¼ é€’çš„æ–¹å¼è¾¾åˆ°ä¸€è‡´æ€§æ˜¯ä¸å¯èƒ½çš„ï¼Œ æ‰€ä»¥æ‰€æœ‰çš„ä¸€è‡´æ€§ç®—æ³•çš„ å¿…è¦å‰æ å°±æ˜¯å®‰å…¨å¯é çš„æ¶ˆæ¯é€šé“ã€‚\nè€Œä¸ºä»€ä¹ˆè¦å»è§£å†³æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ï¼Ÿä½ æƒ³æƒ³ï¼Œå¦‚æœä¸€ä¸ªç§’æ€ç³»ç»Ÿå°†æœåŠ¡æ‹†åˆ†æˆäº†ä¸‹è®¢å•å’ŒåŠ ç§¯åˆ†æœåŠ¡ï¼Œè¿™ä¸¤ä¸ªæœåŠ¡éƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨ä¸Šäº†ï¼Œä¸‡ä¸€åœ¨æ¶ˆæ¯çš„ä¼ æ’­è¿‡ç¨‹ä¸­ç§¯åˆ†ç³»ç»Ÿå®•æœºäº†ï¼Œæ€»ä¸èƒ½ä½ è¿™è¾¹ä¸‹äº†è®¢å•å´æ²¡åŠ ç§¯åˆ†å§ï¼Ÿä½ æ€»å¾—ä¿è¯ä¸¤è¾¹çš„æ•°æ®éœ€è¦ä¸€è‡´å§ï¼Ÿ\n4.1. 2PCï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰ # ä¸¤é˜¶æ®µæäº¤æ˜¯ä¸€ç§ä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿæ•°æ®ä¸€è‡´æ€§çš„åè®®ï¼Œç°åœ¨å¾ˆå¤šæ•°æ®åº“éƒ½æ˜¯é‡‡ç”¨çš„ä¸¤é˜¶æ®µæäº¤åè®®æ¥å®Œæˆ åˆ†å¸ƒå¼äº‹åŠ¡ çš„å¤„ç†ã€‚\nåœ¨ä»‹ç»2PCä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥æƒ³æƒ³åˆ†å¸ƒå¼äº‹åŠ¡åˆ°åº•æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ\nè¿˜æ‹¿ç§’æ€ç³»ç»Ÿçš„ä¸‹è®¢å•å’ŒåŠ ç§¯åˆ†ä¸¤ä¸ªç³»ç»Ÿæ¥ä¸¾ä¾‹å§ï¼ˆæˆ‘æƒ³ä½ ä»¬å¯èƒ½éƒ½åäº†ğŸ¤®ğŸ¤®ğŸ¤®ï¼‰ï¼Œæˆ‘ä»¬æ­¤æ—¶ä¸‹å®Œè®¢å•ä¼šå‘ä¸ªæ¶ˆæ¯ç»™ç§¯åˆ†ç³»ç»Ÿå‘Šè¯‰å®ƒä¸‹é¢è¯¥å¢åŠ ç§¯åˆ†äº†ã€‚å¦‚æœæˆ‘ä»¬ä»…ä»…æ˜¯å‘é€ä¸€ä¸ªæ¶ˆæ¯ä¹Ÿä¸æ”¶å›å¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„è®¢å•ç³»ç»Ÿæ€ä¹ˆèƒ½çŸ¥é“ç§¯åˆ†ç³»ç»Ÿçš„æ”¶åˆ°æ¶ˆæ¯çš„æƒ…å†µå‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬å¢åŠ ä¸€ä¸ªæ”¶å›å¤çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆå½“ç§¯åˆ†ç³»ç»Ÿæ”¶åˆ°æ¶ˆæ¯åè¿”å›ç»™è®¢å•ç³»ç»Ÿä¸€ä¸ª Response ï¼Œä½†åœ¨ä¸­é—´å‡ºç°äº†ç½‘ç»œæ³¢åŠ¨ï¼Œé‚£ä¸ªå›å¤æ¶ˆæ¯æ²¡æœ‰å‘é€æˆåŠŸï¼Œè®¢å•ç³»ç»Ÿæ˜¯ä¸æ˜¯ä»¥ä¸ºç§¯åˆ†ç³»ç»Ÿæ¶ˆæ¯æ¥æ”¶å¤±è´¥äº†ï¼Ÿå®ƒæ˜¯ä¸æ˜¯ä¼šå›æ»šäº‹åŠ¡ï¼Ÿä½†æ­¤æ—¶ï¼ˆå®é™…æƒ…å†µï¼šï¼‰ç§¯åˆ†ç³»ç»Ÿæ˜¯æˆåŠŸæ”¶åˆ°æ¶ˆæ¯çš„ï¼Œå®ƒå°±ä¼šå»å¤„ç†æ¶ˆæ¯ç„¶åç»™ç”¨æˆ·å¢åŠ ç§¯åˆ†ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå‡ºç°ç§¯åˆ†åŠ äº†ä½†æ˜¯è®¢å•æ²¡ä¸‹æˆåŠŸã€‚\næ‰€ä»¥æˆ‘ä»¬æ‰€éœ€è¦è§£å†³çš„æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ•´ä¸ªè°ƒç”¨é“¾ä¸­ï¼Œæˆ‘ä»¬æ‰€æœ‰æœåŠ¡çš„æ•°æ®å¤„ç†è¦ä¹ˆéƒ½æˆåŠŸè¦ä¹ˆéƒ½å¤±è´¥ï¼Œå³æ‰€æœ‰æœåŠ¡çš„ åŸå­æ€§é—®é¢˜ ã€‚\nåœ¨ä¸¤é˜¶æ®µæäº¤ä¸­ï¼Œä¸»è¦æ¶‰åŠåˆ°ä¸¤ä¸ªè§’è‰²ï¼Œåˆ†åˆ«æ˜¯åè°ƒè€…å’Œå‚ä¸è€…ã€‚\nç¬¬ä¸€é˜¶æ®µï¼šå½“è¦æ‰§è¡Œä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„æ—¶å€™ï¼Œäº‹åŠ¡å‘èµ·è€…é¦–å…ˆå‘åè°ƒè€…å‘èµ·äº‹åŠ¡è¯·æ±‚ï¼Œç„¶ååè°ƒè€…ä¼šç»™æ‰€æœ‰å‚ä¸è€…å‘é€ prepare è¯·æ±‚ï¼ˆå…¶ä¸­åŒ…æ‹¬äº‹åŠ¡å†…å®¹ï¼‰å‘Šè¯‰å‚ä¸è€…ä½ ä»¬éœ€è¦æ‰§è¡Œäº‹åŠ¡äº†ï¼Œå¦‚æœèƒ½æ‰§è¡Œæˆ‘å‘çš„äº‹åŠ¡å†…å®¹é‚£ä¹ˆå°±å…ˆæ‰§è¡Œä½†ä¸æäº¤ï¼Œæ‰§è¡Œåè¯·ç»™æˆ‘å›å¤ã€‚ç„¶åå‚ä¸è€…æ”¶åˆ° prepare æ¶ˆæ¯åï¼Œä»–ä»¬ä¼šå¼€å§‹æ‰§è¡Œäº‹åŠ¡ï¼ˆä½†ä¸æäº¤ï¼‰ï¼Œå¹¶å°† Undo å’Œ Redo ä¿¡æ¯è®°å…¥äº‹åŠ¡æ—¥å¿—ä¸­ï¼Œä¹‹åå‚ä¸è€…å°±å‘åè°ƒè€…åé¦ˆæ˜¯å¦å‡†å¤‡å¥½äº†ã€‚\nç¬¬äºŒé˜¶æ®µï¼šç¬¬äºŒé˜¶æ®µä¸»è¦æ˜¯åè°ƒè€…æ ¹æ®å‚ä¸è€…åé¦ˆçš„æƒ…å†µæ¥å†³å®šæ¥ä¸‹æ¥æ˜¯å¦å¯ä»¥è¿›è¡Œäº‹åŠ¡çš„æäº¤æ“ä½œï¼Œå³æäº¤äº‹åŠ¡æˆ–è€…å›æ»šäº‹åŠ¡ã€‚\næ¯”å¦‚è¿™ä¸ªæ—¶å€™ æ‰€æœ‰çš„å‚ä¸è€… éƒ½è¿”å›äº†å‡†å¤‡å¥½äº†çš„æ¶ˆæ¯ï¼Œè¿™ä¸ªæ—¶å€™å°±è¿›è¡Œäº‹åŠ¡çš„æäº¤ï¼Œåè°ƒè€…æ­¤æ—¶ä¼šç»™æ‰€æœ‰çš„å‚ä¸è€…å‘é€ Commit è¯·æ±‚ ï¼Œå½“å‚ä¸è€…æ”¶åˆ° Commit è¯·æ±‚çš„æ—¶å€™ä¼šæ‰§è¡Œå‰é¢æ‰§è¡Œçš„äº‹åŠ¡çš„ æäº¤æ“ä½œ ï¼Œæäº¤å®Œæ¯•ä¹‹åå°†ç»™åè°ƒè€…å‘é€æäº¤æˆåŠŸçš„å“åº”ã€‚\nè€Œå¦‚æœåœ¨ç¬¬ä¸€é˜¶æ®µå¹¶ä¸æ˜¯æ‰€æœ‰å‚ä¸è€…éƒ½è¿”å›äº†å‡†å¤‡å¥½äº†çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ­¤æ—¶åè°ƒè€…å°†ä¼šç»™æ‰€æœ‰å‚ä¸è€…å‘é€ å›æ»šäº‹åŠ¡çš„ rollback è¯·æ±‚ï¼Œå‚ä¸è€…æ”¶åˆ°ä¹‹åå°†ä¼š å›æ»šå®ƒåœ¨ç¬¬ä¸€é˜¶æ®µæ‰€åšçš„äº‹åŠ¡å¤„ç† ï¼Œç„¶åå†å°†å¤„ç†æƒ…å†µè¿”å›ç»™åè°ƒè€…ï¼Œæœ€ç»ˆåè°ƒè€…æ”¶åˆ°å“åº”åä¾¿ç»™äº‹åŠ¡å‘èµ·è€…è¿”å›å¤„ç†å¤±è´¥çš„ç»“æœã€‚\nä¸ªäººè§‰å¾— 2PC å®ç°å¾—è¿˜æ˜¯æ¯”è¾ƒé¸¡è‚‹çš„ï¼Œå› ä¸ºäº‹å®ä¸Šå®ƒåªè§£å†³äº†å„ä¸ªäº‹åŠ¡çš„åŸå­æ€§é—®é¢˜ï¼Œéšä¹‹ä¹Ÿå¸¦æ¥äº†å¾ˆå¤šçš„é—®é¢˜ã€‚\nå•ç‚¹æ•…éšœé—®é¢˜ï¼Œå¦‚æœåè°ƒè€…æŒ‚äº†é‚£ä¹ˆæ•´ä¸ªç³»ç»Ÿéƒ½å¤„äºä¸å¯ç”¨çš„çŠ¶æ€äº†ã€‚ é˜»å¡é—®é¢˜ï¼Œå³å½“åè°ƒè€…å‘é€ prepare è¯·æ±‚ï¼Œå‚ä¸è€…æ”¶åˆ°ä¹‹åå¦‚æœèƒ½å¤„ç†é‚£ä¹ˆå®ƒå°†ä¼šè¿›è¡Œäº‹åŠ¡çš„å¤„ç†ä½†å¹¶ä¸æäº¤ï¼Œè¿™ä¸ªæ—¶å€™ä¼šä¸€ç›´å ç”¨ç€èµ„æºä¸é‡Šæ”¾ï¼Œå¦‚æœæ­¤æ—¶åè°ƒè€…æŒ‚äº†ï¼Œé‚£ä¹ˆè¿™äº›èµ„æºéƒ½ä¸ä¼šå†é‡Šæ”¾äº†ï¼Œè¿™ä¼šæå¤§å½±å“æ€§èƒ½ã€‚ æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œæ¯”å¦‚å½“ç¬¬äºŒé˜¶æ®µï¼Œåè°ƒè€…åªå‘é€äº†ä¸€éƒ¨åˆ†çš„ commit è¯·æ±‚å°±æŒ‚äº†ï¼Œé‚£ä¹ˆä¹Ÿå°±æ„å‘³ç€ï¼Œæ”¶åˆ°æ¶ˆæ¯çš„å‚ä¸è€…ä¼šè¿›è¡Œäº‹åŠ¡çš„æäº¤ï¼Œè€Œåé¢æ²¡æ”¶åˆ°çš„åˆ™ä¸ä¼šè¿›è¡Œäº‹åŠ¡æäº¤ï¼Œé‚£ä¹ˆè¿™æ—¶å€™å°±ä¼šäº§ç”Ÿæ•°æ®ä¸ä¸€è‡´æ€§é—®é¢˜ã€‚ 4.2. 3PCï¼ˆä¸‰é˜¶æ®µæäº¤ï¼‰ # å› ä¸º2PCå­˜åœ¨çš„ä¸€ç³»åˆ—é—®é¢˜ï¼Œæ¯”å¦‚å•ç‚¹ï¼Œå®¹é”™æœºåˆ¶ç¼ºé™·ç­‰ç­‰ï¼Œä»è€Œäº§ç”Ÿäº† 3PCï¼ˆä¸‰é˜¶æ®µæäº¤ï¼‰ ã€‚é‚£ä¹ˆè¿™ä¸‰é˜¶æ®µåˆåˆ†åˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\nåƒä¸‡ä¸è¦å§PCç†è§£æˆä¸ªäººç”µè„‘äº†ï¼Œå…¶å®ä»–ä»¬æ˜¯ phase-commit çš„ç¼©å†™ï¼Œå³é˜¶æ®µæäº¤ã€‚\nCanCommité˜¶æ®µï¼šåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€ CanCommit è¯·æ±‚ï¼Œå‚ä¸è€…æ”¶åˆ°è¯·æ±‚åä¼šæ ¹æ®è‡ªèº«æƒ…å†µæŸ¥çœ‹æ˜¯å¦èƒ½æ‰§è¡Œäº‹åŠ¡ï¼Œå¦‚æœå¯ä»¥åˆ™è¿”å› YES å“åº”å¹¶è¿›å…¥é¢„å¤‡çŠ¶æ€ï¼Œå¦åˆ™è¿”å› NO ã€‚ PreCommité˜¶æ®µï¼šåè°ƒè€…æ ¹æ®å‚ä¸è€…è¿”å›çš„å“åº”æ¥å†³å®šæ˜¯å¦å¯ä»¥è¿›è¡Œä¸‹é¢çš„ PreCommit æ“ä½œã€‚å¦‚æœä¸Šé¢å‚ä¸è€…è¿”å›çš„éƒ½æ˜¯ YESï¼Œé‚£ä¹ˆåè°ƒè€…å°†å‘æ‰€æœ‰å‚ä¸è€…å‘é€ PreCommit é¢„æäº¤è¯·æ±‚ï¼Œå‚ä¸è€…æ”¶åˆ°é¢„æäº¤è¯·æ±‚åï¼Œä¼šè¿›è¡Œäº‹åŠ¡çš„æ‰§è¡Œæ“ä½œï¼Œå¹¶å°† Undo å’Œ Redo ä¿¡æ¯å†™å…¥äº‹åŠ¡æ—¥å¿—ä¸­ ï¼Œæœ€åå¦‚æœå‚ä¸è€…é¡ºåˆ©æ‰§è¡Œäº†äº‹åŠ¡åˆ™ç»™åè°ƒè€…è¿”å›æˆåŠŸçš„å“åº”ã€‚å¦‚æœåœ¨ç¬¬ä¸€é˜¶æ®µåè°ƒè€…æ”¶åˆ°äº† ä»»ä½•ä¸€ä¸ª NO çš„ä¿¡æ¯ï¼Œæˆ–è€… åœ¨ä¸€å®šæ—¶é—´å†… å¹¶æ²¡æœ‰æ”¶åˆ°å…¨éƒ¨çš„å‚ä¸è€…çš„å“åº”ï¼Œé‚£ä¹ˆå°±ä¼šä¸­æ–­äº‹åŠ¡ï¼Œå®ƒä¼šå‘æ‰€æœ‰å‚ä¸è€…å‘é€ä¸­æ–­è¯·æ±‚ï¼ˆabortï¼‰ï¼Œå‚ä¸è€…æ”¶åˆ°ä¸­æ–­è¯·æ±‚ä¹‹åä¼šç«‹å³ä¸­æ–­äº‹åŠ¡ï¼Œæˆ–è€…åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°åè°ƒè€…çš„è¯·æ±‚ï¼Œå®ƒä¹Ÿä¼šä¸­æ–­äº‹åŠ¡ã€‚ DoCommité˜¶æ®µï¼šè¿™ä¸ªé˜¶æ®µå…¶å®å’Œ 2PC çš„ç¬¬äºŒé˜¶æ®µå·®ä¸å¤šï¼Œå¦‚æœåè°ƒè€…æ”¶åˆ°äº†æ‰€æœ‰å‚ä¸è€…åœ¨ PreCommit é˜¶æ®µçš„ YES å“åº”ï¼Œé‚£ä¹ˆåè°ƒè€…å°†ä¼šç»™æ‰€æœ‰å‚ä¸è€…å‘é€ DoCommit è¯·æ±‚ï¼Œå‚ä¸è€…æ”¶åˆ° DoCommit è¯·æ±‚ååˆ™ä¼šè¿›è¡Œäº‹åŠ¡çš„æäº¤å·¥ä½œï¼Œå®Œæˆååˆ™ä¼šç»™åè°ƒè€…è¿”å›å“åº”ï¼Œåè°ƒè€…æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…è¿”å›çš„äº‹åŠ¡æäº¤æˆåŠŸçš„å“åº”ä¹‹ååˆ™å®Œæˆäº‹åŠ¡ã€‚è‹¥åè°ƒè€…åœ¨ PreCommit é˜¶æ®µ æ”¶åˆ°äº†ä»»ä½•ä¸€ä¸ª NO æˆ–è€…åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„å“åº” ï¼Œé‚£ä¹ˆå°±ä¼šè¿›è¡Œä¸­æ–­è¯·æ±‚çš„å‘é€ï¼Œå‚ä¸è€…æ”¶åˆ°ä¸­æ–­è¯·æ±‚ååˆ™ä¼š é€šè¿‡ä¸Šé¢è®°å½•çš„å›æ»šæ—¥å¿— æ¥è¿›è¡Œäº‹åŠ¡çš„å›æ»šæ“ä½œï¼Œå¹¶å‘åè°ƒè€…åé¦ˆå›æ»šçŠ¶å†µï¼Œåè°ƒè€…æ”¶åˆ°å‚ä¸è€…è¿”å›çš„æ¶ˆæ¯åï¼Œä¸­æ–­äº‹åŠ¡ã€‚ è¿™é‡Œæ˜¯ 3PC åœ¨æˆåŠŸçš„ç¯å¢ƒä¸‹çš„æµç¨‹å›¾ï¼Œä½ å¯ä»¥çœ‹åˆ° 3PC åœ¨å¾ˆå¤šåœ°æ–¹è¿›è¡Œäº†è¶…æ—¶ä¸­æ–­çš„å¤„ç†ï¼Œæ¯”å¦‚åè°ƒè€…åœ¨æŒ‡å®šæ—¶é—´å†…ä¸ºæ”¶åˆ°å…¨éƒ¨çš„ç¡®è®¤æ¶ˆæ¯åˆ™è¿›è¡Œäº‹åŠ¡ä¸­æ–­çš„å¤„ç†ï¼Œè¿™æ ·èƒ½ å‡å°‘åŒæ­¥é˜»å¡çš„æ—¶é—´ ã€‚è¿˜æœ‰éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ3PC åœ¨ DoCommit é˜¶æ®µå‚ä¸è€…å¦‚æœªæ”¶åˆ°åè°ƒè€…å‘é€çš„æäº¤äº‹åŠ¡çš„è¯·æ±‚ï¼Œå®ƒä¼šåœ¨ä¸€å®šæ—¶é—´å†…è¿›è¡Œäº‹åŠ¡çš„æäº¤ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆåšå‘¢ï¼Ÿæ˜¯å› ä¸ºè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è‚¯å®šä¿è¯äº†åœ¨ç¬¬ä¸€é˜¶æ®µæ‰€æœ‰çš„åè°ƒè€…å…¨éƒ¨è¿”å›äº†å¯ä»¥æ‰§è¡Œäº‹åŠ¡çš„å“åº”ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æœ‰ç†ç”±ç›¸ä¿¡å…¶ä»–ç³»ç»Ÿéƒ½èƒ½è¿›è¡Œäº‹åŠ¡çš„æ‰§è¡Œå’Œæäº¤ï¼Œæ‰€ä»¥ä¸ç®¡åè°ƒè€…æœ‰æ²¡æœ‰å‘æ¶ˆæ¯ç»™å‚ä¸è€…ï¼Œè¿›å…¥ç¬¬ä¸‰é˜¶æ®µå‚ä¸è€…éƒ½ä¼šè¿›è¡Œäº‹åŠ¡çš„æäº¤æ“ä½œã€‚\næ€»ä¹‹ï¼Œ3PC é€šè¿‡ä¸€ç³»åˆ—çš„è¶…æ—¶æœºåˆ¶å¾ˆå¥½çš„ç¼“è§£äº†é˜»å¡é—®é¢˜ï¼Œä½†æ˜¯æœ€é‡è¦çš„ä¸€è‡´æ€§å¹¶æ²¡æœ‰å¾—åˆ°æ ¹æœ¬çš„è§£å†³ï¼Œæ¯”å¦‚åœ¨ PreCommit é˜¶æ®µï¼Œå½“ä¸€ä¸ªå‚ä¸è€…æ”¶åˆ°äº†è¯·æ±‚ä¹‹åå…¶ä»–å‚ä¸è€…å’Œåè°ƒè€…æŒ‚äº†æˆ–è€…å‡ºç°äº†ç½‘ç»œåˆ†åŒºï¼Œè¿™ä¸ªæ—¶å€™æ”¶åˆ°æ¶ˆæ¯çš„å‚ä¸è€…éƒ½ä¼šè¿›è¡Œäº‹åŠ¡æäº¤ï¼Œè¿™å°±ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æ€§é—®é¢˜ã€‚\næ‰€ä»¥ï¼Œè¦è§£å†³ä¸€è‡´æ€§é—®é¢˜è¿˜éœ€è¦é  Paxos ç®—æ³•â­ï¸ â­ï¸ â­ï¸ ã€‚\n4.3. Paxos ç®—æ³• [ly:çœ‹ä¸æ‡‚ï¼Œè·³è¿‡] # Paxos ç®—æ³•æ˜¯åŸºäºæ¶ˆæ¯ä¼ é€’ä¸”å…·æœ‰é«˜åº¦å®¹é”™ç‰¹æ€§çš„ä¸€è‡´æ€§ç®—æ³•ï¼Œæ˜¯ç›®å‰å…¬è®¤çš„è§£å†³åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜æœ€æœ‰æ•ˆçš„ç®—æ³•ä¹‹ä¸€ï¼Œå…¶è§£å†³çš„é—®é¢˜å°±æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¦‚ä½•å°±æŸä¸ªå€¼ï¼ˆå†³è®®ï¼‰è¾¾æˆä¸€è‡´ ã€‚\nåœ¨ Paxos ä¸­ä¸»è¦æœ‰ä¸‰ä¸ªè§’è‰²ï¼Œåˆ†åˆ«ä¸º Proposerææ¡ˆè€…ã€Acceptorè¡¨å†³è€…ã€Learnerå­¦ä¹ è€…ã€‚Paxos ç®—æ³•å’Œ 2PC ä¸€æ ·ï¼Œä¹Ÿæœ‰ä¸¤ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«ä¸º Prepare å’Œ accept é˜¶æ®µã€‚\n4.3.1. prepare é˜¶æ®µ # Proposerææ¡ˆè€…ï¼šè´Ÿè´£æå‡º proposalï¼Œæ¯ä¸ªææ¡ˆè€…åœ¨æå‡ºææ¡ˆæ—¶éƒ½ä¼šé¦–å…ˆè·å–åˆ°ä¸€ä¸ª å…·æœ‰å…¨å±€å”¯ä¸€æ€§çš„ã€é€’å¢çš„ææ¡ˆç¼–å·Nï¼Œå³åœ¨æ•´ä¸ªé›†ç¾¤ä¸­æ˜¯å”¯ä¸€çš„ç¼–å· Nï¼Œç„¶åå°†è¯¥ç¼–å·èµ‹äºˆå…¶è¦æå‡ºçš„ææ¡ˆï¼Œåœ¨ç¬¬ä¸€é˜¶æ®µæ˜¯åªå°†ææ¡ˆç¼–å·å‘é€ç»™æ‰€æœ‰çš„è¡¨å†³è€…ã€‚ Acceptorè¡¨å†³è€…ï¼šæ¯ä¸ªè¡¨å†³è€…åœ¨ accept æŸææ¡ˆåï¼Œä¼šå°†è¯¥ææ¡ˆç¼–å·Nè®°å½•åœ¨æœ¬åœ°ï¼Œè¿™æ ·æ¯ä¸ªè¡¨å†³è€…ä¸­ä¿å­˜çš„å·²ç»è¢« accept çš„ææ¡ˆä¸­ä¼šå­˜åœ¨ä¸€ä¸ªç¼–å·æœ€å¤§çš„ææ¡ˆï¼Œå…¶ç¼–å·å‡è®¾ä¸º maxNã€‚æ¯ä¸ªè¡¨å†³è€…ä»…ä¼š accept ç¼–å·å¤§äºè‡ªå·±æœ¬åœ° maxN çš„ææ¡ˆï¼Œåœ¨æ‰¹å‡†ææ¡ˆæ—¶è¡¨å†³è€…ä¼šå°†ä»¥å‰æ¥å—è¿‡çš„æœ€å¤§ç¼–å·çš„ææ¡ˆä½œä¸ºå“åº”åé¦ˆç»™ Proposer ã€‚ ä¸‹é¢æ˜¯ prepare é˜¶æ®µçš„æµç¨‹å›¾ï¼Œä½ å¯ä»¥å¯¹ç…§ç€å‚è€ƒä¸€ä¸‹ã€‚\n4.3.2. accept é˜¶æ®µ # å½“ä¸€ä¸ªææ¡ˆè¢« Proposer æå‡ºåï¼Œå¦‚æœ Proposer æ”¶åˆ°äº†è¶…è¿‡åŠæ•°çš„ Acceptor çš„æ‰¹å‡†ï¼ˆProposer æœ¬èº«åŒæ„ï¼‰ï¼Œé‚£ä¹ˆæ­¤æ—¶ Proposer ä¼šç»™æ‰€æœ‰çš„ Acceptor å‘é€çœŸæ­£çš„ææ¡ˆï¼ˆä½ å¯ä»¥ç†è§£ä¸ºç¬¬ä¸€é˜¶æ®µä¸ºè¯•æ¢ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™ Proposer å°±ä¼šå‘é€ææ¡ˆçš„å†…å®¹å’Œææ¡ˆç¼–å·ã€‚\nè¡¨å†³è€…æ”¶åˆ°ææ¡ˆè¯·æ±‚åä¼šå†æ¬¡æ¯”è¾ƒæœ¬èº«å·²ç»æ‰¹å‡†è¿‡çš„æœ€å¤§ææ¡ˆç¼–å·å’Œè¯¥ææ¡ˆç¼–å·ï¼Œå¦‚æœè¯¥ææ¡ˆç¼–å· å¤§äºç­‰äº å·²ç»æ‰¹å‡†è¿‡çš„æœ€å¤§ææ¡ˆç¼–å·ï¼Œé‚£ä¹ˆå°± accept è¯¥ææ¡ˆï¼ˆæ­¤æ—¶æ‰§è¡Œææ¡ˆå†…å®¹ä½†ä¸æäº¤ï¼‰ï¼Œéšåå°†æƒ…å†µè¿”å›ç»™ Proposer ã€‚å¦‚æœä¸æ»¡è¶³åˆ™ä¸å›åº”æˆ–è€…è¿”å› NO ã€‚\nå½“ Proposer æ”¶åˆ°è¶…è¿‡åŠæ•°çš„ accept ï¼Œé‚£ä¹ˆå®ƒè¿™ä¸ªæ—¶å€™ä¼šå‘æ‰€æœ‰çš„ acceptor å‘é€ææ¡ˆçš„æäº¤è¯·æ±‚ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºä¸Šè¿°ä»…ä»…æ˜¯è¶…è¿‡åŠæ•°çš„ acceptor æ‰¹å‡†æ‰§è¡Œäº†è¯¥ææ¡ˆå†…å®¹ï¼Œå…¶ä»–æ²¡æœ‰æ‰¹å‡†çš„å¹¶æ²¡æœ‰æ‰§è¡Œè¯¥ææ¡ˆå†…å®¹ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™éœ€è¦å‘æœªæ‰¹å‡†çš„ acceptor å‘é€ææ¡ˆå†…å®¹å’Œææ¡ˆç¼–å·å¹¶è®©å®ƒæ— æ¡ä»¶æ‰§è¡Œå’Œæäº¤ï¼Œè€Œå¯¹äºå‰é¢å·²ç»æ‰¹å‡†è¿‡è¯¥ææ¡ˆçš„ acceptor æ¥è¯´ ä»…ä»…éœ€è¦å‘é€è¯¥ææ¡ˆçš„ç¼–å· ï¼Œè®© acceptor æ‰§è¡Œæäº¤å°±è¡Œäº†ã€‚\nè€Œå¦‚æœ Proposer å¦‚æœæ²¡æœ‰æ”¶åˆ°è¶…è¿‡åŠæ•°çš„ accept é‚£ä¹ˆå®ƒå°†ä¼šå°† é€’å¢ è¯¥ Proposal çš„ç¼–å·ï¼Œç„¶å é‡æ–°è¿›å…¥ Prepare é˜¶æ®µ ã€‚\nå¯¹äº Learner æ¥è¯´å¦‚ä½•å»å­¦ä¹  Acceptor æ‰¹å‡†çš„ææ¡ˆå†…å®¹ï¼Œè¿™æœ‰å¾ˆå¤šæ–¹å¼ï¼Œè¯»è€…å¯ä»¥è‡ªå·±å»äº†è§£ä¸€ä¸‹ï¼Œè¿™é‡Œä¸åšè¿‡å¤šè§£é‡Šã€‚\n4.3.3. paxos ç®—æ³•çš„æ­»å¾ªç¯é—®é¢˜ # å…¶å®å°±æœ‰ç‚¹ç±»ä¼¼äºä¸¤ä¸ªäººåµæ¶ï¼Œå°æ˜è¯´æˆ‘æ˜¯å¯¹çš„ï¼Œå°çº¢è¯´æˆ‘æ‰æ˜¯å¯¹çš„ï¼Œä¸¤ä¸ªäººæ®ç†åŠ›äº‰çš„è°ä¹Ÿä¸è®©è°ğŸ¤¬ğŸ¤¬ã€‚\næ¯”å¦‚è¯´ï¼Œæ­¤æ—¶ææ¡ˆè€… P1 æå‡ºä¸€ä¸ªæ–¹æ¡ˆ M1ï¼Œå®Œæˆäº† Prepare é˜¶æ®µçš„å·¥ä½œï¼Œè¿™ä¸ªæ—¶å€™ acceptor åˆ™æ‰¹å‡†äº† M1ï¼Œä½†æ˜¯æ­¤æ—¶ææ¡ˆè€… P2 åŒæ—¶ä¹Ÿæå‡ºäº†ä¸€ä¸ªæ–¹æ¡ˆ M2ï¼Œå®ƒä¹Ÿå®Œæˆäº† Prepare é˜¶æ®µçš„å·¥ä½œã€‚ç„¶å P1 çš„æ–¹æ¡ˆå·²ç»ä¸èƒ½åœ¨ç¬¬äºŒé˜¶æ®µè¢«æ‰¹å‡†äº†ï¼ˆå› ä¸º acceptor å·²ç»æ‰¹å‡†äº†æ¯” M1 æ›´å¤§çš„ M2ï¼‰ï¼Œæ‰€ä»¥ P1 è‡ªå¢æ–¹æ¡ˆå˜ä¸º M3 é‡æ–°è¿›å…¥ Prepare é˜¶æ®µï¼Œç„¶å acceptor ï¼Œåˆæ‰¹å‡†äº†æ–°çš„ M3 æ–¹æ¡ˆï¼Œå®ƒåˆä¸èƒ½æ‰¹å‡† M2 äº†ï¼Œè¿™ä¸ªæ—¶å€™ M2 åˆè‡ªå¢è¿›å…¥ Prepare é˜¶æ®µã€‚ã€‚ã€‚\nå°±è¿™æ ·æ— ä¼‘æ— æ­¢çš„æ°¸è¿œææ¡ˆä¸‹å»ï¼Œè¿™å°±æ˜¯ paxos ç®—æ³•çš„æ­»å¾ªç¯é—®é¢˜ã€‚\né‚£ä¹ˆå¦‚ä½•è§£å†³å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œäººå¤šäº†å®¹æ˜“åµæ¶ï¼Œæˆ‘ç°åœ¨ å°±å…è®¸ä¸€ä¸ªèƒ½ææ¡ˆ å°±è¡Œäº†ã€‚\n5. å¼•å‡º ZAB # 5.1. Zookeeper æ¶æ„ # ä½œä¸ºä¸€ä¸ªä¼˜ç§€é«˜æ•ˆä¸”å¯é çš„åˆ†å¸ƒå¼åè°ƒæ¡†æ¶ï¼ŒZooKeeper åœ¨è§£å†³åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§é—®é¢˜æ—¶å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨ Paxos ï¼Œè€Œæ˜¯ä¸“é—¨å®šåˆ¶äº†ä¸€è‡´æ€§åè®®å«åš ZAB(ZooKeeper Atomic Broadcast) åŸå­å¹¿æ’­åè®®ï¼Œè¯¥åè®®èƒ½å¤Ÿå¾ˆå¥½åœ°æ”¯æŒ å´©æºƒæ¢å¤ ã€‚\n5.2. ZAB ä¸­çš„ä¸‰ä¸ªè§’è‰² # å’Œä»‹ç» Paxos ä¸€æ ·ï¼Œåœ¨ä»‹ç» ZAB åè®®ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥äº†è§£ä¸€ä¸‹åœ¨ ZAB ä¸­ä¸‰ä¸ªä¸»è¦çš„è§’è‰²ï¼ŒLeader é¢†å¯¼è€…ã€Followerè·Ÿéšè€…ã€Observerè§‚å¯Ÿè€… ã€‚\nLeader ï¼šé›†ç¾¤ä¸­ å”¯ä¸€çš„å†™è¯·æ±‚å¤„ç†è€… ï¼Œèƒ½å¤Ÿå‘èµ·æŠ•ç¥¨ï¼ˆæŠ•ç¥¨ä¹Ÿæ˜¯ä¸ºäº†è¿›è¡Œå†™è¯·æ±‚ï¼‰ã€‚ Followerï¼šèƒ½å¤Ÿæ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¦‚æœæ˜¯è¯»è¯·æ±‚åˆ™å¯ä»¥è‡ªå·±å¤„ç†ï¼Œå¦‚æœæ˜¯å†™è¯·æ±‚åˆ™è¦è½¬å‘ç»™ Leader ã€‚åœ¨é€‰ä¸¾è¿‡ç¨‹ä¸­ä¼šå‚ä¸æŠ•ç¥¨ï¼Œæœ‰é€‰ä¸¾æƒå’Œè¢«é€‰ä¸¾æƒ ã€‚ Observer ï¼šå°±æ˜¯æ²¡æœ‰é€‰ä¸¾æƒå’Œè¢«é€‰ä¸¾æƒçš„ Follower ã€‚ è§‚å¯Ÿè€…[É™bËˆzÉœËvÉ™(r)] åœ¨ ZAB åè®®ä¸­å¯¹ zkServer(å³ä¸Šé¢æˆ‘ä»¬è¯´çš„ä¸‰ä¸ªè§’è‰²çš„æ€»ç§°) è¿˜æœ‰ä¸¤ç§æ¨¡å¼çš„å®šä¹‰ï¼Œåˆ†åˆ«æ˜¯ æ¶ˆæ¯å¹¿æ’­ å’Œ å´©æºƒæ¢å¤ ã€‚\n5.3. æ¶ˆæ¯å¹¿æ’­æ¨¡å¼ # è¯´ç™½äº†å°±æ˜¯ ZAB åè®®æ˜¯å¦‚ä½•å¤„ç†å†™è¯·æ±‚çš„ï¼Œä¸Šé¢æˆ‘ä»¬ä¸æ˜¯è¯´åªæœ‰ Leader èƒ½å¤„ç†å†™è¯·æ±‚å˜›ï¼Ÿé‚£ä¹ˆæˆ‘ä»¬çš„ Follower å’Œ Observer æ˜¯ä¸æ˜¯ä¹Ÿéœ€è¦ åŒæ­¥æ›´æ–°æ•°æ® å‘¢ï¼Ÿæ€»ä¸èƒ½æ•°æ®åªåœ¨ Leader ä¸­æ›´æ–°äº†ï¼Œå…¶ä»–è§’è‰²éƒ½æ²¡æœ‰å¾—åˆ°æ›´æ–°å§ï¼Ÿ\nä¸å°±æ˜¯ åœ¨æ•´ä¸ªé›†ç¾¤ä¸­ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ å˜›ï¼Ÿå¦‚æœæ˜¯ä½ ï¼Œä½ ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ\nåºŸè¯ï¼Œç¬¬ä¸€æ­¥è‚¯å®šéœ€è¦ Leader å°†å†™è¯·æ±‚ å¹¿æ’­ å‡ºå»å‘€ï¼Œè®© Leader é—®é—® Followers æ˜¯å¦åŒæ„æ›´æ–°ï¼Œå¦‚æœè¶…è¿‡åŠæ•°ä»¥ä¸Šçš„åŒæ„é‚£ä¹ˆå°±è¿›è¡Œ Follower å’Œ Observer çš„æ›´æ–°ï¼ˆå’Œ Paxos ä¸€æ ·ï¼‰ã€‚å½“ç„¶è¿™ä¹ˆè¯´æœ‰ç‚¹è™šï¼Œç”»å¼ å›¾ç†è§£ä¸€ä¸‹ã€‚\nå—¯ã€‚ã€‚ã€‚çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œè²Œä¼¼æ‡‚äº†ğŸ¤¥ğŸ¤¥ğŸ¤¥ã€‚è¿™ä¸¤ä¸ª Queue å“ªå†’å‡ºæ¥çš„ï¼Ÿç­”æ¡ˆæ˜¯ ZAB éœ€è¦è®© Follower å’Œ Observer ä¿è¯é¡ºåºæ€§ ã€‚ä½•ä¸ºé¡ºåºæ€§ï¼Œæ¯”å¦‚æˆ‘ç°åœ¨æœ‰ä¸€ä¸ªå†™è¯·æ±‚Aï¼Œæ­¤æ—¶ Leader å°†è¯·æ±‚Aå¹¿æ’­å‡ºå»ï¼Œå› ä¸ºåªéœ€è¦åŠæ•°åŒæ„å°±è¡Œï¼Œæ‰€ä»¥å¯èƒ½è¿™ä¸ªæ—¶å€™æœ‰ä¸€ä¸ª Follower F1å› ä¸ºç½‘ç»œåŸå› æ²¡æœ‰æ”¶åˆ°ï¼Œè€Œ Leader åˆå¹¿æ’­äº†ä¸€ä¸ªè¯·æ±‚Bï¼Œå› ä¸ºç½‘ç»œåŸå› ï¼ŒF1ç«Ÿç„¶å…ˆæ”¶åˆ°äº†è¯·æ±‚Bç„¶åæ‰æ”¶åˆ°äº†è¯·æ±‚Aï¼Œè¿™ä¸ªæ—¶å€™è¯·æ±‚å¤„ç†çš„é¡ºåºä¸åŒå°±ä¼šå¯¼è‡´æ•°æ®çš„ä¸åŒï¼Œä»è€Œ äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´é—®é¢˜ ã€‚\næ‰€ä»¥åœ¨ Leader è¿™ç«¯ï¼Œå®ƒä¸ºæ¯ä¸ªå…¶ä»–çš„ zkServer å‡†å¤‡äº†ä¸€ä¸ª é˜Ÿåˆ— ï¼Œé‡‡ç”¨å…ˆè¿›å…ˆå‡ºçš„æ–¹å¼å‘é€æ¶ˆæ¯ã€‚ç”±äºåè®®æ˜¯ é€šè¿‡ TCP æ¥è¿›è¡Œç½‘ç»œé€šä¿¡çš„ï¼Œä¿è¯äº†æ¶ˆæ¯çš„å‘é€é¡ºåºæ€§ï¼Œæ¥å—é¡ºåºæ€§ä¹Ÿå¾—åˆ°äº†ä¿è¯ã€‚\né˜Ÿåˆ—çš„å…ˆè¿›å…ˆå‡º+tcpçš„å‘é€é¡ºåºæ€§ï¼Œä¿è¯äº†æ¥æ”¶é¡ºåºçš„ä¸€è‡´æ€§\né™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ ZAB ä¸­è¿˜å®šä¹‰äº†ä¸€ä¸ª å…¨å±€å•è°ƒé€’å¢çš„äº‹åŠ¡ID ZXID ï¼Œå®ƒæ˜¯ä¸€ä¸ª64ä½longå‹ï¼Œå…¶ä¸­é«˜32ä½è¡¨ç¤º epoch å¹´ä»£ï¼Œä½32ä½è¡¨ç¤ºäº‹åŠ¡idã€‚epoch æ˜¯ä¼šæ ¹æ® Leader çš„å˜åŒ–è€Œå˜åŒ–çš„ï¼Œå½“ä¸€ä¸ª Leader æŒ‚äº†ï¼Œæ–°çš„ Leader ä¸Šä½çš„æ—¶å€™ï¼Œå¹´ä»£ï¼ˆepochï¼‰å°±å˜äº†ã€‚è€Œä½32ä½å¯ä»¥ç®€å•ç†è§£ä¸ºé€’å¢çš„äº‹åŠ¡idã€‚\nå®šä¹‰è¿™ä¸ªçš„åŸå› ä¹Ÿæ˜¯ä¸ºäº†é¡ºåºæ€§ï¼Œæ¯ä¸ª proposal åœ¨ Leader ä¸­ç”Ÿæˆåéœ€è¦ é€šè¿‡å…¶ ZXID æ¥è¿›è¡Œæ’åº ï¼Œæ‰èƒ½å¾—åˆ°å¤„ç†ã€‚\n5.4. å´©æºƒæ¢å¤æ¨¡å¼ # è¯´åˆ°å´©æºƒæ¢å¤æˆ‘ä»¬é¦–å…ˆè¦æåˆ° ZAB ä¸­çš„ Leader é€‰ä¸¾ç®—æ³•ï¼Œå½“ç³»ç»Ÿå‡ºç°å´©æºƒå½±å“æœ€å¤§åº”è¯¥æ˜¯ Leader çš„å´©æºƒï¼Œå› ä¸ºæˆ‘ä»¬åªæœ‰ä¸€ä¸ª Leader ï¼Œæ‰€ä»¥å½“ Leader å‡ºç°é—®é¢˜çš„æ—¶å€™æˆ‘ä»¬åŠ¿å¿…éœ€è¦é‡æ–°é€‰ä¸¾ Leader ã€‚\nLeader é€‰ä¸¾å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªä¸åŒçš„é˜¶æ®µï¼Œç¬¬ä¸€ä¸ªæ˜¯æˆ‘ä»¬æåˆ°çš„ Leader å®•æœºéœ€è¦é‡æ–°é€‰ä¸¾ï¼Œç¬¬äºŒåˆ™æ˜¯å½“ Zookeeper å¯åŠ¨æ—¶éœ€è¦è¿›è¡Œç³»ç»Ÿçš„ Leader åˆå§‹åŒ–é€‰ä¸¾ã€‚ä¸‹é¢æˆ‘å…ˆæ¥ä»‹ç»ä¸€ä¸‹ ZAB æ˜¯å¦‚ä½•è¿›è¡Œåˆå§‹åŒ–é€‰ä¸¾çš„ã€‚\nå‡è®¾æˆ‘ä»¬é›†ç¾¤ä¸­æœ‰3å°æœºå™¨ï¼Œé‚£ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬éœ€è¦ä¸¤å°ä»¥ä¸ŠåŒæ„ï¼ˆè¶…è¿‡åŠæ•°ï¼‰ã€‚æ¯”å¦‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯åŠ¨äº† server1 ï¼Œå®ƒä¼šé¦–å…ˆ æŠ•ç¥¨ç»™è‡ªå·± ï¼ŒæŠ•ç¥¨å†…å®¹ä¸ºæœåŠ¡å™¨çš„ myid å’Œ ZXID ï¼Œå› ä¸ºåˆå§‹åŒ–æ‰€ä»¥ ZXID éƒ½ä¸º0ï¼Œæ­¤æ—¶ server1 å‘å‡ºçš„æŠ•ç¥¨ä¸º (1,0)ã€‚ä½†æ­¤æ—¶ server1 çš„æŠ•ç¥¨ä»…ä¸º1ï¼Œæ‰€ä»¥ä¸èƒ½ä½œä¸º Leader ï¼Œæ­¤æ—¶è¿˜åœ¨é€‰ä¸¾é˜¶æ®µæ‰€ä»¥æ•´ä¸ªé›†ç¾¤å¤„äº Looking çŠ¶æ€ã€‚\næ¥ç€ server2 å¯åŠ¨äº†ï¼Œå®ƒé¦–å…ˆä¹Ÿä¼šå°†æŠ•ç¥¨é€‰ç»™è‡ªå·±(2,0)ï¼Œå¹¶å°†æŠ•ç¥¨ä¿¡æ¯å¹¿æ’­å‡ºå»ï¼ˆserver1ä¹Ÿä¼šï¼Œåªæ˜¯å®ƒé‚£æ—¶æ²¡æœ‰å…¶ä»–çš„æœåŠ¡å™¨äº†ï¼‰ï¼Œserver1 åœ¨æ”¶åˆ° server2 çš„æŠ•ç¥¨ä¿¡æ¯åä¼šå°†æŠ•ç¥¨ä¿¡æ¯ä¸è‡ªå·±çš„ä½œæ¯”è¾ƒã€‚é¦–å…ˆå®ƒä¼šæ¯”è¾ƒ ZXID ï¼ŒZXID å¤§çš„ä¼˜å…ˆä¸º Leaderï¼Œå¦‚æœç›¸åŒåˆ™æ¯”è¾ƒ myidï¼Œmyid å¤§çš„ä¼˜å…ˆä½œä¸º Leaderã€‚æ‰€ä»¥æ­¤æ—¶server1 å‘ç° server2 æ›´é€‚åˆåš Leaderï¼Œå®ƒå°±ä¼šå°†è‡ªå·±çš„æŠ•ç¥¨ä¿¡æ¯æ›´æ”¹ä¸º(2,0)ç„¶åå†å¹¿æ’­å‡ºå»ï¼Œä¹‹åserver2 æ”¶åˆ°ä¹‹åå‘ç°å’Œè‡ªå·±çš„ä¸€æ ·æ— éœ€åšæ›´æ”¹ï¼Œå¹¶ä¸”è‡ªå·±çš„ æŠ•ç¥¨å·²ç»è¶…è¿‡åŠæ•° ï¼Œåˆ™ ç¡®å®š server2 ä¸º Leaderï¼Œserver1 ä¹Ÿä¼šå°†è‡ªå·±æœåŠ¡å™¨è®¾ç½®ä¸º Following å˜ä¸º Followerã€‚æ•´ä¸ªæœåŠ¡å™¨å°±ä» Looking å˜ä¸ºäº†æ­£å¸¸çŠ¶æ€ã€‚\nå½“ server3 å¯åŠ¨å‘ç°é›†ç¾¤æ²¡æœ‰å¤„äº Looking çŠ¶æ€æ—¶ï¼Œå®ƒä¼šç›´æ¥ä»¥ Follower çš„èº«ä»½åŠ å…¥é›†ç¾¤ã€‚\nè¿˜æ˜¯å‰é¢ä¸‰ä¸ª server çš„ä¾‹å­ï¼Œå¦‚æœåœ¨æ•´ä¸ªé›†ç¾¤è¿è¡Œçš„è¿‡ç¨‹ä¸­ server2 æŒ‚äº†ï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤ä¼šå¦‚ä½•é‡æ–°é€‰ä¸¾ Leader å‘¢ï¼Ÿå…¶å®å’Œåˆå§‹åŒ–é€‰ä¸¾å·®ä¸å¤šã€‚\né¦–å…ˆæ¯«æ— ç–‘é—®çš„æ˜¯å‰©ä¸‹çš„ä¸¤ä¸ª Follower ä¼šå°†è‡ªå·±çš„çŠ¶æ€ ä» Following å˜ä¸º Looking çŠ¶æ€ ï¼Œç„¶åæ¯ä¸ª server ä¼šå‘åˆå§‹åŒ–æŠ•ç¥¨ä¸€æ ·é¦–å…ˆç»™è‡ªå·±æŠ•ç¥¨ï¼ˆè¿™ä¸è¿‡è¿™é‡Œçš„ zxid å¯èƒ½ä¸æ˜¯0äº†ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿éšä¾¿å–ä¸ªæ•°å­—ï¼‰ã€‚\nå‡è®¾ server1 ç»™è‡ªå·±æŠ•ç¥¨ä¸º(1,99)ï¼Œç„¶åå¹¿æ’­ç»™å…¶ä»– serverï¼Œserver3 é¦–å…ˆä¹Ÿä¼šç»™è‡ªå·±æŠ•ç¥¨(3,95)ï¼Œç„¶åä¹Ÿå¹¿æ’­ç»™å…¶ä»– serverã€‚server1 å’Œ server3 æ­¤æ—¶ä¼šæ”¶åˆ°å½¼æ­¤çš„æŠ•ç¥¨ä¿¡æ¯ï¼Œå’Œä¸€å¼€å§‹é€‰ä¸¾ä¸€æ ·ï¼Œä»–ä»¬ä¹Ÿä¼šæ¯”è¾ƒè‡ªå·±çš„æŠ•ç¥¨å’Œæ”¶åˆ°çš„æŠ•ç¥¨ï¼ˆzxid å¤§çš„ä¼˜å…ˆï¼Œå¦‚æœç›¸åŒé‚£ä¹ˆå°± myid å¤§çš„ä¼˜å…ˆï¼‰ã€‚è¿™ä¸ªæ—¶å€™ server1 æ”¶åˆ°äº† server3 çš„æŠ•ç¥¨å‘ç°æ²¡è‡ªå·±çš„åˆé€‚æ•…ä¸å˜ï¼Œserver3 æ”¶åˆ° server1 çš„æŠ•ç¥¨ç»“æœåå‘ç°æ¯”è‡ªå·±çš„åˆé€‚äºæ˜¯æ›´æ”¹æŠ•ç¥¨ä¸º(1,99)ç„¶åå¹¿æ’­å‡ºå»ï¼Œæœ€å server1 æ”¶åˆ°äº†å‘ç°è‡ªå·±çš„æŠ•ç¥¨å·²ç»è¶…è¿‡åŠæ•°å°±æŠŠè‡ªå·±è®¾ä¸º Leaderï¼Œserver3 ä¹Ÿéšä¹‹å˜ä¸º Followerã€‚\nè¯·æ³¨æ„ ZooKeeper ä¸ºä»€ä¹ˆè¦è®¾ç½®å¥‡æ•°ä¸ªç»“ç‚¹ï¼Ÿæ¯”å¦‚è¿™é‡Œæˆ‘ä»¬æ˜¯ä¸‰ä¸ªï¼ŒæŒ‚äº†ä¸€ä¸ªæˆ‘ä»¬è¿˜èƒ½æ­£å¸¸å·¥ä½œï¼ŒæŒ‚äº†ä¸¤ä¸ªæˆ‘ä»¬å°±ä¸èƒ½æ­£å¸¸å·¥ä½œäº†ï¼ˆå·²ç»æ²¡æœ‰è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ•°äº†ï¼Œæ‰€ä»¥æ— æ³•è¿›è¡ŒæŠ•ç¥¨ç­‰æ“ä½œäº†ï¼‰ã€‚è€Œå‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰å››ä¸ªï¼ŒæŒ‚äº†ä¸€ä¸ªä¹Ÿèƒ½å·¥ä½œï¼Œä½†æ˜¯æŒ‚äº†ä¸¤ä¸ªä¹Ÿä¸èƒ½æ­£å¸¸å·¥ä½œäº†ï¼Œè¿™æ˜¯å’Œä¸‰ä¸ªä¸€æ ·çš„ï¼Œè€Œä¸‰ä¸ªæ¯”å››ä¸ªè¿˜å°‘ä¸€ä¸ªï¼Œå¸¦æ¥çš„æ•ˆç›Šæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ Zookeeper æ¨èå¥‡æ•°ä¸ª server ã€‚\né‚£ä¹ˆè¯´å®Œäº† ZAB ä¸­çš„ Leader é€‰ä¸¾æ–¹å¼ä¹‹åæˆ‘ä»¬å†æ¥äº†è§£ä¸€ä¸‹ å´©æºƒæ¢å¤ æ˜¯ä»€ä¹ˆç©æ„ï¼Ÿ\nå…¶å®ä¸»è¦å°±æ˜¯ å½“é›†ç¾¤ä¸­æœ‰æœºå™¨æŒ‚äº†ï¼Œæˆ‘ä»¬æ•´ä¸ªé›†ç¾¤å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Ÿ\nå¦‚æœåªæ˜¯ Follower æŒ‚äº†ï¼Œè€Œä¸”æŒ‚çš„ï¼ˆæ€»æ•°ï¼‰æ²¡è¶…è¿‡åŠæ•°çš„æ—¶å€™ï¼Œå› ä¸ºæˆ‘ä»¬ä¸€å¼€å§‹è®²äº†åœ¨ Leader ä¸­ä¼šç»´æŠ¤é˜Ÿåˆ—ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒåé¢çš„æ•°æ®æ²¡æ¥æ”¶åˆ°å¯¼è‡´æ•°æ®ä¸ä¸€è‡´æ€§ã€‚\nå¦‚æœ Leader æŒ‚äº†é‚£å°±éº»çƒ¦äº†ï¼Œæˆ‘ä»¬è‚¯å®šéœ€è¦å…ˆæš‚åœæœåŠ¡å˜ä¸º Looking çŠ¶æ€ç„¶åè¿›è¡Œ Leader çš„é‡æ–°é€‰ä¸¾ï¼ˆä¸Šé¢æˆ‘è®²è¿‡äº†ï¼‰ï¼Œä½†è¿™ä¸ªå°±è¦åˆ†ä¸ºä¸¤ç§æƒ…å†µäº†ï¼Œåˆ†åˆ«æ˜¯ ç¡®ä¿å·²ç»è¢«Leaderæäº¤çš„ææ¡ˆæœ€ç»ˆèƒ½å¤Ÿè¢«æ‰€æœ‰çš„Followeræäº¤ å’Œ è·³è¿‡é‚£äº›å·²ç»è¢«ä¸¢å¼ƒçš„ææ¡ˆ ã€‚\nç¡®ä¿å·²ç»è¢«Leaderæäº¤çš„ææ¡ˆæœ€ç»ˆèƒ½å¤Ÿè¢«æ‰€æœ‰çš„Followeræäº¤æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ\nå‡è®¾ Leader (server2) å‘é€ commit è¯·æ±‚ï¼ˆå¿˜äº†è¯·çœ‹ä¸Šé¢çš„æ¶ˆæ¯å¹¿æ’­æ¨¡å¼ï¼‰ï¼Œä»–å‘é€ç»™äº† server3ï¼Œç„¶åè¦å‘ç»™ server1 çš„æ—¶å€™çªç„¶æŒ‚äº†ã€‚è¿™ä¸ªæ—¶å€™é‡æ–°é€‰ä¸¾çš„æ—¶å€™æˆ‘ä»¬å¦‚æœæŠŠ server1 ä½œä¸º Leader çš„è¯ï¼Œé‚£ä¹ˆè‚¯å®šä¼šäº§ç”Ÿæ•°æ®ä¸ä¸€è‡´æ€§ï¼Œå› ä¸º server3 è‚¯å®šä¼šæäº¤åˆšåˆš server2 å‘é€çš„ commit è¯·æ±‚çš„ææ¡ˆï¼Œè€Œ server1 æ ¹æœ¬æ²¡æ”¶åˆ°æ‰€ä»¥ä¼šä¸¢å¼ƒã€‚\né‚£æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ\nèªæ˜çš„åŒå­¦è‚¯å®šä¼šè´¨ç–‘ï¼Œè¿™ä¸ªæ—¶å€™ server1 å·²ç»ä¸å¯èƒ½æˆä¸º Leader äº†ï¼Œå› ä¸º server1 å’Œ server3 è¿›è¡ŒæŠ•ç¥¨é€‰ä¸¾çš„æ—¶å€™ä¼šæ¯”è¾ƒ ZXID ï¼Œè€Œæ­¤æ—¶ server3 çš„ ZXID è‚¯å®šæ¯” server1 çš„å¤§äº†ã€‚(ä¸ç†è§£å¯ä»¥çœ‹å‰é¢çš„é€‰ä¸¾ç®—æ³•)\né‚£ä¹ˆè·³è¿‡é‚£äº›å·²ç»è¢«ä¸¢å¼ƒçš„ææ¡ˆåˆæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ\nå‡è®¾ Leader (server2) æ­¤æ—¶åŒæ„äº†ææ¡ˆN1ï¼Œè‡ªèº«æäº¤äº†è¿™ä¸ªäº‹åŠ¡å¹¶ä¸”è¦å‘é€ç»™æ‰€æœ‰ Follower è¦ commit çš„è¯·æ±‚ï¼Œå´åœ¨è¿™ä¸ªæ—¶å€™æŒ‚äº†ï¼Œæ­¤æ—¶è‚¯å®šè¦é‡æ–°è¿›è¡Œ Leader çš„é€‰ä¸¾ï¼Œæ¯”å¦‚è¯´æ­¤æ—¶é€‰ server1 ä¸º Leader ï¼ˆè¿™æ— æ‰€è°“ï¼‰ã€‚ä½†æ˜¯è¿‡äº†ä¸€ä¼šï¼Œè¿™ä¸ª æŒ‚æ‰çš„ Leader åˆé‡æ–°æ¢å¤äº† ï¼Œæ­¤æ—¶å®ƒè‚¯å®šä¼šä½œä¸º Follower çš„èº«ä»½è¿›å…¥é›†ç¾¤ä¸­ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åˆšåˆš server2 å·²ç»åŒæ„æäº¤äº†ææ¡ˆN1ï¼Œä½†å…¶ä»– server å¹¶æ²¡æœ‰æ”¶åˆ°å®ƒçš„ commit ä¿¡æ¯ï¼Œæ‰€ä»¥å…¶ä»– server ä¸å¯èƒ½å†æäº¤è¿™ä¸ªææ¡ˆN1äº†ï¼Œè¿™æ ·å°±ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æ€§é—®é¢˜äº†ï¼Œæ‰€ä»¥ è¯¥ææ¡ˆN1æœ€ç»ˆéœ€è¦è¢«æŠ›å¼ƒæ‰ ã€‚\n6. Zookeeperçš„å‡ ä¸ªç†è®ºçŸ¥è¯† # äº†è§£äº† ZAB åè®®è¿˜ä¸å¤Ÿï¼Œå®ƒä»…ä»…æ˜¯ Zookeeper å†…éƒ¨å®ç°çš„ä¸€ç§æ–¹å¼ï¼Œè€Œæˆ‘ä»¬å¦‚ä½•é€šè¿‡ Zookeeper å»åšä¸€äº›å…¸å‹çš„åº”ç”¨åœºæ™¯å‘¢ï¼Ÿæ¯”å¦‚è¯´é›†ç¾¤ç®¡ç†ï¼Œåˆ†å¸ƒå¼é”ï¼ŒMaster é€‰ä¸¾ç­‰ç­‰ã€‚\nè¿™å°±æ¶‰åŠåˆ°å¦‚ä½•ä½¿ç”¨ Zookeeper äº†ï¼Œä½†åœ¨ä½¿ç”¨ä¹‹å‰æˆ‘ä»¬è¿˜éœ€è¦æŒæ¡å‡ ä¸ªæ¦‚å¿µã€‚æ¯”å¦‚ Zookeeper çš„ æ•°æ®æ¨¡å‹ ã€ä¼šè¯æœºåˆ¶ã€ACLã€Watcheræœºåˆ¶ ç­‰ç­‰ã€‚\n6.1. æ•°æ®æ¨¡å‹ # zookeeper æ•°æ®å­˜å‚¨ç»“æ„ä¸æ ‡å‡†çš„ Unix æ–‡ä»¶ç³»ç»Ÿéå¸¸ç›¸ä¼¼ï¼Œéƒ½æ˜¯åœ¨æ ¹èŠ‚ç‚¹ä¸‹æŒ‚å¾ˆå¤šå­èŠ‚ç‚¹(æ ‘å‹)ã€‚ä½†æ˜¯ zookeeper ä¸­æ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿä¸­ç›®å½•ä¸æ–‡ä»¶çš„æ¦‚å¿µï¼Œè€Œæ˜¯ ä½¿ç”¨äº† znode ä½œä¸ºæ•°æ®èŠ‚ç‚¹ ã€‚znode æ˜¯ zookeeper ä¸­çš„æœ€å°æ•°æ®å•å…ƒï¼Œæ¯ä¸ª znode ä¸Šéƒ½å¯ä»¥ä¿å­˜æ•°æ®ï¼ŒåŒæ—¶è¿˜å¯ä»¥æŒ‚è½½å­èŠ‚ç‚¹ï¼Œå½¢æˆä¸€ä¸ªæ ‘å½¢åŒ–å‘½åç©ºé—´ã€‚\næ¯ä¸ª znode éƒ½æœ‰è‡ªå·±æ‰€å±çš„ èŠ‚ç‚¹ç±»å‹ å’Œ èŠ‚ç‚¹çŠ¶æ€ã€‚\nå…¶ä¸­èŠ‚ç‚¹ç±»å‹å¯ä»¥åˆ†ä¸º æŒä¹…èŠ‚ç‚¹ã€æŒä¹…é¡ºåºèŠ‚ç‚¹ã€ä¸´æ—¶èŠ‚ç‚¹ å’Œ ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ã€‚\næŒä¹…èŠ‚ç‚¹ï¼šä¸€æ—¦åˆ›å»ºå°±ä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°å°†å…¶åˆ é™¤ã€‚ æŒä¹…é¡ºåºèŠ‚ç‚¹ï¼šä¸€ä¸ªçˆ¶èŠ‚ç‚¹å¯ä»¥ä¸ºå…¶å­èŠ‚ç‚¹ ç»´æŠ¤ä¸€ä¸ªåˆ›å»ºçš„å…ˆåé¡ºåº ï¼Œè¿™ä¸ªé¡ºåºä½“ç°åœ¨ èŠ‚ç‚¹åç§° ä¸Šï¼Œæ˜¯èŠ‚ç‚¹åç§°åè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªç”± 10 ä½æ•°å­—ç»„æˆçš„æ•°å­—ä¸²ï¼Œä» 0 å¼€å§‹è®¡æ•°ã€‚ ä¸´æ—¶èŠ‚ç‚¹ï¼šä¸´æ—¶èŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸ å®¢æˆ·ç«¯ä¼šè¯ ç»‘å®šçš„ï¼Œä¼šè¯æ¶ˆå¤±åˆ™èŠ‚ç‚¹æ¶ˆå¤± ã€‚ä¸´æ—¶èŠ‚ç‚¹ åªèƒ½åšå¶å­èŠ‚ç‚¹ ï¼Œä¸èƒ½åˆ›å»ºå­èŠ‚ç‚¹ã€‚ ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼šçˆ¶èŠ‚ç‚¹å¯ä»¥åˆ›å»ºä¸€ä¸ªç»´æŒäº†é¡ºåºçš„ä¸´æ—¶èŠ‚ç‚¹(å’Œå‰é¢çš„æŒä¹…é¡ºåºæ€§èŠ‚ç‚¹ä¸€æ ·)ã€‚ èŠ‚ç‚¹çŠ¶æ€ä¸­åŒ…å«äº†å¾ˆå¤šèŠ‚ç‚¹çš„å±æ€§æ¯”å¦‚ czxid ã€mzxid ç­‰ç­‰ï¼Œåœ¨ zookeeper ä¸­æ˜¯ä½¿ç”¨ Stat è¿™ä¸ªç±»æ¥ç»´æŠ¤çš„ã€‚ä¸‹é¢æˆ‘åˆ—ä¸¾ä¸€äº›å±æ€§è§£é‡Šã€‚\nczxidï¼šCreated ZXIDï¼Œè¯¥æ•°æ®èŠ‚ç‚¹è¢« åˆ›å»º æ—¶çš„äº‹åŠ¡IDã€‚ mzxidï¼šModified ZXIDï¼ŒèŠ‚ç‚¹ æœ€åä¸€æ¬¡è¢«æ›´æ–°æ—¶ çš„äº‹åŠ¡IDã€‚ ctimeï¼šCreated Timeï¼Œè¯¥èŠ‚ç‚¹è¢«åˆ›å»ºçš„æ—¶é—´ã€‚ mtimeï¼š Modified Timeï¼Œè¯¥èŠ‚ç‚¹æœ€åä¸€æ¬¡è¢«ä¿®æ”¹çš„æ—¶é—´ã€‚ versionï¼šèŠ‚ç‚¹çš„ç‰ˆæœ¬å·ã€‚ cversionï¼šå­èŠ‚ç‚¹ çš„ç‰ˆæœ¬å·ã€‚ aversionï¼šèŠ‚ç‚¹çš„ ACL ç‰ˆæœ¬å·ã€‚ ephemeralOwnerï¼šåˆ›å»ºè¯¥èŠ‚ç‚¹çš„ä¼šè¯çš„ sessionID ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹ä¸ºæŒä¹…èŠ‚ç‚¹ï¼Œè¯¥å€¼ä¸º0ã€‚ dataLengthï¼šèŠ‚ç‚¹æ•°æ®å†…å®¹çš„é•¿åº¦ã€‚ numChildreï¼šè¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•°ï¼Œå¦‚æœä¸ºä¸´æ—¶èŠ‚ç‚¹ä¸º0ã€‚ pzxidï¼šè¯¥èŠ‚ç‚¹å­èŠ‚ç‚¹åˆ—è¡¨æœ€åä¸€æ¬¡è¢«ä¿®æ”¹æ—¶çš„äº‹åŠ¡IDï¼Œæ³¨æ„æ˜¯å­èŠ‚ç‚¹çš„ åˆ—è¡¨ ï¼Œä¸æ˜¯å†…å®¹ã€‚ 6.2. ä¼šè¯ # æˆ‘æƒ³è¿™ä¸ªå¯¹äºåç«¯å¼€å‘çš„æœ‹å‹è‚¯å®šä¸é™Œç”Ÿï¼Œä¸å°±æ˜¯ session å—ï¼Ÿåªä¸è¿‡ zk å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ˜¯é€šè¿‡ TCP é•¿è¿æ¥ ç»´æŒçš„ä¼šè¯æœºåˆ¶ï¼Œå…¶å®å¯¹äºä¼šè¯æ¥è¯´ä½ å¯ä»¥ç†è§£ä¸º ä¿æŒè¿æ¥çŠ¶æ€ ã€‚\nåœ¨ zookeeper ä¸­ï¼Œä¼šè¯è¿˜æœ‰å¯¹åº”çš„äº‹ä»¶ï¼Œæ¯”å¦‚ CONNECTION_LOSS è¿æ¥ä¸¢å¤±äº‹ä»¶ ã€SESSION_MOVED ä¼šè¯è½¬ç§»äº‹ä»¶ ã€SESSION_EXPIRED ä¼šè¯è¶…æ—¶å¤±æ•ˆäº‹ä»¶ ã€‚\n6.3. ACL # ACL ä¸º Access Control Lists ï¼Œå®ƒæ˜¯ä¸€ç§æƒé™æ§åˆ¶ã€‚åœ¨ zookeeper ä¸­å®šä¹‰äº†5ç§æƒé™ï¼Œå®ƒä»¬åˆ†åˆ«ä¸ºï¼š\nCREATE ï¼šåˆ›å»ºå­èŠ‚ç‚¹çš„æƒé™ã€‚ READï¼šè·å–èŠ‚ç‚¹æ•°æ®å’Œå­èŠ‚ç‚¹åˆ—è¡¨çš„æƒé™ã€‚ WRITEï¼šæ›´æ–°èŠ‚ç‚¹æ•°æ®çš„æƒé™ã€‚ DELETEï¼šåˆ é™¤å­èŠ‚ç‚¹çš„æƒé™ã€‚ ADMINï¼šè®¾ç½®èŠ‚ç‚¹ ACL çš„æƒé™ã€‚ 6.4. Watcheræœºåˆ¶ # Watcher ä¸ºäº‹ä»¶ç›‘å¬å™¨ï¼Œæ˜¯ zk éå¸¸é‡è¦çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå¾ˆå¤šåŠŸèƒ½éƒ½ä¾èµ–äºå®ƒï¼Œå®ƒæœ‰ç‚¹ç±»ä¼¼äºè®¢é˜…çš„æ–¹å¼ï¼Œå³å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯ æ³¨å†Œ æŒ‡å®šçš„ watcher ï¼Œå½“æœåŠ¡ç«¯ç¬¦åˆäº† watcher çš„æŸäº›äº‹ä»¶æˆ–è¦æ±‚åˆ™ä¼š å‘å®¢æˆ·ç«¯å‘é€äº‹ä»¶é€šçŸ¥ ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°é€šçŸ¥åæ‰¾åˆ°è‡ªå·±å®šä¹‰çš„ Watcher ç„¶å æ‰§è¡Œç›¸åº”çš„å›è°ƒæ–¹æ³• ã€‚\n7. Zookeeperçš„å‡ ä¸ªå…¸å‹åº”ç”¨åœºæ™¯ # å‰é¢è¯´äº†è¿™ä¹ˆå¤šçš„ç†è®ºçŸ¥è¯†ï¼Œä½ å¯èƒ½å¬å¾—ä¸€å¤´é›¾æ°´ï¼Œè¿™äº›ç©æ„æœ‰å•¥ç”¨ï¼Ÿèƒ½å¹²å•¥äº‹ï¼Ÿåˆ«æ€¥ï¼Œå¬æˆ‘æ…¢æ…¢é“æ¥ã€‚\n7.1. é€‰ä¸» # è¿˜è®°å¾—ä¸Šé¢æˆ‘ä»¬çš„æ‰€è¯´çš„ä¸´æ—¶èŠ‚ç‚¹å—ï¼Ÿå› ä¸º Zookeeper çš„å¼ºä¸€è‡´æ€§ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°åœ¨ä¿è¯ åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ä¿è¯èŠ‚ç‚¹åˆ›å»ºçš„å…¨å±€å”¯ä¸€æ€§ (å³æ— æ³•é‡å¤åˆ›å»ºåŒæ ·çš„èŠ‚ç‚¹)ã€‚\nåˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ è®©å¤šä¸ªå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªæŒ‡å®šçš„èŠ‚ç‚¹ ï¼Œåˆ›å»ºæˆåŠŸçš„å°±æ˜¯ masterã€‚\nä½†æ˜¯ï¼Œå¦‚æœè¿™ä¸ª master æŒ‚äº†æ€ä¹ˆåŠï¼Ÿï¼Ÿï¼Ÿ\nä½ æƒ³æƒ³ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹ï¼Ÿè¿˜è®°å¾—ä¸´æ—¶èŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸå—ï¼Ÿmaster æŒ‚äº†æ˜¯ä¸æ˜¯ä»£è¡¨ä¼šè¯æ–­äº†ï¼Ÿä¼šè¯æ–­äº†æ˜¯ä¸æ˜¯æ„å‘³ç€è¿™ä¸ªèŠ‚ç‚¹æ²¡äº†ï¼Ÿè¿˜è®°å¾— watcher å—ï¼Ÿæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥ è®©å…¶ä»–ä¸æ˜¯ master çš„èŠ‚ç‚¹ç›‘å¬èŠ‚ç‚¹çš„çŠ¶æ€ ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬ç›‘å¬è¿™ä¸ªä¸´æ—¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œå¦‚æœå­èŠ‚ç‚¹ä¸ªæ•°å˜äº†å°±ä»£è¡¨ master æŒ‚äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ è§¦å‘å›è°ƒå‡½æ•°è¿›è¡Œé‡æ–°é€‰ä¸¾ ï¼Œæˆ–è€…æˆ‘ä»¬ç›´æ¥ç›‘å¬èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡èŠ‚ç‚¹æ˜¯å¦å·²ç»å¤±å»è¿æ¥æ¥åˆ¤æ–­ master æ˜¯å¦æŒ‚äº†ç­‰ç­‰ã€‚\næ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å®Œå…¨ åˆ©ç”¨ ä¸´æ—¶èŠ‚ç‚¹ã€èŠ‚ç‚¹çŠ¶æ€ å’Œ watcher æ¥å®ç°é€‰ä¸»çš„åŠŸèƒ½ï¼Œä¸´æ—¶èŠ‚ç‚¹ä¸»è¦ç”¨æ¥é€‰ä¸¾ï¼ŒèŠ‚ç‚¹çŠ¶æ€å’Œ**watcher** å¯ä»¥ç”¨æ¥åˆ¤æ–­ master çš„æ´»æ€§å’Œè¿›è¡Œé‡æ–°é€‰ä¸¾ã€‚\n7.2. åˆ†å¸ƒå¼é” # åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚ Redis ã€æ•°æ®åº“ ã€zookeeper ç­‰ã€‚ä¸ªäººè®¤ä¸º zookeeper åœ¨å®ç°åˆ†å¸ƒå¼é”è¿™æ–¹é¢æ˜¯éå¸¸éå¸¸ç®€å•çš„ã€‚\nä¸Šé¢æˆ‘ä»¬å·²ç»æåˆ°è¿‡äº† zkåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ä¿è¯èŠ‚ç‚¹åˆ›å»ºçš„å…¨å±€å”¯ä¸€æ€§ï¼Œè¿™ç©æ„ä¸€çœ‹å°±çŸ¥é“èƒ½å¹²å•¥äº†ã€‚å®ç°äº’æ–¥é”å‘—ï¼Œåˆå› ä¸ºèƒ½åœ¨åˆ†å¸ƒå¼çš„æƒ…å†µä¸‹ï¼Œæ‰€ä»¥èƒ½å®ç°åˆ†å¸ƒå¼é”å‘—ã€‚\nå¦‚ä½•å®ç°å‘¢ï¼Ÿè¿™ç©æ„å…¶å®è·Ÿé€‰ä¸»åŸºæœ¬ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨ä¸´æ—¶èŠ‚ç‚¹çš„åˆ›å»ºæ¥å®ç°ã€‚\né¦–å…ˆè‚¯å®šæ˜¯å¦‚ä½•è·å–é”ï¼Œå› ä¸ºåˆ›å»ºèŠ‚ç‚¹çš„å”¯ä¸€æ€§ï¼Œæˆ‘ä»¬å¯ä»¥è®©å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶åˆ›å»ºä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ï¼Œåˆ›å»ºæˆåŠŸçš„å°±è¯´æ˜è·å–åˆ°äº†é” ã€‚ç„¶åæ²¡æœ‰è·å–åˆ°é”çš„å®¢æˆ·ç«¯ä¹Ÿåƒä¸Šé¢é€‰ä¸»çš„éä¸»èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ª watcher è¿›è¡ŒèŠ‚ç‚¹çŠ¶æ€çš„ç›‘å¬ï¼Œå¦‚æœè¿™ä¸ªäº’æ–¥é”è¢«é‡Šæ”¾äº†ï¼ˆå¯èƒ½è·å–é”çš„å®¢æˆ·ç«¯å®•æœºäº†ï¼Œæˆ–è€…é‚£ä¸ªå®¢æˆ·ç«¯ä¸»åŠ¨é‡Šæ”¾äº†é”ï¼‰å¯ä»¥è°ƒç”¨å›è°ƒå‡½æ•°é‡æ–°è·å¾—é”ã€‚\nzk ä¸­ä¸éœ€è¦å‘ redis é‚£æ ·è€ƒè™‘é”å¾—ä¸åˆ°é‡Šæ”¾çš„é—®é¢˜äº†ï¼Œå› ä¸ºå½“å®¢æˆ·ç«¯æŒ‚äº†ï¼ŒèŠ‚ç‚¹ä¹ŸæŒ‚äº†ï¼Œé”ä¹Ÿé‡Šæ”¾äº†ã€‚æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿ\né‚£èƒ½ä¸èƒ½ä½¿ç”¨ zookeeper åŒæ—¶å®ç° å…±äº«é”å’Œç‹¬å é” å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œä¸è¿‡ç¨å¾®æœ‰ç‚¹å¤æ‚è€Œå·²ã€‚\nè¿˜è®°å¾— æœ‰åºçš„èŠ‚ç‚¹ å—ï¼Ÿ\nè¿™ä¸ªæ—¶å€™æˆ‘è§„å®šæ‰€æœ‰åˆ›å»ºèŠ‚ç‚¹å¿…é¡»æœ‰åºï¼Œå½“ä½ æ˜¯è¯»è¯·æ±‚ï¼ˆè¦è·å–å…±äº«é”ï¼‰çš„è¯ï¼Œå¦‚æœ æ²¡æœ‰æ¯”è‡ªå·±æ›´å°çš„èŠ‚ç‚¹ï¼Œæˆ–æ¯”è‡ªå·±å°çš„èŠ‚ç‚¹éƒ½æ˜¯è¯»è¯·æ±‚ ï¼Œåˆ™å¯ä»¥è·å–åˆ°è¯»é”ï¼Œç„¶åå°±å¯ä»¥å¼€å§‹è¯»äº†ã€‚è‹¥æ¯”è‡ªå·±å°çš„èŠ‚ç‚¹ä¸­æœ‰å†™è¯·æ±‚ ï¼Œåˆ™å½“å‰å®¢æˆ·ç«¯æ— æ³•è·å–åˆ°è¯»é”ï¼Œåªèƒ½ç­‰å¾…å‰é¢çš„å†™è¯·æ±‚å®Œæˆã€‚\nå¦‚æœä½ æ˜¯å†™è¯·æ±‚ï¼ˆè·å–ç‹¬å é”ï¼‰ï¼Œè‹¥ æ²¡æœ‰æ¯”è‡ªå·±æ›´å°çš„èŠ‚ç‚¹ ï¼Œåˆ™è¡¨ç¤ºå½“å‰å®¢æˆ·ç«¯å¯ä»¥ç›´æ¥è·å–åˆ°å†™é”ï¼Œå¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚è‹¥å‘ç° æœ‰æ¯”è‡ªå·±æ›´å°çš„èŠ‚ç‚¹ï¼Œæ— è®ºæ˜¯è¯»æ“ä½œè¿˜æ˜¯å†™æ“ä½œï¼Œå½“å‰å®¢æˆ·ç«¯éƒ½æ— æ³•è·å–åˆ°å†™é” ï¼Œç­‰å¾…æ‰€æœ‰å‰é¢çš„æ“ä½œå®Œæˆã€‚\nè¿™å°±å¾ˆå¥½åœ°åŒæ—¶å®ç°äº†å…±äº«é”å’Œç‹¬å é”ï¼Œå½“ç„¶è¿˜æœ‰ä¼˜åŒ–çš„åœ°æ–¹ï¼Œæ¯”å¦‚å½“ä¸€ä¸ªé”å¾—åˆ°é‡Šæ”¾å®ƒä¼šé€šçŸ¥æ‰€æœ‰ç­‰å¾…çš„å®¢æˆ·ç«¯ä»è€Œé€ æˆ ç¾Šç¾¤æ•ˆåº” ã€‚æ­¤æ—¶ä½ å¯ä»¥é€šè¿‡è®©ç­‰å¾…çš„èŠ‚ç‚¹åªç›‘å¬ä»–ä»¬å‰é¢çš„èŠ‚ç‚¹ã€‚\nå…·ä½“æ€ä¹ˆåšå‘¢ï¼Ÿå…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œä½ å¯ä»¥è®© è¯»è¯·æ±‚ç›‘å¬æ¯”è‡ªå·±å°çš„æœ€åä¸€ä¸ªå†™è¯·æ±‚èŠ‚ç‚¹ï¼Œå†™è¯·æ±‚åªç›‘å¬æ¯”è‡ªå·±å°çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªå·±å»ç ”ç©¶ä¸€ä¸‹ã€‚\n7.3. å‘½åæœåŠ¡ # å¦‚ä½•ç»™ä¸€ä¸ªå¯¹è±¡è®¾ç½®IDï¼Œå¤§å®¶å¯èƒ½éƒ½ä¼šæƒ³åˆ° UUIDï¼Œä½†æ˜¯ UUID æœ€å¤§çš„é—®é¢˜å°±åœ¨äºå®ƒå¤ªé•¿äº†ã€‚ã€‚ã€‚(å¤ªé•¿ä¸ä¸€å®šæ˜¯å¥½äº‹ï¼Œå˜¿å˜¿å˜¿)ã€‚é‚£ä¹ˆåœ¨æ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½ä½¿ç”¨ zookeeper æ¥å®ç°å‘¢ï¼Ÿ\næˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡ zookeeper æ˜¯é€šè¿‡ æ ‘å½¢ç»“æ„ æ¥å­˜å‚¨æ•°æ®èŠ‚ç‚¹çš„ï¼Œé‚£ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹çš„ å…¨è·¯å¾„ï¼Œå®ƒå¿…å®šæ˜¯å”¯ä¸€çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨èŠ‚ç‚¹çš„å…¨è·¯å¾„ä½œä¸ºå‘½åæ–¹å¼äº†ã€‚è€Œä¸”æ›´é‡è¦çš„æ˜¯ï¼Œè·¯å¾„æ˜¯æˆ‘ä»¬å¯ä»¥è‡ªå·±å®šä¹‰çš„ï¼Œè¿™å¯¹äºæˆ‘ä»¬å¯¹æœ‰äº›æœ‰è¯­æ„çš„å¯¹è±¡çš„IDè®¾ç½®å¯ä»¥æ›´åŠ ä¾¿äºç†è§£ã€‚\n7.4. é›†ç¾¤ç®¡ç†å’Œæ³¨å†Œä¸­å¿ƒ # çœ‹åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯è§‰å¾— zookeeper å®åœ¨æ˜¯å¤ªå¼ºå¤§äº†ï¼Œå®ƒæ€ä¹ˆèƒ½è¿™ä¹ˆèƒ½å¹²ï¼\nåˆ«æ€¥ï¼Œå®ƒèƒ½å¹²çš„äº‹æƒ…è¿˜å¾ˆå¤šå‘¢ã€‚å¯èƒ½æˆ‘ä»¬ä¼šæœ‰è¿™æ ·çš„éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£æ•´ä¸ªé›†ç¾¤ä¸­æœ‰å¤šå°‘æœºå™¨åœ¨å·¥ä½œï¼Œæˆ‘ä»¬æƒ³å¯¹é›†ç¾¤ä¸­çš„æ¯å°æœºå™¨çš„è¿è¡Œæ—¶çŠ¶æ€è¿›è¡Œæ•°æ®é‡‡é›†ï¼Œå¯¹é›†ç¾¤ä¸­æœºå™¨è¿›è¡Œä¸Šä¸‹çº¿æ“ä½œç­‰ç­‰ã€‚\nè€Œ zookeeper å¤©ç„¶æ”¯æŒçš„ watcher å’Œ ä¸´æ—¶èŠ‚ç‚¹èƒ½å¾ˆå¥½çš„å®ç°è¿™äº›éœ€æ±‚ã€‚æˆ‘ä»¬å¯ä»¥ä¸ºæ¯æ¡æœºå™¨åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹ï¼Œå¹¶ç›‘æ§å…¶çˆ¶èŠ‚ç‚¹ï¼Œå¦‚æœå­èŠ‚ç‚¹åˆ—è¡¨æœ‰å˜åŠ¨ï¼ˆæˆ‘ä»¬å¯èƒ½åˆ›å»ºåˆ é™¤äº†ä¸´æ—¶èŠ‚ç‚¹ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åœ¨å…¶çˆ¶èŠ‚ç‚¹ç»‘å®šçš„ watcher è¿›è¡ŒçŠ¶æ€ç›‘æ§å’Œå›è°ƒã€‚\nè‡³äºæ³¨å†Œä¸­å¿ƒä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬åŒæ ·ä¹Ÿæ˜¯è®© æœåŠ¡æä¾›è€… åœ¨ zookeeper ä¸­åˆ›å»ºä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹å¹¶ä¸”å°†è‡ªå·±çš„ ipã€portã€è°ƒç”¨æ–¹å¼ å†™å…¥èŠ‚ç‚¹ï¼Œå½“ æœåŠ¡æ¶ˆè´¹è€… éœ€è¦è¿›è¡Œè°ƒç”¨çš„æ—¶å€™ä¼š é€šè¿‡æ³¨å†Œä¸­å¿ƒæ‰¾åˆ°ç›¸åº”çš„æœåŠ¡çš„åœ°å€åˆ—è¡¨(IPç«¯å£ä»€ä¹ˆçš„) ï¼Œå¹¶ç¼“å­˜åˆ°æœ¬åœ°(æ–¹ä¾¿ä»¥åè°ƒç”¨)ï¼Œå½“æ¶ˆè´¹è€…è°ƒç”¨æœåŠ¡æ—¶ï¼Œä¸ä¼šå†å»è¯·æ±‚æ³¨å†Œä¸­å¿ƒï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡è´Ÿè½½å‡è¡¡ç®—æ³•ä»åœ°å€åˆ—è¡¨ä¸­å–ä¸€ä¸ªæœåŠ¡æä¾›è€…çš„æœåŠ¡å™¨è°ƒç”¨æœåŠ¡ã€‚\nå½“æœåŠ¡æä¾›è€…çš„æŸå°æœåŠ¡å™¨å®•æœºæˆ–ä¸‹çº¿æ—¶ï¼Œç›¸åº”çš„åœ°å€ä¼šä»æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ç§»é™¤ã€‚åŒæ—¶ï¼Œæ³¨å†Œä¸­å¿ƒä¼šå°†æ–°çš„æœåŠ¡åœ°å€åˆ—è¡¨å‘é€ç»™æœåŠ¡æ¶ˆè´¹è€…çš„æœºå™¨å¹¶ç¼“å­˜åœ¨æ¶ˆè´¹è€…æœ¬æœºï¼ˆå½“ç„¶ä½ å¯ä»¥è®©æ¶ˆè´¹è€…è¿›è¡ŒèŠ‚ç‚¹ç›‘å¬ï¼Œæˆ‘è®°å¾— Eureka ä¼šå…ˆè¯•é”™ï¼Œç„¶åå†æ›´æ–°ï¼‰ã€‚\n8. æ€»ç»“ # çœ‹åˆ°è¿™é‡Œçš„åŒå­¦å®åœ¨æ˜¯å¤ªæœ‰è€å¿ƒäº†ğŸ‘ğŸ‘ğŸ‘ï¼Œå¦‚æœè§‰å¾—æˆ‘å†™å¾—ä¸é”™çš„è¯ç‚¹ä¸ªèµå“ˆã€‚\nä¸çŸ¥é“å¤§å®¶æ˜¯å¦è¿˜è®°å¾—æˆ‘è®²äº†ä»€ä¹ˆğŸ˜’ã€‚\nè¿™ç¯‡æ–‡ç« ä¸­æˆ‘å¸¦å¤§å®¶å…¥é—¨äº† zookeeper è¿™ä¸ªå¼ºå¤§çš„åˆ†å¸ƒå¼åè°ƒæ¡†æ¶ã€‚ç°åœ¨æˆ‘ä»¬æ¥ç®€å•æ¢³ç†ä¸€ä¸‹æ•´ç¯‡æ–‡ç« çš„å†…å®¹ã€‚\nåˆ†å¸ƒå¼ä¸é›†ç¾¤çš„åŒºåˆ«\n2PC ã€3PC ä»¥åŠ paxos ç®—æ³•è¿™äº›ä¸€è‡´æ€§æ¡†æ¶çš„åŸç†å’Œå®ç°ã€‚\nzookeeper ä¸“é—¨çš„ä¸€è‡´æ€§ç®—æ³• ZAB åŸå­å¹¿æ’­åè®®çš„å†…å®¹ï¼ˆLeader é€‰ä¸¾ã€å´©æºƒæ¢å¤ã€æ¶ˆæ¯å¹¿æ’­ï¼‰ã€‚\nzookeeper ä¸­çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼Œæ¯”å¦‚ ACLï¼Œæ•°æ®èŠ‚ç‚¹ï¼Œä¼šè¯ï¼Œwatcheræœºåˆ¶ç­‰ç­‰ã€‚\nzookeeper çš„å…¸å‹åº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚é€‰ä¸»ï¼Œæ³¨å†Œä¸­å¿ƒç­‰ç­‰ã€‚\nå¦‚æœå¿˜äº†å¯ä»¥å›å»çœ‹çœ‹å†æ¬¡ç†è§£ä¸€ä¸‹ï¼Œå¦‚æœæœ‰ç–‘é—®å’Œå»ºè®®æ¬¢è¿æå‡ºğŸ¤ğŸ¤ğŸ¤ã€‚\n"},{"id":82,"href":"/zh/docs/study/Review/java_guide/lydly_distributed_system/ly06ly_zookeeper-intro/","title":"zookeeperä»‹ç»","section":"åˆ†å¸ƒå¼ç³»ç»Ÿ","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\n1. å‰è¨€ # ç›¸ä¿¡å¤§å®¶å¯¹ ZooKeeper åº”è¯¥ä¸ç®—é™Œç”Ÿã€‚ä½†æ˜¯ä½ çœŸçš„äº†è§£ ZooKeeper åˆ°åº•æœ‰å•¥ç”¨ä¸ï¼Ÿå¦‚æœåˆ«äºº/é¢è¯•å®˜è®©ä½ ç»™ä»–è®²è®²å¯¹äº ZooKeeper çš„è®¤è¯†ï¼Œä½ èƒ½å›ç­”åˆ°ä»€ä¹ˆåœ°æ­¥å‘¢ï¼Ÿ\næ‹¿æˆ‘è‡ªå·±æ¥è¯´å§ï¼æˆ‘æœ¬äººæ›¾ç»ä½¿ç”¨ Dubbo æ¥åšåˆ†å¸ƒå¼é¡¹ç›®çš„æ—¶å€™ï¼Œä½¿ç”¨äº† ZooKeeper ä½œä¸ºæ³¨å†Œä¸­å¿ƒã€‚ä¸ºäº†ä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿèƒ½å¤ŸåŒæ­¥è®¿é—®æŸä¸ªèµ„æºï¼Œæˆ‘è¿˜ä½¿ç”¨ ZooKeeper åšè¿‡åˆ†å¸ƒå¼é”ã€‚å¦å¤–ï¼Œæˆ‘åœ¨å­¦ä¹  Kafka çš„æ—¶å€™ï¼ŒçŸ¥é“ Kafka å¾ˆå¤šåŠŸèƒ½çš„å®ç°ä¾èµ–äº† ZooKeeperã€‚\nå‰å‡ å¤©ï¼Œæ€»ç»“é¡¹ç›®ç»éªŒçš„æ—¶å€™ï¼Œæˆ‘çªç„¶é—®è‡ªå·± ZooKeeper åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Ÿæƒ³äº†åŠå¤©ï¼Œè„‘æµ·ä¸­åªæ˜¯ç®€å•çš„èƒ½æµ®ç°å‡ºå‡ å¥è¯ï¼š\nZooKeeper å¯ä»¥è¢«ç”¨ä½œæ³¨å†Œä¸­å¿ƒã€åˆ†å¸ƒå¼é”ï¼› ZooKeeper æ˜¯ Hadoop ç”Ÿæ€ç³»ç»Ÿçš„ä¸€å‘˜ï¼› æ„å»º ZooKeeper é›†ç¾¤çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æœåŠ¡å™¨æœ€å¥½æ˜¯å¥‡æ•°å°ã€‚ ç”±æ­¤å¯è§ï¼Œæˆ‘å¯¹äº ZooKeeper çš„ç†è§£ä»…ä»…æ˜¯åœç•™åœ¨äº†è¡¨é¢ã€‚\næ‰€ä»¥ï¼Œé€šè¿‡æœ¬æ–‡ï¼Œå¸Œæœ›å¸¦å¤§å®¶ç¨å¾®è¯¦ç»†çš„äº†è§£ä¸€ä¸‹ ZooKeeper ã€‚å¦‚æœæ²¡æœ‰å­¦è¿‡ ZooKeeper ï¼Œé‚£ä¹ˆæœ¬æ–‡å°†ä¼šæ˜¯ä½ è¿›å…¥ ZooKeeper å¤§é—¨çš„å«è„šç –ã€‚å¦‚æœä½ å·²ç»æ¥è§¦è¿‡ ZooKeeper ï¼Œé‚£ä¹ˆæœ¬æ–‡å°†å¸¦ä½ å›é¡¾ä¸€ä¸‹ ZooKeeper çš„ä¸€äº›åŸºç¡€æ¦‚å¿µã€‚\nå¦å¤–ï¼Œæœ¬æ–‡ä¸å…‰ä¼šæ¶‰åŠåˆ° ZooKeeper çš„ä¸€äº›æ¦‚å¿µï¼Œåé¢çš„æ–‡ç« ä¼šä»‹ç»åˆ° ZooKeeper å¸¸è§å‘½ä»¤çš„ä½¿ç”¨ä»¥åŠä½¿ç”¨ Apache Curator ä½œä¸º ZooKeeper çš„å®¢æˆ·ç«¯ã€‚\nå¦‚æœæ–‡ç« æœ‰ä»»ä½•éœ€è¦æ”¹å–„å’Œå®Œå–„çš„åœ°æ–¹ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡å‡ºï¼Œå…±åŒè¿›æ­¥ï¼\n2. ZooKeeper ä»‹ç» # 2.1. ZooKeeper ç”±æ¥ # æ­£å¼ä»‹ç» ZooKeeper ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ ZooKeeper çš„ç”±æ¥ï¼Œè¿˜æŒºæœ‰æ„æ€çš„ã€‚\nä¸‹é¢è¿™æ®µå†…å®¹æ‘˜è‡ªã€Šä» Paxos åˆ° ZooKeeper ã€‹ç¬¬å››ç« ç¬¬ä¸€èŠ‚ï¼Œæ¨èå¤§å®¶é˜…è¯»ä¸€ä¸‹ï¼š\nZooKeeper æœ€æ—©èµ·æºäºé›…è™ç ”ç©¶é™¢çš„ä¸€ä¸ªç ”ç©¶å°ç»„ã€‚åœ¨å½“æ—¶ï¼Œç ”ç©¶äººå‘˜å‘ç°ï¼Œåœ¨é›…è™å†…éƒ¨å¾ˆå¤šå¤§å‹ç³»ç»ŸåŸºæœ¬éƒ½éœ€è¦ä¾èµ–ä¸€ä¸ªç±»ä¼¼çš„ç³»ç»Ÿæ¥è¿›è¡Œåˆ†å¸ƒå¼åè°ƒï¼Œä½†æ˜¯è¿™äº›ç³»ç»Ÿå¾€å¾€éƒ½å­˜åœ¨åˆ†å¸ƒå¼å•ç‚¹é—®é¢˜ã€‚æ‰€ä»¥ï¼Œé›…è™çš„å¼€å‘äººå‘˜å°±è¯•å›¾å¼€å‘ä¸€ä¸ªé€šç”¨çš„æ— å•ç‚¹é—®é¢˜çš„åˆ†å¸ƒå¼åè°ƒæ¡†æ¶ï¼Œä»¥ä¾¿è®©å¼€å‘äººå‘˜å°†ç²¾åŠ›é›†ä¸­åœ¨å¤„ç†ä¸šåŠ¡é€»è¾‘ä¸Šã€‚\nå…³äºâ€œZooKeeperâ€è¿™ä¸ªé¡¹ç›®çš„åå­—ï¼Œå…¶å®ä¹Ÿæœ‰ä¸€æ®µè¶£é—»ã€‚åœ¨ç«‹é¡¹åˆæœŸï¼Œè€ƒè™‘åˆ°ä¹‹å‰å†…éƒ¨å¾ˆå¤šé¡¹ç›®éƒ½æ˜¯ä½¿ç”¨åŠ¨ç‰©çš„åå­—æ¥å‘½åçš„ï¼ˆä¾‹å¦‚è‘—åçš„ Pig é¡¹ç›®),é›…è™çš„å·¥ç¨‹å¸ˆå¸Œæœ›ç»™è¿™ä¸ªé¡¹ç›®ä¹Ÿå–ä¸€ä¸ªåŠ¨ç‰©çš„åå­—ã€‚æ—¶ä»»ç ”ç©¶é™¢çš„é¦–å¸­ç§‘å­¦å®¶ RaghuRamakrishnan å¼€ç©ç¬‘åœ°è¯´ï¼šâ€œåœ¨è¿™æ ·ä¸‹å»ï¼Œæˆ‘ä»¬è¿™å„¿å°±å˜æˆåŠ¨ç‰©å›­äº†ï¼â€æ­¤è¯ä¸€å‡ºï¼Œå¤§å®¶çº·çº·è¡¨ç¤ºå°±å«åŠ¨ç‰©å›­ç®¡ç†å‘˜å§ä¸€ä¸€ä¸€å› ä¸ºå„ä¸ªä»¥åŠ¨ç‰©å‘½åçš„åˆ†å¸ƒå¼ç»„ä»¶æ”¾åœ¨ä¸€èµ·ï¼Œé›…è™çš„æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçœ‹ä¸Šå»å°±åƒä¸€ä¸ªå¤§å‹çš„åŠ¨ç‰©å›­äº†ï¼Œè€Œ ZooKeeper æ­£å¥½è¦ç”¨æ¥è¿›è¡Œåˆ†å¸ƒå¼ç¯å¢ƒçš„åè°ƒä¸€ä¸€äºæ˜¯ï¼ŒZooKeeper çš„åå­—ä¹Ÿå°±ç”±æ­¤è¯ç”Ÿäº†ã€‚\n2.2. ZooKeeper æ¦‚è§ˆ # ZooKeeper æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œå®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯å°†é‚£äº›å¤æ‚ä¸”å®¹æ˜“å‡ºé”™çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§æœåŠ¡å°è£…èµ·æ¥ï¼Œæ„æˆä¸€ä¸ªé«˜æ•ˆå¯é çš„åŸè¯­é›†ï¼Œå¹¶ä»¥ä¸€ç³»åˆ—ç®€å•æ˜“ç”¨çš„æ¥å£æä¾›ç»™ç”¨æˆ·ä½¿ç”¨ã€‚\nåŸè¯­ï¼š æ“ä½œç³»ç»Ÿæˆ–è®¡ç®—æœºç½‘ç»œç”¨è¯­èŒƒç•´ã€‚æ˜¯ç”±è‹¥å¹²æ¡æŒ‡ä»¤ç»„æˆçš„ï¼Œç”¨äºå®Œæˆä¸€å®šåŠŸèƒ½çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚å…·æœ‰ä¸å¯åˆ†å‰²æ€§Â·å³åŸè¯­çš„æ‰§è¡Œå¿…é¡»æ˜¯è¿ç»­çš„ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸å…è®¸è¢«ä¸­æ–­ã€‚\nZooKeeper ä¸ºæˆ‘ä»¬æä¾›äº†é«˜å¯ç”¨ã€é«˜æ€§èƒ½ã€ç¨³å®šçš„åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆï¼Œé€šå¸¸è¢«ç”¨äºå®ç°è¯¸å¦‚æ•°æ®å‘å¸ƒ/è®¢é˜…ã€è´Ÿè½½å‡è¡¡ã€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥ã€é›†ç¾¤ç®¡ç†ã€Master é€‰ä¸¾ã€åˆ†å¸ƒå¼é”å’Œåˆ†å¸ƒå¼é˜Ÿåˆ—ç­‰åŠŸèƒ½ã€‚\nå¦å¤–ï¼ŒZooKeeper å°†æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ€§èƒ½æ˜¯éå¸¸æ£’çš„ã€‚ åœ¨â€œè¯»â€å¤šäºâ€œå†™â€çš„åº”ç”¨ç¨‹åºä¸­å°¤å…¶åœ°é«˜æ€§èƒ½ï¼Œå› ä¸ºâ€œå†™â€ä¼šå¯¼è‡´æ‰€æœ‰çš„æœåŠ¡å™¨é—´åŒæ­¥çŠ¶æ€ã€‚ï¼ˆâ€œè¯»â€å¤šäºâ€œå†™â€æ˜¯åè°ƒæœåŠ¡çš„å…¸å‹åœºæ™¯ï¼‰ã€‚\n2.3. ZooKeeper ç‰¹ç‚¹ # é¡ºåºä¸€è‡´æ€§ï¼š ä»åŒä¸€å®¢æˆ·ç«¯å‘èµ·çš„äº‹åŠ¡è¯·æ±‚ï¼Œæœ€ç»ˆå°†ä¼šä¸¥æ ¼åœ°æŒ‰ç…§é¡ºåºè¢«åº”ç”¨åˆ° ZooKeeper ä¸­å»ã€‚ åŸå­æ€§ï¼š æ‰€æœ‰äº‹åŠ¡è¯·æ±‚çš„å¤„ç†ç»“æœåœ¨æ•´ä¸ªé›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨ä¸Šçš„åº”ç”¨æƒ…å†µæ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¦ä¹ˆæ•´ä¸ªé›†ç¾¤ä¸­æ‰€æœ‰çš„æœºå™¨éƒ½æˆåŠŸåº”ç”¨äº†æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè¦ä¹ˆéƒ½æ²¡æœ‰åº”ç”¨ã€‚ å•ä¸€ç³»ç»Ÿæ˜ åƒ ï¼š æ— è®ºå®¢æˆ·ç«¯è¿åˆ°å“ªä¸€ä¸ª ZooKeeper æœåŠ¡å™¨ä¸Šï¼Œå…¶çœ‹åˆ°çš„æœåŠ¡ç«¯æ•°æ®æ¨¡å‹éƒ½æ˜¯ä¸€è‡´çš„ã€‚ å¯é æ€§ï¼š ä¸€æ—¦ä¸€æ¬¡æ›´æ”¹è¯·æ±‚è¢«åº”ç”¨ï¼Œæ›´æ”¹çš„ç»“æœå°±ä¼šè¢«æŒä¹…åŒ–ï¼Œç›´åˆ°è¢«ä¸‹ä¸€æ¬¡æ›´æ”¹è¦†ç›–ã€‚ 2.4. ZooKeeper å…¸å‹åº”ç”¨åœºæ™¯ # ZooKeeper æ¦‚è§ˆä¸­ï¼Œæˆ‘ä»¬ä»‹ç»åˆ°ä½¿ç”¨å…¶é€šå¸¸è¢«ç”¨äºå®ç°è¯¸å¦‚æ•°æ®å‘å¸ƒ/è®¢é˜…ã€è´Ÿè½½å‡è¡¡ã€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥ã€é›†ç¾¤ç®¡ç†ã€Master é€‰ä¸¾ã€åˆ†å¸ƒå¼é”å’Œåˆ†å¸ƒå¼é˜Ÿåˆ—ç­‰åŠŸèƒ½ã€‚\nä¸‹é¢é€‰ 3 ä¸ªå…¸å‹çš„åº”ç”¨åœºæ™¯æ¥ä¸“é—¨è¯´è¯´ï¼š\nåˆ†å¸ƒå¼é” ï¼š é€šè¿‡åˆ›å»ºå”¯ä¸€èŠ‚ç‚¹è·å¾—åˆ†å¸ƒå¼é”ï¼Œå½“è·å¾—é”çš„ä¸€æ–¹æ‰§è¡Œå®Œç›¸å…³ä»£ç æˆ–è€…æ˜¯æŒ‚æ‰ä¹‹åå°±é‡Šæ”¾é”ã€‚ å‘½åæœåŠ¡ ï¼šå¯ä»¥é€šè¿‡ ZooKeeper çš„é¡ºåºèŠ‚ç‚¹ç”Ÿæˆå…¨å±€å”¯ä¸€ ID æ•°æ®å‘å¸ƒ/è®¢é˜… ï¼šé€šè¿‡ Watcher æœºåˆ¶ å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®ç°æ•°æ®å‘å¸ƒ/è®¢é˜…ã€‚å½“ä½ å°†æ•°æ®å‘å¸ƒåˆ° ZooKeeper è¢«ç›‘å¬çš„èŠ‚ç‚¹ä¸Šï¼Œå…¶ä»–æœºå™¨å¯é€šè¿‡ç›‘å¬ ZooKeeper ä¸ŠèŠ‚ç‚¹çš„å˜åŒ–æ¥å®ç°é…ç½®çš„åŠ¨æ€æ›´æ–°ã€‚ å®é™…ä¸Šï¼Œè¿™äº›åŠŸèƒ½çš„å®ç°åŸºæœ¬éƒ½å¾—ç›Šäº ZooKeeper å¯ä»¥ä¿å­˜æ•°æ®çš„åŠŸèƒ½ï¼Œä½†æ˜¯ ZooKeeper ä¸é€‚åˆä¿å­˜å¤§é‡æ•°æ®ï¼Œè¿™ä¸€ç‚¹éœ€è¦æ³¨æ„ã€‚\n2.5. æœ‰å“ªäº›è‘—åçš„å¼€æºé¡¹ç›®ç”¨åˆ°äº† ZooKeeper? # Kafka : ZooKeeper ä¸»è¦ä¸º Kafka æä¾› Broker å’Œ Topic çš„æ³¨å†Œä»¥åŠå¤šä¸ª Partition çš„è´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½ã€‚ Hbase : ZooKeeper ä¸º Hbase æä¾›ç¡®ä¿æ•´ä¸ªé›†ç¾¤åªæœ‰ä¸€ä¸ª Master ä»¥åŠä¿å­˜å’Œæä¾› regionserver çŠ¶æ€ä¿¡æ¯ï¼ˆæ˜¯å¦åœ¨çº¿ï¼‰ç­‰åŠŸèƒ½ã€‚ Hadoop : ZooKeeper ä¸º Namenode æä¾›é«˜å¯ç”¨æ”¯æŒã€‚ 3. ZooKeeper é‡è¦æ¦‚å¿µè§£è¯» # ç ´éŸ³ï¼šæ‹¿å‡ºå°æœ¬æœ¬ï¼Œä¸‹é¢çš„å†…å®¹éå¸¸é‡è¦å“¦ï¼\n3.1. Data modelï¼ˆæ•°æ®æ¨¡å‹ï¼‰ # ZooKeeper æ•°æ®æ¨¡å‹é‡‡ç”¨å±‚æ¬¡åŒ–çš„å¤šå‰æ ‘å½¢ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½å¯ä»¥å­˜å‚¨æ•°æ®ï¼Œè¿™äº›æ•°æ®å¯ä»¥æ˜¯æ•°å­—ã€å­—ç¬¦ä¸²æˆ–è€…æ˜¯äºŒçº§åˆ¶åºåˆ—ã€‚å¹¶ä¸”ã€‚æ¯ä¸ªèŠ‚ç‚¹è¿˜å¯ä»¥æ‹¥æœ‰ N ä¸ªå­èŠ‚ç‚¹ï¼Œæœ€ä¸Šå±‚æ˜¯æ ¹èŠ‚ç‚¹ä»¥â€œ/â€æ¥ä»£è¡¨ã€‚æ¯ä¸ªæ•°æ®èŠ‚ç‚¹åœ¨ ZooKeeper ä¸­è¢«ç§°ä¸º znodeï¼Œå®ƒæ˜¯ ZooKeeper ä¸­æ•°æ®çš„æœ€å°å•å…ƒã€‚å¹¶ä¸”ï¼Œæ¯ä¸ª znode éƒ½ä¸€ä¸ªå”¯ä¸€çš„è·¯å¾„æ ‡è¯†ã€‚\nå¼ºè°ƒä¸€å¥ï¼šZooKeeper ä¸»è¦æ˜¯ç”¨æ¥åè°ƒæœåŠ¡çš„ï¼Œè€Œä¸æ˜¯ç”¨æ¥å­˜å‚¨ä¸šåŠ¡æ•°æ®çš„ï¼Œæ‰€ä»¥ä¸è¦æ”¾æ¯”è¾ƒå¤§çš„æ•°æ®åœ¨ znode ä¸Šï¼ŒZooKeeper ç»™å‡ºçš„ä¸Šé™æ˜¯æ¯ä¸ªç»“ç‚¹çš„æ•°æ®å¤§å°æœ€å¤§æ˜¯ 1Mã€‚\nä»ä¸‹å›¾å¯ä»¥æ›´ç›´è§‚åœ°çœ‹å‡ºï¼šZooKeeper èŠ‚ç‚¹è·¯å¾„æ ‡è¯†æ–¹å¼å’Œ Unix æ–‡ä»¶ç³»ç»Ÿè·¯å¾„éå¸¸ç›¸ä¼¼ï¼Œéƒ½æ˜¯ç”±ä¸€ç³»åˆ—ä½¿ç”¨æ–œæ \u0026quot;/\u0026ldquo;è¿›è¡Œåˆ†å‰²çš„è·¯å¾„è¡¨ç¤ºï¼Œå¼€å‘äººå‘˜å¯ä»¥å‘è¿™ä¸ªèŠ‚ç‚¹ä¸­å†™å…¥æ•°æ®ï¼Œä¹Ÿå¯ä»¥åœ¨èŠ‚ç‚¹ä¸‹é¢åˆ›å»ºå­èŠ‚ç‚¹ã€‚è¿™äº›æ“ä½œæˆ‘ä»¬åé¢éƒ½ä¼šä»‹ç»åˆ°ã€‚\n3.2. znodeï¼ˆæ•°æ®èŠ‚ç‚¹ï¼‰ # ä»‹ç»äº† ZooKeeper æ ‘å½¢æ•°æ®æ¨¡å‹ä¹‹åï¼Œæˆ‘ä»¬çŸ¥é“æ¯ä¸ªæ•°æ®èŠ‚ç‚¹åœ¨ ZooKeeper ä¸­è¢«ç§°ä¸º znodeï¼Œå®ƒæ˜¯ ZooKeeper ä¸­æ•°æ®çš„æœ€å°å•å…ƒã€‚ä½ è¦å­˜æ”¾çš„æ•°æ®å°±æ”¾åœ¨ä¸Šé¢ï¼Œæ˜¯ä½ ä½¿ç”¨ ZooKeeper è¿‡ç¨‹ä¸­ç»å¸¸éœ€è¦æ¥è§¦åˆ°çš„ä¸€ä¸ªæ¦‚å¿µã€‚\n3.2.1. znode 4 ç§ç±»å‹ # æˆ‘ä»¬é€šå¸¸æ˜¯å°† znode åˆ†ä¸º 4 å¤§ç±»ï¼š\næŒä¹…ï¼ˆPERSISTENTï¼‰èŠ‚ç‚¹ ï¼šä¸€æ—¦åˆ›å»ºå°±ä¸€ç›´å­˜åœ¨å³ä½¿ ZooKeeper é›†ç¾¤å®•æœºï¼Œç›´åˆ°å°†å…¶åˆ é™¤ã€‚ ä¸´æ—¶ï¼ˆEPHEMERALï¼‰èŠ‚ç‚¹ ï¼šä¸´æ—¶èŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸ å®¢æˆ·ç«¯ä¼šè¯ï¼ˆsessionï¼‰ ç»‘å®šçš„ï¼Œä¼šè¯æ¶ˆå¤±åˆ™èŠ‚ç‚¹æ¶ˆå¤± ã€‚å¹¶ä¸”ï¼Œä¸´æ—¶èŠ‚ç‚¹åªèƒ½åšå¶å­èŠ‚ç‚¹ ï¼Œä¸èƒ½åˆ›å»ºå­èŠ‚ç‚¹ã€‚ æŒä¹…é¡ºåºï¼ˆPERSISTENT_SEQUENTIALï¼‰èŠ‚ç‚¹ ï¼šé™¤äº†å…·æœ‰æŒä¹…ï¼ˆPERSISTENTï¼‰èŠ‚ç‚¹çš„ç‰¹æ€§ä¹‹å¤–ï¼Œ å­èŠ‚ç‚¹çš„åç§°è¿˜å…·æœ‰é¡ºåºæ€§ã€‚æ¯”å¦‚ /node1/app0000000001 ã€/node1/app0000000002 ã€‚ ä¸´æ—¶é¡ºåºï¼ˆEPHEMERAL_SEQUENTIALï¼‰èŠ‚ç‚¹ ï¼šé™¤äº†å…·å¤‡ä¸´æ—¶ï¼ˆEPHEMERALï¼‰èŠ‚ç‚¹çš„ç‰¹æ€§ä¹‹å¤–ï¼Œå­èŠ‚ç‚¹çš„åç§°è¿˜å…·æœ‰é¡ºåºæ€§ã€‚ 3.2.2. znode æ•°æ®ç»“æ„ # æ¯ä¸ª znode ç”± 2 éƒ¨åˆ†ç»„æˆ:\nstat ï¼šçŠ¶æ€ä¿¡æ¯ data ï¼š èŠ‚ç‚¹å­˜æ”¾çš„æ•°æ®çš„å…·ä½“å†…å®¹ å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘é€šè¿‡ get å‘½ä»¤æ¥è·å– æ ¹ç›®å½•ä¸‹çš„ dubbo èŠ‚ç‚¹çš„å†…å®¹ã€‚ï¼ˆget å‘½ä»¤åœ¨ä¸‹é¢ä¼šä»‹ç»åˆ°ï¼‰ã€‚\n[zk: 127.0.0.1:2181(CONNECTED) 6] get /dubbo # è¯¥æ•°æ®èŠ‚ç‚¹å…³è”çš„æ•°æ®å†…å®¹ä¸ºç©º null # ä¸‹é¢æ˜¯è¯¥æ•°æ®èŠ‚ç‚¹çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ï¼Œå…¶å®å°±æ˜¯ Stat å¯¹è±¡çš„æ ¼å¼åŒ–è¾“å‡º cZxid = 0x2 ctime = Tue Nov 27 11:05:34 CST 2018 mZxid = 0x2 mtime = Tue Nov 27 11:05:34 CST 2018 pZxid = 0x3 cversion = 1 dataVersion = 0 aclVersion = 0 ephemeralOwner = 0x0 dataLength = 0 numChildren = 1 Stat ç±»ä¸­åŒ…å«äº†ä¸€ä¸ªæ•°æ®èŠ‚ç‚¹çš„æ‰€æœ‰çŠ¶æ€ä¿¡æ¯çš„å­—æ®µï¼ŒåŒ…æ‹¬äº‹åŠ¡ ID-cZxidã€èŠ‚ç‚¹åˆ›å»ºæ—¶é—´-ctime å’Œå­èŠ‚ç‚¹ä¸ªæ•°-numChildren ç­‰ç­‰ã€‚\nä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ¯ä¸ª znode çŠ¶æ€ä¿¡æ¯ç©¶ç«Ÿä»£è¡¨çš„æ˜¯ä»€ä¹ˆå§ï¼ï¼ˆä¸‹é¢çš„å†…å®¹æ¥æºäºã€Šä» Paxos åˆ° ZooKeeper åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µã€‹ï¼Œå› ä¸º Guide ç¡®å®ä¹Ÿä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šï¼Œè¦å­¦ä¼šå‚è€ƒèµ„æ–™çš„å˜›ï¼ ï¼‰ ï¼š\nznode çŠ¶æ€ä¿¡æ¯ è§£é‡Š cZxid create ZXIDï¼Œå³è¯¥æ•°æ®èŠ‚ç‚¹è¢«åˆ›å»ºæ—¶çš„äº‹åŠ¡ id ctime create timeï¼Œå³è¯¥èŠ‚ç‚¹çš„åˆ›å»ºæ—¶é—´ mZxid modified ZXIDï¼Œå³è¯¥èŠ‚ç‚¹æœ€ç»ˆä¸€æ¬¡æ›´æ–°æ—¶çš„äº‹åŠ¡ id mtime modified timeï¼Œå³è¯¥èŠ‚ç‚¹æœ€åä¸€æ¬¡çš„æ›´æ–°æ—¶é—´ pZxid è¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶çš„äº‹åŠ¡ idï¼Œåªæœ‰å­èŠ‚ç‚¹åˆ—è¡¨å˜æ›´æ‰ä¼šæ›´æ–° pZxidï¼Œå­èŠ‚ç‚¹å†…å®¹å˜æ›´ä¸ä¼šæ›´æ–° cversion å­èŠ‚ç‚¹ç‰ˆæœ¬å·ï¼Œå½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ¯æ¬¡å˜åŒ–æ—¶å€¼å¢åŠ  1 dataVersion æ•°æ®èŠ‚ç‚¹å†…å®¹ç‰ˆæœ¬å·ï¼ŒèŠ‚ç‚¹åˆ›å»ºæ—¶ä¸º 0ï¼Œæ¯æ›´æ–°ä¸€æ¬¡èŠ‚ç‚¹å†…å®¹(ä¸ç®¡å†…å®¹æœ‰æ— å˜åŒ–)è¯¥ç‰ˆæœ¬å·çš„å€¼å¢åŠ  1 aclVersion èŠ‚ç‚¹çš„ ACL ç‰ˆæœ¬å·ï¼Œè¡¨ç¤ºè¯¥èŠ‚ç‚¹ ACL ä¿¡æ¯å˜æ›´æ¬¡æ•° ephemeralOwner åˆ›å»ºè¯¥ä¸´æ—¶èŠ‚ç‚¹çš„ä¼šè¯çš„ sessionIdï¼›å¦‚æœå½“å‰èŠ‚ç‚¹ä¸ºæŒä¹…èŠ‚ç‚¹ï¼Œåˆ™ ephemeralOwner=0 dataLength æ•°æ®èŠ‚ç‚¹å†…å®¹é•¿åº¦ numChildren å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•° 3.3. ç‰ˆæœ¬ï¼ˆversionï¼‰ # åœ¨å‰é¢æˆ‘ä»¬å·²ç»æåˆ°ï¼Œå¯¹åº”äºæ¯ä¸ª znodeï¼ŒZooKeeper éƒ½ä¼šä¸ºå…¶ç»´æŠ¤ä¸€ä¸ªå«ä½œ Stat çš„æ•°æ®ç»“æ„ï¼ŒStat ä¸­è®°å½•äº†è¿™ä¸ª znode çš„ä¸‰ä¸ªç›¸å…³çš„ç‰ˆæœ¬ï¼š\ndataVersion ï¼šå½“å‰ znode èŠ‚ç‚¹çš„ç‰ˆæœ¬å· cversion ï¼š å½“å‰ znode å­èŠ‚ç‚¹çš„ç‰ˆæœ¬ aclVersion ï¼š å½“å‰ znode çš„ ACL çš„ç‰ˆæœ¬ã€‚ 3.4. ACLï¼ˆæƒé™æ§åˆ¶ï¼‰ # ZooKeeper é‡‡ç”¨ ACLï¼ˆAccessControlListsï¼‰ç­–ç•¥æ¥è¿›è¡Œæƒé™æ§åˆ¶ï¼Œç±»ä¼¼äº UNIX æ–‡ä»¶ç³»ç»Ÿçš„æƒé™æ§åˆ¶ã€‚\nå¯¹äº znode æ“ä½œçš„æƒé™ï¼ŒZooKeeper æä¾›äº†ä»¥ä¸‹ 5 ç§ï¼š\nCREATE : èƒ½åˆ›å»ºå­èŠ‚ç‚¹ READ ï¼šèƒ½è·å–èŠ‚ç‚¹æ•°æ®å’Œåˆ—å‡ºå…¶å­èŠ‚ç‚¹ WRITE : èƒ½è®¾ç½®/æ›´æ–°èŠ‚ç‚¹æ•°æ® DELETE : èƒ½åˆ é™¤å­èŠ‚ç‚¹ ADMIN : èƒ½è®¾ç½®èŠ‚ç‚¹ ACL çš„æƒé™ å…¶ä¸­å°¤å…¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCREATE å’Œ DELETE è¿™ä¸¤ç§æƒé™éƒ½æ˜¯é’ˆå¯¹ å­èŠ‚ç‚¹ çš„æƒé™æ§åˆ¶ã€‚\nå¯¹äºèº«ä»½è®¤è¯ï¼Œæä¾›äº†ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š\nworld ï¼š é»˜è®¤æ–¹å¼ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½å¯æ— æ¡ä»¶è®¿é—®ã€‚ auth :ä¸ä½¿ç”¨ä»»ä½• idï¼Œä»£è¡¨ä»»ä½•å·²è®¤è¯çš„ç”¨æˆ·ã€‚ digest :ç”¨æˆ·å:å¯†ç è®¤è¯æ–¹å¼ï¼š username:password ã€‚ ip : å¯¹æŒ‡å®š ip è¿›è¡Œé™åˆ¶ã€‚ 3.5. Watcherï¼ˆäº‹ä»¶ç›‘å¬å™¨ï¼‰ # Watcherï¼ˆäº‹ä»¶ç›‘å¬å™¨ï¼‰ï¼Œæ˜¯ ZooKeeper ä¸­çš„ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§ã€‚ZooKeeper å…è®¸ç”¨æˆ·åœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šæ³¨å†Œä¸€äº› Watcherï¼Œå¹¶ä¸”åœ¨ä¸€äº›ç‰¹å®šäº‹ä»¶è§¦å‘çš„æ—¶å€™ï¼ŒZooKeeper æœåŠ¡ç«¯ä¼šå°†äº‹ä»¶é€šçŸ¥åˆ°æ„Ÿå…´è¶£çš„å®¢æˆ·ç«¯ä¸Šå»ï¼Œè¯¥æœºåˆ¶æ˜¯ ZooKeeper å®ç°åˆ†å¸ƒå¼åè°ƒæœåŠ¡çš„é‡è¦ç‰¹æ€§ã€‚\nç ´éŸ³ï¼šéå¸¸æœ‰ç”¨çš„ä¸€ä¸ªç‰¹æ€§ï¼Œéƒ½æ‹¿å‡ºå°æœ¬æœ¬è®°å¥½äº†ï¼Œåé¢ç”¨åˆ° ZooKeeper åŸºæœ¬ç¦»ä¸å¼€ Watcherï¼ˆäº‹ä»¶ç›‘å¬å™¨ï¼‰æœºåˆ¶ã€‚\n3.6. ä¼šè¯ï¼ˆSessionï¼‰ # Session å¯ä»¥çœ‹ä½œæ˜¯ ZooKeeper æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯çš„ä¹‹é—´çš„ä¸€ä¸ª TCP é•¿è¿æ¥ï¼Œé€šè¿‡è¿™ä¸ªè¿æ¥ï¼Œå®¢æˆ·ç«¯èƒ½å¤Ÿé€šè¿‡å¿ƒè·³æ£€æµ‹ä¸æœåŠ¡å™¨ä¿æŒæœ‰æ•ˆçš„ä¼šè¯ï¼Œä¹Ÿèƒ½å¤Ÿå‘ ZooKeeper æœåŠ¡å™¨å‘é€è¯·æ±‚å¹¶æ¥å—å“åº”ï¼ŒåŒæ—¶è¿˜èƒ½å¤Ÿé€šè¿‡è¯¥è¿æ¥æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„ Watcher äº‹ä»¶é€šçŸ¥ã€‚\nSession æœ‰ä¸€ä¸ªå±æ€§å«åšï¼šsessionTimeout ï¼ŒsessionTimeout ä»£è¡¨ä¼šè¯çš„è¶…æ—¶æ—¶é—´ã€‚å½“ç”±äºæœåŠ¡å™¨å‹åŠ›å¤ªå¤§ã€ç½‘ç»œæ•…éšœæˆ–æ˜¯å®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€è¿æ¥ç­‰å„ç§åŸå› å¯¼è‡´å®¢æˆ·ç«¯è¿æ¥æ–­å¼€æ—¶ï¼Œåªè¦åœ¨**sessionTimeoutè§„å®šçš„æ—¶é—´å†…èƒ½å¤Ÿé‡æ–°è¿æ¥ä¸Šé›†ç¾¤ä¸­ä»»æ„ä¸€å°æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä¹‹å‰åˆ›å»ºçš„ä¼šè¯ä»ç„¶æœ‰æ•ˆ**ã€‚\nå¦å¤–ï¼Œåœ¨ä¸ºå®¢æˆ·ç«¯åˆ›å»ºä¼šè¯ä¹‹å‰ï¼ŒæœåŠ¡ç«¯é¦–å…ˆä¼šä¸ºæ¯ä¸ªå®¢æˆ·ç«¯éƒ½åˆ†é…ä¸€ä¸ª sessionIDã€‚ç”±äº sessionIDæ˜¯ ZooKeeper ä¼šè¯çš„ä¸€ä¸ªé‡è¦æ ‡è¯†ï¼Œè®¸å¤šä¸ä¼šè¯ç›¸å…³çš„è¿è¡Œæœºåˆ¶éƒ½æ˜¯åŸºäºè¿™ä¸ª sessionID çš„ï¼Œå› æ­¤ï¼Œæ— è®ºæ˜¯å“ªå°æœåŠ¡å™¨ä¸ºå®¢æˆ·ç«¯åˆ†é…çš„ sessionIDï¼Œéƒ½åŠ¡å¿…ä¿è¯å…¨å±€å”¯ä¸€ã€‚\n4. ZooKeeper é›†ç¾¤ # ä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œæœ€å¥½æ˜¯ä»¥é›†ç¾¤å½¢æ€æ¥éƒ¨ç½² ZooKeeperï¼Œè¿™æ ·åªè¦é›†ç¾¤ä¸­å¤§éƒ¨åˆ†æœºå™¨æ˜¯å¯ç”¨çš„ï¼ˆèƒ½å¤Ÿå®¹å¿ä¸€å®šçš„æœºå™¨æ•…éšœï¼‰ï¼Œé‚£ä¹ˆ ZooKeeper æœ¬èº«ä»ç„¶æ˜¯å¯ç”¨çš„ã€‚é€šå¸¸ 3 å°æœåŠ¡å™¨å°±å¯ä»¥æ„æˆä¸€ä¸ª ZooKeeper é›†ç¾¤äº†ã€‚ZooKeeper å®˜æ–¹æä¾›çš„æ¶æ„å›¾å°±æ˜¯ä¸€ä¸ª ZooKeeper é›†ç¾¤æ•´ä½“å¯¹å¤–æä¾›æœåŠ¡ã€‚\n[!\nä¸Šå›¾ä¸­æ¯ä¸€ä¸ª Server ä»£è¡¨ä¸€ä¸ªå®‰è£… ZooKeeper æœåŠ¡çš„æœåŠ¡å™¨ã€‚ç»„æˆ ZooKeeper æœåŠ¡çš„æœåŠ¡å™¨éƒ½ä¼šåœ¨å†…å­˜ä¸­ç»´æŠ¤å½“å‰çš„æœåŠ¡å™¨çŠ¶æ€ï¼Œå¹¶ä¸”æ¯å°æœåŠ¡å™¨ä¹‹é—´éƒ½äº’ç›¸ä¿æŒç€é€šä¿¡ã€‚é›†ç¾¤é—´é€šè¿‡ **ZAB åè®®ï¼ˆZooKeeper Atomic Broadcastï¼‰**æ¥ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€‚\n[ zookeeperä¸­ä¸æ˜¯ä½¿ç”¨è¿™ä¸ª ]\næœ€å…¸å‹é›†ç¾¤æ¨¡å¼ï¼š Master/Slave æ¨¡å¼ï¼ˆä¸»å¤‡æ¨¡å¼ï¼‰ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œé€šå¸¸ Master æœåŠ¡å™¨ä½œä¸ºä¸»æœåŠ¡å™¨æä¾›å†™æœåŠ¡ï¼Œå…¶ä»–çš„ Slave æœåŠ¡å™¨ä»æœåŠ¡å™¨é€šè¿‡å¼‚æ­¥å¤åˆ¶çš„æ–¹å¼è·å– Master æœåŠ¡å™¨æœ€æ–°çš„æ•°æ®æä¾›è¯»æœåŠ¡ã€‚\n4.1. ZooKeeper é›†ç¾¤è§’è‰² # ä½†æ˜¯ï¼Œåœ¨ ZooKeeper ä¸­æ²¡æœ‰é€‰æ‹©ä¼ ç»Ÿçš„ Master/Slave æ¦‚å¿µï¼Œè€Œæ˜¯å¼•å…¥äº† Leaderã€Follower å’Œ Observer ä¸‰ç§è§’è‰²ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º\n[!\nZooKeeper é›†ç¾¤ä¸­çš„æ‰€æœ‰æœºå™¨é€šè¿‡ä¸€ä¸ª Leader é€‰ä¸¾è¿‡ç¨‹ æ¥é€‰å®šä¸€å°ç§°ä¸º â€œLeaderâ€ çš„æœºå™¨ï¼ŒLeader æ—¢å¯ä»¥ä¸ºå®¢æˆ·ç«¯æä¾›å†™æœåŠ¡åˆèƒ½æä¾›è¯»æœåŠ¡ã€‚é™¤äº† Leader å¤–ï¼ŒFollower å’Œ Observer éƒ½åªèƒ½æä¾›è¯»æœåŠ¡ã€‚Follower å’Œ Observer å”¯ä¸€çš„åŒºåˆ«åœ¨äº Observer æœºå™¨ä¸å‚ä¸ Leader çš„é€‰ä¸¾è¿‡ç¨‹ï¼Œä¹Ÿä¸å‚ä¸å†™æ“ä½œçš„â€œè¿‡åŠå†™æˆåŠŸâ€ç­–ç•¥ï¼Œå› æ­¤ Observer æœºå™¨å¯ä»¥åœ¨ä¸å½±å“å†™æ€§èƒ½çš„æƒ…å†µä¸‹æå‡é›†ç¾¤çš„è¯»æ€§èƒ½ã€‚\nè§’è‰² è¯´æ˜ Leader ä¸ºå®¢æˆ·ç«¯æä¾›è¯»å’Œå†™çš„æœåŠ¡ï¼Œè´Ÿè´£æŠ•ç¥¨çš„å‘èµ·å’Œå†³è®®ï¼Œæ›´æ–°ç³»ç»ŸçŠ¶æ€ã€‚ Follower ä¸ºå®¢æˆ·ç«¯æä¾›è¯»æœåŠ¡ï¼Œå¦‚æœæ˜¯å†™æœåŠ¡åˆ™è½¬å‘ç»™ Leaderã€‚å‚ä¸é€‰ä¸¾è¿‡ç¨‹ä¸­çš„æŠ•ç¥¨ã€‚ Observer ä¸ºå®¢æˆ·ç«¯æä¾›è¯»æœåŠ¡ï¼Œå¦‚æœæ˜¯å†™æœåŠ¡åˆ™è½¬å‘ç»™ Leaderã€‚ä¸å‚ä¸é€‰ä¸¾è¿‡ç¨‹ä¸­çš„æŠ•ç¥¨ï¼Œä¹Ÿ**ä¸å‚ä¸â€œè¿‡åŠå†™æˆåŠŸâ€**ç­–ç•¥ã€‚åœ¨ä¸å½±å“å†™æ€§èƒ½çš„æƒ…å†µä¸‹æå‡é›†ç¾¤çš„è¯»æ€§èƒ½ã€‚æ­¤è§’è‰²äº ZooKeeper3.3 ç³»åˆ—æ–°å¢çš„è§’è‰²ã€‚ å½“ Leader æœåŠ¡å™¨å‡ºç°ç½‘ç»œä¸­æ–­ã€å´©æºƒé€€å‡ºä¸é‡å¯ç­‰å¼‚å¸¸æƒ…å†µæ—¶ï¼Œå°±ä¼šè¿›å…¥ Leader é€‰ä¸¾è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šé€‰ä¸¾äº§ç”Ÿæ–°çš„ Leader æœåŠ¡å™¨ã€‚\nè¿™ä¸ªè¿‡ç¨‹å¤§è‡´æ˜¯è¿™æ ·çš„ï¼š\nLeader electionï¼ˆé€‰ä¸¾é˜¶æ®µï¼‰ï¼šèŠ‚ç‚¹åœ¨ä¸€å¼€å§‹éƒ½å¤„äºé€‰ä¸¾é˜¶æ®µï¼Œåªè¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹å¾—åˆ°è¶…åŠæ•°èŠ‚ç‚¹çš„ç¥¨æ•°ï¼Œå®ƒå°±å¯ä»¥å½“é€‰å‡† leaderã€‚ Discoveryï¼ˆå‘ç°é˜¶æ®µï¼‰ ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼Œfollowers è·Ÿå‡† leader è¿›è¡Œé€šä¿¡ï¼ŒåŒæ­¥ followers æœ€è¿‘æ¥æ”¶çš„äº‹åŠ¡æè®®ã€‚ Synchronizationï¼ˆåŒæ­¥é˜¶æ®µï¼‰ :åŒæ­¥é˜¶æ®µä¸»è¦æ˜¯åˆ©ç”¨ leader å‰ä¸€é˜¶æ®µè·å¾—çš„æœ€æ–°æè®®å†å²ï¼ŒåŒæ­¥é›†ç¾¤ä¸­æ‰€æœ‰çš„å‰¯æœ¬ã€‚åŒæ­¥å®Œæˆä¹‹å å‡† leader æ‰ä¼šæˆä¸ºçœŸæ­£çš„ leaderã€‚ Broadcastï¼ˆå¹¿æ’­é˜¶æ®µï¼‰ :åˆ°äº†è¿™ä¸ªé˜¶æ®µï¼ŒZooKeeper é›†ç¾¤æ‰èƒ½æ­£å¼å¯¹å¤–æä¾›äº‹åŠ¡æœåŠ¡ï¼Œå¹¶ä¸” leader å¯ä»¥è¿›è¡Œæ¶ˆæ¯å¹¿æ’­ã€‚åŒæ—¶å¦‚æœæœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥ï¼Œè¿˜éœ€è¦å¯¹æ–°èŠ‚ç‚¹è¿›è¡ŒåŒæ­¥ã€‚ 4.2. ZooKeeper é›†ç¾¤ä¸­çš„æœåŠ¡å™¨çŠ¶æ€ # LOOKING ï¼šå¯»æ‰¾ Leaderã€‚ LEADING ï¼šLeader çŠ¶æ€ï¼Œå¯¹åº”çš„èŠ‚ç‚¹ä¸º Leaderã€‚ FOLLOWING ï¼šFollower çŠ¶æ€ï¼Œå¯¹åº”çš„èŠ‚ç‚¹ä¸º Followerã€‚ OBSERVING ï¼šObserver çŠ¶æ€ï¼Œå¯¹åº”èŠ‚ç‚¹ä¸º Observerï¼Œè¯¥èŠ‚ç‚¹ä¸å‚ä¸ Leader é€‰ä¸¾ã€‚ 4.3. ZooKeeper é›†ç¾¤ä¸ºå•¥æœ€å¥½å¥‡æ•°å°ï¼Ÿ # ZooKeeper é›†ç¾¤åœ¨å®•æ‰å‡ ä¸ª ZooKeeper æœåŠ¡å™¨ä¹‹åï¼Œå¦‚æœå‰©ä¸‹çš„ ZooKeeper æœåŠ¡å™¨ä¸ªæ•°å¤§äºå®•æ‰çš„ä¸ªæ•°çš„è¯æ•´ä¸ª ZooKeeper æ‰ä¾ç„¶å¯ç”¨ã€‚å‡å¦‚æˆ‘ä»¬çš„é›†ç¾¤ä¸­æœ‰ n å° ZooKeeper æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯å‰©ä¸‹çš„æœåŠ¡æ•°å¿…é¡»å¤§äº n/2ã€‚\næœ‰ç‚¹ç»•ï¼Œæ¢å¥è¯å°±æ˜¯è¯´æœ€å¤šçš„å®•æœºæ•°å¿…é¡»å°äºä¸€åŠï¼ˆç­‰äºä¹Ÿä¸è¡Œï¼‰ï¼Œé‚£ä¹ˆå¦‚æœæ˜¯å¥‡æ•°xï¼Œé‚£ä»–åªèƒ½å°äºx/2 å³ä¸ºé™¤ä¹‹åçš„æ•´æ•°éƒ¨åˆ†ï¼Œå°±ç®—å†åŠ ä¸€å°ï¼Œä¹Ÿæœ€å¤šåªèƒ½å®•æœº(x+1)/2 -1ï¼ˆç­‰äºå¥‡æ•° (x+1)/2 -1ï¼‰ï¼Œæ‰€ä»¥æ²¡å¿…è¦å†å¤šä¸€å°ï¼Œå¹¶ä¸èƒ½å¢åŠ å¯å®•æœºæ•° å…ˆè¯´ä¸€ä¸‹ç»“è®ºï¼Œ2n å’Œ 2n-1 çš„å®¹å¿åº¦æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ n-1ï¼Œå¤§å®¶å¯ä»¥å…ˆè‡ªå·±ä»”ç»†æƒ³ä¸€æƒ³ï¼Œè¿™åº”è¯¥æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„æ•°å­¦é—®é¢˜äº†ã€‚ æ¯”å¦‚å‡å¦‚æˆ‘ä»¬æœ‰ 3 å°ï¼Œé‚£ä¹ˆæœ€å¤§å…è®¸å®•æ‰ 1 å° ZooKeeper æœåŠ¡å™¨ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ 4 å°çš„çš„æ—¶å€™ä¹ŸåŒæ ·åªå…è®¸å®•æ‰ 1 å°ã€‚ å‡å¦‚æˆ‘ä»¬æœ‰ 5 å°ï¼Œé‚£ä¹ˆæœ€å¤§å…è®¸å®•æ‰ 2 å° ZooKeeper æœåŠ¡å™¨ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ 6 å°çš„çš„æ—¶å€™ä¹ŸåŒæ ·åªå…è®¸å®•æ‰ 2 å°ã€‚\nç»¼ä¸Šï¼Œä½•å¿…å¢åŠ é‚£ä¸€ä¸ªä¸å¿…è¦çš„ ZooKeeper å‘¢ï¼Ÿ\n4.4. ZooKeeper é€‰ä¸¾çš„è¿‡åŠæœºåˆ¶é˜²æ­¢è„‘è£‚ # ä½•ä¸ºé›†ç¾¤è„‘è£‚ï¼Ÿ\nå¯¹äºä¸€ä¸ªé›†ç¾¤ï¼Œé€šå¸¸å¤šå°æœºå™¨ä¼šéƒ¨ç½²åœ¨ä¸åŒæœºæˆ¿ï¼Œæ¥æé«˜è¿™ä¸ªé›†ç¾¤çš„å¯ç”¨æ€§ã€‚ä¿è¯å¯ç”¨æ€§çš„åŒæ—¶ï¼Œä¼šå‘ç”Ÿä¸€ç§æœºæˆ¿é—´ç½‘ç»œçº¿è·¯æ•…éšœï¼Œå¯¼è‡´æœºæˆ¿é—´ç½‘ç»œä¸é€šï¼Œè€Œé›†ç¾¤è¢«å‰²è£‚æˆå‡ ä¸ªå°é›†ç¾¤ã€‚è¿™æ—¶å€™å­é›†ç¾¤å„è‡ªé€‰ä¸»å¯¼è‡´â€œè„‘è£‚â€çš„æƒ…å†µã€‚\nä¸¾ä¾‹è¯´æ˜ï¼šæ¯”å¦‚ç°åœ¨æœ‰ä¸€ä¸ªç”± 6 å°æœåŠ¡å™¨æ‰€ç»„æˆçš„ä¸€ä¸ªé›†ç¾¤ï¼Œéƒ¨ç½²åœ¨äº† 2 ä¸ªæœºæˆ¿ï¼Œæ¯ä¸ªæœºæˆ¿ 3 å°ã€‚æ­£å¸¸æƒ…å†µä¸‹åªæœ‰ 1 ä¸ª leaderï¼Œä½†æ˜¯å½“ä¸¤ä¸ªæœºæˆ¿ä¸­é—´ç½‘ç»œæ–­å¼€çš„æ—¶å€™ï¼Œæ¯ä¸ªæœºæˆ¿çš„ 3 å°æœåŠ¡å™¨éƒ½ä¼šè®¤ä¸ºå¦ä¸€ä¸ªæœºæˆ¿çš„ 3 å°æœåŠ¡å™¨ä¸‹çº¿ï¼Œè€Œé€‰å‡ºè‡ªå·±çš„ leader å¹¶å¯¹å¤–æä¾›æœåŠ¡ã€‚è‹¥æ²¡æœ‰è¿‡åŠæœºåˆ¶ï¼Œå½“ç½‘ç»œæ¢å¤çš„æ—¶å€™ä¼šå‘ç°æœ‰ 2 ä¸ª leaderã€‚ä»¿ä½›æ˜¯ 1 ä¸ªå¤§è„‘ï¼ˆleaderï¼‰åˆ†æ•£æˆäº† 2 ä¸ªå¤§è„‘ï¼Œè¿™å°±å‘ç”Ÿäº†è„‘è£‚ç°è±¡ã€‚è„‘è£‚æœŸé—´ 2 ä¸ªå¤§è„‘éƒ½å¯èƒ½å¯¹å¤–æä¾›äº†æœåŠ¡ï¼Œè¿™å°†ä¼šå¸¦æ¥æ•°æ®ä¸€è‡´æ€§ç­‰é—®é¢˜ã€‚\nè¿‡åŠæœºåˆ¶æ˜¯å¦‚ä½•é˜²æ­¢è„‘è£‚ç°è±¡äº§ç”Ÿçš„ï¼Ÿ\nZooKeeper çš„è¿‡åŠæœºåˆ¶å¯¼è‡´ä¸å¯èƒ½äº§ç”Ÿ 2 ä¸ª leaderï¼Œå› ä¸ºå°‘äºç­‰äºä¸€åŠæ˜¯ä¸å¯èƒ½äº§ç”Ÿ leader çš„ï¼Œè¿™å°±ä½¿å¾—ä¸è®ºæœºæˆ¿çš„æœºå™¨å¦‚ä½•åˆ†é…éƒ½ä¸å¯èƒ½å‘ç”Ÿè„‘è£‚ã€‚\n5. ZAB åè®®å’Œ Paxos ç®—æ³• # Paxos ç®—æ³•åº”è¯¥å¯ä»¥è¯´æ˜¯ ZooKeeper çš„çµé­‚äº†ã€‚ä½†æ˜¯ï¼ŒZooKeeper å¹¶æ²¡æœ‰å®Œå…¨é‡‡ç”¨ Paxos ç®—æ³• ï¼Œè€Œæ˜¯ä½¿ç”¨ ZAB åè®®ä½œä¸ºå…¶ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„æ ¸å¿ƒç®—æ³•ã€‚å¦å¤–ï¼Œåœ¨ ZooKeeper çš„å®˜æ–¹æ–‡æ¡£ä¸­ä¹ŸæŒ‡å‡ºï¼ŒZAB åè®®å¹¶ä¸åƒ Paxos ç®—æ³•é‚£æ ·ï¼Œæ˜¯ä¸€ç§é€šç”¨çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹åˆ«ä¸º Zookeeper è®¾è®¡çš„å´©æºƒå¯æ¢å¤çš„åŸå­æ¶ˆæ¯å¹¿æ’­ç®—æ³•ã€‚\n5.1. ZAB åè®®ä»‹ç» # ZABï¼ˆZooKeeper Atomic Broadcast åŸå­å¹¿æ’­ï¼‰ åè®®æ˜¯ä¸ºåˆ†å¸ƒå¼åè°ƒæœåŠ¡ ZooKeeper ä¸“é—¨è®¾è®¡çš„ä¸€ç§æ”¯æŒå´©æºƒæ¢å¤çš„åŸå­å¹¿æ’­åè®®ã€‚ åœ¨ ZooKeeper ä¸­ï¼Œä¸»è¦ä¾èµ– ZAB åè®®æ¥å®ç°åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§ï¼ŒåŸºäºè¯¥åè®®ï¼ŒZooKeeper å®ç°äº†ä¸€ç§ä¸»å¤‡æ¨¡å¼çš„ç³»ç»Ÿæ¶æ„æ¥ä¿æŒé›†ç¾¤ä¸­å„ä¸ªå‰¯æœ¬ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ã€‚\n5.2. ZAB åè®®ä¸¤ç§åŸºæœ¬çš„æ¨¡å¼ï¼šå´©æºƒæ¢å¤å’Œæ¶ˆæ¯å¹¿æ’­ # ZAB åè®®åŒ…æ‹¬ä¸¤ç§åŸºæœ¬çš„æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯\nå´©æºƒæ¢å¤ ï¼šå½“æ•´ä¸ªæœåŠ¡æ¡†æ¶åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œæˆ–æ˜¯å½“ Leader æœåŠ¡å™¨å‡ºç°ç½‘ç»œä¸­æ–­ã€å´©æºƒé€€å‡ºä¸é‡å¯ç­‰å¼‚å¸¸æƒ…å†µæ—¶ï¼ŒZAB åè®®å°±ä¼šè¿›å…¥æ¢å¤æ¨¡å¼å¹¶é€‰ä¸¾äº§ç”Ÿæ–°çš„ Leader æœåŠ¡å™¨ã€‚å½“é€‰ä¸¾äº§ç”Ÿäº†æ–°çš„ Leader æœåŠ¡å™¨ï¼ŒåŒæ—¶é›†ç¾¤ä¸­å·²ç»æœ‰è¿‡åŠçš„æœºå™¨ä¸è¯¥ Leader æœåŠ¡å™¨å®Œæˆäº†çŠ¶æ€åŒæ­¥ä¹‹åï¼ŒZAB åè®®å°±ä¼šé€€å‡ºæ¢å¤æ¨¡å¼ã€‚å…¶ä¸­ï¼Œæ‰€è°“çš„çŠ¶æ€åŒæ­¥æ˜¯æŒ‡æ•°æ®åŒæ­¥ï¼Œç”¨æ¥ä¿è¯é›†ç¾¤ä¸­å­˜åœ¨è¿‡åŠçš„æœºå™¨èƒ½å¤Ÿå’Œ Leader æœåŠ¡å™¨çš„æ•°æ®çŠ¶æ€ä¿æŒä¸€è‡´ã€‚ æ¶ˆæ¯å¹¿æ’­ ï¼šå½“é›†ç¾¤ä¸­å·²ç»æœ‰è¿‡åŠçš„ Follower æœåŠ¡å™¨å®Œæˆäº†å’Œ Leader æœåŠ¡å™¨çš„çŠ¶æ€åŒæ­¥ï¼Œé‚£ä¹ˆæ•´ä¸ªæœåŠ¡æ¡†æ¶å°±å¯ä»¥è¿›å…¥æ¶ˆæ¯å¹¿æ’­æ¨¡å¼äº†ã€‚ å½“ä¸€å°åŒæ ·éµå®ˆ ZAB åè®®çš„æœåŠ¡å™¨å¯åŠ¨ååŠ å…¥åˆ°é›†ç¾¤ä¸­æ—¶ï¼Œå¦‚æœæ­¤æ—¶é›†ç¾¤ä¸­å·²ç»å­˜åœ¨ä¸€ä¸ª Leader æœåŠ¡å™¨åœ¨è´Ÿè´£è¿›è¡Œæ¶ˆæ¯å¹¿æ’­ï¼Œé‚£ä¹ˆæ–°åŠ å…¥çš„æœåŠ¡å™¨å°±ä¼šè‡ªè§‰åœ°è¿›å…¥æ•°æ®æ¢å¤æ¨¡å¼ï¼šæ‰¾åˆ° Leader æ‰€åœ¨çš„æœåŠ¡å™¨ï¼Œå¹¶ä¸å…¶è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œç„¶åä¸€èµ·å‚ä¸åˆ°æ¶ˆæ¯å¹¿æ’­æµç¨‹ä¸­å»ã€‚ å…³äº ZAB åè®®\u0026amp;Paxos ç®—æ³• éœ€è¦è®²å’Œç†è§£çš„ä¸œè¥¿å¤ªå¤šäº†ï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹é¢è¿™ä¸¤ç¯‡æ–‡ç« ï¼š\nå›¾è§£ Paxos ä¸€è‡´æ€§åè®® Zookeeper ZAB åè®®åˆ†æ 6. æ€»ç»“ # ZooKeeper æœ¬èº«å°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç¨‹åºï¼ˆåªè¦åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹å­˜æ´»ï¼ŒZooKeeper å°±èƒ½æ­£å¸¸æœåŠ¡ï¼‰ã€‚ ä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œæœ€å¥½æ˜¯ä»¥é›†ç¾¤å½¢æ€æ¥éƒ¨ç½² ZooKeeperï¼Œè¿™æ ·åªè¦é›†ç¾¤ä¸­å¤§éƒ¨åˆ†æœºå™¨æ˜¯å¯ç”¨çš„ï¼ˆèƒ½å¤Ÿå®¹å¿ä¸€å®šçš„æœºå™¨æ•…éšœï¼‰ï¼Œé‚£ä¹ˆ ZooKeeper æœ¬èº«ä»ç„¶æ˜¯å¯ç”¨çš„ã€‚ ZooKeeper å°†æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè¿™ä¹Ÿå°±ä¿è¯äº† é«˜ååé‡å’Œä½å»¶è¿Ÿï¼ˆä½†æ˜¯å†…å­˜é™åˆ¶äº†èƒ½å¤Ÿå­˜å‚¨çš„å®¹é‡ä¸å¤ªå¤§ï¼Œæ­¤é™åˆ¶ä¹Ÿæ˜¯ä¿æŒ znode ä¸­å­˜å‚¨çš„æ•°æ®é‡è¾ƒå°çš„è¿›ä¸€æ­¥åŸå› ï¼‰ã€‚ ZooKeeper æ˜¯é«˜æ€§èƒ½çš„ã€‚ åœ¨â€œè¯»â€å¤šäºâ€œå†™â€çš„åº”ç”¨ç¨‹åºä¸­å°¤å…¶åœ°æ˜æ˜¾ï¼Œå› ä¸ºâ€œå†™â€ä¼šå¯¼è‡´æ‰€æœ‰çš„æœåŠ¡å™¨é—´åŒæ­¥çŠ¶æ€ã€‚ï¼ˆâ€œè¯»â€å¤šäºâ€œå†™â€æ˜¯åè°ƒæœåŠ¡çš„å…¸å‹åœºæ™¯ã€‚ï¼‰ ZooKeeper æœ‰ä¸´æ—¶èŠ‚ç‚¹çš„æ¦‚å¿µã€‚ å½“åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹çš„å®¢æˆ·ç«¯ä¼šè¯ä¸€ç›´ä¿æŒæ´»åŠ¨ï¼Œç¬æ—¶èŠ‚ç‚¹å°±ä¸€ç›´å­˜åœ¨ã€‚è€Œå½“ä¼šè¯ç»ˆç»“æ—¶ï¼Œç¬æ—¶èŠ‚ç‚¹è¢«åˆ é™¤ã€‚æŒä¹…èŠ‚ç‚¹æ˜¯æŒ‡ä¸€æ—¦è¿™ä¸ª znode è¢«åˆ›å»ºäº†ï¼Œé™¤éä¸»åŠ¨è¿›è¡Œ znode çš„ç§»é™¤æ“ä½œï¼Œå¦åˆ™è¿™ä¸ª znode å°†ä¸€ç›´ä¿å­˜åœ¨ ZooKeeper ä¸Šã€‚ ZooKeeper åº•å±‚å…¶å®åªæä¾›äº†ä¸¤ä¸ªåŠŸèƒ½ï¼šâ‘  ç®¡ç†ï¼ˆå­˜å‚¨ã€è¯»å–ï¼‰ç”¨æˆ·ç¨‹åºæäº¤çš„æ•°æ®ï¼›â‘¡ ä¸ºç”¨æˆ·ç¨‹åºæä¾›æ•°æ®èŠ‚ç‚¹ç›‘å¬æœåŠ¡ã€‚ 7. å‚è€ƒ # ã€Šä» Paxos åˆ° ZooKeeper åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µã€‹ "},{"id":83,"href":"/zh/docs/study/Review/java_guide/lydly_distributed_system/ly04ly_rpc-http/","title":"rpc_http","section":"åˆ†å¸ƒå¼ç³»ç»Ÿ","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\næˆ‘æ­£åœ¨å‚ä¸æ˜é‡‘æŠ€æœ¯ç¤¾åŒºåˆ›ä½œè€…ç­¾çº¦è®¡åˆ’æ‹›å‹Ÿæ´»åŠ¨ï¼Œç‚¹å‡»é“¾æ¥æŠ¥åæŠ•ç¨¿ã€‚\næˆ‘æƒ³èµ·äº†æˆ‘åˆšå·¥ä½œçš„æ—¶å€™ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦RPCåè®®ï¼Œå½“æ—¶å°±å¾ˆæ‡µï¼Œæˆ‘HTTPåè®®ç”¨çš„å¥½å¥½çš„ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨RPCåè®®ï¼Ÿ\näºæ˜¯å°±åˆ°ç½‘ä¸Šå»æœã€‚\nä¸å°‘è§£é‡Šæ˜¾å¾—éå¸¸å®˜æ–¹ï¼Œæˆ‘ç›¸ä¿¡å¤§å®¶åœ¨å„ç§å¹³å°ä¸Šä¹Ÿéƒ½çœ‹åˆ°è¿‡ï¼Œè§£é‡Šäº†åˆå¥½åƒæ²¡è§£é‡Šï¼Œéƒ½åœ¨ç”¨ä¸€ä¸ªæˆ‘ä»¬ä¸è®¤è¯†çš„æ¦‚å¿µå»è§£é‡Šå¦å¤–ä¸€ä¸ªæˆ‘ä»¬ä¸è®¤è¯†çš„æ¦‚å¿µï¼Œæ‡‚çš„äººä¸éœ€è¦çœ‹ï¼Œä¸æ‡‚çš„äººçœ‹äº†è¿˜æ˜¯ä¸æ‡‚ã€‚\nè¿™ç§çœ‹äº†ï¼Œåˆå¥½åƒæ²¡çœ‹çš„æ„Ÿè§‰ï¼Œäº‘é‡Œé›¾é‡Œçš„å¾ˆéš¾å—ï¼Œæˆ‘æ‡‚ã€‚\nä¸ºäº†é¿å…å¤§å®¶æœ‰å¼ºçƒˆçš„å®¡ä¸‘ç–²åŠ³ï¼Œä»Šå¤©æˆ‘ä»¬æ¥å°è¯•é‡æ–°æ¢ä¸ªæ–¹å¼è®²ä¸€è®²ã€‚\nä»TCPèŠèµ· # ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦åœ¨Aç”µè„‘çš„è¿›ç¨‹å‘ä¸€æ®µæ•°æ®åˆ°Bç”µè„‘çš„è¿›ç¨‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨ä»£ç é‡Œä½¿ç”¨socketè¿›è¡Œç¼–ç¨‹ã€‚\nè¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯é€‰é¡¹ä¸€èˆ¬ä¹Ÿå°±TCPå’ŒUDPäºŒé€‰ä¸€ã€‚TCPå¯é ï¼ŒUDPä¸å¯é ã€‚ é™¤éæ˜¯é©¬æ€»è¿™ç§ç¥çº§ç¨‹åºå‘˜ï¼ˆæ—©æœŸQQå¤§é‡ä½¿ç”¨UDPï¼‰ï¼Œå¦åˆ™ï¼Œåªè¦ç¨å¾®å¯¹å¯é æ€§æœ‰äº›è¦æ±‚ï¼Œæ™®é€šäººä¸€èˆ¬æ— è„‘é€‰TCPå°±å¯¹äº†ã€‚\nç±»ä¼¼ä¸‹é¢è¿™æ ·ã€‚\nfd = socket(AF_INET,SOCK_STREAM,0); å¤åˆ¶ä»£ç  å…¶ä¸­SOCK_STREAMï¼Œæ˜¯æŒ‡ä½¿ç”¨å­—èŠ‚æµä¼ è¾“æ•°æ®ï¼Œè¯´ç™½äº†å°±æ˜¯TCPåè®®ã€‚\nåœ¨å®šä¹‰äº†socketä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«çš„å¯¹è¿™ä¸ªsocketè¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚ç”¨bind()ç»‘å®šIPç«¯å£ï¼Œç”¨connect()å‘èµ·å»ºè¿ã€‚\nåœ¨è¿æ¥å»ºç«‹ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨send()å‘é€æ•°æ®ï¼Œrecv()æ¥æ”¶æ•°æ®ã€‚\nå…‰è¿™æ ·ä¸€ä¸ªçº¯è£¸çš„TCPè¿æ¥ï¼Œå°±å¯ä»¥åšåˆ°æ”¶å‘æ•°æ®äº†ï¼Œé‚£æ˜¯ä¸æ˜¯å°±å¤Ÿäº†ï¼Ÿ\nä¸è¡Œï¼Œè¿™ä¹ˆç”¨ä¼šæœ‰é—®é¢˜ã€‚\nä½¿ç”¨çº¯è£¸TCPä¼šæœ‰ä»€ä¹ˆé—®é¢˜ # å…«è‚¡æ–‡å¸¸èƒŒï¼ŒTCPæ˜¯æœ‰ä¸‰ä¸ªç‰¹ç‚¹ï¼Œé¢å‘è¿æ¥ã€å¯é ã€åŸºäºå­—èŠ‚æµã€‚\nè¿™ä¸‰ä¸ªç‰¹ç‚¹çœŸçš„æ¦‚æ‹¬çš„éå¸¸ç²¾è¾Ÿï¼Œè¿™ä¸ªå…«è‚¡æ–‡æˆ‘ä»¬æ²¡ç™½èƒŒã€‚\næ¯ä¸ªç‰¹ç‚¹å±•å¼€éƒ½èƒ½èŠä¸€ç¯‡æ–‡ç« ï¼Œè€Œä»Šå¤©æˆ‘ä»¬éœ€è¦å…³æ³¨çš„æ˜¯åŸºäºå­—èŠ‚æµè¿™ä¸€ç‚¹ã€‚\nå­—èŠ‚æµå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªåŒå‘çš„é€šé“é‡Œæµæ·Œçš„æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®å…¶å®å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¸€å¤§å † 01 ä¸²ã€‚çº¯è£¸TCPæ”¶å‘çš„è¿™äº› 01 ä¸²ä¹‹é—´æ˜¯æ²¡æœ‰ä»»ä½•è¾¹ç•Œçš„ï¼Œä½ æ ¹æœ¬ä¸çŸ¥é“åˆ°å“ªä¸ªåœ°æ–¹æ‰ç®—ä¸€æ¡å®Œæ•´æ¶ˆæ¯ã€‚ æ­£å› ä¸ºè¿™ä¸ªæ²¡æœ‰ä»»ä½•è¾¹ç•Œçš„ç‰¹ç‚¹ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨TCPå‘é€ \u0026ldquo;å¤æ´›\u0026quot;å’Œ\u0026quot;ç‰¹çƒ¦æ¼\u0026rdquo; çš„æ—¶å€™ï¼Œæ¥æ”¶ç«¯æ”¶åˆ°çš„å°±æ˜¯ \u0026ldquo;å¤æ´›ç‰¹çƒ¦æ¼\u0026rdquo; ï¼Œè¿™æ—¶å€™æ¥æ”¶ç«¯æ²¡å‘åŒºåˆ†ä½ æ˜¯æƒ³è¦è¡¨è¾¾ \u0026ldquo;å¤æ´›\u0026rdquo;+\u0026ldquo;ç‰¹çƒ¦æ¼\u0026rdquo; è¿˜æ˜¯ \u0026ldquo;å¤æ´›ç‰¹\u0026rdquo;+\u0026ldquo;çƒ¦æ¼\u0026rdquo; ã€‚\nè¿™å°±æ˜¯æ‰€è°“çš„ç²˜åŒ…é—®é¢˜ï¼Œä¹‹å‰ä¹Ÿå†™è¿‡ä¸€ç¯‡ä¸“é—¨çš„æ–‡ç« èŠè¿‡è¿™ä¸ªé—®é¢˜ã€‚\nè¯´è¿™ä¸ªçš„ç›®çš„æ˜¯ä¸ºäº†å‘Šè¯‰å¤§å®¶ï¼Œçº¯è£¸TCPæ˜¯ä¸èƒ½ç›´æ¥æ‹¿æ¥ç”¨çš„ï¼Œä½ éœ€è¦åœ¨è¿™ä¸ªåŸºç¡€ä¸ŠåŠ å…¥ä¸€äº›è‡ªå®šä¹‰çš„è§„åˆ™ï¼Œç”¨äºåŒºåˆ†æ¶ˆæ¯è¾¹ç•Œã€‚\näºæ˜¯æˆ‘ä»¬ä¼šæŠŠæ¯æ¡è¦å‘é€çš„æ•°æ®éƒ½åŒ…è£…ä¸€ä¸‹ï¼Œæ¯”å¦‚åŠ å…¥æ¶ˆæ¯å¤´ï¼Œæ¶ˆæ¯å¤´é‡Œå†™æ¸…æ¥šä¸€ä¸ªå®Œæ•´çš„åŒ…é•¿åº¦æ˜¯å¤šå°‘ï¼Œæ ¹æ®è¿™ä¸ªé•¿åº¦å¯ä»¥ç»§ç»­æ¥æ”¶æ•°æ®ï¼Œæˆªå–å‡ºæ¥åå®ƒä»¬å°±æ˜¯æˆ‘ä»¬çœŸæ­£è¦ä¼ è¾“çš„æ¶ˆæ¯ä½“ã€‚\nè€Œè¿™é‡Œå¤´æåˆ°çš„æ¶ˆæ¯å¤´ï¼Œè¿˜å¯ä»¥æ”¾å„ç§ä¸œè¥¿ï¼Œæ¯”å¦‚æ¶ˆæ¯ä½“æ˜¯å¦è¢«å‹ç¼©è¿‡å’Œæ¶ˆæ¯ä½“æ ¼å¼ä¹‹ç±»çš„ï¼Œåªè¦ä¸Šä¸‹æ¸¸éƒ½çº¦å®šå¥½äº†ï¼Œäº’ç›¸éƒ½è®¤å°±å¯ä»¥äº†ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„åè®®ã€‚\næ¯ä¸ªä½¿ç”¨TCPçš„é¡¹ç›®éƒ½å¯èƒ½ä¼šå®šä¹‰ä¸€å¥—ç±»ä¼¼è¿™æ ·çš„åè®®è§£ææ ‡å‡†ï¼Œä»–ä»¬å¯èƒ½æœ‰åŒºåˆ«ï¼Œä½†åŸç†éƒ½ç±»ä¼¼ã€‚\näºæ˜¯åŸºäºTCPï¼Œå°±è¡ç”Ÿäº†éå¸¸å¤šçš„åè®®ï¼Œæ¯”å¦‚HTTPå’ŒRPCã€‚\nHTTPå’ŒRPC # æˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹ç½‘ç»œçš„åˆ†å±‚å›¾ã€‚\nTCPæ˜¯ä¼ è¾“å±‚çš„åè®®ï¼Œè€ŒåŸºäºTCPé€ å‡ºæ¥çš„HTTPå’Œå„ç±»RPCåè®®ï¼Œå®ƒä»¬éƒ½åªæ˜¯å®šä¹‰äº†ä¸åŒæ¶ˆæ¯æ ¼å¼çš„åº”ç”¨å±‚åè®®è€Œå·²ã€‚\nHTTPåè®®ï¼ˆHyper Text Transfer Protocolï¼‰ï¼Œåˆå«åšè¶…æ–‡æœ¬ä¼ è¾“åè®®ã€‚æˆ‘ä»¬ç”¨çš„æ¯”è¾ƒå¤šï¼Œå¹³æ—¶ä¸Šç½‘åœ¨æµè§ˆå™¨ä¸Šæ•²ä¸ªç½‘å€å°±èƒ½è®¿é—®ç½‘é¡µï¼Œè¿™é‡Œç”¨åˆ°çš„å°±æ˜¯HTTPåè®®ã€‚\nè€ŒRPCï¼ˆRemote Procedure Callï¼‰ï¼Œåˆå«åšè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚å®ƒæœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„åè®®ï¼Œè€Œæ˜¯ä¸€ç§è°ƒç”¨æ–¹å¼ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¹³æ—¶è°ƒç”¨ä¸€ä¸ªæœ¬åœ°æ–¹æ³•å°±åƒä¸‹é¢è¿™æ ·ã€‚\nres = localFunc(req) å¤åˆ¶ä»£ç  å¦‚æœç°åœ¨è¿™ä¸æ˜¯ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œè€Œæ˜¯ä¸ªè¿œç«¯æœåŠ¡å™¨æš´éœ²å‡ºæ¥çš„ä¸€ä¸ªæ–¹æ³•remoteFuncï¼Œå¦‚æœæˆ‘ä»¬è¿˜èƒ½åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•é‚£æ ·å»è°ƒç”¨å®ƒï¼Œè¿™æ ·å°±å¯ä»¥å±è”½æ‰ä¸€äº›ç½‘ç»œç»†èŠ‚ï¼Œç”¨èµ·æ¥æ›´æ–¹ä¾¿ï¼Œå²‚ä¸ç¾å“‰ï¼Ÿ\nres = remoteFunc(req) å¤åˆ¶ä»£ç  åŸºäºè¿™ä¸ªæ€è·¯ï¼Œå¤§ä½¬ä»¬é€ å‡ºäº†éå¸¸å¤šæ¬¾å¼çš„RPCåè®®ï¼Œæ¯”å¦‚æ¯”è¾ƒæœ‰åçš„gRPCï¼Œthriftã€‚\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶å¤§éƒ¨åˆ†RPCåè®®åº•å±‚ä½¿ç”¨TCPï¼Œä½†å®é™…ä¸Šå®ƒä»¬ä¸ä¸€å®šéå¾—ä½¿ç”¨TCPï¼Œæ”¹ç”¨UDPæˆ–è€…HTTPï¼Œå…¶å®ä¹Ÿå¯ä»¥åšåˆ°ç±»ä¼¼çš„åŠŸèƒ½ã€‚\nåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å›åˆ°æ–‡ç« æ ‡é¢˜çš„é—®é¢˜ã€‚\næ—¢ç„¶æœ‰HTTPåè®®ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰RPCï¼Ÿ\nå…¶å®ï¼ŒTCPæ˜¯70å¹´ä»£å‡ºæ¥çš„åè®®ï¼Œè€ŒHTTPæ˜¯90å¹´ä»£æ‰å¼€å§‹æµè¡Œçš„ã€‚è€Œç›´æ¥ä½¿ç”¨è£¸TCPä¼šæœ‰é—®é¢˜ï¼Œå¯æƒ³è€ŒçŸ¥ï¼Œè¿™ä¸­é—´è¿™ä¹ˆå¤šå¹´æœ‰å¤šå°‘è‡ªå®šä¹‰çš„åè®®ï¼Œè€Œè¿™é‡Œé¢å°±æœ‰80å¹´ä»£å‡ºæ¥çš„RPCã€‚\næ‰€ä»¥æˆ‘ä»¬è¯¥é—®çš„ä¸æ˜¯æ—¢ç„¶æœ‰HTTPåè®®ä¸ºä»€ä¹ˆè¦æœ‰RPCï¼Œè€Œæ˜¯ä¸ºä»€ä¹ˆæœ‰RPCè¿˜è¦æœ‰HTTPåè®®ã€‚\né‚£æ—¢ç„¶æœ‰RPCäº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰HTTPå‘¢ï¼Ÿ # ç°åœ¨ç”µè„‘ä¸Šè£…çš„å„ç§è”ç½‘è½¯ä»¶ï¼Œæ¯”å¦‚xxç®¡å®¶ï¼Œxxå«å£«ï¼Œå®ƒä»¬éƒ½ä½œä¸ºå®¢æˆ·ç«¯ï¼ˆclientï¼‰ éœ€è¦è·ŸæœåŠ¡ç«¯ï¼ˆserverï¼‰ å»ºç«‹è¿æ¥æ”¶å‘æ¶ˆæ¯ï¼Œæ­¤æ—¶éƒ½ä¼šç”¨åˆ°åº”ç”¨å±‚åè®®ï¼Œåœ¨è¿™ç§client/server (c/s) æ¶æ„ä¸‹ï¼Œå®ƒä»¬å¯ä»¥ä½¿ç”¨è‡ªå®¶é€ çš„RPCåè®®ï¼Œå› ä¸ºå®ƒåªç®¡è¿è‡ªå·±å…¬å¸çš„æœåŠ¡å™¨å°±okäº†ã€‚\nä½†æœ‰ä¸ªè½¯ä»¶ä¸åŒï¼Œæµè§ˆå™¨ï¼ˆbrowserï¼‰ ï¼Œä¸ç®¡æ˜¯chromeè¿˜æ˜¯IEï¼Œå®ƒä»¬ä¸ä»…è¦èƒ½è®¿é—®è‡ªå®¶å…¬å¸çš„æœåŠ¡å™¨ï¼ˆserverï¼‰ ï¼Œè¿˜éœ€è¦è®¿é—®å…¶ä»–å…¬å¸çš„ç½‘ç«™æœåŠ¡å™¨ï¼Œå› æ­¤å®ƒä»¬éœ€è¦æœ‰ä¸ªç»Ÿä¸€çš„æ ‡å‡†ï¼Œä¸ç„¶å¤§å®¶æ²¡æ³•äº¤æµã€‚äºæ˜¯ï¼ŒHTTPå°±æ˜¯é‚£ä¸ªæ—¶ä»£ç”¨äºç»Ÿä¸€ browser/server (b/s) çš„åè®®ã€‚\nä¹Ÿå°±æ˜¯è¯´åœ¨å¤šå¹´ä»¥å‰ï¼ŒHTTPä¸»è¦ç”¨äºb/sæ¶æ„ï¼Œè€ŒRPCæ›´å¤šç”¨äºc/sæ¶æ„ã€‚ä½†ç°åœ¨å…¶å®å·²ç»æ²¡åˆ†é‚£ä¹ˆæ¸…äº†ï¼Œb/så’Œc/såœ¨æ…¢æ…¢èåˆã€‚ å¾ˆå¤šè½¯ä»¶åŒæ—¶æ”¯æŒå¤šç«¯ï¼Œæ¯”å¦‚æŸåº¦äº‘ç›˜ï¼Œæ—¢è¦æ”¯æŒç½‘é¡µç‰ˆï¼Œè¿˜è¦æ”¯æŒæ‰‹æœºç«¯å’Œpcç«¯ï¼Œå¦‚æœé€šä¿¡åè®®éƒ½ç”¨HTTPçš„è¯ï¼Œé‚£æœåŠ¡å™¨åªç”¨åŒä¸€å¥—å°±å¤Ÿäº†ã€‚è€ŒRPCå°±å¼€å§‹é€€å±…å¹•åï¼Œä¸€èˆ¬ç”¨äºå…¬å¸å†…éƒ¨é›†ç¾¤é‡Œï¼Œå„ä¸ªå¾®æœåŠ¡ä¹‹é—´çš„é€šè®¯ã€‚\né‚£è¿™ä¹ˆè¯´çš„è¯ï¼Œéƒ½ç”¨HTTPå¾—äº†ï¼Œè¿˜ç”¨ä»€ä¹ˆRPCï¼Ÿ\nä»¿ä½›åˆå›åˆ°äº†æ–‡ç« å¼€å¤´çš„æ ·å­ï¼Œé‚£è¿™å°±è¦ä»å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«å¼€å§‹è¯´èµ·ã€‚\nHTTPå’ŒRPCæœ‰ä»€ä¹ˆåŒºåˆ« # æˆ‘ä»¬æ¥çœ‹çœ‹RPCå’ŒHTTPåŒºåˆ«æ¯”è¾ƒæ˜æ˜¾çš„å‡ ä¸ªç‚¹ã€‚\næœåŠ¡å‘ç° # é¦–å…ˆè¦å‘æŸä¸ªæœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œä½ å¾—å…ˆå»ºç«‹è¿æ¥ï¼Œè€Œå»ºç«‹è¿æ¥çš„å‰ææ˜¯ï¼Œä½ å¾—çŸ¥é“IPåœ°å€å’Œç«¯å£ã€‚è¿™ä¸ªæ‰¾åˆ°æœåŠ¡å¯¹åº”çš„IPç«¯å£çš„è¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯æœåŠ¡å‘ç°ã€‚\nåœ¨HTTPä¸­ï¼Œä½ çŸ¥é“æœåŠ¡çš„åŸŸåï¼Œå°±å¯ä»¥é€šè¿‡DNSæœåŠ¡å»è§£æå¾—åˆ°å®ƒèƒŒåçš„IPåœ°å€ï¼Œé»˜è®¤80ç«¯å£ã€‚\nè€ŒRPCçš„è¯ï¼Œå°±æœ‰äº›åŒºåˆ«ï¼Œä¸€èˆ¬ä¼šæœ‰ä¸“é—¨çš„ä¸­é—´æœåŠ¡å»ä¿å­˜æœåŠ¡åå’ŒIPä¿¡æ¯ï¼Œæ¯”å¦‚consulæˆ–è€…etcdï¼Œç”šè‡³æ˜¯redisã€‚æƒ³è¦è®¿é—®æŸä¸ªæœåŠ¡ï¼Œå°±å»è¿™äº›ä¸­é—´æœåŠ¡å»è·å¾—IPå’Œç«¯å£ä¿¡æ¯ã€‚ç”±äºdnsä¹Ÿæ˜¯æœåŠ¡å‘ç°çš„ä¸€ç§ï¼Œæ‰€ä»¥ä¹Ÿæœ‰åŸºäºdnså»åšæœåŠ¡å‘ç°çš„ç»„ä»¶ï¼Œæ¯”å¦‚CoreDNSã€‚\nå¯ä»¥çœ‹å‡ºæœåŠ¡å‘ç°è¿™ä¸€å—ï¼Œä¸¤è€…æ˜¯æœ‰äº›åŒºåˆ«ï¼Œä½†ä¸å¤ªèƒ½åˆ†é«˜ä½ã€‚\nåº•å±‚è¿æ¥å½¢å¼ # ä»¥ä¸»æµçš„HTTP1.1åè®®ä¸ºä¾‹ï¼Œå…¶é»˜è®¤åœ¨å»ºç«‹åº•å±‚TCPè¿æ¥ä¹‹åä¼šä¸€ç›´ä¿æŒè¿™ä¸ªè¿æ¥ï¼ˆkeep aliveï¼‰ï¼Œä¹‹åçš„è¯·æ±‚å’Œå“åº”éƒ½ä¼šå¤ç”¨è¿™æ¡è¿æ¥ã€‚\nè€ŒRPCåè®®ï¼Œä¹Ÿè·ŸHTTPç±»ä¼¼ï¼Œä¹Ÿæ˜¯é€šè¿‡å»ºç«‹TCPé•¿é“¾æ¥è¿›è¡Œæ•°æ®äº¤äº’ï¼Œä½†ä¸åŒçš„åœ°æ–¹åœ¨äºï¼ŒRPCåè®®ä¸€èˆ¬è¿˜ä¼šå†å»ºä¸ªè¿æ¥æ± ï¼Œåœ¨è¯·æ±‚é‡å¤§çš„æ—¶å€™ï¼Œå»ºç«‹å¤šæ¡è¿æ¥æ”¾åœ¨æ± å†…ï¼Œè¦å‘æ•°æ®çš„æ—¶å€™å°±ä»æ± é‡Œå–ä¸€æ¡è¿æ¥å‡ºæ¥ï¼Œç”¨å®Œæ”¾å›å»ï¼Œä¸‹æ¬¡å†å¤ç”¨ï¼Œå¯ä»¥è¯´éå¸¸ç¯ä¿ã€‚\nç”±äºè¿æ¥æ± æœ‰åˆ©äºæå‡ç½‘ç»œè¯·æ±‚æ€§èƒ½ï¼Œæ‰€ä»¥ä¸å°‘ç¼–ç¨‹è¯­è¨€çš„ç½‘ç»œåº“é‡Œéƒ½ä¼šç»™HTTPåŠ ä¸ªè¿æ¥æ± ï¼Œæ¯”å¦‚goå°±æ˜¯è¿™ä¹ˆå¹²çš„ã€‚\nå¯ä»¥çœ‹å‡ºè¿™ä¸€å—ä¸¤è€…ä¹Ÿæ²¡å¤ªå¤§åŒºåˆ«ï¼Œæ‰€ä»¥ä¹Ÿä¸æ˜¯å…³é”®ã€‚\nä¼ è¾“çš„å†…å®¹ # åŸºäºTCPä¼ è¾“çš„æ¶ˆæ¯ï¼Œè¯´åˆ°åº•ï¼Œæ— ééƒ½æ˜¯æ¶ˆæ¯å¤´headerå’Œæ¶ˆæ¯ä½“bodyã€‚\nheaderæ˜¯ç”¨äºæ ‡è®°ä¸€äº›ç‰¹æ®Šä¿¡æ¯ï¼Œå…¶ä¸­æœ€é‡è¦çš„æ˜¯æ¶ˆæ¯ä½“é•¿åº¦ã€‚\nbodyåˆ™æ˜¯æ”¾æˆ‘ä»¬çœŸæ­£éœ€è¦ä¼ è¾“çš„å†…å®¹ï¼Œè€Œè¿™äº›å†…å®¹åªèƒ½æ˜¯äºŒè¿›åˆ¶01ä¸²ï¼Œæ¯•ç«Ÿè®¡ç®—æœºåªè®¤è¯†è¿™ç©æ„ã€‚æ‰€ä»¥TCPä¼ å­—ç¬¦ä¸²å’Œæ•°å­—éƒ½é—®é¢˜ä¸å¤§ï¼Œå› ä¸ºå­—ç¬¦ä¸²å¯ä»¥è½¬æˆç¼–ç å†å˜æˆ01ä¸²ï¼Œè€Œæ•°å­—æœ¬èº«ä¹Ÿèƒ½ç›´æ¥è½¬ä¸ºäºŒè¿›åˆ¶ã€‚ä½†ç»“æ„ä½“å‘¢ï¼Œæˆ‘ä»¬å¾—æƒ³ä¸ªåŠæ³•å°†å®ƒä¹Ÿè½¬ä¸ºäºŒè¿›åˆ¶01ä¸²ï¼Œè¿™æ ·çš„æ–¹æ¡ˆç°åœ¨ä¹Ÿæœ‰å¾ˆå¤šç°æˆçš„ï¼Œæ¯”å¦‚jsonï¼Œprotobufã€‚\nè¿™ä¸ªå°†ç»“æ„ä½“è½¬ä¸ºäºŒè¿›åˆ¶æ•°ç»„çš„è¿‡ç¨‹å°±å«åºåˆ—åŒ–ï¼Œåè¿‡æ¥å°†äºŒè¿›åˆ¶æ•°ç»„å¤åŸæˆç»“æ„ä½“çš„è¿‡ç¨‹å«ååºåˆ—åŒ–ã€‚\nå¯¹äºä¸»æµçš„HTTP1.1ï¼Œè™½ç„¶å®ƒç°åœ¨å«è¶…æ–‡æœ¬åè®®ï¼Œæ”¯æŒéŸ³é¢‘è§†é¢‘ï¼Œä½†HTTPè®¾è®¡åˆæ˜¯ç”¨äºåšç½‘é¡µæ–‡æœ¬å±•ç¤ºçš„ï¼Œæ‰€ä»¥å®ƒä¼ çš„å†…å®¹ä»¥å­—ç¬¦ä¸²ä¸ºä¸»ã€‚headerå’Œbodyéƒ½æ˜¯å¦‚æ­¤ã€‚åœ¨bodyè¿™å—ï¼Œå®ƒä½¿ç”¨jsonæ¥åºåˆ—åŒ–ç»“æ„ä½“æ•°æ®ã€‚\næˆ‘ä»¬å¯ä»¥éšä¾¿æˆªä¸ªå›¾ç›´è§‚çœ‹ä¸‹ã€‚\nå¯ä»¥çœ‹åˆ°è¿™é‡Œé¢çš„å†…å®¹éå¸¸å¤šçš„å†—ä½™ï¼Œæ˜¾å¾—éå¸¸å•°å—¦ã€‚æœ€æ˜æ˜¾çš„ï¼Œåƒheaderé‡Œçš„é‚£äº›ä¿¡æ¯ï¼Œå…¶å®å¦‚æœæˆ‘ä»¬çº¦å®šå¥½å¤´éƒ¨çš„ç¬¬å‡ ä½æ˜¯content-typeï¼Œå°±ä¸éœ€è¦æ¯æ¬¡éƒ½çœŸçš„æŠŠ\u0026quot;content-type\u0026quot;è¿™ä¸ªå­—æ®µéƒ½ä¼ è¿‡æ¥ï¼Œç±»ä¼¼çš„æƒ…å†µå…¶å®åœ¨bodyçš„jsonç»“æ„é‡Œä¹Ÿç‰¹åˆ«æ˜æ˜¾ã€‚\nè€ŒRPCï¼Œå› ä¸ºå®ƒå®šåˆ¶åŒ–ç¨‹åº¦æ›´é«˜ï¼Œå¯ä»¥é‡‡ç”¨ä½“ç§¯æ›´å°çš„protobufæˆ–å…¶ä»–åºåˆ—åŒ–åè®®å»ä¿å­˜ç»“æ„ä½“æ•°æ®ï¼ŒåŒæ—¶ä¹Ÿä¸éœ€è¦åƒHTTPé‚£æ ·è€ƒè™‘å„ç§æµè§ˆå™¨è¡Œä¸ºï¼Œæ¯”å¦‚302é‡å®šå‘è·³è½¬å•¥çš„ã€‚å› æ­¤æ€§èƒ½ä¹Ÿä¼šæ›´å¥½ä¸€äº›ï¼Œè¿™ä¹Ÿæ˜¯åœ¨å…¬å¸å†…éƒ¨å¾®æœåŠ¡ä¸­æŠ›å¼ƒHTTPï¼Œé€‰æ‹©ä½¿ç”¨RPCçš„æœ€ä¸»è¦åŸå› ã€‚\n====ç¼ºä¸€å¼ å›¾ç‰‡====\nå½“ç„¶ä¸Šé¢è¯´çš„HTTPï¼Œå…¶å®ç‰¹æŒ‡çš„æ˜¯ç°åœ¨ä¸»æµä½¿ç”¨çš„HTTP1.1ï¼ŒHTTP2åœ¨å‰è€…çš„åŸºç¡€ä¸Šåšäº†å¾ˆå¤šæ”¹è¿›ï¼Œæ‰€ä»¥æ€§èƒ½å¯èƒ½æ¯”å¾ˆå¤šRPCåè®®è¿˜è¦å¥½ï¼Œç”šè‡³è¿gRPCåº•å±‚éƒ½ç›´æ¥ç”¨çš„HTTP2ã€‚\né‚£ä¹ˆé—®é¢˜åˆæ¥äº†ã€‚\nä¸ºä»€ä¹ˆæ—¢ç„¶æœ‰äº†HTTP2ï¼Œè¿˜è¦æœ‰RPCåè®®ï¼Ÿ # è¿™ä¸ªæ˜¯ç”±äºHTTP2æ˜¯2015å¹´å‡ºæ¥çš„ã€‚é‚£æ—¶å€™å¾ˆå¤šå…¬å¸å†…éƒ¨çš„RPCåè®®éƒ½å·²ç»è·‘äº†å¥½äº›å¹´äº†ï¼ŒåŸºäºå†å²åŸå› ï¼Œä¸€èˆ¬ä¹Ÿæ²¡å¿…è¦å»æ¢äº†ã€‚\næ€»ç»“ # çº¯è£¸TCPæ˜¯èƒ½æ”¶å‘æ•°æ®ï¼Œä½†å®ƒæ˜¯ä¸ªæ— è¾¹ç•Œçš„æ•°æ®æµï¼Œä¸Šå±‚éœ€è¦å®šä¹‰æ¶ˆæ¯æ ¼å¼ç”¨äºå®šä¹‰æ¶ˆæ¯è¾¹ç•Œã€‚äºæ˜¯å°±æœ‰äº†å„ç§åè®®ï¼ŒHTTPå’Œå„ç±»RPCåè®®å°±æ˜¯åœ¨TCPä¹‹ä¸Šå®šä¹‰çš„åº”ç”¨å±‚åè®®ã€‚ RPCæœ¬è´¨ä¸Šä¸ç®—æ˜¯åè®®ï¼Œè€Œæ˜¯ä¸€ç§è°ƒç”¨æ–¹å¼ï¼Œè€ŒåƒgRPCå’Œthriftè¿™æ ·çš„å…·ä½“å®ç°ï¼Œæ‰æ˜¯åè®®ï¼Œå®ƒä»¬æ˜¯å®ç°äº†RPCè°ƒç”¨çš„åè®®ã€‚ç›®çš„æ˜¯å¸Œæœ›ç¨‹åºå‘˜èƒ½åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•é‚£æ ·å»è°ƒç”¨è¿œç«¯çš„æœåŠ¡æ–¹æ³•ã€‚åŒæ—¶RPCæœ‰å¾ˆå¤šç§å®ç°æ–¹å¼ï¼Œä¸ä¸€å®šéå¾—åŸºäºTCPåè®®ã€‚ ä»å‘å±•å†å²æ¥è¯´ï¼ŒHTTPä¸»è¦ç”¨äºb/sæ¶æ„ï¼Œè€ŒRPCæ›´å¤šç”¨äºc/sæ¶æ„ã€‚ä½†ç°åœ¨å…¶å®å·²ç»æ²¡åˆ†é‚£ä¹ˆæ¸…äº†ï¼Œb/så’Œc/såœ¨æ…¢æ…¢èåˆã€‚ å¾ˆå¤šè½¯ä»¶åŒæ—¶æ”¯æŒå¤šç«¯ï¼Œæ‰€ä»¥å¯¹å¤–ä¸€èˆ¬ç”¨HTTPåè®®ï¼Œè€Œå†…éƒ¨é›†ç¾¤çš„å¾®æœåŠ¡ä¹‹é—´åˆ™é‡‡ç”¨RPCåè®®è¿›è¡Œé€šè®¯ã€‚ RPCå…¶å®æ¯”HTTPå‡ºç°çš„è¦æ—©ï¼Œä¸”æ¯”ç›®å‰ä¸»æµçš„HTTP1.1æ€§èƒ½è¦æ›´å¥½ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†å…¬å¸å†…éƒ¨éƒ½è¿˜åœ¨ä½¿ç”¨RPCã€‚ HTTP2.0åœ¨HTTP1.1çš„åŸºç¡€ä¸Šåšäº†ä¼˜åŒ–ï¼Œæ€§èƒ½å¯èƒ½æ¯”å¾ˆå¤šRPCåè®®éƒ½è¦å¥½ï¼Œä½†ç”±äºæ˜¯è¿™å‡ å¹´æ‰å‡ºæ¥çš„ï¼Œæ‰€ä»¥ä¹Ÿä¸å¤ªå¯èƒ½å–ä»£æ‰RPCã€‚ æœ€åç•™ä¸ªé—®é¢˜å§ï¼Œå¤§å®¶æœ‰æ²¡æœ‰å‘ç°ï¼Œä¸ç®¡æ˜¯HTTPè¿˜æ˜¯RPCï¼Œå®ƒä»¬éƒ½æœ‰ä¸ªç‰¹ç‚¹ï¼Œé‚£å°±æ˜¯æ¶ˆæ¯éƒ½æ˜¯å®¢æˆ·ç«¯è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å“åº”ã€‚å®¢æˆ·ç«¯æ²¡é—®ï¼ŒæœåŠ¡ç«¯è‚¯å®šå°±ä¸ç­”ï¼Œè¿™å°±æœ‰ç‚¹åƒµäº†ï¼Œä½†ç°å®ä¸­è‚¯å®šæœ‰éœ€è¦ä¸‹æ¸¸ä¸»åŠ¨å‘é€æ¶ˆæ¯ç»™ä¸Šæ¸¸çš„åœºæ™¯ï¼Œæ¯”å¦‚æ‰“ä¸ªç½‘é¡µæ¸¸æˆï¼Œç«™åœ¨é‚£å•¥ä¹Ÿä¸æ“ä½œï¼Œæ€ªä¹Ÿä¼šä¸»åŠ¨æ”»å‡»æˆ‘ï¼Œè¿™ç§æƒ…å†µè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ\næœ€å # æŒ‰ç…§æƒ¯ä¾‹ï¼Œæˆ‘åº”è¯¥åœ¨è¿™é‡Œå”¯å”¯è¯ºè¯ºçš„æ±‚å¤§å®¶å«æˆ‘ä¸¤å£°é“ä»”çš„ã€‚\nä½†è¿˜æ˜¯ç®—äº†ã€‚å› ä¸ºæˆ‘æœ€è¿‘ä¸€ç›´åœ¨æƒ³ä¸€ä¸ªé—®é¢˜ï¼Œå¸Œæœ›å…„å¼Ÿä»¬èƒ½åœ¨è¯„è®ºåŒºå‘Šè¯‰æˆ‘ç­”æ¡ˆã€‚\næœ€è¿‘æ‰‹æœºå€Ÿç»™åˆ«äººç©äº†ä¸€ä¸‹åˆï¼Œç°åœ¨è€æ˜¯ç»™æˆ‘æ¨èç»ƒä¹ æ—¶é•¿ä¸¤å¹´åŠçš„ç»ƒä¹ ç”Ÿè§†é¢‘ã€‚\næ¯ä¸ªè§†é¢‘éƒ½åœ¨å£°å˜¶åŠ›ç«­çš„å‘Šè¯‰æˆ‘ï¼Œé¸¡ä½ å¤ªç¾ã€‚\næ‰€ä»¥æˆ‘å¾ˆæƒ³é—®ï¼Œå…„å¼Ÿä»¬ã€‚\né¸¡ï¼Œåˆ°åº•ç¾ä¸ç¾ï¼Ÿ\nå¤´ç–¼ã€‚\nå³ä¸‹è§’çš„ç‚¹èµå’Œå†çœ‹è¿˜æ˜¯å¯ä»¥èµ°ä¸€æ³¢çš„ã€‚\nå…ˆè¿™æ ·ã€‚\næˆ‘æ˜¯å°ç™½ï¼Œæˆ‘ä»¬ä¸‹æœŸè§ã€‚\nåˆ«è¯´äº†ï¼Œä¸€èµ·åœ¨çŸ¥è¯†çš„æµ·æ´‹é‡Œå‘›æ°´å§ # "},{"id":84,"href":"/zh/docs/study/Review/java_guide/lydly_distributed_system/ly05ly_rpc-intro/","title":"rpcåŸºç¡€åŠé¢è¯•é¢˜","section":"åˆ†å¸ƒå¼ç³»ç»Ÿ","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nç®€å•ä»‹ç»ä¸€ä¸‹ RPC ç›¸å…³çš„åŸºç¡€æ¦‚å¿µã€‚\nä½•ä¸º RPC? # RPCï¼ˆRemote Procedure Callï¼‰ å³è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œé€šè¿‡åå­—æˆ‘ä»¬å°±èƒ½çœ‹å‡º RPC å…³æ³¨çš„æ˜¯è¿œç¨‹è°ƒç”¨è€Œéæœ¬åœ°è°ƒç”¨ã€‚\nä¸ºä»€ä¹ˆè¦ RPC ï¼Ÿ å› ä¸ºï¼Œä¸¤ä¸ªä¸åŒçš„æœåŠ¡å™¨ä¸Šçš„æœåŠ¡æä¾›çš„æ–¹æ³•ä¸åœ¨ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œç¼–ç¨‹æ‰èƒ½ä¼ é€’æ–¹æ³•è°ƒç”¨æ‰€éœ€è¦çš„å‚æ•°ã€‚å¹¶ä¸”ï¼Œæ–¹æ³•è°ƒç”¨çš„ç»“æœä¹Ÿéœ€è¦é€šè¿‡ç½‘ç»œç¼–ç¨‹æ¥æ¥æ”¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨ç½‘ç»œç¼–ç¨‹æ¥å®ç°è¿™ä¸ªè°ƒç”¨è¿‡ç¨‹çš„è¯å·¥ä½œé‡æ˜¯éå¸¸å¤§çš„ï¼Œå› ä¸ºï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘åº•å±‚ä¼ è¾“æ–¹å¼ï¼ˆTCPè¿˜æ˜¯UDPï¼‰ã€åºåˆ—åŒ–æ–¹å¼ç­‰ç­‰æ–¹é¢ã€‚\nRPC èƒ½å¸®åŠ©æˆ‘ä»¬åšä»€ä¹ˆå‘¢ï¼Ÿ ç®€å•æ¥è¯´ï¼Œé€šè¿‡ RPC å¯ä»¥å¸®åŠ©æˆ‘ä»¬è°ƒç”¨è¿œç¨‹è®¡ç®—æœºä¸ŠæŸä¸ªæœåŠ¡çš„æ–¹æ³•ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•ã€‚å¹¶ä¸”ï¼æˆ‘ä»¬ä¸éœ€è¦äº†è§£åº•å±‚ç½‘ç»œç¼–ç¨‹çš„å…·ä½“ç»†èŠ‚ã€‚\nä¸¾ä¸ªä¾‹å­ï¼šä¸¤ä¸ªä¸åŒçš„æœåŠ¡ Aã€B éƒ¨ç½²åœ¨ä¸¤å°ä¸åŒçš„æœºå™¨ä¸Šï¼ŒæœåŠ¡ A å¦‚æœæƒ³è¦è°ƒç”¨æœåŠ¡ B ä¸­çš„æŸä¸ªæ–¹æ³•çš„è¯å°±å¯ä»¥é€šè¿‡ RPC æ¥åšã€‚\nä¸€è¨€è”½ä¹‹ï¼šRPC çš„å‡ºç°å°±æ˜¯ä¸ºäº†è®©ä½ è°ƒç”¨è¿œç¨‹æ–¹æ³•åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•ã€‚\nRPC çš„åŸç†æ˜¯ä»€ä¹ˆ? # ä¸ºäº†èƒ½å¤Ÿå¸®åŠ©å°ä¼™ä¼´ä»¬ç†è§£ RPC åŸç†ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•´ä¸ª RPCçš„ æ ¸å¿ƒåŠŸèƒ½çœ‹ä½œæ˜¯ä¸‹é¢ğŸ‘‡ 5 ä¸ªéƒ¨åˆ†å®ç°çš„ï¼š\nå®¢æˆ·ç«¯ï¼ˆæœåŠ¡æ¶ˆè´¹ç«¯ï¼‰ ï¼šè°ƒç”¨è¿œç¨‹æ–¹æ³•çš„ä¸€ç«¯ã€‚ å®¢æˆ·ç«¯ Stubï¼ˆæ¡©ï¼‰ ï¼š è¿™å…¶å®å°±æ˜¯ä¸€ä»£ç†ç±»ã€‚ä»£ç†ç±»ä¸»è¦åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠä½ è°ƒç”¨æ–¹æ³•ã€ç±»ã€æ–¹æ³•å‚æ•°ç­‰ä¿¡æ¯ä¼ é€’åˆ°æœåŠ¡ç«¯ã€‚ ç½‘ç»œä¼ è¾“ ï¼š ç½‘ç»œä¼ è¾“å°±æ˜¯ä½ è¦æŠŠä½ è°ƒç”¨çš„æ–¹æ³•çš„ä¿¡æ¯æ¯”å¦‚è¯´å‚æ•°å•Šè¿™äº›ä¸œè¥¿ä¼ è¾“åˆ°æœåŠ¡ç«¯ï¼Œç„¶åæœåŠ¡ç«¯æ‰§è¡Œå®Œä¹‹åå†æŠŠè¿”å›ç»“æœé€šè¿‡ç½‘ç»œä¼ è¾“ç»™ä½ ä¼ è¾“å›æ¥ã€‚ç½‘ç»œä¼ è¾“çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šç§æ¯”å¦‚æœ€è¿‘åŸºæœ¬çš„ Socketæˆ–è€…æ€§èƒ½ä»¥åŠå°è£…æ›´åŠ ä¼˜ç§€çš„ Nettyï¼ˆæ¨èï¼‰ã€‚ æœåŠ¡ç«¯ Stubï¼ˆæ¡©ï¼‰ ï¼šè¿™ä¸ªæ¡©å°±ä¸æ˜¯ä»£ç†ç±»äº†ã€‚æˆ‘è§‰å¾—ç†è§£ä¸ºæ¡©å®é™…ä¸å¤ªå¥½ï¼Œå¤§å®¶æ³¨æ„ä¸€ä¸‹å°±å¥½ã€‚è¿™é‡Œçš„æœåŠ¡ç«¯ Stub å®é™…æŒ‡çš„å°±æ˜¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯æ‰§è¡Œæ–¹æ³•çš„è¯·æ±‚åï¼Œå»æŒ‡å®šå¯¹åº”çš„æ–¹æ³•ç„¶åè¿”å›ç»“æœç»™å®¢æˆ·ç«¯çš„ç±»ã€‚ æœåŠ¡ç«¯ï¼ˆæœåŠ¡æä¾›ç«¯ï¼‰ ï¼šæä¾›è¿œç¨‹æ–¹æ³•çš„ä¸€ç«¯ã€‚ å…·ä½“åŸç†å›¾å¦‚ä¸‹ï¼Œåé¢æˆ‘ä¼šä¸²èµ·æ¥å°†æ•´ä¸ªRPCçš„è¿‡ç¨‹ç»™å¤§å®¶è¯´ä¸€ä¸‹ã€‚\næœåŠ¡æ¶ˆè´¹ç«¯ï¼ˆclientï¼‰ä»¥æœ¬åœ°è°ƒç”¨çš„æ–¹å¼è°ƒç”¨è¿œç¨‹æœåŠ¡ï¼› å®¢æˆ·ç«¯ Stubï¼ˆclient stubï¼‰ æ¥æ”¶åˆ°è°ƒç”¨åè´Ÿè´£å°†æ–¹æ³•ã€å‚æ•°ç­‰ç»„è£…æˆèƒ½å¤Ÿè¿›è¡Œç½‘ç»œä¼ è¾“çš„æ¶ˆæ¯ä½“ï¼ˆåºåˆ—åŒ–ï¼‰ï¼šRpcRequestï¼› å®¢æˆ·ç«¯ Stubï¼ˆclient stubï¼‰ æ‰¾åˆ°è¿œç¨‹æœåŠ¡çš„åœ°å€ï¼Œå¹¶å°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡æä¾›ç«¯ï¼› æœåŠ¡ç«¯ Stubï¼ˆæ¡©ï¼‰æ”¶åˆ°æ¶ˆæ¯å°†æ¶ˆæ¯ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡: RpcRequestï¼› æœåŠ¡ç«¯ Stubï¼ˆæ¡©ï¼‰æ ¹æ®RpcRequestä¸­çš„ç±»ã€æ–¹æ³•ã€æ–¹æ³•å‚æ•°ç­‰ä¿¡æ¯è°ƒç”¨æœ¬åœ°çš„æ–¹æ³•ï¼› æœåŠ¡ç«¯ Stubï¼ˆæ¡©ï¼‰å¾—åˆ°æ–¹æ³•æ‰§è¡Œç»“æœå¹¶å°†ç»„è£…æˆèƒ½å¤Ÿè¿›è¡Œç½‘ç»œä¼ è¾“çš„æ¶ˆæ¯ä½“ï¼šRpcResponseï¼ˆåºåˆ—åŒ–ï¼‰å‘é€è‡³æ¶ˆè´¹æ–¹ï¼› å®¢æˆ·ç«¯ Stubï¼ˆclient stubï¼‰æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶å°†æ¶ˆæ¯ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡:RpcResponse ï¼Œè¿™æ ·ä¹Ÿå°±å¾—åˆ°äº†æœ€ç»ˆç»“æœã€‚over! ç›¸ä¿¡å°ä¼™ä¼´ä»¬çœ‹å®Œä¸Šé¢çš„è®²è§£ä¹‹åï¼Œå·²ç»äº†è§£äº† RPC çš„åŸç†ã€‚\nè™½ç„¶ç¯‡å¹…ä¸å¤šï¼Œä½†æ˜¯åŸºæœ¬æŠŠ RPC æ¡†æ¶çš„æ ¸å¿ƒåŸç†è®²æ¸…æ¥šäº†ï¼å¦å¤–ï¼Œå¯¹äºä¸Šé¢çš„æŠ€æœ¯ç»†èŠ‚ï¼Œæˆ‘ä¼šåœ¨åé¢çš„ç« èŠ‚ä»‹ç»åˆ°ã€‚\næœ€åï¼Œå¯¹äº RPC çš„åŸç†ï¼Œå¸Œæœ›å°ä¼™ä¼´ä¸å•å•è¦ç†è§£ï¼Œè¿˜è¦èƒ½å¤Ÿè‡ªå·±ç”»å‡ºæ¥å¹¶ä¸”èƒ½å¤Ÿç»™åˆ«äººè®²å‡ºæ¥ã€‚å› ä¸ºï¼Œåœ¨é¢è¯•ä¸­è¿™ä¸ªé—®é¢˜åœ¨é¢è¯•å®˜é—®åˆ° RPC ç›¸å…³å†…å®¹çš„æ—¶å€™åŸºæœ¬éƒ½ä¼šç¢°åˆ°ã€‚\næœ‰å“ªäº›å¸¸è§çš„ RPC æ¡†æ¶ï¼Ÿ # æˆ‘ä»¬è¿™é‡Œè¯´çš„ RPC æ¡†æ¶æŒ‡çš„æ˜¯å¯ä»¥è®©å®¢æˆ·ç«¯ç›´æ¥è°ƒç”¨æœåŠ¡ç«¯æ–¹æ³•ï¼Œå°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•çš„æ¡†æ¶ï¼Œæ¯”å¦‚æˆ‘ä¸‹é¢ä»‹ç»çš„ Dubboã€Motanã€gRPCè¿™äº›ã€‚ å¦‚æœéœ€è¦å’Œ HTTP åè®®æ‰“äº¤é“ï¼Œè§£æå’Œå°è£… HTTP è¯·æ±‚å’Œå“åº”ã€‚è¿™ç±»æ¡†æ¶å¹¶ä¸èƒ½ç®—æ˜¯â€œRPC æ¡†æ¶â€ï¼Œæ¯”å¦‚Feignã€‚\nDubbo # Apache Dubbo æ˜¯ä¸€æ¬¾å¾®æœåŠ¡æ¡†æ¶ï¼Œä¸ºå¤§è§„æ¨¡å¾®æœåŠ¡å®è·µæä¾›é«˜æ€§èƒ½ RPC é€šä¿¡ã€æµé‡æ²»ç†ã€å¯è§‚æµ‹æ€§ç­‰è§£å†³æ–¹æ¡ˆï¼Œ æ¶µç›– Javaã€Golang ç­‰å¤šç§è¯­è¨€ SDK å®ç°ã€‚\nDubbo æä¾›äº†ä»æœåŠ¡å®šä¹‰ã€æœåŠ¡å‘ç°ã€æœåŠ¡é€šä¿¡åˆ°æµé‡ç®¡æ§ç­‰å‡ ä¹æ‰€æœ‰çš„æœåŠ¡æ²»ç†èƒ½åŠ›ï¼Œæ”¯æŒ Triple åè®®ï¼ˆåŸºäº HTTP/2 ä¹‹ä¸Šå®šä¹‰çš„ä¸‹ä¸€ä»£ RPC é€šä¿¡åè®®ï¼‰ã€åº”ç”¨çº§æœåŠ¡å‘ç°ã€Dubbo Mesh ï¼ˆDubbo3 èµ‹äºˆäº†å¾ˆå¤šäº‘åŸç”Ÿå‹å¥½çš„æ–°ç‰¹æ€§ï¼‰ç­‰ç‰¹æ€§ã€‚\nDubbo æ˜¯ç”±é˜¿é‡Œå¼€æºï¼Œåæ¥åŠ å…¥äº† Apache ã€‚æ­£æ˜¯ç”±äº Dubbo çš„å‡ºç°ï¼Œæ‰ä½¿å¾—è¶Šæ¥è¶Šå¤šçš„å…¬å¸å¼€å§‹ä½¿ç”¨ä»¥åŠæ¥å—åˆ†å¸ƒå¼æ¶æ„ã€‚\nDubbo ç®—çš„æ˜¯æ¯”è¾ƒä¼˜ç§€çš„å›½äº§å¼€æºé¡¹ç›®äº†ï¼Œå®ƒçš„æºç ä¹Ÿæ˜¯éå¸¸å€¼å¾—å­¦ä¹ å’Œé˜…è¯»çš„ï¼\nGithub ï¼šhttps://github.com/apache/incubator-dubbo å®˜ç½‘ï¼šhttps://dubbo.apache.org/zh/ Motan # Motan æ˜¯æ–°æµªå¾®åšå¼€æºçš„ä¸€æ¬¾ RPC æ¡†æ¶ï¼Œæ®è¯´åœ¨æ–°æµªå¾®åšæ­£æ”¯æ’‘ç€åƒäº¿æ¬¡è°ƒç”¨ã€‚ä¸è¿‡ç¬”è€…å€’æ˜¯å¾ˆå°‘çœ‹åˆ°æœ‰å…¬å¸ä½¿ç”¨ï¼Œè€Œä¸”ç½‘ä¸Šçš„èµ„æ–™ä¹Ÿæ¯”è¾ƒå°‘ã€‚\nå¾ˆå¤šäººå–œæ¬¢æ‹¿ Motan å’Œ Dubbo ä½œæ¯”è¾ƒï¼Œæ¯•ç«Ÿéƒ½æ˜¯å›½å†…å¤§å…¬å¸å¼€æºçš„ã€‚ç¬”è€…åœ¨æŸ¥é˜…äº†å¾ˆå¤šèµ„æ–™ï¼Œä»¥åŠç®€å•æŸ¥çœ‹äº†å…¶æºç ä¹‹åå‘ç°ï¼šMotan æ›´åƒæ˜¯ä¸€ä¸ªç²¾ç®€ç‰ˆçš„ Dubboï¼Œå¯èƒ½æ˜¯å€Ÿé‰´äº† Dubbo çš„æ€æƒ³ï¼ŒMotan çš„è®¾è®¡æ›´åŠ ç²¾ç®€ï¼ŒåŠŸèƒ½æ›´åŠ çº¯ç²¹ã€‚\nä¸è¿‡ï¼Œæˆ‘ä¸æ¨èä½ åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ Motanã€‚å¦‚æœä½ è¦æ˜¯å…¬å¸å®é™…ä½¿ç”¨çš„è¯ï¼Œè¿˜æ˜¯æ¨è Dubbo ï¼Œå…¶ç¤¾åŒºæ´»è·ƒåº¦ä»¥åŠç”Ÿæ€éƒ½è¦å¥½å¾ˆå¤šã€‚\nä» Motan çœ‹ RPC æ¡†æ¶è®¾è®¡ï¼šhttp://kriszhang.com/motan-rpc-impl/ Motan ä¸­æ–‡æ–‡æ¡£ï¼šhttps://github.com/weibocom/motan/wiki/zh_overview gRPC # gRPC æ˜¯ Google å¼€æºçš„ä¸€ä¸ªé«˜æ€§èƒ½ã€é€šç”¨çš„å¼€æº RPC æ¡†æ¶ã€‚å…¶ç”±ä¸»è¦é¢å‘ç§»åŠ¨åº”ç”¨å¼€å‘å¹¶åŸºäº HTTP/2 åè®®æ ‡å‡†è€Œè®¾è®¡ï¼ˆæ”¯æŒåŒå‘æµã€æ¶ˆæ¯å¤´å‹ç¼©ç­‰åŠŸèƒ½ï¼Œæ›´åŠ èŠ‚çœå¸¦å®½ï¼‰ï¼ŒåŸºäº ProtoBuf åºåˆ—åŒ–åè®®å¼€å‘ï¼Œå¹¶ä¸”æ”¯æŒä¼—å¤šå¼€å‘è¯­è¨€ã€‚\nä½•è°“ ProtoBufï¼Ÿ ProtoBufï¼ˆ Protocol Bufferï¼‰ æ˜¯ä¸€ç§æ›´åŠ çµæ´»ã€é«˜æ•ˆçš„æ•°æ®æ ¼å¼ï¼Œå¯ç”¨äºé€šè®¯åè®®ã€æ•°æ®å­˜å‚¨ç­‰é¢†åŸŸï¼ŒåŸºæœ¬æ”¯æŒæ‰€æœ‰ä¸»æµç¼–ç¨‹è¯­è¨€ä¸”ä¸å¹³å°æ— å…³ã€‚ä¸è¿‡ï¼Œé€šè¿‡ ProtoBuf å®šä¹‰æ¥å£å’Œæ•°æ®ç±»å‹è¿˜æŒºç¹ççš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå°é—®é¢˜ã€‚\nä¸å¾—ä¸è¯´ï¼ŒgRPC çš„é€šä¿¡å±‚çš„è®¾è®¡è¿˜æ˜¯éå¸¸ä¼˜ç§€çš„ï¼ŒDubbo-go 3.0 çš„é€šä¿¡å±‚æ”¹è¿›ä¸»è¦å€Ÿé‰´äº† gRPCã€‚\nä¸è¿‡ï¼ŒgRPC çš„è®¾è®¡å¯¼è‡´å…¶å‡ ä¹æ²¡æœ‰æœåŠ¡æ²»ç†èƒ½åŠ›ã€‚å¦‚æœä½ æƒ³è¦è§£å†³è¿™ä¸ªé—®é¢˜çš„è¯ï¼Œå°±éœ€è¦ä¾èµ–å…¶ä»–ç»„ä»¶æ¯”å¦‚è…¾è®¯çš„ PolarisMeshï¼ˆåŒ—ææ˜Ÿï¼‰äº†ã€‚\nGithubï¼šhttps://github.com/grpc/grpc å®˜ç½‘ï¼šhttps://grpc.io/ Thrift # Apache Thrift æ˜¯ Facebook å¼€æºçš„è·¨è¯­è¨€çš„ RPC é€šä¿¡æ¡†æ¶ï¼Œç›®å‰å·²ç»æçŒ®ç»™ Apache åŸºé‡‘ä¼šç®¡ç†ï¼Œç”±äºå…¶è·¨è¯­è¨€ç‰¹æ€§å’Œå‡ºè‰²çš„æ€§èƒ½ï¼Œåœ¨å¾ˆå¤šäº’è”ç½‘å…¬å¸å¾—åˆ°åº”ç”¨ï¼Œæœ‰èƒ½åŠ›çš„å…¬å¸ç”šè‡³ä¼šåŸºäº thrift ç ”å‘ä¸€å¥—åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ï¼Œå¢åŠ è¯¸å¦‚æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ç­‰åŠŸèƒ½ã€‚\nThriftæ”¯æŒå¤šç§ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬C++ã€Javaã€Pythonã€PHPã€Rubyç­‰ï¼ˆç›¸æ¯”äº gRPC æ”¯æŒçš„è¯­è¨€æ›´å¤š ï¼‰ã€‚\nå®˜ç½‘ï¼šhttps://thrift.apache.org/ Thrift ç®€å•ä»‹ç»ï¼šhttps://www.jianshu.com/p/8f25d057a5a9 æ€»ç»“ # gRPC å’Œ Thrift è™½ç„¶æ”¯æŒè·¨è¯­è¨€çš„ RPC è°ƒç”¨ï¼Œä½†æ˜¯å®ƒä»¬åªæä¾›äº†æœ€åŸºæœ¬çš„ RPC æ¡†æ¶åŠŸèƒ½ï¼Œç¼ºä¹ä¸€ç³»åˆ—é…å¥—çš„æœåŠ¡åŒ–ç»„ä»¶å’ŒæœåŠ¡æ²»ç†åŠŸèƒ½çš„æ”¯æ’‘ã€‚\nDubbo ä¸è®ºæ˜¯ä»åŠŸèƒ½å®Œå–„ç¨‹åº¦ã€ç”Ÿæ€ç³»ç»Ÿè¿˜æ˜¯ç¤¾åŒºæ´»è·ƒåº¦æ¥è¯´éƒ½æ˜¯æœ€ä¼˜ç§€çš„ã€‚è€Œä¸”ï¼ŒDubboåœ¨å›½å†…æœ‰å¾ˆå¤šæˆåŠŸçš„æ¡ˆä¾‹æ¯”å¦‚å½“å½“ç½‘ã€æ»´æ»´ç­‰ç­‰ï¼Œæ˜¯ä¸€æ¬¾ç»å¾—èµ·ç”Ÿäº§è€ƒéªŒçš„æˆç†Ÿç¨³å®šçš„ RPC æ¡†æ¶ã€‚æœ€é‡è¦çš„æ˜¯ä½ è¿˜èƒ½æ‰¾åˆ°éå¸¸å¤šçš„ Dubbo å‚è€ƒèµ„æ–™ï¼Œå­¦ä¹ æˆæœ¬ç›¸å¯¹ä¹Ÿè¾ƒä½ã€‚\nä¸‹å›¾å±•ç¤ºäº† Dubbo çš„ç”Ÿæ€ç³»ç»Ÿã€‚\nDubbo ä¹Ÿæ˜¯ Spring Cloud Alibaba é‡Œé¢çš„ä¸€ä¸ªç»„ä»¶ã€‚\nä½†æ˜¯ï¼ŒDubbo å’Œ Motan ä¸»è¦æ˜¯ç»™ Java è¯­è¨€ä½¿ç”¨ã€‚è™½ç„¶ï¼ŒDubbo å’Œ Motan ç›®å‰ä¹Ÿèƒ½å…¼å®¹éƒ¨åˆ†è¯­è¨€ï¼Œä½†æ˜¯ä¸å¤ªæ¨èã€‚å¦‚æœéœ€è¦è·¨å¤šç§è¯­è¨€è°ƒç”¨çš„è¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ gRPCã€‚\nç»¼ä¸Šï¼Œå¦‚æœæ˜¯ Java åç«¯æŠ€æœ¯æ ˆï¼Œå¹¶ä¸”ä½ åœ¨çº ç»“é€‰æ‹©å“ªä¸€ç§ RPC æ¡†æ¶çš„è¯ï¼Œæˆ‘æ¨èä½ è€ƒè™‘ä¸€ä¸‹ Dubboã€‚\nå¦‚ä½•è®¾è®¡å¹¶å®ç°ä¸€ä¸ª RPC æ¡†æ¶ï¼Ÿ # ã€Šæ‰‹å†™ RPC æ¡†æ¶ã€‹ æ˜¯æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒçš„ä¸€ä¸ªå†…éƒ¨å°å†Œï¼Œæˆ‘å†™äº† 12 ç¯‡æ–‡ç« æ¥è®²è§£å¦‚ä½•ä»é›¶å¼€å§‹åŸºäº Netty+Kyro+Zookeeper å®ç°ä¸€ä¸ªç®€æ˜“çš„ RPC æ¡†æ¶ã€‚\néº»é›€è™½å°äº”è„ä¿±å…¨ï¼Œé¡¹ç›®ä»£ç æ³¨é‡Šè¯¦ç»†ï¼Œç»“æ„æ¸…æ™°ï¼Œå¹¶ä¸”é›†æˆäº† Check Style è§„èŒƒä»£ç ç»“æ„ï¼Œéå¸¸é€‚åˆé˜…è¯»å’Œå­¦ä¹ ã€‚\nå†…å®¹æ¦‚è§ˆ ï¼š\næ—¢ç„¶æœ‰äº† HTTP åè®®ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ RPC ï¼Ÿ # HTTP å’Œ RPC è¯¦ç»†å¯¹æ¯” ã€‚\n"},{"id":85,"href":"/zh/docs/study/Review/java_guide/lydly_distributed_system/ly03ly_distributed-lock/","title":"åˆ†å¸ƒå¼é”","section":"åˆ†å¸ƒå¼ç³»ç»Ÿ","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nç½‘ä¸Šæœ‰å¾ˆå¤šåˆ†å¸ƒå¼é”ç›¸å…³çš„æ–‡ç« ï¼Œå†™äº†ä¸€ä¸ªç›¸å¯¹ç®€æ´æ˜“æ‡‚çš„ç‰ˆæœ¬ï¼Œé’ˆå¯¹é¢è¯•å’Œå·¥ä½œåº”è¯¥å¤Ÿç”¨äº†ã€‚\nä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”ï¼Ÿ # å¯¹äºå•æœºå¤šçº¿ç¨‹æ¥è¯´ï¼Œåœ¨ Java ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ ReetrantLock ç±»ã€synchronized å…³é”®å­—è¿™ç±» JDK è‡ªå¸¦çš„ æœ¬åœ°é” æ¥æ§åˆ¶ä¸€ä¸ª JVM è¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹å¯¹æœ¬åœ°å…±äº«èµ„æºçš„è®¿é—®ã€‚\nä¸‹é¢æ˜¯æˆ‘å¯¹æœ¬åœ°é”ç”»çš„ä¸€å¼ ç¤ºæ„å›¾ã€‚\nä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿™äº›çº¿ç¨‹è®¿é—®å…±äº«èµ„æºæ˜¯äº’æ–¥çš„ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å–åˆ°æœ¬åœ°é”è®¿é—®å…±äº«èµ„æºã€‚\nåˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ï¼Œä¸åŒçš„æœåŠ¡/å®¢æˆ·ç«¯é€šå¸¸è¿è¡Œåœ¨ç‹¬ç«‹çš„ JVM è¿›ç¨‹ä¸Šã€‚å¦‚æœå¤šä¸ª JVM è¿›ç¨‹å…±äº«åŒä¸€ä»½èµ„æºçš„è¯ï¼Œä½¿ç”¨æœ¬åœ°é”å°±æ²¡åŠæ³•å®ç°èµ„æºçš„äº’æ–¥è®¿é—®äº†ã€‚äºæ˜¯ï¼Œåˆ†å¸ƒå¼é” å°±è¯ç”Ÿäº†ã€‚\nä¸¾ä¸ªä¾‹å­ï¼šç³»ç»Ÿçš„è®¢å•æœåŠ¡ä¸€å…±éƒ¨ç½²äº† 3 ä»½ï¼Œéƒ½å¯¹å¤–æä¾›æœåŠ¡ã€‚ç”¨æˆ·ä¸‹è®¢å•ä¹‹å‰éœ€è¦æ£€æŸ¥åº“å­˜ï¼Œä¸ºäº†é˜²æ­¢è¶…å–ï¼Œè¿™é‡Œéœ€è¦åŠ é”ä»¥å®ç°å¯¹æ£€æŸ¥åº“å­˜æ“ä½œçš„åŒæ­¥è®¿é—®ã€‚ç”±äºè®¢å•æœåŠ¡ä½äºä¸åŒçš„ JVM è¿›ç¨‹ä¸­ï¼Œæœ¬åœ°é”åœ¨è¿™ç§æƒ…å†µä¸‹å°±æ²¡åŠæ³•æ­£å¸¸å·¥ä½œäº†ã€‚æˆ‘ä»¬éœ€è¦ç”¨åˆ°åˆ†å¸ƒå¼é”ï¼Œè¿™æ ·çš„è¯ï¼Œå³ä½¿å¤šä¸ªçº¿ç¨‹ä¸åœ¨åŒä¸€ä¸ª JVM è¿›ç¨‹ä¸­ä¹Ÿèƒ½è·å–åˆ°åŒä¸€æŠŠé”ï¼Œè¿›è€Œå®ç°å…±äº«èµ„æºçš„äº’æ–¥è®¿é—®ã€‚\nä¸‹é¢æ˜¯æˆ‘å¯¹åˆ†å¸ƒå¼é”ç”»çš„ä¸€å¼ ç¤ºæ„å›¾ã€‚\nä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿™äº›ç‹¬ç«‹çš„è¿›ç¨‹ä¸­çš„çº¿ç¨‹è®¿é—®å…±äº«èµ„æºæ˜¯äº’æ–¥çš„ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å–åˆ°åˆ†å¸ƒå¼é”è®¿é—®å…±äº«èµ„æºã€‚\nä¸€ä¸ªæœ€åŸºæœ¬çš„åˆ†å¸ƒå¼é”éœ€è¦æ»¡è¶³ï¼š\näº’æ–¥ ï¼šä»»æ„ä¸€ä¸ªæ—¶åˆ»ï¼Œé”åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ï¼› é«˜å¯ç”¨ ï¼šé”æœåŠ¡æ˜¯é«˜å¯ç”¨çš„ã€‚å¹¶ä¸”ï¼Œå³ä½¿å®¢æˆ·ç«¯çš„é‡Šæ”¾é”çš„ä»£ç é€»è¾‘å‡ºç°é—®é¢˜(è¿™é‡Œè¯´çš„æ˜¯å¼‚å¸¸ï¼Œä¸æ˜¯è¯´ä»£ç å†™çš„æœ‰é—®é¢˜)ï¼Œé”æœ€ç»ˆä¸€å®šè¿˜æ˜¯ä¼šè¢«é‡Šæ”¾ï¼Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®ã€‚ å¯é‡å…¥ï¼š(åŒ)ä¸€ä¸ªèŠ‚ç‚¹è·å–äº†é”ä¹‹åï¼Œè¿˜å¯ä»¥å†æ¬¡è·å–é”ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šé€‰æ‹©åŸºäº Redis æˆ–è€… ZooKeeper å®ç°åˆ†å¸ƒå¼é”ï¼ŒRedis ç”¨çš„è¦æ›´å¤šä¸€ç‚¹ï¼Œæˆ‘è¿™é‡Œä¹Ÿä»¥ Redis ä¸ºä¾‹ä»‹ç»åˆ†å¸ƒå¼é”çš„å®ç°ã€‚\nåŸºäº Redis å®ç°åˆ†å¸ƒå¼é” # å¦‚ä½•åŸºäº Redis å®ç°ä¸€ä¸ªæœ€ç®€æ˜“çš„åˆ†å¸ƒå¼é”ï¼Ÿ # ä¸è®ºæ˜¯å®ç°é”(æœ¬åœ°)è¿˜æ˜¯åˆ†å¸ƒå¼é”ï¼Œæ ¸å¿ƒéƒ½åœ¨äº**â€œäº’æ–¥â€**ã€‚\nåœ¨ Redis ä¸­ï¼Œ SETNX å‘½ä»¤æ˜¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°äº’æ–¥ã€‚SETNX å³ SET if Not eXists (å¯¹åº” Java ä¸­çš„ setIfAbsent æ–¹æ³•)ï¼Œå¦‚æœ key ä¸å­˜åœ¨çš„è¯ï¼Œæ‰ä¼šè®¾ç½® key çš„å€¼ã€‚å¦‚æœ key å·²ç»å­˜åœ¨ï¼Œ SETNX å•¥ä¹Ÿä¸åšã€‚\n\u0026gt; SETNX lockKey uniqueValue (integer) 1 \u0026gt; SETNX lockKey uniqueValue (integer) 0 #å¦‚ä¸ŠæˆåŠŸä¸º1ï¼Œå¤±è´¥ä¸º0 é‡Šæ”¾é”çš„è¯ï¼Œç›´æ¥é€šè¿‡ DEL å‘½ä»¤åˆ é™¤å¯¹åº”çš„ key å³å¯ã€‚\n\u0026gt; DEL lockKey (integer) 1 # æˆåŠŸä¸º1 ä¸ºäº†è¯¯åˆ åˆ°å…¶ä»–çš„é”ï¼Œè¿™é‡Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ Lua è„šæœ¬é€šè¿‡ key å¯¹åº”çš„ valueï¼ˆå”¯ä¸€å€¼ï¼‰æ¥åˆ¤æ–­ã€‚\né€‰ç”¨ Lua è„šæœ¬æ˜¯ä¸ºäº†ä¿è¯è§£é”æ“ä½œçš„åŸå­æ€§ã€‚å› ä¸º Redis åœ¨æ‰§è¡Œ Lua è„šæœ¬æ—¶ï¼Œå¯ä»¥ä»¥åŸå­æ€§çš„æ–¹å¼æ‰§è¡Œï¼Œä»è€Œä¿è¯äº†é”é‡Šæ”¾æ“ä½œçš„åŸå­æ€§ã€‚\n// é‡Šæ”¾é”æ—¶ï¼Œå…ˆæ¯”è¾ƒé”å¯¹åº”çš„ value å€¼æ˜¯å¦ç›¸ç­‰ï¼Œé¿å…é”çš„è¯¯é‡Šæ”¾ if redis.call(\u0026#34;get\u0026#34;,KEYS[1]) == ARGV[1] then return redis.call(\u0026#34;del\u0026#34;,KEYS[1]) else return 0 end è¿™æ˜¯ä¸€ç§æœ€ç®€æ˜“çš„ Redis åˆ†å¸ƒå¼é”å®ç°ï¼Œå®ç°æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œæ€§èƒ½ä¹Ÿå¾ˆé«˜æ•ˆã€‚ä¸è¿‡ï¼Œè¿™ç§æ–¹å¼å®ç°åˆ†å¸ƒå¼é”å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚å°±æ¯”å¦‚åº”ç”¨ç¨‹åºé‡åˆ°ä¸€äº›é—®é¢˜æ¯”å¦‚é‡Šæ”¾é”çš„é€»è¾‘çªç„¶æŒ‚æ‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´é”æ— æ³•è¢«é‡Šæ”¾ï¼Œè¿›è€Œé€ æˆå…±äº«èµ„æºæ— æ³•å†è¢«å…¶ä»–çº¿ç¨‹/è¿›ç¨‹è®¿é—®ã€‚\nä¸ºä»€ä¹ˆè¦ç»™é”è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Ÿ # ä¸ºäº†é¿å…é”æ— æ³•è¢«é‡Šæ”¾ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åˆ°çš„ä¸€ä¸ªè§£å†³åŠæ³•å°±æ˜¯ï¼š ç»™è¿™ä¸ª keyï¼ˆä¹Ÿå°±æ˜¯é”ï¼‰ è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ ã€‚\n127.0.0.1:6379\u0026gt; SET lockKey uniqueValue EX 3 NX OK lockKey ï¼šåŠ é”çš„é”åï¼› uniqueValue ï¼šèƒ½å¤Ÿå”¯ä¸€æ ‡ç¤ºé”çš„éšæœºå­—ç¬¦ä¸²ï¼› NX ï¼šåªæœ‰å½“ lockKey å¯¹åº”çš„ key å€¼ä¸å­˜åœ¨çš„æ—¶å€™æ‰èƒ½ SET æˆåŠŸï¼› EX ï¼šè¿‡æœŸæ—¶é—´è®¾ç½®ï¼ˆç§’ä¸ºå•ä½ï¼‰EX 3 æ ‡ç¤ºè¿™ä¸ªé”æœ‰ä¸€ä¸ª 3 ç§’çš„è‡ªåŠ¨è¿‡æœŸæ—¶é—´ã€‚ä¸ EX å¯¹åº”çš„æ˜¯ PXï¼ˆæ¯«ç§’ä¸ºå•ä½ï¼‰ï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯è¿‡æœŸæ—¶é—´è®¾ç½®ã€‚ ä¸€å®šè¦ä¿è¯è®¾ç½®æŒ‡å®š key çš„å€¼å’Œè¿‡æœŸæ—¶é—´æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼ï¼ï¼ ä¸ç„¶çš„è¯ï¼Œä¾ç„¶å¯èƒ½ä¼šå‡ºç°é”æ— æ³•è¢«é‡Šæ”¾çš„é—®é¢˜ã€‚\nè¿™æ ·ç¡®å®å¯ä»¥è§£å†³é—®é¢˜ï¼Œä¸è¿‡ï¼Œè¿™ç§è§£å†³åŠæ³•åŒæ ·å­˜åœ¨æ¼æ´ï¼šå¦‚æœæ“ä½œå…±äº«èµ„æºçš„æ—¶é—´å¤§äºè¿‡æœŸæ—¶é—´ï¼Œå°±ä¼šå‡ºç°é”æå‰è¿‡æœŸçš„é—®é¢˜ï¼Œè¿›è€Œå¯¼è‡´åˆ†å¸ƒå¼é”ç›´æ¥å¤±æ•ˆã€‚å¦‚æœé”çš„è¶…æ—¶æ—¶é—´è®¾ç½®è¿‡é•¿ï¼Œåˆä¼šå½±å“åˆ°æ€§èƒ½ã€‚\nä½ æˆ–è®¸åœ¨æƒ³ï¼š å¦‚æœæ“ä½œå…±äº«èµ„æºçš„æ“ä½œè¿˜æœªå®Œæˆï¼Œé”è¿‡æœŸæ—¶é—´èƒ½å¤Ÿè‡ªå·±ç»­æœŸå°±å¥½äº†ï¼\nå¦‚ä½•å®ç°é”çš„ä¼˜é›…ç»­æœŸï¼Ÿ # å¯¹äº Java å¼€å‘çš„å°ä¼™ä¼´æ¥è¯´ï¼Œå·²ç»æœ‰äº†ç°æˆçš„è§£å†³æ–¹æ¡ˆï¼šRedisson ã€‚å…¶ä»–è¯­è¨€çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥åœ¨ Redis å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°ï¼Œåœ°å€ï¼šhttps://redis.io/topics/distlock ã€‚\nRedisson æ˜¯ä¸€ä¸ªå¼€æºçš„ Java è¯­è¨€ Redis å®¢æˆ·ç«¯ï¼Œæä¾›äº†å¾ˆå¤šå¼€ç®±å³ç”¨çš„åŠŸèƒ½ï¼Œä¸ä»…ä»…åŒ…æ‹¬å¤šç§åˆ†å¸ƒå¼é”çš„å®ç°ã€‚å¹¶ä¸”ï¼ŒRedisson è¿˜æ”¯æŒ Redis å•æœºã€Redis Sentinel ã€Redis Cluster ç­‰å¤šç§éƒ¨ç½²æ¶æ„ã€‚\nRedisson ä¸­çš„åˆ†å¸ƒå¼é”è‡ªå¸¦è‡ªåŠ¨ç»­æœŸæœºåˆ¶ï¼Œä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ï¼ŒåŸç†ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå…¶æä¾›äº†ä¸€ä¸ªä¸“é—¨ç”¨æ¥ç›‘æ§å’Œç»­æœŸé”çš„ Watch Dogï¼ˆ çœ‹é—¨ç‹—ï¼‰ï¼Œå¦‚æœæ“ä½œå…±äº«èµ„æºçš„çº¿ç¨‹è¿˜æœªæ‰§è¡Œå®Œæˆçš„è¯ï¼ŒWatch Dog ä¼šä¸æ–­åœ°å»¶é•¿é”çš„è¿‡æœŸæ—¶é—´ï¼Œè¿›è€Œä¿è¯é”ä¸ä¼šå› ä¸ºè¶…æ—¶è€Œè¢«é‡Šæ”¾ã€‚\nå¦‚å›¾ï¼Œç»­æœŸä¹‹å‰ä¹Ÿæ˜¯è¦æ£€æµ‹æ˜¯å¦ä¸ºæŒé”çº¿ç¨‹\nçœ‹é—¨ç‹—åå­—çš„ç”±æ¥äº getLockWatchdogTimeout() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯çœ‹é—¨ç‹—ç»™é”ç»­æœŸçš„è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤ä¸º 30 ç§’ï¼ˆredisson-3.17.6ï¼‰ã€‚\n//é»˜è®¤ 30ç§’ï¼Œæ”¯æŒä¿®æ”¹ private long lockWatchdogTimeout = 30 * 1000; public Config setLockWatchdogTimeout(long lockWatchdogTimeout) { this.lockWatchdogTimeout = lockWatchdogTimeout; return this; } public long getLockWatchdogTimeout() { return lockWatchdogTimeout; } renewExpiration() æ–¹æ³•åŒ…å«äº†çœ‹é—¨ç‹—çš„ä¸»è¦é€»è¾‘ï¼š\nprivate void renewExpiration() { //...... Timeout task = commandExecutor.getConnectionManager().newTimeout(new TimerTask() { @Override public void run(Timeout timeout) throws Exception { //...... // å¼‚æ­¥ç»­æœŸï¼ŒåŸºäº Lua è„šæœ¬(ly:æˆ‘è§‰å¾—æ˜¯ä¸ºäº†ä¿è¯åŸå­æ€§æ‰€ä»¥ç”¨äº†Luaè„šæœ¬) CompletionStage\u0026lt;Boolean\u0026gt; future = renewExpirationAsync(threadId); future.whenComplete((res, e) -\u0026gt; { if (e != null) { // æ— æ³•ç»­æœŸ log.error(\u0026#34;Can\u0026#39;t update lock \u0026#34; + getRawName() + \u0026#34; expiration\u0026#34;, e); EXPIRATION_RENEWAL_MAP.remove(getEntryName()); return; } if (res) { // é€’å½’è°ƒç”¨å®ç°ç»­æœŸ renewExpiration(); } else { // å–æ¶ˆç»­æœŸ cancelExpirationRenewal(null); } }); } // å»¶è¿Ÿ internalLockLeaseTime/3ï¼ˆé»˜è®¤ 10sï¼Œä¹Ÿå°±æ˜¯ 30/3ï¼‰ å†è°ƒç”¨ }, internalLockLeaseTime / 3, TimeUnit.MILLISECONDS); ee.setTimeout(task); } é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯è¿‡ 10 ç§’ï¼Œçœ‹é—¨ç‹—å°±ä¼šæ‰§è¡Œç»­æœŸæ“ä½œï¼Œå°†é”çš„è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º 30 ç§’ã€‚çœ‹é—¨ç‹—ç»­æœŸå‰ä¹Ÿä¼šå…ˆåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰§è¡Œç»­æœŸæ“ä½œï¼Œéœ€è¦æ‰ä¼šæ‰§è¡Œç»­æœŸï¼Œå¦åˆ™å–æ¶ˆç»­æœŸæ“ä½œã€‚\nWatch Dog é€šè¿‡è°ƒç”¨ renewExpirationAsync() æ–¹æ³•å®ç°é”çš„å¼‚æ­¥ç»­æœŸï¼š\nprotected CompletionStage\u0026lt;Boolean\u0026gt; renewExpirationAsync(long threadId) { return evalWriteAsync(getRawName(), LongCodec.INSTANCE, RedisCommands.EVAL_BOOLEAN, // åˆ¤æ–­æ˜¯å¦ä¸ºæŒé”çº¿ç¨‹ï¼Œå¦‚æœæ˜¯å°±æ‰§è¡Œç»­æœŸæ“ä½œï¼Œå°±é”çš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸º 30sï¼ˆé»˜è®¤ï¼‰ \u0026#34;if (redis.call(\u0026#39;hexists\u0026#39;, KEYS[1], ARGV[2]) == 1) then \u0026#34; + \u0026#34;redis.call(\u0026#39;pexpire\u0026#39;, KEYS[1], ARGV[1]); \u0026#34; + \u0026#34;return 1; \u0026#34; + \u0026#34;end; \u0026#34; + \u0026#34;return 0;\u0026#34;, Collections.singletonList(getRawName()), internalLockLeaseTime, getLockName(threadId)); } å¯ä»¥çœ‹å‡ºï¼Œ renewExpirationAsync æ–¹æ³•å…¶å®æ˜¯è°ƒç”¨ Lua è„šæœ¬å®ç°çš„ç»­æœŸï¼Œè¿™æ ·åšä¸»è¦æ˜¯ä¸ºäº†ä¿è¯ç»­æœŸæ“ä½œçš„åŸå­æ€§ã€‚\næˆ‘è¿™é‡Œä»¥ Redisson çš„åˆ†å¸ƒå¼å¯é‡å…¥é” RLock ä¸ºä¾‹æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨ Redisson å®ç°åˆ†å¸ƒå¼é”ï¼š\n// 1.è·å–æŒ‡å®šçš„åˆ†å¸ƒå¼é”å¯¹è±¡ RLock lock = redisson.getLock(\u0026#34;lock\u0026#34;); // 2.æ‹¿é”ä¸”ä¸è®¾ç½®é”è¶…æ—¶æ—¶é—´ï¼Œå…·å¤‡ Watch Dog è‡ªåŠ¨ç»­æœŸæœºåˆ¶ lock.lock(); // 3.æ‰§è¡Œä¸šåŠ¡ ... // 4.é‡Šæ”¾é” lock.unlock(); åªæœ‰æœªæŒ‡å®šé”è¶…æ—¶æ—¶é—´ï¼Œæ‰ä¼šä½¿ç”¨åˆ° Watch Dog è‡ªåŠ¨ç»­æœŸæœºåˆ¶ã€‚\n// æ‰‹åŠ¨ç»™é”è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¸å…·å¤‡ Watch Dog è‡ªåŠ¨ç»­æœŸæœºåˆ¶ lock.lock(10, TimeUnit.SECONDS); å¦‚æœä½¿ç”¨ Redis æ¥å®ç°åˆ†å¸ƒå¼é”çš„è¯ï¼Œè¿˜æ˜¯æ¯”è¾ƒæ¨èç›´æ¥åŸºäº Redisson æ¥åšçš„ã€‚\nå¦‚ä½•å®ç°å¯é‡å…¥é”ï¼Ÿ # æ‰€è°“å¯é‡å…¥é”æŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å¯ä»¥å¤šæ¬¡è·å–åŒä¸€æŠŠé”ï¼Œæ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œä¸€ä¸ªå¸¦é”çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­åˆè°ƒç”¨äº†å¦ä¸€ä¸ªéœ€è¦ç›¸åŒé”çš„æ–¹æ³•ï¼Œåˆ™è¯¥çº¿ç¨‹å¯ä»¥ç›´æ¥æ‰§è¡Œè°ƒç”¨çš„æ–¹æ³•å³å¯é‡å…¥ ï¼Œè€Œæ— éœ€é‡æ–°è·å¾—é”ã€‚åƒ Java ä¸­çš„ synchronized å’Œ ReentrantLock éƒ½å±äºå¯é‡å…¥é”ã€‚\nä¸å¯é‡å…¥çš„åˆ†å¸ƒå¼é”åŸºæœ¬å¯ä»¥æ»¡è¶³ç»å¤§éƒ¨åˆ†ä¸šåŠ¡åœºæ™¯äº†ï¼Œä¸€äº›ç‰¹æ®Šçš„åœºæ™¯å¯èƒ½ä¼šéœ€è¦ä½¿ç”¨å¯é‡å…¥çš„åˆ†å¸ƒå¼é”ã€‚\nå¯é‡å…¥åˆ†å¸ƒå¼é”çš„å®ç°æ ¸å¿ƒæ€è·¯æ˜¯çº¿ç¨‹åœ¨è·å–é”çš„æ—¶å€™åˆ¤æ–­æ˜¯å¦ä¸ºè‡ªå·±çš„é”ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå°±ä¸ç”¨å†é‡æ–°è·å–äº†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªé”å…³è”ä¸€ä¸ªå¯é‡å…¥è®¡æ•°å™¨å’Œä¸€ä¸ªå æœ‰å®ƒçš„çº¿ç¨‹ã€‚å½“å¯é‡å…¥è®¡æ•°å™¨å¤§äº 0 æ—¶ï¼Œåˆ™é”è¢«å æœ‰ï¼Œéœ€è¦åˆ¤æ–­å æœ‰è¯¥é”çš„çº¿ç¨‹å’Œè¯·æ±‚è·å–é”çš„çº¿ç¨‹æ˜¯å¦ä¸ºåŒä¸€ä¸ªã€‚\nå®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦è‡ªå·±æ‰‹åŠ¨å®ç°ï¼Œæ¨èä½¿ç”¨æˆ‘ä»¬ä¸Šé¢æåˆ°çš„ Redisson ï¼Œå…¶å†…ç½®äº†å¤šç§ç±»å‹çš„é”æ¯”å¦‚å¯é‡å…¥é”ï¼ˆReentrant Lockï¼‰ã€è‡ªæ—‹é”ï¼ˆSpin Lockï¼‰ã€å…¬å¹³é”ï¼ˆFair Lockï¼‰ã€å¤šé‡é”ï¼ˆMultiLockï¼‰ã€ çº¢é”ï¼ˆRedLockï¼‰ã€ è¯»å†™é”ï¼ˆReadWriteLockï¼‰ã€‚\nRedis å¦‚ä½•è§£å†³é›†ç¾¤æƒ…å†µä¸‹åˆ†å¸ƒå¼é”çš„å¯é æ€§ï¼Ÿ # ä¸ºäº†é¿å…å•ç‚¹æ•…éšœï¼ˆä¹Ÿå°±æ˜¯åªéƒ¨ç½²åœ¨ä¸€å°æœºå™¨ï¼Œå¯¼è‡´ä¸€å°æœºå™¨æŒ‚äº†æœåŠ¡å°±æ— æ³•è¿è¡Œå¹¶æä¾›åŠŸèƒ½ï¼‰ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹çš„ Redis æœåŠ¡é€šå¸¸æ˜¯é›†ç¾¤åŒ–éƒ¨ç½²çš„ã€‚\nRedis é›†ç¾¤ä¸‹ï¼Œä¸Šé¢ä»‹ç»åˆ°çš„åˆ†å¸ƒå¼é”çš„å®ç°ä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ã€‚ç”±äº Redis é›†ç¾¤æ•°æ®åŒæ­¥åˆ°å„ä¸ªèŠ‚ç‚¹æ—¶æ˜¯å¼‚æ­¥çš„ï¼Œå¦‚æœåœ¨ Redis ä¸»èŠ‚ç‚¹è·å–åˆ°é”åï¼Œåœ¨æ²¡æœ‰åŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹æ—¶ï¼ŒRedis ä¸»èŠ‚ç‚¹å®•æœºäº†ï¼Œæ­¤æ—¶æ–°çš„ Redis ä¸»èŠ‚ç‚¹ä¾ç„¶å¯ä»¥è·å–é”ï¼Œæ‰€ä»¥å¤šä¸ªåº”ç”¨æœåŠ¡å°±å¯ä»¥åŒæ—¶è·å–åˆ°é”ã€‚\né’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼ŒRedis ä¹‹çˆ¶ antirez è®¾è®¡äº† Redlock ç®—æ³• æ¥è§£å†³ã€‚\nRedlock ç®—æ³•çš„æ€æƒ³æ˜¯è®©å®¢æˆ·ç«¯å‘ Redis é›†ç¾¤ä¸­çš„å¤šä¸ªç‹¬ç«‹çš„ Redis å®ä¾‹ ä¾æ¬¡è¯·æ±‚ç”³è¯·åŠ é”ï¼Œå¦‚æœå®¢æˆ·ç«¯èƒ½å¤Ÿå’ŒåŠæ•°ä»¥ä¸Šçš„å®ä¾‹æˆåŠŸåœ°å®ŒæˆåŠ é”æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è®¤ä¸ºï¼Œå®¢æˆ·ç«¯æˆåŠŸåœ°è·å¾—åˆ†å¸ƒå¼é”ï¼Œå¦åˆ™åŠ é”å¤±è´¥ã€‚\nå³ä½¿éƒ¨åˆ† Redis èŠ‚ç‚¹å‡ºç°é—®é¢˜ï¼Œåªè¦ä¿è¯ Redis é›†ç¾¤ä¸­æœ‰åŠæ•°ä»¥ä¸Šçš„ Redis èŠ‚ç‚¹å¯ç”¨ï¼Œåˆ†å¸ƒå¼é”æœåŠ¡å°±æ˜¯æ­£å¸¸çš„ã€‚\nRedlock æ˜¯ç›´æ¥æ“ä½œ Redis èŠ‚ç‚¹çš„ï¼Œå¹¶ä¸æ˜¯é€šè¿‡ Redis é›†ç¾¤æ“ä½œçš„ï¼Œè¿™æ ·æ‰å¯ä»¥é¿å… Redis é›†ç¾¤ä¸»ä»åˆ‡æ¢å¯¼è‡´çš„é”ä¸¢å¤±é—®é¢˜ã€‚\næ³¨æ„ï¼Œä¸æ˜¯é€šè¿‡Redisé›†ç¾¤åšçš„å“¦\nRedlock å®ç°æ¯”è¾ƒå¤æ‚ï¼Œæ€§èƒ½æ¯”è¾ƒå·®ï¼Œå‘ç”Ÿæ—¶é’Ÿå˜è¿çš„æƒ…å†µä¸‹è¿˜å­˜åœ¨å®‰å…¨æ€§éšæ‚£ã€‚ã€Šæ•°æ®å¯†é›†å‹åº”ç”¨ç³»ç»Ÿè®¾è®¡ã€‹ä¸€ä¹¦çš„ä½œè€… Martin Kleppmann æ›¾ç»ä¸“é—¨å‘æ–‡ï¼ˆHow to do distributed locking - Martin Kleppmann - 2016ï¼‰æ€¼è¿‡ Redlockï¼Œä»–è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¾ˆå·®çš„åˆ†å¸ƒå¼é”å®ç°ã€‚æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥çœ‹çœ‹Redis é”ä»é¢è¯•è¿ç¯ç‚®èŠåˆ°ç¥ä»™æ‰“æ¶è¿™ç¯‡æ–‡ç« ï¼Œæœ‰è¯¦ç»†ä»‹ç»åˆ° antirez å’Œ Martin Kleppmann å…³äº Redlock çš„æ¿€çƒˆè¾©è®ºã€‚\nå®é™…é¡¹ç›®ä¸­ä¸å»ºè®®ä½¿ç”¨ Redlock ç®—æ³•ï¼Œæˆæœ¬å’Œæ”¶ç›Šä¸æˆæ­£æ¯”ã€‚\nå¦‚æœä¸æ˜¯éè¦å®ç°ç»å¯¹å¯é çš„åˆ†å¸ƒå¼é”çš„è¯ï¼Œå…¶å®å•æœºç‰ˆ Redis å°±å®Œå…¨å¤Ÿäº†ï¼Œå®ç°ç®€å•ï¼Œæ€§èƒ½ä¹Ÿéå¸¸é«˜ã€‚å¦‚æœä½ å¿…é¡»è¦å®ç°ä¸€ä¸ªç»å¯¹å¯é çš„åˆ†å¸ƒå¼é”çš„è¯ï¼Œå¯ä»¥åŸºäº Zookeeper æ¥åšï¼Œåªæ˜¯æ€§èƒ½ä¼šå·®ä¸€äº›ã€‚\n"},{"id":86,"href":"/zh/docs/study/Review/java_guide/lydly_distributed_system/ly02ly_distributed-id/","title":"åˆ†å¸ƒå¼id","section":"åˆ†å¸ƒå¼ç³»ç»Ÿ","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nåˆ†å¸ƒå¼ ID ä»‹ç» # ä»€ä¹ˆæ˜¯ IDï¼Ÿ # æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ç³»ç»Ÿä¸­çš„å„ç§æ•°æ®ä½¿ç”¨ ID å”¯ä¸€è¡¨ç¤ºï¼Œæ¯”å¦‚ç”¨æˆ· ID å¯¹åº”ä¸”ä»…å¯¹åº”ä¸€ä¸ªäººï¼Œå•†å“ ID å¯¹åº”ä¸”ä»…å¯¹åº”ä¸€ä»¶å•†å“ï¼Œè®¢å• ID å¯¹åº”ä¸”ä»…å¯¹åº”ä¸€ä¸ªè®¢å•ã€‚\næˆ‘ä»¬ç°å®ç”Ÿæ´»ä¸­ä¹Ÿæœ‰å„ç§ IDï¼Œæ¯”å¦‚èº«ä»½è¯ ID å¯¹åº”ä¸”ä»…å¯¹åº”ä¸€ä¸ªäººã€åœ°å€ ID å¯¹åº”ä¸”ä»…å¯¹åº”\nç®€å•æ¥è¯´ï¼ŒID å°±æ˜¯æ•°æ®çš„å”¯ä¸€æ ‡è¯†ã€‚\nä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ IDï¼Ÿ # åˆ†å¸ƒå¼ ID æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹çš„ IDã€‚åˆ†å¸ƒå¼ ID ä¸å­˜åœ¨ä¸ç°å®ç”Ÿæ´»ä¸­(å±äºæŠ€æœ¯ä¸Šçš„é—®é¢˜ï¼Œè·Ÿä¸šåŠ¡æ— å…³)ï¼Œå±äºè®¡ç®—æœºç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ¦‚å¿µã€‚\næˆ‘ç®€å•ä¸¾ä¸€ä¸ªåˆ†åº“åˆ†è¡¨çš„ä¾‹å­ã€‚\næˆ‘å¸çš„ä¸€ä¸ªé¡¹ç›®ï¼Œä½¿ç”¨çš„æ˜¯å•æœº MySQL ã€‚ä½†æ˜¯ï¼Œæ²¡æƒ³åˆ°çš„æ˜¯ï¼Œé¡¹ç›®ä¸Šçº¿ä¸€ä¸ªæœˆä¹‹åï¼Œéšç€ä½¿ç”¨äººæ•°è¶Šæ¥è¶Šå¤šï¼Œæ•´ä¸ªç³»ç»Ÿçš„æ•°æ®é‡å°†è¶Šæ¥è¶Šå¤§ã€‚å•æœº MySQL å·²ç»æ²¡åŠæ³•æ”¯æ’‘äº†ï¼Œéœ€è¦è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼ˆæ¨è Sharding-JDBCï¼‰ã€‚\nåœ¨åˆ†åº“ä¹‹åï¼Œ æ•°æ®éå¸ƒåœ¨ä¸åŒæœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“ï¼Œæ•°æ®åº“çš„è‡ªå¢ä¸»é”®å·²ç»æ²¡åŠæ³•æ»¡è¶³ç”Ÿæˆçš„ä¸»é”®å”¯ä¸€äº†ã€‚æˆ‘ä»¬å¦‚ä½•ä¸ºä¸åŒçš„æ•°æ®èŠ‚ç‚¹ç”Ÿæˆå…¨å±€å”¯ä¸€ä¸»é”®å‘¢ï¼Ÿ\nè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”Ÿæˆåˆ†å¸ƒå¼ IDäº†ã€‚\nåˆ†å¸ƒå¼ ID éœ€è¦æ»¡è¶³å“ªäº›è¦æ±‚? # åˆ†å¸ƒå¼ ID ä½œä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¿…ä¸å¯å°‘çš„ä¸€ç¯ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½è¦ç”¨åˆ°åˆ†å¸ƒå¼ IDã€‚\nä¸€ä¸ªæœ€åŸºæœ¬çš„åˆ†å¸ƒå¼ ID éœ€è¦æ»¡è¶³ä¸‹é¢è¿™äº›è¦æ±‚ï¼š\nå…¨å±€å”¯ä¸€ ï¼šID çš„å…¨å±€å”¯ä¸€æ€§è‚¯å®šæ˜¯é¦–å…ˆè¦æ»¡è¶³çš„ï¼ é«˜æ€§èƒ½ ï¼š åˆ†å¸ƒå¼ ID çš„ç”Ÿæˆé€Ÿåº¦è¦å¿«ï¼Œå¯¹æœ¬åœ°èµ„æºæ¶ˆè€—è¦å°ã€‚ é«˜å¯ç”¨ ï¼šç”Ÿæˆåˆ†å¸ƒå¼ ID çš„æœåŠ¡è¦ä¿è¯å¯ç”¨æ€§æ— é™æ¥è¿‘äº 100%ã€‚ æ–¹ä¾¿æ˜“ç”¨ ï¼šæ‹¿æ¥å³ç”¨ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œå¿«é€Ÿæ¥å…¥ï¼ é™¤äº†è¿™äº›ä¹‹å¤–ï¼Œä¸€ä¸ªæ¯”è¾ƒå¥½çš„åˆ†å¸ƒå¼ ID è¿˜åº”ä¿è¯ï¼š\nå®‰å…¨ ï¼šID ä¸­ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯ã€‚ æœ‰åºé€’å¢ ï¼šå¦‚æœè¦æŠŠ ID å­˜æ”¾åœ¨æ•°æ®åº“çš„è¯ï¼ŒID çš„æœ‰åºæ€§å¯ä»¥æå‡æ•°æ®åº“å†™å…¥é€Ÿåº¦ã€‚å¹¶ä¸”ï¼Œå¾ˆå¤šæ—¶å€™ ï¼Œæˆ‘ä»¬è¿˜å¾ˆæœ‰å¯èƒ½ä¼šç›´æ¥é€šè¿‡ ID æ¥è¿›è¡Œæ’åºã€‚ æœ‰å…·ä½“çš„ä¸šåŠ¡å«ä¹‰ ï¼šç”Ÿæˆçš„ ID å¦‚æœèƒ½æœ‰å…·ä½“çš„ä¸šåŠ¡å«ä¹‰ï¼Œå¯ä»¥è®©å®šä½é—®é¢˜ä»¥åŠå¼€å‘æ›´é€æ˜åŒ–ï¼ˆé€šè¿‡ ID å°±èƒ½ç¡®å®šæ˜¯å“ªä¸ªä¸šåŠ¡ï¼‰ã€‚ ç‹¬ç«‹éƒ¨ç½² ï¼šä¹Ÿå°±æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå•ç‹¬æœ‰ä¸€ä¸ªå‘å·å™¨æœåŠ¡ï¼Œä¸“é—¨ç”¨æ¥ç”Ÿæˆåˆ†å¸ƒå¼ IDã€‚è¿™æ ·å°±ç”Ÿæˆ ID çš„æœåŠ¡å¯ä»¥å’Œä¸šåŠ¡ç›¸å…³çš„æœåŠ¡è§£è€¦ã€‚ä¸è¿‡ï¼Œè¿™æ ·åŒæ ·å¸¦æ¥äº†ç½‘ç»œè°ƒç”¨æ¶ˆè€—å¢åŠ çš„é—®é¢˜ã€‚æ€»çš„æ¥è¯´ï¼Œå¦‚æœéœ€è¦ç”¨åˆ°åˆ†å¸ƒå¼ ID çš„åœºæ™¯æ¯”è¾ƒå¤šçš„è¯ï¼Œç‹¬ç«‹éƒ¨ç½²çš„å‘å·å™¨æœåŠ¡è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ åˆ†å¸ƒå¼ ID å¸¸è§è§£å†³æ–¹æ¡ˆ # è¿™é‡Œè¯´çš„æ˜¯å¦‚ä½•è·å–åˆ°ä¸€ä¸ªåˆ†å¸ƒå¼IDï¼Œè€Œä¸æ˜¯å…·ä½“åˆ†å¸ƒå¼IDçš„ä½¿ç”¨\næ•°æ®åº“ # æ•°æ®åº“ä¸»é”®è‡ªå¢ # è¿™ç§æ–¹å¼å°±æ¯”è¾ƒç®€å•ç›´ç™½äº†ï¼Œå°±æ˜¯é€šè¿‡å…³ç³»å‹æ•°æ®åº“çš„è‡ªå¢ä¸»é”®äº§ç”Ÿæ¥å”¯ä¸€çš„ IDã€‚\nä»¥ MySQL ä¸¾ä¾‹ï¼Œæˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„æ–¹å¼å³å¯ã€‚\n1.åˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¡¨ã€‚\nCREATE TABLE `sequence_id` ( `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT, `stub` char(10) NOT NULL DEFAULT \u0026#39;\u0026#39;, PRIMARY KEY (`id`), UNIQUE KEY `stub` (`stub`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; stub å­—æ®µæ— æ„ä¹‰ï¼Œåªæ˜¯ä¸ºäº†å ä½ï¼Œä¾¿äºæˆ‘ä»¬æ’å…¥æˆ–è€…ä¿®æ”¹æ•°æ®ã€‚å¹¶ä¸”ï¼Œç»™ stub å­—æ®µåˆ›å»ºäº†å”¯ä¸€ç´¢å¼•ï¼Œä¿è¯å…¶å”¯ä¸€æ€§ã€‚\n2.é€šè¿‡ replace into æ¥æ’å…¥æ•°æ®ã€‚\nBEGIN; REPLACE INTO sequence_id (stub) VALUES (\u0026#39;stub\u0026#39;); SELECT LAST_INSERT_ID(); COMMIT; æ’å…¥æ•°æ®è¿™é‡Œï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ insert into è€Œæ˜¯ä½¿ç”¨ replace into æ¥æ’å…¥æ•°æ®ï¼Œå…·ä½“æ­¥éª¤æ˜¯è¿™æ ·çš„ï¼š\n1)ç¬¬ä¸€æ­¥ï¼š å°è¯•æŠŠæ•°æ®æ’å…¥åˆ°è¡¨ä¸­ã€‚\n2)ç¬¬äºŒæ­¥ï¼š å¦‚æœä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•å­—æ®µå‡ºç°é‡å¤æ•°æ®é”™è¯¯è€Œæ’å…¥å¤±è´¥æ—¶ï¼Œå…ˆä»è¡¨ä¸­åˆ é™¤å«æœ‰é‡å¤å…³é”®å­—å€¼çš„å†²çªè¡Œï¼Œç„¶åå†æ¬¡å°è¯•æŠŠæ•°æ®æ’å…¥åˆ°è¡¨ä¸­ã€‚\nä½¿ç”¨replaceåªæ˜¯ç”¨æ¥åˆ é™¤è¡Œï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šå«ä¹‰\nè¿™ç§æ–¹å¼çš„ä¼˜ç¼ºç‚¹ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼š\nä¼˜ç‚¹ ï¼šå®ç°èµ·æ¥æ¯”è¾ƒç®€å•ã€ID æœ‰åºé€’å¢ã€å­˜å‚¨æ¶ˆè€—ç©ºé—´å° ç¼ºç‚¹ ï¼š æ”¯æŒçš„å¹¶å‘é‡ä¸å¤§ã€å­˜åœ¨æ•°æ®åº“å•ç‚¹é—®é¢˜ï¼ˆå¯ä»¥ä½¿ç”¨æ•°æ®åº“é›†ç¾¤è§£å†³ï¼Œä¸è¿‡å¢åŠ äº†å¤æ‚åº¦ï¼‰ã€ID æ²¡æœ‰å…·ä½“ä¸šåŠ¡å«ä¹‰ã€å®‰å…¨é—®é¢˜ï¼ˆæ¯”å¦‚æ ¹æ®è®¢å• ID çš„é€’å¢è§„å¾‹å°±èƒ½æ¨ç®—å‡ºæ¯å¤©çš„è®¢å•é‡ï¼Œå•†ä¸šæœºå¯†å•Šï¼ ï¼‰ã€æ¯æ¬¡è·å– ID éƒ½è¦è®¿é—®ä¸€æ¬¡æ•°æ®åº“ï¼ˆå¢åŠ äº†å¯¹æ•°æ®åº“çš„å‹åŠ›ï¼Œè·å–é€Ÿåº¦ä¹Ÿæ…¢ï¼‰ æ•°æ®åº“å·æ®µæ¨¡å¼ # æ•°æ®åº“ä¸»é”®è‡ªå¢è¿™ç§æ¨¡å¼ï¼Œæ¯æ¬¡è·å– ID éƒ½è¦è®¿é—®ä¸€æ¬¡æ•°æ®åº“ï¼ŒID éœ€æ±‚æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œè‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚\nå¦‚æœæˆ‘ä»¬å¯ä»¥æ‰¹é‡è·å–ï¼Œç„¶åå­˜åœ¨åœ¨å†…å­˜é‡Œé¢ï¼Œéœ€è¦ç”¨åˆ°çš„æ—¶å€™ï¼Œç›´æ¥ä»å†…å­˜é‡Œé¢æ‹¿å°±èˆ’æœäº†ï¼è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„ åŸºäºæ•°æ®åº“çš„å·æ®µæ¨¡å¼æ¥ç”Ÿæˆåˆ†å¸ƒå¼ IDã€‚\næ•°æ®åº“çš„å·æ®µæ¨¡å¼ä¹Ÿæ˜¯ç›®å‰æ¯”è¾ƒä¸»æµçš„ä¸€ç§åˆ†å¸ƒå¼ ID ç”Ÿæˆæ–¹å¼ã€‚åƒæ»´æ»´å¼€æºçš„Tinyid å°±æ˜¯åŸºäºè¿™ç§æ–¹å¼æ¥åšçš„ã€‚ä¸è¿‡ï¼ŒTinyId ä½¿ç”¨äº†åŒå·æ®µç¼“å­˜ã€å¢åŠ å¤š db æ”¯æŒç­‰æ–¹å¼æ¥è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚\nä»¥ MySQL ä¸¾ä¾‹ï¼Œæˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„æ–¹å¼å³å¯ã€‚\n1.åˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¡¨ã€‚\nCREATE TABLE `sequence_id_generator` ( `id` int(10) NOT NULL, `current_max_id` bigint(20) NOT NULL COMMENT \u0026#39;å½“å‰æœ€å¤§id\u0026#39;, `step` int(10) NOT NULL COMMENT \u0026#39;å·æ®µçš„é•¿åº¦\u0026#39;, `version` int(20) NOT NULL COMMENT \u0026#39;ç‰ˆæœ¬å·\u0026#39;, `biz_type` int(20) NOT NULL COMMENT \u0026#39;ä¸šåŠ¡ç±»å‹\u0026#39;, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; current_max_id å­—æ®µå’Œstepå­—æ®µä¸»è¦ç”¨äºè·å–æ‰¹é‡ IDï¼Œè·å–çš„æ‰¹é‡ id ä¸ºï¼š current_max_id ~ current_max_id+stepã€‚\nversion å­—æ®µä¸»è¦ç”¨äºè§£å†³å¹¶å‘é—®é¢˜ï¼ˆä¹è§‚é”ï¼‰,biz_type ä¸»è¦ç”¨äºè¡¨ç¤ºä¸šåŠ¡ç±»å‹ã€‚\n2.å…ˆæ’å…¥ä¸€è¡Œæ•°æ®ã€‚\nINSERT INTO `sequence_id_generator` (`id`, `current_max_id`, `step`, `version`, `biz_type`) VALUES (1, 0, 100, 0, 101); 3.é€šè¿‡ SELECT è·å–æŒ‡å®šä¸šåŠ¡ä¸‹çš„æ‰¹é‡å”¯ä¸€ ID\nSELECT `current_max_id`, `step`,`version` FROM `sequence_id_generator` where `biz_type` = 101 ç»“æœï¼š\nid\tcurrent_max_id\tstep\tversion\tbiz_type 1\t0\t100\t0\t101 4.ä¸å¤Ÿç”¨çš„è¯ï¼Œæ›´æ–°ä¹‹åé‡æ–° SELECT å³å¯ã€‚\nUPDATE sequence_id_generator SET current_max_id = 0+100, version=version+1 WHERE version = 0 AND `biz_type` = 101 SELECT `current_max_id`, `step`,`version` FROM `sequence_id_generator` where `biz_type` = 101 ç»“æœï¼š\nid\tcurrent_max_id\tstep\tversion\tbiz_type 1\t100\t100\t1\t101 ç›¸æ¯”äºæ•°æ®åº“ä¸»é”®è‡ªå¢çš„æ–¹å¼ï¼Œæ•°æ®åº“çš„å·æ®µæ¨¡å¼å¯¹äºæ•°æ®åº“çš„è®¿é—®æ¬¡æ•°æ›´å°‘ï¼Œæ•°æ®åº“å‹åŠ›æ›´å°ã€‚\nå¦å¤–ï¼Œä¸ºäº†é¿å…å•ç‚¹é—®é¢˜ï¼Œä½ å¯ä»¥ä»ä½¿ç”¨ä¸»ä»æ¨¡å¼æ¥æé«˜å¯ç”¨æ€§ã€‚\næ•°æ®åº“å·æ®µæ¨¡å¼çš„ä¼˜ç¼ºç‚¹:\nä¼˜ç‚¹ ï¼šID æœ‰åºé€’å¢ã€å­˜å‚¨æ¶ˆè€—ç©ºé—´å° ç¼ºç‚¹ ï¼šå­˜åœ¨æ•°æ®åº“å•ç‚¹é—®é¢˜ï¼ˆå¯ä»¥ä½¿ç”¨æ•°æ®åº“é›†ç¾¤è§£å†³ï¼Œä¸è¿‡å¢åŠ äº†å¤æ‚åº¦ï¼‰ã€ID æ²¡æœ‰å…·ä½“ä¸šåŠ¡å«ä¹‰ã€å®‰å…¨é—®é¢˜ï¼ˆæ¯”å¦‚æ ¹æ®è®¢å• ID çš„é€’å¢è§„å¾‹å°±èƒ½æ¨ç®—å‡ºæ¯å¤©çš„è®¢å•é‡ï¼Œå•†ä¸šæœºå¯†å•Šï¼ ï¼‰ NoSQL # ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒNoSQL æ–¹æ¡ˆä½¿ç”¨ Redis å¤šä¸€äº›ã€‚æˆ‘ä»¬é€šè¿‡ Redis çš„ incr å‘½ä»¤å³å¯å®ç°å¯¹ id åŸå­é¡ºåºé€’å¢ã€‚\n127.0.0.1:6379\u0026gt; set sequence_id_biz_type 1 OK 127.0.0.1:6379\u0026gt; incr sequence_id_biz_type (integer) 2 127.0.0.1:6379\u0026gt; get sequence_id_biz_type \u0026#34;2\u0026#34; ä¸ºäº†æé«˜å¯ç”¨æ€§å’Œå¹¶å‘ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Redis Clusterã€‚Redis Cluster æ˜¯ Redis å®˜æ–¹æä¾›çš„ Redis é›†ç¾¤è§£å†³æ–¹æ¡ˆï¼ˆ3.0+ç‰ˆæœ¬ï¼‰ã€‚\né™¤äº† Redis Cluster ä¹‹å¤–ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å¼€æºçš„ Redis é›†ç¾¤æ–¹æ¡ˆCodis ï¼ˆå¤§è§„æ¨¡é›†ç¾¤æ¯”å¦‚ä¸Šç™¾ä¸ªèŠ‚ç‚¹çš„æ—¶å€™æ¯”è¾ƒæ¨èï¼‰ã€‚\né™¤äº†é«˜å¯ç”¨å’Œå¹¶å‘ä¹‹å¤–ï¼Œæˆ‘ä»¬çŸ¥é“ Redis åŸºäºå†…å­˜ï¼Œæˆ‘ä»¬éœ€è¦æŒä¹…åŒ–æ•°æ®ï¼Œé¿å…é‡å¯æœºå™¨æˆ–è€…æœºå™¨æ•…éšœåæ•°æ®ä¸¢å¤±ã€‚Redis æ”¯æŒä¸¤ç§ä¸åŒçš„æŒä¹…åŒ–æ–¹å¼ï¼šå¿«ç…§ï¼ˆsnapshottingï¼ŒRDBï¼‰ã€åªè¿½åŠ æ–‡ä»¶ï¼ˆappend-only file, AOFï¼‰ã€‚ å¹¶ä¸”ï¼ŒRedis 4.0 å¼€å§‹æ”¯æŒ RDB å’Œ AOF çš„æ··åˆæŒä¹…åŒ–ï¼ˆé»˜è®¤å…³é—­ï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹ aof-use-rdb-preamble å¼€å¯ï¼‰ã€‚\nå…³äº Redis æŒä¹…åŒ–ï¼Œæˆ‘è¿™é‡Œå°±ä¸è¿‡å¤šä»‹ç»ã€‚ä¸äº†è§£è¿™éƒ¨åˆ†å†…å®¹çš„å°ä¼™ä¼´ï¼Œå¯ä»¥çœ‹çœ‹ JavaGuide å¯¹äº Redis çŸ¥è¯†ç‚¹çš„æ€»ç»“ã€‚\nRedis æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ï¼š\nä¼˜ç‚¹ ï¼š æ€§èƒ½ä¸é”™å¹¶ä¸”ç”Ÿæˆçš„ ID æ˜¯æœ‰åºé€’å¢çš„ ç¼ºç‚¹ ï¼š å’Œæ•°æ®åº“ä¸»é”®è‡ªå¢æ–¹æ¡ˆçš„ç¼ºç‚¹ç±»ä¼¼ é™¤äº† Redis ä¹‹å¤–ï¼ŒMongoDB ObjectId ç»å¸¸ä¹Ÿä¼šè¢«æ‹¿æ¥å½“åšåˆ†å¸ƒå¼ ID çš„è§£å†³æ–¹æ¡ˆã€‚\nMongoDB ObjectId ä¸€å…±éœ€è¦ 12 ä¸ªå­—èŠ‚å­˜å‚¨ï¼š\n0~3ï¼šæ—¶é—´æˆ³ 3~6ï¼š ä»£è¡¨æœºå™¨ ID 7~8ï¼šæœºå™¨è¿›ç¨‹ ID 9~11 ï¼šè‡ªå¢å€¼ MongoDB æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ï¼š\nä¼˜ç‚¹ ï¼š æ€§èƒ½ä¸é”™å¹¶ä¸”ç”Ÿæˆçš„ ID æ˜¯æœ‰åºé€’å¢çš„ ç¼ºç‚¹ ï¼š éœ€è¦è§£å†³é‡å¤ ID é—®é¢˜ï¼ˆå½“æœºå™¨æ—¶é—´ä¸å¯¹çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½å¯¼è‡´ä¼šäº§ç”Ÿé‡å¤ IDï¼‰ ã€æœ‰å®‰å…¨æ€§é—®é¢˜ï¼ˆID ç”Ÿæˆæœ‰è§„å¾‹æ€§ï¼‰ ç®—æ³• # UUID # UUID æ˜¯ Universally Unique Identifierï¼ˆé€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦ï¼‰ çš„ç¼©å†™ã€‚UUID åŒ…å« 32 ä¸ª 16 è¿›åˆ¶æ•°å­—ï¼ˆ8-4-4-4-12ï¼‰ã€‚\nJDK å°±æä¾›äº†ç°æˆçš„ç”Ÿæˆ UUID çš„æ–¹æ³•ï¼Œä¸€è¡Œä»£ç å°±è¡Œäº†ã€‚\n//è¾“å‡ºç¤ºä¾‹ï¼šcb4a9ede-fa5e-4585-b9bb-d60bce986eaa UUID.randomUUID() RFC 4122 ä¸­å…³äº UUID çš„ç¤ºä¾‹æ˜¯è¿™æ ·çš„ï¼š\næˆ‘ä»¬è¿™é‡Œé‡ç‚¹å…³æ³¨ä¸€ä¸‹è¿™ä¸ª Version(ç‰ˆæœ¬)ï¼Œä¸åŒçš„ç‰ˆæœ¬å¯¹åº”çš„ UUID çš„ç”Ÿæˆè§„åˆ™æ˜¯ä¸åŒçš„ã€‚\n5 ç§ä¸åŒçš„ Version(ç‰ˆæœ¬)å€¼åˆ†åˆ«å¯¹åº”çš„å«ä¹‰ï¼ˆå‚è€ƒç»´åŸºç™¾ç§‘å¯¹äº UUID çš„ä»‹ç»ï¼‰ï¼š\nç‰ˆæœ¬ 1 : UUID æ˜¯æ ¹æ®æ—¶é—´å’ŒèŠ‚ç‚¹ IDï¼ˆé€šå¸¸æ˜¯ MAC åœ°å€ï¼‰ç”Ÿæˆï¼› ç‰ˆæœ¬ 2 : UUID æ˜¯æ ¹æ®æ ‡è¯†ç¬¦ï¼ˆé€šå¸¸æ˜¯ç»„æˆ–ç”¨æˆ· IDï¼‰ã€æ—¶é—´å’ŒèŠ‚ç‚¹ ID ç”Ÿæˆï¼› ç‰ˆæœ¬ 3ã€ç‰ˆæœ¬ 5 : ç‰ˆæœ¬ 5 - ç¡®å®šæ€§ UUID é€šè¿‡æ•£åˆ—ï¼ˆhashingï¼‰åå­—ç©ºé—´ï¼ˆnamespaceï¼‰æ ‡è¯†ç¬¦å’Œåç§°ç”Ÿæˆï¼› ç‰ˆæœ¬ 4 : UUID ä½¿ç”¨éšæœºæ€§æˆ–ä¼ªéšæœºæ€§ç”Ÿæˆã€‚ ä¸‹é¢æ˜¯ Version 1 ç‰ˆæœ¬ä¸‹ç”Ÿæˆçš„ UUID çš„ç¤ºä¾‹ï¼š\nJDK ä¸­é€šè¿‡ UUID çš„ randomUUID() æ–¹æ³•ç”Ÿæˆçš„ UUID çš„ç‰ˆæœ¬é»˜è®¤ä¸º 4ã€‚\nUUID uuid = UUID.randomUUID(); int version = uuid.version();// 4 å¦å¤–ï¼ŒVariant(å˜ä½“)ä¹Ÿæœ‰ 4 ç§ä¸åŒçš„å€¼ï¼Œè¿™ç§å€¼åˆ†åˆ«å¯¹åº”ä¸åŒçš„å«ä¹‰ã€‚è¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼Œè²Œä¼¼å¹³æ—¶ä¹Ÿä¸æ€ä¹ˆéœ€è¦å…³æ³¨ã€‚\néœ€è¦ç”¨åˆ°çš„æ—¶å€™ï¼Œå»çœ‹çœ‹ç»´åŸºç™¾ç§‘å¯¹äº UUID çš„ Variant(å˜ä½“) ç›¸å…³çš„ä»‹ç»å³å¯ã€‚\nä»ä¸Šé¢çš„ä»‹ç»ä¸­å¯ä»¥çœ‹å‡ºï¼ŒUUID å¯ä»¥ä¿è¯å”¯ä¸€æ€§ï¼Œå› ä¸ºå…¶ç”Ÿæˆè§„åˆ™åŒ…æ‹¬ MAC åœ°å€ã€æ—¶é—´æˆ³ã€åå­—ç©ºé—´ï¼ˆNamespaceï¼‰ã€éšæœºæˆ–ä¼ªéšæœºæ•°ã€æ—¶åºç­‰å…ƒç´ ï¼Œè®¡ç®—æœºåŸºäºè¿™äº›è§„åˆ™ç”Ÿæˆçš„ UUID æ˜¯è‚¯å®šä¸ä¼šé‡å¤çš„ã€‚\nè™½ç„¶ï¼ŒUUID å¯ä»¥åšåˆ°å…¨å±€å”¯ä¸€æ€§ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸€èˆ¬å¾ˆå°‘ä¼šä½¿ç”¨å®ƒã€‚\næ¯”å¦‚ä½¿ç”¨ UUID ä½œä¸º MySQL æ•°æ®åº“ä¸»é”®çš„æ—¶å€™å°±éå¸¸ä¸åˆé€‚ï¼š\næ•°æ®åº“ä¸»é”®è¦å°½é‡è¶ŠçŸ­è¶Šå¥½ï¼Œè€Œ UUID çš„æ¶ˆè€—çš„å­˜å‚¨ç©ºé—´æ¯”è¾ƒå¤§ï¼ˆ32 ä¸ªå­—ç¬¦ä¸²ï¼Œ128 ä½ï¼‰ã€‚ UUID æ˜¯æ— é¡ºåºçš„ï¼ŒInnoDB å¼•æ“ä¸‹ï¼Œæ•°æ®åº“ä¸»é”®çš„æ— åºæ€§ä¼šä¸¥é‡å½±å“æ•°æ®åº“æ€§èƒ½ã€‚ æœ€åï¼Œæˆ‘ä»¬å†ç®€å•åˆ†æä¸€ä¸‹ UUID çš„ä¼˜ç¼ºç‚¹ ï¼ˆé¢è¯•çš„æ—¶å€™å¯èƒ½ä¼šè¢«é—®åˆ°çš„å“¦ï¼ï¼‰ :\nä¼˜ç‚¹ ï¼šç”Ÿæˆé€Ÿåº¦æ¯”è¾ƒå¿«ã€ç®€å•æ˜“ç”¨ ç¼ºç‚¹ ï¼š å­˜å‚¨æ¶ˆè€—ç©ºé—´å¤§ï¼ˆ32 ä¸ªå­—ç¬¦ä¸²ï¼Œ128 ä½ï¼‰ ã€ ä¸å®‰å…¨ï¼ˆåŸºäº MAC åœ°å€ç”Ÿæˆ UUID çš„ç®—æ³•ä¼šé€ æˆ MAC åœ°å€æ³„éœ²)ã€æ— åºï¼ˆéè‡ªå¢ï¼‰ã€æ²¡æœ‰å…·ä½“ä¸šåŠ¡å«ä¹‰ã€éœ€è¦è§£å†³é‡å¤ ID é—®é¢˜ï¼ˆå½“æœºå™¨æ—¶é—´ä¸å¯¹çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½å¯¼è‡´ä¼šäº§ç”Ÿé‡å¤ IDï¼‰ Snowflake(é›ªèŠ±ç®—æ³•) # Snowflake æ˜¯ Twitter å¼€æºçš„åˆ†å¸ƒå¼ ID ç”Ÿæˆç®—æ³•ã€‚Snowflake ç”± 64 bit çš„äºŒè¿›åˆ¶æ•°å­—ç»„æˆï¼Œè¿™ 64bit çš„äºŒè¿›åˆ¶è¢«åˆ†æˆäº†å‡ éƒ¨åˆ†ï¼Œæ¯ä¸€éƒ¨åˆ†å­˜å‚¨çš„æ•°æ®éƒ½æœ‰ç‰¹å®šçš„å«ä¹‰ï¼š\nç¬¬ 0 ä½ï¼š ç¬¦å·ä½ï¼ˆæ ‡è¯†æ­£è´Ÿï¼‰ï¼Œå§‹ç»ˆä¸º 0ï¼Œæ²¡æœ‰ç”¨ï¼Œä¸ç”¨ç®¡ã€‚ ç¬¬ 1~41 ä½ ï¼šä¸€å…± 41 ä½ï¼Œç”¨æ¥è¡¨ç¤ºæ—¶é—´æˆ³ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼Œå¯ä»¥æ”¯æ’‘ 2 ^41 æ¯«ç§’ï¼ˆçº¦ 69 å¹´ï¼‰ ç¬¬ 42~52 ä½ ï¼šä¸€å…± 10 ä½ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå‰ 5 ä½è¡¨ç¤ºæœºæˆ¿ IDï¼Œå 5 ä½è¡¨ç¤ºæœºå™¨ IDï¼ˆå®é™…é¡¹ç›®ä¸­å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼‰ã€‚è¿™æ ·å°±å¯ä»¥åŒºåˆ†ä¸åŒé›†ç¾¤/æœºæˆ¿çš„èŠ‚ç‚¹ã€‚ ç¬¬ 53~64 ä½ ï¼šä¸€å…± 12 ä½ï¼Œç”¨æ¥è¡¨ç¤ºåºåˆ—å·ã€‚ åºåˆ—å·ä¸ºè‡ªå¢å€¼ï¼Œä»£è¡¨å•å°æœºå™¨æ¯æ¯«ç§’èƒ½å¤Ÿäº§ç”Ÿçš„æœ€å¤§ ID æ•°(2^12 = 4096),ä¹Ÿå°±æ˜¯è¯´å•å°æœºå™¨æ¯æ¯«ç§’æœ€å¤šå¯ä»¥ç”Ÿæˆ 4096 ä¸ª å”¯ä¸€ IDã€‚ å¦‚æœä½ æƒ³è¦ä½¿ç”¨ Snowflake ç®—æ³•çš„è¯ï¼Œä¸€èˆ¬ä¸éœ€è¦ä½ è‡ªå·±å†é€ è½®å­ã€‚æœ‰å¾ˆå¤šåŸºäº Snowflake ç®—æ³•çš„å¼€æºå®ç°æ¯”å¦‚ç¾å›¢ çš„ Leafã€ç™¾åº¦çš„ UidGeneratorï¼Œå¹¶ä¸”è¿™äº›å¼€æºå®ç°å¯¹åŸæœ‰çš„ Snowflake ç®—æ³•è¿›è¡Œäº†ä¼˜åŒ–ã€‚\nå¦å¤–ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¹Ÿä¼šå¯¹ Snowflake ç®—æ³•è¿›è¡Œæ”¹é€ ï¼Œæœ€å¸¸è§çš„å°±æ˜¯åœ¨ Snowflake ç®—æ³•ç”Ÿæˆçš„ ID ä¸­åŠ å…¥ä¸šåŠ¡ç±»å‹ä¿¡æ¯ã€‚\næˆ‘ä»¬å†æ¥çœ‹çœ‹ Snowflake ç®—æ³•çš„ä¼˜ç¼ºç‚¹ ï¼š\nä¼˜ç‚¹ ï¼šç”Ÿæˆé€Ÿåº¦æ¯”è¾ƒå¿«ã€ç”Ÿæˆçš„ ID æœ‰åºé€’å¢ã€æ¯”è¾ƒçµæ´»ï¼ˆå¯ä»¥å¯¹ Snowflake ç®—æ³•è¿›è¡Œç®€å•çš„æ”¹é€ æ¯”å¦‚åŠ å…¥ä¸šåŠ¡ IDï¼‰ ç¼ºç‚¹ ï¼š éœ€è¦è§£å†³é‡å¤ ID é—®é¢˜ï¼ˆä¾èµ–æ—¶é—´ï¼Œå½“æœºå™¨æ—¶é—´ä¸å¯¹çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½å¯¼è‡´ä¼šäº§ç”Ÿé‡å¤ IDï¼‰ã€‚ å¼€æºæ¡†æ¶ # UidGenerator(ç™¾åº¦) # UidGenerator æ˜¯ç™¾åº¦å¼€æºçš„ä¸€æ¬¾åŸºäº Snowflake(é›ªèŠ±ç®—æ³•)çš„å”¯ä¸€ ID ç”Ÿæˆå™¨ã€‚\nä¸è¿‡ï¼ŒUidGenerator å¯¹ Snowflake(é›ªèŠ±ç®—æ³•)è¿›è¡Œäº†æ”¹è¿›ï¼Œç”Ÿæˆçš„å”¯ä¸€ ID ç»„æˆå¦‚ä¸‹ã€‚\nå¯ä»¥çœ‹å‡ºï¼Œå’ŒåŸå§‹ Snowflake(é›ªèŠ±ç®—æ³•)ç”Ÿæˆçš„å”¯ä¸€ ID çš„ç»„æˆä¸å¤ªä¸€æ ·ã€‚å¹¶ä¸”ï¼Œä¸Šé¢è¿™äº›å‚æ•°æˆ‘ä»¬éƒ½å¯ä»¥è‡ªå®šä¹‰ã€‚\nUidGenerator å®˜æ–¹æ–‡æ¡£ä¸­çš„ä»‹ç»å¦‚ä¸‹ï¼š\nè‡ª 18 å¹´åï¼ŒUidGenerator å°±åŸºæœ¬æ²¡æœ‰å†ç»´æŠ¤äº†ï¼Œæˆ‘è¿™é‡Œä¹Ÿä¸è¿‡å¤šä»‹ç»ã€‚æƒ³è¦è¿›ä¸€æ­¥äº†è§£çš„æœ‹å‹ï¼Œå¯ä»¥çœ‹çœ‹ UidGenerator çš„å®˜æ–¹ä»‹ç»ã€‚\nLeaf(ç¾å›¢) # Leaf æ˜¯ç¾å›¢å¼€æºçš„ä¸€ä¸ªåˆ†å¸ƒå¼ ID è§£å†³æ–¹æ¡ˆ ã€‚è¿™ä¸ªé¡¹ç›®çš„åå­— Leafï¼ˆæ ‘å¶ï¼‰ èµ·æºäºå¾·å›½å“²å­¦å®¶ã€æ•°å­¦å®¶è±å¸ƒå°¼èŒ¨çš„ä¸€å¥è¯ï¼š â€œThere are no two identical leaves in the worldâ€ï¼ˆä¸–ç•Œä¸Šæ²¡æœ‰ä¸¤ç‰‡ç›¸åŒçš„æ ‘å¶ï¼‰ ã€‚è¿™åå­—èµ·å¾—çœŸå¿ƒæŒºä¸é”™çš„ï¼Œæœ‰ç‚¹æ–‡è‰ºé’å¹´é‚£å‘³äº†ï¼\nLeaf æä¾›äº† å·æ®µæ¨¡å¼ å’Œ Snowflake(é›ªèŠ±ç®—æ³•) è¿™ä¸¤ç§æ¨¡å¼æ¥ç”Ÿæˆåˆ†å¸ƒå¼ IDã€‚å¹¶ä¸”ï¼Œå®ƒæ”¯æŒåŒå·æ®µï¼Œè¿˜è§£å†³äº†é›ªèŠ± ID ç³»ç»Ÿæ—¶é’Ÿå›æ‹¨é—®é¢˜ã€‚ä¸è¿‡ï¼Œæ—¶é’Ÿé—®é¢˜çš„è§£å†³éœ€è¦å¼±ä¾èµ–äº Zookeeper ã€‚\nLeaf çš„è¯ç”Ÿä¸»è¦æ˜¯ä¸ºäº†è§£å†³ç¾å›¢å„ä¸ªä¸šåŠ¡çº¿ç”Ÿæˆåˆ†å¸ƒå¼ ID çš„æ–¹æ³•å¤šç§å¤šæ ·ä»¥åŠä¸å¯é çš„é—®é¢˜ã€‚\nLeaf å¯¹åŸæœ‰çš„å·æ®µæ¨¡å¼è¿›è¡Œæ”¹è¿›ï¼Œæ¯”å¦‚å®ƒè¿™é‡Œå¢åŠ äº†åŒå·æ®µé¿å…è·å– DB åœ¨è·å–å·æ®µçš„æ—¶å€™é˜»å¡è¯·æ±‚è·å– ID çš„çº¿ç¨‹ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æˆ‘ä¸€ä¸ªå·æ®µè¿˜æ²¡ç”¨å®Œä¹‹å‰ï¼Œæˆ‘è‡ªå·±å°±ä¸»åŠ¨æå‰å»è·å–ä¸‹ä¸€ä¸ªå·æ®µï¼ˆå›¾ç‰‡æ¥è‡ªäºç¾å›¢å®˜æ–¹æ–‡ç« ï¼šã€ŠLeafâ€”â€”ç¾å›¢ç‚¹è¯„åˆ†å¸ƒå¼ ID ç”Ÿæˆç³»ç»Ÿã€‹ï¼‰ã€‚\næ ¹æ®é¡¹ç›® README ä»‹ç»ï¼Œåœ¨ 4C8G VM åŸºç¡€ä¸Šï¼Œé€šè¿‡å…¬å¸ RPC æ–¹å¼è°ƒç”¨ï¼ŒQPS å‹æµ‹ç»“æœè¿‘ 5w/sï¼ŒTP999 1msã€‚\nTinyid(æ»´æ»´) # Tinyid æ˜¯æ»´æ»´å¼€æºçš„ä¸€æ¬¾åŸºäºæ•°æ®åº“å·æ®µæ¨¡å¼çš„å”¯ä¸€ ID ç”Ÿæˆå™¨ã€‚\næ•°æ®åº“å·æ®µæ¨¡å¼çš„åŸç†æˆ‘ä»¬åœ¨ä¸Šé¢å·²ç»ä»‹ç»è¿‡äº†ã€‚Tinyid æœ‰å“ªäº›äº®ç‚¹å‘¢ï¼Ÿ\nä¸ºäº†ææ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹åŸºäºæ•°æ®åº“å·æ®µæ¨¡å¼çš„ç®€å•æ¶æ„æ–¹æ¡ˆã€‚ï¼ˆå›¾ç‰‡æ¥è‡ªäº Tinyid çš„å®˜æ–¹ wiki:ã€ŠTinyid åŸç†ä»‹ç»ã€‹ï¼‰\nåœ¨è¿™ç§æ¶æ„æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡ HTTP è¯·æ±‚å‘å‘å·å™¨æœåŠ¡ç”³è¯·å”¯ä¸€ IDã€‚è´Ÿè½½å‡è¡¡ router ä¼šæŠŠæˆ‘ä»¬çš„è¯·æ±‚é€å¾€å…¶ä¸­çš„ä¸€å° tinyid-serverã€‚\nè¿™ç§æ–¹æ¡ˆæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿåœ¨æˆ‘çœ‹æ¥ï¼ˆTinyid å®˜æ–¹ wiki ä¹Ÿæœ‰ä»‹ç»åˆ°ï¼‰ï¼Œä¸»è¦ç”±ä¸‹é¢è¿™ 2 ä¸ªé—®é¢˜ï¼š\nè·å–æ–°å·æ®µçš„æƒ…å†µä¸‹ï¼Œç¨‹åºè·å–å”¯ä¸€ ID çš„é€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚ éœ€è¦ä¿è¯ DB é«˜å¯ç”¨ï¼Œè¿™ä¸ªæ˜¯æ¯”è¾ƒéº»çƒ¦ä¸”è€—è´¹èµ„æºçš„ã€‚ é™¤æ­¤ä¹‹å¤–ï¼ŒHTTP è°ƒç”¨ä¹Ÿå­˜åœ¨ç½‘ç»œå¼€é”€ã€‚\nTinyid çš„åŸç†æ¯”è¾ƒç®€å•ï¼Œå…¶æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nç›¸æ¯”äºåŸºäºæ•°æ®åº“å·æ®µæ¨¡å¼çš„ç®€å•æ¶æ„æ–¹æ¡ˆï¼ŒTinyid æ–¹æ¡ˆä¸»è¦åšäº†ä¸‹é¢è¿™äº›ä¼˜åŒ–ï¼š\nåŒå·æ®µç¼“å­˜ ï¼šä¸ºäº†é¿å…åœ¨è·å–æ–°å·æ®µçš„æƒ…å†µä¸‹ï¼Œç¨‹åºè·å–å”¯ä¸€ ID çš„é€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚ Tinyid ä¸­çš„å·æ®µåœ¨ç”¨åˆ°ä¸€å®šç¨‹åº¦çš„æ—¶å€™ï¼Œå°±ä¼šå»å¼‚æ­¥åŠ è½½ä¸‹ä¸€ä¸ªå·æ®µï¼Œä¿è¯å†…å­˜ä¸­å§‹ç»ˆæœ‰å¯ç”¨å·æ®µã€‚ å¢åŠ å¤š db æ”¯æŒ ï¼šæ”¯æŒå¤šä¸ª DBï¼Œå¹¶ä¸”ï¼Œæ¯ä¸ª DB éƒ½èƒ½ç”Ÿæˆå”¯ä¸€ IDï¼Œæé«˜äº†å¯ç”¨æ€§ã€‚ å¢åŠ  tinyid-client ï¼šçº¯æœ¬åœ°æ“ä½œï¼Œæ—  HTTP è¯·æ±‚æ¶ˆè€—ï¼Œæ€§èƒ½å’Œå¯ç”¨æ€§éƒ½æœ‰å¾ˆå¤§æå‡ã€‚ Tinyid çš„ä¼˜ç¼ºç‚¹è¿™é‡Œå°±ä¸åˆ†æäº†ï¼Œç»“åˆæ•°æ®åº“å·æ®µæ¨¡å¼çš„ä¼˜ç¼ºç‚¹å’Œ Tinyid çš„åŸç†å°±èƒ½çŸ¥é“ã€‚\næ€»ç»“ # é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘åŸºæœ¬ä¸Šå·²ç»æŠŠæœ€å¸¸è§çš„åˆ†å¸ƒå¼ ID ç”Ÿæˆæ–¹æ¡ˆéƒ½æ€»ç»“äº†ä¸€æ³¢ã€‚\né™¤äº†ä¸Šé¢ä»‹ç»çš„æ–¹å¼ä¹‹å¤–ï¼Œåƒ ZooKeeper è¿™ç±»ä¸­é—´ä»¶ä¹Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆå”¯ä¸€ IDã€‚æ²¡æœ‰é“¶å¼¹ï¼Œä¸€å®šè¦ç»“åˆå®é™…é¡¹ç›®æ¥é€‰æ‹©æœ€é€‚åˆè‡ªå·±çš„æ–¹æ¡ˆã€‚\n"},{"id":87,"href":"/zh/docs/study/Review/java_guide/lydly_distributed_system/ly01ly_api-gateway/","title":"apiç½‘å…³","section":"åˆ†å¸ƒå¼ç³»ç»Ÿ","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nä»€ä¹ˆæ˜¯ç½‘å…³ï¼Ÿæœ‰ä»€ä¹ˆç”¨ï¼Ÿ # å¾®æœåŠ¡èƒŒæ™¯ä¸‹ï¼Œä¸€ä¸ªç³»ç»Ÿè¢«æ‹†åˆ†ä¸ºå¤šä¸ªæœåŠ¡ï¼Œä½†æ˜¯åƒå®‰å…¨è®¤è¯ï¼Œæµé‡æ§åˆ¶ï¼Œæ—¥å¿—ï¼Œç›‘æ§ç­‰åŠŸèƒ½æ˜¯æ¯ä¸ªæœåŠ¡éƒ½éœ€è¦çš„ï¼Œæ²¡æœ‰ç½‘å…³çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨æ¯ä¸ªæœåŠ¡ä¸­å•ç‹¬å®ç°ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬åšäº†å¾ˆå¤šé‡å¤çš„äº‹æƒ…å¹¶ä¸”æ²¡æœ‰ä¸€ä¸ªå…¨å±€çš„è§†å›¾æ¥ç»Ÿä¸€ç®¡ç†è¿™äº›åŠŸèƒ½ã€‚\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç½‘å…³å¯ä»¥ä¸ºæˆ‘ä»¬æä¾›è¯·æ±‚è½¬å‘ã€å®‰å…¨è®¤è¯ï¼ˆèº«ä»½/æƒé™è®¤è¯ï¼‰ã€æµé‡æ§åˆ¶ã€è´Ÿè½½å‡è¡¡ã€é™çº§ç†”æ–­ã€æ—¥å¿—ã€ç›‘æ§ç­‰åŠŸèƒ½ã€‚\nä¸Šé¢ä»‹ç»äº†è¿™ä¹ˆå¤šåŠŸèƒ½ï¼Œå®é™…ä¸Šï¼Œç½‘å…³ä¸»è¦åšäº†ä¸€ä»¶äº‹æƒ…ï¼šè¯·æ±‚è¿‡æ»¤ ã€‚\næœ‰å“ªäº›å¸¸è§çš„ç½‘å…³ç³»ç»Ÿï¼Ÿ # Netflix Zuul # Zuul æ˜¯ Netflix å¼€å‘çš„ä¸€æ¬¾æä¾›åŠ¨æ€è·¯ç”±ã€ç›‘æ§ã€å¼¹æ€§ã€å®‰å…¨çš„ç½‘å…³æœåŠ¡ã€‚\nZuul ä¸»è¦é€šè¿‡è¿‡æ»¤å™¨ï¼ˆç±»ä¼¼äº AOPï¼‰æ¥è¿‡æ»¤è¯·æ±‚ï¼Œä»è€Œå®ç°ç½‘å…³å¿…å¤‡çš„å„ç§åŠŸèƒ½ã€‚\næˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰è¿‡æ»¤å™¨æ¥å¤„ç†è¯·æ±‚ï¼Œå¹¶ä¸”ï¼ŒZuul ç”Ÿæ€æœ¬èº«å°±æœ‰å¾ˆå¤šç°æˆçš„è¿‡æ»¤å™¨ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚å°±æ¯”å¦‚é™æµå¯ä»¥ç›´æ¥ç”¨å›½å¤–æœ‹å‹å†™çš„ spring-cloud-zuul-ratelimit (è¿™é‡Œåªæ˜¯ä¸¾ä¾‹è¯´æ˜ï¼Œä¸€èˆ¬æ˜¯é…åˆ hystrix æ¥åšé™æµ)ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-netflix-zuul\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.marcosbarbero.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-zuul-ratelimit\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.2.0.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; Zuul 1.x åŸºäºåŒæ­¥ IOï¼Œæ€§èƒ½è¾ƒå·®ã€‚Zuul 2.x åŸºäº Netty å®ç°äº†å¼‚æ­¥ IOï¼Œæ€§èƒ½å¾—åˆ°äº†å¤§å¹…æ”¹è¿›ã€‚\nGithub åœ°å€ ï¼š https://github.com/Netflix/zuul å®˜æ–¹ Wiki ï¼š https://github.com/Netflix/zuul/wiki Spring Cloud Gateway # SpringCloud Gateway å±äº Spring Cloud ç”Ÿæ€ç³»ç»Ÿä¸­çš„ç½‘å…³ï¼Œå…¶è¯ç”Ÿçš„ç›®æ ‡æ˜¯ä¸ºäº†æ›¿ä»£è€ç‰Œç½‘å…³ **Zuul **ã€‚å‡†ç¡®ç‚¹æ¥è¯´ï¼Œåº”è¯¥æ˜¯ Zuul 1.xã€‚SpringCloud Gateway èµ·æ­¥è¦æ¯” Zuul 2.x æ›´æ—©ã€‚\nä¸ºäº†æå‡ç½‘å…³çš„æ€§èƒ½ï¼ŒSpringCloud Gateway åŸºäº Spring WebFlux ã€‚Spring WebFlux ä½¿ç”¨ Reactor åº“æ¥å®ç°å“åº”å¼ç¼–ç¨‹æ¨¡å‹ï¼Œåº•å±‚åŸºäº Netty å®ç°å¼‚æ­¥ IOã€‚\nSpring Cloud Gateway çš„ç›®æ ‡ï¼Œä¸ä»…æä¾›ç»Ÿä¸€çš„è·¯ç”±æ–¹å¼ï¼Œå¹¶ä¸”åŸºäº Filter é“¾çš„æ–¹å¼æä¾›äº†ç½‘å…³åŸºæœ¬çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šå®‰å…¨ï¼Œç›‘æ§/æŒ‡æ ‡ï¼Œå’Œé™æµã€‚\nSpring Cloud Gateway å’Œ Zuul 2.x çš„å·®åˆ«ä¸å¤§ï¼Œä¹Ÿæ˜¯é€šè¿‡è¿‡æ»¤å™¨æ¥å¤„ç†è¯·æ±‚ã€‚ä¸è¿‡ï¼Œç›®å‰æ›´åŠ æ¨èä½¿ç”¨ Spring Cloud Gateway è€Œé Zuulï¼ŒSpring Cloud ç”Ÿæ€å¯¹å…¶æ”¯æŒæ›´åŠ å‹å¥½ã€‚\nGithub åœ°å€ ï¼š https://github.com/spring-cloud/spring-cloud-gateway å®˜ç½‘ ï¼š https://spring.io/projects/spring-cloud-gateway Kong # Kong æ˜¯ä¸€æ¬¾åŸºäº OpenResty çš„é«˜æ€§èƒ½ã€äº‘åŸç”Ÿã€å¯æ‰©å±•çš„ç½‘å…³ç³»ç»Ÿã€‚\nOpenResty æ˜¯ä¸€ä¸ªåŸºäº Nginx ä¸ Lua çš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œå…¶å†…éƒ¨é›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—ä»¥åŠå¤§å¤šæ•°çš„ä¾èµ–é¡¹ã€‚ç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†è¶…é«˜å¹¶å‘ã€æ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ã€Web æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚\nKong æä¾›äº†æ’ä»¶æœºåˆ¶æ¥æ‰©å±•å…¶åŠŸèƒ½ã€‚æ¯”å¦‚ã€åœ¨æœåŠ¡ä¸Šå¯ç”¨ Zipkin æ’ä»¶\n$ curl -X POST http://kong:8001/services/{service}/plugins \\ --data \u0026#34;name=zipkin\u0026#34; \\ --data \u0026#34;config.http_endpoint=http://your.zipkin.collector:9411/api/v2/spans\u0026#34; \\ --data \u0026#34;config.sample_ratio=0.001\u0026#34; Github åœ°å€ï¼š https://github.com/Kong/kong å®˜ç½‘åœ°å€ ï¼š https://konghq.com/kong APISIX # APISIX æ˜¯ä¸€æ¬¾åŸºäº Nginx å’Œ etcd çš„é«˜æ€§èƒ½ã€äº‘åŸç”Ÿã€å¯æ‰©å±•çš„ç½‘å…³ç³»ç»Ÿã€‚\netcdæ˜¯ä½¿ç”¨ Go è¯­è¨€å¼€å‘çš„ä¸€ä¸ªå¼€æºçš„ã€é«˜å¯ç”¨çš„åˆ†å¸ƒå¼ key-value å­˜å‚¨ç³»ç»Ÿï¼Œä½¿ç”¨ Raft åè®®åšåˆ†å¸ƒå¼å…±è¯†ã€‚\nä¸ä¼ ç»Ÿ API ç½‘å…³ç›¸æ¯”ï¼ŒAPISIX å…·æœ‰åŠ¨æ€è·¯ç”±å’Œæ’ä»¶çƒ­åŠ è½½ï¼Œç‰¹åˆ«é€‚åˆå¾®æœåŠ¡ç³»ç»Ÿä¸‹çš„ API ç®¡ç†ã€‚å¹¶ä¸”ï¼ŒAPISIX ä¸ SkyWalkingï¼ˆåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªç³»ç»Ÿï¼‰ã€Zipkinï¼ˆåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªç³»ç»Ÿï¼‰ã€Prometheusï¼ˆç›‘æ§ç³»ç»Ÿï¼‰ ç­‰ DevOps ç”Ÿæ€å·¥å…·å¯¹æ¥éƒ½ååˆ†æ–¹ä¾¿ã€‚\nä½œä¸º NGINX å’Œ Kong çš„æ›¿ä»£é¡¹ç›®ï¼ŒAPISIX ç›®å‰å·²ç»æ˜¯ Apache é¡¶çº§å¼€æºé¡¹ç›®ï¼Œå¹¶ä¸”æ˜¯æœ€å¿«æ¯•ä¸šçš„å›½äº§å¼€æºé¡¹ç›®ã€‚å›½å†…ç›®å‰å·²ç»æœ‰å¾ˆå¤šçŸ¥åä¼ä¸šï¼ˆæ¯”å¦‚é‡‘å±±ã€æœ‰èµã€çˆ±å¥‡è‰ºã€è…¾è®¯ã€è´å£³ï¼‰ä½¿ç”¨ APISIX å¤„ç†æ ¸å¿ƒçš„ä¸šåŠ¡æµé‡ã€‚\næ ¹æ®å®˜ç½‘ä»‹ç»ï¼šâ€œAPISIX å·²ç»ç”Ÿäº§å¯ç”¨ï¼ŒåŠŸèƒ½ã€æ€§èƒ½ã€æ¶æ„å…¨é¢ä¼˜äº Kongâ€ã€‚\nGithub åœ°å€ ï¼šhttps://github.com/apache/apisix å®˜ç½‘åœ°å€ï¼š https://apisix.apache.org/zh/ ç›¸å…³é˜…è¯»ï¼š\næœ‰äº† NGINX å’Œ Kongï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ Apache APISIX APISIX æŠ€æœ¯åšå®¢ APISIX ç”¨æˆ·æ¡ˆä¾‹ Shenyu # Shenyu æ˜¯ä¸€æ¬¾åŸºäº WebFlux çš„å¯æ‰©å±•ã€é«˜æ€§èƒ½ã€å“åº”å¼ç½‘å…³ï¼ŒApache é¡¶çº§å¼€æºé¡¹ç›®ã€‚\nShenyu é€šè¿‡æ’ä»¶æ‰©å±•åŠŸèƒ½ï¼Œæ’ä»¶æ˜¯ ShenYu çš„çµé­‚ï¼Œå¹¶ä¸”æ’ä»¶ä¹Ÿæ˜¯å¯æ‰©å±•å’Œçƒ­æ’æ‹”çš„ã€‚ä¸åŒçš„æ’ä»¶å®ç°ä¸åŒçš„åŠŸèƒ½ã€‚Shenyu è‡ªå¸¦äº†è¯¸å¦‚é™æµã€ç†”æ–­ã€è½¬å‘ ã€é‡å†™ã€é‡å®šå‘ã€å’Œè·¯ç”±ç›‘æ§ç­‰æ’ä»¶ã€‚\nGithub åœ°å€ï¼š https://github.com/apache/incubator-shenyu å®˜ç½‘åœ°å€ ï¼š https://shenyu.apache.org/ "},{"id":88,"href":"/zh/docs/study/Review/java_guide/lydly_distributed_system/base/raft-algorithm/","title":"raftç®—æ³•","section":"åŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\n1 èƒŒæ™¯ # å½“ä»Šçš„æ•°æ®ä¸­å¿ƒå’Œåº”ç”¨ç¨‹åºåœ¨é«˜åº¦åŠ¨æ€çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œä¸ºäº†åº”å¯¹é«˜åº¦åŠ¨æ€çš„ç¯å¢ƒï¼Œå®ƒä»¬é€šè¿‡é¢å¤–çš„æœåŠ¡å™¨è¿›è¡Œæ¨ªå‘æ‰©å±•ï¼Œå¹¶ä¸”æ ¹æ®éœ€æ±‚è¿›è¡Œæ‰©å±•å’Œæ”¶ç¼©ã€‚åŒæ—¶ï¼ŒæœåŠ¡å™¨å’Œç½‘ç»œæ•…éšœä¹Ÿå¾ˆå¸¸è§ã€‚\nå› æ­¤ï¼Œç³»ç»Ÿå¿…é¡»åœ¨æ­£å¸¸æ“ä½œæœŸé—´å¤„ç†æœåŠ¡å™¨çš„ä¸Šä¸‹çº¿ã€‚å®ƒä»¬å¿…é¡»å¯¹å˜æ•…åšå‡ºååº”å¹¶åœ¨å‡ ç§’é’Ÿå†…è‡ªåŠ¨é€‚åº”ï¼›å¯¹å®¢æˆ·æ¥è¯´çš„è¯ï¼Œæ˜æ˜¾çš„ä¸­æ–­é€šå¸¸æ˜¯ä¸å¯æ¥å—çš„ã€‚\nå¹¸è¿çš„æ˜¯ï¼Œåˆ†å¸ƒå¼å…±è¯†å¯ä»¥å¸®åŠ©åº”å¯¹è¿™äº›æŒ‘æˆ˜ã€‚\n1.1 æ‹œå åº­å°†å†› # åœ¨ä»‹ç»å…±è¯†ç®—æ³•ä¹‹å‰ï¼Œå…ˆä»‹ç»ä¸€ä¸ªç®€åŒ–ç‰ˆæ‹œå åº­å°†å†›çš„ä¾‹å­æ¥å¸®åŠ©ç†è§£å…±è¯†ç®—æ³•ã€‚\nå‡è®¾å¤šä½æ‹œå åº­å°†å†›ä¸­æ²¡æœ‰å›å†›ï¼Œä¿¡ä½¿çš„ä¿¡æ¯å¯é ä½†æœ‰å¯èƒ½è¢«æš—æ€çš„æƒ…å†µä¸‹ï¼Œå°†å†›ä»¬å¦‚ä½•è¾¾æˆæ˜¯å¦è¦è¿›æ”»çš„ä¸€è‡´æ€§å†³å®šï¼Ÿ\nè§£å†³æ–¹æ¡ˆå¤§è‡´å¯ä»¥ç†è§£æˆï¼šå…ˆåœ¨æ‰€æœ‰çš„å°†å†›ä¸­é€‰å‡ºä¸€ä¸ªå¤§å°†å†›ï¼Œç”¨æ¥åšå‡ºæ‰€æœ‰çš„å†³å®šã€‚\nä¸¾ä¾‹å¦‚ä¸‹ï¼šå‡å¦‚ç°åœ¨ä¸€å…±æœ‰ 3 ä¸ªå°†å†› Aï¼ŒB å’Œ Cï¼Œæ¯ä¸ªå°†å†›éƒ½æœ‰ä¸€ä¸ªéšæœºæ—¶é—´çš„å€’è®¡æ—¶å™¨ï¼Œå€’è®¡æ—¶ä¸€ç»“æŸï¼Œè¿™ä¸ªå°†å†›å°±æŠŠè‡ªå·±å½“æˆå¤§å°†å†›å€™é€‰äººï¼Œç„¶åæ´¾ä¿¡ä½¿ä¼ é€’é€‰ä¸¾æŠ•ç¥¨çš„ä¿¡æ¯ç»™å°†å†› B å’Œ Cï¼Œå¦‚æœå°†å†› B å’Œ C è¿˜æ²¡æœ‰æŠŠè‡ªå·±å½“ä½œå€™é€‰äººï¼ˆè‡ªå·±çš„å€’è®¡æ—¶è¿˜æ²¡æœ‰ç»“æŸï¼‰ï¼Œå¹¶ä¸”æ²¡æœ‰æŠŠé€‰ä¸¾ç¥¨æŠ•ç»™å…¶ä»–äººï¼Œå®ƒä»¬å°±ä¼šæŠŠç¥¨æŠ•ç»™å°†å†› Aï¼Œä¿¡ä½¿å›åˆ°å°†å†› A æ—¶ï¼Œå°†å†› A çŸ¥é“è‡ªå·±æ”¶åˆ°äº†è¶³å¤Ÿçš„ç¥¨æ•°ï¼Œæˆä¸ºå¤§å°†å†›ã€‚åœ¨æœ‰äº†å¤§å°†å†›ä¹‹åï¼Œæ˜¯å¦éœ€è¦è¿›æ”»å°±ç”±å¤§å°†å†› A å†³å®šï¼Œç„¶åå†å»æ´¾ä¿¡ä½¿é€šçŸ¥å¦å¤–ä¸¤ä¸ªå°†å†›ï¼Œè‡ªå·±å·²ç»æˆä¸ºäº†å¤§å°†å†›ã€‚å¦‚æœä¸€æ®µæ—¶é—´è¿˜æ²¡æ”¶åˆ°å°†å†› B å’Œ C çš„å›å¤ï¼ˆä¿¡ä½¿å¯èƒ½ä¼šè¢«æš—æ€ï¼‰ï¼Œé‚£å°±å†é‡æ´¾ä¸€ä¸ªä¿¡ä½¿ï¼Œç›´åˆ°æ”¶åˆ°å›å¤ã€‚\n1.2 å…±è¯†ç®—æ³• # å…±è¯†æ˜¯å¯å®¹é”™ç³»ç»Ÿä¸­çš„ä¸€ä¸ªåŸºæœ¬é—®é¢˜ï¼šå³ä½¿é¢å¯¹æ•…éšœï¼ŒæœåŠ¡å™¨ä¹Ÿå¯ä»¥åœ¨å…±äº«çŠ¶æ€ä¸Šè¾¾æˆä¸€è‡´ã€‚\nå…±è¯†ç®—æ³•å…è®¸ä¸€ç»„èŠ‚ç‚¹åƒä¸€ä¸ªæ•´ä½“ä¸€æ ·ä¸€èµ·å·¥ä½œï¼Œå³ä½¿å…¶ä¸­çš„ä¸€äº›èŠ‚ç‚¹å‡ºç°æ•…éšœä¹Ÿèƒ½å¤Ÿç»§ç»­å·¥ä½œä¸‹å»ï¼Œå…¶æ­£ç¡®æ€§ä¸»è¦æ˜¯æºäºå¤åˆ¶çŠ¶æ€æœºçš„æ€§è´¨ï¼šä¸€ç»„Serverçš„çŠ¶æ€æœºè®¡ç®—ç›¸åŒçŠ¶æ€çš„å‰¯æœ¬ï¼Œå³ä½¿æœ‰ä¸€éƒ¨åˆ†çš„Serverå®•æœºäº†å®ƒä»¬ä»ç„¶èƒ½å¤Ÿç»§ç»­è¿è¡Œã€‚\nå›¾-1 å¤åˆ¶çŠ¶æ€æœºæ¶æ„ ä¸€èˆ¬é€šè¿‡ä½¿ç”¨å¤åˆ¶æ—¥å¿—æ¥å®ç°å¤åˆ¶çŠ¶æ€æœºã€‚æ¯ä¸ªServerå­˜å‚¨ç€ä¸€ä»½åŒ…æ‹¬å‘½ä»¤åºåˆ—çš„æ—¥å¿—æ–‡ä»¶ï¼ŒçŠ¶æ€æœºä¼šæŒ‰é¡ºåºæ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚å› ä¸ºæ¯ä¸ªæ—¥å¿—åŒ…å«ç›¸åŒçš„å‘½ä»¤ï¼Œå¹¶ä¸”é¡ºåºä¹Ÿç›¸åŒï¼Œæ‰€ä»¥æ¯ä¸ªçŠ¶æ€æœºå¤„ç†ç›¸åŒçš„å‘½ä»¤åºåˆ—ã€‚ç”±äºçŠ¶æ€æœºæ˜¯ç¡®å®šæ€§çš„ï¼Œæ‰€ä»¥å¤„ç†ç›¸åŒçš„çŠ¶æ€ï¼Œå¾—åˆ°ç›¸åŒçš„è¾“å‡ºã€‚\nå› æ­¤å…±è¯†ç®—æ³•çš„å·¥ä½œå°±æ˜¯ä¿æŒå¤åˆ¶æ—¥å¿—çš„ä¸€è‡´æ€§ã€‚æœåŠ¡å™¨ä¸Šçš„å…±è¯†æ¨¡å—ä»å®¢æˆ·ç«¯æ¥æ”¶å‘½ä»¤å¹¶å°†å®ƒä»¬æ·»åŠ åˆ°æ—¥å¿—ä¸­ã€‚å®ƒä¸å…¶ä»–æœåŠ¡å™¨ä¸Šçš„å…±è¯†æ¨¡å—é€šä¿¡ï¼Œä»¥ç¡®ä¿å³ä½¿æŸäº›æœåŠ¡å™¨å‘ç”Ÿæ•…éšœã€‚æ¯ä¸ªæ—¥å¿—æœ€ç»ˆåŒ…å«ç›¸åŒé¡ºåºçš„è¯·æ±‚ã€‚ä¸€æ—¦å‘½ä»¤è¢«æ­£ç¡®åœ°å¤åˆ¶ï¼Œå®ƒä»¬å°±è¢«ç§°ä¸ºå·²æäº¤ã€‚æ¯ä¸ªæœåŠ¡å™¨çš„çŠ¶æ€æœºæŒ‰ç…§æ—¥å¿—é¡ºåºå¤„ç†å·²æäº¤çš„å‘½ä»¤ï¼Œå¹¶å°†è¾“å‡ºè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå› æ­¤ï¼Œè¿™äº›æœåŠ¡å™¨å½¢æˆäº†ä¸€ä¸ªå•ä¸€çš„ã€é«˜åº¦å¯é çš„çŠ¶æ€æœºã€‚\né€‚ç”¨äºå®é™…ç³»ç»Ÿçš„å…±è¯†ç®—æ³•é€šå¸¸å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š\nå®‰å…¨ã€‚ç¡®ä¿åœ¨éæ‹œå åº­æ¡ä»¶ï¼ˆä¹Ÿå°±æ˜¯ä¸Šæ–‡ä¸­æåˆ°çš„ç®€æ˜“ç‰ˆæ‹œå åº­ï¼‰ä¸‹çš„å®‰å…¨æ€§ï¼ŒåŒ…æ‹¬ç½‘ç»œå»¶è¿Ÿã€åˆ†åŒºã€åŒ…ä¸¢å¤±ã€å¤åˆ¶å’Œé‡æ–°æ’åºã€‚ é«˜å¯ç”¨ã€‚åªè¦å¤§å¤šæ•°æœåŠ¡å™¨éƒ½æ˜¯å¯æ“ä½œçš„ï¼Œå¹¶ä¸”å¯ä»¥ç›¸äº’é€šä¿¡ï¼Œä¹Ÿå¯ä»¥ä¸å®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ï¼Œé‚£ä¹ˆè¿™äº›æœåŠ¡å™¨å°±å¯ä»¥çœ‹ä½œå®Œå…¨åŠŸèƒ½å¯ç”¨çš„ã€‚å› æ­¤ï¼Œä¸€ä¸ªå…¸å‹çš„ç”±äº”å°æœåŠ¡å™¨ç»„æˆçš„é›†ç¾¤å¯ä»¥å®¹å¿ä»»ä½•ä¸¤å°æœåŠ¡å™¨ç«¯æ•…éšœã€‚å‡è®¾æœåŠ¡å™¨å› åœæ­¢è€Œå‘ç”Ÿæ•…éšœï¼›å®ƒä»¬ç¨åå¯èƒ½ä¼šä»ç¨³å®šå­˜å‚¨ä¸Šçš„çŠ¶æ€ä¸­æ¢å¤å¹¶é‡æ–°åŠ å…¥é›†ç¾¤ã€‚ ä¸€è‡´æ€§ä¸ä¾èµ–æ—¶åºã€‚é”™è¯¯çš„æ—¶é’Ÿå’Œæç«¯çš„æ¶ˆæ¯å»¶è¿Ÿï¼Œåœ¨æœ€åçš„æƒ…å†µä¸‹ä¹Ÿåªä¼šé€ æˆå¯ç”¨æ€§é—®é¢˜ï¼Œè€Œä¸ä¼šäº§ç”Ÿä¸€è‡´æ€§é—®é¢˜ã€‚ åœ¨é›†ç¾¤ä¸­å¤§å¤šæ•°æœåŠ¡å™¨å“åº”ï¼Œå‘½ä»¤å°±å¯ä»¥å®Œæˆï¼Œä¸ä¼šè¢«å°‘æ•°è¿è¡Œç¼“æ…¢çš„æœåŠ¡å™¨æ¥å½±å“æ•´ä½“ç³»ç»Ÿæ€§èƒ½ã€‚ 2 åŸºç¡€ # 2.1 èŠ‚ç‚¹ç±»å‹ # ä¸€ä¸ª Raft é›†ç¾¤åŒ…æ‹¬è‹¥å¹²æœåŠ¡å™¨ï¼Œä»¥å…¸å‹çš„ 5 æœåŠ¡å™¨é›†ç¾¤ä¸¾ä¾‹ã€‚åœ¨ä»»æ„çš„æ—¶é—´ï¼Œæ¯ä¸ªæœåŠ¡å™¨ä¸€å®šä¼šå¤„äºä»¥ä¸‹ä¸‰ä¸ªçŠ¶æ€ä¸­çš„ä¸€ä¸ªï¼š\nLeaderï¼šè´Ÿè´£å‘èµ·å¿ƒè·³ï¼Œå“åº”å®¢æˆ·ç«¯ï¼Œåˆ›å»ºæ—¥å¿—ï¼ŒåŒæ­¥æ—¥å¿—ã€‚ Candidateï¼šLeader é€‰ä¸¾è¿‡ç¨‹ä¸­çš„ä¸´æ—¶è§’è‰²ï¼Œç”± Follower è½¬åŒ–è€Œæ¥ï¼Œå‘èµ·æŠ•ç¥¨å‚ä¸ç«é€‰ã€‚ Followerï¼šæ¥å— Leader çš„å¿ƒè·³å’Œæ—¥å¿—åŒæ­¥æ•°æ®ï¼ŒæŠ•ç¥¨ç»™ Candidateã€‚ åœ¨æ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ä¸ªæœåŠ¡å™¨æ˜¯ Leaderï¼Œå‰©ä¸‹çš„æœåŠ¡å™¨æ˜¯ Followerã€‚Follower æ˜¯è¢«åŠ¨çš„ï¼Œå®ƒä»¬ä¸ä¼šå‘é€ä»»ä½•è¯·æ±‚ï¼Œåªæ˜¯å“åº”æ¥è‡ª Leader å’Œ Candidate çš„è¯·æ±‚ã€‚\nå›¾-2ï¼šæœåŠ¡å™¨çš„çŠ¶æ€ 2.2 ä»»æœŸ # å›¾-3ï¼šä»»æœŸ å¦‚å›¾ 3 æ‰€ç¤ºï¼Œraft ç®—æ³•å°†æ—¶é—´åˆ’åˆ†ä¸ºä»»æ„é•¿åº¦çš„ä»»æœŸï¼ˆtermï¼‰ï¼Œä»»æœŸç”¨è¿ç»­çš„æ•°å­—è¡¨ç¤ºï¼Œçœ‹ä½œå½“å‰ term å·ã€‚æ¯ä¸€ä¸ªä»»æœŸçš„å¼€å§‹éƒ½æ˜¯ä¸€æ¬¡é€‰ä¸¾ï¼Œåœ¨é€‰ä¸¾å¼€å§‹æ—¶ï¼Œä¸€ä¸ªæˆ–å¤šä¸ª Candidate ä¼šå°è¯•æˆä¸º Leaderã€‚å¦‚æœä¸€ä¸ª Candidate èµ¢å¾—äº†é€‰ä¸¾ï¼Œå®ƒå°±ä¼šåœ¨è¯¥ä»»æœŸå†…æ‹…ä»» Leaderã€‚å¦‚æœæ²¡æœ‰é€‰å‡º Leaderï¼Œå°†ä¼šå¼€å¯å¦ä¸€ä¸ªä»»æœŸï¼Œå¹¶ç«‹åˆ»å¼€å§‹ä¸‹ä¸€æ¬¡é€‰ä¸¾ã€‚raft ç®—æ³•ä¿è¯åœ¨ç»™å®šçš„ä¸€ä¸ªä»»æœŸæœ€å°‘è¦æœ‰ä¸€ä¸ª Leaderã€‚\næ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šå­˜å‚¨å½“å‰çš„ term å·ï¼Œå½“æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œé€šä¿¡æ—¶ä¼šäº¤æ¢å½“å‰çš„ term å·ï¼›å¦‚æœæœ‰æœåŠ¡å™¨å‘ç°è‡ªå·±çš„ term å·æ¯”å…¶ä»–äººå°ï¼Œé‚£ä¹ˆä»–ä¼šæ›´æ–°åˆ°è¾ƒå¤§çš„ term å€¼ã€‚å¦‚æœä¸€ä¸ª Candidate æˆ–è€… Leader å‘ç°è‡ªå·±çš„ term è¿‡æœŸäº†ï¼Œä»–ä¼šç«‹å³é€€å›æˆ Followerã€‚å¦‚æœä¸€å°æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚çš„ term å·æ˜¯è¿‡æœŸçš„ï¼Œé‚£ä¹ˆå®ƒä¼šæ‹’ç»æ­¤æ¬¡è¯·æ±‚ã€‚\n2.3 æ—¥å¿— # entryï¼šæ¯ä¸€ä¸ªäº‹ä»¶æˆä¸º entryï¼Œåªæœ‰ Leader å¯ä»¥åˆ›å»º entryã€‚entry çš„å†…å®¹ä¸º\u0026lt;term,index,cmd\u0026gt;å…¶ä¸­ cmd æ˜¯å¯ä»¥åº”ç”¨åˆ°çŠ¶æ€æœºçš„æ“ä½œã€‚ logï¼šç”± entry æ„æˆçš„æ•°ç»„ï¼Œæ¯ä¸€ä¸ª entry éƒ½æœ‰ä¸€ä¸ªè¡¨æ˜è‡ªå·±åœ¨ log ä¸­çš„ indexã€‚åªæœ‰ Leader æ‰å¯ä»¥æ”¹å˜å…¶ä»–èŠ‚ç‚¹çš„ logã€‚entry æ€»æ˜¯å…ˆè¢« Leader æ·»åŠ åˆ°è‡ªå·±çš„ log æ•°ç»„ä¸­ï¼Œç„¶åå†å‘èµ·å…±è¯†è¯·æ±‚ï¼Œè·å¾—åŒæ„åæ‰ä¼šè¢« Leader æäº¤ç»™çŠ¶æ€æœºã€‚Follower åªèƒ½ä» Leader è·å–æ–°æ—¥å¿—å’Œå½“å‰çš„ commitIndexï¼Œç„¶åæŠŠå¯¹åº”çš„ entry åº”ç”¨åˆ°è‡ªå·±çš„çŠ¶æ€æœºä¸­ã€‚ 3 é¢†å¯¼äººé€‰ä¸¾ # raft ä½¿ç”¨å¿ƒè·³æœºåˆ¶æ¥è§¦å‘ Leader çš„é€‰ä¸¾ã€‚\nå¦‚æœä¸€å°æœåŠ¡å™¨èƒ½å¤Ÿæ”¶åˆ°æ¥è‡ª Leader æˆ–è€… Candidate çš„æœ‰æ•ˆä¿¡æ¯ï¼Œé‚£ä¹ˆå®ƒä¼šä¸€ç›´ä¿æŒä¸º Follower çŠ¶æ€ï¼Œå¹¶ä¸”åˆ·æ–°è‡ªå·±çš„ electionElapsedï¼Œé‡æ–°è®¡æ—¶ã€‚\nLeader ä¼šå‘æ‰€æœ‰çš„ Follower å‘¨æœŸæ€§å‘é€å¿ƒè·³æ¥ä¿è¯è‡ªå·±çš„ Leader åœ°ä½ã€‚å¦‚æœä¸€ä¸ª Follower åœ¨ä¸€ä¸ªå‘¨æœŸå†…æ²¡æœ‰æ”¶åˆ°å¿ƒè·³ä¿¡æ¯ï¼Œå°±å«åšé€‰ä¸¾è¶…æ—¶ï¼Œç„¶åå®ƒå°±ä¼šè®¤ä¸ºæ­¤æ—¶æ²¡æœ‰å¯ç”¨çš„ Leaderï¼Œå¹¶ä¸”å¼€å§‹è¿›è¡Œä¸€æ¬¡é€‰ä¸¾ä»¥é€‰å‡ºä¸€ä¸ªæ–°çš„ Leaderã€‚\nä¸ºäº†å¼€å§‹æ–°çš„é€‰ä¸¾ï¼ŒFollower ä¼šè‡ªå¢è‡ªå·±çš„ term å·å¹¶ä¸”è½¬æ¢çŠ¶æ€ä¸º Candidateã€‚ç„¶åä»–ä¼šå‘æ‰€æœ‰èŠ‚ç‚¹å‘èµ· RequestVoteRPC è¯·æ±‚ï¼Œ Candidate çš„çŠ¶æ€ä¼šæŒç»­åˆ°ä»¥ä¸‹æƒ…å†µå‘ç”Ÿï¼š\nèµ¢å¾—é€‰ä¸¾ å…¶ä»–èŠ‚ç‚¹èµ¢å¾—é€‰ä¸¾ ä¸€è½®é€‰ä¸¾ç»“æŸï¼Œæ— äººèƒœå‡º èµ¢å¾—é€‰ä¸¾çš„æ¡ä»¶æ˜¯ï¼šä¸€ä¸ª Candidate åœ¨ä¸€ä¸ªä»»æœŸå†…æ”¶åˆ°äº†æ¥è‡ªé›†ç¾¤å†…çš„å¤šæ•°é€‰ç¥¨ï¼ˆN/2+1ï¼‰ï¼Œå°±å¯ä»¥æˆä¸º Leaderã€‚\nåœ¨ Candidate ç­‰å¾…é€‰ç¥¨çš„æ—¶å€™ï¼Œå®ƒå¯èƒ½æ”¶åˆ°å…¶ä»–èŠ‚ç‚¹å£°æ˜è‡ªå·±æ˜¯ Leader çš„å¿ƒè·³ï¼Œæ­¤æ—¶æœ‰ä¸¤ç§æƒ…å†µï¼š\nè¯¥ Leader çš„ term å·å¤§äºç­‰äºè‡ªå·±çš„ term å·ï¼Œè¯´æ˜å¯¹æ–¹å·²ç»æˆä¸º Leaderï¼Œåˆ™è‡ªå·±å›é€€ä¸º Followerã€‚ è¯¥ Leader çš„ term å·å°äºè‡ªå·±çš„ term å·ï¼Œé‚£ä¹ˆä¼šæ‹’ç»è¯¥è¯·æ±‚å¹¶è®©è¯¥èŠ‚ç‚¹æ›´æ–° termã€‚ ç”±äºå¯èƒ½åŒä¸€æ—¶åˆ»å‡ºç°å¤šä¸ª Candidateï¼Œå¯¼è‡´æ²¡æœ‰ Candidate è·å¾—å¤§å¤šæ•°é€‰ç¥¨ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–æ‰‹æ®µæ¥é‡æ–°åˆ†é…é€‰ç¥¨çš„è¯ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šæ— é™é‡å¤ä¸‹å»ã€‚\nraft ä½¿ç”¨äº†éšæœºçš„é€‰ä¸¾è¶…æ—¶æ—¶é—´æ¥é¿å…ä¸Šè¿°æƒ…å†µã€‚æ¯ä¸€ä¸ª Candidate åœ¨å‘èµ·é€‰ä¸¾åï¼Œéƒ½ä¼šéšæœºåŒ–ä¸€ä¸ªæ–°çš„æšä¸¾è¶…æ—¶æ—¶é—´ï¼Œè¿™ç§æœºåˆ¶ä½¿å¾—å„ä¸ªæœåŠ¡å™¨èƒ½å¤Ÿåˆ†æ•£å¼€æ¥ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹åªæœ‰ä¸€ä¸ªæœåŠ¡å™¨ä¼šç‡å…ˆè¶…æ—¶ï¼›å®ƒä¼šåœ¨å…¶ä»–æœåŠ¡å™¨è¶…æ—¶ä¹‹å‰èµ¢å¾—é€‰ä¸¾ã€‚\n4 æ—¥å¿—å¤åˆ¶ # ä¸€æ—¦é€‰å‡ºäº† Leaderï¼Œå®ƒå°±å¼€å§‹æ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚æ¯ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚éƒ½åŒ…å«ä¸€æ¡éœ€è¦è¢«å¤åˆ¶çŠ¶æ€æœºï¼ˆReplicated State Mechineï¼‰æ‰§è¡Œçš„å‘½ä»¤ã€‚\nLeader æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚åï¼Œä¼šç”Ÿæˆä¸€ä¸ª entryï¼ŒåŒ…å«\u0026lt;index,term,cmd\u0026gt;ï¼Œå†å°†è¿™ä¸ª entry æ·»åŠ åˆ°è‡ªå·±çš„æ—¥å¿—æœ«å°¾åï¼Œå‘æ‰€æœ‰çš„èŠ‚ç‚¹å¹¿æ’­è¯¥ entryï¼Œè¦æ±‚å…¶ä»–æœåŠ¡å™¨å¤åˆ¶è¿™æ¡ entryã€‚\nå¦‚æœ Follower æ¥å—è¯¥ entryï¼Œåˆ™ä¼šå°† entry æ·»åŠ åˆ°è‡ªå·±çš„æ—¥å¿—åé¢ï¼ŒåŒæ—¶è¿”å›ç»™ Leader åŒæ„ã€‚\nå¦‚æœ Leader æ”¶åˆ°äº†å¤šæ•°çš„æˆåŠŸå“åº”ï¼ŒLeader ä¼šå°†è¿™ä¸ª entry åº”ç”¨åˆ°è‡ªå·±çš„çŠ¶æ€æœºä¸­ï¼Œä¹‹åå¯ä»¥æˆä¸ºè¿™ä¸ª entry æ˜¯ committed çš„ï¼Œå¹¶ä¸”å‘å®¢æˆ·ç«¯è¿”å›æ‰§è¡Œç»“æœã€‚\nraft ä¿è¯ä»¥ä¸‹ä¸¤ä¸ªæ€§è´¨ï¼š\nåœ¨ä¸¤ä¸ªæ—¥å¿—é‡Œï¼Œæœ‰ä¸¤ä¸ª entry æ‹¥æœ‰ç›¸åŒçš„ index å’Œ termï¼Œé‚£ä¹ˆå®ƒä»¬ä¸€å®šæœ‰ç›¸åŒçš„ cmd åœ¨ä¸¤ä¸ªæ—¥å¿—é‡Œï¼Œæœ‰ä¸¤ä¸ª entry æ‹¥æœ‰ç›¸åŒçš„ index å’Œ termï¼Œé‚£ä¹ˆå®ƒä»¬å‰é¢çš„ entry ä¹Ÿä¸€å®šç›¸åŒ é€šè¿‡â€œä»…æœ‰ Leader å¯ä»¥ç”Ÿå­˜ entryâ€æ¥ä¿è¯ç¬¬ä¸€ä¸ªæ€§è´¨ï¼Œç¬¬äºŒä¸ªæ€§è´¨éœ€è¦ä¸€è‡´æ€§æ£€æŸ¥æ¥è¿›è¡Œä¿è¯ã€‚\nä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒLeader å’Œ Follower çš„æ—¥å¿—ä¿æŒä¸€è‡´ï¼Œç„¶åï¼ŒLeader çš„å´©æºƒä¼šå¯¼è‡´æ—¥å¿—ä¸ä¸€æ ·ï¼Œè¿™æ ·ä¸€è‡´æ€§æ£€æŸ¥ä¼šäº§ç”Ÿå¤±è´¥ã€‚Leader é€šè¿‡å¼ºåˆ¶ Follower å¤åˆ¶è‡ªå·±çš„æ—¥å¿—æ¥å¤„ç†æ—¥å¿—çš„ä¸ä¸€è‡´ã€‚è¿™å°±æ„å‘³ç€ï¼Œåœ¨ Follower ä¸Šçš„å†²çªæ—¥å¿—ä¼šè¢«é¢†å¯¼è€…çš„æ—¥å¿—è¦†ç›–ã€‚\nä¸ºäº†ä½¿å¾— Follower çš„æ—¥å¿—å’Œè‡ªå·±çš„æ—¥å¿—ä¸€è‡´ï¼ŒLeader éœ€è¦æ‰¾åˆ° Follower ä¸å®ƒæ—¥å¿—ä¸€è‡´çš„åœ°æ–¹ï¼Œç„¶ååˆ é™¤ Follower åœ¨è¯¥ä½ç½®ä¹‹åçš„æ—¥å¿—ï¼Œæ¥ç€æŠŠè¿™ä¹‹åçš„æ—¥å¿—å‘é€ç»™ Followerã€‚\nLeader ç»™æ¯ä¸€ä¸ªFollower ç»´æŠ¤äº†ä¸€ä¸ª nextIndexï¼Œå®ƒè¡¨ç¤º Leader å°†è¦å‘é€ç»™è¯¥è¿½éšè€…çš„ä¸‹ä¸€æ¡æ—¥å¿—æ¡ç›®çš„ç´¢å¼•ã€‚å½“ä¸€ä¸ª Leader å¼€å§‹æŒæƒæ—¶ï¼Œå®ƒä¼šå°† nextIndex åˆå§‹åŒ–ä¸ºå®ƒçš„æœ€æ–°çš„æ—¥å¿—æ¡ç›®ç´¢å¼•æ•°+1ã€‚å¦‚æœä¸€ä¸ª Follower çš„æ—¥å¿—å’Œ Leader çš„ä¸ä¸€è‡´ï¼ŒAppendEntries ä¸€è‡´æ€§æ£€æŸ¥ä¼šåœ¨ä¸‹ä¸€æ¬¡ AppendEntries RPC æ—¶è¿”å›å¤±è´¥ã€‚åœ¨å¤±è´¥ä¹‹åï¼ŒLeader ä¼šå°† nextIndex é€’å‡ç„¶åé‡è¯• AppendEntries RPCã€‚æœ€ç»ˆ nextIndex ä¼šè¾¾åˆ°ä¸€ä¸ª Leader å’Œ Follower æ—¥å¿—ä¸€è‡´çš„åœ°æ–¹ã€‚è¿™æ—¶ï¼ŒAppendEntries ä¼šè¿”å›æˆåŠŸï¼ŒFollower ä¸­å†²çªçš„æ—¥å¿—æ¡ç›®éƒ½è¢«ç§»é™¤äº†ï¼Œå¹¶ä¸”æ·»åŠ æ‰€ç¼ºå°‘çš„ä¸Šäº† Leader çš„æ—¥å¿—æ¡ç›®ã€‚ä¸€æ—¦ AppendEntries è¿”å›æˆåŠŸï¼ŒFollower å’Œ Leader çš„æ—¥å¿—å°±ä¸€è‡´äº†ï¼Œè¿™æ ·çš„çŠ¶æ€ä¼šä¿æŒåˆ°è¯¥ä»»æœŸç»“æŸã€‚\n5 å®‰å…¨æ€§ # 5.1 é€‰ä¸¾é™åˆ¶ # Leader éœ€è¦ä¿è¯è‡ªå·±å­˜å‚¨å…¨éƒ¨å·²ç»æäº¤çš„æ—¥å¿—æ¡ç›®ã€‚è¿™æ ·æ‰å¯ä»¥ä½¿æ—¥å¿—æ¡ç›®åªæœ‰ä¸€ä¸ªæµå‘ï¼šä» Leader æµå‘ Followerï¼ŒLeader æ°¸è¿œä¸ä¼šè¦†ç›–å·²ç»å­˜åœ¨çš„æ—¥å¿—æ¡ç›®ã€‚\næ¯ä¸ª Candidate å‘é€ RequestVoteRPC æ—¶ï¼Œéƒ½ä¼šå¸¦ä¸Šæœ€åä¸€ä¸ª entry çš„ä¿¡æ¯ã€‚æ‰€æœ‰èŠ‚ç‚¹æ”¶åˆ°æŠ•ç¥¨ä¿¡æ¯æ—¶ï¼Œä¼šå¯¹è¯¥ entry è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå‘ç°è‡ªå·±çš„æ›´æ–°ï¼Œåˆ™æ‹’ç»æŠ•ç¥¨ç»™è¯¥ Candidateã€‚\nåˆ¤æ–­æ—¥å¿—æ–°æ—§çš„æ–¹å¼ï¼šå¦‚æœä¸¤ä¸ªæ—¥å¿—çš„ term ä¸åŒï¼Œterm å¤§çš„æ›´æ–°ï¼›å¦‚æœ term ç›¸åŒï¼Œæ›´é•¿çš„ index æ›´æ–°ã€‚\n5.2 èŠ‚ç‚¹å´©æºƒ # å¦‚æœ Leader å´©æºƒï¼Œé›†ç¾¤ä¸­çš„èŠ‚ç‚¹åœ¨ electionTimeout æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ° Leader çš„å¿ƒè·³ä¿¡æ¯å°±ä¼šè§¦å‘æ–°ä¸€è½®çš„é€‰ä¸»ï¼Œåœ¨é€‰ä¸»æœŸé—´æ•´ä¸ªé›†ç¾¤å¯¹å¤–æ˜¯ä¸å¯ç”¨çš„ã€‚\nå¦‚æœ Follower å’Œ Candidate å´©æºƒï¼Œå¤„ç†æ–¹å¼ä¼šç®€å•å¾ˆå¤šã€‚ä¹‹åå‘é€ç»™å®ƒçš„ RequestVoteRPC å’Œ AppendEntriesRPC ä¼šå¤±è´¥ã€‚ç”±äº raft çš„æ‰€æœ‰è¯·æ±‚éƒ½æ˜¯å¹‚ç­‰çš„ï¼Œæ‰€ä»¥å¤±è´¥çš„è¯ä¼šæ— é™çš„é‡è¯•ã€‚å¦‚æœå´©æºƒæ¢å¤åï¼Œå°±å¯ä»¥æ”¶åˆ°æ–°çš„è¯·æ±‚ï¼Œç„¶åé€‰æ‹©è¿½åŠ æˆ–è€…æ‹’ç» entryã€‚\n5.3 æ—¶é—´ä¸å¯ç”¨æ€§ # raft çš„è¦æ±‚ä¹‹ä¸€å°±æ˜¯å®‰å…¨æ€§ä¸ä¾èµ–äºæ—¶é—´ï¼šç³»ç»Ÿä¸èƒ½ä»…ä»…å› ä¸ºä¸€äº›äº‹ä»¶å‘ç”Ÿçš„æ¯”é¢„æƒ³çš„å¿«ä¸€äº›æˆ–è€…æ…¢ä¸€äº›å°±äº§ç”Ÿé”™è¯¯ã€‚ä¸ºäº†ä¿è¯ä¸Šè¿°è¦æ±‚ï¼Œæœ€å¥½èƒ½æ»¡è¶³ä»¥ä¸‹çš„æ—¶é—´æ¡ä»¶ï¼š\nbroadcastTime \u0026lt;\u0026lt; electionTimeout \u0026lt;\u0026lt; MTBF broadcastTimeï¼šå‘å…¶ä»–èŠ‚ç‚¹å¹¶å‘å‘é€æ¶ˆæ¯çš„å¹³å‡å“åº”æ—¶é—´ï¼› electionTimeoutï¼šé€‰ä¸¾è¶…æ—¶æ—¶é—´ï¼› MTBF(mean time between failures)ï¼šå•å°æœºå™¨çš„å¹³å‡å¥åº·æ—¶é—´ï¼› broadcastTimeåº”è¯¥æ¯”electionTimeoutå°ä¸€ä¸ªæ•°é‡çº§ï¼Œä¸ºçš„æ˜¯ä½¿Leaderèƒ½å¤ŸæŒç»­å‘é€å¿ƒè·³ä¿¡æ¯ï¼ˆheartbeatï¼‰æ¥é˜»æ­¢Followerå¼€å§‹é€‰ä¸¾ï¼›\nelectionTimeoutä¹Ÿè¦æ¯”MTBFå°å‡ ä¸ªæ•°é‡çº§ï¼Œä¸ºçš„æ˜¯ä½¿å¾—ç³»ç»Ÿç¨³å®šè¿è¡Œã€‚å½“Leaderå´©æºƒæ—¶ï¼Œå¤§çº¦ä¼šåœ¨æ•´ä¸ªelectionTimeoutçš„æ—¶é—´å†…ä¸å¯ç”¨ï¼›æˆ‘ä»¬å¸Œæœ›è¿™ç§æƒ…å†µä»…å å…¨éƒ¨æ—¶é—´çš„å¾ˆå°ä¸€éƒ¨åˆ†ã€‚\nç”±äºbroadcastTimeå’ŒMTBFæ˜¯ç”±ç³»ç»Ÿå†³å®šçš„å±æ€§ï¼Œå› æ­¤éœ€è¦å†³å®šelectionTimeoutçš„æ—¶é—´ã€‚\nä¸€èˆ¬æ¥è¯´ï¼ŒbroadcastTime ä¸€èˆ¬ä¸º 0.5ï½20msï¼ŒelectionTimeout å¯ä»¥è®¾ç½®ä¸º 10ï½500msï¼ŒMTBF ä¸€èˆ¬ä¸ºä¸€ä¸¤ä¸ªæœˆã€‚\n6 å‚è€ƒ # https://tanxinyu.work/raft/ https://github.com/OneSizeFitsQuorum/raft-thesis-zh_cn/blob/master/raft-thesis-zh_cn.md https://github.com/ongardie/dissertation/blob/master/stanford.pdf https://knowledge-sharing.gitbooks.io/raft/content/chapter5.html "},{"id":89,"href":"/zh/docs/study/Review/java_guide/lydly_distributed_system/base/paxos-algorithm/","title":"paxosç®—æ³•","section":"åŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nèƒŒæ™¯ # Paxos ç®—æ³•æ˜¯ Leslie Lamportï¼ˆè±æ–¯åˆ©Â·å…°ä¼¯ç‰¹ï¼‰åœ¨ 1990 å¹´æå‡ºäº†ä¸€ç§åˆ†å¸ƒå¼ç³»ç»Ÿ å…±è¯† ç®—æ³•ã€‚è¿™ä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªè¢«è¯æ˜å®Œå¤‡çš„å…±è¯†ç®—æ³•ï¼ˆå‰ææ˜¯ä¸å­˜åœ¨æ‹œå åº­å°†å†›é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æ¶æ„èŠ‚ç‚¹ï¼‰ã€‚\nä¸ºäº†ä»‹ç» Paxos ç®—æ³•ï¼Œå…°ä¼¯ç‰¹ä¸“é—¨å†™äº†ä¸€ç¯‡å¹½é»˜é£è¶£çš„è®ºæ–‡ã€‚åœ¨è¿™ç¯‡è®ºæ–‡ä¸­ï¼Œä»–è™šæ‹Ÿäº†ä¸€ä¸ªå«åš Paxos çš„å¸Œè…ŠåŸé‚¦æ¥æ›´å½¢è±¡åŒ–åœ°ä»‹ç» Paxos ç®—æ³•ã€‚\nä¸è¿‡ï¼Œå®¡ç¨¿äººå¹¶ä¸è®¤å¯è¿™ç¯‡è®ºæ–‡çš„å¹½é»˜ã€‚äºæ˜¯ï¼Œä»–ä»¬å°±ç»™å…°ä¼¯ç‰¹è¯´ï¼šâ€œå¦‚æœä½ æƒ³è¦æˆåŠŸå‘è¡¨è¿™ç¯‡è®ºæ–‡çš„è¯ï¼Œå¿…é¡»åˆ é™¤æ‰€æœ‰ Paxos ç›¸å…³çš„æ•…äº‹èƒŒæ™¯â€ã€‚å…°ä¼¯ç‰¹ä¸€å¬å°±ä¸å¼€å¿ƒäº†ï¼šâ€œæˆ‘å‡­ä»€ä¹ˆä¿®æ”¹å•Šï¼Œä½ ä»¬è¿™äº›å®¡ç¨¿äººå°±æ˜¯ç¼ºä¹å¹½é»˜ç»†èƒï¼Œå‘ä¸äº†å°±ä¸å‘äº†å‘—ï¼â€ã€‚\näºæ˜¯ä¹ï¼Œæå‡º Paxos ç®—æ³•çš„é‚£ç¯‡è®ºæ–‡åœ¨å½“æ—¶å¹¶æ²¡æœ‰è¢«æˆåŠŸå‘è¡¨ã€‚\nç›´åˆ° 1998 å¹´ï¼Œç³»ç»Ÿç ”ç©¶ä¸­å¿ƒ (Systems Research Centerï¼ŒSRCï¼‰çš„ä¸¤ä¸ªæŠ€æœ¯ç ”ç©¶å‘˜éœ€è¦æ‰¾ä¸€äº›åˆé€‚çš„åˆ†å¸ƒå¼ç®—æ³•æ¥æœåŠ¡ä»–ä»¬æ­£åœ¨æ„å»ºçš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼ŒPaxos ç®—æ³•åˆšå¥½å¯ä»¥è§£å†³ä»–ä»¬çš„éƒ¨åˆ†éœ€æ±‚ã€‚å› æ­¤ï¼Œå…°ä¼¯ç‰¹å°±æŠŠè®ºæ–‡å‘ç»™äº†ä»–ä»¬ã€‚åœ¨çœ‹äº†è®ºæ–‡ä¹‹åï¼Œè¿™ä¿©å¤§ä½¬è§‰å¾—è®ºæ–‡è¿˜æ˜¯æŒºä¸é”™çš„ã€‚äºæ˜¯ï¼Œå…°ä¼¯ç‰¹åœ¨ 1998 å¹´é‡æ–°å‘è¡¨è®ºæ–‡ ã€ŠThe Part-Time Parliamentã€‹ã€‚\nè®ºæ–‡å‘è¡¨ä¹‹åï¼Œå„è·¯å­¦è€…ç›´å‘¼çœ‹ä¸æ‡‚ï¼Œè¨€è¯­ä¸­è¿˜ç•¥æ˜¾è°ƒä¾ƒä¹‹æ„ã€‚è¿™è°å¿å¾—äº†ï¼Œåœ¨ 2001 å¹´çš„æ—¶å€™ï¼Œå…°ä¼¯ç‰¹ä¸“é—¨åˆå†™äº†ä¸€ç¯‡ ã€ŠPaxos Made Simpleã€‹ çš„è®ºæ–‡æ¥ç®€åŒ–å¯¹ Paxos çš„ä»‹ç»ï¼Œä¸»è¦è®²è¿°ä¸¤é˜¶æ®µå…±è¯†åè®®éƒ¨åˆ†ï¼Œé¡ºä¾¿è¿˜ä¸å¿˜å˜²è®½ä¸€ä¸‹è¿™ç¾¤å­¦è€…ã€‚\nã€ŠPaxos Made Simpleã€‹è¿™ç¯‡è®ºæ–‡å°± 14 é¡µï¼Œç›¸æ¯”äº ã€ŠThe Part-Time Parliamentã€‹çš„ 33 é¡µç²¾ç®€äº†ä¸å°‘ã€‚æœ€å…³é”®çš„æ˜¯è¿™ç¯‡è®ºæ–‡çš„æ‘˜è¦å°±ä¸€å¥è¯ï¼š\nThe Paxos algorithm, when presented in plain English, is very simple.\nç¿»è¯‘è¿‡æ¥çš„æ„æ€å¤§æ¦‚å°±æ˜¯ï¼šå½“æˆ‘ç”¨æ— ä¿®é¥°çš„è‹±æ–‡æ¥æè¿°æ—¶ï¼ŒPaxos ç®—æ³•çœŸå¿ƒç®€å•ï¼\næœ‰æ²¡æœ‰æ„Ÿè§‰åˆ°æ¥è‡ªå…°ä¼¯ç‰¹å¤§ä½¬æ»¡æ»¡åœ°å˜²è®½çš„å‘³é“ï¼Ÿ\nä»‹ç» # Paxos ç®—æ³•æ˜¯ç¬¬ä¸€ä¸ªè¢«è¯æ˜å®Œå¤‡çš„åˆ†å¸ƒå¼ç³»ç»Ÿå…±è¯†ç®—æ³•ã€‚å…±è¯†ç®—æ³•çš„ä½œç”¨æ˜¯è®©åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´å¯¹æŸä¸ªææ¡ˆï¼ˆProposalï¼‰è¾¾æˆä¸€è‡´çš„çœ‹æ³•ã€‚ææ¡ˆçš„å«ä¹‰åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ååˆ†å®½æ³›ï¼Œåƒå“ªä¸€ä¸ªèŠ‚ç‚¹æ˜¯ Leader èŠ‚ç‚¹ã€å¤šä¸ªäº‹ä»¶å‘ç”Ÿçš„é¡ºåºç­‰ç­‰éƒ½å¯ä»¥æ˜¯ä¸€ä¸ªææ¡ˆã€‚\nå…°ä¼¯ç‰¹å½“æ—¶æå‡ºçš„ Paxos ç®—æ³•ä¸»è¦åŒ…å« 2 ä¸ªéƒ¨åˆ†:\nBasic Paxos ç®—æ³• ï¼š æè¿°çš„æ˜¯å¤šèŠ‚ç‚¹ä¹‹é—´å¦‚ä½•å°±æŸä¸ªå€¼(ææ¡ˆ Value)è¾¾æˆå…±è¯†ã€‚ Multi-Paxos æ€æƒ³ ï¼š æè¿°çš„æ˜¯æ‰§è¡Œå¤šä¸ª Basic Paxos å®ä¾‹ï¼Œå°±ä¸€ç³»åˆ—å€¼è¾¾æˆå…±è¯†ã€‚Multi-Paxos è¯´ç™½äº†å°±æ˜¯æ‰§è¡Œå¤šæ¬¡ Basic Paxos ï¼Œæ ¸å¿ƒè¿˜æ˜¯ Basic Paxos ã€‚ ç”±äº Paxos ç®—æ³•åœ¨å›½é™…ä¸Šè¢«å…¬è®¤çš„éå¸¸éš¾ä»¥ç†è§£å’Œå®ç°ï¼Œå› æ­¤ä¸æ–­æœ‰äººå°è¯•ç®€åŒ–è¿™ä¸€ç®—æ³•ã€‚åˆ°äº† 2013 å¹´æ‰è¯ç”Ÿäº†ä¸€ä¸ªæ¯” Paxos ç®—æ³•æ›´æ˜“ç†è§£å’Œå®ç°çš„å…±è¯†ç®—æ³•â€”Raft ç®—æ³• ã€‚æ›´å…·ä½“ç‚¹æ¥è¯´ï¼ŒRaft æ˜¯ Multi-Paxos çš„ä¸€ä¸ªå˜ç§ï¼Œå…¶ç®€åŒ–äº† Multi-Paxos çš„æ€æƒ³ï¼Œå˜å¾—æ›´å®¹æ˜“è¢«ç†è§£ä»¥åŠå·¥ç¨‹å®ç°ã€‚\né’ˆå¯¹æ²¡æœ‰æ¶æ„èŠ‚ç‚¹çš„æƒ…å†µï¼Œé™¤äº† Raft ç®—æ³•ä¹‹å¤–ï¼Œå½“å‰æœ€å¸¸ç”¨çš„ä¸€äº›å…±è¯†ç®—æ³•æ¯”å¦‚ ZAB åè®® ã€ Fast Paxos ç®—æ³•éƒ½æ˜¯åŸºäº Paxos ç®—æ³•æ”¹è¿›çš„ã€‚\né’ˆå¯¹å­˜åœ¨æ¶æ„èŠ‚ç‚¹çš„æƒ…å†µï¼Œä¸€èˆ¬ä½¿ç”¨çš„æ˜¯ å·¥ä½œé‡è¯æ˜ï¼ˆPOWï¼ŒProof-of-Workï¼‰ ã€ æƒç›Šè¯æ˜ï¼ˆPoSï¼ŒProof-of-Stake ï¼‰ ç­‰å…±è¯†ç®—æ³•ã€‚è¿™ç±»å…±è¯†ç®—æ³•æœ€å…¸å‹çš„åº”ç”¨å°±æ˜¯åŒºå—é“¾ï¼Œå°±æ¯”å¦‚è¯´å‰æ®µæ—¶é—´ä»¥å¤ªåŠå®˜æ–¹å®£å¸ƒå…¶å…±è¯†æœºåˆ¶æ­£åœ¨ä»å·¥ä½œé‡è¯æ˜(PoW)è½¬å˜ä¸ºæƒç›Šè¯æ˜(PoS)ã€‚\nåŒºå—é“¾ç³»ç»Ÿä½¿ç”¨çš„å…±è¯†ç®—æ³•éœ€è¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜æ˜¯ æ‹œå åº­å°†å†›é—®é¢˜ ï¼Œè¿™å’Œæˆ‘ä»¬æ—¥å¸¸æ¥è§¦åˆ°çš„ ZooKeeperã€Etcdã€Consul ç­‰åˆ†å¸ƒå¼ä¸­é—´ä»¶ä¸å¤ªä¸€æ ·ã€‚\nä¸‹é¢æˆ‘ä»¬æ¥å¯¹ Paxos ç®—æ³•çš„å®šä¹‰åšä¸€ä¸ªæ€»ç»“ï¼š\nPaxos ç®—æ³•æ˜¯å…°ä¼¯ç‰¹åœ¨ 1990 å¹´æå‡ºäº†ä¸€ç§åˆ†å¸ƒå¼ç³»ç»Ÿå…±è¯†ç®—æ³•ã€‚ å…°ä¼¯ç‰¹å½“æ—¶æå‡ºçš„ Paxos ç®—æ³•ä¸»è¦åŒ…å« 2 ä¸ªéƒ¨åˆ†: Basic Paxos ç®—æ³•å’Œ Multi-Paxos æ€æƒ³ã€‚ Raft ç®—æ³•ã€ZAB åè®®ã€ Fast Paxos ç®—æ³•éƒ½æ˜¯åŸºäº Paxos ç®—æ³•æ”¹è¿›è€Œæ¥ã€‚ Basic Paxos ç®—æ³• # Basic Paxos ä¸­å­˜åœ¨ 3 ä¸ªé‡è¦çš„è§’è‰²ï¼š\næè®®è€…ï¼ˆProposerï¼‰ï¼šä¹Ÿå¯ä»¥å«åšåè°ƒè€…ï¼ˆcoordinatorï¼‰ï¼Œæè®®è€…è´Ÿè´£æ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚å¹¶å‘èµ·ææ¡ˆã€‚ææ¡ˆä¿¡æ¯é€šå¸¸åŒ…æ‹¬ææ¡ˆç¼–å· (Proposal ID) å’Œæè®®çš„å€¼ (Value)ã€‚ æ¥å—è€…ï¼ˆAcceptorï¼‰ï¼šä¹Ÿå¯ä»¥å«åšæŠ•ç¥¨å‘˜ï¼ˆvoterï¼‰ï¼Œè´Ÿè´£å¯¹æè®®è€…çš„ææ¡ˆè¿›è¡ŒæŠ•ç¥¨ï¼ŒåŒæ—¶éœ€è¦è®°ä½è‡ªå·±çš„æŠ•ç¥¨å†å²ï¼› å­¦ä¹ è€…ï¼ˆLearnerï¼‰ï¼šå¦‚æœæœ‰è¶…è¿‡åŠæ•°æ¥å—è€…å°±æŸä¸ªæè®®è¾¾æˆäº†å…±è¯†ï¼Œé‚£ä¹ˆå­¦ä¹ è€…å°±éœ€è¦æ¥å—è¿™ä¸ªæè®®ï¼Œå¹¶å°±è¯¥æè®®ä½œå‡ºè¿ç®—ï¼Œç„¶åå°†è¿ç®—ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ ä¸ºäº†å‡å°‘å®ç°è¯¥ç®—æ³•æ‰€éœ€çš„èŠ‚ç‚¹æ•°ï¼Œä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥èº«å…¼å¤šä¸ªè§’è‰²ã€‚å¹¶ä¸”ï¼Œä¸€ä¸ªææ¡ˆè¢«é€‰å®šéœ€è¦è¢«åŠæ•°ä»¥ä¸Šçš„ Acceptor æ¥å—ã€‚è¿™æ ·çš„è¯ï¼ŒBasic Paxos ç®—æ³•è¿˜å…·å¤‡å®¹é”™æ€§ï¼Œåœ¨å°‘äºä¸€åŠçš„èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶ï¼Œé›†ç¾¤ä»èƒ½æ­£å¸¸å·¥ä½œã€‚\nMulti Paxos æ€æƒ³ # Basic Paxos ç®—æ³•çš„ä»…èƒ½å°±å•ä¸ªå€¼è¾¾æˆå…±è¯†ï¼Œä¸ºäº†èƒ½å¤Ÿå¯¹ä¸€ç³»åˆ—çš„å€¼è¾¾æˆå…±è¯†ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° Basic Paxos æ€æƒ³ã€‚\nâš ï¸æ³¨æ„ ï¼š Multi-Paxos åªæ˜¯ä¸€ç§æ€æƒ³ï¼Œè¿™ç§æ€æƒ³çš„æ ¸å¿ƒå°±æ˜¯é€šè¿‡å¤šä¸ª Basic Paxos å®ä¾‹å°±ä¸€ç³»åˆ—å€¼è¾¾æˆå…±è¯†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒBasic Paxos æ˜¯ Multi-Paxos æ€æƒ³çš„æ ¸å¿ƒï¼ŒMulti-Paxos å°±æ˜¯å¤šæ‰§è¡Œå‡ æ¬¡ Basic Paxosã€‚\nç”±äºå…°ä¼¯ç‰¹æåˆ°çš„ Multi-Paxos æ€æƒ³ç¼ºå°‘ä»£ç å®ç°çš„å¿…è¦ç»†èŠ‚(æ¯”å¦‚æ€ä¹ˆé€‰ä¸¾é¢†å¯¼è€…)ï¼Œæ‰€ä»¥åœ¨ç†è§£å’Œå®ç°ä¸Šæ¯”è¾ƒå›°éš¾ã€‚\nä¸è¿‡ï¼Œä¹Ÿä¸éœ€è¦æ‹…å¿ƒï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦è‡ªå·±å®ç°åŸºäº Multi-Paxos æ€æƒ³çš„å…±è¯†ç®—æ³•ï¼Œä¸šç•Œå·²ç»æœ‰äº†æ¯”è¾ƒå‡ºåçš„å®ç°ã€‚åƒ Raft ç®—æ³•å°±æ˜¯ Multi-Paxos çš„ä¸€ä¸ªå˜ç§ï¼Œå…¶ç®€åŒ–äº† Multi-Paxos çš„æ€æƒ³ï¼Œå˜å¾—æ›´å®¹æ˜“è¢«ç†è§£ä»¥åŠå·¥ç¨‹å®ç°ï¼Œå®é™…é¡¹ç›®ä¸­å¯ä»¥ä¼˜å…ˆè€ƒè™‘ Raft ç®—æ³•ã€‚\nå‚è€ƒ # https://zh.wikipedia.org/wiki/Paxos åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸€è‡´æ€§ä¸å…±è¯†ç®—æ³•ï¼šhttp://www.xuyasong.com/?p=1970 "},{"id":90,"href":"/zh/docs/study/Review/java_guide/lydly_distributed_system/base/cap_base-theorem/","title":"CAP\u0026BASE ç†è®º","section":"åŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nç»å†è¿‡æŠ€æœ¯é¢è¯•çš„å°ä¼™ä¼´æƒ³å¿…å¯¹ CAP \u0026amp; BASE è¿™ä¸ªä¸¤ä¸ªç†è®ºå·²ç»å†ç†Ÿæ‚‰ä¸è¿‡äº†ï¼\næˆ‘å½“å¹´å‚åŠ é¢è¯•çš„æ—¶å€™ï¼Œä¸å¤¸å¼ åœ°è¯´ï¼Œåªè¦é—®åˆ°åˆ†å¸ƒå¼ç›¸å…³çš„å†…å®¹ï¼Œé¢è¯•å®˜å‡ ä¹æ˜¯å¿…å®šä¼šé—®è¿™ä¸¤ä¸ªåˆ†å¸ƒå¼ç›¸å…³çš„ç†è®ºã€‚ä¸€æ˜¯å› ä¸ºè¿™ä¸¤ä¸ªåˆ†å¸ƒå¼åŸºç¡€ç†è®ºæ˜¯å­¦ä¹ åˆ†å¸ƒå¼çŸ¥è¯†çš„å¿…å¤‡å‰ç½®åŸºç¡€ï¼ŒäºŒæ˜¯å› ä¸ºå¾ˆå¤šé¢è¯•å®˜è‡ªå·±æ¯”è¾ƒç†Ÿæ‚‰è¿™ä¸¤ä¸ªç†è®ºï¼ˆæ–¹ä¾¿æé—®ï¼‰ã€‚\næˆ‘ä»¬éå¸¸æœ‰å¿…è¦å°†è¿™ä¸¤ä¸ªç†è®ºææ‡‚ï¼Œå¹¶ä¸”èƒ½å¤Ÿç”¨è‡ªå·±çš„ç†è§£ç»™åˆ«äººè®²å‡ºæ¥ã€‚\nCAP ç†è®º # CAP ç†è®º/å®šç†èµ·æºäº 2000 å¹´ï¼Œç”±åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡çš„ Eric Brewer æ•™æˆåœ¨åˆ†å¸ƒå¼è®¡ç®—åŸç†ç ”è®¨ä¼šï¼ˆPODCï¼‰ä¸Šæå‡ºï¼Œå› æ­¤ CAP å®šç†åˆè¢«ç§°ä½œ å¸ƒé²å°”å®šç†ï¼ˆBrewerâ€™s theoremï¼‰\n2 å¹´åï¼Œéº»çœç†å·¥å­¦é™¢çš„ Seth Gilbert å’Œ Nancy Lynch å‘è¡¨äº†å¸ƒé²å°”çŒœæƒ³çš„è¯æ˜ï¼ŒCAP ç†è®ºæ­£å¼æˆä¸ºåˆ†å¸ƒå¼é¢†åŸŸçš„å®šç†ã€‚\nç®€ä»‹ # [kÉ™nËˆsÉªstÉ™nsi] consistency ä¸€è‡´æ€§\n[É™ËŒveÉªlÉ™'bÉªlÉ™ti] availability å¯ç”¨æ€§ ,\n[pÉ‘ËËˆtÉªÊƒn] åˆ†å‰² [ËˆtÉ’lÉ™rÉ™ns] å®¹å¿, CAP ä¹Ÿå°±æ˜¯ Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ã€Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ã€Partition Toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰ è¿™ä¸‰ä¸ªå•è¯é¦–å­—æ¯ç»„åˆã€‚\nCAP ç†è®ºçš„æå‡ºè€…å¸ƒé²å°”åœ¨æå‡º CAP çŒœæƒ³çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰è¯¦ç»†å®šä¹‰ Consistencyã€Availabilityã€Partition Tolerance ä¸‰ä¸ªå•è¯çš„æ˜ç¡®å®šä¹‰ã€‚\nå› æ­¤ï¼Œå¯¹äº CAP çš„æ°‘é—´è§£è¯»æœ‰å¾ˆå¤šï¼Œä¸€èˆ¬æ¯”è¾ƒè¢«å¤§å®¶æ¨èçš„æ˜¯ä¸‹é¢ ğŸ‘‡ è¿™ç§ç‰ˆæœ¬çš„è§£è¯»ã€‚\nåœ¨ç†è®ºè®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒCAP å®šç†ï¼ˆCAP theoremï¼‰æŒ‡å‡ºå¯¹äºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œå½“è®¾è®¡è¯»å†™æ“ä½œæ—¶ï¼Œåªèƒ½åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸‰ç‚¹ä¸­çš„ä¸¤ä¸ªï¼š\nä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ : æ‰€æœ‰èŠ‚ç‚¹è®¿é—®åŒä¸€ä»½æœ€æ–°çš„æ•°æ®å‰¯æœ¬ å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰: éæ•…éšœçš„èŠ‚ç‚¹åœ¨åˆç†çš„æ—¶é—´å†…è¿”å›åˆç†çš„å“åº”ï¼ˆä¸æ˜¯é”™è¯¯æˆ–è€…è¶…æ—¶çš„å“åº”ï¼‰ã€‚ åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition Toleranceï¼‰ : åˆ†å¸ƒå¼ç³»ç»Ÿå‡ºç°ç½‘ç»œåˆ†åŒºçš„æ—¶å€™ï¼Œä»ç„¶èƒ½å¤Ÿå¯¹å¤–æä¾›æœåŠ¡ã€‚ ä»€ä¹ˆæ˜¯ç½‘ç»œåˆ†åŒºï¼Ÿ\nåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹å‰çš„ç½‘ç»œæœ¬æ¥æ˜¯è¿é€šçš„ï¼Œä½†æ˜¯å› ä¸ºæŸäº›æ•…éšœï¼ˆæ¯”å¦‚éƒ¨åˆ†èŠ‚ç‚¹ç½‘ç»œå‡ºäº†é—®é¢˜ï¼‰æŸäº›èŠ‚ç‚¹ä¹‹é—´ä¸è¿é€šäº†ï¼Œæ•´ä¸ªç½‘ç»œå°±åˆ†æˆäº†å‡ å—åŒºåŸŸï¼Œè¿™å°±å« ç½‘ç»œåˆ†åŒºã€‚\nä¸æ˜¯æ‰€è°“çš„â€œ3 é€‰ 2â€ # å¤§éƒ¨åˆ†äººè§£é‡Šè¿™ä¸€å®šå¾‹æ—¶ï¼Œå¸¸å¸¸ç®€å•çš„è¡¨è¿°ä¸ºï¼šâ€œä¸€è‡´æ€§ã€å¯ç”¨æ€§ã€åˆ†åŒºå®¹å¿æ€§ä¸‰è€…ä½ åªèƒ½åŒæ—¶è¾¾åˆ°å…¶ä¸­ä¸¤ä¸ªï¼Œä¸å¯èƒ½åŒæ—¶è¾¾åˆ°â€ã€‚å®é™…ä¸Šè¿™æ˜¯ä¸€ä¸ªéå¸¸å…·æœ‰è¯¯å¯¼æ€§è´¨çš„è¯´æ³•ï¼Œè€Œä¸”åœ¨ CAP ç†è®ºè¯ç”Ÿ 12 å¹´ä¹‹åï¼ŒCAP ä¹‹çˆ¶ä¹Ÿåœ¨ 2012 å¹´é‡å†™äº†ä¹‹å‰çš„è®ºæ–‡ã€‚\nå½“å‘ç”Ÿç½‘ç»œåˆ†åŒºçš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬è¦ç»§ç»­æœåŠ¡ï¼ˆä¹Ÿå°±æ˜¯P)ï¼Œé‚£ä¹ˆå¼ºä¸€è‡´æ€§å’Œå¯ç”¨æ€§åªèƒ½ 2 é€‰ 1ã€‚ä¹Ÿå°±æ˜¯è¯´å½“ç½‘ç»œåˆ†åŒºä¹‹å P æ˜¯å‰æï¼Œå†³å®šäº† P ä¹‹åæ‰æœ‰ C å’Œ A çš„é€‰æ‹©ã€‚ä¹Ÿå°±æ˜¯è¯´åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰æˆ‘ä»¬æ˜¯å¿…é¡»è¦å®ç°çš„ã€‚\nç®€è€Œè¨€ä¹‹å°±æ˜¯ï¼šCAP ç†è®ºä¸­åˆ†åŒºå®¹é”™æ€§ P æ˜¯ä¸€å®šè¦æ»¡è¶³çš„ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œåªèƒ½æ»¡è¶³å¯ç”¨æ€§ A æˆ–è€…ä¸€è‡´æ€§ Cã€‚\nå› æ­¤ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºä¸Šä¸å¯èƒ½é€‰æ‹© CA æ¶æ„ï¼Œåªèƒ½é€‰æ‹© CP æˆ–è€… AP æ¶æ„ã€‚ æ¯”å¦‚ ZooKeeperã€HBase å°±æ˜¯ CP æ¶æ„ï¼ŒCassandraã€Eureka å°±æ˜¯ AP æ¶æ„ï¼ŒNacos ä¸ä»…æ”¯æŒ CP æ¶æ„ä¹Ÿæ”¯æŒ AP æ¶æ„ã€‚\nPï¼Œåˆ†åŒºå®¹é”™æ€§ï¼Œå°±æ˜¯ä¸€å®šè¦ä¿è¯èƒ½æä¾›æœåŠ¡\nä¸ºå•¥ä¸å¯èƒ½é€‰æ‹© CA æ¶æ„å‘¢ï¼Ÿ ä¸¾ä¸ªä¾‹å­ï¼šè‹¥ç³»ç»Ÿå‡ºç°â€œåˆ†åŒºâ€ï¼Œç³»ç»Ÿä¸­çš„æŸä¸ªèŠ‚ç‚¹åœ¨è¿›è¡Œå†™æ“ä½œã€‚ä¸ºäº†ä¿è¯ Cï¼Œ å¿…é¡»è¦ç¦æ­¢å…¶ä»–èŠ‚ç‚¹çš„è¯»å†™æ“ä½œï¼Œè¿™å°±å’Œ A å‘ç”Ÿå†²çªäº†ã€‚å¦‚æœä¸ºäº†ä¿è¯ Aï¼Œå…¶ä»–èŠ‚ç‚¹çš„è¯»å†™æ“ä½œæ­£å¸¸çš„è¯ï¼Œé‚£å°±å’Œ C å‘ç”Ÿå†²çªäº†ã€‚\né€‰æ‹© CP è¿˜æ˜¯ AP çš„å…³é”®åœ¨äºå½“å‰çš„ä¸šåŠ¡åœºæ™¯ï¼Œæ²¡æœ‰å®šè®ºï¼Œæ¯”å¦‚å¯¹äºéœ€è¦ç¡®ä¿å¼ºä¸€è‡´æ€§çš„åœºæ™¯å¦‚é“¶è¡Œä¸€èˆ¬ä¼šé€‰æ‹©ä¿è¯ CP ã€‚\nå¦å¤–ï¼Œéœ€è¦è¡¥å……è¯´æ˜çš„ä¸€ç‚¹æ˜¯ï¼š å¦‚æœç½‘ç»œåˆ†åŒºæ­£å¸¸çš„è¯ï¼ˆç³»ç»Ÿåœ¨ç»å¤§éƒ¨åˆ†æ—¶å€™æ‰€å¤„çš„çŠ¶æ€ï¼‰ï¼Œä¹Ÿå°±è¯´ä¸éœ€è¦ä¿è¯ P çš„æ—¶å€™ï¼ŒC å’Œ A èƒ½å¤ŸåŒæ—¶ä¿è¯ã€‚\nCAP å®é™…åº”ç”¨æ¡ˆä¾‹ # æˆ‘è¿™é‡Œä»¥æ³¨å†Œä¸­å¿ƒæ¥æ¢è®¨ä¸€ä¸‹ CAP çš„å®é™…åº”ç”¨ã€‚è€ƒè™‘åˆ°å¾ˆå¤šå°ä¼™ä¼´ä¸çŸ¥é“æ³¨å†Œä¸­å¿ƒæ˜¯å¹²å˜›çš„ï¼Œè¿™é‡Œç®€å•ä»¥ Dubbo ä¸ºä¾‹è¯´ä¸€è¯´ã€‚\nä¸‹å›¾æ˜¯ Dubbo çš„æ¶æ„å›¾ã€‚æ³¨å†Œä¸­å¿ƒ Registry åœ¨å…¶ä¸­æ‰®æ¼”äº†ä»€ä¹ˆè§’è‰²å‘¢ï¼Ÿæä¾›äº†ä»€ä¹ˆæœåŠ¡å‘¢ï¼Ÿ\næ³¨å†Œä¸­å¿ƒè´Ÿè´£æœåŠ¡åœ°å€çš„æ³¨å†Œä¸æŸ¥æ‰¾ï¼Œç›¸å½“äºç›®å½•æœåŠ¡ï¼ŒæœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…åªåœ¨å¯åŠ¨æ—¶ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’ï¼Œæ³¨å†Œä¸­å¿ƒä¸è½¬å‘è¯·æ±‚ï¼Œå‹åŠ›è¾ƒå°ã€‚\n](https://camo.gith\nå¸¸è§çš„å¯ä»¥ä½œä¸ºæ³¨å†Œä¸­å¿ƒçš„ç»„ä»¶æœ‰ï¼šZooKeeperã€Eurekaã€Nacos\u0026hellip;ã€‚\nZooKeeper ä¿è¯çš„æ˜¯ CPã€‚ ä»»ä½•æ—¶åˆ»å¯¹ ZooKeeper çš„è¯»è¯·æ±‚éƒ½èƒ½å¾—åˆ°ä¸€è‡´æ€§çš„ç»“æœï¼Œä½†æ˜¯ï¼Œ ZooKeeper ä¸ä¿è¯æ¯æ¬¡è¯·æ±‚çš„å¯ç”¨æ€§æ¯”å¦‚åœ¨ Leader é€‰ä¸¾è¿‡ç¨‹ä¸­æˆ–è€…åŠæ•°ä»¥ä¸Šçš„æœºå™¨ä¸å¯ç”¨çš„æ—¶å€™æœåŠ¡å°±æ˜¯ä¸å¯ç”¨çš„ã€‚ Eureka ä¿è¯çš„åˆ™æ˜¯ APã€‚ Eureka åœ¨è®¾è®¡çš„æ—¶å€™å°±æ˜¯ä¼˜å…ˆä¿è¯ A ï¼ˆå¯ç”¨æ€§ï¼‰ã€‚åœ¨ Eureka ä¸­ä¸å­˜åœ¨ä»€ä¹ˆ Leader èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€æ ·çš„ã€å¹³ç­‰çš„ã€‚å› æ­¤ Eureka ä¸ä¼šåƒ ZooKeeper é‚£æ ·å‡ºç°é€‰ä¸¾è¿‡ç¨‹ä¸­æˆ–è€…åŠæ•°ä»¥ä¸Šçš„æœºå™¨ä¸å¯ç”¨çš„æ—¶å€™æœåŠ¡å°±æ˜¯ä¸å¯ç”¨çš„æƒ…å†µã€‚ Eureka ä¿è¯å³ä½¿å¤§éƒ¨åˆ†èŠ‚ç‚¹æŒ‚æ‰ä¹Ÿä¸ä¼šå½±å“æ­£å¸¸æä¾›æœåŠ¡ï¼Œåªè¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¯ç”¨çš„å°±è¡Œäº†ã€‚åªä¸è¿‡è¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„æ•°æ®å¯èƒ½å¹¶ä¸æ˜¯æœ€æ–°çš„ã€‚ Nacos ä¸ä»…æ”¯æŒ CP ä¹Ÿæ”¯æŒ APã€‚ æ€»ç»“ # åœ¨è¿›è¡Œåˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡å’Œå¼€å‘æ—¶ï¼Œæˆ‘ä»¬ä¸åº”è¯¥ä»…ä»…å±€é™åœ¨ CAP é—®é¢˜ä¸Šï¼Œè¿˜è¦å…³æ³¨ç³»ç»Ÿçš„æ‰©å±•æ€§ã€å¯ç”¨æ€§ç­‰ç­‰\nåœ¨ç³»ç»Ÿå‘ç”Ÿâ€œåˆ†åŒºâ€çš„æƒ…å†µä¸‹ï¼ŒCAP ç†è®ºåªèƒ½æ»¡è¶³ CP æˆ–è€… APã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„å‰ææ˜¯ç³»ç»Ÿå‘ç”Ÿäº†â€œåˆ†åŒºâ€\nå¦‚æœç³»ç»Ÿæ²¡æœ‰å‘ç”Ÿâ€œåˆ†åŒºâ€çš„è¯ï¼ŒèŠ‚ç‚¹é—´çš„ç½‘ç»œè¿æ¥é€šä¿¡æ­£å¸¸çš„è¯ï¼Œä¹Ÿå°±ä¸å­˜åœ¨ P äº†ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥åŒæ—¶ä¿è¯ C å’Œ A äº†ã€‚\næ€»ç»“ï¼šå¦‚æœç³»ç»Ÿå‘ç”Ÿâ€œåˆ†åŒºâ€ï¼Œæˆ‘ä»¬è¦è€ƒè™‘é€‰æ‹© CP è¿˜æ˜¯ APã€‚å¦‚æœç³»ç»Ÿæ²¡æœ‰å‘ç”Ÿâ€œåˆ†åŒºâ€çš„è¯ï¼Œæˆ‘ä»¬è¦æ€è€ƒå¦‚ä½•ä¿è¯ CA ã€‚\næ¨èé˜…è¯» # CAP å®šç†ç®€åŒ– ï¼ˆè‹±æ–‡ï¼Œæœ‰è¶£çš„æ¡ˆä¾‹ï¼‰ ç¥ä¸€æ ·çš„ CAP ç†è®ºè¢«åº”ç”¨åœ¨ä½•æ–¹ ï¼ˆä¸­æ–‡ï¼Œåˆ—ä¸¾äº†å¾ˆå¤šå®é™…çš„ä¾‹å­ï¼‰ è¯·åœæ­¢å‘¼å«æ•°æ®åº“ CP æˆ– AP ï¼ˆè‹±æ–‡ï¼Œå¸¦ç»™ä½ ä¸ä¸€æ ·çš„æ€è€ƒï¼‰ BASE ç†è®º # BASE ç†è®ºèµ·æºäº 2008 å¹´ï¼Œ ç”± eBay çš„æ¶æ„å¸ˆ Dan Pritchett åœ¨ ACM ä¸Šå‘è¡¨ã€‚\nç®€ä»‹ # BASE æ˜¯ Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ ã€Soft-stateï¼ˆè½¯çŠ¶æ€ï¼‰ å’Œ Eventually Consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™ã€‚BASE ç†è®ºæ˜¯å¯¹ CAP ä¸­ä¸€è‡´æ€§ C å’Œå¯ç”¨æ€§ A æƒè¡¡çš„ç»“æœï¼Œå…¶æ¥æºäºå¯¹å¤§è§„æ¨¡äº’è”ç½‘ç³»ç»Ÿåˆ†å¸ƒå¼å®è·µçš„æ€»ç»“ï¼Œæ˜¯åŸºäº CAP å®šç†é€æ­¥æ¼”åŒ–è€Œæ¥çš„ï¼Œå®ƒå¤§å¤§é™ä½äº†æˆ‘ä»¬å¯¹ç³»ç»Ÿçš„è¦æ±‚ã€‚\nBASE ç†è®ºçš„æ ¸å¿ƒæ€æƒ³ # å³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚\nä¹Ÿå°±æ˜¯ç‰ºç‰²æ•°æ®çš„ä¸€è‡´æ€§æ¥æ»¡è¶³ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ï¼Œç³»ç»Ÿä¸­ä¸€éƒ¨åˆ†æ•°æ®ä¸å¯ç”¨æˆ–è€…ä¸ä¸€è‡´æ—¶ï¼Œä»éœ€è¦ä¿æŒç³»ç»Ÿæ•´ä½“â€œä¸»è¦å¯ç”¨â€ã€‚\nBASE ç†è®ºæœ¬è´¨ä¸Šæ˜¯å¯¹ CAP çš„å»¶ä¼¸å’Œè¡¥å……ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯å¯¹ CAP ä¸­ AP æ–¹æ¡ˆçš„ä¸€ä¸ªè¡¥å……ã€‚\nä¸ºä»€ä¹ˆè¿™æ ·è¯´å‘¢ï¼Ÿ\nCAP ç†è®ºè¿™èŠ‚æˆ‘ä»¬ä¹Ÿè¯´è¿‡äº†ï¼š\nå¦‚æœç³»ç»Ÿæ²¡æœ‰å‘ç”Ÿâ€œåˆ†åŒºâ€çš„è¯ï¼ŒèŠ‚ç‚¹é—´çš„ç½‘ç»œè¿æ¥é€šä¿¡æ­£å¸¸çš„è¯ï¼Œä¹Ÿå°±ä¸å­˜åœ¨ P äº†ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥åŒæ—¶ä¿è¯ C å’Œ A äº†ã€‚å› æ­¤ï¼Œå¦‚æœç³»ç»Ÿå‘ç”Ÿâ€œåˆ†åŒºâ€ï¼Œæˆ‘ä»¬è¦è€ƒè™‘é€‰æ‹© CP è¿˜æ˜¯ APã€‚å¦‚æœç³»ç»Ÿæ²¡æœ‰å‘ç”Ÿâ€œåˆ†åŒºâ€çš„è¯ï¼Œæˆ‘ä»¬è¦æ€è€ƒå¦‚ä½•ä¿è¯ CA ã€‚\nå› æ­¤ï¼ŒAP æ–¹æ¡ˆåªæ˜¯åœ¨ç³»ç»Ÿå‘ç”Ÿåˆ†åŒºçš„æ—¶å€™æ”¾å¼ƒä¸€è‡´æ€§ï¼Œè€Œä¸æ˜¯æ°¸è¿œæ”¾å¼ƒä¸€è‡´æ€§ã€‚åœ¨åˆ†åŒºæ•…éšœæ¢å¤åï¼Œç³»ç»Ÿåº”è¯¥è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚è¿™ä¸€ç‚¹å…¶å®å°±æ˜¯ BASE ç†è®ºå»¶ä¼¸çš„åœ°æ–¹ã€‚\nBASE ç†è®ºä¸‰è¦ç´  # åŸºæœ¬å¯ç”¨ # åŸºæœ¬å¯ç”¨æ˜¯æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°ä¸å¯é¢„çŸ¥æ•…éšœçš„æ—¶å€™ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ã€‚ä½†æ˜¯ï¼Œè¿™ç»ä¸ç­‰ä»·äºç³»ç»Ÿä¸å¯ç”¨ã€‚\nä»€ä¹ˆå«å…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§å‘¢ï¼Ÿ\nå“åº”æ—¶é—´ä¸Šçš„æŸå¤±: æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¤„ç†ç”¨æˆ·è¯·æ±‚éœ€è¦ 0.5s è¿”å›ç»“æœï¼Œä½†æ˜¯ç”±äºç³»ç»Ÿå‡ºç°æ•…éšœï¼Œå¤„ç†ç”¨æˆ·è¯·æ±‚çš„æ—¶é—´å˜ä¸º 3 sã€‚ ç³»ç»ŸåŠŸèƒ½ä¸Šçš„æŸå¤±ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ç³»ç»Ÿçš„å…¨éƒ¨åŠŸèƒ½ï¼Œä½†æ˜¯ç”±äºç³»ç»Ÿè®¿é—®é‡çªç„¶å‰§å¢ï¼Œç³»ç»Ÿçš„éƒ¨åˆ†éæ ¸å¿ƒåŠŸèƒ½æ— æ³•ä½¿ç”¨ã€‚ è½¯çŠ¶æ€ # è½¯çŠ¶æ€æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼ˆCAP ç†è®ºä¸­çš„æ•°æ®ä¸ä¸€è‡´ï¼‰ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€çš„å­˜åœ¨ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿåœ¨ä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥çš„è¿‡ç¨‹å­˜åœ¨å»¶æ—¶ã€‚\næœ€ç»ˆä¸€è‡´æ€§ # æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œæœ€ç»ˆä¸€è‡´æ€§çš„æœ¬è´¨æ˜¯éœ€è¦ç³»ç»Ÿä¿è¯æœ€ç»ˆæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´ï¼Œè€Œä¸éœ€è¦å®æ—¶ä¿è¯ç³»ç»Ÿæ•°æ®çš„å¼ºä¸€è‡´æ€§ã€‚\nåˆ†å¸ƒå¼ä¸€è‡´æ€§çš„ 3 ç§çº§åˆ«ï¼š\nå¼ºä¸€è‡´æ€§ ï¼šç³»ç»Ÿå†™å…¥äº†ä»€ä¹ˆï¼Œè¯»å‡ºæ¥çš„å°±æ˜¯ä»€ä¹ˆã€‚ å¼±ä¸€è‡´æ€§ ï¼šä¸ä¸€å®šå¯ä»¥è¯»å–åˆ°æœ€æ–°å†™å…¥çš„å€¼ï¼Œä¹Ÿä¸ä¿è¯å¤šå°‘æ—¶é—´ä¹‹åè¯»å–åˆ°çš„æ•°æ®æ˜¯æœ€æ–°çš„ï¼Œåªæ˜¯ä¼šå°½é‡ä¿è¯æŸä¸ªæ—¶åˆ»è¾¾åˆ°æ•°æ®ä¸€è‡´çš„çŠ¶æ€ã€‚ æœ€ç»ˆä¸€è‡´æ€§ ï¼šå¼±ä¸€è‡´æ€§çš„å‡çº§ç‰ˆï¼Œç³»ç»Ÿä¼šä¿è¯åœ¨ä¸€å®šæ—¶é—´å†…è¾¾åˆ°æ•°æ®ä¸€è‡´çš„çŠ¶æ€ã€‚ ä¸šç•Œæ¯”è¾ƒæ¨å´‡æ˜¯æœ€ç»ˆä¸€è‡´æ€§çº§åˆ«ï¼Œä½†æ˜¯æŸäº›å¯¹æ•°æ®ä¸€è‡´è¦æ±‚ååˆ†ä¸¥æ ¼çš„åœºæ™¯æ¯”å¦‚é“¶è¡Œè½¬è´¦è¿˜æ˜¯è¦ä¿è¯å¼ºä¸€è‡´æ€§ã€‚\né‚£å®ç°æœ€ç»ˆä¸€è‡´æ€§çš„å…·ä½“æ–¹å¼æ˜¯ä»€ä¹ˆå‘¢? ã€Šåˆ†å¸ƒå¼åè®®ä¸ç®—æ³•å®æˆ˜ã€‹ ä¸­æ˜¯è¿™æ ·ä»‹ç»ï¼š\nè¯»æ—¶ä¿®å¤ : åœ¨è¯»å–æ•°æ®æ—¶ï¼Œæ£€æµ‹æ•°æ®çš„ä¸ä¸€è‡´ï¼Œè¿›è¡Œä¿®å¤ã€‚æ¯”å¦‚ Cassandra çš„ Read Repair å®ç°ï¼Œå…·ä½“æ¥è¯´ï¼Œåœ¨å‘ Cassandra ç³»ç»ŸæŸ¥è¯¢æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœæ£€æµ‹åˆ°ä¸åŒèŠ‚ç‚¹çš„å‰¯æœ¬æ•°æ®ä¸ä¸€è‡´ï¼Œç³»ç»Ÿå°±è‡ªåŠ¨ä¿®å¤æ•°æ®ã€‚ å†™æ—¶ä¿®å¤ : åœ¨å†™å…¥æ•°æ®ï¼Œæ£€æµ‹æ•°æ®çš„ä¸ä¸€è‡´æ—¶ï¼Œè¿›è¡Œä¿®å¤ã€‚æ¯”å¦‚ Cassandra çš„ Hinted Handoff å®ç°ã€‚å…·ä½“æ¥è¯´ï¼ŒCassandra é›†ç¾¤çš„èŠ‚ç‚¹ä¹‹é—´è¿œç¨‹å†™æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœå†™å¤±è´¥ å°±å°†æ•°æ®ç¼“å­˜ä¸‹æ¥ï¼Œç„¶åå®šæ—¶é‡ä¼ ï¼Œä¿®å¤æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚ å¼‚æ­¥ä¿®å¤ : è¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œé€šè¿‡å®šæ—¶å¯¹è´¦æ£€æµ‹å‰¯æœ¬æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¹¶ä¿®å¤ã€‚ æ¯”è¾ƒæ¨è å†™æ—¶ä¿®å¤ï¼Œè¿™ç§æ–¹å¼å¯¹æ€§èƒ½æ¶ˆè€—æ¯”è¾ƒä½ã€‚\næ€»ç»“ # ACID æ˜¯æ•°æ®åº“äº‹åŠ¡å®Œæ•´æ€§çš„ç†è®ºï¼ŒCAP æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ç†è®ºï¼ŒBASE æ˜¯ CAP ç†è®ºä¸­ AP æ–¹æ¡ˆçš„å»¶ä¼¸ã€‚\n"},{"id":91,"href":"/zh/docs/study/Review/java_guide/lybly_framework/MyBatis/principle/mybatis-principle3/","title":"MybatisåŸç†ç³»åˆ—(3)","section":"åŸç†","content":" è½¬è½½è‡ªhttps://www.jianshu.com/p/4e268828db48ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nè¿˜æ²¡çœ‹å®Œ\nåœ¨ä¸Šç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®²è§£äº†MyBatisçš„å¯åŠ¨æµç¨‹ï¼Œä»¥åŠå¯åŠ¨è¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„ç»„ä»¶ï¼Œåœ¨æœ¬ç¯‡æ–‡ä¸­ï¼Œæˆ‘ä»¬ç»§ç»­æ¢ç´¢SqlSession,SqlSessionFactory,SqlSessionFactoryBuilderçš„å…³ç³»ã€‚SqlSessionä½œä¸ºMyBatisçš„æ ¸å¿ƒç»„ä»¶ï¼Œå¯ä»¥è¯´MyBatisçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯å›´ç»•SqlSessionæ¥å±•å¼€çš„ã€‚å¯¹SqlSessionç†è§£é€å½»ï¼Œæ‰èƒ½å…¨é¢æŒæ¡MyBatisã€‚\n1. SqlSessionåˆè¯† # SqlSessionåœ¨ä¸€å¼€å§‹å°±ä»‹ç»è¿‡æ˜¯é«˜çº§æ¥å£ï¼Œç±»ä¼¼äºJDBCæ“ä½œçš„connectionå¯¹è±¡ï¼Œå®ƒåŒ…è£…äº†æ•°æ®åº“è¿æ¥ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£æˆ‘ä»¬å¯ä»¥å®ç°å¢åˆ æ”¹æŸ¥ï¼Œæäº¤/å›æ»šäº‹ç‰©ï¼Œå…³é—­è¿æ¥ï¼Œè·å–ä»£ç†ç±»ç­‰æ“ä½œã€‚SqlSessionæ˜¯ä¸ªæ¥å£ï¼Œå…¶é»˜è®¤å®ç°æ˜¯DefaultSqlSessionã€‚SqlSessionæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è‡ªå·±å”¯ä¸€çš„SqlSessionï¼Œä¸åŒçº¿ç¨‹é—´è°ƒç”¨åŒä¸€ä¸ªSqlSessionä¼šå‡ºç°é—®é¢˜ï¼Œå› æ­¤åœ¨ä½¿ç”¨å®Œåéœ€è¦closeæ‰ã€‚\nSqlSessionçš„æ–¹æ³•\n2. SqlSessionçš„åˆ›å»º # SqlSessionFactoryBuilderçš„build()æ–¹æ³•ä½¿ç”¨å»ºé€ è€…æ¨¡å¼åˆ›å»ºäº†SqlSessionFactoryæ¥å£å¯¹è±¡ï¼ŒSqlSessionFactoryæ¥å£çš„é»˜è®¤å®ç°æ˜¯DefaultSqlSessionFactoryã€‚SqlSessionFactoryä½¿ç”¨å®ä¾‹å·¥å‚æ¨¡å¼æ¥åˆ›å»ºSqlSessionå¯¹è±¡ã€‚SqlSession,SqlSessionFactory,SqlSessionFactoryBuilderçš„å…³ç³»å¦‚ä¸‹(å›¾ç”»å¾—æœ‰ç‚¹ä¸‘\u0026hellip;)ï¼š\nç±»å›¾\nDefaultSqlSessionFactoryä¸­openSessionæ˜¯æœ‰ä¸¤ç§æ–¹æ³•ä¸€ç§æ˜¯openSessionFromDataSourceï¼Œå¦ä¸€ç§æ˜¯openSessionFromConnectionã€‚è¿™ä¸¤ç§æ˜¯ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿä»å­—é¢æ„ä¹‰ä¸Šå°†ï¼Œä¸€ç§æ˜¯ä»æ•°æ®æºä¸­è·å–SqlSessionå¯¹è±¡ï¼Œä¸€ç§æ˜¯ç”±å·²æœ‰è¿æ¥è·å–SqlSessionã€‚SqlSessionå®é™…æ˜¯å¯¹æ•°æ®åº“è¿æ¥çš„ä¸€å±‚åŒ…è£…ï¼Œæ•°æ®åº“è¿æ¥æ˜¯ä¸ªçè´µçš„èµ„æºï¼Œå¦‚æœé¢‘ç¹çš„åˆ›å»ºé”€æ¯å°†ä¼šå½±å“ååé‡ï¼Œå› æ­¤ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± åŒ–æŠ€æœ¯å°±å¯ä»¥å¤ç”¨æ•°æ®åº“è¿æ¥äº†ã€‚å› æ­¤openSessionFromDataSourceä¼šä»æ•°æ®åº“è¿æ¥æ± ä¸­è·å–ä¸€ä¸ªè¿æ¥ï¼Œç„¶ååŒ…è£…æˆä¸€ä¸ªSqlSessionå¯¹åƒã€‚openSessionFromConnectionåˆ™æ˜¯ç›´æ¥åŒ…è£…å·²æœ‰çš„è¿æ¥å¹¶è¿”å›SqlSessionå¯¹åƒã€‚\nopenSessionFromDataSource ä¸»è¦ç»å†äº†ä»¥ä¸‹å‡ æ­¥ï¼š\nä»è·å–configurationä¸­è·å–Environmentå¯¹è±¡ï¼ŒEnvironmentåŒ…å«äº†æ•°æ®åº“é…ç½® ä»Environmentè·å–DataSourceæ•°æ®æº ä»DataSourceæ•°æ®æºä¸­è·å–Connectionè¿æ¥å¯¹è±¡ ä»DataSourceæ•°æ®æºä¸­è·å–TransactionFactoryäº‹ç‰©å·¥å‚ ä»TransactionFactoryä¸­åˆ›å»ºäº‹ç‰©Transactionå¯¹è±¡ åˆ›å»ºExecutorå¯¹è±¡ åŒ…è£…configurationå’ŒExecutorå¯¹è±¡æˆDefaultSqlSessionå¯¹è±¡ private SqlSession openSessionFromDataSource(ExecutorType execType, TransactionIsolationLevel level, boolean autoCommit) { Transaction tx = null; try { final Environment environment = configuration.getEnvironment(); final TransactionFactory transactionFactory = getTransactionFactoryFromEnvironment(environment); tx = transactionFactory.newTransaction(environment.getDataSource(), level, autoCommit); final Executor executor = configuration.newExecutor(tx, execType); return new DefaultSqlSession(configuration, executor, autoCommit); } catch (Exception e) { closeTransaction(tx); // may have fetched a connection so lets call close() throw ExceptionFactory.wrapException(\u0026#34;Error opening session. Cause: \u0026#34; + e, e); } finally { ErrorContext.instance().reset(); } } private SqlSession openSessionFromConnection(ExecutorType execType, Connection connection) { try { boolean autoCommit; try { autoCommit = connection.getAutoCommit(); } catch (SQLException e) { // Failover to true, as most poor drivers // or databases won\u0026#39;t support transactions autoCommit = true; } final Environment environment = configuration.getEnvironment(); final TransactionFactory transactionFactory = getTransactionFactoryFromEnvironment(environment); final Transaction tx = transactionFactory.newTransaction(connection); final Executor executor = configuration.newExecutor(tx, execType); return new DefaultSqlSession(configuration, executor, autoCommit); } catch (Exception e) { throw ExceptionFactory.wrapException(\u0026#34;Error opening session. Cause: \u0026#34; + e, e); } finally { ErrorContext.instance().reset(); } } 3. SqlSessionçš„ä½¿ç”¨ # SqlSession è·å–æˆåŠŸåï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å…¶ä¸­çš„æ–¹æ³•äº†ï¼Œæ¯”å¦‚ç›´æ¥ä½¿ç”¨SqlSessionå‘é€sqlè¯­å¥ï¼Œæˆ–è€…é€šè¿‡mapperæ˜ å°„æ–‡ä»¶çš„æ–¹å¼æ¥ä½¿ç”¨ï¼Œåœ¨ä¸Šä¸¤ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬éƒ½æ˜¯é€šè¿‡mapperæ˜ å°„æ–‡ä»¶æ¥ä½¿ç”¨çš„ï¼Œæ¥ä¸‹æ¥å°±ä»‹ç»ç¬¬ä¸€ç§ï¼Œç›´æ¥ä½¿ç”¨SqlSessionå‘é€sqlè¯­å¥ã€‚\npublic static void main(String[] args){ try { // 1. è¯»å–é…ç½® InputStream inputStream = Resources.getResourceAsStream(\u0026#34;mybatis-config.xml\u0026#34;); // 2. è·å–SqlSessionFactoryå¯¹è±¡ SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); // 3. è·å–SqlSessionå¯¹è±¡ SqlSession sqlSession = sqlSessionFactory.openSession(); // 4. æ‰§è¡Œsql TTestUser user = sqlSession.selectOne(\u0026#34;com.example.demo.dao.TTestUserMapper.selectByPrimaryKey\u0026#34;, 13L); log.info(\u0026#34;user = [{}]\u0026#34;, JSONUtil.toJsonStr(user)); // 5. å…³é—­è¿æ¥ sqlSession.close(); inputStream.close(); } catch (Exception e){ log.error(\u0026#34;errMsg = [{}]\u0026#34;, e.getMessage(), e); } } å…¶ä¸­com.example.demo.dao.TTestUserMapper.selectByPrimaryKeyæŒ‡å®šäº†TTestUserMapperä¸­selectByPrimaryKeyè¿™ä¸ªæ–¹æ³•ï¼Œåœ¨å¯¹åº”çš„mapper/TTestUserMapper.xmlæˆ‘ä»¬å®šä¹‰äº†idä¸€è‡´çš„sqlè¯­å¥\n\u0026lt;select id=\u0026#34;selectByPrimaryKey\u0026#34; parameterType=\u0026#34;java.lang.Long\u0026#34; resultMap=\u0026#34;BaseResultMap\u0026#34;\u0026gt; select \u0026lt;include refid=\u0026#34;Base_Column_List\u0026#34; /\u0026gt; from t_test_user where id = #{id,jdbcType=BIGINT} \u0026lt;/select\u0026gt; Mybatisä¼šåœ¨ä¸€å¼€å§‹åŠ è½½çš„æ—¶å€™å°†æ¯ä¸ªæ ‡ç­¾ä¸­çš„sqlè¯­å¥åŒ…è£…æˆMappedStatementå¯¹è±¡ï¼Œå¹¶ä»¥ç±»å…¨è·¯å¾„å+æ–¹æ³•åä¸ºkeyï¼ŒMappedStatementä¸ºvalueç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚åœ¨æ‰§è¡Œå¯¹åº”çš„æ–¹æ³•æ—¶ï¼Œå°±ä¼šæ ¹æ®è¿™ä¸ªå”¯ä¸€è·¯å¾„æ‰¾åˆ°TTestUserMapper.xmlè¿™æ¡sqlè¯­å¥å¹¶ä¸”æ‰§è¡Œè¿”å›ç»“æœã€‚\n4. SqlSessionçš„æ‰§è¡ŒåŸç† # 4. 1 SqlSessionçš„selectOneçš„æ‰§è¡ŒåŸç† # SqlSessionçš„selectOneä»£ç å¦‚ä¸‹ï¼Œå…¶å®æ˜¯è°ƒç”¨selectList()æ–¹æ³•è·å–ç¬¬ä¸€æ¡æ•°æ®çš„ã€‚å…¶ä¸­å‚æ•°statementå°±æ˜¯statementçš„idï¼Œparameterå°±æ˜¯å‚æ•°ã€‚\npublic \u0026lt;T\u0026gt; T selectOne(String statement, Object parameter) { List\u0026lt;T\u0026gt; list = this.selectList(statement, parameter); if (list.size() == 1) { return list.get(0); } else if (list.size() \u0026gt; 1) { throw new TooManyResultsException(\u0026#34;Expected one result (or null) to be returned by selectOne(), but found: \u0026#34; + list.size()); } else { return null; } } RowBounds å¯¹è±¡æ˜¯åˆ†é¡µå¯¹è±¡ï¼Œä¸»è¦æ‹¼æ¥sqlä¸­çš„start,limitæ¡ä»¶ã€‚å¹¶ä¸”å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªé‡è¦æ­¥éª¤ï¼š\nä»configurationçš„æˆå‘˜å˜é‡mappedStatementsä¸­è·å–MappedStatementå¯¹è±¡ã€‚mappedStatementsæ˜¯Map\u0026lt;String, MappedStatement\u0026gt;ç±»å‹çš„ç¼“å­˜ç»“æ„ï¼Œå…¶ä¸­keyå°±æ˜¯mapperæ¥å£å…¨ç±»å+æ–¹æ³•åï¼ŒMappedStatementå°±æ˜¯å¯¹æ ‡ç­¾ä¸­é…ç½®çš„sqlä¸€ä¸ªåŒ…è£… ä½¿ç”¨executoræˆå‘˜å˜é‡æ¥æ‰§è¡ŒæŸ¥è¯¢å¹¶ä¸”æŒ‡å®šç»“æœå¤„ç†å™¨ï¼Œå¹¶ä¸”è¿”å›ç»“æœã€‚Executorä¹Ÿæ˜¯mybatisçš„ä¸€ä¸ªé‡è¦çš„ç»„ä»¶ã€‚sqlçš„æ‰§è¡Œéƒ½æ˜¯ç”±Executorå¯¹è±¡æ¥æ“ä½œçš„ã€‚ public \u0026lt;E\u0026gt; List\u0026lt;E\u0026gt; selectList(String statement, Object parameter, RowBounds rowBounds) { List var5; try { MappedStatement ms = this.configuration.getMappedStatement(statement); var5 = this.executor.query(ms, this.wrapCollection(parameter), rowBounds, Executor.NO_RESULT_HANDLER); } catch (Exception var9) { throw ExceptionFactory.wrapException(\u0026#34;Error querying database. Cause: \u0026#34; + var9, var9); } finally { ErrorContext.instance().reset(); } return var5; } MappedStatementå¯¹è±¡çš„å…·ä½“å†…å®¹å’ŒExecutorå¯¹è±¡çš„ç±»å‹ï¼Œæˆ‘ä»¬å°†åœ¨å…¶å®ƒæ–‡ç« ä¸­è¯¦è¿°ã€‚\n4. 2 SqlSessionçš„é€šè¿‡mapperå¯¹è±¡ä½¿ç”¨çš„æ‰§è¡ŒåŸç† # åœ¨å¯åŠ¨æµç¨‹é‚£ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å¤§è‡´äº†è§£äº†sqlSession.getMapperè¿”å›çš„å…¶å®æ˜¯ä¸ªä»£ç†ç±»MapperProxyï¼Œç„¶åè°ƒmapperæ¥å£çš„æ–¹æ³•å…¶å®éƒ½æ˜¯è°ƒç”¨MapperProxyçš„invokeæ–¹æ³•ï¼Œè¿›è€Œè°ƒç”¨MapperMethodçš„executeæ–¹æ³•ã€‚\npublic static void main(String[] args) { try { // 1. è¯»å–é…ç½® InputStream inputStream = Resources.getResourceAsStream(\u0026#34;mybatis-config.xml\u0026#34;); // 2. åˆ›å»ºSqlSessionFactoryå·¥å‚ SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); // 3. è·å–sqlSession SqlSession sqlSession = sqlSessionFactory.openSession(); // 4. è·å–Mapper TTestUserMapper userMapper = sqlSession.getMapper(TTestUserMapper.class); // 5. æ‰§è¡Œæ¥å£æ–¹æ³• TTestUser userInfo = userMapper.selectByPrimaryKey(16L); System.out.println(\u0026#34;userInfo = \u0026#34; + JSONUtil.toJsonStr(userInfo)); // 6. æäº¤äº‹ç‰© sqlSession.commit(); // 7. å…³é—­èµ„æº sqlSession.close(); inputStream.close(); } catch (Exception e){ log.error(e.getMessage(), e); } } MapperMethodçš„executeæ–¹æ³•ä¸­ä½¿ç”¨å‘½ä»¤æ¨¡å¼è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œï¼Œå…¶å®ä¹Ÿæ˜¯è°ƒç”¨äº†sqlSessionçš„å¢åˆ æ”¹æŸ¥æ–¹æ³•ã€‚\npublic Object execute(SqlSession sqlSession, Object[] args) { Object result; switch (command.getType()) { case INSERT: { Object param = method.convertArgsToSqlCommandParam(args); result = rowCountResult(sqlSession.insert(command.getName(), param)); break; } case UPDATE: { Object param = method.convertArgsToSqlCommandParam(args); result = rowCountResult(sqlSession.update(command.getName(), param)); break; } case DELETE: { Object param = method.convertArgsToSqlCommandParam(args); result = rowCountResult(sqlSession.delete(command.getName(), param)); break; } case SELECT: if (method.returnsVoid() \u0026amp;\u0026amp; method.hasResultHandler()) { executeWithResultHandler(sqlSession, args); result = null; } else if (method.returnsMany()) { result = executeForMany(sqlSession, args); } else if (method.returnsMap()) { result = executeForMap(sqlSession, args); } else if (method.returnsCursor()) { result = executeForCursor(sqlSession, args); } else { Object param = method.convertArgsToSqlCommandParam(args); result = sqlSession.selectOne(command.getName(), param); if (method.returnsOptional() \u0026amp;\u0026amp; (result == null || !method.getReturnType().equals(result.getClass()))) { result = Optional.ofNullable(result); } } break; case FLUSH: result = sqlSession.flushStatements(); break; default: throw new BindingException(\u0026#34;Unknown execution method for: \u0026#34; + command.getName()); } if (result == null \u0026amp;\u0026amp; method.getReturnType().isPrimitive() \u0026amp;\u0026amp; !method.returnsVoid()) { throw new BindingException(\u0026#34;Mapper method \u0026#39;\u0026#34; + command.getName() + \u0026#34; attempted to return null from a method with a primitive return type (\u0026#34; + method.getReturnType() + \u0026#34;).\u0026#34;); } return result; } æ€»ç»“ # åœ¨è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬è¯¦ç»†ä»‹ç»äº†SqlSessionçš„ä½œç”¨ï¼Œåˆ›å»ºè¿‡ç¨‹ï¼Œä½¿ç”¨æ–¹æ³•ï¼Œä»¥åŠæ‰§è¡ŒåŸç†ç­‰ï¼Œå¯¹SqlSessionå·²ç»æœ‰äº†æ¯”è¾ƒå…¨é¢çš„äº†è§£ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„Executorå¯¹è±¡ï¼ŒMappedStatementå¯¹è±¡ï¼ŒResultHandleræˆ‘ä»¬å°†åœ¨å…¶å®ƒæ–‡ç« ä¸­è®²è§£ã€‚æ¬¢è¿åœ¨è¯„è®ºåŒºä¸­è®¨è®ºæŒ‡æ­£ï¼Œä¸€èµ·è¿›æ­¥ã€‚\n"},{"id":92,"href":"/zh/docs/study/Review/java_guide/lybly_framework/MyBatis/principle/mybatis-principle2/","title":"MybatisåŸç†ç³»åˆ—(2)","section":"åŸç†","content":" è½¬è½½è‡ªhttps://www.jianshu.com/p/7d6b891180a3ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nåœ¨ä¸Šç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¸¾äº†ä¸€ä¸ªä¾‹å­å¦‚ä½•ä½¿ç”¨MyBatisï¼Œä½†æ˜¯å¯¹å…¶ä¸­daoå±‚ï¼Œentityå±‚ï¼Œmapperå±‚é—´çš„å…³ç³»ä¸å¾—è€ŒçŸ¥ï¼Œä»æ­¤ç¯‡æ–‡ç« å¼€å§‹ï¼Œç¬”è€…å°†ä»MyBatisçš„å¯åŠ¨æµç¨‹ç€æ‰‹ï¼ŒçœŸæ­£çš„å¼€å§‹ç ”ç©¶MyBatisæºç äº†ã€‚\n1. MyBatiså¯åŠ¨ä»£ç ç¤ºä¾‹ # åœ¨ä¸Šç¯‡æ–‡ç« ä¸­ï¼Œä»‹ç»äº†MyBatisçš„ç›¸å…³é…ç½®å’Œå„å±‚ä»£ç ç¼–å†™ï¼Œæœ¬æ–‡å°†ä»¥ä¸‹ä»£ç å±•å¼€æè¿°å’Œä»‹ç»MyBatisçš„å¯åŠ¨æµç¨‹ï¼Œå¹¶ç®€ç•¥çš„ä»‹ç»å„ä¸ªæ¨¡å—çš„ä½œç”¨ï¼Œå„ä¸ªæ¨¡å—çš„ç»†èŠ‚éƒ¨åˆ†å°†åœ¨å…¶å®ƒæ–‡ç« ä¸­å‘ˆç°ã€‚\nå›é¡¾ä¸‹ä¸Šæ–‡ä¸­ä½¿ç”¨mybatisçš„éƒ¨åˆ†ä»£ç ï¼ŒåŒ…æ‹¬ä¸ƒæ­¥ã€‚æ¯æ­¥è™½ç„¶éƒ½æ˜¯ä¸€è¡Œä»£ç ï¼Œä½†æ˜¯éšè—äº†å¾ˆå¤šç»†èŠ‚ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†å›´ç»•è¿™èµ·æ­¥å±•å¼€äº†è§£ã€‚\n@Slf4j public class MyBatisBootStrap { public static void main(String[] args) { try { // 1. è¯»å–é…ç½® InputStream inputStream = Resources.getResourceAsStream(\u0026#34;mybatis-config.xml\u0026#34;); // 2. åˆ›å»ºSqlSessionFactoryå·¥å‚ SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); // 3. è·å–sqlSession SqlSession sqlSession = sqlSessionFactory.openSession(); // 4. è·å–Mapper TTestUserMapper userMapper = sqlSession.getMapper(TTestUserMapper.class); // 5. æ‰§è¡Œæ¥å£æ–¹æ³• TTestUser userInfo = userMapper.selectByPrimaryKey(16L); System.out.println(\u0026#34;userInfo = \u0026#34; + JSONUtil.toJsonStr(userInfo)); // 6. æäº¤äº‹ç‰© sqlSession.commit(); // 7. å…³é—­èµ„æº sqlSession.close(); inputStream.close(); } catch (Exception e){ log.error(e.getMessage(), e); } } } 2. è¯»å–é…ç½® # // 1. è¯»å–é…ç½® InputStream inputStream = Resources.getResourceAsStream(\u0026#34;mybatis-config.xml\u0026#34;); åœ¨mybatis-config.xmlä¸­æˆ‘ä»¬é…ç½®äº†å±æ€§ï¼Œç¯å¢ƒï¼Œæ˜ å°„æ–‡ä»¶è·¯å¾„ç­‰ï¼Œå…¶å®ä¸ä»…å¯ä»¥é…ç½®ä»¥ä¸Šå†…å®¹ï¼Œè¿˜å¯ä»¥é…ç½®æ’ä»¶ï¼Œåå°„å·¥å‚ï¼Œç±»å‹å¤„ç†å™¨ç­‰ç­‰å…¶å®ƒå†…å®¹ã€‚åœ¨å¯åŠ¨æµç¨‹ä¸­çš„ç¬¬ä¸€æ­¥æˆ‘ä»¬å°±éœ€è¦è¯»å–è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¹¶è·å–ä¸€ä¸ªè¾“å…¥æµä¸ºä¸‹ä¸€æ­¥è§£æé…ç½®æ–‡ä»¶ä½œå‡†å¤‡ã€‚\nmybatis-config.xml å†…å®¹å¦‚ä¸‹\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34; ?\u0026gt; \u0026lt;!DOCTYPE configuration PUBLIC \u0026#34;-//mybatis.org//DTD Config 3.0//EN\u0026#34; \u0026#34;http://mybatis.org/dtd/mybatis-3-config.dtd\u0026#34;\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;!--ä¸€äº›é‡è¦çš„å…¨å±€é…ç½®--\u0026gt; \u0026lt;settings\u0026gt; \u0026lt;setting name=\u0026#34;cacheEnabled\u0026#34; value=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;lazyLoadingEnabled\u0026#34; value=\u0026#34;true\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;multipleResultSetsEnabled\u0026#34; value=\u0026#34;true\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;useColumnLabel\u0026#34; value=\u0026#34;true\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;useGeneratedKeys\u0026#34; value=\u0026#34;false\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;autoMappingBehavior\u0026#34; value=\u0026#34;PARTIAL\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;autoMappingUnknownColumnBehavior\u0026#34; value=\u0026#34;WARNING\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;defaultExecutorType\u0026#34; value=\u0026#34;SIMPLE\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;defaultStatementTimeout\u0026#34; value=\u0026#34;25\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;defaultFetchSize\u0026#34; value=\u0026#34;100\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;safeRowBoundsEnabled\u0026#34; value=\u0026#34;false\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;mapUnderscoreToCamelCase\u0026#34; value=\u0026#34;false\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;localCacheScope\u0026#34; value=\u0026#34;STATEMENT\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;jdbcTypeForNull\u0026#34; value=\u0026#34;OTHER\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;lazyLoadTriggerMethods\u0026#34; value=\u0026#34;equals,clone,hashCode,toString\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;logImpl\u0026#34; value=\u0026#34;STDOUT_LOGGING\u0026#34; /\u0026gt;--\u0026gt; \u0026lt;/settings\u0026gt; \u0026lt;environments default=\u0026#34;development\u0026#34;\u0026gt; \u0026lt;environment id=\u0026#34;development\u0026#34;\u0026gt; \u0026lt;transactionManager type=\u0026#34;JDBC\u0026#34;/\u0026gt; \u0026lt;dataSource type=\u0026#34;POOLED\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;driver\u0026#34; value=\u0026#34;com.mysql.cj.jdbc.Driver\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;url\u0026#34; value=\u0026#34;jdbc:mysql://10.255.0.50:3306/volvo_bev?useUnicode=true\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;username\u0026#34; value=\u0026#34;appdev\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;password\u0026#34; value=\u0026#34;FEGwo3EzsdDYS9ooYKGCjRQepkwG\u0026#34;/\u0026gt; \u0026lt;/dataSource\u0026gt; \u0026lt;/environment\u0026gt; \u0026lt;/environments\u0026gt; \u0026lt;mappers\u0026gt; \u0026lt;!--è¿™è¾¹å¯ä»¥ä½¿ç”¨packageå’Œresourceä¸¤ç§æ–¹å¼åŠ è½½mapper--\u0026gt; \u0026lt;!--\u0026lt;package name=\u0026#34;åŒ…å\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;mapper resource=\u0026#34;./mappers/SysUserMapper.xml\u0026#34;/\u0026gt; \u0026lt;package name=\u0026#34;com.example.demo.dao\u0026#34;/\u0026gt; --\u0026gt; \u0026lt;mapper resource=\u0026#34;./mapper/TTestUserMapper.xml\u0026#34;/\u0026gt; \u0026lt;/mappers\u0026gt; \u0026lt;/configuration\u0026gt; 3. åˆ›å»ºSqlSessionFactoryå·¥å‚ # SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); æˆ‘ä»¬åœ¨å­¦ä¹ Javaçš„è®¾è®¡æ¨¡å¼æ—¶ï¼Œä¼šå­¦åˆ°å·¥å‚æ¨¡å¼ï¼Œå·¥å‚æ¨¡å¼åˆåˆ†ä¸ºç®€å•å·¥å‚æ¨¡å¼ï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼ç­‰ç­‰ã€‚å·¥å‚æ¨¡å¼å°±æ˜¯ä¸ºäº†åˆ›å»ºå¯¹è±¡æä¾›æ¥å£ï¼Œå¹¶å°†åˆ›å»ºå¯¹è±¡çš„å…·ä½“ç»†èŠ‚å±è”½èµ·æ¥ï¼Œä»è€Œå¯ä»¥æé«˜çµæ´»æ€§ã€‚\npublic interface SqlSessionFactory { SqlSession openSession(); SqlSession openSession(boolean autoCommit); SqlSession openSession(Connection connection); SqlSession openSession(TransactionIsolationLevel level); SqlSession openSession(ExecutorType execType); SqlSession openSession(ExecutorType execType, boolean autoCommit); SqlSession openSession(ExecutorType execType, TransactionIsolationLevel level); SqlSession openSession(ExecutorType execType, Connection connection); Configuration getConfiguration(); } ç”±æ­¤å¯çŸ¥SqlSessionFactoryå·¥å‚æ˜¯ä¸ºäº†åˆ›å»ºä¸€ä¸ªå¯¹è±¡è€Œç”Ÿçš„ï¼Œå…¶äº§å‡ºçš„å¯¹è±¡å°±æ˜¯SqlSessionå¯¹è±¡ã€‚SqlSessionæ˜¯MyBatisé¢å‘æ•°æ®åº“çš„é«˜çº§æ¥å£ï¼Œå…¶æä¾›äº†æ‰§è¡ŒæŸ¥è¯¢sqlï¼Œæ›´æ–°sqlï¼Œæäº¤äº‹ç‰©ï¼Œå›æ»šäº‹ç‰©ï¼Œ**è·å–æ˜ å°„ä»£ç†ç±»(ä¹Ÿå°±æ˜¯Mapper)**ç­‰ç­‰æ–¹æ³•ã€‚\nåœ¨æ­¤ç¬”è€…åˆ—å‡ºäº†ä¸»è¦æ–¹æ³•ï¼Œä¸€äº›é‡è½½çš„æ–¹æ³•å°±è¿‡æ»¤æ‰äº†ã€‚\npublic interface SqlSession extends Closeable { /** * æŸ¥è¯¢ä¸€ä¸ªç»“æœå¯¹è±¡ **/ \u0026lt;T\u0026gt; T selectOne(String statement, Object parameter); /** * æŸ¥è¯¢ä¸€ä¸ªç»“æœé›†åˆ **/ \u0026lt;E\u0026gt; List\u0026lt;E\u0026gt; selectList(String statement, Object parameter, RowBounds rowBounds); /** * æŸ¥è¯¢ä¸€ä¸ªmap **/ \u0026lt;K, V\u0026gt; Map\u0026lt;K, V\u0026gt; selectMap(String statement, Object parameter, String mapKey, RowBounds rowBounds); /** * æŸ¥è¯¢æ¸¸æ ‡ **/ \u0026lt;T\u0026gt; Cursor\u0026lt;T\u0026gt; selectCursor(String statement, Object parameter, RowBounds rowBounds); void select(String statement, Object parameter, RowBounds rowBounds, ResultHandler handler); /** * æ’å…¥ **/ int insert(String statement, Object parameter); /** * ä¿®æ”¹ **/ int update(String statement, Object parameter); /** * åˆ é™¤ **/ int delete(String statement, Object parameter); /** * æäº¤äº‹ç‰© **/ void commit(boolean force); /** * å›æ»šäº‹ç‰© **/ void rollback(boolean force); List\u0026lt;BatchResult\u0026gt; flushStatements(); void close(); void clearCache(); Configuration getConfiguration(); /** * è·å–æ˜ å°„ä»£ç†ç±» **/ \u0026lt;T\u0026gt; T getMapper(Class\u0026lt;T\u0026gt; type); /** * è·å–æ•°æ®åº“è¿æ¥ **/ Connection getConnection(); } å›åˆ°å¼€å§‹ï¼ŒSqlSessionFactoryå·¥å‚æ˜¯æ€ä¹ˆåˆ›å»ºçš„å‡ºæ¥çš„å‘¢ï¼ŸSqlSessionFactoryBuilderå°±æ˜¯åˆ›å»ºè€…ï¼Œä»¥Builderç»“å°¾æˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°äº†Javaè®¾è®¡æ¨¡å¼ä¸­çš„å»ºé€ è€…æ¨¡å¼ï¼Œä¸€ä¸ªå¯¹è±¡çš„åˆ›å»ºæ˜¯ç”±ä¼—å¤šå¤æ‚å¯¹è±¡ç»„æˆçš„ï¼Œå»ºé€ è€…æ¨¡å¼å°±æ˜¯ä¸€ä¸ªåˆ›å»ºå¤æ‚å¯¹è±¡çš„é€‰æ‹©ï¼Œå®ƒä¸å·¥å‚æ¨¡å¼ç›¸æ¯”ï¼Œå»ºé€ è€…æ¨¡å¼æ›´åŠ å…³æ³¨é›¶ä»¶è£…é…çš„é¡ºåºã€‚\npublic class SqlSessionFactoryBuilder { public SqlSessionFactory build(InputStream inputStream, String environment, Properties properties) { try { XMLConfigBuilder parser = new XMLConfigBuilder(inputStream, environment, properties); return build(parser.parse()); } catch (Exception e) { throw ExceptionFactory.wrapException(\u0026#34;Error building SqlSession.\u0026#34;, e); } finally { ErrorContext.instance().reset(); try { inputStream.close(); } catch (IOException e) { // Intentionally ignore. Prefer previous error. } } } } å…¶ä¸­XMLConfigBuilderå°±æ˜¯è§£æmybatis-config.xmlä¸­æ¯ä¸ªæ ‡ç­¾çš„å†…å®¹ï¼Œparse()æ–¹æ³•è¿”å›çš„å°±æ˜¯ä¸€ä¸ªConfigurationå¯¹è±¡.Configurationä¹Ÿæ˜¯MyBatisä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„ç»„ä»¶ï¼ŒåŒ…æ‹¬æ’ä»¶ï¼Œå¯¹è±¡å·¥å‚ï¼Œåå°„å·¥å‚ï¼Œæ˜ å°„æ–‡ä»¶ï¼Œç±»å‹è§£æå™¨ç­‰ç­‰éƒ½å­˜å‚¨åœ¨Configurationå¯¹è±¡ä¸­ã€‚\npublic Configuration parse() { if (parsed) { throw new BuilderException(\u0026#34;Each XMLConfigBuilder can only be used once.\u0026#34;); } parsed = true; parseConfiguration(parser.evalNode(\u0026#34;/configuration\u0026#34;)); return configuration; } private void parseConfiguration(XNode root) { try { // issue #117 read properties first // è§£æpropertiesèŠ‚ç‚¹ propertiesElement(root.evalNode(\u0026#34;properties\u0026#34;)); Properties settings = settingsAsProperties(root.evalNode(\u0026#34;settings\u0026#34;)); loadCustomVfs(settings); loadCustomLogImpl(settings); typeAliasesElement(root.evalNode(\u0026#34;typeAliases\u0026#34;)); pluginElement(root.evalNode(\u0026#34;plugins\u0026#34;)); objectFactoryElement(root.evalNode(\u0026#34;objectFactory\u0026#34;)); objectWrapperFactoryElement(root.evalNode(\u0026#34;objectWrapperFactory\u0026#34;)); reflectorFactoryElement(root.evalNode(\u0026#34;reflectorFactory\u0026#34;)); settingsElement(settings); // read it after objectFactory and objectWrapperFactory issue #631 environmentsElement(root.evalNode(\u0026#34;environments\u0026#34;)); databaseIdProviderElement(root.evalNode(\u0026#34;databaseIdProvider\u0026#34;)); typeHandlerElement(root.evalNode(\u0026#34;typeHandlers\u0026#34;)); mapperElement(root.evalNode(\u0026#34;mappers\u0026#34;)); } catch (Exception e) { throw new BuilderException(\u0026#34;Error parsing SQL Mapper Configuration. Cause: \u0026#34; + e, e); } } åœ¨è·å–åˆ°Configurationå¯¹è±¡åï¼ŒSqlSessionFactoryBuilderå°±ä¼šåˆ›å»ºä¸€ä¸ªDefaultSqlSessionFactoryå¯¹è±¡ï¼ŒDefaultSqlSessionFactoryæ˜¯SqlSessionFactoryçš„ä¸€ä¸ªé»˜è®¤å®ç°ï¼Œè¿˜æœ‰ä¸€ä¸ªå®ç°æ˜¯SqlSessionManagerã€‚\npublic SqlSessionFactory build(Configuration config) { return new DefaultSqlSessionFactory(config); } 4. è·å–sqlSession # // 3. è·å–sqlSession SqlSession sqlSession = sqlSessionFactory.openSession(); åœ¨å‰é¢æˆ‘ä»¬è®²åˆ°ï¼ŒsqlSessionæ˜¯æ“ä½œæ•°æ®åº“çš„é«˜çº§æ¥å£ï¼Œæˆ‘ä»¬æ“ä½œæ•°æ®åº“éƒ½æ˜¯é€šè¿‡è¿™ä¸ªæ¥å£æ“ä½œçš„ã€‚è·å–sqlSessionæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ä»æ•°æ®æºä¸­è·å–çš„ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ä»è¿æ¥ä¸­è·å–ã€‚\nè²Œä¼¼é»˜è®¤æ˜¯ä»æ•°æ®æºè·å–\nè·å–åˆ°çš„éƒ½æ˜¯DefaultSqlSessionå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯sqlSessionçš„é»˜è®¤å®ç°ã€‚\næ³¨æ„ï¼Œè¿‡ç¨‹ä¸­æœ‰ä¸ªExecutor\u0026mdash;æ‰§è¡Œå™¨\nprivate SqlSession openSessionFromDataSource(ExecutorType execType, TransactionIsolationLevel level, boolean autoCommit) { Transaction tx = null; try { final Environment environment = configuration.getEnvironment(); final TransactionFactory transactionFactory = getTransactionFactoryFromEnvironment(environment); tx = transactionFactory.newTransaction(environment.getDataSource(), level, autoCommit); final Executor executor = configuration.newExecutor(tx, execType); return new DefaultSqlSession(configuration, executor, autoCommit); } catch (Exception e) { closeTransaction(tx); // may have fetched a connection so lets call close() throw ExceptionFactory.wrapException(\u0026#34;Error opening session. Cause: \u0026#34; + e, e); } finally { ErrorContext.instance().reset(); } } private SqlSession openSessionFromConnection(ExecutorType execType, Connection connection) { try { boolean autoCommit; try { autoCommit = connection.getAutoCommit(); } catch (SQLException e) { // Failover to true, as most poor drivers // or databases won\u0026#39;t support transactions autoCommit = true; } final Environment environment = configuration.getEnvironment(); final TransactionFactory transactionFactory = getTransactionFactoryFromEnvironment(environment); final Transaction tx = transactionFactory.newTransaction(connection); final Executor executor = configuration.newExecutor(tx, execType); return new DefaultSqlSession(configuration, executor, autoCommit); } catch (Exception e) { throw ExceptionFactory.wrapException(\u0026#34;Error opening session. Cause: \u0026#34; + e, e); } finally { ErrorContext.instance().reset(); } } è·å–SqlSessionæ­¥éª¤\n5. è·å–Mapperä»£ç†ç±» # åœ¨ä¸Šä¸€æ­¥è·å–åˆ°sqlSessionåï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±è·å–åˆ°äº†mapperä»£ç†ç±»ã€‚\n// 4. è·å–Mapper TTestUserMapper userMapper = sqlSession.getMapper(TTestUserMapper.class); è¿™ä¸ªgetMapperæ–¹æ³•ï¼Œæˆ‘ä»¬çœ‹çœ‹DefaultSqlSessionæ˜¯æ€ä¹ˆåšçš„\nDefaultSqlSession çš„ getMapper æ–¹æ³•\npublic \u0026lt;T\u0026gt; T getMapper(Class\u0026lt;T\u0026gt; type) { return this.configuration.getMapper(type, this); } Configuration çš„ getMapper æ–¹æ³•\npublic \u0026lt;T\u0026gt; T getMapper(Class\u0026lt;T\u0026gt; type, SqlSession sqlSession) { return this.mapperRegistry.getMapper(type, sqlSession); } MapperRegistry ä¸­æœ‰ä¸ªgetMapperæ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯ä»æˆå‘˜å˜é‡knownMappersä¸­è·å–çš„ï¼Œè¿™ä¸ªknownMappersæ˜¯ä¸ªkey-valueå½¢å¼çš„ç¼“å­˜ï¼Œkeyæ˜¯mapperæ¥å£çš„classå¯¹è±¡ï¼Œvalueæ˜¯MapperProxyFactoryä»£ç†å·¥å‚ï¼Œè¿™ä¸ªå·¥å‚å°±æ˜¯ç”¨æ¥åˆ›å»ºMapperProxyä»£ç†ç±»çš„ã€‚\npublic class MapperRegistry { private final Configuration config; private final Map\u0026lt;Class\u0026lt;?\u0026gt;, MapperProxyFactory\u0026lt;?\u0026gt;\u0026gt; knownMappers = new HashMap(); public MapperRegistry(Configuration config) { this.config = config; } public \u0026lt;T\u0026gt; T getMapper(Class\u0026lt;T\u0026gt; type, SqlSession sqlSession) { MapperProxyFactory\u0026lt;T\u0026gt; mapperProxyFactory = (MapperProxyFactory)this.knownMappers.get(type); if (mapperProxyFactory == null) { throw new BindingException(\u0026#34;Type \u0026#34; + type + \u0026#34; is not known to the MapperRegistry.\u0026#34;); } else { try { return mapperProxyFactory.newInstance(sqlSession); } catch (Exception var5) { throw new BindingException(\u0026#34;Error getting mapper instance. Cause: \u0026#34; + var5, var5); } } } } å¦‚æœå¯¹javaåŠ¨æ€ä»£ç†äº†è§£çš„åŒå­¦å°±çŸ¥é“ï¼ŒProxy.newProxyInstance()æ–¹æ³•å¯ä»¥åˆ›å»ºå‡ºä¸€ä¸ªç›®æ ‡å¯¹è±¡ä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚ç”±æ­¤å¯çŸ¥æ¯æ¬¡è°ƒç”¨getMapperæ–¹æ³•éƒ½ä¼šåˆ›å»ºå‡ºä¸€ä¸ªä»£ç†ç±»å‡ºæ¥ã€‚\npublic class MapperProxyFactory\u0026lt;T\u0026gt; { private final Class\u0026lt;T\u0026gt; mapperInterface; private final Map\u0026lt;Method, MapperMethod\u0026gt; methodCache = new ConcurrentHashMap(); public MapperProxyFactory(Class\u0026lt;T\u0026gt; mapperInterface) { this.mapperInterface = mapperInterface; } public Class\u0026lt;T\u0026gt; getMapperInterface() { return this.mapperInterface; } public Map\u0026lt;Method, MapperMethod\u0026gt; getMethodCache() { return this.methodCache; } protected T newInstance(MapperProxy\u0026lt;T\u0026gt; mapperProxy) { return Proxy.newProxyInstance(this.mapperInterface.getClassLoader(), new Class[]{this.mapperInterface}, mapperProxy); } public T newInstance(SqlSession sqlSession) { MapperProxy\u0026lt;T\u0026gt; mapperProxy = new MapperProxy(sqlSession, this.mapperInterface, this.methodCache); return this.newInstance(mapperProxy); } } å›åˆ°ä¸Šé¢ï¼Œé‚£è¿™ä¸ªMapperProxyFactoryæ˜¯æ€ä¹ˆåŠ è½½åˆ°MapperRegistryçš„knownMappersç¼“å­˜ä¸­çš„å‘¢ï¼Ÿ\nåœ¨ä¸Šé¢çš„Configurationç±»çš„parseConfigurationæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¼šè§£æ mappersæ ‡ç­¾ï¼ŒmapperElementæ–¹æ³•å°±ä¼šè§£æmapperæ¥å£ã€‚\nprivate void parseConfiguration(XNode root) { try { // issue #117 read properties first // è§£æpropertiesèŠ‚ç‚¹ propertiesElement(root.evalNode(\u0026#34;properties\u0026#34;)); Properties settings = settingsAsProperties(root.evalNode(\u0026#34;settings\u0026#34;)); loadCustomVfs(settings); loadCustomLogImpl(settings); typeAliasesElement(root.evalNode(\u0026#34;typeAliases\u0026#34;)); pluginElement(root.evalNode(\u0026#34;plugins\u0026#34;)); objectFactoryElement(root.evalNode(\u0026#34;objectFactory\u0026#34;)); objectWrapperFactoryElement(root.evalNode(\u0026#34;objectWrapperFactory\u0026#34;)); reflectorFactoryElement(root.evalNode(\u0026#34;reflectorFactory\u0026#34;)); settingsElement(settings); // read it after objectFactory and objectWrapperFactory issue #631 environmentsElement(root.evalNode(\u0026#34;environments\u0026#34;)); databaseIdProviderElement(root.evalNode(\u0026#34;databaseIdProvider\u0026#34;)); typeHandlerElement(root.evalNode(\u0026#34;typeHandlers\u0026#34;)); mapperElement(root.evalNode(\u0026#34;mappers\u0026#34;)); } catch (Exception e) { throw new BuilderException(\u0026#34;Error parsing SQL Mapper Configuration. Cause: \u0026#34; + e, e); } } private void mapperElement(XNode parent) throws Exception { if (parent != null) { for (XNode child : parent.getChildren()) { if (\u0026#34;package\u0026#34;.equals(child.getName())) { String mapperPackage = child.getStringAttribute(\u0026#34;name\u0026#34;); configuration.addMappers(mapperPackage); } else { String resource = child.getStringAttribute(\u0026#34;resource\u0026#34;); String url = child.getStringAttribute(\u0026#34;url\u0026#34;); String mapperClass = child.getStringAttribute(\u0026#34;class\u0026#34;); if (resource != null \u0026amp;\u0026amp; url == null \u0026amp;\u0026amp; mapperClass == null) { ErrorContext.instance().resource(resource); InputStream inputStream = Resources.getResourceAsStream(resource); XMLMapperBuilder mapperParser = new XMLMapperBuilder(inputStream, configuration, resource, configuration.getSqlFragments()); mapperParser.parse(); } else if (resource == null \u0026amp;\u0026amp; url != null \u0026amp;\u0026amp; mapperClass == null) { ErrorContext.instance().resource(url); InputStream inputStream = Resources.getUrlAsStream(url); XMLMapperBuilder mapperParser = new XMLMapperBuilder(inputStream, configuration, url, configuration.getSqlFragments()); mapperParser.parse(); } else if (resource == null \u0026amp;\u0026amp; url == null \u0026amp;\u0026amp; mapperClass != null) { Class\u0026lt;?\u0026gt; mapperInterface = Resources.classForName(mapperClass); configuration.addMapper(mapperInterface); } else { throw new BuilderException(\u0026#34;A mapper element may only specify a url, resource or class, but not more than one.\u0026#34;); } } } } } è§£æå®Œåï¼Œå°±å°†è¿™ä¸ªmapperæ¥å£åŠ åˆ° mapperRegistryä¸­ï¼Œ\nconfiguration.addMapper(mapperInterface); Configurationçš„addMapperæ–¹æ³•\npublic \u0026lt;T\u0026gt; void addMapper(Class\u0026lt;T\u0026gt; type) { mapperRegistry.addMapper(type); } æœ€åè¿˜æ˜¯åŠ è½½åˆ°äº†MapperRegistryçš„knownMappersä¸­å»äº†\npublic \u0026lt;T\u0026gt; void addMapper(Class\u0026lt;T\u0026gt; type) { if (type.isInterface()) { if (hasMapper(type)) { throw new BindingException(\u0026#34;Type \u0026#34; + type + \u0026#34; is already known to the MapperRegistry.\u0026#34;); } boolean loadCompleted = false; try { knownMappers.put(type, new MapperProxyFactory\u0026lt;\u0026gt;(type)); // It\u0026#39;s important that the type is added before the parser is run // otherwise the binding may automatically be attempted by the // mapper parser. If the type is already known, it won\u0026#39;t try. MapperAnnotationBuilder parser = new MapperAnnotationBuilder(config, type); parser.parse(); loadCompleted = true; } finally { if (!loadCompleted) { knownMappers.remove(type); } } } } è·å–mapperä»£ç†ç±»è¿‡ç¨‹\n6. æ‰§è¡Œmapperæ¥å£æ–¹æ³• # // 5. æ‰§è¡Œæ¥å£æ–¹æ³• TTestUser userInfo = userMapper.selectByPrimaryKey(16L); selectByPrimaryKeyæ˜¯TTestUserMapperæ¥å£ä¸­å®šä¹‰çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰ç¼–å†™TTestUserMapperæ¥å£çš„çš„å®ç°ç±»ï¼Œé‚£ä¹ˆMybatisæ˜¯æ€ä¹ˆå¸®æˆ‘ä»¬æ‰§è¡Œçš„å‘¢ï¼Ÿå‰é¢è®²åˆ°ï¼Œè·å–mapperå¯¹è±¡æ—¶ï¼Œæ˜¯ä¼šè·å–åˆ°ä¸€ä¸ªMapperProxyFactoryå·¥å‚ç±»ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªMapperProxyä»£ç†ç±»ï¼Œåœ¨æ‰§è¡ŒMapperæ¥å£çš„æ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨MapperProxyçš„invokeæ–¹æ³•ã€‚\n@Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { try { if (Object.class.equals(method.getDeclaringClass())) { return method.invoke(this, args); } else { return cachedInvoker(method).invoke(proxy, method, args, sqlSession); } } catch (Throwable t) { throw ExceptionUtil.unwrapThrowable(t); } } å¦‚æœæ˜¯Objectçš„æ–¹æ³•å°±ç›´æ¥æ‰§è¡Œï¼Œå¦åˆ™æ‰§è¡ŒcachedInvoker(method).invoke(proxy, method, args, sqlSession); è¿™è¡Œä»£ç ï¼Œåˆ°è¿™é‡Œï¼Œæƒ³å¿…æœ‰éƒ¨åˆ†åŒå­¦å·²ç»å¤´æ™•äº†å§ã€‚æ€ä¹ˆåˆæ¥äº†ä¸ªinvokeæ–¹æ³•ã€‚ cachedInvoker æ˜¯è¿”å›ç¼“å­˜çš„MapperMethodInvokerå¯¹è±¡ï¼ŒMapperMethodInvokerçš„invokeæ–¹æ³•ä¼šæ‰§è¡ŒMapperMethodçš„executeæ–¹æ³•ã€‚\npublic class MapperMethod { private final SqlCommand command; private final MethodSignature method; public MapperMethod(Class\u0026lt;?\u0026gt; mapperInterface, Method method, Configuration config) { this.command = new SqlCommand(config, mapperInterface, method); this.method = new MethodSignature(config, mapperInterface, method); } public Object execute(SqlSession sqlSession, Object[] args) { Object result; switch (command.getType()) { case INSERT: { Object param = method.convertArgsToSqlCommandParam(args); result = rowCountResult(sqlSession.insert(command.getName(), param)); break; } case UPDATE: { Object param = method.convertArgsToSqlCommandParam(args); result = rowCountResult(sqlSession.update(command.getName(), param)); break; } case DELETE: { Object param = method.convertArgsToSqlCommandParam(args); result = rowCountResult(sqlSession.delete(command.getName(), param)); break; } case SELECT: if (method.returnsVoid() \u0026amp;\u0026amp; method.hasResultHandler()) { executeWithResultHandler(sqlSession, args); result = null; } else if (method.returnsMany()) { result = executeForMany(sqlSession, args); } else if (method.returnsMap()) { result = executeForMap(sqlSession, args); } else if (method.returnsCursor()) { result = executeForCursor(sqlSession, args); } else { Object param = method.convertArgsToSqlCommandParam(args); result = sqlSession.selectOne(command.getName(), param); if (method.returnsOptional() \u0026amp;\u0026amp; (result == null || !method.getReturnType().equals(result.getClass()))) { result = Optional.ofNullable(result); } } break; case FLUSH: result = sqlSession.flushStatements(); break; default: throw new BindingException(\u0026#34;Unknown execution method for: \u0026#34; + command.getName()); } if (result == null \u0026amp;\u0026amp; method.getReturnType().isPrimitive() \u0026amp;\u0026amp; !method.returnsVoid()) { throw new BindingException(\u0026#34;Mapper method \u0026#39;\u0026#34; + command.getName() + \u0026#34; attempted to return null from a method with a primitive return type (\u0026#34; + method.getReturnType() + \u0026#34;).\u0026#34;); } return result; } } ç„¶åæ ¹æ®æ‰§è¡Œçš„æ¥å£æ‰¾åˆ°mapper.xmlä¸­é…ç½®çš„sqlï¼Œå¹¶å¤„ç†å‚æ•°ï¼Œç„¶åæ‰§è¡Œè¿”å›ç»“æœå¤„ç†ç»“æœç­‰æ­¥éª¤ã€‚\n7. æäº¤äº‹åŠ¡ # // 6. æäº¤äº‹åŠ¡ sqlSession.commit(); äº‹åŠ¡å°±æ˜¯å°†è‹¥å¹²æ•°æ®åº“æ“ä½œçœ‹æˆä¸€ä¸ªå•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œå¦‚æœå¤±è´¥äº†ï¼Œåˆ™ä¼šæ‰§è¡Œæ‰§è¡Œå›æ»šæ“ä½œï¼Œæ¢å¤åˆ°å¼€å§‹æ‰§è¡Œçš„æ•°æ®åº“çŠ¶æ€ã€‚\n8. å…³é—­èµ„æº # // 7. å…³é—­èµ„æº sqlSession.close(); inputStream.close(); sqlSessionæ˜¯ç§å…±ç”¨èµ„æºï¼Œç”¨å®Œäº†è¦è¿”å›åˆ°æ± å­ä¸­ï¼Œä»¥ä¾›å…¶å®ƒåœ°æ–¹ä½¿ç”¨ã€‚\n9. æ€»ç»“ # è‡³æ­¤æˆ‘ä»¬å·²ç»å¤§è‡´äº†è§£äº†Mybatiså¯åŠ¨æ—¶çš„å¤§è‡´æµç¨‹ï¼Œå¾ˆå¤šç»†èŠ‚éƒ½è¿˜æ²¡æœ‰è¯¦ç»†ä»‹ç»ï¼Œè¿™æ˜¯å› ä¸ºæ¶‰åŠåˆ°çš„å±‚é¢åˆæ·±åˆå¹¿ï¼Œå¦‚æœåœ¨ä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»ï¼Œåè€Œä¼šè®©è¯»è€…å¦‚ç½®äº‘é‡Œé›¾é‡Œï¼Œä¸çŸ¥æ‰€äº‘ã€‚å› æ­¤ï¼Œåœ¨æ¥ä¸‹æ¥æˆ‘å°†æ¯ä¸ªæ¨¡å—çš„è¯¦ç»†ä»‹ç»ã€‚å¦‚æœæ–‡ç« æœ‰ä»€ä¹ˆé”™è¯¯æˆ–è€…éœ€è¦æ”¹è¿›çš„ï¼Œå¸Œæœ›åŒå­¦ä»¬æŒ‡å‡ºæ¥ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©ã€‚\n"},{"id":93,"href":"/zh/docs/study/Review/java_guide/lybly_framework/MyBatis/principle/mybatis-principle1/","title":"MybatisåŸç†ç³»åˆ—(1)","section":"åŸç†","content":" è½¬è½½è‡ªhttps://www.jianshu.com/p/ada025f97a07ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nä½œä¸ºJavaç å†œï¼Œæ— è®ºåœ¨é¢è¯•ä¸­ï¼Œè¿˜æ˜¯åœ¨å·¥ä½œä¸­éƒ½ä¼šé‡åˆ°MyBatisçš„ç›¸å…³é—®é¢˜ã€‚ç¬”è€…ä»å¤§å­¦å¼€å§‹å°±æ¥è§¦MyBatisï¼Œåˆ°ç°åœ¨ä¸ºæ­¢éƒ½æ˜¯ä¼šç”¨ï¼ŒçŸ¥é“æ€ä¹ˆé…ç½®ï¼Œæ€ä¹ˆç¼–å†™xmlï¼Œä½†æ˜¯ä¸çŸ¥é“Mybatisæ ¸å¿ƒåŸç†ï¼Œä¸€é‡åˆ°é—®é¢˜å°±å¤åˆ¶é”™è¯¯ä¿¡æ¯ç™¾åº¦è§£å†³ã€‚ä¸ºäº†æ”¹å˜è¿™ç§å¢ƒåœ°ï¼Œé¼“èµ·å‹‡æ°”å¼€å§‹ä¸‹å®šå†³å¿ƒé˜…è¯»MyBatisæºç ï¼Œå¹¶å¼€å§‹è®°å½•é˜…è¯»è¿‡ç¨‹ï¼Œå¸Œæœ›å’Œå¤§å®¶åˆ†äº«ã€‚\n1. åˆè¯†MyBatis # è¿˜è®°å¾—å½“åˆæ¥è§¦MyBatisæ—¶ï¼Œè§‰å¾—è¦é…ç½®å¾ˆå¤šï¼Œè€Œä¸”sqlè¦å•ç‹¬å†™åœ¨xmlä¸­ï¼Œç›¸æ¯”Hibernateæ¥è¯´ç®€ç›´ä¸å¤ªå‹å¥½ï¼Œç›´åˆ°åæ¥å‡ºç°äº†å¤æ‚çš„ä¸šåŠ¡éœ€æ±‚ï¼Œéœ€è¦ç¼–å†™ç›¸åº”çš„å¤æ‚çš„sqlï¼Œæ­¤æ—¶ç”¨Hibernateåè€Œæ›´åŠ éº»çƒ¦äº†ï¼Œç”¨MyBatisæ˜¯çœŸé¦™äº†ã€‚å› æ­¤ç¬”è€…å¯¹MyBatisçš„ç¬¬ä¸€å°è±¡å°±æ˜¯å°†ä¸šåŠ¡å…³æ³¨çš„sqlå’Œjavaä»£ç è¿›è¡Œäº†è§£è€¦ï¼Œåœ¨ä¸šåŠ¡å¤æ‚å˜åŒ–çš„æ—¶å€™ï¼Œç›¸åº”çš„æ•°æ®åº“æ“ä½œéœ€è¦ç›¸åº”è¿›è¡Œä¿®æ”¹ï¼Œå¦‚æœé€šè¿‡javaä»£ç æ„å»ºæ“ä½œæ•°æ®é€»è¾‘ï¼Œè¿™ä¸æ–­å˜åŠ¨çš„éœ€æ±‚å¯¹ç¨‹åºå‘˜çš„è€å¿ƒæ˜¯æå¤§çš„è€ƒéªŒã€‚å¦‚æœå°†sqlç»Ÿä¸€çš„ç»´æŠ¤åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œjavaä»£ç ç”¨æ¥å£å®šä¹‰ï¼Œåœ¨éœ€æ±‚å˜åŠ¨æ—¶ï¼Œåªç”¨æ”¹ç›¸åº”çš„sqlï¼Œä»è€Œå‡å°‘äº†ä¿®æ”¹é‡ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚ä»¥ä¸Šä¹Ÿæ˜¯ç»å¸¸åœ¨é¢è¯•ä¸­ç»å¸¸é—®åˆ°çš„Hibernateå’ŒMyBatisé—´çš„åŒºåˆ«ä¸€ç‚¹ã€‚\nåˆ‡åˆ°æ­£é¢˜ï¼ŒMybatisæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\nMybatis SQL æ˜ å°„æ¡†æ¶ä½¿å¾—ä¸€ä¸ªé¢å‘å¯¹è±¡æ„å»ºçš„åº”ç”¨ç¨‹åºå»è®¿é—®ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“å˜å¾—æ›´å®¹æ˜“ã€‚MyBatisä½¿ç”¨XMLæè¿°ç¬¦æˆ–æ³¨è§£å°†å¯¹è±¡ä¸å­˜å‚¨è¿‡ç¨‹æˆ–SQLè¯­å¥è€¦åˆã€‚ä¸å¯¹è±¡å…³ç³»æ˜ å°„å·¥å…·ç›¸æ¯”ï¼Œç®€å•æ€§æ˜¯MyBatisæ•°æ®æ˜ å°„å™¨çš„æœ€å¤§ä¼˜åŠ¿ã€‚\nä»¥ä¸Šæ˜¯Mybatisçš„å®˜æ–¹è§£é‡Šï¼Œå…¶ä¸­â€œæ˜ å°„â€ï¼Œâ€œé¢å‘å¯¹è±¡â€ï¼Œâ€œå…³ç³»å‹â€ï¼Œâ€œxmlâ€ç­‰ç­‰éƒ½æ˜¯Mybatisçš„å…³é”®è¯ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬äº†è§£äº†MybatisåŸç†åï¼Œä¼šæç„¶å¤§æ‚Ÿçš„åœ°æ–¹ã€‚ç¬”è€…ç°åœ¨ä¸è¯¦è¿°è¿™äº›æ¦‚å¿µï¼Œåœ¨æœ€åæ€»ç»“çš„æ—¶å€™å†è¿›è¡Œè¯¦è¿°ã€‚æˆ‘ä»¬åªè¦çŸ¥é“Mybatisä¸ºæˆ‘ä»¬æ“ä½œæ•°æ®åº“æä¾›äº†å¾ˆå¤§çš„ä¾¿æ·ã€‚\n2. æºç ä¸‹è½½ # è¿™é‡Œå»ºè®®ä½¿ç”¨mavenå³å¯ï¼Œåœ¨pom.xmlæ·»åŠ ä»¥ä¸‹ä¾èµ–\n\u0026lt;dependencies\u0026gt; \u0026lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;8.0.32\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.mybatis\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mybatis\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.5.6\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!--è¿™é‡Œè¿˜æ·»åŠ äº†ä¸€äº›è¾…åŠ©çš„ä¾èµ–--\u0026gt; \u0026lt;!--lombok--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.projectlombok\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;lombok\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.18.8\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!--æ—¥å¿—æ¨¡å—--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.logging.log4j\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;log4j-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.17.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; ç„¶ååœ¨ExternalLibraries çš„mybatis:3.5.6é‡Œæ‰¾åˆ°ï¼Œå°±èƒ½çœ‹åˆ°ç›®å½•ç»“æ„ ï¼Œéšä¾¿æ‰¾ä¸€ä¸ªè¿›å» ideaå³ä¸Šè§’ä¼šå‡ºç°DownloadSourceä¹‹ç±»çš„å­—æ · ï¼Œç‚¹å‡»å³å¯\næˆ‘ä»¬é¦–å…ˆè¦ä»githubä¸Šä¸‹è½½æºç ï¼Œä»“åº“åœ°å€ï¼Œç„¶ååœ¨IDEAä¸­cloneä»£ç \nåœ¨æ‰“å¼€ä¸­çš„IDEAä¸­ï¼Œé€‰æ‹©vsc -\u0026gt; get from version control -\u0026gt; å¤åˆ¶åˆšæ‰çš„åœ°å€\nimage.png\nç‚¹å‡»cloneå³å¯\nimage.png\nç»è¿‡æ¼«é•¿çš„ç­‰å¾…åï¼Œä»£ç ä¼šå…¨éƒ¨ä¸‹è½½ä¸‹æ¥ï¼Œé¡¹ç›®ç»“æœå¦‚ä¸‹ï¼Œæ¡†èµ·æ¥çš„å°±æ˜¯æˆ‘ä»¬è¦å…³æ³¨çš„æ ¸å¿ƒä»£ç äº†ã€‚\nimage.png\næ¯ä¸ªåŒ…å°±æ˜¯MyBatisçš„ä¸€ä¸ªæ¨¡å—ï¼Œæ¯ä¸ªåŒ…çš„ä½œç”¨å¦‚ä¸‹ï¼š\n3. ä¸€ä¸ªç®€å•çš„æ —å­ # ä¸çŸ¥é“ç°åœ¨è¿˜æœ‰æ²¡æœ‰åŒå­¦çŸ¥é“æ€ä¹ˆä½¿ç”¨åŸç”Ÿçš„JDBCè¿›è¡Œæ•°æ®åº“æ“ä½œï¼Œç°åœ¨æ¡†æ¶å¤ªæ–¹ä¾¿äº†ï¼Œä¸ºæˆ‘ä»¬è€ƒè™‘äº†å¾ˆå¤šï¼Œä¹Ÿéšè—äº†å¾ˆå¤šç»†èŠ‚ï¼Œå› æ­¤ä¼šè®©æˆ‘ä»¬å¤„äºä¸€ä¸ªäº‘é‡Œé›¾é‡Œçš„å¢ƒåœ°ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡ï¼Œè¿™æ ·è®¾è®¡è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘ä»¬æ˜¯ä¸å¾—è€ŒçŸ¥çš„ï¼Œä¸ºäº†äº†è§£å…¶ä¸­å¥¥ç§˜ï¼Œè¿˜æ˜¯éœ€è¦æˆ‘ä»¬ä»å¤´å¼€å§‹äº†è§£ã€‚\næ¥ä¸‹æ¥ç¬”è€…å°†ä»¥ä¸¤ä¸ªæ —å­æ¥åˆ†åˆ«è®²è®²å¦‚ä½•ç”¨åŸç”Ÿçš„JDBCæ“ä½œæ•°æ®åº“ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨MyBatisæ¡†æ¶æ¥å®ç°ç›¸åŒçš„åŠŸèƒ½ï¼Œå¹¶æ¯”è¾ƒä¸¤è€…çš„åŒºåˆ«ã€‚\né¦–å…ˆåˆ›å»ºæ•°æ®åº“ test\n3.1 åˆ›å»ºè¡¨ # åœ¨æ­¤æˆ‘ä»¬å»ºäº†ä¸¤å¼ è¡¨ï¼Œä¸€å¼ æ˜¯t_test_userç”¨æˆ·ä¿¡æ¯ä¸»è¡¨ï¼Œä¸€å¼ æ˜¯t_test_user_infoç”¨æˆ·ä¿¡æ¯å‰¯è¡¨ï¼Œä¸¤å¼ è¡¨é€šè¿‡member_idè¿›è¡Œå…³è”ã€‚\nDROP TABLE IF EXISTS `t_test_user`; CREATE TABLE `t_test_user` ( `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT \u0026#39;id\u0026#39;, `member_id` bigint(20) NOT NULL COMMENT \u0026#39;ä¼šå‘˜id\u0026#39;, `real_name` varchar(255) CHARACTER SET utf8 DEFAULT NULL COMMENT \u0026#39;çœŸå®å§“å\u0026#39;, `nickname` varchar(255) CHARACTER SET utf8mb4 DEFAULT NULL COMMENT \u0026#39;ä¼šå‘˜æ˜µç§°\u0026#39;, `date_create` datetime DEFAULT CURRENT_TIMESTAMP COMMENT \u0026#39;åˆ›å»ºæ—¶é—´\u0026#39;, `date_update` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT \u0026#39;æ›´æ–°æ—¶é—´\u0026#39;, `deleted` bigint(20) DEFAULT \u0026#39;0\u0026#39; COMMENT \u0026#39;åˆ é™¤æ ‡è¯†ï¼Œ0æœªåˆ é™¤ï¼Œæ—¶é—´æˆ³-åˆ é™¤æ—¶é—´\u0026#39;, PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=42013 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=\u0026#39;æµ‹è¯•è¡¨\u0026#39;; DROP TABLE IF EXISTS `t_test_user_info`; CREATE TABLE `t_test_user_info` ( `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT \u0026#39;id\u0026#39;, `member_id` bigint(20) NOT NULL COMMENT \u0026#39;ä¼šå‘˜id\u0026#39;, `member_phone` varchar(50) CHARACTER SET utf8mb4 DEFAULT NULL COMMENT \u0026#39;ç”µè¯\u0026#39;, `member_province` varchar(50) CHARACTER SET utf8mb4 DEFAULT NULL COMMENT \u0026#39;çœ\u0026#39;, `member_city` varchar(50) CHARACTER SET utf8mb4 DEFAULT NULL COMMENT \u0026#39;å¸‚\u0026#39;, `member_county` varchar(50) CHARACTER SET utf8mb4 DEFAULT NULL COMMENT \u0026#39;åŒº\u0026#39;, `date_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT \u0026#39;åˆ›å»ºæ—¶é—´\u0026#39;, `date_update` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT \u0026#39;æ›´æ–°æ—¶é—´\u0026#39;, `deleted` bigint(20) NOT NULL DEFAULT \u0026#39;0\u0026#39; COMMENT \u0026#39;åˆ é™¤æ ‡è¯†ï¼Œ0æœªåˆ é™¤ï¼Œæ—¶é—´æˆ³-åˆ é™¤æ—¶é—´\u0026#39;, PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=17 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=\u0026#39;ç”¨æˆ·ä¿¡æ¯æµ‹è¯•è¡¨\u0026#39;; 3.2 ä½¿ç”¨Java JDBCè¿›è¡Œæ“ä½œæ•°æ®åº“ # JDBC(Java Database Connectivityï¼Œç®€ç§°JDBCï¼‰æ˜¯Javaä¸­ç”¨æ¥è§„èŒƒå®¢æˆ·ç«¯ç¨‹åºå¦‚ä½•æ¥è®¿é—®æ•°æ®åº“çš„åº”ç”¨ç¨‹åºæ¥å£ï¼Œæä¾›äº†è¯¸å¦‚æŸ¥è¯¢å’Œæ›´æ–°æ•°æ®åº“ä¸­æ•°æ®çš„æ–¹æ³•ã€‚ä½¿ç”¨JDBCæ“ä½œæ•°æ®åº“ï¼Œä¸€èˆ¬åŒ…å«7æ­¥ï¼Œä»£ç å¦‚ä¸‹ã€‚\npublic class JDBCTest { /** * æ•°æ®åº“åœ°å€ æ›¿æ¢æˆæœ¬åœ°çš„åœ°å€ */ private static final String url = \u0026#34;jdbc:mysql://localhost:3306/test?useUnicode=true\u0026#34;; /** * æ•°æ®åº“ç”¨æˆ·å */ private static final String username = \u0026#34;test\u0026#34;; /** * å¯†ç  */ private static final String password = \u0026#34;test\u0026#34;; public static void main(String[] args) { try { // 1. åŠ è½½æ•°æ®åº“é©±åŠ¨ Class.forName(\u0026#34;com.mysql.jdbc.Driver\u0026#34;); // 2. è·å¾—è¿æ¥ Connection connection = DriverManager.getConnection(url, username, password); // 3. åˆ›å»ºsqlè¯­å¥ String sql = \u0026#34;select * from t_test_user\u0026#34;; Statement statement = connection.createStatement(); // 4. æ‰§è¡Œsql ResultSet result = statement.executeQuery(sql); // 5. å¤„ç†ç»“æœ while(result.next()){ System.out.println(\u0026#34;result = \u0026#34; + result.getString(1)); } // 6. å…³é—­è¿æ¥ result.close(); connection.close(); } catch (Exception e){ System.out.println(e); } } } 3.3 ä½¿ç”¨Mybatisè¿›è¡Œæ“ä½œæ•°æ®åº“ # 3.3.1 æ–°å¢mybatis-config.xmlé…ç½® # åœ¨è·¯å¾„src/main/resources/mybatis-config.xmlæ–°å¢é…ç½®ï¼Œé…ç½®å†…å®¹å¦‚ä¸‹\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34; ?\u0026gt; \u0026lt;!DOCTYPE configuration PUBLIC \u0026#34;-//mybatis.org//DTD Config 3.0//EN\u0026#34; \u0026#34;http://mybatis.org/dtd/mybatis-3-config.dtd\u0026#34;\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;!--ä¸€äº›é‡è¦çš„å…¨å±€é…ç½®--\u0026gt; \u0026lt;settings\u0026gt; \u0026lt;setting name=\u0026#34;cacheEnabled\u0026#34; value=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;lazyLoadingEnabled\u0026#34; value=\u0026#34;true\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;multipleResultSetsEnabled\u0026#34; value=\u0026#34;true\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;useColumnLabel\u0026#34; value=\u0026#34;true\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;useGeneratedKeys\u0026#34; value=\u0026#34;false\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;autoMappingBehavior\u0026#34; value=\u0026#34;PARTIAL\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;autoMappingUnknownColumnBehavior\u0026#34; value=\u0026#34;WARNING\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;defaultExecutorType\u0026#34; value=\u0026#34;SIMPLE\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;defaultStatementTimeout\u0026#34; value=\u0026#34;25\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;defaultFetchSize\u0026#34; value=\u0026#34;100\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;safeRowBoundsEnabled\u0026#34; value=\u0026#34;false\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;mapUnderscoreToCamelCase\u0026#34; value=\u0026#34;false\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;localCacheScope\u0026#34; value=\u0026#34;STATEMENT\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;jdbcTypeForNull\u0026#34; value=\u0026#34;OTHER\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;lazyLoadTriggerMethods\u0026#34; value=\u0026#34;equals,clone,hashCode,toString\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--\u0026lt;setting name=\u0026#34;logImpl\u0026#34; value=\u0026#34;STDOUT_LOGGING\u0026#34; /\u0026gt;--\u0026gt; \u0026lt;/settings\u0026gt; \u0026lt;environments default=\u0026#34;development\u0026#34;\u0026gt; \u0026lt;environment id=\u0026#34;development\u0026#34;\u0026gt; \u0026lt;transactionManager type=\u0026#34;JDBC\u0026#34;/\u0026gt; \u0026lt;dataSource type=\u0026#34;POOLED\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;driver\u0026#34; value=\u0026#34;com.mysql.cj.jdbc.Driver\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;url\u0026#34; value=\u0026#34;jdbc:mysql://localhost:3306/test?useUnicode=true\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;username\u0026#34; value=\u0026#34;root\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;password\u0026#34; value=\u0026#34;123456\u0026#34;/\u0026gt; \u0026lt;/dataSource\u0026gt; \u0026lt;/environment\u0026gt; \u0026lt;/environments\u0026gt; \u0026lt;mappers\u0026gt; \u0026lt;!--è¿™è¾¹å¯ä»¥ä½¿ç”¨packageæˆ–resourceä¸¤ç§æ–¹å¼åŠ è½½mapper--\u0026gt; \u0026lt;!--\u0026lt;package name=\u0026#34;åŒ…å\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;!--å¦‚æœè¿™é‡Œä½¿ç”¨äº†åŒ…å, é‚£ä¹ˆresourceä¸‹ çš„Mapper.xmlæ–‡ä»¶çš„å±‚çº§,ä¸€å®šè¦å’ŒMapperç±»çš„å…¨ç±»åä¸€æ ·,å³com/example/demo/dao/TTestUserMapper.xml--\u0026gt; \u0026lt;!--\u0026lt;mapper resource=\u0026#34;å…·ä½“çš„Mapper.xmlåœ°å€\u0026#34; /\u0026gt;--\u0026gt; \u0026lt;mapper resource=\u0026#34;mapper/TTestUserMapper.xml\u0026#34; /\u0026gt; \u0026lt;!--\u0026lt;package name=\u0026#34;com.example.demo.dao\u0026#34;/\u0026gt;--\u0026gt; \u0026lt;/mappers\u0026gt; \u0026lt;/configuration\u0026gt; 3.3.2 æ–°å¢mapperæ¥å£ # æ–°å¢src/main/java/com/example/demo/dao/TTestUserMapper.java æ¥å£\npackage com.example.demo.dao; import com.example.demo.entity.TTestUser; import org.apache.ibatis.annotations.Mapper; import java.util.List; @Mapper public interface TTestUserMapper { /** * This method was generated by MyBatis Generator. * This method corresponds to the database table t_test_user * * @mbggenerated */ int deleteByPrimaryKey(Long id); /** * This method was generated by MyBatis Generator. * This method corresponds to the database table t_test_user * * @mbggenerated */ int insert(TTestUser record); /** * This method was generated by MyBatis Generator. * This method corresponds to the database table t_test_user * * @mbggenerated */ int insertSelective(TTestUser record); int batchInsert(List\u0026lt;TTestUser\u0026gt; records); /** * This method was generated by MyBatis Generator. * This method corresponds to the database table t_test_user * * @mbggenerated */ TTestUser selectByPrimaryKey(Long id); /** * This method was generated by MyBatis Generator. * This method corresponds to the database table t_test_user * * @mbggenerated */ int updateByPrimaryKeySelective(TTestUser record); /** * This method was generated by MyBatis Generator. * This method corresponds to the database table t_test_user * * @mbggenerated */ int updateByPrimaryKey(TTestUser record); } 3.3.3 æ–°å¢æ˜ å°„é…ç½®æ–‡ä»¶ # src/main/resources/mapper/TTestUserMapper.xml æ–°å¢æ˜ å°„é…ç½®æ–‡ä»¶\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE mapper PUBLIC \u0026#34;-//mybatis.org//DTD Mapper 3.0//EN\u0026#34; \u0026#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd\u0026#34;\u0026gt; \u0026lt;mapper namespace=\u0026#34;com.example.demo.dao.TTestUserMapper\u0026#34;\u0026gt; \u0026lt;resultMap id=\u0026#34;BaseResultMap\u0026#34; type=\u0026#34;com.example.demo.entity.TTestUser\u0026#34;\u0026gt; \u0026lt;!-- WARNING - @mbggenerated This element is automatically generated by MyBatis Generator, do not modify. --\u0026gt; \u0026lt;id column=\u0026#34;id\u0026#34; jdbcType=\u0026#34;BIGINT\u0026#34; property=\u0026#34;id\u0026#34; /\u0026gt; \u0026lt;result column=\u0026#34;member_id\u0026#34; jdbcType=\u0026#34;BIGINT\u0026#34; property=\u0026#34;memberId\u0026#34; /\u0026gt; \u0026lt;result column=\u0026#34;real_name\u0026#34; jdbcType=\u0026#34;VARCHAR\u0026#34; property=\u0026#34;realName\u0026#34; /\u0026gt; \u0026lt;result column=\u0026#34;nickname\u0026#34; jdbcType=\u0026#34;VARCHAR\u0026#34; property=\u0026#34;nickname\u0026#34; /\u0026gt; \u0026lt;result column=\u0026#34;date_create\u0026#34; jdbcType=\u0026#34;TIMESTAMP\u0026#34; property=\u0026#34;dateCreate\u0026#34; /\u0026gt; \u0026lt;result column=\u0026#34;date_update\u0026#34; jdbcType=\u0026#34;TIMESTAMP\u0026#34; property=\u0026#34;dateUpdate\u0026#34; /\u0026gt; \u0026lt;result column=\u0026#34;deleted\u0026#34; jdbcType=\u0026#34;BIGINT\u0026#34; property=\u0026#34;deleted\u0026#34; /\u0026gt; \u0026lt;/resultMap\u0026gt; \u0026lt;sql id=\u0026#34;Base_Column_List\u0026#34;\u0026gt; \u0026lt;!-- WARNING - @mbggenerated This element is automatically generated by MyBatis Generator, do not modify. --\u0026gt; id, member_id, real_name, nickname, date_create, date_update, deleted \u0026lt;/sql\u0026gt; \u0026lt;select id=\u0026#34;selectByPrimaryKey\u0026#34; parameterType=\u0026#34;java.lang.Long\u0026#34; resultMap=\u0026#34;BaseResultMap\u0026#34;\u0026gt; \u0026lt;!-- WARNING - @mbggenerated This element is automatically generated by MyBatis Generator, do not modify. --\u0026gt; select \u0026lt;include refid=\u0026#34;Base_Column_List\u0026#34; /\u0026gt; from t_test_user where id = #{id,jdbcType=BIGINT} \u0026lt;/select\u0026gt; \u0026lt;delete id=\u0026#34;deleteByPrimaryKey\u0026#34; parameterType=\u0026#34;java.lang.Long\u0026#34;\u0026gt; \u0026lt;!-- WARNING - @mbggenerated This element is automatically generated by MyBatis Generator, do not modify. --\u0026gt; delete from t_test_user where id = #{id,jdbcType=BIGINT} \u0026lt;/delete\u0026gt; \u0026lt;insert id=\u0026#34;insert\u0026#34; parameterType=\u0026#34;com.example.demo.entity.TTestUser\u0026#34;\u0026gt; \u0026lt;!-- WARNING - @mbggenerated This element is automatically generated by MyBatis Generator, do not modify. --\u0026gt; insert into t_test_user (id, member_id, real_name, nickname, date_create, date_update, deleted) values (#{id,jdbcType=BIGINT}, #{memberId,jdbcType=BIGINT}, #{realName,jdbcType=VARCHAR}, #{nickname,jdbcType=VARCHAR}, #{dateCreate,jdbcType=TIMESTAMP}, #{dateUpdate,jdbcType=TIMESTAMP}, #{deleted,jdbcType=BIGINT}) \u0026lt;/insert\u0026gt; \u0026lt;insert id=\u0026#34;insertSelective\u0026#34; parameterType=\u0026#34;com.example.demo.entity.TTestUser\u0026#34;\u0026gt; \u0026lt;!-- WARNING - @mbggenerated This element is automatically generated by MyBatis Generator, do not modify. --\u0026gt; insert into t_test_user \u0026lt;trim prefix=\u0026#34;(\u0026#34; suffix=\u0026#34;)\u0026#34; suffixOverrides=\u0026#34;,\u0026#34;\u0026gt; \u0026lt;if test=\u0026#34;id != null\u0026#34;\u0026gt; id, \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;memberId != null\u0026#34;\u0026gt; member_id, \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;realName != null\u0026#34;\u0026gt; real_name, \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;nickname != null\u0026#34;\u0026gt; nickname, \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;dateCreate != null\u0026#34;\u0026gt; date_create, \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;dateUpdate != null\u0026#34;\u0026gt; date_update, \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;deleted != null\u0026#34;\u0026gt; deleted, \u0026lt;/if\u0026gt; \u0026lt;/trim\u0026gt; \u0026lt;trim prefix=\u0026#34;values (\u0026#34; suffix=\u0026#34;)\u0026#34; suffixOverrides=\u0026#34;,\u0026#34;\u0026gt; \u0026lt;if test=\u0026#34;id != null\u0026#34;\u0026gt; #{id,jdbcType=BIGINT}, \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;memberId != null\u0026#34;\u0026gt; #{memberId,jdbcType=BIGINT}, \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;realName != null\u0026#34;\u0026gt; #{realName,jdbcType=VARCHAR}, \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;nickname != null\u0026#34;\u0026gt; #{nickname,jdbcType=VARCHAR}, \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;dateCreate != null\u0026#34;\u0026gt; #{dateCreate,jdbcType=TIMESTAMP}, \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;dateUpdate != null\u0026#34;\u0026gt; #{dateUpdate,jdbcType=TIMESTAMP}, \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;deleted != null\u0026#34;\u0026gt; #{deleted,jdbcType=BIGINT}, \u0026lt;/if\u0026gt; \u0026lt;/trim\u0026gt; \u0026lt;/insert\u0026gt; \u0026lt;update id=\u0026#34;updateByPrimaryKeySelective\u0026#34; parameterType=\u0026#34;com.example.demo.entity.TTestUser\u0026#34;\u0026gt; \u0026lt;!-- WARNING - @mbggenerated This element is automatically generated by MyBatis Generator, do not modify. --\u0026gt; update t_test_user \u0026lt;set\u0026gt; \u0026lt;if test=\u0026#34;memberId != null\u0026#34;\u0026gt; member_id = #{memberId,jdbcType=BIGINT}, \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;realName != null\u0026#34;\u0026gt; real_name = #{realName,jdbcType=VARCHAR}, \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;nickname != null\u0026#34;\u0026gt; nickname = #{nickname,jdbcType=VARCHAR}, \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;dateCreate != null\u0026#34;\u0026gt; date_create = #{dateCreate,jdbcType=TIMESTAMP}, \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;dateUpdate != null\u0026#34;\u0026gt; date_update = #{dateUpdate,jdbcType=TIMESTAMP}, \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;deleted != null\u0026#34;\u0026gt; deleted = #{deleted,jdbcType=BIGINT}, \u0026lt;/if\u0026gt; \u0026lt;/set\u0026gt; where id = #{id,jdbcType=BIGINT} \u0026lt;/update\u0026gt; \u0026lt;update id=\u0026#34;updateByPrimaryKey\u0026#34; parameterType=\u0026#34;com.example.demo.entity.TTestUser\u0026#34;\u0026gt; \u0026lt;!-- WARNING - @mbggenerated This element is automatically generated by MyBatis Generator, do not modify. --\u0026gt; update t_test_user set member_id = #{memberId,jdbcType=BIGINT}, real_name = #{realName,jdbcType=VARCHAR}, nickname = #{nickname,jdbcType=VARCHAR}, date_create = #{dateCreate,jdbcType=TIMESTAMP}, date_update = #{dateUpdate,jdbcType=TIMESTAMP}, deleted = #{deleted,jdbcType=BIGINT} where id = #{id,jdbcType=BIGINT} \u0026lt;/update\u0026gt; \u0026lt;/mapper\u0026gt; 3.3.5 æ–°å¢å®ä½“ç±» # package com.example.demo.entity; import java.io.Serializable; import java.util.Date; public class TTestUser implements Serializable { /** * This field was generated by MyBatis Generator. * This field corresponds to the database column t_test_user.id * * @mbggenerated */ private Long id; /** * This field was generated by MyBatis Generator. * This field corresponds to the database column t_test_user.member_id * * @mbggenerated */ private Long memberId; /** * This field was generated by MyBatis Generator. * This field corresponds to the database column t_test_user.real_name * * @mbggenerated */ private String realName; /** * This field was generated by MyBatis Generator. * This field corresponds to the database column t_test_user.nickname * * @mbggenerated */ private String nickname; /** * This field was generated by MyBatis Generator. * This field corresponds to the database column t_test_user.date_create * * @mbggenerated */ private Date dateCreate; /** * This field was generated by MyBatis Generator. * This field corresponds to the database column t_test_user.date_update * * @mbggenerated */ private Date dateUpdate; /** * This field was generated by MyBatis Generator. * This field corresponds to the database column t_test_user.deleted * * @mbggenerated */ private Long deleted; /** * This field was generated by MyBatis Generator. * This field corresponds to the database table t_test_user * * @mbggenerated */ private static final long serialVersionUID = 1L; /** * This method was generated by MyBatis Generator. * This method returns the value of the database column t_test_user.id * * @return the value of t_test_user.id * * @mbggenerated */ public Long getId() { return id; } /** * This method was generated by MyBatis Generator. * This method sets the value of the database column t_test_user.id * * @param id the value for t_test_user.id * * @mbggenerated */ public void setId(Long id) { this.id = id; } /** * This method was generated by MyBatis Generator. * This method returns the value of the database column t_test_user.member_id * * @return the value of t_test_user.member_id * * @mbggenerated */ public Long getMemberId() { return memberId; } /** * This method was generated by MyBatis Generator. * This method sets the value of the database column t_test_user.member_id * * @param memberId the value for t_test_user.member_id * * @mbggenerated */ public void setMemberId(Long memberId) { this.memberId = memberId; } /** * This method was generated by MyBatis Generator. * This method returns the value of the database column t_test_user.real_name * * @return the value of t_test_user.real_name * * @mbggenerated */ public String getRealName() { return realName; } /** * This method was generated by MyBatis Generator. * This method sets the value of the database column t_test_user.real_name * * @param realName the value for t_test_user.real_name * * @mbggenerated */ public void setRealName(String realName) { this.realName = realName == null ? null : realName.trim(); } /** * This method was generated by MyBatis Generator. * This method returns the value of the database column t_test_user.nickname * * @return the value of t_test_user.nickname * * @mbggenerated */ public String getNickname() { return nickname; } /** * This method was generated by MyBatis Generator. * This method sets the value of the database column t_test_user.nickname * * @param nickname the value for t_test_user.nickname * * @mbggenerated */ public void setNickname(String nickname) { this.nickname = nickname == null ? null : nickname.trim(); } /** * This method was generated by MyBatis Generator. * This method returns the value of the database column t_test_user.date_create * * @return the value of t_test_user.date_create * * @mbggenerated */ public Date getDateCreate() { return dateCreate; } /** * This method was generated by MyBatis Generator. * This method sets the value of the database column t_test_user.date_create * * @param dateCreate the value for t_test_user.date_create * * @mbggenerated */ public void setDateCreate(Date dateCreate) { this.dateCreate = dateCreate; } /** * This method was generated by MyBatis Generator. * This method returns the value of the database column t_test_user.date_update * * @return the value of t_test_user.date_update * * @mbggenerated */ public Date getDateUpdate() { return dateUpdate; } /** * This method was generated by MyBatis Generator. * This method sets the value of the database column t_test_user.date_update * * @param dateUpdate the value for t_test_user.date_update * * @mbggenerated */ public void setDateUpdate(Date dateUpdate) { this.dateUpdate = dateUpdate; } /** * This method was generated by MyBatis Generator. * This method returns the value of the database column t_test_user.deleted * * @return the value of t_test_user.deleted * * @mbggenerated */ public Long getDeleted() { return deleted; } /** * This method was generated by MyBatis Generator. * This method sets the value of the database column t_test_user.deleted * * @param deleted the value for t_test_user.deleted * * @mbggenerated */ public void setDeleted(Long deleted) { this.deleted = deleted; } /** * This method was generated by MyBatis Generator. * This method corresponds to the database table t_test_user * * @mbggenerated */ @Override public String toString() { StringBuilder sb = new StringBuilder(); sb.append(getClass().getSimpleName()); sb.append(\u0026#34; [\u0026#34;); sb.append(\u0026#34;Hash = \u0026#34;).append(hashCode()); sb.append(\u0026#34;, id=\u0026#34;).append(id); sb.append(\u0026#34;, memberId=\u0026#34;).append(memberId); sb.append(\u0026#34;, realName=\u0026#34;).append(realName); sb.append(\u0026#34;, nickname=\u0026#34;).append(nickname); sb.append(\u0026#34;, dateCreate=\u0026#34;).append(dateCreate); sb.append(\u0026#34;, dateUpdate=\u0026#34;).append(dateUpdate); sb.append(\u0026#34;, deleted=\u0026#34;).append(deleted); sb.append(\u0026#34;, serialVersionUID=\u0026#34;).append(serialVersionUID); sb.append(\u0026#34;]\u0026#34;); return sb.toString(); } } 3.3.6 æ‰§è¡ŒæŸ¥è¯¢ # @Slf4j public class MyBatisBootStrap { public static void main(String[] args) { try { // 1. è¯»å–é…ç½® InputStream inputStream = Resources.getResourceAsStream(\u0026#34;mybatis-config.xml\u0026#34;); // 2. åˆ›å»ºSqlSessionFactoryå·¥å‚ SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); // 3. è·å–sqlSession SqlSession sqlSession = sqlSessionFactory.openSession(); // 4. è·å–Mapper TTestUserMapper userMapper = sqlSession.getMapper(TTestUserMapper.class); // 5. æ‰§è¡Œæ¥å£æ–¹æ³• TTestUser userInfo = userMapper.selectByPrimaryKey(16L); System.out.println(\u0026#34;userInfo = \u0026#34; + JSONUtil.toJsonStr(userInfo)); // 6. æäº¤äº‹åŠ¡ sqlSession.commit(); // 7. å…³é—­èµ„æº sqlSession.close(); inputStream.close(); } catch (Exception e){ log.error(e.getMessage(), e); } } } 3.4 åŒºåˆ« # å‘ç°æ²¡æœ‰åœ¨å†™MyBatisçš„æ—¶å€™ï¼Œæ–°å¢äº†dao, mapper.xml, entity, mybatis-config.xmlç­‰å¾ˆå¤šä¸œè¥¿ï¼Œå·¥ä½œé‡åè€Œå¢å¤§äº†ã€‚ä½†æ˜¯dao, mapper.xml, entityéƒ½æ˜¯å¯ä»¥æ ¹æ®æ’ä»¶mybatis-generatorç”Ÿæˆçš„ï¼Œæˆ‘ä»¬ä¹Ÿä¸ç”¨ä¸€ä¸€å»åˆ›å»ºï¼Œè€Œä¸”æˆ‘ä»¬æ²¡æœ‰æ¶‰åŠåˆ°åŸç”ŸJDBCä¸­åŠ è½½é©±åŠ¨ï¼Œåˆ›å»ºè¿æ¥ï¼Œå¤„ç†ç»“æœé›†ï¼Œå…³é—­è¿æ¥ç­‰ç­‰è¿™äº›æ“ä½œï¼Œè¿™äº›éƒ½æ˜¯MyBatiså¸®æˆ‘ä»¬åšäº†ï¼Œæˆ‘ä»¬åªç”¨å…³å¿ƒæä¾›çš„æŸ¥è¯¢æ¥å£å’Œsqlç¼–å†™å³å¯ã€‚\nå¦‚æœä½¿ç”¨åŸç”Ÿçš„JDBCè¿›è¡Œæ•°æ®åº“æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦å…³å¿ƒå¦‚ä½•åŠ è½½é©±åŠ¨ï¼Œå¦‚ä½•è·å–è¿æ¥å…³é—­è¿æ¥ï¼Œå¦‚ä½•è·å–ç»“æœé›†ç­‰ç­‰ä¸ä¸šåŠ¡æ— å…³çš„åœ°æ–¹ï¼Œè€ŒMyBatisé€šè¿‡**â€œæ˜ å°„â€è¿™ä¸ªæ ¸å¿ƒæ¦‚å¿µå°†sqlå’Œjavaæ¥å£å…³è”èµ·æ¥ï¼Œæˆ‘ä»¬è°ƒç”¨javaæ¥å£å°±ç›¸å½“äºå¯ä»¥ç›´æ¥æ‰§è¡Œsql**ï¼Œå¹¶ä¸”å°†ç»“æœæ˜ å°„ä¸ºjava pojoå¯¹è±¡ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¼€å¤´è¯´çš„**â€œæ˜ å°„â€ï¼Œâ€œé¢å‘å¯¹è±¡çš„â€**çš„åŸå› äº†ã€‚\n4. æ€»ç»“ # è¿™ç¯‡æ–‡ç« ç®€å•çš„ä»‹ç»äº†ä¸‹MyBatisçš„åŸºæœ¬æ¦‚å¿µï¼Œå¹¶æä¾›äº†ç®€å•çš„æ —å­ï¼Œæ¥ä¸‹æ¥å‡ ç¯‡æ–‡ç« æ‰“ç®—å†™ä¸‹Mybatisçš„å¯åŠ¨æµç¨‹ï¼Œè®©æˆ‘ä»¬æ›´å¥½çš„äº†è§£ä¸‹mybatisçš„å„æ¨¡å—åä½œã€‚\n"},{"id":94,"href":"/zh/docs/study/Review/java_guide/lybly_framework/MyBatis/MyBatis-interview/","title":"Mybatisé¢è¯•","section":"MyBatis","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\néƒ¨åˆ†ç–‘é—®å‚è€ƒè‡ª https://blog.csdn.net/Gherbirthday0916 æ„Ÿè°¢ä½œè€…!\n#{} å’Œ ${} çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ # æ³¨ï¼šè¿™é“é¢˜æ˜¯é¢è¯•å®˜é¢è¯•æˆ‘åŒäº‹çš„ã€‚\nç­”ï¼š\n${}æ˜¯ Properties æ–‡ä»¶ä¸­çš„å˜é‡å ä½ç¬¦ï¼Œå®ƒå¯ä»¥ç”¨äºæ ‡ç­¾å±æ€§å€¼å’Œ sql å†…éƒ¨ï¼Œå±äºé™æ€æ–‡æœ¬æ›¿æ¢ï¼Œæ¯”å¦‚${driver}ä¼šè¢«é™æ€æ›¿æ¢ä¸ºcom.mysql.jdbc. Driverã€‚ #{}æ˜¯ sql çš„å‚æ•°å ä½ç¬¦ï¼ŒMyBatis ä¼šå°† sql ä¸­çš„#{}æ›¿æ¢ä¸º? å·ï¼Œåœ¨ sql æ‰§è¡Œå‰ä¼šä½¿ç”¨ PreparedStatement çš„å‚æ•°è®¾ç½®æ–¹æ³•ï¼ŒæŒ‰åºç»™ sql çš„? å·å ä½ç¬¦è®¾ç½®å‚æ•°å€¼ï¼Œæ¯”å¦‚ ps.setInt(0, parameterValue)ï¼Œ#{item.name} çš„å–å€¼æ–¹å¼ä¸ºä½¿ç”¨åå°„ä»å‚æ•°å¯¹è±¡ä¸­è·å– item å¯¹è±¡çš„ name å±æ€§å€¼ï¼Œç›¸å½“äº param.getItem().getName()ã€‚ [è¿™é‡Œç”¨åˆ°äº†åå°„] åœ¨åº•å±‚æ„é€ å®Œæ•´SQLè¯­å¥æ—¶ï¼ŒMyBatisçš„ä¸¤ç§ä¼ å‚æ–¹å¼æ‰€é‡‡å–çš„æ–¹å¼ä¸åŒã€‚#{Parameter}é‡‡ç”¨é¢„ç¼–è¯‘çš„æ–¹å¼æ„é€ SQLï¼Œé¿å…äº† SQLæ³¨å…¥ çš„äº§ç”Ÿã€‚è€Œ**${Parameter}é‡‡ç”¨æ‹¼æ¥çš„æ–¹å¼æ„é€ SQLï¼Œåœ¨å¯¹ç”¨æˆ·è¾“å…¥è¿‡æ»¤ä¸ä¸¥æ ¼**çš„å‰æä¸‹ï¼Œæ­¤å¤„å¾ˆå¯èƒ½å­˜åœ¨SQLæ³¨å…¥\nxml æ˜ å°„æ–‡ä»¶ä¸­ï¼Œé™¤äº†å¸¸è§çš„ selectã€insertã€updateã€delete æ ‡ç­¾ä¹‹å¤–ï¼Œè¿˜æœ‰å“ªäº›æ ‡ç­¾ï¼Ÿ # æ³¨ï¼šè¿™é“é¢˜æ˜¯äº¬ä¸œé¢è¯•å®˜é¢è¯•æˆ‘æ—¶é—®çš„ã€‚\nç­”ï¼šè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æ ‡ç­¾ï¼Œ \u0026lt;resultMap\u0026gt; ã€ \u0026lt;parameterMap\u0026gt; ã€ \u0026lt;sql\u0026gt; ã€ \u0026lt;include\u0026gt; ã€ \u0026lt;selectKey\u0026gt; ï¼ŒåŠ ä¸ŠåŠ¨æ€ sql çš„ 9 ä¸ªæ ‡ç­¾ï¼Œ trim|where|set|foreach|if|choose|when|otherwise|bind ç­‰ï¼Œå…¶ä¸­ \u0026lt;sql\u0026gt; ä¸º sql ç‰‡æ®µæ ‡ç­¾ï¼Œé€šè¿‡ \u0026lt;include\u0026gt; æ ‡ç­¾å¼•å…¥ sql ç‰‡æ®µï¼Œ \u0026lt;selectKey\u0026gt; ä¸ºä¸æ”¯æŒè‡ªå¢çš„ä¸»é”®ç”Ÿæˆç­–ç•¥æ ‡ç­¾ã€‚\nsetæ ‡ç­¾ï¼Œæ˜¯updateç”¨çš„\n\u0026lt;update id=\u0026#34;updateUserById\u0026#34; parameterType=\u0026#34;user\u0026#34;\u0026gt; update user \u0026lt;set\u0026gt; \u0026lt;if test=\u0026#34;uid!=null\u0026#34;\u0026gt; uid=#{uid} \u0026lt;/if\u0026gt; \u0026lt;/set\u0026gt; \u0026lt;/update\u0026gt; ResultMapï¼ˆç»“æœé›†æ˜ å°„ï¼‰ï¼š\nå‡è®¾æˆ‘ä»¬çš„æ•°æ®åº“å­—æ®µå’Œæ˜ å°„pojoç±»çš„å±æ€§å­—æ®µä¸ä¸€è‡´ï¼Œé‚£ä¹ˆæŸ¥è¯¢ç»“æœï¼Œä¸ä¸€è‡´çš„å­—æ®µå€¼ä¼šä¸ºnull\nè¿™æ—¶å¯ä»¥ä½¿ç”¨Mybatis ResultMap ç»“æœé›†æ˜ å°„\nparameterMapï¼ˆå‚æ•°ç±»å‹æ˜ å°„ï¼‰ï¼š\nå¾ˆå°‘ä½¿ç”¨ï¼ŒåŸºæœ¬éƒ½ç”¨parameterTypeæ›¿ä»£\nparameterMapæ ‡ç­¾å¯ä»¥ç”¨æ¥å®šä¹‰å‚æ•°ç»„ï¼Œå¯ä»¥ä¸ºå‚æ•°ç»„æŒ‡å®šIDã€å‚æ•°ç±»å‹\nä¾‹å¦‚æœ‰ä¸€ä¸ªbeanæ˜¯è¿™æ ·çš„ï¼š\npublic class ArgBean { private String name; private int age; // å¿½ç•¥ getter å’Œ setter } ä¸‹é¢ä½¿ç”¨ \u0026lt;parameterMap\u0026gt; å°†å‚æ•° ArgBean å¯¹è±¡è¿›è¡Œæ˜ å°„\n\u0026lt;parameterMap id=\u0026#34;PARAM_MAP\u0026#34; type=\u0026#34;com.hxstrive.mybatis.parameter.demo2.ArgBean\u0026#34;\u0026gt; \u0026lt;parameter property=\u0026#34;age\u0026#34; javaType=\u0026#34;integer\u0026#34; /\u0026gt; \u0026lt;parameter property=\u0026#34;name\u0026#34; javaType=\u0026#34;String\u0026#34; /\u0026gt; \u0026lt;/parameterMap\u0026gt; sqlï¼ˆsqlç‰‡æ®µæ ‡ç­¾ï¼‰/includeï¼ˆç‰‡æ®µæ’å…¥æ ‡ç­¾ï¼‰ï¼š é‡å¤çš„SQLé¢„è®¡æ°¸è¿œä¸å¯é¿å…ï¼Œ\u0026lt;sql\u0026gt;æ ‡ç­¾å°±æ˜¯ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„\nå…¶ä¸­ \u0026lt;sql\u0026gt; ä¸º sql ç‰‡æ®µæ ‡ç­¾ï¼Œé€šè¿‡ \u0026lt;include\u0026gt; æ ‡ç­¾å¼•å…¥ sql ç‰‡æ®µ\nä¾‹å¦‚ï¼š\n\u0026lt;mapper namespace=\u0026#34;com.klza.dao.UserMapper\u0026#34;\u0026gt; \u0026lt;sql id=\u0026#34;sqlUserParameter\u0026#34;\u0026gt;id,username,password\u0026lt;/sql\u0026gt; \u0026lt;select id=\u0026#34;getUserList\u0026#34; resultType=\u0026#34;user\u0026#34;\u0026gt; select \u0026lt;include refid=\u0026#34;sqlUserParameter\u0026#34;/\u0026gt; from test.user \u0026lt;/select\u0026gt; \u0026lt;/mapper\u0026gt; \u0026lt;selectKey\u0026gt; ä¸ºä¸æ”¯æŒè‡ªå¢çš„ä¸»é”®ç”Ÿæˆç­–ç•¥æ ‡ç­¾\n\u0026lt;insert id=\u0026#34;insert\u0026#34; parameterType=\u0026#34;com.pinyougou.pojo.TbGoods\u0026#34; \u0026gt; \u0026lt;selectKey resultType=\u0026#34;java.lang.Long\u0026#34; order=\u0026#34;AFTER\u0026#34; keyProperty=\u0026#34;id\u0026#34;\u0026gt; SELECT LAST_INSERT_ID() AS id \u0026lt;/selectKey\u0026gt; insert into tb_goods (id, seller_id ) values (#{id,jdbcType=BIGINT}, #{sellerId,jdbcType=VARCHAR} \u0026lt;/insert\u0026gt; Dao æ¥å£çš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼ŸDao æ¥å£é‡Œçš„æ–¹æ³•ï¼Œå‚æ•°ä¸åŒæ—¶ï¼Œæ–¹æ³•èƒ½é‡è½½å—ï¼Ÿ # æ³¨ï¼šè¿™é“é¢˜ä¹Ÿæ˜¯äº¬ä¸œé¢è¯•å®˜é¢è¯•æˆ‘è¢«é—®çš„ã€‚\nç­”ï¼šæœ€ä½³å®è·µä¸­ï¼Œé€šå¸¸ä¸€ä¸ª xml æ˜ å°„æ–‡ä»¶ï¼Œéƒ½ä¼šå†™ä¸€ä¸ª Dao æ¥å£ä¸ä¹‹å¯¹åº”ã€‚Dao æ¥å£å°±æ˜¯äººä»¬å¸¸è¯´çš„ Mapper æ¥å£ï¼Œæ¥å£çš„å…¨é™åï¼Œå°±æ˜¯æ˜ å°„æ–‡ä»¶ä¸­çš„ namespace çš„å€¼ï¼Œæ¥å£çš„æ–¹æ³•åï¼Œå°±æ˜¯æ˜ å°„æ–‡ä»¶ä¸­ MappedStatement çš„ id å€¼ï¼Œæ¥å£æ–¹æ³•å†…çš„å‚æ•°ï¼Œå°±æ˜¯ä¼ é€’ç»™ sql çš„å‚æ•°ã€‚ Mapper æ¥å£æ˜¯æ²¡æœ‰å®ç°ç±»çš„ï¼Œå½“è°ƒç”¨æ¥å£æ–¹æ³•æ—¶ï¼Œæ¥å£å…¨é™å+æ–¹æ³•åæ‹¼æ¥å­—ç¬¦ä¸²ä½œä¸º key å€¼ï¼Œå¯å”¯ä¸€å®šä½ä¸€ä¸ª MappedStatement ï¼Œä¸¾ä¾‹ï¼š com.mybatis3.mappers. StudentDao.findStudentById ï¼Œå¯ä»¥å”¯ä¸€æ‰¾åˆ° namespace ä¸º com.mybatis3.mappers. StudentDao ä¸‹é¢ id = findStudentById çš„ MappedStatement ã€‚åœ¨ MyBatis ä¸­ï¼Œæ¯ä¸€ä¸ª \u0026lt;select\u0026gt; ã€ \u0026lt;insert\u0026gt; ã€ \u0026lt;update\u0026gt; ã€ \u0026lt;delete\u0026gt; æ ‡ç­¾ï¼Œéƒ½ä¼šè¢«è§£æä¸ºä¸€ä¸ª MappedStatement å¯¹è±¡ã€‚\nDao æ¥å£é‡Œçš„æ–¹æ³•ï¼Œæ˜¯ä¸èƒ½é‡è½½çš„ï¼Œå› ä¸ºæ˜¯å…¨é™å+æ–¹æ³•åçš„ä¿å­˜å’Œå¯»æ‰¾ç­–ç•¥ã€‚\nDao æ¥å£é‡Œçš„æ–¹æ³•å¯ä»¥é‡è½½ï¼Œä½†æ˜¯ Mybatis çš„ xml é‡Œé¢çš„ ID ä¸å…è®¸é‡å¤ã€‚\nMybatis ç‰ˆæœ¬ 3.3.0ï¼Œäº²æµ‹å¦‚ä¸‹ï¼š\n/** * Mapperæ¥å£é‡Œé¢æ–¹æ³•é‡è½½ */ public interface StuMapper { List\u0026lt;Student\u0026gt; getAllStu(); List\u0026lt;Student\u0026gt; getAllStu(@Param(\u0026#34;id\u0026#34;) Integer id); } ç„¶ååœ¨ StuMapper.xml ä¸­åˆ©ç”¨ Mybatis çš„åŠ¨æ€ sql å°±å¯ä»¥å®ç°ã€‚\n\u0026lt;select id=\u0026#34;getAllStu\u0026#34; resultType=\u0026#34;com.pojo.Student\u0026#34;\u0026gt; select * from student \u0026lt;where\u0026gt; \u0026lt;if test=\u0026#34;id != null\u0026#34;\u0026gt; id = #{id} \u0026lt;/if\u0026gt; \u0026lt;/where\u0026gt; \u0026lt;/select\u0026gt; èƒ½æ­£å¸¸è¿è¡Œï¼Œå¹¶èƒ½å¾—åˆ°ç›¸åº”çš„ç»“æœï¼Œè¿™æ ·å°±å®ç°äº†åœ¨ Dao æ¥å£ä¸­å†™é‡è½½æ–¹æ³•ã€‚\nMybatis çš„ Dao æ¥å£å¯ä»¥æœ‰å¤šä¸ªé‡è½½æ–¹æ³•ï¼Œä½†æ˜¯å¤šä¸ªæ¥å£å¯¹åº”çš„æ˜ å°„å¿…é¡»åªæœ‰ä¸€ä¸ªï¼Œå¦åˆ™å¯åŠ¨ä¼šæŠ¥é”™ã€‚\nç›¸å…³ issue ï¼šæ›´æ­£ï¼šDao æ¥å£é‡Œçš„æ–¹æ³•å¯ä»¥é‡è½½ï¼Œä½†æ˜¯ Mybatis çš„ xml é‡Œé¢çš„ ID ä¸å…è®¸é‡å¤ï¼ã€‚\nDao æ¥å£çš„å·¥ä½œåŸç†æ˜¯ JDK åŠ¨æ€ä»£ç†ï¼ŒMyBatis è¿è¡Œæ—¶ä¼šä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ä¸º Dao æ¥å£ç”Ÿæˆä»£ç† proxy å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡ proxy ä¼šæ‹¦æˆªæ¥å£æ–¹æ³•ï¼Œè½¬è€Œæ‰§è¡Œ MappedStatement æ‰€ä»£è¡¨çš„ sqlï¼Œç„¶åå°† sql æ‰§è¡Œç»“æœè¿”å›ã€‚\nè¡¥å…… ï¼š\nDao æ¥å£æ–¹æ³•å¯ä»¥é‡è½½ï¼Œä½†æ˜¯éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š\nä»…æœ‰ä¸€ä¸ªæ— å‚æ–¹æ³•å’Œä¸€ä¸ªæœ‰å‚æ–¹æ³• (å¤šä¸ªå‚æ•°)çš„æ–¹æ³•ä¸­ï¼Œå‚æ•°æ•°é‡å¿…é¡»(å’Œxmlä¸­çš„)ä¸€è‡´ã€‚ä¸”ä½¿ç”¨ç›¸åŒçš„ @Param ï¼Œæˆ–è€…ä½¿ç”¨ param1 è¿™ç§ æµ‹è¯•å¦‚ä¸‹ ï¼š\nPersonDao.java Person queryById(); Person queryById(@Param(\u0026#34;id\u0026#34;) Long id); Person queryById(@Param(\u0026#34;id\u0026#34;) Long id, @Param(\u0026#34;name\u0026#34;) String name); PersonMapper.xml \u0026lt;select id=\u0026#34;queryById\u0026#34; resultMap=\u0026#34;PersonMap\u0026#34;\u0026gt; select id, name, age, address from person \u0026lt;where\u0026gt; \u0026lt;if test=\u0026#34;id != null\u0026#34;\u0026gt; id = #{id} \u0026lt;/if\u0026gt; \u0026lt;if test=\u0026#34;name != null and name != \u0026#39;\u0026#39;\u0026#34;\u0026gt; and name = #{name} \u0026lt;/if\u0026gt; \u0026lt;/where\u0026gt; limit 1 \u0026lt;/select\u0026gt; org.apache.ibatis.scripting.xmltags. DynamicContext. ContextAccessor#getProperty æ–¹æ³•ç”¨äºè·å– \u0026lt;if\u0026gt; æ ‡ç­¾ä¸­çš„æ¡ä»¶å€¼\nContextAccessor è¿™ä¸ªä¿®é¥°ç¬¦ä¸ºé»˜è®¤ï¼ˆåŒä¸€ä¸ªåŒ…å†…ï¼‰\npublic Object getProperty(Map context, Object target, Object name) { Map map = (Map) target; Object result = map.get(name); if (map.containsKey(name) || result != null) { return result; } Object parameterObject = map.get(PARAMETER_OBJECT_KEY); if (parameterObject instanceof Map) { return ((Map)parameterObject).get(name); } return null; } parameterObject ä¸º mapï¼Œå­˜æ”¾çš„æ˜¯ Dao æ¥å£ä¸­å‚æ•°ç›¸å…³ä¿¡æ¯ã€‚\n((Map)parameterObject).get(name) æ–¹æ³•å¦‚ä¸‹\npublic V get(Object key) { if (!super.containsKey(key)) { throw new BindingException(\u0026#34;Parameter \u0026#39;\u0026#34; + key + \u0026#34;\u0026#39; not found. Available parameters are \u0026#34; + keySet()); } return super.get(key); } queryById()æ–¹æ³•æ‰§è¡Œæ—¶ï¼ŒparameterObjectä¸º nullï¼ŒgetPropertyæ–¹æ³•è¿”å› null å€¼ï¼Œ\u0026lt;if\u0026gt;æ ‡ç­¾è·å–çš„æ‰€æœ‰æ¡ä»¶å€¼éƒ½ä¸º nullï¼Œæ‰€æœ‰æ¡ä»¶ä¸æˆç«‹ï¼ŒåŠ¨æ€ sql å¯ä»¥æ­£å¸¸æ‰§è¡Œã€‚ queryById(1L)æ–¹æ³•æ‰§è¡Œæ—¶ï¼ŒparameterObjectä¸º mapï¼ŒåŒ…å«äº†**idå’Œparam1**ä¸¤ä¸ª key å€¼ã€‚å½“è·å–\u0026lt;if\u0026gt;æ ‡ç­¾ä¸­nameçš„å±æ€§å€¼æ—¶ï¼Œè¿›å…¥((Map)parameterObject).get(name)æ–¹æ³•ä¸­ï¼Œmap ä¸­ key ä¸åŒ…å«nameï¼Œæ‰€ä»¥æŠ›å‡ºå¼‚å¸¸ã€‚ queryById(1L,\u0026quot;1\u0026quot;)æ–¹æ³•æ‰§è¡Œæ—¶ï¼ŒparameterObjectä¸­åŒ…å«id,param1,name,param2å››ä¸ª key å€¼ï¼Œidå’Œnameå±æ€§éƒ½å¯ä»¥è·å–åˆ°ï¼ŒåŠ¨æ€ sql æ­£å¸¸æ‰§è¡Œã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œifçš„testä¸€å®šæ˜¯ä¼šè¿›è¡Œåˆ¤æ–­çš„(é™¤éæ•´ä¸ªparameterObjectä¸ºnull)ã€‚ä½†æ˜¯å¦‚æœè¿™é‡Œé¢çš„param ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å¼‚å¸¸ (BindingException)\nMyBatis æ˜¯å¦‚ä½•è¿›è¡Œåˆ†é¡µçš„ï¼Ÿåˆ†é¡µæ’ä»¶çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ # æ³¨ï¼šæˆ‘å‡ºçš„ã€‚\nç­”ï¼š(1) MyBatis ä½¿ç”¨ RowBounds å¯¹è±¡è¿›è¡Œåˆ†é¡µï¼Œå®ƒæ˜¯é’ˆå¯¹ ResultSet ç»“æœé›†æ‰§è¡Œçš„å†…å­˜åˆ†é¡µï¼Œè€Œéç‰©ç†åˆ†é¡µï¼›\n//ä½¿ç”¨ //Mapperä¸­ List\u0026lt;User\u0026gt; getUserListLimit(RowBounds rowBounds); //Mapper.xmlå®šä¹‰ ï¼ˆä¸å˜ï¼‰ \u0026lt;select id=\u0026#34;getUserListLimit\u0026#34; resultType=\u0026#34;user\u0026#34;\u0026gt; select * from test.user \u0026lt;/select\u0026gt; //ä½¿ç”¨, å°†ä¼šä»indexä¸º0çš„è®°å½•å¼€å§‹ï¼Œå–ä¸¤æ¡è®°å½• List\u0026lt;User\u0026gt; userListLimit = userMapper.getUserListLimit(new RowBounds(0, 2)); for (User user : userListLimit) { System.out.println(user); } æƒ³è¦ä½¿ç”¨mybatisæ—¥å¿—ï¼Œåªè¦åŠ ä¸Šæ—¥å¿—æ¨¡å—çš„ä¾èµ–å³å¯\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.slf4j\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;slf4j-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.7.30\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- https://mvnrepository.com/artifact/ch.qos.logback/logback-classic --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;ch.qos.logback\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;logback-classic\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.2.3\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; æŸ¥çœ‹ä¸Šé¢çš„æ—¥å¿—å¯ä»¥å‘ç°ï¼Œå®é™…æŸ¥æ‰¾çš„æ˜¯å…¨éƒ¨çš„æ•°æ®(æ²¡æœ‰ä½¿ç”¨ç‰©ç†åˆ†é¡µ)\n14:28:14.938 [main] DEBUG org.mybatis.example.BlogMapper.selectBlog - ==\u0026gt; Preparing: select * from Blog 14:28:14.996 [main] DEBUG org.mybatis.example.BlogMapper.selectBlog - ==\u0026gt; Parameters: [Blog{id=2, name=\u0026#39;n2\u0026#39;, age=20}, Blog{id=3, name=\u0026#39;n3\u0026#39;, age=30}] (2) å¯ä»¥åœ¨ sql å†…ç›´æ¥ä¹¦å†™å¸¦æœ‰ç‰©ç†åˆ†é¡µçš„å‚æ•°æ¥å®Œæˆç‰©ç†åˆ†é¡µåŠŸèƒ½\n(3) ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ†é¡µæ’ä»¶æ¥å®Œæˆç‰©ç†åˆ†é¡µ\nåˆ†é¡µæ’ä»¶çš„åŸºæœ¬åŸç†æ˜¯ä½¿ç”¨ MyBatis æä¾›çš„æ’ä»¶æ¥å£ï¼Œå®ç°è‡ªå®šä¹‰æ’ä»¶ï¼Œåœ¨æ’ä»¶çš„æ‹¦æˆªæ–¹æ³•å†…æ‹¦æˆªå¾…æ‰§è¡Œçš„ sqlï¼Œç„¶åé‡å†™ sqlï¼Œæ ¹æ® dialect æ–¹è¨€ï¼Œæ·»åŠ å¯¹åº”çš„ç‰©ç†åˆ†é¡µè¯­å¥å’Œç‰©ç†åˆ†é¡µå‚æ•°ã€‚\nä¸¾ä¾‹ï¼š select _ from student ï¼Œæ‹¦æˆª sql åé‡å†™ä¸ºï¼š select t._ from ï¼ˆselect \\* from studentï¼‰t limit 0ï¼Œ10\nåˆ†é¡µæ’ä»¶çš„ä½¿ç”¨\næ¥ä¸‹æ¥ä»‹ç»PageHelperæ’ä»¶çš„ä½¿ç”¨ï¼š\nç¬¬ä¸€æ­¥ï¼Œå¼•å…¥ä¾èµ–ï¼š\n\u0026lt;!-- https://mvnrepository.com/artifact/com.github.pagehelper/pagehelper --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.github.pagehelper\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;pagehelper\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.3.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; ç¬¬äºŒæ­¥ï¼Œmybatis-config.xmlé…ç½®æ‹¦æˆªå™¨ï¼š\n\u0026lt;!-- é…ç½®pageHelperæ‹¦æˆªå™¨ --\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin interceptor=\u0026#34;com.github.pagehelper.PageInterceptor\u0026#34;/\u0026gt; \u0026lt;/plugins\u0026gt; ç¬¬ä¸‰æ­¥ï¼Œä»£ç ç¼–å†™ï¼š\nMapperæ¥å£ç±»ï¼š\nList\u0026lt;User\u0026gt; getUserListByPageHelper(); Mapper.xmlï¼š\n\u0026lt;select id=\u0026#34;getUserListByPageHelper\u0026#34; resultType=\u0026#34;user\u0026#34;\u0026gt; select * from test.user \u0026lt;/select\u0026gt; æµ‹è¯•ç¨‹åºï¼š\n// å¼€å¯åˆ†é¡µåŠŸèƒ½ int pageNum = 1; // å½“å‰é¡µç  int pageSize = 2; // æ¯é¡µçš„è®°å½•æ•° PageHelper.startPage(pageNum, pageSize); List\u0026lt;User\u0026gt; userListByPageHelper = userMapper.getUserListByPageHelper(); userListByPageHelper.forEach(System.out::println); ç¬¬å››æ­¥ï¼šè·å–pageInfoä¿¡æ¯ï¼š\npageHelperçœŸæ­£å¼ºå¤§çš„åœ°æ–¹åœ¨äºå®ƒçš„pageInfoåŠŸèƒ½ï¼Œå®ƒå¯ä»¥ä¸ºæˆ‘ä»¬æä¾›è¯¦ç»†çš„åˆ†é¡µæ•°æ®ï¼š\nä¾‹å¦‚ï¼š\n// å¼€å¯åˆ†é¡µåŠŸèƒ½ int pageNum = 2; // å½“å‰é¡µç  int pageSize = 5; // æ¯é¡µçš„è®°å½•æ•° PageHelper.startPage(pageNum, pageSize); List\u0026lt;User\u0026gt; userListByPageHelper = userMapper.getUserListByPageHelper(); // è®¾ç½®å¯¼èˆªçš„å¡ç‰‡æ•°ä¸º3 PageInfo\u0026lt;User\u0026gt; userPageInfo = new PageInfo\u0026lt;\u0026gt;(userListByPageHelper, 3); System.out.println(userPageInfo); /* * PageInfo{pageNum=2, pageSize=5, size=5, startRow=6, endRow=10, total=1004, pages=201, * list=Page{count=true, pageNum=2, pageSize=5, startRow=5, endRow=10, total=1004, pages=201, reasonable=false, pageSizeZero=false} * [User(id=6, username=Cheng Zhennan, password=Jx3SLGXeS4), User(id=7, username=Thelma Hernandez, password=VxVO6dEgym), User(id=8, username=Emma Wood, password=XljUnUrnFZ), User(id=9, username=Kikuchi Akina, password=IgditeatR7), User(id=10, username=Miura Kenta, password=2CbmTGczZv)], * prePage=1, nextPage=3, isFirstPage=false, isLastPage=false, hasPreviousPage=true, hasNextPage=true, navigatePages=3, navigateFirstPage=1, navigateLastPage=3, navigatepageNums=[1, 2, 3]} ç®€è¿° MyBatis çš„æ’ä»¶è¿è¡ŒåŸç†ï¼Œä»¥åŠå¦‚ä½•ç¼–å†™ä¸€ä¸ªæ’ä»¶ã€‚ # æ³¨ï¼šæˆ‘å‡ºçš„ã€‚\nç­”ï¼šMyBatis ä»…å¯ä»¥ç¼–å†™é’ˆå¯¹ ParameterHandler ã€ ResultSetHandler ã€ StatementHandler ã€ Executor è¿™ 4 ç§æ¥å£çš„æ’ä»¶ï¼ŒMyBatis ä½¿ç”¨ JDK çš„åŠ¨æ€ä»£ç†ï¼Œä¸ºéœ€è¦æ‹¦æˆªçš„æ¥å£ç”Ÿæˆä»£ç†å¯¹è±¡ä»¥å®ç°æ¥å£æ–¹æ³•æ‹¦æˆªåŠŸèƒ½ï¼Œæ¯å½“æ‰§è¡Œè¿™ 4 ç§æ¥å£å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œå°±ä¼šè¿›å…¥æ‹¦æˆªæ–¹æ³•ï¼Œå…·ä½“å°±æ˜¯ InvocationHandler çš„ invoke() æ–¹æ³•ï¼Œå½“ç„¶ï¼Œåªä¼šæ‹¦æˆªé‚£äº›ä½ æŒ‡å®šéœ€è¦æ‹¦æˆªçš„æ–¹æ³•ã€‚\nå®ç° MyBatis çš„ Interceptor æ¥å£å¹¶å¤å†™ intercept() æ–¹æ³•ï¼Œç„¶ååœ¨ç»™æ’ä»¶ç¼–å†™æ³¨è§£ï¼ŒæŒ‡å®šè¦æ‹¦æˆªå“ªä¸€ä¸ªæ¥å£çš„å“ªäº›æ–¹æ³•å³å¯ï¼Œè®°ä½ï¼Œåˆ«å¿˜äº†åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ä½ ç¼–å†™çš„æ’ä»¶ã€‚\nMyBatis æ‰§è¡Œæ‰¹é‡æ’å…¥ï¼Œèƒ½è¿”å›æ•°æ®åº“ä¸»é”®åˆ—è¡¨å—ï¼Ÿ # æ³¨ï¼šæˆ‘å‡ºçš„ã€‚\nç­”ï¼šèƒ½ï¼ŒJDBC éƒ½èƒ½ï¼ŒMyBatis å½“ç„¶ä¹Ÿèƒ½ã€‚\nMyBatis åŠ¨æ€ sql æ˜¯åšä»€ä¹ˆçš„ï¼Ÿéƒ½æœ‰å“ªäº›åŠ¨æ€ sqlï¼Ÿèƒ½ç®€è¿°ä¸€ä¸‹åŠ¨æ€ sql çš„æ‰§è¡ŒåŸç†ä¸ï¼Ÿ # æ³¨ï¼šæˆ‘å‡ºçš„ã€‚\nç­”ï¼šMyBatis åŠ¨æ€ sql å¯ä»¥è®©æˆ‘ä»¬åœ¨ xml æ˜ å°„æ–‡ä»¶å†…ï¼Œä»¥æ ‡ç­¾çš„å½¢å¼ç¼–å†™åŠ¨æ€ sqlï¼Œå®Œæˆé€»è¾‘åˆ¤æ–­å’ŒåŠ¨æ€æ‹¼æ¥ sql çš„åŠŸèƒ½ã€‚å…¶æ‰§è¡ŒåŸç†ä¸ºï¼Œä½¿ç”¨ OGNL ä» sql å‚æ•°å¯¹è±¡ä¸­è®¡ç®—è¡¨è¾¾å¼çš„å€¼ï¼Œæ ¹æ®è¡¨è¾¾å¼çš„å€¼åŠ¨æ€æ‹¼æ¥ sqlï¼Œä»¥æ­¤æ¥å®ŒæˆåŠ¨æ€ sql çš„åŠŸèƒ½ã€‚\nMyBatis æä¾›äº† 9 ç§åŠ¨æ€ sql æ ‡ç­¾:\n\u0026lt;if\u0026gt;\u0026lt;/if\u0026gt; \u0026lt;where\u0026gt;\u0026lt;/where\u0026gt;(trim,set) \u0026lt;choose\u0026gt;\u0026lt;/choose\u0026gt;ï¼ˆwhen, otherwiseï¼‰ \u0026lt;foreach\u0026gt;\u0026lt;/foreach\u0026gt; \u0026lt;bind/\u0026gt; å…³äº MyBatis åŠ¨æ€ SQL çš„è¯¦ç»†ä»‹ç»ï¼Œè¯·çœ‹è¿™ç¯‡æ–‡ç« ï¼šMybatis ç³»åˆ—å…¨è§£ï¼ˆå…«ï¼‰ï¼šMybatis çš„ 9 å¤§åŠ¨æ€ SQL æ ‡ç­¾ä½ çŸ¥é“å‡ ä¸ªï¼Ÿ ã€‚\nå…³äºè¿™äº›åŠ¨æ€ SQL çš„å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼Œè¯·çœ‹è¿™ç¯‡æ–‡ç« ï¼šMybatisã€13ã€‘\u0026ndash; Mybatis åŠ¨æ€ sql æ ‡ç­¾æ€ä¹ˆä½¿ç”¨ï¼Ÿ\nMyBatis æ˜¯å¦‚ä½•å°† sql æ‰§è¡Œç»“æœå°è£…ä¸ºç›®æ ‡å¯¹è±¡å¹¶è¿”å›çš„ï¼Ÿéƒ½æœ‰å“ªäº›æ˜ å°„å½¢å¼ï¼Ÿ # æ³¨ï¼šæˆ‘å‡ºçš„ã€‚\nç­”ï¼šç¬¬ä¸€ç§æ˜¯ä½¿ç”¨ \u0026lt;resultMap\u0026gt; æ ‡ç­¾ï¼Œé€ä¸€å®šä¹‰åˆ—åå’Œå¯¹è±¡å±æ€§åä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚ç¬¬äºŒç§æ˜¯ä½¿ç”¨ sql åˆ—çš„åˆ«ååŠŸèƒ½ï¼Œå°†åˆ—åˆ«åä¹¦å†™ä¸ºå¯¹è±¡å±æ€§åï¼Œæ¯”å¦‚ T_NAME AS NAMEï¼Œå¯¹è±¡å±æ€§åä¸€èˆ¬æ˜¯ nameï¼Œå°å†™ï¼Œä½†æ˜¯åˆ—åä¸åŒºåˆ†å¤§å°å†™ï¼ŒMyBatis ä¼šå¿½ç•¥åˆ—åå¤§å°å†™ï¼Œæ™ºèƒ½æ‰¾åˆ°ä¸ä¹‹å¯¹åº”å¯¹è±¡å±æ€§åï¼Œä½ ç”šè‡³å¯ä»¥å†™æˆ T_NAME AS NaMeï¼ŒMyBatis ä¸€æ ·å¯ä»¥æ­£å¸¸å·¥ä½œã€‚\næœ‰äº†åˆ—åä¸å±æ€§åçš„æ˜ å°„å…³ç³»åï¼ŒMyBatis é€šè¿‡åå°„åˆ›å»ºå¯¹è±¡ï¼ŒåŒæ—¶ä½¿ç”¨åå°„ ç»™å¯¹è±¡çš„å±æ€§é€ä¸€èµ‹å€¼å¹¶è¿”å›ï¼Œé‚£äº›æ‰¾ä¸åˆ°æ˜ å°„å…³ç³»çš„å±æ€§ï¼Œæ˜¯æ— æ³•å®Œæˆèµ‹å€¼çš„ã€‚\nMyBatis èƒ½æ‰§è¡Œä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šçš„å…³è”æŸ¥è¯¢å—ï¼Ÿéƒ½æœ‰å“ªäº›å®ç°æ–¹å¼ï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚ã€å®é™…æ²¡æœ‰ç”¨è¿‡ã€‘ # æ³¨ï¼šæˆ‘å‡ºçš„ã€‚\nç­”ï¼šèƒ½ï¼ŒMyBatis ä¸ä»…å¯ä»¥æ‰§è¡Œä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šçš„å…³è”æŸ¥è¯¢ï¼Œè¿˜å¯ä»¥æ‰§è¡Œå¤šå¯¹ä¸€ï¼Œå¤šå¯¹å¤šçš„å…³è”æŸ¥è¯¢ï¼Œå¤šå¯¹ä¸€æŸ¥è¯¢ï¼Œå…¶å®å°±æ˜¯ä¸€å¯¹ä¸€æŸ¥è¯¢ï¼Œåªéœ€è¦æŠŠ selectOne() ä¿®æ”¹ä¸º selectList() å³å¯ï¼›å¤šå¯¹å¤šæŸ¥è¯¢ï¼Œå…¶å®å°±æ˜¯ä¸€å¯¹å¤šæŸ¥è¯¢ï¼Œåªéœ€è¦æŠŠ selectOne() ä¿®æ”¹ä¸º selectList() å³å¯ã€‚\nå…³è”å¯¹è±¡æŸ¥è¯¢ï¼Œæœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œä¸€ç§æ˜¯å•ç‹¬å‘é€ä¸€ä¸ª sql å»æŸ¥è¯¢å…³è”å¯¹è±¡ï¼Œèµ‹ç»™ä¸»å¯¹è±¡ï¼Œç„¶åè¿”å›ä¸»å¯¹è±¡ã€‚å¦ä¸€ç§æ˜¯ä½¿ç”¨åµŒå¥—æŸ¥è¯¢ï¼ŒåµŒå¥—æŸ¥è¯¢çš„å«ä¹‰ä¸ºä½¿ç”¨ join æŸ¥è¯¢ï¼Œä¸€éƒ¨åˆ†åˆ—æ˜¯ A å¯¹è±¡çš„å±æ€§å€¼ï¼Œå¦å¤–ä¸€éƒ¨åˆ†åˆ—æ˜¯å…³è”å¯¹è±¡ B çš„å±æ€§å€¼ï¼Œå¥½å¤„æ˜¯åªå‘ä¸€ä¸ª sql æŸ¥è¯¢ï¼Œå°±å¯ä»¥æŠŠä¸»å¯¹è±¡å’Œå…¶å…³è”å¯¹è±¡æŸ¥å‡ºæ¥ã€‚\né‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œjoin æŸ¥è¯¢å‡ºæ¥ 100 æ¡è®°å½•ï¼Œå¦‚ä½•ç¡®å®šä¸»å¯¹è±¡æ˜¯ 5 ä¸ªï¼Œè€Œä¸æ˜¯ 100 ä¸ªï¼Ÿå…¶å»é‡å¤çš„åŸç†æ˜¯ \u0026lt;resultMap\u0026gt; æ ‡ç­¾å†…çš„ \u0026lt;id\u0026gt; å­æ ‡ç­¾ï¼ŒæŒ‡å®šäº†å”¯ä¸€ç¡®å®šä¸€æ¡è®°å½•çš„ id åˆ—ï¼ŒMyBatis æ ¹æ® \u0026lt;id\u0026gt; åˆ—å€¼æ¥å®Œæˆ 100 æ¡è®°å½•çš„å»é‡å¤åŠŸèƒ½ï¼Œ \u0026lt;id\u0026gt; å¯ä»¥æœ‰å¤šä¸ªï¼Œä»£è¡¨äº†è”åˆä¸»é”®çš„è¯­æ„ã€‚\nåŒæ ·ä¸»å¯¹è±¡çš„å…³è”å¯¹è±¡ï¼Œä¹Ÿæ˜¯æ ¹æ®è¿™ä¸ªåŸç†å»é‡å¤çš„ï¼Œå°½ç®¡ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸»å¯¹è±¡ä¼šæœ‰é‡å¤è®°å½•ï¼Œå…³è”å¯¹è±¡ä¸€èˆ¬ä¸ä¼šé‡å¤ã€‚\nä¸¾ä¾‹ï¼šä¸‹é¢ join æŸ¥è¯¢å‡ºæ¥ 6 æ¡è®°å½•ï¼Œä¸€ã€äºŒåˆ—æ˜¯ Teacher å¯¹è±¡åˆ—ï¼Œç¬¬ä¸‰åˆ—ä¸º Student å¯¹è±¡åˆ—ï¼ŒMyBatis å»é‡å¤å¤„ç†åï¼Œç»“æœä¸º 1 ä¸ªè€å¸ˆ 6 ä¸ªå­¦ç”Ÿï¼Œè€Œä¸æ˜¯ 6 ä¸ªè€å¸ˆ 6 ä¸ªå­¦ç”Ÿã€‚\nt_id t_name s_id 1 teacher 38 1 teacher 39 1 teacher 40 1 teacher 41 1 teacher 42 1 teacher 43 MyBatis æ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Ÿå¦‚æœæ”¯æŒï¼Œå®ƒçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ # æ³¨ï¼šæˆ‘å‡ºçš„ã€‚\nç­”ï¼šMyBatis ä»…æ”¯æŒ association å…³è”å¯¹è±¡å’Œ collection å…³è”é›†åˆå¯¹è±¡çš„å»¶è¿ŸåŠ è½½ï¼Œassociation æŒ‡çš„å°±æ˜¯ä¸€å¯¹ä¸€ï¼Œcollection æŒ‡çš„å°±æ˜¯ä¸€å¯¹å¤šæŸ¥è¯¢ã€‚åœ¨ MyBatis é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é…ç½®æ˜¯å¦å¯ç”¨å»¶è¿ŸåŠ è½½ lazyLoadingEnabled=true|falseã€‚\nå®ƒçš„åŸç†æ˜¯ï¼Œä½¿ç”¨ CGLIB åˆ›å»ºç›®æ ‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼Œå½“è°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ï¼Œè¿›å…¥æ‹¦æˆªå™¨æ–¹æ³•ï¼Œæ¯”å¦‚è°ƒç”¨ a.getB().getName() ï¼Œæ‹¦æˆªå™¨ invoke() æ–¹æ³•å‘ç° a.getB() æ˜¯ null å€¼ï¼Œé‚£ä¹ˆå°±ä¼šå•ç‹¬å‘é€äº‹å…ˆä¿å­˜å¥½çš„æŸ¥è¯¢å…³è” B å¯¹è±¡çš„ sqlï¼ŒæŠŠ B æŸ¥è¯¢ä¸Šæ¥ï¼Œç„¶åè°ƒç”¨ a.setB(b)ï¼Œäºæ˜¯ a çš„å¯¹è±¡ b å±æ€§å°±æœ‰å€¼äº†ï¼Œæ¥ç€å®Œæˆ a.getB().getName() æ–¹æ³•çš„è°ƒç”¨ã€‚è¿™å°±æ˜¯å»¶è¿ŸåŠ è½½çš„åŸºæœ¬åŸç†ã€‚\nå½“ç„¶äº†ï¼Œä¸å…‰æ˜¯ MyBatisï¼Œå‡ ä¹æ‰€æœ‰çš„åŒ…æ‹¬ Hibernateï¼Œæ”¯æŒå»¶è¿ŸåŠ è½½çš„åŸç†éƒ½æ˜¯ä¸€æ ·çš„ã€‚\nMyBatis çš„ xml æ˜ å°„æ–‡ä»¶ä¸­ï¼Œä¸åŒçš„ xml æ˜ å°„æ–‡ä»¶ï¼Œid æ˜¯å¦å¯ä»¥é‡å¤ï¼Ÿ # æ³¨ï¼šæˆ‘å‡ºçš„ã€‚\nç­”ï¼šä¸åŒçš„ xml æ˜ å°„æ–‡ä»¶ï¼Œå¦‚æœé…ç½®äº† namespaceï¼Œé‚£ä¹ˆ id å¯ä»¥é‡å¤ï¼›å¦‚æœæ²¡æœ‰é…ç½® namespaceï¼Œé‚£ä¹ˆ id ä¸èƒ½é‡å¤ï¼›æ¯•ç«Ÿ namespace ä¸æ˜¯å¿…é¡»çš„ï¼Œåªæ˜¯æœ€ä½³å®è·µè€Œå·²ã€‚\nåŸå› å°±æ˜¯ namespace+id æ˜¯ä½œä¸º Map\u0026lt;String, MappedStatement\u0026gt; çš„ key ä½¿ç”¨çš„ï¼Œå¦‚æœæ²¡æœ‰ namespaceï¼Œå°±å‰©ä¸‹ idï¼Œé‚£ä¹ˆï¼Œid é‡å¤ä¼šå¯¼è‡´æ•°æ®äº’ç›¸è¦†ç›–ã€‚æœ‰äº† namespaceï¼Œè‡ªç„¶ id å°±å¯ä»¥é‡å¤ï¼Œnamespace ä¸åŒï¼Œnamespace+id è‡ªç„¶ä¹Ÿå°±ä¸åŒã€‚\nMyBatis ä¸­å¦‚ä½•æ‰§è¡Œæ‰¹å¤„ç†ï¼Ÿ # æ³¨ï¼šæˆ‘å‡ºçš„ã€‚\nç­”ï¼šä½¿ç”¨ BatchExecutor å®Œæˆæ‰¹å¤„ç†ã€‚\nMyBatis éƒ½æœ‰å“ªäº› Executor æ‰§è¡Œå™¨ï¼Ÿå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ # æ³¨ï¼šæˆ‘å‡ºçš„\nç­”ï¼šMyBatis æœ‰ä¸‰ç§åŸºæœ¬çš„ Executor æ‰§è¡Œå™¨ï¼š\nSimpleExecutorï¼š æ¯æ‰§è¡Œä¸€æ¬¡ update æˆ– selectï¼Œå°±å¼€å¯ä¸€ä¸ª Statement å¯¹è±¡ï¼Œç”¨å®Œç«‹åˆ»å…³é—­ Statement å¯¹è±¡ã€‚ ReuseExecutorï¼š æ‰§è¡Œ update æˆ– selectï¼Œä»¥ sql ä½œä¸º key æŸ¥æ‰¾ Statement å¯¹è±¡ï¼Œå­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±åˆ›å»ºï¼Œç”¨å®Œåï¼Œä¸å…³é—­ Statement å¯¹è±¡ï¼Œè€Œæ˜¯æ”¾ç½®äº Map\u0026lt;String, Statement\u0026gt;å†…ï¼Œä¾›ä¸‹ä¸€æ¬¡ä½¿ç”¨ã€‚ç®€è¨€ä¹‹ï¼Œå°±æ˜¯é‡å¤ä½¿ç”¨ Statement å¯¹è±¡ã€‚ BatchExecutor ï¼šæ‰§è¡Œ updateï¼ˆæ²¡æœ‰ selectï¼ŒJDBC æ‰¹å¤„ç†ä¸æ”¯æŒ selectï¼‰ï¼Œå°†æ‰€æœ‰ sql éƒ½æ·»åŠ åˆ°æ‰¹å¤„ç†ä¸­ï¼ˆaddBatch()ï¼‰ï¼Œç­‰å¾…ç»Ÿä¸€æ‰§è¡Œï¼ˆexecuteBatch()ï¼‰ï¼Œå®ƒç¼“å­˜äº†å¤šä¸ª Statement å¯¹è±¡ï¼Œæ¯ä¸ª Statement å¯¹è±¡éƒ½æ˜¯ addBatch()å®Œæ¯•åï¼Œç­‰å¾…é€ä¸€æ‰§è¡Œ executeBatch()æ‰¹å¤„ç†ã€‚ä¸ JDBC æ‰¹å¤„ç†ç›¸åŒã€‚ ä½œç”¨èŒƒå›´ï¼šExecutor çš„è¿™äº›ç‰¹ç‚¹ï¼Œéƒ½ä¸¥æ ¼é™åˆ¶åœ¨ SqlSession ç”Ÿå‘½å‘¨æœŸèŒƒå›´å†…ã€‚\nMyBatis ä¸­å¦‚ä½•æŒ‡å®šä½¿ç”¨å“ªä¸€ç§ Executor æ‰§è¡Œå™¨ï¼Ÿ # æ³¨ï¼šæˆ‘å‡ºçš„\nç­”ï¼šåœ¨ MyBatis é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥æŒ‡å®šé»˜è®¤çš„ ExecutorType æ‰§è¡Œå™¨ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨ç»™ DefaultSqlSessionFactory çš„åˆ›å»º SqlSession çš„æ–¹æ³•ä¼ é€’ ExecutorType ç±»å‹å‚æ•°ã€‚\nMyBatis æ˜¯å¦å¯ä»¥æ˜ å°„ Enum æšä¸¾ç±»ï¼Ÿ # æ³¨ï¼šæˆ‘å‡ºçš„\nç­”ï¼šMyBatis å¯ä»¥æ˜ å°„æšä¸¾ç±»ï¼Œä¸å•å¯ä»¥æ˜ å°„æšä¸¾ç±»ï¼ŒMyBatis å¯ä»¥æ˜ å°„ä»»ä½•å¯¹è±¡åˆ°è¡¨çš„ä¸€åˆ—ä¸Šã€‚æ˜ å°„æ–¹å¼ä¸ºè‡ªå®šä¹‰ä¸€ä¸ª TypeHandler ï¼Œå®ç° TypeHandler çš„ setParameter() å’Œ getResult() æ¥å£æ–¹æ³•ã€‚ TypeHandler æœ‰ä¸¤ä¸ªä½œç”¨ï¼š\nä¸€æ˜¯å®Œæˆä» javaType è‡³ jdbcType çš„è½¬æ¢ï¼› äºŒæ˜¯å®Œæˆ jdbcType è‡³ javaType çš„è½¬æ¢ï¼Œä½“ç°ä¸º setParameter() å’Œ getResult() ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«ä»£è¡¨è®¾ç½® sql é—®å·å ä½ç¬¦å‚æ•°å’Œè·å–åˆ—æŸ¥è¯¢ç»“æœã€‚ MyBatis æ˜ å°„æ–‡ä»¶ä¸­ï¼Œå¦‚æœ A æ ‡ç­¾é€šè¿‡ include å¼•ç”¨äº† B æ ‡ç­¾çš„å†…å®¹ï¼Œè¯·é—®ï¼ŒB æ ‡ç­¾èƒ½å¦å®šä¹‰åœ¨ A æ ‡ç­¾çš„åé¢ï¼Œè¿˜æ˜¯è¯´å¿…é¡»å®šä¹‰åœ¨ A æ ‡ç­¾çš„å‰é¢ï¼Ÿ # æ³¨ï¼šæˆ‘å‡ºçš„\nç­”ï¼šè™½ç„¶ MyBatis è§£æ xml æ˜ å°„æ–‡ä»¶æ˜¯æŒ‰ç…§é¡ºåºè§£æçš„ï¼Œä½†æ˜¯ï¼Œè¢«å¼•ç”¨çš„ B æ ‡ç­¾ä¾ç„¶å¯ä»¥å®šä¹‰åœ¨ä»»ä½•åœ°æ–¹ï¼ŒMyBatis éƒ½å¯ä»¥æ­£ç¡®è¯†åˆ«ã€‚\nåŸç†æ˜¯ï¼ŒMyBatis è§£æ A æ ‡ç­¾ï¼Œå‘ç° A æ ‡ç­¾å¼•ç”¨äº† B æ ‡ç­¾ï¼Œä½†æ˜¯ B æ ‡ç­¾å°šæœªè§£æåˆ°ï¼Œå°šä¸å­˜åœ¨ï¼Œæ­¤æ—¶ï¼ŒMyBatis ä¼šå°† A æ ‡ç­¾æ ‡è®°ä¸ºæœªè§£æçŠ¶æ€ï¼Œç„¶åç»§ç»­è§£æä½™ä¸‹çš„æ ‡ç­¾ï¼ŒåŒ…å« B æ ‡ç­¾ï¼Œå¾…æ‰€æœ‰æ ‡ç­¾è§£æå®Œæ¯•ï¼ŒMyBatis ä¼šé‡æ–°è§£æé‚£äº›è¢«æ ‡è®°ä¸ºæœªè§£æçš„æ ‡ç­¾ï¼Œæ­¤æ—¶å†è§£æ A æ ‡ç­¾æ—¶ï¼ŒB æ ‡ç­¾å·²ç»å­˜åœ¨ï¼ŒA æ ‡ç­¾ä¹Ÿå°±å¯ä»¥æ­£å¸¸è§£æå®Œæˆäº†ã€‚\nç®€è¿° MyBatis çš„ xml æ˜ å°„æ–‡ä»¶å’Œ MyBatis å†…éƒ¨æ•°æ®ç»“æ„ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Ÿ[ä¸æ‡‚] # æ³¨ï¼šæˆ‘å‡ºçš„\nç­”ï¼šMyBatis å°†æ‰€æœ‰ xml é…ç½®ä¿¡æ¯éƒ½å°è£…åˆ° All-In-One é‡é‡çº§å¯¹è±¡ Configuration å†…éƒ¨ã€‚åœ¨ xml æ˜ å°„æ–‡ä»¶ä¸­ï¼Œ \u0026lt;parameterMap\u0026gt; æ ‡ç­¾ä¼šè¢«è§£æä¸º ParameterMap å¯¹è±¡ï¼Œå…¶æ¯ä¸ªå­å…ƒç´ ä¼šè¢«è§£æä¸º ParameterMapping å¯¹è±¡ã€‚ \u0026lt;resultMap\u0026gt; æ ‡ç­¾ä¼šè¢«è§£æä¸º ResultMap å¯¹è±¡ï¼Œå…¶æ¯ä¸ªå­å…ƒç´ ä¼šè¢«è§£æä¸º ResultMapping å¯¹è±¡ã€‚æ¯ä¸€ä¸ª \u0026lt;select\u0026gt;ã€\u0026lt;insert\u0026gt;ã€\u0026lt;update\u0026gt;ã€\u0026lt;delete\u0026gt; æ ‡ç­¾å‡ä¼šè¢«è§£æä¸º MappedStatement å¯¹è±¡ï¼Œæ ‡ç­¾å†…çš„ sql ä¼šè¢«è§£æä¸º BoundSql å¯¹è±¡ã€‚\nä¸ºä»€ä¹ˆè¯´ MyBatis æ˜¯åŠè‡ªåŠ¨ ORM æ˜ å°„å·¥å…·ï¼Ÿå®ƒä¸å…¨è‡ªåŠ¨çš„åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ # æ³¨ï¼šæˆ‘å‡ºçš„\nç­”ï¼šHibernate å±äºå…¨è‡ªåŠ¨ ORM æ˜ å°„å·¥å…·ï¼Œä½¿ç”¨ Hibernate æŸ¥è¯¢å…³è”å¯¹è±¡æˆ–è€…å…³è”é›†åˆå¯¹è±¡æ—¶ï¼Œå¯ä»¥æ ¹æ®å¯¹è±¡å…³ç³»æ¨¡å‹ç›´æ¥è·å–ï¼Œæ‰€ä»¥å®ƒæ˜¯å…¨è‡ªåŠ¨çš„ã€‚è€Œ MyBatis åœ¨æŸ¥è¯¢å…³è”å¯¹è±¡æˆ–å…³è”é›†åˆå¯¹è±¡æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨ç¼–å†™ sql æ¥å®Œæˆï¼Œæ‰€ä»¥ï¼Œç§°ä¹‹ä¸ºåŠè‡ªåŠ¨ ORM æ˜ å°„å·¥å…·ã€‚\né¢è¯•é¢˜çœ‹ä¼¼éƒ½å¾ˆç®€å•ï¼Œä½†æ˜¯æƒ³è¦èƒ½æ­£ç¡®å›ç­”ä¸Šæ¥ï¼Œå¿…å®šæ˜¯ç ”ç©¶è¿‡æºç ä¸”æ·±å…¥çš„äººï¼Œè€Œä¸æ˜¯ä»…ä¼šä½¿ç”¨çš„äººæˆ–è€…ç”¨çš„å¾ˆç†Ÿçš„äººï¼Œä»¥ä¸Šæ‰€æœ‰é¢è¯•é¢˜åŠå…¶ç­”æ¡ˆæ‰€æ¶‰åŠçš„å†…å®¹ï¼Œåœ¨æˆ‘çš„ MyBatis ç³»åˆ—åšå®¢ä¸­éƒ½æœ‰è¯¦ç»†è®²è§£å’ŒåŸç†åˆ†æã€‚\n"},{"id":95,"href":"/zh/docs/study/Review/java_guide/lybly_framework/conditional_on_class/","title":"ConditionalOnClasså®è·µ","section":"æ¡†æ¶","content":" ä¸¤ä¸ªæµ‹è¯•æ–¹å‘ # æ–¹å‘1ï¼šä¸¤ä¸ªmavené¡¹ç›® # è¯¦è§gitä¸Šçš„ conditional_on_class_main é¡¹ç›®ä»¥åŠ conditional_on_class2 é¡¹ç›®\nåŸºç¡€mavené¡¹ç›® conditional_on_class2\npomæ–‡ä»¶\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;groupId\u0026gt;org.example\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;conditional_on_class_2\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;/project\u0026gt; javaç±»\npackage com; public class LyReferenceImpl { public String sayWord() { return \u0026#34;hello one\u0026#34;; } } ç®€å•çš„SpringBooté¡¹ç›® conditional_on_class_main\n\u0026lt;!--pomæ–‡ä»¶--\u0026gt; \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;groupId\u0026gt;org.example\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;conditional_on_class_main\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.7.8\u0026lt;/version\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;!--æŠŠ1é…ç½®çš„beanå¼•ç”¨è¿›æ¥--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.example\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;conditional_on_class_2\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;optional\u0026gt;true\u0026lt;/optional\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;excludes\u0026gt; \u0026lt;!-- é»˜è®¤ä¼šå°†conditional_on_class_2 æ‰“åŒ…è¿›å»,ç°åœ¨ä¼šé…ç½®SayExist å¦‚æœæ”¾å¼€æ³¨é‡Š,é‚£ä¹ˆä¼šé…ç½®SayNotExist--\u0026gt; \u0026lt;!--\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.example\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;conditional_on_class_2\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt;--\u0026gt; \u0026lt;/excludes\u0026gt; \u0026lt;jvmArguments\u0026gt;-Dfile.encoding=UTF-8\u0026lt;/jvmArguments\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;repackage\u0026lt;/goal\u0026gt;\u0026lt;!--å¯ä»¥æŠŠä¾èµ–çš„åŒ…éƒ½æ‰“åŒ…åˆ°ç”Ÿæˆçš„JaråŒ…ä¸­ --\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;/project\u0026gt; //ä¸¤ä¸ªé…ç½®ç±» //é…ç½®ç±»1 package com.config; import com.service.ISay; import com.service.SayExist; import org.springframework.boot.autoconfigure.condition.ConditionalOnClass; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration //ä¸è¦æ”¾åœ¨æ–¹æ³•é‡Œé¢,å¦åˆ™ä¼šæŠ¥é”™\u0026#34;java.lang.ArrayStoreException: sun.reflect.annotation.TypeNotPresentExceptionProxy\u0026#34; @ConditionalOnClass(value = com.LyReferenceImpl.class) public class ExistConfiguration { @Bean public ISay getISay1(){ return new SayExist(); } } //é…ç½®ç±»2 package com.config; import com.service.ISay; import com.service.SayNotExist; import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingClass; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration @ConditionalOnMissingClass(\u0026#34;com.LyReferenceImpl\u0026#34;) public class NotExistConfiguration { @Bean public ISay getISay1(){ return new SayNotExist(); } } æ–¹å‘2ï¼š3ä¸ªmavené¡¹ç›®(å»ºè®®ç”¨è¿™ä¸ªç†è§£) # æ³¨æ„ï¼Œè¿™é‡Œå¯èƒ½è¿˜æ¼äº†ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ è¿™ä¸ªconditional_on_class1 çš„configurationä¹‹æ‰€ä»¥èƒ½å¤Ÿè¢«è‡ªåŠ¨è£…é…ï¼Œæ˜¯å› ä¸ºå’Œ conditional_on_class_main1çš„Applicationç±»æ˜¯åŒä¸€ä¸ªåŒ…ï¼Œæ‰€ä»¥ä¸ç”¨ç‰¹æ®Šå¤„ç†ã€‚å¦‚æœæ˜¯å…¶ä»–åŒ…åçš„è¯ï¼Œé‚£ä¹ˆæ˜¯éœ€è¦ç”¨åˆ°spring bootçš„è‡ªåŠ¨è£…é…æœºåˆ¶çš„ï¼šåœ¨conditional_on_class1 å·¥ç¨‹çš„ resources åŒ…ä¸‹åˆ›å»ºMETA-INF/spring.factoriesï¼Œå¹¶å†™ä¸ŠConfigç±»çš„å…¨ç±»å\nè¯¦è§ gitä¸Šçš„ conditional_on_class_main1, conditional_on_class1 é¡¹ç›®ä»¥åŠ conditional_on_class2 é¡¹ç›®\nåŸºç¡€ conditional_on_class2\npomæ–‡ä»¶\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;groupId\u0026gt;org.example\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;conditional_on_class_2\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;/project\u0026gt; javaç±»\npackage com; public class LyReferenceImpl { public String sayWord() { return \u0026#34;hello one\u0026#34;; } } ä»¥LyReferenceImpl.classå­˜ä¸å­˜åœ¨ï¼Œå†³å®šåˆ›å»ºå“ªä¸ªbean\nconditional_on_class_1 pom.xml\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;groupId\u0026gt;org.example\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;conditional_on_class_1\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;!--å¼•å…¥è¢«å¼•ç”¨çš„ç±»ï¼Œåªåœ¨ç¼–è¯‘æœŸå­˜åœ¨--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.example\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;conditional_on_class_2\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;optional\u0026gt;true\u0026lt;/optional\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-autoconfigure --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-autoconfigure\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.7.8\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/project\u0026gt; //æ ¹æ®æ˜¯å¦å­˜åœ¨class_2ä¸­çš„ç±»ï¼Œè¿›è¡Œè‡ªåŠ¨è£…é… @Configuration //ä¸è¦æ”¾åœ¨æ–¹æ³•é‡Œé¢,å¦åˆ™ä¼šæŠ¥é”™\u0026#34;java.lang.ArrayStoreException: sun.reflect.annotation.TypeNotPresentExceptionProxy\u0026#34; @ConditionalOnClass(value = com.LyReferenceImpl.class) public class ExistConfiguration { @Bean public LyEntity lyEntity1(){ return new LyEntity(\u0026#34;å­˜åœ¨\u0026#34;); } } @Configuration @ConditionalOnMissingClass(\u0026#34;com.LyReferenceImpl\u0026#34;) public class NotExistConfiguration { @Bean public LyEntity lyEntity1(){ return new LyEntity(\u0026#34;ä¸å­˜åœ¨\u0026#34;); } } //åŸºç¡€ç±» public class LyEntity { private String name; private Integer age; public LyEntity(String name) { this.name = name; } public String getName() { return name; } public void setName(String name) { this.name = name; } public Integer getAge() { return age; } public void setAge(Integer age) { this.age = age; } } ä½¿ç”¨ åœ¨_mainé¡¹ç›®ä¸­ pom.xml\n\u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.7.8\u0026lt;/version\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;!--æŠŠ1é…ç½®çš„beanå¼•ç”¨è¿›æ¥--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.example\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;conditional_on_class_1\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!--åŠ ä¸Šè¿™ä¸ªåˆ™ä¼šæç¤ºå­˜åœ¨--\u0026gt; \u0026lt;!-- \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.example\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;conditional_on_class_2\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; å¦‚æœä¸å­˜åœ¨class_2ä¸­çš„ç±»ï¼Œåˆ™æç¤ºä¸å­˜åœ¨ï¼›å¦‚æœå­˜åœ¨åˆ™æç¤ºå­˜åœ¨\n@SpringBootApplication @RestController public class MyApplication { @Autowired private LyEntity lyEntity; @RequestMapping(\u0026#34;hello\u0026#34;) public String hello(){ return lyEntity.getName(); } public static void main(String[] args) { SpringApplication.run(MyApplication.class,args); } } "},{"id":96,"href":"/zh/docs/study/Review/java_guide/lybly_framework/ly05ly_springboot-auto-assembly/","title":"SpringBootè‡ªåŠ¨è£…é…åŸç†","section":"æ¡†æ¶","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\næ¯æ¬¡é—®åˆ° Spring Bootï¼Œ é¢è¯•å®˜éå¸¸å–œæ¬¢é—®è¿™ä¸ªé—®é¢˜ï¼šâ€œè®²è¿°ä¸€ä¸‹ SpringBoot è‡ªåŠ¨è£…é…åŸç†ï¼Ÿâ€ã€‚\næˆ‘è§‰å¾—æˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å›ç­”ï¼š\nä»€ä¹ˆæ˜¯ SpringBoot è‡ªåŠ¨è£…é…ï¼Ÿ SpringBoot æ˜¯å¦‚ä½•å®ç°è‡ªåŠ¨è£…é…çš„ï¼Ÿå¦‚ä½•å®ç°æŒ‰éœ€åŠ è½½ï¼Ÿ å¦‚ä½•å®ç°ä¸€ä¸ª Starterï¼Ÿ ç¯‡å¹…é—®é¢˜ï¼Œè¿™ç¯‡æ–‡ç« å¹¶æ²¡æœ‰æ·±å…¥ï¼Œå°ä¼™ä¼´ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ debug çš„æ–¹å¼å»çœ‹çœ‹ SpringBoot è‡ªåŠ¨è£…é…éƒ¨åˆ†çš„æºä»£ç ã€‚\nå‰è¨€ # ä½¿ç”¨è¿‡ Spring çš„å°ä¼™ä¼´ï¼Œä¸€å®šæœ‰è¢« XML é…ç½®ç»Ÿæ²»çš„ææƒ§ã€‚å³ä½¿ Spring åé¢å¼•å…¥äº†åŸºäºæ³¨è§£çš„é…ç½®ï¼Œæˆ‘ä»¬åœ¨å¼€å¯æŸäº› Spring ç‰¹æ€§æˆ–è€…å¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–çš„æ—¶å€™ï¼Œè¿˜æ˜¯éœ€è¦ç”¨ XML æˆ– Java è¿›è¡Œæ˜¾å¼é…ç½®ã€‚\nä¸¾ä¸ªä¾‹å­ã€‚æ²¡æœ‰ Spring Boot çš„æ—¶å€™ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ª RestFul Web æœåŠ¡ï¼Œè¿˜é¦–å…ˆéœ€è¦è¿›è¡Œå¦‚ä¸‹é…ç½®ã€‚\n@Configuration public class RESTConfiguration { @Bean public View jsonTemplate() { MappingJackson2JsonView view = new MappingJackson2JsonView(); view.setPrettyPrint(true); return view; } @Bean public ViewResolver viewResolver() { return new BeanNameViewResolver(); } } spring-servlet.xml \u0026lt;beans xmlns=\u0026#34;http://www.springframework.org/schema/beans\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:context=\u0026#34;http://www.springframework.org/schema/context\u0026#34; xmlns:mvc=\u0026#34;http://www.springframework.org/schema/mvc\u0026#34; xsi:schemaLocation=\u0026#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context/ http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc/ http://www.springframework.org/schema/mvc/spring-mvc.xsd\u0026#34;\u0026gt; \u0026lt;context:component-scan base-package=\u0026#34;com.howtodoinjava.demo\u0026#34; /\u0026gt; \u0026lt;mvc:annotation-driven /\u0026gt; \u0026lt;!-- JSON Support --\u0026gt; \u0026lt;bean name=\u0026#34;viewResolver\u0026#34; class=\u0026#34;org.springframework.web.servlet.view.BeanNameViewResolver\u0026#34;/\u0026gt; \u0026lt;bean name=\u0026#34;jsonTemplate\u0026#34; class=\u0026#34;org.springframework.web.servlet.view.json.MappingJackson2JsonView\u0026#34;/\u0026gt; \u0026lt;/beans\u0026gt; ä½†æ˜¯ï¼ŒSpring Boot é¡¹ç›®ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ ç›¸å…³ä¾èµ–ï¼Œæ— éœ€é…ç½®ï¼Œé€šè¿‡å¯åŠ¨ä¸‹é¢çš„ main æ–¹æ³•å³å¯ã€‚\n@SpringBootApplication public class DemoApplication { public static void main(String[] args) { SpringApplication.run(DemoApplication.class, args); } } å¹¶ä¸”ï¼Œæˆ‘ä»¬é€šè¿‡ Spring Boot çš„å…¨å±€é…ç½®æ–‡ä»¶ application.propertiesæˆ–application.ymlå³å¯å¯¹é¡¹ç›®è¿›è¡Œè®¾ç½®æ¯”å¦‚æ›´æ¢ç«¯å£å·ï¼Œé…ç½® JPA å±æ€§ç­‰ç­‰ã€‚\nä¸ºä»€ä¹ˆ Spring Boot ä½¿ç”¨èµ·æ¥è¿™ä¹ˆé…¸çˆ½å‘¢ï¼Ÿ è¿™å¾—ç›Šäºå…¶è‡ªåŠ¨è£…é…ã€‚è‡ªåŠ¨è£…é…å¯ä»¥è¯´æ˜¯ Spring Boot çš„æ ¸å¿ƒï¼Œé‚£ç©¶ç«Ÿä»€ä¹ˆæ˜¯è‡ªåŠ¨è£…é…å‘¢ï¼Ÿ\nä»€ä¹ˆæ˜¯ SpringBoot è‡ªåŠ¨è£…é…ï¼Ÿ # æˆ‘ä»¬ç°åœ¨æåˆ°è‡ªåŠ¨è£…é…çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šå’Œ Spring Boot è”ç³»åœ¨ä¸€èµ·ã€‚ä½†æ˜¯ï¼Œå®é™…ä¸Š Spring Framework æ—©å°±å®ç°äº†è¿™ä¸ªåŠŸèƒ½ã€‚Spring Boot åªæ˜¯åœ¨å…¶åŸºç¡€ä¸Šï¼Œé€šè¿‡ SPI çš„æ–¹å¼ï¼Œåšäº†è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚\nSpringBoot å®šä¹‰äº†ä¸€å¥—æ¥å£è§„èŒƒï¼Œè¿™å¥—è§„èŒƒè§„å®šï¼šSpringBoot åœ¨å¯åŠ¨æ—¶ä¼šæ‰«æå¤–éƒ¨å¼•ç”¨ jar åŒ…ä¸­çš„META-INF/spring.factoriesæ–‡ä»¶ï¼Œå°†æ–‡ä»¶ä¸­é…ç½®çš„ç±»å‹ä¿¡æ¯åŠ è½½åˆ° Spring å®¹å™¨ï¼ˆæ­¤å¤„æ¶‰åŠåˆ° JVM ç±»åŠ è½½æœºåˆ¶ä¸ Spring çš„å®¹å™¨çŸ¥è¯†ï¼‰ï¼Œå¹¶æ‰§è¡Œç±»ä¸­å®šä¹‰çš„å„ç§æ“ä½œã€‚å¯¹äºå¤–éƒ¨ jar æ¥è¯´ï¼Œåªéœ€è¦æŒ‰ç…§ SpringBoot å®šä¹‰çš„æ ‡å‡†ï¼Œå°±èƒ½å°†è‡ªå·±çš„åŠŸèƒ½è£…ç½®è¿› SpringBootã€‚\næ²¡æœ‰ Spring Boot çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œéå¸¸éº»çƒ¦ã€‚ä½†æ˜¯ï¼ŒSpring Boot ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥å¼•å…¥ä¸€ä¸ª starter å³å¯ã€‚æ¯”å¦‚ä½ æƒ³è¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ redis çš„è¯ï¼Œç›´æ¥åœ¨é¡¹ç›®ä¸­å¼•å…¥å¯¹åº”çš„ starter å³å¯ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-data-redis\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; å¼•å…¥ starter ä¹‹åï¼Œæˆ‘ä»¬é€šè¿‡å°‘é‡æ³¨è§£å’Œä¸€äº›ç®€å•çš„é…ç½®å°±èƒ½ä½¿ç”¨ç¬¬ä¸‰æ–¹ç»„ä»¶æä¾›çš„åŠŸèƒ½äº†ã€‚\nåœ¨æˆ‘çœ‹æ¥ï¼Œè‡ªåŠ¨è£…é…å¯ä»¥ç®€å•ç†è§£ä¸ºï¼šé€šè¿‡æ³¨è§£æˆ–è€…ä¸€äº›ç®€å•çš„é…ç½®å°±èƒ½åœ¨ Spring Boot çš„å¸®åŠ©ä¸‹å®ç°æŸå—åŠŸèƒ½ã€‚\nSpringBoot æ˜¯å¦‚ä½•å®ç°è‡ªåŠ¨è£…é…çš„ï¼Ÿ # æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ SpringBoot çš„æ ¸å¿ƒæ³¨è§£ SpringBootApplication ã€‚\n@Target({ElementType.TYPE}) @Retention(RetentionPolicy.RUNTIME) @Documented @Inherited \u0026lt;1.\u0026gt;@SpringBootConfiguration \u0026lt;2.\u0026gt;@ComponentScan \u0026lt;3.\u0026gt;@EnableAutoConfiguration public @interface SpringBootApplication { } @Target({ElementType.TYPE}) @Retention(RetentionPolicy.RUNTIME) @Documented @Configuration //å®é™…ä¸Šå®ƒä¹Ÿæ˜¯ä¸€ä¸ªé…ç½®ç±» public @interface SpringBootConfiguration { } å¤§æ¦‚å¯ä»¥æŠŠ @SpringBootApplicationçœ‹ä½œæ˜¯ @Configurationã€@EnableAutoConfigurationã€@ComponentScan æ³¨è§£çš„é›†åˆã€‚æ ¹æ® SpringBoot å®˜ç½‘ï¼Œè¿™ä¸‰ä¸ªæ³¨è§£çš„ä½œç”¨åˆ†åˆ«æ˜¯ï¼š\n@EnableAutoConfigurationï¼šå¯ç”¨ SpringBoot çš„è‡ªåŠ¨é…ç½®æœºåˆ¶\n@Configurationï¼šå…è®¸åœ¨ä¸Šä¸‹æ–‡ä¸­æ³¨å†Œé¢å¤–çš„ bean æˆ–å¯¼å…¥å…¶ä»–é…ç½®ç±»\n@ComponentScanï¼š æ‰«æè¢«@Component (@Service,@Controller)æ³¨è§£çš„ beanï¼Œæ³¨è§£é»˜è®¤ä¼šæ‰«æå¯åŠ¨ç±»æ‰€åœ¨çš„åŒ…ä¸‹æ‰€æœ‰çš„ç±» ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸æ‰«ææŸäº› beanã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå®¹å™¨ä¸­å°†æ’é™¤TypeExcludeFilterå’ŒAutoConfigurationExcludeFilterã€‚\n@EnableAutoConfiguration æ˜¯å®ç°è‡ªåŠ¨è£…é…çš„é‡è¦æ³¨è§£ï¼Œæˆ‘ä»¬ä»¥è¿™ä¸ªæ³¨è§£å…¥æ‰‹ã€‚\n@EnableAutoConfiguration:å®ç°è‡ªåŠ¨è£…é…çš„æ ¸å¿ƒæ³¨è§£ # EnableAutoConfiguration åªæ˜¯ä¸€ä¸ªç®€å•åœ°æ³¨è§£ï¼Œè‡ªåŠ¨è£…é…æ ¸å¿ƒåŠŸèƒ½çš„å®ç°å®é™…æ˜¯é€šè¿‡ **AutoConfigurationImportSelector**ç±»ã€‚\n@Target({ElementType.TYPE}) @Retention(RetentionPolicy.RUNTIME) @Documented @Inherited @AutoConfigurationPackage //ä½œç”¨ï¼šå°†mainåŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶æ³¨å†Œåˆ°å®¹å™¨ä¸­ @Import({AutoConfigurationImportSelector.class}) //åŠ è½½è‡ªåŠ¨è£…é…ç±» xxxAutoconfiguration public @interface EnableAutoConfiguration { String ENABLED_OVERRIDE_PROPERTY = \u0026#34;spring.boot.enableautoconfiguration\u0026#34;; Class\u0026lt;?\u0026gt;[] exclude() default {}; String[] excludeName() default {}; } æˆ‘ä»¬ç°åœ¨é‡ç‚¹åˆ†æä¸‹**AutoConfigurationImportSelector** ç±»åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ\nAutoConfigurationImportSelector:åŠ è½½è‡ªåŠ¨è£…é…ç±» # AutoConfigurationImportSelectorç±»çš„ç»§æ‰¿ä½“ç³»å¦‚ä¸‹ï¼š\npublic class AutoConfigurationImportSelector implements DeferredImportSelector, BeanClassLoaderAware, ResourceLoaderAware, BeanFactoryAware, EnvironmentAware, Ordered { } public interface DeferredImportSelector extends ImportSelector { } public interface ImportSelector { String[] selectImports(AnnotationMetadata var1); } å¯ä»¥çœ‹å‡ºï¼ŒAutoConfigurationImportSelector ç±»å®ç°äº† ImportSelectoræ¥å£ï¼Œä¹Ÿå°±å®ç°äº†è¿™ä¸ªæ¥å£ä¸­çš„ selectImportsæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸»è¦ç”¨äºè·å–æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ç±»çš„å…¨é™å®šç±»åï¼Œè¿™äº›ç±»éœ€è¦è¢«åŠ è½½åˆ° IoC å®¹å™¨ä¸­ã€‚\nprivate static final String[] NO_IMPORTS = new String[0]; public String[] selectImports(AnnotationMetadata annotationMetadata) { // \u0026lt;1\u0026gt;.åˆ¤æ–­è‡ªåŠ¨è£…é…å¼€å…³æ˜¯å¦æ‰“å¼€ if (!this.isEnabled(annotationMetadata)) { return NO_IMPORTS; } else { //\u0026lt;2\u0026gt;.è·å–æ‰€æœ‰éœ€è¦è£…é…çš„bean AutoConfigurationMetadata autoConfigurationMetadata = AutoConfigurationMetadataLoader.loadMetadata(this.beanClassLoader); AutoConfigurationImportSelector.AutoConfigurationEntry autoConfigurationEntry = this.getAutoConfigurationEntry(autoConfigurationMetadata, annotationMetadata); return StringUtils.toStringArray(autoConfigurationEntry.getConfigurations()); } } è¿™é‡Œæˆ‘ä»¬éœ€è¦é‡ç‚¹å…³æ³¨ä¸€ä¸‹getAutoConfigurationEntry()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦è´Ÿè´£åŠ è½½è‡ªåŠ¨é…ç½®ç±»çš„ã€‚\nè¯¥æ–¹æ³•è°ƒç”¨é“¾å¦‚ä¸‹ï¼š\nç°åœ¨æˆ‘ä»¬ç»“åˆgetAutoConfigurationEntry()çš„æºç æ¥è¯¦ç»†åˆ†æä¸€ä¸‹ï¼š\nprivate static final AutoConfigurationEntry EMPTY_ENTRY = new AutoConfigurationEntry(); AutoConfigurationEntry getAutoConfigurationEntry(AutoConfigurationMetadata autoConfigurationMetadata, AnnotationMetadata annotationMetadata) { //\u0026lt;1\u0026gt;. if (!this.isEnabled(annotationMetadata)) { return EMPTY_ENTRY; } else { //\u0026lt;2\u0026gt;. AnnotationAttributes attributes = this.getAttributes(annotationMetadata); //\u0026lt;3\u0026gt;. List\u0026lt;String\u0026gt; configurations = this.getCandidateConfigurations(annotationMetadata, attributes); //\u0026lt;4\u0026gt;. configurations = this.removeDuplicates(configurations); Set\u0026lt;String\u0026gt; exclusions = this.getExclusions(annotationMetadata, attributes); this.checkExcludedClasses(configurations, exclusions); configurations.removeAll(exclusions); configurations = this.filter(configurations, autoConfigurationMetadata); this.fireAutoConfigurationImportEvents(configurations, exclusions); return new AutoConfigurationImportSelector.AutoConfigurationEntry(configurations, exclusions); } } ç¬¬ 1 æ­¥:\nåˆ¤æ–­è‡ªåŠ¨è£…é…å¼€å…³æ˜¯å¦æ‰“å¼€ã€‚é»˜è®¤spring.boot.enableautoconfiguration=trueï¼Œå¯åœ¨ application.properties æˆ– application.yml ä¸­è®¾ç½®\nç¬¬ 2 æ­¥ ï¼š\nç”¨äºè·å–EnableAutoConfigurationæ³¨è§£ä¸­çš„ exclude å’Œ excludeNameã€‚\nç¬¬ 3 æ­¥\nè·å–éœ€è¦è‡ªåŠ¨è£…é…çš„æ‰€æœ‰é…ç½®ç±»ï¼Œè¯»å–META-INF/spring.factories\nspring-boot/spring-boot-project/spring-boot-autoconfigure/src/main/resources/META-INF/spring.factories ä»ä¸‹å›¾å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶çš„é…ç½®å†…å®¹éƒ½è¢«æˆ‘ä»¬è¯»å–åˆ°äº†ã€‚XXXAutoConfigurationçš„ä½œç”¨å°±æ˜¯æŒ‰éœ€åŠ è½½ç»„ä»¶ã€‚\n[\nä¸å…‰æ˜¯è¿™ä¸ªä¾èµ–ä¸‹çš„META-INF/spring.factoriesè¢«è¯»å–åˆ°ï¼Œæ‰€æœ‰ Spring Boot Starter ä¸‹çš„META-INF/spring.factorieséƒ½ä¼šè¢«è¯»å–åˆ°ã€‚\næ‰€ä»¥ï¼Œä½ å¯ä»¥æ¸…æ¥šæ»´çœ‹åˆ°ï¼Œ druid æ•°æ®åº“è¿æ¥æ± çš„ Spring Boot Starter å°±åˆ›å»ºäº†META-INF/spring.factoriesæ–‡ä»¶ã€‚\nå¦‚æœï¼Œæˆ‘ä»¬è‡ªå·±è¦åˆ›å»ºä¸€ä¸ª Spring Boot Starterï¼Œè¿™ä¸€æ­¥æ˜¯å¿…ä¸å¯å°‘çš„ã€‚\nç¬¬ 4 æ­¥ ï¼š\nåˆ°è¿™é‡Œå¯èƒ½é¢è¯•å®˜ä¼šé—®ä½ :â€œspring.factoriesä¸­è¿™ä¹ˆå¤šé…ç½®ï¼Œæ¯æ¬¡å¯åŠ¨éƒ½è¦å…¨éƒ¨åŠ è½½ä¹ˆï¼Ÿâ€ã€‚\nå¾ˆæ˜æ˜¾ï¼Œè¿™æ˜¯ä¸ç°å®çš„ã€‚æˆ‘ä»¬ debug åˆ°åé¢ä½ ä¼šå‘ç°ï¼Œconfigurations çš„å€¼å˜å°äº†ã€‚\nå› ä¸ºï¼Œè¿™ä¸€æ­¥æœ‰ç»å†äº†ä¸€éç­›é€‰ï¼Œ@ConditionalOnXXX ä¸­çš„æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³ï¼Œè¯¥ç±»æ‰ä¼šç”Ÿæ•ˆã€‚\n@Configuration // æ£€æŸ¥ç›¸å…³çš„ç±»ï¼šRabbitTemplate å’Œ Channelæ˜¯å¦å­˜åœ¨ // å­˜åœ¨æ‰ä¼šåŠ è½½ @ConditionalOnClass({ RabbitTemplate.class, Channel.class }) @EnableConfigurationProperties(RabbitProperties.class) @Import(RabbitAnnotationDrivenConfiguration.class) public class RabbitAutoConfiguration { } æœ‰å…´è¶£çš„ç«¥é‹å¯ä»¥è¯¦ç»†äº†è§£ä¸‹ Spring Boot æä¾›çš„æ¡ä»¶æ³¨è§£\n@ConditionalOnBeanï¼šå½“å®¹å™¨é‡Œæœ‰æŒ‡å®š Bean çš„æ¡ä»¶ä¸‹ @ConditionalOnMissingBeanï¼šå½“å®¹å™¨é‡Œæ²¡æœ‰æŒ‡å®š Bean çš„æƒ…å†µä¸‹ @ConditionalOnSingleCandidateï¼šå½“æŒ‡å®š Bean åœ¨å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªï¼Œæˆ–è€…è™½ç„¶æœ‰å¤šä¸ªä½†æ˜¯æŒ‡å®šé¦–é€‰ Bean @ConditionalOnClassï¼šå½“ç±»è·¯å¾„ä¸‹æœ‰æŒ‡å®šç±»çš„æ¡ä»¶ä¸‹(è¿™ä¸ªæå…¶é‡è¦) @ConditionalOnMissingClassï¼šå½“ç±»è·¯å¾„ä¸‹æ²¡æœ‰æŒ‡å®šç±»çš„æ¡ä»¶ä¸‹ @ConditionalOnPropertyï¼šæŒ‡å®šçš„å±æ€§æ˜¯å¦æœ‰æŒ‡å®šçš„å€¼ @ConditionalOnResourceï¼šç±»è·¯å¾„æ˜¯å¦æœ‰æŒ‡å®šçš„å€¼ @ConditionalOnExpressionï¼šåŸºäº SpEL è¡¨è¾¾å¼ä½œä¸ºåˆ¤æ–­æ¡ä»¶ @ConditionalOnJavaï¼šåŸºäº Java ç‰ˆæœ¬ä½œä¸ºåˆ¤æ–­æ¡ä»¶ @ConditionalOnJndiï¼šåœ¨ JNDI å­˜åœ¨çš„æ¡ä»¶ä¸‹å·®åœ¨æŒ‡å®šçš„ä½ç½® @ConditionalOnNotWebApplicationï¼šå½“å‰é¡¹ç›®ä¸æ˜¯ Web é¡¹ç›®çš„æ¡ä»¶ä¸‹ @ConditionalOnWebApplicationï¼šå½“å‰é¡¹ç›®æ˜¯ Web é¡¹ ç›®çš„æ¡ä»¶ä¸‹ å¦‚ä½•å®ç°ä¸€ä¸ª Starter # å…‰è¯´ä¸ç»ƒå‡æŠŠå¼ï¼Œç°åœ¨å°±æ¥æ’¸ä¸€ä¸ª starterï¼Œå®ç°è‡ªå®šä¹‰çº¿ç¨‹æ± \nç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºthreadpool-spring-boot-starterå·¥ç¨‹\nç¬¬äºŒæ­¥ï¼Œå¼•å…¥ Spring Boot ç›¸å…³ä¾èµ–\n[\nç¬¬ä¸‰æ­¥ï¼Œåˆ›å»ºThreadPoolAutoConfiguration\nç¬¬å››æ­¥ï¼Œåœ¨threadpool-spring-boot-starterå·¥ç¨‹çš„ resources åŒ…ä¸‹åˆ›å»ºMETA-INF/spring.factoriesæ–‡ä»¶\næœ€åæ–°å»ºå·¥ç¨‹å¼•å…¥threadpool-spring-boot-starter\næµ‹è¯•é€šè¿‡ï¼ï¼ï¼\n[\næ€»ç»“ # Spring Boot é€šè¿‡**@EnableAutoConfigurationå¼€å¯è‡ªåŠ¨è£…é…ï¼Œé€šè¿‡ SpringFactoriesLoader æœ€ç»ˆåŠ è½½META-INF/spring.factoriesä¸­çš„è‡ªåŠ¨é…ç½®ç±»å®ç°è‡ªåŠ¨è£…é…**ï¼Œè‡ªåŠ¨é…ç½®ç±»å…¶å®å°±æ˜¯é€šè¿‡@ConditionalæŒ‰éœ€åŠ è½½çš„é…ç½®ç±»ï¼Œæƒ³è¦å…¶ç”Ÿæ•ˆå¿…é¡»å¼•å…¥**spring-boot-starter-xxxåŒ…å®ç°èµ·æ­¥ä¾èµ–**\n"},{"id":97,"href":"/zh/docs/study/Review/java_guide/lybly_framework/ly04ly_spring-design-patterns/","title":"spring è®¾è®¡æ¨¡å¼","section":"æ¡†æ¶","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nâ€œJDK ä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼? Spring ä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼? â€è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œåœ¨é¢è¯•ä¸­æ¯”è¾ƒå¸¸è§ã€‚\næˆ‘åœ¨ç½‘ä¸Šæœç´¢äº†ä¸€ä¸‹å…³äº Spring ä¸­è®¾è®¡æ¨¡å¼çš„è®²è§£å‡ ä¹éƒ½æ˜¯åƒç¯‡ä¸€å¾‹ï¼Œè€Œä¸”å¤§éƒ¨åˆ†éƒ½å¹´ä»£ä¹…è¿œã€‚æ‰€ä»¥ï¼ŒèŠ±äº†å‡ å¤©æ—¶é—´è‡ªå·±æ€»ç»“äº†ä¸€ä¸‹ã€‚\nç”±äºæˆ‘çš„ä¸ªäººèƒ½åŠ›æœ‰é™ï¼Œæ–‡ä¸­å¦‚æœ‰ä»»ä½•é”™è¯¯å„ä½éƒ½å¯ä»¥æŒ‡å‡ºã€‚å¦å¤–ï¼Œæ–‡ç« ç¯‡å¹…æœ‰é™ï¼Œå¯¹äºè®¾è®¡æ¨¡å¼ä»¥åŠä¸€äº›æºç çš„è§£è¯»æˆ‘åªæ˜¯ä¸€ç¬”å¸¦è¿‡ï¼Œè¿™ç¯‡æ–‡ç« çš„ä¸»è¦ç›®çš„æ˜¯å›é¡¾ä¸€ä¸‹ Spring ä¸­çš„è®¾è®¡æ¨¡å¼ã€‚\næ§åˆ¶åè½¬(IoC)å’Œä¾èµ–æ³¨å…¥(DI) # IoC(Inversion of Control,æ§åˆ¶åè½¬) æ˜¯ Spring ä¸­ä¸€ä¸ªéå¸¸éå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå®ƒä¸æ˜¯ä»€ä¹ˆæŠ€æœ¯ï¼Œè€Œæ˜¯ä¸€ç§è§£è€¦çš„è®¾è®¡æ€æƒ³ã€‚IoC çš„ä¸»è¦ç›®çš„æ˜¯å€ŸåŠ©äºâ€œç¬¬ä¸‰æ–¹â€(Spring ä¸­çš„ IoC å®¹å™¨) å®ç°å…·æœ‰ä¾èµ–å…³ç³»çš„å¯¹è±¡ä¹‹é—´çš„è§£è€¦(IOC å®¹å™¨ç®¡ç†å¯¹è±¡ï¼Œä½ åªç®¡ä½¿ç”¨å³å¯)ï¼Œä»è€Œé™ä½ä»£ç ä¹‹é—´çš„è€¦åˆåº¦ã€‚\nIoC æ˜¯ä¸€ä¸ªåŸåˆ™ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ¨¡å¼ï¼Œä»¥ä¸‹æ¨¡å¼ï¼ˆä½†ä¸é™äºï¼‰å®ç°äº† IoC åŸåˆ™ã€‚\nSpring IoC å®¹å™¨å°±åƒæ˜¯ä¸€ä¸ªå·¥å‚ä¸€æ ·ï¼Œå½“æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œåªéœ€è¦é…ç½®å¥½é…ç½®æ–‡ä»¶/æ³¨è§£å³å¯ï¼Œå®Œå…¨ä¸ç”¨è€ƒè™‘å¯¹è±¡æ˜¯å¦‚ä½•è¢«åˆ›å»ºå‡ºæ¥çš„ã€‚ IoC å®¹å™¨è´Ÿè´£åˆ›å»ºå¯¹è±¡ï¼Œå°†å¯¹è±¡è¿æ¥åœ¨ä¸€èµ·ï¼Œé…ç½®è¿™äº›å¯¹è±¡ï¼Œå¹¶ä»åˆ›å»ºä¸­å¤„ç†è¿™äº›å¯¹è±¡çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œç›´åˆ°å®ƒä»¬è¢«å®Œå…¨é”€æ¯ã€‚\nåœ¨å®é™…é¡¹ç›®ä¸­ä¸€ä¸ª Service ç±»å¦‚æœæœ‰å‡ ç™¾ç”šè‡³ä¸Šåƒä¸ªç±»ä½œä¸ºå®ƒçš„åº•å±‚ï¼Œæˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–è¿™ä¸ª Serviceï¼Œä½ å¯èƒ½è¦æ¯æ¬¡éƒ½è¦ææ¸…è¿™ä¸ª Service æ‰€æœ‰åº•å±‚ç±»çš„æ„é€ å‡½æ•°ï¼Œè¿™å¯èƒ½ä¼šæŠŠäººé€¼ç–¯ã€‚å¦‚æœåˆ©ç”¨ IOC çš„è¯ï¼Œä½ åªéœ€è¦é…ç½®å¥½ï¼Œç„¶ååœ¨éœ€è¦çš„åœ°æ–¹å¼•ç”¨å°±è¡Œäº†ï¼Œè¿™å¤§å¤§å¢åŠ äº†é¡¹ç›®çš„å¯ç»´æŠ¤æ€§ä¸”é™ä½äº†å¼€å‘éš¾åº¦ã€‚\nå…³äº Spring IOC çš„ç†è§£ï¼Œæ¨èçœ‹è¿™ä¸€ä¸‹çŸ¥ä¹çš„ä¸€ä¸ªå›ç­”ï¼šhttps://www.zhihu.com/question/23277575/answer/169698662 ï¼Œéå¸¸ä¸é”™ã€‚\næ§åˆ¶åè½¬æ€ä¹ˆç†è§£å‘¢? ä¸¾ä¸ªä¾‹å­ï¼š\u0026quot;å¯¹è±¡ a ä¾èµ–äº†å¯¹è±¡ bï¼Œå½“å¯¹è±¡ a éœ€è¦ä½¿ç”¨ å¯¹è±¡ b çš„æ—¶å€™å¿…é¡»è‡ªå·±å»åˆ›å»ºã€‚ä½†æ˜¯å½“ç³»ç»Ÿå¼•å…¥äº† IOC å®¹å™¨åï¼Œ å¯¹è±¡ a å’Œå¯¹è±¡ b ä¹‹å‰å°±å¤±å»äº†ç›´æ¥çš„è”ç³»ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå½“å¯¹è±¡ a éœ€è¦ä½¿ç”¨ å¯¹è±¡ b çš„æ—¶å€™ï¼Œ æˆ‘ä»¬å¯ä»¥æŒ‡å®š IOC å®¹å™¨å»åˆ›å»ºä¸€ä¸ªå¯¹è±¡ b æ³¨å…¥åˆ°å¯¹è±¡ a ä¸­\u0026quot;ã€‚ å¯¹è±¡ a è·å¾—ä¾èµ–å¯¹è±¡ b çš„è¿‡ç¨‹,ç”±ä¸»åŠ¨è¡Œä¸ºå˜ä¸ºäº†è¢«åŠ¨è¡Œä¸ºï¼Œæ§åˆ¶æƒåè½¬ï¼Œè¿™å°±æ˜¯æ§åˆ¶åè½¬åå­—çš„ç”±æ¥ã€‚\nDI(Dependecy Inject,ä¾èµ–æ³¨å…¥)æ˜¯å®ç°æ§åˆ¶åè½¬çš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œä¾èµ–æ³¨å…¥å°±æ˜¯å°†å®ä¾‹å˜é‡ä¼ å…¥åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­å»ã€‚\nå·¥å‚è®¾è®¡æ¨¡å¼ # //æ–¹å¼ä¸€ spring3.1å,XmlBeanFactoryè¢«å¼ƒç”¨ XmlBeanFactory factory = new XmlBeanFactory (new ClassPathResource(\u0026#34;beans.xml\u0026#34;)); User bean = factory.getBean(User.class); System.out.println(bean); /* //æ–¹å¼äºŒ ApplicationContext context=new ClassPathXmlApplicationContext(\u0026#34;beans.xml\u0026#34;); User bean = context.getBean(User.class); System.out.println(bean);*/ Spring ä½¿ç”¨å·¥å‚æ¨¡å¼å¯ä»¥é€šè¿‡ BeanFactory æˆ– ApplicationContext åˆ›å»º bean å¯¹è±¡ã€‚\nApplicationContextç»§æ‰¿äº†ListableBeanFactoryï¼ŒListableBeanFactoryç»§æ‰¿äº†BeanFactory\nä¸¤è€…å¯¹æ¯”ï¼š\nBeanFactory ï¼šå»¶è¿Ÿæ³¨å…¥(ä½¿ç”¨åˆ°æŸä¸ª bean çš„æ—¶å€™æ‰ä¼šæ³¨å…¥),ç›¸æ¯”äºApplicationContext æ¥è¯´ä¼šå ç”¨æ›´å°‘çš„å†…å­˜ï¼Œç¨‹åºå¯åŠ¨é€Ÿåº¦æ›´å¿«ã€‚ ApplicationContext ï¼šå®¹å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¸ç®¡ä½ ç”¨æ²¡ç”¨åˆ°ï¼Œä¸€æ¬¡æ€§åˆ›å»ºæ‰€æœ‰ bean ã€‚BeanFactory ä»…æä¾›äº†æœ€åŸºæœ¬çš„ä¾èµ–æ³¨å…¥æ”¯æŒï¼ŒApplicationContext æ‰©å±•äº† BeanFactory ,é™¤äº†æœ‰BeanFactoryçš„åŠŸèƒ½è¿˜æœ‰é¢å¤–æ›´å¤šåŠŸèƒ½ï¼Œæ‰€ä»¥ä¸€èˆ¬å¼€å‘äººå‘˜ä½¿ç”¨ApplicationContextä¼šæ›´å¤šã€‚ ApplicationContext çš„ä¸‰ä¸ªå®ç°ç±»ï¼š\nClassPathXmlApplicationï¼šæŠŠä¸Šä¸‹æ–‡æ–‡ä»¶å½“æˆç±»è·¯å¾„èµ„æºã€‚ FileSystemXmlApplicationï¼šä»æ–‡ä»¶ç³»ç»Ÿä¸­çš„ XML æ–‡ä»¶è½½å…¥ä¸Šä¸‹æ–‡å®šä¹‰ä¿¡æ¯ã€‚ XmlWebApplicationContextï¼šä» Web ç³»ç»Ÿä¸­çš„ XML æ–‡ä»¶è½½å…¥ä¸Šä¸‹æ–‡å®šä¹‰ä¿¡æ¯ã€‚ Example:\nimport org.springframework.context.ApplicationContext; import org.springframework.context.support.FileSystemXmlApplicationContext; public class App { public static void main(String[] args) { ApplicationContext context = new FileSystemXmlApplicationContext( \u0026#34;C:/work/IOC Containers/springframework.applicationcontext/src/main/resources/bean-factory-config.xml\u0026#34;); HelloApplicationContext obj = (HelloApplicationContext) context.getBean(\u0026#34;helloApplicationContext\u0026#34;); obj.getMsg(); } } å•ä¾‹è®¾è®¡æ¨¡å¼ # åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­ï¼Œæœ‰ä¸€äº›å¯¹è±¡å…¶å®æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªï¼Œæ¯”å¦‚è¯´ï¼šçº¿ç¨‹æ± ã€ç¼“å­˜ã€å¯¹è¯æ¡†ã€æ³¨å†Œè¡¨ã€æ—¥å¿—å¯¹è±¡ã€å……å½“æ‰“å°æœºã€æ˜¾å¡ç­‰è®¾å¤‡é©±åŠ¨ç¨‹åºçš„å¯¹è±¡ã€‚äº‹å®ä¸Šï¼Œè¿™ä¸€ç±»å¯¹è±¡åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¦‚æœåˆ¶é€ å‡ºå¤šä¸ªå®ä¾‹å°±å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜çš„äº§ç”Ÿï¼Œæ¯”å¦‚ï¼šç¨‹åºçš„è¡Œä¸ºå¼‚å¸¸ã€èµ„æºä½¿ç”¨è¿‡é‡ã€æˆ–è€…ä¸ä¸€è‡´æ€§çš„ç»“æœã€‚\nä½¿ç”¨å•ä¾‹æ¨¡å¼çš„å¥½å¤„ :\nå¯¹äºé¢‘ç¹ä½¿ç”¨çš„å¯¹è±¡ï¼Œå¯ä»¥çœç•¥åˆ›å»ºå¯¹è±¡æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œè¿™å¯¹äºé‚£äº›é‡é‡çº§å¯¹è±¡è€Œè¨€ï¼Œæ˜¯éå¸¸å¯è§‚çš„ä¸€ç¬”ç³»ç»Ÿå¼€é”€ï¼› ç”±äº new æ“ä½œçš„æ¬¡æ•°å‡å°‘ï¼Œå› è€Œå¯¹ç³»ç»Ÿå†…å­˜çš„ä½¿ç”¨é¢‘ç‡ä¹Ÿä¼šé™ä½ï¼Œè¿™å°†å‡è½» GC å‹åŠ›ï¼Œç¼©çŸ­ GC åœé¡¿æ—¶é—´ã€‚ Spring ä¸­ bean çš„é»˜è®¤ä½œç”¨åŸŸå°±æ˜¯ singleton(å•ä¾‹)çš„ã€‚ é™¤äº† singleton ä½œç”¨åŸŸï¼ŒSpring ä¸­ bean è¿˜æœ‰ä¸‹é¢å‡ ç§ä½œç”¨åŸŸï¼š\nprototype : æ¯æ¬¡è·å–éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ bean å®ä¾‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿ç»­ getBean() ä¸¤æ¬¡ï¼Œå¾—åˆ°çš„æ˜¯ä¸åŒçš„ Bean å®ä¾‹ã€‚ request ï¼ˆä»… Web åº”ç”¨å¯ç”¨ï¼‰: æ¯ä¸€æ¬¡ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ beanï¼ˆè¯·æ±‚ beanï¼‰ï¼Œè¯¥ bean ä»…åœ¨å½“å‰ HTTP request å†…æœ‰æ•ˆã€‚ session ï¼ˆä»… Web åº”ç”¨å¯ç”¨ï¼‰ : æ¯ä¸€æ¬¡æ¥è‡ªæ–° session çš„ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ beanï¼ˆä¼šè¯ beanï¼‰ï¼Œè¯¥ bean ä»…åœ¨å½“å‰ HTTP session å†…æœ‰æ•ˆã€‚ application/global-session ï¼ˆä»… Web åº”ç”¨å¯ç”¨ï¼‰ï¼š æ¯ä¸ª Web åº”ç”¨åœ¨å¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ª Beanï¼ˆåº”ç”¨ Beanï¼‰ï¼Œï¼Œè¯¥ bean ä»…åœ¨å½“å‰åº”ç”¨å¯åŠ¨æ—¶é—´å†…æœ‰æ•ˆã€‚ websocket ï¼ˆä»… Web åº”ç”¨å¯ç”¨ï¼‰ï¼šæ¯ä¸€æ¬¡ WebSocket ä¼šè¯äº§ç”Ÿä¸€ä¸ªæ–°çš„ beanã€‚ Spring é€šè¿‡ ConcurrentHashMap å®ç°å•ä¾‹æ³¨å†Œè¡¨çš„ç‰¹æ®Šæ–¹å¼å®ç°å•ä¾‹æ¨¡å¼ã€‚\nSpring å®ç°å•ä¾‹çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š\n// é€šè¿‡ ConcurrentHashMapï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ å®ç°å•ä¾‹æ³¨å†Œè¡¨ private final Map\u0026lt;String, Object\u0026gt; singletonObjects = new ConcurrentHashMap\u0026lt;String, Object\u0026gt;(64); public Object getSingleton(String beanName, ObjectFactory\u0026lt;?\u0026gt; singletonFactory) { Assert.notNull(beanName, \u0026#34;\u0026#39;beanName\u0026#39; must not be null\u0026#34;); synchronized (this.singletonObjects) { // æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨å®ä¾‹ Object singletonObject = this.singletonObjects.get(beanName); if (singletonObject == null) { //...çœç•¥äº†å¾ˆå¤šä»£ç  try { singletonObject = singletonFactory.getObject(); } //...çœç•¥äº†å¾ˆå¤šä»£ç  // å¦‚æœå®ä¾‹å¯¹è±¡åœ¨ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬æ³¨å†Œåˆ°å•ä¾‹æ³¨å†Œè¡¨ä¸­ã€‚ addSingleton(beanName, singletonObject); } return (singletonObject != NULL_OBJECT ? singletonObject : null); } } //å°†å¯¹è±¡æ·»åŠ åˆ°å•ä¾‹æ³¨å†Œè¡¨ protected void addSingleton(String beanName, Object singletonObject) { synchronized (this.singletonObjects) { this.singletonObjects.put(beanName, (singletonObject != null ? singletonObject : NULL_OBJECT)); } } } å•ä¾‹ Bean å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜å—ï¼Ÿ\nå¤§éƒ¨åˆ†æ—¶å€™æˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œæ‰€ä»¥å¾ˆå°‘æœ‰äººä¼šå…³æ³¨è¿™ä¸ªé—®é¢˜ã€‚å•ä¾‹ Bean å­˜åœ¨çº¿ç¨‹é—®é¢˜ï¼Œä¸»è¦æ˜¯å› ä¸ºå½“å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™æ˜¯å­˜åœ¨èµ„æºç«äº‰çš„ã€‚\nå¸¸è§çš„æœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼š\nåœ¨ Bean ä¸­å°½é‡é¿å…å®šä¹‰å¯å˜çš„æˆå‘˜å˜é‡ã€‚ åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ª ThreadLocal æˆå‘˜å˜é‡ï¼Œå°†éœ€è¦çš„å¯å˜æˆå‘˜å˜é‡ä¿å­˜åœ¨ ThreadLocal ä¸­ï¼ˆæ¨èçš„ä¸€ç§æ–¹å¼ï¼‰ã€‚ ä¸è¿‡ï¼Œå¤§éƒ¨åˆ† Bean å®é™…éƒ½æ˜¯æ— çŠ¶æ€ï¼ˆæ²¡æœ‰å®ä¾‹å˜é‡ï¼‰çš„ï¼ˆæ¯”å¦‚ Daoã€Serviceï¼‰ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œ Bean æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚\nä»£ç†è®¾è®¡æ¨¡å¼ # ä»£ç†æ¨¡å¼åœ¨ AOP ä¸­çš„åº”ç”¨ # AOP(Aspect-Oriented Programmingï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹) èƒ½å¤Ÿå°†é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œå´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘æˆ–è´£ä»»ï¼ˆä¾‹å¦‚äº‹åŠ¡å¤„ç†ã€æ—¥å¿—ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰ï¼‰å°è£…èµ·æ¥ï¼Œä¾¿äºå‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç ï¼Œé™ä½æ¨¡å—é—´çš„è€¦åˆåº¦ï¼Œå¹¶æœ‰åˆ©äºæœªæ¥çš„å¯æ‹“å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\nSpring AOP å°±æ˜¯åŸºäºåŠ¨æ€ä»£ç†çš„ï¼Œå¦‚æœè¦ä»£ç†çš„å¯¹è±¡ï¼Œå®ç°äº†æŸä¸ªæ¥å£ï¼Œé‚£ä¹ˆ Spring AOP ä¼šä½¿ç”¨ JDK Proxy å»åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œè€Œå¯¹äºæ²¡æœ‰å®ç°æ¥å£çš„å¯¹è±¡ï¼Œå°±æ— æ³•ä½¿ç”¨ JDK Proxy å»è¿›è¡Œä»£ç†äº†ï¼Œè¿™æ—¶å€™ Spring AOP ä¼šä½¿ç”¨ Cglib ç”Ÿæˆä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡çš„å­ç±»æ¥ä½œä¸ºä»£ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ AspectJ ,Spring AOP å·²ç»é›†æˆäº† AspectJ ï¼ŒAspectJ åº”è¯¥ç®—çš„ä¸Šæ˜¯ Java ç”Ÿæ€ç³»ç»Ÿä¸­æœ€å®Œæ•´çš„ AOP æ¡†æ¶äº†ã€‚\nä½¿ç”¨ AOP ä¹‹åæˆ‘ä»¬å¯ä»¥æŠŠä¸€äº›é€šç”¨åŠŸèƒ½æŠ½è±¡å‡ºæ¥ï¼Œåœ¨éœ€è¦ç”¨åˆ°çš„åœ°æ–¹ç›´æ¥ä½¿ç”¨å³å¯ï¼Œè¿™æ ·å¤§å¤§ç®€åŒ–äº†ä»£ç é‡ã€‚æˆ‘ä»¬éœ€è¦å¢åŠ æ–°åŠŸèƒ½æ—¶ä¹Ÿæ–¹ä¾¿ï¼Œè¿™æ ·ä¹Ÿæé«˜äº†ç³»ç»Ÿæ‰©å±•æ€§ã€‚æ—¥å¿—åŠŸèƒ½ã€äº‹åŠ¡ç®¡ç†ç­‰ç­‰åœºæ™¯éƒ½ç”¨åˆ°äº† AOP ã€‚\nSpring AOP å’Œ AspectJ AOP æœ‰ä»€ä¹ˆåŒºåˆ«? # Spring AOP å±äºè¿è¡Œæ—¶å¢å¼ºï¼Œè€Œ AspectJ æ˜¯ç¼–è¯‘æ—¶å¢å¼ºã€‚ Spring AOP åŸºäºä»£ç†(Proxying)ï¼Œè€Œ AspectJ åŸºäºå­—èŠ‚ç æ“ä½œ(Bytecode Manipulation)ã€‚\nSpring AOP å·²ç»é›†æˆäº† AspectJ ï¼ŒAspectJ åº”è¯¥ç®—çš„ä¸Šæ˜¯ Java ç”Ÿæ€ç³»ç»Ÿä¸­æœ€å®Œæ•´çš„ AOP æ¡†æ¶äº†ã€‚AspectJ ç›¸æ¯”äº Spring AOP åŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼Œä½†æ˜¯ Spring AOP ç›¸å¯¹æ¥è¯´æ›´ç®€å•ï¼Œ\nå¦‚æœæˆ‘ä»¬çš„åˆ‡é¢æ¯”è¾ƒå°‘ï¼Œé‚£ä¹ˆä¸¤è€…æ€§èƒ½å·®å¼‚ä¸å¤§ã€‚ä½†æ˜¯ï¼Œå½“åˆ‡é¢å¤ªå¤šçš„è¯ï¼Œæœ€å¥½é€‰æ‹© AspectJ ï¼Œå®ƒæ¯” Spring AOP å¿«å¾ˆå¤šã€‚\næ¨¡æ¿æ–¹æ³• # æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå®ƒå®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚ æ¨¡æ¿æ–¹æ³•ä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„å³å¯é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤çš„å®ç°æ–¹å¼ã€‚\npublic abstract class Template { //è¿™æ˜¯æˆ‘ä»¬çš„æ¨¡æ¿æ–¹æ³• public final void TemplateMethod(){ PrimitiveOperation1(); PrimitiveOperation2(); PrimitiveOperation3(); } protected void PrimitiveOperation1(){ //å½“å‰ç±»å®ç° } //è¢«å­ç±»å®ç°çš„æ–¹æ³• protected abstract void PrimitiveOperation2(); protected abstract void PrimitiveOperation3(); } public class TemplateImpl extends Template { @Override public void PrimitiveOperation2() { //å½“å‰ç±»å®ç° } @Override public void PrimitiveOperation3() { //å½“å‰ç±»å®ç° } } Spring ä¸­ JdbcTemplateã€HibernateTemplate ç­‰ä»¥ Template ç»“å°¾çš„å¯¹æ•°æ®åº“æ“ä½œçš„ç±»ï¼Œå®ƒä»¬å°±ä½¿ç”¨åˆ°äº†æ¨¡æ¿æ¨¡å¼ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨ç»§æ‰¿çš„æ–¹å¼æ¥å®ç°æ¨¡æ¿æ¨¡å¼ï¼Œä½†æ˜¯ Spring å¹¶æ²¡æœ‰ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œè€Œæ˜¯ä½¿ç”¨ Callback æ¨¡å¼ä¸æ¨¡æ¿æ–¹æ³•æ¨¡å¼é…åˆï¼Œæ—¢è¾¾åˆ°äº†ä»£ç å¤ç”¨çš„æ•ˆæœï¼ŒåŒæ—¶å¢åŠ äº†çµæ´»æ€§ã€‚\nä»€ä¹ˆæ˜¯Callbackæ¨¡å¼\n//çº¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼ public abstract class JdbcTemplate { public final Object executeï¼ˆString sqlï¼‰{ Connection con=null; Statement stmt=null; try { con=getConnectionï¼ˆï¼‰; stmt=con.createStatementï¼ˆï¼‰; Object retValue=executeWithStatementï¼ˆstmt,sqlï¼‰; return retValue; } catchï¼ˆSQLException eï¼‰{ ... } finally { closeStatementï¼ˆstmtï¼‰; releaseConnectionï¼ˆconï¼‰; } } protected abstract Object executeWithStatementï¼ˆStatement stmt, String sqlï¼‰; } Callbackç±»\npublic interface StatementCallback{ Object doWithStatementï¼ˆStatement stmtï¼‰; } ä½¿ç”¨\n//ç»“åˆCallbackæ¨¡å¼ public class JdbcTemplate { //ä¸»è¦æ˜¯ä¼ å…¥äº†ä¸€ä¸ªç±» public final Object executeï¼ˆStatementCallback callbackï¼‰{ Connection con=null; Statement stmt=null; try { con=getConnectionï¼ˆï¼‰; stmt=con.createStatementï¼ˆï¼‰; Object retValue=callback.doWithStatementï¼ˆstmtï¼‰; return retValue; } catchï¼ˆSQLException eï¼‰{ ... } finally { closeStatementï¼ˆstmtï¼‰; releaseConnectionï¼ˆconï¼‰; } } ...//å…¶å®ƒæ–¹æ³•å®šä¹‰ } JdbcTemplate jdbcTemplate=...; final String sql=...; StatementCallback callback=new StatementCallback(){ public Object=doWithStatement(Statement stmt){ return ...; } } jdbcTemplate.execute(callback); è§‚å¯Ÿè€…æ¨¡å¼ # è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡è¡Œä¸ºå‹æ¨¡å¼ã€‚å®ƒè¡¨ç¤ºçš„æ˜¯ä¸€ç§å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´å…·æœ‰ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œè¿™ä¸ªå¯¹è±¡æ‰€ä¾èµ–çš„å¯¹è±¡ä¹Ÿä¼šåšå‡ºååº”ã€‚Spring äº‹ä»¶é©±åŠ¨æ¨¡å‹å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼å¾ˆç»å…¸çš„ä¸€ä¸ªåº”ç”¨ã€‚Spring äº‹ä»¶é©±åŠ¨æ¨¡å‹éå¸¸æœ‰ç”¨ï¼Œåœ¨å¾ˆå¤šåœºæ™¯éƒ½å¯ä»¥è§£è€¦æˆ‘ä»¬çš„ä»£ç ã€‚æ¯”å¦‚æˆ‘ä»¬æ¯æ¬¡æ·»åŠ å•†å“çš„æ—¶å€™éƒ½éœ€è¦é‡æ–°æ›´æ–°å•†å“ç´¢å¼•ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥åˆ©ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\nSpring äº‹ä»¶é©±åŠ¨æ¨¡å‹ä¸­çš„ä¸‰ç§è§’è‰² # äº‹ä»¶è§’è‰²ï¼šæ˜¯ä¸€ç§å±æ€§ï¼ˆç‰©å“ï¼‰\näº‹ä»¶ç›‘å¬è€…ï¼šï¼ˆæ³¨å†Œåˆ°äº‹ä»¶å‘å¸ƒè€…ä¸Šï¼‰\näº‹ä»¶å‘å¸ƒè€…ï¼šå½“å‘å¸ƒçš„æ—¶å€™ï¼Œé€šçŸ¥æŒ‡å®šçš„ç›‘å¬è€…ï¼ˆè§‚å¯Ÿè€…ï¼‰\näº‹ä»¶è§’è‰² # ApplicationEvent (org.springframework.contextåŒ…ä¸‹)å……å½“äº‹ä»¶çš„è§’è‰²,è¿™æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒç»§æ‰¿äº†java.util.EventObjectå¹¶å®ç°äº† java.io.Serializableæ¥å£ã€‚\nSpring ä¸­é»˜è®¤å­˜åœ¨ä»¥ä¸‹äº‹ä»¶ï¼Œä»–ä»¬éƒ½æ˜¯å¯¹ ApplicationContextEvent çš„å®ç°(ç»§æ‰¿è‡ªApplicationContextEvent)ï¼š\nContextStartedEventï¼šApplicationContext å¯åŠ¨åè§¦å‘çš„äº‹ä»¶; ContextStoppedEventï¼šApplicationContext åœæ­¢åè§¦å‘çš„äº‹ä»¶; ContextRefreshedEventï¼šApplicationContext åˆå§‹åŒ–æˆ–åˆ·æ–°å®Œæˆåè§¦å‘çš„äº‹ä»¶; ContextClosedEventï¼šApplicationContext å…³é—­åè§¦å‘çš„äº‹ä»¶ã€‚ äº‹ä»¶ç›‘å¬è€…è§’è‰² # ApplicationListener å……å½“äº†äº‹ä»¶ç›‘å¬è€…è§’è‰²ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œé‡Œé¢åªå®šä¹‰äº†ä¸€ä¸ª onApplicationEventï¼ˆï¼‰æ–¹æ³•æ¥å¤„ç†ApplicationEventã€‚ApplicationListeneræ¥å£ç±»æºç å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹å‡ºæ¥å£å®šä¹‰çœ‹å‡ºæ¥å£ä¸­çš„äº‹ä»¶åªè¦å®ç°äº† ApplicationEventå°±å¯ä»¥äº†ã€‚æ‰€ä»¥ï¼Œåœ¨ Spring ä¸­æˆ‘ä»¬åªè¦å®ç° ApplicationListener æ¥å£çš„ onApplicationEvent() æ–¹æ³•å³å¯å®Œæˆç›‘å¬äº‹ä»¶\næ³¨æ„ä»£ç ï¼ŒE extends ApplicationEvent , å¯¹æŸç±»äº‹ä»¶è¿›è¡Œç›‘å¬\npackage org.springframework.context; import java.util.EventListener; @FunctionalInterface public interface ApplicationListener\u0026lt;E extends ApplicationEvent\u0026gt; extends EventListener { void onApplicationEvent(E var1); } äº‹ä»¶å‘å¸ƒè€…è§’è‰² # ApplicationEventPublisher å……å½“äº†äº‹ä»¶çš„å‘å¸ƒè€…ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªæ¥å£ã€‚\n@FunctionalInterface public interface ApplicationEventPublisher { default void publishEvent(ApplicationEvent event) { this.publishEvent((Object)event); } void publishEvent(Object var1); } ApplicationEventPublisher æ¥å£çš„publishEventï¼ˆï¼‰è¿™ä¸ªæ–¹æ³•åœ¨AbstractApplicationContextç±»ä¸­è¢«å®ç°(è¿™ä¸ªç±»ç»§æ‰¿äº†ApplicationEventPublisher)ï¼Œé˜…è¯»è¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼Œä½ ä¼šå‘ç°å®é™…ä¸Šäº‹ä»¶çœŸæ­£æ˜¯é€šè¿‡ApplicationEventMulticasteræ¥å¹¿æ’­å‡ºå»çš„ã€‚å…·ä½“å†…å®¹è¿‡å¤šï¼Œå°±ä¸åœ¨è¿™é‡Œåˆ†æäº†ï¼Œåé¢å¯èƒ½ä¼šå•ç‹¬å†™ä¸€ç¯‡æ–‡ç« æåˆ°ã€‚\nSpring çš„äº‹ä»¶æµç¨‹æ€»ç»“ # å®šä¹‰ä¸€ä¸ªäº‹ä»¶: å®ç°ä¸€ä¸ªç»§æ‰¿è‡ª ApplicationEventï¼Œå¹¶ä¸”å†™ç›¸åº”çš„æ„é€ å‡½æ•°ï¼› å®šä¹‰ä¸€ä¸ªäº‹ä»¶ç›‘å¬è€…ï¼šå®ç° ApplicationListener æ¥å£ï¼Œé‡å†™ onApplicationEvent() æ–¹æ³•ï¼› ä½¿ç”¨äº‹ä»¶å‘å¸ƒè€…å‘å¸ƒæ¶ˆæ¯: å¯ä»¥é€šè¿‡ ApplicationEventPublisher çš„ publishEvent() æ–¹æ³•å‘å¸ƒæ¶ˆæ¯ã€‚ Example:\n// å®šä¹‰ä¸€ä¸ªäº‹ä»¶,ç»§æ‰¿è‡ªApplicationEventå¹¶ä¸”å†™ç›¸åº”çš„æ„é€ å‡½æ•° public class DemoEvent extends ApplicationEvent{ private static final long serialVersionUID = 1L; private String message; public DemoEvent(Object source,String message){ super(source); this.message = message; } public String getMessage() { return message; } } // å®šä¹‰ä¸€ä¸ªäº‹ä»¶ç›‘å¬è€…,å®ç°ApplicationListeneræ¥å£ï¼Œé‡å†™ onApplicationEvent() æ–¹æ³•ï¼› @Component public class DemoListener implements ApplicationListener\u0026lt;DemoEvent\u0026gt;{ //ä½¿ç”¨onApplicationEventæ¥æ”¶æ¶ˆæ¯ @Override public void onApplicationEvent(DemoEvent event) { String msg = event.getMessage(); System.out.println(\u0026#34;æ¥æ”¶åˆ°çš„ä¿¡æ¯æ˜¯ï¼š\u0026#34;+msg); } } // å‘å¸ƒäº‹ä»¶ï¼Œå¯ä»¥é€šè¿‡ApplicationEventPublisher çš„ publishEvent() æ–¹æ³•å‘å¸ƒæ¶ˆæ¯ã€‚ @Component public class DemoPublisher { @Autowired ApplicationContext applicationContext; public void publish(String message){ //å‘å¸ƒäº‹ä»¶ applicationContext.publishEvent(new DemoEvent(this, message)); } } å½“è°ƒç”¨ DemoPublisher çš„ publish() æ–¹æ³•çš„æ—¶å€™ï¼Œæ¯”å¦‚ demoPublisher.publish(\u0026quot;ä½ å¥½\u0026quot;) ï¼Œæ§åˆ¶å°å°±ä¼šæ‰“å°å‡º:æ¥æ”¶åˆ°çš„ä¿¡æ¯æ˜¯ï¼šä½ å¥½ ã€‚\né€‚é…å™¨æ¨¡å¼ # é€‚é…å™¨æ¨¡å¼(Adapter Pattern) å°†ä¸€ä¸ªæ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œé€‚é…å™¨æ¨¡å¼ä½¿æ¥å£ä¸å…¼å®¹çš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œã€‚\nSpring AOP ä¸­çš„é€‚é…å™¨æ¨¡å¼ # æˆ‘ä»¬çŸ¥é“ Spring AOP çš„å®ç°æ˜¯åŸºäºä»£ç†æ¨¡å¼ï¼Œä½†æ˜¯ Spring AOP çš„å¢å¼ºæˆ–é€šçŸ¥(Advice)ä½¿ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼ï¼Œä¸ä¹‹ç›¸å…³çš„æ¥å£æ˜¯AdvisorAdapter ã€‚\nAdvice å¸¸ç”¨çš„ç±»å‹æœ‰ï¼šBeforeAdviceï¼ˆç›®æ ‡æ–¹æ³•è°ƒç”¨å‰,å‰ç½®é€šçŸ¥ï¼‰ã€AfterAdviceï¼ˆç›®æ ‡æ–¹æ³•è°ƒç”¨å,åç½®é€šçŸ¥ï¼‰ã€AfterReturningAdvice(ç›®æ ‡æ–¹æ³•æ‰§è¡Œç»“æŸåï¼Œreturn ä¹‹å‰)ç­‰ç­‰ã€‚æ¯ä¸ªç±»å‹ Adviceï¼ˆé€šçŸ¥ï¼‰éƒ½æœ‰å¯¹åº”çš„æ‹¦æˆªå™¨:MethodBeforeAdviceInterceptorã€AfterReturningAdviceInterceptorã€ThrowsAdviceInterceptor ç­‰ç­‰ã€‚\nSpring é¢„å®šä¹‰çš„é€šçŸ¥è¦é€šè¿‡å¯¹åº”çš„é€‚é…å™¨ï¼Œé€‚é…æˆ MethodInterceptor æ¥å£(æ–¹æ³•æ‹¦æˆªå™¨)ç±»å‹çš„å¯¹è±¡ï¼ˆå¦‚ï¼šMethodBeforeAdviceAdapter é€šè¿‡è°ƒç”¨ getInterceptor æ–¹æ³•ï¼Œå°† MethodBeforeAdvice é€‚é…æˆ MethodBeforeAdviceInterceptor ï¼‰ã€‚\nSpring MVC ä¸­çš„é€‚é…å™¨æ¨¡å¼ # åœ¨ Spring MVC ä¸­ï¼ŒDispatcherServlet æ ¹æ®è¯·æ±‚ä¿¡æ¯è°ƒç”¨ HandlerMappingï¼Œè§£æè¯·æ±‚å¯¹åº”çš„ Handlerã€‚è§£æåˆ°å¯¹åº”çš„ Handlerï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³å¸¸è¯´çš„ Controller æ§åˆ¶å™¨ï¼‰åï¼Œå¼€å§‹ç”±HandlerAdapter é€‚é…å™¨å¤„ç†ã€‚HandlerAdapter ä½œä¸ºæœŸæœ›æ¥å£ï¼Œå…·ä½“çš„é€‚é…å™¨å®ç°ç±»ç”¨äºå¯¹ç›®æ ‡ç±»è¿›è¡Œé€‚é…ï¼ŒController ä½œä¸ºéœ€è¦é€‚é…çš„ç±»ã€‚\nä¸ºä»€ä¹ˆè¦åœ¨ Spring MVC ä¸­ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼Ÿ\nSpring MVC ä¸­çš„ Controller ç§ç±»ä¼—å¤šï¼Œä¸åŒç±»å‹çš„ Controller é€šè¿‡ä¸åŒçš„æ–¹æ³•æ¥å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚å¦‚æœä¸åˆ©ç”¨é€‚é…å™¨æ¨¡å¼çš„è¯ï¼ŒDispatcherServlet ç›´æ¥è·å–å¯¹åº”ç±»å‹çš„ Controllerï¼Œéœ€è¦çš„è‡ªè¡Œæ¥åˆ¤æ–­ï¼Œåƒä¸‹é¢è¿™æ®µä»£ç ä¸€æ ·ï¼š\nif(mappedHandler.getHandler() instanceof MultiActionController){ ((MultiActionController)mappedHandler.getHandler()).xxx }else if(mappedHandler.getHandler() instanceof XXX){ ... }else if(...){ ... } å‡å¦‚æˆ‘ä»¬å†å¢åŠ ä¸€ä¸ª Controllerç±»å‹å°±è¦åœ¨ä¸Šé¢ä»£ç ä¸­å†åŠ å…¥ä¸€è¡Œ åˆ¤æ–­è¯­å¥ï¼Œè¿™ç§å½¢å¼å°±ä½¿å¾—ç¨‹åºéš¾ä»¥ç»´æŠ¤ï¼Œä¹Ÿè¿åäº†è®¾è®¡æ¨¡å¼ä¸­çš„å¼€é—­åŸåˆ™ â€“ å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚\nè£…é¥°è€…æ¨¡å¼ # è£…é¥°è€…æ¨¡å¼å¯ä»¥åŠ¨æ€åœ°ç»™å¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„å±æ€§æˆ–è¡Œä¸ºã€‚ç›¸æ¯”äºä½¿ç”¨ç»§æ‰¿ï¼Œè£…é¥°è€…æ¨¡å¼æ›´åŠ çµæ´»ã€‚ç®€å•ç‚¹å„¿è¯´å°±æ˜¯å½“æˆ‘ä»¬éœ€è¦ä¿®æ”¹åŸæœ‰çš„åŠŸèƒ½ï¼Œä½†æˆ‘ä»¬åˆä¸æ„¿ç›´æ¥å»ä¿®æ”¹åŸæœ‰çš„ä»£ç æ—¶ï¼Œè®¾è®¡ä¸€ä¸ª Decorator å¥—åœ¨åŸæœ‰ä»£ç å¤–é¢ã€‚å…¶å®åœ¨ JDK ä¸­å°±æœ‰å¾ˆå¤šåœ°æ–¹ç”¨åˆ°äº†è£…é¥°è€…æ¨¡å¼ï¼Œæ¯”å¦‚ InputStreamå®¶æ—ï¼ŒInputStream ç±»ä¸‹æœ‰ FileInputStream (è¯»å–æ–‡ä»¶)ã€BufferedInputStream (å¢åŠ ç¼“å­˜,ä½¿è¯»å–æ–‡ä»¶é€Ÿåº¦å¤§å¤§æå‡)ç­‰å­ç±»éƒ½åœ¨ä¸ä¿®æ”¹InputStream ä»£ç çš„æƒ…å†µä¸‹æ‰©å±•äº†å®ƒçš„åŠŸèƒ½ã€‚\nSpring ä¸­é…ç½® DataSource çš„æ—¶å€™ï¼ŒDataSource å¯èƒ½æ˜¯ä¸åŒçš„æ•°æ®åº“å’Œæ•°æ®æºã€‚æˆ‘ä»¬èƒ½å¦æ ¹æ®å®¢æˆ·çš„éœ€æ±‚åœ¨å°‘ä¿®æ”¹åŸæœ‰ç±»çš„ä»£ç ä¸‹åŠ¨æ€åˆ‡æ¢ä¸åŒçš„æ•°æ®æºï¼Ÿè¿™ä¸ªæ—¶å€™å°±è¦ç”¨åˆ°è£…é¥°è€…æ¨¡å¼(è¿™ä¸€ç‚¹æˆ‘è‡ªå·±è¿˜æ²¡å¤ªç†è§£å…·ä½“åŸç†)ã€‚Spring ä¸­ç”¨åˆ°çš„åŒ…è£…å™¨æ¨¡å¼åœ¨ç±»åä¸Šå«æœ‰ Wrapperæˆ–è€… Decoratorã€‚è¿™äº›ç±»åŸºæœ¬ä¸Šéƒ½æ˜¯åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£\næ€»ç»“ # Spring æ¡†æ¶ä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ\nå·¥å‚è®¾è®¡æ¨¡å¼ : Spring ä½¿ç”¨å·¥å‚æ¨¡å¼é€šè¿‡ BeanFactoryã€ApplicationContext åˆ›å»º bean å¯¹è±¡ã€‚ ä»£ç†è®¾è®¡æ¨¡å¼ : Spring AOP åŠŸèƒ½çš„å®ç°ã€‚ å•ä¾‹è®¾è®¡æ¨¡å¼ : Spring ä¸­çš„ Bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ã€‚ æ¨¡æ¿æ–¹æ³•æ¨¡å¼ : Spring ä¸­ jdbcTemplateã€hibernateTemplate ç­‰ä»¥ Template ç»“å°¾çš„å¯¹æ•°æ®åº“æ“ä½œçš„ç±»ï¼Œå®ƒä»¬å°±ä½¿ç”¨åˆ°äº†æ¨¡æ¿æ¨¡å¼ã€‚ åŒ…è£…å™¨è®¾è®¡æ¨¡å¼ : æˆ‘ä»¬çš„é¡¹ç›®éœ€è¦è¿æ¥å¤šä¸ªæ•°æ®åº“ï¼Œè€Œä¸”ä¸åŒçš„å®¢æˆ·åœ¨æ¯æ¬¡è®¿é—®ä¸­æ ¹æ®éœ€è¦ä¼šå»è®¿é—®ä¸åŒçš„æ•°æ®åº“ã€‚è¿™ç§æ¨¡å¼è®©æˆ‘ä»¬å¯ä»¥æ ¹æ®å®¢æˆ·çš„éœ€æ±‚èƒ½å¤ŸåŠ¨æ€åˆ‡æ¢ä¸åŒçš„æ•°æ®æºã€‚ è§‚å¯Ÿè€…æ¨¡å¼: Spring äº‹ä»¶é©±åŠ¨æ¨¡å‹å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼å¾ˆç»å…¸çš„ä¸€ä¸ªåº”ç”¨ã€‚ é€‚é…å™¨æ¨¡å¼ :Spring AOP çš„å¢å¼ºæˆ–é€šçŸ¥(Advice)ä½¿ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼ã€spring MVC ä¸­ä¹Ÿæ˜¯ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼é€‚é…Controllerã€‚ \u0026hellip;\u0026hellip; å‚è€ƒ # ã€ŠSpring æŠ€æœ¯å†…å¹•ã€‹ https://blog.eduonix.com/java-programming-2/learn-design-patterns-used-spring-framework/ http://blog.yeamin.top/2018/03/27/å•ä¾‹æ¨¡å¼-Springå•ä¾‹å®ç°åŸç†åˆ†æ/ https://www.tutorialsteacher.com/ioc/inversion-of-control https://design-patterns.readthedocs.io/zh_CN/latest/behavioral_patterns/observer.html https://juejin.im/post/5a8eb261f265da4e9e307230 https://juejin.im/post/5ba28986f265da0abc2b6084 "},{"id":98,"href":"/zh/docs/study/Review/java_guide/lybly_framework/ly03ly_spring-transaction/","title":"Springäº‹åŠ¡è¯¦æƒ…","section":"æ¡†æ¶","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nå‰æ®µæ—¶é—´ç­”åº”è¯»è€…çš„ Spring äº‹åŠ¡ åˆ†ææ€»ç»“ç»ˆäºæ¥äº†ã€‚è¿™éƒ¨åˆ†å†…å®¹æ¯”è¾ƒé‡è¦ï¼Œä¸è®ºæ˜¯å¯¹äºå·¥ä½œè¿˜æ˜¯é¢è¯•ï¼Œä½†æ˜¯ç½‘ä¸Šæ¯”è¾ƒå¥½çš„å‚è€ƒèµ„æ–™æ¯”è¾ƒå°‘ã€‚\nä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ # äº‹åŠ¡æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚\nç›¸ä¿¡å¤§å®¶åº”è¯¥éƒ½èƒ½èƒŒä¸Šé¢è¿™å¥è¯äº†ï¼Œä¸‹é¢æˆ‘ç»“åˆæˆ‘ä»¬æ—¥å¸¸çš„çœŸå®å¼€å‘æ¥è°ˆä¸€è°ˆã€‚\næˆ‘ä»¬ç³»ç»Ÿçš„æ¯ä¸ªä¸šåŠ¡æ–¹æ³•å¯èƒ½åŒ…æ‹¬äº†å¤šä¸ªåŸå­æ€§çš„æ•°æ®åº“æ“ä½œï¼Œæ¯”å¦‚ä¸‹é¢çš„ savePerson() æ–¹æ³•ä¸­å°±æœ‰ä¸¤ä¸ªåŸå­æ€§çš„æ•°æ®åº“æ“ä½œã€‚è¿™äº›åŸå­æ€§çš„æ•°æ®åº“æ“ä½œæ˜¯æœ‰ä¾èµ–çš„ï¼Œå®ƒä»¬è¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¸å°±éƒ½ä¸æ‰§è¡Œã€‚\npublic void savePerson() { personDao.save(person); personDetailDao.save(personDetail); } å¦å¤–ï¼Œéœ€è¦æ ¼å¤–æ³¨æ„çš„æ˜¯ï¼šäº‹åŠ¡èƒ½å¦ç”Ÿæ•ˆæ•°æ®åº“å¼•æ“æ˜¯å¦æ”¯æŒäº‹åŠ¡æ˜¯å…³é”®ã€‚æ¯”å¦‚å¸¸ç”¨çš„ MySQL æ•°æ®åº“é»˜è®¤ä½¿ç”¨æ”¯æŒäº‹åŠ¡çš„ innodbå¼•æ“ã€‚ä½†æ˜¯ï¼Œå¦‚æœæŠŠæ•°æ®åº“å¼•æ“å˜ä¸º myisamï¼Œé‚£ä¹ˆç¨‹åºä¹Ÿå°±ä¸å†æ”¯æŒäº‹åŠ¡äº†ï¼\näº‹åŠ¡æœ€ç»å…¸ä¹Ÿç»å¸¸è¢«æ‹¿å‡ºæ¥è¯´ä¾‹å­å°±æ˜¯è½¬è´¦äº†ã€‚å‡å¦‚å°æ˜è¦ç»™å°çº¢è½¬è´¦ 1000 å…ƒï¼Œè¿™ä¸ªè½¬è´¦ä¼šæ¶‰åŠåˆ°ä¸¤ä¸ªå…³é”®æ“ä½œå°±æ˜¯ï¼š\nå°†å°æ˜çš„ä½™é¢å‡å°‘ 1000 å…ƒã€‚ å°†å°çº¢çš„ä½™é¢å¢åŠ  1000 å…ƒã€‚ ä¸‡ä¸€åœ¨è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´çªç„¶å‡ºç°é”™è¯¯æ¯”å¦‚é“¶è¡Œç³»ç»Ÿå´©æºƒæˆ–è€…ç½‘ç»œæ•…éšœï¼Œå¯¼è‡´å°æ˜ä½™é¢å‡å°‘è€Œå°çº¢çš„ä½™é¢æ²¡æœ‰å¢åŠ ï¼Œè¿™æ ·å°±ä¸å¯¹äº†ã€‚äº‹åŠ¡å°±æ˜¯ä¿è¯è¿™ä¸¤ä¸ªå…³é”®æ“ä½œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½è¦å¤±è´¥ã€‚\npublic class OrdersService { private AccountDao accountDao; public void setOrdersDao(AccountDao accountDao) { this.accountDao = accountDao; } @Transactional(propagation = Propagation.REQUIRED, isolation = Isolation.DEFAULT, readOnly = false, timeout = -1) public void accountMoney() { //å°çº¢è´¦æˆ·å¤š1000 accountDao.addMoney(1000,xiaohong); //æ¨¡æ‹Ÿçªç„¶å‡ºç°çš„å¼‚å¸¸ï¼Œæ¯”å¦‚é“¶è¡Œä¸­å¯èƒ½ä¸ºçªç„¶åœç”µç­‰ç­‰ //å¦‚æœæ²¡æœ‰é…ç½®äº‹åŠ¡ç®¡ç†çš„è¯ä¼šé€ æˆï¼Œå°çº¢è´¦æˆ·å¤šäº†1000è€Œå°æ˜è´¦æˆ·æ²¡æœ‰å°‘é’± int i = 10 / 0; //å°ç‹è´¦æˆ·å°‘1000 accountDao.reduceMoney(1000,xiaoming); } } å¦å¤–ï¼Œæ•°æ®åº“äº‹åŠ¡çš„ ACID å››å¤§ç‰¹æ€§æ˜¯äº‹åŠ¡çš„åŸºç¡€ï¼Œä¸‹é¢ç®€å•æ¥äº†è§£ä¸€ä¸‹ã€‚\näº‹åŠ¡çš„ç‰¹æ€§ï¼ˆACIDï¼‰äº†è§£ä¹ˆ? AID -\u0026gt; C # åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼š ä¸€ä¸ªäº‹åŠ¡ï¼ˆtransactionï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œæˆ–è€…å…¨éƒ¨å®Œæˆï¼Œæˆ–è€…å…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«å›æ»šï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚å³ï¼Œäº‹åŠ¡ä¸å¯åˆ†å‰²ã€ä¸å¯çº¦ç®€ã€‚ ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼š åœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿™è¡¨ç¤ºå†™å…¥çš„èµ„æ–™å¿…é¡»å®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é¢„è®¾çº¦æŸã€è§¦å‘å™¨ã€çº§è”å›æ»šç­‰ã€‚ éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼š æ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš”ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«ï¼ŒåŒ…æ‹¬æœªæäº¤è¯»ï¼ˆRead uncommittedï¼‰ã€æäº¤è¯»ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ã€‚ æŒä¹…æ€§ï¼ˆDurabilityï¼‰: äº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚ å‚è€ƒ ï¼šhttps://zh.wikipedia.org/wiki/ACID ã€‚\nè¯¦è°ˆ Spring å¯¹äº‹åŠ¡çš„æ”¯æŒ # âš ï¸ å†æé†’ä¸€æ¬¡ï¼šä½ çš„ç¨‹åºæ˜¯å¦æ”¯æŒäº‹åŠ¡é¦–å…ˆå–å†³äºæ•°æ®åº“ ï¼Œæ¯”å¦‚ä½¿ç”¨ MySQL çš„è¯ï¼Œå¦‚æœä½ é€‰æ‹©çš„æ˜¯ innodb å¼•æ“ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œæ˜¯å¯ä»¥æ”¯æŒäº‹åŠ¡çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ çš„ MySQL æ•°æ®åº“ä½¿ç”¨çš„æ˜¯ myisam å¼•æ“çš„è¯ï¼Œé‚£ä¸å¥½æ„æ€ï¼Œä»æ ¹ä¸Šå°±æ˜¯ä¸æ”¯æŒäº‹åŠ¡çš„ã€‚\nè¿™é‡Œå†å¤šæä¸€ä¸‹ä¸€ä¸ªéå¸¸é‡è¦çš„çŸ¥è¯†ç‚¹ï¼š MySQL æ€ä¹ˆä¿è¯åŸå­æ€§çš„ï¼Ÿ\næˆ‘ä»¬çŸ¥é“å¦‚æœæƒ³è¦ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ï¼Œå°±éœ€è¦åœ¨å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œå¯¹å·²ç»æ‰§è¡Œçš„æ“ä½œè¿›è¡Œå›æ»šï¼Œåœ¨ MySQL ä¸­ï¼Œæ¢å¤æœºåˆ¶æ˜¯é€šè¿‡ å›æ»šæ—¥å¿—ï¼ˆundo logï¼‰ å®ç°çš„ï¼Œæ‰€æœ‰äº‹åŠ¡è¿›è¡Œçš„ä¿®æ”¹éƒ½ä¼šå…ˆè®°å½•åˆ°è¿™ä¸ªå›æ»šæ—¥å¿—ä¸­ï¼Œç„¶åå†æ‰§è¡Œç›¸å…³çš„æ“ä½œã€‚å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°å¼‚å¸¸çš„è¯ï¼Œæˆ‘ä»¬ç›´æ¥åˆ©ç”¨ å›æ»šæ—¥å¿— ä¸­çš„ä¿¡æ¯å°†æ•°æ®å›æ»šåˆ°ä¿®æ”¹ä¹‹å‰çš„æ ·å­å³å¯ï¼å¹¶ä¸”ï¼Œå›æ»šæ—¥å¿—ä¼šå…ˆäºæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šã€‚è¿™æ ·å°±ä¿è¯äº†å³ä½¿é‡åˆ°æ•°æ®åº“çªç„¶å®•æœºç­‰æƒ…å†µï¼Œå½“ç”¨æˆ·å†æ¬¡å¯åŠ¨æ•°æ®åº“çš„æ—¶å€™ï¼Œæ•°æ®åº“è¿˜èƒ½å¤Ÿé€šè¿‡æŸ¥è¯¢å›æ»šæ—¥å¿—æ¥å›æ»šä¹‹å‰æœªå®Œæˆçš„äº‹åŠ¡ã€‚\nSpring æ”¯æŒä¸¤ç§æ–¹å¼çš„äº‹åŠ¡ç®¡ç† # ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç† # é€šè¿‡ **TransactionTemplateæˆ–è€…TransactionManager**æ‰‹åŠ¨ç®¡ç†äº‹åŠ¡ï¼Œå®é™…åº”ç”¨ä¸­å¾ˆå°‘ä½¿ç”¨ï¼Œä½†æ˜¯å¯¹äºä½ ç†è§£ Spring äº‹åŠ¡ç®¡ç†åŸç†æœ‰å¸®åŠ©ã€‚\nä½¿ç”¨TransactionTemplate è¿›è¡Œç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n@Autowired private TransactionTemplate transactionTemplate; public void testTransaction() { transactionTemplate.execute(new TransactionCallbackWithoutResult() { @Override protected void doInTransactionWithoutResult(TransactionStatus transactionStatus) { try { // .... ä¸šåŠ¡ä»£ç  } catch (Exception e){ //å›æ»š transactionStatus.setRollbackOnly(); } } }); } ä½¿ç”¨ TransactionManager è¿›è¡Œç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n@Autowired private PlatformTransactionManager transactionManager; public void testTransaction() { TransactionStatus status = transactionManager.getTransaction(new DefaultTransactionDefinition()); try { // .... ä¸šåŠ¡ä»£ç  transactionManager.commit(status); } catch (Exception e) { transactionManager.rollback(status); } } å£°æ˜å¼äº‹åŠ¡ç®¡ç† # æ¨èä½¿ç”¨ï¼ˆä»£ç ä¾µå…¥æ€§æœ€å°ï¼‰ï¼Œå®é™…æ˜¯é€šè¿‡ AOP å®ç°ï¼ˆåŸºäº@Transactional çš„å…¨æ³¨è§£æ–¹å¼ä½¿ç”¨æœ€å¤šï¼‰ã€‚\nä½¿ç”¨ @Transactionalæ³¨è§£è¿›è¡Œäº‹åŠ¡ç®¡ç†çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n@Transactional(propagation = Propagation.REQUIRED) public void aMethod { //do something B b = new B(); C c = new C(); b.bMethod(); c.cMethod(); } Spring äº‹åŠ¡ç®¡ç†æ¥å£ä»‹ç» # Spring æ¡†æ¶ä¸­ï¼Œäº‹åŠ¡ç®¡ç†ç›¸å…³æœ€é‡è¦çš„ 3 ä¸ªæ¥å£å¦‚ä¸‹ï¼š\nPlatformTransactionManagerï¼š ï¼ˆå¹³å°ï¼‰äº‹åŠ¡ç®¡ç†å™¨ï¼ŒSpring äº‹åŠ¡ç­–ç•¥çš„æ ¸å¿ƒã€‚ TransactionDefinitionï¼š äº‹åŠ¡å®šä¹‰ä¿¡æ¯(äº‹åŠ¡éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºã€è¶…æ—¶ã€åªè¯»ã€å›æ»šè§„åˆ™)ã€‚ TransactionStatusï¼š äº‹åŠ¡è¿è¡ŒçŠ¶æ€ã€‚ æˆ‘ä»¬å¯ä»¥æŠŠ PlatformTransactionManager æ¥å£å¯ä»¥è¢«çœ‹ä½œæ˜¯äº‹åŠ¡ä¸Šå±‚çš„ç®¡ç†è€…ï¼Œè€Œ TransactionDefinition å’Œ TransactionStatus è¿™ä¸¤ä¸ªæ¥å£å¯ä»¥çœ‹ä½œæ˜¯äº‹åŠ¡çš„æè¿°ã€‚\nPlatformTransactionManager ä¼šæ ¹æ® TransactionDefinition çš„å®šä¹‰æ¯”å¦‚äº‹åŠ¡è¶…æ—¶æ—¶é—´ã€éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºç­‰æ¥è¿›è¡Œäº‹åŠ¡ç®¡ç† ï¼Œè€Œ TransactionStatus æ¥å£åˆ™æä¾›äº†ä¸€äº›æ–¹æ³•æ¥è·å–äº‹åŠ¡ç›¸åº”çš„çŠ¶æ€æ¯”å¦‚æ˜¯å¦æ–°äº‹åŠ¡ã€æ˜¯å¦å¯ä»¥å›æ»šç­‰ç­‰ã€‚\nPlatformTransactionManager:äº‹åŠ¡ç®¡ç†æ¥å£ # Spring å¹¶ä¸ç›´æ¥ç®¡ç†äº‹åŠ¡ï¼Œè€Œæ˜¯æä¾›äº†å¤šç§äº‹åŠ¡ç®¡ç†å™¨ ã€‚Spring äº‹åŠ¡ç®¡ç†å™¨çš„æ¥å£æ˜¯ï¼š PlatformTransactionManager ã€‚\né€šè¿‡è¿™ä¸ªæ¥å£ï¼ŒSpring ä¸ºå„ä¸ªå¹³å°å¦‚ï¼šJDBC(DataSourceTransactionManager)ã€Hibernate(HibernateTransactionManager)ã€JPA(JpaTransactionManager)ç­‰éƒ½æä¾›äº†å¯¹åº”çš„äº‹åŠ¡ç®¡ç†å™¨ï¼Œä½†æ˜¯å…·ä½“çš„å®ç°å°±æ˜¯å„ä¸ªå¹³å°è‡ªå·±çš„äº‹æƒ…äº†ã€‚\nPlatformTransactionManager æ¥å£çš„å…·ä½“å®ç°å¦‚ä¸‹:\nPlatformTransactionManageræ¥å£ä¸­å®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼š\npackage org.springframework.transaction; import org.springframework.lang.Nullable; public interface PlatformTransactionManager { //è·å¾—äº‹åŠ¡ TransactionStatus getTransaction(@Nullable TransactionDefinition var1) throws TransactionException; //æäº¤äº‹åŠ¡ void commit(TransactionStatus var1) throws TransactionException; //å›æ»šäº‹åŠ¡ void rollback(TransactionStatus var1) throws TransactionException; } è¿™é‡Œå¤šæ’ä¸€å˜´ã€‚ä¸ºä»€ä¹ˆè¦å®šä¹‰æˆ–è€…è¯´æŠ½è±¡å‡ºæ¥PlatformTransactionManagerè¿™ä¸ªæ¥å£å‘¢ï¼Ÿ\nä¸»è¦æ˜¯å› ä¸ºè¦å°†äº‹åŠ¡ç®¡ç†è¡Œä¸ºæŠ½è±¡å‡ºæ¥ï¼Œç„¶åä¸åŒçš„å¹³å°å»å®ç°å®ƒï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥ä¿è¯æä¾›ç»™å¤–éƒ¨çš„è¡Œä¸º(æä¾›ç»™ç¨‹åºå‘˜)ä¸å˜ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ‰©å±•ã€‚\næˆ‘å‰æ®µæ—¶é—´åœ¨æˆ‘çš„çŸ¥è¯†æ˜Ÿçƒåˆ†äº«è¿‡ï¼šâ€œä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ç”¨æ¥å£ï¼Ÿâ€ ã€‚\nã€Šè®¾è®¡æ¨¡å¼ã€‹ï¼ˆGOF é‚£æœ¬ï¼‰è¿™æœ¬ä¹¦åœ¨å¾ˆå¤šå¹´å‰éƒ½æåˆ°è¿‡è¯´è¦åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹ï¼Œä½ çœŸçš„çŸ¥é“ä¸ºä»€ä¹ˆè¦åŸºäºæ¥å£ç¼–ç¨‹ä¹ˆï¼Ÿ\nçºµè§‚å¼€æºæ¡†æ¶å’Œé¡¹ç›®çš„æºç ï¼Œæ¥å£æ˜¯å®ƒä»¬ä¸å¯æˆ–ç¼ºçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚è¦ç†è§£ä¸ºä»€ä¹ˆè¦ç”¨æ¥å£ï¼Œé¦–å…ˆè¦ææ‡‚æ¥å£æä¾›äº†ä»€ä¹ˆåŠŸèƒ½ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ¥å£ç†è§£ä¸ºæä¾›äº†ä¸€ç³»åˆ—åŠŸèƒ½åˆ—è¡¨çš„çº¦å®šï¼Œæ¥å£æœ¬èº«ä¸æä¾›åŠŸèƒ½ï¼Œå®ƒåªå®šä¹‰è¡Œä¸ºã€‚ä½†æ˜¯è°è¦ç”¨ï¼Œå°±è¦å…ˆå®ç°æˆ‘ï¼Œéµå®ˆæˆ‘çš„çº¦å®šï¼Œç„¶åå†è‡ªå·±å»å®ç°æˆ‘å®šä¹‰çš„è¦å®ç°çš„åŠŸèƒ½ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä¸Šä¸ªé¡¹ç›®æœ‰å‘é€çŸ­ä¿¡çš„éœ€æ±‚ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å®šäº†ä¸€ä¸ªæ¥å£ï¼Œæ¥å£åªæœ‰ä¸¤ä¸ªæ–¹æ³•:\n1.å‘é€çŸ­ä¿¡ 2.å¤„ç†å‘é€ç»“æœçš„æ–¹æ³•ã€‚\nåˆšå¼€å§‹æˆ‘ä»¬ç”¨çš„æ˜¯é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡ï¼Œç„¶åæˆ‘ä»¬å®ç°è¿™ä¸ªæ¥å£å®Œæˆäº†ä¸€ä¸ªé˜¿é‡Œäº‘çŸ­ä¿¡çš„æœåŠ¡ã€‚åæ¥ï¼Œæˆ‘ä»¬çªç„¶åˆæ¢åˆ°äº†åˆ«çš„çŸ­ä¿¡æœåŠ¡å¹³å°ï¼Œæˆ‘ä»¬è¿™ä¸ªæ—¶å€™åªéœ€è¦å†å®ç°è¿™ä¸ªæ¥å£å³å¯ã€‚è¿™æ ·ä¿è¯äº†æˆ‘ä»¬æä¾›ç»™å¤–éƒ¨çš„è¡Œä¸ºä¸å˜ã€‚å‡ ä¹ä¸éœ€è¦æ”¹å˜ä»€ä¹ˆä»£ç ï¼Œæˆ‘ä»¬å°±è½»æ¾å®Œæˆäº†éœ€æ±‚çš„è½¬å˜ï¼Œæé«˜äº†ä»£ç çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nä»€ä¹ˆæ—¶å€™ç”¨æ¥å£ï¼Ÿå½“ä½ è¦å®ç°çš„åŠŸèƒ½æ¨¡å—è®¾è®¡æŠ½è±¡è¡Œä¸ºçš„æ—¶å€™ï¼Œæ¯”å¦‚å‘é€çŸ­ä¿¡çš„æœåŠ¡ï¼Œå›¾åºŠçš„å­˜å‚¨æœåŠ¡ç­‰ç­‰ã€‚\nTransactionDefinition:äº‹åŠ¡å±æ€§ # äº‹åŠ¡ç®¡ç†å™¨æ¥å£ PlatformTransactionManager é€šè¿‡ getTransaction(TransactionDefinition definition) æ–¹æ³•æ¥å¾—åˆ°ä¸€ä¸ªäº‹åŠ¡ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œé¢çš„å‚æ•°æ˜¯ TransactionDefinition ç±» ï¼Œè¿™ä¸ªç±»å°±å®šä¹‰äº†ä¸€äº›åŸºæœ¬çš„äº‹åŠ¡å±æ€§ã€‚\nä»€ä¹ˆæ˜¯äº‹åŠ¡å±æ€§å‘¢ï¼Ÿ äº‹åŠ¡å±æ€§å¯ä»¥ç†è§£æˆäº‹åŠ¡çš„ä¸€äº›åŸºæœ¬é…ç½®ï¼Œæè¿°äº†äº‹åŠ¡ç­–ç•¥å¦‚ä½•åº”ç”¨åˆ°æ–¹æ³•ä¸Šã€‚\näº‹åŠ¡å±æ€§åŒ…å«äº† 5 ä¸ªæ–¹é¢ï¼š\néš”ç¦»çº§åˆ« ä¼ æ’­è¡Œä¸º å›æ»šè§„åˆ™ æ˜¯å¦åªè¯» äº‹åŠ¡è¶…æ—¶ TransactionDefinition æ¥å£ä¸­å®šä¹‰äº† 5 ä¸ªæ–¹æ³•ä»¥åŠä¸€äº›è¡¨ç¤ºäº‹åŠ¡å±æ€§çš„å¸¸é‡æ¯”å¦‚éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºç­‰ç­‰ã€‚\npackage org.springframework.transaction; import org.springframework.lang.Nullable; public interface TransactionDefinition { int PROPAGATION_REQUIRED = 0; int PROPAGATION_SUPPORTS = 1; int PROPAGATION_MANDATORY = 2; int PROPAGATION_REQUIRES_NEW = 3; int PROPAGATION_NOT_SUPPORTED = 4; int PROPAGATION_NEVER = 5; int PROPAGATION_NESTED = 6; int ISOLATION_DEFAULT = -1; int ISOLATION_READ_UNCOMMITTED = 1; int ISOLATION_READ_COMMITTED = 2; int ISOLATION_REPEATABLE_READ = 4; int ISOLATION_SERIALIZABLE = 8; int TIMEOUT_DEFAULT = -1; // è¿”å›äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Œé»˜è®¤å€¼ä¸º REQUIREDã€‚ int getPropagationBehavior(); //è¿”å›äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œé»˜è®¤å€¼æ˜¯ DEFAULT int getIsolationLevel(); // è¿”å›äº‹åŠ¡çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º-1ã€‚å¦‚æœè¶…è¿‡è¯¥æ—¶é—´é™åˆ¶ä½†äº‹åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™è‡ªåŠ¨å›æ»šäº‹åŠ¡ã€‚ int getTimeout(); // è¿”å›æ˜¯å¦ä¸ºåªè¯»äº‹åŠ¡ï¼Œé»˜è®¤å€¼ä¸º false boolean isReadOnly(); @Nullable String getName(); } TransactionStatus:äº‹åŠ¡çŠ¶æ€ # TransactionStatusæ¥å£ç”¨æ¥è®°å½•äº‹åŠ¡çš„çŠ¶æ€ è¯¥æ¥å£å®šä¹‰äº†ä¸€ç»„æ–¹æ³•,ç”¨æ¥è·å–æˆ–åˆ¤æ–­ äº‹åŠ¡çš„ç›¸åº”çŠ¶æ€ä¿¡æ¯ã€‚\nPlatformTransactionManager.getTransaction(â€¦)æ–¹æ³•è¿”å›ä¸€ä¸ª TransactionStatus å¯¹è±¡ã€‚\nTransactionStatus æ¥å£å†…å®¹å¦‚ä¸‹ï¼š\npublic interface TransactionStatus{ boolean isNewTransaction(); // æ˜¯å¦æ˜¯æ–°çš„äº‹åŠ¡ boolean hasSavepoint(); // æ˜¯å¦æœ‰æ¢å¤ç‚¹ void setRollbackOnly(); // è®¾ç½®ä¸ºåªå›æ»š boolean isRollbackOnly(); // æ˜¯å¦ä¸ºåªå›æ»š boolean isCompleted; // æ˜¯å¦å·²å®Œæˆ } äº‹åŠ¡å±æ€§è¯¦è§£ # å®é™…ä¸šåŠ¡å¼€å‘ä¸­ï¼Œå¤§å®¶ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨ @Transactional æ³¨è§£æ¥å¼€å¯äº‹åŠ¡ï¼Œä½†å¾ˆå¤šäººå¹¶ä¸æ¸…æ¥šè¿™ä¸ªæ³¨è§£é‡Œé¢çš„å‚æ•°æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæœ‰ä»€ä¹ˆç”¨ã€‚ä¸ºäº†æ›´å¥½çš„åœ¨é¡¹ç›®ä¸­ä½¿ç”¨äº‹åŠ¡ç®¡ç†ï¼Œå¼ºçƒˆæ¨èå¥½å¥½é˜…è¯»ä¸€ä¸‹ä¸‹é¢çš„å†…å®¹ã€‚\näº‹åŠ¡ä¼ æ’­è¡Œä¸º # äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯ä¸ºäº†è§£å†³ä¸šåŠ¡å±‚æ–¹æ³•ä¹‹é—´äº’ç›¸è°ƒç”¨çš„äº‹åŠ¡é—®é¢˜ã€‚\nå½“äº‹åŠ¡æ–¹æ³•è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå¿…é¡»æŒ‡å®šäº‹åŠ¡åº”è¯¥å¦‚ä½•ä¼ æ’­ã€‚ä¾‹å¦‚ï¼šæ–¹æ³•å¯èƒ½ç»§ç»­åœ¨ç°æœ‰äº‹åŠ¡ä¸­è¿è¡Œï¼Œä¹Ÿå¯èƒ½å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¹¶åœ¨è‡ªå·±çš„äº‹åŠ¡ä¸­è¿è¡Œã€‚\nä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬åœ¨ A ç±»çš„aMethod()æ–¹æ³•ä¸­è°ƒç”¨äº† B ç±»çš„ bMethod() æ–¹æ³•ã€‚è¿™ä¸ªæ—¶å€™å°±æ¶‰åŠåˆ°ä¸šåŠ¡å±‚æ–¹æ³•ä¹‹é—´äº’ç›¸è°ƒç”¨çš„äº‹åŠ¡é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬çš„ bMethod()å¦‚æœå‘ç”Ÿå¼‚å¸¸éœ€è¦å›æ»šï¼Œå¦‚ä½•é…ç½®äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ‰èƒ½è®© aMethod()ä¹Ÿè·Ÿç€å›æ»šå‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™å°±éœ€è¦äº‹åŠ¡ä¼ æ’­è¡Œä¸ºçš„çŸ¥è¯†äº†ï¼Œå¦‚æœä½ ä¸çŸ¥é“çš„è¯ä¸€å®šè¦å¥½å¥½çœ‹ä¸€ä¸‹ã€‚\n@Service Class A { @Autowired B b; @Transactional(propagation = Propagation.xxx) public void aMethod { //do something b.bMethod(); } } @Service Class B { @Transactional(propagation = Propagation.xxx) public void bMethod { //do something } } åœ¨TransactionDefinitionå®šä¹‰ä¸­åŒ…æ‹¬äº†å¦‚ä¸‹å‡ ä¸ªè¡¨ç¤ºä¼ æ’­è¡Œä¸ºçš„å¸¸é‡ï¼š\npublic interface TransactionDefinition { int PROPAGATION_REQUIRED = 0; int PROPAGATION_SUPPORTS = 1; int PROPAGATION_MANDATORY = 2; int PROPAGATION_REQUIRES_NEW = 3; int PROPAGATION_NOT_SUPPORTED = 4; int PROPAGATION_NEVER = 5; int PROPAGATION_NESTED = 6; ...... } ä¸è¿‡ï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼ŒSpring ç›¸åº”åœ°å®šä¹‰äº†ä¸€ä¸ªæšä¸¾ç±»ï¼šPropagation\npackage org.springframework.transaction.annotation; import org.springframework.transaction.TransactionDefinition; public enum Propagation { REQUIRED(TransactionDefinition.PROPAGATION_REQUIRED), SUPPORTS(TransactionDefinition.PROPAGATION_SUPPORTS), MANDATORY(TransactionDefinition.PROPAGATION_MANDATORY), REQUIRES_NEW(TransactionDefinition.PROPAGATION_REQUIRES_NEW), NOT_SUPPORTED(TransactionDefinition.PROPAGATION_NOT_SUPPORTED), NEVER(TransactionDefinition.PROPAGATION_NEVER), NESTED(TransactionDefinition.PROPAGATION_NESTED); private final int value; Propagation(int value) { this.value = value; } public int value() { return this.value; } } æ­£ç¡®çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºå¯èƒ½çš„å€¼å¦‚ä¸‹ ï¼š\n1.TransactionDefinition.PROPAGATION_REQUIRED\nä½¿ç”¨çš„æœ€å¤šçš„ä¸€ä¸ªäº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼Œæˆ‘ä»¬å¹³æ—¶ç»å¸¸ä½¿ç”¨çš„@Transactionalæ³¨è§£é»˜è®¤ä½¿ç”¨å°±æ˜¯è¿™ä¸ªäº‹åŠ¡ä¼ æ’­è¡Œä¸ºã€‚å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š\nå¦‚æœå¤–éƒ¨æ–¹æ³•æ²¡æœ‰å¼€å¯äº‹åŠ¡çš„è¯ï¼ŒPropagation.REQUIREDä¿®é¥°çš„å†…éƒ¨æ–¹æ³•ä¼šæ–°å¼€å¯è‡ªå·±çš„äº‹åŠ¡ï¼Œä¸”å¼€å¯çš„äº‹åŠ¡ç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°ã€‚ å¦‚æœå¤–éƒ¨æ–¹æ³•å¼€å¯äº‹åŠ¡å¹¶ä¸”è¢«Propagation.REQUIREDçš„è¯ï¼Œæ‰€æœ‰Propagation.REQUIREDä¿®é¥°çš„å†…éƒ¨æ–¹æ³•å’Œå¤–éƒ¨æ–¹æ³•å‡å±äºåŒä¸€äº‹åŠ¡ ï¼Œåªè¦ä¸€ä¸ªæ–¹æ³•å›æ»šï¼Œæ•´ä¸ªäº‹åŠ¡å‡å›æ»šã€‚ ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœæˆ‘ä»¬ä¸Šé¢çš„aMethod()å’ŒbMethod()ä½¿ç”¨çš„éƒ½æ˜¯PROPAGATION_REQUIREDä¼ æ’­è¡Œä¸ºçš„è¯ï¼Œä¸¤è€…ä½¿ç”¨çš„å°±æ˜¯åŒä¸€ä¸ªäº‹åŠ¡ï¼Œåªè¦å…¶ä¸­ä¸€ä¸ªæ–¹æ³•å›æ»šï¼Œæ•´ä¸ªäº‹åŠ¡å‡å›æ»šã€‚\n@Service Class A { @Autowired B b; @Transactional(propagation = Propagation.REQUIRED) public void aMethod { //do something b.bMethod(); } } @Service Class B { @Transactional(propagation = Propagation.REQUIRED) public void bMethod { //do something } } 2.TransactionDefinition.PROPAGATION_REQUIRES_NEW\nåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸ç®¡å¤–éƒ¨æ–¹æ³•æ˜¯å¦å¼€å¯äº‹åŠ¡ï¼ŒPropagation.REQUIRES_NEWä¿®é¥°çš„å†…éƒ¨æ–¹æ³•ä¼šæ–°å¼€å¯è‡ªå·±çš„äº‹åŠ¡ï¼Œä¸”å¼€å¯çš„äº‹åŠ¡ç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°ã€‚\nä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœæˆ‘ä»¬ä¸Šé¢çš„bMethod()ä½¿ç”¨PROPAGATION_REQUIRES_NEWäº‹åŠ¡ä¼ æ’­è¡Œä¸ºä¿®é¥°ï¼ŒaMethodè¿˜æ˜¯ç”¨PROPAGATION_REQUIREDä¿®é¥°çš„è¯ã€‚å¦‚æœaMethod()å‘ç”Ÿå¼‚å¸¸å›æ»šï¼ŒbMethod()ä¸ä¼šè·Ÿç€å›æ»šï¼Œå› ä¸º bMethod()å¼€å¯äº†ç‹¬ç«‹çš„äº‹åŠ¡ã€‚ä½†æ˜¯ï¼Œå¦‚æœ bMethod()æŠ›å‡ºäº†æœªè¢«æ•è·çš„å¼‚å¸¸å¹¶ä¸”è¿™ä¸ªå¼‚å¸¸æ»¡è¶³äº‹åŠ¡å›æ»šè§„åˆ™çš„è¯,aMethod()åŒæ ·ä¹Ÿä¼šå›æ»šï¼Œå› ä¸ºè¿™ä¸ªå¼‚å¸¸è¢« aMethod()çš„äº‹åŠ¡ç®¡ç†æœºåˆ¶æ£€æµ‹åˆ°äº†ã€‚\n@Service Class A { @Autowired B b; @Transactional(propagation = Propagation.REQUIRED) public void aMethod { //do something b.bMethod(); } } @Service Class B { @Transactional(propagation = Propagation.REQUIRES_NEW) public void bMethod { //do something } } 3.TransactionDefinition.PROPAGATION_NESTED:\nå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æ‰§è¡Œä¸TransactionDefinition.PROPAGATION_REQUIREDç±»ä¼¼çš„æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š\nåœ¨å¤–éƒ¨æ–¹æ³•å¼€å¯äº‹åŠ¡çš„æƒ…å†µä¸‹,åœ¨å†…éƒ¨å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œä½œä¸ºåµŒå¥—äº‹åŠ¡å­˜åœ¨ã€‚ å¦‚æœå¤–éƒ¨æ–¹æ³•æ— äº‹åŠ¡ï¼Œåˆ™å•ç‹¬å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œä¸ PROPAGATION_REQUIRED ç±»ä¼¼ã€‚ è¿™é‡Œè¿˜æ˜¯ç®€å•ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœ bMethod() å›æ»šçš„è¯ï¼ŒaMethod()ä¹Ÿä¼šå›æ»šã€‚\nå¦‚æœaMethod()å›æ»šçš„è¯ï¼ŒbMethod()ä¹Ÿä¼šå›æ»š\n@Service Class A { @Autowired B b; @Transactional(propagation = Propagation.REQUIRED) public void aMethod { //do something b.bMethod(); } } @Service Class B { @Transactional(propagation = Propagation.NESTED) public void bMethod { //do something } } 4.TransactionDefinition.PROPAGATION_MANDATORY\nå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ï¼ˆmandatoryï¼šå¼ºåˆ¶æ€§ï¼‰\nè¿™ä¸ªä½¿ç”¨çš„å¾ˆå°‘ï¼Œå°±ä¸ä¸¾ä¾‹å­æ¥è¯´äº†ã€‚\nè‹¥æ˜¯é”™è¯¯çš„é…ç½®ä»¥ä¸‹ 3 ç§äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼Œäº‹åŠ¡å°†ä¸ä¼šå‘ç”Ÿå›æ»šï¼Œè¿™é‡Œä¸å¯¹ç…§æ¡ˆä¾‹è®²è§£äº†ï¼Œä½¿ç”¨çš„å¾ˆå°‘ã€‚\nTransactionDefinition.PROPAGATION_SUPPORTS: å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œã€‚ TransactionDefinition.PROPAGATION_NOT_SUPPORTED: ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚ TransactionDefinition.PROPAGATION_NEVER: ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ æ›´å¤šå…³äºäº‹åŠ¡ä¼ æ’­è¡Œä¸ºçš„å†…å®¹è¯·çœ‹è¿™ç¯‡æ–‡ç« ï¼šã€Šå¤ªéš¾äº†~é¢è¯•å®˜è®©æˆ‘ç»“åˆæ¡ˆä¾‹è®²è®²è‡ªå·±å¯¹ Spring äº‹åŠ¡ä¼ æ’­è¡Œä¸ºçš„ç†è§£ã€‚ã€‹\näº‹åŠ¡éš”ç¦»çº§åˆ« # TransactionDefinition æ¥å£ä¸­å®šä¹‰äº†äº”ä¸ªè¡¨ç¤ºéš”ç¦»çº§åˆ«çš„å¸¸é‡ï¼š\npublic interface TransactionDefinition { ...... int ISOLATION_DEFAULT = -1; int ISOLATION_READ_UNCOMMITTED = 1; int ISOLATION_READ_COMMITTED = 2; int ISOLATION_REPEATABLE_READ = 4; int ISOLATION_SERIALIZABLE = 8; ...... } å’Œäº‹åŠ¡ä¼ æ’­è¡Œä¸ºé‚£å—ä¸€æ ·ï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼ŒSpring ä¹Ÿç›¸åº”åœ°å®šä¹‰äº†ä¸€ä¸ªæšä¸¾ç±»ï¼šIsolation\npublic enum Isolation { DEFAULT(TransactionDefinition.ISOLATION_DEFAULT), READ_UNCOMMITTED(TransactionDefinition.ISOLATION_READ_UNCOMMITTED), READ_COMMITTED(TransactionDefinition.ISOLATION_READ_COMMITTED), REPEATABLE_READ(TransactionDefinition.ISOLATION_REPEATABLE_READ), SERIALIZABLE(TransactionDefinition.ISOLATION_SERIALIZABLE); private final int value; Isolation(int value) { this.value = value; } public int value() { return this.value; } } ä¸‹é¢æˆ‘ä¾æ¬¡å¯¹æ¯ä¸€ç§äº‹åŠ¡éš”ç¦»çº§åˆ«è¿›è¡Œä»‹ç»ï¼š\nTransactionDefinition.ISOLATION_DEFAULT :ä½¿ç”¨åç«¯æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼ŒMySQL é»˜è®¤é‡‡ç”¨çš„ REPEATABLE_READ éš”ç¦»çº§åˆ« Oracle é»˜è®¤é‡‡ç”¨çš„ READ_COMMITTED éš”ç¦»çº§åˆ«. TransactionDefinition.ISOLATION_READ_UNCOMMITTED :æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œä½¿ç”¨è¿™ä¸ªéš”ç¦»çº§åˆ«å¾ˆå°‘ï¼Œå› ä¸ºå®ƒå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯» TransactionDefinition.ISOLATION_READ_COMMITTED : å…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ TransactionDefinition.ISOLATION_REPEATABLE_READ : å¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œå¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚ TransactionDefinition.ISOLATION_SERIALIZABLE : æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä» ACID çš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»ã€‚ä½†æ˜¯è¿™å°†ä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚é€šå¸¸æƒ…å†µä¸‹ä¹Ÿä¸ä¼šç”¨åˆ°è¯¥çº§åˆ«ã€‚ ç›¸å…³é˜…è¯»ï¼šMySQLäº‹åŠ¡éš”ç¦»çº§åˆ«è¯¦è§£ã€‚\näº‹åŠ¡è¶…æ—¶å±æ€§ # æ‰€è°“äº‹åŠ¡è¶…æ—¶ï¼Œå°±æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡æ‰€å…è®¸æ‰§è¡Œçš„æœ€é•¿æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡è¯¥æ—¶é—´é™åˆ¶ä½†äº‹åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™è‡ªåŠ¨å›æ»šäº‹åŠ¡ã€‚åœ¨ TransactionDefinition ä¸­ä»¥ int çš„å€¼æ¥è¡¨ç¤ºè¶…æ—¶æ—¶é—´ï¼Œå…¶å•ä½æ˜¯ç§’ï¼Œé»˜è®¤å€¼ä¸º-1ï¼Œè¿™è¡¨ç¤ºäº‹åŠ¡çš„è¶…æ—¶æ—¶é—´å–å†³äºåº•å±‚äº‹åŠ¡ç³»ç»Ÿæˆ–è€…æ²¡æœ‰è¶…æ—¶æ—¶é—´ã€‚\näº‹åŠ¡åªè¯»å±æ€§ # package org.springframework.transaction; import org.springframework.lang.Nullable; public interface TransactionDefinition { ...... // è¿”å›æ˜¯å¦ä¸ºåªè¯»äº‹åŠ¡ï¼Œé»˜è®¤å€¼ä¸º false boolean isReadOnly(); } å¯¹äºåªæœ‰è¯»å–æ•°æ®æŸ¥è¯¢çš„äº‹åŠ¡ï¼Œå¯ä»¥æŒ‡å®šäº‹åŠ¡ç±»å‹ä¸º readonlyï¼Œå³åªè¯»äº‹åŠ¡ã€‚åªè¯»äº‹åŠ¡ä¸æ¶‰åŠæ•°æ®çš„ä¿®æ”¹ï¼Œæ•°æ®åº“ä¼šæä¾›ä¸€äº›ä¼˜åŒ–æ‰‹æ®µï¼Œé€‚åˆç”¨åœ¨æœ‰å¤šæ¡æ•°æ®åº“æŸ¥è¯¢æ“ä½œçš„æ–¹æ³•ä¸­ã€‚\nå¾ˆå¤šäººå°±ä¼šç–‘é—®äº†ï¼Œä¸ºä»€ä¹ˆæˆ‘ä¸€ä¸ªæ•°æ®æŸ¥è¯¢æ“ä½œè¿˜è¦å¯ç”¨äº‹åŠ¡æ”¯æŒå‘¢ï¼Ÿ\næ‹¿ MySQL çš„ innodb ä¸¾ä¾‹å­ï¼Œæ ¹æ®å®˜ç½‘ https://dev.mysql.com/doc/refman/5.7/en/innodb-autocommit-commit-rollback.html æè¿°ï¼š\nMySQL é»˜è®¤å¯¹æ¯ä¸€ä¸ªæ–°å»ºç«‹çš„è¿æ¥éƒ½å¯ç”¨äº†autocommitæ¨¡å¼ã€‚åœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œæ¯ä¸€ä¸ªå‘é€åˆ° MySQL æœåŠ¡å™¨çš„sqlè¯­å¥éƒ½ä¼šåœ¨ä¸€ä¸ªå•ç‹¬çš„äº‹åŠ¡ä¸­è¿›è¡Œå¤„ç†ï¼Œæ‰§è¡Œç»“æŸåä¼šè‡ªåŠ¨æäº¤äº‹åŠ¡ï¼Œå¹¶å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼ˆæ‰ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼‰ã€‚\nä½†æ˜¯ï¼Œå¦‚æœä½ ç»™æ–¹æ³•åŠ ä¸Šäº†Transactionalæ³¨è§£çš„è¯ï¼Œè¿™ä¸ªæ–¹æ³•æ‰§è¡Œçš„æ‰€æœ‰sqlä¼šè¢«æ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚å¦‚æœå£°æ˜äº†åªè¯»äº‹åŠ¡çš„è¯ï¼Œæ•°æ®åº“å°±ä¼šå»ä¼˜åŒ–å®ƒçš„æ‰§è¡Œï¼Œå¹¶ä¸ä¼šå¸¦æ¥å…¶ä»–çš„ä»€ä¹ˆæ”¶ç›Šã€‚\nå¦‚æœä¸åŠ Transactionalï¼Œæ¯æ¡sqlä¼šå¼€å¯ä¸€ä¸ªå•ç‹¬çš„äº‹åŠ¡ï¼Œä¸­é—´è¢«å…¶å®ƒäº‹åŠ¡æ”¹äº†æ•°æ®ï¼Œéƒ½ä¼šå®æ—¶è¯»å–åˆ°æœ€æ–°å€¼ã€‚\nåˆ†äº«ä¸€ä¸‹å…³äºäº‹åŠ¡åªè¯»å±æ€§ï¼Œå…¶ä»–äººçš„è§£ç­”ï¼š\nå¦‚æœä½ ä¸€æ¬¡æ‰§è¡Œå•æ¡æŸ¥è¯¢è¯­å¥ï¼Œåˆ™æ²¡æœ‰å¿…è¦å¯ç”¨äº‹åŠ¡æ”¯æŒï¼Œæ•°æ®åº“é»˜è®¤æ”¯æŒ SQL æ‰§è¡ŒæœŸé—´çš„è¯»ä¸€è‡´æ€§ï¼› å¦‚æœä½ ä¸€æ¬¡æ‰§è¡Œå¤šæ¡æŸ¥è¯¢è¯­å¥ï¼Œä¾‹å¦‚ç»Ÿè®¡æŸ¥è¯¢ï¼ŒæŠ¥è¡¨æŸ¥è¯¢ï¼Œåœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œå¤šæ¡æŸ¥è¯¢ SQL å¿…é¡»ä¿è¯æ•´ä½“çš„è¯»ä¸€è‡´æ€§ï¼Œå¦åˆ™ï¼Œåœ¨å‰æ¡ SQL æŸ¥è¯¢ä¹‹åï¼Œåæ¡ SQL æŸ¥è¯¢ä¹‹å‰ï¼Œæ•°æ®è¢«å…¶ä»–ç”¨æˆ·æ”¹å˜ï¼Œåˆ™è¯¥æ¬¡æ•´ä½“çš„ç»Ÿè®¡æŸ¥è¯¢å°†ä¼šå‡ºç°è¯»æ•°æ®ä¸ä¸€è‡´çš„çŠ¶æ€ï¼Œæ­¤æ—¶ï¼Œåº”è¯¥å¯ç”¨äº‹åŠ¡æ”¯æŒï¼ˆé¿å…å¤šæ¬¡æŸ¥è¯¢ç»“æœä¸ä¸€è‡´ï¼‰ äº‹åŠ¡å›æ»šè§„åˆ™ # è¿™äº›è§„åˆ™å®šä¹‰äº†å“ªäº›å¼‚å¸¸ä¼šå¯¼è‡´äº‹åŠ¡å›æ»šè€Œå“ªäº›ä¸ä¼šã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹åŠ¡åªæœ‰é‡åˆ°è¿è¡ŒæœŸå¼‚å¸¸ï¼ˆRuntimeException çš„å­ç±»ï¼‰æ—¶æ‰ä¼šå›æ»šï¼ŒError ä¹Ÿä¼šå¯¼è‡´äº‹åŠ¡å›æ»šï¼Œä½†æ˜¯ï¼Œåœ¨é‡åˆ°æ£€æŸ¥å‹ï¼ˆCheckedï¼‰å¼‚å¸¸æ—¶ä¸ä¼šå›æ»šã€‚[ **è¿™é‡Œè¯´çš„æ˜¯é»˜è®¤æƒ…å†µä¸‹ **]\nå¦‚æœä½ æƒ³è¦å›æ»šä½ å®šä¹‰çš„ç‰¹å®šçš„å¼‚å¸¸ç±»å‹çš„è¯ï¼Œå¯ä»¥è¿™æ ·ï¼š\n@Transactional(rollbackFor= MyException.class) @Transactional æ³¨è§£ä½¿ç”¨è¯¦è§£ # @Transactional çš„ä½œç”¨èŒƒå›´ # æ–¹æ³• ï¼šæ¨èå°†æ³¨è§£ä½¿ç”¨äºæ–¹æ³•ä¸Šï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¯¥æ³¨è§£åªèƒ½åº”ç”¨åˆ° public æ–¹æ³•ä¸Šï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆã€‚ ç±» ï¼šå¦‚æœè¿™ä¸ªæ³¨è§£ä½¿ç”¨åœ¨ç±»ä¸Šçš„è¯ï¼Œè¡¨æ˜è¯¥æ³¨è§£å¯¹è¯¥ç±»ä¸­æ‰€æœ‰çš„ public æ–¹æ³•éƒ½ç”Ÿæ•ˆã€‚ æ¥å£ ï¼šä¸æ¨èåœ¨æ¥å£ä¸Šä½¿ç”¨ã€‚ @Transactional çš„å¸¸ç”¨é…ç½®å‚æ•° # @Transactionalæ³¨è§£æºç å¦‚ä¸‹ï¼Œé‡Œé¢åŒ…å«äº†åŸºæœ¬äº‹åŠ¡å±æ€§çš„é…ç½®ï¼š\n@Target({ElementType.TYPE, ElementType.METHOD}) @Retention(RetentionPolicy.RUNTIME) @Inherited @Documented public @interface Transactional { @AliasFor(\u0026#34;transactionManager\u0026#34;) String value() default \u0026#34;\u0026#34;; @AliasFor(\u0026#34;value\u0026#34;) String transactionManager() default \u0026#34;\u0026#34;; Propagation propagation() default Propagation.REQUIRED; Isolation isolation() default Isolation.DEFAULT; int timeout() default TransactionDefinition.TIMEOUT_DEFAULT; boolean readOnly() default false; Class\u0026lt;? extends Throwable\u0026gt;[] rollbackFor() default {}; String[] rollbackForClassName() default {}; Class\u0026lt;? extends Throwable\u0026gt;[] noRollbackFor() default {}; String[] noRollbackForClassName() default {}; } @Transactional çš„å¸¸ç”¨é…ç½®å‚æ•°æ€»ç»“ï¼ˆåªåˆ—å‡ºäº† 5 ä¸ªæˆ‘å¹³æ—¶æ¯”è¾ƒå¸¸ç”¨çš„ï¼‰ï¼š\nå±æ€§å è¯´æ˜ propagation äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Œé»˜è®¤å€¼ä¸º REQUIREDï¼Œå¯é€‰çš„å€¼åœ¨ä¸Šé¢ä»‹ç»è¿‡ isolation äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œé»˜è®¤å€¼é‡‡ç”¨ DEFAULTï¼Œå¯é€‰çš„å€¼åœ¨ä¸Šé¢ä»‹ç»è¿‡ timeout äº‹åŠ¡çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º-1ï¼ˆä¸ä¼šè¶…æ—¶ï¼‰ã€‚å¦‚æœè¶…è¿‡è¯¥æ—¶é—´é™åˆ¶ä½†äº‹åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™è‡ªåŠ¨å›æ»šäº‹åŠ¡ã€‚ readOnly æŒ‡å®šäº‹åŠ¡æ˜¯å¦ä¸ºåªè¯»äº‹åŠ¡ï¼Œé»˜è®¤å€¼ä¸º falseã€‚ rollbackFor ç”¨äºæŒ‡å®šèƒ½å¤Ÿè§¦å‘äº‹åŠ¡å›æ»šçš„å¼‚å¸¸ç±»å‹ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šå¤šä¸ªå¼‚å¸¸ç±»å‹ã€‚ @Transactional äº‹åŠ¡æ³¨è§£åŸç† # é¢è¯•ä¸­åœ¨é—® AOP çš„æ—¶å€™å¯èƒ½ä¼šè¢«é—®åˆ°çš„ä¸€ä¸ªé—®é¢˜ã€‚ç®€å•è¯´ä¸‹å§ï¼\næˆ‘ä»¬çŸ¥é“ï¼Œ@Transactional çš„å·¥ä½œæœºåˆ¶æ˜¯åŸºäº AOP å®ç°çš„ï¼ŒAOP åˆæ˜¯ä½¿ç”¨åŠ¨æ€ä»£ç†å®ç°çš„ã€‚å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šé‡‡ç”¨ JDK çš„åŠ¨æ€ä»£ç†ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°äº†æ¥å£,ä¼šä½¿ç”¨ CGLIB åŠ¨æ€ä»£ç†ã€‚\nå¤šæä¸€å˜´ï¼šcreateAopProxy() æ–¹æ³• å†³å®šäº†æ˜¯ä½¿ç”¨ JDK è¿˜æ˜¯ Cglib æ¥åšåŠ¨æ€ä»£ç†ï¼Œæºç å¦‚ä¸‹ï¼š\npublic class DefaultAopProxyFactory implements AopProxyFactory, Serializable { @Override public AopProxy createAopProxy(AdvisedSupport config) throws AopConfigException { if (config.isOptimize() || config.isProxyTargetClass() || hasNoUserSuppliedProxyInterfaces(config)) { Class\u0026lt;?\u0026gt; targetClass = config.getTargetClass(); if (targetClass == null) { throw new AopConfigException(\u0026#34;TargetSource cannot determine target class: \u0026#34; + \u0026#34;Either an interface or a target is required for proxy creation.\u0026#34;); } if (targetClass.isInterface() || Proxy.isProxyClass(targetClass)) { return new JdkDynamicAopProxy(config); } return new ObjenesisCglibAopProxy(config); } else { return new JdkDynamicAopProxy(config); } } ....... } å¦‚æœä¸€ä¸ªç±»æˆ–è€…ä¸€ä¸ªç±»ä¸­çš„ public æ–¹æ³•ä¸Šè¢«æ ‡æ³¨@Transactional æ³¨è§£çš„è¯ï¼ŒSpring å®¹å™¨å°±ä¼šåœ¨å¯åŠ¨çš„æ—¶å€™ä¸ºå…¶åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ï¼Œåœ¨è°ƒç”¨è¢«@Transactional æ³¨è§£çš„ public æ–¹æ³•çš„æ—¶å€™ï¼Œå®é™…è°ƒç”¨çš„æ˜¯ï¼ŒTransactionInterceptor ç±»ä¸­çš„ invoke()æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯åœ¨ç›®æ ‡æ–¹æ³•ä¹‹å‰å¼€å¯äº‹åŠ¡ï¼Œæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœé‡åˆ°å¼‚å¸¸çš„æ—¶å€™å›æ»šäº‹åŠ¡ï¼Œæ–¹æ³•è°ƒç”¨å®Œæˆä¹‹åæäº¤äº‹åŠ¡ã€‚\nTransactionInterceptor ç±»ä¸­çš„ invoke()æ–¹æ³•å†…éƒ¨å®é™…è°ƒç”¨çš„æ˜¯ TransactionAspectSupport ç±»çš„ invokeWithinTransaction()æ–¹æ³•ã€‚ç”±äºæ–°ç‰ˆæœ¬çš„ Spring å¯¹è¿™éƒ¨åˆ†é‡å†™å¾ˆå¤§ï¼Œè€Œä¸”ç”¨åˆ°äº†å¾ˆå¤šå“åº”å¼ç¼–ç¨‹çš„çŸ¥è¯†ï¼Œè¿™é‡Œå°±ä¸åˆ—æºç äº†ã€‚\nSpring AOP è‡ªè°ƒç”¨é—®é¢˜ # è‹¥åŒä¸€ç±»ä¸­çš„å…¶ä»–æ²¡æœ‰ @Transactional æ³¨è§£çš„æ–¹æ³•å†…éƒ¨è°ƒç”¨æœ‰ @Transactional æ³¨è§£çš„æ–¹æ³•ï¼Œæœ‰@Transactional æ³¨è§£çš„æ–¹æ³•çš„äº‹åŠ¡ä¼šå¤±æ•ˆã€‚\nè¿™æ˜¯ç”±äºSpring AOPä»£ç†çš„åŸå› é€ æˆçš„ï¼Œå› ä¸ºåªæœ‰å½“ @Transactional æ³¨è§£çš„æ–¹æ³•åœ¨ç±»ä»¥å¤–è¢«è°ƒç”¨çš„æ—¶å€™ï¼ŒSpring äº‹åŠ¡ç®¡ç†æ‰ç”Ÿæ•ˆã€‚\nå› ä¸ºè¿™é‡Œä½¿ç”¨äº†thisï¼Œè€Œå†…éƒ¨è°ƒç”¨(ä½¿ç”¨this)ç¬¬äºŒä¸ªæ–¹æ³•å…¶å®æ˜¯ä½¿ç”¨äº†åŸå§‹ç±»ï¼Œè€Œéä»£ç†ç±»\nMyService ç±»ä¸­çš„method1()è°ƒç”¨method2()å°±ä¼šå¯¼è‡´method2()çš„äº‹åŠ¡å¤±æ•ˆã€‚\n@Service public class MyService { private void method1() { method2(); //...... } @Transactional public void method2() { //...... } } è§£å†³åŠæ³•å°±æ˜¯é¿å…åŒä¸€ç±»ä¸­è‡ªè°ƒç”¨æˆ–è€…ä½¿ç”¨ AspectJ å–ä»£ Spring AOP ä»£ç†ã€‚\n@Transactional çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹æ€»ç»“ # @Transactional æ³¨è§£åªæœ‰ä½œç”¨åˆ° public æ–¹æ³•ä¸Šäº‹åŠ¡æ‰ç”Ÿæ•ˆï¼Œä¸æ¨èåœ¨æ¥å£ä¸Šä½¿ç”¨ï¼› é¿å…åŒä¸€ä¸ªç±»ä¸­è°ƒç”¨ @Transactional æ³¨è§£çš„æ–¹æ³•ï¼Œè¿™æ ·ä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼› æ­£ç¡®çš„è®¾ç½® @Transactional çš„ rollbackFor å’Œ propagation å±æ€§ï¼Œå¦åˆ™äº‹åŠ¡å¯èƒ½ä¼šå›æ»šå¤±è´¥; è¢« @Transactional æ³¨è§£çš„æ–¹æ³•æ‰€åœ¨çš„ç±»å¿…é¡»è¢« Spring ç®¡ç†ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆï¼› åº•å±‚ä½¿ç”¨çš„æ•°æ®åº“å¿…é¡»æ”¯æŒäº‹åŠ¡æœºåˆ¶ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆï¼› \u0026hellip;\u0026hellip; å‚è€ƒ # [æ€»ç»“]Spring äº‹åŠ¡ç®¡ç†ä¸­@Transactional çš„å‚æ•°:http://www.mobabel.net/spring äº‹åŠ¡ç®¡ç†ä¸­ transactional çš„å‚æ•°/ Spring å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.spring.io/spring/docs/4.2.x/spring-framework-reference/html/transaction.html ã€ŠSpring5 é«˜çº§ç¼–ç¨‹ã€‹ é€å½»çš„æŒæ¡ Spring ä¸­@transactional çš„ä½¿ç”¨: https://www.ibm.com/developerworks/cn/java/j-master-spring-transactional-use/index.html Spring äº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§ï¼šhttps://github.com/love-somnus/Spring/wiki/Spring äº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§ Spring äº‹åŠ¡ä¼ æ’­è¡Œä¸ºè¯¦è§£ ï¼šhttps://segmentfault.com/a/1190000013341344 å…¨é¢åˆ†æ Spring çš„ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†åŠå£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼šhttps://www.ibm.com/developerworks/cn/education/opensource/os-cn-spring-trans/index.html "},{"id":99,"href":"/zh/docs/study/Review/java_guide/lybly_framework/ly02ly_spring-annotations/","title":"Spring/SpringBootå¸¸ç”¨æ³¨è§£","section":"æ¡†æ¶","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\n0.å‰è¨€ # å¯ä»¥æ¯«ä¸å¤¸å¼ åœ°è¯´ï¼Œè¿™ç¯‡æ–‡ç« ä»‹ç»çš„ Spring/SpringBoot å¸¸ç”¨æ³¨è§£åŸºæœ¬å·²ç»æ¶µç›–ä½ å·¥ä½œä¸­é‡åˆ°çš„å¤§éƒ¨åˆ†å¸¸ç”¨çš„åœºæ™¯ã€‚å¯¹äºæ¯ä¸€ä¸ªæ³¨è§£æˆ‘éƒ½è¯´äº†å…·ä½“ç”¨æ³•ï¼ŒæŒæ¡ææ‡‚ï¼Œä½¿ç”¨ SpringBoot æ¥å¼€å‘é¡¹ç›®åŸºæœ¬æ²¡å•¥å¤§é—®é¢˜äº†ï¼\nä¸ºä»€ä¹ˆè¦å†™è¿™ç¯‡æ–‡ç« ï¼Ÿ\næœ€è¿‘çœ‹åˆ°ç½‘ä¸Šæœ‰ä¸€ç¯‡å…³äº SpringBoot å¸¸ç”¨æ³¨è§£çš„æ–‡ç« è¢«è½¬è½½çš„æ¯”è¾ƒå¤šï¼Œæˆ‘çœ‹äº†æ–‡ç« å†…å®¹ä¹‹åå±å®è§‰å¾—è´¨é‡æœ‰ç‚¹ä½ï¼Œå¹¶ä¸”æœ‰ç‚¹ä¼šè¯¯å¯¼æ²¡æœ‰å¤ªå¤šå®é™…ä½¿ç”¨ç»éªŒçš„äººï¼ˆè¿™äº›äººåˆå æ®äº†å¤§å¤šæ•°ï¼‰ã€‚æ‰€ä»¥ï¼Œè‡ªå·±ç´¢æ€§èŠ±äº†å¤§æ¦‚ ä¸¤å¤©æ—¶é—´ç®€å•æ€»ç»“ä¸€ä¸‹äº†ã€‚\nå› ä¸ºæˆ‘ä¸ªäººçš„èƒ½åŠ›å’Œç²¾åŠ›æœ‰é™ï¼Œå¦‚æœæœ‰ä»»ä½•ä¸å¯¹æˆ–è€…éœ€è¦å®Œå–„çš„åœ°æ–¹ï¼Œè¯·å¸®å¿™æŒ‡å‡ºï¼Guide å“¥æ„Ÿæ¿€ä¸å°½ï¼\n1. @SpringBootApplication # è¿™é‡Œå…ˆå•ç‹¬æ‹å‡º@SpringBootApplication æ³¨è§£è¯´ä¸€ä¸‹ï¼Œè™½ç„¶æˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šä¸»åŠ¨å»ä½¿ç”¨å®ƒã€‚\nGuide å“¥ï¼šè¿™ä¸ªæ³¨è§£æ˜¯ Spring Boot é¡¹ç›®çš„åŸºçŸ³ï¼Œåˆ›å»º SpringBoot é¡¹ç›®ä¹‹åä¼šé»˜è®¤åœ¨ä¸»ç±»åŠ ä¸Šã€‚\n@SpringBootApplication public class SpringSecurityJwtGuideApplication { public static void main(java.lang.String[] args) { SpringApplication.run(SpringSecurityJwtGuideApplication.class, args); } } æˆ‘ä»¬å¯ä»¥æŠŠ @SpringBootApplicationçœ‹ä½œæ˜¯ @Configurationã€@EnableAutoConfigurationã€@ComponentScan æ³¨è§£çš„é›†åˆã€‚\npackage org.springframework.boot.autoconfigure; @Target(ElementType.TYPE) @Retention(RetentionPolicy.RUNTIME) @Documented @Inherited @SpringBootConfiguration @EnableAutoConfiguration @ComponentScan(excludeFilters = { @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class), @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) }) public @interface SpringBootApplication { ...... } package org.springframework.boot; @Target(ElementType.TYPE) @Retention(RetentionPolicy.RUNTIME) @Documented @Configuration public @interface SpringBootConfiguration { } æ ¹æ® SpringBoot å®˜ç½‘ï¼Œè¿™ä¸‰ä¸ªæ³¨è§£çš„ä½œç”¨åˆ†åˆ«æ˜¯ï¼š\n@EnableAutoConfigurationï¼šå¯ç”¨ SpringBoot çš„è‡ªåŠ¨é…ç½®æœºåˆ¶ (è¿™ä¸ªæ˜¯å¿…é¡»çš„ï¼Œå¦å¤–ä¸¤ä¸ªå¯ä»¥ä¸è¦) @ComponentScanï¼š æ‰«æè¢«@Component (@Repository,@Service,@Controller)æ³¨è§£çš„ beanï¼Œæ³¨è§£é»˜è®¤ä¼šæ‰«æè¯¥ç±»æ‰€åœ¨çš„åŒ…ä¸‹æ‰€æœ‰çš„ç±»ã€‚ @Configurationï¼šå…è®¸åœ¨ Spring ä¸Šä¸‹æ–‡ä¸­æ³¨å†Œé¢å¤–çš„ bean æˆ–å¯¼å…¥å…¶ä»–é…ç½®ç±» 2. Spring Bean ç›¸å…³ # 2.1. @Autowired # è‡ªåŠ¨å¯¼å…¥å¯¹è±¡åˆ°ç±»ä¸­ï¼Œè¢«æ³¨å…¥è¿›çš„ç±»åŒæ ·è¦è¢« Spring å®¹å™¨ç®¡ç†æ¯”å¦‚ï¼šService ç±»æ³¨å…¥åˆ° Controller ç±»ä¸­ã€‚\n@Service public class UserService { ...... } @RestController @RequestMapping(\u0026#34;/users\u0026#34;) public class UserController { @Autowired private UserService userService; ...... } 2.2. @Component,@Repository,@Service, @Controller # æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ @Autowired æ³¨è§£è®© Spring å®¹å™¨å¸®æˆ‘ä»¬è‡ªåŠ¨è£…é… beanã€‚è¦æƒ³æŠŠç±»æ ‡è¯†æˆå¯ç”¨äº @Autowired æ³¨è§£è‡ªåŠ¨è£…é…çš„ bean çš„ç±»,å¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ³¨è§£å®ç°ï¼š\n@Component ï¼šé€šç”¨çš„æ³¨è§£ï¼Œå¯æ ‡æ³¨ä»»æ„ç±»ä¸º Spring ç»„ä»¶ã€‚å¦‚æœä¸€ä¸ª Bean ä¸çŸ¥é“å±äºå“ªä¸ªå±‚ï¼Œå¯ä»¥ä½¿ç”¨@Component æ³¨è§£æ ‡æ³¨ã€‚ @Repository : å¯¹åº”æŒä¹…å±‚å³ Dao å±‚ï¼Œä¸»è¦ç”¨äºæ•°æ®åº“ç›¸å…³æ“ä½œã€‚ @Service : å¯¹åº”æœåŠ¡å±‚ï¼Œä¸»è¦æ¶‰åŠä¸€äº›å¤æ‚çš„é€»è¾‘ï¼Œéœ€è¦ç”¨åˆ° Dao å±‚ã€‚ @Controller : å¯¹åº” Spring MVC æ§åˆ¶å±‚ï¼Œä¸»è¦ç”¨äºæ¥å—ç”¨æˆ·è¯·æ±‚å¹¶è°ƒç”¨ Service å±‚è¿”å›æ•°æ®ç»™å‰ç«¯é¡µé¢ã€‚ 2.3. @RestController # @RestControlleræ³¨è§£æ˜¯@Controllerå’Œ@ResponseBodyçš„åˆé›†,è¡¨ç¤ºè¿™æ˜¯ä¸ªæ§åˆ¶å™¨ bean,å¹¶ä¸”æ˜¯å°†å‡½æ•°çš„è¿”å›å€¼ç›´æ¥å¡«å…¥ HTTP å“åº”ä½“ä¸­,æ˜¯ REST é£æ ¼çš„æ§åˆ¶å™¨ã€‚\nGuide å“¥ï¼šç°åœ¨éƒ½æ˜¯å‰åç«¯åˆ†ç¦»ï¼Œè¯´å®è¯æˆ‘å·²ç»å¾ˆä¹…æ²¡æœ‰ç”¨è¿‡@Controllerã€‚å¦‚æœä½ çš„é¡¹ç›®å¤ªè€äº†çš„è¯ï¼Œå°±å½“æˆ‘æ²¡è¯´ã€‚\nå•ç‹¬ä½¿ç”¨ @Controller ä¸åŠ  @ResponseBodyçš„è¯ä¸€èˆ¬æ˜¯ç”¨åœ¨è¦è¿”å›ä¸€ä¸ªè§†å›¾çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µå±äºæ¯”è¾ƒä¼ ç»Ÿçš„ Spring MVC çš„åº”ç”¨ï¼Œå¯¹åº”äºå‰åç«¯ä¸åˆ†ç¦»çš„æƒ…å†µã€‚@Controller +@ResponseBody è¿”å› JSON æˆ– XML å½¢å¼æ•°æ®\nå…³äº@RestController å’Œ @Controllerçš„å¯¹æ¯”ï¼Œè¯·çœ‹è¿™ç¯‡æ–‡ç« ï¼š@RestController vs @Controllerã€‚\n2.4. @Scope # å£°æ˜ Spring Bean çš„ä½œç”¨åŸŸï¼Œä½¿ç”¨æ–¹æ³•:\n@Bean @Scope(\u0026#34;singleton\u0026#34;) public Person personSingleton() { return new Person(); } å››ç§å¸¸è§çš„ Spring Bean çš„ä½œç”¨åŸŸï¼š\nsingleton : å”¯ä¸€ bean å®ä¾‹ï¼ŒSpring ä¸­çš„ bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ã€‚ prototype : æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ bean å®ä¾‹ã€‚ request : æ¯ä¸€æ¬¡ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ beanï¼Œè¯¥ bean ä»…åœ¨å½“å‰ HTTP request å†…æœ‰æ•ˆã€‚ session : æ¯ä¸€ä¸ª HTTP Session ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ beanï¼Œè¯¥ bean ä»…åœ¨å½“å‰ HTTP session å†…æœ‰æ•ˆã€‚ 2.5. @Configuration # ä¸€èˆ¬ç”¨æ¥å£°æ˜é…ç½®ç±»ï¼Œå¯ä»¥ä½¿ç”¨ @Componentæ³¨è§£æ›¿ä»£ï¼Œä¸è¿‡ä½¿ç”¨@Configurationæ³¨è§£å£°æ˜é…ç½®ç±»æ›´åŠ è¯­ä¹‰åŒ–ã€‚(è¿˜æœ‰å°±æ˜¯é…ç½®ç¬¬ä¸‰æ–¹åº“)\n@Configuration public class AppConfig { @Bean public TransferService transferService() { return new TransferServiceImpl(); } } 3. å¤„ç†å¸¸è§çš„ HTTP è¯·æ±‚ç±»å‹ # 5 ç§å¸¸è§çš„è¯·æ±‚ç±»å‹:\nGET ï¼šè¯·æ±‚ä»æœåŠ¡å™¨è·å–ç‰¹å®šèµ„æºã€‚ä¸¾ä¸ªä¾‹å­ï¼šGET /usersï¼ˆè·å–æ‰€æœ‰å­¦ç”Ÿï¼‰ POST ï¼šåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„èµ„æºã€‚ä¸¾ä¸ªä¾‹å­ï¼šPOST /usersï¼ˆåˆ›å»ºå­¦ç”Ÿï¼‰ PUT ï¼šæ›´æ–°æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ›´æ–°åçš„æ•´ä¸ªèµ„æºï¼‰ã€‚ä¸¾ä¸ªä¾‹å­ï¼šPUT /users/12ï¼ˆæ›´æ–°ç¼–å·ä¸º 12 çš„å­¦ç”Ÿï¼‰ DELETE ï¼šä»æœåŠ¡å™¨åˆ é™¤ç‰¹å®šçš„èµ„æºã€‚ä¸¾ä¸ªä¾‹å­ï¼šDELETE /users/12ï¼ˆåˆ é™¤ç¼–å·ä¸º 12 çš„å­¦ç”Ÿï¼‰ PATCH ï¼šæ›´æ–°æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ›´æ”¹çš„å±æ€§ï¼Œå¯ä»¥çœ‹åšä½œæ˜¯éƒ¨åˆ†æ›´æ–°ï¼‰ï¼Œä½¿ç”¨çš„æ¯”è¾ƒå°‘ï¼Œè¿™é‡Œå°±ä¸ä¸¾ä¾‹å­äº†ã€‚ 3.1. GET è¯·æ±‚ # @GetMapping(\u0026#34;users\u0026#34;)` ç­‰ä»·äº`@RequestMapping(value=\u0026#34;/users\u0026#34;,method=RequestMethod.GET) @GetMapping(\u0026#34;/users\u0026#34;) public ResponseEntity\u0026lt;List\u0026lt;User\u0026gt;\u0026gt; getAllUsers() { return userRepository.findAll(); } 3.2. POST è¯·æ±‚ # @PostMapping(\u0026#34;users\u0026#34;)` ç­‰ä»·äº`@RequestMapping(value=\u0026#34;/users\u0026#34;,method=RequestMethod.POST) å…³äº@RequestBodyæ³¨è§£çš„ä½¿ç”¨ï¼Œåœ¨ä¸‹é¢çš„â€œå‰åç«¯ä¼ å€¼â€è¿™å—ä¼šè®²åˆ°ã€‚\n@PostMapping(\u0026#34;/users\u0026#34;) public ResponseEntity\u0026lt;User\u0026gt; createUser(@Valid @RequestBody UserCreateRequest userCreateRequest) { return userRespository.save(userCreateRequest); } 3.3. PUT è¯·æ±‚ # @PutMapping(\u0026#34;/users/{userId}\u0026#34;)` ç­‰ä»·äº`@RequestMapping(value=\u0026#34;/users/{userId}\u0026#34;,method=RequestMethod.PUT) @PutMapping(\u0026#34;/users/{userId}\u0026#34;) public ResponseEntity\u0026lt;User\u0026gt; updateUser(@PathVariable(value = \u0026#34;userId\u0026#34;) Long userId, @Valid @RequestBody UserUpdateRequest userUpdateRequest) { ...... } 3.4. DELETE è¯·æ±‚ # @DeleteMapping(\u0026#34;/users/{userId}\u0026#34;)`ç­‰ä»·äº`@RequestMapping(value=\u0026#34;/users/{userId}\u0026#34;,method=RequestMethod.DELETE) @DeleteMapping(\u0026#34;/users/{userId}\u0026#34;) public ResponseEntity deleteUser(@PathVariable(value = \u0026#34;userId\u0026#34;) Long userId){ ...... } 3.5. PATCH è¯·æ±‚ # ä¸€èˆ¬å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬éƒ½æ˜¯ PUT ä¸å¤Ÿç”¨äº†ä¹‹åæ‰ç”¨ PATCH è¯·æ±‚å»æ›´æ–°æ•°æ®ã€‚\n@PatchMapping(\u0026#34;/profile\u0026#34;) public ResponseEntity updateStudent(@RequestBody StudentUpdateRequest studentUpdateRequest) { studentRepository.updateDetail(studentUpdateRequest); return ResponseEntity.ok().build(); } 4. å‰åç«¯ä¼ å€¼ # æŒæ¡å‰åç«¯ä¼ å€¼çš„æ­£ç¡®å§¿åŠ¿ï¼Œæ˜¯ä½ å¼€å§‹ CRUD çš„ç¬¬ä¸€æ­¥ï¼\n4.1. @PathVariable å’Œ @RequestParam # @PathVariableç”¨äºè·å–è·¯å¾„å‚æ•°ï¼Œ@RequestParamç”¨äºè·å–æŸ¥è¯¢å‚æ•°ã€‚\nä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š\n@GetMapping(\u0026#34;/klasses/{klassId}/teachers\u0026#34;) public List\u0026lt;Teacher\u0026gt; getKlassRelatedTeachers( @PathVariable(\u0026#34;klassId\u0026#34;) Long klassId, @RequestParam(value = \u0026#34;type\u0026#34;, required = false) String type ) { ... } å¦‚æœæˆ‘ä»¬è¯·æ±‚çš„ url æ˜¯ï¼š/klasses/123456/teachers?type=web\né‚£ä¹ˆæˆ‘ä»¬æœåŠ¡è·å–åˆ°çš„æ•°æ®å°±æ˜¯ï¼šklassId=123456,type=webã€‚\n4.2. @RequestBody # ç”¨äºè¯»å– Request è¯·æ±‚ï¼ˆå¯èƒ½æ˜¯ POST,PUT,DELETE,GET è¯·æ±‚ï¼‰çš„ body éƒ¨åˆ†å¹¶ä¸”Content-Type ä¸º application/json æ ¼å¼çš„æ•°æ®ï¼Œæ¥æ”¶åˆ°æ•°æ®ä¹‹åä¼šè‡ªåŠ¨å°†æ•°æ®ç»‘å®šåˆ° Java å¯¹è±¡ä¸Šå»ã€‚ç³»ç»Ÿä¼šä½¿ç”¨HttpMessageConverteræˆ–è€…è‡ªå®šä¹‰çš„HttpMessageConverterå°†è¯·æ±‚çš„ body ä¸­çš„ json å­—ç¬¦ä¸²è½¬æ¢ä¸º java å¯¹è±¡ã€‚\næˆ‘ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥ç»™æ¼”ç¤ºä¸€ä¸‹åŸºæœ¬ä½¿ç”¨ï¼\næˆ‘ä»¬æœ‰ä¸€ä¸ªæ³¨å†Œçš„æ¥å£ï¼š\n@PostMapping(\u0026#34;/sign-up\u0026#34;) public ResponseEntity signUp(@RequestBody @Valid UserRegisterRequest userRegisterRequest) { userService.save(userRegisterRequest); return ResponseEntity.ok().build(); } UserRegisterRequestå¯¹è±¡ï¼š\n@Data @AllArgsConstructor @NoArgsConstructor public class UserRegisterRequest { @NotBlank private String userName; @NotBlank private String password; @NotBlank private String fullName; } æˆ‘ä»¬å‘é€ post è¯·æ±‚åˆ°è¿™ä¸ªæ¥å£ï¼Œå¹¶ä¸” body æºå¸¦ JSON æ•°æ®ï¼š\n{\u0026#34;userName\u0026#34;:\u0026#34;coder\u0026#34;,\u0026#34;fullName\u0026#34;:\u0026#34;shuangkou\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;123456\u0026#34;} è¿™æ ·æˆ‘ä»¬çš„åç«¯å°±å¯ä»¥ç›´æ¥æŠŠ json æ ¼å¼çš„æ•°æ®æ˜ å°„åˆ°æˆ‘ä»¬çš„ UserRegisterRequest ç±»ä¸Šã€‚\nğŸ‘‰ éœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸€ä¸ªè¯·æ±‚æ–¹æ³•åªå¯ä»¥æœ‰ä¸€ä¸ª@RequestBodyï¼Œä½†æ˜¯å¯ä»¥æœ‰å¤šä¸ª@RequestParamå’Œ@PathVariableã€‚ å¦‚æœä½ çš„æ–¹æ³•å¿…é¡»è¦ç”¨ä¸¤ä¸ª @RequestBodyæ¥æ¥å—æ•°æ®çš„è¯ï¼Œå¤§æ¦‚ç‡æ˜¯ä½ çš„æ•°æ®åº“è®¾è®¡æˆ–è€…ç³»ç»Ÿè®¾è®¡å‡ºé—®é¢˜äº†ï¼\n5. è¯»å–é…ç½®ä¿¡æ¯ # å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦å°†ä¸€äº›å¸¸ç”¨çš„é…ç½®ä¿¡æ¯æ¯”å¦‚é˜¿é‡Œäº‘ ossã€å‘é€çŸ­ä¿¡ã€å¾®ä¿¡è®¤è¯çš„ç›¸å…³é…ç½®ä¿¡æ¯ç­‰ç­‰æ”¾åˆ°é…ç½®æ–‡ä»¶ä¸­ã€‚\nä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Spring ä¸ºæˆ‘ä»¬æä¾›äº†å“ªäº›æ–¹å¼å¸®åŠ©æˆ‘ä»¬ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–è¿™äº›é…ç½®ä¿¡æ¯ã€‚\næˆ‘ä»¬çš„æ•°æ®æºapplication.ymlå†…å®¹å¦‚ä¸‹ï¼š\nwuhan2020: 2020å¹´åˆæ­¦æ±‰çˆ†å‘äº†æ–°å‹å† çŠ¶ç—…æ¯’ï¼Œç–«æƒ…ä¸¥é‡ï¼Œä½†æ˜¯ï¼Œæˆ‘ç›¸ä¿¡ä¸€åˆ‡éƒ½ä¼šè¿‡å»ï¼æ­¦æ±‰åŠ æ²¹ï¼ä¸­å›½åŠ æ²¹ï¼ my-profile: name: Guideå“¥ email: koushuangbwcx@163.com library: location: æ¹–åŒ—æ­¦æ±‰åŠ æ²¹ä¸­å›½åŠ æ²¹ books: - name: å¤©æ‰åŸºæœ¬æ³• description: äºŒåäºŒå²çš„æ—æœå¤•åœ¨çˆ¶äº²ç¡®è¯Šé˜¿å°”èŒ¨æµ·é»˜ç—…è¿™å¤©ï¼Œå¾—çŸ¥è‡ªå·±æš—æ‹å¤šå¹´çš„æ ¡å›­ç”·ç¥è£´ä¹‹å³å°†å‡ºå›½æ·±é€ çš„æ¶ˆæ¯â€”â€”å¯¹æ–¹è€ƒå–çš„å­¦æ ¡ï¼Œæ°æ˜¯çˆ¶äº²å½“å¹´ä¸ºå¥¹æ”¾å¼ƒçš„é‚£æ‰€ã€‚ - name: æ—¶é—´çš„ç§©åº description: ä¸ºä»€ä¹ˆæˆ‘ä»¬è®°å¾—è¿‡å»ï¼Œè€Œéæœªæ¥ï¼Ÿæ—¶é—´â€œæµé€â€æ„å‘³ç€ä»€ä¹ˆï¼Ÿæ˜¯æˆ‘ä»¬å­˜åœ¨äºæ—¶é—´ä¹‹å†…ï¼Œè¿˜æ˜¯æ—¶é—´å­˜åœ¨äºæˆ‘ä»¬ä¹‹ä¸­ï¼Ÿå¡æ´›Â·ç½—éŸ¦åˆ©ç”¨è¯—æ„çš„æ–‡å­—ï¼Œé‚€è¯·æˆ‘ä»¬æ€è€ƒè¿™ä¸€äº˜å¤éš¾é¢˜â€”â€”æ—¶é—´çš„æœ¬è´¨ã€‚ - name: äº†ä¸èµ·çš„æˆ‘ description: å¦‚ä½•å…»æˆä¸€ä¸ªæ–°ä¹ æƒ¯ï¼Ÿå¦‚ä½•è®©å¿ƒæ™ºå˜å¾—æ›´æˆç†Ÿï¼Ÿå¦‚ä½•æ‹¥æœ‰é«˜è´¨é‡çš„å…³ç³»ï¼Ÿ å¦‚ä½•èµ°å‡ºäººç”Ÿçš„è‰°éš¾æ—¶åˆ»ï¼Ÿ 5.1. @Value(å¸¸ç”¨) # ä½¿ç”¨ @Value(\u0026quot;${property}\u0026quot;) è¯»å–æ¯”è¾ƒç®€å•çš„é…ç½®ä¿¡æ¯ï¼š\n@Value(\u0026#34;${wuhan2020}\u0026#34;) String wuhan2020; 5.2. @ConfigurationProperties(å¸¸ç”¨) # é€šè¿‡@ConfigurationPropertiesè¯»å–é…ç½®ä¿¡æ¯å¹¶ä¸ bean ç»‘å®šã€‚\n@Component @ConfigurationProperties(prefix = \u0026#34;library\u0026#34;) class LibraryProperties { @NotEmpty private String location; private List\u0026lt;Book\u0026gt; books; @Setter @Getter @ToString static class Book { String name; String description; } çœç•¥getter/setter ...... } ä½ å¯ä»¥åƒä½¿ç”¨æ™®é€šçš„ Spring bean ä¸€æ ·ï¼Œå°†å…¶æ³¨å…¥åˆ°ç±»ä¸­ä½¿ç”¨ã€‚\n5.3. @PropertySourceï¼ˆä¸å¸¸ç”¨ï¼‰ # @PropertySourceè¯»å–æŒ‡å®š properties æ–‡ä»¶\n@Component @PropertySource(\u0026#34;classpath:website.properties\u0026#34;) class WebSite { @Value(\u0026#34;${url}\u0026#34;) private String url; çœç•¥getter/setter ...... } æ›´å¤šå†…å®¹è¯·æŸ¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼šã€Š10 åˆ†é’Ÿæå®š SpringBoot å¦‚ä½•ä¼˜é›…è¯»å–é…ç½®æ–‡ä»¶ï¼Ÿã€‹ ã€‚\n6. å‚æ•°æ ¡éªŒ # æ•°æ®çš„æ ¡éªŒçš„é‡è¦æ€§å°±ä¸ç”¨è¯´äº†ï¼Œå³ä½¿åœ¨å‰ç«¯å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦å¯¹ä¼ å…¥åç«¯çš„æ•°æ®å†è¿›è¡Œä¸€éæ ¡éªŒï¼Œé¿å…ç”¨æˆ·ç»•è¿‡æµè§ˆå™¨ç›´æ¥é€šè¿‡ä¸€äº› HTTP å·¥å…·ç›´æ¥å‘åç«¯è¯·æ±‚ä¸€äº›è¿æ³•æ•°æ®ã€‚\nJSR(Java Specification Requestsï¼‰ æ˜¯ä¸€å¥— JavaBean å‚æ•°æ ¡éªŒçš„æ ‡å‡†ï¼Œå®ƒå®šä¹‰äº†å¾ˆå¤šå¸¸ç”¨çš„æ ¡éªŒæ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†è¿™äº›æ³¨è§£åŠ åœ¨æˆ‘ä»¬ JavaBean çš„å±æ€§ä¸Šé¢ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨éœ€è¦æ ¡éªŒçš„æ—¶å€™è¿›è¡Œæ ¡éªŒäº†ï¼Œéå¸¸æ–¹ä¾¿ï¼\næ ¡éªŒçš„æ—¶å€™æˆ‘ä»¬å®é™…ç”¨çš„æ˜¯ Hibernate Validator æ¡†æ¶ã€‚Hibernate Validator æ˜¯ Hibernate å›¢é˜Ÿæœ€åˆçš„æ•°æ®æ ¡éªŒæ¡†æ¶ï¼ŒHibernate Validator 4.x æ˜¯ Bean Validation 1.0ï¼ˆJSR 303ï¼‰çš„å‚è€ƒå®ç°ï¼ŒHibernate Validator 5.x æ˜¯ Bean Validation 1.1ï¼ˆJSR 349ï¼‰çš„å‚è€ƒå®ç°ï¼Œç›®å‰æœ€æ–°ç‰ˆçš„ Hibernate Validator 6.x æ˜¯ Bean Validation 2.0ï¼ˆJSR 380ï¼‰çš„å‚è€ƒå®ç°ã€‚\nSpringBoot é¡¹ç›®çš„ spring-boot-starter-web ä¾èµ–ä¸­å·²ç»æœ‰ hibernate-validator åŒ…ï¼Œä¸éœ€è¦å¼•ç”¨ç›¸å…³ä¾èµ–ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆé€šè¿‡ idea æ’ä»¶â€”Maven Helper ç”Ÿæˆï¼‰ï¼š\næ³¨ï¼šæ›´æ–°ç‰ˆæœ¬çš„ spring-boot-starter-web ä¾èµ–ä¸­ä¸å†æœ‰ hibernate-validator åŒ…ï¼ˆå¦‚2.3.11.RELEASEï¼‰ï¼Œéœ€è¦è‡ªå·±å¼•å…¥ spring-boot-starter-validation ä¾èµ–ã€‚\né SpringBoot é¡¹ç›®éœ€è¦è‡ªè¡Œå¼•å…¥ç›¸å…³ä¾èµ–åŒ…ï¼Œè¿™é‡Œä¸å¤šåšè®²è§£ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼šã€Šå¦‚ä½•åœ¨ Spring/Spring Boot ä¸­åšå‚æ•°æ ¡éªŒï¼Ÿä½ éœ€è¦äº†è§£çš„éƒ½åœ¨è¿™é‡Œï¼ã€‹ã€‚\nğŸ‘‰ éœ€è¦æ³¨æ„çš„æ˜¯ï¼š æ‰€æœ‰çš„æ³¨è§£ï¼Œæ¨èä½¿ç”¨ JSR æ³¨è§£ï¼Œå³javax.validation.constraintsï¼Œè€Œä¸æ˜¯org.hibernate.validator.constraints\n6.1. ä¸€äº›å¸¸ç”¨çš„å­—æ®µéªŒè¯çš„æ³¨è§£ # @NotEmpty è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²çš„ä¸èƒ½ä¸º null ä¹Ÿä¸èƒ½ä¸ºç©º @NotBlank è¢«æ³¨é‡Šçš„å­—ç¬¦ä¸²é nullï¼Œå¹¶ä¸”å¿…é¡»åŒ…å«ä¸€ä¸ªéç©ºç™½å­—ç¬¦ @Null è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º null @NotNull è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸ä¸º null @AssertTrue è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º true @AssertFalse è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸º false @Pattern(regex=,flag=)è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ç¬¦åˆæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼ @Email è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ Email æ ¼å¼ã€‚ @Min(value)è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼ @Max(value)è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼ @DecimalMin(value)è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼ @DecimalMax(value) è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼ @Size(max=, min=)è¢«æ³¨é‡Šçš„å…ƒç´ çš„å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†… @Digits(integer, fraction)è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»åœ¨å¯æ¥å—çš„èŒƒå›´å†… @Pastè¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡å»çš„æ—¥æœŸ @Future è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªå°†æ¥çš„æ—¥æœŸ \u0026hellip;\u0026hellip; 6.2. éªŒè¯è¯·æ±‚ä½“(RequestBody) # @Data @AllArgsConstructor @NoArgsConstructor public class Person { @NotNull(message = \u0026#34;classId ä¸èƒ½ä¸ºç©º\u0026#34;) private String classId; @Size(max = 33) @NotNull(message = \u0026#34;name ä¸èƒ½ä¸ºç©º\u0026#34;) private String name; @Pattern(regexp = \u0026#34;((^Man$|^Woman$|^UGM$))\u0026#34;, message = \u0026#34;sex å€¼ä¸åœ¨å¯é€‰èŒƒå›´\u0026#34;) @NotNull(message = \u0026#34;sex ä¸èƒ½ä¸ºç©º\u0026#34;) private String sex; @Email(message = \u0026#34;email æ ¼å¼ä¸æ­£ç¡®\u0026#34;) @NotNull(message = \u0026#34;email ä¸èƒ½ä¸ºç©º\u0026#34;) private String email; } æˆ‘ä»¬åœ¨éœ€è¦éªŒè¯çš„å‚æ•°ä¸ŠåŠ ä¸Šäº†@Validæ³¨è§£ï¼Œå¦‚æœéªŒè¯å¤±è´¥ï¼Œå®ƒå°†æŠ›å‡ºMethodArgumentNotValidExceptionã€‚\n@RestController @RequestMapping(\u0026#34;/api\u0026#34;) public class PersonController { @PostMapping(\u0026#34;/person\u0026#34;) public ResponseEntity\u0026lt;Person\u0026gt; getPerson(@RequestBody @Valid Person person) { return ResponseEntity.ok().body(person); } } 6.3. éªŒè¯è¯·æ±‚å‚æ•°(Path Variables å’Œ Request Parameters) # ä¸€å®šä¸€å®šä¸è¦å¿˜è®°åœ¨ç±»ä¸ŠåŠ ä¸Š @Validated æ³¨è§£äº†ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥å‘Šè¯‰ Spring å»æ ¡éªŒæ–¹æ³•å‚æ•°ã€‚\n@RestController @RequestMapping(\u0026#34;/api\u0026#34;) @Validated public class PersonController { @GetMapping(\u0026#34;/person/{id}\u0026#34;) public ResponseEntity\u0026lt;Integer\u0026gt; getPersonByID(@Valid @PathVariable(\u0026#34;id\u0026#34;) @Max(value = 5,message = \u0026#34;è¶…è¿‡ id çš„èŒƒå›´äº†\u0026#34;) Integer id) { return ResponseEntity.ok().body(id); } } æ›´å¤šå…³äºå¦‚ä½•åœ¨ Spring é¡¹ç›®ä¸­è¿›è¡Œå‚æ•°æ ¡éªŒçš„å†…å®¹ï¼Œè¯·çœ‹ã€Šå¦‚ä½•åœ¨ Spring/Spring Boot ä¸­åšå‚æ•°æ ¡éªŒï¼Ÿä½ éœ€è¦äº†è§£çš„éƒ½åœ¨è¿™é‡Œï¼ã€‹è¿™ç¯‡æ–‡ç« ã€‚\n7. å…¨å±€å¤„ç† Controller å±‚å¼‚å¸¸ # ä»‹ç»ä¸€ä¸‹æˆ‘ä»¬ Spring é¡¹ç›®å¿…å¤‡çš„å…¨å±€å¤„ç† Controller å±‚å¼‚å¸¸ã€‚\nç›¸å…³æ³¨è§£ï¼š\n@ControllerAdvice :æ³¨è§£å®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†ç±» @ExceptionHandler :æ³¨è§£å£°æ˜å¼‚å¸¸å¤„ç†æ–¹æ³• å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿæ‹¿æˆ‘ä»¬åœ¨ç¬¬ 5 èŠ‚å‚æ•°æ ¡éªŒè¿™å—æ¥ä¸¾ä¾‹å­ã€‚å¦‚æœæ–¹æ³•å‚æ•°ä¸å¯¹çš„è¯å°±ä¼šæŠ›å‡ºMethodArgumentNotValidExceptionï¼Œæˆ‘ä»¬æ¥å¤„ç†è¿™ä¸ªå¼‚å¸¸ã€‚\n@ControllerAdvice @ResponseBody public class GlobalExceptionHandler { /** * è¯·æ±‚å‚æ•°å¼‚å¸¸å¤„ç† */ @ExceptionHandler(MethodArgumentNotValidException.class) public ResponseEntity\u0026lt;?\u0026gt; handleMethodArgumentNotValidException(MethodArgumentNotValidException ex, HttpServletRequest request) { ...... } } æ›´å¤šå…³äº Spring Boot å¼‚å¸¸å¤„ç†çš„å†…å®¹ï¼Œè¯·çœ‹æˆ‘çš„è¿™ä¸¤ç¯‡æ–‡ç« ï¼š\nSpringBoot å¤„ç†å¼‚å¸¸çš„å‡ ç§å¸¸è§å§¿åŠ¿ ä½¿ç”¨æšä¸¾ç®€å•å°è£…ä¸€ä¸ªä¼˜é›…çš„ Spring Boot å…¨å±€å¼‚å¸¸å¤„ç†ï¼ 8. JPA ç›¸å…³ # 8.1. åˆ›å»ºè¡¨ # @Entityå£°æ˜ä¸€ä¸ªç±»å¯¹åº”ä¸€ä¸ªæ•°æ®åº“å®ä½“ã€‚\n@Table è®¾ç½®è¡¨å\n@Entity @Table(name = \u0026#34;role\u0026#34;) public class Role { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Long id; private String name; private String description; çœç•¥getter/setter...... } 8.2. åˆ›å»ºä¸»é”® # @Id ï¼šå£°æ˜ä¸€ä¸ªå­—æ®µä¸ºä¸»é”®ã€‚\nä½¿ç”¨@Idå£°æ˜ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®šä¹‰ä¸»é”®çš„ç”Ÿæˆç­–ç•¥ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ @GeneratedValue æŒ‡å®šä¸»é”®ç”Ÿæˆç­–ç•¥ã€‚\n1.é€šè¿‡ @GeneratedValueç›´æ¥ä½¿ç”¨ JPA å†…ç½®æä¾›çš„å››ç§ä¸»é”®ç”Ÿæˆç­–ç•¥æ¥æŒ‡å®šä¸»é”®ç”Ÿæˆç­–ç•¥ã€‚\n@Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Long id; JPA ä½¿ç”¨æšä¸¾å®šä¹‰äº† 4 ç§å¸¸è§çš„ä¸»é”®ç”Ÿæˆç­–ç•¥ï¼Œå¦‚ä¸‹ï¼š\nGuide å“¥ï¼šæšä¸¾æ›¿ä»£å¸¸é‡çš„ä¸€ç§ç”¨æ³•\npublic enum GenerationType { /** * ä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„æ•°æ®åº“è¡¨æ ¼æ¥ä¿å­˜ä¸»é”® * æŒä¹…åŒ–å¼•æ“é€šè¿‡å…³ç³»æ•°æ®åº“çš„ä¸€å¼ ç‰¹å®šçš„è¡¨æ ¼æ¥ç”Ÿæˆä¸»é”®, */ TABLE, /** *åœ¨æŸäº›æ•°æ®åº“ä¸­,ä¸æ”¯æŒä¸»é”®è‡ªå¢é•¿,æ¯”å¦‚Oracleã€PostgreSQLå…¶æä¾›äº†ä¸€ç§å«åš\u0026#34;åºåˆ—(sequence)\u0026#34;çš„æœºåˆ¶ç”Ÿæˆä¸»é”® */ SEQUENCE, /** * ä¸»é”®è‡ªå¢é•¿ */ IDENTITY, /** *æŠŠä¸»é”®ç”Ÿæˆç­–ç•¥äº¤ç»™æŒä¹…åŒ–å¼•æ“(persistence engine), *æŒä¹…åŒ–å¼•æ“ä¼šæ ¹æ®æ•°æ®åº“åœ¨ä»¥ä¸Šä¸‰ç§ä¸»é”®ç”Ÿæˆ ç­–ç•¥ä¸­é€‰æ‹©å…¶ä¸­ä¸€ç§ */ AUTO } @GeneratedValue`æ³¨è§£é»˜è®¤ä½¿ç”¨çš„ç­–ç•¥æ˜¯`GenerationType.AUTO public @interface GeneratedValue { GenerationType strategy() default AUTO; String generator() default \u0026#34;\u0026#34;; } ä¸€èˆ¬ä½¿ç”¨ MySQL æ•°æ®åº“çš„è¯ï¼Œä½¿ç”¨GenerationType.IDENTITYç­–ç•¥æ¯”è¾ƒæ™®éä¸€ç‚¹ï¼ˆåˆ†å¸ƒå¼ç³»ç»Ÿçš„è¯éœ€è¦å¦å¤–è€ƒè™‘ä½¿ç”¨åˆ†å¸ƒå¼ IDï¼‰ã€‚\n2.é€šè¿‡ @GenericGeneratorå£°æ˜ä¸€ä¸ªä¸»é”®ç­–ç•¥ï¼Œç„¶å @GeneratedValueä½¿ç”¨è¿™ä¸ªç­–ç•¥\n@Id @GeneratedValue(generator = \u0026#34;IdentityIdGenerator\u0026#34;) @GenericGenerator(name = \u0026#34;IdentityIdGenerator\u0026#34;, strategy = \u0026#34;identity\u0026#34;) private Long id; ç­‰ä»·äºï¼š\n@Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Long id; jpa æä¾›çš„ä¸»é”®ç”Ÿæˆç­–ç•¥æœ‰å¦‚ä¸‹å‡ ç§ï¼š\npublic class DefaultIdentifierGeneratorFactory implements MutableIdentifierGeneratorFactory, Serializable, ServiceRegistryAwareService { @SuppressWarnings(\u0026#34;deprecation\u0026#34;) public DefaultIdentifierGeneratorFactory() { register( \u0026#34;uuid2\u0026#34;, UUIDGenerator.class ); register( \u0026#34;guid\u0026#34;, GUIDGenerator.class );\t// can be done with UUIDGenerator + strategy register( \u0026#34;uuid\u0026#34;, UUIDHexGenerator.class );\t// \u0026#34;deprecated\u0026#34; for new use register( \u0026#34;uuid.hex\u0026#34;, UUIDHexGenerator.class ); // uuid.hex is deprecated register( \u0026#34;assigned\u0026#34;, Assigned.class ); register( \u0026#34;identity\u0026#34;, IdentityGenerator.class ); register( \u0026#34;select\u0026#34;, SelectGenerator.class ); register( \u0026#34;sequence\u0026#34;, SequenceStyleGenerator.class ); register( \u0026#34;seqhilo\u0026#34;, SequenceHiLoGenerator.class ); register( \u0026#34;increment\u0026#34;, IncrementGenerator.class ); register( \u0026#34;foreign\u0026#34;, ForeignGenerator.class ); register( \u0026#34;sequence-identity\u0026#34;, SequenceIdentityGenerator.class ); register( \u0026#34;enhanced-sequence\u0026#34;, SequenceStyleGenerator.class ); register( \u0026#34;enhanced-table\u0026#34;, TableGenerator.class ); } public void register(String strategy, Class generatorClass) { LOG.debugf( \u0026#34;Registering IdentifierGenerator strategy [%s] -\u0026gt; [%s]\u0026#34;, strategy, generatorClass.getName() ); final Class previous = generatorStrategyToClassNameMap.put( strategy, generatorClass ); if ( previous != null ) { LOG.debugf( \u0026#34; - overriding [%s]\u0026#34;, previous.getName() ); } } } 8.3. è®¾ç½®å­—æ®µç±»å‹ # @Column å£°æ˜å­—æ®µã€‚\nç¤ºä¾‹ï¼š\nè®¾ç½®å±æ€§ userName å¯¹åº”çš„æ•°æ®åº“å­—æ®µåä¸º user_nameï¼Œé•¿åº¦ä¸º 32ï¼Œéç©º\n@Column(name = \u0026#34;user_name\u0026#34;, nullable = false, length=32) private String userName; è®¾ç½®å­—æ®µç±»å‹å¹¶ä¸”åŠ é»˜è®¤å€¼ï¼Œè¿™ä¸ªè¿˜æ˜¯æŒºå¸¸ç”¨çš„ã€‚\n@Column(columnDefinition = \u0026#34;tinyint(1) default 1\u0026#34;) private Boolean enabled; 8.4. æŒ‡å®šä¸æŒä¹…åŒ–ç‰¹å®šå­—æ®µ # @Transient ï¼šå£°æ˜ä¸éœ€è¦ä¸æ•°æ®åº“æ˜ å°„çš„å­—æ®µï¼Œåœ¨ä¿å­˜çš„æ—¶å€™ä¸éœ€è¦ä¿å­˜è¿›æ•°æ®åº“ ã€‚\nå¦‚æœæˆ‘ä»¬æƒ³è®©secrect è¿™ä¸ªå­—æ®µä¸è¢«æŒä¹…åŒ–ï¼Œå¯ä»¥ä½¿ç”¨ @Transientå…³é”®å­—å£°æ˜ã€‚\n@Entity(name=\u0026#34;USER\u0026#34;) public class User { ...... @Transient private String secrect; // not persistent because of @Transient } é™¤äº† @Transientå…³é”®å­—å£°æ˜ï¼Œ è¿˜å¯ä»¥é‡‡ç”¨ä¸‹é¢å‡ ç§æ–¹æ³•ï¼š\nstatic String secrect; // not persistent because of static final String secrect = \u0026#34;Satish\u0026#34;; // not persistent because of final transient String secrect; // not persistent because of transient ä¸€èˆ¬ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¯”è¾ƒå¤šã€‚\n8.5. å£°æ˜å¤§å­—æ®µ # @Lob:å£°æ˜æŸä¸ªå­—æ®µä¸ºå¤§å­—æ®µã€‚\n@Lob private String content; æ›´è¯¦ç»†çš„å£°æ˜ï¼š\n@Lob //æŒ‡å®š Lob ç±»å‹æ•°æ®çš„è·å–ç­–ç•¥ï¼Œ FetchType.EAGER è¡¨ç¤ºéå»¶è¿ŸåŠ è½½ï¼Œè€Œ FetchType.LAZY è¡¨ç¤ºå»¶è¿ŸåŠ è½½ ï¼› @Basic(fetch = FetchType.EAGER) //columnDefinition å±æ€§æŒ‡å®šæ•°æ®è¡¨å¯¹åº”çš„ Lob å­—æ®µç±»å‹ @Column(name = \u0026#34;content\u0026#34;, columnDefinition = \u0026#34;LONGTEXT NOT NULL\u0026#34;) private String content; 8.6. åˆ›å»ºæšä¸¾ç±»å‹çš„å­—æ®µ # å¯ä»¥ä½¿ç”¨æšä¸¾ç±»å‹çš„å­—æ®µï¼Œä¸è¿‡æšä¸¾å­—æ®µè¦ç”¨@Enumeratedæ³¨è§£ä¿®é¥°ã€‚\npublic enum Gender { MALE(\u0026#34;ç”·æ€§\u0026#34;), FEMALE(\u0026#34;å¥³æ€§\u0026#34;); private String value; Gender(String str){ value=str; } } @Entity @Table(name = \u0026#34;role\u0026#34;) public class Role { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Long id; private String name; private String description; @Enumerated(EnumType.STRING) private Gender gender; çœç•¥getter/setter...... } æ•°æ®åº“é‡Œé¢å¯¹åº”å­˜å‚¨çš„æ˜¯ MALE/FEMALEã€‚\n8.7. å¢åŠ å®¡è®¡åŠŸèƒ½ # åªè¦ç»§æ‰¿äº† AbstractAuditBaseçš„ç±»éƒ½ä¼šé»˜è®¤åŠ ä¸Šä¸‹é¢å››ä¸ªå­—æ®µã€‚\n@Data @AllArgsConstructor @NoArgsConstructor @MappedSuperclass @EntityListeners(value = AuditingEntityListener.class) public abstract class AbstractAuditBase { @CreatedDate @Column(updatable = false) @JsonIgnore private Instant createdAt; @LastModifiedDate @JsonIgnore private Instant updatedAt; @CreatedBy @Column(updatable = false) @JsonIgnore private String createdBy; @LastModifiedBy @JsonIgnore private String updatedBy; } æˆ‘ä»¬å¯¹åº”çš„å®¡è®¡åŠŸèƒ½å¯¹åº”åœ°é…ç½®ç±»å¯èƒ½æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼ˆSpring Security é¡¹ç›®ï¼‰:\n@Configuration @EnableJpaAuditing public class AuditSecurityConfiguration { @Bean AuditorAware\u0026lt;String\u0026gt; auditorAware() { return () -\u0026gt; Optional.ofNullable(SecurityContextHolder.getContext()) .map(SecurityContext::getAuthentication) .filter(Authentication::isAuthenticated) .map(Authentication::getName); } } ç®€å•ä»‹ç»ä¸€ä¸‹ä¸Šé¢æ¶‰åŠåˆ°çš„ä¸€äº›æ³¨è§£ï¼š\n@CreatedDate: è¡¨ç¤ºè¯¥å­—æ®µä¸ºåˆ›å»ºæ—¶é—´å­—æ®µï¼Œåœ¨è¿™ä¸ªå®ä½“è¢« insert çš„æ—¶å€™ï¼Œä¼šè®¾ç½®å€¼\n@CreatedBy :è¡¨ç¤ºè¯¥å­—æ®µä¸ºåˆ›å»ºäººï¼Œåœ¨è¿™ä¸ªå®ä½“è¢« insert çš„æ—¶å€™ï¼Œä¼šè®¾ç½®å€¼\n@LastModifiedDateã€@LastModifiedByåŒç†ã€‚\n@EnableJpaAuditingï¼šå¼€å¯ JPA å®¡è®¡åŠŸèƒ½ã€‚\n8.8. åˆ é™¤/ä¿®æ”¹æ•°æ® # @Modifying æ³¨è§£æç¤º JPA è¯¥æ“ä½œæ˜¯ä¿®æ”¹æ“ä½œ,æ³¨æ„è¿˜è¦é…åˆ@Transactionalæ³¨è§£ä½¿ç”¨ã€‚\n@Repository public interface UserRepository extends JpaRepository\u0026lt;User, Integer\u0026gt; { @Modifying @Transactional(rollbackFor = Exception.class) void deleteByUserName(String userName); } 8.9. å…³è”å…³ç³» # @OneToOne å£°æ˜ä¸€å¯¹ä¸€å…³ç³» @OneToMany å£°æ˜ä¸€å¯¹å¤šå…³ç³» @ManyToOne å£°æ˜å¤šå¯¹ä¸€å…³ç³» @ManyToMany å£°æ˜å¤šå¯¹å¤šå…³ç³» æ›´å¤šå…³äº Spring Boot JPA çš„æ–‡ç« è¯·çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼šä¸€æ–‡ææ‡‚å¦‚ä½•åœ¨ Spring Boot æ­£ç¡®ä¸­ä½¿ç”¨ JPA ã€‚\n9. äº‹åŠ¡ @Transactional # åœ¨è¦å¼€å¯äº‹åŠ¡çš„æ–¹æ³•ä¸Šä½¿ç”¨@Transactionalæ³¨è§£å³å¯!\n@Transactional(rollbackFor = Exception.class) public void save() { ...... } æˆ‘ä»¬çŸ¥é“ Exception åˆ†ä¸ºè¿è¡Œæ—¶å¼‚å¸¸ RuntimeException å’Œéè¿è¡Œæ—¶å¼‚å¸¸ã€‚åœ¨@Transactionalæ³¨è§£ä¸­å¦‚æœä¸é…ç½®rollbackForå±æ€§,é‚£ä¹ˆäº‹åŠ¡åªä¼šåœ¨é‡åˆ°RuntimeExceptionçš„æ—¶å€™æ‰ä¼šå›æ»š,åŠ ä¸ŠrollbackFor=Exception.class,å¯ä»¥è®©äº‹åŠ¡åœ¨é‡åˆ°éè¿è¡Œæ—¶å¼‚å¸¸æ—¶ä¹Ÿå›æ»šã€‚\n@Transactional æ³¨è§£ä¸€èˆ¬å¯ä»¥ä½œç”¨åœ¨ç±»æˆ–è€…æ–¹æ³•ä¸Šã€‚\nä½œç”¨äºç±»ï¼šå½“æŠŠ@Transactional æ³¨è§£æ”¾åœ¨ç±»ä¸Šæ—¶ï¼Œè¡¨ç¤ºæ‰€æœ‰è¯¥ç±»çš„ public æ–¹æ³•éƒ½é…ç½®ç›¸åŒçš„äº‹åŠ¡å±æ€§ä¿¡æ¯ã€‚ ä½œç”¨äºæ–¹æ³•ï¼šå½“ç±»é…ç½®äº†@Transactionalï¼Œæ–¹æ³•ä¹Ÿé…ç½®äº†@Transactionalï¼Œæ–¹æ³•çš„äº‹åŠ¡ä¼šè¦†ç›– ç±»çš„äº‹åŠ¡é…ç½®ä¿¡æ¯ã€‚ æ›´å¤šå…³äº Spring äº‹åŠ¡çš„å†…å®¹è¯·æŸ¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼šå¯èƒ½æ˜¯æœ€æ¼‚äº®çš„ Spring äº‹åŠ¡ç®¡ç†è¯¦è§£ ã€‚\n10. json æ•°æ®å¤„ç† # 10.1. è¿‡æ»¤ json æ•°æ® # @JsonIgnoreProperties ä½œç”¨åœ¨ç±»ä¸Šç”¨äºè¿‡æ»¤æ‰ç‰¹å®šå­—æ®µä¸è¿”å›æˆ–è€…ä¸è§£æã€‚\n//ç”Ÿæˆjsonæ—¶å°†userRoleså±æ€§è¿‡æ»¤ @JsonIgnoreProperties({\u0026#34;userRoles\u0026#34;}) public class User { private String userName; private String fullName; private String password; private List\u0026lt;UserRole\u0026gt; userRoles = new ArrayList\u0026lt;\u0026gt;(); } @JsonIgnoreä¸€èˆ¬ç”¨äºç±»çš„å±æ€§ä¸Šï¼Œä½œç”¨å’Œä¸Šé¢çš„@JsonIgnoreProperties ä¸€æ ·ã€‚\npublic class User { private String userName; private String fullName; private String password; //ç”Ÿæˆjsonæ—¶å°†userRoleså±æ€§è¿‡æ»¤ @JsonIgnore private List\u0026lt;UserRole\u0026gt; userRoles = new ArrayList\u0026lt;\u0026gt;(); } 10.2. æ ¼å¼åŒ– json æ•°æ® # @JsonFormatä¸€èˆ¬ç”¨æ¥æ ¼å¼åŒ– json æ•°æ®ã€‚\næ¯”å¦‚ï¼š\n@JsonFormat(shape=JsonFormat.Shape.STRING, pattern=\u0026#34;yyyy-MM-dd\u0026#39;T\u0026#39;HH:mm:ss.SSS\u0026#39;Z\u0026#39;\u0026#34;, timezone=\u0026#34;GMT\u0026#34;) private Date date; 10.3. æ‰å¹³åŒ–å¯¹è±¡ # @Getter @Setter @ToString public class Account { private Location location; private PersonInfo personInfo; @Getter @Setter @ToString public static class Location { private String provinceName; private String countyName; } @Getter @Setter @ToString public static class PersonInfo { private String userName; private String fullName; } } æœªæ‰å¹³åŒ–ä¹‹å‰ï¼š\n{ \u0026#34;location\u0026#34;: { \u0026#34;provinceName\u0026#34;:\u0026#34;æ¹–åŒ—\u0026#34;, \u0026#34;countyName\u0026#34;:\u0026#34;æ­¦æ±‰\u0026#34; }, \u0026#34;personInfo\u0026#34;: { \u0026#34;userName\u0026#34;: \u0026#34;coder1234\u0026#34;, \u0026#34;fullName\u0026#34;: \u0026#34;shaungkou\u0026#34; } } ä½¿ç”¨@JsonUnwrapped **æ‰å¹³å¯¹è±¡(å¤–é¢é‚£å±‚æ²¡äº†)**ä¹‹åï¼š\n@Getter @Setter @ToString public class Account { @JsonUnwrapped private Location location; @JsonUnwrapped private PersonInfo personInfo; ...... } { \u0026#34;provinceName\u0026#34;:\u0026#34;æ¹–åŒ—\u0026#34;, \u0026#34;countyName\u0026#34;:\u0026#34;æ­¦æ±‰\u0026#34;, \u0026#34;userName\u0026#34;: \u0026#34;coder1234\u0026#34;, \u0026#34;fullName\u0026#34;: \u0026#34;shaungkou\u0026#34; } 11. æµ‹è¯•ç›¸å…³ # @ActiveProfilesä¸€èˆ¬ä½œç”¨äºæµ‹è¯•ç±»ä¸Šï¼Œ ç”¨äºå£°æ˜ç”Ÿæ•ˆçš„ Spring é…ç½®æ–‡ä»¶ã€‚\n@SpringBootTest(webEnvironment = RANDOM_PORT) @ActiveProfiles(\u0026#34;test\u0026#34;) @Slf4j public abstract class TestBase { ...... } @Testå£°æ˜ä¸€ä¸ªæ–¹æ³•ä¸ºæµ‹è¯•æ–¹æ³•\n@Transactionalè¢«å£°æ˜çš„æµ‹è¯•æ–¹æ³•çš„æ•°æ®ä¼šå›æ»šï¼Œé¿å…æ±¡æŸ“æµ‹è¯•æ•°æ®ã€‚\n@WithMockUser Spring Security æä¾›çš„ï¼Œç”¨æ¥æ¨¡æ‹Ÿä¸€ä¸ªçœŸå®ç”¨æˆ·ï¼Œå¹¶ä¸”å¯ä»¥èµ‹äºˆæƒé™ã€‚\n@Test @Transactional @WithMockUser(username = \u0026#34;user-id-18163138155\u0026#34;, authorities = \u0026#34;ROLE_TEACHER\u0026#34;) void should_import_student_success() throws Exception { ...... } æš‚æ—¶æ€»ç»“åˆ°è¿™é‡Œå§ï¼è™½ç„¶èŠ±äº†æŒºé•¿æ—¶é—´æ‰å†™å®Œï¼Œä¸è¿‡å¯èƒ½è¿˜æ˜¯ä¼šä¸€äº›å¸¸ç”¨çš„æ³¨è§£çš„è¢«æ¼æ‰ï¼Œæ‰€ä»¥ï¼Œæˆ‘å°†æ–‡ç« ä¹ŸåŒæ­¥åˆ°äº† Github ä¸Šå»ï¼ŒGithub åœ°å€ï¼š æ¬¢è¿å®Œå–„ï¼\næœ¬æ–‡å·²ç»æ”¶å½•è¿›æˆ‘çš„ 75K Star çš„ Java å¼€æºé¡¹ç›® JavaGuideï¼šhttps://github.com/Snailclimb/JavaGuideã€‚\n"},{"id":100,"href":"/zh/docs/study/Review/java_guide/lybly_framework/ly01ly_spring-knowledge-and-questions-summary/","title":"spring å¸¸è§é¢è¯•é¢˜æ€»ç»“","section":"æ¡†æ¶","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nè¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯æƒ³é€šè¿‡ä¸€äº›é—®é¢˜ï¼ŒåŠ æ·±å¤§å®¶å¯¹äº Spring çš„ç†è§£ï¼Œæ‰€ä»¥ä¸ä¼šæ¶‰åŠå¤ªå¤šçš„ä»£ç ï¼\nä¸‹é¢çš„å¾ˆå¤šé—®é¢˜æˆ‘è‡ªå·±åœ¨ä½¿ç”¨ Spring çš„è¿‡ç¨‹ä¸­ä¹Ÿå¹¶æ²¡æœ‰æ³¨æ„ï¼Œè‡ªå·±ä¹Ÿæ˜¯ä¸´æ—¶æŸ¥é˜…äº†å¾ˆå¤šèµ„æ–™å’Œä¹¦ç±è¡¥ä¸Šçš„ã€‚ç½‘ä¸Šä¹Ÿæœ‰ä¸€äº›å¾ˆå¤šå…³äº Spring å¸¸è§é—®é¢˜/é¢è¯•é¢˜æ•´ç†çš„æ–‡ç« ï¼Œæˆ‘æ„Ÿè§‰å¤§éƒ¨åˆ†éƒ½æ˜¯äº’ç›¸ copyï¼Œè€Œä¸”å¾ˆå¤šé—®é¢˜ä¹Ÿä¸æ˜¯å¾ˆå¥½ï¼Œæœ‰äº›å›ç­”ä¹Ÿå­˜åœ¨é—®é¢˜ã€‚æ‰€ä»¥ï¼Œè‡ªå·±èŠ±äº†ä¸€å‘¨çš„ä¸šä½™æ—¶é—´æ•´ç†äº†ä¸€ä¸‹ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©ã€‚\nSpring åŸºç¡€ # ä»€ä¹ˆæ˜¯ Spring æ¡†æ¶? # Spring æ˜¯ä¸€æ¬¾å¼€æºçš„è½»é‡çº§ Java å¼€å‘æ¡†æ¶ï¼Œæ—¨åœ¨æé«˜å¼€å‘äººå‘˜çš„å¼€å‘æ•ˆç‡ä»¥åŠç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚\næˆ‘ä»¬ä¸€èˆ¬è¯´ Spring æ¡†æ¶æŒ‡çš„éƒ½æ˜¯ Spring Frameworkï¼Œå®ƒæ˜¯å¾ˆå¤šæ¨¡å—çš„é›†åˆï¼Œä½¿ç”¨è¿™äº›æ¨¡å—å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ååŠ©æˆ‘ä»¬è¿›è¡Œå¼€å‘ï¼Œæ¯”å¦‚è¯´ Spring æ”¯æŒ IoCï¼ˆInversion of Control:æ§åˆ¶åè½¬ï¼‰ å’Œ AOP(Aspect-Oriented Programming:é¢å‘åˆ‡é¢ç¼–ç¨‹)ã€å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¯¹æ•°æ®åº“è¿›è¡Œè®¿é—®ã€å¯ä»¥å¾ˆæ–¹ä¾¿åœ°é›†æˆç¬¬ä¸‰æ–¹ç»„ä»¶ï¼ˆç”µå­é‚®ä»¶ï¼Œä»»åŠ¡ï¼Œè°ƒåº¦ï¼Œç¼“å­˜ç­‰ç­‰ï¼‰ã€å¯¹å•å…ƒæµ‹è¯•æ”¯æŒæ¯”è¾ƒå¥½ã€æ”¯æŒ RESTful Java åº”ç”¨ç¨‹åºçš„å¼€å‘ã€‚\n[\nSpring æœ€æ ¸å¿ƒçš„æ€æƒ³å°±æ˜¯ä¸é‡æ–°é€ è½®å­ï¼Œå¼€ç®±å³ç”¨ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚\nSpring ç¿»è¯‘è¿‡æ¥å°±æ˜¯æ˜¥å¤©çš„æ„æ€ï¼Œå¯è§å…¶ç›®æ ‡å’Œä½¿å‘½å°±æ˜¯ä¸º Java ç¨‹åºå‘˜å¸¦æ¥æ˜¥å¤©å•Šï¼æ„ŸåŠ¨ï¼\nğŸ¤ å¤šæä¸€å˜´ ï¼š è¯­è¨€çš„æµè¡Œé€šå¸¸éœ€è¦ä¸€ä¸ªæ€æ‰‹çº§çš„åº”ç”¨ï¼ŒSpring å°±æ˜¯ Java ç”Ÿæ€çš„ä¸€ä¸ªæ€æ‰‹çº§çš„åº”ç”¨æ¡†æ¶ã€‚\nSpring æä¾›çš„æ ¸å¿ƒåŠŸèƒ½ä¸»è¦æ˜¯ IoC å’Œ AOPã€‚å­¦ä¹  Spring ï¼Œä¸€å®šè¦æŠŠ IoC å’Œ AOP çš„æ ¸å¿ƒæ€æƒ³ææ‡‚ï¼\nSpring å®˜ç½‘ï¼šhttps://spring.io/ Github åœ°å€ï¼š https://github.com/spring-projects/spring-framework Spring åŒ…å«çš„æ¨¡å—æœ‰å“ªäº›ï¼Ÿ # Spring4.x ç‰ˆæœ¬ ï¼š\nSpring5.x ç‰ˆæœ¬ ï¼š\nSpring5.x ç‰ˆæœ¬ä¸­ Web æ¨¡å—çš„ Sertlet (åº”è¯¥æ˜¯Servlet å§)ç»„ä»¶å·²ç»è¢«åºŸå¼ƒæ‰ï¼ŒåŒæ—¶å¢åŠ äº†ç”¨äºå¼‚æ­¥å“åº”å¼å¤„ç†çš„ WebFlux ç»„ä»¶ã€‚\nSpring å„ä¸ªæ¨¡å—çš„ä¾èµ–å…³ç³»å¦‚ä¸‹ï¼š Core Container # Spring æ¡†æ¶çš„æ ¸å¿ƒæ¨¡å—ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯åŸºç¡€æ¨¡å—ï¼Œä¸»è¦æä¾› IoC ä¾èµ–æ³¨å…¥åŠŸèƒ½çš„æ”¯æŒã€‚Spring å…¶ä»–æ‰€æœ‰çš„åŠŸèƒ½åŸºæœ¬éƒ½éœ€è¦ä¾èµ–äºè¯¥æ¨¡å—ï¼Œæˆ‘ä»¬ä»ä¸Šé¢é‚£å¼  Spring å„ä¸ªæ¨¡å—çš„ä¾èµ–å…³ç³»å›¾å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚\nspring-core ï¼šSpring æ¡†æ¶åŸºæœ¬çš„æ ¸å¿ƒå·¥å…·ç±»ã€‚ spring-beans ï¼šæä¾›å¯¹ bean çš„åˆ›å»ºã€é…ç½®å’Œç®¡ç†ç­‰åŠŸèƒ½çš„æ”¯æŒã€‚ spring-context ï¼šæä¾›å¯¹å›½é™…åŒ–ã€äº‹ä»¶ä¼ æ’­ã€èµ„æºåŠ è½½ç­‰åŠŸèƒ½çš„æ”¯æŒã€‚ spring-expression ï¼šæä¾›å¯¹è¡¨è¾¾å¼è¯­è¨€ï¼ˆSpring Expression Languageï¼‰ SpEL çš„æ”¯æŒï¼Œåªä¾èµ–äº core æ¨¡å—ï¼Œä¸ä¾èµ–äºå…¶ä»–æ¨¡å—ï¼Œå¯ä»¥å•ç‹¬ä½¿ç”¨ã€‚ AOP # spring-aspects ï¼šè¯¥æ¨¡å—ä¸ºä¸ AspectJ çš„é›†æˆæä¾›æ”¯æŒã€‚ spring-aop ï¼šæä¾›äº†é¢å‘åˆ‡é¢çš„ç¼–ç¨‹å®ç°ã€‚ spring-instrument ï¼šæä¾›äº†ä¸º JVM æ·»åŠ ä»£ç†ï¼ˆagentï¼‰çš„åŠŸèƒ½ã€‚ å…·ä½“æ¥è®²ï¼Œå®ƒä¸º Tomcat æä¾›äº†ä¸€ä¸ªç»‡å…¥ä»£ç†ï¼Œèƒ½å¤Ÿä¸º Tomcat ä¼ é€’ç±»æ–‡ ä»¶ï¼Œå°±åƒè¿™äº›æ–‡ä»¶æ˜¯è¢«ç±»åŠ è½½å™¨åŠ è½½çš„ä¸€æ ·ã€‚æ²¡æœ‰ç†è§£ä¹Ÿæ²¡å…³ç³»ï¼Œè¿™ä¸ªæ¨¡å—çš„ä½¿ç”¨åœºæ™¯éå¸¸æœ‰é™ã€‚ Data Access/Integration # spring-jdbc ï¼šæä¾›äº†å¯¹æ•°æ®åº“è®¿é—®çš„æŠ½è±¡ JDBCã€‚ä¸åŒçš„æ•°æ®åº“éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ API ç”¨äºæ“ä½œæ•°æ®åº“ï¼Œè€Œ Java ç¨‹åºåªéœ€è¦å’Œ JDBC API äº¤äº’ï¼Œè¿™æ ·å°±å±è”½äº†æ•°æ®åº“çš„å½±å“ã€‚ spring-tx ï¼šæä¾›å¯¹äº‹åŠ¡çš„æ”¯æŒã€‚ spring-orm ï¼š æä¾›å¯¹ Hibernateã€JPA ã€iBatis ç­‰ ORM æ¡†æ¶çš„æ”¯æŒã€‚ spring-oxm ï¼šæä¾›ä¸€ä¸ªæŠ½è±¡å±‚æ”¯æ’‘ OXM(Object-to-XML-Mapping)ï¼Œä¾‹å¦‚ï¼šJAXBã€Castorã€XMLBeansã€JiBX å’Œ XStream ç­‰ã€‚ spring-jms : æ¶ˆæ¯æœåŠ¡ã€‚è‡ª Spring Framework 4.1 ä»¥åï¼Œå®ƒè¿˜æä¾›äº†å¯¹ spring-messaging æ¨¡å—çš„ç»§æ‰¿ã€‚ Spring Web # spring-web ï¼šå¯¹ Web åŠŸèƒ½çš„å®ç°æä¾›ä¸€äº›æœ€åŸºç¡€çš„æ”¯æŒã€‚ spring-webmvc ï¼š æä¾›å¯¹ Spring MVC çš„å®ç°ã€‚ spring-websocket ï¼š æä¾›äº†å¯¹ WebSocket çš„æ”¯æŒï¼ŒWebSocket å¯ä»¥è®©å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¿›è¡ŒåŒå‘é€šä¿¡ã€‚ spring-webflux ï¼šæä¾›å¯¹ WebFlux çš„æ”¯æŒã€‚WebFlux æ˜¯ Spring Framework 5.0 ä¸­å¼•å…¥çš„æ–°çš„å“åº”å¼æ¡†æ¶ã€‚ä¸ Spring MVC ä¸åŒï¼Œå®ƒä¸éœ€è¦ Servlet APIï¼Œæ˜¯å®Œå…¨å¼‚æ­¥ã€‚ Messaging # spring-messaging æ˜¯ä» Spring4.0 å¼€å§‹æ–°åŠ å…¥çš„ä¸€ä¸ªæ¨¡å—ï¼Œä¸»è¦èŒè´£æ˜¯ä¸º Spring æ¡†æ¶é›†æˆä¸€äº›åŸºç¡€çš„æŠ¥æ–‡ä¼ é€åº”ç”¨ã€‚\nSpring Test # Spring å›¢é˜Ÿæå€¡æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰ã€‚æœ‰äº†æ§åˆ¶åè½¬ (IoC)çš„å¸®åŠ©ï¼Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•å˜å¾—æ›´ç®€å•ã€‚\nSpring çš„æµ‹è¯•æ¨¡å—å¯¹ JUnitï¼ˆå•å…ƒæµ‹è¯•æ¡†æ¶ï¼‰ã€TestNGï¼ˆç±»ä¼¼ JUnitï¼‰ã€Mockitoï¼ˆä¸»è¦ç”¨æ¥ Mock å¯¹è±¡ï¼‰ã€PowerMockï¼ˆè§£å†³ Mockito çš„é—®é¢˜æ¯”å¦‚æ— æ³•æ¨¡æ‹Ÿ final, staticï¼Œ private æ–¹æ³•ï¼‰ç­‰ç­‰å¸¸ç”¨çš„æµ‹è¯•æ¡†æ¶æ”¯æŒçš„éƒ½æ¯”è¾ƒå¥½ã€‚\nSpring,Spring MVC,Spring Boot ä¹‹é—´ä»€ä¹ˆå…³ç³»? # å¾ˆå¤šäººå¯¹ Spring,Spring MVC,Spring Boot è¿™ä¸‰è€…å‚»å‚»åˆ†ä¸æ¸…æ¥šï¼è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹è¿™ä¸‰è€…ï¼Œå…¶å®å¾ˆç®€å•ï¼Œæ²¡æœ‰ä»€ä¹ˆé«˜æ·±çš„ä¸œè¥¿ã€‚\nSpring åŒ…å«äº†å¤šä¸ªåŠŸèƒ½æ¨¡å—ï¼ˆä¸Šé¢åˆšåˆšæåˆ°è¿‡ï¼‰ï¼Œå…¶ä¸­æœ€é‡è¦çš„æ˜¯ Spring-Coreï¼ˆä¸»è¦æä¾› IoC ä¾èµ–æ³¨å…¥åŠŸèƒ½çš„æ”¯æŒï¼‰ æ¨¡å—ï¼Œ Spring ä¸­çš„å…¶ä»–æ¨¡å—ï¼ˆæ¯”å¦‚ Spring MVCï¼‰çš„åŠŸèƒ½å®ç°åŸºæœ¬éƒ½éœ€è¦ä¾èµ–äºè¯¥æ¨¡å—ã€‚\nä¸‹å›¾å¯¹åº”çš„æ˜¯ Spring4.x ç‰ˆæœ¬ã€‚ç›®å‰æœ€æ–°çš„ 5.x ç‰ˆæœ¬ä¸­ Web æ¨¡å—çš„ Portlet ç»„ä»¶å·²ç»è¢«åºŸå¼ƒæ‰ï¼ŒåŒæ—¶å¢åŠ äº†ç”¨äºå¼‚æ­¥å“åº”å¼å¤„ç†çš„ WebFlux ç»„ä»¶ã€‚\nSpring MVC æ˜¯ Spring ä¸­çš„ä¸€ä¸ªå¾ˆé‡è¦çš„æ¨¡å—ï¼Œä¸»è¦èµ‹äºˆ Spring å¿«é€Ÿæ„å»º MVC æ¶æ„çš„ Web ç¨‹åºçš„èƒ½åŠ›ã€‚MVC æ˜¯æ¨¡å‹(Model)ã€è§†å›¾(View)ã€æ§åˆ¶å™¨(Controller)çš„ç®€å†™ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å°†ä¸šåŠ¡é€»è¾‘ã€æ•°æ®ã€æ˜¾ç¤ºåˆ†ç¦»æ¥ç»„ç»‡ä»£ç ã€‚\nä½¿ç”¨ Spring è¿›è¡Œå¼€å‘å„ç§é…ç½®è¿‡äºéº»çƒ¦æ¯”å¦‚å¼€å¯æŸäº› Spring ç‰¹æ€§æ—¶ï¼Œéœ€è¦ç”¨ XML æˆ– Java è¿›è¡Œæ˜¾å¼é…ç½®ã€‚äºæ˜¯ï¼ŒSpring Boot è¯ç”Ÿäº†ï¼\nSpring æ—¨åœ¨ç®€åŒ– J2EE ä¼ä¸šåº”ç”¨ç¨‹åºå¼€å‘ã€‚Spring Boot æ—¨åœ¨ç®€åŒ– Spring å¼€å‘ï¼ˆå‡å°‘é…ç½®æ–‡ä»¶ï¼Œå¼€ç®±å³ç”¨ï¼ï¼‰ã€‚\nSpring Boot åªæ˜¯ç®€åŒ–äº†é…ç½®ï¼Œå¦‚æœä½ éœ€è¦æ„å»º MVC æ¶æ„çš„ Web ç¨‹åºï¼Œä½ è¿˜æ˜¯éœ€è¦ä½¿ç”¨ Spring MVC ä½œä¸º MVC æ¡†æ¶ï¼Œåªæ˜¯è¯´ Spring Boot å¸®ä½ ç®€åŒ–äº† Spring MVC çš„å¾ˆå¤šé…ç½®ï¼ŒçœŸæ­£åšåˆ°å¼€ç®±å³ç”¨ï¼\nSpring IoC # è°ˆè°ˆè‡ªå·±å¯¹äº Spring IoC çš„äº†è§£ # IoCï¼ˆInversion of Control:æ§åˆ¶åè½¬ï¼‰ æ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„æŠ€æœ¯å®ç°ã€‚IoC çš„æ€æƒ³å°±æ˜¯å°†åŸæœ¬åœ¨ç¨‹åºä¸­æ‰‹åŠ¨åˆ›å»ºå¯¹è±¡çš„æ§åˆ¶æƒï¼Œäº¤ç”± Spring æ¡†æ¶æ¥ç®¡ç†ã€‚ä¸è¿‡ï¼Œ IoC å¹¶é Spring ç‰¹æœ‰ï¼Œåœ¨å…¶ä»–è¯­è¨€ä¸­ä¹Ÿæœ‰åº”ç”¨ã€‚\nä¸ºä»€ä¹ˆå«æ§åˆ¶åè½¬ï¼Ÿ\næ§åˆ¶ ï¼šæŒ‡çš„æ˜¯å¯¹è±¡åˆ›å»ºï¼ˆå®ä¾‹åŒ–ã€ç®¡ç†ï¼‰çš„æƒåŠ› åè½¬ ï¼šæ§åˆ¶æƒäº¤ç»™å¤–éƒ¨ç¯å¢ƒï¼ˆSpring æ¡†æ¶ã€IoC å®¹å™¨ï¼‰ å°†å¯¹è±¡ä¹‹é—´çš„ç›¸äº’ä¾èµ–å…³ç³»äº¤ç»™ IoC å®¹å™¨æ¥ç®¡ç†ï¼Œå¹¶ç”± IoC å®¹å™¨å®Œæˆå¯¹è±¡çš„æ³¨å…¥ã€‚è¿™æ ·å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šç®€åŒ–åº”ç”¨çš„å¼€å‘ï¼ŒæŠŠåº”ç”¨ä»å¤æ‚çš„ä¾èµ–å…³ç³»ä¸­è§£æ”¾å‡ºæ¥ã€‚ IoC å®¹å™¨å°±åƒæ˜¯ä¸€ä¸ªå·¥å‚ä¸€æ ·ï¼Œå½“æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œåªéœ€è¦é…ç½®å¥½é…ç½®æ–‡ä»¶/æ³¨è§£å³å¯ï¼Œå®Œå…¨ä¸ç”¨è€ƒè™‘å¯¹è±¡æ˜¯å¦‚ä½•è¢«åˆ›å»ºå‡ºæ¥çš„ã€‚\nåœ¨å®é™…é¡¹ç›®ä¸­ä¸€ä¸ª Service ç±»å¯èƒ½ä¾èµ–äº†å¾ˆå¤šå…¶ä»–çš„ç±»ï¼Œå‡å¦‚æˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–è¿™ä¸ª Serviceï¼Œä½ å¯èƒ½è¦æ¯æ¬¡éƒ½è¦ææ¸…è¿™ä¸ª Service æ‰€æœ‰åº•å±‚ç±»çš„æ„é€ å‡½æ•°ï¼Œè¿™å¯èƒ½ä¼šæŠŠäººé€¼ç–¯ã€‚å¦‚æœåˆ©ç”¨ IoC çš„è¯ï¼Œä½ åªéœ€è¦é…ç½®å¥½ï¼Œç„¶ååœ¨éœ€è¦çš„åœ°æ–¹å¼•ç”¨å°±è¡Œäº†ï¼Œè¿™å¤§å¤§å¢åŠ äº†é¡¹ç›®çš„å¯ç»´æŠ¤æ€§ä¸”é™ä½äº†å¼€å‘éš¾åº¦ã€‚\nåœ¨ Spring ä¸­ï¼Œ IoC å®¹å™¨æ˜¯ Spring ç”¨æ¥å®ç° IoC çš„è½½ä½“ï¼Œ IoC å®¹å™¨å®é™…ä¸Šå°±æ˜¯ä¸ª Mapï¼ˆkeyï¼Œvalueï¼‰ï¼ŒMap ä¸­å­˜æ”¾çš„æ˜¯å„ç§å¯¹è±¡ã€‚\nSpring æ—¶ä»£æˆ‘ä»¬ä¸€èˆ¬é€šè¿‡ XML æ–‡ä»¶æ¥é…ç½® Beanï¼Œåæ¥å¼€å‘äººå‘˜è§‰å¾— XML æ–‡ä»¶æ¥é…ç½®ä¸å¤ªå¥½ï¼Œäºæ˜¯ SpringBoot æ³¨è§£é…ç½®å°±æ…¢æ…¢å¼€å§‹æµè¡Œèµ·æ¥ã€‚\nç›¸å…³é˜…è¯»ï¼š\nIoC æºç é˜…è¯» é¢è¯•è¢«é—®äº†å‡ ç™¾éçš„ IoC å’Œ AOP ï¼Œè¿˜åœ¨å‚»å‚»æä¸æ¸…æ¥šï¼Ÿ ä»€ä¹ˆæ˜¯ Spring Beanï¼Ÿ # ç®€å•æ¥è¯´ï¼ŒBean ä»£æŒ‡çš„å°±æ˜¯é‚£äº›è¢« IoC å®¹å™¨æ‰€ç®¡ç†çš„å¯¹è±¡ã€‚\næˆ‘ä»¬éœ€è¦å‘Šè¯‰ IoC å®¹å™¨å¸®åŠ©æˆ‘ä»¬ç®¡ç†å“ªäº›å¯¹è±¡ï¼Œè¿™ä¸ªæ˜¯é€šè¿‡é…ç½®å…ƒæ•°æ®æ¥å®šä¹‰çš„ã€‚é…ç½®å…ƒæ•°æ®å¯ä»¥æ˜¯ XML æ–‡ä»¶ã€æ³¨è§£æˆ–è€… Java é…ç½®ç±»ã€‚\n\u0026lt;!-- Constructor-arg with \u0026#39;value\u0026#39; attribute --\u0026gt; \u0026lt;bean id=\u0026#34;...\u0026#34; class=\u0026#34;...\u0026#34;\u0026gt; \u0026lt;constructor-arg value=\u0026#34;...\u0026#34;/\u0026gt; \u0026lt;/bean\u0026gt; ä¸‹å›¾ç®€å•åœ°å±•ç¤ºäº† IoC å®¹å™¨å¦‚ä½•ä½¿ç”¨é…ç½®å…ƒæ•°æ®æ¥ç®¡ç†å¯¹è±¡ã€‚\norg.springframework.beanså’Œ org.springframework.context è¿™ä¸¤ä¸ªåŒ…æ˜¯ IoC å®ç°çš„åŸºç¡€ï¼Œå¦‚æœæƒ³è¦ç ”ç©¶ IoC ç›¸å…³çš„æºç çš„è¯ï¼Œå¯ä»¥å»çœ‹çœ‹\nå°†ä¸€ä¸ªç±»å£°æ˜ä¸º Bean çš„æ³¨è§£æœ‰å“ªäº›? # @Component ï¼šé€šç”¨çš„æ³¨è§£ï¼Œå¯æ ‡æ³¨ä»»æ„ç±»ä¸º Spring ç»„ä»¶ã€‚å¦‚æœä¸€ä¸ª Bean ä¸çŸ¥é“å±äºå“ªä¸ªå±‚ï¼Œå¯ä»¥ä½¿ç”¨@Component æ³¨è§£æ ‡æ³¨ã€‚ @Repository : å¯¹åº”æŒä¹…å±‚å³ Dao å±‚ï¼Œä¸»è¦ç”¨äºæ•°æ®åº“ç›¸å…³æ“ä½œã€‚ @Service : å¯¹åº”æœåŠ¡å±‚ï¼Œä¸»è¦æ¶‰åŠä¸€äº›å¤æ‚çš„é€»è¾‘ï¼Œéœ€è¦ç”¨åˆ° Dao å±‚ã€‚ @Controller : å¯¹åº” Spring MVC æ§åˆ¶å±‚ï¼Œä¸»è¦ç”¨æˆ·æ¥å—ç”¨æˆ·è¯·æ±‚å¹¶è°ƒç”¨ Service å±‚è¿”å›æ•°æ®ç»™å‰ç«¯é¡µé¢ã€‚ @Component å’Œ @Bean çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ # @Component æ³¨è§£ä½œç”¨äºç±»ï¼Œè€Œ@Beanæ³¨è§£ä½œç”¨äºæ–¹æ³•ã€‚ @Componenté€šå¸¸æ˜¯é€šè¿‡ç±»è·¯å¾„æ‰«ææ¥è‡ªåŠ¨ä¾¦æµ‹ä»¥åŠè‡ªåŠ¨è£…é…åˆ° Spring å®¹å™¨ä¸­ï¼ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ @ComponentScan æ³¨è§£å®šä¹‰è¦æ‰«æçš„è·¯å¾„ä»ä¸­æ‰¾å‡ºæ ‡è¯†äº†éœ€è¦è£…é…çš„ç±»è‡ªåŠ¨è£…é…åˆ° Spring çš„ bean å®¹å™¨ä¸­ï¼‰ã€‚@Bean æ³¨è§£é€šå¸¸æ˜¯æˆ‘ä»¬åœ¨æ ‡æœ‰è¯¥æ³¨è§£çš„æ–¹æ³•ä¸­å®šä¹‰äº§ç”Ÿè¿™ä¸ª bean,@Beanå‘Šè¯‰äº† Spring è¿™æ˜¯æŸä¸ªç±»çš„å®ä¾‹ï¼Œå½“æˆ‘éœ€è¦ç”¨å®ƒçš„æ—¶å€™è¿˜ç»™æˆ‘ã€‚ @Bean æ³¨è§£æ¯” @Component æ³¨è§£çš„è‡ªå®šä¹‰æ€§æ›´å¼ºï¼Œè€Œä¸”å¾ˆå¤šåœ°æ–¹æˆ‘ä»¬åªèƒ½é€šè¿‡ @Bean æ³¨è§£æ¥æ³¨å†Œ beanã€‚æ¯”å¦‚å½“æˆ‘ä»¬å¼•ç”¨ç¬¬ä¸‰æ–¹åº“ä¸­çš„ç±»éœ€è¦è£…é…åˆ° Springå®¹å™¨æ—¶ï¼Œåˆ™åªèƒ½é€šè¿‡ @Beanæ¥å®ç°ã€‚ @Beanæ³¨è§£ä½¿ç”¨ç¤ºä¾‹ï¼š\n@Configuration public class AppConfig { @Bean public TransferService transferService() { return new TransferServiceImpl(); } } ä¸Šé¢çš„ä»£ç ç›¸å½“äºä¸‹é¢çš„ xml é…ç½®\n\u0026lt;beans\u0026gt; \u0026lt;bean id=\u0026#34;transferService\u0026#34; class=\u0026#34;com.acme.TransferServiceImpl\u0026#34;/\u0026gt; \u0026lt;/beans\u0026gt; ä¸‹é¢è¿™ä¸ªä¾‹å­æ˜¯é€šè¿‡ @Component æ— æ³•å®ç°çš„ã€‚ï¼ˆå¸¦æœ‰é€»è¾‘ï¼‰\n@Bean public OneService getService(status) { case (status) { when 1: return new serviceImpl1(); when 2: return new serviceImpl2(); when 3: return new serviceImpl3(); } } æ³¨å…¥ Bean çš„æ³¨è§£æœ‰å“ªäº›ï¼Ÿ # Spring å†…ç½®çš„ @Autowired ä»¥åŠ JDK å†…ç½®çš„ @Resource å’Œ @Inject éƒ½å¯ä»¥ç”¨äºæ³¨å…¥ Beanã€‚\nAnnotaion Package Source @Autowired org.springframework.bean.factory Spring 2.5+ @Resource javax.annotation Java JSR-250 @Inject javax.inject Java JSR-330 @Autowired å’Œ@Resourceä½¿ç”¨çš„æ¯”è¾ƒå¤šä¸€äº›ã€‚\n@Autowired å’Œ @Resource çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ # Autowired å±äº Spring å†…ç½®çš„æ³¨è§£ï¼Œé»˜è®¤çš„æ³¨å…¥æ–¹å¼ä¸ºbyTypeï¼ˆæ ¹æ®ç±»å‹è¿›è¡ŒåŒ¹é…ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šä¼˜å…ˆæ ¹æ®æ¥å£ç±»å‹å»åŒ¹é…å¹¶æ³¨å…¥ Bean ï¼ˆæ¥å£çš„å®ç°ç±»ï¼‰ã€‚\nè¿™ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ å½“ä¸€ä¸ªæ¥å£å­˜åœ¨å¤šä¸ªå®ç°ç±»çš„è¯ï¼ŒbyTypeè¿™ç§æ–¹å¼å°±æ— æ³•æ­£ç¡®æ³¨å…¥å¯¹è±¡äº†ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™ Spring ä¼šåŒæ—¶æ‰¾åˆ°å¤šä¸ªæ»¡è¶³æ¡ä»¶çš„é€‰æ‹©ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒè‡ªå·±ä¸çŸ¥é“é€‰æ‹©å“ªä¸€ä¸ªã€‚\nè¿™ç§æƒ…å†µä¸‹ï¼Œæ³¨å…¥æ–¹å¼ä¼šå˜ä¸º byNameï¼ˆæ ¹æ®åç§°è¿›è¡ŒåŒ¹é…ï¼‰ï¼Œè¿™ä¸ªåç§°é€šå¸¸å°±æ˜¯ç±»åï¼ˆé¦–å­—æ¯å°å†™ï¼‰ã€‚å°±æ¯”å¦‚è¯´ä¸‹é¢ä»£ç ä¸­çš„ smsService å°±æ˜¯æˆ‘è¿™é‡Œæ‰€è¯´çš„åç§°ï¼Œè¿™æ ·åº”è¯¥æ¯”è¾ƒå¥½ç†è§£äº†å§ã€‚\n// smsService å°±æ˜¯æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„åç§° @Autowired private SmsService smsService; ä¸¾ä¸ªä¾‹å­ï¼ŒSmsService æ¥å£æœ‰ä¸¤ä¸ªå®ç°ç±»: SmsServiceImpl1å’Œ SmsServiceImpl2ï¼Œä¸”å®ƒä»¬éƒ½å·²ç»è¢« Spring å®¹å™¨æ‰€ç®¡ç†ã€‚\n// æŠ¥é”™ï¼ŒbyName å’Œ byType éƒ½æ— æ³•åŒ¹é…åˆ° bean @Autowired private SmsService smsService; // æ­£ç¡®æ³¨å…¥ SmsServiceImpl1 å¯¹è±¡å¯¹åº”çš„ bean @Autowired private SmsService smsServiceImpl1; // æ­£ç¡®æ³¨å…¥ SmsServiceImpl1 å¯¹è±¡å¯¹åº”çš„ bean // smsServiceImpl1 å°±æ˜¯æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„åç§° @Autowired @Qualifier(value = \u0026#34;smsServiceImpl1\u0026#34;) private SmsService smsService; æˆ‘ä»¬è¿˜æ˜¯å»ºè®®é€šè¿‡ @Qualifier æ³¨è§£æ¥æ˜¾å¼æŒ‡å®šåç§°è€Œä¸æ˜¯ä¾èµ–å˜é‡çš„åç§°ã€‚\n@Resourceå±äº JDK æä¾›çš„æ³¨è§£ï¼Œé»˜è®¤æ³¨å…¥æ–¹å¼ä¸º byNameã€‚å¦‚æœæ— æ³•é€šè¿‡åç§°åŒ¹é…åˆ°å¯¹åº”çš„ Bean çš„è¯ï¼Œæ³¨å…¥æ–¹å¼ä¼šå˜ä¸ºbyTypeã€‚\n@Resource æœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦ä¸”æ—¥å¸¸å¼€å‘å¸¸ç”¨çš„å±æ€§ï¼šnameï¼ˆåç§°ï¼‰ã€typeï¼ˆç±»å‹ï¼‰ã€‚\npublic @interface Resource { String name() default \u0026#34;\u0026#34;; Class\u0026lt;?\u0026gt; type() default Object.class; } å¦‚æœä»…æŒ‡å®š name å±æ€§åˆ™æ³¨å…¥æ–¹å¼ä¸ºbyNameï¼Œå¦‚æœä»…æŒ‡å®štypeå±æ€§åˆ™æ³¨å…¥æ–¹å¼ä¸ºbyTypeï¼Œå¦‚æœåŒæ—¶æŒ‡å®šname å’Œtypeå±æ€§ï¼ˆä¸å»ºè®®è¿™ä¹ˆåšï¼‰åˆ™æ³¨å…¥æ–¹å¼ä¸ºbyType+byNameã€‚\n// æŠ¥é”™ï¼ŒbyName å’Œ byType éƒ½æ— æ³•åŒ¹é…åˆ° bean @Resource private SmsService smsService; // æ­£ç¡®æ³¨å…¥ SmsServiceImpl1 å¯¹è±¡å¯¹åº”çš„ bean @Resource private SmsService smsServiceImpl1; // æ­£ç¡®æ³¨å…¥ SmsServiceImpl1 å¯¹è±¡å¯¹åº”çš„ beanï¼ˆæ¯”è¾ƒæ¨èè¿™ç§æ–¹å¼ï¼‰ @Resource(name = \u0026#34;smsServiceImpl1\u0026#34;) private SmsService smsService; ç®€å•æ€»ç»“ä¸€ä¸‹ï¼š\n@Autowired æ˜¯ Spring æä¾›çš„æ³¨è§£ï¼Œ@Resource æ˜¯ JDK æä¾›çš„æ³¨è§£ã€‚ Autowired é»˜è®¤çš„æ³¨å…¥æ–¹å¼ä¸º**byTypeï¼ˆæ ¹æ®ç±»å‹è¿›è¡ŒåŒ¹é…ï¼‰**ï¼Œ@Resourceé»˜è®¤æ³¨å…¥æ–¹å¼ä¸º byNameï¼ˆæ ¹æ®åç§°è¿›è¡ŒåŒ¹é…ï¼‰ã€‚ å½“ä¸€ä¸ªæ¥å£å­˜åœ¨å¤šä¸ªå®ç°ç±»çš„æƒ…å†µä¸‹ï¼Œ@Autowired å’Œ@Resourceéƒ½éœ€è¦é€šè¿‡åç§°æ‰èƒ½æ­£ç¡®åŒ¹é…åˆ°å¯¹åº”çš„ Beanã€‚Autowired å¯ä»¥é€šè¿‡ @Qualifier æ³¨è§£æ¥æ˜¾å¼æŒ‡å®šåç§°ï¼Œ@Resourceå¯ä»¥é€šè¿‡ name å±æ€§æ¥æ˜¾å¼æŒ‡å®šåç§°ã€‚ Bean çš„ä½œç”¨åŸŸæœ‰å“ªäº›? # Spring ä¸­ Bean çš„ä½œç”¨åŸŸé€šå¸¸æœ‰ä¸‹é¢å‡ ç§ï¼š\nsingleton : IoC å®¹å™¨ä¸­åªæœ‰å”¯ä¸€çš„ bean å®ä¾‹ã€‚Spring ä¸­çš„ bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ï¼Œæ˜¯å¯¹å•ä¾‹è®¾è®¡æ¨¡å¼çš„åº”ç”¨ã€‚ prototype : æ¯æ¬¡è·å–éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ bean å®ä¾‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿ç»­ getBean() ä¸¤æ¬¡ï¼Œå¾—åˆ°çš„æ˜¯ä¸åŒçš„ Bean å®ä¾‹ã€‚ request ï¼ˆä»… Web åº”ç”¨å¯ç”¨ï¼‰: æ¯ä¸€æ¬¡ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ beanï¼ˆè¯·æ±‚ beanï¼‰ï¼Œè¯¥ bean ä»…åœ¨å½“å‰ HTTP request å†…æœ‰æ•ˆã€‚ session ï¼ˆä»… Web åº”ç”¨å¯ç”¨ï¼‰ : æ¯ä¸€æ¬¡æ¥è‡ªæ–° session çš„ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ beanï¼ˆä¼šè¯ beanï¼‰ï¼Œè¯¥ bean ä»…åœ¨å½“å‰ HTTP session å†…æœ‰æ•ˆã€‚ application/global-session ï¼ˆä»… Web åº”ç”¨å¯ç”¨ï¼‰ï¼š æ¯ä¸ª Web åº”ç”¨åœ¨å¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ª Beanï¼ˆåº”ç”¨ Beanï¼‰ï¼Œè¯¥ bean ä»…åœ¨å½“å‰åº”ç”¨å¯åŠ¨æ—¶é—´å†…æœ‰æ•ˆã€‚ websocket ï¼ˆä»… Web åº”ç”¨å¯ç”¨ï¼‰ï¼šæ¯ä¸€æ¬¡ WebSocket ä¼šè¯äº§ç”Ÿä¸€ä¸ªæ–°çš„ beanã€‚ å¦‚ä½•é…ç½® bean çš„ä½œç”¨åŸŸå‘¢ï¼Ÿ\nxml æ–¹å¼ï¼š\n\u0026lt;bean id=\u0026#34;...\u0026#34; class=\u0026#34;...\u0026#34; scope=\u0026#34;singleton\u0026#34;\u0026gt;\u0026lt;/bean\u0026gt; æ³¨è§£æ–¹å¼ï¼š\n@Bean @Scope(value = ConfigurableBeanFactory.SCOPE_PROTOTYPE) public Person personPrototype() { return new Person(); } å•ä¾‹ Bean çš„çº¿ç¨‹å®‰å…¨é—®é¢˜äº†è§£å—ï¼Ÿ # å¤§éƒ¨åˆ†æ—¶å€™æˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œæ‰€ä»¥å¾ˆå°‘æœ‰äººä¼šå…³æ³¨è¿™ä¸ªé—®é¢˜ã€‚å•ä¾‹ Bean å­˜åœ¨çº¿ç¨‹é—®é¢˜ï¼Œä¸»è¦æ˜¯å› ä¸ºå½“å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™æ˜¯å­˜åœ¨èµ„æºç«äº‰çš„ã€‚\nå¸¸è§çš„æœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼š\nåœ¨ Bean ä¸­å°½é‡é¿å…å®šä¹‰å¯å˜çš„æˆå‘˜å˜é‡ã€‚ åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ª ThreadLocal æˆå‘˜å˜é‡ï¼Œå°†éœ€è¦çš„å¯å˜æˆå‘˜å˜é‡ä¿å­˜åœ¨ ThreadLocal ä¸­ï¼ˆæ¨èçš„ä¸€ç§æ–¹å¼ï¼‰ã€‚ ä¸è¿‡ï¼Œå¤§éƒ¨åˆ† Bean å®é™…éƒ½æ˜¯æ— çŠ¶æ€ï¼ˆæ²¡æœ‰å®ä¾‹å˜é‡ï¼‰çš„ï¼ˆæ¯”å¦‚ Daoã€Serviceï¼‰ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œ Bean æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚\nBean çš„ç”Ÿå‘½å‘¨æœŸäº†è§£ä¹ˆ? # ä¸‹é¢çš„å†…å®¹æ•´ç†è‡ªï¼šhttps://yemengying.com/2016/07/14/spring-bean-life-cycle/ ï¼Œé™¤äº†è¿™ç¯‡æ–‡ç« ï¼Œå†æ¨èä¸€ç¯‡å¾ˆä¸é”™çš„æ–‡ç«  ï¼šhttps://www.cnblogs.com/zrtqsk/p/3735273.html ã€‚\nBean å®¹å™¨æ‰¾åˆ°é…ç½®æ–‡ä»¶ä¸­ Spring Bean çš„å®šä¹‰ã€‚ Bean å®¹å™¨åˆ©ç”¨ Java Reflection API åˆ›å»ºä¸€ä¸ª Bean çš„å®ä¾‹ã€‚ã€åå°„ã€‘ å¦‚æœæ¶‰åŠåˆ°ä¸€äº›å±æ€§å€¼ åˆ©ç”¨ set()æ–¹æ³•è®¾ç½®ä¸€äº›å±æ€§å€¼ã€‚ aware è‹±[É™ËˆweÉ™(r)] adj. æ„è¯†åˆ°çš„,å‘è§‰,å‘ç°`\nå¦‚æœ Bean å®ç°äº† BeanNameAware æ¥å£ï¼Œè°ƒç”¨ setBeanName()æ–¹æ³•ï¼Œä¼ å…¥ Bean çš„åå­—ã€‚ å¦‚æœ Bean å®ç°äº† BeanClassLoaderAware æ¥å£ï¼Œè°ƒç”¨ setBeanClassLoader()æ–¹æ³•ï¼Œä¼ å…¥ ClassLoaderå¯¹è±¡çš„å®ä¾‹ã€‚ å¦‚æœ Bean å®ç°äº† BeanFactoryAware æ¥å£ï¼Œè°ƒç”¨ setBeanFactory()æ–¹æ³•ï¼Œä¼ å…¥ BeanFactoryå¯¹è±¡çš„å®ä¾‹ã€‚ ä¸ä¸Šé¢çš„ç±»ä¼¼ï¼Œå¦‚æœå®ç°äº†å…¶ä»– *.Awareæ¥å£ï¼Œå°±è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ã€‚ å¦‚æœæœ‰å’ŒåŠ è½½è¿™ä¸ª Bean çš„ Spring å®¹å™¨ç›¸å…³çš„ BeanPostProcessor å¯¹è±¡ï¼Œæ‰§è¡ŒpostProcessBeforeInitialization() æ–¹æ³• å¦‚æœ Bean å®ç°äº†**InitializingBeanæ¥å£ï¼Œæ‰§è¡ŒafterPropertiesSet()**æ–¹æ³•ã€‚ å¦‚æœ Bean åœ¨é…ç½®æ–‡ä»¶ä¸­çš„å®šä¹‰åŒ…å« init-method å±æ€§ï¼Œæ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•ã€‚ å¦‚æœæœ‰å’ŒåŠ è½½è¿™ä¸ª Bean çš„ Spring å®¹å™¨ç›¸å…³çš„ BeanPostProcessor å¯¹è±¡ï¼Œæ‰§è¡ŒpostProcessAfterInitialization() æ–¹æ³• å½“è¦é”€æ¯ Bean çš„æ—¶å€™ï¼Œå¦‚æœ Bean å®ç°äº† DisposableBean æ¥å£ï¼Œæ‰§è¡Œ destroy() æ–¹æ³•ã€‚ å½“è¦é”€æ¯ Bean çš„æ—¶å€™ï¼Œå¦‚æœ Bean åœ¨é…ç½®æ–‡ä»¶ä¸­çš„å®šä¹‰åŒ…å« destroy-method å±æ€§ï¼Œæ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•ã€‚ å›¾ç¤ºï¼š\nä¸ä¹‹æ¯”è¾ƒç±»ä¼¼çš„ä¸­æ–‡ç‰ˆæœ¬:\nSpring AoP # è°ˆè°ˆè‡ªå·±å¯¹äº AOP çš„äº†è§£ # aspect è‹±[ËˆÃ¦spekt] æ–¹ä½ n.\noriented è‹±[ËˆÉ”ËrientÉªd] æœå‘ v.\nAOP(Aspect-Oriented Programming:é¢å‘åˆ‡é¢ç¼–ç¨‹)èƒ½å¤Ÿå°†é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œå´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘æˆ–è´£ä»»ï¼ˆä¾‹å¦‚äº‹åŠ¡å¤„ç†ã€æ—¥å¿—ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰ï¼‰å°è£…èµ·æ¥ï¼Œä¾¿äºå‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç ï¼Œé™ä½æ¨¡å—é—´çš„è€¦åˆåº¦ï¼Œå¹¶æœ‰åˆ©äºæœªæ¥çš„å¯æ‹“å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\nSpring AOP å°±æ˜¯åŸºäºåŠ¨æ€ä»£ç†çš„ï¼Œå¦‚æœè¦ä»£ç†çš„å¯¹è±¡ï¼Œå®ç°äº†æŸä¸ªæ¥å£ï¼Œé‚£ä¹ˆ Spring AOP ä¼šä½¿ç”¨ JDK Proxyï¼Œå»åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œè€Œå¯¹äºæ²¡æœ‰å®ç°æ¥å£çš„å¯¹è±¡ï¼Œå°±æ— æ³•ä½¿ç”¨ JDK Proxy å»è¿›è¡Œä»£ç†äº†ï¼Œè¿™æ—¶å€™ Spring AOP ä¼šä½¿ç”¨ Cglib ç”Ÿæˆä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡çš„å­ç±»æ¥ä½œä¸ºä»£ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ AspectJ ï¼Spring AOP å·²ç»é›†æˆäº† AspectJ ï¼ŒAspectJ åº”è¯¥ç®—çš„ä¸Šæ˜¯ Java ç”Ÿæ€ç³»ç»Ÿä¸­æœ€å®Œæ•´çš„ AOP æ¡†æ¶äº†ã€‚\nAOP åˆ‡é¢ç¼–ç¨‹è®¾è®¡åˆ°çš„ä¸€äº›ä¸“ä¸šæœ¯è¯­ï¼š\næœ¯è¯­ å«ä¹‰ ç›®æ ‡(Target) è¢«é€šçŸ¥çš„å¯¹è±¡ ä»£ç†(Proxy) å‘ç›®æ ‡å¯¹è±¡åº”ç”¨é€šçŸ¥ä¹‹ååˆ›å»ºçš„ä»£ç†å¯¹è±¡ è¿æ¥ç‚¹(JoinPoint) ç›®æ ‡å¯¹è±¡çš„æ‰€å±ç±»ä¸­ï¼Œå®šä¹‰çš„æ‰€æœ‰æ–¹æ³•å‡ä¸ºè¿æ¥ç‚¹ åˆ‡å…¥ç‚¹(Pointcut) è¢«åˆ‡é¢æ‹¦æˆª / å¢å¼ºçš„è¿æ¥ç‚¹ï¼ˆåˆ‡å…¥ç‚¹ä¸€å®šæ˜¯è¿æ¥ç‚¹ï¼Œè¿æ¥ç‚¹ä¸ä¸€å®šæ˜¯åˆ‡å…¥ç‚¹ï¼‰ é€šçŸ¥(Advice) å¢å¼ºçš„é€»è¾‘ / ä»£ç ï¼Œä¹Ÿå³æ‹¦æˆªåˆ°ç›®æ ‡å¯¹è±¡çš„è¿æ¥ç‚¹ä¹‹åè¦åšçš„äº‹æƒ… åˆ‡é¢(Aspect) åˆ‡å…¥ç‚¹(Pointcut)+é€šçŸ¥(Advice) Weaving(ç»‡å…¥) å°†é€šçŸ¥åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡ï¼Œè¿›è€Œç”Ÿæˆä»£ç†å¯¹è±¡çš„è¿‡ç¨‹åŠ¨ä½œ Spring AOP å’Œ AspectJ AOP æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ # Spring AOP å±äºè¿è¡Œæ—¶å¢å¼ºï¼Œè€Œ AspectJ æ˜¯ç¼–è¯‘æ—¶å¢å¼ºã€‚ Spring AOP åŸºäºä»£ç†(Proxying)ï¼Œè€Œ AspectJ åŸºäºå­—èŠ‚ç æ“ä½œ(Bytecode Manipulation)ã€‚\nSpring AOP å·²ç»é›†æˆäº† AspectJ ï¼ŒAspectJ åº”è¯¥ç®—çš„ä¸Šæ˜¯ Java ç”Ÿæ€ç³»ç»Ÿä¸­æœ€å®Œæ•´çš„ AOP æ¡†æ¶äº†ã€‚AspectJ ç›¸æ¯”äº Spring AOP åŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼Œä½†æ˜¯ Spring AOP ç›¸å¯¹æ¥è¯´æ›´ç®€å•ï¼Œ\nå¦‚æœæˆ‘ä»¬çš„åˆ‡é¢æ¯”è¾ƒå°‘ï¼Œé‚£ä¹ˆä¸¤è€…æ€§èƒ½å·®å¼‚ä¸å¤§ã€‚ä½†æ˜¯ï¼Œå½“åˆ‡é¢å¤ªå¤šçš„è¯ï¼Œæœ€å¥½é€‰æ‹© AspectJ ï¼Œå®ƒæ¯” Spring AOP å¿«å¾ˆå¤šã€‚\nAspectJ å®šä¹‰çš„é€šçŸ¥ç±»å‹æœ‰å“ªäº›ï¼Ÿ # Beforeï¼ˆå‰ç½®é€šçŸ¥ï¼‰ï¼šç›®æ ‡å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ä¹‹å‰è§¦å‘ After ï¼ˆåç½®é€šçŸ¥ï¼‰ï¼šç›®æ ‡å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ä¹‹åè§¦å‘ AfterReturningï¼ˆè¿”å›é€šçŸ¥ï¼‰ï¼šç›®æ ‡å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨å®Œæˆï¼Œåœ¨è¿”å›ç»“æœå€¼ä¹‹åè§¦å‘ AfterThrowingï¼ˆå¼‚å¸¸é€šçŸ¥ï¼‰ ï¼šç›®æ ‡å¯¹è±¡çš„æ–¹æ³•è¿è¡Œä¸­æŠ›å‡º / è§¦å‘å¼‚å¸¸åè§¦å‘ã€‚AfterReturning å’Œ AfterThrowing ä¸¤è€…äº’æ–¥ã€‚å¦‚æœæ–¹æ³•è°ƒç”¨æˆåŠŸæ— å¼‚å¸¸ï¼Œåˆ™ä¼šæœ‰è¿”å›å€¼ï¼›å¦‚æœæ–¹æ³•æŠ›å‡ºäº†å¼‚å¸¸ï¼Œåˆ™ä¸ä¼šæœ‰è¿”å›å€¼ã€‚ Around ï¼ˆç¯ç»•é€šçŸ¥ï¼‰ï¼šç¼–ç¨‹å¼æ§åˆ¶ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ã€‚ç¯ç»•é€šçŸ¥æ˜¯æ‰€æœ‰é€šçŸ¥ç±»å‹ä¸­å¯æ“ä½œèŒƒå›´æœ€å¤§çš„ä¸€ç§ï¼Œå› ä¸ºå®ƒå¯ä»¥ç›´æ¥æ‹¿åˆ°ç›®æ ‡å¯¹è±¡ï¼Œä»¥åŠè¦æ‰§è¡Œçš„æ–¹æ³•ï¼Œæ‰€ä»¥ç¯ç»•é€šçŸ¥å¯ä»¥ä»»æ„çš„åœ¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨å‰åæäº‹ï¼Œç”šè‡³ä¸è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³• å¤šä¸ªåˆ‡é¢çš„æ‰§è¡Œé¡ºåºå¦‚ä½•æ§åˆ¶ï¼Ÿ # 1ã€é€šå¸¸ä½¿ç”¨**@Order æ³¨è§£**ç›´æ¥å®šä¹‰åˆ‡é¢é¡ºåº\n// å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ @Order(3) @Component @Aspect public class LoggingAspect implements Ordered { 2ã€å®ç°Ordered æ¥å£é‡å†™ getOrder æ–¹æ³•ã€‚\n@Component @Aspect public class LoggingAspect implements Ordered { // .... @Override public int getOrder() { // è¿”å›å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ return 1; } } Spring MVC # è¯´è¯´è‡ªå·±å¯¹äº Spring MVC äº†è§£? # MVC æ˜¯æ¨¡å‹(Model)ã€è§†å›¾(View)ã€æ§åˆ¶å™¨(Controller)çš„ç®€å†™ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å°†ä¸šåŠ¡é€»è¾‘ã€æ•°æ®ã€æ˜¾ç¤ºåˆ†ç¦»æ¥ç»„ç»‡ä»£ç ã€‚\nç½‘ä¸Šæœ‰å¾ˆå¤šäººè¯´ MVC ä¸æ˜¯è®¾è®¡æ¨¡å¼ï¼Œåªæ˜¯è½¯ä»¶è®¾è®¡è§„èŒƒï¼Œæˆ‘ä¸ªäººæ›´å€¾å‘äº MVC åŒæ ·æ˜¯ä¼—å¤šè®¾è®¡æ¨¡å¼ä¸­çš„ä¸€ç§ã€‚java-design-patterns é¡¹ç›®ä¸­å°±æœ‰å…³äº MVC çš„ç›¸å…³ä»‹ç»ã€‚\næƒ³è¦çœŸæ­£ç†è§£ Spring MVCï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ Model 1 å’Œ Model 2 è¿™ä¸¤ä¸ªæ²¡æœ‰ Spring MVC çš„æ—¶ä»£ã€‚\nModel 1 æ—¶ä»£\nå¾ˆå¤šå­¦ Java åç«¯æ¯”è¾ƒæ™šçš„æœ‹å‹å¯èƒ½å¹¶æ²¡æœ‰æ¥è§¦è¿‡ Model 1 æ—¶ä»£ä¸‹çš„ JavaWeb åº”ç”¨å¼€å‘ã€‚åœ¨ Model1 æ¨¡å¼ä¸‹ï¼Œæ•´ä¸ª Web åº”ç”¨å‡ ä¹å…¨éƒ¨ç”¨ JSP é¡µé¢ç»„æˆï¼Œåªç”¨å°‘é‡çš„ JavaBean æ¥å¤„ç†æ•°æ®åº“è¿æ¥ã€è®¿é—®ç­‰æ“ä½œã€‚\nè¿™ä¸ªæ¨¡å¼ä¸‹ JSP å³æ˜¯æ§åˆ¶å±‚ï¼ˆControllerï¼‰åˆæ˜¯è¡¨ç°å±‚ï¼ˆViewï¼‰ã€‚æ˜¾è€Œæ˜“è§ï¼Œè¿™ç§æ¨¡å¼å­˜åœ¨å¾ˆå¤šé—®é¢˜ã€‚æ¯”å¦‚æ§åˆ¶é€»è¾‘å’Œè¡¨ç°é€»è¾‘æ··æ‚åœ¨ä¸€èµ·ï¼Œå¯¼è‡´ä»£ç é‡ç”¨ç‡æä½ï¼›å†æ¯”å¦‚å‰ç«¯å’Œåç«¯ç›¸äº’ä¾èµ–ï¼Œéš¾ä»¥è¿›è¡Œæµ‹è¯•ç»´æŠ¤å¹¶ä¸”å¼€å‘æ•ˆç‡æä½ã€‚\nModel 2 æ—¶ä»£\nå­¦è¿‡ Servlet å¹¶åšè¿‡ç›¸å…³ Demo çš„æœ‹å‹åº”è¯¥äº†è§£â€œJava Bean(Model)+ JSPï¼ˆViewï¼‰+Servletï¼ˆControllerï¼‰ â€è¿™ç§å¼€å‘æ¨¡å¼ï¼Œè¿™å°±æ˜¯æ—©æœŸçš„ JavaWeb MVC å¼€å‘æ¨¡å¼ã€‚\nModel:ç³»ç»Ÿæ¶‰åŠçš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ dao å’Œ beanã€‚ Viewï¼šå±•ç¤ºæ¨¡å‹ä¸­çš„æ•°æ®ï¼Œåªæ˜¯ç”¨æ¥å±•ç¤ºã€‚ Controllerï¼šå¤„ç†ç”¨æˆ·è¯·æ±‚éƒ½å‘é€ç»™ Servletï¼Œè¿”å›æ•°æ®ç»™ JSP å¹¶å±•ç¤ºç»™ç”¨æˆ·ã€‚ Model2 æ¨¡å¼ä¸‹è¿˜å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼ŒModel2 çš„æŠ½è±¡å’Œå°è£…ç¨‹åº¦è¿˜è¿œè¿œä¸å¤Ÿï¼Œä½¿ç”¨ Model2 è¿›è¡Œå¼€å‘æ—¶ä¸å¯é¿å…åœ°ä¼šé‡å¤é€ è½®å­ï¼Œè¿™å°±å¤§å¤§é™ä½äº†ç¨‹åºçš„å¯ç»´æŠ¤æ€§å’Œå¤ç”¨æ€§ã€‚\näºæ˜¯ï¼Œå¾ˆå¤š JavaWeb å¼€å‘ç›¸å…³çš„ MVC æ¡†æ¶åº”è¿è€Œç”Ÿæ¯”å¦‚ Struts2ï¼Œä½†æ˜¯ Struts2 æ¯”è¾ƒç¬¨é‡ã€‚\nSpring MVC æ—¶ä»£\néšç€ Spring è½»é‡çº§å¼€å‘æ¡†æ¶çš„æµè¡Œï¼ŒSpring ç”Ÿæ€åœˆå‡ºç°äº† Spring MVC æ¡†æ¶ï¼Œ Spring MVC æ˜¯å½“å‰æœ€ä¼˜ç§€çš„ MVC æ¡†æ¶ã€‚ç›¸æ¯”äº Struts2 ï¼Œ Spring MVC ä½¿ç”¨æ›´åŠ ç®€å•å’Œæ–¹ä¾¿ï¼Œå¼€å‘æ•ˆç‡æ›´é«˜ï¼Œå¹¶ä¸” Spring MVC è¿è¡Œé€Ÿåº¦æ›´å¿«ã€‚\nMVC æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼ŒSpring MVC æ˜¯ä¸€æ¬¾å¾ˆä¼˜ç§€çš„ MVC æ¡†æ¶ã€‚Spring MVC å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œæ›´ç®€æ´çš„ Web å±‚çš„å¼€å‘ï¼Œå¹¶ä¸”å®ƒå¤©ç”Ÿä¸ Spring æ¡†æ¶é›†æˆã€‚Spring MVC ä¸‹æˆ‘ä»¬ä¸€èˆ¬æŠŠåç«¯é¡¹ç›®åˆ†ä¸º Service å±‚ï¼ˆå¤„ç†ä¸šåŠ¡ï¼‰ã€Dao å±‚ï¼ˆæ•°æ®åº“æ“ä½œï¼‰ã€Entity å±‚ï¼ˆå®ä½“ç±»ï¼‰ã€Controller å±‚(æ§åˆ¶å±‚ï¼Œè¿”å›æ•°æ®ç»™å‰å°é¡µé¢)ã€‚\nSpring MVC çš„æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Ÿ # è®°ä½äº†ä¸‹é¢è¿™äº›ç»„ä»¶ï¼Œä¹Ÿå°±è®°ä½äº† SpringMVC çš„å·¥ä½œåŸç†ã€‚\nDispatcherServlet ï¼šæ ¸å¿ƒçš„ä¸­å¤®å¤„ç†å™¨ï¼Œè´Ÿè´£æ¥æ”¶è¯·æ±‚ã€åˆ†å‘ï¼Œå¹¶ç»™äºˆå®¢æˆ·ç«¯å“åº”ã€‚ HandlerMapping ï¼šå¤„ç†å™¨æ˜ å°„å™¨ï¼Œæ ¹æ® uri å»åŒ¹é…æŸ¥æ‰¾èƒ½å¤„ç†çš„ Handler ï¼Œå¹¶ä¼šå°†è¯·æ±‚æ¶‰åŠåˆ°çš„æ‹¦æˆªå™¨å’Œ Handler ä¸€èµ·å°è£…ã€‚ HandlerAdapter ï¼šå¤„ç†å™¨é€‚é…å™¨ï¼Œæ ¹æ® HandlerMapping æ‰¾åˆ°çš„ Handler ï¼Œé€‚é…æ‰§è¡Œå¯¹åº”çš„ Handlerï¼› Handler ï¼šè¯·æ±‚å¤„ç†å™¨ï¼Œå¤„ç†å®é™…è¯·æ±‚çš„å¤„ç†å™¨ã€‚ ViewResolver ï¼šè§†å›¾è§£æå™¨ï¼Œæ ¹æ® Handler è¿”å›çš„é€»è¾‘è§†å›¾ / è§†å›¾ï¼Œè§£æå¹¶æ¸²æŸ“çœŸæ­£çš„è§†å›¾ï¼Œå¹¶ä¼ é€’ç»™ DispatcherServlet å“åº”å®¢æˆ·ç«¯ SpringMVC å·¥ä½œåŸç†äº†è§£å—? # Spring MVC åŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nSpringMVC å·¥ä½œåŸç†çš„å›¾è§£æˆ‘æ²¡æœ‰è‡ªå·±ç”»ï¼Œç›´æ¥å›¾çœäº‹åœ¨ç½‘ä¸Šæ‰¾äº†ä¸€ä¸ªéå¸¸æ¸…æ™°ç›´è§‚çš„ï¼ŒåŸå‡ºå¤„ä¸æ˜ã€‚\næµç¨‹è¯´æ˜ï¼ˆé‡è¦ï¼‰ï¼š\nå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å‘é€è¯·æ±‚ï¼Œ DispatcherServletæ‹¦æˆªè¯·æ±‚ã€‚ DispatcherServlet æ ¹æ®è¯·æ±‚ä¿¡æ¯è°ƒç”¨ HandlerMapping ã€‚HandlerMapping æ ¹æ® uri å»åŒ¹é…æŸ¥æ‰¾èƒ½å¤„ç†çš„ Handlerï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³å¸¸è¯´çš„ Controller æ§åˆ¶å™¨ï¼‰ ï¼Œå¹¶ä¼šå°†è¯·æ±‚æ¶‰åŠåˆ°çš„æ‹¦æˆªå™¨å’Œ Handler ä¸€èµ·å°è£…ã€‚ DispatcherServlet è°ƒç”¨ **HandlerAdapter**é€‚é…æ‰§è¡Œ Handler ã€‚ Handler å®Œæˆå¯¹ç”¨æˆ·è¯·æ±‚çš„å¤„ç†åï¼Œä¼šè¿”å›ä¸€ä¸ª ModelAndView å¯¹è±¡ç»™DispatcherServletï¼ŒModelAndView é¡¾åæ€ä¹‰ï¼ŒåŒ…å«äº†æ•°æ®æ¨¡å‹ä»¥åŠç›¸åº”çš„è§†å›¾çš„ä¿¡æ¯ã€‚Model æ˜¯è¿”å›çš„æ•°æ®å¯¹è±¡ï¼ŒView æ˜¯ä¸ªé€»è¾‘ä¸Šçš„ Viewã€‚ ViewResolver ä¼šæ ¹æ®é€»è¾‘ View æŸ¥æ‰¾å®é™…çš„ Viewã€‚ DispaterServlet æŠŠè¿”å›çš„ Model ä¼ ç»™ Viewï¼ˆè§†å›¾æ¸²æŸ“ï¼‰ã€‚ æŠŠ View è¿”å›ç»™è¯·æ±‚è€…ï¼ˆæµè§ˆå™¨ï¼‰\nç»Ÿä¸€å¼‚å¸¸å¤„ç†æ€ä¹ˆåšï¼Ÿ # æ¨èä½¿ç”¨æ³¨è§£çš„æ–¹å¼ç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼Œå…·ä½“ä¼šä½¿ç”¨åˆ° @ControllerAdvice + @ExceptionHandler è¿™ä¸¤ä¸ªæ³¨è§£ ã€‚\n@ControllerAdvice @ResponseBody public class GlobalExceptionHandler { @ExceptionHandler(BaseException.class) public ResponseEntity\u0026lt;?\u0026gt; handleAppException(BaseException ex, HttpServletRequest request) { //...... } @ExceptionHandler(value = ResourceNotFoundException.class) public ResponseEntity\u0026lt;ErrorReponse\u0026gt; handleResourceNotFoundException(ResourceNotFoundException ex, HttpServletRequest request) { //...... } } è¿™ç§å¼‚å¸¸å¤„ç†æ–¹å¼ä¸‹ï¼Œä¼šç»™æ‰€æœ‰æˆ–è€…æŒ‡å®šçš„ Controller ç»‡å…¥å¼‚å¸¸å¤„ç†çš„é€»è¾‘ï¼ˆAOPï¼‰ï¼Œå½“ Controller ä¸­çš„æ–¹æ³•æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™ï¼Œç”±è¢«@ExceptionHandler æ³¨è§£ä¿®é¥°çš„æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚\nExceptionHandlerMethodResolver ä¸­ getMappedMethod æ–¹æ³•å†³å®šäº†å¼‚å¸¸å…·ä½“è¢«å“ªä¸ªè¢« @ExceptionHandler æ³¨è§£ä¿®é¥°çš„æ–¹æ³•å¤„ç†å¼‚å¸¸ã€‚ã€è¿™ä¸ªæ˜¯æ¡†æ¶é‡Œçš„æºç ï¼Œä¸æ˜¯è‡ªå·±å†™çš„ã€‘\n@Nullable private Method getMappedMethod(Class\u0026lt;? extends Throwable\u0026gt; exceptionType) { List\u0026lt;Class\u0026lt;? extends Throwable\u0026gt;\u0026gt; matches = new ArrayList\u0026lt;\u0026gt;(); //æ‰¾åˆ°å¯ä»¥å¤„ç†çš„æ‰€æœ‰å¼‚å¸¸ä¿¡æ¯ã€‚mappedMethods ä¸­å­˜æ”¾äº†å¼‚å¸¸å’Œå¤„ç†å¼‚å¸¸çš„æ–¹æ³•çš„å¯¹åº”å…³ç³» for (Class\u0026lt;? extends Throwable\u0026gt; mappedException : this.mappedMethods.keySet()) { if (mappedException.isAssignableFrom(exceptionType)) { matches.add(mappedException); } } // ä¸ä¸ºç©ºè¯´æ˜æœ‰æ–¹æ³•å¤„ç†å¼‚å¸¸ if (!matches.isEmpty()) { // æŒ‰ç…§åŒ¹é…ç¨‹åº¦ä»å°åˆ°å¤§æ’åº matches.sort(new ExceptionDepthComparator(exceptionType)); // è¿”å›å¤„ç†å¼‚å¸¸çš„æ–¹æ³• return this.mappedMethods.get(matches.get(0)); } else { return null; } } ä»æºä»£ç çœ‹å‡ºï¼š getMappedMethod()ä¼šé¦–å…ˆæ‰¾åˆ°å¯ä»¥åŒ¹é…å¤„ç†å¼‚å¸¸çš„æ‰€æœ‰æ–¹æ³•ä¿¡æ¯ï¼Œç„¶åå¯¹å…¶è¿›è¡Œä»å°åˆ°å¤§çš„æ’åºï¼Œæœ€åå–æœ€å°çš„é‚£ä¸€ä¸ªåŒ¹é…çš„æ–¹æ³•(å³åŒ¹é…åº¦æœ€é«˜çš„é‚£ä¸ª)ã€‚\nSpring æ¡†æ¶ä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ # å…³äºä¸‹é¢è¿™äº›è®¾è®¡æ¨¡å¼çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥çœ‹æˆ‘å†™çš„ Spring ä¸­çš„è®¾è®¡æ¨¡å¼è¯¦è§£ è¿™ç¯‡æ–‡ç« ã€‚\nå·¥å‚è®¾è®¡æ¨¡å¼ : Spring ä½¿ç”¨å·¥å‚æ¨¡å¼é€šè¿‡ BeanFactoryã€ApplicationContext åˆ›å»º bean å¯¹è±¡ã€‚ ä»£ç†è®¾è®¡æ¨¡å¼ : Spring AOP åŠŸèƒ½çš„å®ç°ã€‚ å•ä¾‹è®¾è®¡æ¨¡å¼ : Spring ä¸­çš„ Bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ã€‚ æ¨¡æ¿æ–¹æ³•æ¨¡å¼ : Spring ä¸­ jdbcTemplateã€hibernateTemplate ç­‰ä»¥ Template ç»“å°¾çš„å¯¹æ•°æ®åº“æ“ä½œçš„ç±»ï¼Œå®ƒä»¬å°±ä½¿ç”¨åˆ°äº†æ¨¡æ¿æ¨¡å¼ã€‚ åŒ…è£…å™¨è®¾è®¡æ¨¡å¼ : æˆ‘ä»¬çš„é¡¹ç›®éœ€è¦è¿æ¥å¤šä¸ªæ•°æ®åº“ï¼Œè€Œä¸”ä¸åŒçš„å®¢æˆ·åœ¨æ¯æ¬¡è®¿é—®ä¸­æ ¹æ®éœ€è¦ä¼šå»è®¿é—®ä¸åŒçš„æ•°æ®åº“ã€‚è¿™ç§æ¨¡å¼è®©æˆ‘ä»¬å¯ä»¥æ ¹æ®å®¢æˆ·çš„éœ€æ±‚èƒ½å¤ŸåŠ¨æ€åˆ‡æ¢ä¸åŒçš„æ•°æ®æºã€‚ è§‚å¯Ÿè€…æ¨¡å¼: Spring äº‹ä»¶é©±åŠ¨æ¨¡å‹å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼å¾ˆç»å…¸çš„ä¸€ä¸ªåº”ç”¨ã€‚ é€‚é…å™¨æ¨¡å¼ : Spring AOP çš„å¢å¼ºæˆ–é€šçŸ¥(Advice)ä½¿ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼ã€spring MVC ä¸­ä¹Ÿæ˜¯ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼é€‚é…Controllerã€‚ \u0026hellip;\u0026hellip; Spring äº‹åŠ¡ # å…³äº Spring äº‹åŠ¡çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥çœ‹æˆ‘å†™çš„ Spring äº‹åŠ¡è¯¦è§£ è¿™ç¯‡æ–‡ç« ã€‚\nSpring ç®¡ç†äº‹åŠ¡çš„æ–¹å¼æœ‰å‡ ç§ï¼Ÿ # ç¼–ç¨‹å¼äº‹åŠ¡ ï¼š åœ¨ä»£ç ä¸­ç¡¬ç¼–ç (ä¸æ¨èä½¿ç”¨) : é€šè¿‡ **TransactionTemplate**æˆ–è€… TransactionManager æ‰‹åŠ¨ç®¡ç†äº‹åŠ¡ï¼Œå®é™…åº”ç”¨ä¸­å¾ˆå°‘ä½¿ç”¨ï¼Œä½†æ˜¯å¯¹äºä½ ç†è§£ Spring äº‹åŠ¡ç®¡ç†åŸç†æœ‰å¸®åŠ©ã€‚ å£°æ˜å¼äº‹åŠ¡ ï¼š åœ¨ XML é…ç½®æ–‡ä»¶ä¸­é…ç½®æˆ–è€…ç›´æ¥åŸºäºæ³¨è§£ï¼ˆæ¨èä½¿ç”¨ï¼‰ : å®é™…æ˜¯é€šè¿‡ AOP å®ç°ï¼ˆåŸºäº@**Transactional** çš„å…¨æ³¨è§£æ–¹å¼ä½¿ç”¨æœ€å¤šï¼‰ Springäº‹åŠ¡å¤±æ•ˆçš„å‡ ç§æƒ…å†µï¼ˆéjavaguideï¼‰ # 1.springäº‹åŠ¡å®ç°æ–¹å¼åŠåŸç† # Spring äº‹åŠ¡çš„æœ¬è´¨å…¶å®å°±æ˜¯æ•°æ®åº“å¯¹äº‹åŠ¡çš„æ”¯æŒï¼Œæ²¡æœ‰æ•°æ®åº“çš„äº‹åŠ¡æ”¯æŒï¼Œspring æ˜¯æ— æ³•æä¾›äº‹åŠ¡åŠŸèƒ½çš„ã€‚çœŸæ­£çš„æ•°æ®åº“å±‚çš„äº‹åŠ¡æäº¤å’Œå›æ»šæ˜¯åœ¨binlogæäº¤ä¹‹åè¿›è¡Œæäº¤çš„ é€šè¿‡ redo log æ¥é‡åšï¼Œ undo logæ¥å›æ»šã€‚\nä¸€èˆ¬æˆ‘ä»¬åœ¨ç¨‹åºé‡Œé¢ä½¿ç”¨çš„éƒ½æ˜¯åœ¨æ–¹æ³•ä¸Šé¢åŠ @Transactional æ³¨è§£ï¼Œè¿™ç§å±äºå£°æ˜å¼äº‹åŠ¡ã€‚\nå£°æ˜å¼äº‹åŠ¡æœ¬è´¨æ˜¯é€šè¿‡ AOP åŠŸèƒ½ï¼Œå¯¹æ–¹æ³•å‰åè¿›è¡Œæ‹¦æˆªï¼Œå°†äº‹åŠ¡å¤„ç†çš„åŠŸèƒ½ç¼–ç»‡åˆ°æ‹¦æˆªçš„æ–¹æ³•ä¸­ï¼Œä¹Ÿå°±æ˜¯åœ¨ç›®æ ‡æ–¹æ³•å¼€å§‹ä¹‹å‰åŠ å…¥ä¸€ä¸ªäº‹åŠ¡ï¼Œåœ¨æ‰§è¡Œå®Œç›®æ ‡æ–¹æ³•ä¹‹åæ ¹æ®æ‰§è¡Œæƒ…å†µæäº¤æˆ–è€…å›æ»šäº‹åŠ¡ã€‚\n2.æ•°æ®åº“æœ¬èº«ä¸æ”¯æŒäº‹åŠ¡ # è¿™é‡Œä»¥ MySQL ä¸ºä¾‹ï¼Œå…¶ MyISAM å¼•æ“æ˜¯ä¸æ”¯æŒäº‹åŠ¡æ“ä½œçš„ï¼ŒInnoDB æ‰æ˜¯æ”¯æŒäº‹åŠ¡çš„å¼•æ“ï¼Œä¸€èˆ¬è¦æ”¯æŒäº‹åŠ¡éƒ½ä¼šä½¿ç”¨ InnoDB\n3.å½“å‰ç±»çš„è°ƒç”¨ # @Service public class UserServiceImpl implements UserService { public void update(User user) { updateUser(user); } @Transactional(rollbackFor = Exception.class) public void updateUser(User user) { // update user } } å¤åˆ¶ä»£ç  ä¸Šé¢çš„è¿™ç§æƒ…å†µä¸‹æ˜¯ä¸ä¼šæœ‰äº‹åŠ¡ç®¡ç†æ“ä½œçš„ã€‚\né€šè¿‡çœ‹å£°æ˜å¼äº‹åŠ¡çš„åŸç†å¯çŸ¥ï¼Œspringä½¿ç”¨çš„æ˜¯AOPåˆ‡é¢çš„æ–¹å¼ï¼Œæœ¬è´¨ä¸Šä½¿ç”¨çš„æ˜¯åŠ¨æ€ä»£ç†æ¥è¾¾åˆ°äº‹åŠ¡ç®¡ç†çš„ç›®çš„ï¼Œå½“å‰ç±»è°ƒç”¨çš„æ–¹æ³•ä¸Šé¢åŠ @Transactional è¿™ä¸ªæ˜¯æ²¡æœ‰ä»»ä½•ä½œç”¨çš„ï¼Œå› ä¸ºè°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„æ˜¯this.\nOKï¼Œ æˆ‘ä»¬åœ¨çœ‹ä¸‹é¢çš„ä¸€ç§ä¾‹å­ã€‚\n@Service public class UserServiceImpl implements UserService { @Transactional(rollbackFor = Exception.class) public void update(User user) { updateUser(user); } @Transactional(propagation = Propagation.REQUIRES_NEW) public void updateUser(User user) { // update user } } å¤åˆ¶ä»£ç  è¿™æ¬¡åœ¨ update æ–¹æ³•ä¸ŠåŠ äº† @Transactionalï¼ŒupdateUser åŠ äº† REQUIRES_NEW æ–°å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œé‚£ä¹ˆæ–°å¼€çš„äº‹åŠ¡ç®¡ç”¨ä¹ˆï¼Ÿ\nç­”æ¡ˆæ˜¯ï¼šä¸ç®¡ç”¨ï¼\nå› ä¸ºå®ƒä»¬å‘ç”Ÿäº†è‡ªèº«è°ƒç”¨ï¼Œå°±è°ƒè¯¥ç±»è‡ªå·±çš„æ–¹æ³•ï¼Œè€Œæ²¡æœ‰ç»è¿‡ Spring çš„ä»£ç†ç±»ï¼Œé»˜è®¤åªæœ‰åœ¨å¤–éƒ¨è°ƒç”¨äº‹åŠ¡æ‰ä¼šç”Ÿæ•ˆï¼Œè¿™ä¹Ÿæ˜¯è€ç”Ÿå¸¸è°ˆçš„ç»å…¸é—®é¢˜äº†ã€‚\n4.æ–¹æ³•ä¸æ˜¯publicçš„ # @Service public class UserServiceImpl implements UserService { @Transactional(rollbackFor = Exception.class) private void updateUser(User user) { // update user } } å¤åˆ¶ä»£ç  private æ–¹æ³•æ˜¯ä¸ä¼šè¢«springä»£ç†çš„ï¼Œå› æ­¤æ˜¯ä¸ä¼šæœ‰äº‹åŠ¡äº§ç”Ÿçš„ï¼Œè¿™ç§åšæ³•æ˜¯æ— æ•ˆçš„ã€‚\n5.æ²¡æœ‰è¢«springç®¡ç† # //@Service public class UserServiceImpl implements UserService { @Transactional(rollbackFor = Exception.class) public void updateUser(User user) { // update user } } å¤åˆ¶ä»£ç  æ²¡æœ‰è¢«springç®¡ç†çš„beanï¼Œ springè¿ä»£ç†å¯¹è±¡éƒ½æ— æ³•ç”Ÿæˆï¼Œå½“ç„¶æ— æ•ˆå’¯ã€‚\n6.é…ç½®çš„äº‹åŠ¡ä¼ æ’­æ€§æœ‰é—®é¢˜ # @Service public class UserServiceImpl implements UserService { @Transactional(propagation = Propagation.NOT_SUPPORTED) public void update(User user) { // update user } } å¤åˆ¶ä»£ç  å›é¡¾ä¸€ä¸‹springçš„äº‹åŠ¡ä¼ æ’­è¡Œä¸º\nSpring äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºè¯´çš„æ˜¯ï¼Œå½“å¤šä¸ªäº‹åŠ¡åŒæ—¶å­˜åœ¨çš„æ—¶å€™ï¼Œ Spring å¦‚ä½•å¤„ç†è¿™äº›äº‹åŠ¡çš„è¡Œä¸ºã€‚\nPROPAGATION_REQUIREDï¼šå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œè¯¥è®¾ç½®æ˜¯æœ€å¸¸ç”¨çš„è®¾ç½®ã€‚ PROPAGATION_SUPPORTSï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦‚æœå½“å‰ä¸å­˜åœ¨äº‹åŠ¡ï¼Œå°±ä»¥éäº‹åŠ¡æ‰§è¡Œ PROPAGATION_MANDATORYï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå¦‚æœå½“å‰ä¸å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚ PROPAGATION_REQUIRES_NEWï¼šåˆ›å»ºæ–°äº‹åŠ¡ï¼Œæ— è®ºå½“å‰å­˜ä¸å­˜åœ¨äº‹åŠ¡ï¼Œéƒ½åˆ›å»ºæ–°äº‹åŠ¡ã€‚ PROPAGATION_NOT_SUPPORTEDï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚ PROPAGATION_NEVERï¼š ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ PROPAGATION_NESTEDï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œã€‚å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŒ‰ REQUIRED å±æ€§æ‰§è¡Œ å½“ä¼ æ’­è¡Œä¸ºè®¾ç½®äº†PROPAGATION_NOT_SUPPORTEDï¼ŒPROPAGATION_NEVERï¼ŒPROPAGATION_SUPPORTSè¿™ä¸‰ç§æ—¶ï¼Œå°±æœ‰å¯èƒ½å­˜åœ¨äº‹åŠ¡ä¸ç”Ÿæ•ˆ\n7.å¼‚å¸¸è¢«ä½  \u0026ldquo;æŠ“ä½\u0026quot;äº† # @Service public class UserServiceImpl implements UserService { @Transactional(rollbackFor = Exception.class) public void update(User user) { try{ // update user }catch(Execption e){ log.error(\u0026#34;å¼‚å¸¸\u0026#34;,e) } } } å¤åˆ¶ä»£ç  å¼‚å¸¸è¢«æŠ“äº†ï¼Œè¿™æ ·å­ä»£ç†ç±»å°±æ²¡åŠæ³•çŸ¥é“ä½ åˆ°åº•æœ‰æ²¡æœ‰é”™è¯¯ï¼Œéœ€ä¸éœ€è¦å›æ»šï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¹Ÿæ˜¯æ²¡åŠæ³•å›æ»šçš„å“¦ã€‚\n8.æ¥å£å±‚å£°æ˜å¼äº‹åŠ¡ä½¿ç”¨cglibä»£ç† # æ³¨æ„ï¼Œè¿™æ˜¯ä¸ªå‰åå…³ç³»ï¼Œè¯´çš„æ˜¯ï¼šå¦‚æœåœ¨æ¥å£å±‚ä½¿ç”¨äº†å£°æ˜å¼äº‹åŠ¡ï¼Œç»“æœç”¨çš„æ˜¯cglibä»£ç†ï¼Œé‚£ä¹ˆäº‹åŠ¡å°±ä¸ä¼šç”Ÿæ•ˆ\npublic interface UserService { @Transactional(rollbackFor = Exception.class) public void update(User user) } å¤åˆ¶ä»£ç  @Service public class UserServiceImpl implements UserService { public void update(User user) { // update user } } å¤åˆ¶ä»£ç  é€šè¿‡å…ƒç´ çš„ \u0026ldquo;proxy-target-class\u0026rdquo; å±æ€§å€¼æ¥æ§åˆ¶æ˜¯åŸºäºæ¥å£çš„è¿˜æ˜¯åŸºäºç±»çš„ä»£ç†è¢«åˆ›å»ºã€‚å¦‚æœ \u0026ldquo;proxy-target-class\u0026rdquo; å±å€¼è¢«è®¾ç½®ä¸º \u0026ldquo;true\u0026rdquo;ï¼Œé‚£ä¹ˆåŸºäºç±»çš„ä»£ç†å°†èµ·ä½œç”¨ï¼ˆè¿™æ—¶éœ€è¦CGLIBåº“cglib.jaråœ¨CLASSPATHä¸­ï¼‰ã€‚å¦‚æœ \u0026ldquo;proxy-target-class\u0026rdquo; å±å€¼è¢«è®¾ç½®ä¸º \u0026ldquo;false\u0026rdquo; æˆ–è€…è¿™ä¸ªå±æ€§è¢«çœç•¥ï¼Œé‚£ä¹ˆæ ‡å‡†çš„JDKåŸºäºæ¥å£çš„ä»£ç†å°†èµ·ä½œç”¨\næ³¨è§£@Transactional cglibä¸javaåŠ¨æ€ä»£ç†æœ€å¤§åŒºåˆ«æ˜¯ä»£ç†ç›®æ ‡å¯¹è±¡ä¸ç”¨å®ç°æ¥å£,é‚£ä¹ˆæ³¨è§£è¦æ˜¯å†™åˆ°æ¥å£æ–¹æ³•ä¸Šï¼Œè¦æ˜¯ä½¿ç”¨cglibä»£ç†ï¼Œè¿™æ—¶æ³¨è§£äº‹åŠ¡å°±å¤±æ•ˆäº†ï¼Œä¸ºäº†ä¿æŒå…¼å®¹æ³¨è§£æœ€å¥½éƒ½å†™åˆ°å®ç°ç±»æ–¹æ³•ä¸Šã€‚\n9.rollbackForå¼‚å¸¸æŒ‡å®šé”™è¯¯ # @Service public class UserServiceImpl implements UserService { @Transactional public void update(User user) { // update user } } å¤åˆ¶ä»£ç  ä¸Šé¢è¿™ç§æ²¡æœ‰æŒ‡å®šå›æ»šå¼‚å¸¸ï¼Œè¿™ä¸ªæ—¶å€™é»˜è®¤çš„å›æ»šå¼‚å¸¸æ˜¯RuntimeException ï¼Œå¦‚æœå‡ºç°å…¶ä»–å¼‚å¸¸é‚£ä¹ˆå°±ä¸ä¼šå›æ»šäº‹åŠ¡\nSpring äº‹åŠ¡ä¸­å“ªå‡ ç§äº‹åŠ¡ä¼ æ’­è¡Œä¸º? # äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯ä¸ºäº†è§£å†³ä¸šåŠ¡å±‚æ–¹æ³•ä¹‹é—´äº’ç›¸è°ƒç”¨çš„äº‹åŠ¡é—®é¢˜ã€‚\nå½“äº‹åŠ¡æ–¹æ³•è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•(ä¹Ÿå¯èƒ½éäº‹åŠ¡)è°ƒç”¨æ—¶ï¼Œå¿…é¡»æŒ‡å®šäº‹åŠ¡åº”è¯¥å¦‚ä½•ä¼ æ’­ã€‚ä¾‹å¦‚ï¼šæ–¹æ³•å¯èƒ½ç»§ç»­åœ¨ç°æœ‰äº‹åŠ¡ä¸­è¿è¡Œï¼Œä¹Ÿå¯èƒ½å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¹¶åœ¨è‡ªå·±çš„äº‹åŠ¡ä¸­è¿è¡Œã€‚\næ³¨æ„å‡ ç‚¹ï¼Œä¸‹é¢è¿™ä¸ªå€¼éƒ½æ˜¯å†…æ–¹æ³•ä¸Šçš„æ³¨è§£çš„å€¼ï¼Œä¸”ä¸¤ä¸ªæ–¹æ³•å¿…é¡»å±äºä¸åŒç±»\n@Service public class MyClassServiceImpl extends ServiceImpl\u0026lt;MyClassMapper, MyClass\u0026gt; implements MyClassService { @Autowired private UserService userService; //å¤–æ–¹æ³• @Override public void methodOuter() throws Exception { //æ–°å¢ä¸€æ¡è®°å½• MyClass myClass=new MyClass(); myClass.setName(\u0026#34;class_name\u0026#34;); this.saveOrUpdate(myClass); //è°ƒç”¨å†…æ–¹æ³• userService.methodInner(); //æŠ›å‡ºå¼‚å¸¸ //throw new Exception(\u0026#34;hello\u0026#34;); } } @Service public class UserServiceImpl extends ServiceImpl\u0026lt;UserMapper, User\u0026gt; implements UserService { //å†…æ–¹æ³• @Transactional( rollbackFor = Exception.class ,propagation = Propagation.REQUIRED ) @Override public void methodInner() throws Exception { //æ–°å¢ä¸€æ¡è®°å½• User user = new User(); user.setName(\u0026#34;outer_name\u0026#34;); this.saveOrUpdate(user); //æŠ›å‡ºå¼‚å¸¸ //throw new Exception(\u0026#34;hello\u0026#34;); } } æ­£ç¡®çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºå¯èƒ½çš„å€¼å¦‚ä¸‹:\næ³¨ï¼šå¦‚æœå¤–æ–¹æ³•ä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™å†…å¤–æ–¹æ³•å®Œå…¨ç‹¬ç«‹ï¼Œè‡ªå·±(æ–¹æ³•å†…)æŠ›å¼‚å¸¸ä¸å½±å“å¦ä¸€æ–¹æ³•\n1.TransactionDefinition.PROPAGATION_REQUIRED\nä½¿ç”¨çš„æœ€å¤šçš„ä¸€ä¸ªäº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼Œæˆ‘ä»¬å¹³æ—¶ç»å¸¸ä½¿ç”¨çš„@Transactionalæ³¨è§£é»˜è®¤ä½¿ç”¨å°±æ˜¯è¿™ä¸ªäº‹åŠ¡ä¼ æ’­è¡Œä¸ºã€‚å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚\nå¦‚æœå¤–æ–¹æ³•å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™ä¸è®º å¤–æ–¹æ³•æˆ–å†…æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œéƒ½ä¼šå¯¼è‡´å¤–å†…æ‰€åœ¨äº‹åŠ¡ï¼ˆåŒä¸€ä¸ªï¼‰å›æ»š\n2.TransactionDefinition.PROPAGATION_REQUIRES_NEW\nåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸ç®¡å¤–éƒ¨æ–¹æ³•æ˜¯å¦å¼€å¯äº‹åŠ¡ï¼ŒPropagation.REQUIRES_NEWä¿®é¥°çš„å†…éƒ¨æ–¹æ³•ä¼šæ–°å¼€å¯è‡ªå·±çš„äº‹åŠ¡ï¼Œä¸”å¼€å¯çš„äº‹åŠ¡ç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°ã€‚\nå¦‚æœå¤–æ–¹æ³•å­˜åœ¨äº‹åŠ¡ï¼Œå¦‚æœä»…å†…æ–¹æ³•æŠ›å¼‚å¸¸ï¼Œä¼šå¯¼è‡´å¤–æ–¹æ³•å›æ»šï¼›å¦‚æœä»…å¤–æ–¹æ³•æŠ›å¼‚å¸¸ï¼Œåˆ™ä¸ä¼šå›æ»šå†…æ–¹æ³•\n3.TransactionDefinition.PROPAGATION_NESTED\nå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ä½œä¸ºå½“å‰äº‹åŠ¡çš„åµŒå¥—äº‹åŠ¡æ¥è¿è¡Œï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™è¯¥å–å€¼ç­‰ä»·äºTransactionDefinition.PROPAGATION_REQUIREDã€‚\nå¦‚æœå¤–æ–¹æ³•å­˜åœ¨äº‹åŠ¡ï¼Œï¼ˆæ•ˆæœå’Œ1ä¸€æ ·ï¼‰ï¼Œ ä¸è®º å¤–æ–¹æ³•æˆ–å†…æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œéƒ½ä¼šå¯¼è‡´å¤–å†…æ‰€åœ¨äº‹åŠ¡ï¼ˆå’Œ1å”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œä»–ä»¬æ˜¯ä¸åŒäº‹åŠ¡ï¼‰å›æ»š\n4.TransactionDefinition.PROPAGATION_MANDATORY\nå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ï¼ˆmandatoryï¼šå¼ºåˆ¶æ€§ï¼‰\nè¿™ä¸ªä½¿ç”¨çš„å¾ˆå°‘ã€‚\nå¦‚æœå¤–æ–¹æ³•å­˜åœ¨äº‹åŠ¡ï¼Œï¼ˆæ•ˆæœå’Œ1ä¸€æ ·ï¼‰ï¼Œ ä¸è®º å¤–æ–¹æ³•æˆ–å†…æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œéƒ½ä¼šå¯¼è‡´å¤–å†…æ‰€åœ¨äº‹åŠ¡ï¼ˆå’Œ1å”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œå¦‚æœå¤–æ–¹æ³•ä¸å­˜åœ¨äº‹åŠ¡ï¼Œè°ƒç”¨è¯¥æ–¹æ³•å‰å°±ç›´æ¥æŠ›å¼‚å¸¸ï¼‰å›æ»š\nè‹¥æ˜¯é”™è¯¯çš„é…ç½®ä»¥ä¸‹ 3 ç§äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼Œäº‹åŠ¡å°†ä¸ä¼šå‘ç”Ÿå›æ»šï¼š\nTransactionDefinition.PROPAGATION_SUPPORTS: å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œã€‚ TransactionDefinition.PROPAGATION_NOT_SUPPORTED: ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚ TransactionDefinition.PROPAGATION_NEVER: ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ Spring äº‹åŠ¡ä¸­çš„éš”ç¦»çº§åˆ«æœ‰å“ªå‡ ç§? # //è¿™ä¸ªæ³¨è§£åº”è¯¥æ˜¯ç”¨æ¥ä¿®æ”¹sessionçº§åˆ«çš„éš”ç¦»çº§åˆ«\nå’Œäº‹åŠ¡ä¼ æ’­è¡Œä¸ºè¿™å—ä¸€æ ·ï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼ŒSpring ä¹Ÿç›¸åº”åœ°å®šä¹‰äº†ä¸€ä¸ªæšä¸¾ç±»ï¼šIsolation\npublic enum Isolation { DEFAULT(TransactionDefinition.ISOLATION_DEFAULT), READ_UNCOMMITTED(TransactionDefinition.ISOLATION_READ_UNCOMMITTED), READ_COMMITTED(TransactionDefinition.ISOLATION_READ_COMMITTED), REPEATABLE_READ(TransactionDefinition.ISOLATION_REPEATABLE_READ), SERIALIZABLE(TransactionDefinition.ISOLATION_SERIALIZABLE); private final int value; Isolation(int value) { this.value = value; } public int value() { return this.value; } } ä¸‹é¢æˆ‘ä¾æ¬¡å¯¹æ¯ä¸€ç§äº‹åŠ¡éš”ç¦»çº§åˆ«è¿›è¡Œä»‹ç»ï¼š\nTransactionDefinition.ISOLATION_DEFAULT :ä½¿ç”¨åç«¯æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼ŒMySQL é»˜è®¤é‡‡ç”¨çš„ REPEATABLE_READ éš”ç¦»çº§åˆ« Oracle é»˜è®¤é‡‡ç”¨çš„ READ_COMMITTED éš”ç¦»çº§åˆ«. TransactionDefinition.ISOLATION_READ_UNCOMMITTED :æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œä½¿ç”¨è¿™ä¸ªéš”ç¦»çº§åˆ«å¾ˆå°‘ï¼Œå› ä¸ºå®ƒå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯» TransactionDefinition.ISOLATION_READ_COMMITTED : å…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ TransactionDefinition.ISOLATION_REPEATABLE_READ : å¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œå¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚ TransactionDefinition.ISOLATION_SERIALIZABLE : æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä» ACID çš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»ã€‚ä½†æ˜¯è¿™å°†ä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚é€šå¸¸æƒ…å†µä¸‹ä¹Ÿä¸ä¼šç”¨åˆ°è¯¥çº§åˆ«ã€‚ æ³¨æ„ï¼Œè¿™ä¸ªæ³¨è§£çš„ä½¿ç”¨æ–¹æ³•ï¼Œä¸‹é¢å†™äº†ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«æ¨¡æ‹Ÿä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹æ“ä½œï¼ˆä¾›ä¸åŒçš„controllerä½¿ç”¨ï¼‰\n@Transactional( isolation = Isolation.READ_COMMITTED ) public User isolation1() { //è¯»å–userid=1çš„å€¼ User byId = this.getById(1L); return byId; } @Transactional public User isolation2() throws InterruptedException { //10såä¿®æ”¹ TimeUnit.SECONDS.sleep(10); User user=new User(); user.setId(1L); user.setName(\u0026#34;1è¢«ä¿®æ”¹äº†\u0026#34;); this.saveOrUpdate(user); //10såæäº¤ TimeUnit.SECONDS.sleep(10); return null; } å½“isolation1ä¸ºè¯»å·²æäº¤æ—¶ï¼Œåªè¦isolation2æ–¹æ³•æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼ˆæ²¡æœ‰æäº¤ï¼‰ï¼Œé‚£ä¹ˆisolation1åªä¼šè¯»å–åˆ°æœªä¿®æ”¹çš„å€¼ï¼› å½“isolation1ä¸ºè¯»ä¸ºæäº¤æ—¶ï¼Œå³ä½¿isolation2æ–¹æ³•æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼ˆæ²¡æœ‰æäº¤ï¼‰ï¼Œé‚£ä¹ˆisolation1ä¹Ÿä¼šç«‹é©¬è¯»å–åˆ°æœ€æ–°çš„å€¼ï¼› @Transactional(rollbackFor = Exception.class)æ³¨è§£äº†è§£å—ï¼Ÿ # Exception åˆ†ä¸ºè¿è¡Œæ—¶å¼‚å¸¸ RuntimeException å’Œéè¿è¡Œæ—¶å¼‚å¸¸ã€‚äº‹åŠ¡ç®¡ç†å¯¹äºä¼ä¸šåº”ç”¨æ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ï¼Œå³ä½¿å‡ºç°å¼‚å¸¸æƒ…å†µï¼Œå®ƒä¹Ÿå¯ä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚\nå½“ @Transactional æ³¨è§£ä½œç”¨äºç±»ä¸Šæ—¶ï¼Œè¯¥ç±»çš„æ‰€æœ‰ public æ–¹æ³•å°†éƒ½å…·æœ‰è¯¥ç±»å‹çš„äº‹åŠ¡å±æ€§ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æ–¹æ³•çº§åˆ«ä½¿ç”¨è¯¥æ ‡æ³¨æ¥è¦†ç›–ç±»çº§åˆ«çš„å®šä¹‰ã€‚å¦‚æœç±»æˆ–è€…æ–¹æ³•åŠ äº†è¿™ä¸ªæ³¨è§£ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»é‡Œé¢çš„æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œå°±ä¼šå›æ»šï¼Œæ•°æ®åº“é‡Œé¢çš„æ•°æ®ä¹Ÿä¼šå›æ»šã€‚\nåœ¨ @Transactional æ³¨è§£ä¸­å¦‚æœä¸é…ç½®rollbackForå±æ€§,é‚£ä¹ˆäº‹åŠ¡åªä¼šåœ¨é‡åˆ°**RuntimeExceptionçš„æ—¶å€™æ‰ä¼šå›æ»šï¼ŒåŠ ä¸Š rollbackFor=Exception.class,å¯ä»¥è®©äº‹åŠ¡åœ¨é‡åˆ°éè¿è¡Œæ—¶å¼‚å¸¸æ—¶**ä¹Ÿå›æ»šã€‚\nSpring Data JPA # JPA é‡è¦çš„æ˜¯å®æˆ˜ï¼Œè¿™é‡Œä»…å¯¹å°éƒ¨åˆ†çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“ã€‚\nå¦‚ä½•ä½¿ç”¨ JPA åœ¨æ•°æ®åº“ä¸­éæŒä¹…åŒ–ä¸€ä¸ªå­—æ®µï¼Ÿ # å‡å¦‚æˆ‘ä»¬æœ‰ä¸‹é¢ä¸€ä¸ªç±»ï¼š\n@Entity(name=\u0026#34;USER\u0026#34;) public class User { @Id @GeneratedValue(strategy = GenerationType.AUTO) @Column(name = \u0026#34;ID\u0026#34;) private Long id; @Column(name=\u0026#34;USER_NAME\u0026#34;) private String userName; @Column(name=\u0026#34;PASSWORD\u0026#34;) private String password; private String secrect; } å¦‚æœæˆ‘ä»¬æƒ³è®©secrect è¿™ä¸ªå­—æ®µä¸è¢«æŒä¹…åŒ–ï¼Œä¹Ÿå°±æ˜¯ä¸è¢«æ•°æ®åº“å­˜å‚¨æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸‹é¢å‡ ç§æ–¹æ³•ï¼š\nstatic String transient1; // not persistent because of static final String transient2 = \u0026#34;Satish\u0026#34;; // not persistent because of final transient String transient3; // not persistent because of transient @Transient String transient4; // not persistent because of @Transient ä¸€èˆ¬ä½¿ç”¨åé¢ä¸¤ç§æ–¹å¼æ¯”è¾ƒå¤šï¼Œæˆ‘ä¸ªäººä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¯”è¾ƒå¤šã€‚\nJPA çš„å®¡è®¡åŠŸèƒ½æ˜¯åšä»€ä¹ˆçš„ï¼Ÿæœ‰ä»€ä¹ˆç”¨ï¼Ÿ # å®¡è®¡åŠŸèƒ½ä¸»è¦æ˜¯å¸®åŠ©æˆ‘ä»¬è®°å½•æ•°æ®åº“æ“ä½œçš„å…·ä½“è¡Œä¸ºæ¯”å¦‚æŸæ¡è®°å½•æ˜¯è°åˆ›å»ºçš„ã€ä»€ä¹ˆæ—¶é—´åˆ›å»ºçš„ã€æœ€åä¿®æ”¹äººæ˜¯è°ã€æœ€åä¿®æ”¹æ—¶é—´æ˜¯ä»€ä¹ˆæ—¶å€™ã€‚\n@Data @AllArgsConstructor @NoArgsConstructor @MappedSuperclass @EntityListeners(value = AuditingEntityListener.class) public abstract class AbstractAuditBase { @CreatedDate @Column(updatable = false) @JsonIgnore private Instant createdAt; @LastModifiedDate @JsonIgnore private Instant updatedAt; @CreatedBy @Column(updatable = false) @JsonIgnore private String createdBy; @LastModifiedBy @JsonIgnore private String updatedBy; } @CreatedDate: è¡¨ç¤ºè¯¥å­—æ®µä¸ºåˆ›å»ºæ—¶é—´å­—æ®µï¼Œåœ¨è¿™ä¸ªå®ä½“è¢« insert çš„æ—¶å€™ï¼Œä¼šè®¾ç½®å€¼\n@CreatedBy :è¡¨ç¤ºè¯¥å­—æ®µä¸ºåˆ›å»ºäººï¼Œåœ¨è¿™ä¸ªå®ä½“è¢« insert çš„æ—¶å€™ï¼Œä¼šè®¾ç½®å€¼\n@LastModifiedDateã€@LastModifiedByåŒç†ã€‚\nå®ä½“ä¹‹é—´çš„å…³è”å…³ç³»æ³¨è§£æœ‰å“ªäº›ï¼Ÿ # @OneToOne : ä¸€å¯¹ä¸€ã€‚ @ManyToMany ï¼šå¤šå¯¹å¤šã€‚ @OneToMany : ä¸€å¯¹å¤šã€‚ @ManyToOne ï¼šå¤šå¯¹ä¸€ã€‚ åˆ©ç”¨ @ManyToOne å’Œ @OneToMany ä¹Ÿå¯ä»¥è¡¨è¾¾å¤šå¯¹å¤šçš„å…³è”å…³ç³»ã€‚\nSpring Security # Spring Security é‡è¦çš„æ˜¯å®æˆ˜ï¼Œè¿™é‡Œä»…å¯¹å°éƒ¨åˆ†çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“ã€‚\næœ‰å“ªäº›æ§åˆ¶è¯·æ±‚è®¿é—®æƒé™çš„æ–¹æ³•ï¼Ÿ # permitAll() ï¼šæ— æ¡ä»¶å…è®¸ä»»ä½•å½¢å¼è®¿é—®ï¼Œä¸ç®¡ä½ ç™»å½•è¿˜æ˜¯æ²¡æœ‰ç™»å½•ã€‚ anonymous() ï¼šå…è®¸åŒ¿åè®¿é—®ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ç™»å½•æ‰å¯ä»¥è®¿é—®ã€‚ denyAll() ï¼šæ— æ¡ä»¶å†³ç»ä»»ä½•å½¢å¼çš„è®¿é—®ã€‚ authenticated()ï¼šåªå…è®¸å·²è®¤è¯çš„ç”¨æˆ·è®¿é—®ã€‚ fullyAuthenticated() ï¼šåªå…è®¸å·²ç»ç™»å½•æˆ–è€…é€šè¿‡ remember-me ç™»å½•çš„ç”¨æˆ·è®¿é—®ã€‚ hasRole(String) : åªå…è®¸æŒ‡å®šçš„è§’è‰²è®¿é—®ã€‚ hasAnyRole(String)\t: æŒ‡å®šä¸€ä¸ªæˆ–è€…å¤šä¸ªè§’è‰²ï¼Œæ»¡è¶³å…¶ä¸€çš„ç”¨æˆ·å³å¯è®¿é—®ã€‚ hasAuthority(String) ï¼šåªå…è®¸å…·æœ‰æŒ‡å®šæƒé™çš„ç”¨æˆ·è®¿é—® hasAnyAuthority(String) ï¼šæŒ‡å®šä¸€ä¸ªæˆ–è€…å¤šä¸ªæƒé™ï¼Œæ»¡è¶³å…¶ä¸€çš„ç”¨æˆ·å³å¯è®¿é—®ã€‚ hasIpAddress(String) : åªå…è®¸æŒ‡å®š ip çš„ç”¨æˆ·è®¿é—®ã€‚ hasRole å’Œ hasAuthority æœ‰åŒºåˆ«å—ï¼Ÿ # å¯ä»¥çœ‹çœ‹æ¾å“¥çš„è¿™ç¯‡æ–‡ç« ï¼šSpring Security ä¸­çš„ hasRole å’Œ hasAuthority æœ‰åŒºåˆ«å—ï¼Ÿï¼Œä»‹ç»çš„æ¯”è¾ƒè¯¦ç»†ã€‚\nå¦‚ä½•å¯¹å¯†ç è¿›è¡ŒåŠ å¯†ï¼Ÿ # å¦‚æœæˆ‘ä»¬éœ€è¦ä¿å­˜å¯†ç è¿™ç±»æ•æ„Ÿæ•°æ®åˆ°æ•°æ®åº“çš„è¯ï¼Œéœ€è¦å…ˆåŠ å¯†å†ä¿å­˜ã€‚\nSpring Security æä¾›äº†å¤šç§åŠ å¯†ç®—æ³•çš„å®ç°ï¼Œå¼€ç®±å³ç”¨ï¼Œéå¸¸æ–¹ä¾¿ã€‚è¿™äº›åŠ å¯†ç®—æ³•å®ç°ç±»çš„çˆ¶ç±»æ˜¯ PasswordEncoder ï¼Œå¦‚æœä½ æƒ³è¦è‡ªå·±å®ç°ä¸€ä¸ªåŠ å¯†ç®—æ³•çš„è¯ï¼Œä¹Ÿéœ€è¦ç»§æ‰¿ PasswordEncoderã€‚\nPasswordEncoder æ¥å£ä¸€å…±ä¹Ÿå°± 3 ä¸ªå¿…é¡»å®ç°çš„æ–¹æ³•ã€‚\npublic interface PasswordEncoder { // åŠ å¯†ä¹Ÿå°±æ˜¯å¯¹åŸå§‹å¯†ç è¿›è¡Œç¼–ç  String encode(CharSequence var1); // æ¯”å¯¹åŸå§‹å¯†ç å’Œæ•°æ®åº“ä¸­ä¿å­˜çš„å¯†ç  boolean matches(CharSequence var1, String var2); // åˆ¤æ–­åŠ å¯†å¯†ç æ˜¯å¦éœ€è¦å†æ¬¡è¿›è¡ŒåŠ å¯†ï¼Œé»˜è®¤è¿”å› false default boolean upgradeEncoding(String encodedPassword) { return false; } } å®˜æ–¹æ¨èä½¿ç”¨åŸºäº bcrypt å¼ºå“ˆå¸Œå‡½æ•°çš„åŠ å¯†ç®—æ³•å®ç°ç±»ã€‚\nå¦‚ä½•ä¼˜é›…æ›´æ¢ç³»ç»Ÿä½¿ç”¨çš„åŠ å¯†ç®—æ³•ï¼Ÿ # å¦‚æœæˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œçªç„¶å‘ç°ç°æœ‰çš„åŠ å¯†ç®—æ³•æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œéœ€è¦æ›´æ¢æˆå¦å¤–ä¸€ä¸ªåŠ å¯†ç®—æ³•ï¼Œè¿™ä¸ªæ—¶å€™åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ\næ¨èçš„åšæ³•æ˜¯é€šè¿‡ DelegatingPasswordEncoder å…¼å®¹å¤šç§ä¸åŒçš„å¯†ç åŠ å¯†æ–¹æ¡ˆï¼Œä»¥é€‚åº”ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ã€‚\nä»åå­—ä¹Ÿèƒ½çœ‹å‡ºæ¥ï¼ŒDelegatingPasswordEncoder å…¶å®å°±æ˜¯ä¸€ä¸ªä»£ç†ç±»ï¼Œå¹¶éæ˜¯ä¸€ç§å…¨æ–°çš„åŠ å¯†ç®—æ³•ï¼Œå®ƒåšçš„äº‹æƒ…å°±æ˜¯ä»£ç†ä¸Šé¢æåˆ°çš„åŠ å¯†ç®—æ³•å®ç°ç±»ã€‚åœ¨ Spring Security 5.0ä¹‹åï¼Œé»˜è®¤å°±æ˜¯åŸºäº DelegatingPasswordEncoder è¿›è¡Œå¯†ç åŠ å¯†çš„ã€‚\nå‚è€ƒ # ã€ŠSpring æŠ€æœ¯å†…å¹•ã€‹ ã€Šä»é›¶å¼€å§‹æ·±å…¥å­¦ä¹  Springã€‹ï¼šhttps://juejin.cn/book/6857911863016390663 http://www.cnblogs.com/wmyskxz/p/8820371.html https://www.journaldev.com/2696/spring-interview-questions-and-answers https://www.edureka.co/blog/interview-questions/spring-interview-questions/ https://www.cnblogs.com/clwydjgs/p/9317849.html https://howtodoinjava.com/interview-questions/top-spring-interview-questions-with-answers/ http://www.tomaszezula.com/2014/02/09/spring-series-part-5-component-vs-bean/ https://stackoverflow.com/questions/34172888/difference-between-bean-and-autowired "},{"id":101,"href":"/zh/docs/study/Review/java_guide/lyaly_dev_tools/git/","title":"git","section":"å¼€å‘å·¥å…·","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nç‰ˆæœ¬æ§åˆ¶ # ä»€ä¹ˆæ˜¯ç‰ˆæœ¬æ§åˆ¶ # ç‰ˆæœ¬æ§åˆ¶æ˜¯ä¸€ç§è®°å½•ä¸€ä¸ªæˆ–è‹¥å¹²æ–‡ä»¶å†…å®¹å˜åŒ–ï¼Œä»¥ä¾¿å°†æ¥æŸ¥é˜…ç‰¹å®šç‰ˆæœ¬ä¿®è®¢æƒ…å†µçš„ç³»ç»Ÿã€‚ é™¤äº†é¡¹ç›®æºä»£ç ï¼Œä½ è¿˜å¯ä»¥å¯¹ä»»ä½•ç±»å‹çš„æ–‡ä»¶è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚\nä¸ºä»€ä¹ˆè¦ç‰ˆæœ¬æ§åˆ¶ # æœ‰äº†å®ƒä½ å°±å¯ä»¥å°†æŸä¸ªæ–‡ä»¶å›æº¯åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼Œç”šè‡³å°†æ•´ä¸ªé¡¹ç›®éƒ½å›é€€åˆ°è¿‡å»æŸä¸ªæ—¶é—´ç‚¹çš„çŠ¶æ€ï¼Œä½ å¯ä»¥æ¯”è¾ƒæ–‡ä»¶çš„å˜åŒ–ç»†èŠ‚ï¼ŒæŸ¥å‡ºæœ€åæ˜¯è°ä¿®æ”¹äº†å“ªä¸ªåœ°æ–¹ï¼Œä»è€Œæ‰¾å‡ºå¯¼è‡´æ€ªå¼‚é—®é¢˜å‡ºç°çš„åŸå› ï¼Œåˆæ˜¯è°åœ¨ä½•æ—¶æŠ¥å‘Šäº†æŸä¸ªåŠŸèƒ½ç¼ºé™·ç­‰ç­‰ã€‚\næœ¬åœ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ # è®¸å¤šäººä¹ æƒ¯ç”¨å¤åˆ¶æ•´ä¸ªé¡¹ç›®ç›®å½•çš„æ–¹å¼æ¥ä¿å­˜ä¸åŒçš„ç‰ˆæœ¬ï¼Œæˆ–è®¸è¿˜ä¼šæ”¹ååŠ ä¸Šå¤‡ä»½æ—¶é—´ä»¥ç¤ºåŒºåˆ«ã€‚ è¿™ä¹ˆåšå”¯ä¸€çš„å¥½å¤„å°±æ˜¯ç®€å•ï¼Œä½†æ˜¯ç‰¹åˆ«å®¹æ˜“çŠ¯é”™ã€‚ æœ‰æ—¶å€™ä¼šæ··æ·†æ‰€åœ¨çš„å·¥ä½œç›®å½•ï¼Œä¸€ä¸å°å¿ƒä¼šå†™é”™æ–‡ä»¶æˆ–è€…è¦†ç›–æ„æƒ³å¤–çš„æ–‡ä»¶ã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œäººä»¬å¾ˆä¹…ä»¥å‰å°±å¼€å‘äº†è®¸å¤šç§æœ¬åœ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå¤§å¤šéƒ½æ˜¯é‡‡ç”¨æŸç§ç®€å•çš„æ•°æ®åº“æ¥è®°å½•æ–‡ä»¶çš„å†æ¬¡æ›´æ–°å·®å¼‚ã€‚\né›†ä¸­åŒ–çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ # æ¥ä¸‹æ¥äººä»¬åˆé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•è®©åœ¨ä¸åŒç³»ç»Ÿä¸Šçš„å¼€å‘è€…ååŒå·¥ä½œï¼Ÿ äºæ˜¯ï¼Œé›†ä¸­åŒ–çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆCentralized Version Control Systemsï¼Œç®€ç§° CVCSï¼‰åº”è¿è€Œç”Ÿã€‚\né›†ä¸­åŒ–çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿéƒ½æœ‰ä¸€ä¸ªå•ä¸€çš„é›†ä¸­ç®¡ç†çš„æœåŠ¡å™¨ï¼Œä¿å­˜æ‰€æœ‰æ–‡ä»¶çš„ä¿®è®¢ç‰ˆæœ¬ï¼Œè€ŒååŒå·¥ä½œçš„äººä»¬éƒ½é€šè¿‡å®¢æˆ·ç«¯è¿åˆ°è¿™å°æœåŠ¡å™¨ï¼Œå–å‡ºæœ€æ–°çš„æ–‡ä»¶æˆ–è€…æäº¤æ›´æ–°ã€‚\nè¿™ä¹ˆåšè™½ç„¶è§£å†³äº†æœ¬åœ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ— æ³•è®©åœ¨ä¸åŒç³»ç»Ÿä¸Šçš„å¼€å‘è€…ååŒå·¥ä½œçš„è¯Ÿç—…ï¼Œä½†ä¹Ÿè¿˜æ˜¯å­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š\nå•ç‚¹æ•…éšœï¼š ä¸­å¤®æœåŠ¡å™¨å®•æœºï¼Œåˆ™å…¶ä»–äººæ— æ³•ä½¿ç”¨ï¼›å¦‚æœä¸­å¿ƒæ•°æ®åº“ç£ç›˜æŸååˆæ²¡æœ‰è¿›è¡Œå¤‡ä»½ï¼Œä½ å°†ä¸¢å¤±æ‰€æœ‰æ•°æ®ã€‚æœ¬åœ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¹Ÿå­˜åœ¨ç±»ä¼¼é—®é¢˜ï¼Œåªè¦æ•´ä¸ªé¡¹ç›®çš„å†å²è®°å½•è¢«ä¿å­˜åœ¨å•ä¸€ä½ç½®ï¼Œå°±æœ‰ä¸¢å¤±æ‰€æœ‰å†å²æ›´æ–°è®°å½•çš„é£é™©ã€‚ å¿…é¡»è”ç½‘æ‰èƒ½å·¥ä½œï¼š å—ç½‘ç»œçŠ¶å†µã€å¸¦å®½å½±å“ã€‚ åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ # äºæ˜¯åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆDistributed Version Control Systemï¼Œç®€ç§° DVCSï¼‰é¢ä¸–äº†ã€‚ Git å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚\nè¿™ç±»ç³»ç»Ÿï¼Œå®¢æˆ·ç«¯å¹¶ä¸åªæå–æœ€æ–°ç‰ˆæœ¬çš„æ–‡ä»¶å¿«ç…§ï¼Œè€Œæ˜¯æŠŠä»£ç ä»“åº“å®Œæ•´åœ°é•œåƒä¸‹æ¥ã€‚ è¿™ä¹ˆä¸€æ¥ï¼Œä»»ä½•ä¸€å¤„ååŒå·¥ä½œç”¨çš„æœåŠ¡å™¨å‘ç”Ÿæ•…éšœï¼Œäº‹åéƒ½å¯ä»¥ç”¨ä»»ä½•ä¸€ä¸ªé•œåƒå‡ºæ¥çš„æœ¬åœ°ä»“åº“æ¢å¤ã€‚ å› ä¸ºæ¯ä¸€æ¬¡çš„å…‹éš†æ“ä½œï¼Œå®é™…ä¸Šéƒ½æ˜¯ä¸€æ¬¡å¯¹ä»£ç ä»“åº“çš„å®Œæ•´å¤‡ä»½ã€‚\nåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿå¯ä»¥ä¸ç”¨è”ç½‘å°±å¯ä»¥å·¥ä½œï¼Œå› ä¸ºæ¯ä¸ªäººçš„ç”µè„‘ä¸Šéƒ½æ˜¯å®Œæ•´çš„ç‰ˆæœ¬åº“ï¼Œå½“ä½ ä¿®æ”¹äº†æŸä¸ªæ–‡ä»¶åï¼Œä½ åªéœ€è¦å°†è‡ªå·±çš„ä¿®æ”¹æ¨é€ç»™åˆ«äººå°±å¯ä»¥äº†ã€‚ä½†æ˜¯ï¼Œåœ¨å®é™…ä½¿ç”¨åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„æ—¶å€™ï¼Œå¾ˆå°‘ä¼šç›´æ¥è¿›è¡Œæ¨é€ä¿®æ”¹ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€å°å……å½“â€œä¸­å¤®æœåŠ¡å™¨â€çš„ä¸œè¥¿ã€‚è¿™ä¸ªæœåŠ¡å™¨çš„ä½œç”¨ä»…ä»…æ˜¯ç”¨æ¥æ–¹ä¾¿â€œäº¤æ¢â€å¤§å®¶çš„ä¿®æ”¹ï¼Œæ²¡æœ‰å®ƒå¤§å®¶ä¹Ÿä¸€æ ·å¹²æ´»ï¼Œåªæ˜¯äº¤æ¢ä¿®æ”¹ä¸æ–¹ä¾¿è€Œå·²ã€‚\nåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„ä¼˜åŠ¿ä¸å•æ˜¯ä¸å¿…è”ç½‘è¿™ä¹ˆç®€å•ï¼Œåé¢æˆ‘ä»¬è¿˜ä¼šçœ‹åˆ° Git æå…¶å¼ºå¤§çš„åˆ†æ”¯ç®¡ç†ç­‰åŠŸèƒ½ã€‚\nè®¤è¯† Git # Git ç®€å² # Linux å†…æ ¸é¡¹ç›®ç»„å½“æ—¶ä½¿ç”¨åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ BitKeeper æ¥ç®¡ç†å’Œç»´æŠ¤ä»£ç ã€‚ä½†æ˜¯ï¼Œåæ¥å¼€å‘ BitKeeper çš„å•†ä¸šå…¬å¸åŒ Linux å†…æ ¸å¼€æºç¤¾åŒºçš„åˆä½œå…³ç³»ç»“æŸï¼Œä»–ä»¬æ”¶å›äº† Linux å†…æ ¸ç¤¾åŒºå…è´¹ä½¿ç”¨ BitKeeper çš„æƒåŠ›ã€‚ Linux å¼€æºç¤¾åŒºï¼ˆç‰¹åˆ«æ˜¯ Linux çš„ç¼”é€ è€… Linus Torvaldsï¼‰åŸºäºä½¿ç”¨ BitKeeper æ—¶çš„ç»éªŒæ•™è®­ï¼Œå¼€å‘å‡ºè‡ªå·±çš„ç‰ˆæœ¬ç³»ç»Ÿï¼Œè€Œä¸”å¯¹æ–°çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿåšäº†å¾ˆå¤šæ”¹è¿›ã€‚\nGit ä¸å…¶ä»–ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿçš„ä¸»è¦åŒºåˆ« # Git åœ¨ä¿å­˜å’Œå¯¹å¾…å„ç§ä¿¡æ¯çš„æ—¶å€™ä¸å…¶å®ƒç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæœ‰å¾ˆå¤§å·®å¼‚ï¼Œå°½ç®¡æ“ä½œèµ·æ¥çš„å‘½ä»¤å½¢å¼éå¸¸ç›¸è¿‘ï¼Œç†è§£è¿™äº›å·®å¼‚å°†æœ‰åŠ©äºé˜²æ­¢ä½ ä½¿ç”¨ä¸­çš„å›°æƒ‘ã€‚\nä¸‹é¢æˆ‘ä»¬ä¸»è¦è¯´ä¸€ä¸ªå…³äº Git ä¸å…¶ä»–ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿçš„ä¸»è¦å·®åˆ«ï¼šå¯¹å¾…æ•°æ®çš„æ–¹å¼ã€‚\nGité‡‡ç”¨çš„æ˜¯ç›´æ¥è®°å½•å¿«ç…§çš„æ–¹å¼ï¼Œè€Œéå·®å¼‚æ¯”è¾ƒã€‚æˆ‘åé¢ä¼šè¯¦ç»†ä»‹ç»è¿™ä¸¤ç§æ–¹å¼çš„å·®åˆ«ã€‚\nå¤§éƒ¨åˆ†ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆCVSã€Subversionã€Perforceã€Bazaar ç­‰ç­‰ï¼‰éƒ½æ˜¯ä»¥æ–‡ä»¶å˜æ›´åˆ—è¡¨çš„æ–¹å¼å­˜å‚¨ä¿¡æ¯ï¼Œè¿™ç±»ç³»ç»Ÿå°†å®ƒä»¬ä¿å­˜çš„ä¿¡æ¯çœ‹ä½œæ˜¯ä¸€ç»„åŸºæœ¬æ–‡ä»¶å’Œæ¯ä¸ªæ–‡ä»¶éšæ—¶é—´é€æ­¥ç´¯ç§¯çš„å·®å¼‚ã€‚\nå…·ä½“åŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç†è§£èµ·æ¥å…¶å®å¾ˆç®€å•ï¼Œæ¯å½“æˆ‘ä»¬æäº¤æ›´æ–°ä¸€ä¸ªæ–‡ä»¶ä¹‹åï¼Œç³»ç»Ÿéƒ½ä¼šè®°å½•è¿™ä¸ªæ–‡ä»¶åšäº†å“ªäº›æ›´æ–°ï¼Œä»¥å¢é‡ç¬¦å·Î”(Delta)è¡¨ç¤ºã€‚\næˆ‘ä»¬æ€æ ·æ‰èƒ½å¾—åˆ°ä¸€ä¸ªæ–‡ä»¶çš„æœ€ç»ˆç‰ˆæœ¬å‘¢ï¼Ÿ\nå¾ˆç®€å•ï¼Œé«˜ä¸­æ•°å­¦çš„åŸºæœ¬çŸ¥è¯†ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¿™äº›åŸæ–‡ä»¶å’Œè¿™äº›å¢åŠ è¿›è¡Œç›¸åŠ å°±è¡Œäº†ã€‚\nè¿™ç§æ–¹å¼æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ\næ¯”å¦‚æˆ‘ä»¬çš„å¢é‡ç‰¹åˆ«ç‰¹åˆ«å¤šçš„è¯ï¼Œå¦‚æœæˆ‘ä»¬è¦å¾—åˆ°æœ€ç»ˆçš„æ–‡ä»¶æ˜¯ä¸æ˜¯ä¼šè€—è´¹æ—¶é—´å’Œæ€§èƒ½ã€‚\nGit ä¸æŒ‰ç…§ä»¥ä¸Šæ–¹å¼å¯¹å¾…æˆ–ä¿å­˜æ•°æ®ã€‚ åä¹‹ï¼ŒGit æ›´åƒæ˜¯æŠŠæ•°æ®çœ‹ä½œæ˜¯å¯¹å°å‹æ–‡ä»¶ç³»ç»Ÿçš„ä¸€ç»„å¿«ç…§ã€‚ æ¯æ¬¡ä½ æäº¤æ›´æ–°ï¼Œæˆ–åœ¨ Git ä¸­ä¿å­˜é¡¹ç›®çŠ¶æ€æ—¶ï¼Œå®ƒä¸»è¦å¯¹å½“æ—¶çš„å…¨éƒ¨æ–‡ä»¶åˆ¶ä½œä¸€ä¸ªå¿«ç…§å¹¶ä¿å­˜è¿™ä¸ªå¿«ç…§çš„ç´¢å¼•ã€‚ ä¸ºäº†é«˜æ•ˆï¼Œå¦‚æœæ–‡ä»¶æ²¡æœ‰ä¿®æ”¹ï¼ŒGit ä¸å†é‡æ–°å­˜å‚¨è¯¥æ–‡ä»¶ï¼Œè€Œæ˜¯åªä¿ç•™ä¸€ä¸ªé“¾æ¥æŒ‡å‘ä¹‹å‰å­˜å‚¨çš„æ–‡ä»¶ã€‚ Git å¯¹å¾…æ•°æ®æ›´åƒæ˜¯ä¸€ä¸ª å¿«ç…§æµã€‚\nGit çš„ä¸‰ç§çŠ¶æ€ # Git æœ‰ä¸‰ç§çŠ¶æ€ï¼Œä½ çš„æ–‡ä»¶å¯èƒ½å¤„äºå…¶ä¸­ä¹‹ä¸€ï¼š\nå·²æäº¤ï¼ˆcommittedï¼‰ï¼šæ•°æ®å·²ç»å®‰å…¨çš„ä¿å­˜åœ¨æœ¬åœ°æ•°æ®åº“ä¸­ã€‚ å·²ä¿®æ”¹ï¼ˆmodifiedï¼‰ï¼šå·²ä¿®æ”¹è¡¨ç¤ºä¿®æ”¹äº†æ–‡ä»¶ï¼Œä½†è¿˜æ²¡ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚ å·²æš‚å­˜ï¼ˆstagedï¼‰ï¼šè¡¨ç¤ºå¯¹ä¸€ä¸ªå·²ä¿®æ”¹æ–‡ä»¶çš„å½“å‰ç‰ˆæœ¬åšäº†æ ‡è®°ï¼Œä½¿ä¹‹åŒ…å«åœ¨ä¸‹æ¬¡æäº¤çš„å¿«ç…§ä¸­ã€‚ ç”±æ­¤å¼•å…¥ Git é¡¹ç›®çš„ä¸‰ä¸ªå·¥ä½œåŒºåŸŸçš„æ¦‚å¿µï¼šGit ä»“åº“(.git directory)ã€å·¥ä½œç›®å½•(Working Directory) ä»¥åŠ æš‚å­˜åŒºåŸŸ(Staging Area) ã€‚\nåŸºæœ¬çš„ Git å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š\nåœ¨å·¥ä½œç›®å½•ä¸­ä¿®æ”¹æ–‡ä»¶ã€‚ æš‚å­˜æ–‡ä»¶ï¼Œå°†æ–‡ä»¶çš„å¿«ç…§æ”¾å…¥æš‚å­˜åŒºåŸŸã€‚ æäº¤æ›´æ–°ï¼Œæ‰¾åˆ°æš‚å­˜åŒºåŸŸçš„æ–‡ä»¶ï¼Œå°†å¿«ç…§æ°¸ä¹…æ€§å­˜å‚¨åˆ° Git ä»“åº“ç›®å½•ã€‚ Git ä½¿ç”¨å¿«é€Ÿå…¥é—¨ # è·å– Git ä»“åº“ # æœ‰ä¸¤ç§å–å¾— Git é¡¹ç›®ä»“åº“çš„æ–¹æ³•ã€‚\nåœ¨ç°æœ‰ç›®å½•ä¸­åˆå§‹åŒ–ä»“åº“: è¿›å…¥é¡¹ç›®ç›®å½•è¿è¡Œ git init å‘½ä»¤,è¯¥å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªåä¸º .git çš„å­ç›®å½•ã€‚ ä»ä¸€ä¸ªæœåŠ¡å™¨å…‹éš†ä¸€ä¸ªç°æœ‰çš„ Git ä»“åº“: git clone [url] è‡ªå®šä¹‰æœ¬åœ°ä»“åº“çš„åå­—: git clone [url] directoryname è®°å½•æ¯æ¬¡æ›´æ–°åˆ°ä»“åº“ # æ£€æµ‹å½“å‰æ–‡ä»¶çŠ¶æ€ : git status æå‡ºæ›´æ”¹ï¼ˆæŠŠå®ƒä»¬æ·»åŠ åˆ°æš‚å­˜åŒºï¼‰ï¼šgit add filename (é’ˆå¯¹ç‰¹å®šæ–‡ä»¶)ã€git add *(æ‰€æœ‰æ–‡ä»¶)ã€git add *.txtï¼ˆæ”¯æŒé€šé…ç¬¦ï¼Œæ‰€æœ‰ .txt æ–‡ä»¶ï¼‰ å¿½ç•¥æ–‡ä»¶ï¼š.gitignore æ–‡ä»¶ æäº¤æ›´æ–°: git commit -m \u0026quot;ä»£ç æäº¤ä¿¡æ¯\u0026quot; ï¼ˆæ¯æ¬¡å‡†å¤‡æäº¤å‰ï¼Œå…ˆç”¨ git status çœ‹ä¸‹ï¼Œæ˜¯ä¸æ˜¯éƒ½å·²æš‚å­˜èµ·æ¥äº†ï¼Œ ç„¶åå†è¿è¡Œæäº¤å‘½ä»¤ git commitï¼‰ è·³è¿‡ä½¿ç”¨æš‚å­˜åŒºåŸŸæ›´æ–°çš„æ–¹å¼ : git commit -a -m \u0026quot;ä»£ç æäº¤ä¿¡æ¯\u0026quot;ã€‚ git commit åŠ ä¸Š -a é€‰é¡¹ï¼ŒGit å°±ä¼šè‡ªåŠ¨æŠŠæ‰€æœ‰å·²ç»è·Ÿè¸ªè¿‡çš„æ–‡ä»¶æš‚å­˜èµ·æ¥ä¸€å¹¶æäº¤ï¼Œä»è€Œè·³è¿‡ git add æ­¥éª¤ã€‚ ç§»é™¤æ–‡ä»¶ ï¼šgit rm filename ï¼ˆä»æš‚å­˜åŒºåŸŸç§»é™¤ï¼Œç„¶åæäº¤ã€‚ï¼‰ å¯¹æ–‡ä»¶é‡å‘½å ï¼šgit mv README.md README(è¿™ä¸ªå‘½ä»¤ç›¸å½“äºmv README.md READMEã€git rm README.mdã€git add README è¿™ä¸‰æ¡å‘½ä»¤çš„é›†åˆ) ä¸€ä¸ªå¥½çš„ Git æäº¤æ¶ˆæ¯ # ä¸€ä¸ªå¥½çš„ Git æäº¤æ¶ˆæ¯å¦‚ä¸‹ï¼š\næ ‡é¢˜è¡Œï¼šç”¨è¿™ä¸€è¡Œæ¥æè¿°å’Œè§£é‡Šä½ çš„è¿™æ¬¡æäº¤ ä¸»ä½“éƒ¨åˆ†å¯ä»¥æ˜¯å¾ˆå°‘çš„å‡ è¡Œï¼Œæ¥åŠ å…¥æ›´å¤šçš„ç»†èŠ‚æ¥è§£é‡Šæäº¤ï¼Œæœ€å¥½æ˜¯èƒ½ç»™å‡ºä¸€äº›ç›¸å…³çš„èƒŒæ™¯æˆ–è€…è§£é‡Šè¿™ä¸ªæäº¤èƒ½ä¿®å¤å’Œè§£å†³ä»€ä¹ˆé—®é¢˜ã€‚ ä¸»ä½“éƒ¨åˆ†å½“ç„¶ä¹Ÿå¯ä»¥æœ‰å‡ æ®µï¼Œä½†æ˜¯ä¸€å®šè¦æ³¨æ„æ¢è¡Œå’Œå¥å­ä¸è¦å¤ªé•¿ã€‚å› ä¸ºè¿™æ ·åœ¨ä½¿ç”¨ \u0026#34;git log\u0026#34; çš„æ—¶å€™ä¼šæœ‰ç¼©è¿›æ¯”è¾ƒå¥½çœ‹ã€‚ æäº¤çš„æ ‡é¢˜è¡Œæè¿°åº”è¯¥å°½é‡çš„æ¸…æ™°å’Œå°½é‡çš„ä¸€å¥è¯æ¦‚æ‹¬ã€‚è¿™æ ·å°±æ–¹ä¾¿ç›¸å…³çš„ Git æ—¥å¿—æŸ¥çœ‹å·¥å…·æ˜¾ç¤ºå’Œå…¶ä»–äººçš„é˜…è¯»ã€‚\næ¨é€æ”¹åŠ¨åˆ°è¿œç¨‹ä»“åº“ # å¦‚æœä½ è¿˜æ²¡æœ‰å…‹éš†ç°æœ‰ä»“åº“ï¼Œå¹¶æ¬²å°†ä½ çš„ä»“åº“è¿æ¥åˆ°æŸä¸ªè¿œç¨‹æœåŠ¡å™¨ï¼Œä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ·»åŠ ï¼šgit remote add origin \u0026lt;server\u0026gt; ,æ¯”å¦‚æˆ‘ä»¬è¦è®©æœ¬åœ°çš„ä¸€ä¸ªä»“åº“å’Œ Github ä¸Šåˆ›å»ºçš„ä¸€ä¸ªä»“åº“å…³è”å¯ä»¥è¿™æ ·**git remote add origin https://github.com/Snailclimb/test.git**\nå°†è¿™äº›æ”¹åŠ¨æäº¤åˆ°è¿œç«¯ä»“åº“ï¼šgit push origin master (å¯ä»¥æŠŠ master æ¢æˆä½ æƒ³è¦æ¨é€çš„ä»»ä½•åˆ†æ”¯)\nå¦‚æ­¤ä½ å°±èƒ½å¤Ÿå°†ä½ çš„æ”¹åŠ¨æ¨é€åˆ°æ‰€æ·»åŠ çš„æœåŠ¡å™¨ä¸Šå»äº†ã€‚\nè¿œç¨‹ä»“åº“çš„ç§»é™¤ä¸é‡å‘½å # å°† test é‡å‘½åä¸º test1ï¼šgit remote rename test test1 ç§»é™¤è¿œç¨‹ä»“åº“ test1:git remote rm test1 æŸ¥çœ‹æäº¤å†å² # åœ¨æäº¤äº†è‹¥å¹²æ›´æ–°ï¼Œåˆæˆ–è€…å…‹éš†äº†æŸä¸ªé¡¹ç›®ä¹‹åï¼Œä½ ä¹Ÿè®¸æƒ³å›é¡¾ä¸‹æäº¤å†å²ã€‚ å®Œæˆè¿™ä¸ªä»»åŠ¡æœ€ç®€å•è€Œåˆæœ‰æ•ˆçš„å·¥å…·æ˜¯ git log å‘½ä»¤ã€‚git log ä¼šæŒ‰æäº¤æ—¶é—´åˆ—å‡ºæ‰€æœ‰çš„æ›´æ–°ï¼Œæœ€è¿‘çš„æ›´æ–°æ’åœ¨æœ€ä¸Šé¢ã€‚\nå¯ä»¥æ·»åŠ ä¸€äº›å‚æ•°æ¥æŸ¥çœ‹è‡ªå·±å¸Œæœ›çœ‹åˆ°çš„å†…å®¹ï¼š\nåªçœ‹æŸä¸ªäººçš„æäº¤è®°å½•ï¼š\ngit log --author=bob æ’¤é”€æ“ä½œ # æœ‰æ—¶å€™æˆ‘ä»¬æäº¤å®Œäº†æ‰å‘ç°æ¼æ‰äº†å‡ ä¸ªæ–‡ä»¶æ²¡æœ‰æ·»åŠ ï¼Œæˆ–è€…æäº¤ä¿¡æ¯å†™é”™äº†ã€‚ æ­¤æ—¶ï¼Œå¯ä»¥è¿è¡Œå¸¦æœ‰ --amend é€‰é¡¹çš„æäº¤å‘½ä»¤å°è¯•é‡æ–°æäº¤ï¼š\ngit commit --amend å–æ¶ˆæš‚å­˜çš„æ–‡ä»¶\ngit reset filename æ’¤æ¶ˆå¯¹æ–‡ä»¶çš„ä¿®æ”¹:\ngit checkout -- filename å‡å¦‚ä½ æƒ³ä¸¢å¼ƒä½ åœ¨æœ¬åœ°çš„æ‰€æœ‰æ”¹åŠ¨ä¸æäº¤ï¼Œå¯ä»¥åˆ°æœåŠ¡å™¨ä¸Šè·å–æœ€æ–°çš„ç‰ˆæœ¬å†å²ï¼Œå¹¶å°†ä½ æœ¬åœ°ä¸»åˆ†æ”¯æŒ‡å‘å®ƒï¼š\ngit fetch origin git reset --hard origin/master åˆ†æ”¯ # åˆ†æ”¯æ˜¯ç”¨æ¥å°†ç‰¹æ€§å¼€å‘ç»ç¼˜å¼€æ¥çš„ã€‚åœ¨ä½ åˆ›å»ºä»“åº“çš„æ—¶å€™ï¼Œmaster æ˜¯â€œé»˜è®¤â€çš„åˆ†æ”¯ã€‚åœ¨å…¶ä»–åˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘ï¼Œå®Œæˆåå†å°†å®ƒä»¬åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸Šã€‚\næˆ‘ä»¬é€šå¸¸åœ¨å¼€å‘æ–°åŠŸèƒ½ã€ä¿®å¤ä¸€ä¸ªç´§æ€¥ bug ç­‰ç­‰æ—¶å€™ä¼šé€‰æ‹©åˆ›å»ºåˆ†æ”¯ã€‚å•åˆ†æ”¯å¼€å‘å¥½è¿˜æ˜¯å¤šåˆ†æ”¯å¼€å‘å¥½ï¼Œè¿˜æ˜¯è¦çœ‹å…·ä½“åœºæ™¯æ¥è¯´ã€‚\nåˆ›å»ºä¸€ä¸ªåå­—å«åš test çš„åˆ†æ”¯\ngit branch test åˆ‡æ¢å½“å‰åˆ†æ”¯åˆ° testï¼ˆå½“ä½ åˆ‡æ¢åˆ†æ”¯çš„æ—¶å€™ï¼ŒGit ä¼šé‡ç½®ä½ çš„å·¥ä½œç›®å½•ï¼Œä½¿å…¶çœ‹èµ·æ¥åƒå›åˆ°äº†ä½ åœ¨é‚£ä¸ªåˆ†æ”¯ä¸Šæœ€åä¸€æ¬¡æäº¤çš„æ ·å­ã€‚ Git ä¼šè‡ªåŠ¨æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹æ–‡ä»¶ä»¥ç¡®ä¿æ­¤æ—¶ä½ çš„å·¥ä½œç›®å½•å’Œè¿™ä¸ªåˆ†æ”¯æœ€åä¸€æ¬¡æäº¤æ—¶çš„æ ·å­ä¸€æ¨¡ä¸€æ ·ï¼‰\ngit checkout test ä½ ä¹Ÿå¯ä»¥ç›´æ¥è¿™æ ·åˆ›å»ºåˆ†æ”¯å¹¶åˆ‡æ¢è¿‡å»(ä¸Šé¢ä¸¤æ¡å‘½ä»¤çš„åˆå†™)\ngit checkout -b feature_x åˆ‡æ¢åˆ°ä¸»åˆ†æ”¯\ngit checkout master åˆå¹¶åˆ†æ”¯(å¯èƒ½ä¼šæœ‰å†²çª)\ngit merge test æŠŠæ–°å»ºçš„åˆ†æ”¯åˆ æ‰\ngit branch -d feature_x å°†åˆ†æ”¯æ¨é€åˆ°è¿œç«¯ä»“åº“ï¼ˆæ¨é€æˆåŠŸåå…¶ä»–äººå¯è§ï¼‰ï¼š\ngit push origin æ¨è # åœ¨çº¿æ¼”ç¤ºå­¦ä¹ å·¥å…·ï¼š\nã€Œè¡¥å……ï¼Œæ¥è‡ªissue729ã€Learn Git Branching https://oschina.gitee.io/learn-git-branching/ ã€‚è¯¥ç½‘ç«™å¯ä»¥æ–¹ä¾¿çš„æ¼”ç¤ºåŸºæœ¬çš„gitæ“ä½œï¼Œè®²è§£å¾—æ˜æ˜ç™½ç™½ã€‚æ¯ä¸€ä¸ªåŸºæœ¬å‘½ä»¤çš„ä½œç”¨å’Œç»“æœã€‚\næ¨èé˜…è¯»ï¼š\nGit - ç®€æ˜æŒ‡å— å›¾è§£Git çŒ´å­éƒ½èƒ½æ‡‚å¾—Gitå…¥é—¨ https://git-scm.com/book/en/v2 Generating a new SSH key and adding it to the ssh-agent ä¸€ä¸ªå¥½çš„ Git æäº¤æ¶ˆæ¯ï¼Œå‡ºè‡ª Linus ä¹‹æ‰‹ "},{"id":102,"href":"/zh/docs/study/Review/java_guide/lyaly_dev_tools/maven/","title":"maven","section":"å¼€å‘å·¥å…·","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nè¿™éƒ¨åˆ†å†…å®¹ä¸»è¦æ ¹æ® Maven å®˜æ–¹æ–‡æ¡£æ•´ç†ï¼Œåšäº†å¯¹åº”çš„åˆ å‡ï¼Œä¸»è¦ä¿ç•™æ¯”è¾ƒé‡è¦çš„éƒ¨åˆ†ï¼Œä¸æ¶‰åŠå®æˆ˜ï¼Œä¸»è¦æ˜¯ä¸€äº›é‡è¦æ¦‚å¿µçš„ä»‹ç»ã€‚\nMaven ä»‹ç» # Maven å®˜æ–¹æ–‡æ¡£æ˜¯è¿™æ ·ä»‹ç»çš„ Maven çš„ï¼š\nApache Maven is a software project management and comprehension tool. Based on the concept of a project object model (POM), Maven can manage a project\u0026rsquo;s build, reporting and documentation from a central piece of information.\nApache Maven çš„æœ¬è´¨æ˜¯ä¸€ä¸ªè½¯ä»¶é¡¹ç›®ç®¡ç†å’Œç†è§£å·¥å…·ã€‚åŸºäºé¡¹ç›®å¯¹è±¡æ¨¡å‹ (Project Object Modelï¼ŒPOM) çš„æ¦‚å¿µï¼ŒMaven å¯ä»¥ä»ä¸€æ¡ä¸­å¿ƒä¿¡æ¯ ç®¡ç†é¡¹ç›®çš„æ„å»ºã€æŠ¥å‘Šå’Œæ–‡æ¡£ã€‚\nä»€ä¹ˆæ˜¯ POMï¼Ÿ æ¯ä¸€ä¸ª Maven å·¥ç¨‹éƒ½æœ‰ä¸€ä¸ª pom.xml æ–‡ä»¶ï¼Œä½äºæ ¹ç›®å½•ä¸­ï¼ŒåŒ…å«é¡¹ç›®æ„å»ºç”Ÿå‘½å‘¨æœŸçš„è¯¦ç»†ä¿¡æ¯ã€‚é€šè¿‡ pom.xml æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰é¡¹ç›®çš„åæ ‡ã€é¡¹ç›®ä¾èµ–ã€é¡¹ç›®ä¿¡æ¯ã€æ’ä»¶ä¿¡æ¯ç­‰ç­‰é…ç½®ã€‚\nå¯¹äºå¼€å‘è€…æ¥è¯´ï¼ŒMaven çš„ä¸»è¦ä½œç”¨ä¸»è¦æœ‰ 3 ä¸ªï¼š\né¡¹ç›®æ„å»º ï¼šæä¾›æ ‡å‡†çš„ã€è·¨å¹³å°çš„è‡ªåŠ¨åŒ–é¡¹ç›®æ„å»ºæ–¹å¼ã€‚ ä¾èµ–ç®¡ç† ï¼šæ–¹ä¾¿å¿«æ·çš„ç®¡ç†é¡¹ç›®ä¾èµ–çš„èµ„æºï¼ˆjar åŒ…ï¼‰ï¼Œé¿å…èµ„æºé—´çš„ç‰ˆæœ¬å†²çªé—®é¢˜ã€‚ ç»Ÿä¸€å¼€å‘ç»“æ„ ï¼šæä¾›æ ‡å‡†çš„ã€ç»Ÿä¸€çš„é¡¹ç›®ç»“æ„ã€‚ å…³äº Maven çš„åŸºæœ¬ä½¿ç”¨è¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼Œå»ºè®®çœ‹çœ‹å®˜ç½‘çš„ 5 åˆ†é’Ÿä¸Šæ‰‹ Maven çš„æ•™ç¨‹ï¼šMaven in 5 Minutes ã€‚\nMaven åæ ‡ # é¡¹ç›®ä¸­ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“ä»¥åŠæ’ä»¶å¯ç»Ÿç§°ä¸ºæ„ä»¶ã€‚æ¯ä¸€ä¸ªæ„ä»¶éƒ½å¯ä»¥ä½¿ç”¨ Maven åæ ‡ å”¯ä¸€æ ‡è¯†ï¼Œåæ ‡å…ƒç´ åŒ…æ‹¬ï¼š\ngoupId(å¿…é¡»): å®šä¹‰äº†å½“å‰ Maven é¡¹ç›®éš¶å±çš„ç»„ç»‡æˆ–å…¬å¸ã€‚groupId ä¸€èˆ¬åˆ†ä¸ºå¤šæ®µï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œç¬¬ä¸€æ®µä¸ºåŸŸï¼Œç¬¬äºŒæ®µä¸ºå…¬å¸åç§°ã€‚åŸŸåˆåˆ†ä¸º orgã€comã€cn ç­‰ï¼Œå…¶ä¸­ org ä¸ºéè¥åˆ©ç»„ç»‡ï¼Œcom ä¸ºå•†ä¸šç»„ç»‡ï¼Œcn è¡¨ç¤ºä¸­å›½ã€‚ä»¥ apache å¼€æºç¤¾åŒºçš„ tomcat é¡¹ç›®ä¸ºä¾‹ï¼Œè¿™ä¸ªé¡¹ç›®çš„ groupId æ˜¯ org.apacheï¼Œå®ƒçš„åŸŸæ˜¯ orgï¼ˆå› ä¸º tomcat æ˜¯éè¥åˆ©é¡¹ç›®ï¼‰ï¼Œå…¬å¸åç§°æ˜¯ apacheï¼ŒartifactId æ˜¯ tomcatã€‚ artifactId(å¿…é¡»)ï¼šå®šä¹‰äº†å½“å‰ Maven é¡¹ç›®çš„åç§°ï¼Œé¡¹ç›®çš„å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå¯¹åº”é¡¹ç›®æ ¹ç›®å½•çš„åç§°ã€‚ version(å¿…é¡»)ï¼š å®šä¹‰äº† Maven é¡¹ç›®å½“å‰æ‰€å¤„ç‰ˆæœ¬ã€‚ packagingï¼ˆå¯é€‰ï¼‰ï¼šå®šä¹‰äº† Maven é¡¹ç›®çš„æ‰“åŒ…æ–¹å¼ï¼ˆæ¯”å¦‚ jarï¼Œwar\u0026hellip;ï¼‰ï¼Œé»˜è®¤ä½¿ç”¨ jarã€‚ classifier(å¯é€‰)ï¼šå¸¸ç”¨äºåŒºåˆ†ä»åŒä¸€ POM æ„å»ºçš„å…·æœ‰ä¸åŒå†…å®¹çš„æ„ä»¶ï¼Œå¯ä»¥æ˜¯ä»»æ„çš„å­—ç¬¦ä¸²ï¼Œé™„åŠ åœ¨ç‰ˆæœ¬å·ä¹‹åã€‚ åªè¦ä½ æä¾›æ­£ç¡®çš„åæ ‡ï¼Œå°±èƒ½ä» Maven ä»“åº“ä¸­æ‰¾åˆ°ç›¸åº”çš„æ„ä»¶ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚\nä¸¾ä¸ªä¾‹å­ï¼ˆå¼•å…¥é˜¿é‡Œå·´å·´å¼€æºçš„ EasyExcelï¼‰ ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;easyexcel\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.1.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; ä½ å¯ä»¥åœ¨ https://mvnrepository.com/ è¿™ä¸ªç½‘ç«™ä¸Šæ‰¾åˆ°å‡ ä¹æ‰€æœ‰å¯ç”¨çš„æ„ä»¶ï¼Œå¦‚æœä½ çš„é¡¹ç›®ä½¿ç”¨çš„æ˜¯ Maven ä½œä¸ºæ„å»ºå·¥å…·ï¼Œé‚£è¿™ä¸ªç½‘ç«™ä½ ä¸€å®šä¼šç»å¸¸æ¥è§¦ã€‚\nMaven ä¾èµ– # å¦‚æœä½¿ç”¨ Maven æ„å»ºäº§ç”Ÿçš„æ„ä»¶ï¼ˆä¾‹å¦‚ Jar æ–‡ä»¶ï¼‰è¢«å…¶ä»–çš„é¡¹ç›®å¼•ç”¨ï¼Œé‚£ä¹ˆè¯¥æ„ä»¶å°±æ˜¯å…¶ä»–é¡¹ç›®çš„ä¾èµ–ã€‚\nä¾èµ–é…ç½® # é…ç½®ä¿¡æ¯ç¤ºä¾‹ ï¼š\n\u0026lt;project\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;\u0026lt;/version\u0026gt; \u0026lt;type\u0026gt;...\u0026lt;/type\u0026gt; \u0026lt;scope\u0026gt;...\u0026lt;/scope\u0026gt; \u0026lt;optional\u0026gt;...\u0026lt;/optional\u0026gt; \u0026lt;exclusions\u0026gt; \u0026lt;exclusion\u0026gt; \u0026lt;groupId\u0026gt;...\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;...\u0026lt;/artifactId\u0026gt; \u0026lt;/exclusion\u0026gt; \u0026lt;/exclusions\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/project\u0026gt; é…ç½®è¯´æ˜ ï¼š\ndependenciesï¼š ä¸€ä¸ª pom.xml æ–‡ä»¶ä¸­åªèƒ½å­˜åœ¨ä¸€ä¸ªè¿™æ ·çš„æ ‡ç­¾ï¼Œæ˜¯ç”¨æ¥ç®¡ç†ä¾èµ–çš„æ€»æ ‡ç­¾ã€‚ dependencyï¼šåŒ…å«åœ¨ dependencies æ ‡ç­¾ä¸­ï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œæ¯ä¸€ä¸ªè¡¨ç¤ºé¡¹ç›®çš„ä¸€ä¸ªä¾èµ–ã€‚ groupId,artifactId,version(å¿…è¦)ï¼šä¾èµ–çš„åŸºæœ¬åæ ‡ï¼Œå¯¹äºä»»ä½•ä¸€ä¸ªä¾èµ–æ¥è¯´ï¼ŒåŸºæœ¬åæ ‡æ˜¯æœ€é‡è¦çš„ï¼ŒMaven æ ¹æ®åæ ‡æ‰èƒ½æ‰¾åˆ°éœ€è¦çš„ä¾èµ–ã€‚æˆ‘ä»¬åœ¨ä¸Šé¢è§£é‡Šè¿‡è¿™äº›å…ƒç´ çš„å…·ä½“æ„æ€ï¼Œè¿™é‡Œå°±ä¸é‡å¤æäº†ã€‚ type(å¯é€‰)ï¼šä¾èµ–çš„ç±»å‹ï¼Œå¯¹åº”äºé¡¹ç›®åæ ‡å®šä¹‰çš„ packagingã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œè¯¥å…ƒç´ ä¸å¿…å£°æ˜ï¼Œå…¶é»˜è®¤å€¼æ˜¯ jarã€‚ scope(å¯é€‰)ï¼šä¾èµ–çš„èŒƒå›´ï¼Œé»˜è®¤å€¼æ˜¯ compileã€‚ optional(å¯é€‰)ï¼š æ ‡è®°ä¾èµ–æ˜¯å¦å¯é€‰ exclusions(å¯é€‰)ï¼šç”¨æ¥æ’é™¤ä¼ é€’æ€§ä¾èµ–,ä¾‹å¦‚ jar åŒ…å†²çª ä¾èµ–èŒƒå›´ # classpath ç”¨äºæŒ‡å®š .class æ–‡ä»¶å­˜æ”¾çš„ä½ç½®ï¼Œç±»åŠ è½½å™¨ä¼šä»è¯¥è·¯å¾„ä¸­åŠ è½½æ‰€éœ€çš„ .class æ–‡ä»¶åˆ°å†…å­˜ä¸­ã€‚\nMaven åœ¨ç¼–è¯‘ã€æ‰§è¡Œæµ‹è¯•ã€å®é™…è¿è¡Œæœ‰ç€ä¸‰å¥—ä¸åŒçš„ classpathï¼š\nç¼–è¯‘ classpath ï¼šç¼–è¯‘ä¸»ä»£ç æœ‰æ•ˆ æµ‹è¯• classpath ï¼šç¼–è¯‘ã€è¿è¡Œæµ‹è¯•ä»£ç æœ‰æ•ˆ è¿è¡Œ classpath ï¼šé¡¹ç›®è¿è¡Œæ—¶æœ‰æ•ˆ Maven çš„ä¾èµ–èŒƒå›´å¦‚ä¸‹ï¼š\ncompileï¼šç¼–è¯‘ä¾èµ–èŒƒå›´ï¼ˆé»˜è®¤ï¼‰ï¼Œä½¿ç”¨æ­¤ä¾èµ–èŒƒå›´å¯¹äºç¼–è¯‘ã€æµ‹è¯•ã€è¿è¡Œä¸‰ç§éƒ½æœ‰æ•ˆï¼Œå³åœ¨ç¼–è¯‘ã€æµ‹è¯•å’Œè¿è¡Œçš„æ—¶å€™éƒ½è¦ä½¿ç”¨è¯¥ä¾èµ– Jar åŒ…ã€‚ testï¼šæµ‹è¯•ä¾èµ–èŒƒå›´ï¼Œä»å­—é¢æ„æ€å°±å¯ä»¥çŸ¥é“æ­¤ä¾èµ–èŒƒå›´åªèƒ½ç”¨äºæµ‹è¯•ï¼Œè€Œåœ¨ç¼–è¯‘å’Œè¿è¡Œé¡¹ç›®æ—¶æ— æ³•ä½¿ç”¨æ­¤ç±»ä¾èµ–ï¼Œå…¸å‹çš„æ˜¯ JUnitï¼Œå®ƒåªç”¨äºç¼–è¯‘ æµ‹è¯•ä»£ç å’Œè¿è¡Œæµ‹è¯•ä»£ç çš„æ—¶å€™æ‰éœ€è¦ã€‚ provided ï¼šæ­¤ä¾èµ–èŒƒå›´ï¼Œå¯¹äºç¼–è¯‘å’Œæµ‹è¯•æœ‰æ•ˆï¼Œè€Œå¯¹è¿è¡Œæ—¶æ— æ•ˆã€‚æ¯”å¦‚ servlet-api.jar åœ¨ Tomcat ä¸­å·²ç»æä¾›äº†ï¼Œæˆ‘ä»¬åªéœ€è¦çš„æ˜¯ç¼–è¯‘æœŸæä¾›è€Œå·²ã€‚ runtimeï¼šè¿è¡Œæ—¶ä¾èµ–èŒƒå›´ï¼Œå¯¹äºæµ‹è¯•å’Œè¿è¡Œæœ‰æ•ˆï¼Œä½†æ˜¯åœ¨ç¼–è¯‘ä¸»ä»£ç æ—¶æ— æ•ˆï¼Œå…¸å‹çš„å°±æ˜¯ JDBC é©±åŠ¨å®ç°ã€‚ systemï¼šç³»ç»Ÿä¾èµ–èŒƒå›´ï¼Œä½¿ç”¨ system èŒƒå›´çš„ä¾èµ–æ—¶å¿…é¡»é€šè¿‡ systemPath å…ƒç´ æ˜¾ç¤ºåœ°æŒ‡å®šä¾èµ–æ–‡ä»¶çš„è·¯å¾„ï¼Œä¸ä¾èµ– Maven ä»“åº“è§£æï¼Œæ‰€ä»¥å¯èƒ½ä¼šé€ æˆå»ºæ„çš„ä¸å¯ç§»æ¤ã€‚ ä¼ é€’ä¾èµ–æ€§ # ä¾èµ–å†²çª # 1ã€å¯¹äº Maven è€Œè¨€ï¼ŒåŒä¸€ä¸ª groupId åŒä¸€ä¸ª artifactId ä¸‹ï¼Œåªèƒ½ä½¿ç”¨ä¸€ä¸ª versionã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;in.hocg.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mybatis-plus-spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0.48\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- åªä¼šä½¿ç”¨ 1.0.49 è¿™ä¸ªç‰ˆæœ¬çš„ä¾èµ– --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;in.hocg.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mybatis-plus-spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0.49\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; è‹¥ç›¸åŒç±»å‹ä½†ç‰ˆæœ¬ä¸åŒçš„ä¾èµ–å­˜åœ¨äºåŒä¸€ä¸ª pom æ–‡ä»¶ï¼Œåªä¼šå¼•å…¥åä¸€ä¸ªå£°æ˜çš„ä¾èµ–ã€‚\n2ã€é¡¹ç›®çš„ä¸¤ä¸ªä¾èµ–åŒæ—¶å¼•å…¥äº†æŸä¸ªä¾èµ–ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œé¡¹ç›®å­˜åœ¨ä¸‹é¢è¿™æ ·çš„ä¾èµ–å…³ç³»ï¼š\nä¾èµ–é“¾è·¯ä¸€ï¼šA -\u0026gt; B -\u0026gt; C -\u0026gt; X(1.0) ä¾èµ–é“¾è·¯äºŒï¼šA -\u0026gt; D -\u0026gt; X(2.0) è¿™ä¸¤æ¡ä¾èµ–è·¯å¾„ä¸Šæœ‰ä¸¤ä¸ªç‰ˆæœ¬çš„ Xï¼Œä¸ºäº†é¿å…ä¾èµ–é‡å¤ï¼ŒMaven åªä¼šé€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªè¿›è¡Œè§£æã€‚\nå“ªä¸ªç‰ˆæœ¬çš„ X ä¼šè¢« Maven è§£æä½¿ç”¨å‘¢?\nMaven åœ¨é‡åˆ°è¿™ç§é—®é¢˜çš„æ—¶å€™ï¼Œä¼šéµå¾ª è·¯å¾„æœ€çŸ­ä¼˜å…ˆ å’Œ å£°æ˜é¡ºåºä¼˜å…ˆ ä¸¤å¤§åŸåˆ™ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„è¿‡ç¨‹ä¹Ÿè¢«ç§°ä¸º Maven ä¾èµ–è°ƒè§£ ã€‚\nè·¯å¾„æœ€çŸ­ä¼˜å…ˆ\nä¾èµ–é“¾è·¯ä¸€ï¼šA -\u0026gt; B -\u0026gt; C -\u0026gt; X(1.0) // dist = 3 ä¾èµ–é“¾è·¯äºŒï¼šA -\u0026gt; D -\u0026gt; X(2.0) // dist = 2 ä¾èµ–é“¾è·¯äºŒçš„è·¯å¾„æœ€çŸ­ï¼Œå› æ­¤ï¼ŒX(2.0)ä¼šè¢«è§£æä½¿ç”¨ã€‚\nä¸è¿‡ï¼Œä½ ä¹Ÿå¯ä»¥å‘ç°ã€‚è·¯å¾„æœ€çŸ­ä¼˜å…ˆåŸåˆ™å¹¶ä¸æ˜¯é€šç”¨çš„ï¼Œåƒä¸‹é¢è¿™ç§è·¯å¾„é•¿åº¦ç›¸ç­‰çš„æƒ…å†µå°±ä¸èƒ½å•å•é€šè¿‡å…¶è§£å†³äº†ï¼š\nä¾èµ–é“¾è·¯ä¸€ï¼šA -\u0026gt; B -\u0026gt; X(1.0) // dist = 3 ä¾èµ–é“¾è·¯äºŒï¼šA -\u0026gt; D -\u0026gt; X(2.0) // dist = 2 å› æ­¤ï¼ŒMaven åˆå®šä¹‰äº†å£°æ˜é¡ºåºä¼˜å…ˆåŸåˆ™ã€‚\nä¾èµ–è°ƒè§£ç¬¬ä¸€åŸåˆ™ä¸èƒ½è§£å†³æ‰€æœ‰é—®é¢˜ï¼Œæ¯”å¦‚è¿™æ ·çš„ä¾èµ–å…³ç³»ï¼šA-\u0026gt;B-\u0026gt;Y(1.0)ã€A-\u0026gt; C-\u0026gt;Y(2.0)ï¼ŒY(1.0)å’Œ Y(2.0)çš„ä¾èµ–è·¯å¾„é•¿åº¦æ˜¯ä¸€æ ·çš„ï¼Œéƒ½ä¸º 2ã€‚Maven å®šä¹‰äº†ä¾èµ–è°ƒè§£çš„ç¬¬äºŒåŸåˆ™ï¼š\nå£°æ˜é¡ºåºä¼˜å…ˆ\nåœ¨ä¾èµ–è·¯å¾„é•¿åº¦ç›¸ç­‰çš„å‰æä¸‹ï¼Œåœ¨ pom.xml ä¸­ä¾èµ–å£°æ˜çš„é¡ºåºå†³å®šäº†è°ä¼šè¢«è§£æä½¿ç”¨ï¼Œé¡ºåºæœ€å‰çš„é‚£ä¸ªä¾èµ–ä¼˜èƒœã€‚è¯¥ä¾‹ä¸­ï¼Œå¦‚æœ B çš„ä¾èµ–å£°æ˜åœ¨ D ä¹‹å‰ï¼Œé‚£ä¹ˆ X (1.0)å°±ä¼šè¢«è§£æä½¿ç”¨ã€‚\n\u0026lt;!-- A pom.xml --\u0026gt; \u0026lt;dependencies\u0026gt; ... dependency B ... dependency D \u0026lt;/dependencies\u0026gt; æ’é™¤ä¾èµ– # å•çº¯ä¾èµ– Maven æ¥è¿›è¡Œä¾èµ–è°ƒè§£ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹æ˜¯ä¸é€‚ç”¨çš„ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ’é™¤ä¾èµ–ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œå½“å‰é¡¹ç›®å­˜åœ¨ä¸‹é¢è¿™æ ·çš„ä¾èµ–å…³ç³»ï¼š\nä¾èµ–é“¾è·¯ä¸€ï¼šA -\u0026gt; B -\u0026gt; C -\u0026gt; X(1.5) // dist = 3 ä¾èµ–é“¾è·¯äºŒï¼šA -\u0026gt; D -\u0026gt; X(1.0) // dist = 2 æ ¹æ®è·¯å¾„æœ€çŸ­ä¼˜å…ˆåŸåˆ™ï¼ŒX(1.0) ä¼šè¢«è§£æä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å®é™…ç”¨çš„æ˜¯ 1.0 ç‰ˆæœ¬çš„ Xã€‚\nä½†æ˜¯ï¼ï¼ï¼è¿™ä¼šä¸€äº›é—®é¢˜ï¼šå¦‚æœ D ä¾èµ–ç”¨åˆ°äº† 1.5 ç‰ˆæœ¬çš„ X ä¸­æ‰æœ‰çš„ä¸€ä¸ªç±»ï¼Œè¿è¡Œé¡¹ç›®å°±ä¼šæŠ¥NoClassDefFoundErroré”™è¯¯ã€‚å¦‚æœ D ä¾èµ–ç”¨åˆ°äº† 1.5 ç‰ˆæœ¬çš„ X ä¸­æ‰æœ‰çš„ä¸€ä¸ªæ–¹æ³•ï¼Œè¿è¡Œé¡¹ç›®å°±ä¼šæŠ¥NoSuchMethodErroré”™è¯¯ã€‚\nç°åœ¨çŸ¥é“ä¸ºä»€ä¹ˆä½ çš„ Maven é¡¹ç›®æ€»æ˜¯ä¼šæŠ¥**NoClassDefFoundErrorå’ŒNoSuchMethodError**é”™è¯¯äº†å§ï¼Ÿ\nå¦‚ä½•è§£å†³å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥é€šè¿‡exclusiveæ ‡ç­¾æ‰‹åŠ¨å°† X(1.0) ç»™æ’é™¤ã€‚\n\u0026lt;dependencyB\u0026gt; ...... \u0026lt;exclusions\u0026gt; \u0026lt;exclusion\u0026gt; \u0026lt;artifactId\u0026gt;x\u0026lt;/artifactId\u0026gt; \u0026lt;groupId\u0026gt;org.apache.x\u0026lt;/groupId\u0026gt; \u0026lt;/exclusion\u0026gt; \u0026lt;/exclusions\u0026gt; \u0026lt;/dependency\u0026gt; ä¸€èˆ¬æˆ‘ä»¬åœ¨è§£å†³ä¾èµ–å†²çªçš„æ—¶å€™ï¼Œéƒ½ä¼šä¼˜å…ˆä¿ç•™ç‰ˆæœ¬è¾ƒé«˜çš„ã€‚è¿™æ˜¯å› ä¸ºå¤§éƒ¨åˆ† jar åœ¨å‡çº§çš„æ—¶å€™éƒ½ä¼šåšåˆ°å‘ä¸‹å…¼å®¹ã€‚\nå¦‚æœé«˜ç‰ˆæœ¬ä¿®æ”¹äº†ä½ç‰ˆæœ¬çš„ä¸€äº›ç±»æˆ–è€…æ–¹æ³•çš„è¯ï¼Œè¿™ä¸ªæ—¶å€™å°±èƒ½ç›´æ¥ä¿ç•™é«˜ç‰ˆæœ¬äº†ï¼Œè€Œæ˜¯åº”è¯¥è€ƒè™‘ä¼˜åŒ–ä¸Šå±‚ä¾èµ–ï¼Œæ¯”å¦‚å‡çº§ä¸Šå±‚ä¾èµ–çš„ç‰ˆæœ¬ã€‚\nè¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼š\nä¾èµ–é“¾è·¯ä¸€ï¼šA -\u0026gt; B -\u0026gt; C -\u0026gt; X(1.5) // dist = 3 ä¾èµ–é“¾è·¯äºŒï¼šA -\u0026gt; D -\u0026gt; X(1.0) // dist = 2 æˆ‘ä»¬ä¿ç•™äº† 1.5 ç‰ˆæœ¬çš„ Xï¼Œä½†æ˜¯è¿™ä¸ªç‰ˆæœ¬çš„ X åˆ é™¤äº† 1.0 ç‰ˆæœ¬ä¸­çš„æŸäº›ç±»ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å‡çº§ D çš„ç‰ˆæœ¬åˆ°ä¸€ä¸ª X å…¼å®¹çš„ç‰ˆæœ¬ã€‚\nMaven ä»“åº“ # åœ¨ Maven ä¸–ç•Œä¸­ï¼Œä»»ä½•ä¸€ä¸ªä¾èµ–ã€æ’ä»¶æˆ–è€…é¡¹ç›®æ„å»ºçš„è¾“å‡ºï¼Œéƒ½å¯ä»¥ç§°ä¸º æ„ä»¶ ã€‚\nåæ ‡å’Œä¾èµ–æ˜¯æ„ä»¶åœ¨ Maven ä¸–ç•Œä¸­çš„é€»è¾‘è¡¨ç¤ºæ–¹å¼ï¼Œæ„ä»¶çš„ç‰©ç†è¡¨ç¤ºæ–¹å¼æ˜¯æ–‡ä»¶ï¼ŒMaven é€šè¿‡ä»“åº“æ¥ç»Ÿä¸€ç®¡ç†è¿™äº›æ–‡ä»¶ã€‚ ä»»ä½•ä¸€ä¸ªæ„ä»¶éƒ½æœ‰ä¸€ç»„åæ ‡å”¯ä¸€æ ‡è¯†ã€‚æœ‰äº†ä»“åº“ä¹‹åï¼Œæ— éœ€æ‰‹åŠ¨å¼•å…¥æ„ä»¶ï¼Œæˆ‘ä»¬ç›´æ¥ç»™å®šæ„ä»¶çš„åæ ‡å³å¯åœ¨ Maven ä»“åº“ä¸­æ‰¾åˆ°è¯¥æ„ä»¶ã€‚\nMaven ä»“åº“åˆ†ä¸ºï¼š\næœ¬åœ°ä»“åº“ ï¼šè¿è¡Œ Maven çš„è®¡ç®—æœºä¸Šçš„ä¸€ä¸ªç›®å½•ï¼Œå®ƒç¼“å­˜è¿œç¨‹ä¸‹è½½çš„æ„ä»¶å¹¶åŒ…å«å°šæœªå‘å¸ƒçš„ä¸´æ—¶æ„ä»¶ã€‚settings.xml æ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ° Maven çš„æœ¬åœ°ä»“åº“è·¯å¾„é…ç½®ï¼Œé»˜è®¤æœ¬åœ°ä»“åº“è·¯å¾„æ˜¯åœ¨ ${user.home}/.m2/repositoryã€‚ è¿œç¨‹ä»“åº“ ï¼šå®˜æ–¹æˆ–è€…å…¶ä»–ç»„ç»‡ç»´æŠ¤çš„ Maven ä»“åº“ã€‚ Maven è¿œç¨‹ä»“åº“å¯ä»¥åˆ†ä¸ºï¼š\nä¸­å¤®ä»“åº“ ï¼šè¿™ä¸ªä»“åº“æ˜¯ç”± Maven ç¤¾åŒºæ¥ç»´æŠ¤çš„ï¼Œé‡Œé¢å­˜æ”¾äº†ç»å¤§å¤šæ•°å¼€æºè½¯ä»¶çš„åŒ…ï¼Œå¹¶ä¸”æ˜¯ä½œä¸º Maven çš„é»˜è®¤é…ç½®ï¼Œä¸éœ€è¦å¼€å‘è€…é¢å¤–é…ç½®ã€‚å¦å¤–ä¸ºäº†æ–¹ä¾¿æŸ¥è¯¢ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªæŸ¥è¯¢åœ°å€ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡è¿™ä¸ªåœ°å€æ›´å¿«çš„æœç´¢éœ€è¦æ„ä»¶çš„åæ ‡ã€‚ ç§æœ ï¼šç§æœæ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿œç¨‹ Maven ä»“åº“ï¼Œå®ƒæ˜¯æ¶è®¾åœ¨å±€åŸŸç½‘å†…çš„ä»“åº“æœåŠ¡ï¼Œç§æœä¸€èˆ¬è¢«é…ç½®ä¸ºäº’è”ç½‘è¿œç¨‹ä»“åº“çš„é•œåƒï¼Œä¾›å±€åŸŸç½‘å†…çš„ Maven ç”¨æˆ·ä½¿ç”¨ã€‚ å…¶ä»–çš„å…¬å…±ä»“åº“ ï¼šæœ‰ä¸€äº›å…¬å…±ä»“åº“æ˜¯æœªæ¥åŠ é€Ÿè®¿é—®ï¼ˆæ¯”å¦‚é˜¿é‡Œäº‘ Maven é•œåƒä»“åº“ï¼‰æˆ–è€…éƒ¨åˆ†æ„ä»¶ä¸å­˜åœ¨äºä¸­å¤®ä»“åº“ä¸­ã€‚ Maven ä¾èµ–åŒ…å¯»æ‰¾é¡ºåºï¼š\nå…ˆå»æœ¬åœ°ä»“åº“æ‰¾å¯»ï¼Œæœ‰çš„è¯ï¼Œç›´æ¥ä½¿ç”¨ã€‚ æœ¬åœ°ä»“åº“æ²¡æœ‰æ‰¾åˆ°çš„è¯ï¼Œä¼šå»è¿œç¨‹ä»“åº“æ‰¾å¯»ï¼Œä¸‹è½½åŒ…åˆ°æœ¬åœ°ä»“åº“ã€‚ è¿œç¨‹ä»“åº“æ²¡æœ‰æ‰¾åˆ°çš„è¯ï¼Œä¼šæŠ¥é”™ã€‚ Maven ç”Ÿå‘½å‘¨æœŸ # Maven çš„ç”Ÿå‘½å‘¨æœŸå°±æ˜¯ä¸ºäº†å¯¹æ‰€æœ‰çš„æ„å»ºè¿‡ç¨‹è¿›è¡ŒæŠ½è±¡å’Œç»Ÿä¸€ï¼ŒåŒ…å«äº†é¡¹ç›®çš„æ¸…ç†ã€åˆå§‹åŒ–ã€ç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…ã€é›†æˆæµ‹è¯•ã€éªŒè¯ã€éƒ¨ç½²å’Œç«™ç‚¹ç”Ÿæˆç­‰å‡ ä¹æ‰€æœ‰æ„å»ºæ­¥éª¤ã€‚\nMaven å®šä¹‰äº† 3 ä¸ªç”Ÿå‘½å‘¨æœŸMETA-INF/plexus/components.xmlï¼š\ndefault ç”Ÿå‘½å‘¨æœŸ cleanç”Ÿå‘½å‘¨æœŸ siteç”Ÿå‘½å‘¨æœŸ è¿™äº›ç”Ÿå‘½å‘¨æœŸæ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…å«å¤šä¸ªé˜¶æ®µ(phase)ã€‚å¹¶ä¸”ï¼Œè¿™äº›é˜¶æ®µæ˜¯æœ‰åºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåé¢çš„é˜¶æ®µä¾èµ–äºå‰é¢çš„é˜¶æ®µã€‚å½“æ‰§è¡ŒæŸä¸ªé˜¶æ®µçš„æ—¶å€™ï¼Œä¼šå…ˆæ‰§è¡Œå®ƒå‰é¢çš„é˜¶æ®µã€‚\næ‰§è¡Œ Maven ç”Ÿå‘½å‘¨æœŸçš„å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š\nmvn é˜¶æ®µ [é˜¶æ®µ2] ...[é˜¶æ®µn] default ç”Ÿå‘½å‘¨æœŸ # defaultç”Ÿå‘½å‘¨æœŸæ˜¯åœ¨æ²¡æœ‰ä»»ä½•å…³è”æ’ä»¶çš„æƒ…å†µä¸‹å®šä¹‰çš„ï¼Œæ˜¯ Maven çš„ä¸»è¦ç”Ÿå‘½å‘¨æœŸï¼Œç”¨äºæ„å»ºåº”ç”¨ç¨‹åºï¼Œå…±åŒ…å« 23 ä¸ªé˜¶æ®µã€‚\n\u0026lt;phases\u0026gt; \u0026lt;!-- éªŒè¯é¡¹ç›®æ˜¯å¦æ­£ç¡®ï¼Œå¹¶ä¸”æ‰€æœ‰å¿…è¦çš„ä¿¡æ¯å¯ç”¨äºå®Œæˆæ„å»ºè¿‡ç¨‹ --\u0026gt; \u0026lt;phase\u0026gt;validate\u0026lt;/phase\u0026gt; \u0026lt;!-- å»ºç«‹åˆå§‹åŒ–çŠ¶æ€ï¼Œä¾‹å¦‚è®¾ç½®å±æ€§ --\u0026gt; \u0026lt;phase\u0026gt;initialize\u0026lt;/phase\u0026gt; \u0026lt;!-- ç”Ÿæˆè¦åŒ…å«åœ¨ç¼–è¯‘é˜¶æ®µçš„æºä»£ç  --\u0026gt; \u0026lt;phase\u0026gt;generate-sources\u0026lt;/phase\u0026gt; \u0026lt;!-- å¤„ç†æºä»£ç  --\u0026gt; \u0026lt;phase\u0026gt;process-sources\u0026lt;/phase\u0026gt; \u0026lt;!-- ç”Ÿæˆè¦åŒ…å«åœ¨åŒ…ä¸­çš„èµ„æº --\u0026gt; \u0026lt;phase\u0026gt;generate-resources\u0026lt;/phase\u0026gt; \u0026lt;!-- å°†èµ„æºå¤åˆ¶å¹¶å¤„ç†åˆ°ç›®æ ‡ç›®å½•ä¸­ï¼Œä¸ºæ‰“åŒ…é˜¶æ®µåšå¥½å‡†å¤‡ã€‚ --\u0026gt; \u0026lt;phase\u0026gt;process-resources\u0026lt;/phase\u0026gt; \u0026lt;!-- ç¼–è¯‘é¡¹ç›®çš„æºä»£ç  --\u0026gt; \u0026lt;phase\u0026gt;compile\u0026lt;/phase\u0026gt; \u0026lt;!-- å¯¹ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶è¿›è¡Œåå¤„ç†ï¼Œä¾‹å¦‚å¯¹ Java ç±»è¿›è¡Œå­—èŠ‚ç å¢å¼º/ä¼˜åŒ– --\u0026gt; \u0026lt;phase\u0026gt;process-classes\u0026lt;/phase\u0026gt; \u0026lt;!-- ç”Ÿæˆè¦åŒ…å«åœ¨ç¼–è¯‘é˜¶æ®µçš„ä»»ä½•æµ‹è¯•æºä»£ç  --\u0026gt; \u0026lt;phase\u0026gt;generate-test-sources\u0026lt;/phase\u0026gt; \u0026lt;!-- å¤„ç†æµ‹è¯•æºä»£ç  --\u0026gt; \u0026lt;phase\u0026gt;process-test-sources\u0026lt;/phase\u0026gt; \u0026lt;!-- ç”Ÿæˆè¦åŒ…å«åœ¨ç¼–è¯‘é˜¶æ®µçš„æµ‹è¯•æºä»£ç  --\u0026gt; \u0026lt;phase\u0026gt;generate-test-resources\u0026lt;/phase\u0026gt; \u0026lt;!-- å¤„ç†ä»æµ‹è¯•ä»£ç æ–‡ä»¶ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶ --\u0026gt; \u0026lt;phase\u0026gt;process-test-resources\u0026lt;/phase\u0026gt; \u0026lt;!-- ç¼–è¯‘æµ‹è¯•æºä»£ç  --\u0026gt; \u0026lt;phase\u0026gt;test-compile\u0026lt;/phase\u0026gt; \u0026lt;!-- å¤„ç†ä»æµ‹è¯•ä»£ç æ–‡ä»¶ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶ --\u0026gt; \u0026lt;phase\u0026gt;process-test-classes\u0026lt;/phase\u0026gt; \u0026lt;!-- ä½¿ç”¨åˆé€‚çš„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼ˆJunit å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼‰è¿è¡Œæµ‹è¯• --\u0026gt; \u0026lt;phase\u0026gt;test\u0026lt;/phase\u0026gt; \u0026lt;!-- åœ¨å®é™…æ‰“åŒ…ä¹‹å‰ï¼Œæ‰§è¡Œä»»ä½•çš„å¿…è¦çš„æ“ä½œä¸ºæ‰“åŒ…åšå‡†å¤‡ --\u0026gt; \u0026lt;phase\u0026gt;prepare-package\u0026lt;/phase\u0026gt; \u0026lt;!-- è·å–å·²ç¼–è¯‘çš„ä»£ç å¹¶å°†å…¶æ‰“åŒ…æˆå¯åˆ†å‘çš„æ ¼å¼ï¼Œä¾‹å¦‚ JARã€WAR æˆ– EAR æ–‡ä»¶ --\u0026gt; \u0026lt;phase\u0026gt;package\u0026lt;/phase\u0026gt; \u0026lt;!-- åœ¨æ‰§è¡Œé›†æˆæµ‹è¯•ä¹‹å‰æ‰§è¡Œæ‰€éœ€çš„æ“ä½œã€‚ ä¾‹å¦‚ï¼Œè®¾ç½®æ‰€éœ€çš„ç¯å¢ƒ --\u0026gt; \u0026lt;phase\u0026gt;pre-integration-test\u0026lt;/phase\u0026gt; \u0026lt;!-- å¤„ç†å¹¶åœ¨å¿…è¦æ—¶éƒ¨ç½²è½¯ä»¶åŒ…åˆ°é›†æˆæµ‹è¯•å¯ä»¥è¿è¡Œçš„ç¯å¢ƒ --\u0026gt; \u0026lt;phase\u0026gt;integration-test\u0026lt;/phase\u0026gt; \u0026lt;!-- æ‰§è¡Œé›†æˆæµ‹è¯•åæ‰§è¡Œæ‰€éœ€çš„æ“ä½œã€‚ ä¾‹å¦‚ï¼Œæ¸…ç†ç¯å¢ƒ --\u0026gt; \u0026lt;phase\u0026gt;post-integration-test\u0026lt;/phase\u0026gt; \u0026lt;!-- è¿è¡Œä»»ä½•æ£€æŸ¥ä»¥éªŒè¯æ‰“çš„åŒ…æ˜¯å¦æœ‰æ•ˆå¹¶ç¬¦åˆè´¨é‡æ ‡å‡†ã€‚ --\u0026gt; \u0026lt;phase\u0026gt;verify\u0026lt;/phase\u0026gt; \u0026lt;!-- å°†åŒ…å®‰è£…åˆ°æœ¬åœ°ä»“åº“ä¸­ï¼Œå¯ä»¥ä½œä¸ºæœ¬åœ°å…¶ä»–é¡¹ç›®çš„ä¾èµ– --\u0026gt; \u0026lt;phase\u0026gt;install\u0026lt;/phase\u0026gt; \u0026lt;!-- å°†æœ€ç»ˆçš„é¡¹ç›®åŒ…å¤åˆ¶åˆ°è¿œç¨‹ä»“åº“ä¸­ä¸å…¶ä»–å¼€å‘è€…å’Œé¡¹ç›®å…±äº« --\u0026gt; \u0026lt;phase\u0026gt;deploy\u0026lt;/phase\u0026gt; \u0026lt;/phases\u0026gt; æ ¹æ®å‰é¢æåˆ°çš„é˜¶æ®µé—´ä¾èµ–å…³ç³»ç†è®ºï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ mvn testå‘½ä»¤çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œä» validate åˆ° test çš„æ‰€æœ‰é˜¶æ®µï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆæ‰§è¡Œæµ‹è¯•çš„æ—¶å€™ï¼Œé¡¹ç›®çš„ä»£ç èƒ½å¤Ÿè‡ªåŠ¨ç¼–è¯‘ã€‚\nclean ç”Ÿå‘½å‘¨æœŸ # clean ç”Ÿå‘½å‘¨æœŸçš„ç›®çš„æ˜¯æ¸…ç†é¡¹ç›®ï¼Œå…±åŒ…å« 3 ä¸ªé˜¶æ®µï¼š\npre-clean clean post-clean \u0026lt;phases\u0026gt; \u0026lt;!-- æ‰§è¡Œä¸€äº›éœ€è¦åœ¨cleanä¹‹å‰å®Œæˆçš„å·¥ä½œ --\u0026gt; \u0026lt;phase\u0026gt;pre-clean\u0026lt;/phase\u0026gt; \u0026lt;!-- ç§»é™¤æ‰€æœ‰ä¸Šä¸€æ¬¡æ„å»ºç”Ÿæˆçš„æ–‡ä»¶ --\u0026gt; \u0026lt;phase\u0026gt;clean\u0026lt;/phase\u0026gt; \u0026lt;!-- æ‰§è¡Œä¸€äº›éœ€è¦åœ¨cleanä¹‹åç«‹åˆ»å®Œæˆçš„å·¥ä½œ --\u0026gt; \u0026lt;phase\u0026gt;post-clean\u0026lt;/phase\u0026gt; \u0026lt;/phases\u0026gt; \u0026lt;default-phases\u0026gt; \u0026lt;clean\u0026gt; org.apache.maven.plugins:maven-clean-plugin:2.5:clean \u0026lt;/clean\u0026gt; \u0026lt;/default-phases\u0026gt; æ ¹æ®å‰é¢æåˆ°çš„é˜¶æ®µé—´ä¾èµ–å…³ç³»ç†è®ºï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ mvn clean çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œ clean ç”Ÿå‘½å‘¨æœŸä¸­çš„ pre-clean å’Œ clean é˜¶æ®µã€‚\nsite ç”Ÿå‘½å‘¨æœŸ # site ç”Ÿå‘½å‘¨æœŸçš„ç›®çš„æ˜¯å»ºç«‹å’Œå‘å¸ƒé¡¹ç›®ç«™ç‚¹ï¼Œå…±åŒ…å« 4 ä¸ªé˜¶æ®µï¼š\npre-site site post-site site-deploy \u0026lt;phases\u0026gt; \u0026lt;!-- æ‰§è¡Œä¸€äº›éœ€è¦åœ¨ç”Ÿæˆç«™ç‚¹æ–‡æ¡£ä¹‹å‰å®Œæˆçš„å·¥ä½œ --\u0026gt; \u0026lt;phase\u0026gt;pre-site\u0026lt;/phase\u0026gt; \u0026lt;!-- ç”Ÿæˆé¡¹ç›®çš„ç«™ç‚¹æ–‡æ¡£ä½œ --\u0026gt; \u0026lt;phase\u0026gt;site\u0026lt;/phase\u0026gt; \u0026lt;!-- æ‰§è¡Œä¸€äº›éœ€è¦åœ¨ç”Ÿæˆç«™ç‚¹æ–‡æ¡£ä¹‹åå®Œæˆçš„å·¥ä½œï¼Œå¹¶ä¸”ä¸ºéƒ¨ç½²åšå‡†å¤‡ --\u0026gt; \u0026lt;phase\u0026gt;post-site\u0026lt;/phase\u0026gt; \u0026lt;!-- å°†ç”Ÿæˆçš„ç«™ç‚¹æ–‡æ¡£éƒ¨ç½²åˆ°ç‰¹å®šçš„æœåŠ¡å™¨ä¸Š --\u0026gt; \u0026lt;phase\u0026gt;site-deploy\u0026lt;/phase\u0026gt; \u0026lt;/phases\u0026gt; \u0026lt;default-phases\u0026gt; \u0026lt;site\u0026gt; org.apache.maven.plugins:maven-site-plugin:3.3:site \u0026lt;/site\u0026gt; \u0026lt;site-deploy\u0026gt; org.apache.maven.plugins:maven-site-plugin:3.3:deploy \u0026lt;/site-deploy\u0026gt; \u0026lt;/default-phases\u0026gt; Maven èƒ½å¤ŸåŸºäº pom.xml æ‰€åŒ…å«çš„ä¿¡æ¯ï¼Œè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå‹å¥½çš„ç«™ç‚¹ï¼Œæ–¹ä¾¿å›¢é˜Ÿäº¤æµå’Œå‘å¸ƒé¡¹ç›®ä¿¡æ¯ã€‚\nMaven æ’ä»¶ # Maven æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ’ä»¶æ‰§è¡Œæ¡†æ¶ï¼Œæ‰€æœ‰çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œéƒ½æ˜¯ç”±ä¸€ä¸ªä¸€ä¸ªæ’ä»¶ç‹¬ç«‹å®Œæˆçš„ã€‚åƒå’±ä»¬æ—¥å¸¸ä½¿ç”¨åˆ°çš„ installã€cleanã€deploy ç­‰å‘½ä»¤ï¼Œå…¶å®åº•å±‚éƒ½æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„ Maven æ’ä»¶ã€‚å…³äº Maven çš„æ ¸å¿ƒæ’ä»¶å¯ä»¥å‚è€ƒå®˜æ–¹çš„è¿™ç¯‡æ–‡æ¡£ï¼šhttps://maven.apache.org/plugins/index.html ã€‚\né™¤äº† Maven è‡ªå¸¦çš„æ’ä»¶ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›ä¸‰æ–¹æä¾›çš„æ’ä»¶æ¯”å¦‚å•æµ‹è¦†ç›–ç‡æ’ä»¶ jacoco-maven-pluginã€å¸®åŠ©å¼€å‘æ£€æµ‹ä»£ç ä¸­ä¸åˆè§„èŒƒçš„åœ°æ–¹çš„æ’ä»¶ maven-checkstyle-pluginã€åˆ†æä»£ç è´¨é‡çš„ sonar-maven-pluginã€‚å¹¶ä¸”ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰æ’ä»¶æ¥æ»¡è¶³è‡ªå·±çš„éœ€æ±‚ã€‚\njacoco-maven-plugin ä½¿ç”¨ç¤ºä¾‹ï¼š\n\u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.jacoco\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jacoco-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.8.8\u0026lt;/version\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;prepare-agent\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;id\u0026gt;generate-code-coverage-report\u0026lt;/id\u0026gt; \u0026lt;phase\u0026gt;test\u0026lt;/phase\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;report\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; ä½ å¯ä»¥å°† Maven æ’ä»¶ç†è§£ä¸ºä¸€ç»„ä»»åŠ¡çš„é›†åˆï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œç›´æ¥è¿è¡ŒæŒ‡å®šæ’ä»¶çš„ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥å°†æ’ä»¶ä»»åŠ¡æŒ‚è½½åˆ°æ„å»ºç”Ÿå‘½å‘¨æœŸï¼Œéšç€ç”Ÿå‘½å‘¨æœŸè¿è¡Œã€‚\nMaven æ’ä»¶è¢«åˆ†ä¸ºä¸‹é¢ä¸¤ç§ç±»å‹ï¼š\nBuild plugins ï¼šåœ¨æ„å»ºæ—¶æ‰§è¡Œã€‚ Reporting pluginsï¼šåœ¨ç½‘ç«™ç”Ÿæˆè¿‡ç¨‹ä¸­æ‰§è¡Œã€‚ Maven å¤šæ¨¡å—ç®¡ç† # å¤šæ¨¡å—ç®¡ç†ç®€å•åœ°æ¥è¯´å°±æ˜¯å°†ä¸€ä¸ªé¡¹ç›®åˆ†ä¸ºå¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—åªè´Ÿè´£å•ä¸€çš„åŠŸèƒ½å®ç°ã€‚ç›´è§‚çš„è¡¨ç°å°±æ˜¯ä¸€ä¸ª Maven é¡¹ç›®ä¸­ä¸æ­¢æœ‰ä¸€ä¸ª pom.xml æ–‡ä»¶ï¼Œä¼šåœ¨ä¸åŒçš„ç›®å½•ä¸­æœ‰å¤šä¸ª pom.xml æ–‡ä»¶ï¼Œè¿›è€Œå®ç°å¤šæ¨¡å—ç®¡ç†ã€‚\nå¤šæ¨¡å—ç®¡ç†é™¤äº†å¯ä»¥æ›´åŠ ä¾¿äºé¡¹ç›®å¼€å‘å’Œç®¡ç†ï¼Œè¿˜æœ‰å¦‚ä¸‹å¥½å¤„ï¼š\né™ä½ä»£ç ä¹‹é—´çš„è€¦åˆæ€§ï¼ˆä»ç±»çº§åˆ«çš„è€¦åˆæå‡åˆ° jar åŒ…çº§åˆ«çš„è€¦åˆï¼‰ï¼› å‡å°‘é‡å¤ï¼Œæå‡å¤ç”¨æ€§ï¼› æ¯ä¸ªæ¨¡å—éƒ½å¯ä»¥æ˜¯è‡ªè§£é‡Šçš„ï¼ˆé€šè¿‡æ¨¡å—åæˆ–è€…æ¨¡å—æ–‡æ¡£ï¼‰ï¼› æ¨¡å—è¿˜è§„èŒƒäº†ä»£ç è¾¹ç•Œçš„åˆ’åˆ†ï¼Œå¼€å‘è€…å¾ˆå®¹æ˜“é€šè¿‡æ¨¡å—ç¡®å®šè‡ªå·±æ‰€è´Ÿè´£çš„å†…å®¹ã€‚ å¤šæ¨¡å—ç®¡ç†ä¸‹ï¼Œä¼šæœ‰ä¸€ä¸ªçˆ¶æ¨¡å—ï¼Œå…¶ä»–çš„éƒ½æ˜¯å­æ¨¡å—ã€‚çˆ¶æ¨¡å—é€šå¸¸åªæœ‰ä¸€ä¸ª pom.xmlï¼Œæ²¡æœ‰å…¶ä»–å†…å®¹ã€‚çˆ¶æ¨¡å—çš„ pom.xml ä¸€èˆ¬åªå®šä¹‰äº†å„ä¸ªä¾èµ–çš„ç‰ˆæœ¬å·ã€åŒ…å«å“ªäº›å­æ¨¡å—ä»¥åŠæ’ä»¶æœ‰å“ªäº›ã€‚ä¸è¿‡ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä¾èµ–åªåœ¨æŸä¸ªå­é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œåˆ™å¯ä»¥åœ¨å­é¡¹ç›®çš„ pom.xml ä¸­ç›´æ¥å¼•å…¥ï¼Œé˜²æ­¢çˆ¶ pom çš„è¿‡äºè‡ƒè‚¿ã€‚\nå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒDubbo é¡¹ç›®å°±è¢«åˆ†æˆäº†å¤šä¸ªå­æ¨¡å—æ¯”å¦‚ dubbo-commonï¼ˆå…¬å…±é€»è¾‘æ¨¡å—ï¼‰ã€dubbo-remotingï¼ˆè¿œç¨‹é€šè®¯æ¨¡å—ï¼‰ã€dubbo-rpcï¼ˆè¿œç¨‹è°ƒç”¨æ¨¡å—ï¼‰ã€‚\næ–‡ç« æ¨è # å®‰å…¨åŒå­¦è®² Maven é—´æ¥ä¾èµ–åœºæ™¯çš„ä»²è£æœºåˆ¶ - é˜¿é‡Œå¼€å‘è€… - 2022 é«˜æ•ˆä½¿ç”¨ Java æ„å»ºå·¥å…·ï½œ Maven ç¯‡ - é˜¿é‡Œå¼€å‘è€… - 2022 å®‰å…¨åŒå­¦è®² Maven é‡æ‰“åŒ…çš„æ•…äº‹ - é˜¿é‡Œå¼€å‘è€… - 2022 å‚è€ƒ # ã€ŠMaven å®æˆ˜ã€‹ Introduction to Repositories - Maven å®˜æ–¹æ–‡æ¡£ï¼šhttps://maven.apache.org/guides/introduction/introduction-to-repositories.html Introduction to the Build Lifecycle - Maven å®˜æ–¹æ–‡æ¡£ï¼šhttps://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#Lifecycle_Reference Maven ä¾èµ–èŒƒå›´ï¼šhttp://www.mvnbook.com/maven-dependency.html è§£å†³ maven ä¾èµ–å†²çªï¼Œè¿™ç¯‡å°±å¤Ÿäº†ï¼ï¼šhttps://www.cnblogs.com/qdhxhz/p/16363532.html Multi-Module Project with Mavenï¼šhttps://www.baeldung.com/maven-multi-module "},{"id":103,"href":"/zh/docs/study/Review/java_guide/java/Concurrent/ly030301lyatomicpre/","title":"Atomicé¢„å¤‡çŸ¥è¯†","section":"å¹¶å‘","content":" Javaå®ç°CASçš„åŸç†[éjavaguide] # i++æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºi++ä¸æ˜¯åŸå­æ“ä½œï¼›å¯ä»¥ä½¿ç”¨synchronizedå’ŒCASå®ç°åŠ é”\nsynchronizedæ˜¯æ‚²è§‚é”ï¼Œä¸€æ—¦è·å¾—é”ï¼Œå…¶ä»–çº¿ç¨‹è¿›å…¥åå°±ä¼šé˜»å¡ç­‰å¾…é”ï¼›è€ŒCASæ˜¯ä¹è§‚é”ï¼Œæ‰§è¡Œæ—¶ä¸ä¼šåŠ é”ï¼Œå‡è®¾æ²¡æœ‰å†²çªï¼Œå¦‚æœå› ä¸ºå†²çªå¤±è´¥äº†å°±é‡è¯•ï¼Œç›´åˆ°æˆåŠŸ\nä¹è§‚é”å’Œæ‚²è§‚é”\nè¿™æ˜¯ä¸€ç§åˆ†ç±»æ–¹å¼ æ‚²è§‚é”ï¼Œæ€»æ˜¯è®¤ä¸ºæ¯æ¬¡è®¿é—®å…±äº«èµ„æºä¼šå‘ç”Ÿå†²çªï¼Œæ‰€ä»¥å¿…é¡»å¯¹æ¯æ¬¡æ•°æ®æ“ä½œåŠ é”ï¼Œä»¥ä¿è¯ä¸´ç•ŒåŒºçš„ç¨‹åºåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œ ä¹è§‚é”ï¼Œåˆç§°**â€œæ— é”â€**ï¼Œå‡è®¾å¯¹å…±äº«èµ„æºè®¿é—®æ²¡æœ‰å†²çªï¼Œçº¿ç¨‹å¯ä»¥ä¸åœçš„æ‰§è¡Œï¼Œæ— éœ€åŠ é”æ— éœ€ç­‰å¾…ï¼›ä¸€æ—¦å‘ç”Ÿå†²çªï¼Œé€šå¸¸æ˜¯ä½¿ç”¨ä¸€ç§ç§°ä¸ºCASçš„æŠ€æœ¯ä¿è¯çº¿ç¨‹æ‰§è¡Œå®‰å…¨ æ— é”æ²¡æœ‰é”çš„å­˜åœ¨ï¼Œå› æ­¤ä¸å¯èƒ½å‘ç”Ÿæ­»é”ï¼Œå³ä¹è§‚é”å¤©ç”Ÿå…ç–«æ­»é” ä¹è§‚é”ç”¨äº**â€œè¯»å¤šå†™å°‘â€çš„ç¯å¢ƒï¼Œé¿å…åŠ é”é¢‘ç¹å½±å“æ€§èƒ½ï¼›æ‚²è§‚é”ç”¨äºâ€œå†™å¤šè¯»å°‘â€ï¼Œé¿å…é¢‘ç¹å¤±è´¥åŠé‡è¯•**å½±å“æ€§èƒ½ CASæ¦‚å¿µï¼Œå³CompareAndSwap ï¼Œæ¯”è¾ƒå’Œäº¤æ¢ï¼ŒCASä¸­ï¼Œæœ‰ä¸‰ä¸ªå€¼ï¼ˆæ¦‚å¿µä¸Šï¼‰\nVï¼šè¦æ›´æ–°çš„å˜é‡(var)ï¼›Eï¼šæœŸæœ›å€¼ï¼ˆexpectedï¼‰ï¼›Nï¼šæ–°å€¼ï¼ˆnewï¼‰ åˆ¤æ–­Væ˜¯å¦ç­‰äºEï¼Œå¦‚æœç­‰äºï¼Œå°†Vçš„å€¼è®¾ç½®ä¸ºNï¼›å¦‚æœä¸ç­‰ï¼Œè¯´æ˜å·²ç»æœ‰å…¶å®ƒçº¿ç¨‹æ›´æ–°äº†Vï¼Œåˆ™å½“å‰çº¿ç¨‹æ”¾å¼ƒæ›´æ–°ï¼Œä»€ä¹ˆéƒ½ä¸åšã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œé¢„æœŸå€¼Eæœ¬è´¨ä¸ŠæŒ‡çš„æ˜¯â€œæ—§å€¼â€ï¼ˆåˆ¤æ–­æ˜¯å¦ä¿®æ”¹äº†ï¼‰\nå¦‚æœæœ‰ä¸€ä¸ªå¤šä¸ªçº¿ç¨‹å…±äº«çš„å˜é‡iåŸæœ¬ç­‰äº5ï¼Œæˆ‘ç°åœ¨åœ¨çº¿ç¨‹Aä¸­ï¼Œæƒ³æŠŠå®ƒè®¾ç½®ä¸ºæ–°çš„å€¼6; æˆ‘ä»¬ä½¿ç”¨CASæ¥åšè¿™ä¸ªäº‹æƒ…ï¼› ï¼ˆé¦–å…ˆè¦æŠŠåŸæ¥çš„å€¼5åœ¨çº¿ç¨‹ä¸­ä¿å­˜èµ·æ¥ï¼‰ æ¥ä¸‹æ¥æ˜¯åŸå­æ“ä½œï¼šé¦–å…ˆæˆ‘ä»¬ç”¨ï¼ˆç°åœ¨çš„iï¼‰å»ä¸5å¯¹æ¯”ï¼Œå‘ç°å®ƒç­‰äº5ï¼Œè¯´æ˜æ²¡æœ‰è¢«å…¶å®ƒçº¿ç¨‹æ”¹è¿‡ï¼Œé‚£æˆ‘å°±æŠŠå®ƒè®¾ç½®ä¸ºæ–°çš„å€¼6ï¼Œæ­¤æ¬¡CASæˆåŠŸï¼Œiçš„å€¼è¢«è®¾ç½®æˆäº†6ï¼› å¦‚æœä¸ç­‰äº5ï¼Œè¯´æ˜iè¢«å…¶å®ƒçº¿ç¨‹æ”¹è¿‡äº†ï¼ˆæ¯”å¦‚ç°åœ¨içš„å€¼ä¸º2ï¼‰ï¼Œé‚£ä¹ˆæˆ‘å°±ä»€ä¹ˆä¹Ÿä¸åšï¼Œæ­¤æ¬¡CASå¤±è´¥ï¼Œiçš„å€¼ä»ç„¶ä¸º2ã€‚ å…¶ä¸­iä¸ºVï¼Œ5ä¸ºEï¼Œ6ä¸ºN\nCASæ˜¯ä¸€ç§åŸå­æ“ä½œï¼Œå®ƒæ˜¯ä¸€ç§ç³»ç»ŸåŸè¯­ï¼Œæ˜¯ä¸€æ¡CPUåŸå­æŒ‡ä»¤ï¼Œä»CPUå±‚é¢ä¿è¯å®ƒçš„åŸå­æ€§ï¼ˆä¸å¯èƒ½å‡ºç°è¯´ï¼Œåˆ¤æ–­äº†å¯¹æ¯”äº†iä¸º5ä¹‹åï¼Œæ­£å‡†å¤‡æ›´æ–°å®ƒçš„å€¼ï¼Œæ­¤æ—¶è¯¥å€¼è¢«å…¶ä»–çº¿ç¨‹æ”¹äº†ï¼‰\nå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶ä½¿ç”¨CASæ“ä½œä¸€ä¸ªå˜é‡æ—¶ï¼Œåªæœ‰ä¸€ä¸ªä¼šèƒœå‡ºï¼Œå¹¶æˆåŠŸæ›´æ–°ï¼Œå…¶ä½™å‡ä¼šå¤±è´¥ï¼Œä½†å¤±è´¥çš„çº¿ç¨‹å¹¶ä¸ä¼šè¢«æŒ‚èµ·ï¼Œä»…æ˜¯è¢«å‘ŠçŸ¥å¤±è´¥ï¼Œå¹¶ä¸”å…è®¸å†æ¬¡å°è¯•ï¼Œå½“ç„¶ä¹Ÿå…è®¸å¤±è´¥çš„çº¿ç¨‹æ”¾å¼ƒæ“ä½œã€‚\nJavaå®ç°CASçš„åŸç† - Unsafeç±»\nåœ¨Javaä¸­ï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•æ˜¯nativeçš„ï¼Œé‚£Javaå°±ä¸è´Ÿè´£å…·ä½“å®ç°å®ƒï¼Œè€Œæ˜¯äº¤ç»™åº•å±‚çš„JVMä½¿ç”¨cæˆ–è€…c++å»å®ç°\nJavaä¸­æœ‰ä¸€ä¸ªUnsafeç±»ï¼Œåœ¨sun.miscåŒ…ä¸­ï¼Œé‡Œé¢æœ‰ä¸€äº›nativeæ–¹æ³•ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š\nboolean compareAndSwapObject(Object o, long offset,Object expected, Object x); boolean compareAndSwapInt(Object o, long offset,int expected,int x); boolean compareAndSwapLong(Object o, long offset,long expected,long x); //------\u0026gt;AtomicInteger.class public class AtomicInteger extends Number implements java.io.Serializable { private static final long serialVersionUID = 6214790243416807050L; // setup to use Unsafe.compareAndSwapInt for updates private static final Unsafe unsafe = Unsafe.getUnsafe(); private static final long valueOffset; static { try { valueOffset = unsafe.objectFieldOffset (AtomicInteger.class.getDeclaredField(\u0026#34;value\u0026#34;)); } catch (Exception ex) { throw new Error(ex); } } private volatile int value; public final int getAndIncrement() { return unsafe.getAndAddInt(this, valueOffset, 1); } }\nUnsafeä¸­å¯¹CASçš„å®ç°æ˜¯C++å†™çš„ï¼Œå®ƒçš„å…·ä½“å®ç°å’Œæ“ä½œç³»ç»Ÿã€CPUéƒ½æœ‰å…³ç³»ã€‚Linuxçš„X86ä¸­ä¸»è¦é€šè¿‡cmpxchglè¿™ä¸ªæŒ‡ä»¤åœ¨CPUçº§å®ŒæˆCASæ“ä½œï¼Œå¦‚æœæ˜¯å¤šå¤„ç†å™¨åˆ™å¿…é¡»ä½¿ç”¨lockæŒ‡ä»¤åŠ é”\nUnsafeç±»ä¸­è¿˜æœ‰park(çº¿ç¨‹æŒ‚èµ·)å’Œunpark(çº¿ç¨‹æ¢å¤)ï¼ŒLockSupportåº•å±‚åˆ™è°ƒç”¨äº†è¯¥æ–¹æ³•ï¼›è¿˜æœ‰æ”¯æŒåå°„æ“ä½œçš„allocateInstance()\nåŸå­æ“ä½œ- AtomicIntegerç±»æºç ç®€æ JDKæä¾›äº†ä¸€äº›åŸå­æ“ä½œçš„ç±»ï¼Œåœ¨java.util.concurrent.atomicåŒ…ä¸‹é¢ï¼ŒJDK11ä¸­æœ‰å¦‚ä¸‹17ä¸ªç±» åŒ…æ‹¬ åŸå­æ›´æ–°åŸºæœ¬ç±»å‹ï¼ŒåŸå­æ›´æ–°æ•°ç»„ï¼ŒåŸå­æ›´æ–°å¼•ç”¨ï¼ŒåŸå­æ›´æ–°å­—æ®µ(å±æ€§)\nå…¶ä¸­ï¼ŒAtomicIntegerç±»çš„getAndAdd(int data)\npublic final int getAndAdd(int delta) { return unsafe.getAndAddInt(this, valueOffset, delta); } //unsafeå­—æ®µ private static final jdk.internal.misc.Unsafe U = jdk.internal.misc.Unsafe.getUnsafe(); //ä¸Šé¢æ–¹æ³•å®é™…è°ƒç”¨ @HotSpotIntrinsicCandidate public final int getAndAddInt(Object o, long offset, int delta) { int v; do { v = getIntVolatile(o, offset); } while (!weakCompareAndSetInt(o, offset, v, v + delta)); return v; } //å¯¹äºoffsetï¼Œè¿™æ˜¯ä¸€ä¸ªå¯¹è±¡åç§»é‡ï¼Œç”¨äºè·å–æŸä¸ªå­—æ®µç›¸å¯¹Javaå¯¹è±¡çš„èµ·å§‹åœ°å€çš„åç§»é‡ /* ä¸€ä¸ªjavaå¯¹è±¡å¯ä»¥çœ‹æˆæ˜¯ä¸€æ®µå†…å­˜ï¼Œå„ä¸ªå­—æ®µéƒ½å¾—æŒ‰ç…§ä¸€å®šçš„é¡ºåºæ”¾åœ¨è¿™æ®µå†…å­˜é‡Œï¼ŒåŒæ—¶è€ƒè™‘åˆ°å¯¹é½è¦æ±‚ï¼Œå¯èƒ½è¿™äº›å­—æ®µä¸æ˜¯è¿ç»­æ”¾ç½®çš„ï¼Œ ç”¨è¿™ä¸ªæ–¹æ³•èƒ½å‡†ç¡®åœ°å‘Šè¯‰ä½ æŸä¸ªå­—æ®µç›¸å¯¹äºå¯¹è±¡çš„èµ·å§‹å†…å­˜åœ°å€çš„å­—èŠ‚åç§»é‡ï¼Œå› ä¸ºæ˜¯ç›¸å¯¹åç§»é‡ï¼Œæ‰€ä»¥å®ƒå…¶å®è·ŸæŸä¸ªå…·ä½“å¯¹è±¡åˆæ²¡ä»€ä¹ˆå¤ªå¤§å…³ç³»ï¼Œè·Ÿclassçš„å®šä¹‰å’Œè™šæ‹Ÿæœºçš„å†…å­˜æ¨¡å‹çš„å®ç°ç»†èŠ‚æ›´ç›¸å…³ã€‚ */ public class AtomicInteger extends Number implements java.io.Serializable { private static final long serialVersionUID = 6214790243416807050L; // setup to use Unsafe.compareAndSwapInt for updates private static final Unsafe unsafe = Unsafe.getUnsafe(); private static final long valueOffset; static { try { valueOffset = unsafe.objectFieldOffset (AtomicInteger.class.getDeclaredField(\u0026#34;value\u0026#34;)); } catch (Exception ex) { throw new Error(ex); } } private volatile int value; public final int getAndIncrement() { return unsafe.getAndAddInt(this, valueOffset, 1); } } å†é‡æ–°çœ‹è¿™æ®µä»£ç \n@HotSpotIntrinsicCandidate public final int getAndAddInt(Object o, long offset, int delta) { int v; do { v = getIntVolatile(o, offset); } while (!weakCompareAndSetInt(o, offset, v, v + delta)); return v; } è¿™é‡Œå£°æ˜äº†vï¼Œå³è¦è¿”å›çš„å€¼ï¼Œå³ä¸è®ºå¦‚ä½•éƒ½ä¼šè¿”å›åŸæ¥çš„å€¼(æ›´æ–°æˆåŠŸå‰çš„å€¼)ï¼Œç„¶åæ–°çš„å€¼ä¸ºv+delta\nä½¿ç”¨do-whileä¿è¯æ‰€æœ‰å¾ªç¯è‡³å°‘æ‰§è¡Œä¸€é\nå¾ªç¯ä½“çš„æ¡ä»¶æ˜¯ä¸€ä¸ªCASæ–¹æ³•ï¼š\npublic final boolean weakCompareAndSetInt(Object o, long offset, int expected, int x) { return compareAndSetInt(o, offset, expected, x); } public final native boolean compareAndSetInt(Object o, long offset, int expected, int x); æœ€ç»ˆè°ƒç”¨äº†nativeæ–¹æ³•ï¼šcompareAndSetIntæ–¹æ³•\nä¸ºç”šä¹ˆè¦ç»è¿‡ä¸€å±‚weakCompareAndSetIntï¼Œåœ¨JDK 8åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯ä¸€æ ·çš„ã€‚\nè€Œåœ¨JDK 9å¼€å§‹ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¸Šé¢å¢åŠ äº†@HotSpotIntrinsicCandidateæ³¨è§£ã€‚è¿™ä¸ªæ³¨è§£å…è®¸HotSpot VMè‡ªå·±æ¥å†™æ±‡ç¼–æˆ–IRç¼–è¯‘å™¨æ¥å®ç°è¯¥æ–¹æ³•ä»¥æä¾›æ€§èƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´è™½ç„¶å¤–é¢çœ‹åˆ°çš„åœ¨JDK9ä¸­weakCompareAndSetå’ŒcompareAndSetåº•å±‚ä¾æ—§æ˜¯è°ƒç”¨äº†ä¸€æ ·çš„ä»£ç ï¼Œä½†æ˜¯ä¸æ’é™¤HotSpot VMä¼šæ‰‹åŠ¨æ¥å®ç°weakCompareAndSetçœŸæ­£å«ä¹‰çš„åŠŸèƒ½çš„å¯èƒ½æ€§ã€‚\nç®€å•æ¥è¯´ï¼ŒweakCompareAndSetæ“ä½œä»…ä¿ç•™äº†volatileè‡ªèº«å˜é‡çš„ç‰¹æ€§ï¼Œè€Œé™¤å»äº†happens-beforeè§„åˆ™å¸¦æ¥çš„å†…å­˜è¯­ä¹‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒweakCompareAndSet**æ— æ³•ä¿è¯å¤„ç†æ“ä½œç›®æ ‡çš„volatileå˜é‡å¤–çš„å…¶ä»–å˜é‡çš„æ‰§è¡Œé¡ºåº( ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†ä¼˜åŒ–ç¨‹åºæ€§èƒ½è€Œå¯¹æŒ‡ä»¤åºåˆ—è¿›è¡Œé‡æ–°æ’åº )ï¼ŒåŒæ—¶ä¹Ÿæ— æ³•ä¿è¯è¿™äº›å˜é‡çš„å¯è§æ€§ã€‚**è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥æé«˜æ€§èƒ½ã€‚ï¼ˆæ²¡çœ‹æ‡‚ï¼‰\nCASå¦‚æœæ—§å€¼Vä¸ç­‰äºé¢„æœŸå€¼Eï¼Œå®ƒå°±ä¼šæ›´æ–°å¤±è´¥ã€‚è¯´æ˜æ—§çš„å€¼å‘ç”Ÿäº†å˜åŒ–ã€‚é‚£æˆ‘ä»¬å½“ç„¶éœ€è¦è¿”å›çš„æ˜¯è¢«å…¶ä»–çº¿ç¨‹æ”¹å˜ä¹‹åçš„æ—§å€¼äº†ï¼Œå› æ­¤æ”¾åœ¨äº†doå¾ªç¯ä½“å†…\nCASå®ç°åŸå­æ“ä½œçš„ä¸‰å¤§é—®é¢˜\nABAé—®é¢˜\nå°±æ˜¯ä¸€ä¸ªå€¼åŸæ¥æ˜¯Aï¼Œå˜æˆäº†Bï¼Œåˆå˜å›äº†Aã€‚è¿™ä¸ªæ—¶å€™ä½¿ç”¨CASæ˜¯æ£€æŸ¥ä¸å‡ºå˜åŒ–çš„ï¼Œä½†å®é™…ä¸Šå´è¢«æ›´æ–°äº†ä¸¤æ¬¡\nåœ¨å˜é‡å‰é¢è¿½åŠ ä¸Šç‰ˆæœ¬å·æˆ–è€…æ—¶é—´æˆ³ã€‚ä»JDK 1.5å¼€å§‹ï¼ŒJDKçš„atomicåŒ…é‡Œæä¾›äº†ä¸€ä¸ªç±»AtomicStampedReferenceç±»æ¥è§£å†³ABAé—®é¢˜\nAtomicStampedReferenceç±»çš„compareAndSetæ–¹æ³•çš„ä½œç”¨æ˜¯é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨æ˜¯å¦ç­‰äºé¢„æœŸå¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥å½“å‰æ ‡å¿—æ˜¯å¦ç­‰äºé¢„æœŸæ ‡å¿—ï¼Œå¦‚æœäºŒè€…éƒ½ç›¸ç­‰ï¼Œæ‰ä½¿ç”¨CASè®¾ç½®ä¸ºæ–°çš„å€¼å’Œæ ‡å¿—ã€‚\npublic boolean compareAndSet(V expectedReference, V newReference, int expectedStamp, int newStamp) { Pair\u0026lt;V\u0026gt; current = pair; return expectedReference == current.reference \u0026amp;\u0026amp; expectedStamp == current.stamp \u0026amp;\u0026amp; ((newReference == current.reference \u0026amp;\u0026amp; newStamp == current.stamp) || casPair(current, Pair.of(newReference, newStamp))); } å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§\nCASå¤šä¸è‡ªæ—‹ç»“åˆï¼Œå¦‚æœè‡ªæ—‹CASé•¿æ—¶é—´ä¸æˆåŠŸï¼Œåˆ™ä¼šå ç”¨å¤§é‡CPUèµ„æºï¼Œè§£å†³æ€è·¯æ˜¯è®©JVMæ”¯æŒå¤„ç†å™¨æä¾›çš„pauseæŒ‡ä»¤\npauseæŒ‡ä»¤èƒ½è®©è‡ªæ—‹å¤±è´¥æ—¶cpuç¡çœ ä¸€å°æ®µæ—¶é—´å†ç»§ç»­è‡ªæ—‹ï¼Œä»è€Œä½¿å¾—è¯»æ“ä½œçš„é¢‘ç‡ä½å¾ˆå¤š,ä¸ºè§£å†³å†…å­˜é¡ºåºå†²çªè€Œå¯¼è‡´çš„CPUæµæ°´çº¿é‡æ’çš„ä»£ä»·ä¹Ÿä¼šå°å¾ˆå¤šã€‚\né™åˆ¶æ¬¡æ•°ï¼ˆå¦‚æœå¯ä»¥æ”¾å¼ƒæ“ä½œçš„è¯ï¼‰\nåªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ\nä½¿ç”¨JDK 1.5å¼€å§‹å°±æä¾›çš„AtomicReferenceç±»ä¿è¯å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼ŒæŠŠå¤šä¸ªå˜é‡æ”¾åˆ°ä¸€ä¸ªå¯¹è±¡é‡Œé¢è¿›è¡ŒCASæ“ä½œï¼› ä½¿ç”¨é”ã€‚é”å†…çš„ä¸´ç•ŒåŒºä»£ç å¯ä»¥ä¿è¯åªæœ‰å½“å‰çº¿ç¨‹èƒ½æ“ä½œã€‚ AtomicIntegerçš„ä½¿ç”¨[éjavaguide] # //AtomicIntegerç±»å¸¸ç”¨æ–¹æ³•(ä¸‹é¢çš„è‡ªå¢ï¼Œéƒ½ä½¿ç”¨äº†CASï¼Œæ˜¯åŒæ­¥å®‰å…¨çš„) ublic final int get() //è·å–å½“å‰çš„å€¼ public final int getAndSet(int newValue)//è·å–å½“å‰çš„å€¼ï¼Œå¹¶è®¾ç½®æ–°çš„å€¼ public final int getAndIncrement()//è·å–å½“å‰çš„å€¼ï¼Œå¹¶è‡ªå¢ public final int getAndDecrement() //è·å–å½“å‰çš„å€¼ï¼Œå¹¶è‡ªå‡ public final int getAndAdd(int delta) //è·å–å½“å‰çš„å€¼ï¼Œå¹¶åŠ ä¸Šé¢„æœŸçš„å€¼ boolean compareAndSet(int expect, int update) //å¦‚æœè¾“å…¥çš„æ•°å€¼ç­‰äºé¢„æœŸå€¼ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†è¯¥å€¼è®¾ç½®ä¸ºè¾“å…¥å€¼ï¼ˆupdateï¼‰ public final void lazySet(int newValue)//æœ€ç»ˆè®¾ç½®ä¸ºnewValue,ä½¿ç”¨ lazySet è®¾ç½®ä¹‹åå¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹åœ¨ä¹‹åçš„ä¸€å°æ®µæ—¶é—´å†…è¿˜æ˜¯å¯ä»¥è¯»åˆ°æ—§çš„å€¼ã€‚ ------ //ä½¿ç”¨å¦‚ä¸‹ class AtomicIntegerTest { private AtomicInteger count = new AtomicInteger(); //ä½¿ç”¨AtomicIntegerä¹‹åï¼Œä¸éœ€è¦å¯¹è¯¥æ–¹æ³•åŠ é”ï¼Œä¹Ÿå¯ä»¥å®ç°çº¿ç¨‹å®‰å…¨ã€‚ public void increment() { count.incrementAndGet(); } public int getCount() { return count.get(); } } æµ…è°ˆAtomicIntegerå®ç°åŸç†[éjavaguide] # ä½äºJava.util.concurrent.atomicåŒ…ä¸‹ï¼Œå¯¹intå°è£…ï¼Œæä¾›åŸå­æ€§çš„è®¿é—®å’Œæ›´æ–°æ“ä½œï¼Œå…¶åŸå­æ€§æ“ä½œçš„å®ç°åŸºäºCASï¼ˆCompareAndSetï¼‰\nCASï¼Œæ¯”è¾ƒå¹¶äº¤æ¢ï¼ŒJavaå¹¶å‘ä¸­lock-freeæœºåˆ¶çš„åŸºç¡€ï¼Œè°ƒç”¨Sunçš„Unsafeçš„CompareAndSwapIntå®Œæˆï¼Œä¸ºnativeæ–¹æ³•ï¼ŒåŸºäºCPUçš„CASæŒ‡ä»¤æ¥å®ç°çš„ï¼Œå³æ— é˜»å¡ï¼›ä¸”ä¸ºCASåŸè¯­\nCASï¼šä¸‰ä¸ªå‚æ•°ï¼Œ1. å½“å‰å†…å­˜å€¼V 2.æ—§çš„é¢„æœŸå€¼ 3.å³å°†æ›´æ–°çš„å€¼ï¼Œå½“ä¸”ä»…å½“é¢„æœŸå€¼Aå’Œå†…å­˜å€¼ç›¸åŒæ—¶ï¼Œå°†å†…å­˜å€¼æ”¹ä¸º 8 å¹¶è¿”å›trueï¼›å¦åˆ™è¿”å›false åœ¨JAVAä¸­,CASé€šè¿‡è°ƒç”¨C++åº“å®ç°ï¼Œç”±C++åº“å†å»è°ƒç”¨CPUæŒ‡ä»¤é›†ã€‚\nCASç¡®å®š\nABAã€€é—®é¢˜ å¦‚æœæœŸé—´å‘ç”Ÿäº† A -\u0026gt; B -\u0026gt; A çš„æ›´æ–°ï¼Œä»…ä»…åˆ¤æ–­æ•°å€¼æ˜¯ Aï¼Œå¯èƒ½å¯¼è‡´ä¸åˆç†çš„ä¿®æ”¹æ“ä½œï¼›ä¸ºæ­¤ï¼Œæä¾›äº†AtomicStampedReference å·¥å…·ç±»ï¼Œä¸ºå¼•ç”¨å»ºç«‹ç±»ä¼¼ç‰ˆæœ¬å·ï½“ï½”ï½ï½ï½çš„æ–¹å¼\nå¾ªç¯æ—¶é—´é•¿ï¼Œå¼€é”€å¤§ã€‚CASé€‚ç”¨äºç«äº‰æƒ…å†µçŸ­æš‚çš„æƒ…å†µï¼Œæœ‰éœ€è¦çš„æ—¶å€™è¦é™åˆ¶è‡ªæ—‹æ¬¡æ•°ï¼Œä»¥å…è¿‡åº¦æ¶ˆè€—CPU\nåªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ å¯¹å¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼Œå¾ªç¯CASå°±æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç”¨é”ï¼›æˆ–è€…å–å·§ä¸€ä¸‹ï¼Œæ¯”å¦‚ i = 2 , j = a ï¼Œåˆå¹¶åä¸º ij = 2a ï¼Œç„¶åcasæ“ä½œ2a\nJava1.5å¼€å§‹JDKæä¾›äº†AtomicReferenceç±»æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œä½ å¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡ŒCASæ“ä½œï¼Œä¾‹å­å¦‚ä¸‹ï¼š å¦‚å›¾ï¼Œå®ƒæ˜¯åŒæ—¶æ›´æ–°äº†ä¸¤ä¸ªå˜é‡ï¼Œè€Œè¿™ä¸¤ä¸ªå˜é‡éƒ½åœ¨æ–°çš„å¯¹è±¡ä¸Šï¼Œæ‰€ä»¥å°±èƒ½è§£å†³å¤šä¸ªå…±äº«å˜é‡çš„é—®é¢˜ï¼Œå³â€œå°†é—®é¢˜è½¬æ¢æˆï¼Œå¦‚æœå˜é‡æ›´æ–°äº†ï¼Œåˆ™æ›´æ¢ä¸€ä¸ªå¯¹è±¡â€\nAtomicIntegeråŸç†æµ…æ\nä¸€äº›å…¬å…±å±æ€§ï¼š\npublic class AtomicInteger extends Number implements java.io.Serializable { private static final long serialVersionUID = 6214790243416807050L; // setup to use Unsafe.compareAndSwapInt for updates private static final Unsafe unsafe = Unsafe.getUnsafe(); private static final long valueOffset; static { try { valueOffset = unsafe.objectFieldOffset (AtomicInteger.class.getDeclaredField(\u0026#34;value\u0026#34;)); } catch (Exception ex) { throw new Error(ex); } } private volatile int value; } AtomicIntegerï¼Œæ ¹æ®valueOffsetä»£è¡¨çš„è¯¥å˜é‡å€¼ï¼Œåœ¨å†…å­˜ä¸­çš„åç§»åœ°å€ï¼Œä»è€Œè·å–æ•°æ®ï¼›ä¸”valueç”¨volatileä¿®é¥°ï¼Œä¿è¯å¤šçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§\npublic final int getAndIncrement() { return unsafe.getAndAddInt(this, valueOffset, 1); } //unsafe.getAndAddInt public final int getAndAddInt(Object var1, long var2, int var4) { int var5; do { var5 = this.getIntVolatile(var1, var2); } while(!this.compareAndSwapInt(var1, var2, var5, var5 + var4));//å…ˆè·å–var1å¯¹è±¡çš„åç§»é‡ä¸ºvar2çš„å†…å­˜åœ°å€ä¸Šçš„å€¼ã€ç°åœ¨çš„å®é™…å€¼ã€‘ //å¦‚æœæ­¤åˆ»è¿˜æ˜¯var5ï¼Œ+1å¹¶èµ‹å€¼ï¼Œå¦åˆ™é‡æ–°è·å– return var5; } å‡è®¾çº¿ç¨‹1å’Œçº¿ç¨‹2é€šè¿‡getIntVolatileæ‹¿åˆ°valueçš„å€¼éƒ½ä¸º1ï¼Œçº¿ç¨‹1è¢«æŒ‚èµ·ï¼Œçº¿ç¨‹2ç»§ç»­æ‰§è¡Œ ï¼ˆè¿™é‡Œæ˜¯éåŸå­çš„å“¦ï¼‰ çº¿ç¨‹2åœ¨compareAndSwapIntæ“ä½œä¸­ç”±äºé¢„æœŸå€¼å’Œå†…å­˜å€¼éƒ½ä¸º1ï¼Œå› æ­¤æˆåŠŸå°†å†…å­˜å€¼æ›´æ–°ä¸º2 çº¿ç¨‹1ç»§ç»­æ‰§è¡Œï¼Œåœ¨compareAndSwapIntæ“ä½œä¸­ï¼Œé¢„æœŸå€¼æ˜¯1ï¼Œè€Œå½“å‰çš„å†…å­˜å€¼ä¸º2ï¼ŒCASæ“ä½œå¤±è´¥ï¼Œä»€ä¹ˆéƒ½ä¸åšï¼Œè¿”å›false çº¿ç¨‹1é‡æ–°é€šè¿‡getIntVolatileæ‹¿åˆ°æœ€æ–°çš„valueä¸º2ï¼Œå†è¿›è¡Œä¸€æ¬¡compareAndSwapIntæ“ä½œï¼Œè¿™æ¬¡æ“ä½œæˆåŠŸï¼Œå†…å­˜å€¼æ›´æ–°ä¸º3 åŸå­æ“ä½œçš„å®ç°åŸç†\nJavaä¸­çš„CASæ“ä½œæ­£æ˜¯åˆ©ç”¨äº†å¤„ç†å™¨æä¾›çš„CMPXCHGæŒ‡ä»¤å®ç°çš„ã€‚è‡ªæ—‹CASå®ç°çš„åŸºæœ¬æ€è·¯å°±æ˜¯å¾ªç¯è¿›è¡ŒCASæ“ä½œç›´åˆ°æ“ä½œæˆåŠŸä¸ºæ­¢ã€‚ åœ¨CASä¸­æœ‰ä¸‰ä¸ªæ“ä½œæ•°ï¼šåˆ†åˆ«æ˜¯å†…å­˜åœ°å€ï¼ˆåœ¨Javaä¸­å¯ä»¥ç®€å•ç†è§£ä¸ºå˜é‡çš„å†…å­˜åœ°å€ï¼Œç”¨Vè¡¨ç¤ºï¼Œè¦è·å–å®æ—¶å€¼ï¼‰ã€æ—§çš„é¢„æœŸå€¼ï¼ˆç”¨Aè¡¨ç¤º,[æ“ä½œä¹‹å‰ä¿å­˜çš„]ï¼‰å’Œæ–°å€¼ï¼ˆç”¨Bè¡¨ç¤ºï¼‰ã€‚CASæŒ‡ä»¤æ‰§è¡Œæ—¶ï¼Œå½“ä¸”ä»…å½“Vç¬¦åˆæ—§çš„é¢„æœŸå€¼Aæ—¶ï¼Œå¤„ç†å™¨æ‰ä¼šç”¨æ–°å€¼Bæ›´æ–°Vçš„å€¼ï¼Œå¦åˆ™ä»–å°±ä¸æ‰§è¡Œæ›´æ–°ï¼Œä½†æ— è®ºæ˜¯å¦æ›´æ–°äº†Vçš„å€¼ï¼Œéƒ½ä¼šè¿”å›Vçš„æ—§å€¼ã€‚(è¿™é‡Œè¯´çš„ä¸‰ä¸ªå€¼ï¼ŒæŒ‡çš„æ˜¯é€»è¾‘æ¦‚å¿µï¼Œè€Œä¸æ˜¯å®é™…æ¦‚å¿µ) "},{"id":104,"href":"/zh/docs/study/Review/java_guide/database/MySQL/ly0611lymysql-high-performance-optimization-specification-recommendations/","title":"MySQLé«˜æ€§èƒ½ä¼˜åŒ–è§„èŒƒå»ºè®®æ€»ç»“","section":"MySQL","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nç´¢å¼•ä¼˜åŒ–ç›¸å…³\nin ä»£æ›¿ or not exist ä»£æ›¿ not in æ•°æ®åº“å‘½åè§„èŒƒ # æ‰€æœ‰æ•°æ®åº“å¯¹è±¡åç§°å¿…é¡»ä½¿ç”¨å°å†™å­—æ¯å¹¶ç”¨ä¸‹åˆ’çº¿åˆ†å‰² æ‰€æœ‰æ•°æ®åº“å¯¹è±¡åç§°ç¦æ­¢ä½¿ç”¨ MySQL ä¿ç•™å…³é”®å­—ï¼ˆå¦‚æœè¡¨åä¸­åŒ…å«å…³é”®å­—æŸ¥è¯¢æ—¶ï¼Œéœ€è¦å°†å…¶ç”¨å•å¼•å·æ‹¬èµ·æ¥ï¼‰ æ•°æ®åº“å¯¹è±¡çš„å‘½åè¦èƒ½åšåˆ°è§åè¯†æ„ï¼Œå¹¶ä¸”æœ€å¥½ä¸è¦è¶…è¿‡ 32 ä¸ªå­—ç¬¦ ä¸´æ—¶åº“è¡¨å¿…é¡»ä»¥ tmp_ ä¸ºå‰ç¼€å¹¶ä»¥æ—¥æœŸä¸ºåç¼€ï¼Œå¤‡ä»½è¡¨å¿…é¡»ä»¥ bak_ ä¸ºå‰ç¼€å¹¶ä»¥æ—¥æœŸ (æ—¶é—´æˆ³) ä¸ºåç¼€ æ‰€æœ‰å­˜å‚¨ç›¸åŒæ•°æ®çš„åˆ—åå’Œåˆ—ç±»å‹å¿…é¡»ä¸€è‡´ï¼ˆä¸€èˆ¬ä½œä¸ºå…³è”åˆ—ï¼Œå¦‚æœæŸ¥è¯¢æ—¶å…³è”åˆ—ç±»å‹ä¸ä¸€è‡´ä¼šè‡ªåŠ¨è¿›è¡Œæ•°æ®ç±»å‹éšå¼è½¬æ¢ï¼Œä¼šé€ æˆåˆ—ä¸Šçš„ç´¢å¼•å¤±æ•ˆï¼Œå¯¼è‡´æŸ¥è¯¢æ•ˆç‡é™ä½ï¼‰ æ•°æ®åº“åŸºæœ¬è®¾è®¡è§„èŒƒ # æ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“ # æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼ˆå³ InnoDB æ— æ³•æ»¡è¶³çš„åŠŸèƒ½å¦‚ï¼šåˆ—å­˜å‚¨ï¼Œå­˜å‚¨ç©ºé—´æ•°æ®ç­‰ï¼‰çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“ï¼ˆMySQL5.5 ä¹‹å‰é»˜è®¤ä½¿ç”¨ Myisamï¼Œ5.6 ä»¥åé»˜è®¤çš„ä¸º InnoDBï¼‰ã€‚ InnoDB æ”¯æŒäº‹åŠ¡ï¼Œæ”¯æŒè¡Œçº§é”ï¼Œæ›´å¥½çš„æ¢å¤æ€§ï¼Œé«˜å¹¶å‘ä¸‹æ€§èƒ½æ›´å¥½ æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨UTF-8 # å…¼å®¹æ€§æ›´å¥½ï¼Œç»Ÿä¸€å­—ç¬¦é›†å¯ä»¥é¿å…ç”±äºå­—ç¬¦é›†è½¬æ¢äº§ç”Ÿçš„ä¹±ç ï¼Œä¸åŒçš„å­—ç¬¦é›†è¿›è¡Œæ¯”è¾ƒå‰éœ€è¦è¿›è¡Œè½¬æ¢ä¼šé€ æˆç´¢å¼•å¤±æ•ˆï¼Œå¦‚æœæ•°æ®åº“ä¸­æœ‰å­˜å‚¨ emoji è¡¨æƒ…çš„éœ€è¦ï¼Œå­—ç¬¦é›†éœ€è¦é‡‡ç”¨ utf8mb4 å­—ç¬¦é›†ã€‚\nå‚è€ƒæ–‡ç« ï¼š\nMySQL å­—ç¬¦é›†ä¸ä¸€è‡´å¯¼è‡´ç´¢å¼•å¤±æ•ˆçš„ä¸€ä¸ªçœŸå®æ¡ˆä¾‹open in new window [MySQL å­—ç¬¦é›†è¯¦è§£ æ‰€æœ‰è¡¨å’Œå­—æ®µéƒ½éœ€è¦æ·»åŠ æ³¨é‡Š # ä½¿ç”¨ comment ä»å¥æ·»åŠ è¡¨å’Œåˆ—çš„å¤‡æ³¨ï¼Œä»ä¸€å¼€å§‹å°±è¿›è¡Œæ•°æ®å­—å…¸çš„ç»´æŠ¤\nå°½é‡æ§åˆ¶å•è¡¨æ•°æ®é‡çš„å¤§å°ï¼Œå»ºè®®æ§åˆ¶åœ¨500ä¸‡ä»¥å†… # 500 ä¸‡å¹¶ä¸æ˜¯ MySQL æ•°æ®åº“çš„é™åˆ¶ï¼Œè¿‡å¤§ä¼šé€ æˆä¿®æ”¹è¡¨ç»“æ„ï¼Œå¤‡ä»½ï¼Œæ¢å¤éƒ½ä¼šæœ‰å¾ˆå¤§çš„é—®é¢˜ã€‚\nå¯ä»¥ç”¨å†å²æ•°æ®å½’æ¡£ï¼ˆåº”ç”¨äºæ—¥å¿—æ•°æ®ï¼‰ï¼Œ**åˆ†åº“åˆ†è¡¨ï¼ˆåº”ç”¨äºä¸šåŠ¡æ•°æ®ï¼‰**ç­‰æ‰‹æ®µæ¥æ§åˆ¶æ•°æ®é‡å¤§å°\nè°¨æ…ä½¿ç”¨MySQLåˆ†åŒºè¡¨ # åˆ†åŒºè¡¨åœ¨ç‰©ç†ä¸Šè¡¨ç°ä¸ºå¤šä¸ªæ–‡ä»¶ï¼Œåœ¨é€»è¾‘ä¸Šè¡¨ç°ä¸ºä¸€ä¸ªè¡¨ï¼›\nè°¨æ…é€‰æ‹©åˆ†åŒºé”®ï¼Œè·¨åˆ†åŒºæŸ¥è¯¢æ•ˆç‡å¯èƒ½æ›´ä½ï¼›\nå»ºè®®é‡‡ç”¨ç‰©ç†åˆ†è¡¨çš„æ–¹å¼ç®¡ç†å¤§æ•°æ®ã€‚\nç»å¸¸ä¸€èµ·ä½¿ç”¨çš„åˆ—æ”¾åˆ°ä¸€ä¸ªè¡¨ä¸­ # é¿å…æ›´å¤šçš„å…³è”æ“ä½œã€‚\nç¦æ­¢åœ¨è¡¨ä¸­å»ºç«‹é¢„ç•™å­—æ®µ # é¢„ç•™å­—æ®µçš„å‘½åå¾ˆéš¾åšåˆ°è§åè¯†ä¹‰ã€‚ é¢„ç•™å­—æ®µæ— æ³•ç¡®è®¤å­˜å‚¨çš„æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥æ— æ³•é€‰æ‹©åˆé€‚çš„ç±»å‹ã€‚ å¯¹é¢„ç•™å­—æ®µç±»å‹çš„ä¿®æ”¹ï¼Œä¼šå¯¹è¡¨è¿›è¡Œé”å®š ç¦æ­¢åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ–‡æœ¬ï¼ˆæ¯”å¦‚å›¾ç‰‡ï¼‰è¿™ç±»å¤§çš„äºŒè¿›åˆ¶æ•°æ® # åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ–‡ä»¶ä¼šä¸¥é‡å½±å“æ•°æ®åº“æ€§èƒ½ï¼Œæ¶ˆè€—è¿‡å¤šå­˜å‚¨ç©ºé—´ã€‚\næ–‡ä»¶ï¼ˆæ¯”å¦‚å›¾ç‰‡ï¼‰è¿™ç±»å¤§çš„äºŒè¿›åˆ¶æ•°æ®é€šå¸¸å­˜å‚¨äºæ–‡ä»¶æœåŠ¡å™¨ï¼Œæ•°æ®åº“åªå­˜å‚¨æ–‡ä»¶åœ°å€ä¿¡æ¯ã€‚\nä¸è¦è¢«æ•°æ®åº“èŒƒå¼æ‰€æŸç¼š # ä¸€èˆ¬æ¥è¯´ï¼Œè®¾è®¡å…³ç³»æ•°æ®åº“æ—¶éœ€è¦æ»¡è¶³ç¬¬ä¸‰èŒƒå¼ï¼Œä½†ä¸ºäº†æ»¡è¶³ç¬¬ä¸‰èŒƒå¼ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ‹†åˆ†å‡ºå¤šå¼ è¡¨ã€‚è€Œåœ¨è¿›è¡ŒæŸ¥è¯¢æ—¶éœ€è¦å¯¹å¤šå¼ è¡¨è¿›è¡Œå…³è”æŸ¥è¯¢ï¼Œæœ‰æ—¶ä¸ºäº†æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œä¼šé™ä½èŒƒå¼çš„è¦æ±‚ï¼Œåœ¨è¡¨ä¸­ä¿å­˜ä¸€å®šçš„å†—ä½™ä¿¡æ¯ï¼Œä¹Ÿå«åšåèŒƒå¼ã€‚ä½†è¦æ³¨æ„åèŒƒå¼ä¸€å®šè¦é€‚åº¦ã€‚\nç¦æ­¢åœ¨çº¿ä¸Šåšæ•°æ®åº“å‹åŠ›æµ‹è¯• # ç¦æ­¢ä»å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒï¼Œç›´æ¥è¿æ¥ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“ # å®‰å…¨éšæ‚£æå¤§ï¼Œè¦å¯¹ç”Ÿäº§ç¯å¢ƒæŠ±æœ‰æ•¬ç•ä¹‹å¿ƒï¼\næ•°æ®åº“å­—æ®µè®¾è®¡è§„èŒƒ # ä¼˜å…ˆé€‰æ‹©ç¬¦åˆå­˜å‚¨éœ€è¦çš„æœ€å°æ•°æ®ç±»å‹ # Byteï¼šå­—èŠ‚\nå­˜å‚¨å­—èŠ‚è¶Šå°ï¼Œå ç”¨ä¹Ÿå°±ç©ºé—´è¶Šå°ï¼Œæ€§èƒ½ä¹Ÿè¶Šå¥½ã€‚\na.æŸäº›å­—ç¬¦ä¸²å¯ä»¥è½¬æ¢æˆæ•°å­—ç±»å‹å­˜å‚¨æ¯”å¦‚å¯ä»¥å°† IP åœ°å€è½¬æ¢æˆæ•´å‹æ•°æ®ã€‚\næ•°å­—æ˜¯è¿ç»­çš„ï¼Œæ€§èƒ½æ›´å¥½ï¼Œå ç”¨ç©ºé—´ä¹Ÿæ›´å°ã€‚\nMySQL æä¾›äº†ä¸¤ä¸ªæ–¹æ³•æ¥å¤„ç† ip åœ°å€\nINET_ATON() ï¼š æŠŠ ip è½¬ä¸ºæ— ç¬¦å·æ•´å‹ (4-8 ä½) INET_NTOA() :æŠŠæ•´å‹çš„ ip è½¬ä¸ºåœ°å€ æ’å…¥æ•°æ®å‰ï¼Œå…ˆç”¨ INET_ATON() æŠŠ ip åœ°å€è½¬ä¸ºæ•´å‹ï¼Œæ˜¾ç¤ºæ•°æ®æ—¶ï¼Œä½¿ç”¨ INET_NTOA() æŠŠæ•´å‹çš„ ip åœ°å€è½¬ä¸ºåœ°å€æ˜¾ç¤ºå³å¯ã€‚\nb.å¯¹äºéè´Ÿå‹çš„æ•°æ® (å¦‚è‡ªå¢ ID,æ•´å‹ IPï¼Œå¹´é¾„) æ¥è¯´,è¦ä¼˜å…ˆä½¿ç”¨æ— ç¬¦å·æ•´å‹æ¥å­˜å‚¨ã€‚\næ— ç¬¦å·ç›¸å¯¹äºæœ‰ç¬¦å·å¯ä»¥å¤šå‡ºä¸€å€çš„å­˜å‚¨ç©ºé—´\nSIGNED INT -2147483648~2147483647 UNSIGNED INT 0~4294967295 c.å°æ•°å€¼ç±»å‹ï¼ˆæ¯”å¦‚å¹´é¾„ã€çŠ¶æ€è¡¨ç¤ºå¦‚ 0/1ï¼‰ä¼˜å…ˆä½¿ç”¨ TINYINT ç±»å‹ã€‚\né¿å…ä½¿ç”¨TEXTã€BLOBæ•°æ®ç±»å‹ï¼Œæœ€å¸¸è§çš„TEXTç±»å‹å¯ä»¥å­˜å‚¨64kçš„æ•°æ® # a. å»ºè®®æŠŠ BLOB æˆ–æ˜¯ TEXT åˆ—åˆ†ç¦»åˆ°å•ç‹¬çš„æ‰©å±•è¡¨ä¸­ã€‚\nMySQL å†…å­˜ä¸´æ—¶è¡¨ä¸æ”¯æŒ TEXTã€BLOB è¿™æ ·çš„å¤§æ•°æ®ç±»å‹ï¼Œå¦‚æœæŸ¥è¯¢ä¸­åŒ…å«è¿™æ ·çš„æ•°æ®ï¼Œåœ¨æ’åºç­‰æ“ä½œæ—¶ï¼Œå°±ä¸èƒ½ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨ï¼Œå¿…é¡»ä½¿ç”¨ç£ç›˜ä¸´æ—¶è¡¨è¿›è¡Œã€‚è€Œä¸”å¯¹äºè¿™ç§æ•°æ®ï¼ŒMySQL è¿˜æ˜¯è¦è¿›è¡ŒäºŒæ¬¡æŸ¥è¯¢ï¼Œä¼šä½¿ sql æ€§èƒ½å˜å¾—å¾ˆå·®ï¼Œä½†æ˜¯ä¸æ˜¯è¯´ä¸€å®šä¸èƒ½ä½¿ç”¨è¿™æ ·çš„æ•°æ®ç±»å‹ã€‚\nå¦‚æœä¸€å®šè¦ä½¿ç”¨ï¼Œå»ºè®®æŠŠ BLOB æˆ–æ˜¯ TEXT åˆ—åˆ†ç¦»åˆ°å•ç‹¬çš„æ‰©å±•è¡¨ä¸­ï¼ŒæŸ¥è¯¢æ—¶ä¸€å®šä¸è¦ä½¿ç”¨ select *è€Œåªéœ€è¦å–å‡ºå¿…è¦çš„åˆ—ï¼Œä¸éœ€è¦ TEXT åˆ—çš„æ•°æ®æ—¶ä¸è¦å¯¹è¯¥åˆ—è¿›è¡ŒæŸ¥è¯¢ã€‚\n2ã€TEXT æˆ– BLOB ç±»å‹åªèƒ½ä½¿ç”¨å‰ç¼€ç´¢å¼•\nå› ä¸º MySQL å¯¹ç´¢å¼•å­—æ®µé•¿åº¦æ˜¯æœ‰é™åˆ¶çš„ï¼Œæ‰€ä»¥ TEXT ç±»å‹åªèƒ½ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œå¹¶ä¸” TEXT åˆ—ä¸Šæ˜¯ä¸èƒ½æœ‰é»˜è®¤å€¼çš„\né¿å…ä½¿ç”¨ENUMç±»å‹ # åŸå› ï¼š\nä¿®æ”¹ ENUM å€¼éœ€è¦ä½¿ç”¨ ALTER è¯­å¥ï¼› ENUM ç±»å‹çš„ ORDER BY æ“ä½œæ•ˆç‡ä½ï¼Œéœ€è¦é¢å¤–æ“ä½œï¼› ENUM æ•°æ®ç±»å‹å­˜åœ¨ä¸€äº›é™åˆ¶æ¯”å¦‚å»ºè®®ä¸è¦ä½¿ç”¨æ•°å€¼ä½œä¸º ENUM çš„æšä¸¾å€¼ã€‚ ç›¸å…³é˜…è¯»ï¼šæ˜¯å¦æ¨èä½¿ç”¨ MySQL çš„ enum ç±»å‹ï¼Ÿ - æ¶æ„æ–‡æ‘˜ - çŸ¥ä¹open in new window\nå°½å¯èƒ½æŠŠæ‰€æœ‰çš„åˆ—å®šä¹‰ä¸ºNOT NULL # é™¤éæœ‰ç‰¹åˆ«çš„åŸå› ä½¿ç”¨ NULL å€¼ï¼Œåº”è¯¥æ€»æ˜¯è®©å­—æ®µä¿æŒ NOT NULLã€‚\nç´¢å¼• NULL åˆ—éœ€è¦é¢å¤–çš„ç©ºé—´æ¥ä¿å­˜ï¼Œæ‰€ä»¥è¦å ç”¨æ›´å¤šçš„ç©ºé—´ï¼›\nè¯¥ä½æŒ‡ç¤ºäº†è¯¥è¡Œæ•°æ®ä¸­æ˜¯å¦æœ‰NULLå€¼ï¼Œæœ‰åˆ™ä½¿ç”¨1æ¥è¡¨ç¤ºï¼Œè¯¥éƒ¨åˆ†å çš„å­—èŠ‚å¤§å°å¤§æ¦‚ä¸º1å­—èŠ‚ï¼Œæ¯”å¦‚å½“NULLæ ‡å¿—ä½ä¸º06æ—¶ï¼Œ06è½¬æ¢ä¸ºäºŒè¿›åˆ¶ä¸º110ï¼Œè¡¨ç¤ºç¬¬äºŒåˆ—å’Œç¬¬ä¸‰åˆ—ä¸ºNULLã€‚\nè¿›è¡Œæ¯”è¾ƒå’Œè®¡ç®—æ—¶è¦å¯¹ NULL å€¼åšç‰¹åˆ«çš„å¤„ç†ã€‚\nç›¸å…³é˜…è¯»ï¼šæŠ€æœ¯åˆ†äº« | MySQL é»˜è®¤å€¼é€‰å‹ï¼ˆæ˜¯ç©ºï¼Œè¿˜æ˜¯ NULLï¼‰open in new window ã€‚\nä½¿ç”¨TIMESTAMP(4ä¸ªå­—èŠ‚)æˆ–DATETIMEç±»å‹ï¼ˆ8ä¸ªå­—èŠ‚ï¼‰å­˜å‚¨æ—¶é—´ # TIMESTAMP å­˜å‚¨çš„æ—¶é—´èŒƒå›´ 1970-01-01 00:00:01 ~ 2038-01-19-03:14:07\nTIMESTAMP å ç”¨ 4 å­—èŠ‚å’Œ INT ç›¸åŒï¼Œä½†æ¯” INT å¯è¯»æ€§é«˜\nè¶…å‡º TIMESTAMP å–å€¼èŒƒå›´çš„ä½¿ç”¨ DATETIME ç±»å‹å­˜å‚¨\nåä¹‹ï¼Œ ç»å¸¸ä¼šæœ‰äººç”¨å­—ç¬¦ä¸²å­˜å‚¨æ—¥æœŸå‹çš„æ•°æ®**ï¼ˆä¸æ­£ç¡®çš„åšæ³•ï¼‰**\nç¼ºç‚¹ 1ï¼šæ— æ³•ç”¨æ—¥æœŸå‡½æ•°è¿›è¡Œè®¡ç®—å’Œæ¯”è¾ƒ ç¼ºç‚¹ 2ï¼šç”¨å­—ç¬¦ä¸²å­˜å‚¨æ—¥æœŸè¦å ç”¨æ›´å¤šçš„ç©ºé—´ åŒè´¢åŠ¡ç›¸å…³çš„é‡‘é¢ç±»æ•°æ®å¿…é¡»ä½¿ç”¨decimalç±»å‹ # éç²¾å‡†æµ®ç‚¹ ï¼šfloat,double ç²¾å‡†æµ®ç‚¹ ï¼šdecimal decimal ç±»å‹ä¸ºç²¾å‡†æµ®ç‚¹æ•°ï¼Œåœ¨è®¡ç®—æ—¶ä¸ä¼šä¸¢å¤±ç²¾åº¦ã€‚å ç”¨ç©ºé—´ç”±å®šä¹‰çš„å®½åº¦å†³å®šï¼Œæ¯ 4 ä¸ªå­—èŠ‚å¯ä»¥å­˜å‚¨ 9 ä½æ•°å­—ï¼Œå¹¶ä¸”å°æ•°ç‚¹è¦å ç”¨ä¸€ä¸ªå­—èŠ‚ã€‚å¹¶ä¸”ï¼Œdecimal å¯ç”¨äºå­˜å‚¨æ¯” bigint æ›´å¤§çš„æ•´å‹æ•°æ®\nä¸è¿‡ï¼Œ ç”±äº decimal éœ€è¦é¢å¤–çš„ç©ºé—´å’Œè®¡ç®—å¼€é”€ï¼Œåº”è¯¥å°½é‡åªåœ¨éœ€è¦å¯¹æ•°æ®è¿›è¡Œç²¾ç¡®è®¡ç®—æ—¶æ‰ä½¿ç”¨ decimal ã€‚\nå•è¡¨ä¸è¦åŒ…å«è¿‡å¤šå­—æ®µ # å¦‚æœä¸€ä¸ªè¡¨åŒ…å«è¿‡å¤šå­—æ®µçš„è¯ï¼Œå¯ä»¥è€ƒè™‘å°†å…¶åˆ†è§£æˆå¤šä¸ªè¡¨ï¼Œå¿…è¦æ—¶å¢åŠ ä¸­é—´è¡¨è¿›è¡Œå…³è”ã€‚\nç´¢å¼•è®¾è®¡è§„èŒƒ # é™åˆ¶æ¯å¼ è¡¨ä¸Šçš„ç´¢å¼•æ•°é‡ï¼Œå»ºè®®å•å¼ è¡¨ç´¢å¼•ä¸è¶…è¿‡5ä¸ª # ç´¢å¼•å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼ç´¢å¼•å¯ä»¥æé«˜æ•ˆç‡åŒæ ·å¯ä»¥é™ä½æ•ˆç‡ã€‚\nç´¢å¼•å¯ä»¥å¢åŠ æŸ¥è¯¢æ•ˆç‡ï¼Œä½†åŒæ ·ä¹Ÿä¼šé™ä½æ’å…¥å’Œæ›´æ–°çš„æ•ˆç‡ï¼Œç”šè‡³æœ‰äº›æƒ…å†µä¸‹ä¼šé™ä½æŸ¥è¯¢æ•ˆç‡ã€‚\nå› ä¸º MySQL ä¼˜åŒ–å™¨åœ¨é€‰æ‹©å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢æ—¶ï¼Œä¼šæ ¹æ®ç»Ÿä¸€ä¿¡æ¯ï¼Œå¯¹æ¯ä¸€ä¸ªå¯ä»¥ç”¨åˆ°çš„ç´¢å¼•æ¥è¿›è¡Œè¯„ä¼°ï¼Œä»¥ç”Ÿæˆå‡ºä¸€ä¸ªæœ€å¥½çš„æ‰§è¡Œè®¡åˆ’ï¼Œå¦‚æœåŒæ—¶æœ‰å¾ˆå¤šä¸ªç´¢å¼•éƒ½å¯ä»¥ç”¨äºæŸ¥è¯¢ï¼Œå°±ä¼šå¢åŠ  MySQL ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ï¼ŒåŒæ ·ä¼šé™ä½æŸ¥è¯¢æ€§èƒ½ã€‚\nç¦æ­¢ä½¿ç”¨å…¨æ–‡ç´¢å¼• # å…¨æ–‡ç´¢å¼•ä¸é€‚ç”¨äº OLTP åœºæ™¯ã€‚\nOn-Line Transaction Processingè”æœºäº‹åŠ¡å¤„ç†è¿‡ç¨‹(OLTP)ï¼Œä¹Ÿç§°ä¸ºé¢å‘äº¤æ˜“çš„å¤„ç†è¿‡ç¨‹\nç¦æ­¢ç»™è¡¨ä¸­çš„æ¯ä¸€åˆ—éƒ½å»ºç«‹å•ç‹¬çš„ç´¢å¼• # 5.6 ç‰ˆæœ¬ä¹‹å‰ï¼Œä¸€ä¸ª sql åªèƒ½ä½¿ç”¨åˆ°ä¸€ä¸ªè¡¨ä¸­çš„ä¸€ä¸ªç´¢å¼•ï¼Œ5.6 ä»¥åï¼Œè™½ç„¶æœ‰äº†åˆå¹¶ç´¢å¼•çš„ä¼˜åŒ–æ–¹å¼ï¼Œä½†æ˜¯è¿˜æ˜¯è¿œè¿œæ²¡æœ‰ä½¿ç”¨ä¸€ä¸ªè”åˆç´¢å¼•çš„æŸ¥è¯¢æ–¹å¼å¥½\nå°½é‡ä½¿ç”¨è”åˆç´¢å¼•\næ¯ä¸ªInnoDBè¡¨å¿…é¡»æœ‰ä¸ªä¸»é”® # InnoDB æ˜¯ä¸€ç§ç´¢å¼•ç»„ç»‡è¡¨ï¼šæ•°æ®çš„å­˜å‚¨çš„é€»è¾‘é¡ºåºå’Œç´¢å¼•çš„é¡ºåºæ˜¯ç›¸åŒçš„ã€‚æ¯ä¸ªè¡¨éƒ½å¯ä»¥æœ‰å¤šä¸ªç´¢å¼•ï¼Œä½†æ˜¯è¡¨çš„å­˜å‚¨é¡ºåºåªèƒ½æœ‰ä¸€ç§ã€‚ InnoDB æ˜¯æŒ‰ç…§ä¸»é”®ç´¢å¼•çš„é¡ºåºæ¥ç»„ç»‡è¡¨çš„ ä¸è¦ä½¿ç”¨æ›´æ–°é¢‘ç¹çš„åˆ—ä½œä¸ºä¸»é”®ï¼Œä¸é€‚ç”¨(ä½¿ç”¨)å¤šåˆ—ä¸»é”®ï¼ˆç›¸å½“äºè”åˆç´¢å¼•ï¼‰ ä¸è¦ä½¿ç”¨ UUID,MD5,HASH,å­—ç¬¦ä¸²åˆ—ä½œä¸ºä¸»é”®ï¼ˆæ— æ³•ä¿è¯æ•°æ®çš„é¡ºåºå¢é•¿ï¼‰ ä¸»é”®å»ºè®®ä½¿ç”¨è‡ªå¢ ID å€¼ å¸¸è§ç´¢å¼•åˆ—å»ºè®® # å‡ºç°åœ¨ SELECTã€UPDATEã€DELETE è¯­å¥çš„ WHERE ä»å¥ä¸­çš„åˆ—\nåŒ…å«åœ¨ ORDER BYã€GROUP BYã€DISTINCT ä¸­çš„å­—æ®µ\nå¹¶ä¸è¦å°†ç¬¦åˆ 1 å’Œ 2 ä¸­çš„å­—æ®µçš„åˆ—éƒ½å»ºç«‹ä¸€ä¸ªç´¢å¼•ï¼Œ é€šå¸¸å°† 1ã€2 ä¸­çš„å­—æ®µå»ºç«‹è”åˆç´¢å¼•æ•ˆæœæ›´å¥½\nå¤šè¡¨ join çš„å…³è”åˆ—\nå¦‚ä½•é€‰æ‹©ç´¢å¼•åˆ—çš„é¡ºåº # å»ºç«‹ç´¢å¼•çš„ç›®çš„æ˜¯ï¼šå¸Œæœ›é€šè¿‡ç´¢å¼•è¿›è¡Œæ•°æ®æŸ¥æ‰¾ï¼Œå‡å°‘éšæœº IOï¼Œå¢åŠ æŸ¥è¯¢æ€§èƒ½ ï¼Œç´¢å¼•èƒ½è¿‡æ»¤å‡ºè¶Šå°‘çš„æ•°æ®ï¼Œåˆ™ä»ç£ç›˜ä¸­è¯»å…¥çš„æ•°æ®ä¹Ÿå°±è¶Šå°‘ã€‚\nåŒºåˆ†åº¦æœ€é«˜çš„æ”¾åœ¨è”åˆç´¢å¼•çš„æœ€å·¦ä¾§ï¼ˆåŒºåˆ†åº¦=åˆ—ä¸­ä¸åŒå€¼çš„æ•°é‡/åˆ—çš„æ€»è¡Œæ•°ï¼‰ å°½é‡æŠŠå­—æ®µé•¿åº¦å°çš„åˆ—æ”¾åœ¨è”åˆç´¢å¼•çš„æœ€å·¦ä¾§ï¼ˆå› ä¸ºå­—æ®µé•¿åº¦è¶Šå°ï¼Œä¸€é¡µèƒ½å­˜å‚¨çš„æ•°æ®é‡è¶Šå¤§ï¼ŒIO æ€§èƒ½ä¹Ÿå°±è¶Šå¥½ï¼‰ ä½¿ç”¨æœ€é¢‘ç¹çš„åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å·¦ä¾§ï¼ˆè¿™æ ·å¯ä»¥æ¯”è¾ƒå°‘çš„å»ºç«‹ä¸€äº›ç´¢å¼•ï¼‰ é¿å…å»ºç«‹å†—ä½™ç´¢å¼•å’Œé‡å¤ç´¢å¼•ï¼ˆå¢åŠ äº†æŸ¥è¯¢ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ï¼‰ # é‡å¤ç´¢å¼•ç¤ºä¾‹ï¼šprimary key(id)ã€index(id)ã€unique index(id) å†—ä½™ç´¢å¼•ç¤ºä¾‹ï¼šindex(a,b,c)ã€index(a,b)ã€index(a) å¯¹äºé¢‘ç¹çš„æŸ¥è¯¢æœ‰ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è¦†ç›–ç´¢å¼• # è¦†ç›–ç´¢å¼•ï¼šå°±æ˜¯åŒ…å«äº†æ‰€æœ‰æŸ¥è¯¢å­—æ®µ (where,select,order by,group by åŒ…å«çš„å­—æ®µ) çš„ç´¢å¼•\nè¦†ç›–ç´¢å¼•çš„å¥½å¤„ï¼š\né¿å… InnoDB è¡¨è¿›è¡Œç´¢å¼•çš„äºŒæ¬¡æŸ¥è¯¢: InnoDB æ˜¯ä»¥èšé›†ç´¢å¼•çš„é¡ºåºæ¥å­˜å‚¨çš„ï¼Œå¯¹äº InnoDB æ¥è¯´ï¼ŒäºŒçº§ç´¢å¼•åœ¨å¶å­èŠ‚ç‚¹ä¸­æ‰€ä¿å­˜çš„æ˜¯è¡Œçš„ä¸»é”®ä¿¡æ¯ï¼Œå¦‚æœæ˜¯ç”¨äºŒçº§ç´¢å¼•æŸ¥è¯¢æ•°æ®çš„è¯ï¼Œåœ¨æŸ¥æ‰¾åˆ°ç›¸åº”çš„é”®å€¼åï¼Œè¿˜è¦é€šè¿‡ä¸»é”®è¿›è¡ŒäºŒæ¬¡æŸ¥è¯¢æ‰èƒ½è·å–æˆ‘ä»¬çœŸå®æ‰€éœ€è¦çš„æ•°æ®ã€‚è€Œåœ¨è¦†ç›–ç´¢å¼•ä¸­ï¼ŒäºŒçº§ç´¢å¼•çš„é”®å€¼ä¸­å¯ä»¥è·å–æ‰€æœ‰çš„æ•°æ®ï¼Œé¿å…äº†å¯¹ä¸»é”®çš„äºŒæ¬¡æŸ¥è¯¢ ï¼Œå‡å°‘äº† IO æ“ä½œï¼Œæå‡äº†æŸ¥è¯¢æ•ˆç‡ã€‚ å¯ä»¥æŠŠéšæœº IO å˜æˆé¡ºåº IO åŠ å¿«æŸ¥è¯¢æ•ˆç‡: ç”±äºè¦†ç›–ç´¢å¼•æ˜¯æŒ‰é”®å€¼çš„é¡ºåºå­˜å‚¨çš„ï¼Œå¯¹äº IO å¯†é›†å‹çš„èŒƒå›´æŸ¥æ‰¾æ¥è¯´ï¼Œå¯¹æ¯”éšæœºä»ç£ç›˜è¯»å–æ¯ä¸€è¡Œçš„æ•°æ® IO è¦å°‘çš„å¤šï¼Œå› æ­¤åˆ©ç”¨è¦†ç›–ç´¢å¼•åœ¨è®¿é—®æ—¶ä¹Ÿå¯ä»¥æŠŠç£ç›˜çš„éšæœºè¯»å–çš„ IO è½¬å˜æˆç´¢å¼•æŸ¥æ‰¾çš„é¡ºåº IOã€‚ ç´¢å¼•SETè§„èŒƒ # å°½é‡é¿å…ä½¿ç”¨å¤–é”®çº¦æŸ\nä¸å»ºè®®ä½¿ç”¨å¤–é”®çº¦æŸï¼ˆforeign keyï¼‰ï¼Œä½†ä¸€å®šè¦åœ¨è¡¨ä¸è¡¨ä¹‹é—´çš„å…³è”é”®ä¸Šå»ºç«‹ç´¢å¼• å¤–é”®å¯ç”¨äºä¿è¯æ•°æ®çš„å‚ç…§å®Œæ•´æ€§ï¼Œä½†å»ºè®®åœ¨ä¸šåŠ¡ç«¯å®ç° å¤–é”®ä¼šå½±å“çˆ¶è¡¨å’Œå­è¡¨çš„å†™æ“ä½œä»è€Œé™ä½æ€§èƒ½ æ•°æ®åº“SQLå¼€å‘è§„èŒƒ # ä¼˜åŒ–å¯¹æ€§èƒ½å½±å“è¾ƒå¤§çš„SQLè¯­å¥ # è¦æ‰¾åˆ°æœ€éœ€è¦ä¼˜åŒ–çš„ SQL è¯­å¥ã€‚è¦ä¹ˆæ˜¯ä½¿ç”¨æœ€é¢‘ç¹çš„è¯­å¥ï¼Œè¦ä¹ˆæ˜¯ä¼˜åŒ–åæé«˜æœ€æ˜æ˜¾çš„è¯­å¥ï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢ MySQL çš„æ…¢æŸ¥è¯¢æ—¥å¿—æ¥å‘ç°éœ€è¦è¿›è¡Œä¼˜åŒ–çš„ SQL è¯­å¥ï¼›\nå……åˆ†åˆ©ç”¨è¡¨ä¸Šå·²ç»å­˜åœ¨çš„ç´¢å¼• # é¿å…ä½¿ç”¨åŒ%å·çš„æŸ¥è¯¢æ¡ä»¶ã€‚å¦‚ï¼ša like '%123%'ï¼Œï¼ˆå¦‚æœæ— å‰ç½®%,åªæœ‰åç½®%ï¼Œæ˜¯å¯ä»¥ç”¨åˆ°åˆ—ä¸Šçš„ç´¢å¼•çš„ï¼‰\nä¸€ä¸ª SQL åªèƒ½åˆ©ç”¨åˆ°å¤åˆç´¢å¼•ä¸­çš„ä¸€åˆ—è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ã€‚å¦‚ï¼šæœ‰ a,b,c åˆ—çš„è”åˆç´¢å¼•ï¼Œåœ¨æŸ¥è¯¢æ¡ä»¶ä¸­æœ‰ a åˆ—çš„èŒƒå›´æŸ¥è¯¢ï¼Œåˆ™åœ¨ b,c åˆ—ä¸Šçš„ç´¢å¼•å°†ä¸ä¼šè¢«ç”¨åˆ°ã€‚\nhttps://blog.csdn.net/qq_33589510/article/details/123038988\n(a=1 b=1 c=1) (a=1 b=2 c=1) (a=1 b=2 c=3)\n(a=2 b=2 c=3) (a=2 b=2 c=5) (a=2 b=5 c=1) (a=2 b=5 c=2)\n(a=3 b=0 c=1) (a=3 b=3 c=5) (a=3 b=8 c=6)\nå‡è®¾æœ‰ä¸€æ¡SQLä¸ºselect a,b,c from table where a = 2 and b \u0026gt;1 and c = 2ï¼Œé‚£ä¹ˆç´¢å¼•cå°±ç”¨ä¸åˆ°äº†ï¼Œå› ä¸ºæœ‰å¯èƒ½bæŸ¥æ‰¾åcæ˜¯æ— åºçš„äº†\nåœ¨å®šä¹‰è”åˆç´¢å¼•æ—¶ï¼Œå¦‚æœ a åˆ—è¦ç”¨åˆ°èŒƒå›´æŸ¥æ‰¾çš„è¯ï¼Œå°±è¦æŠŠ a åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å³ä¾§ï¼Œä½¿ç”¨ left join æˆ– not exists æ¥ä¼˜åŒ– not in æ“ä½œï¼Œå› ä¸º not in ä¹Ÿé€šå¸¸ä¼šä½¿ç”¨ç´¢å¼•å¤±æ•ˆã€‚\nè¿™ä¸ªçš„æ„æ€æ˜¯ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªåˆ—ï¼Œbï¼Œaéƒ½æ˜¯ç´¢å¼•\nSELECT * FROM table WHERE a \u0026gt; 1 and b = 2;\nå¯¹äºä¸Šé¢è¿™å¥ï¼Œå¦‚æœå»ºç«‹(aï¼Œb)ï¼Œé‚£ä¹ˆåªæœ‰aä¼šç”¨å¾—åˆ°ã€‚è€Œå¦‚æœå»ºç«‹(bï¼Œa)ï¼Œåˆ™éƒ½èƒ½ç”¨ä¸Š ï¼ˆå¦‚æœæ²¡æœ‰b= 2ï¼Œé‚£ä¹ˆï¼ˆbï¼Œaï¼‰ç´¢å¼•å°±ç”¨ä¸ä¸Šäº†ï¼‰\nç¦æ­¢ä½¿ç”¨SELECT * å¿…é¡»ä½¿ç”¨SELECT \u0026lt;å­—æ®µåˆ—è¡¨\u0026gt; æŸ¥è¯¢ # SELECT * æ¶ˆè€—æ›´å¤šçš„ CPU å’Œ IO ä»¥ç½‘ç»œå¸¦å®½èµ„æº SELECT * æ— æ³•ä½¿ç”¨è¦†ç›–ç´¢å¼• SELECT \u0026lt;å­—æ®µåˆ—è¡¨\u0026gt; å¯å‡å°‘è¡¨ç»“æ„å˜æ›´å¸¦æ¥çš„å½±å“ ç¦æ­¢ä½¿ç”¨ä¸å«å­—æ®µåˆ—è¡¨çš„INSERTè¯­å¥ # å¦‚ï¼š\ninsert into t values (\u0026#39;a\u0026#39;,\u0026#39;b\u0026#39;,\u0026#39;c\u0026#39;); åº”ä½¿ç”¨ï¼š\ninsert into t(c1,c2,c3) values (\u0026#39;a\u0026#39;,\u0026#39;b\u0026#39;,\u0026#39;c\u0026#39;); å»ºè®®ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥è¿›è¡Œæ•°æ®åº“æ“ä½œ # ï¼ˆè¿™é‡Œåº”è¯¥æ˜¯é’ˆå¯¹jdbcï¼Œä¸æ˜¯æŒ‡mybatisçš„æƒ…å†µï¼‰\nä¾‹å­ï¼š\nMySQLæ‰§è¡Œé¢„ç¼–è¯‘åˆ†ä¸ºå¦‚ä¸‰æ­¥ï¼š\næ‰§è¡Œé¢„ç¼–è¯‘è¯­å¥ï¼Œä¾‹å¦‚ï¼šprepare myfun from \u0026lsquo;select * from t_book where bid=?\u0026rsquo;\nè®¾ç½®å˜é‡ï¼Œä¾‹å¦‚ï¼šset @str=\u0026lsquo;b1\u0026rsquo;\næ‰§è¡Œè¯­å¥ï¼Œä¾‹å¦‚ï¼šexecute myfun using @str\nå¦‚æœéœ€è¦å†æ¬¡æ‰§è¡Œmyfunï¼Œé‚£ä¹ˆå°±ä¸å†éœ€è¦ç¬¬ä¸€æ­¥ï¼Œå³ä¸éœ€è¦å†ç¼–è¯‘è¯­å¥äº†ï¼š\nè®¾ç½®å˜é‡ï¼Œä¾‹å¦‚ï¼šset @str=\u0026lsquo;b2\u0026rsquo; æ‰§è¡Œè¯­å¥ï¼Œä¾‹å¦‚ï¼šexecute myfun using @str é€šè¿‡æŸ¥çœ‹MySQLæ—¥å¿—å¯ä»¥çœ‹åˆ°æ‰§è¡Œçš„è¿‡ç¨‹ï¼š\nä½¿ç”¨Statementæ‰§è¡Œé¢„ç¼–è¯‘\n**ä½¿ç”¨Statementæ‰§è¡Œé¢„ç¼–è¯‘å°±æ˜¯æŠŠä¸Šé¢çš„SQLè¯­å¥æ‰§è¡Œä¸€æ¬¡ã€‚ **\nConnection con = JdbcUtils.getConnection(); Statement stmt = con.createStatement(); stmt.executeUpdate(\u0026#34;prepare myfun from \u0026#39;select * from t_book where bid=?\u0026#39;\u0026#34;); stmt.executeUpdate(\u0026#34;set @str=\u0026#39;b1\u0026#39;\u0026#34;); ResultSet rs = stmt.executeQuery(\u0026#34;execute myfun using @str\u0026#34;); while(rs.next()) { System.out.print(rs.getString(1) + \u0026#34;, \u0026#34;); System.out.print(rs.getString(2) + \u0026#34;, \u0026#34;); System.out.print(rs.getString(3) + \u0026#34;, \u0026#34;); System.out.println(rs.getString(4)); } stmt.executeUpdate(\u0026#34;set @str=\u0026#39;b2\u0026#39;\u0026#34;); rs = stmt.executeQuery(\u0026#34;execute myfun using @str\u0026#34;); while(rs.next()) { System.out.print(rs.getString(1) + \u0026#34;, \u0026#34;); System.out.print(rs.getString(2) + \u0026#34;, \u0026#34;); System.out.print(rs.getString(3) + \u0026#34;, \u0026#34;); System.out.println(rs.getString(4)); } rs.close(); stmt.close(); con.close(); useServerPrepStmtså‚æ•°\né»˜è®¤ä½¿ç”¨PreparedStatementæ˜¯ä¸èƒ½æ‰§è¡Œé¢„ç¼–è¯‘çš„ï¼Œè¿™éœ€è¦åœ¨urlä¸­ç»™å‡ºuseServerPrepStmts=trueå‚æ•°ï¼ˆMySQL Server 4.1ä¹‹å‰çš„ç‰ˆæœ¬æ˜¯ä¸æ”¯æŒé¢„ç¼–è¯‘çš„ï¼Œè€ŒConnector/Jåœ¨5.0.5ä»¥åçš„ç‰ˆæœ¬ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰å¼€å¯é¢„ç¼–è¯‘åŠŸèƒ½çš„ï¼‰ã€‚\nä¾‹å¦‚ï¼šjdbc:mysql://localhost:3306/test?useServerPrepStmts=true\né¢„ç¼–è¯‘è¯­å¥å¯ä»¥é‡å¤ä½¿ç”¨è¿™äº›è®¡åˆ’ï¼Œå‡å°‘ SQL ç¼–è¯‘æ‰€éœ€è¦çš„æ—¶é—´ï¼Œè¿˜å¯ä»¥è§£å†³åŠ¨æ€ SQL æ‰€å¸¦æ¥çš„ SQL æ³¨å…¥çš„é—®é¢˜ã€‚\nåªä¼ å‚æ•°ï¼Œæ¯”ä¼ é€’ SQL è¯­å¥æ›´é«˜æ•ˆã€‚\nç›¸åŒè¯­å¥å¯ä»¥ä¸€æ¬¡è§£æï¼Œå¤šæ¬¡ä½¿ç”¨ï¼Œæé«˜å¤„ç†æ•ˆç‡ã€‚\né¿å…æ•°æ®ç±»å‹çš„éšå¼è½¬æ¢ # éšå¼è½¬æ¢ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆå¦‚: è¿™é‡Œidåº”è¯¥ä¸æ˜¯å­—ç¬¦å‹(ä½†æ˜¯è¿™ä¸ªå¥½åƒæ˜¯ä¾‹å¤–ï¼Œå¦‚æœå­—æ®µæ˜¯æ•°å­—ï¼Œè€ŒæŸ¥è¯¢çš„æ˜¯å­—ç¬¦ï¼Œç´¢å¼•è¿˜æ˜¯æœ‰æ•ˆçš„)\nselect name,phone from customer where id = \u0026#39;111\u0026#39;; è¯¦ç»†è§£è¯»å¯ä»¥çœ‹ï¼šMySQL ä¸­çš„éšå¼è½¬æ¢é€ æˆçš„ç´¢å¼•å¤±æ•ˆ è¿™ç¯‡æ–‡ç« \né¿å…ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå¯ä»¥æŠŠå­æŸ¥è¯¢ä¼˜åŒ–ä¸ºjoinæ“ä½œ # é€šå¸¸å­æŸ¥è¯¢åœ¨ in å­å¥ä¸­ï¼Œä¸”å­æŸ¥è¯¢ä¸­ä¸ºç®€å• SQL(ä¸åŒ…å« unionã€group byã€order byã€limit ä»å¥) æ—¶,æ‰å¯ä»¥æŠŠå­æŸ¥è¯¢è½¬åŒ–ä¸ºå…³è”æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ã€‚\nå­æŸ¥è¯¢æ€§èƒ½å·®çš„åŸå› ï¼š å­æŸ¥è¯¢çš„ç»“æœé›†æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œé€šå¸¸å­æŸ¥è¯¢çš„ç»“æœé›†ä¼šè¢«å­˜å‚¨åˆ°ä¸´æ—¶è¡¨ä¸­ï¼Œä¸è®ºæ˜¯å†…å­˜ä¸´æ—¶è¡¨è¿˜æ˜¯ç£ç›˜ä¸´æ—¶è¡¨éƒ½ä¸ä¼šå­˜åœ¨ç´¢å¼•ï¼Œæ‰€ä»¥æŸ¥è¯¢æ€§èƒ½ä¼šå—åˆ°ä¸€å®šçš„å½±å“ã€‚ç‰¹åˆ«æ˜¯å¯¹äºè¿”å›ç»“æœé›†æ¯”è¾ƒå¤§çš„å­æŸ¥è¯¢ï¼Œå…¶å¯¹æŸ¥è¯¢æ€§èƒ½çš„å½±å“ä¹Ÿå°±è¶Šå¤§ã€‚ç”±äºå­æŸ¥è¯¢ä¼šäº§ç”Ÿå¤§é‡çš„ä¸´æ—¶è¡¨ä¹Ÿæ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥ä¼šæ¶ˆè€—è¿‡å¤šçš„ CPU å’Œ IO èµ„æºï¼Œäº§ç”Ÿå¤§é‡çš„æ…¢æŸ¥è¯¢ã€‚\né¿å…JOINå…³è”å¤ªå¤šçš„è¡¨ # å¯¹äº MySQL æ¥è¯´ï¼Œæ˜¯å­˜åœ¨å…³è”ç¼“å­˜çš„ï¼Œç¼“å­˜çš„å¤§å°å¯ä»¥ç”± join_buffer_size å‚æ•°è¿›è¡Œè®¾ç½®ã€‚\nåœ¨ MySQL ä¸­ï¼Œå¯¹äºåŒä¸€ä¸ª SQL å¤šå…³è”ï¼ˆjoinï¼‰ä¸€ä¸ªè¡¨ï¼Œå°±ä¼šå¤šåˆ†é…ä¸€ä¸ªå…³è”ç¼“å­˜ï¼Œå¦‚æœåœ¨ä¸€ä¸ª SQL ä¸­å…³è”çš„è¡¨è¶Šå¤šï¼Œæ‰€å ç”¨çš„å†…å­˜ä¹Ÿå°±è¶Šå¤§ã€‚\nå¦‚æœç¨‹åºä¸­å¤§é‡çš„ä½¿ç”¨äº†å¤šè¡¨å…³è”çš„æ“ä½œï¼ŒåŒæ—¶ join_buffer_size è®¾ç½®çš„ä¹Ÿä¸åˆç†çš„æƒ…å†µä¸‹ï¼Œå°±å®¹æ˜“é€ æˆæœåŠ¡å™¨å†…å­˜æº¢å‡ºçš„æƒ…å†µï¼Œå°±ä¼šå½±å“åˆ°æœåŠ¡å™¨æ•°æ®åº“æ€§èƒ½çš„ç¨³å®šæ€§ã€‚\nåŒæ—¶å¯¹äºå…³è”æ“ä½œæ¥è¯´ï¼Œä¼šäº§ç”Ÿä¸´æ—¶è¡¨æ“ä½œï¼Œå½±å“æŸ¥è¯¢æ•ˆç‡ï¼ŒMySQL æœ€å¤šå…è®¸å…³è” 61 ä¸ªè¡¨ï¼Œå»ºè®®ä¸è¶…è¿‡ 5 ä¸ªã€‚\nå‡å°‘åŒæ•°æ®åº“çš„äº¤äº’æ¬¡æ•° # æ•°æ®åº“æ›´é€‚åˆå¤„ç†æ‰¹é‡æ“ä½œï¼Œåˆå¹¶å¤šä¸ªç›¸åŒçš„æ“ä½œåˆ°ä¸€èµ·ï¼Œå¯ä»¥æé«˜å¤„ç†æ•ˆç‡ã€‚\nå¯¹åº”åŒä¸€åˆ—è¿›è¡Œoråˆ¤æ–­æ—¶ï¼Œä½¿ç”¨inä»£æ›¿or # in çš„å€¼ä¸è¦è¶…è¿‡ 500 ä¸ªï¼Œin æ“ä½œå¯ä»¥æ›´æœ‰æ•ˆçš„åˆ©ç”¨ç´¢å¼•ï¼Œor å¤§å¤šæ•°æƒ…å†µä¸‹å¾ˆå°‘èƒ½åˆ©ç”¨åˆ°ç´¢å¼•ã€‚\nç¦æ­¢ä½¿ç”¨order by rand() è¿›è¡Œéšæœºæ’åº # order by rand() ä¼šæŠŠè¡¨ä¸­æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®è£…è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶ååœ¨å†…å­˜ä¸­å¯¹æ‰€æœ‰æ•°æ®æ ¹æ®éšæœºç”Ÿæˆçš„å€¼è¿›è¡Œæ’åºï¼Œå¹¶ä¸”å¯èƒ½ä¼šå¯¹æ¯ä¸€è¡Œéƒ½ç”Ÿæˆä¸€ä¸ªéšæœºå€¼ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶çš„æ•°æ®é›†éå¸¸å¤§ï¼Œå°±ä¼šæ¶ˆè€—å¤§é‡çš„ CPU å’Œ IO åŠå†…å­˜èµ„æºã€‚\næ¨èåœ¨ç¨‹åºä¸­è·å–ä¸€ä¸ªéšæœºå€¼ï¼Œç„¶åä»æ•°æ®åº“ä¸­è·å–æ•°æ®çš„æ–¹å¼ã€‚\nWHEREä»å¥ä¸­ç¦æ­¢å¯¹åˆ—è¿›è¡Œå‡½æ•°è½¬æ¢å’Œè®¡ç®— # å¯¹åˆ—è¿›è¡Œå‡½æ•°è½¬æ¢æˆ–è®¡ç®—æ—¶ä¼šå¯¼è‡´æ— æ³•ä½¿ç”¨ç´¢å¼•\nä¸æ¨èï¼š\nwhere date(create_time)=\u0026#39;20190101\u0026#39; æ¨èï¼š\nwhere create_time \u0026gt;= \u0026#39;20190101\u0026#39; and create_time \u0026lt; \u0026#39;20190102\u0026#39; åœ¨æ˜æ˜¾ä¸ä¼šæœ‰é‡å¤å€¼æ—¶ä½¿ç”¨UNION ALL è€Œä¸æ˜¯ UNION # UNION ä¼šæŠŠä¸¤ä¸ªç»“æœé›†çš„æ‰€æœ‰æ•°æ®æ”¾åˆ°ä¸´æ—¶è¡¨ä¸­åå†è¿›è¡Œå»é‡æ“ä½œ UNION ALL ä¸ä¼šå†å¯¹ç»“æœé›†è¿›è¡Œå»é‡æ“ä½œ æ‹†åˆ†å¤æ‚çš„å¤§SQLä¸ºå¤šä¸ªå°SQL # å¤§ SQL é€»è¾‘ä¸Šæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å ç”¨å¤§é‡ CPU è¿›è¡Œè®¡ç®—çš„ SQL MySQL ä¸­ï¼Œä¸€ä¸ª SQL åªèƒ½ä½¿ç”¨ä¸€ä¸ª CPU è¿›è¡Œè®¡ç®— SQL æ‹†åˆ†åå¯ä»¥é€šè¿‡å¹¶è¡Œæ‰§è¡Œæ¥æé«˜å¤„ç†æ•ˆç‡ ç¨‹åºè¿æ¥ä¸åŒçš„æ•°æ®åº“ä½¿ç”¨ä¸åŒçš„è´¦å·ï¼Œç¦æ­¢è·¨åº“æŸ¥è¯¢ # ä¸ºæ•°æ®åº“è¿ç§»å’Œåˆ†åº“åˆ†è¡¨ç•™å‡ºä½™åœ° é™ä½ä¸šåŠ¡è€¦åˆåº¦ é¿å…æƒé™è¿‡å¤§è€Œäº§ç”Ÿçš„å®‰å…¨é£é™© æ•°æ®åº“æ“ä½œè¡Œä¸ºè§„èŒƒ # è¶… 100 ä¸‡è¡Œçš„æ‰¹é‡å†™ (UPDATE,DELETE,INSERT) æ“ä½œ,è¦åˆ†æ‰¹å¤šæ¬¡è¿›è¡Œæ“ä½œ # å¤§æ‰¹é‡æ“ä½œå¯èƒ½ä¼šé€ æˆä¸¥é‡çš„ä¸»ä»å»¶è¿Ÿ\nä¸»ä»ç¯å¢ƒä¸­,å¤§æ‰¹é‡æ“ä½œå¯èƒ½ä¼šé€ æˆä¸¥é‡çš„ä¸»ä»å»¶è¿Ÿï¼Œå¤§æ‰¹é‡çš„å†™æ“ä½œä¸€èˆ¬éƒ½éœ€è¦æ‰§è¡Œä¸€å®šé•¿çš„æ—¶é—´ï¼Œè€Œåªæœ‰å½“ä¸»åº“ä¸Šæ‰§è¡Œå®Œæˆåï¼Œæ‰ä¼šåœ¨å…¶ä»–ä»åº“ä¸Šæ‰§è¡Œï¼Œæ‰€ä»¥ä¼šé€ æˆä¸»åº“ä¸ä»åº“é•¿æ—¶é—´çš„å»¶è¿Ÿæƒ…å†µ\nbinlog æ—¥å¿—ä¸º row æ ¼å¼æ—¶ä¼šäº§ç”Ÿå¤§é‡çš„æ—¥å¿—\nå¤§æ‰¹é‡å†™æ“ä½œä¼šäº§ç”Ÿå¤§é‡æ—¥å¿—ï¼Œç‰¹åˆ«æ˜¯å¯¹äº row æ ¼å¼äºŒè¿›åˆ¶æ•°æ®è€Œè¨€ï¼Œç”±äºåœ¨ row æ ¼å¼ä¸­ä¼šè®°å½•æ¯ä¸€è¡Œæ•°æ®çš„ä¿®æ”¹ï¼Œæˆ‘ä»¬ä¸€æ¬¡ä¿®æ”¹çš„æ•°æ®è¶Šå¤šï¼Œäº§ç”Ÿçš„æ—¥å¿—é‡ä¹Ÿå°±ä¼šè¶Šå¤šï¼Œæ—¥å¿—çš„ä¼ è¾“å’Œæ¢å¤æ‰€éœ€è¦çš„æ—¶é—´ä¹Ÿå°±è¶Šé•¿ï¼Œè¿™ä¹Ÿæ˜¯é€ æˆä¸»ä»å»¶è¿Ÿçš„ä¸€ä¸ªåŸå› \né¿å…äº§ç”Ÿå¤§äº‹åŠ¡æ“ä½œ\nå¤§æ‰¹é‡ä¿®æ”¹æ•°æ®ï¼Œä¸€å®šæ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­è¿›è¡Œçš„ï¼Œè¿™å°±ä¼šé€ æˆè¡¨ä¸­å¤§æ‰¹é‡æ•°æ®è¿›è¡Œé”å®šï¼Œä»è€Œå¯¼è‡´å¤§é‡çš„é˜»å¡ï¼Œé˜»å¡ä¼šå¯¹ MySQL çš„æ€§èƒ½äº§ç”Ÿéå¸¸å¤§çš„å½±å“ã€‚\nç‰¹åˆ«æ˜¯é•¿æ—¶é—´çš„é˜»å¡ä¼šå æ»¡æ‰€æœ‰æ•°æ®åº“çš„å¯ç”¨è¿æ¥ï¼Œè¿™ä¼šä½¿ç”Ÿäº§ç¯å¢ƒä¸­çš„å…¶ä»–åº”ç”¨æ— æ³•è¿æ¥åˆ°æ•°æ®åº“ï¼Œå› æ­¤ä¸€å®šè¦æ³¨æ„å¤§æ‰¹é‡å†™æ“ä½œè¦è¿›è¡Œåˆ†æ‰¹\nå¯¹äºå¤§è¡¨ä½¿ç”¨ pt-online-schema-change ä¿®æ”¹è¡¨ç»“æ„ # é¿å…å¤§è¡¨ä¿®æ”¹äº§ç”Ÿçš„ä¸»ä»å»¶è¿Ÿ é¿å…åœ¨å¯¹è¡¨å­—æ®µè¿›è¡Œä¿®æ”¹æ—¶è¿›è¡Œé”è¡¨ å¯¹å¤§è¡¨æ•°æ®ç»“æ„çš„ä¿®æ”¹ä¸€å®šè¦è°¨æ…ï¼Œä¼šé€ æˆä¸¥é‡çš„é”è¡¨æ“ä½œï¼Œå°¤å…¶æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œæ˜¯ä¸èƒ½å®¹å¿çš„ã€‚\npt-online-schema-change å®ƒä¼šé¦–å…ˆå»ºç«‹ä¸€ä¸ªä¸åŸè¡¨ç»“æ„ç›¸åŒçš„æ–°è¡¨ï¼Œå¹¶ä¸”åœ¨æ–°è¡¨ä¸Šè¿›è¡Œè¡¨ç»“æ„çš„ä¿®æ”¹ï¼Œç„¶åå†æŠŠåŸè¡¨ä¸­çš„æ•°æ®å¤åˆ¶åˆ°æ–°è¡¨ä¸­ï¼Œå¹¶åœ¨åŸè¡¨ä¸­å¢åŠ ä¸€äº›è§¦å‘å™¨ã€‚æŠŠåŸè¡¨ä¸­æ–°å¢çš„æ•°æ®ä¹Ÿå¤åˆ¶åˆ°æ–°è¡¨ä¸­ï¼Œåœ¨è¡Œæ‰€æœ‰æ•°æ®å¤åˆ¶å®Œæˆä¹‹åï¼ŒæŠŠæ–°è¡¨å‘½åæˆåŸè¡¨ï¼Œå¹¶æŠŠåŸæ¥çš„è¡¨åˆ é™¤æ‰ã€‚\næŠŠåŸæ¥ä¸€ä¸ª DDL æ“ä½œï¼Œåˆ†è§£æˆå¤šä¸ªå°çš„æ‰¹æ¬¡è¿›è¡Œã€‚\nç¦æ­¢ä¸ºç¨‹åºä½¿ç”¨çš„è´¦å·èµ‹äºˆ super æƒé™ # å½“è¾¾åˆ°æœ€å¤§è¿æ¥æ•°é™åˆ¶æ—¶ï¼Œè¿˜è¿è¡Œ 1 ä¸ªæœ‰ super æƒé™çš„ç”¨æˆ·è¿æ¥ super æƒé™åªèƒ½ç•™ç»™ DBA å¤„ç†é—®é¢˜çš„è´¦å·ä½¿ç”¨ å¯¹äºç¨‹åºè¿æ¥æ•°æ®åº“è´¦å·,éµå¾ªæƒé™æœ€å°åŸåˆ™ # ç¨‹åºä½¿ç”¨æ•°æ®åº“è´¦å·åªèƒ½åœ¨ä¸€ä¸ª DB ä¸‹ä½¿ç”¨ï¼Œä¸å‡†è·¨åº“ ç¨‹åºä½¿ç”¨çš„è´¦å·åŸåˆ™ä¸Šä¸å‡†æœ‰ drop æƒé™ "},{"id":105,"href":"/zh/docs/study/Review/java_guide/database/MySQL/ly0610lymysql-questions-01/","title":"MySQLå¸¸è§é¢è¯•é¢˜æ€»ç»“","section":"MySQL","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!====\nMySQLåŸºç¡€ # å…³ç³»å‹æ•°æ®åº“ä»‹ç» # å…³ç³»å‹æ•°æ®åº“ï¼Œå»ºç«‹åœ¨å…³ç³»æ¨¡å‹çš„åŸºç¡€ä¸Šçš„æ•°æ®åº“ã€‚è¡¨æ˜æ•°æ®åº“ä¸­æ‰€å­˜å‚¨çš„æ•°æ®ä¹‹é—´çš„è”ç³»ï¼ˆä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤šï¼‰ å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬çš„æ•°æ®éƒ½è¢«å­˜æ”¾åœ¨å„ç§è¡¨ä¸­ï¼ˆæ¯”å¦‚ç”¨æˆ·è¡¨ï¼‰ï¼Œè¡¨ä¸­çš„æ¯ä¸€è¡Œå­˜æ”¾ç€ä¸€æ¡æ•°æ®ï¼ˆæ¯”å¦‚ä¸€ä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼‰ å¤§éƒ¨åˆ†å…³ç³»å‹æ•°æ®åº“éƒ½ä½¿ç”¨SQLæ¥æ“ä½œæ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œå¹¶ä¸”å¤§éƒ¨åˆ†å…³ç³»å‹æ•°æ®åº“éƒ½æ”¯æŒäº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼ˆACIDï¼‰ å¸¸è§çš„å…³ç³»å‹æ•°æ®åº“\nMySQLã€PostgreSQLã€Oracleã€SQL Serverã€SQLiteï¼ˆå¾®ä¿¡æœ¬åœ°çš„èŠå¤©è®°å½•çš„å­˜å‚¨å°±æ˜¯ç”¨çš„ SQLiteï¼‰ \u0026hellip;\u0026hellip;\nMySQLä»‹ç» # MySQLæ˜¯ä¸€ç§å…³ç³»å‹æ•°æ®åº“ï¼Œä¸»è¦ç”¨äºæŒä¹…åŒ–å­˜å‚¨æˆ‘ä»¬ç³»ç»Ÿä¸­çš„ä¸€äº›æ•°æ®æ¯”å¦‚ç”¨æˆ·ä¿¡æ¯\nç”±äº MySQL æ˜¯å¼€æºå…è´¹å¹¶ä¸”æ¯”è¾ƒæˆç†Ÿçš„æ•°æ®åº“ï¼Œå› æ­¤ï¼ŒMySQL è¢«å¤§é‡ä½¿ç”¨åœ¨å„ç§ç³»ç»Ÿä¸­ã€‚ä»»ä½•äººéƒ½å¯ä»¥åœ¨ GPL(General Public License é€šç”¨æ€§å…¬å¼€è®¸å¯è¯) çš„è®¸å¯ä¸‹ä¸‹è½½å¹¶æ ¹æ®ä¸ªæ€§åŒ–çš„éœ€è¦å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚MySQL çš„é»˜è®¤ç«¯å£å·æ˜¯3306ã€‚\nMySQLåŸºç¡€æ¶æ„ # MySQLçš„ä¸€ä¸ªç®€è¦æœºæ„å›¾ï¼Œå®¢æˆ·ç«¯çš„ä¸€æ¡SQLè¯­å¥åœ¨MySQLå†…éƒ¨å¦‚ä½•æ‰§è¡Œ MySQLä¸»è¦ç”±å‡ éƒ¨åˆ†æ„æˆ è¿æ¥å™¨ï¼šèº«ä»½è®¤è¯å’Œæƒé™ç›¸å…³ï¼ˆç™»å½•MySQLçš„æ—¶å€™ï¼‰ æŸ¥è¯¢ç¼“å­˜ï¼šæ‰§è¡ŒæŸ¥è¯¢è¯­å¥çš„æ—¶å€™ï¼Œä¼šå…ˆæŸ¥è¯¢ç¼“å­˜ï¼ˆMySQL8.0ç‰ˆæœ¬åç§»é™¤ï¼Œå› ä¸ºè¿™ä¸ªåŠŸèƒ½ä¸å¤ªå®ç”¨ï¼‰ åˆ†æå™¨ï¼šæ²¡æœ‰å‘½ä¸­ç¼“å­˜çš„è¯ï¼ŒSQLè¯­å¥å°±ä¼šç»è¿‡åˆ†æå™¨ï¼Œåˆ†æå™¨è¯´ç™½äº†å°±æ˜¯è¦å…ˆçœ‹ä½ çš„SQLè¯­å¥è¦å¹²å˜›ï¼Œå†æ£€æŸ¥ä½ çš„SQLè¯­å¥è¯­æ³•æ˜¯å¦æ­£ç¡® ä¼˜åŒ–å™¨ï¼šæŒ‰ç…§MySQLè®¤ä¸ºæœ€ä¼˜çš„æ–¹æ¡ˆå»æ‰§è¡Œ æ‰§è¡Œå™¨ï¼šæ‰§è¡Œè¯­å¥ï¼Œç„¶åä»å­˜å‚¨å¼•æ“è¿”å›æ•°æ®ã€‚æ‰§è¡Œè¯­å¥ä¹‹å‰ä¼šå…ˆåˆ¤æ–­æ˜¯å¦æœ‰æƒé™ï¼Œå¦‚æœæ²¡æœ‰æƒé™ï¼Œå°±ä¼šæŠ¥é”™ æ’ä»¶å¼å­˜å‚¨å¼•æ“ï¼šä¸»è¦è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œè¯»å–ï¼Œé‡‡ç”¨çš„æ˜¯æ’ä»¶å¼æ¶æ„ï¼Œæ”¯æŒInnoDBã€MyISAMã€Memoryç­‰å¤šç§å­˜å‚¨å¼•æ“ MySQLå­˜å‚¨å¼•æ“ # MySQLæ ¸å¿ƒåœ¨äºå­˜å‚¨å¼•æ“\nMySQLæ”¯æŒå“ªäº›å­˜å‚¨å¼•æ“ï¼Ÿé»˜è®¤ä½¿ç”¨å“ªä¸ªï¼Ÿ # MySQLæ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ï¼Œå¯ä»¥é€šè¿‡show engineså‘½ä»¤æ¥æŸ¥çœ‹MySQLæ”¯æŒçš„æ‰€æœ‰å­˜å‚¨å¼•æ“ é»˜è®¤å­˜å‚¨å¼•æ“ä¸ºInnoDBï¼Œå¹¶ä¸”ï¼Œæ‰€æœ‰å­˜å‚¨å¼•æ“ä¸­åªæœ‰InnoDBæ˜¯äº‹åŠ¡æ€§å­˜å‚¨å¼•æ“ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰InnoDBæ”¯æŒäº‹åŠ¡\nè¿™é‡Œä½¿ç”¨MySQL 8.x MySQL 5.5.5ä¹‹å‰ï¼ŒMyISAMæ˜¯MySQLçš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼›5.5.5ä¹‹åï¼ŒInnoDBæ˜¯MySQLçš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œå¯ä»¥é€šè¿‡select version()å‘½ä»¤æŸ¥çœ‹ä½ çš„MySQLç‰ˆæœ¬\nmysql\u0026gt; select version(); +-----------+ | version() | +-----------+ | 8.0.27 | +-----------+ 1 row in set (0.00 sec) ä½¿ç”¨show variables like %storage_engine%å‘½ä»¤ç›´æ¥æŸ¥çœ‹MySQLå½“å‰é»˜è®¤çš„å­˜å‚¨å¼•æ“ å¦‚æœåªæƒ³æŸ¥çœ‹æ•°æ®åº“ä¸­æŸä¸ªè¡¨ä½¿ç”¨çš„å­˜å‚¨å¼•æ“çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨show table status from db_name where name = 'table_name'å‘½ä»¤\nå¦‚æœä½ æƒ³è¦æ·±å…¥äº†è§£æ¯ä¸ªå­˜å‚¨å¼•æ“ä»¥åŠå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ï¼Œæ¨èä½ å»é˜…è¯»ä»¥ä¸‹ MySQL å®˜æ–¹æ–‡æ¡£å¯¹åº”çš„ä»‹ç»(é¢è¯•ä¸ä¼šé—®è¿™ä¹ˆç»†ï¼Œäº†è§£å³å¯)ï¼š\nInnoDB å­˜å‚¨å¼•æ“è¯¦ç»†ä»‹ç»ï¼šhttps://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html ã€‚ å…¶ä»–å­˜å‚¨å¼•æ“è¯¦ç»†ä»‹ç»ï¼šhttps://dev.mysql.com/doc/refman/8.0/en/storage-engines.html ã€‚ MySQLå­˜å‚¨å¼•æ“æ¶æ„äº†è§£å—ï¼Ÿ # MySQL å­˜å‚¨å¼•æ“é‡‡ç”¨çš„æ˜¯æ’ä»¶å¼æ¶æ„ï¼Œæ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥ä¸ºä¸åŒçš„æ•°æ®åº“è¡¨è®¾ç½®ä¸åŒçš„å­˜å‚¨å¼•æ“ä»¥é€‚åº”ä¸åŒåœºæ™¯çš„éœ€è¦ã€‚å­˜å‚¨å¼•æ“æ˜¯åŸºäºè¡¨çš„ï¼Œè€Œä¸æ˜¯æ•°æ®åº“ å¯ä»¥æ ¹æ® MySQL å®šä¹‰çš„å­˜å‚¨å¼•æ“å®ç°æ ‡å‡†æ¥å£æ¥ç¼–å†™ä¸€ä¸ªå±äºè‡ªå·±çš„å­˜å‚¨å¼•æ“ã€‚è¿™äº›éå®˜æ–¹æä¾›çš„å­˜å‚¨å¼•æ“å¯ä»¥ç§°ä¸ºç¬¬ä¸‰æ–¹å­˜å‚¨å¼•æ“ï¼ŒåŒºåˆ«äºå®˜æ–¹å­˜å‚¨å¼•æ“ åƒç›®å‰æœ€å¸¸ç”¨çš„ InnoDB å…¶å®åˆšå¼€å§‹å°±æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹å­˜å‚¨å¼•æ“ï¼Œåé¢ç”±äºè¿‡äºä¼˜ç§€ï¼Œå…¶è¢« Oracle ç›´æ¥æ”¶è´­äº†ã€‚\nMySQL å®˜æ–¹æ–‡æ¡£ä¹Ÿæœ‰ä»‹ç»åˆ°å¦‚ä½•ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰å­˜å‚¨å¼•æ“ï¼Œåœ°å€ï¼šhttps://dev.mysql.com/doc/internals/en/custom-engine.html\nMyISAMå’ŒInnoDBçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ # ISAMå…¨ç§°ï¼šIndexed Sequential Access Method(ç´¢å¼• é¡ºåº è®¿é—® æ–¹æ³•) è™½ç„¶ï¼ŒMyISAM çš„æ€§èƒ½è¿˜è¡Œï¼Œå„ç§ç‰¹æ€§ä¹Ÿè¿˜ä¸é”™ï¼ˆæ¯”å¦‚å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°ç­‰ï¼‰ã€‚ä½†æ˜¯ï¼ŒMyISAM ä¸æ”¯æŒäº‹åŠ¡å’Œè¡Œçº§é”ï¼Œè€Œä¸”æœ€å¤§çš„ç¼ºé™·å°±æ˜¯å´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ æ˜¯å¦æ”¯æŒè¡Œçº§é” MyISAM åªæœ‰è¡¨çº§é”(table-level locking)ï¼Œè€Œ InnoDB æ”¯æŒè¡Œçº§é”(row-level locking)å’Œè¡¨çº§é”,é»˜è®¤ä¸ºè¡Œçº§é”ã€‚\nMyISAM ä¸€é”å°±æ˜¯é”ä½äº†æ•´å¼ è¡¨ï¼Œè¿™åœ¨å¹¶å‘å†™çš„æƒ…å†µä¸‹æ˜¯å¤šä¹ˆæ»´æ†¨æ†¨å•Šï¼è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ InnoDB åœ¨å¹¶å‘å†™çš„æ—¶å€™ï¼Œæ€§èƒ½æ›´ç‰›çš®äº†ï¼\næ˜¯å¦æ”¯æŒäº‹åŠ¡\nMyISAMä¸æ”¯æŒäº‹åŠ¡ï¼ŒInnoDBæä¾›äº‹åŠ¡æ”¯æŒ\nInnoDBå®ç°äº†SQLæ ‡å‡†ï¼Œå®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«ï¼Œå…·æœ‰æäº¤ï¼ˆcommitï¼‰å’Œå›æ»šï¼ˆrollbackï¼‰äº‹åŠ¡çš„èƒ½åŠ› InnoDBé»˜è®¤ä½¿ç”¨çš„REPEATABLE-READ(å¯é‡å¤è¯»)éš”ç¦»çº§åˆ«æ˜¯å¯ä»¥è§£å†³å¹»è¯»é—®é¢˜å‘ç”Ÿçš„ï¼ˆéƒ¨åˆ†å¹»è¯»ï¼‰ï¼ŒåŸºäºMVCCå’ŒNext-Key Lockï¼ˆé—´éš™é”ï¼‰ è¯¦ç»†å¯ä»¥æŸ¥çœ‹MySQL äº‹åŠ¡éš”ç¦»çº§åˆ«è¯¦è§£\næ˜¯å¦æ”¯æŒå¤–é”®\nMyISAMä¸æ”¯æŒï¼Œè€ŒInnoDBæ”¯æŒ\nå¤–é”®å¯¹äºç»´æŠ¤æ•°æ®ä¸€è‡´æ€§éå¸¸æœ‰å¸®åŠ©ï¼Œä½†æ˜¯å¯¹æ€§èƒ½æœ‰ä¸€å®šçš„æŸè€—ã€‚å› æ­¤ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯ä¸å»ºè®®åœ¨å®é™…ç”Ÿäº§é¡¹ç›®ä¸­ä½¿ç”¨å¤–é”®çš„ï¼Œåœ¨ä¸šåŠ¡ä»£ç ä¸­è¿›è¡Œçº¦æŸå³å¯ï¼\né˜¿é‡Œçš„ã€ŠJava å¼€å‘æ‰‹å†Œã€‹ä¹Ÿæ˜¯æ˜ç¡®è§„å®šç¦æ­¢ä½¿ç”¨å¤–é”®çš„ã€‚\nä¸è¿‡ï¼Œåœ¨ä»£ç ä¸­è¿›è¡Œçº¦æŸçš„è¯ï¼Œå¯¹ç¨‹åºå‘˜çš„èƒ½åŠ›è¦æ±‚æ›´é«˜ï¼Œå…·ä½“æ˜¯å¦è¦é‡‡ç”¨å¤–é”®è¿˜æ˜¯è¦æ ¹æ®ä½ çš„é¡¹ç›®å®é™…æƒ…å†µè€Œå®š\nä¸€èˆ¬æˆ‘ä»¬ä¹Ÿæ˜¯ä¸å»ºè®®åœ¨æ•°æ®åº“å±‚é¢ä½¿ç”¨å¤–é”®çš„ï¼Œåº”ç”¨å±‚é¢å¯ä»¥è§£å†³ã€‚ä¸è¿‡ï¼Œè¿™æ ·ä¼šå¯¹æ•°æ®çš„ä¸€è‡´æ€§é€ æˆå¨èƒã€‚å…·ä½“è¦ä¸è¦ä½¿ç”¨å¤–é”®è¿˜æ˜¯è¦æ ¹æ®ä½ çš„é¡¹ç›®æ¥å†³å®š æ˜¯å¦æ”¯æŒæ•°æ®åº“å¼‚å¸¸å´©æºƒåçš„å®‰å…¨æ¢å¤ MyISAM ä¸æ”¯æŒï¼Œè€Œ InnoDB æ”¯æŒã€‚\nä½¿ç”¨ InnoDB çš„æ•°æ®åº“åœ¨å¼‚å¸¸å´©æºƒåï¼Œæ•°æ®åº“é‡æ–°å¯åŠ¨çš„æ—¶å€™ä¼šä¿è¯æ•°æ®åº“æ¢å¤åˆ°å´©æºƒå‰çš„çŠ¶æ€ã€‚è¿™ä¸ªæ¢å¤çš„è¿‡ç¨‹ä¾èµ–äº redo log æ˜¯å¦æ”¯æŒMVCC MyISAM ä¸æ”¯æŒï¼Œè€Œ InnoDB æ”¯æŒã€‚\nMyISAM è¿è¡Œçº§é”éƒ½ä¸æ”¯æŒã€‚MVCC å¯ä»¥çœ‹ä½œæ˜¯è¡Œçº§é”çš„ä¸€ä¸ªå‡çº§ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘åŠ é”æ“ä½œï¼Œæé«˜æ€§èƒ½ã€‚ ç´¢å¼•å®ç°ä¸ä¸€æ ·\nè™½ç„¶ MyISAM å¼•æ“å’Œ InnoDB å¼•æ“éƒ½æ˜¯ä½¿ç”¨ B+Tree ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œä½†æ˜¯ä¸¤è€…çš„å®ç°æ–¹å¼ä¸å¤ªä¸€æ ·ã€‚ InnoDB å¼•æ“ä¸­ï¼Œå…¶æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ã€‚è€Œ MyISAMä¸­ï¼Œç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ InnoDBå¼•æ“ä¸­ï¼Œè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯æŒ‰ B+Tree ç»„ç»‡çš„ä¸€ä¸ªç´¢å¼•ç»“æ„ï¼Œæ ‘çš„å¶èŠ‚ç‚¹ data åŸŸä¿å­˜äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚ è¯¦ç»†åŒºåˆ«ï¼Œæ¨è ï¼š MySQL ç´¢å¼•è¯¦è§£\nMyISAMå’ŒInnoDB å¦‚ä½•é€‰æ‹© # å¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬ä½¿ç”¨çš„éƒ½æ˜¯ InnoDB å­˜å‚¨å¼•æ“ï¼Œåœ¨æŸäº›è¯»å¯†é›†çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ MyISAM ä¹Ÿæ˜¯åˆé€‚çš„ã€‚ä¸è¿‡ï¼Œå‰ææ˜¯ä½ çš„é¡¹ç›®ä¸ä»‹æ„ MyISAM ä¸æ”¯æŒäº‹åŠ¡ã€å´©æºƒæ¢å¤ç­‰ç¼ºç‚¹ï¼ˆå¯æ˜¯~æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šä»‹æ„å•Šï¼ï¼‰\nã€ŠMySQL é«˜æ€§èƒ½ã€‹ä¸Šé¢æœ‰ä¸€å¥è¯è¿™æ ·å†™åˆ°:\nä¸è¦è½»æ˜“ç›¸ä¿¡â€œMyISAM æ¯” InnoDB å¿«â€ä¹‹ç±»çš„ç»éªŒä¹‹è°ˆï¼Œè¿™ä¸ªç»“è®ºå¾€å¾€ä¸æ˜¯ç»å¯¹çš„ã€‚åœ¨å¾ˆå¤šæˆ‘ä»¬å·²çŸ¥åœºæ™¯ä¸­ï¼ŒInnoDB çš„é€Ÿåº¦éƒ½å¯ä»¥è®© MyISAM æœ›å°˜è«åŠï¼Œå°¤å…¶æ˜¯ç”¨åˆ°äº†èšç°‡ç´¢å¼•ï¼Œæˆ–è€…éœ€è¦è®¿é—®çš„æ•°æ®éƒ½å¯ä»¥æ”¾å…¥å†…å­˜çš„åº”ç”¨ã€‚\nä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬é€‰æ‹© InnoDB éƒ½æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯æŸäº›æƒ…å†µä¸‹ä½ å¹¶ä¸åœ¨ä¹å¯æ‰©å±•èƒ½åŠ›å’Œå¹¶å‘èƒ½åŠ›ï¼Œä¹Ÿä¸éœ€è¦äº‹åŠ¡æ”¯æŒï¼Œä¹Ÿä¸åœ¨ä¹å´©æºƒåçš„å®‰å…¨æ¢å¤é—®é¢˜çš„è¯ï¼Œé€‰æ‹© MyISAM ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯éœ€è¦è€ƒè™‘åˆ°è¿™äº›é—®é¢˜çš„ã€‚\nå¯¹äºå’±ä»¬æ—¥å¸¸å¼€å‘çš„ä¸šåŠ¡ç³»ç»Ÿæ¥è¯´ï¼Œä½ å‡ ä¹æ‰¾ä¸åˆ°ä»€ä¹ˆç†ç”±å†ä½¿ç”¨ MyISAM ä½œä¸ºè‡ªå·±çš„ MySQL æ•°æ®åº“çš„å­˜å‚¨å¼•æ“\nMySQL ç´¢å¼• # MySQL ç´¢å¼•ç›¸å…³çš„é—®é¢˜æ¯”è¾ƒå¤šï¼Œå¯¹äºé¢è¯•å’Œå·¥ä½œéƒ½æ¯”è¾ƒé‡è¦ï¼Œäºæ˜¯ï¼Œæˆ‘å•ç‹¬æŠ½äº†ä¸€ç¯‡æ–‡ç« ä¸“é—¨æ¥æ€»ç»“ MySQL ç´¢å¼•ç›¸å…³çš„çŸ¥è¯†ç‚¹å’Œé—®é¢˜ï¼š MySQL ç´¢å¼•è¯¦è§£]\nMySQLæŸ¥è¯¢ç¼“å­˜ # æ‰§è¡ŒæŸ¥è¯¢è¯­å¥çš„æ—¶å€™ï¼Œä¼šå…ˆæŸ¥è¯¢ç¼“å­˜ã€‚ä¸è¿‡**ï¼ŒMySQL 8.0 ç‰ˆæœ¬åç§»é™¤**ï¼Œå› ä¸ºè¿™ä¸ªåŠŸèƒ½ä¸å¤ªå®ç”¨\nmy.cnf åŠ å…¥ä»¥ä¸‹é…ç½®ï¼Œé‡å¯ MySQL å¼€å¯æŸ¥è¯¢ç¼“å­˜\nquery_cache_type=1 query_cache_size=600000 æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¹Ÿå¯ä»¥å¼€å¯æŸ¥è¯¢ç¼“å­˜\nset global query_cache_type=1; set global query_cache_size=600000; å¼€å¯æŸ¥è¯¢ç¼“å­˜ååœ¨åŒæ ·çš„æŸ¥è¯¢æ¡ä»¶ä»¥åŠæ•°æ®æƒ…å†µä¸‹ï¼Œä¼šç›´æ¥åœ¨ç¼“å­˜ä¸­è¿”å›ç»“æœï¼š\næŸ¥è¯¢æ¡ä»¶åŒ…æ‹¬æŸ¥è¯¢æœ¬èº«ã€å½“å‰è¦æŸ¥è¯¢çš„æ•°æ®åº“ã€å®¢æˆ·ç«¯åè®®ç‰ˆæœ¬å·ç­‰ä¸€äº›å¯èƒ½å½±å“ç»“æœçš„ä¿¡æ¯\næŸ¥è¯¢ç¼“å­˜ä¸å‘½ä¸­çš„æƒ…å†µï¼š\nä»»ä½•ä¸¤ä¸ªæŸ¥è¯¢åœ¨ä»»ä½•å­—ç¬¦ä¸Šçš„ä¸åŒéƒ½ä¼šå¯¼è‡´ç¼“å­˜ä¸å‘½ä¸­ å¦‚æœæŸ¥è¯¢ä¸­åŒ…å«ä»»ä½•ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ã€å­˜å‚¨å‡½æ•°ã€ç”¨æˆ·å˜é‡ã€ä¸´æ—¶è¡¨ã€MySQL åº“ä¸­çš„ç³»ç»Ÿè¡¨ï¼Œå…¶æŸ¥è¯¢ç»“æœä¹Ÿä¸ä¼šè¢«ç¼“å­˜ ç¼“å­˜å»ºç«‹ä¹‹åï¼ŒMySQL çš„æŸ¥è¯¢ç¼“å­˜ç³»ç»Ÿä¼šè·Ÿè¸ªæŸ¥è¯¢ä¸­æ¶‰åŠçš„æ¯å¼ è¡¨ï¼Œå¦‚æœè¿™äº›è¡¨ï¼ˆæ•°æ®æˆ–ç»“æ„ï¼‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå’Œè¿™å¼ è¡¨ç›¸å…³çš„æ‰€æœ‰ç¼“å­˜æ•°æ®éƒ½å°†å¤±æ•ˆ ç¼“å­˜è™½ç„¶èƒ½å¤Ÿæå‡æ•°æ®åº“çš„æŸ¥è¯¢æ€§èƒ½ï¼Œä½†æ˜¯ç¼“å­˜åŒæ—¶ä¹Ÿå¸¦æ¥äº†é¢å¤–çš„å¼€é”€ï¼Œæ¯æ¬¡æŸ¥è¯¢åéƒ½è¦åšä¸€æ¬¡ç¼“å­˜æ“ä½œï¼Œå¤±æ•ˆåè¿˜è¦é”€æ¯ã€‚ å› æ­¤ï¼Œå¼€å¯æŸ¥è¯¢ç¼“å­˜è¦è°¨æ…ï¼Œå°¤å…¶å¯¹äºå†™å¯†é›†çš„åº”ç”¨æ¥è¯´æ›´æ˜¯å¦‚æ­¤ã€‚å¦‚æœå¼€å¯ï¼Œè¦æ³¨æ„åˆç†æ§åˆ¶ç¼“å­˜ç©ºé—´å¤§å°ï¼Œä¸€èˆ¬æ¥è¯´å…¶å¤§å°è®¾ç½®ä¸ºå‡ å MB æ¯”è¾ƒåˆé€‚ã€‚æ­¤å¤–ï¼Œ**è¿˜å¯ä»¥é€šè¿‡ sql_cache å’Œ sql_no_cache æ¥æ§åˆ¶æŸä¸ªæŸ¥è¯¢è¯­å¥æ˜¯å¦éœ€è¦ç¼“å­˜\nselect sql_no_cache count(*) from usr; MySQLäº‹åŠ¡ # ä½•è°“äº‹åŠ¡ # æˆ‘ä»¬è®¾æƒ³ä¸€ä¸ªåœºæ™¯ï¼Œè¿™ä¸ªåœºæ™¯ä¸­æˆ‘ä»¬éœ€è¦æ’å…¥å¤šæ¡ç›¸å…³è”çš„æ•°æ®åˆ°æ•°æ®åº“ï¼Œä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šé‡åˆ°ä¸‹é¢è¿™äº›é—®é¢˜ï¼š\næ•°æ®åº“ä¸­é€”çªç„¶å› ä¸ºæŸäº›åŸå› æŒ‚æ‰äº†ã€‚ å®¢æˆ·ç«¯çªç„¶å› ä¸ºç½‘ç»œåŸå› è¿æ¥ä¸ä¸Šæ•°æ®åº“äº†ã€‚ å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶å†™å…¥æ•°æ®åº“ï¼Œè¦†ç›–äº†å½¼æ­¤çš„æ›´æ”¹ã€‚ \u0026hellip;\u0026hellip; ä¸Šé¢çš„ä»»ä½•ä¸€ä¸ªé—®é¢˜éƒ½å¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œç³»ç»Ÿå¿…é¡»èƒ½å¤Ÿå¤„ç†è¿™äº›é—®é¢˜ã€‚äº‹åŠ¡å°±æ˜¯æˆ‘ä»¬æŠ½è±¡å‡ºæ¥ç®€åŒ–è¿™äº›é—®é¢˜çš„é¦–é€‰æœºåˆ¶ã€‚äº‹åŠ¡çš„æ¦‚å¿µèµ·æºäºæ•°æ®åº“ï¼Œç›®å‰ï¼Œå·²ç»æˆä¸ºä¸€ä¸ªæ¯”è¾ƒå¹¿æ³›çš„æ¦‚å¿µ\näº‹åŠ¡æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ\næœ€ç»å…¸çš„å°±æ˜¯è½¬è´¦ï¼Œå‡å¦‚å°æ˜è¦ç»™å°çº¢è½¬è´¦1000å…ƒï¼Œè¿™ä¸ªè½¬è´¦æ¶‰åŠåˆ°ä¸¤ä¸ªå…³é”®æ“ä½œï¼Œè¿™ä¸¤ä¸ªæ“ä½œå¿…é¡»éƒ½æˆåŠŸæˆ–è€…éƒ½å¤±è´¥\nå°†å°æ˜çš„ä½™é¢å‡å°‘1000å…ƒ å°†å°çº¢çš„ä½™é¢å¢åŠ 1000å…ƒ äº‹åŠ¡ä¼šæŠŠä¸¤ä¸ªæ“ä½œçœ‹æˆé€»è¾‘ä¸Šçš„ä¸€ä¸ªæ•´ä½“ï¼Œè¿™ä¸ªæ•´ä½“åŒ…å«çš„æ“ä½œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ã€‚è¿™æ ·å°±ä¸ä¼šå‡ºç°å°æ˜ä½™é¢å‡å°‘è€Œå°çº¢ä½™é¢å´æ²¡æœ‰å¢åŠ çš„æƒ…å†µ\nä½•è°“æ•°æ®åº“äº‹åŠ¡ # å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è°ˆè®ºäº‹åŠ¡çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æŒ‡åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¾€å¾€æŒ‡çš„æ˜¯æ•°æ®åº“äº‹åŠ¡\næ•°æ®åº“äº‹åŠ¡åœ¨æ—¥å¸¸å¼€å‘ä¸­æ¥è§¦æœ€å¤šï¼Œå¦‚æœé¡¹ç›®å±äºå•ä½“æ¶æ„ï¼Œæ¥è§¦çš„å¾€å¾€å°±æ˜¯æ•°æ®åº“äº‹åŠ¡\næ•°æ®åº“äº‹åŠ¡çš„ä½œç”¨\nå¯ä»¥ä¿è¯å¤šä¸ªå¯¹æ•°æ®åº“çš„æ“ä½œï¼ˆä¹Ÿå°±æ˜¯SQLè¯­å¥ï¼‰æ„æˆä¸€ä¸ªé€»è¾‘ä¸Šçš„æ•´ä½“ï¼Œæ„æˆè¿™ä¸ªé€»è¾‘ä¸Šæ•´ä½“çš„è¿™äº›æ•°æ®åº“æ“ä½œéµå¾ªï¼šè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œ\n# å¼€å¯ä¸€ä¸ªäº‹åŠ¡ START TRANSACTION; # å¤šæ¡ SQL è¯­å¥ SQL1,SQL2... ## æäº¤äº‹åŠ¡ COMMIT; å…³ç³»å‹æ•°æ®åº“ï¼ˆæ¯”å¦‚MySQLã€SQLServerã€Oracleç­‰ï¼‰äº‹åŠ¡éƒ½æœ‰ACIDç‰¹æ€§\nåŸå­æ€§ï¼ˆAtomicityï¼‰ ï¼š äº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ï¼› ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼š æ‰§è¡Œäº‹åŠ¡å‰åï¼Œæ•°æ®ä¿æŒä¸€è‡´ï¼Œä¾‹å¦‚è½¬è´¦ä¸šåŠ¡ä¸­ï¼Œæ— è®ºäº‹åŠ¡æ˜¯å¦æˆåŠŸï¼Œè½¬è´¦è€…å’Œæ”¶æ¬¾äººçš„æ€»é¢åº”è¯¥æ˜¯ä¸å˜çš„ï¼›ï¼ˆå…¶å®ä¸€è‡´æ€§æ˜¯ç»“æœï¼‰ éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼š å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸è¢«å…¶ä»–äº‹åŠ¡æ‰€å¹²æ‰°ï¼Œå„å¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®åº“æ˜¯ç‹¬ç«‹çš„ï¼› æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼š ä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚ åªæœ‰ä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§ã€åŸå­æ€§ã€éš”ç¦»æ€§ä¹‹åï¼Œä¸€è‡´æ€§æ‰èƒ½å¾—åˆ°ä¿éšœã€‚ä¹Ÿå°±æ˜¯è¯´ Aã€Iã€D æ˜¯æ‰‹æ®µï¼ŒC æ˜¯ç›®çš„ï¼ æƒ³å¿…å¤§å®¶ä¹Ÿå’Œæˆ‘ä¸€æ ·ï¼Œè¢« ACID è¿™ä¸ªæ¦‚å¿µè¢«è¯¯å¯¼äº†å¾ˆä¹…! æˆ‘ä¹Ÿæ˜¯çœ‹å‘¨å¿—æ˜è€å¸ˆçš„å…¬å¼€è¯¾ã€Šå‘¨å¿—æ˜çš„è½¯ä»¶æ¶æ„è¯¾ã€‹open in new windowæ‰ææ¸…æ¥šçš„ï¼ˆå¤šçœ‹å¥½ä¹¦ï¼ï¼ï¼‰\nå¦å¤–ï¼ŒDDIA ä¹Ÿå°±æ˜¯ ã€ŠDesigning Data-Intensive Applicationï¼ˆæ•°æ®å¯†é›†å‹åº”ç”¨ç³»ç»Ÿè®¾è®¡ï¼‰ã€‹open in new window çš„ä½œè€…åœ¨ä»–çš„è¿™æœ¬ä¹¦ä¸­å¦‚æ˜¯è¯´ï¼š\nAtomicity, isolation, and durability are properties of the database, whereas consisâ€ tency (in the ACID sense) is a property of the application. The application may rely on the databaseâ€™s atomicity and isolation properties in order to achieve consistency, but itâ€™s not up to the database alone.\nç¿»è¯‘è¿‡æ¥çš„æ„æ€æ˜¯ï¼šåŸå­æ€§ï¼Œéš”ç¦»æ€§å’ŒæŒä¹…æ€§æ˜¯æ•°æ®åº“çš„å±æ€§ï¼Œè€Œä¸€è‡´æ€§ï¼ˆåœ¨ ACID æ„ä¹‰ä¸Šï¼‰æ˜¯åº”ç”¨ç¨‹åºçš„å±æ€§ã€‚åº”ç”¨å¯èƒ½ä¾èµ–æ•°æ®åº“çš„åŸå­æ€§å’Œéš”ç¦»å±æ€§æ¥å®ç°ä¸€è‡´æ€§ï¼Œä½†è¿™å¹¶ä¸ä»…å–å†³äºæ•°æ®åº“ã€‚å› æ­¤ï¼Œå­—æ¯ C ä¸å±äº ACID ã€ŠDesigning Data-Intensive Applicationï¼ˆæ•°æ®å¯†é›†å‹åº”ç”¨ç³»ç»Ÿè®¾è®¡ï¼‰ã€‹è¿™æœ¬ä¹¦å¼ºæ¨ä¸€æ³¢ï¼Œå€¼å¾—è¯»å¾ˆå¤šéï¼è±†ç“£æœ‰æ¥è¿‘ 90% çš„äººçœ‹äº†è¿™æœ¬ä¹¦ä¹‹åç»™äº†äº”æ˜Ÿå¥½è¯„ã€‚å¦å¤–ï¼Œä¸­æ–‡ç¿»è¯‘ç‰ˆæœ¬å·²ç»åœ¨ Github å¼€æºï¼Œåœ°å€ï¼šhttps://github.com/Vonng/ddiaopen in new window\nå¹¶å‘äº‹åŠ¡å¸¦æ¥äº†å“ªäº›é—®é¢˜ # å…¸å‹åº”ç”¨ç¨‹åºä¸­ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶å‘è¿è¡Œï¼Œç»å¸¸ä¼šæ“ä½œç›¸åŒæ•°æ®æ¥å®Œæˆå„è‡ªä»»åŠ¡(å¤šä¸ªç”¨æˆ·å¯¹ç»Ÿä¸€æ•°æ®è¿›è¡Œæ“ä½œ)ã€‚å¹¶å‘è™½ç„¶æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯ä¼šå¯¼è‡´ä¸€ä¸‹çš„é—®é¢˜\nè„è¯»ï¼ˆDirty readï¼‰ **\nä¸€ä¸ªäº‹åŠ¡è¯»å–æ•°æ®å¹¶ä¸”å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œè¿™ä¸ªä¿®æ”¹å¯¹å…¶ä»–äº‹åŠ¡æ¥è¯´æ˜¯å¯è§çš„(å…¶å®å°±æ˜¯è¯»æœªæäº¤ï¼‰ï¼Œå³ä½¿å½“å‰äº‹åŠ¡æ²¡æœ‰æäº¤ã€‚è¿™æ—¶å¦å¤–ä¸€ä¸ªäº‹åŠ¡è¯»å–äº†è¿™ä¸ªè¿˜æœªæäº¤çš„æ•°æ®ï¼Œä½†ç¬¬ä¸€ä¸ªäº‹åŠ¡çªç„¶å›æ»šï¼Œå¯¼è‡´æ•°æ®å¹¶æ²¡æœ‰è¢«æäº¤åˆ°æ•°æ®åº“ï¼Œé‚£ç¬¬äºŒä¸ªäº‹åŠ¡è¯»å–åˆ°çš„å°±æ˜¯è„æ•°æ®**ï¼Œè¿™ä¹Ÿå°±æ˜¯è„è¯»çš„ç”±æ¥ã€‚\nä¾‹å¦‚ï¼šäº‹åŠ¡ 1 è¯»å–æŸè¡¨ä¸­çš„æ•°æ® A=20ï¼Œäº‹åŠ¡ 1 ä¿®æ”¹ A=A-1ï¼Œäº‹åŠ¡ 2 è¯»å–åˆ° A = 19,äº‹åŠ¡ 1 å›æ»šå¯¼è‡´å¯¹ A çš„ä¿®æ”¹å¹¶ä¸ºæäº¤åˆ°æ•°æ®åº“ï¼Œ A çš„å€¼è¿˜æ˜¯ 20\nä¸¢å¤±ä¿®æ”¹ï¼ˆLost to modifyï¼‰ åœ¨ä¸€ä¸ªäº‹åŠ¡è¯»å–ä¸€ä¸ªæ•°æ®æ—¶ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®äº†è¯¥æ•°æ®ï¼Œé‚£ä¹ˆåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­ä¿®æ”¹äº†è¿™ä¸ªæ•°æ®åï¼Œç¬¬äºŒä¸ªäº‹åŠ¡ä¹Ÿä¿®æ”¹äº†è¿™ä¸ªæ•°æ®ã€‚è¿™æ ·ç¬¬ä¸€ä¸ªäº‹åŠ¡å†…çš„ä¿®æ”¹ç»“æœå°±è¢«ä¸¢å¤±ï¼Œå› æ­¤ç§°ä¸ºä¸¢å¤±ä¿®æ”¹ã€‚\nä¾‹å¦‚ï¼šäº‹åŠ¡ 1 è¯»å–æŸè¡¨ä¸­çš„æ•°æ® A=20ï¼Œäº‹åŠ¡ 2 ä¹Ÿè¯»å– A=20ï¼Œäº‹åŠ¡ 1 å…ˆä¿®æ”¹ A=A-1ï¼Œäº‹åŠ¡ 2 åæ¥ä¹Ÿä¿®æ”¹ A=A-1ï¼Œæœ€ç»ˆç»“æœ A=19ï¼Œäº‹åŠ¡ 1 çš„ä¿®æ”¹è¢«ä¸¢å¤±ã€‚ (è¿™é‡Œä¾‹å­ä¸¾å¾—ä¸å¥½ï¼Œç”¨äº‹åŠ¡2è¿›è¡Œäº†A = A - 2 æ“ä½œä¼šæ¯”è¾ƒæ˜æ˜¾) ä¸å¯é‡å¤è¯»ï¼ˆUnrepeatable read)\næŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡è¯»åŒä¸€æ•°æ®ã€‚åœ¨è¿™ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰ç»“æŸæ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®è¯¥æ•°æ®ã€‚é‚£ä¹ˆï¼Œåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸¤æ¬¡è¯»æ•°æ®ä¹‹é—´ï¼Œç”±äºç¬¬äºŒä¸ªäº‹åŠ¡çš„ä¿®æ”¹å¯¼è‡´ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–çš„æ•°æ®å¯èƒ½ä¸å¤ªä¸€æ ·ã€‚è¿™å°±å‘ç”Ÿäº†åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®æ˜¯ä¸ä¸€æ ·çš„æƒ…å†µï¼Œå› æ­¤ç§°ä¸ºä¸å¯é‡å¤è¯»ã€‚\nä¾‹å¦‚ï¼šäº‹åŠ¡ 1 è¯»å–æŸè¡¨ä¸­çš„æ•°æ® A=20ï¼Œäº‹åŠ¡ 2 ä¹Ÿè¯»å– A=20ï¼Œäº‹åŠ¡ 1 ä¿®æ”¹ A=A-1ï¼Œäº‹åŠ¡ 2 å†æ¬¡è¯»å– A =19ï¼Œæ­¤æ—¶è¯»å–çš„ç»“æœå’Œç¬¬ä¸€æ¬¡è¯»å–çš„ç»“æœä¸åŒã€‚\nå¹»è¯»\nå¹»è¯»ä¸ä¸å¯é‡å¤è¯»ç±»ä¼¼ã€‚å®ƒå‘ç”Ÿåœ¨ä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å‡ è¡Œæ•°æ®ï¼Œæ¥ç€å¦ä¸€ä¸ªå¹¶å‘äº‹åŠ¡æ’å…¥äº†ä¸€äº›æ•°æ®æ—¶ã€‚åœ¨éšåçš„æŸ¥è¯¢ä¸­ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡å°±ä¼šå‘ç°å¤šäº†ä¸€äº›åŸæœ¬ä¸å­˜åœ¨çš„è®°å½•ï¼Œå°±å¥½åƒå‘ç”Ÿäº†å¹»è§‰ä¸€æ ·ï¼Œæ‰€ä»¥ç§°ä¸ºå¹»è¯»ã€‚\nä¾‹å¦‚ï¼šäº‹åŠ¡ 2 è¯»å–æŸä¸ªèŒƒå›´çš„æ•°æ®ï¼Œäº‹åŠ¡ 1 åœ¨è¿™ä¸ªèŒƒå›´æ’å…¥äº†æ–°çš„æ•°æ®ï¼Œäº‹åŠ¡ 1 å†æ¬¡è¯»å–è¿™ä¸ªèŒƒå›´çš„æ•°æ®å‘ç°ç›¸æ¯”äºç¬¬ä¸€æ¬¡è¯»å–çš„ç»“æœå¤šäº†æ–°çš„æ•°æ®ã€‚\nä¸å¯é‡å¤è¯»å’Œå¹»è¯»æœ‰ä»€ä¹ˆåŒºåˆ« # ä¸å¯é‡å¤è¯»çš„é‡ç‚¹æ˜¯å†…å®¹ä¿®æ”¹æˆ–è€…è®°å½•å‡å°‘ã€‚æ¯”å¦‚å¤šæ¬¡è¯»å–ä¸€æ¡è®°å½•å‘ç°å…¶ä¸­æŸäº›è®°å½•çš„å€¼è¢«ä¿®æ”¹ï¼›\nå¹»è¯»çš„é‡ç‚¹åœ¨äºè®°å½•æ–°å¢æ¯”å¦‚å¤šæ¬¡æ‰§è¡ŒåŒä¸€æ¡æŸ¥è¯¢è¯­å¥ï¼ˆDQLï¼‰æ—¶ï¼Œå‘ç°æŸ¥åˆ°çš„è®°å½•å¢åŠ äº†ã€‚\nå¹»è¯»å…¶å®å¯ä»¥çœ‹ä½œæ˜¯ä¸å¯é‡å¤è¯»çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå•ç‹¬æŠŠåŒºåˆ†å¹»è¯»çš„åŸå› ä¸»è¦æ˜¯è§£å†³å¹»è¯»å’Œä¸å¯é‡å¤è¯»çš„æ–¹æ¡ˆä¸ä¸€æ ·ã€‚\nä¸¾ä¸ªä¾‹å­ï¼šæ‰§è¡Œ delete å’Œ update æ“ä½œçš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥å¯¹è®°å½•åŠ é”ï¼Œä¿è¯äº‹åŠ¡å®‰å…¨ã€‚è€Œæ‰§è¡Œ insert æ“ä½œçš„æ—¶å€™ï¼Œç”±äºè®°å½•é”ï¼ˆRecord Lockï¼‰åªèƒ½é”ä½å·²ç»å­˜åœ¨çš„è®°å½•ï¼Œä¸ºäº†é¿å…æ’å…¥æ–°è®°å½•ï¼Œéœ€è¦ä¾èµ–é—´éš™é”ï¼ˆGap Lockï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´æ‰§è¡Œ insert æ“ä½œçš„æ—¶å€™éœ€è¦ä¾èµ– Next-Key Lockï¼ˆRecord Lock+Gap Lockï¼‰ è¿›è¡ŒåŠ é”æ¥ä¿è¯ä¸å‡ºç°å¹»è¯»ã€‚ (è¿™é‡Œè¯´çš„æ˜¯å®Œå…¨è§£å†³å¹»è¯»ï¼Œå…¶å®ä¹Ÿå¯ä»¥ä¾é MVCCéƒ¨åˆ†è§£å†³å¹»è¯») ä½¿ç”¨MVCCæœºåˆ¶ï¼ˆåªåœ¨äº‹åŠ¡ç¬¬ä¸€æ¬¡selectçš„æ—¶å€™ç”ŸæˆReadViewè§£å†³ä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼‰ SQLæ ‡å‡†å®šä¹‰äº†å“ªäº›äº‹åŠ¡éš”ç¦»çº§åˆ« # SQLæ ‡å‡†å®šä¹‰äº†**å››ä¸ªéš”ç¦»çº§åˆ« **\nREAD-UNCOMMITTED(è¯»å–æœªæäº¤) ï¼š æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ã€‚ READ-COMMITTED(è¯»å–å·²æäº¤) ï¼š å…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚ REPEATABLE-READ(å¯é‡å¤è¯») ï¼š å¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œå¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚ SERIALIZABLE(å¯ä¸²è¡ŒåŒ–) ï¼š æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä» ACID çš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»ã€‚ éš”ç¦»çº§åˆ« è„è¯» ä¸å¯é‡å¤è¯» å¹»è¯» READ-UNCOMMITTED âˆš âˆš âˆš READ-COMMITTED Ã— âˆš âˆš REPEATABLE-READ Ã— Ã— âˆš SERIALIZABLE Ã— Ã— Ã— MySQLçš„éš”ç¦»çº§åˆ«æ˜¯åŸºäºé”å®ç°çš„å— # MySQL çš„éš”ç¦»çº§åˆ«åŸºäºé”å’Œ MVCC æœºåˆ¶å…±åŒå®ç°çš„ã€‚\nSERIALIZABLE éš”ç¦»çº§åˆ«ï¼Œæ˜¯é€šè¿‡é”æ¥å®ç°çš„ã€‚é™¤äº† SERIALIZABLE éš”ç¦»çº§åˆ«ï¼Œå…¶ä»–çš„éš”ç¦»çº§åˆ«éƒ½æ˜¯åŸºäº MVCC å®ç°ã€‚ ä¸è¿‡ï¼Œ SERIALIZABLE ä¹‹å¤–çš„å…¶ä»–éš”ç¦»çº§åˆ«å¯èƒ½ä¹Ÿéœ€è¦ç”¨åˆ°é”æœºåˆ¶ï¼Œå°±æ¯”å¦‚ REPEATABLE-READ åœ¨å½“å‰è¯»æƒ…å†µä¸‹éœ€è¦ä½¿ç”¨åŠ é”è¯»æ¥ä¿è¯ä¸ä¼šå‡ºç°å¹»è¯»ï¼ˆè¿™å°±æ˜¯MVCCä¸èƒ½è§£å†³å¹»è¯»çš„ä¾‹å¤–ä¹‹ä¸€ï¼‰ã€‚ ä¸Šè¿°æ€»ç»“ # MySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯ä»€ä¹ˆ # MySQL InnoDB å­˜å‚¨å¼•æ“çš„é»˜è®¤æ”¯æŒçš„éš”ç¦»çº§åˆ«æ˜¯ REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡**SELECT @@tx_isolation;**å‘½ä»¤æ¥æŸ¥çœ‹ï¼ŒMySQL 8.0 è¯¥å‘½ä»¤æ”¹ä¸ºSELECT @@transaction_isolation;\nmysql\u0026gt; SELECT @@tx_isolation; +-----------------+ | @@tx_isolation | +-----------------+ | REPEATABLE-READ | +-----------------+ ------ å…³äº MySQL äº‹åŠ¡éš”ç¦»çº§åˆ«çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥çœ‹çœ‹æˆ‘å†™çš„è¿™ç¯‡æ–‡ç« ï¼š MySQL äº‹åŠ¡éš”ç¦»çº§åˆ«è¯¦è§£\nMySQLé” # è¡¨çº§é”å’Œè¡Œçº§é”äº†è§£å—ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ« # MyISAM ä»…ä»…æ”¯æŒè¡¨çº§é”(table-level locking)ï¼Œä¸€é”å°±é”æ•´å¼ è¡¨ï¼Œè¿™åœ¨å¹¶å‘å†™çš„æƒ…å†µä¸‹æ€§éå¸¸å·®ã€‚ InnoDB ä¸å…‰æ”¯æŒè¡¨çº§é”(table-level locking)ï¼Œè¿˜æ”¯æŒè¡Œçº§é”(row-level locking)ï¼Œé»˜è®¤ä¸ºè¡Œçº§é”ã€‚è¡Œçº§é”çš„ç²’åº¦æ›´å°ï¼Œä»…å¯¹ç›¸å…³çš„è®°å½•ä¸Šé”å³å¯ï¼ˆå¯¹ä¸€è¡Œæˆ–è€…å¤šè¡Œè®°å½•åŠ é”ï¼‰ï¼Œæ‰€ä»¥å¯¹äºå¹¶å‘å†™å…¥æ“ä½œæ¥è¯´ï¼Œ InnoDB çš„æ€§èƒ½æ›´é«˜ã€‚ è¡¨çº§é”å’Œè¡Œçº§é”å¯¹æ¯” ï¼š\nè¡¨çº§é”ï¼š MySQL ä¸­é”å®šç²’åº¦æœ€å¤§çš„ä¸€ç§é”ï¼ˆå…¨å±€é”é™¤å¤–ï¼‰ï¼Œæ˜¯é’ˆå¯¹éç´¢å¼•å­—æ®µåŠ çš„é”ï¼Œå¯¹å½“å‰æ“ä½œçš„æ•´å¼ è¡¨åŠ é”ï¼Œå®ç°ç®€å•ï¼Œèµ„æºæ¶ˆè€—ä¹Ÿæ¯”è¾ƒå°‘ï¼ŒåŠ é”å¿«ï¼Œä¸ä¼šå‡ºç°æ­»é”ã€‚å…¶é”å®šç²’åº¦æœ€å¤§ï¼Œè§¦å‘é”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œå¹¶å‘åº¦æœ€ä½ï¼ŒMyISAM å’Œ InnoDB å¼•æ“éƒ½æ”¯æŒè¡¨çº§é”ã€‚\nè¡Œçº§é”ï¼š MySQL ä¸­é”å®šç²’åº¦æœ€å°çš„ä¸€ç§é”ï¼Œæ˜¯é’ˆå¯¹ç´¢å¼•å­—æ®µåŠ çš„é”ï¼Œåªé’ˆå¯¹å½“å‰æ“ä½œçš„è¡Œè®°å½•è¿›è¡ŒåŠ é”ã€‚ è¡Œçº§é”èƒ½å¤§å¤§å‡å°‘æ•°æ®åº“æ“ä½œçš„å†²çªã€‚å…¶åŠ é”ç²’åº¦æœ€å°ï¼Œå¹¶å‘åº¦é«˜ï¼Œä½†åŠ é”çš„å¼€é”€ä¹Ÿæœ€å¤§ï¼ŒåŠ é”æ…¢ï¼Œä¼šå‡ºç°æ­»é”ã€‚\nè¡Œçº§é”çš„ä½¿ç”¨æœ‰ä»€ä¹ˆæ³¨æ„äº‹é¡¹ # InnoDB çš„è¡Œé”æ˜¯é’ˆå¯¹ç´¢å¼•å­—æ®µåŠ çš„é”ï¼Œè¡¨çº§é”æ˜¯é’ˆå¯¹éç´¢å¼•å­—æ®µåŠ çš„é”ã€‚\nå½“æˆ‘ä»¬æ‰§è¡Œ UPDATEã€DELETE è¯­å¥æ—¶ï¼Œå¦‚æœ WHEREæ¡ä»¶ä¸­å­—æ®µæ²¡æœ‰å‘½ä¸­å”¯ä¸€ç´¢å¼•æˆ–è€…ç´¢å¼•å¤±æ•ˆçš„è¯ï¼Œå°±ä¼šå¯¼è‡´æ‰«æå…¨è¡¨å¯¹è¡¨ä¸­çš„æ‰€æœ‰è¡Œè®°å½•è¿›è¡ŒåŠ é”ã€‚è¿™ä¸ªåœ¨æˆ‘ä»¬æ—¥å¸¸å·¥ä½œå¼€å‘ä¸­ç»å¸¸ä¼šé‡åˆ°ï¼Œä¸€å®šè¦å¤šå¤šæ³¨æ„ï¼ï¼ï¼\nä¸è¿‡ï¼Œå¾ˆå¤šæ—¶å€™å³ä½¿ç”¨äº†ç´¢å¼•ä¹Ÿæœ‰å¯èƒ½ä¼šèµ°å…¨è¡¨æ‰«æï¼Œè¿™æ˜¯å› ä¸º MySQL ä¼˜åŒ–å™¨çš„åŸå› ã€‚\nå…±äº«é”å’Œæ’ä»–é” # ä¸è®ºæ˜¯è¡¨çº§é”è¿˜æ˜¯è¡Œçº§é”ï¼Œéƒ½å­˜åœ¨**å…±äº«é”ï¼ˆShare Lockï¼ŒS é”ï¼‰å’Œæ’ä»–é”ï¼ˆExclusive Lockï¼ŒX é”ï¼‰**è¿™ä¸¤ç±»\nå…±äº«é”ï¼ˆS é”ï¼‰ ï¼šåˆç§°è¯»é”ï¼Œäº‹åŠ¡åœ¨è¯»å–è®°å½•çš„æ—¶å€™è·å–å…±äº«é”ï¼Œå…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è·å–ï¼ˆé”å…¼å®¹ï¼‰ã€‚ æ’ä»–é”ï¼ˆX é”ï¼‰ ï¼šåˆç§°å†™é”/ç‹¬å é”ï¼Œäº‹åŠ¡åœ¨ä¿®æ”¹è®°å½•çš„æ—¶å€™è·å–æ’ä»–é”ï¼Œä¸å…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è·å–ã€‚å¦‚æœä¸€ä¸ªè®°å½•å·²ç»è¢«åŠ äº†æ’ä»–é”ï¼Œé‚£å…¶ä»–äº‹åŠ¡ä¸èƒ½å†å¯¹è¿™æ¡äº‹åŠ¡åŠ ä»»ä½•ç±»å‹çš„é”**ï¼ˆé”ä¸å…¼å®¹ï¼‰**ã€‚ æ’ä»–é”ä¸ä»»ä½•çš„é”éƒ½ä¸å…¼å®¹ï¼Œå…±äº«é”ä»…å’Œå…±äº«é”å…¼å®¹ã€‚\nS é” X é” S é” ä¸å†²çª å†²çª X é” å†²çª å†²çª ç”±äº MVCC çš„å­˜åœ¨ï¼Œå¯¹äºä¸€èˆ¬çš„ SELECT è¯­å¥ï¼ŒInnoDB ä¸ä¼šåŠ ä»»ä½•é”ã€‚ä¸è¿‡ï¼Œ ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹è¯­å¥æ˜¾å¼åŠ å…±äº«é”æˆ–æ’ä»–é”ï¼š\n# å…±äº«é” SELECT ... LOCK IN SHARE MODE; # æ’ä»–é” SELECT ... FOR UPDATE; æ„å‘é”æœ‰ä»€ä¹ˆä½œç”¨ # â˜…â˜… é‡ç‚¹ ï¼šå¦‚æœéœ€è¦ç”¨åˆ°è¡¨é”çš„è¯ï¼Œå¦‚ä½•åˆ¤æ–­è¡¨ä¸­çš„è®°å½•æ²¡æœ‰è¡Œé”å‘¢ï¼Ÿä¸€è¡Œä¸€è¡Œéå†è‚¯å®šæ˜¯ä¸è¡Œï¼Œæ€§èƒ½å¤ªå·®ã€‚æˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸€ä¸ªå«åšæ„å‘é”çš„ä¸œä¸œæ¥å¿«é€Ÿåˆ¤æ–­æ˜¯å¦å¯ä»¥å¯¹æŸä¸ªè¡¨ä½¿ç”¨è¡¨é”ã€‚\næ„å‘é”æ˜¯è¡¨çº§é”ï¼ˆè¿™å¥è¯å¾ˆé‡è¦ï¼Œæ„å‘é”æ˜¯æè¿°æŸä¸ªè¡¨çš„æŸä¸ªå±æ€§ï¼ˆè¿™ä¸ªè¡¨æ˜¯å¦æœ‰è®°å½•åŠ äº†å…±äº«é”/æˆ–è€…æ’ä»–é”ï¼‰ï¼‰ï¼Œå…±æœ‰ä¸¤ç§ï¼š\næ„å‘å…±äº«é”ï¼ˆIntention Shared Lockï¼ŒIS é”ï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è®°å½•åŠ å…±äº«é”ï¼ˆS é”ï¼‰ï¼ŒåŠ å…±äº«é”å‰å¿…é¡»å…ˆå–å¾—è¯¥è¡¨çš„ IS é”ã€‚\næ„å‘æ’ä»–é”ï¼ˆIntention Exclusive Lockï¼ŒIX é”ï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è®°å½•åŠ æ’ä»–é”ï¼ˆX é”ï¼‰ï¼ŒåŠ æ’ä»–é”ä¹‹å‰å¿…é¡»å…ˆå–å¾—è¯¥è¡¨çš„ IX é”ã€‚\næ„å‘é”æ˜¯æœ‰æ•°æ®å¼•æ“è‡ªå·±ç»´æŠ¤çš„ï¼Œç”¨æˆ·æ— æ³•æ‰‹åŠ¨æ“ä½œæ„å‘é”ï¼Œåœ¨ä¸ºæ•°æ®è¡ŒåŠ å…±äº« / æ’ä»–é”ä¹‹å‰ï¼ŒInooDB ä¼šå…ˆè·å–ï¼ˆå¦‚æœè·å–åˆ°äº†ï¼Œå…¶å®å°±æ˜¯â€œåŠ äº†é”â€ï¼‰è¯¥æ•°æ®è¡Œæ‰€åœ¨åœ¨æ•°æ®è¡¨çš„å¯¹åº”æ„å‘é”ã€‚\næ„å‘é”ä¹‹é—´æ˜¯äº’ç›¸å…¼å®¹çš„ ï¼š\nç†ç”±å¾ˆç®€å•ï¼Œè¡¨é‡ŒæŸä¸€æ¡è®°å½•åŠ äº†æ’ä»–é”ï¼ˆå³è¿™ä¸ªè¡¨åŠ äº†æ„å‘æ’ä»–é”ï¼‰ï¼Œä¸ä»£è¡¨ä¸èƒ½æ“ä½œå…¶ä»–è®°å½•\nIS é” IX é” IS é” å…¼å®¹ å…¼å®¹ IX é” å…¼å®¹ å…¼å®¹ æ„å‘é”å’Œå…±äº«é”å’Œæ’å®ƒé”äº’æ–¥ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯è¡¨çº§åˆ«çš„å…±äº«é”å’Œæ’ä»–é”ï¼Œæ„å‘é”ä¸ä¼šä¸è¡Œçº§çš„å…±äº«é”å’Œæ’ä»–é”äº’æ–¥ï¼Œâ˜…â˜…æ‹¬å·é‡Œè¿™å¥è¯æå…¶é‡è¦ï¼Œè¦ä¸ç„¶å°±çœ‹ä¸æ‡‚ä¸‹é¢çš„è¡¨äº†ï¼‰ã€‚\nIS é” IX é” S é” å…¼å®¹ äº’æ–¥ X é” äº’æ–¥ äº’æ–¥ ã€ŠMySQL æŠ€æœ¯å†…å¹• InnoDB å­˜å‚¨å¼•æ“ã€‹è¿™æœ¬ä¹¦å¯¹åº”çš„æè¿°åº”è¯¥æ˜¯ç¬”è¯¯äº†ã€‚\nInnoDB æœ‰å“ªå‡ ç±»è¡Œé” # MySQL InnoDB æ”¯æŒä¸‰ç§è¡Œé”å®šæ–¹å¼ï¼š\nè®°å½•é”ï¼ˆRecord Lockï¼‰ ï¼šä¹Ÿè¢«ç§°ä¸ºè®°å½•é”ï¼Œå±äºå•ä¸ªè¡Œè®°å½•ä¸Šçš„é”ã€‚ é—´éš™é”ï¼ˆGap Lockï¼‰ ï¼šé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä¸åŒ…æ‹¬è®°å½•æœ¬èº«ã€‚ ä¸´é”®é”ï¼ˆNext-key Lockï¼‰ ï¼šRecord Lock+Gap Lockï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼ŒåŒ…å«è®°å½•æœ¬èº«ã€‚è®°å½•é”åªèƒ½é”ä½å·²ç»å­˜åœ¨çš„è®°å½•ï¼Œä¸ºäº†é¿å…æ’å…¥æ–°è®°å½•ï¼Œéœ€è¦ä¾èµ–é—´éš™é”ã€‚ InnoDB çš„é»˜è®¤éš”ç¦»çº§åˆ« RRï¼ˆå¯é‡è¯»ï¼‰æ˜¯å¯ä»¥è§£å†³å¹»è¯»é—®é¢˜å‘ç”Ÿçš„ï¼Œä¸»è¦æœ‰ä¸‹é¢ä¸¤ç§æƒ…å†µï¼š\nå¿«ç…§è¯»ï¼ˆä¸€è‡´æ€§éé”å®šè¯»ï¼‰ ï¼šç”± MVCC æœºåˆ¶æ¥ä¿è¯ä¸å‡ºç°å¹»è¯»ã€‚ å½“å‰è¯» ï¼ˆä¸€è‡´æ€§é”å®šè¯»ï¼‰ï¼š ä½¿ç”¨ Next-Key Lock è¿›è¡ŒåŠ é”æ¥ä¿è¯ä¸å‡ºç°å¹»è¯»ã€‚ å½“å‰è¯»å’Œå¿«ç…§è¯»æœ‰ä»€ä¹ˆåŒºåˆ« # å¿«ç…§è¯»ï¼ˆä¸€è‡´æ€§éé”å®šè¯»ï¼‰å°±æ˜¯å•çº¯çš„ SELECT è¯­å¥ï¼Œä½†ä¸åŒ…æ‹¬ä¸‹é¢è¿™ä¸¤ç±» SELECT è¯­å¥ï¼š\nSELECT ... FOR UPDATE SELECT ... LOCK IN SHARE MODE å¿«ç…§å³è®°å½•çš„å†å²ç‰ˆæœ¬ï¼Œæ¯è¡Œè®°å½•å¯èƒ½å­˜åœ¨å¤šä¸ªå†å²ç‰ˆæœ¬ï¼ˆå¤šç‰ˆæœ¬æŠ€æœ¯ï¼‰ã€‚\nå¿«ç…§è¯»çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè¯»å–çš„è®°å½•æ­£åœ¨æ‰§è¡Œ UPDATE/DELETE æ“ä½œï¼Œè¯»å–æ“ä½œä¸ä¼šå› æ­¤å»ç­‰å¾…è®°å½•ä¸Š X é”çš„é‡Šæ”¾ï¼Œè€Œæ˜¯ä¼šå»è¯»å–è¡Œçš„ä¸€ä¸ªå¿«ç…§ã€‚\nåªæœ‰åœ¨äº‹åŠ¡éš”ç¦»çº§åˆ« RC(è¯»å–å·²æäº¤ï¼ŒReadCommit) å’Œ **RRï¼ˆå¯é‡è¯»ï¼ŒRepeatableCommitï¼‰**ä¸‹ï¼ŒInnoDB æ‰ä¼šä½¿ç”¨ä¸€è‡´æ€§éé”å®šè¯»ï¼š\nåœ¨ RC çº§åˆ«ä¸‹ï¼Œå¯¹äºå¿«ç…§æ•°æ®ï¼Œä¸€è‡´æ€§éé”å®šè¯»æ€»æ˜¯è¯»å–è¢«é”å®šè¡Œçš„æœ€æ–°ä¸€ä»½ï¼ˆå¯è§ï¼‰å¿«ç…§æ•°æ®ã€‚ åœ¨ RR çº§åˆ«ä¸‹ï¼Œå¯¹äºå¿«ç…§æ•°æ®ï¼Œä¸€è‡´æ€§éé”å®šè¯»æ€»æ˜¯è¯»å–æœ¬äº‹åŠ¡å¼€å§‹æ—¶çš„è¡Œæ•°æ®ç‰ˆæœ¬ã€‚ å¿«ç…§è¯»æ¯”è¾ƒé€‚åˆå¯¹äºæ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸æ˜¯ç‰¹åˆ«é«˜ä¸”è¿½æ±‚æè‡´æ€§èƒ½çš„ä¸šåŠ¡åœºæ™¯ã€‚\nå½“å‰è¯» ï¼ˆä¸€è‡´æ€§é”å®šè¯»ï¼‰å°±æ˜¯ç»™è¡Œè®°å½•åŠ  X é”æˆ– S é”ã€‚ï¼ˆä½¿ç”¨å½“å‰è¯»çš„è¯åœ¨RRçº§åˆ«ä¸‹å°±æ— æ³•è§£å†³å¹»è¯»ï¼‰\nå½“å‰è¯»çš„ä¸€äº›å¸¸è§ SQL è¯­å¥ç±»å‹å¦‚ä¸‹ï¼š\n# å¯¹è¯»çš„è®°å½•åŠ ä¸€ä¸ªXé” SELECT...FOR UPDATE # å¯¹è¯»çš„è®°å½•åŠ ä¸€ä¸ªSé” SELECT...LOCK IN SHARE MODE # å¯¹ä¿®æ”¹çš„è®°å½•åŠ ä¸€ä¸ªXé” INSERT... UPDATE... DELETE... MySQL æ€§èƒ½ä¼˜åŒ– # å…³äº MySQL æ€§èƒ½ä¼˜åŒ–çš„å»ºè®®æ€»ç»“ï¼Œè¯·çœ‹è¿™ç¯‡æ–‡ç« ï¼š MySQL é«˜æ€§èƒ½ä¼˜åŒ–è§„èŒƒå»ºè®®æ€»ç»“\nèƒ½ç”¨MySQLç›´æ¥å­˜å‚¨æ–‡ä»¶ï¼ˆæ¯”å¦‚å›¾ç‰‡ï¼‰å— # å¯ä»¥æ˜¯å¯ä»¥ï¼Œç›´æ¥å­˜å‚¨æ–‡ä»¶å¯¹åº”çš„äºŒè¿›åˆ¶æ•°æ®å³å¯ã€‚ä¸è¿‡ï¼Œè¿˜æ˜¯å»ºè®®ä¸è¦åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ–‡ä»¶ï¼Œä¼šä¸¥é‡å½±å“æ•°æ®åº“æ€§èƒ½ï¼Œæ¶ˆè€—è¿‡å¤šå­˜å‚¨ç©ºé—´ã€‚\næ•°æ®åº“åªå­˜å‚¨æ–‡ä»¶åœ°å€ä¿¡æ¯ï¼Œæ–‡ä»¶ç”±æ–‡ä»¶å­˜å‚¨æœåŠ¡è´Ÿè´£å­˜å‚¨ã€‚\nå¯ä»¥é€‰æ‹©ä½¿ç”¨äº‘æœåŠ¡å‚å•†æä¾›çš„å¼€ç®±å³ç”¨çš„æ–‡ä»¶å­˜å‚¨æœåŠ¡ï¼Œæˆç†Ÿç¨³å®šï¼Œä»·æ ¼ä¹Ÿæ¯”è¾ƒä½ã€‚ ä¹Ÿå¯ä»¥é€‰æ‹©è‡ªå»ºæ–‡ä»¶å­˜å‚¨æœåŠ¡ï¼Œå®ç°èµ·æ¥ä¹Ÿä¸éš¾ï¼ŒåŸºäº FastDFSã€MinIOï¼ˆæ¨èï¼‰ ç­‰å¼€æºé¡¹ç›®å°±å¯ä»¥å®ç°åˆ†å¸ƒå¼æ–‡ä»¶æœåŠ¡ã€‚\nç›¸å…³é˜…è¯»ï¼šSpring Boot æ•´åˆ MinIO å®ç°åˆ†å¸ƒå¼æ–‡ä»¶æœåŠ¡\nMySQLå¦‚ä½•å­˜å‚¨IP åœ°å€ # å¯ä»¥å°† IP åœ°å€è½¬æ¢æˆæ•´å½¢æ•°æ®å­˜å‚¨ï¼Œæ€§èƒ½æ›´å¥½ï¼Œå ç”¨ç©ºé—´ä¹Ÿæ›´å°ã€‚\nMySQL æä¾›äº†ä¸¤ä¸ªæ–¹æ³•æ¥å¤„ç† ip åœ°å€\nINET_ATON() ï¼š æŠŠ ip è½¬ä¸ºæ— ç¬¦å·æ•´å‹ (4-8 ä½) INET_NTOA() :æŠŠæ•´å‹çš„ ip è½¬ä¸ºåœ°å€ æ’å…¥æ•°æ®å‰ï¼Œå…ˆç”¨ INET_ATON() æŠŠ ip åœ°å€è½¬ä¸ºæ•´å‹ï¼Œæ˜¾ç¤ºæ•°æ®æ—¶ï¼Œä½¿ç”¨ INET_NTOA() æŠŠæ•´å‹çš„ ip åœ°å€è½¬ä¸ºåœ°å€æ˜¾ç¤ºå³å¯\næœ‰å“ªäº›å¸¸è§çš„SQLä¼˜åŒ–æ‰‹æ®µå— # ã€ŠJava é¢è¯•æŒ‡åŒ—ã€‹open in new window çš„ã€ŒæŠ€æœ¯é¢è¯•é¢˜ç¯‡ã€æœ‰ä¸€ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº†å¸¸è§çš„ SQL ä¼˜åŒ–æ‰‹æ®µï¼Œéå¸¸å…¨é¢ï¼Œæ¸…æ™°æ˜“æ‡‚ï¼\n"},{"id":106,"href":"/zh/docs/study/Review/java_guide/database/MySQL/ly0609lyindex-invalidation-caused-by-implicit-conversion/","title":"MySQLä¸­çš„éšå¼è½¬æ¢é€ æˆçš„ç´¢å¼•å¤±æ•ˆ","section":"MySQL","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\næœ¬ç¯‡æ–‡ç« åŸºäºMySQL 5.7.26ï¼ŒåŸæ–‡ï¼šhttps://www.guitu18.com/post/2019/11/24/61.html\nå‰è¨€ # å…³äºæ•°æ®åº“ä¼˜åŒ–ï¼Œæœ€å¸¸è§çš„è«è¿‡äºç´¢å¼•å¤±æ•ˆï¼Œæ•°æ®é‡å¤šçš„æ—¶å€™æ¯”è¾ƒæ˜æ˜¾ï¼Œå¤„ç†ä¸åŠæ—¶ä¼šé€ æˆé›ªçƒæ•ˆåº”ï¼Œæœ€ç»ˆå¯¼è‡´æ•°æ®åº“å¡æ­»ç”šè‡³ç˜«ç—ªã€‚ è¿™é‡Œè¯´çš„æ˜¯éšå¼è½¬æ¢é€ æˆçš„ç´¢å¼•å¤±æ•ˆ æ•°æ®å‡†å¤‡ # -- åˆ›å»ºæµ‹è¯•æ•°æ®è¡¨ DROP TABLE IF EXISTS test1; CREATE TABLE `test1` ( `id` int(11) NOT NULL, `num1` int(11) NOT NULL DEFAULT \u0026#39;0\u0026#39;, `num2` varchar(11) NOT NULL DEFAULT \u0026#39;\u0026#39;, `type1` int(4) NOT NULL DEFAULT \u0026#39;0\u0026#39;, `type2` int(4) NOT NULL DEFAULT \u0026#39;0\u0026#39;, `str1` varchar(100) NOT NULL DEFAULT \u0026#39;\u0026#39;, `str2` varchar(100) DEFAULT NULL, PRIMARY KEY (`id`), KEY `num1` (`num1`), KEY `num2` (`num2`), KEY `type1` (`type1`), KEY `str1` (`str1`), KEY `str2` (`str2`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; -- åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ DROP PROCEDURE IF EXISTS pre_test1; DELIMITER // CREATE PROCEDURE `pre_test1`() BEGIN DECLARE i INT DEFAULT 0; SET autocommit = 0; WHILE i \u0026lt; 10000000 DO SET i = i + 1; SET @str1 = SUBSTRING(MD5(RAND()),1,20); -- æ¯100æ¡æ•°æ®str2äº§ç”Ÿä¸€ä¸ªnullå€¼ IF i % 100 = 0 THEN SET @str2 = NULL; ELSE SET @str2 = @str1; END IF; INSERT INTO test1 (`id`, `num1`, `num2`, `type1`, `type2`, `str1`, `str2`) VALUES (CONCAT(\u0026#39;\u0026#39;, i), CONCAT(\u0026#39;\u0026#39;, i), CONCAT(\u0026#39;\u0026#39;, i), i%5, i%5, @str1, @str2); -- äº‹åŠ¡ä¼˜åŒ–ï¼Œæ¯ä¸€ä¸‡æ¡æ•°æ®æäº¤ä¸€æ¬¡äº‹åŠ¡ IF i % 10000 = 0 THEN COMMIT; END IF; END WHILE; END; // DELIMITER ; -- æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ CALL pre_test1(); å…¶ä¸­ï¼Œä¸ƒä¸ªå­—æ®µï¼Œé¦–å…ˆä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ç”Ÿæˆ 1000 ä¸‡æ¡æµ‹è¯•æ•°æ®ï¼Œ æµ‹è¯•è¡¨ä¸€å…±å»ºç«‹äº† 7 ä¸ªå­—æ®µï¼ˆåŒ…æ‹¬ä¸»é”®ï¼‰ï¼Œnum1å’Œnum2ä¿å­˜çš„æ˜¯å’ŒIDä¸€æ ·çš„é¡ºåºæ•°å­—ï¼Œå…¶ä¸­num2æ˜¯å­—ç¬¦ä¸²ç±»å‹ã€‚ type1å’Œtype2ä¿å­˜çš„éƒ½æ˜¯ä¸»é”®å¯¹ 5 çš„å–æ¨¡ï¼Œç›®çš„æ˜¯æ¨¡æ‹Ÿå®é™…åº”ç”¨ä¸­å¸¸ç”¨ç±»ä¼¼ type ç±»å‹çš„æ•°æ®ï¼Œä½†æ˜¯**type2æ˜¯æ²¡æœ‰å»ºç«‹ç´¢å¼•çš„ã€‚ str1å’Œstr2éƒ½æ˜¯ä¿å­˜äº†ä¸€ä¸ª 20 ä½é•¿åº¦çš„éšæœºå­—ç¬¦ä¸²ï¼Œstr1ä¸èƒ½ä¸ºNULLï¼Œstr2å…è®¸ä¸ºNULLï¼Œç›¸åº”çš„ç”Ÿæˆæµ‹è¯•æ•°æ®çš„æ—¶å€™æˆ‘ä¹Ÿä¼šåœ¨str2å­—æ®µç”Ÿäº§å°‘é‡NULLå€¼**ï¼ˆæ¯ 100 æ¡æ•°æ®äº§ç”Ÿä¸€ä¸ªNULLå€¼ï¼‰ã€‚\næ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œè¿˜æ¶‰åŠä½¿ç”¨MD5ç”Ÿæˆéšæœºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥é€Ÿåº¦æœ‰ç‚¹æ…¢ï¼Œç¨å®‰å‹¿èºï¼Œè€å¿ƒç­‰å¾…å³å¯ã€‚\n1000 ä¸‡æ¡æ•°æ®ï¼Œæˆ‘ç”¨äº† 33 åˆ†é’Ÿæ‰è·‘å®Œï¼ˆå®é™…æ—¶é—´è·Ÿä½ ç”µè„‘ç¡¬ä»¶é…ç½®æœ‰å…³ï¼‰ã€‚è¿™é‡Œè´´å‡ æ¡ç”Ÿæˆçš„æ•°æ®ï¼Œå¤§è‡´é•¿è¿™æ ·ã€‚ æ•°æ®å¦‚ä¸‹æ‰€ç¤ºï¼š\nSQLæµ‹è¯• # æ³¨ï¼šnum1æ˜¯intç±»å‹ï¼Œnum2æ˜¯varcharç±»å‹ã€‚\n1: SELECT * FROM `test1` WHERE num1 = 10000; 2: SELECT * FROM `test1` WHERE num1 = \u0026#39;10000\u0026#39;; 3: SELECT * FROM `test1` WHERE num2 = 10000; 4: SELECT * FROM `test1` WHERE num2 = \u0026#39;10000\u0026#39;; è¿™å››æ¡ SQL éƒ½æ˜¯æœ‰é’ˆå¯¹æ€§å†™çš„ï¼Œ12 æŸ¥è¯¢çš„å­—æ®µæ˜¯ int ç±»å‹ï¼Œ34 æŸ¥è¯¢çš„å­—æ®µæ˜¯varcharç±»å‹ã€‚12 æˆ– 34 æŸ¥è¯¢çš„å­—æ®µè™½ç„¶éƒ½ç›¸åŒï¼Œä½†æ˜¯ä¸€ä¸ªæ¡ä»¶æ˜¯æ•°å­—ï¼Œä¸€ä¸ªæ¡ä»¶æ˜¯ç”¨å¼•å·å¼•èµ·æ¥çš„å­—ç¬¦ä¸²ã€‚è¿™æ ·åšæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿå…ˆä¸çœ‹ä¸‹è¾¹çš„æµ‹è¯•ç»“æœä½ èƒ½çŒœå‡ºè¿™å››æ¡ SQL çš„æ•ˆç‡é¡ºåºå—ï¼Ÿ\nç»æµ‹è¯•è¿™å››æ¡ SQL æœ€åçš„æ‰§è¡Œç»“æœå´ç›¸å·®å¾ˆå¤§ï¼Œå…¶ä¸­ 124 ä¸‰æ¡ SQL åŸºæœ¬éƒ½æ˜¯ç¬é—´å‡ºç»“æœï¼Œå¤§æ¦‚åœ¨ 0.0010.005 ç§’ï¼Œåœ¨åƒä¸‡çº§çš„æ•°æ®é‡ä¸‹è¿™æ ·çš„ç»“æœå¯ä»¥åˆ¤å®šè¿™ä¸‰æ¡ SQL æ€§èƒ½åŸºæœ¬æ²¡å·®åˆ«äº†ã€‚ä½†æ˜¯ç¬¬ä¸‰æ¡ SQLï¼Œå¤šæ¬¡æµ‹è¯•è€—æ—¶åŸºæœ¬åœ¨ 4.54.8 ç§’ä¹‹é—´\nä¹Ÿå°±æ˜¯è¯´ å·¦int å³å­—ç¬¦ä¸å½±å“æ•ˆç‡ï¼›è€Œå·¦å­—ç¬¦å³intåˆ™å½±å“æ•ˆç‡ï¼Œåé¢ä¼šè§£é‡Š\nä¸‹é¢çœ‹1234çš„æ‰§è¡Œè®¡åˆ’\nå¯ä»¥çœ‹åˆ°ï¼Œ124 ä¸‰æ¡ SQL éƒ½èƒ½ä½¿ç”¨åˆ°ç´¢å¼•ï¼Œè¿æ¥ç±»å‹éƒ½ä¸ºrefï¼Œæ‰«æè¡Œæ•°éƒ½ä¸º 1ï¼Œæ‰€ä»¥æ•ˆç‡éå¸¸é«˜ã€‚å†çœ‹çœ‹ç¬¬ä¸‰æ¡ SQLï¼Œæ²¡æœ‰ç”¨ä¸Šç´¢å¼•ï¼Œæ‰€ä»¥ä¸ºå…¨è¡¨æ‰«æï¼Œrowsç›´æ¥åˆ°è¾¾ 1000 ä¸‡äº†ï¼Œæ‰€ä»¥æ€§èƒ½å·®åˆ«æ‰é‚£ä¹ˆå¤§\n34 ä¸¤æ¡ SQL æŸ¥è¯¢çš„å­—æ®µnum2æ˜¯varcharç±»å‹çš„ï¼ŒæŸ¥è¯¢æ¡ä»¶ç­‰å·å³è¾¹åŠ å¼•å·çš„ç¬¬ 4 æ¡ SQL æ˜¯ç”¨åˆ°ç´¢å¼•çš„ï¼Œé‚£ä¹ˆæ˜¯æŸ¥è¯¢çš„æ•°æ®ç±»å‹å’Œå­—æ®µæ•°æ®ç±»å‹ä¸ä¸€è‡´é€ æˆçš„å—ï¼Ÿå¦‚æœæ˜¯è¿™æ ·é‚£ 12 ä¸¤æ¡ SQL æŸ¥è¯¢çš„å­—æ®µnum1æ˜¯intç±»å‹ï¼Œä½†æ˜¯ç¬¬ 2 æ¡ SQL æŸ¥è¯¢æ¡ä»¶å³è¾¹åŠ äº†å¼•å·ä¸ºä»€ä¹ˆè¿˜èƒ½ç”¨ä¸Šç´¢å¼•å‘¢ã€‚ å®˜æ–¹æ–‡æ¡£ï¼š 12.2 Type Conversion in Expression Evaluationopen in new window\nå½“æ“ä½œç¬¦ä¸ä¸åŒç±»å‹çš„æ“ä½œæ•°ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œä¼šå‘ç”Ÿç±»å‹è½¬æ¢ä»¥ä½¿æ“ä½œæ•°å…¼å®¹ã€‚æŸäº›è½¬æ¢æ˜¯éšå¼å‘ç”Ÿçš„ã€‚ä¾‹å¦‚ï¼ŒMySQL ä¼šæ ¹æ®éœ€è¦è‡ªåŠ¨å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ï¼Œåä¹‹äº¦ç„¶ã€‚ä»¥ä¸‹è§„åˆ™æè¿°äº†æ¯”è¾ƒæ“ä½œçš„è½¬æ¢æ–¹å¼ï¼š\nä¸¤ä¸ªå‚æ•°è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯NULLæ—¶ï¼Œæ¯”è¾ƒçš„ç»“æœä¹Ÿæ˜¯NULLï¼Œç‰¹æ®Šçš„æƒ…å†µæ˜¯ä½¿ç”¨\u0026lt;=\u0026gt;å¯¹ä¸¤ä¸ªNULLåšæ¯”è¾ƒæ—¶ä¼šè¿”å›1ï¼Œè¿™ä¸¤ç§æƒ…å†µéƒ½ä¸éœ€è¦åšç±»å‹è½¬æ¢ ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œä¼šæŒ‰ç…§å­—ç¬¦ä¸²æ¥æ¯”è¾ƒï¼Œä¸åšç±»å‹è½¬æ¢ ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯æ•´æ•°ï¼ŒæŒ‰ç…§æ•´æ•°æ¥æ¯”è¾ƒï¼Œä¸åšç±»å‹è½¬æ¢ åå…­è¿›åˆ¶çš„å€¼å’Œéæ•°å­—åšæ¯”è¾ƒæ—¶ï¼Œä¼šè¢«å½“åšäºŒè¿›åˆ¶ä¸² æœ‰ä¸€ä¸ªå‚æ•°æ˜¯TIMESTAMPæˆ–DATETIMEï¼Œå¹¶ä¸”å¦å¤–ä¸€ä¸ªå‚æ•°æ˜¯å¸¸é‡ï¼Œå¸¸é‡ä¼šè¢«è½¬æ¢ä¸ºtimestamp æœ‰ä¸€ä¸ªå‚æ•°æ˜¯decimalç±»å‹ï¼Œå¦‚æœå¦å¤–ä¸€ä¸ªå‚æ•°æ˜¯decimalæˆ–è€…æ•´æ•°ï¼Œä¼šå°†æ•´æ•°è½¬æ¢ä¸ºdecimalåè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå¦å¤–ä¸€ä¸ªå‚æ•°æ˜¯æµ®ç‚¹æ•°ï¼Œåˆ™ä¼šæŠŠdecimalè½¬æ¢ä¸ºæµ®ç‚¹æ•°è¿›è¡Œæ¯”è¾ƒ æ‰€æœ‰å…¶ä»–æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªå‚æ•°éƒ½ä¼šè¢«è½¬æ¢ä¸ºæµ®ç‚¹æ•°å†è¿›è¡Œæ¯”è¾ƒ æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„æè¿°ï¼Œæˆ‘ä»¬çš„ç¬¬ 23 ä¸¤æ¡ SQL éƒ½å‘ç”Ÿäº†éšå¼è½¬æ¢ï¼Œç¬¬ 2 æ¡ SQL çš„æŸ¥è¯¢æ¡ä»¶num1 = '10000'ï¼Œå·¦è¾¹æ˜¯intç±»å‹å³è¾¹æ˜¯å­—ç¬¦ä¸²ï¼Œç¬¬ 3 æ¡ SQL ç›¸åï¼Œé‚£ä¹ˆæ ¹æ®å®˜æ–¹è½¬æ¢è§„åˆ™ç¬¬ 7 æ¡ï¼Œå·¦å³ä¸¤è¾¹éƒ½ä¼šè½¬æ¢ä¸ºæµ®ç‚¹æ•°å†è¿›è¡Œæ¯”è¾ƒ\nâ˜…â˜…\nå…ˆçœ‹ç¬¬ 2 æ¡ SQLï¼šSELECT * FROMtest1WHERE num1 = '10000';å·¦è¾¹ä¸º int ç±»å‹10000ï¼Œè½¬æ¢ä¸ºæµ®ç‚¹æ•°è¿˜æ˜¯10000ï¼Œå³è¾¹å­—ç¬¦ä¸²ç±»å‹'10000'ï¼Œè½¬æ¢ä¸ºæµ®ç‚¹æ•°ä¹Ÿæ˜¯10000ã€‚ä¸¤è¾¹çš„è½¬æ¢ç»“æœéƒ½æ˜¯å”¯ä¸€ç¡®å®šçš„ï¼Œæ‰€ä»¥ä¸å½±å“ä½¿ç”¨ç´¢å¼•\nä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªsqlæ˜¯è¦æ‰¾åˆ°ç´¢å¼•num1çš„å€¼ä¸ºæµ®ç‚¹æ•°10000çš„è¡Œï¼Œæ‰€ä»¥èƒ½ç”¨ä¸Šç´¢å¼•\nç¬¬ 3 æ¡ SQLï¼šSELECT * FROMtest1WHERE num2 = 10000;å·¦è¾¹æ˜¯å­—ç¬¦ä¸²ç±»å‹'10000'ï¼Œè½¬æµ®ç‚¹æ•°ä¸º 10000 æ˜¯å”¯ä¸€çš„ï¼Œå³è¾¹intç±»å‹10000è½¬æ¢ç»“æœä¹Ÿæ˜¯å”¯ä¸€çš„ã€‚ä½†æ˜¯ï¼Œå› ä¸ºå·¦è¾¹æ˜¯æ£€ç´¢æ¡ä»¶ï¼Œ'10000'è½¬åˆ°10000è™½ç„¶æ˜¯å”¯ä¸€ï¼Œä½†æ˜¯å…¶ä»–å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥è½¬æ¢ä¸º10000ï¼Œæ¯”å¦‚'10000a'ï¼Œ'010000'ï¼Œ'10000'ç­‰ç­‰éƒ½èƒ½è½¬ä¸ºæµ®ç‚¹æ•°10000ï¼Œè¿™æ ·çš„æƒ…å†µä¸‹ï¼Œæ˜¯ä¸èƒ½ç”¨åˆ°ç´¢å¼•çš„ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘æŠŠ10000å½“ä½œç´¢å¼•å»æŸ¥ï¼Œæ˜¯ä¸è¡Œçš„ã€‚å› ä¸ºæ­£ç¡®ç»“æœåº”è¯¥æ˜¯æŠŠ \u0026lsquo;10000a\u0026rsquo;ï¼Œ\u0026lsquo;10000-\u0026lsquo;è¿™ç§éƒ½æŸ¥å‡ºæ¥ã€‚è€Œå¦‚æœä½¿ç”¨ç´¢å¼•ï¼Œä¹Ÿåªèƒ½æŸ¥å‡º'10000\u0026rsquo;ï¼Œç»“æœä¸å¯¹ã€‚æ‰€ä»¥è‚¯å®šä¼šç”¨ä¸Šå…¨è¡¨æ‰«æ\nä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªsqlæ˜¯è¦æ‰¾åˆ°ç´¢å¼•num2çš„å€¼(å­—ç¬¦ä¸²)è½¬æ¢åæ˜¯'10000\u0026rsquo;çš„è¡Œï¼Œå› ä¸º10000a,10000bè½¬æ¢åä¹Ÿéƒ½æ˜¯10000ï¼Œæ‰€ä»¥ç”¨ä¸ä¸Šç´¢å¼•\nå¯¹ç¬¬äºŒç‚¹çš„ååŠéƒ¨åˆ†å†åšè§£é‡Š\nå…³äºè¿™ä¸ªéšå¼è½¬æ¢æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥è¯¢æµ‹è¯•éªŒè¯ä¸€ä¸‹ï¼Œå…ˆæ’å…¥å‡ æ¡æ•°æ®ï¼Œå…¶ä¸­num2='10000a'ã€'010000'å’Œ'10000'ï¼š\nINSERT INTO `test1` (`id`, `num1`, `num2`, `type1`, `type2`, `str1`, `str2`) VALUES (\u0026#39;10000001\u0026#39;, \u0026#39;10000\u0026#39;, \u0026#39;10000a\u0026#39;, \u0026#39;0\u0026#39;, \u0026#39;0\u0026#39;, \u0026#39;2df3d9465ty2e4hd523\u0026#39;, \u0026#39;2df3d9465ty2e4hd523\u0026#39;); INSERT INTO `test1` (`id`, `num1`, `num2`, `type1`, `type2`, `str1`, `str2`) VALUES (\u0026#39;10000002\u0026#39;, \u0026#39;10000\u0026#39;, \u0026#39;010000\u0026#39;, \u0026#39;0\u0026#39;, \u0026#39;0\u0026#39;, \u0026#39;2df3d9465ty2e4hd523\u0026#39;, \u0026#39;2df3d9465ty2e4hd523\u0026#39;); INSERT INTO `test1` (`id`, `num1`, `num2`, `type1`, `type2`, `str1`, `str2`) VALUES (\u0026#39;10000003\u0026#39;, \u0026#39;10000\u0026#39;, \u0026#39; 10000\u0026#39;, \u0026#39;0\u0026#39;, \u0026#39;0\u0026#39;, \u0026#39;2df3d9465ty2e4hd523\u0026#39;, \u0026#39;2df3d9465ty2e4hd523\u0026#39;); ç„¶åä½¿ç”¨ç¬¬ä¸‰æ¡ SQL è¯­å¥SELECT * FROMtest1WHERE num2 = 10000;è¿›è¡ŒæŸ¥è¯¢ï¼š\nä»ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œåé¢æ’å…¥çš„ä¸‰æ¡æ•°æ®ä¹Ÿéƒ½åŒ¹é…ä¸Šäº†ã€‚é‚£ä¹ˆè¿™ä¸ªå­—ç¬¦ä¸²éšå¼è½¬æ¢çš„è§„åˆ™æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸ºä»€ä¹ˆnum2='10000a'ã€'010000'å’Œ'10000'è¿™ä¸‰ç§æƒ…å½¢éƒ½èƒ½åŒ¹é…ä¸Šå‘¢ï¼ŸæŸ¥é˜…ç›¸å…³èµ„æ–™å‘ç°è§„åˆ™å¦‚ä¸‹ï¼š\nä¸ä»¥æ•°å­—å¼€å¤´çš„å­—ç¬¦ä¸²éƒ½å°†è½¬æ¢ä¸º0ã€‚å¦‚'abc'ã€'a123bc'ã€'abc123'éƒ½ä¼šè½¬åŒ–ä¸º0ï¼› ä»¥æ•°å­—å¼€å¤´çš„å­—ç¬¦ä¸²è½¬æ¢æ—¶ä¼šè¿›è¡Œæˆªå–ï¼Œä»ç¬¬ä¸€ä¸ªå­—ç¬¦æˆªå–åˆ°ç¬¬ä¸€ä¸ªéæ•°å­—å†…å®¹ä¸ºæ­¢ã€‚æ¯”å¦‚'123abc'ä¼šè½¬æ¢ä¸º123ï¼Œ'012abc'ä¼šè½¬æ¢ä¸º012ä¹Ÿå°±æ˜¯12ï¼Œ'5.3a66b78c'ä¼šè½¬æ¢ä¸º5.3ï¼Œå…¶ä»–åŒç†ã€‚ ç°å¯¹ä»¥ä¸Šè§„åˆ™åšå¦‚ä¸‹æµ‹è¯•éªŒè¯ï¼š\nå¦‚æ­¤ä¹Ÿå°±å°è¯äº†ä¹‹å‰çš„æŸ¥è¯¢ç»“æœäº†\nå†æ¬¡å†™ä¸€æ¡ SQL æŸ¥è¯¢ str1 å­—æ®µï¼šSELECT * FROMtest1WHERE str1 = 1234;\nåˆ†æå’Œæ€»ç»“ # é€šè¿‡ä¸Šé¢çš„æµ‹è¯•æˆ‘ä»¬å‘ç° MySQL ä½¿ç”¨æ“ä½œç¬¦çš„ä¸€äº›ç‰¹æ€§ï¼š\nå½“æ“ä½œç¬¦å·¦å³ä¸¤è¾¹çš„æ•°æ®ç±»å‹ä¸ä¸€è‡´æ—¶ï¼Œä¼šå‘ç”Ÿéšå¼è½¬æ¢ã€‚ å½“ where æŸ¥è¯¢æ“ä½œç¬¦å·¦è¾¹ä¸ºæ•°å€¼ç±»å‹æ—¶å‘ç”Ÿäº†éšå¼è½¬æ¢ï¼Œé‚£ä¹ˆå¯¹æ•ˆç‡å½±å“ä¸å¤§ï¼Œä½†è¿˜æ˜¯ä¸æ¨èè¿™ä¹ˆåšã€‚ å½“ where æŸ¥è¯¢æ“ä½œç¬¦å·¦è¾¹ä¸ºå­—ç¬¦ç±»å‹æ—¶å‘ç”Ÿäº†éšå¼è½¬æ¢ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œé€ æˆå…¨è¡¨æ‰«ææ•ˆç‡æä½ã€‚ å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å€¼ç±»å‹æ—¶ï¼Œéæ•°å­—å¼€å¤´çš„å­—ç¬¦ä¸²ä¼šè½¬åŒ–ä¸º0ï¼Œä»¥æ•°å­—å¼€å¤´çš„å­—ç¬¦ä¸²ä¼šæˆªå–ä»ç¬¬ä¸€ä¸ªå­—ç¬¦åˆ°ç¬¬ä¸€ä¸ªéæ•°å­—å†…å®¹ä¸ºæ­¢çš„å€¼ä¸ºè½¬åŒ–ç»“æœã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨å†™ SQL æ—¶ä¸€å®šè¦å…»æˆè‰¯å¥½çš„ä¹ æƒ¯ï¼ŒæŸ¥è¯¢çš„å­—æ®µæ˜¯ä»€ä¹ˆç±»å‹ï¼Œç­‰å·å³è¾¹çš„æ¡ä»¶å°±å†™æˆå¯¹åº”çš„ç±»å‹ã€‚ç‰¹åˆ«å½“æŸ¥è¯¢çš„å­—æ®µæ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œç­‰å·å³è¾¹çš„æ¡ä»¶ä¸€å®šè¦ç”¨å¼•å·å¼•èµ·æ¥æ ‡æ˜è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦åˆ™ä¼šé€ æˆç´¢å¼•å¤±æ•ˆè§¦å‘å…¨è¡¨æ‰«æ\n"},{"id":107,"href":"/zh/docs/study/Review/java_guide/database/MySQL/ly0608lysome-thoughts-on-database-storage-time/","title":"MySQLæ•°æ®åº“æ—¶é—´ç±»å‹æ•°æ®å­˜å‚¨å»ºè®®","section":"MySQL","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nä¸è¦ç”¨å­—ç¬¦ä¸²å­˜å‚¨æ—¥æœŸ # ä¼˜ç‚¹ï¼šç®€å•ç›´ç™½ ç¼ºç‚¹ å­—ç¬¦ä¸²å æœ‰çš„ç©ºé—´æ›´å¤§ å­—ç¬¦ä¸²å­˜å‚¨çš„æ—¥æœŸæ•ˆç‡æ¯”è¾ƒä½ï¼ˆé€ä¸ªå­—ç¬¦è¿›è¡Œæ¯”è¾ƒï¼‰ï¼Œæ— æ³•ç”¨æ—¥æœŸç›¸å…³çš„APIè¿›è¡Œè®¡ç®—å’Œæ¯”è¾ƒ Datetimeå’ŒTimestampä¹‹é—´æŠ‰æ‹© # Datetime å’Œ Timestamp æ˜¯ MySQL æä¾›çš„ä¸¤ç§æ¯”è¾ƒç›¸ä¼¼çš„ä¿å­˜æ—¶é—´çš„æ•°æ®ç±»å‹ã€‚ä»–ä»¬ä¸¤è€…ç©¶ç«Ÿè¯¥å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿ\né€šå¸¸æˆ‘ä»¬éƒ½ä¼šé¦–é€‰ Timestamp\nDatetimeç±»å‹æ²¡æœ‰æ—¶åŒºä¿¡æ¯ # DateTime ç±»å‹æ˜¯æ²¡æœ‰æ—¶åŒºä¿¡æ¯çš„ï¼ˆæ—¶åŒºæ— å…³ï¼‰ ï¼ŒDateTime ç±»å‹ä¿å­˜çš„æ—¶é—´éƒ½æ˜¯å½“å‰ä¼šè¯æ‰€è®¾ç½®çš„æ—¶åŒºå¯¹åº”çš„æ—¶é—´ã€‚è¿™æ ·å°±ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿå½“ä½ çš„æ—¶åŒºæ›´æ¢ä¹‹åï¼Œæ¯”å¦‚ä½ çš„æœåŠ¡å™¨æ›´æ¢åœ°å€æˆ–è€…æ›´æ¢å®¢æˆ·ç«¯è¿æ¥æ—¶åŒºè®¾ç½®çš„è¯ï¼Œå°±ä¼šå¯¼è‡´ä½ ä»æ•°æ®åº“ä¸­è¯»å‡ºçš„æ—¶é—´é”™è¯¯ã€‚ä¸è¦å°çœ‹è¿™ä¸ªé—®é¢˜ï¼Œå¾ˆå¤šç³»ç»Ÿå°±æ˜¯å› ä¸ºè¿™ä¸ªé—®é¢˜é—¹å‡ºäº†å¾ˆå¤šç¬‘è¯ã€‚ Timestamp å’Œæ—¶åŒºæœ‰å…³ã€‚Timestamp ç±»å‹å­—æ®µçš„å€¼ä¼šéšç€æœåŠ¡å™¨æ—¶åŒºçš„å˜åŒ–è€Œå˜åŒ–ï¼Œè‡ªåŠ¨æ¢ç®—æˆç›¸åº”çš„æ—¶é—´ï¼Œè¯´ç®€å•ç‚¹å°±æ˜¯åœ¨ä¸åŒæ—¶åŒºï¼ŒæŸ¥è¯¢åˆ°åŒä¸€ä¸ªæ¡è®°å½•æ­¤å­—æ®µçš„å€¼ä¼šä¸ä¸€æ · æ¡ˆä¾‹\n-- å»ºè¡¨ CREATE TABLE `time_zone_test` ( `id` bigint(20) NOT NULL AUTO_INCREMENT, `date_time` datetime DEFAULT NULL, `time_stamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; -- æ’å…¥æ•°æ® INSERT INTO time_zone_test(date_time,time_stamp) VALUES(NOW(),NOW()); -- æŸ¥çœ‹æ•°æ® select date_time,time_stamp from time_zone_test; -- ç»“æœ /* +---------------------+---------------------+ | date_time | time_stamp | +---------------------+---------------------+ | 2020-01-11 09:53:32 | 2020-01-11 09:53:32 | +---------------------+---------------------+ ------ */ ä¿®æ”¹æ—¶åŒºå¹¶æŸ¥çœ‹æ•°æ®\nset time_zone=\u0026#39;+8:00\u0026#39;; /* +---------------------+---------------------+ | date_time | time_stamp | +---------------------+---------------------+ | 2020-01-11 09:53:32 | 2020-01-11 17:53:32 | +---------------------+---------------------+ ------ */ å…³äºMySQLæ—¶åŒºè®¾ç½®çš„ä¸€ä¸ªå¸¸ç”¨sqlå‘½ä»¤\n# æŸ¥çœ‹å½“å‰ä¼šè¯æ—¶åŒº SELECT @@session.time_zone; # è®¾ç½®å½“å‰ä¼šè¯æ—¶åŒº SET time_zone = \u0026#39;Europe/Helsinki\u0026#39;; SET time_zone = \u0026#34;+00:00\u0026#34;; # æ•°æ®åº“å…¨å±€æ—¶åŒºè®¾ç½® SELECT @@global.time_zone; # è®¾ç½®å…¨å±€æ—¶åŒº SET GLOBAL time_zone = \u0026#39;+8:00\u0026#39;; SET GLOBAL time_zone = \u0026#39;Europe/Helsinki\u0026#39;; DateTimeç±»å‹è€—è´¹ç©ºé—´æ›´å¤§ # Timestamp åªéœ€è¦ä½¿ç”¨ 4 ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ï¼Œä½†æ˜¯ DateTime éœ€è¦è€—è´¹ 8 ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ã€‚ä½†æ˜¯ï¼Œè¿™æ ·åŒæ ·é€ æˆäº†ä¸€ä¸ªé—®é¢˜ï¼ŒTimestamp è¡¨ç¤ºçš„æ—¶é—´èŒƒå›´æ›´å°ã€‚\nDateTime ï¼š1000-01-01 00:00:00 ~ 9999-12-31 23:59:59 Timestampï¼š 1970-01-01 00:00:01 ~ 2037-12-31 23:59:59 Timestamp åœ¨ä¸åŒç‰ˆæœ¬çš„ MySQL ä¸­æœ‰ç»†å¾®å·®åˆ«ã€‚\nå†çœ‹MySQLæ—¥æœŸç±»å‹å­˜å‚¨ç©ºé—´ # MySQL 5.6 ç‰ˆæœ¬ä¸­æ—¥æœŸç±»å‹æ‰€å çš„å­˜å‚¨ç©ºé—´ å¯ä»¥çœ‹å‡º 5.6.4 ä¹‹åçš„ MySQL å¤šå‡ºäº†ä¸€ä¸ªéœ€è¦ 0 ï½ 3 å­—èŠ‚çš„å°æ•°ä½ã€‚DateTime å’Œ Timestamp ä¼šæœ‰å‡ ç§ä¸åŒçš„å­˜å‚¨ç©ºé—´å ç”¨ã€‚ ä¸ºäº†æ–¹ä¾¿ï¼Œæœ¬æ–‡æˆ‘ä»¬è¿˜æ˜¯é»˜è®¤ Timestamp åªéœ€è¦ä½¿ç”¨ 4 ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ï¼Œä½†æ˜¯ DateTime éœ€è¦è€—è´¹ 8 ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ æ•°å€¼å‹æ—¶é—´æˆ³æ˜¯æ›´å¥½çš„é€‰æ‹©å— # ä½¿ç”¨intæˆ–è€…bigintç±»å‹æ•°å€¼ï¼Œå³æ—¶é—´æˆ³æ¥è¡¨ç¤ºæ—¶é—´\nä¼˜ç‚¹ï¼šä½¿ç”¨å®ƒè¿›è¡Œæ—¥æœŸæ’åºä»¥åŠå¯¹æ¯”ç­‰æ“ä½œæ•ˆç‡æ›´é«˜ï¼Œè·¨ç³»ç»Ÿä¹Ÿæ–¹ä¾¿ ç¼ºç‚¹ï¼šå¯è¯»æ€§å·® æ—¶é—´æˆ³çš„å®šä¹‰\næ—¶é—´æˆ³çš„å®šä¹‰æ˜¯ä»ä¸€ä¸ªåŸºå‡†æ—¶é—´å¼€å§‹ç®—èµ·ï¼Œè¿™ä¸ªåŸºå‡†æ—¶é—´æ˜¯ã€Œ1970-1-1 00:00:00 +0:00ã€ï¼Œä»è¿™ä¸ªæ—¶é—´å¼€å§‹ï¼Œç”¨æ•´æ•°è¡¨ç¤ºï¼Œä»¥ç§’è®¡æ—¶ï¼Œéšç€æ—¶é—´çš„æµé€è¿™ä¸ªæ—¶é—´æ•´æ•°ä¸æ–­å¢åŠ ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘åªéœ€è¦ä¸€ä¸ªæ•°å€¼ï¼Œå°±å¯ä»¥å®Œç¾åœ°è¡¨ç¤ºæ—¶é—´äº†ï¼Œè€Œä¸”è¿™ä¸ªæ•°å€¼æ˜¯ä¸€ä¸ªç»å¯¹æ•°å€¼ï¼Œå³æ— è®ºçš„èº«å¤„åœ°çƒçš„ä»»ä½•è§’è½ï¼Œè¿™ä¸ªè¡¨ç¤ºæ—¶é—´çš„æ—¶é—´æˆ³ï¼Œéƒ½æ˜¯ä¸€æ ·çš„ï¼Œç”Ÿæˆçš„æ•°å€¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¹¶ä¸”æ²¡æœ‰æ—¶åŒºçš„æ¦‚å¿µï¼Œæ‰€ä»¥åœ¨ç³»ç»Ÿçš„ä¸­æ—¶é—´çš„ä¼ è¾“ä¸­ï¼Œéƒ½ä¸éœ€è¦è¿›è¡Œé¢å¤–çš„è½¬æ¢äº†ï¼Œåªæœ‰åœ¨æ˜¾ç¤ºç»™ç”¨æˆ·çš„æ—¶å€™ï¼Œæ‰è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ ¼å¼çš„æœ¬åœ°æ—¶é—´\nå®é™…æ“ä½œ\nmysql\u0026gt; select UNIX_TIMESTAMP(\u0026#39;2020-01-11 09:53:32\u0026#39;); +---------------------------------------+ | UNIX_TIMESTAMP(\u0026#39;2020-01-11 09:53:32\u0026#39;) | +---------------------------------------+ | 1578707612 | +---------------------------------------+ 1 row in set (0.00 sec) mysql\u0026gt; select FROM_UNIXTIME(1578707612); +---------------------------+ | FROM_UNIXTIME(1578707612) | +---------------------------+ | 2020-01-11 09:53:32 | +---------------------------+ 1 row in set (0.01 sec) æ€»ç»“ # æ¨èä½¿ç”¨ã€Šé«˜æ€§èƒ½MySQLã€‹\nå¯¹æ¯”\n"},{"id":108,"href":"/zh/docs/study/Review/java_guide/database/MySQL/ly0605lyhow-sql-executed-in-mysql/","title":"SQLè¯­å¥åœ¨MySQLä¸­çš„æ‰§è¡Œè¿‡ç¨‹","section":"MySQL","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nåŸæ–‡ https://github.com/kinglaw1204 æ„Ÿè°¢ä½œè€…\næœ¬ç¯‡æ–‡ç« ä¼šåˆ†æä¸€ä¸ªSQLè¯­å¥åœ¨MySQLçš„æ‰§è¡Œæµç¨‹ï¼ŒåŒ…æ‹¬SQLçš„æŸ¥è¯¢åœ¨MySQLå†…éƒ¨ä¼šæ€ä¹ˆæµè½¬ï¼ŒSQLè¯­å¥çš„æ›´æ–°æ˜¯æ€ä¹ˆå®Œæˆçš„ åˆ†æä¹‹å‰å…ˆçœ‹çœ‹MySQLçš„åŸºç¡€æ¶æ„ï¼ŒçŸ¥é“äº†MySQLç”±å“ªäº›ç»„ä»¶ç»„æˆä»¥åŠè¿™äº›ç»„ä»¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£å’Œè§£å†³è¿™äº›é—®é¢˜ MySQLåŸºç¡€æ¶æ„åˆ†æ # MySQLåŸºæœ¬æ¶æ„æ¦‚è§ˆ # ä¸‹å›¾æ˜¯MySQLçš„ç®€è¦æ¶æ„å›¾ï¼Œä»ä¸‹å›¾å¯ä»¥çœ‹åˆ°ç”¨æˆ·çš„SQLè¯­å¥åœ¨MySQLå†…éƒ¨æ˜¯å¦‚ä½•æ‰§è¡Œçš„ å…ˆç®€å•ä»‹ç»ä¸€ä¸ªä¸‹å›¾æ¶‰åŠçš„ä¸€äº›ç»„ä»¶çš„åŸºæœ¬ä½œç”¨ è¿æ¥å™¨ï¼š èº«ä»½è®¤è¯å’Œæƒé™ç›¸å…³ï¼ˆç™»å½•MySQLçš„æ—¶å€™ï¼‰ æŸ¥è¯¢ç¼“å­˜ï¼šæ‰§è¡ŒæŸ¥è¯¢è¯­å¥çš„æ—¶å€™ï¼Œä¼šå…ˆæŸ¥è¯¢ç¼“å­˜ï¼ˆMySQL8.0ç‰ˆæœ¬åç§»é™¤ï¼Œå› ä¸ºè¿™ä¸ªåŠŸèƒ½ä¸å¤ªå®ç”¨ï¼‰ åˆ†æå™¨ï¼šæ²¡æœ‰å‘½ä¸­ç¼“å­˜çš„è¯ï¼ŒSQLè¯­å¥å°±ä¼šç»è¿‡åˆ†æå™¨ï¼Œåˆ†æå™¨è¯´ç™½äº†å°±æ˜¯è¦å…ˆçœ‹ä½ çš„SQLè¯­å¥å¹²å˜›ï¼Œå†æ£€æŸ¥ä½ çš„SQLè¯­å¥è¯­æ³•æ˜¯å¦æ­£ç¡® ä¼˜åŒ–å™¨ï¼šæŒ‰ç…§MySQLè®¤ä¸ºæœ€ä¼˜çš„æ–¹æ¡ˆå»æ‰§è¡Œ æ‰§è¡Œå™¨ï¼šæ‰§è¡Œè¯­å¥ï¼Œç„¶åä»å­˜å‚¨å¼•æ“è¿”å›æ•°æ® ç®€å•æ¥è¯´ MySQL ä¸»è¦åˆ†ä¸º Server å±‚å’Œå­˜å‚¨å¼•æ“å±‚ï¼š Server å±‚ï¼šä¸»è¦åŒ…æ‹¬è¿æ¥å™¨ã€æŸ¥è¯¢ç¼“å­˜ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ç­‰ï¼Œæ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½éƒ½åœ¨è¿™ä¸€å±‚å®ç°ï¼Œæ¯”å¦‚å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ï¼Œå‡½æ•°ç­‰ï¼Œè¿˜æœ‰ä¸€ä¸ªé€šç”¨çš„æ—¥å¿—æ¨¡å— binlog æ—¥å¿—æ¨¡å—ã€‚ å­˜å‚¨å¼•æ“ï¼š ä¸»è¦è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œè¯»å–ï¼Œé‡‡ç”¨å¯ä»¥æ›¿æ¢çš„æ’ä»¶å¼æ¶æ„ï¼Œæ”¯æŒ InnoDBã€MyISAMã€Memory ç­‰å¤šä¸ªå­˜å‚¨å¼•æ“ï¼Œå…¶ä¸­ InnoDB å¼•æ“æœ‰è‡ªæœ‰çš„æ—¥å¿—æ¨¡å— redolog æ¨¡å—ã€‚ç°åœ¨æœ€å¸¸ç”¨çš„å­˜å‚¨å¼•æ“æ˜¯ InnoDBï¼Œå®ƒä» MySQL 5.5 ç‰ˆæœ¬å¼€å§‹å°±è¢«å½“åšé»˜è®¤å­˜å‚¨å¼•æ“äº† Serverå±‚åŸºæœ¬ç»„ä»¶ä»‹ç» # è¿æ¥å™¨ è¿æ¥å™¨ä¸»è¦å’Œèº«ä»½è®¤è¯å’Œæƒé™ç›¸å…³çš„åŠŸèƒ½ç›¸å…³ï¼Œå°±å¥½æ¯”ä¸€ä¸ªçº§åˆ«å¾ˆé«˜çš„é—¨å«ä¸€æ ·\nä¸»è¦è´Ÿè´£ç”¨æˆ·ç™»å½•æ•°æ®åº“ï¼Œè¿›è¡Œç”¨æˆ·çš„èº«ä»½è®¤è¯ï¼ŒåŒ…æ‹¬æ ¡éªŒè´¦æˆ·å¯†ç ï¼Œæƒé™ç­‰æ“ä½œï¼Œå¦‚æœç”¨æˆ·è´¦æˆ·å¯†ç å·²é€šè¿‡ï¼Œè¿æ¥å™¨ä¼šåˆ°æƒé™è¡¨ä¸­æŸ¥è¯¢è¯¥ç”¨æˆ·çš„æ‰€æœ‰æƒé™ï¼Œä¹‹ååœ¨è¿™ä¸ªè¿æ¥é‡Œçš„æƒé™é€»è¾‘åˆ¤æ–­éƒ½æ˜¯ä¼šä¾èµ–æ­¤æ—¶è¯»å–åˆ°çš„æƒé™æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåç»­åªè¦è¿™ä¸ªè¿æ¥ä¸æ–­å¼€ï¼Œå³ä½¿ç®¡ç†å‘˜ä¿®æ”¹äº†è¯¥ç”¨æˆ·çš„æƒé™ï¼Œè¯¥ç”¨æˆ·ä¹Ÿæ˜¯ä¸å—å½±å“çš„ã€‚\næŸ¥è¯¢ç¼“å­˜ï¼ˆMySQL8.0 ç‰ˆæœ¬åç§»é™¤ï¼‰\næŸ¥è¯¢ç¼“å­˜ä¸»è¦ç”¨æ¥ç¼“å­˜æˆ‘ä»¬æ‰€æ‰§è¡Œçš„ SELECT è¯­å¥ä»¥åŠè¯¥è¯­å¥çš„ç»“æœé›†ã€‚\nè¿æ¥å»ºç«‹åï¼Œæ‰§è¡ŒæŸ¥è¯¢è¯­å¥çš„æ—¶å€™ï¼Œä¼šå…ˆæŸ¥è¯¢ç¼“å­˜ï¼ŒMySQL ä¼šå…ˆæ ¡éªŒè¿™ä¸ª SQL æ˜¯å¦æ‰§è¡Œè¿‡ï¼Œä»¥ Key-Value çš„å½¢å¼ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼ŒKey æ˜¯æŸ¥è¯¢é¢„è®¡ï¼ŒValue æ˜¯ç»“æœé›†ã€‚å¦‚æœç¼“å­˜ key è¢«å‘½ä¸­ï¼Œå°±ä¼šç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¦‚æœæ²¡æœ‰å‘½ä¸­ï¼Œå°±ä¼šæ‰§è¡Œåç»­çš„æ“ä½œï¼Œå®Œæˆåä¹Ÿä¼šæŠŠç»“æœç¼“å­˜èµ·æ¥ï¼Œæ–¹ä¾¿ä¸‹ä¸€æ¬¡è°ƒç”¨ã€‚å½“ç„¶åœ¨çœŸæ­£æ‰§è¡Œç¼“å­˜æŸ¥è¯¢çš„æ—¶å€™è¿˜æ˜¯ä¼šæ ¡éªŒç”¨æˆ·çš„æƒé™ï¼Œæ˜¯å¦æœ‰è¯¥è¡¨çš„æŸ¥è¯¢æ¡ä»¶ã€‚\nMySQL æŸ¥è¯¢ä¸å»ºè®®ä½¿ç”¨ç¼“å­˜ï¼Œå› ä¸ºæŸ¥è¯¢ç¼“å­˜å¤±æ•ˆåœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­å¯èƒ½ä¼šéå¸¸é¢‘ç¹ï¼Œå‡å¦‚ä½ å¯¹ä¸€ä¸ªè¡¨æ›´æ–°çš„è¯ï¼Œè¿™ä¸ªè¡¨ä¸Šçš„æ‰€æœ‰çš„æŸ¥è¯¢ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©ºã€‚å¯¹äºä¸ç»å¸¸æ›´æ–°çš„æ•°æ®æ¥è¯´ï¼Œä½¿ç”¨ç¼“å­˜è¿˜æ˜¯å¯ä»¥çš„ã€‚æ‰€ä»¥ï¼Œä¸€èˆ¬åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬éƒ½æ˜¯ä¸æ¨èå»ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜çš„ã€‚\nMySQL 8.0 ç‰ˆæœ¬ååˆ é™¤äº†ç¼“å­˜çš„åŠŸèƒ½ï¼Œå®˜æ–¹ä¹Ÿæ˜¯è®¤ä¸ºè¯¥åŠŸèƒ½åœ¨å®é™…çš„åº”ç”¨åœºæ™¯æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥å¹²è„†ç›´æ¥åˆ æ‰äº†\nåˆ†æå™¨MySQL æ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œé‚£ä¹ˆå°±ä¼šè¿›å…¥åˆ†æå™¨ï¼Œåˆ†æå™¨ä¸»è¦æ˜¯ç”¨æ¥åˆ†æ SQL è¯­å¥æ˜¯æ¥å¹²å˜›çš„ï¼Œåˆ†æå™¨ä¹Ÿä¼šåˆ†ä¸ºå‡ æ­¥ï¼š\nç¬¬ä¸€æ­¥ï¼Œè¯æ³•åˆ†æï¼Œä¸€æ¡ SQL è¯­å¥æœ‰å¤šä¸ªå­—ç¬¦ä¸²ç»„æˆï¼Œé¦–å…ˆè¦æå–å…³é”®å­—ï¼Œæ¯”å¦‚ selectï¼Œæå‡ºæŸ¥è¯¢çš„è¡¨ï¼Œæå‡ºå­—æ®µåï¼Œæå‡ºæŸ¥è¯¢æ¡ä»¶ç­‰ç­‰ã€‚åšå®Œè¿™äº›æ“ä½œåï¼Œå°±ä¼šè¿›å…¥ç¬¬äºŒæ­¥ã€‚\nç¬¬äºŒæ­¥ï¼Œè¯­æ³•åˆ†æï¼Œä¸»è¦å°±æ˜¯åˆ¤æ–­ä½ è¾“å…¥çš„ SQL æ˜¯å¦æ­£ç¡®ï¼Œæ˜¯å¦ç¬¦åˆ MySQL çš„è¯­æ³•ã€‚\nå®Œæˆè¿™ 2 æ­¥ä¹‹åï¼ŒMySQL å°±å‡†å¤‡å¼€å§‹æ‰§è¡Œäº†ï¼Œä½†æ˜¯å¦‚ä½•æ‰§è¡Œï¼Œæ€ä¹ˆæ‰§è¡Œæ˜¯æœ€å¥½çš„ç»“æœå‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¼˜åŒ–å™¨ä¸Šåœºäº†ã€‚\nä¼˜åŒ–å™¨\nä¼˜åŒ–å™¨çš„ä½œç”¨å°±æ˜¯å®ƒè®¤ä¸ºçš„æœ€ä¼˜çš„æ‰§è¡Œæ–¹æ¡ˆå»æ‰§è¡Œï¼ˆæœ‰æ—¶å€™å¯èƒ½ä¹Ÿä¸æ˜¯æœ€ä¼˜ï¼Œè¿™ç¯‡æ–‡ç« æ¶‰åŠå¯¹è¿™éƒ¨åˆ†çŸ¥è¯†çš„æ·±å…¥è®²è§£ï¼‰ï¼Œæ¯”å¦‚å¤šä¸ªç´¢å¼•çš„æ—¶å€™è¯¥å¦‚ä½•é€‰æ‹©ç´¢å¼•ï¼Œå¤šè¡¨æŸ¥è¯¢çš„æ—¶å€™å¦‚ä½•é€‰æ‹©å…³è”é¡ºåºç­‰ã€‚\nå¯ä»¥è¯´ï¼Œç»è¿‡äº†ä¼˜åŒ–å™¨ä¹‹åå¯ä»¥è¯´è¿™ä¸ªè¯­å¥å…·ä½“è¯¥å¦‚ä½•æ‰§è¡Œå°±å·²ç»å®šä¸‹æ¥\næ‰§è¡Œå™¨\nå½“é€‰æ‹©äº†æ‰§è¡Œæ–¹æ¡ˆåï¼ŒMySQL å°±å‡†å¤‡å¼€å§‹æ‰§è¡Œäº†ï¼Œé¦–å…ˆæ‰§è¡Œå‰ä¼šæ ¡éªŒè¯¥ç”¨æˆ·æœ‰æ²¡æœ‰æƒé™ï¼Œå¦‚æœæ²¡æœ‰æƒé™ï¼Œå°±ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœæœ‰æƒé™ï¼Œå°±ä¼šå»è°ƒç”¨å¼•æ“çš„æ¥å£ï¼Œè¿”å›æ¥å£æ‰§è¡Œçš„ç»“æœ\nè¯­å¥åˆ†æ # SQLåˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯æŸ¥è¯¢ï¼Œä¸€ç§æ˜¯æ›´æ–°ï¼ˆå¢åŠ ã€ä¿®æ”¹ã€åˆ é™¤ï¼‰\næŸ¥è¯¢è¯­å¥ # select * from tb_student A where A.age='18' and A.name=' å¼ ä¸‰ ';\nç»“åˆä¸Šé¢è¯´æ˜ï¼Œåˆ†æä¸‹é¢è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹ï¼š\nå…ˆæ£€æŸ¥è¯¥è¯­å¥æ˜¯å¦æœ‰æƒé™ï¼Œå¦‚æœæ²¡æœ‰æƒé™ï¼Œç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœæœ‰æƒé™ï¼Œåœ¨ MySQL8.0 ç‰ˆæœ¬ä»¥å‰ï¼Œä¼šå…ˆæŸ¥è¯¢ç¼“å­˜ï¼Œä»¥è¿™æ¡ SQL è¯­å¥ä¸º key åœ¨å†…å­˜ä¸­æŸ¥è¯¢æ˜¯å¦æœ‰ç»“æœï¼Œå¦‚æœæœ‰ç›´æ¥ç¼“å­˜ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ‰§è¡Œä¸‹ä¸€æ­¥ã€‚\né€šè¿‡åˆ†æå™¨è¿›è¡Œè¯æ³•åˆ†æï¼Œæå– SQL è¯­å¥çš„å…³é”®å…ƒç´ ï¼Œæ¯”å¦‚æå–ä¸Šé¢è¿™ä¸ªè¯­å¥æ˜¯æŸ¥è¯¢ selectï¼Œæå–éœ€è¦æŸ¥è¯¢çš„è¡¨åä¸º tb_studentï¼Œéœ€è¦æŸ¥è¯¢æ‰€æœ‰çš„åˆ—ï¼ŒæŸ¥è¯¢æ¡ä»¶æ˜¯è¿™ä¸ªè¡¨çš„ id=\u0026lsquo;1\u0026rsquo;ã€‚ç„¶ååˆ¤æ–­è¿™ä¸ª SQL è¯­å¥æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯ï¼Œæ¯”å¦‚å…³é”®è¯æ˜¯å¦æ­£ç¡®ç­‰ç­‰ï¼Œå¦‚æœæ£€æŸ¥æ²¡é—®é¢˜å°±æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚\næ¥ä¸‹æ¥å°±æ˜¯ä¼˜åŒ–å™¨è¿›è¡Œç¡®å®šæ‰§è¡Œæ–¹æ¡ˆï¼Œä¸Šé¢çš„ SQL è¯­å¥ï¼Œå¯ä»¥æœ‰ä¸¤ç§æ‰§è¡Œæ–¹æ¡ˆï¼š\na.å…ˆæŸ¥è¯¢å­¦ç”Ÿè¡¨ä¸­å§“åä¸ºâ€œå¼ ä¸‰â€çš„å­¦ç”Ÿï¼Œç„¶ååˆ¤æ–­æ˜¯å¦å¹´é¾„æ˜¯ 18ã€‚ b.å…ˆæ‰¾å‡ºå­¦ç”Ÿä¸­å¹´é¾„ 18 å²çš„å­¦ç”Ÿï¼Œç„¶åå†æŸ¥è¯¢å§“åä¸ºâ€œå¼ ä¸‰â€çš„å­¦ç”Ÿã€‚ é‚£ä¹ˆä¼˜åŒ–å™¨æ ¹æ®è‡ªå·±çš„ä¼˜åŒ–ç®—æ³•è¿›è¡Œé€‰æ‹©æ‰§è¡Œæ•ˆç‡æœ€å¥½çš„ä¸€ä¸ªæ–¹æ¡ˆï¼ˆä¼˜åŒ–å™¨è®¤ä¸ºï¼Œæœ‰æ—¶å€™ä¸ä¸€å®šæœ€å¥½ï¼‰ã€‚é‚£ä¹ˆç¡®è®¤äº†æ‰§è¡Œè®¡åˆ’åå°±å‡†å¤‡å¼€å§‹æ‰§è¡Œäº†\nè¿›è¡Œæƒé™æ ¡éªŒï¼Œå¦‚æœæ²¡æœ‰æƒé™å°±ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœæœ‰æƒé™å°±ä¼šè°ƒç”¨æ•°æ®åº“å¼•æ“æ¥å£ï¼Œè¿”å›å¼•æ“çš„æ‰§è¡Œç»“æœ\næ›´æ–°è¯­å¥ # ä»¥ä¸Šå°±æ˜¯ä¸€æ¡æŸ¥è¯¢ SQL çš„æ‰§è¡Œæµç¨‹ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ä¸€æ¡æ›´æ–°è¯­å¥å¦‚ä½•æ‰§è¡Œçš„å‘¢ï¼ŸSQL è¯­å¥å¦‚ä¸‹ï¼š\nupdate tb_student A set A.age='19' where A.name=' å¼ ä¸‰ ';\næˆ‘ä»¬æ¥ç»™å¼ ä¸‰ä¿®æ”¹ä¸‹å¹´é¾„ï¼Œåœ¨å®é™…æ•°æ®åº“è‚¯å®šä¸ä¼šè®¾ç½®å¹´é¾„è¿™ä¸ªå­—æ®µçš„ï¼Œä¸ç„¶è¦è¢«æŠ€æœ¯è´Ÿè´£äººæ‰“çš„ (å› ä¸ºå¯èƒ½æœ‰ç”Ÿæ—¥ï¼Œå¹´é¾„æ˜¯ä¸å¯äººä¸ºæ‰‹åŠ¨ä¿®æ”¹) å…¶å®è¿™æ¡è¯­å¥ä¹ŸåŸºæœ¬ä¸Šä¼šæ²¿ç€ä¸Šä¸€ä¸ªæŸ¥è¯¢çš„æµç¨‹èµ°ï¼Œåªä¸è¿‡æ‰§è¡Œæ›´æ–°çš„æ—¶å€™è‚¯å®šè¦è®°å½•æ—¥å¿—å•¦ï¼Œè¿™å°±ä¼šå¼•å…¥æ—¥å¿—æ¨¡å—äº†ï¼ŒMySQL è‡ªå¸¦çš„æ—¥å¿—æ¨¡å—æ˜¯ binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ ï¼Œæ‰€æœ‰çš„å­˜å‚¨å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ InnoDB å¼•æ“è¿˜è‡ªå¸¦äº†ä¸€ä¸ªæ—¥å¿—æ¨¡å— redo logï¼ˆé‡åšæ—¥å¿—ï¼‰ï¼Œæˆ‘ä»¬å°±ä»¥ InnoDB æ¨¡å¼ä¸‹æ¥æ¢è®¨è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹ å…ˆæŸ¥è¯¢åˆ°å¼ ä¸‰è¿™ä¸€æ¡æ•°æ®ï¼Œå¦‚æœæœ‰ç¼“å­˜ï¼Œä¹Ÿæ˜¯ä¼šç”¨åˆ°ç¼“å­˜ã€‚ ç„¶åæ‹¿åˆ°æŸ¥è¯¢çš„è¯­å¥ï¼ŒæŠŠ age æ”¹ä¸º 19ï¼Œç„¶åè°ƒç”¨å¼•æ“ API æ¥å£ï¼Œå†™å…¥è¿™ä¸€è¡Œæ•°æ®ï¼ŒInnoDB å¼•æ“æŠŠæ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼ŒåŒæ—¶è®°å½• redo logï¼Œæ­¤æ—¶ redo log è¿›å…¥ prepare çŠ¶æ€ï¼Œç„¶åå‘Šè¯‰æ‰§è¡Œå™¨ï¼Œæ‰§è¡Œå®Œæˆäº†ï¼Œéšæ—¶å¯ä»¥æäº¤ã€‚ æ‰§è¡Œå™¨æ”¶åˆ°é€šçŸ¥åè®°å½• binlogï¼Œç„¶åè°ƒç”¨å¼•æ“æ¥å£ï¼Œæäº¤ redo log ä¸ºæäº¤çŠ¶æ€ã€‚ æ›´æ–°å®Œæˆ è¿™é‡Œè‚¯å®šæœ‰åŒå­¦ä¼šé—®ï¼Œä¸ºä»€ä¹ˆè¦ç”¨ä¸¤ä¸ªæ—¥å¿—æ¨¡å—ï¼Œç”¨ä¸€ä¸ªæ—¥å¿—æ¨¡å—ä¸è¡Œå—?\nè¿™æ˜¯å› ä¸ºæœ€å¼€å§‹ MySQL å¹¶æ²¡æœ‰ InnoDB å¼•æ“ï¼ˆInnoDB å¼•æ“æ˜¯å…¶ä»–å…¬å¸ä»¥æ’ä»¶å½¢å¼æ’å…¥ MySQL çš„ï¼‰ï¼ŒMySQL è‡ªå¸¦çš„å¼•æ“æ˜¯ MyISAMï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“ redo log æ˜¯ InnoDB å¼•æ“ç‰¹æœ‰çš„ï¼Œå…¶ä»–å­˜å‚¨å¼•æ“éƒ½æ²¡æœ‰ï¼Œè¿™å°±å¯¼è‡´ä¼šæ²¡æœ‰ crash-safe çš„èƒ½åŠ›(crash-safe çš„èƒ½åŠ›å³ä½¿æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œä¹‹å‰æäº¤çš„è®°å½•éƒ½ä¸ä¼šä¸¢å¤±)ï¼Œbinlog æ—¥å¿—åªèƒ½ç”¨æ¥å½’æ¡£ã€‚\nå¹¶ä¸æ˜¯è¯´åªç”¨ä¸€ä¸ªæ—¥å¿—æ¨¡å—ä¸å¯ä»¥ï¼Œåªæ˜¯ InnoDB å¼•æ“å°±æ˜¯é€šè¿‡ redo log æ¥æ”¯æŒäº‹åŠ¡çš„ã€‚é‚£ä¹ˆï¼Œåˆä¼šæœ‰åŒå­¦é—®ï¼Œæˆ‘ç”¨ä¸¤ä¸ªæ—¥å¿—æ¨¡å—ï¼Œä½†æ˜¯ä¸è¦è¿™ä¹ˆå¤æ‚è¡Œä¸è¡Œï¼Œä¸ºä»€ä¹ˆ redo log è¦å¼•å…¥ prepare é¢„æäº¤çŠ¶æ€ï¼Ÿè¿™é‡Œæˆ‘ä»¬ç”¨åè¯æ³•æ¥è¯´æ˜ä¸‹ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿ\nå…ˆå†™ redo log ç›´æ¥æäº¤ï¼Œç„¶åå†™ binlogï¼Œå‡è®¾å†™å®Œ redo log åï¼Œæœºå™¨æŒ‚äº†ï¼Œbinlog æ—¥å¿—æ²¡æœ‰è¢«å†™å…¥ï¼Œé‚£ä¹ˆæœºå™¨é‡å¯åï¼Œè¿™å°æœºå™¨ä¼šé€šè¿‡ redo log æ¢å¤æ•°æ®ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™ binlog å¹¶æ²¡æœ‰è®°å½•è¯¥æ•°æ®ï¼Œ**åç»­è¿›è¡Œæœºå™¨å¤‡ä»½(ä»æœº)**çš„æ—¶å€™ï¼Œå°±ä¼šä¸¢å¤±è¿™ä¸€æ¡æ•°æ®ï¼ŒåŒæ—¶ä¸»ä»åŒæ­¥ä¹Ÿä¼šä¸¢å¤±è¿™ä¸€æ¡æ•°æ®ã€‚ å…ˆå†™ binlogï¼Œç„¶åå†™ redo logï¼Œå‡è®¾å†™å®Œäº† binlogï¼Œæœºå™¨å¼‚å¸¸é‡å¯äº†ï¼Œç”±äºæ²¡æœ‰ redo logï¼Œæœ¬æœºæ˜¯æ— æ³•æ¢å¤è¿™ä¸€æ¡è®°å½•çš„ï¼Œä½†æ˜¯ binlog åˆæœ‰è®°å½•ï¼Œé‚£ä¹ˆå’Œä¸Šé¢åŒæ ·çš„é“ç†ï¼Œå°±ä¼šäº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ å¦‚æœé‡‡ç”¨ redo log ä¸¤é˜¶æ®µæäº¤çš„æ–¹å¼å°±ä¸ä¸€æ ·äº†ï¼Œå†™å®Œ binlog åï¼Œç„¶åå†æäº¤ redo log å°±ä¼šé˜²æ­¢å‡ºç°ä¸Šè¿°çš„é—®é¢˜ï¼Œä»è€Œä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæœ‰æ²¡æœ‰ä¸€ä¸ªæç«¯çš„æƒ…å†µå‘¢ï¼Ÿå‡è®¾ redo log å¤„äºé¢„æäº¤çŠ¶æ€ï¼Œbinlog ä¹Ÿå·²ç»å†™å®Œäº†ï¼Œè¿™ä¸ªæ—¶å€™å‘ç”Ÿäº†å¼‚å¸¸é‡å¯ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ è¿™ä¸ªå°±è¦ä¾èµ–äº MySQL çš„å¤„ç†æœºåˆ¶äº†ï¼ŒMySQL çš„å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š\nåˆ¤æ–­ redo log æ˜¯å¦å®Œæ•´ï¼Œå¦‚æœåˆ¤æ–­æ˜¯å®Œæ•´çš„ï¼Œå°±ç«‹å³æäº¤ã€‚ å¦‚æœ redo log åªæ˜¯é¢„æäº¤ä½†ä¸æ˜¯ commit çŠ¶æ€ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå»åˆ¤æ–­ binlog æ˜¯å¦å®Œæ•´ï¼Œå¦‚æœå®Œæ•´å°±æäº¤ redo log, ä¸å®Œæ•´å°±å›æ»šäº‹åŠ¡ã€‚ è¿™æ ·å°±è§£å†³äº†æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜\næ€»ç»“ # MySQL ä¸»è¦åˆ†ä¸º Server å±‚å’Œå¼•æ“å±‚ï¼ŒServer å±‚ä¸»è¦åŒ…æ‹¬è¿æ¥å™¨ã€æŸ¥è¯¢ç¼“å­˜ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªæ—¥å¿—æ¨¡å—ï¼ˆbinlogï¼‰ï¼Œè¿™ä¸ªæ—¥å¿—æ¨¡å—æ‰€æœ‰æ‰§è¡Œå¼•æ“éƒ½å¯ä»¥å…±ç”¨ï¼Œredolog åªæœ‰ InnoDB æœ‰ã€‚\nå¼•æ“å±‚æ˜¯æ’ä»¶å¼çš„ï¼Œç›®å‰ä¸»è¦åŒ…æ‹¬ï¼ŒMyISAM,InnoDB,Memory ç­‰ã€‚\næŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼šæƒé™æ ¡éªŒï¼ˆå¦‚æœå‘½ä¸­ç¼“å­˜ï¼‰\u0026mdash;\u0026gt;æŸ¥è¯¢ç¼“å­˜\u0026mdash;\u0026gt;åˆ†æå™¨\u0026mdash;\u0026gt;ä¼˜åŒ–å™¨\u0026mdash;\u0026gt;æƒé™æ ¡éªŒ\u0026mdash;\u0026gt;æ‰§è¡Œå™¨\u0026mdash;\u0026gt;å¼•æ“\næ›´æ–°è¯­å¥æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼šåˆ†æå™¨\u0026mdash;-\u0026gt;æƒé™æ ¡éªŒ\u0026mdash;-\u0026gt;æ‰§è¡Œå™¨\u0026mdash;\u0026gt;å¼•æ“\u0026mdash;redo log(prepare çŠ¶æ€)\u0026mdash;\u0026gt;binlog\u0026mdash;\u0026gt;redo log(commitçŠ¶æ€\n"},{"id":109,"href":"/zh/docs/study/Review/java_guide/database/MySQL/ly0604lyinnodb-implementation-of-mvcc/","title":"innodbå¼•æ“å¯¹MVCCçš„å®ç°","section":"MySQL","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nä¸€è‡´æ€§éé”å®šè¯»å’Œé”å®šè¯» # ä¸€è‡´æ€§éé”å®šè¯» # â˜…â˜…éé”å®šâ˜…â˜…\nå¯¹äºä¸€è‡´æ€§éé”å®šè¯»ï¼ˆConsistent Nonlocking Readsï¼‰çš„å®ç°ï¼Œé€šå¸¸åšæ³•æ˜¯åŠ ä¸€ä¸ªç‰ˆæœ¬å·æˆ–è€…æ—¶é—´æˆ³å­—æ®µï¼Œåœ¨æ›´æ–°æ•°æ®çš„åŒæ—¶ç‰ˆæœ¬å·+1æˆ–è€…æ›´æ–°æ—¶é—´æˆ³ã€‚æŸ¥è¯¢æ—¶ï¼Œå°†å½“å‰å¯è§çš„ç‰ˆæœ¬å·ä¸å¯¹åº”è®°å½•çš„ç‰ˆæœ¬å·è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœè®°å½•çš„ç‰ˆæœ¬å°äºå¯è§ç‰ˆæœ¬ï¼Œåˆ™è¡¨ç¤ºè¯¥è®°å½•å¯è§ InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œå¤šç‰ˆæœ¬æ§åˆ¶ï¼ˆmulti versioningï¼‰å³æ˜¯éé”å®šè¯»çš„å®ç°ã€‚å¦‚æœè¯»å–çš„è¡Œæ­£åœ¨æ‰§è¡ŒDELETEæˆ–UPDATEæ“ä½œï¼Œè¿™æ—¶è¯»å–æ“ä½œä¸ä¼šå»ç­‰å¾…è¡Œä¸Š é”çš„é‡Šæ”¾.ç›¸ååœ°ï¼ŒInnå“¦DBå­˜å‚¨å¼•æ“ä¼šå»è¯»å–è¡Œçš„ä¸€ä¸ªå¿«ç…§æ•°æ®ï¼Œå¯¹äºè¿™ç§è¯»å–å†å²æ•°æ®çš„æ–¹å¼ï¼Œæˆ‘ä»¬å«å®ƒå¿«ç…§è¯»ï¼ˆsnapshot readï¼‰ã€‚ åœ¨ Repeatable Read å’Œ Read Committed ä¸¤ä¸ªéš”ç¦»çº§åˆ«ä¸‹ï¼Œå¦‚æœæ˜¯æ‰§è¡Œæ™®é€šçš„ select è¯­å¥ï¼ˆä¸åŒ…æ‹¬ select ... lock in share mode ,select ... for updateï¼‰åˆ™ä¼šä½¿ç”¨ ä¸€è‡´æ€§éé”å®šè¯»ï¼ˆMVCCï¼‰ã€‚å¹¶ä¸”åœ¨ Repeatable Read ä¸‹ MVCC å®ç°äº†å¯é‡å¤è¯»å’Œé˜²æ­¢éƒ¨åˆ†å¹»è¯» é”å®šè¯» # å¦‚æœæ‰§è¡Œçš„æ˜¯ä¸‹åˆ—è¯­å¥ï¼Œå°±æ˜¯é”å®šè¯»ï¼ˆLocking Readsï¼‰\nselect ... lock in share\nselect ... for update\ninsert ã€upateã€delete\né”å®šè¯»ä¸‹ï¼Œè¯»å–çš„æ˜¯æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¿™ç§è¯»ä¹Ÿè¢«ç§°ä¸ºå½“å‰è¯»current readã€‚é”å®šè¯»ä¼šå¯¹è¯»å–åˆ°çš„è®°å½•åŠ é”\nselect ... lock in share mode ï¼šå¯¹(è¯»å–åˆ°çš„)è®°å½•åŠ Sé”ï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿå¯ä»¥åŠ Sé”ï¼Œå¦‚æœåŠ Xé”åˆ™ä¼šè¢«é˜»å¡\nselect ... for updateã€insertã€updateã€deleteï¼šå¯¹è®°å½•åŠ Xé”ï¼Œä¸”å…¶ä»–äº‹åŠ¡ä¸èƒ½åŠ ä»»ä½•é”\nåœ¨ä¸€è‡´æ€§éé”å®šè¯»ä¸‹ï¼Œå³ä½¿è¯»å–çš„è®°å½•å·²è¢«å…¶ä»–äº‹åŠ¡åŠ ä¸ŠXé”ï¼Œè¿™æ—¶è®°å½•ä¹Ÿæ˜¯å¯ä»¥è¢«è¯»å–çš„ï¼Œå³è¯»å–çš„å¿«ç…§æ•°æ®ã€‚\nåœ¨RepeatableReadä¸‹MVCCé˜²æ­¢äº†éƒ¨åˆ†å¹»è¯»ï¼Œè¿™è¾¹çš„â€œéƒ¨åˆ†â€æ˜¯æŒ‡åœ¨ä¸€è‡´æ€§éé”å®šè¯»æƒ…å†µä¸‹ï¼Œåªèƒ½è¯»å–åˆ°ç¬¬ä¸€æ¬¡æŸ¥è¯¢ä¹‹å‰æ‰€æ’å…¥çš„æ•°æ®ï¼ˆæ ¹æ®ReadViewåˆ¤æ–­æ•°æ®å¯è§æ€§ï¼ŒReadViewåœ¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶ç”Ÿæˆï¼‰ï¼Œä½†å¦‚æœæ˜¯å½“å‰è¯»ï¼Œæ¯æ¬¡è¯»å–çš„éƒ½æ˜¯æœ€æ–°æ•°æ®ï¼Œè¿™æ—¶å¦‚æœä¸¤æ¬¡æŸ¥è¯¢ä¸­é—´æœ‰å…¶ä»–äº‹åŠ¡æ’å…¥æ•°æ®ï¼Œå°±ä¼šäº§ç”Ÿå¹»è¯» æ‰€ä»¥ï¼ŒInnoDBåœ¨å®ç°RepeatableReadæ—¶ï¼Œå¦‚æœæ‰§è¡Œçš„æ˜¯å½“å‰è¯»ï¼Œåˆ™ä¼šå¯¹è¯»å–çš„è®°å½•ä½¿ç”¨Next-key Lockï¼Œæ¥é˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨é—´éš™é—´æ’å…¥æ•°æ®ã€‚ RRäº§ç”Ÿå¹»è¯»çš„å¦ä¸€ä¸ªåœºæ™¯\nå‡è®¾æœ‰è¿™æ ·ä¸€å¼ è¡¨\näº‹åŠ¡ A æ‰§è¡ŒæŸ¥è¯¢ id = 5 çš„è®°å½•ï¼Œæ­¤æ—¶è¡¨ä¸­æ˜¯æ²¡æœ‰è¯¥è®°å½•çš„ï¼Œæ‰€ä»¥æŸ¥è¯¢ä¸å‡ºæ¥ã€‚\n# äº‹åŠ¡ A mysql\u0026gt; begin; Query OK, 0 rows affected (0.00 sec) mysql\u0026gt; select * from t_stu where id = 5; Empty set (0.01 sec) ç„¶åäº‹åŠ¡ B æ’å…¥ä¸€æ¡ id = 5 çš„è®°å½•ï¼Œå¹¶ä¸”æäº¤äº†äº‹åŠ¡ã€‚\n# äº‹åŠ¡ B mysql\u0026gt; begin; Query OK, 0 rows affected (0.00 sec) mysql\u0026gt; insert into t_stu values(5, \u0026#39;å°ç¾\u0026#39;, 18); Query OK, 1 row affected (0.00 sec) mysql\u0026gt; commit; Query OK, 0 rows affected (0.00 sec) æ­¤æ—¶ï¼Œäº‹åŠ¡ A æ›´æ–° id = 5 è¿™æ¡è®°å½•ï¼Œå¯¹æ²¡é”™ï¼Œäº‹åŠ¡ A çœ‹ä¸åˆ° id = 5 è¿™æ¡è®°å½•ï¼Œä½†æ˜¯ä»–å»æ›´æ–°äº†è¿™æ¡è®°å½•ï¼Œè¿™åœºæ™¯ç¡®å®å¾ˆè¿å’Œï¼Œç„¶åå†æ¬¡æŸ¥è¯¢ id = 5 çš„è®°å½•ï¼Œäº‹åŠ¡ A å°±èƒ½çœ‹åˆ°äº‹åŠ¡ B æ’å…¥çš„çºªå½•äº†ï¼Œå¹»è¯»å°±æ˜¯å‘ç”Ÿåœ¨è¿™ç§è¿å’Œçš„åœºæ™¯ã€‚\n# äº‹åŠ¡ A mysql\u0026gt; update t_stu set name = \u0026#39;å°æ—coding\u0026#39; where id = 5; Query OK, 1 row affected (0.01 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql\u0026gt; select * from t_stu where id = 5; +----+--------------+------+ | id | name | age | +----+--------------+------+ | 5 | å°æ—coding | 18 | +----+--------------+------+ 1 row in set (0.00 sec) æ—¶åºå›¾å¦‚ä¸‹\nåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡ A ç¬¬ä¸€æ¬¡æ‰§è¡Œæ™®é€šçš„ select è¯­å¥æ—¶ç”Ÿæˆäº†ä¸€ä¸ª ReadViewï¼Œä¹‹åäº‹åŠ¡ B å‘è¡¨ä¸­æ–°æ’å…¥äº†ä¸€æ¡ id = 5 çš„è®°å½•å¹¶æäº¤ã€‚æ¥ç€ï¼Œäº‹åŠ¡ A å¯¹ id = 5 è¿™æ¡è®°å½•è¿›è¡Œäº†æ›´æ–°æ“ä½œï¼Œåœ¨è¿™ä¸ªæ—¶åˆ»ï¼Œè¿™æ¡æ–°è®°å½•çš„ trx_id éšè—åˆ—çš„å€¼å°±å˜æˆäº†äº‹åŠ¡ A çš„äº‹åŠ¡ idï¼Œä¹‹åäº‹åŠ¡ A å†ä½¿ç”¨æ™®é€š select è¯­å¥å»æŸ¥è¯¢è¿™æ¡è®°å½•æ—¶å°±å¯ä»¥çœ‹åˆ°è¿™æ¡è®°å½•äº†ï¼Œäºæ˜¯å°±å‘ç”Ÿäº†å¹»è¯»ã€‚\nå› ä¸ºè¿™ç§ç‰¹æ®Šç°è±¡çš„å­˜åœ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¤ä¸º MySQL Innodb ä¸­çš„ MVCC å¹¶ä¸èƒ½å®Œå…¨é¿å…å¹»è¯»ç°è±¡ã€‚\nInnoDBå¯¹MVCCçš„å®ç° # MVCCçš„å®ç°ä¾èµ–äºï¼šéšè—å­—æ®µï¼ˆæ¯æ¡è®°å½•çš„ï¼‰ã€ReadViewï¼ˆå½“å‰äº‹åŠ¡ç”Ÿæˆçš„ï¼‰ã€undo logï¼ˆå½“å‰äº‹åŠ¡æ‰§è¡Œæ—¶ï¼Œä¸ºæ¯ä¸ªæ“ä½œï¼ˆè®°å½•ï¼‰ç”Ÿæˆçš„ï¼‰ å†…éƒ¨å®ç°ä¸­ï¼ŒInnoDBé€šè¿‡æ•°æ®è¡Œçš„DB_TRX_IDå’ŒRead Viewæ¥åˆ¤æ–­æ•°æ®çš„å¯è§æ€§ï¼Œå¦‚ä¸å¯è§ï¼Œåˆ™é€šè¿‡æ•°æ®è¡Œçš„DB_ROLL_PTRæ‰¾åˆ°undo logä¸­çš„å†å²ç‰ˆæœ¬ã€‚å› æ­¤ï¼Œæ¯ä¸ªäº‹åŠ¡è¯»åˆ°çš„æ•°æ®ç‰ˆæœ¬å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œç”¨æˆ·åªèƒ½çœ‹åˆ°è¯¥äº‹åŠ¡åˆ›å»ºReadViewä¹‹å‰**ï¼ˆå…¶å®è¿™ä¸ªè¯´æ³•ä¸å¤ªå‡†ç¡®ï¼Œm_up_limit_idä¸ä¸€å®šå¤§äºå½“å‰äº‹åŠ¡idï¼‰å·²ç»æäº¤çš„ä¿®æ”¹å’Œè¯¥äº‹åŠ¡æœ¬èº«åšçš„ä¿®æ”¹** éšè—å­—æ®µ # å†…éƒ¨ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä¸ºæ¯è¡Œæ•°æ®æ·»åŠ äº†ä¸‰ä¸ªéšè—å­—æ®µï¼š DB_TRX_ID(6å­—èŠ‚)ï¼šè¡¨ç¤ºæœ€åä¸€æ¬¡æ’å…¥æˆ–æ›´æ–°è¯¥è¡Œçš„äº‹åŠ¡idã€‚æ­¤å¤–ï¼Œdeleteæ“ä½œåœ¨å†…éƒ¨è¢«è§†ä¸ºæ›´æ–°ï¼Œåªä¸è¿‡ä¼šåœ¨è®°å½•å¤´Record headerä¸­çš„deleted_flagå­—æ®µå°†å…¶æ ‡è®°ä¸ºå·²åˆ é™¤ DB_ROLL_PTR(7å­—èŠ‚)ï¼šå›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘è¯¥è¡Œçš„undo logã€‚å¦‚æœè¯¥è¡Œæœªè¢«æ›´æ–°ï¼Œåˆ™ä¸ºç©º DB_ROW_ID(6å­—èŠ‚)ï¼šå¦‚æœæ²¡æœ‰è®¾ç½®ä¸»é”®ä¸”è¯¥è¡¨æ²¡æœ‰å”¯ä¸€éç©ºç´¢å¼•æ—¶ï¼ŒInnoDBä¼šä½¿ç”¨è¯¥idæ¥ç”Ÿæˆèšç°‡ç´¢å¼• ReadView # class ReadView { /* ... */ private: trx_id_t m_low_limit_id; /* å¤§äºç­‰äºè¿™ä¸ª ID çš„äº‹åŠ¡å‡ä¸å¯è§ */ trx_id_t m_up_limit_id; /* å°äºè¿™ä¸ª ID çš„äº‹åŠ¡å‡å¯è§ */ trx_id_t m_creator_trx_id; /* åˆ›å»ºè¯¥ Read View çš„äº‹åŠ¡ID */ trx_id_t m_low_limit_no; /* äº‹åŠ¡ Number, å°äºè¯¥ Number çš„ Undo Logs å‡å¯ä»¥è¢« Purge */ ids_t m_ids; /* åˆ›å»º Read View æ—¶çš„æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ */ m_closed; /* æ ‡è®° Read View æ˜¯å¦ close */ } Read View ä¸»è¦æ˜¯ç”¨æ¥åšå¯è§æ€§åˆ¤æ–­ï¼Œé‡Œé¢ä¿å­˜äº† â€œå½“å‰å¯¹æœ¬äº‹åŠ¡ä¸å¯è§çš„å…¶ä»–æ´»è·ƒäº‹åŠ¡â€\nReadViewä¸»è¦æœ‰ä»¥ä¸‹å­—æ®µ\nm_low_limit_idï¼šç›®å‰å‡ºç°è¿‡çš„æœ€å¤§çš„äº‹åŠ¡ ID+1ï¼Œå³ä¸‹ä¸€ä¸ªå°†è¢«åˆ†é…çš„äº‹åŠ¡ IDã€‚å¤§äºç­‰äºè¿™ä¸ª ID çš„æ•°æ®ç‰ˆæœ¬å‡ä¸å¯è§ m_up_limit_idï¼šæ´»è·ƒäº‹åŠ¡åˆ—è¡¨ m_ids ä¸­æœ€å°çš„äº‹åŠ¡ IDï¼Œå¦‚æœ m_ids ä¸ºç©ºï¼Œåˆ™ m_up_limit_id ä¸º m_low_limit_idã€‚å°äºè¿™ä¸ª ID çš„æ•°æ®ç‰ˆæœ¬å‡å¯è§ m_idsï¼šRead View åˆ›å»ºæ—¶å…¶ä»–æœªæäº¤çš„æ´»è·ƒäº‹åŠ¡ ID åˆ—è¡¨ã€‚åˆ›å»º Read Viewæ—¶ï¼Œå°†å½“å‰æœªæäº¤äº‹åŠ¡ ID è®°å½•ä¸‹æ¥ï¼Œåç»­å³ä½¿å®ƒä»¬ä¿®æ”¹äº†è®°å½•è¡Œçš„å€¼ï¼Œå¯¹äºå½“å‰äº‹åŠ¡ä¹Ÿæ˜¯ä¸å¯è§çš„ã€‚m_ids ä¸åŒ…æ‹¬å½“å‰äº‹åŠ¡è‡ªå·±å’Œå·²æäº¤çš„äº‹åŠ¡ï¼ˆæ­£åœ¨å†…å­˜ä¸­ï¼‰ m_creator_trx_idï¼šåˆ›å»ºè¯¥ Read View çš„äº‹åŠ¡ ID äº‹åŠ¡å¯è§æ€§ç¤ºæ„å›¾ï¼ˆè¿™ä¸ªå›¾å®¹æ˜“ç†è§£ï¼‰ï¼š\nä¸ºä»€ä¹ˆä¸æ˜¯åˆ†å¤§äºm_low_limit_idå’Œåœ¨å°äºm_low_limit_idé‡Œè¿‡æ»¤å­˜åœ¨äºæ´»è·ƒäº‹åŠ¡åˆ—è¡¨ï¼Œåº”è¯¥å’Œç®—æ³•æœ‰å…³å§\nundo-log # undo logä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨\nå½“äº‹åŠ¡å›æ»šæ—¶ç”¨äºå°†æ•°æ®æ¢å¤åˆ°ä¿®æ”¹å‰çš„æ ·å­ ç”¨äºMVCCï¼Œè¯»å–è®°å½•æ—¶ï¼Œè‹¥è¯¥è®°å½•è¢«å…¶ä»–äº‹åŠ¡å ç”¨æˆ–å½“å‰ç‰ˆæœ¬å¯¹è¯¥äº‹åŠ¡ä¸å¯è§ï¼Œåˆ™å¯ä»¥é€šè¿‡undo log è¯»å–ä¹‹å‰çš„ç‰ˆæœ¬æ•°æ®ï¼Œä»¥æ­¤å®ç°éé”å®šè¯» InnoDBå­˜å‚¨å¼•æ“ä¸­undo logåˆ†ä¸ºä¸¤ç§ï¼šinsert undo logå’Œupdate undo log\ninsert undo logï¼šæŒ‡åœ¨insertæ“ä½œä¸­äº§ç”Ÿçš„undo logï¼Œå› ä¸ºinsertæ“ä½œçš„è®°å½•åªå¯¹äº‹åŠ¡æœ¬èº«å¯è§ï¼Œå¯¹å…¶ä»–äº‹åŠ¡ä¸å¯è§ï¼Œæ•…è¯¥undo logå¯ä»¥åœ¨äº‹åŠ¡æäº¤åç›´æ¥åˆ é™¤ã€‚ä¸éœ€è¦è¿›è¡Œpurgeæ“ä½œï¼ˆpurgeï¼šæ¸…æ´—ï¼‰\ninsertæ—¶çš„æ•°æ®åˆå§‹çŠ¶æ€ï¼š(DB_ROLL_PTRä¸ºç©º)\nupdate undo logï¼šundateæˆ–deleteæ“ä½œäº§ç”Ÿçš„undo logã€‚è¯¥undo log å¯èƒ½éœ€è¦æä¾›ç»™MVCCæœºåˆ¶ï¼Œå› æ­¤ä¸èƒ½åœ¨äº‹åŠ¡æäº¤æ—¶å°±è¿›è¡Œåˆ é™¤ã€‚æäº¤æ—¶æ”¾å…¥undo logé“¾è¡¨ï¼Œç­‰å¾…purgeçº¿ç¨‹è¿›è¡Œæœ€åçš„åˆ é™¤\næ•°æ®ç¬¬ä¸€æ¬¡ä¿®æ”¹æ—¶\næ•°æ®ç¬¬äºŒæ¬¡è¢«ä¿®æ”¹æ—¶\nä¸åŒäº‹åŠ¡æˆ–è€…ç›¸åŒäº‹åŠ¡çš„å¯¹åŒä¸€è®°å½•è¡Œçš„ä¿®æ”¹ï¼Œä¼šä½¿è¯¥è®°å½•è¡Œçš„ undo log æˆä¸ºä¸€æ¡é“¾è¡¨ï¼Œé“¾é¦–å°±æ˜¯æœ€æ–°çš„è®°å½•ï¼Œé“¾å°¾å°±æ˜¯æœ€æ—©çš„æ—§è®°å½•ã€‚\næ•°æ®å¯è§æ€§ç®—æ³• # åœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡åï¼Œæ‰§è¡Œæ¯ä¸ª select è¯­å¥å‰(RCä¸‹æ˜¯)ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼ˆRead Viewï¼‰ï¼Œå¿«ç…§ä¸­ä¿å­˜äº†å½“å‰æ•°æ®åº“ç³»ç»Ÿä¸­æ­£å¤„äºæ´»è·ƒï¼ˆæ²¡æœ‰ commitï¼‰çš„äº‹åŠ¡çš„ ID å·ã€‚å…¶å®ç®€å•çš„è¯´ä¿å­˜çš„æ˜¯ç³»ç»Ÿä¸­å½“å‰ä¸åº”è¯¥è¢«æœ¬äº‹åŠ¡çœ‹åˆ°çš„å…¶ä»–äº‹åŠ¡ ID åˆ—è¡¨ï¼ˆå³ m_idsï¼‰ã€‚å½“ç”¨æˆ·åœ¨è¿™ä¸ªäº‹åŠ¡ä¸­è¦è¯»å–æŸä¸ªè®°å½•è¡Œçš„æ—¶å€™ï¼ŒInnoDB ä¼šå°†è¯¥è®°å½•è¡Œçš„ DB_TRX_ID ä¸ Read View ä¸­çš„ä¸€äº›å˜é‡åŠå½“å‰äº‹åŠ¡ ID è¿›è¡Œæ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦æ»¡è¶³å¯è§æ€§æ¡ä»¶\nå…·ä½“çš„æ¯”è¾ƒç®—æ³•\nå¦‚æœè®°å½• DB_TRX_ID \u0026lt; m_up_limit_idï¼Œé‚£ä¹ˆè¡¨æ˜æœ€æ–°ä¿®æ”¹è¯¥è¡Œçš„äº‹åŠ¡ï¼ˆDB_TRX_IDï¼‰åœ¨å½“å‰äº‹åŠ¡åˆ›å»ºå¿«ç…§ä¹‹å‰å°±æäº¤äº†ï¼Œæ‰€ä»¥è¯¥è®°å½•è¡Œçš„å€¼å¯¹å½“å‰äº‹åŠ¡æ˜¯å¯è§çš„ å¦‚æœ DB_TRX_ID \u0026gt;= m_low_limit_idï¼Œé‚£ä¹ˆè¡¨æ˜æœ€æ–°ä¿®æ”¹è¯¥è¡Œçš„äº‹åŠ¡ï¼ˆDB_TRX_IDï¼‰åœ¨å½“å‰äº‹åŠ¡åˆ›å»ºå¿«ç…§ä¹‹åæ‰ä¿®æ”¹è¯¥è¡Œï¼Œæ‰€ä»¥è¯¥è®°å½•è¡Œçš„å€¼å¯¹å½“å‰äº‹åŠ¡ä¸å¯è§ã€‚è·³åˆ°æ­¥éª¤ 5 m_ids ä¸ºç©º[é‚£å°±ä¸ç”¨æ’é™¤å•¦ï¼Œåªè¦å°äºm_low_limit_idéƒ½å¯è§]ï¼ˆä¸”DB_TRX_ID \u0026lt; m_low_limit_idï¼‰ï¼Œåˆ™è¡¨æ˜åœ¨å½“å‰äº‹åŠ¡åˆ›å»ºå¿«ç…§ä¹‹å‰ï¼Œä¿®æ”¹è¯¥è¡Œçš„äº‹åŠ¡å°±å·²ç»æäº¤äº†ï¼Œæ‰€ä»¥è¯¥è®°å½•è¡Œçš„å€¼å¯¹å½“å‰äº‹åŠ¡æ˜¯å¯è§çš„ å¦‚æœ m_up_limit_id \u0026lt;= DB_TRX_ID \u0026lt; m_low_limit_idï¼Œè¡¨æ˜æœ€æ–°ä¿®æ”¹è¯¥è¡Œçš„äº‹åŠ¡ï¼ˆDB_TRX_IDï¼‰åœ¨å½“å‰äº‹åŠ¡åˆ›å»ºå¿«ç…§çš„æ—¶å€™å¯èƒ½å¤„äºâ€œæ´»åŠ¨çŠ¶æ€â€æˆ–è€…â€œå·²æäº¤çŠ¶æ€â€ï¼›æ‰€ä»¥å°±è¦å¯¹æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ m_ids è¿›è¡ŒæŸ¥æ‰¾ï¼ˆæºç ä¸­æ˜¯ç”¨çš„äºŒåˆ†æŸ¥æ‰¾ï¼Œå› ä¸ºæ˜¯æœ‰åºçš„ï¼‰ å¦‚æœåœ¨æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ m_ids ä¸­èƒ½æ‰¾åˆ° DB_TRX_IDï¼Œè¡¨æ˜ï¼šâ‘  åœ¨å½“å‰äº‹åŠ¡åˆ›å»ºå¿«ç…§å‰ï¼Œè¯¥è®°å½•è¡Œçš„å€¼è¢«äº‹åŠ¡ ID ä¸º DB_TRX_ID çš„äº‹åŠ¡ä¿®æ”¹äº†ï¼Œä½†æ²¡æœ‰æäº¤ï¼›æˆ–è€… â‘¡ åœ¨å½“å‰äº‹åŠ¡åˆ›å»ºå¿«ç…§åï¼Œè¯¥è®°å½•è¡Œçš„å€¼è¢«äº‹åŠ¡ ID ä¸º DB_TRX_ID çš„äº‹åŠ¡ä¿®æ”¹äº†ä¸”æäº¤äº†(å¯é‡å¤è¯»)ã€‚è¿™äº›æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè®°å½•è¡Œçš„å€¼å¯¹å½“å‰äº‹åŠ¡éƒ½æ˜¯ä¸å¯è§çš„ã€‚è·³åˆ°æ­¥éª¤ 5 åœ¨æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ä¸­æ‰¾ä¸åˆ°ï¼Œåˆ™è¡¨æ˜â€œid ä¸º trx_id çš„äº‹åŠ¡â€åœ¨ä¿®æ”¹â€œè¯¥è®°å½•è¡Œçš„å€¼â€åï¼Œåœ¨**â€œå½“å‰äº‹åŠ¡â€åˆ›å»ºå¿«ç…§å‰å°±å·²ç»æäº¤**äº†ï¼Œæ‰€ä»¥è®°å½•è¡Œå¯¹å½“å‰äº‹åŠ¡å¯è§ åœ¨è¯¥è®°å½•è¡Œçš„ DB_ROLL_PTR æŒ‡é’ˆæ‰€æŒ‡å‘çš„ undo log å–å‡ºå¿«ç…§è®°å½•ï¼Œç”¨å¿«ç…§è®°å½•çš„ DB_TRX_ID è·³åˆ°æ­¥éª¤ 1 é‡æ–°å¼€å§‹åˆ¤æ–­ï¼Œç›´åˆ°æ‰¾åˆ°æ»¡è¶³çš„å¿«ç…§ç‰ˆæœ¬æˆ–è¿”å›ç©º RC å’Œ RR éš”ç¦»çº§åˆ«ä¸‹ MVCC çš„å·®å¼‚ # åœ¨äº‹åŠ¡éš”ç¦»çº§åˆ« RC å’Œ RR ï¼ˆInnoDB å­˜å‚¨å¼•æ“çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼‰ä¸‹ï¼ŒInnoDB å­˜å‚¨å¼•æ“ä½¿ç”¨ MVCCï¼ˆéé”å®šä¸€è‡´æ€§è¯»ï¼‰ï¼Œä½†å®ƒä»¬ç”Ÿæˆ Read View çš„æ—¶æœºå´ä¸åŒ ã€RCï¼šRead Commit è¯»å·²æäº¤ï¼ŒRRï¼šRepeatable Read å¯é‡å¤è¯»ã€‘\nåœ¨ RC éš”ç¦»çº§åˆ«ä¸‹çš„ æ¯æ¬¡select æŸ¥è¯¢å‰éƒ½ç”Ÿæˆä¸€ä¸ªRead View (m_ids åˆ—è¡¨) åœ¨ RR éš”ç¦»çº§åˆ«ä¸‹åªåœ¨äº‹åŠ¡å¼€å§‹å ç¬¬ä¸€æ¬¡select æ•°æ®å‰ç”Ÿæˆä¸€ä¸ªRead Viewï¼ˆm_ids åˆ—è¡¨ï¼‰ MVCCè§£å†³ä¸å¯é‡å¤è¯»é—®é¢˜ # è™½ç„¶ RC å’Œ RR éƒ½é€šè¿‡ MVCC æ¥è¯»å–å¿«ç…§æ•°æ®ï¼Œä½†ç”±äº ç”Ÿæˆ Read View æ—¶æœºä¸åŒï¼Œä»è€Œåœ¨ RR çº§åˆ«ä¸‹å®ç°å¯é‡å¤è¯»\nä¸¾ä¾‹ï¼š ï¼ˆTn è¡¨ç¤ºæ—¶é—´çº¿ï¼‰\nåœ¨RCä¸‹ReadViewç”Ÿæˆæƒ…å†µ # 1. å‡è®¾æ—¶é—´çº¿æ¥åˆ° T4 ï¼Œé‚£ä¹ˆæ­¤æ—¶æ•°æ®è¡Œ id = 1 çš„ç‰ˆæœ¬é“¾ä¸ºï¼š\nç”±äº RC çº§åˆ«ä¸‹æ¯æ¬¡æŸ¥è¯¢éƒ½ä¼šç”ŸæˆRead View ï¼Œå¹¶ä¸”äº‹åŠ¡ 101ã€102 å¹¶æœªæäº¤ï¼Œæ­¤æ—¶ 103 äº‹åŠ¡ç”Ÿæˆçš„ Read View ä¸­æ´»è·ƒçš„äº‹åŠ¡ m_ids ä¸ºï¼š[101,102] ï¼Œm_low_limit_idä¸ºï¼š104ï¼Œm_up_limit_idä¸ºï¼š101ï¼Œm_creator_trx_id ä¸ºï¼š103\næ­¤æ—¶æœ€æ–°è®°å½•çš„ DB_TRX_ID ä¸º 101ï¼Œm_up_limit_id \u0026lt;= 101 \u0026lt; m_low_limit_idï¼Œæ‰€ä»¥è¦åœ¨ m_ids åˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼Œå‘ç° DB_TRX_ID å­˜åœ¨åˆ—è¡¨ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªè®°å½•ä¸å¯è§ æ ¹æ® DB_ROLL_PTR æ‰¾åˆ° undo log ä¸­çš„ä¸Šä¸€ç‰ˆæœ¬è®°å½•ï¼Œä¸Šä¸€æ¡è®°å½•çš„ DB_TRX_ID è¿˜æ˜¯ 101ï¼Œä¸å¯è§ ç»§ç»­æ‰¾ä¸Šä¸€æ¡ DB_TRX_IDä¸º 1ï¼Œæ»¡è¶³ 1 \u0026lt; m_up_limit_idï¼Œå¯è§ï¼Œæ‰€ä»¥äº‹åŠ¡ 103 æŸ¥è¯¢åˆ°æ•°æ®ä¸º name = èœèŠ± 2. æ—¶é—´çº¿æ¥åˆ° T6 ï¼Œæ•°æ®çš„ç‰ˆæœ¬é“¾ä¸ºï¼š\nå› ä¸ºåœ¨ RC çº§åˆ«ä¸‹ï¼Œé‡æ–°ç”Ÿæˆ Read Viewï¼Œè¿™æ—¶äº‹åŠ¡ 101 å·²ç»æäº¤ï¼Œ102 å¹¶æœªæäº¤ï¼Œæ‰€ä»¥æ­¤æ—¶ Read View ä¸­æ´»è·ƒçš„äº‹åŠ¡ m_idsï¼š[102] ï¼Œm_low_limit_idä¸ºï¼š104ï¼Œm_up_limit_idä¸ºï¼š102ï¼Œm_creator_trx_idä¸ºï¼š103\næ­¤æ—¶æœ€æ–°è®°å½•çš„ DB_TRX_ID ä¸º 102ï¼Œm_up_limit_id \u0026lt;= 102 \u0026lt; m_low_limit_idï¼Œæ‰€ä»¥è¦åœ¨ m_ids åˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼Œå‘ç° DB_TRX_ID å­˜åœ¨åˆ—è¡¨ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªè®°å½•ä¸å¯è§ æ ¹æ® DB_ROLL_PTR æ‰¾åˆ° undo log ä¸­çš„ä¸Šä¸€ç‰ˆæœ¬è®°å½•ï¼Œä¸Šä¸€æ¡è®°å½•çš„ DB_TRX_ID ä¸º 101ï¼Œæ»¡è¶³ 101 \u0026lt; m_up_limit_idï¼Œè®°å½•å¯è§ï¼Œæ‰€ä»¥åœ¨ T6 æ—¶é—´ç‚¹æŸ¥è¯¢åˆ°æ•°æ®ä¸º name = æå››ï¼Œä¸æ—¶é—´ T4 æŸ¥è¯¢åˆ°çš„ç»“æœä¸ä¸€è‡´ï¼Œä¸å¯é‡å¤è¯»ï¼ 3. æ—¶é—´çº¿æ¥åˆ° T9 ï¼Œæ•°æ®çš„ç‰ˆæœ¬é“¾ä¸ºï¼š\né‡æ–°ç”Ÿæˆ Read Viewï¼Œ è¿™æ—¶äº‹åŠ¡ 101 å’Œ 102 éƒ½å·²ç»æäº¤ï¼Œæ‰€ä»¥ m_ids ä¸ºç©ºï¼Œåˆ™ m_up_limit_id = m_low_limit_id = 104ï¼Œæœ€æ–°ç‰ˆæœ¬äº‹åŠ¡ ID ä¸º 102ï¼Œæ»¡è¶³ 102 \u0026lt; m_low_limit_idï¼Œå¯è§ï¼ŒæŸ¥è¯¢ç»“æœä¸º name = èµµå…­\næ€»ç»“ï¼š åœ¨ RC éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡åœ¨æ¯æ¬¡æŸ¥è¯¢å¼€å§‹æ—¶éƒ½ä¼šç”Ÿæˆå¹¶è®¾ç½®æ–°çš„ Read Viewï¼Œæ‰€ä»¥å¯¼è‡´ä¸å¯é‡å¤è¯»\nåœ¨RRä¸‹ReadViewç”Ÿæˆæƒ…å†µ # åœ¨å¯é‡å¤è¯»çº§åˆ«ä¸‹ï¼Œåªä¼šåœ¨äº‹åŠ¡å¼€å§‹åç¬¬ä¸€æ¬¡è¯»å–æ•°æ®æ—¶ç”Ÿæˆä¸€ä¸ª Read Viewï¼ˆm_ids åˆ—è¡¨ï¼‰\n1. åœ¨ T4 æƒ…å†µä¸‹çš„ç‰ˆæœ¬é“¾ä¸ºï¼š\nåœ¨å½“å‰æ‰§è¡Œ select è¯­å¥æ—¶ç”Ÿæˆä¸€ä¸ª Read Viewï¼Œæ­¤æ—¶ m_idsï¼š[101,102] ï¼Œm_low_limit_idä¸ºï¼š104ï¼Œm_up_limit_idä¸ºï¼š101ï¼Œm_creator_trx_id ä¸ºï¼š103\næ­¤æ—¶å’Œ RC çº§åˆ«ä¸‹ä¸€æ ·ï¼š\næœ€æ–°è®°å½•çš„ DB_TRX_ID ä¸º 101ï¼Œm_up_limit_id \u0026lt;= 101 \u0026lt; m_low_limit_idï¼Œæ‰€ä»¥è¦åœ¨ m_ids åˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼Œå‘ç° DB_TRX_ID å­˜åœ¨åˆ—è¡¨ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªè®°å½•ä¸å¯è§ æ ¹æ® DB_ROLL_PTR æ‰¾åˆ° undo log ä¸­çš„ä¸Šä¸€ç‰ˆæœ¬è®°å½•ï¼Œä¸Šä¸€æ¡è®°å½•çš„ DB_TRX_ID è¿˜æ˜¯ 101ï¼Œä¸å¯è§ ç»§ç»­æ‰¾ä¸Šä¸€æ¡ DB_TRX_IDä¸º 1ï¼Œæ»¡è¶³ 1 \u0026lt; m_up_limit_idï¼Œå¯è§ï¼Œæ‰€ä»¥äº‹åŠ¡ 103 æŸ¥è¯¢åˆ°æ•°æ®ä¸º name = èœèŠ± 2. æ—¶é—´ç‚¹ T6 æƒ…å†µä¸‹ï¼š\nåœ¨ RR çº§åˆ«ä¸‹åªä¼šç”Ÿæˆä¸€æ¬¡Read Viewï¼Œæ‰€ä»¥æ­¤æ—¶ä¾ç„¶æ²¿ç”¨ m_ids ï¼š[101,102] ï¼Œm_low_limit_idä¸ºï¼š104ï¼Œm_up_limit_idä¸ºï¼š101ï¼Œm_creator_trx_id ä¸ºï¼š103\næœ€æ–°è®°å½•çš„ DB_TRX_ID ä¸º 102ï¼Œm_up_limit_id \u0026lt;= 102 \u0026lt; m_low_limit_idï¼Œæ‰€ä»¥è¦åœ¨ m_ids åˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼Œå‘ç° DB_TRX_ID å­˜åœ¨åˆ—è¡¨ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªè®°å½•ä¸å¯è§ æ ¹æ® DB_ROLL_PTR æ‰¾åˆ° undo log ä¸­çš„ä¸Šä¸€ç‰ˆæœ¬è®°å½•ï¼Œä¸Šä¸€æ¡è®°å½•çš„ DB_TRX_ID ä¸º 101ï¼Œä¸å¯è§ ã€ä»è¿™æ­¥å¼€å§‹å°±è·ŸT4ä¸€æ ·äº†ã€‘ ç»§ç»­æ ¹æ® DB_ROLL_PTR æ‰¾åˆ° undo log ä¸­çš„ä¸Šä¸€ç‰ˆæœ¬è®°å½•ï¼Œä¸Šä¸€æ¡è®°å½•çš„ DB_TRX_ID è¿˜æ˜¯ 101ï¼Œä¸å¯è§ ç»§ç»­æ‰¾ä¸Šä¸€æ¡ DB_TRX_IDä¸º 1ï¼Œæ»¡è¶³ 1 \u0026lt; m_up_limit_idï¼Œå¯è§ï¼Œæ‰€ä»¥äº‹åŠ¡ 103 æŸ¥è¯¢åˆ°æ•°æ®ä¸º name = èœèŠ± 3. æ—¶é—´ç‚¹ T9 æƒ…å†µä¸‹ï¼š\næ­¤æ—¶æƒ…å†µè·Ÿ T6 å®Œå…¨ä¸€æ ·ï¼Œç”±äºå·²ç»ç”Ÿæˆäº† Read Viewï¼Œæ­¤æ—¶ä¾ç„¶æ²¿ç”¨ m_ids ï¼š[101,102] ï¼Œæ‰€ä»¥æŸ¥è¯¢ç»“æœä¾ç„¶æ˜¯ name = èœèŠ±\nMVCC+Next-key -Locké˜²æ­¢å¹»è¯» # InnoDBå­˜å‚¨å¼•æ“åœ¨ RR çº§åˆ«ä¸‹é€šè¿‡ MVCCå’Œ Next-key Lock æ¥è§£å†³å¹»è¯»é—®é¢˜ï¼š\n1ã€æ‰§è¡Œæ™®é€š selectï¼Œæ­¤æ—¶ä¼šä»¥ MVCC å¿«ç…§è¯»çš„æ–¹å¼è¯»å–æ•°æ®\nåœ¨å¿«ç…§è¯»çš„æƒ…å†µä¸‹ï¼ŒRR éš”ç¦»çº§åˆ«åªä¼šåœ¨äº‹åŠ¡å¼€å¯åçš„ç¬¬ä¸€æ¬¡æŸ¥è¯¢ç”Ÿæˆ Read View ï¼Œå¹¶ä½¿ç”¨è‡³äº‹åŠ¡æäº¤ã€‚æ‰€ä»¥åœ¨ç”Ÿæˆ Read View ä¹‹åå…¶å®ƒäº‹åŠ¡æ‰€åšçš„æ›´æ–°ã€æ’å…¥è®°å½•ç‰ˆæœ¬å¯¹å½“å‰äº‹åŠ¡å¹¶ä¸å¯è§ï¼Œå®ç°äº†å¯é‡å¤è¯»å’Œé˜²æ­¢å¿«ç…§è¯»ä¸‹çš„ â€œå¹»è¯»â€\n2ã€æ‰§è¡Œ select\u0026hellip;for update/lock in share modeã€insertã€updateã€delete ç­‰å½“å‰è¯»\nåœ¨å½“å‰è¯»ä¸‹ï¼Œè¯»å–çš„éƒ½æ˜¯æœ€æ–°çš„æ•°æ®ï¼Œå¦‚æœå…¶å®ƒäº‹åŠ¡æœ‰æ’å…¥æ–°çš„è®°å½•ï¼Œå¹¶ä¸”åˆšå¥½åœ¨å½“å‰äº‹åŠ¡æŸ¥è¯¢èŒƒå›´å†…ï¼Œå°±ä¼šäº§ç”Ÿå¹»è¯»ï¼\nInnoDB ä½¿ç”¨ Next-key Lockopen in new window æ¥é˜²æ­¢è¿™ç§æƒ…å†µã€‚å½“æ‰§è¡Œå½“å‰è¯»æ—¶ï¼Œä¼šé”å®šè¯»å–åˆ°çš„è®°å½•çš„åŒæ—¶ï¼Œé”å®šå®ƒä»¬çš„é—´éš™ï¼Œé˜²æ­¢å…¶å®ƒäº‹åŠ¡åœ¨æŸ¥è¯¢èŒƒå›´å†…æ’å…¥æ•°æ®ã€‚åªè¦æˆ‘ä¸è®©ä½ æ’å…¥ï¼Œå°±ä¸ä¼šå‘ç”Ÿå¹»è¯»\nNext-Key* Lock(ä¸´é”®é”) æ˜¯Record Lock(è®°å½•é”) å’ŒGap Lock(é—´éš™é”) çš„ç»“åˆ é—´éš™é”æ˜¯(å·¦ï¼Œå³] ï¼Œå³å·¦å¼€å³é—­ã€‚ "},{"id":110,"href":"/zh/docs/study/Review/java_guide/database/MySQL/ly0603lytransaction-isolation-level/","title":"MySQLäº‹åŠ¡éš”ç¦»çº§åˆ«è¯¦è§£","section":"MySQL","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\näº‹åŠ¡éš”ç¦»çº§åˆ«æ€»ç»“ # SQLæ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«\nREAD-UNCOMMITTED(è¯»å–æœªæäº¤)ï¼šæœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯» READ-COMMITED(è¯»å–å·²æäº¤)ï¼šå…è®¸è¯»å–å¹¶å‘äº‹åŠ¡ å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ REPEATABLE-READ(å¯é‡å¤è¯»)ï¼šå¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œå¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ SERIALIZABLE(å¯ä¸²è¡ŒåŒ–)ï¼šæœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä»ACIDçš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»ã€‚ éš”ç¦»çº§åˆ« è„è¯» ä¸å¯é‡å¤è¯» å¹»è¯» READ-UNCOMMITTED âˆš âˆš âˆš READ-COMMITTED Ã— âˆš âˆš REPEATABLE-READ Ã— Ã— âˆš SERIALIZABLE Ã— Ã— Ã— MySQL InnoDB å­˜å‚¨å¼•æ“çš„é»˜è®¤æ”¯æŒçš„éš”ç¦»çº§åˆ«æ˜¯ REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰\nä½¿ç”¨å‘½ä»¤æŸ¥çœ‹ï¼Œé€šè¿‡SELECT @@tx_isolation;ã€‚\nMySQL 8.0 è¯¥å‘½ä»¤æ”¹ä¸ºSELECT @@transaction_isolation;\nMySQL\u0026gt; SELECT @@tx_isolation; +-----------------+ | @@tx_isolation | +-----------------+ | REPEATABLE-READ | +-----------------+ ä»ä¸Šé¢å¯¹SQLæ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«çš„ä»‹ç»å¯ä»¥çœ‹å‡ºï¼Œæ ‡å‡†çš„SQLéš”ç¦»çº§åˆ«é‡Œï¼ŒREPEATABLE-READ(å¯é‡å¤è¯»)æ˜¯ä¸å¯ä»¥é˜²æ­¢å¹»è¯»çš„ã€‚ä½†æ˜¯ï¼ŒInnoDBå®ç°çš„REPEATABLE-READ éš”ç¦»çº§åˆ«å…¶å®æ˜¯å¯ä»¥è§£å†³å¹»è¯»é—®é¢˜å‘ç”Ÿçš„ï¼Œåˆ†ä¸¤ç§æƒ…å†µ\nå¿«ç…§è¯»ï¼šç”±MVCCæœºåˆ¶æ¥ä¿è¯ä¸å‡ºç°å¹»è¯» å½“å‰è¯»ï¼šä½¿ç”¨Next-Key Lockè¿›è¡ŒåŠ é”æ¥ä¿è¯ä¸å‡ºç°å¹»è¯»ï¼ŒNext-Key Lockæ˜¯è¡Œé”ï¼ˆRecord Lock ï¼‰å’Œé—´éš™é”ï¼ˆGap Lockï¼‰çš„ç»“åˆï¼Œè¡Œé”åªèƒ½é”ä½å·²ç»å­˜åœ¨çš„è¡Œï¼Œä¸ºäº†é¿å…æ’å…¥æ–°è¡Œï¼Œéœ€è¦ä¾èµ–é—´éš™é” (åªç”¨é—´éš™é”ä¸è¡Œï¼Œå› ä¸ºé—´éš™é”æ˜¯ \u0026gt; æˆ– \u0026lt; ï¼Œä¸åŒ…æ‹¬ç­‰äºï¼Œæ‰€ä»¥å†å¯é‡å¤è¯»ä¸‹åŸè®°å½•å¯èƒ½ä¼šè¢«åˆ æ‰) å› ä¸ºéš”ç¦»çº§åˆ«è¶Šä½ï¼Œäº‹åŠ¡è¯·æ±‚çš„é”è¶Šå°‘ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ•°æ®åº“ç³»ç»Ÿçš„éš”ç¦»çº§åˆ«éƒ½æ˜¯ READ-COMMITTED ï¼Œä½†æ˜¯ä½ è¦çŸ¥é“çš„æ˜¯ InnoDB å­˜å‚¨å¼•æ“é»˜è®¤ä½¿ç”¨ REPEATABLE-READ å¹¶ä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½æŸå¤±ã€‚\nInnoDB å­˜å‚¨å¼•æ“åœ¨åˆ†å¸ƒå¼äº‹åŠ¡çš„æƒ…å†µä¸‹ä¸€èˆ¬ä¼šç”¨åˆ° SERIALIZABLE éš”ç¦»çº§åˆ«\nInnoDB å­˜å‚¨å¼•æ“æä¾›äº†å¯¹ XA äº‹åŠ¡çš„æ”¯æŒï¼Œå¹¶é€šè¿‡ XA äº‹åŠ¡æ¥æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°ã€‚ åˆ†å¸ƒå¼äº‹åŠ¡æŒ‡çš„æ˜¯å…è®¸å¤šä¸ªç‹¬ç«‹çš„äº‹åŠ¡èµ„æºï¼ˆtransactional resourcesï¼‰å‚ä¸åˆ°ä¸€ä¸ªå…¨å±€çš„äº‹åŠ¡ä¸­ã€‚äº‹åŠ¡èµ„æºé€šå¸¸æ˜¯å…³ç³»å‹æ•°æ®åº“ç³»ç»Ÿï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ç±»å‹çš„èµ„æºã€‚å…¨å±€äº‹åŠ¡è¦æ±‚åœ¨å…¶ä¸­çš„æ‰€æœ‰å‚ä¸çš„äº‹åŠ¡è¦ä¹ˆéƒ½æäº¤ï¼Œè¦ä¹ˆéƒ½å›æ»šï¼Œè¿™å¯¹äºäº‹åŠ¡åŸæœ‰çš„ ACID è¦æ±‚åˆæœ‰äº†æé«˜ã€‚ åœ¨ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ—¶ï¼ŒInnoDB å­˜å‚¨å¼•æ“çš„äº‹åŠ¡éš”ç¦»çº§åˆ«å¿…é¡»è®¾ç½®ä¸º SERIALIZABLEã€‚ å®é™…æƒ…å†µæ¼”ç¤º # ä¸‹é¢ä¼šä½¿ç”¨2ä¸ªå‘½ä»¤è¡ŒMySQLï¼Œæ¨¡æ‹Ÿå¤šçº¿ç¨‹ï¼ˆå¤šäº‹åŠ¡ï¼‰å¯¹åŒä¸€ä»½æ•°æ®çš„(è„è¯»ç­‰)é—®é¢˜\nMySQL å‘½ä»¤è¡Œçš„é»˜è®¤é…ç½®ä¸­äº‹åŠ¡éƒ½æ˜¯è‡ªåŠ¨æäº¤çš„ï¼Œå³æ‰§è¡Œ SQL è¯­å¥åå°±ä¼šé©¬ä¸Šæ‰§è¡Œ COMMIT æ“ä½œã€‚å¦‚æœè¦æ˜¾å¼åœ°å¼€å¯ä¸€ä¸ªäº‹åŠ¡éœ€è¦ä½¿ç”¨å‘½ä»¤ï¼šSTART TRANSACTION\né€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥è®¾ç½®éš”ç¦»çº§åˆ« session ï¼šæ›´æ”¹åªæœ‰æœ¬æ¬¡ä¼šè¯æœ‰æ•ˆï¼›globalï¼šæ›´æ”¹åœ¨æ‰€æœ‰ä¼šè¯éƒ½æœ‰æ•ˆï¼Œä¸”ä¸ä¼šå½±å“å·²å¼€å¯çš„session\nSET [SESSION|GLOBAL] TRANSACTION ISOLATION LEVEL [READ UNCOMMITTED|READ COMMITTED|REPEATABLE READ|SERIALIZABLE] å®é™…æ“ä½œä¸­ä½¿ç”¨åˆ°çš„ä¸€äº›å¹¶å‘æ§åˆ¶çš„è¯­å¥\nSTART TRANSACTION | BEGINï¼šæ˜¾ç¤ºåœ°å¼€å¯ä¸€ä¸ªäº‹åŠ¡ ï¼ˆbeginä¹Ÿèƒ½å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼‰ COMMITï¼šæäº¤äº‹åŠ¡ï¼Œä½¿å¾—å¯¹æ•°æ®åº“åšçš„æ‰€æœ‰ä¿®æ”¹æˆä¸ºæ°¸ä¹…æ€§ ROLLBACKï¼šå›æ»šï¼Œä¼šç»“æŸç”¨æˆ·çš„äº‹åŠ¡ï¼Œå¹¶æ’¤é”€æ­£åœ¨è¿›è¡Œçš„æ‰€æœ‰æœªæäº¤çš„ä¿®æ”¹ è„è¯»ï¼ˆè¯»æœªæäº¤ï¼‰ # äº‹åŠ¡1 è®¾ç½®ä¸ºè¯»æœªæäº¤çº§åˆ« SET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;\näº‹åŠ¡1å¼€å¯äº‹åŠ¡å¹¶æŸ¥çœ‹æ•°æ®\nSTART TRANSACTION; SELECT salary FROM employ WHERE id = 1; # ç»“æœ +--------+ | salary | +--------+ | 5000 | +--------+ å¼€å¯æ–°è¿æ¥ï¼Œäº‹åŠ¡2 å¼€å¯äº‹åŠ¡å¹¶æ›´æ–°æ•°æ®\nSTART TRANSACTION; UPDATE employ SET salary = 4500 ; äº‹åŠ¡1æŸ¥çœ‹ SELECT salary FROM employ WHERE id = 1;\n+--------+ | salary | +--------+ | 4500 | +--------+ æ­¤æ—¶äº‹åŠ¡2 è¿›è¡Œå›æ»š ROLLBACK; ä½¿ç”¨äº‹åŠ¡1å†æ¬¡æŸ¥çœ‹ SELECT salary FROM employ WHERE id = 1;\n+--------+ | salary | +--------+ | 5000 | +--------+ äº‹åŠ¡äºŒè¿›è¡Œäº†å›æ»šï¼Œä½†æ˜¯ä¹‹å‰äº‹åŠ¡1å´è¯»å–åˆ°äº†4500ï¼ˆæ˜¯ä¸ªè„æ•°æ®ï¼‰\né¿å…è„è¯»ï¼ˆè¯»å·²æäº¤ï¼‰ # ä¸è¦åœ¨ä¸Šé¢çš„è¿æ¥é‡Œç»§ç»­\näº‹åŠ¡1 è®¾ç½®ä¸ºè¯»å·²æäº¤SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;\näº‹åŠ¡1 å¼€å¯äº‹åŠ¡å¹¶æŸ¥è¯¢æ•°æ®\nSTART TRANSACTION; SELECT salary FROM employ WHERE id = 1; # ç»“æœ +--------+ | salary | +--------+ | 5000 | +--------+ äº‹åŠ¡2 å¼€å¯å¹¶ä¿®æ”¹æ•°æ®(æœªæäº¤)\nSTART TRANSACTION; UPDATE employ SET salary = 4500 ; äº‹åŠ¡1æŸ¥çœ‹æ•°æ® SELECT salary FROM employ WHERE id = 1; å› ä¸ºäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºè¯»å·²æäº¤ï¼Œæ‰€ä»¥ä¸ä¼šå‘ç”Ÿè„è¯»\n# ç»“æœ +--------+ | salary | +--------+ | 5000 | +--------+ äº‹åŠ¡2æäº¤ COMMIT;åï¼Œäº‹åŠ¡1å†æ¬¡è¯»å–æ•°æ®\nSELECT salary FROM employ WHERE id = 1; +--------+ | salary | +--------+ | 4500 | +--------+ ä¸å¯é‡å¤è¯» # è¿˜æ˜¯åˆšæ‰è¯»å·²æäº¤çš„é‚£äº›æ­¥éª¤ï¼Œé‡å¤æ“ä½œå¯ä»¥çŸ¥é“ è™½ç„¶é¿å…äº†è¯»æœªæäº¤ï¼Œä½†æ˜¯å‡ºç°äº†ï¼Œä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡ç»“æŸï¼Œå°±å‘ç”Ÿäº†ä¸å¯é‡å¤è¯»é—®é¢˜\nåŒä¸€ä¸ªæ•°æ®ï¼Œåœ¨åŒä¸€äº‹åŠ¡å†…è¯»å–å¤šæ¬¡ä½†å€¼ä¸ä¸€æ ·\nå¯é‡å¤è¯» # æ–­å¼€è¿æ¥åé‡æ–°è¿æ¥MySQLï¼Œé»˜è®¤å°±æ˜¯REPEATABLE-READ å¯é‡å¤è¯»\näº‹åŠ¡1æŸ¥çœ‹å½“å‰äº‹åŠ¡éš”ç¦»çº§åˆ« select @@tx_isolation;\n+-----------------+ | @@tx_isolation | +-----------------+ | REPEATABLE-READ | +-----------------+ äº‹åŠ¡1 å¼€å¯äº‹åŠ¡å¹¶æŸ¥è¯¢æ•°æ®\nSTART TRANSACTION; SELECT salary FROM employ WHERE id = 1; # ç»“æœ +--------+ | salary | +--------+ | 5000 | +--------+ äº‹åŠ¡2 å¼€å¯äº‹åŠ¡å¹¶æ›´æ–°æ•°æ®\nSTART TRANSACTION; UPDATE employ SET salary = 4500 WHERE id = 1; äº‹åŠ¡1 è¯»å–æ•°æ®ï¼ˆç»“æœä»ä¸å˜ï¼Œé¿å…äº†è¯»æœªæäº¤çš„é—®é¢˜ï¼‰\nSELECT salary FROM employ WHERE id = 1; +--------+ | salary | +--------+ | 5000 | +--------+ äº‹åŠ¡2æäº¤äº‹åŠ¡ COMMIT ;\næäº¤åäº‹åŠ¡1å†æ¬¡è¯»å–\nSELECT salary FROM employ WHERE id = 1; +--------+ | salary | +--------+ | 5000 | +--------+ ä¸MySQLå»ºç«‹æ–°è¿æ¥å¹¶æŸ¥è¯¢æ•°æ®ï¼ˆå‘ç°æ•°æ®ç¡®å®æ˜¯å·²ç»æ›´æ–°äº†çš„ï¼‰\nSELECT salary FROM employ WHERE id = 1; +--------+ | salary | +--------+ | 4500 | +--------+ å¹»è¯» # æ¥ä¸‹æ¥æµ‹è¯•ä¸€ä¸‹è¯¥éš”ç¦»ç­–ç•¥ä¸‹æ˜¯å¦å¹»è¯» è¿™é‡Œæ˜¯åœ¨å¯é‡å¤è¯»ä¸‹\nå…ˆæŸ¥çœ‹ä¸€ä¸‹å½“å‰æ•°æ®åº“è¡¨çš„æ•°æ®\nSELECT * FROM test; +----+--------+ | id | salary | +----+--------+ | 1 | 8000 | | 6 | 500 | +----+--------+ use lydb; \u0026mdash;\u0026gt; äº‹åŠ¡1å’Œäº‹åŠ¡2éƒ½å¼€å¯äº‹åŠ¡ START TRANSACTION;\näº‹åŠ¡2æ’å…¥ä¸€æ¡è–ªèµ„ä¸º500çš„æ•°æ®å¹¶æäº¤\nINSERT INTO test(salary) values (500); COMMIT; #æ­¤æ—¶æ•°æ®åº“å·²ç»æœ‰ä¸¤æ¡500çš„æ•°æ®äº†(äº‹åŠ¡2) select * from test; +----+--------+ | id | salary | +----+--------+ | 1 | 8000 | | 6 | 500 | | 10 | 500 | +----+--------+ äº‹åŠ¡1æŸ¥è¯¢500çš„æ•°æ®(â˜…â˜…å¦‚æœåœ¨äº‹åŠ¡2æäº¤ä¹‹å‰æŸ¥è¯¢ SELECT * FROM test WHERE salary = 500; æˆ–è€… SELECT * FROM test; é‚£ä¹ˆè¿™é‡Œ[å¿«ç…§è¯»]å°±åªä¼šæŸ¥å‡ºä¸€æ¡ï¼Œä½†æ˜¯ä¸ç®¡æ€ä¹ˆæ · [å½“å‰è¯»]éƒ½ä¼šæŸ¥å‡ºä¸¤æ¡)\n#---------------- # å¿«ç…§è¯»------------------ SELECT * FROM test WHERE salary = 500; +----+--------+ | id | salary | +----+--------+ | 6 | 500 | +----+--------+ #----------------# å½“å‰è¯»------------------ SELECT * FROM test WHERE salary = 500 FOR UPDATE; +----+--------+ | id | salary | +----+--------+ | 6 | 500 | | 11 | 500 | +----+--------+ SQL äº‹åŠ¡1 åœ¨ç¬¬ä¸€æ¬¡æŸ¥è¯¢å·¥èµ„ä¸º 500 çš„è®°å½•æ—¶åªæœ‰ä¸€æ¡ï¼ŒSQL äº‹åŠ¡2 æ’å…¥äº†ä¸€æ¡å·¥èµ„ä¸º 500 çš„è®°å½•ï¼Œæäº¤ä¹‹åï¼›SQL äº‹åŠ¡1 åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­å†æ¬¡ä½¿ç”¨å½“å‰è¯»æŸ¥è¯¢å‘ç°å‡ºç°äº†ä¸¤æ¡å·¥èµ„ä¸º 500 çš„è®°å½•è¿™ç§å°±æ˜¯å¹»è¯»ã€‚\nè¿™é‡Œè¯´æ˜ä¸€ä¸‹å½“å‰è¯»å’Œå¿«ç…§è¯»ï¼š\nMySQL é‡Œé™¤äº†æ™®é€šæŸ¥è¯¢æ˜¯å¿«ç…§è¯»ï¼Œå…¶ä»–éƒ½æ˜¯å½“å‰è¯»ï¼Œæ¯”å¦‚ updateã€insertã€deleteï¼Œè¿™äº›è¯­å¥æ‰§è¡Œå‰éƒ½ä¼šæŸ¥è¯¢æœ€æ–°ç‰ˆæœ¬çš„æ•°æ®ï¼Œç„¶åå†åšè¿›ä¸€æ­¥çš„æ“ä½œ ã€ä¸ºä»€ä¹ˆä¸Šé¢è¦å…ˆè¿›è¡ŒæŸ¥è¯¢çš„åŸå› ã€‘å¯é‡å¤è¯»éš”ç¦»çº§æ˜¯ç”± MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰å®ç°çš„ï¼Œå®ç°çš„æ–¹å¼æ˜¯å¼€å§‹äº‹åŠ¡åï¼ˆæ‰§è¡Œ begin è¯­å¥åï¼‰ï¼Œåœ¨æ‰§è¡Œç¬¬ä¸€ä¸ªæŸ¥è¯¢è¯­å¥åï¼Œä¼šåˆ›å»ºä¸€ä¸ª Read Viewï¼Œåç»­çš„æŸ¥è¯¢è¯­å¥åˆ©ç”¨è¿™ä¸ª Read Viewï¼Œé€šè¿‡è¿™ä¸ª Read View å°±å¯ä»¥åœ¨ undo log ç‰ˆæœ¬é“¾æ‰¾åˆ°äº‹åŠ¡å¼€å§‹æ—¶çš„æ•°æ®ï¼Œæ‰€ä»¥äº‹åŠ¡è¿‡ç¨‹ä¸­æ¯æ¬¡æŸ¥è¯¢çš„æ•°æ®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå³ä½¿ä¸­é€”æœ‰å…¶ä»–äº‹åŠ¡æ’å…¥äº†æ–°çºªå½•ï¼Œæ˜¯æŸ¥è¯¢ä¸å‡ºæ¥è¿™æ¡æ•°æ®çš„ï¼Œæ‰€ä»¥å°±å¾ˆå¥½äº†é¿å…å¹»è¯»é—®é¢˜ã€‚ è§£å†³å¹»è¯»çš„æ–¹æ³• # è§£å†³å¹»è¯»çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œä½†æ˜¯å®ƒä»¬çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡åœ¨æ“ä½œæŸå¼ è¡¨æ•°æ®çš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¸å…è®¸æ–°å¢æˆ–è€…åˆ é™¤è¿™å¼ è¡¨ä¸­çš„æ•°æ®äº†ã€‚è§£å†³å¹»è¯»çš„æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼šï¼ˆç”±é‡åˆ°è½»ï¼‰\nå°†äº‹åŠ¡éš”ç¦»çº§åˆ«è°ƒæ•´ä¸º SERIALIZABLE ã€‚ åœ¨å¯é‡å¤è¯»çš„äº‹åŠ¡çº§åˆ«ä¸‹ï¼Œç»™äº‹åŠ¡æ“ä½œçš„è¿™å¼ è¡¨æ·»åŠ è¡¨é”ã€‚ åœ¨å¯é‡å¤è¯»çš„äº‹åŠ¡çº§åˆ«ä¸‹ï¼Œç»™äº‹åŠ¡æ“ä½œçš„è¿™å¼ è¡¨æ·»åŠ  Next-key Lockï¼ˆRecord Lock+Gap Lockï¼‰ã€‚ "},{"id":111,"href":"/zh/docs/study/Review/java_guide/database/MySQL/ly0602lymysql-logs/","title":"æ—¥å¿—","section":"MySQL","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nå‰è¨€ # é¦–å…ˆè¦äº†è§£ä¸€ä¸ªä¸œè¥¿ ï¼šWALï¼Œå…¨ç§° Write-Ahead Loggingï¼Œå®ƒçš„å…³é”®ç‚¹å°±æ˜¯å…ˆå†™æ—¥å¿—ï¼Œå†å†™ç£ç›˜\nåœ¨æ¦‚å¿µä¸Šï¼Œinnodbé€šè¿‡***force log at commit***æœºåˆ¶å®ç°äº‹åŠ¡çš„æŒä¹…æ€§ï¼Œå³åœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå¿…é¡»å…ˆå°†è¯¥äº‹åŠ¡çš„æ‰€æœ‰äº‹åŠ¡æ—¥å¿—å†™å…¥åˆ°ç£ç›˜ä¸Šçš„redo log fileå’Œundo log fileä¸­è¿›è¡ŒæŒä¹…åŒ–\nWAL æœºåˆ¶çš„åŸç†ä¹Ÿå¾ˆç®€å•ï¼šä¿®æ”¹å¹¶ä¸ç›´æ¥å†™å…¥åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯å†™å…¥åˆ°å¦å¤–ä¸€ä¸ªç§°ä¸º WAL çš„æ–‡ä»¶ä¸­ï¼›å¦‚æœäº‹åŠ¡å¤±è´¥ï¼ŒWAL ä¸­çš„è®°å½•ä¼šè¢«å¿½ç•¥ï¼Œæ’¤é”€ä¿®æ”¹ï¼›å¦‚æœäº‹åŠ¡æˆåŠŸï¼Œå®ƒå°†åœ¨éšåçš„æŸä¸ªæ—¶é—´è¢«å†™å›åˆ°æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œæäº¤ä¿®æ”¹\nä½¿ç”¨ WAL çš„æ•°æ®åº“ç³»ç»Ÿä¸ä¼šå†æ¯æ–°å¢ä¸€æ¡ WAL æ—¥å¿—å°±å°†å…¶åˆ·å…¥æ•°æ®åº“æ–‡ä»¶ä¸­ï¼Œä¸€èˆ¬ç§¯ç´¯ä¸€å®šçš„é‡ç„¶åæ‰¹é‡å†™å…¥ï¼Œé€šå¸¸ä½¿ç”¨é¡µä¸ºå•ä½ï¼Œè¿™æ˜¯ç£ç›˜çš„å†™å…¥å•ä½ã€‚ åŒæ­¥ WAL æ–‡ä»¶å’Œæ•°æ®åº“æ–‡ä»¶çš„è¡Œä¸ºè¢«ç§°ä¸º checkpointï¼ˆæ£€æŸ¥ç‚¹ï¼‰ï¼Œä¸€èˆ¬åœ¨ WAL æ–‡ä»¶ç§¯ç´¯åˆ°ä¸€å®šé¡µæ•°ä¿®æ”¹çš„æ—¶å€™ï¼›å½“ç„¶ï¼Œæœ‰äº›ç³»ç»Ÿä¹Ÿå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œ checkpointã€‚æ‰§è¡Œ checkpoint ä¹‹åï¼ŒWAL æ–‡ä»¶å¯ä»¥è¢«æ¸…ç©ºï¼Œè¿™æ ·å¯ä»¥ä¿è¯ WAL æ–‡ä»¶ä¸ä¼šå› ä¸ºå¤ªå¤§è€Œæ€§èƒ½ä¸‹é™ã€‚\næœ‰äº›æ•°æ®åº“ç³»ç»Ÿè¯»å–è¯·æ±‚ä¹Ÿå¯ä»¥ä½¿ç”¨ WALï¼Œé€šè¿‡è¯»å– WAL æœ€æ–°æ—¥å¿—å°±å¯ä»¥è·å–åˆ°æ•°æ®çš„æœ€æ–°çŠ¶æ€\nå…³äºcheckpointï¼šhttps://www.cnblogs.com/chenpingzhao/p/5107480.htmlæ€è€ƒä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼šå¦‚æœé‡åšæ—¥å¿—å¯ä»¥æ— é™åœ°å¢å¤§ï¼ŒåŒæ—¶ç¼“å†²æ± ä¹Ÿè¶³å¤Ÿå¤§ ï¼Œé‚£ä¹ˆæ˜¯ä¸éœ€è¦å°†ç¼“å†²æ± ä¸­é¡µçš„æ–°ç‰ˆæœ¬åˆ·æ–°å›ç£ç›˜ã€‚å› ä¸ºå½“å‘ç”Ÿå®•æœºæ—¶ï¼Œå®Œå…¨å¯ä»¥é€šè¿‡é‡åšæ—¥å¿—æ¥æ¢å¤æ•´ä¸ªæ•°æ®åº“ç³»ç»Ÿä¸­çš„æ•°æ®åˆ°å®•æœºå‘ç”Ÿçš„æ—¶åˆ»ã€‚ä½†æ˜¯è¿™éœ€è¦ä¸¤ä¸ªå‰ææ¡ä»¶ï¼š1ã€ç¼“å†²æ± å¯ä»¥ç¼“å­˜æ•°æ®åº“ä¸­æ‰€æœ‰çš„æ•°æ®ï¼›2ã€é‡åšæ—¥å¿—å¯ä»¥æ— é™å¢å¤§\nå› æ­¤Checkpointï¼ˆæ£€æŸ¥ç‚¹ï¼‰æŠ€æœ¯å°±è¯ç”Ÿäº†ï¼Œç›®çš„æ˜¯è§£å†³ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š1ã€ç¼©çŸ­æ•°æ®åº“çš„æ¢å¤æ—¶é—´ï¼›2ã€ç¼“å†²æ± ä¸å¤Ÿç”¨æ—¶ï¼Œå°†è„é¡µåˆ·æ–°åˆ°ç£ç›˜ï¼›3ã€é‡åšæ—¥å¿—ä¸å¯ç”¨æ—¶ï¼Œåˆ·æ–°è„é¡µã€‚\nå½“æ•°æ®åº“å‘ç”Ÿå®•æœºæ—¶ï¼Œæ•°æ®åº“ä¸éœ€è¦é‡åšæ‰€æœ‰çš„æ—¥å¿—ï¼Œå› ä¸ºCheckpointä¹‹å‰çš„é¡µéƒ½å·²ç»åˆ·æ–°å›ç£ç›˜ã€‚æ•°æ®åº“åªéœ€å¯¹Checkpointåçš„é‡åšæ—¥å¿—è¿›è¡Œæ¢å¤ï¼Œè¿™æ ·å°±å¤§å¤§ç¼©çŸ­äº†æ¢å¤çš„æ—¶é—´ã€‚ å½“ç¼“å†²æ± ä¸å¤Ÿç”¨æ—¶ï¼Œæ ¹æ®LRUç®—æ³•ä¼šæº¢å‡ºæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é¡µï¼Œè‹¥æ­¤é¡µä¸ºè„é¡µï¼Œé‚£ä¹ˆéœ€è¦å¼ºåˆ¶æ‰§è¡ŒCheckpointï¼Œå°†è„é¡µä¹Ÿå°±æ˜¯é¡µçš„æ–°ç‰ˆæœ¬åˆ·å›ç£ç›˜ã€‚ å½“é‡åšæ—¥å¿—å‡ºç°ä¸å¯ç”¨æ—¶ï¼Œå› ä¸ºå½“å‰äº‹åŠ¡æ•°æ®åº“ç³»ç»Ÿå¯¹é‡åšæ—¥å¿—çš„è®¾è®¡éƒ½æ˜¯å¾ªç¯ä½¿ç”¨çš„ï¼Œå¹¶ä¸æ˜¯è®©å…¶æ— é™å¢å¤§çš„ï¼Œé‡åšæ—¥å¿—å¯ä»¥è¢«é‡ç”¨çš„éƒ¨åˆ†æ˜¯æŒ‡è¿™äº›é‡åšæ—¥å¿—å·²ç»ä¸å†éœ€è¦ï¼Œå½“æ•°æ®åº“å‘ç”Ÿå®•æœºæ—¶ï¼Œæ•°æ®åº“æ¢å¤æ“ä½œä¸éœ€è¦è¿™éƒ¨åˆ†çš„é‡åšæ—¥å¿—ï¼Œå› æ­¤è¿™éƒ¨åˆ†å°±å¯ä»¥è¢«è¦†ç›–é‡ç”¨ã€‚å¦‚æœé‡åšæ—¥å¿—è¿˜éœ€è¦ä½¿ç”¨ï¼Œé‚£ä¹ˆå¿…é¡»å¼ºåˆ¶Checkpointï¼Œå°†ç¼“å†²æ± ä¸­çš„é¡µè‡³å°‘åˆ·æ–°åˆ°å½“å‰é‡åšæ—¥å¿—çš„ä½ç½®ã€‚ mysql çš„ WALï¼Œå¤§å®¶å¯èƒ½éƒ½æ¯”è¾ƒç†Ÿæ‚‰ã€‚mysql é€šè¿‡ redoã€undo æ—¥å¿—å®ç° WALã€‚redo log ç§°ä¸ºé‡åšæ—¥å¿—ï¼Œæ¯å½“æœ‰æ“ä½œæ—¶ï¼Œåœ¨æ•°æ®å˜æ›´ä¹‹å‰å°†æ“ä½œå†™å…¥ redo logï¼Œè¿™æ ·å½“å‘ç”Ÿæ‰ç”µä¹‹ç±»çš„æƒ…å†µæ—¶ç³»ç»Ÿå¯ä»¥åœ¨é‡å¯åç»§ç»­æ“ä½œã€‚undo log ç§°ä¸ºæ’¤é”€æ—¥å¿—ï¼Œå½“ä¸€äº›å˜æ›´æ‰§è¡Œåˆ°ä¸€åŠæ— æ³•å®Œæˆæ—¶ï¼Œå¯ä»¥æ ¹æ®æ’¤é”€æ—¥å¿—æ¢å¤åˆ°å˜æ›´ä¹‹é—´çš„çŠ¶æ€ã€‚mysql ä¸­ç”¨ redo log æ¥åœ¨ç³»ç»Ÿ Crash é‡å¯ä¹‹ç±»çš„æƒ…å†µæ—¶ä¿®å¤æ•°æ®ï¼ˆäº‹åŠ¡çš„æŒä¹…æ€§ï¼‰ï¼Œè€Œ undo log æ¥ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ã€‚\nMySQL æ—¥å¿— ä¸»è¦åŒ…æ‹¬é”™è¯¯æ—¥å¿—ã€æŸ¥è¯¢æ—¥å¿—ã€æ…¢æŸ¥è¯¢æ—¥å¿—ã€äº‹åŠ¡æ—¥å¿—ã€äºŒè¿›åˆ¶æ—¥å¿—å‡ å¤§ç±»\nmysqlæ‰§è¡Œ\næ€»ç»“\næ¯”è¾ƒé‡è¦çš„\näºŒè¿›åˆ¶æ—¥å¿—ï¼š binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ã€serverå±‚ã€‘ äº‹åŠ¡æ—¥å¿—ï¼šredo logï¼ˆé‡åšæ—¥å¿—ï¼‰å’Œundo logï¼ˆå›æ»šæ—¥å¿—ï¼‰ ã€å¼•æ“å±‚ã€‘ redo logæ˜¯è®°å½•ç‰©ç†ä¸Šçš„æ”¹å˜ï¼›\nundo logæ˜¯ä»é€»è¾‘ä¸Šæ¢å¤ï¼Œäº§ç”Ÿæ—¶æœºï¼šäº‹åŠ¡å¼€å§‹ä¹‹å‰ MySQL InnoDB å¼•æ“ä½¿ç”¨ redo log(é‡åšæ—¥å¿—) ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ï¼Œä½¿ç”¨ undo log(å›æ»šæ—¥å¿—) æ¥ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ã€‚ redo log # redo logï¼ˆé‡åšæ—¥å¿—ï¼‰æ˜¯InnoDBå­˜å‚¨å¼•æ“ç‹¬æœ‰çš„ï¼Œå®ƒè®©MySQLæ‹¥æœ‰äº†å´©æºƒæ¢å¤çš„èƒ½åŠ›\næ¯”å¦‚ MySQL å®ä¾‹æŒ‚äº†æˆ–å®•æœºäº†ï¼Œé‡å¯æ—¶ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä¼šä½¿ç”¨redo logæ¢å¤æ•°æ®ï¼Œä¿è¯æ•°æ®çš„æŒä¹…æ€§ä¸å®Œæ•´æ€§ã€‚\nå†å…·ä½“ç‚¹ï¼šé˜²æ­¢åœ¨å‘ç”Ÿæ•…éšœçš„æ—¶é—´ç‚¹ï¼Œå°šæœ‰è„é¡µæœªå†™å…¥ç£ç›˜ï¼Œåœ¨é‡å¯mysqlæœåŠ¡çš„æ—¶å€™ï¼Œæ ¹æ®redo logè¿›è¡Œé‡åšï¼Œä»è€Œè¾¾åˆ°äº‹åŠ¡çš„æŒä¹…æ€§è¿™ä¸€ç‰¹æ€§\nMySQLä¸­æ•°æ®æ˜¯ä»¥é¡µï¼ˆè¿™ä¸ªå¾ˆé‡è¦ï¼Œé‡ç‚¹æ˜¯é’ˆå¯¹é¡µï¼‰ä¸ºå•ä½ï¼Œä½ æŸ¥è¯¢ä¸€æ¡è®°å½•ï¼Œä¼šä»ç¡¬ç›˜æŠŠä¸€é¡µçš„æ•°æ®åŠ è½½å‡ºæ¥ï¼ŒåŠ è½½å‡ºæ¥çš„æ•°æ®å«æ•°æ®é¡µï¼Œä¼šæ”¾åˆ°Buffer Poolä¸­ (è¿™ä¸ªæ—¶å€™ å¦‚æœæ›´æ–°ï¼Œbuffer pool ä¸­çš„æ•°æ®é¡µå°±ä¸ç£ç›˜ä¸Šçš„æ•°æ®é¡µå†…å®¹ä¸ä¸€è‡´ï¼Œæˆ‘ä»¬ç§° buffer pool çš„æ•°æ®é¡µä¸º dirty page è„æ•°æ®)\nä»¥é¡µä¸ºå•ä½ï¼š\né¡µæ˜¯InnoDB ç®¡ç†å­˜å‚¨ç©ºé—´çš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªé¡µçš„å¤§å°ä¸€èˆ¬æ˜¯16KB ã€‚å¯ä»¥ç†è§£ä¸ºåˆ›å»ºä¸€ä¸ªè¡¨æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå¤§å°ä¸º16KBå¤§å°çš„ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯æ•°æ®é¡µã€‚æ–°å¢æ•°æ®æ—¶ä¼šå¾€è¯¥é¡µä¸­User Recordsä¸­æ·»åŠ æ•°æ®ï¼Œå¦‚æœé¡µçš„å¤§å°ä¸å¤Ÿä½¿ç”¨äº†ç»§ç»­åˆ›å»ºæ–°çš„é¡µã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€èˆ¬æƒ…å†µä¸‹ä¸€æ¬¡æœ€å°‘ä»ç£ç›˜è¯»å–16kbçš„å†…å®¹åˆ°å†…å­˜ï¼Œä¸€æ¬¡æœ€å°‘æŠŠ16kbçš„å†…å®¹åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œå…¶ä½œç”¨æœ‰ç‚¹ç¼“å­˜è¡Œçš„æ„æ€ åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/qq_31142237/article/details/125447413\nåç»­çš„æŸ¥è¯¢éƒ½æ˜¯å…ˆä» Buffer Pool ä¸­æ‰¾ï¼Œæ²¡æœ‰å‘½ä¸­å†å»ç¡¬ç›˜åŠ è½½ï¼Œå‡å°‘ç¡¬ç›˜ IO å¼€é”€ï¼Œæå‡æ€§èƒ½ã€‚\næ›´æ–°è¡¨æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå‘ç° Buffer Pool é‡Œå­˜åœ¨è¦æ›´æ–°çš„æ•°æ®ï¼Œå°±ç›´æ¥åœ¨ Buffer Pool é‡Œæ›´æ–°\næŠŠâ€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€è®°å½•åˆ°é‡åšæ—¥å¿—ç¼“å­˜ï¼ˆredo log bufferï¼‰é‡Œï¼Œæ¥ç€åˆ·ç›˜åˆ° redo log æ–‡ä»¶é‡Œ\nå³ ä» ç¡¬ç›˜ä¸Šdbæ•°æ®æ–‡ä»¶ \u0026ndash;\u0026gt; BufferPool \u0026ndash;\u0026gt; redo log buffer \u0026ndash;\u0026gt; redo log ç†æƒ³æƒ…å†µï¼Œäº‹åŠ¡ä¸€æäº¤å°±ä¼šè¿›è¡Œåˆ·ç›˜æ“ä½œï¼Œä½†å®é™…ä¸Šï¼Œåˆ·ç›˜çš„æ—¶æœºæ˜¯æ ¹æ®ç­–ç•¥\næ¯æ¡redoè®°å½•ç”±**â€è¡¨ç©ºé—´å·+æ•°æ®é¡µå·+åç§»é‡+ä¿®æ”¹æ•°æ®é•¿åº¦+å…·ä½“ä¿®æ”¹çš„æ•°æ®â€œ**ç»„æˆ\nåˆ·ç›˜æ—¶æœº # InnoDB å­˜å‚¨å¼•æ“ä¸º redo log çš„åˆ·ç›˜ç­–ç•¥æä¾›äº† innodb_flush_log_at_trx_commit å‚æ•°ï¼Œå®ƒæ”¯æŒä¸‰ç§ç­–ç•¥\n0ï¼šè®¾ç½®ä¸º0æ—¶ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶ä¸è¿›è¡Œåˆ·ç›˜æ“ä½œ\n1ï¼šè®¾ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½å°†è¿›è¡Œåˆ·ç›˜æ“ä½œï¼ˆé»˜è®¤å€¼ï¼‰\n2ï¼šè®¾ç½®ä¸º2æ—¶ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæŠŠredo log bufferå†…å®¹å†™å…¥page cache(ç³»ç»Ÿç¼“å­˜)\ninnodb_flush_log_at_trx_commit å‚æ•°é»˜è®¤ä¸º 1 ï¼Œä¹Ÿå°±æ˜¯è¯´å½“äº‹åŠ¡æäº¤æ—¶ä¼šè°ƒç”¨ fsync å¯¹ redo log è¿›è¡Œåˆ·ç›˜\nInnoDB å­˜å‚¨å¼•æ“æœ‰ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œæ¯éš”1 ç§’ï¼Œå°±ä¼šæŠŠ redo log buffer ä¸­çš„å†…å®¹å†™åˆ°æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼ˆpage cacheï¼‰ï¼Œç„¶åè°ƒç”¨ fsync åˆ·ç›˜ã€‚(â˜…â˜…é‡è¦â˜…â˜…å³ä½¿æ²¡æœ‰æäº¤äº‹åŠ¡çš„redo logè®°å½•ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šåˆ·ç›˜ï¼Œå› ä¸ºåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ redo log è®°å½•æ˜¯ä¼šå†™å…¥redo log buffer ä¸­ï¼Œè¿™äº› redo log è®°å½•ä¼šè¢«åå°çº¿ç¨‹åˆ·ç›˜ã€‚)\né™¤äº†åå°çº¿ç¨‹æ¯ç§’1æ¬¡çš„è½®è¯¢æ“ä½œï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå½“ redo log buffer å ç”¨çš„ç©ºé—´å³å°†è¾¾åˆ° innodb_log_buffer_size ä¸€åŠçš„æ—¶å€™ï¼Œåå°çº¿ç¨‹ä¼šä¸»åŠ¨åˆ·ç›˜\nä¸åŒåˆ·ç›˜ç­–ç•¥çš„æµç¨‹å›¾\ninnodb_flush_log_at_trx_commit=0ï¼ˆä¸å¯¹æ˜¯å¦åˆ·ç›˜åšå‡ºå¤„ç†ï¼‰ # ä¸º0æ—¶ï¼Œå¦‚æœMySQLæŒ‚äº†æˆ–å®•æœºå¯èƒ½ä¼šæœ‰1ç§’æ•°æ®çš„ä¸¢å¤±ã€‚\nï¼ˆç”±äºäº‹åŠ¡æäº¤æˆåŠŸä¹Ÿä¸ä¼šä¸»åŠ¨å†™å…¥page cacheï¼Œæ‰€ä»¥å³ä½¿åªæœ‰MySQL æŒ‚äº†ï¼Œæ²¡æœ‰å®•æœºï¼Œä¹Ÿä¼šä¸¢å¤±ã€‚ï¼‰\ninnodb_flush_log_at_trx_commit=1 # ä¸º1æ—¶ï¼Œ åªè¦äº‹åŠ¡æäº¤æˆåŠŸï¼Œredo logè®°å½•å°±ä¸€å®šåœ¨ç¡¬ç›˜é‡Œï¼Œä¸ä¼šæœ‰ä»»ä½•æ•°æ®ä¸¢å¤±ã€‚å¦‚æœäº‹åŠ¡æ‰§è¡ŒæœŸé—´MySQLæŒ‚äº†æˆ–å®•æœºï¼Œè¿™éƒ¨åˆ†æ—¥å¿—ä¸¢äº†ï¼Œä½†æ˜¯äº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥æ—¥å¿—ä¸¢äº†ä¹Ÿä¸ä¼šæœ‰æŸå¤±ã€‚\ninnodb_flush_log_at_trx_commit=2 # ä¸º2æ—¶ï¼Œ åªè¦äº‹åŠ¡æäº¤æˆåŠŸï¼Œredo log bufferä¸­çš„å†…å®¹åªå†™å…¥æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼ˆpage cacheï¼‰ã€‚\nå¦‚æœä»…ä»…åªæ˜¯MySQLæŒ‚äº†ä¸ä¼šæœ‰ä»»ä½•æ•°æ®ä¸¢å¤±ï¼Œä½†æ˜¯å®•æœºå¯èƒ½ä¼šæœ‰1ç§’æ•°æ®çš„ä¸¢å¤±ã€‚\næ—¥å¿—æ–‡ä»¶ç»„ # ç¡¬ç›˜ä¸Šå­˜å‚¨çš„ redo log æ—¥å¿—æ–‡ä»¶ä¸åªä¸€ä¸ªï¼Œè€Œæ˜¯ä»¥ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ç»„çš„å½¢å¼å‡ºç°çš„ï¼Œæ¯ä¸ªçš„redoæ—¥å¿—æ–‡ä»¶å¤§å°éƒ½æ˜¯ä¸€æ ·çš„\næ¯”å¦‚å¯ä»¥é…ç½®ä¸ºä¸€ç»„**4ä¸ªæ–‡ä»¶**ï¼Œæ¯ä¸ªæ–‡ä»¶çš„å¤§å°æ˜¯ 1GBï¼Œæ•´ä¸ª redo log æ—¥å¿—æ–‡ä»¶ç»„å¯ä»¥è®°å½•**4G**çš„å†…å®¹\nå®ƒé‡‡ç”¨çš„æ˜¯ç¯å½¢æ•°ç»„å½¢å¼ï¼Œä»å¤´å¼€å§‹å†™ï¼Œå†™åˆ°æœ«å°¾åˆå›åˆ°å¤´å¾ªç¯å†™ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\nåœ¨ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ç»„ä¸­è¿˜æœ‰ä¸¤ä¸ªé‡è¦çš„å±æ€§ï¼Œåˆ†åˆ«æ˜¯ write posã€checkpoint\nwrite pos æ˜¯å½“å‰è®°å½•çš„ä½ç½®ï¼Œä¸€è¾¹å†™ä¸€è¾¹åç§» checkpoint æ˜¯å½“å‰è¦æ“¦é™¤çš„ä½ç½®ï¼Œä¹Ÿæ˜¯å¾€åæ¨ç§» write pos å’Œ checkpoint ä¹‹é—´çš„è¿˜ç©ºç€çš„éƒ¨åˆ†å¯ä»¥ç”¨æ¥å†™å…¥æ–°çš„ redo log è®°å½•ã€‚ ly: æˆ‘çš„ç†è§£æ˜¯æœ‰ä¸ªç¼“å†²å¸¦\nå¦‚æœ write pos è¿½ä¸Š checkpoint (ly: æ²¡æœ‰å¯ä»¥æ“¦é™¤çš„åœ°æ–¹äº†ï¼‰ï¼Œè¡¨ç¤ºæ—¥å¿—æ–‡ä»¶ç»„æ»¡äº†ï¼Œè¿™æ—¶å€™ä¸èƒ½å†å†™å…¥æ–°çš„ redo log è®°å½•ï¼ŒMySQL å¾—åœä¸‹æ¥ï¼Œæ¸…ç©ºä¸€äº›è®°å½•ï¼ŒæŠŠ checkpoint æ¨è¿›ä¸€ä¸‹ã€‚\nredo log å°ç»“ # â˜…â˜…è¿™é‡Œæœ‰ä¸ªå¾ˆé‡è¦çš„é—®é¢˜ï¼Œå°±æ˜¯ä¸ºä»€ä¹ˆå…è®¸æ“¦é™¤â˜…â˜…\nå› ä¸ºredo logè®°å½•çš„æ˜¯æ•°æ®é¡µä¸Šçš„ä¿®æ”¹ï¼Œå¦‚æœBuffer Poolä¸­æ•°æ®é¡µå·²ç»åˆ·ç£ç›˜ï¼ˆè¿™é‡Œè¯´çš„ç£ç›˜æ˜¯æ•°æ®åº“æ•°æ®å§ï¼‰åï¼Œé‚£è¿™äº›è®°å½•å°±å¤±æ•ˆäº†ï¼Œæ–°æ—¥å¿—ä¼šå°†è¿™äº›å¤±æ•ˆçš„è®°å½•è¿›è¡Œè¦†ç›–æ“¦é™¤ã€‚ redo logæ—¥å¿—æ»¡äº†ï¼Œåœ¨æ“¦é™¤ä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿è¿™äº›è¦è¢«æ“¦é™¤è®°å½•å¯¹åº”åœ¨å†…å­˜ä¸­çš„æ•°æ®é¡µéƒ½å·²ç»åˆ·åˆ°ç£ç›˜ä¸­äº†ã€‚æ“¦é™¤æ—§è®°å½•è…¾å‡ºæ–°ç©ºé—´è¿™æ®µæœŸé—´ï¼Œæ˜¯ä¸èƒ½å†æ¥æ”¶æ–°çš„æ›´æ–°è¯·æ±‚çš„ï¼Œæ­¤åˆ»MySQLçš„æ€§èƒ½ä¼šä¸‹é™ã€‚æ‰€ä»¥åœ¨å¹¶å‘é‡å¤§çš„æƒ…å†µä¸‹ï¼Œåˆç†è°ƒæ•´redo logçš„æ–‡ä»¶å¤§å°éå¸¸é‡è¦ã€‚ é‚£ä¸ºä»€ä¹ˆè¦ç»•è¿™ä¹ˆä¸€åœˆå‘¢ï¼Œåªè¦æ¯æ¬¡æŠŠä¿®æ”¹åçš„æ•°æ®é¡µç›´æ¥åˆ·ç›˜ä¸å°±å¥½äº†ï¼Œè¿˜æœ‰ redo log ä»€ä¹ˆäº‹ï¼Ÿ\n1 Byte = 8bit 1 KB = 1024 Byte 1 MB = 1024 KB 1 GB = 1024 MB 1 TB = 1024 GB å®é™…ä¸Šï¼Œæ•°æ®é¡µæ˜¯16KBï¼Œåˆ·ç›˜æ¯”è¾ƒè€—æ—¶ï¼Œæœ‰æ—¶å€™å¯èƒ½å°±ä¿®æ”¹äº†æ•°æ®é¡µé‡Œçš„å‡ Byteæ•°æ®ï¼Œæœ‰å¿…è¦æŠŠå®Œæ•´çš„æ•°æ®é¡µåˆ·ç›˜å—\næ•°æ®é¡µåˆ·ç›˜æ˜¯éšæœºå†™ï¼Œå› ä¸ºä¸€ä¸ªæ•°æ®é¡µå¯¹åº”çš„ä½ç½®å¯èƒ½åœ¨ç¡¬ç›˜æ–‡ä»¶çš„éšæœºä½ç½®ï¼Œæ‰€ä»¥æ€§èƒ½æ˜¯å¾ˆå·®\nä¸€ä¸ªæ•°æ®é¡µå¯¹åº”çš„ä½ç½®å¯èƒ½åœ¨ç¡¬ç›˜æ–‡ä»¶çš„éšæœºä½ç½®ï¼Œå³1é¡µæ˜¯16KBï¼Œè¿™16KBï¼Œå¯èƒ½æ˜¯åœ¨æŸä¸ªç¡¬ç›˜æ–‡ä»¶çš„æŸä¸ªåç§»é‡åˆ°æŸä¸ªåç§»é‡ä¹‹é—´\nå¦‚æœæ˜¯å†™ redo logï¼Œä¸€è¡Œè®°å½•å¯èƒ½å°±å å‡ å Byteï¼ŒåªåŒ…å«è¡¨ç©ºé—´å·ã€æ•°æ®é¡µå·ã€ç£ç›˜æ–‡ä»¶åç§» é‡ã€æ›´æ–°å€¼ï¼Œå†åŠ ä¸Šæ˜¯é¡ºåºå†™ï¼Œæ‰€ä»¥åˆ·ç›˜é€Ÿåº¦å¾ˆå¿«ã€‚\nå…¶å®å†…å­˜çš„æ•°æ®é¡µåœ¨ä¸€å®šæ—¶æœºä¹Ÿä¼šåˆ·ç›˜ï¼Œæˆ‘ä»¬æŠŠè¿™ç§°ä¸ºé¡µåˆå¹¶ï¼Œè®² Buffer Poolçš„æ—¶å€™ä¼šå¯¹è¿™å—ç»†è¯´\nbinlog # redo logæ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•å†…å®¹æ˜¯**â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼Œå±äºInnoDB å­˜å‚¨å¼•æ“**ï¼›è€Œbin logæ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•å†…å®¹æ˜¯è¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œç±»ä¼¼äº â€œç»™ID = 2 è¿™ä¸€è¡Œçš„ c å­—æ®µåŠ 1â€ï¼Œå±äºMYSQL Serverå±‚\næ— è®ºç”¨ä»€ä¹ˆå­˜å‚¨å¼•æ“ï¼Œåªè¦å‘ç”Ÿäº†è¡¨æ•°æ®æ›´æ–°ï¼Œéƒ½ä¼šäº§ç”Ÿäºbinlog æ—¥å¿—\nMySQLçš„æ•°æ®åº“çš„æ•°æ®å¤‡ä»½ã€ä¸»å¤‡ã€ä¸»ä¸»ã€ä¸»ä»éƒ½ç¦»ä¸å¼€binlogï¼Œéœ€è¦ä¾é binlogæ¥åŒæ­¥æ•°æ®ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚ binlogä¼šè®°å½•æ‰€æœ‰æ¶‰åŠæ›´æ–°æ•°æ®çš„é€»è¾‘æ“ä½œï¼Œè€Œä¸”æ˜¯é¡ºåºå†™\nè®°å½•æ ¼å¼ # binlog æ—¥å¿—æœ‰ä¸‰ç§æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡**binlog_format**å‚æ•°æŒ‡å®šã€‚ statement row mixed æŒ‡å®š**statementï¼Œè®°å½•çš„å†…å®¹æ˜¯SQLè¯­å¥åŸæ–‡**ï¼Œæ¯”å¦‚æ‰§è¡Œä¸€æ¡update T set update_time=now() where id=1ï¼Œè®°å½•çš„å†…å®¹å¦‚ä¸‹ åŒæ­¥æ•°æ®æ—¶ä¼šæ‰§è¡Œè®°å½•çš„SQLè¯­å¥ï¼Œä½†æœ‰ä¸ªé—®é¢˜ï¼Œupdate_time = now() ä¼šè·å–å½“å‰ç³»ç»Ÿæ—¶é—´ï¼Œç›´æ¥æ‰§è¡Œä¼šå¯¼è‡´ä¸åŸåº“çš„æ•°æ®ä¸ä¸€è‡´\nä¸ºäº†è§£å†³ä¸Šé¢é—®é¢˜ï¼Œéœ€è¦æŒ‡å®šrowï¼Œè®°å½•çš„ä¸æ˜¯ç®€å•çš„SQLè¯­å¥ï¼Œè¿˜åŒ…æ‹¬æ“ä½œçš„å…·ä½“æ•°æ®ï¼Œè®°å½•å†…å®¹å¦‚ä¸‹\nrowæ ¼å¼çš„è®°å½•å†…å®¹çœ‹ä¸åˆ°è¯¦ç»†ä¿¡æ¯ï¼Œéœ€è¦ç”¨mysqlbinlogå·¥å…·è§£æå‡ºæ¥ update_time=now()å˜æˆäº†å…·ä½“çš„æ—¶é—´update_time=1627112756247ï¼Œæ¡ä»¶åé¢çš„@1ã€@2ã€@3 éƒ½æ˜¯è¯¥è¡Œæ•°æ®ç¬¬ 1 ä¸ª~3 ä¸ªå­—æ®µçš„åŸå§‹å€¼ï¼ˆå‡è®¾è¿™å¼ è¡¨åªæœ‰ 3 ä¸ªå­—æ®µï¼‰ è¿™æ ·å°±èƒ½ä¿è¯åŒæ­¥æ•°æ®çš„ä¸€è‡´æ€§ï¼Œé€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯æŒ‡å®šrowï¼Œå¯ä»¥ä¸ºæ•°æ®åº“çš„æ¢å¤ä¸åŒæ­¥å¸¦æ¥æ›´å¥½çš„å¯é æ€§\nä½†æ˜¯ç”±äºrowéœ€è¦æ›´å¤§çš„å®¹é‡æ¥è®°å½•ï¼Œæ¯”è¾ƒå ç”¨ç©ºé—´ï¼Œæ¢å¤ä¸åŒæ­¥æ›´æ¶ˆè€—IOèµ„æºï¼Œå½±å“æ‰§è¡Œé€Ÿåº¦ã€‚ æŠ˜ä¸­æ–¹æ¡ˆï¼ŒæŒ‡å®šä¸ºmixedï¼Œè®°å½•å†…å®¹ä¸ºä¸¤è€…æ··åˆï¼šMySQLä¼šåˆ¤æ–­è¿™æ¡SQLè¯­å¥æ˜¯å¦å¼•èµ·æ•°æ®ä¸ä¸€è‡´ï¼Œå¦‚æœæ˜¯å°±ç”¨rowæ ¼å¼ï¼Œå¦åˆ™å°±ä½¿ç”¨statementæ ¼å¼\nå†™å…¥æœºåˆ¶ # binlogçš„å†™å…¥æ—¶æœºï¼šäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ°binlog cacheï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼ˆè¿™ä¸ªå¾ˆé‡è¦ï¼Œä»–ä¸åƒredo logï¼Œbinlogåªæœ‰æäº¤çš„æ—¶å€™æ‰ä¼šåˆ·ç›˜ï¼‰ï¼Œå†æŠŠbinlog cacheå†™åˆ°binlogæ–‡ä»¶ä¸­\nå› ä¸ºä¸€ä¸ªäº‹åŠ¡çš„**binlogä¸èƒ½è¢«æ‹†å¼€**ï¼Œæ— è®ºè¿™ä¸ªäº‹åŠ¡å¤šå¤§ï¼Œä¹Ÿè¦ç¡®ä¿ä¸€æ¬¡æ€§å†™å…¥ï¼Œæ‰€ä»¥ç³»ç»Ÿä¼šç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªå—å†…å­˜ä½œä¸ºbinlog cache\næˆ‘ä»¬å¯ä»¥é€šè¿‡binlog_cache_sizeå‚æ•°æ§åˆ¶å•ä¸ªçº¿ç¨‹ binlog cache å¤§å°ï¼Œå¦‚æœå­˜å‚¨å†…å®¹è¶…è¿‡äº†è¿™ä¸ªå‚æ•°ï¼Œå°±è¦æš‚å­˜åˆ°ç£ç›˜ï¼ˆSwapï¼‰ï¼š\nbinlogæ—¥å¿—åˆ·ç›˜æµç¨‹å¦‚ä¸‹\nä¸Šå›¾çš„ writeï¼Œæ˜¯æŒ‡æŠŠæ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cacheï¼Œå¹¶æ²¡æœ‰æŠŠæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ‰€ä»¥é€Ÿåº¦æ¯”è¾ƒå¿« ä¸Šå›¾çš„ fsyncï¼Œæ‰æ˜¯å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ“ä½œ writeå’Œfsyncçš„æ—¶æœºï¼Œç”±sync_binlogæ§åˆ¶ï¼Œé»˜è®¤ä¸º0\nä¸º0æ—¶ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤çš„äº‹åŠ¡éƒ½åªwriteï¼Œç”±ç³»ç»Ÿè‡ªè¡Œåˆ¤æ–­ä»€ä¹ˆæ—¶å€™æ‰§è¡Œfsync è™½ç„¶æ€§èƒ½ä¼šæå‡ï¼Œä½†æ˜¯å¦‚æœæœºå™¨å®•æœºï¼Œpage cacheé‡Œé¢çš„binlogä¼šä¸¢å¤±\nè®¾ç½®ä¸º1ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šfsync ï¼Œå°±å¦‚åŒredo logæ—¥å¿—åˆ·ç›˜æµç¨‹ ä¸€æ ·\næŠ˜ä¸­ï¼Œå¯ä»¥è®¾ç½®ä¸ºN\nåœ¨å‡ºç°IOç“¶é¢ˆçš„åœºæ™¯é‡Œï¼Œå°†sync_binlogè®¾ç½®æˆä¸€ä¸ªè¾ƒå¤§çš„å€¼ï¼Œå¯ä»¥æå‡æ€§èƒ½\nåŒç†ï¼Œå¦‚æœæœºå™¨å®•æœºï¼Œä¼šä¸¢å¤±æœ€è¿‘Nä¸ªäº‹åŠ¡çš„binlogæ—¥å¿—\nä¸¤é˜¶æ®µæäº¤ # redo logï¼ˆé‡åšæ—¥å¿—ï¼‰è®©InnoDBå­˜å‚¨å¼•æ“æ‹¥æœ‰äº†å´©æºƒæ¢å¤çš„èƒ½åŠ› binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ä¿è¯äº†MySQLé›†ç¾¤æ¶æ„çš„æ•°æ®ä¸€è‡´æ€§ ä¸¤è€…éƒ½å±äºæŒä¹…æ€§çš„ä¿è¯ï¼Œä½†ä¾§é‡ç‚¹ä¸åŒ\næ›´æ–°è¯­å¥è¿‡ç¨‹ï¼Œä¼šè®°å½•redo logå’Œbinlogä¸¤å—æ—¥å¿—ï¼Œä»¥åŸºæœ¬çš„äº‹åŠ¡ä¸ºå•ä½\nredo logåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥ä¸æ–­åœ°å†™å…¥ï¼Œè€Œbinlogåªæœ‰åœ¨æäº¤äº‹åŠ¡æ—¶æ‰å†™å…¥ï¼Œæ‰€ä»¥redo logå’Œbinlogå†™å…¥æ—¶æœºä¸ä¸€æ ·\nredo logä¸binlog ä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸ä¸€æ ·ï¼Œä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ\nä»¥updateè¯­å¥ä¸ºä¾‹ï¼Œå‡è®¾id=2çš„è®°å½•ï¼Œå­—æ®µcå€¼æ˜¯0ï¼ŒæŠŠå­—æ®µcå€¼æ›´æ–°æˆ1ï¼ŒSQLè¯­å¥ä¸ºupdate T set c=1 where id= 2\nå‡è®¾æ‰§è¡Œè¿‡ç¨‹ä¸­å†™å®Œredo logæ—¥å¿—åï¼Œbinlogæ—¥å¿—å†™æœŸé—´å‘ç”Ÿäº†å¼‚å¸¸ï¼Œä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µ ç”±äºbinlogæ²¡å†™å®Œå°±å¼‚å¸¸ï¼Œè¿™æ—¶å€™**binlogé‡Œé¢æ²¡æœ‰å¯¹åº”çš„ä¿®æ”¹è®°å½•**ã€‚å› æ­¤ï¼Œä¹‹åç”¨**binlogæ—¥å¿—æ¢å¤(å¤‡åº“)æ•°æ®æ—¶ï¼Œå°±ä¼šå°‘è¿™ä¸€æ¬¡æ›´æ–°ï¼Œæ¢å¤å‡ºæ¥çš„è¿™ä¸€è¡Œcå€¼æ˜¯0ï¼Œè€ŒåŸåº“å› ä¸ºredo logæ—¥å¿—æ¢å¤ï¼Œè¿™ä¸€è¡Œcå€¼æ˜¯1ï¼Œæœ€ç»ˆæ•°æ®ä¸ä¸€è‡´**ã€‚\nä¸ºäº†è§£å†³ä¸¤ä»½æ—¥å¿—ä¹‹é—´çš„é€»è¾‘ä¸€è‡´é—®é¢˜ï¼ŒInnoDBå­˜å‚¨å¼•æ“ä½¿ç”¨ä¸¤é˜¶æ®µæäº¤æ–¹æ¡ˆ å³å°†redo logçš„å†™å…¥æ‹†æˆäº†ä¸¤ä¸ªæ­¥éª¤prepareå’Œcommitï¼Œè¿™å°±æ˜¯ä¸¤é˜¶æ®µæäº¤ï¼ˆå…¶å®å°±æ˜¯ç­‰binlogæ­£å¼å†™å…¥åredo logæ‰æ­£å¼æäº¤ï¼‰ ä½¿ç”¨ä¸¤é˜¶æ®µæäº¤åï¼Œå†™å…¥binlogæ—¶å‘ç”Ÿå¼‚å¸¸ä¹Ÿä¸ä¼šæœ‰å½±å“ï¼Œå› ä¸º**MySQLæ ¹æ®redo logæ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œå‘ç°redo logè¿˜å¤„äºprepareé˜¶æ®µï¼ˆä¹Ÿå°±æ˜¯ä¸‹å›¾çš„écommité˜¶æ®µï¼‰ï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹åº”binlogæ—¥å¿—**ï¼Œå°±ä¼šå›æ»šè¯¥äº‹åŠ¡ã€‚\nå…¶å®ä¸‹å›¾ä¸­ï¼Œæ˜¯å¦å­˜åœ¨å¯¹åº”çš„binlogï¼Œå°±æ˜¯æƒ³çŸ¥é“binlogæ˜¯å¦æ˜¯å®Œæ•´çš„ï¼Œå¦‚æœå®Œæ•´çš„è¯ redologå°±å¯ä»¥æäº¤ ï¼ˆç®­å¤´å‰é¢æ˜¯å¦commité˜¶æ®µï¼Œæ˜¯çš„è¯å°±è¡¨ç¤ºbinlogå†™å…¥æœŸé—´æ²¡æœ‰å‡ºé”™ï¼Œå³binlogå®Œæ•´ï¼‰ è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œredo logè®¾ç½®commité˜¶æ®µå‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¼šä¸ä¼šå›æ»šäº‹åŠ¡å‘¢ï¼Ÿ å¹¶ä¸ä¼šå›æ»šäº‹åŠ¡ï¼Œå®ƒä¼šæ‰§è¡Œä¸Šå›¾æ¡†ä½çš„é€»è¾‘ï¼Œè™½ç„¶redo logæ˜¯å¤„äºprepareé˜¶æ®µï¼Œä½†æ˜¯èƒ½é€šè¿‡äº‹åŠ¡idæ‰¾åˆ°å¯¹åº”çš„binlogæ—¥å¿—ï¼Œæ‰€ä»¥**MySQLè®¤ä¸º(binlog)æ˜¯å®Œæ•´çš„**ï¼Œå°±ä¼šæäº¤äº‹åŠ¡æ¢å¤æ•°æ®ã€‚\nundo log # å¦‚æœæƒ³è¦ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ï¼Œå°±éœ€è¦åœ¨å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œå¯¹å·²ç»æ‰§è¡Œçš„æ“ä½œè¿›è¡Œå›æ»šï¼Œåœ¨ MySQL ä¸­ï¼Œæ¢å¤æœºåˆ¶æ˜¯é€šè¿‡ å›æ»šæ—¥å¿—ï¼ˆundo logï¼‰ å®ç°çš„ï¼Œæ‰€æœ‰äº‹åŠ¡è¿›è¡Œçš„ä¿®æ”¹éƒ½ä¼šå…ˆè®°å½•åˆ°è¿™ä¸ªå›æ»šæ—¥å¿—ä¸­ï¼Œç„¶åå†æ‰§è¡Œç›¸å…³çš„æ“ä½œ å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°å¼‚å¸¸çš„è¯ï¼Œæˆ‘ä»¬ç›´æ¥åˆ©ç”¨ å›æ»šæ—¥å¿— ä¸­çš„ä¿¡æ¯å°†æ•°æ®å›æ»šåˆ°ä¿®æ”¹ä¹‹å‰çš„æ ·å­å³å¯ï¼ å›æ»šæ—¥å¿—ä¼šå…ˆäºæ•°æ®ï¼ˆæ•°æ®åº“æ•°æ®ï¼‰æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šã€‚è¿™æ ·å°±ä¿è¯äº†å³ä½¿é‡åˆ°æ•°æ®åº“çªç„¶å®•æœºç­‰æƒ…å†µï¼Œå½“ç”¨æˆ·å†æ¬¡å¯åŠ¨æ•°æ®åº“çš„æ—¶å€™ï¼Œæ•°æ®åº“è¿˜èƒ½å¤Ÿé€šè¿‡æŸ¥è¯¢å›æ»šæ—¥å¿—æ¥å›æ»šå°†ä¹‹å‰æœªå®Œæˆçš„äº‹åŠ¡ã€‚ å…³äºundo logï¼š\nå‚è€ƒhttps://blog.csdn.net/Weixiaohuai/article/details/117867353\nundo logæ˜¯é€»è¾‘æ—¥å¿—ï¼Œè€Œä¸”è®°å½•çš„æ˜¯ç›¸åçš„è¯­å¥\nundo logæ—¥å¿—é‡Œé¢ä¸ä»…å­˜æ”¾ç€æ•°æ®æ›´æ–°å‰çš„è®°å½•ï¼Œè¿˜è®°å½•ç€RowIDã€äº‹åŠ¡IDã€å›æ»šæŒ‡é’ˆã€‚å…¶ä¸­äº‹åŠ¡IDæ¯æ¬¡é€’å¢ï¼Œå›æ»šæŒ‡é’ˆç¬¬ä¸€æ¬¡å¦‚æœæ˜¯insertè¯­å¥çš„è¯ï¼Œå›æ»šæŒ‡é’ˆä¸ºNULL**ï¼Œç¬¬äºŒæ¬¡updateä¹‹åçš„undo logçš„å›æ»šæŒ‡é’ˆå°±ä¼šæŒ‡å‘åˆšåˆšé‚£ä¸€æ¡undo logæ—¥å¿—**ï¼Œä¾æ¬¡ç±»æ¨ï¼Œå°±ä¼šå½¢æˆä¸€æ¡undo logçš„å›æ»šé“¾ï¼Œæ–¹ä¾¿æ‰¾åˆ°è¯¥æ¡è®°å½•çš„å†å²ç‰ˆæœ¬\næ›´æ–°æ•°æ®ä¹‹å‰ï¼ŒMySQLä¼šæå‰ç”Ÿæˆundo logæ—¥å¿—ï¼Œå½“äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šç«‹å³åˆ é™¤undo logï¼Œå› ä¸ºåé¢å¯èƒ½éœ€è¦è¿›è¡Œå›æ»šæ“ä½œï¼Œè¦æ‰§è¡Œå›æ»šï¼ˆrollbackï¼‰æ“ä½œæ—¶ï¼Œä»ç¼“å­˜ä¸­è¯»å–æ•°æ®ã€‚undo logæ—¥å¿—çš„åˆ é™¤æ˜¯é€šè¿‡é€šè¿‡åå°purgeçº¿ç¨‹è¿›è¡Œå›æ”¶å¤„ç†çš„ã€‚\nä¸¾ä¾‹\nå‡è®¾æœ‰Aã€Bä¸¤ä¸ªæ•°æ®ï¼Œå€¼åˆ†åˆ«ä¸º1,2ã€‚\nA. äº‹åŠ¡å¼€å§‹\nB. è®°å½•A=1åˆ°undo logä¸­\nC. ä¿®æ”¹A=3\nD. è®°å½•B=2åˆ°undo logä¸­\nE. ä¿®æ”¹B=4\nF. å°†undo logå†™åˆ°ç£ç›˜ \u0026mdash;\u0026mdash;-undo logæŒä¹…åŒ–\nG. å°†æ•°æ®å†™åˆ°ç£ç›˜ \u0026mdash;\u0026mdash;-æ•°æ®æŒä¹…åŒ–\nH. äº‹åŠ¡æäº¤ \u0026mdash;\u0026mdash;-æäº¤äº‹åŠ¡\nç”±äºä»¥ä¸‹ç‰¹ç‚¹ï¼Œæ‰€ä»¥èƒ½ä¿è¯åŸå­æ€§å’ŒæŒä¹…åŒ–\næ›´æ–°æ•°æ®å‰è®°å½•undo logã€‚ ä¸ºäº†ä¿è¯æŒä¹…æ€§ï¼Œå¿…é¡»å°†æ•°æ®åœ¨äº‹åŠ¡æäº¤å‰å†™åˆ°ç£ç›˜ï¼Œåªè¦äº‹åŠ¡æˆåŠŸæäº¤ï¼Œæ•°æ®å¿…ç„¶å·²ç»æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚ undo logå¿…é¡»å…ˆäºæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚å¦‚æœåœ¨G,Hä¹‹é—´å‘ç”Ÿç³»ç»Ÿå´©æºƒï¼Œundo logæ˜¯å®Œæ•´çš„ï¼Œå¯ä»¥ç”¨æ¥å›æ»šã€‚ å¦‚æœåœ¨A - Fä¹‹é—´å‘ç”Ÿç³»ç»Ÿå´©æºƒï¼Œå› ä¸ºæ•°æ®æ²¡æœ‰æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ‰€ä»¥ç£ç›˜ä¸Šçš„æ•°æ®è¿˜æ˜¯ä¿æŒåœ¨äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ã€‚ å‚è€ƒhttps://developer.aliyun.com/article/1009683\nhttps://www.cnblogs.com/defectfixer/p/15835714.html\nMySQL çš„ InnoDB å­˜å‚¨å¼•æ“ä½¿ç”¨â€œWrite-Ahead Logâ€æ—¥å¿—æ–¹æ¡ˆå®ç°æœ¬åœ°äº‹åŠ¡çš„åŸå­æ€§ã€æŒä¹…æ€§ã€‚\nâ€œæå‰å†™å…¥â€ï¼ˆWrite-Aheadï¼‰ï¼Œå°±æ˜¯åœ¨äº‹åŠ¡æäº¤ä¹‹å‰ï¼Œå…è®¸å°†å˜åŠ¨æ•°æ®å†™å…¥ç£ç›˜ã€‚ä¸â€œæå‰å†™å…¥â€ç›¸åçš„å°±æ˜¯ï¼Œåœ¨äº‹åŠ¡æäº¤ä¹‹å‰ï¼Œä¸å…è®¸å°†å˜åŠ¨æ•°æ®å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯ç­‰åˆ°äº‹åŠ¡æäº¤ä¹‹åå†å†™å…¥ã€‚\nâ€œæå‰å†™å…¥â€çš„å¥½å¤„æ˜¯ï¼šæœ‰åˆ©äºåˆ©ç”¨ç©ºé—² I/O èµ„æºã€‚ä½†â€œæå‰å†™å…¥â€åŒæ—¶ä¹Ÿå¼•å…¥äº†æ–°çš„é—®é¢˜ï¼šåœ¨äº‹åŠ¡æäº¤ä¹‹å‰å°±æœ‰éƒ¨åˆ†å˜åŠ¨æ•°æ®è¢«å†™å…¥ç£ç›˜ï¼Œé‚£ä¹ˆå¦‚æœäº‹åŠ¡è¦å›æ»šï¼Œæˆ–è€…å‘ç”Ÿäº†å´©æºƒï¼Œè¿™äº›æå‰å†™å…¥çš„å˜åŠ¨æ•°æ®å°±éƒ½æˆäº†é”™è¯¯ã€‚â€œWrite-Ahead Logâ€æ—¥å¿—æ–¹æ¡ˆç»™å‡ºçš„è§£å†³åŠæ³•æ˜¯ï¼šå¢åŠ äº†ä¸€ç§è¢«ç§°ä¸º Undo Log çš„æ—¥å¿—ï¼Œç”¨äºè¿›è¡Œäº‹åŠ¡å›æ»šã€‚\nå˜åŠ¨æ•°æ®å†™å…¥ç£ç›˜å‰ï¼Œå¿…é¡»å…ˆè®°å½• Undo Logï¼ŒUndo Log ä¸­å­˜å‚¨äº†å›æ»šéœ€è¦çš„æ•°æ®ã€‚åœ¨äº‹åŠ¡å›æ»šæˆ–è€…å´©æºƒæ¢å¤æ—¶ï¼Œæ ¹æ® Undo Log ä¸­çš„ä¿¡æ¯å¯¹æå‰å†™å…¥çš„æ•°æ®å˜åŠ¨è¿›è¡Œæ“¦é™¤ã€‚\næ›´æ–°ä¸€æ¡è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹(ly:æ ¹æ®å¤šæ–¹èµ„æ–™éªŒè¯ï¼Œè¿™ä¸ªæ˜¯å¯¹çš„ï¼Œäº‹åŠ¡æäº¤å‰å¹¶ä¸ä¼šæŒä¹…åŒ–åˆ°dbç£ç›˜æ•°æ®åº“æ–‡ä»¶ä¸­)\nå›ç­”é¢˜ä¸»çš„é—®é¢˜ï¼Œå¯¹MySQLæ•°æ®åº“æ¥è¯´ï¼Œäº‹åŠ¡æäº¤ä¹‹å‰ï¼Œæ“ä½œçš„æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“åœ¨å†…å­˜åŒºåŸŸä¸­çš„ç¼“å†²æ± ä¸­ï¼Œå³å†™çš„æ˜¯å†…å­˜ç¼“å†²æ± ä¸­çš„é¡µ(page cache)ï¼ŒåŒæ—¶ä¼šåœ¨ç¼“å†²æ± ä¸­å†™undolog(ç”¨äºå›æ»š)å’Œredologã€binlog(ç”¨äºæ•…éšœæ¢å¤ï¼Œä¿è¯æ•°æ®æŒä¹…åŒ–çš„ä¸€è‡´æ€§)ï¼Œäº‹åŠ¡æäº¤åï¼Œæœ‰æ•°æ®å˜æ›´çš„é¡µï¼Œå³è„é¡µï¼Œä¼šè¢«æŒä¹…åŒ–åˆ°ç‰©ç†ç£ç›˜ã€‚\nä½œè€…ï¼šç‹åŒå­¦ é“¾æ¥ï¼šhttps://www.zhihu.com/question/278643174/answer/1998207141 æ¥æºï¼šçŸ¥ä¹ è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚\næ‰§è¡Œåçš„å‡ ä¸ªæ­¥éª¤\näº‹åŠ¡å¼€å§‹ ç”³è¯·åŠ é”ï¼šè¡¨é”ã€MDL é”ã€è¡Œé”ã€ç´¢å¼•åŒºé—´é”ï¼ˆçœ‹æƒ…å†µåŠ å“ªå‡ ç§é”ï¼‰ æ‰§è¡Œå™¨æ‰¾å­˜å‚¨å¼•æ“å–æ•°æ®ã€‚ å¦‚æœè®°å½•æ‰€åœ¨çš„æ•°æ®é¡µæœ¬æ¥å°±åœ¨å†…å­˜ï¼ˆinnodb_buffer_cacheï¼‰ä¸­ï¼Œå­˜å‚¨å¼•æ“å°±ç›´æ¥è¿”å›ç»™æ‰§è¡Œå™¨ï¼› å¦åˆ™ï¼Œå­˜å‚¨å¼•æ“éœ€è¦å…ˆå°†è¯¥æ•°æ®é¡µä»ç£ç›˜è¯»å–åˆ°å†…å­˜ï¼Œç„¶åå†è¿”å›ç»™æ‰§è¡Œå™¨ã€‚ æ‰§è¡Œå™¨æ‹¿åˆ°å­˜å‚¨å¼•æ“ç»™çš„è¡Œæ•°æ®ï¼Œè¿›è¡Œæ›´æ–°æ“ä½œåï¼Œå†è°ƒç”¨å­˜å‚¨å¼•æ“æ¥å£å†™å…¥è¿™è¡Œæ–°æ•°æ®(6 - 9)ã€‚ å­˜å‚¨å¼•æ“å°†å›æ»šéœ€è¦çš„æ•°æ®è®°å½•åˆ° Undo Logï¼Œå¹¶å°†è¿™ä¸ªæ›´æ–°æ“ä½œè®°å½•åˆ° Redo Logï¼Œæ­¤æ—¶ Redo Log å¤„äº prepare çŠ¶æ€ã€‚å¹¶å°†è¿™è¡Œæ–°æ•°æ®æ›´æ–°åˆ°å†…å­˜ï¼ˆinnodb_buffer_cacheï¼‰ä¸­ã€‚åŒæ—¶ï¼Œç„¶åå‘ŠçŸ¥æ‰§è¡Œå™¨æ‰§è¡Œå®Œæˆäº†ï¼Œéšæ—¶å¯ä»¥æäº¤äº‹åŠ¡ã€‚ æ‰‹åŠ¨äº‹åŠ¡ commitï¼šæ‰§è¡Œå™¨ç”Ÿæˆè¿™ä¸ªæ“ä½œçš„ Binary Logï¼Œå¹¶æŠŠ Binary Log å†™å…¥ç£ç›˜ã€‚ æ‰§è¡Œå™¨è°ƒç”¨å­˜å‚¨å¼•æ“çš„æäº¤äº‹åŠ¡æ¥å£ï¼Œå­˜å‚¨å¼•æ“æŠŠåˆšåˆšå†™å…¥çš„ Redo Log æ”¹æˆ commit çŠ¶æ€ã€‚ äº‹åŠ¡ç»“æŸ MVCC # MVCC çš„å®ç°ä¾èµ–äºï¼šéšè—å­—æ®µã€Read Viewã€undo logã€‚\nå†…éƒ¨å®ç°ä¸­ï¼ŒInnoDB é€šè¿‡æ•°æ®è¡Œçš„ DB_TRX_ID å’Œ Read View æ¥åˆ¤æ–­æ•°æ®çš„å¯è§æ€§ï¼Œå¦‚ä¸å¯è§ï¼Œåˆ™é€šè¿‡æ•°æ®è¡Œçš„ DB_ROLL_PTR æ‰¾åˆ° undo log ä¸­çš„å†å²ç‰ˆæœ¬ã€‚\næ¯ä¸ªäº‹åŠ¡è¯»åˆ°çš„æ•°æ®ç‰ˆæœ¬å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œç”¨æˆ·åªèƒ½çœ‹åˆ°è¯¥äº‹åŠ¡åˆ›å»º Read View ä¹‹å‰å·²ç»æäº¤çš„ä¿®æ”¹å’Œè¯¥äº‹åŠ¡æœ¬èº«åšçš„ä¿®æ”¹\næ€»ç»“ # MySQL InnoDB å¼•æ“ä½¿ç”¨ redo log(é‡åšæ—¥å¿—) ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ï¼Œä½¿ç”¨ undo log(å›æ»šæ—¥å¿—) æ¥ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ã€‚ MySQLæ•°æ®åº“çš„æ•°æ®å¤‡ä»½ã€ä¸»å¤‡ã€ä¸»ä¸»ã€ä¸»ä»éƒ½ç¦»ä¸å¼€binlogï¼Œéœ€è¦ä¾é binlogæ¥åŒæ­¥æ•°æ®ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚ ä¸‰å¤§æ—¥å¿—å¤§æ¦‚çš„æµç¨‹ "},{"id":112,"href":"/zh/docs/study/Review/java_guide/database/MySQL/ly0601lymysql-index/","title":"ç´¢å¼•","section":"MySQL","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nè¡¥å……ç´¢å¼•åŸºç¡€çŸ¥è¯†(å¼•è‡ªbç«™sggè§†é¢‘) # å­˜å‚¨å¼•æ“ï¼Œæ•°æ®çš„åŸºæœ¬å•ä½æ˜¯é¡µï¼Œå¦‚æœæ•°æ®å¾ˆå°‘ï¼Œåªæœ‰ä¸€é¡µï¼Œé‚£å°±ç®€å•ï¼Œæ˜¯ç›´æ¥äºŒåˆ†æŸ¥æ‰¾(ä¸æ¶‰åŠç£ç›˜IO)ï¼›å¦‚æœæ•°æ®å¾ˆå¤šï¼Œæœ‰å¥½å‡ ä¸ªé¡µï¼Œé‚£ä¹ˆéœ€è¦å¯¹é¡µå»ºç«‹ä¸€ç§æ•°æ®ç»“æ„ï¼Œèƒ½å¤Ÿæœ€å¿«å®šä½åˆ°å“ªä¸€é¡µï¼Œç„¶åå‡å°‘ç£ç›˜IO ç´¢å¼•ä»‹ç» # ç´¢å¼•æ˜¯ä¸€ç§ç”¨äºå¿«é€ŸæŸ¥è¯¢å’Œæ£€ç´¢æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œå…¶æœ¬è´¨å¯ä»¥çœ‹æˆæ˜¯ä¸€ç§æ’åºå¥½çš„æ•°æ®ç»“æ„\nç´¢å¼•çš„ä½œç”¨å°±ç›¸å½“äºä¹¦çš„ç›®å½•ã€‚æ‰“ä¸ªæ¯”æ–¹: æˆ‘ä»¬åœ¨æŸ¥å­—å…¸çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰ç›®å½•ï¼Œé‚£æˆ‘ä»¬å°±åªèƒ½ä¸€é¡µä¸€é¡µçš„å»æ‰¾æˆ‘ä»¬éœ€è¦æŸ¥çš„é‚£ä¸ªå­—ï¼Œé€Ÿåº¦å¾ˆæ…¢ã€‚å¦‚æœæœ‰ç›®å½•äº†ï¼Œæˆ‘ä»¬åªéœ€è¦å…ˆå»ç›®å½•é‡ŒæŸ¥æ‰¾å­—çš„ä½ç½®ï¼Œç„¶åç›´æ¥ç¿»åˆ°é‚£ä¸€é¡µå°±è¡Œäº†\nç´¢å¼•åº•å±‚æ•°æ®ç»“æ„å­˜åœ¨å¾ˆå¤šç§ç±»å‹ï¼Œå¸¸è§çš„ç´¢å¼•ç»“æ„æœ‰ï¼šBæ ‘ï¼ŒB+æ ‘å’ŒHashã€çº¢é»‘æ ‘ã€‚åœ¨MySQLä¸­ï¼Œæ— è®ºæ˜¯Innodbè¿˜æ˜¯MyIsamï¼Œéƒ½ä½¿ç”¨äº†B+æ ‘ä½œä¸ºç´¢å¼•ç»“æ„\nç´¢å¼•çš„ä¼˜ç¼ºç‚¹ # ä¼˜ç‚¹ï¼š\nä½¿ç”¨ç´¢å¼•å¯ä»¥å¤§å¤§åŠ å¿« æ•°æ®çš„æ£€ç´¢é€Ÿåº¦ï¼ˆå¤§å¤§å‡å°‘æ£€ç´¢çš„æ•°æ®é‡ï¼‰, è¿™ä¹Ÿæ˜¯åˆ›å»ºç´¢å¼•çš„æœ€ä¸»è¦çš„åŸå› ã€‚ é€šè¿‡åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•ï¼Œå¯ä»¥ä¿è¯æ•°æ®åº“è¡¨ä¸­æ¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ€§ã€‚ ç¼ºç‚¹ï¼š\nåˆ›å»ºç´¢å¼•å’Œç»´æŠ¤ç´¢å¼•éœ€è¦è€—è´¹è®¸å¤šæ—¶é—´ã€‚å½“å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢åˆ æ”¹çš„æ—¶å€™ï¼Œå¦‚æœæ•°æ®æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆç´¢å¼•ä¹Ÿéœ€è¦åŠ¨æ€çš„ä¿®æ”¹ï¼Œä¼šé™ä½ SQL æ‰§è¡Œæ•ˆç‡ã€‚ ç´¢å¼•éœ€è¦ä½¿ç”¨ç‰©ç†æ–‡ä»¶å­˜å‚¨ï¼Œä¹Ÿä¼šè€—è´¹ä¸€å®šç©ºé—´ ç´¢å¼•ä¸€å®šä¼šæé«˜æŸ¥è¯¢æ€§èƒ½å—\nå¤šæ•°æƒ…å†µä¸‹ï¼Œç´¢å¼•æŸ¥è¯¢éƒ½æ˜¯æ¯”å…¨è¡¨æ‰«æè¦å¿«çš„ã€‚ä½†æ˜¯å¦‚æœæ•°æ®åº“çš„æ•°æ®é‡ä¸å¤§ï¼Œé‚£ä¹ˆä½¿ç”¨ç´¢å¼•ä¹Ÿä¸ä¸€å®šèƒ½å¤Ÿå¸¦æ¥å¾ˆå¤§æå‡ ç´¢å¼•çš„åº•å±‚æ•°æ®ç»“æ„ # Hashè¡¨ # å“ˆå¸Œè¡¨æ˜¯é”®å€¼å¯¹çš„é›†åˆï¼Œé€šè¿‡é”®ï¼ˆkeyï¼‰å³å¯å¿«é€Ÿå–å‡ºå¯¹åº”çš„å€¼ï¼ˆvalueï¼‰ï¼Œå› æ­¤å“ˆå¸Œè¡¨å¯ä»¥å¿«é€Ÿæ£€ç´¢æ•°æ®ï¼ˆæ¥è¿‘O(1))\nä¸ºä½•èƒ½å¤Ÿé€šè¿‡keyå¿«é€Ÿå–å‡ºvalueå‘¢ï¼ŸåŸå› åœ¨äºå“ˆå¸Œç®—æ³•ï¼ˆä¹Ÿå«æ•£åˆ—ç®—æ³•ï¼‰ã€‚é€šè¿‡å“ˆå¸Œç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿæ‰¾åˆ°keyå¯¹åº”çš„indexï¼Œæ‰¾åˆ°äº†indexä¹Ÿå°±æ‰¾åˆ°äº†å¯¹åº”çš„value\nhash = hashfunc(key) index = hash % array_size æ³¨æ„ï¼Œå›¾ä¸­keys[å¤©è“è‰²]æ˜¯å­—ç¬¦ä¸²ï¼Œä¸æ˜¯ä»€ä¹ˆè«åå…¶å¦™çš„äºº å“ˆå¸Œç®—æ³•æœ‰ä¸ª Hash å†²çª é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´å¤šä¸ªä¸åŒçš„ key æœ€åå¾—åˆ°çš„ index ç›¸åŒã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„è§£å†³åŠæ³•æ˜¯ é“¾åœ°å€æ³•ã€‚é“¾åœ°å€æ³•å°±æ˜¯å°†å“ˆå¸Œå†²çªæ•°æ®å­˜æ”¾åœ¨é“¾è¡¨ä¸­ã€‚å°±æ¯”å¦‚ JDK1.8 ä¹‹å‰ HashMap å°±æ˜¯é€šè¿‡é“¾åœ°å€æ³•æ¥è§£å†³å“ˆå¸Œå†²çªçš„ã€‚ä¸è¿‡ï¼ŒJDK1.8 ä»¥åHashMapä¸ºäº†å‡å°‘é“¾è¡¨è¿‡é•¿çš„æ—¶å€™æœç´¢æ—¶é—´è¿‡é•¿å¼•å…¥äº†çº¢é»‘æ ‘ã€‚\nä¸ºäº†å‡å°‘ Hash å†²çªçš„å‘ç”Ÿï¼Œä¸€ä¸ªå¥½çš„å“ˆå¸Œå‡½æ•°åº”è¯¥**â€œå‡åŒ€åœ°â€å°†æ•°æ®åˆ†å¸ƒ**åœ¨æ•´ä¸ªå¯èƒ½çš„å“ˆå¸Œå€¼é›†åˆä¸­\nç”±äºHashç´¢å¼•ä¸æ”¯æŒé¡ºåºå’ŒèŒƒå›´æŸ¥è¯¢ï¼Œå‡å¦‚è¦å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œæ’åºæˆ–è€…è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œé‚£Hashç´¢å¼•å°±ä¸è¡Œäº†ï¼Œå¹¶ä¸”ï¼Œæ¯æ¬¡IOåªèƒ½å–ä¸€ä¸ª\nä¾‹å¦‚ï¼š SELECT * FROM tb1 WHERE id \u0026lt; 500 ; è¿™ç§èŒƒå›´æŸ¥è¯¢ä¸­ï¼ŒB+æ ‘ ä¼˜åŠ¿éå¸¸å¤§ ç›´æ¥éå†æ¯”500å°çš„å¶å­èŠ‚ç‚¹å³å¯ å¦‚æœä½¿ç”¨Hashç´¢å¼•ï¼Œç”±äºHashç´¢å¼•æ˜¯æ ¹æ®hashç®—æ³•æ¥å®šä½çš„ï¼Œéš¾ä¸æˆæŠŠ1 ~499 ï¼ˆå°äº500ï¼‰çš„æ•°æ®éƒ½è¿›è¡Œä¸€æ¬¡hashè®¡ç®—æ¥å®šä½å—ï¼Ÿè¿™å°±æ˜¯Hashæœ€å¤§çš„ç¼ºç‚¹ è¿™é‡Œå…¶å®è¯´çš„æ˜¯å·²ç»æ‰¾åˆ°äº†ç´¢å¼•ï¼Œä½†æ˜¯ç´¢å¼•æ²¡æœ‰æ•°æ®çš„æƒ…å½¢ã€‚è¦ä¹ˆé€šè¿‡hashä¸€ä¸ªä¸ªå–æ•°æ®ï¼Œè¦ä¹ˆåˆ©ç”¨B+æ ‘çš„ç‰¹æ€§ï¼ˆå¶å­èŠ‚ç‚¹æœ‰å®Œæ•´æ•°æ®ï¼‰\nBæ ‘\u0026amp; B+ æ ‘ # Bæ ‘ä¹Ÿç§°B-æ ‘ï¼Œå…¨ç§°ä¸ºå¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼ŒB+æ ‘æ˜¯Bæ ‘çš„ä¸€ç§å˜ä½“\nBæ ‘å’ŒB+æ ‘ä¸­çš„Bæ˜¯Balancedï¼ˆå¹³è¡¡ï¼‰çš„æ„æ€\nç›®å‰å¤§éƒ¨åˆ†æ•°æ®åº“ä»¥åŠæ–‡ä»¶ç³»ç»Ÿéƒ½é‡‡ç”¨B-Treeæˆ–è€…å…¶å˜ç§B+Treeä½œä¸ºç´¢å¼•ç»“æ„\nBæ ‘\u0026amp;B+æ ‘ä¸¤è€…æœ‰ä½•å¼‚åŒå‘¢\nBæ ‘çš„æ‰€æœ‰ç»“ç‚¹æ—¢å­˜æ”¾é”®ï¼ˆkeyï¼‰ä¹Ÿå­˜æ”¾æ•°æ®ï¼ˆdataï¼‰ï¼Œè€ŒB+æ ‘åªæœ‰å¶å­ç»“ç‚¹å­˜æ”¾keyå’Œdataï¼Œå…¶ä»–å†…èŠ‚ç‚¹åªå­˜æ”¾key Bæ ‘çš„å¶å­èŠ‚ç‚¹éƒ½æ˜¯ç‹¬ç«‹çš„ï¼›B+æ ‘çš„å¶å­èŠ‚ç‚¹æœ‰ä¸€æ¡å¼•ç”¨é“¾æŒ‡å‘ä¸å®ƒç›¸é‚»çš„å¶å­èŠ‚ç‚¹ Bæ ‘çš„æ£€ç´¢çš„è¿‡ç¨‹ç›¸å½“äºå¯¹èŒƒå›´å†…çš„æ¯ä¸ªç»“ç‚¹çš„å…³é”®å­—åšäºŒåˆ†æŸ¥æ‰¾ï¼Œå¯èƒ½è¿˜æ²¡æœ‰åˆ°è¾¾å¶å­èŠ‚ç‚¹ï¼Œæ£€ç´¢å°±ç»“æŸäº†ã€‚è€ŒB+æ ‘çš„æ£€ç´¢æ•ˆç‡æ¯”è¾ƒç¨³å®šï¼Œä»»ä½•æŸ¥æ‰¾éƒ½æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼Œå¶å­ç»“ç‚¹çš„é¡ºåºæ£€ç´¢å¾ˆæ˜æ˜¾ Bæ ‘ä¸­æŸä¸ªå­èŠ‚ç‚¹ï¼Œä»–éƒ½åŒ…æ‹¬äº†çˆ¶èŠ‚ç‚¹çš„æŸä¸ªèŠ‚ç‚¹ å¦‚å›¾ åœ¨MySQLä¸­ï¼ŒMyISAMå¼•æ“å’ŒInnoDBå¼•æ“éƒ½æ˜¯ä½¿ç”¨B+Treeä½œä¸ºç´¢å¼•ç»“æ„ï¼Œä½†æ˜¯ï¼Œä¸¤è€…çš„å®ç°æ–¹å¼æœ‰ç‚¹ä¸å¤ªä¸€æ ·\nMyISAM å¼•æ“ä¸­ï¼ŒB+Tree å¶èŠ‚ç‚¹çš„ data åŸŸå­˜æ”¾çš„æ˜¯æ•°æ®è®°å½•çš„åœ°å€ã€‚åœ¨ç´¢å¼•æ£€ç´¢çš„æ—¶å€™ï¼Œé¦–å…ˆæŒ‰ç…§ B+Tree æœç´¢ç®—æ³•æœç´¢ç´¢å¼•ï¼Œå¦‚æœæŒ‡å®šçš„ Key å­˜åœ¨ï¼Œåˆ™å–å‡ºå…¶ data åŸŸçš„å€¼ï¼Œç„¶åä»¥ data åŸŸçš„å€¼ä¸ºåœ°å€è¯»å–ç›¸åº”çš„æ•°æ®è®°å½•ã€‚è¿™è¢«ç§°ä¸ºâ€œéèšç°‡ç´¢å¼•ï¼ˆéèšé›†ç´¢å¼•ï¼‰â€ã€‚ã€åä¾‹ï¼ŒB+ æ ‘éå¶å­èŠ‚ç‚¹æ²¡æœ‰å­˜å‚¨æ•°æ®è®°å½•çš„åœ°å€/æ•°æ®è®°å½•æœ¬èº«ã€‘ InnoDB å¼•æ“ä¸­ï¼Œå…¶æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ã€‚ MyISAM çš„ ç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œè€ŒInnoDBå¼•æ“ä¸­å…¶è¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯æŒ‰ B+Tree ç»„ç»‡çš„ä¸€ä¸ªç´¢å¼•ç»“æ„ï¼Œæ ‘çš„å¶èŠ‚ç‚¹ data åŸŸä¿å­˜äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ä¸ªç´¢å¼•çš„ key æ˜¯æ•°æ®è¡¨çš„ä¸»é”®ï¼ˆè€Œéåœ°å€ï¼‰ï¼Œå› æ­¤ InnoDB è¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ä¸»ç´¢å¼•ã€‚è¿™è¢«ç§°ä¸ºâ€œèšç°‡ç´¢å¼•ï¼ˆèšé›†ç´¢å¼•ï¼‰â€ï¼Œè€Œå…¶ä½™çš„ç´¢å¼•éƒ½ä½œä¸º è¾…åŠ©ç´¢å¼• ï¼Œè¾…åŠ©ç´¢å¼•çš„ data åŸŸå­˜å‚¨ç›¸åº”è®°å½•ä¸»é”®çš„å€¼è€Œä¸æ˜¯åœ°å€ï¼Œè¿™ä¹Ÿæ˜¯å’Œ MyISAM ä¸åŒçš„åœ°æ–¹ã€‚åœ¨æ ¹æ®ä¸»ç´¢å¼•æœç´¢æ—¶ï¼Œç›´æ¥æ‰¾åˆ° key æ‰€åœ¨çš„èŠ‚ç‚¹å³å¯å–å‡ºæ•°æ®ï¼›åœ¨æ ¹æ®è¾…åŠ©ç´¢å¼•æŸ¥æ‰¾æ—¶ï¼Œåˆ™éœ€è¦å…ˆå–å‡ºä¸»é”®çš„å€¼ï¼Œå†èµ°ä¸€éä¸»ç´¢å¼•ã€‚ åœ¨è®¾è®¡è¡¨çš„æ—¶å€™ï¼Œä¸å»ºè®®ä½¿ç”¨è¿‡é•¿çš„å­—æ®µä½œä¸ºä¸»é”®ï¼Œä¹Ÿä¸å»ºè®®ä½¿ç”¨éå•è°ƒçš„å­—æ®µä½œä¸ºä¸»é”®ï¼Œè¿™æ ·ä¼šé€ æˆä¸»ç´¢å¼•é¢‘ç¹åˆ†è£‚ã€‚\nåŸå› ï¼š InnoDBçš„è¾…åŠ©ç´¢å¼•dataåŸŸå­˜å‚¨ç›¸åº”è®°å½•ä¸»é”®çš„å€¼è€Œä¸æ˜¯åœ°å€ã€‚æ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨è¿‡é•¿çš„å­—æ®µä½œä¸ºä¸»é”®ï¼Œå› ä¸ºæ‰€æœ‰è¾…åŠ©ç´¢å¼•éƒ½å¼•ç”¨ä¸»ç´¢å¼•ï¼Œè¿‡é•¿çš„ä¸»ç´¢å¼•ä¼šä»¤è¾…åŠ©ç´¢å¼•å˜å¾—è¿‡å¤§ (ä¸å»ºè®®ä½¿ç”¨è¿‡é•¿çš„å­—æ®µä½œä¸ºä¸»é”®) InnoDBæ•°æ®æ–‡ä»¶æœ¬èº«æ˜¯ä¸€é¢—B+Treeï¼Œéå•è°ƒçš„ä¸»é”®ä¼šé€ æˆåœ¨æ’å…¥æ–°è®°å½•æ—¶æ•°æ®æ–‡ä»¶ä¸ºäº†ç»´æŒB+Treeçš„ç‰¹æ€§è€Œé¢‘ç¹çš„åˆ†è£‚è°ƒæ•´ï¼Œååˆ†ä½æ•ˆã€‚(ä¸å»ºè®®ä½¿ç”¨éå•è°ƒçš„å­—æ®µä½œä¸ºä¸»é”®) MySQLåº•å±‚æ•°æ®ç»“æ„æ€»ç»“ # ç´¢å¼•ç±»å‹æ€»ç»“ # æŒ‰ç…§æ•°æ®ç»“æ„ç»´åº¦åˆ’åˆ†ï¼š\nBTree ç´¢å¼•ï¼šMySQL é‡Œé»˜è®¤å’Œæœ€å¸¸ç”¨çš„ç´¢å¼•ç±»å‹ã€‚åªæœ‰å¶å­èŠ‚ç‚¹å­˜å‚¨ valueï¼Œéå¶å­èŠ‚ç‚¹åªæœ‰æŒ‡é’ˆå’Œ keyã€‚å­˜å‚¨å¼•æ“ MyISAM å’Œ InnoDB å®ç° BTree ç´¢å¼•éƒ½æ˜¯ä½¿ç”¨ B+Treeï¼Œä½†äºŒè€…å®ç°æ–¹å¼ä¸ä¸€æ ·ï¼ˆå‰é¢å·²ç»ä»‹ç»äº†ï¼‰ã€‚ å“ˆå¸Œç´¢å¼•ï¼šç±»ä¼¼é”®å€¼å¯¹çš„å½¢å¼ï¼Œä¸€æ¬¡å³å¯å®šä½ã€‚ RTree ç´¢å¼•ï¼šä¸€èˆ¬ä¸ä¼šä½¿ç”¨ï¼Œä»…æ”¯æŒ geometry æ•°æ®ç±»å‹ï¼Œä¼˜åŠ¿åœ¨äºèŒƒå›´æŸ¥æ‰¾ï¼Œæ•ˆç‡è¾ƒä½ï¼Œé€šå¸¸ä½¿ç”¨æœç´¢å¼•æ“å¦‚ ElasticSearch ä»£æ›¿ã€‚ å…¨æ–‡ç´¢å¼•ï¼šå¯¹æ–‡æœ¬çš„å†…å®¹è¿›è¡Œåˆ†è¯ï¼Œè¿›è¡Œæœç´¢ã€‚ç›®å‰åªæœ‰ CHARã€VARCHAR ï¼ŒTEXT åˆ—ä¸Šå¯ä»¥åˆ›å»ºå…¨æ–‡ç´¢å¼•ã€‚ä¸€èˆ¬ä¸ä¼šä½¿ç”¨ï¼Œæ•ˆç‡è¾ƒä½ï¼Œé€šå¸¸ä½¿ç”¨æœç´¢å¼•æ“å¦‚ ElasticSearch ä»£æ›¿ã€‚ æŒ‰ç…§åº•å±‚å­˜å‚¨æ–¹å¼è§’åº¦åˆ’åˆ†ï¼š\nèšç°‡ç´¢å¼•ï¼ˆèšé›†ç´¢å¼•ï¼‰ï¼šç´¢å¼•ç»“æ„å’Œæ•°æ®ä¸€èµ·å­˜æ”¾çš„ç´¢å¼•ï¼ŒInnoDB ä¸­çš„ä¸»é”®ç´¢å¼•å°±å±äºèšç°‡ç´¢å¼•ã€‚ éèšç°‡ç´¢å¼•ï¼ˆéèšé›†ç´¢å¼•ï¼‰ï¼šç´¢å¼•ç»“æ„å’Œæ•°æ®åˆ†å¼€å­˜æ”¾çš„ç´¢å¼•ï¼Œ**äºŒçº§ç´¢å¼•(è¾…åŠ©ç´¢å¼•)**å°±å±äºéèšç°‡ç´¢å¼•ã€‚MySQL çš„ MyISAM å¼•æ“ï¼Œä¸ç®¡ä¸»é”®è¿˜æ˜¯éä¸»é”®ï¼Œä½¿ç”¨çš„éƒ½æ˜¯éèšç°‡ç´¢å¼•ã€‚ æŒ‰ç…§åº”ç”¨ç»´åº¦åˆ’åˆ†ï¼š\nä¸»é”®ç´¢å¼•ï¼šåŠ é€ŸæŸ¥è¯¢ + åˆ—å€¼å”¯ä¸€ï¼ˆä¸å¯ä»¥æœ‰ NULLï¼‰+ è¡¨ä¸­åªæœ‰ä¸€ä¸ªã€‚ æ™®é€šç´¢å¼•ï¼šä»…åŠ é€ŸæŸ¥è¯¢ã€‚ å”¯ä¸€ç´¢å¼•ï¼šåŠ é€ŸæŸ¥è¯¢ + åˆ—å€¼å”¯ä¸€ï¼ˆå¯ä»¥æœ‰ NULLï¼‰ã€‚ è¦†ç›–ç´¢å¼•ï¼šä¸€ä¸ªç´¢å¼•åŒ…å«ï¼ˆæˆ–è€…è¯´è¦†ç›–ï¼‰æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µçš„å€¼ã€‚ è”åˆç´¢å¼•ï¼šå¤šåˆ—å€¼ç»„æˆä¸€ä¸ªç´¢å¼•ï¼Œä¸“é—¨ç”¨äºç»„åˆæœç´¢ï¼Œå…¶æ•ˆç‡å¤§äºç´¢å¼•åˆå¹¶ã€‚ å…¨æ–‡ç´¢å¼•ï¼šå¯¹æ–‡æœ¬çš„å†…å®¹è¿›è¡Œåˆ†è¯ï¼Œè¿›è¡Œæœç´¢ã€‚ç›®å‰åªæœ‰ CHARã€VARCHAR ï¼ŒTEXT åˆ—ä¸Šå¯ä»¥åˆ›å»ºå…¨æ–‡ç´¢å¼•ã€‚ä¸€èˆ¬ä¸ä¼šä½¿ç”¨ï¼Œæ•ˆç‡è¾ƒä½ï¼Œé€šå¸¸ä½¿ç”¨æœç´¢å¼•æ“å¦‚ ElasticSearch ä»£æ›¿ã€‚ MySQL 8.x ä¸­å®ç°çš„ç´¢å¼•æ–°ç‰¹æ€§ï¼š\néšè—ç´¢å¼•ï¼šä¹Ÿç§°ä¸ºä¸å¯è§ç´¢å¼•ï¼Œä¸ä¼šè¢«ä¼˜åŒ–å™¨ä½¿ç”¨ï¼Œä½†æ˜¯ä»ç„¶éœ€è¦ç»´æŠ¤ï¼Œé€šå¸¸ä¼šè½¯åˆ é™¤å’Œç°åº¦å‘å¸ƒçš„åœºæ™¯ä¸­ä½¿ç”¨ã€‚ä¸»é”®ä¸èƒ½è®¾ç½®ä¸ºéšè—ï¼ˆåŒ…æ‹¬æ˜¾å¼è®¾ç½®æˆ–éšå¼è®¾ç½®ï¼‰ã€‚ é™åºç´¢å¼•ï¼šä¹‹å‰çš„ç‰ˆæœ¬å°±æ”¯æŒé€šè¿‡ desc æ¥æŒ‡å®šç´¢å¼•ä¸ºé™åºï¼Œä½†å®é™…ä¸Šåˆ›å»ºçš„ä»ç„¶æ˜¯å¸¸è§„çš„å‡åºç´¢å¼•ã€‚ç›´åˆ° MySQL 8.x ç‰ˆæœ¬æ‰å¼€å§‹çœŸæ­£æ”¯æŒé™åºç´¢å¼•ã€‚å¦å¤–ï¼Œåœ¨ MySQL 8.x ç‰ˆæœ¬ä¸­ï¼Œä¸å†å¯¹ GROUP BY è¯­å¥è¿›è¡Œéšå¼æ’åºã€‚ å‡½æ•°ç´¢å¼•ï¼šä» MySQL 8.0.13 ç‰ˆæœ¬å¼€å§‹æ”¯æŒåœ¨ç´¢å¼•ä¸­ä½¿ç”¨å‡½æ•°æˆ–è€…è¡¨è¾¾å¼çš„å€¼ï¼Œä¹Ÿå°±æ˜¯åœ¨ç´¢å¼•ä¸­å¯ä»¥åŒ…å«å‡½æ•°æˆ–è€…è¡¨è¾¾å¼ã€‚ ç´¢å¼•ç±»å‹ # ä¸»é”®ç´¢å¼•ï¼ˆPrimary Keyï¼‰ # æ•°æ®è¡¨çš„ä¸»é”®åˆ—ï¼Œä½¿ç”¨çš„å°±æ˜¯ä¸»é”®ç´¢å¼• ä¸€å¼ æ•°æ®è¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Œå¹¶ä¸”ä¸»é”®ä¸èƒ½ä¸ºnullï¼Œä¸èƒ½é‡å¤ åœ¨ MySQL çš„ InnoDB çš„è¡¨ä¸­ï¼Œå½“æ²¡æœ‰æ˜¾ç¤ºçš„æŒ‡å®šè¡¨çš„ä¸»é”®æ—¶ï¼ŒInnoDB ä¼šè‡ªåŠ¨å…ˆæ£€æŸ¥è¡¨ä¸­æ˜¯å¦æœ‰å”¯ä¸€ç´¢å¼•ä¸”ä¸å…è®¸å­˜åœ¨ null å€¼çš„å­—æ®µï¼Œå¦‚æœæœ‰ï¼Œåˆ™é€‰æ‹©è¯¥å­—æ®µä¸ºé»˜è®¤çš„ä¸»é”®ï¼Œå¦åˆ™ InnoDB å°†ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª 6Byte çš„è‡ªå¢ä¸»é”® å¦‚å›¾ äºŒçº§ç´¢å¼•ï¼ˆè¾…åŠ©ç´¢å¼•ï¼‰ # äºŒçº§ç´¢å¼•åˆç§°ä¸ºè¾…åŠ©ç´¢å¼•ï¼Œæ˜¯å› ä¸ºäºŒçº§ç´¢å¼•çš„å¶å­ç»“ç‚¹å­˜å‚¨çš„æ•°æ®æ˜¯ä¸»é”®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡äºŒçº§ç´¢å¼•ï¼Œå¯ä»¥å®šä½ä¸»é”®çš„ä½ç½®ï¼ˆè¿˜æœ‰å€¼ï¼‰\nå”¯ä¸€ç´¢å¼•ã€æ™®é€šç´¢å¼•ã€å‰ç¼€ç´¢å¼•ç­‰ç´¢å¼•éƒ½å±äºäºŒçº§ç´¢å¼•\nå”¯ä¸€ç´¢å¼• Unique Keyï¼šæ˜¯ä¸€ç§çº¦æŸï¼Œè¯¥ç´¢å¼•çš„å±æ€§åˆ—ä¸èƒ½å‡ºç°é‡å¤çš„æ•°æ®ï¼Œä½†æ˜¯å…è®¸æ•°æ®ä¸ºNULLï¼Œä¸€å¼ è¡¨å…è®¸åˆ›å»ºå¤šä¸ªå”¯ä¸€ç´¢å¼•ã€‚å»ºç«‹å”¯ä¸€ç´¢å¼•çš„ç›®çš„å¤šæ˜¯ä¸ºäº†è¯¥å±æ€§åˆ—çš„æ•°æ®çš„å”¯ä¸€æ€§ï¼Œè€Œä¸æ˜¯ä¸ºäº†æŸ¥è¯¢æ•ˆç‡\næ™®é€šç´¢å¼• Indexï¼šæ™®é€šç´¢å¼•çš„å”¯ä¸€ä½œç”¨å°±æ˜¯ä¸ºäº†å¿«é€ŸæŸ¥è¯¢æ•°æ®ï¼Œä¸€å¼ è¡¨å…è®¸åˆ›å»ºå¤šä¸ªæ™®é€šç´¢å¼•ï¼Œå¹¶å…è®¸æ•°æ®é‡å¤å’ŒNULL\nå‰ç¼€ç´¢å¼• Prefixï¼šå‰ç¼€ç´¢å¼•åªé€‚ç”¨äºå­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ã€‚å‰ç¼€ç´¢å¼•æ˜¯å¯¹æ–‡æœ¬çš„å‰å‡ ä¸ªå­—ç¬¦åˆ›å»ºç´¢å¼•ï¼Œç›¸æ¯”æ™®é€šç´¢å¼•å»ºç«‹çš„æ•°æ®æ›´å°ï¼Œå› ä¸ºåªå–å‰å‡ ä¸ªå­—ç¬¦\nå…¨æ–‡ç´¢å¼•Full Textï¼šå…¨æ–‡ç´¢å¼•ä¸»è¦æ˜¯ä¸ºäº†æ£€ç´¢å¤§æ–‡æœ¬æ•°æ®ä¸­çš„å…³é”®å­—çš„ä¿¡æ¯ï¼Œæ˜¯ç›®å‰æœç´¢å¼•æ“æ•°æ®åº“ä½¿ç”¨çš„ä¸€ç§æŠ€æœ¯ã€‚\nMysql5.6 ä¹‹å‰åªæœ‰ MYISAM å¼•æ“æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œ5.6 ä¹‹å InnoDB ä¹Ÿæ”¯æŒäº†å…¨æ–‡ç´¢å¼•ã€‚\näºŒçº§ç´¢å¼•ï¼š èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼• # èšç°‡ç´¢å¼•ï¼ˆèšé›†ç´¢å¼•ï¼‰ # èšç°‡ç´¢å¼•ä»‹ç» èšç°‡ç´¢å¼•å³ç´¢å¼•ç»“æ„å’Œæ•°æ®ä¸€èµ·å­˜æ”¾çš„ç´¢å¼•ï¼Œå¹¶ä¸æ˜¯ä¸€ç§å•ç‹¬çš„ç´¢å¼•ç±»å‹ã€‚InnoDBä¸­çš„ä¸»é”®ç´¢å¼•å°±å±äºèšç°‡ç´¢å¼• MySQLä¸­InnoDBå¼•æ“çš„è¡¨çš„**.ibd æ–‡ä»¶å°±åŒ…å«äº†è¯¥è¡¨çš„ç´¢å¼•å’Œæ•°æ®**ï¼Œå¯¹äºInnoDBå¼•æ“è¡¨æ¥è¯´ï¼Œè¯¥è¡¨çš„ç´¢å¼•ï¼ˆB+æ ‘ï¼‰çš„æ¯ä¸ªéå¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•(å’Œé¡µåœ°å€)ï¼Œå¶å­ç»“ç‚¹å­˜å‚¨ç´¢å¼•å’Œç´¢å¼•å¯¹åº”çš„æ•°æ® èšç°‡ç´¢å¼•çš„ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ æŸ¥è¯¢é€Ÿåº¦éå¸¸å¿«ï¼šèšç°‡ç´¢å¼•çš„æŸ¥è¯¢é€Ÿåº¦éå¸¸çš„å¿«ï¼Œå› ä¸ºæ•´ä¸ªB+æ ‘æœ¬èº«å°±æ˜¯ä¸€é¢—å¤šå·®å¹³è¡¡æ ‘ï¼Œå¶å­èŠ‚ç‚¹ä¹Ÿéƒ½æ˜¯æœ‰åºçš„ï¼Œå®šä½åˆ°ç´¢å¼•çš„èŠ‚ç‚¹ï¼Œå°±ç›¸å½“äºå®šä½åˆ°äº†æ•°æ®ã€‚ç›¸æ¯”äºéèšç°‡ç´¢å¼•ï¼Œèšç°‡ç´¢å¼•å°‘äº†ä¸€æ¬¡è¯»å–æ•°æ®çš„IOæ“ä½œ å¯¹æ’åºæŸ¥æ‰¾å’ŒèŒƒå›´æŸ¥æ‰¾ä¼˜åŒ–ï¼šèšç°‡ç´¢å¼•å¯¹äºé€æ¸çš„æ’åºæŸ¥æ‰¾å’ŒèŒƒå›´æŸ¥æ‰¾é€Ÿåº¦éå¸¸å¿« ç¼ºç‚¹ ä¾èµ–äºæœ‰åºçš„æ•°æ®ï¼šå› ä¸ºB+æ ‘æ˜¯å¤šè·¯å¹³è¡¡æ ‘ï¼Œå¦‚æœç´¢å¼•çš„æ•°æ®ä¸æ˜¯æœ‰åºçš„ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨æ’å…¥æ—¶æ’åºã€‚å¦‚æœæ•°æ®æ˜¯æ•´å‹è¿˜å¥½ï¼Œå¦åˆ™ç±»ä¼¼äºå­—ç¬¦ä¸²æˆ–UUIDè¿™ç§åˆé•¿æœ‰éš¾æ¯”è¾ƒçš„æ•°æ®ï¼Œæ’å…¥æˆ–æŸ¥æ‰¾çš„é€Ÿåº¦è¾ƒæ…¢ æ›´æ–°ä»£ä»·å¤§ï¼šå¦‚æœå¯¹ç´¢å¼•åˆ—çš„æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œé‚£ä¹ˆå¯¹åº”çš„ç´¢å¼•ä¹Ÿå°†ä¼šè¢«ä¿®æ”¹ï¼Œè€Œä¸”èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹è¿˜å­˜æ”¾ç€æ•°æ®ï¼Œä¿®æ”¹ä»£ä»·è‚¯å®šæ˜¯è¾ƒå¤§çš„ï¼Œæ‰€ä»¥å¯¹äºä¸»é”®ç´¢å¼•æ¥è¯´ï¼Œä¸»é”®ä¸€èˆ¬éƒ½æ˜¯ä¸å¯è¢«ä¿®æ”¹çš„ éèšç°‡ç´¢å¼•ï¼ˆéèšé›†ç´¢å¼•ï¼‰ # ä¼˜ç‚¹ï¼š\næ›´æ–°ä»£ä»·æ¯”èšç°‡ç´¢å¼•è¦å°ã€‚å› ä¸ºéèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹æ˜¯ä¸å­˜æ”¾æ•°æ®çš„\nç¼ºç‚¹ï¼š\nä¾èµ–äºæœ‰åºæ•°æ®ï¼šè·Ÿèšç°‡ç´¢å¼•ä¸€æ ·ï¼Œéèšç°‡ç´¢å¼•ä¹Ÿä¾èµ–äºæœ‰åºæ•°æ® å¯èƒ½ä¼šäºŒæ¬¡æŸ¥è¯¢ï¼ˆå›è¡¨ï¼‰ï¼šè¿™åº”è¯¥æ˜¯éèšç°‡ç´¢å¼•æœ€å¤§çš„ç¼ºç‚¹äº†ã€‚ å½“æŸ¥åˆ°ç´¢å¼•å¯¹åº”çš„æŒ‡é’ˆæˆ–ä¸»é”®åï¼Œå¯èƒ½è¿˜éœ€è¦æ ¹æ®æŒ‡é’ˆæˆ–ä¸»é”®å†åˆ°æ•°æ®æ–‡ä»¶æˆ–è¡¨ä¸­æŸ¥è¯¢ MySQLçš„è¡¨çš„æ–‡ä»¶æˆªå›¾ï¼š èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ï¼š\nèšç°‡ç´¢å¼•ä¸€å®šå›è¡¨æŸ¥è¯¢å—(è¦†ç›–ç´¢å¼•)\néèšç°‡ç´¢å¼•ä¸ä¸€å®šå›è¡¨æŸ¥è¯¢\nè¯•æƒ³ä¸€ç§æƒ…å†µï¼Œç”¨æˆ·å‡†å¤‡ä½¿ç”¨ SQL æŸ¥è¯¢ç”¨æˆ·åï¼Œè€Œç”¨æˆ·åå­—æ®µæ­£å¥½å»ºç«‹äº†ç´¢å¼•ã€‚\nSELECT name FROM table WHERE name=\u0026#39;guang19\u0026#39;; é‚£ä¹ˆè¿™ä¸ªç´¢å¼•çš„ key æœ¬èº«å°±æ˜¯ nameï¼ŒæŸ¥åˆ°å¯¹åº”çš„ name ç›´æ¥è¿”å›å°±è¡Œäº†ï¼Œæ— éœ€å›è¡¨æŸ¥è¯¢ã€‚\nå³ä½¿æ˜¯ MYISAM ä¹Ÿæ˜¯è¿™æ ·ï¼Œè™½ç„¶ MYISAM çš„ä¸»é”®ç´¢å¼•ç¡®å®éœ€è¦å›è¡¨ï¼Œå› ä¸ºå®ƒçš„ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯æŒ‡é’ˆã€‚ä½†æ˜¯ï¼å¦‚æœ SQL æŸ¥çš„å°±æ˜¯ä¸»é”®(æœ¬èº«)å‘¢?\nSELECT id FROM table WHERE id=1; ä¸»é”®ç´¢å¼•æœ¬èº«çš„ key å°±æ˜¯ä¸»é”®ï¼ŒæŸ¥åˆ°è¿”å›å°±è¡Œäº†ã€‚è¿™ç§æƒ…å†µå°±ç§°ä¹‹ä¸ºè¦†ç›–ç´¢å¼•äº†\nè¦†ç›–ç´¢å¼•å’Œè”åˆç´¢å¼• # è¦†ç›–ç´¢å¼• # å¦‚æœä¸€ä¸ªç´¢å¼•åŒ…å«ï¼ˆæˆ–è€…è¯´è¦†ç›–ï¼‰æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µçš„å€¼ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸ºâ€œè¦†ç›–ç´¢å¼•â€ã€‚ï¼ˆä¹Ÿå°±æ˜¯ä¸ç”¨å›è¡¨ï¼‰\næˆ‘ä»¬çŸ¥é“åœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œå¦‚æœä¸æ˜¯ä¸»é”®ç´¢å¼•ï¼ˆå¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®+åˆ—å€¼ï¼‰ï¼Œæœ€ç»ˆè¿˜æ˜¯è¦â€œå›è¡¨â€ï¼Œä¹Ÿå°±æ˜¯è¦é€šè¿‡ä¸»é”®å†æŸ¥æ‰¾ä¸€æ¬¡ï¼Œè¿™æ ·å°±ä¼šæ¯”è¾ƒæ…¢ã€‚è¦†ç›–ç´¢å¼•å°±æ˜¯æŠŠè¦æŸ¥è¯¢å‡ºçš„åˆ—å’Œç´¢å¼•æ˜¯å¯¹åº”çš„ï¼Œä¸åšå›è¡¨æ“ä½œï¼\nè¦†ç›–ç´¢å¼•å³éœ€è¦æŸ¥è¯¢çš„å­—æ®µæ­£å¥½äº‹ç´¢å¼•çš„å­—æ®µï¼Œé‚£ä¹ˆç›´æ¥æ ¹æ®è¯¥ç´¢å¼•ï¼Œå°±å¯ä»¥æŸ¥åˆ°æ•°æ®äº†ï¼Œè€Œæ— éœ€å›è¡¨æŸ¥è¯¢\nå¦‚ä¸»é”®ç´¢å¼•ï¼Œå¦‚æœä¸€æ¡ SQL éœ€è¦æŸ¥è¯¢ä¸»é”®ï¼Œé‚£ä¹ˆæ­£å¥½æ ¹æ®ä¸»é”®ç´¢å¼•å°±å¯ä»¥æŸ¥åˆ°ä¸»é”®ã€‚\nå†å¦‚æ™®é€šç´¢å¼•ï¼Œå¦‚æœä¸€æ¡ SQL éœ€è¦æŸ¥è¯¢ nameï¼Œname å­—æ®µæ­£å¥½æœ‰ç´¢å¼•ï¼Œ é‚£ä¹ˆç›´æ¥æ ¹æ®è¿™ä¸ªç´¢å¼•å°±å¯ä»¥æŸ¥åˆ°æ•°æ®ï¼Œä¹Ÿæ— éœ€å›è¡¨ã€‚\næˆ‘è§‰å¾—è¦†ç›–ç´¢å¼•è¦åœ¨è”åˆç´¢å¼•ä¸Šä½“ç°çš„è¯åŠŸèƒ½ä¼šæ¯”è¾ƒçªå‡º\nè”åˆç´¢å¼• # ä½¿ç”¨è¡¨ä¸­çš„å¤šä¸ªå­—æ®µåˆ›å»ºç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯è”åˆç´¢å¼•ï¼Œä¹Ÿå«ç»„åˆç´¢å¼•ï¼Œæˆ–å¤åˆç´¢å¼•\næœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ # æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™æŒ‡çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨è”åˆç´¢å¼•æ—¶ï¼ŒMySQL ä¼šæ ¹æ®è”åˆç´¢å¼•ä¸­çš„å­—æ®µé¡ºåºï¼Œä»å·¦åˆ°å³ä¾æ¬¡åˆ°æŸ¥è¯¢æ¡ä»¶ä¸­å»åŒ¹é…ï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­å­˜åœ¨ä¸è”åˆç´¢å¼•ä¸­æœ€å·¦ä¾§å­—æ®µç›¸åŒ¹é…çš„å­—æ®µï¼Œåˆ™å°±ä¼šä½¿ç”¨è¯¥å­—æ®µè¿‡æ»¤ä¸€æ‰¹æ•°æ®ï¼Œç›´è‡³è”åˆç´¢å¼•ä¸­å…¨éƒ¨å­—æ®µåŒ¹é…å®Œæˆï¼Œæˆ–è€…åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°èŒƒå›´æŸ¥è¯¢ï¼Œå¦‚ \u0026gt;ã€\u0026lt;ã€between å’Œ ä»¥%å¼€å¤´çš„likeæŸ¥è¯¢ ç­‰æ¡ä»¶ï¼Œæ‰ä¼šåœæ­¢åŒ¹é…ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨è”åˆç´¢å¼•æ—¶ï¼Œå¯ä»¥å°†åŒºåˆ†åº¦é«˜çš„å­—æ®µæ”¾åœ¨æœ€å·¦è¾¹ï¼Œè¿™ä¹Ÿå¯ä»¥è¿‡æ»¤æ›´å¤šæ•°æ® ç´¢å¼•ä¸‹æ¨ # ç´¢å¼•ä¸‹æ¨ï¼ˆIndex Condition Pushdownï¼‰ æ˜¯ MySQL 5.6 ç‰ˆæœ¬ä¸­æä¾›çš„ä¸€é¡¹ç´¢å¼•ä¼˜åŒ–åŠŸèƒ½ï¼Œå¯ä»¥åœ¨éèšç°‡ç´¢å¼•éå†è¿‡ç¨‹ä¸­ï¼Œå¯¹ï¼ˆå³èƒ½ç”¨ç´¢å¼•å…ˆç”¨ç´¢å¼•ï¼‰ç´¢å¼•ä¸­åŒ…å«çš„å­—æ®µå…ˆåšåˆ¤æ–­ï¼Œè¿‡æ»¤æ‰ä¸ç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°ã€‚\nä¾‹å­ï¼š\nå¯¹äºSELECT * from user where name like 'é™ˆ%' and age=20è¿™æ¡è¯­å¥ å…¶ä¸­ä¸»è¦å‡ ä¸ªå­—æ®µæœ‰ï¼šidã€nameã€ageã€addressã€‚å»ºç«‹è”åˆç´¢å¼•ï¼ˆnameï¼Œageï¼‰\næœ€å…³é”®çš„ä¸€ç‚¹ï¼š ç»„åˆç´¢å¼•æ»¡è¶³æœ€å·¦åŒ¹é…ï¼Œä½†æ˜¯é‡åˆ°éç­‰å€¼åˆ¤æ–­æ—¶åŒ¹é…åœæ­¢ã€‚ name like \u0026lsquo;é™ˆ%\u0026rsquo; ä¸æ˜¯ç­‰å€¼åŒ¹é…ï¼Œæ‰€ä»¥ age = 20 è¿™é‡Œå°±ç”¨ä¸ä¸Š (name,age) ç»„åˆç´¢å¼•äº†ã€‚å¦‚æœæ²¡æœ‰ç´¢å¼•ä¸‹æ¨ï¼Œç»„åˆç´¢å¼•åªèƒ½ç”¨åˆ° nameï¼Œage çš„åˆ¤å®šå°±éœ€è¦å›è¡¨æ‰èƒ½åšäº†ã€‚5.6ä¹‹åæœ‰äº†ç´¢å¼•ä¸‹æ¨ï¼Œage = 20 å¯ä»¥ç›´æ¥åœ¨ç»„åˆç´¢å¼•é‡Œåˆ¤å®šã€‚\n5.6ä¹‹å‰çš„ç‰ˆæœ¬æ˜¯æ²¡æœ‰ç´¢å¼•ä¸‹æ¨è¿™ä¸ªä¼˜åŒ–çš„ï¼Œä¼šå¿½ç•¥ageè¿™ä¸ªå­—æ®µï¼Œç›´æ¥é€šè¿‡nameè¿›è¡ŒæŸ¥è¯¢ï¼Œåœ¨(name,age)è¿™è¯¾æ ‘ä¸ŠæŸ¥æ‰¾åˆ°äº†ä¸¤ä¸ªç»“æœï¼Œidåˆ†åˆ«ä¸º2,1ï¼Œç„¶åæ‹¿ç€å–åˆ°çš„idå€¼ä¸€æ¬¡æ¬¡çš„å›è¡¨æŸ¥è¯¢ï¼Œå› æ­¤è¿™ä¸ªè¿‡ç¨‹éœ€è¦å›è¡¨ä¸¤æ¬¡ 5.6ç‰ˆæœ¬æ·»åŠ äº†ç´¢å¼•ä¸‹æ¨è¿™ä¸ªä¼˜åŒ– InnoDBå¹¶æ²¡æœ‰å¿½ç•¥ageè¿™ä¸ªå­—æ®µï¼Œè€Œæ˜¯åœ¨ç´¢å¼•å†…éƒ¨å°±åˆ¤æ–­äº†ageæ˜¯å¦ç­‰äº20ï¼Œå¯¹äºä¸ç­‰äº20çš„è®°å½•ç›´æ¥è·³è¿‡ï¼Œå› æ­¤åœ¨(name,age)è¿™æ£µç´¢å¼•æ ‘ä¸­åªåŒ¹é…åˆ°äº†ä¸€ä¸ªè®°å½•ï¼Œæ­¤æ—¶æ‹¿ç€è¿™ä¸ªidå»ä¸»é”®ç´¢å¼•æ ‘ä¸­å›è¡¨æŸ¥è¯¢å…¨éƒ¨æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹åªéœ€è¦å›è¡¨ä¸€æ¬¡ äº‰å–ä½¿ç”¨ç´¢å¼•çš„ä¸€äº›å»ºè®® # é€‰æ‹©åˆé€‚çš„å­—æ®µåˆ›å»ºç´¢å¼• # ä¸ä¸º NULL çš„å­—æ®µ ï¼šç´¢å¼•å­—æ®µçš„æ•°æ®åº”è¯¥å°½é‡ä¸ä¸º NULLï¼Œå› ä¸ºå¯¹äºæ•°æ®ä¸º NULL çš„å­—æ®µï¼Œæ•°æ®åº“è¾ƒéš¾ä¼˜åŒ–ã€‚å¦‚æœå­—æ®µé¢‘ç¹è¢«æŸ¥è¯¢ï¼Œä½†åˆé¿å…ä¸äº†ä¸º NULLï¼Œå»ºè®®ä½¿ç”¨ 0,1,true,false è¿™æ ·è¯­ä¹‰è¾ƒä¸ºæ¸…æ™°çš„çŸ­å€¼æˆ–çŸ­å­—ç¬¦ä½œä¸ºæ›¿ä»£ã€‚ è¢«é¢‘ç¹æŸ¥è¯¢çš„å­—æ®µ ï¼šæˆ‘ä»¬åˆ›å»ºç´¢å¼•çš„å­—æ®µåº”è¯¥æ˜¯æŸ¥è¯¢æ“ä½œéå¸¸é¢‘ç¹çš„å­—æ®µã€‚ è¢«ä½œä¸ºæ¡ä»¶æŸ¥è¯¢çš„å­—æ®µ ï¼šè¢«ä½œä¸º WHERE æ¡ä»¶æŸ¥è¯¢çš„å­—æ®µï¼Œåº”è¯¥è¢«è€ƒè™‘å»ºç«‹ç´¢å¼•ã€‚ é¢‘ç¹éœ€è¦æ’åºçš„å­—æ®µ ï¼šç´¢å¼•å·²ç»æ’åºï¼Œè¿™æ ·æŸ¥è¯¢å¯ä»¥åˆ©ç”¨ç´¢å¼•çš„æ’åºï¼ŒåŠ å¿«æ’åºæŸ¥è¯¢æ—¶é—´ã€‚ è¢«ç»å¸¸é¢‘ç¹ç”¨äºè¿æ¥çš„å­—æ®µ ï¼šç»å¸¸ç”¨äºè¿æ¥çš„å­—æ®µå¯èƒ½æ˜¯ä¸€äº›å¤–é”®åˆ—ï¼Œå¯¹äºå¤–é”®åˆ—å¹¶ä¸ä¸€å®šè¦å»ºç«‹å¤–é”®ï¼Œåªæ˜¯è¯´è¯¥åˆ—æ¶‰åŠåˆ°è¡¨ä¸è¡¨çš„å…³ç³»ã€‚å¯¹äºé¢‘ç¹è¢«è¿æ¥æŸ¥è¯¢çš„å­—æ®µï¼Œå¯ä»¥è€ƒè™‘å»ºç«‹ç´¢å¼•ï¼Œæé«˜å¤šè¡¨è¿æ¥æŸ¥è¯¢çš„æ•ˆç‡ è¢«é¢‘ç¹æ›´æ–°çš„å­—æ®µåº”è¯¥æ…é‡å»ºç´¢å¼• # è™½ç„¶ç´¢å¼•èƒ½å¸¦æ¥æŸ¥è¯¢ä¸Šçš„æ•ˆç‡ï¼Œä½†æ˜¯ç»´æŠ¤ç´¢å¼•çš„æˆæœ¬ä¹Ÿæ˜¯ä¸å°çš„ã€‚ å¦‚æœä¸€ä¸ªå­—æ®µä¸è¢«ç»å¸¸æŸ¥è¯¢ï¼Œåè€Œè¢«ç»å¸¸ä¿®æ”¹ï¼Œé‚£ä¹ˆå°±æ›´ä¸åº”è¯¥åœ¨è¿™ç§å­—æ®µä¸Šå»ºç«‹ç´¢å¼•äº†ã€‚\nå°½å¯èƒ½åœ°è€ƒè™‘å»ºç«‹è”åˆç´¢å¼•è€Œä¸æ˜¯å•åˆ—ç´¢å¼• # å› ä¸ºç´¢å¼•æ˜¯éœ€è¦å ç”¨ç£ç›˜ç©ºé—´çš„ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºæ¯ä¸ªç´¢å¼•éƒ½å¯¹åº”ç€ä¸€é¢— B+æ ‘ã€‚å¦‚æœä¸€ä¸ªè¡¨çš„å­—æ®µè¿‡å¤šï¼Œç´¢å¼•è¿‡å¤šï¼Œé‚£ä¹ˆå½“è¿™ä¸ªè¡¨çš„æ•°æ®è¾¾åˆ°ä¸€ä¸ªä½“é‡åï¼Œç´¢å¼•å ç”¨çš„ç©ºé—´ä¹Ÿæ˜¯å¾ˆå¤šçš„ï¼Œä¸”ä¿®æ”¹ç´¢å¼•æ—¶ï¼Œè€—è´¹çš„æ—¶é—´ä¹Ÿæ˜¯è¾ƒå¤šçš„ã€‚å¦‚æœæ˜¯è”åˆç´¢å¼•ï¼Œå¤šä¸ªå­—æ®µåœ¨ä¸€ä¸ªç´¢å¼•ä¸Šï¼Œé‚£ä¹ˆå°†ä¼šèŠ‚çº¦å¾ˆå¤§ç£ç›˜ç©ºé—´ï¼Œä¸”ä¿®æ”¹æ•°æ®çš„æ“ä½œæ•ˆç‡ä¹Ÿä¼šæå‡ã€‚\næ³¨æ„é¿å…å†—ä½™ç´¢å¼• # å†—ä½™ç´¢å¼•æŒ‡çš„æ˜¯ç´¢å¼•çš„åŠŸèƒ½ç›¸åŒï¼Œèƒ½å¤Ÿå‘½ä¸­ç´¢å¼•(a, b)å°±è‚¯å®šèƒ½å‘½ä¸­ç´¢å¼•(a) ï¼Œé‚£ä¹ˆç´¢å¼•(a)å°±æ˜¯å†—ä½™ç´¢å¼•\nï¼ˆname,city ï¼‰å’Œï¼ˆname ï¼‰è¿™ä¸¤ä¸ªç´¢å¼•å°±æ˜¯å†—ä½™ç´¢å¼•ï¼Œèƒ½å¤Ÿå‘½ä¸­å‰è€…çš„æŸ¥è¯¢è‚¯å®šæ˜¯èƒ½å¤Ÿå‘½ä¸­åè€…çš„ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œéƒ½åº”è¯¥å°½é‡æ‰©å±•å·²æœ‰çš„ç´¢å¼•è€Œä¸æ˜¯åˆ›å»ºæ–°ç´¢å¼•\nè€ƒè™‘åœ¨å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µä¸Šä½¿ç”¨å‰ç¼€ç´¢å¼•ä»£æ›¿æ™®é€šç´¢å¼• # å‰ç¼€ç´¢å¼•ä»…é™äºå­—ç¬¦ä¸²ç±»å‹ï¼Œè¾ƒæ™®é€šç´¢å¼•ä¼šå ç”¨æ›´å°çš„ç©ºé—´ï¼Œæ‰€ä»¥å¯ä»¥è€ƒè™‘ä½¿ç”¨å‰ç¼€ç´¢å¼•å¸¦æ›¿æ™®é€šç´¢å¼•ã€‚\né¿å…ç´¢å¼•å¤±æ•ˆ # ä½¿ç”¨ SELECT * è¿›è¡ŒæŸ¥è¯¢;\nåˆ›å»ºäº†ç»„åˆç´¢å¼•ï¼Œä½†æŸ¥è¯¢æ¡ä»¶æœªå‡†å®ˆæœ€å·¦åŒ¹é…åŸåˆ™;\nåœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè®¡ç®—ã€å‡½æ•°ã€ç±»å‹è½¬æ¢ç­‰æ“ä½œ;\nä»¥ % å¼€å¤´çš„ LIKE æŸ¥è¯¢æ¯”å¦‚ like '%abc';\n%åœ¨å·¦è¾¹ï¼Œå³ä½¿æœ‰ç´¢å¼•ï¼Œä¹Ÿä¼šå¤±æ•ˆ åªæœ‰å½“%åœ¨å³è¾¹æ—¶ï¼Œæ‰ä¼šç”Ÿæ•ˆ æŸ¥è¯¢æ¡ä»¶ä¸­ä½¿ç”¨ orï¼Œä¸” or çš„å‰åæ¡ä»¶ä¸­æœ‰ä¸€ä¸ªåˆ—æ²¡æœ‰ç´¢å¼•ï¼Œæ¶‰åŠçš„ç´¢å¼•éƒ½ä¸ä¼šè¢«ä½¿ç”¨åˆ°(ä¹Ÿå°±æ˜¯è¯´ï¼Œåæ­£éƒ½æ˜¯è¦å…¨è¡¨æ‰«æï¼Œæ‰€ä»¥å°±ä¸ç”¨ç´¢å¼•äº†)\nåˆ é™¤é•¿æœŸæœªä½¿ç”¨çš„ç´¢å¼• # åˆ é™¤é•¿æœŸæœªä½¿ç”¨çš„ç´¢å¼•ï¼Œä¸ç”¨çš„ç´¢å¼•çš„å­˜åœ¨ä¼šé€ æˆä¸å¿…è¦çš„æ€§èƒ½æŸè€—\nMySQL 5.7 å¯ä»¥é€šè¿‡æŸ¥è¯¢ sys åº“çš„ schema_unused_indexes è§†å›¾æ¥æŸ¥è¯¢å“ªäº›ç´¢å¼•ä»æœªè¢«ä½¿ç”¨\n"},{"id":113,"href":"/zh/docs/study/Review/java_guide/database/ly0502lycharactor-set/","title":"å­—ç¬¦é›†è¯¦è§£","section":"æ•°æ®åº“","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nå›¾ç¤ºæ€»ç»“\nMySQLå­—ç¬¦ç¼–ç é›†æœ‰ä¸¤å¥—UTF-8ç¼–ç å®ç°ï¼šutf-8 å’Œ utf8mb4\nè€Œå…¶ä¸­ï¼Œutf-8 ä¸æ”¯æŒå­˜å‚¨emojiç¬¦å·å’Œä¸€äº›æ¯”è¾ƒå¤æ‚çš„æ±‰å­—ã€ç¹ä½“å­—ï¼Œä¼šå‡ºé”™ ä½•ä¸ºå­—ç¬¦é›† # å­—ç¬¦æ˜¯å„ç§æ–‡å­—å’Œç¬¦å·çš„ç»Ÿç§°ï¼ŒåŒ…æ‹¬å„ä¸ªå›½å®¶æ–‡å­—ã€æ ‡ç‚¹ç¬¦å·ã€è¡¨æƒ…ã€æ•°å­—ç­‰ç­‰\nå­—ç¬¦é›†å°±æ˜¯ä¸€ç³»åˆ—å­—ç¬¦çš„é›†åˆï¼Œå­—ç¬¦é›†çš„ç§ç±»è¾ƒå¤šï¼Œæ¯ä¸ªå­—ç¬¦é›†å¯ä»¥è¡¨ç¤ºçš„å­—ç¬¦èŒƒå›´é€šå¸¸ä¸åŒï¼Œå°±æ¯”å¦‚è¯´æœ‰äº›å­—ç¬¦é›†æ— æ³•è¡¨ç¤ºæ±‰å­— è®¡ç®—æœºåªèƒ½å­˜å‚¨äºŒè¿›åˆ¶çš„æ•°æ®ï¼Œé‚£è‹±æ–‡ã€æ±‰å­—ã€è¡¨æƒ…ç­‰å­—ç¬¦åº”è¯¥å¦‚ä½•å­˜å‚¨å‘¢\næˆ‘ä»¬è¦å°†è¿™äº›å­—ç¬¦å’ŒäºŒè¿›åˆ¶çš„æ•°æ®ä¸€ä¸€å¯¹åº”èµ·æ¥ï¼Œæ¯”å¦‚è¯´å­—ç¬¦â€œaâ€å¯¹åº”â€œ01100001â€ï¼Œåä¹‹ï¼Œâ€œ01100001â€å¯¹åº” â€œaâ€ã€‚æˆ‘ä»¬å°†å­—ç¬¦å¯¹åº”äºŒè¿›åˆ¶æ•°æ®çš„è¿‡ç¨‹ç§°ä¸º\u0026quot;å­—ç¬¦ç¼–ç \u0026quot;ï¼Œåä¹‹ï¼ŒäºŒè¿›åˆ¶æ•°æ®è§£ææˆå­—ç¬¦çš„è¿‡ç¨‹ç§°ä¸ºâ€œå­—ç¬¦è§£ç â€ã€‚\næœ‰å“ªäº›å¸¸è§çš„å­—ç¬¦é›† # å¸¸è§çš„å­—ç¬¦é›†æœ‰ASCLLã€GB2312ã€GBKã€UTF-8 ä¸åŒçš„å­—ç¬¦é›†çš„ä¸»è¦åŒºåˆ«åœ¨äº å¯ä»¥è¡¨ç¤ºçš„å­—ç¬¦èŒƒå›´ ç¼–ç æ–¹å¼ ASCLL # ASCII (American Standard Code for Information Interchangeï¼Œç¾å›½ä¿¡æ¯äº¤æ¢æ ‡å‡†ä»£ç ) æ˜¯ä¸€å¥—ä¸»è¦ç”¨äºç°ä»£ç¾å›½è‹±è¯­çš„å­—ç¬¦é›†ï¼ˆè¿™ä¹Ÿæ˜¯ ASCII å­—ç¬¦é›†çš„å±€é™æ€§æ‰€åœ¨ï¼‰\nä¸ºä»€ä¹ˆ ASCII å­—ç¬¦é›†æ²¡æœ‰è€ƒè™‘åˆ°ä¸­æ–‡ç­‰å…¶ä»–å­—ç¬¦å‘¢ï¼Ÿ å› ä¸ºè®¡ç®—æœºæ˜¯ç¾å›½äººå‘æ˜çš„ï¼Œå½“æ—¶ï¼Œè®¡ç®—æœºçš„å‘å±•è¿˜å¤„äºæ¯”è¾ƒé›å½¢çš„æ—¶ä»£ï¼Œè¿˜æœªåœ¨å…¶ä»–å›½å®¶å¤§è§„æ¨¡ä½¿ç”¨ã€‚å› æ­¤ï¼Œç¾å›½å‘å¸ƒ ASCII å­—ç¬¦é›†çš„æ—¶å€™æ²¡æœ‰è€ƒè™‘å…¼å®¹å…¶ä»–å›½å®¶çš„è¯­è¨€\nASCII å­—ç¬¦é›†è‡³ä»Šä¸ºæ­¢å…±å®šä¹‰äº† 128 ä¸ªå­—ç¬¦ï¼Œå…¶ä¸­æœ‰ 33 ä¸ªæ§åˆ¶å­—ç¬¦ï¼ˆæ¯”å¦‚å›è½¦ã€åˆ é™¤ï¼‰æ— æ³•æ˜¾ç¤º\nä¸€ä¸ª ASCII ç é•¿åº¦æ˜¯ä¸€ä¸ªå­—èŠ‚ä¹Ÿå°±æ˜¯ 8 ä¸ª bitï¼Œæ¯”å¦‚â€œaâ€å¯¹åº”çš„ ASCII ç æ˜¯â€œ01100001â€ã€‚ä¸è¿‡ï¼Œæœ€é«˜ä½æ˜¯ 0 ä»…ä»…ä½œä¸ºæ ¡éªŒä½ï¼Œå…¶ä½™ 7 ä½ä½¿ç”¨ 0 å’Œ 1 è¿›è¡Œç»„åˆï¼Œæ‰€ä»¥ï¼ŒASCII å­—ç¬¦é›†å¯ä»¥å®šä¹‰ 128ï¼ˆ2^7ï¼‰ä¸ªå­—ç¬¦\nç”±äºï¼ŒASCII ç å¯ä»¥è¡¨ç¤ºçš„å­—ç¬¦å®åœ¨æ˜¯å¤ªå°‘äº†ã€‚åæ¥ï¼Œäººä»¬å¯¹å…¶è¿›è¡Œäº†æ‰©å±•å¾—åˆ°äº† ASCII æ‰©å±•å­—ç¬¦é›† ã€‚ASCII æ‰©å±•å­—ç¬¦é›†ä½¿ç”¨ 8 ä½ï¼ˆbitsï¼‰è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥ï¼ŒASCII æ‰©å±•å­—ç¬¦é›†å¯ä»¥å®šä¹‰ 256ï¼ˆ2^8ï¼‰ä¸ªå­—ç¬¦\næ€»å…±128ä¸ªï¼Œä¸‹é¢å°‘äº†33ä¸ªæ— æ³•æ˜¾ç¤ºçš„æ§åˆ¶å­—ç¬¦ GB2312 # æˆ‘ä»¬ä¸Šé¢è¯´äº†ï¼ŒASCII å­—ç¬¦é›†æ˜¯ä¸€ç§ç°ä»£ç¾å›½è‹±è¯­é€‚ç”¨çš„å­—ç¬¦é›†ã€‚å› æ­¤ï¼Œå¾ˆå¤šå›½å®¶éƒ½æ£é¼“äº†ä¸€ä¸ªé€‚åˆè‡ªå·±å›½å®¶è¯­è¨€çš„å­—ç¬¦é›†ã€‚\nGB2312 å­—ç¬¦é›†æ˜¯ä¸€ç§å¯¹æ±‰å­—æ¯”è¾ƒå‹å¥½çš„å­—ç¬¦é›†ï¼Œå…±æ”¶å½• 6700 å¤šä¸ªæ±‰å­—ï¼ŒåŸºæœ¬æ¶µç›–äº†ç»å¤§éƒ¨åˆ†å¸¸ç”¨æ±‰å­—ã€‚ä¸è¿‡ï¼ŒGB2312 å­—ç¬¦é›†ä¸æ”¯æŒç»å¤§éƒ¨åˆ†çš„ç”Ÿåƒ»å­—å’Œç¹ä½“å­— ï¼ˆå¯¹äºä¸­è‹±æ–‡å­—ç¬¦ï¼Œä½¿ç”¨çš„å­—èŠ‚æ•°ä¸ä¸€æ · ( 1å’Œ2 ) ï¼‰å¯¹äºè‹±è¯­å­—ç¬¦ï¼ŒGB2312 ç¼–ç å’Œ ASCII ç æ˜¯ç›¸åŒçš„ï¼Œ1 å­—èŠ‚ç¼–ç å³å¯ã€‚å¯¹äºéè‹±å­—ç¬¦ï¼Œéœ€è¦ 2 å­—èŠ‚ç¼–ç ã€‚ GBK # GBK å­—ç¬¦é›†å¯ä»¥çœ‹ä½œæ˜¯ GB2312 å­—ç¬¦é›†çš„æ‰©å±•ï¼Œå…¼å®¹ GB2312 å­—ç¬¦é›†ï¼Œå…±æ”¶å½•äº† 20000 å¤šä¸ªæ±‰å­—ã€‚\nGBK ä¸­ K æ˜¯æ±‰è¯­æ‹¼éŸ³ Kuo Zhanï¼ˆæ‰©å±•ï¼‰ä¸­çš„â€œKuoâ€çš„é¦–å­—æ¯\nGB18030 # GB18030 å®Œå…¨å…¼å®¹ GB2312 å’Œ GBK å­—ç¬¦é›†ï¼Œçº³å…¥ä¸­å›½å›½å†…å°‘æ•°æ°‘æ—çš„æ–‡å­—ï¼Œä¸”æ”¶å½•äº†æ—¥éŸ©æ±‰å­—ï¼Œæ˜¯ç›®å‰ä¸ºæ­¢æœ€å…¨é¢çš„æ±‰å­—å­—ç¬¦é›†ï¼Œå…±æ”¶å½•æ±‰å­— 70000 å¤šä¸ª\nBIG5 # BIG5 ä¸»è¦é’ˆå¯¹çš„æ˜¯ç¹ä½“ä¸­æ–‡ï¼Œæ”¶å½•äº† 13000 å¤šä¸ªæ±‰å­—ã€‚\nUnicode \u0026amp; UTF-8ç¼–ç  # äº†æ›´åŠ é€‚åˆæœ¬å›½è¯­è¨€ï¼Œè¯ç”Ÿäº†å¾ˆå¤šç§å­—ç¬¦é›†ã€‚\næˆ‘ä»¬ä¸Šé¢ä¹Ÿè¯´äº†ä¸åŒçš„å­—ç¬¦é›†å¯ä»¥è¡¨ç¤ºçš„å­—ç¬¦èŒƒå›´ä»¥åŠç¼–ç è§„åˆ™å­˜åœ¨å·®å¼‚ã€‚è¿™å°±å¯¼è‡´äº†ä¸€ä¸ªéå¸¸ä¸¥é‡çš„é—®é¢˜ï¼šä½¿ç”¨é”™è¯¯çš„ç¼–ç æ–¹å¼æŸ¥çœ‹ä¸€ä¸ªåŒ…å«å­—ç¬¦çš„æ–‡ä»¶å°±ä¼šäº§ç”Ÿä¹±ç ç°è±¡ã€‚ å°±æ¯”å¦‚è¯´ä½ ä½¿ç”¨ UTF-8 ç¼–ç æ–¹å¼æ‰“å¼€ GB2312 ç¼–ç æ ¼å¼çš„æ–‡ä»¶å°±ä¼šå‡ºç°ä¹±ç ã€‚ç¤ºä¾‹ï¼šâ€œç‰›â€è¿™ä¸ªæ±‰å­— GB2312 ç¼–ç åçš„åå…­è¿›åˆ¶æ•°å€¼ä¸º â€œC5A3â€ï¼Œè€Œ â€œC5A3â€ ç”¨ UTF-8 è§£ç ä¹‹åå¾—åˆ°çš„å´æ˜¯ â€œÅ£â€ã€‚\nä½ å¯ä»¥é€šè¿‡è¿™ä¸ªç½‘ç«™åœ¨çº¿è¿›è¡Œç¼–ç å’Œè§£ç ï¼šhttps://www.haomeili.net/HanZi/ZiFuBianMaZhuanHuan ä¹±ç çš„æœ¬è´¨ï¼šç¼–ç å’Œè§£ç æ—¶ç”¨äº†ä¸åŒæˆ–è€…ä¸å…¼å®¹çš„å­—ç¬¦é›†\nå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæœ‰ä¸€ç§å­—ç¬¦é›†å°†ä¸–ç•Œä¸Šæ‰€æœ‰çš„å­—ç¬¦éƒ½çº³å…¥å…¶ä¸­å°±å¥½äº†ï¼Œäºæ˜¯Unicodeå¸¦ç€è¿™ä¸ªä½¿å‘½è¯ç”Ÿäº†ã€‚\nUnicode å­—ç¬¦é›†ä¸­åŒ…å«äº†ä¸–ç•Œä¸Šå‡ ä¹æ‰€æœ‰å·²çŸ¥çš„å­—ç¬¦ã€‚ä¸è¿‡ï¼ŒUnicode å­—ç¬¦é›†å¹¶æ²¡æœ‰è§„å®šå¦‚ä½•å­˜å‚¨è¿™äº›å­—ç¬¦ï¼ˆä¹Ÿå°±æ˜¯å¦‚ä½•ä½¿ç”¨äºŒè¿›åˆ¶æ•°æ®è¡¨ç¤ºè¿™äº›å­—ç¬¦ï¼‰ äºæ˜¯æœ‰äº† UTF-8ï¼ˆ8-bit Unicode Transformation Formatï¼‰ã€‚ç±»ä¼¼çš„è¿˜æœ‰ UTF-16ã€ UTF-32\nå…¶ä¸­ï¼ŒUTF-8 ä½¿ç”¨1-4ä¸ªå­—èŠ‚ä¸ºæ¯ä¸ªå­—ç¬¦ç¼–ç ï¼ŒUTF-16ä½¿ç”¨2æˆ–4ä¸ªå­—èŠ‚ä¸ºæ¯ä¸ªå­—ç¬¦ç¼–ç ï¼ŒUTF-32å›ºå®šä½¿ç”¨4ä¸ªå­—èŠ‚ä¸ºæ¯ä¸ªå­—ç¬¦ç¼–ç \nUTF-8 å¯ä»¥æ ¹æ®ä¸åŒçš„ç¬¦å·è‡ªåŠ¨é€‰æ‹©ç¼–ç çš„é•¿çŸ­ï¼Œåƒè‹±æ–‡å­—ç¬¦åªéœ€è¦ 1 ä¸ªå­—èŠ‚å°±å¤Ÿäº†ï¼Œè¿™ä¸€ç‚¹ ASCII å­—ç¬¦é›†ä¸€æ · ã€‚å› æ­¤ï¼Œå¯¹äºè‹±è¯­å­—ç¬¦ï¼ŒUTF-8 ç¼–ç å’Œ ASCII ç æ˜¯ç›¸åŒçš„\nUTF-32 çš„è§„åˆ™æœ€ç®€å•ï¼Œä¸è¿‡ç¼ºé™·ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼Œå¯¹äºè‹±æ–‡å­—æ¯è¿™ç±»å­—ç¬¦æ¶ˆè€—çš„ç©ºé—´æ˜¯ UTF-8 çš„ 4 å€ä¹‹å¤šã€‚\nUTF-8 æ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿çš„ä¸€ç§å­—ç¬¦ç¼–ç  MySQLå­—ç¬¦é›† # MySQLæ”¯æŒå¾ˆå¤šå­—ç¬¦ç¼–ç çš„æ–¹å¼ï¼Œæ¯”å¦‚UTF-8ï¼ŒGB2312ï¼ŒGBKï¼ŒBIG5\nä½¿ç”¨SHOW CHARSETå‘½ä»¤æŸ¥çœ‹ é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨UTF-8ä½œä¸ºé»˜è®¤çš„å­—ç¬¦ç¼–ç æ–¹å¼\nç„¶è€Œï¼ŒMySQLå­—ç¬¦ç¼–ç ä¸­æœ‰ä¸¤å¥—UTF-8ç¼–ç å®ç°\nutf-8ï¼šutf8ç¼–ç åªæ”¯æŒ1-3ä¸ªå­—èŠ‚ ã€‚ åœ¨ utf8 ç¼–ç ä¸­ï¼Œä¸­æ–‡æ˜¯å  3 ä¸ªå­—èŠ‚ï¼Œå…¶ä»–æ•°å­—ã€è‹±æ–‡ã€ç¬¦å·å ä¸€ä¸ªå­—èŠ‚ã€‚ä½† emoji ç¬¦å·å  4 ä¸ªå­—èŠ‚ï¼Œä¸€äº›è¾ƒå¤æ‚çš„æ–‡å­—ã€ç¹ä½“å­—ä¹Ÿæ˜¯ 4 ä¸ªå­—èŠ‚ utf8mb4 ï¼š UTF-8 çš„å®Œæ•´å®ç°ï¼Œæ­£ç‰ˆï¼æœ€å¤šæ”¯æŒä½¿ç”¨ 4 ä¸ªå­—èŠ‚è¡¨ç¤ºå­—ç¬¦ï¼Œå› æ­¤ï¼Œå¯ä»¥ç”¨æ¥å­˜å‚¨ emoji ç¬¦å· ä¸ºä½•ä¼šæœ‰ä¸¤å¥—UTF-8ç¼–ç å®ç°ï¼ŒåŸå› å¦‚ä¸‹ å› æ­¤ï¼Œå¦‚æœä½ éœ€è¦å­˜å‚¨emojiç±»å‹çš„æ•°æ®æˆ–è€…ä¸€äº›æ¯”è¾ƒå¤æ‚çš„æ–‡å­—ã€ç¹ä½“å­—åˆ° MySQL æ•°æ®åº“çš„è¯ï¼Œæ•°æ®åº“çš„ç¼–ç ä¸€å®šè¦æŒ‡å®šä¸ºutf8mb4 è€Œä¸æ˜¯utf8 ï¼Œè¦ä¸ç„¶å­˜å‚¨çš„æ—¶å€™å°±ä¼šæŠ¥é”™äº†ã€‚ æµ‹è¯•ï¼š\nç¯å¢ƒï¼ŒMySQL 5.7 + å»ºè¡¨è¯­å¥ï¼š ï¼Œè¿™é‡ŒæŒ‡å®šæ•°æ®åº“CHARSETä¸ºutf8\nCREATE TABLE `user` ( `id` varchar(66) NOT NULL, `name` varchar(33) NOT NULL, `phone` varchar(33) DEFAULT NULL, `password` varchar(100) DEFAULT NULL ) ENGINE=InnoDB DEFAULT CHARSET=utf8; CREATE TABLE `user` ( `id` varchar(66) CHARACTER SET utf8mb4 NOT NULL, `name` varchar(33) CHARACTER SET utf8mb4 NOT NULL, `phone` varchar(33) CHARACTER SET utf8mb4 DEFAULT NULL, `password` varchar(100) CHARACTER SET utf8mb4 DEFAULT NULL ) ENGINE=InnoDB DEFAULT CHARSET=utf8; ------ è¿™è¾¹åº”è¯¥æ˜¯å†™é”™äº†ï¼Œå¦‚æœæ˜¯è¿™ä¸ªsqlï¼Œæ˜¯å¯ä»¥æ’å…¥æˆåŠŸçš„ è‘—ä½œæƒå½’æ‰€æœ‰ åŸæ–‡é“¾æ¥ï¼šhttps://javaguide.cn/database/character-set.html æ’å…¥\nINSERT INTO `user` (`id`, `name`, `phone`, `password`) VALUES (\u0026#39;A00003\u0026#39;, \u0026#39;guideå“¥ğŸ˜˜ğŸ˜˜ğŸ˜˜\u0026#39;, \u0026#39;181631312312\u0026#39;, \u0026#39;123456\u0026#39;); -- æŠ¥é”™ Incorrect string value: \u0026#39;\\xF0\\x9F\\x98\\x98\\xF0\\x9F...\u0026#39; for column \u0026#39;name\u0026#39; at row 1 "},{"id":114,"href":"/zh/docs/study/Review/java_guide/cs_basics/data-structure/tree/","title":"æ ‘","section":"æ•°æ®ç»“æ„","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\næ ‘æ˜¯ä¸€ç§ç±»ä¼¼ç°å®ç”Ÿæ´»ä¸­çš„æ ‘çš„æ•°æ®ç»“æ„ï¼ˆå€’ç½®çš„æ ‘ï¼‰\nä»»ä½•ä¸€é¢—éç©ºæ ‘åªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹\nä¸€æ£µæ ‘å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nä¸€æ£µæ ‘ä¸­çš„ä»»ä½•ä¸¤ä¸ªèŠ‚ç‚¹æœ‰ä¸”ä»…æœ‰å”¯ä¸€çš„ä¸€æ¡è·¯ç›¸é€š ï¼ˆå› ä¸ºæ¯ä¸ªç»“ç‚¹åªä¼šæœ‰ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ï¼‰ ä¸€æ£µæ ‘å¦‚æœæœ‰nä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå®ƒä¸€å®šæ°å¥½æœ‰n-1æ¡è¾¹ ä¸€æ£µæ ‘ä¸åŒ…æ‹¬å›è·¯ ä¸‹é¢æ˜¯ä¸€é¢—äºŒå‰æ ‘ æ·±åº¦å’Œé«˜åº¦æ˜¯å¯¹åº”çš„ï¼›æ ¹èŠ‚ç‚¹æ‰€åœ¨å±‚ä¸º1å±‚\nå¸¸ç”¨æ¦‚å¿µ\nèŠ‚ç‚¹ï¼šæ ‘ä¸­æ¯ä¸ªå…ƒç´ éƒ½å¯ä»¥ç»Ÿç§°ä¸ºèŠ‚ç‚¹\næ ¹èŠ‚ç‚¹ï¼šé¡¶å±‚èŠ‚ç‚¹ï¼Œæˆ–è€…è¯´æ²¡æœ‰çˆ¶èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚ä¸Šå›¾ä¸­AèŠ‚ç‚¹å°±æ˜¯æ ¹èŠ‚ç‚¹\nçˆ¶èŠ‚ç‚¹ï¼šè‹¥ä¸€ä¸ªèŠ‚ç‚¹å«æœ‰å­èŠ‚ç‚¹ï¼Œåˆ™è¿™ä¸ªèŠ‚ç‚¹ç§°ä¸ºå…¶å­èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚ä¸Šå›¾ä¸­çš„ B èŠ‚ç‚¹æ˜¯ D èŠ‚ç‚¹ã€E èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹\nå…„å¼ŸèŠ‚ç‚¹ï¼šå…·æœ‰ç›¸åŒçˆ¶èŠ‚ç‚¹çš„èŠ‚ç‚¹äº’ç§°ä¸ºå…„å¼ŸèŠ‚ç‚¹ã€‚ä¸Šå›¾ä¸­ D èŠ‚ç‚¹ã€E èŠ‚ç‚¹çš„å…±åŒçˆ¶èŠ‚ç‚¹æ˜¯ B èŠ‚ç‚¹ï¼Œæ•… D å’Œ E ä¸ºå…„å¼ŸèŠ‚ç‚¹ã€‚\nå¶å­èŠ‚ç‚¹ï¼šæ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚ä¸Šå›¾ä¸­çš„ Dã€Fã€Hã€I éƒ½æ˜¯å¶å­èŠ‚ç‚¹\nèŠ‚ç‚¹çš„é«˜åº¦**ï¼ˆè·Ÿå¶å­èŠ‚ç‚¹æœ‰å…³ï¼ŒåŒä¸€å±‚ä¸ä¸€å®šä¸€æ ·ï¼‰ï¼šè¯¥èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„æ‰€åŒ…å«çš„è¾¹æ•°ã€‚\nèŠ‚ç‚¹çš„æ·±åº¦**ï¼ˆè·Ÿæ ¹èŠ‚ç‚¹æœ‰å…³ï¼ŒåŒä¸€å±‚æ˜¯ä¸€æ ·çš„ï¼‰ï¼šæ ¹èŠ‚ç‚¹åˆ°è¯¥èŠ‚ç‚¹çš„è·¯å¾„æ‰€åŒ…å«çš„è¾¹æ•°**\nèŠ‚ç‚¹çš„å±‚æ•°ï¼šèŠ‚ç‚¹çš„æ·±åº¦+1\næ ‘çš„é«˜åº¦ï¼šæ ¹èŠ‚ç‚¹çš„é«˜åº¦\näºŒå‰æ ‘çš„åˆ†ç±» # **äºŒå‰æ ‘ï¼ˆBinary treeï¼‰**æ˜¯æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåªæœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼ˆå³ä¸å­˜åœ¨åˆ†æ”¯åº¦å¤§äº2çš„èŠ‚ç‚¹ï¼‰çš„æ ‘ç»“æ„ äºŒå‰æ ‘çš„åˆ†æ”¯ï¼Œé€šå¸¸è¢«ç§°ä¸ºå·¦å­æ ‘æˆ–å³å­æ ‘ï¼Œå¹¶ä¸”ï¼ŒäºŒå‰æ ‘çš„åˆ†æ”¯å…·æœ‰å·¦å³æ¬¡åºï¼Œä¸èƒ½éšæ„é¢ å€’ äºŒå‰æ ‘çš„ç¬¬iå±‚è‡³å¤šæ‹¥æœ‰2^(i-1) ä¸ªèŠ‚ç‚¹\næ·±åº¦ä¸ºkçš„äºŒå‰æ ‘è‡³å¤šæ€»å…±æœ‰ 2^(k+1) -1 ä¸ªèŠ‚ç‚¹ ï¼ˆæ·±åº¦ä¸ºkï¼Œæœ€å¤šk + 1 å±‚ï¼Œæœ€å¤šä¸ºæ»¡äºŒå‰æ ‘çš„æƒ…å†µï¼‰\nè‡³å°‘æœ‰2^(k) ä¸ªèŠ‚ç‚¹ï¼Œå³ æ·±åº¦ä¸ºk-1çš„äºŒå‰æ ‘çš„æœ€å¤šçš„èŠ‚ç‚¹å†åŠ 1 ï¼ˆå…³äºèŠ‚ç‚¹çš„æ·±åº¦çš„å®šä¹‰å›½å†…äº‰è®®æ¯”è¾ƒå¤šï¼Œæˆ‘ä¸ªäººæ¯”è¾ƒè®¤å¯ç»´åŸºç™¾ç§‘å¯¹èŠ‚ç‚¹æ·±åº¦çš„å®šä¹‰open in new windowï¼‰ã€‚ æ»¡äºŒå‰æ ‘ # ä¸€ä¸ªäºŒå‰æ ‘ï¼Œå¦‚æœæ¯ä¸€ä¸ªå±‚çš„ç»“ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§å€¼ï¼Œåˆ™è¿™ä¸ªäºŒå‰æ ‘å°±æ˜¯ æ»¡äºŒå‰æ ‘ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªäºŒå‰æ ‘çš„å±‚æ•°ä¸º Kï¼Œä¸”ç»“ç‚¹æ€»æ•°æ˜¯(2^k) -1 ï¼Œåˆ™å®ƒå°±æ˜¯ æ»¡äºŒå‰æ ‘ã€‚ å®Œå…¨äºŒå‰æ ‘ # å®šä¹‰ï¼šé™¤æœ€åä¸€å±‚å¤–ï¼Œè‹¥å…¶ä½™å±‚éƒ½æ˜¯æ»¡çš„ï¼Œå¹¶ä¸”æœ€åä¸€å±‚æˆ–è€…æ˜¯æ»¡çš„ï¼Œæˆ–è€…æ˜¯åœ¨å³è¾¹ç¼ºå°‘è¿ç»­è‹¥å¹²èŠ‚ç‚¹ï¼Œåˆ™è¿™ä¸ªäºŒå‰æ ‘å°±æ˜¯ å®Œå…¨äºŒå‰æ ‘ ã€‚\nå¤§å®¶å¯ä»¥æƒ³è±¡ä¸ºä¸€æ£µæ ‘ä»æ ¹ç»“ç‚¹å¼€å§‹æ‰©å±•ï¼Œæ‰©å±•å®Œå·¦å­èŠ‚ç‚¹æ‰èƒ½å¼€å§‹æ‰©å±•å³å­èŠ‚ç‚¹ï¼Œæ¯æ‰©å±•å®Œä¸€å±‚ï¼Œæ‰èƒ½ç»§ç»­æ‰©å±•ä¸‹ä¸€å±‚ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nä»å·¦åˆ°å³ï¼Œä»ä¸Šåˆ°ä¸‹ï¼š\nå®Œå…¨äºŒå‰æ ‘çš„æ€§è´¨ï¼šçˆ¶ç»“ç‚¹å’Œå­èŠ‚ç‚¹çš„åºå·æœ‰ç€å¯¹åº”å…³ç³»\nç»†å¿ƒçš„å°ä¼™ä¼´å¯èƒ½å‘ç°äº†ï¼Œå½“æ ¹èŠ‚ç‚¹çš„å€¼ä¸º 1 çš„æƒ…å†µä¸‹ï¼Œè‹¥çˆ¶ç»“ç‚¹çš„åºå·æ˜¯ iï¼Œé‚£ä¹ˆå·¦å­èŠ‚ç‚¹çš„åºå·å°±æ˜¯ 2iï¼Œå³å­èŠ‚ç‚¹çš„åºå·æ˜¯ 2i+1ã€‚è¿™ä¸ªæ€§è´¨ä½¿å¾—å®Œå…¨äºŒå‰æ ‘åˆ©ç”¨æ•°ç»„å­˜å‚¨æ—¶å¯ä»¥æå¤§åœ°èŠ‚çœç©ºé—´ï¼Œä»¥åŠåˆ©ç”¨åºå·æ‰¾åˆ°æŸä¸ªèŠ‚ç‚¹çš„çˆ¶ç»“ç‚¹å’Œå­èŠ‚ç‚¹ï¼Œåç»­äºŒå‰æ ‘çš„å­˜å‚¨ä¼šè¯¦ç»†ä»‹ç»ã€‚\nå¹³è¡¡äºŒå‰æ ‘ # å¹³è¡¡äºŒå‰æ ‘æ˜¯ä¸€é¢—äºŒå‰æ’åºæ ‘ï¼Œä¸”å…·æœ‰ä»¥ä¸‹æ€§è´¨\nå¯ä»¥æ˜¯ä¸€æ£µç©ºæ ‘ å¦‚æœä¸æ˜¯ç©ºæ ‘ï¼Œé‚£ä¹ˆå·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ï¼Œå¹¶ä¸”å·¦å³ä¸¤ä¸ªå­æ ‘éƒ½æ˜¯ä¸€æ£µå¹³è¡¡äºŒå‰æ ‘ å¹³è¡¡äºŒå‰æ ‘çš„å¸¸ç”¨å®ç°æ–¹æ³•æœ‰ çº¢é»‘æ ‘ã€AVL æ ‘ã€æ›¿ç½ªç¾Šæ ‘ã€åŠ æƒå¹³è¡¡æ ‘ã€ä¼¸å±•æ ‘ ç­‰ã€‚\nä¸‹é¢çœ‹ä¸€é¢—ä¸å¤ªæ­£å¸¸çš„æ ‘ è¿™ç©æ„å„¿è¿˜çœŸå«æ ‘ï¼Œåªä¸è¿‡è¿™æ£µæ ‘å·²ç»é€€åŒ–ä¸ºä¸€ä¸ªé“¾è¡¨äº†ï¼Œæˆ‘ä»¬ç®¡å®ƒå« æ–œæ ‘ã€‚\näºŒå‰æ ‘ç›¸æ¯”äºé“¾è¡¨ï¼Œç”±äºçˆ¶å­èŠ‚ç‚¹ä»¥åŠå…„å¼ŸèŠ‚ç‚¹ä¹‹é—´å¾€å¾€å…·æœ‰æŸç§ç‰¹æ®Šçš„å…³ç³»ï¼Œè¿™ç§å…³ç³»ä½¿å¾—æˆ‘ä»¬åœ¨æ ‘ä¸­å¯¹æ•°æ®è¿›è¡Œæœç´¢å’Œä¿®æ”¹æ—¶ï¼Œç›¸å¯¹äºé“¾è¡¨æ›´åŠ å¿«æ·ä¾¿åˆ©ã€‚ å¦‚æœäºŒå‰æ ‘é€€åŒ–ä¸ºä¸€ä¸ªé“¾è¡¨äº†ï¼Œé‚£ä¹ˆé‚£ä¹ˆæ ‘æ‰€å…·æœ‰çš„ä¼˜ç§€æ€§è´¨å°±éš¾ä»¥è¡¨ç°å‡ºæ¥ï¼Œæ•ˆç‡ä¹Ÿä¼šå¤§æ‰“æŠ˜ï¼Œä¸ºäº†é¿å…è¿™æ ·çš„æƒ…å†µï¼Œæˆ‘ä»¬å¸Œæœ›æ¯ä¸ªåš â€œå®¶é•¿â€ï¼ˆçˆ¶ç»“ç‚¹ï¼‰ çš„ï¼Œéƒ½ ä¸€ç¢—æ°´ç«¯å¹³ï¼Œåˆ†ç»™å·¦å„¿å­å’Œåˆ†ç»™å³å„¿å­çš„å°½å¯èƒ½ä¸€æ ·å¤šï¼Œç›¸å·®æœ€å¤šä¸è¶…è¿‡ä¸€å±‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š äºŒå‰æ ‘çš„å­˜å‚¨ # äºŒå‰æ ‘çš„å­˜å‚¨ä¸»è¦åˆ†ä¸ºé“¾å¼å­˜å‚¨å’Œé¡ºåºå­˜å‚¨ é“¾å¼å­˜å‚¨ # å’Œé“¾è¡¨ç±»ä¼¼ï¼ŒäºŒå‰æ ‘çš„é“¾å¼å­˜å‚¨ä¾é æŒ‡é’ˆå°†å„ä¸ªç»“ç‚¹ä¸²è”èµ·æ¥ï¼Œä¸éœ€è¦è¿ç»­çš„å­˜å‚¨ç©ºé—´ æ¯ä¸ªèŠ‚ç‚¹åŒ…æ‹¬ä¸‰ä¸ªå±æ€§ æ•°æ®data dataä¸ä¸€å®šæ˜¯å•ä¸€çš„æ•°æ®ï¼Œæ ¹æ®æƒ…å†µä¸åŒï¼Œå¯ä»¥æ˜¯å¤šä¸ªå…·æœ‰ä¸åŒç±»å‹çš„æ•°æ® å·¦èŠ‚ç‚¹æŒ‡é’ˆ left å³èŠ‚ç‚¹æŒ‡é’ˆ right Javaæ²¡æœ‰æŒ‡é’ˆï¼Œè€Œæ˜¯ç›´æ¥å¼•ç”¨å¯¹è±¡ é¡ºåºå­˜å‚¨ # å°±æ˜¯åˆ©ç”¨æ•°ç»„è¿›è¡Œå­˜å‚¨ï¼Œæ•°ç»„ä¸­æ¯ä¸€ä¸ªä½ç½®ä»…å­˜å‚¨ç»“ç‚¹çš„dataï¼Œä¸å­˜å‚¨å·¦å³å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå­èŠ‚ç‚¹çš„ç´¢å¼•é€šè¿‡æ•°ç»„ä¸‹æ ‡å®Œæˆï¼ˆç±»ä¼¼å †ï¼‰ æ ¹èŠ‚ç‚¹çš„åºå·ä¸º1ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ Nodeï¼Œå‡è®¾å®ƒå­˜å‚¨åœ¨æ•°ç»„ä¸­ä¸‹æ ‡ä¸º i çš„ä½ç½®ï¼Œé‚£ä¹ˆå®ƒçš„å·¦å­èŠ‚ç‚¹å°±å­˜å‚¨åœ¨ 2i çš„ä½ç½®ï¼Œå®ƒçš„å³å­èŠ‚ç‚¹å­˜å‚¨åœ¨ä¸‹æ ‡ä¸º 2i+1 çš„ä½ç½®ã€‚ å¦‚å›¾ å­˜å‚¨å¦‚ä¸‹æ•°ç»„ï¼Œä¼šå‘ç°é—®é¢˜ï¼šå¦‚æœè¦å­˜å‚¨çš„äºŒå‰æ ‘ä¸æ˜¯å®Œå…¨äºŒå‰æ ‘ï¼Œåœ¨æ•°ç»„ä¸­å°±ä¼šå‡ºç°ç©ºéš™ï¼Œå¯¼è‡´å†…å­˜åˆ©ç”¨ç‡é™ä½ äºŒå‰æ ‘çš„éå† # å…ˆåºéå† # å®šä¹‰ï¼šå…ˆè¾“å‡ºæ ¹èŠ‚ç‚¹ï¼Œå†éå†å·¦å­æ ‘ï¼Œæœ€åéå†å³å­æ ‘ã€‚\u0026lt;éå†å·¦å­æ ‘å’Œå³å­æ ‘çš„æ—¶å€™ï¼ŒåŒæ ·éµå¾ªå…ˆåºéå†çš„è§„åˆ™\u0026gt;ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ä½¿ç”¨é€’å½’å®ç°å…ˆåºéå†\npublic void preOrder(TreeNode root){ if(root == null){ return; } system.out.println(root.data); preOrder(root.left); preOrder(root.right); } ä¸­åºéå† # å®šä¹‰ï¼šå…ˆé€’å½’ä¸­åºéå†å·¦å­æ ‘ï¼Œå†è¾“å‡ºæ ¹ç»“ç‚¹çš„å€¼ï¼Œå†é€’å½’ä¸­åºéå†å³å­æ ‘ï¼Œå¤§å®¶å¯ä»¥æƒ³è±¡æˆä¸€å·´æŒæŠŠæ ‘å‹æ‰ï¼Œçˆ¶ç»“ç‚¹è¢«æ‹åˆ°äº†å·¦å­èŠ‚ç‚¹å’Œå³å­èŠ‚ç‚¹çš„ä¸­é—´ï¼ˆå€’å½±ã€æ˜ å°„ï¼‰\npublic void inOrder(TreeNode root){ if(root == null){ return; } inOrder(root.left); system.out.println(root.data); inOrder(root.right); } å¦‚å›¾æ‰€ç¤º åç»­éå† # å®šä¹‰ï¼šå…ˆé€’å½’ååºéå†å·¦å­æ ‘ï¼Œå†é€’å½’ååºéå†å³å­æ ‘ï¼Œæœ€åè¾“å‡ºæ ¹ç»“ç‚¹çš„å€¼\nä»£ç \npublic void postOrder(TreeNode root){ if(root == null){ return; } postOrder(root.left); postOrder(root.right); system.out.println(root.data); } å¦‚å›¾\n"},{"id":115,"href":"/zh/docs/study/Review/java_guide/cs_basics/data-structure/heap/","title":"å †","section":"æ•°æ®ç»“æ„","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nä»€ä¹ˆæ˜¯å † # å †æ˜¯æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„æ ‘ å †ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹å€¼éƒ½å¤§äºç­‰äºï¼ˆæˆ–å°äºç­‰äºï¼‰å­æ ‘ä¸­æ‰€æœ‰èŠ‚ç‚¹ã€‚æˆ–è€…è¯´ï¼Œä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼**éƒ½å¤§äºç­‰äºï¼ˆæˆ–å°äºç­‰äºï¼‰**æ‰€æœ‰å­èŠ‚ç‚¹çš„å€¼\nå¤§å®¶å¯ä»¥æŠŠå †(æœ€å¤§å †)ç†è§£ä¸ºä¸€ä¸ªå…¬å¸,è¿™ä¸ªå…¬å¸å¾ˆå…¬å¹³,è°èƒ½åŠ›å¼ºè°å°±å½“è€å¤§,ä¸å­˜åœ¨å¼±çš„äººå½“è€å¤§,è€å¤§æ‰‹åº•ä¸‹çš„äººä¸€å®šä¸ä¼šæ¯”ä»–å¼ºã€‚è¿™æ ·æœ‰åŠ©äºç†è§£åç»­å †çš„æ“ä½œã€‚\nå †ä¸ä¸€å®šæ˜¯å®Œå…¨äºŒå‰æ ‘ï¼Œä¸ºäº†æ–¹ä¾¿å­˜å‚¨å’Œç´¢å¼•ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨å®Œå…¨äºŒå‰æ ‘çš„å½¢å¼æ¥è¡¨ç¤ºå †\nå¹¿ä¸ºäººçŸ¥çš„æ–æ³¢é‚£å¥‘å †å’ŒäºŒé¡¹å †å°±ä¸æ˜¯å®Œå…¨äºŒå‰æ ‘ï¼Œå®ƒä»¬ç”šè‡³éƒ½ä¸æ˜¯äºŒå‰æ ‘ (äºŒå‰)å †æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå®ƒå¯ä»¥è¢«çœ‹æˆæ˜¯ä¸€ä¸ªè¿‘ä¼¼çš„å®Œå…¨äºŒå‰æ ‘ ä¸‹é¢ç»™å‡ºçš„å›¾æ˜¯å¦æ˜¯å †ï¼ˆé€šè¿‡å®šä¹‰ï¼‰\n1ï¼Œ2æ˜¯ã€‚ 3ä¸æ˜¯ã€‚ å †çš„ç”¨é€” # å½“æˆ‘ä»¬åªå…³å¿ƒæ‰€æœ‰æ•°æ®ä¸­çš„æœ€å¤§å€¼æˆ–è€…æœ€å°å€¼ï¼Œå­˜åœ¨å¤šæ¬¡è·å–æœ€å¤§å€¼æˆ–è€…æœ€å°å€¼ï¼Œå¤šæ¬¡æ’å…¥æˆ–åˆ é™¤æ•°æ®æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨å †ã€‚\næœ‰å°ä¼™ä¼´å¯èƒ½ä¼šæƒ³åˆ°ç”¨æœ‰åºæ•°ç»„ï¼Œåˆå§‹åŒ–ä¸€ä¸ªæœ‰åºæ•°ç»„æ—¶é—´å¤æ‚åº¦æ˜¯ O(nlog(n))[ä¹Ÿå°±æ˜¯å°†ä¸€å †æ•°å­—ä¹±åºæ’åºï¼Œæœ€å¿«æ˜¯O(nlog(n))]ï¼ŒæŸ¥æ‰¾æœ€å¤§å€¼æˆ–è€…æœ€å°å€¼æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(1)ï¼Œä½†æ˜¯ï¼Œæ¶‰åŠåˆ°æ›´æ–°ï¼ˆæ’å…¥æˆ–åˆ é™¤ï¼‰æ•°æ®æ—¶ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œå³ä½¿æ˜¯ä½¿ç”¨å¤æ‚åº¦ä¸º O(log(n)) çš„äºŒåˆ†æ³•æ‰¾åˆ°è¦æ’å…¥æˆ–è€…åˆ é™¤çš„æ•°æ®ï¼Œåœ¨ç§»åŠ¨æ•°æ®æ—¶ä¹Ÿéœ€è¦ O(n) çš„æ—¶é—´å¤æ‚åº¦ã€‚\nç›¸å¯¹äºæœ‰åºæ•°ç»„è€Œè¨€ï¼Œå †çš„ä¸»è¦ä¼˜åŠ¿åœ¨äºæ›´æ–°æ•°æ®æ•ˆç‡è¾ƒé«˜\nå †çš„åˆå§‹åŒ–æ—¶é—´å¤æ‚åº¦ä¸ºO(nlog(n))ï¼Œå †å¯ä»¥åšåˆ°O(1)çš„æ—¶é—´å¤æ‚åº¦å–å‡ºæœ€å¤§å€¼æˆ–è€…æœ€å°å€¼ï¼ŒO(log(n))çš„æ—¶é—´å¤æ‚åº¦æ’å…¥æˆ–è€…åˆ é™¤æ•°æ® å †çš„åˆ†ç±» # å †åˆ†ä¸ºæœ€å¤§å †å’Œæœ€å°å †ï¼ŒäºŒè€…çš„åŒºåˆ«åœ¨äºèŠ‚ç‚¹çš„æ’åºæ–¹å¼ æœ€å¤§å †ï¼šå †ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºå­æ ‘ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„å€¼ æœ€å°å †ï¼šå †ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å°äºå­æ ‘ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„å€¼ å¦‚å›¾ï¼Œå›¾1æ˜¯æœ€å¤§å †ï¼Œå›¾2æ˜¯æœ€å°å † å †çš„å­˜å‚¨ # ç”±äºå®Œå…¨äºŒå‰æ ‘çš„ä¼˜ç§€æ€§è´¨ï¼Œåˆ©ç”¨æ•°ç»„å­˜å‚¨äºŒå‰æ ‘å³èŠ‚çœç©ºé—´ï¼Œåˆæ–¹ä¾¿ç´¢å¼•ï¼ˆè‹¥æ ¹ç»“ç‚¹çš„åºå·ä¸º1ï¼Œé‚£ä¹ˆå¯¹äºæ ‘ä¸­ä»»æ„èŠ‚ç‚¹iï¼Œå…¶å·¦å­èŠ‚ç‚¹åºå·ä¸º 2*iï¼Œå³å­èŠ‚ç‚¹åºå·ä¸º 2*i+1ï¼‰ã€‚ ä¸ºäº†æ–¹ä¾¿å­˜å‚¨å’Œç´¢å¼•ï¼Œï¼ˆäºŒå‰ï¼‰å †å¯ä»¥ç”¨å®Œå…¨äºŒå‰æ ‘çš„å½¢å¼è¿›è¡Œå­˜å‚¨ã€‚å­˜å‚¨çš„æ–¹å¼å¦‚ä¸‹å›¾æ‰€ç¤º å †çš„æ“ä½œ # å †çš„æ›´æ–°æ“ä½œä¸»è¦åŒ…æ‹¬ä¸¤ç§ï¼šæ’å…¥å…ƒç´ å’Œåˆ é™¤å †é¡¶å…ƒç´ \nå †æ˜¯ä¸€ä¸ªå…¬å¹³çš„å…¬å¸ï¼Œæœ‰èƒ½åŠ›çš„äººè‡ªç„¶ä¼šèµ°åˆ°ä¸ä»–èƒ½åŠ›æ‰€åŒ¹é…çš„ä½ç½®\næ’å…¥å…ƒç´  # å°†è¦æ’å…¥çš„å…ƒç´ æ”¾åˆ°æœ€å ä»åº•å‘ä¸Šï¼Œå¦‚æœçˆ¶èŠ‚ç‚¹æ¯”è¯¥å…ƒç´ å°ï¼Œåˆ™è¯¥èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹äº¤æ¢ï¼ˆå…¶å®å°±æ˜¯ä¸€æ£µæ ‘æœ‰3ä¸ªï¼ˆæœ€å¤šï¼‰èŠ‚ç‚¹ï¼Œä¸æ ‘ä¸Šæœ€å¤§çš„èŠ‚ç‚¹æ¯”è¾ƒï¼‰ ç›´åˆ°æ— æ³•äº¤æ¢ï¼ˆå·²ç»ä¸æ ¹èŠ‚ç‚¹æ¯”è¾ƒè¿‡ï¼‰ åˆ é™¤å †é¡¶å…ƒç´  # æ ¹æ®å †çš„æ€§è´¨å¯çŸ¥ï¼Œæœ€å¤§å †çš„å †ç›¯å…ƒç´ ä¸ºæ‰€æœ‰å…ƒç´ ä¸­æœ€å¤§çš„ï¼Œæœ€å°å †çš„å †é¡¶å…ƒç´ æ˜¯æ‰€æœ‰å…ƒç´ ä¸­æœ€å°çš„\nå½“æˆ‘ä»¬éœ€è¦å¤šæ¬¡æŸ¥æ‰¾æœ€å¤§å…ƒç´ æˆ–è€…æœ€å°å…ƒç´ çš„æ—¶å€™ï¼Œå¯ä»¥åˆ©ç”¨å †æ¥å®ç°\nåˆ é™¤å †é¡¶å…ƒç´ åï¼Œä¸ºäº†ä¿æŒå †çš„æ€§è´¨ï¼Œéœ€è¦å¯¹å †çš„ç»“æ„è¿›è¡Œè°ƒæ•´ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªè¿‡ç¨‹ç§°ä¹‹ä¸ºå †åŒ–\nè‡ªåº•å‘ä¸Šçš„å †åŒ–ï¼Œä¸Šè¿°çš„æ’å…¥å…ƒç´ æ‰€ä½¿ç”¨çš„ï¼Œå°±æ˜¯è‡ªé¡¶å‘ä¸Šçš„å †åŒ–ï¼Œå…ƒç´ ä»æœ€åº•éƒ¨å‘ä¸Šç§»åŠ¨ è‡ªé¡¶å‘ä¸‹çš„å †åŒ–ï¼Œå…ƒç´ ç”±é¡¶éƒ¨å‘ä¸‹ç§»åŠ¨ã€‚åœ¨è®²è§£åˆ é™¤å †é¡¶å…ƒç´ çš„æ–¹æ³•æ—¶ï¼Œæˆ‘å°†é˜è¿°è¿™ä¸¤ç§æ“ä½œçš„è¿‡ç¨‹ è‡ªåº•å‘ä¸Šå †åŒ–\nåœ¨å †è¿™ä¸ªå…¬å¸ä¸­ï¼Œä¼šå‡ºç°è€å¤§ç¦»èŒçš„ç°è±¡ï¼Œè€å¤§ç¦»èŒä¹‹åï¼Œå®ƒçš„ä½ç½®å°±ç©ºå‡ºæ¥äº†\né¦–å…ˆåˆ é™¤å †é¡¶å…ƒç´ ï¼Œä½¿å¾—æ•°ç»„ä¸­ä¸‹æ ‡ä¸º1çš„ä½ç½®ç©ºå‡º é‚£ä¹ˆä»–çš„ä½ç½®ç”±è°æ¥æ¥æ›¿å‘¢ï¼Œå½“ç„¶æ˜¯ä»–çš„ç›´æ¥ä¸‹å±äº†ï¼Œè°èƒ½åŠ›å¼ºå°±è®©è°ä¸Š\næ¯”è¾ƒæ ¹èŠ‚ç‚¹ï¼ˆå½“å‰èŠ‚ç‚¹ï¼‰çš„å·¦å­èŠ‚ç‚¹å’Œå³å­èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä¸‹æ ‡ä¸º 2 ï¼Œ3 çš„æ•°ç»„å…ƒç´ ï¼Œå°†è¾ƒå¤§çš„å…ƒç´ å¡«å……åˆ°**æ ¹èŠ‚ç‚¹ï¼ˆä¸‹æ ‡ä¸º1ï¼‰ï¼ˆå½“å‰éå†èŠ‚ç‚¹ï¼‰**çš„ä½ç½® æ­¤æ—¶åˆç©ºå‡ºä¸€ä¸ªä½ç½®äº†ï¼Œè€è§„çŸ©ï¼Œè°æœ‰èƒ½åŠ›è°ä¸Š\nä¸€ç›´å¾ªç¯æ¯”è¾ƒç©ºå‡ºä½ç½®çš„å·¦å³å­èŠ‚ç‚¹ï¼Œå¹¶å°†è¾ƒå¤§è€…ç§»è‡³ç©ºä½ï¼Œç›´åˆ°å †çš„æœ€åº•éƒ¨ æ­¤æ—¶å·²ç»å®Œæˆè‡ªé¡¶å‘ä¸Šçš„å †åŒ–ï¼Œæ²¡æœ‰å…ƒç´ å¯ä»¥å¡«è¡¥ç©ºç¼ºã€‚ä½†ä¼šå‘ç°æ•°ç»„ä¸­å‡ºç°äº†â€æ°”æ³¡â€ï¼Œå¯¼è‡´å­˜æˆ·ç©ºé—´çš„æµªè´¹ã€‚\nè§£å†³åŠæ³•ï¼šè‡ªé¡¶å‘ä¸‹å †åŒ–\nè‡ªé¡¶å‘ä¸‹å †åŒ– è‡ªé¡¶å‘ä¸‹çš„å †åŒ–ç”¨ä¸€ä¸ªè¯å½¢å®¹å°±æ˜¯â€œçŸ³æ²‰å¤§æµ·â€\nç¬¬ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯æŠŠçŸ³å¤´æŠ¬èµ·æ¥ï¼Œä»æµ·é¢æ‰”ä¸‹å»ã€‚è¿™ä¸ªçŸ³å¤´å°±æ˜¯å †çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬å°†æœ€åä¸€ä¸ªå…ƒç´ ç§»åŠ¨åˆ°å †é¡¶ã€‚ å°†è¿™ä¸ªçŸ³å¤´æ²‰å…¥æµ·åº•ï¼Œä¸åœçš„ä¸å·¦å³å­èŠ‚ç‚¹çš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå’Œè¾ƒå¤§çš„å­èŠ‚ç‚¹äº¤æ¢ä½ç½®ï¼Œç›´åˆ°æ— æ³•äº¤æ¢ä½ç½® ç»“æœ å †çš„æ“ä½œæ€»ç»“ # æ’å…¥å…ƒç´ ï¼šå…ˆå°†å…ƒç´ æ”¾ç½®æ•°ç»„æœ«å°¾ï¼Œå†è‡ªåº•å‘ä¸Šå †åŒ–ï¼Œå°†æœ«å°¾å…ƒç´ ä¸Šæµ®\nåˆ é™¤å †é¡¶å…ƒç´ ï¼šåˆ é™¤å †é¡¶å…ƒç´ ï¼Œå°†æœ«å°¾å…ƒç´ æ”¾ç½®å †é¡¶ï¼Œå†è‡ªé¡¶å‘ä¸‹å †åŒ–ï¼Œå°†å †é¡¶å…ƒç´ ä¸‹æ²‰ã€‚\nä¹Ÿå¯ä»¥è‡ªåº•å‘ä¸Šå †åŒ–ï¼Œä½†æ˜¯ä¼šäº§ç”Ÿæ°”æ³¡ï¼Œæµªè´¹å­˜å‚¨ç©ºé—´ã€‚ä¸å»ºè®®\nå †æ’åº # å †æ’åºçš„è¿‡ç¨‹åˆ†ä¸¤æ­¥\nå»ºå †ï¼Œå°†ä¸€ä¸ªæ— åºçš„æ•°ç»„ï¼Œå»ºç«‹æˆå † æ’åºï¼Œ[ å°†å †é¡¶å…ƒç´ å–å‡ºï¼Œç„¶åå¯¹å‰©ä¸‹çš„å…ƒç´ å †åŒ– ]ã€‚ åå¤è¿­ä»£ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ è¢«å–å‡º å»ºå † # ä¹Ÿå°±æ˜¯å¯¹æ‰€æœ‰éå¶å­ç»“ç‚¹è¿›è¡Œè‡ªé¡¶å‘ä¸‹\nå¦‚å›¾ï¼Œçº¢è‰²åŒºåŸŸåˆ†åˆ«æ˜¯å †çš„æƒ…å†µä¸‹ã€‚å¯¹äºTï¼Œå¦‚æœåªè‡ªé¡¶å‘ä¸‹åˆ°Pã€Lè¿™å±‚ï¼Œè¢«æ¢åˆ°äº†è¿™å±‚çš„é‚£ä¸ªå…ƒç´ æ˜¯ä¸ä¸€å®šå°±æ¯”å…¶ä»–æ ‘å¤§çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯è¦ä¾æ¬¡è‡ªé¡¶å‘ä¸‹\nè¿™ä¸ªæ„å»ºå †æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n) é¦–å…ˆè¦äº†è§£å“ªäº›æ˜¯éå¶èŠ‚ç‚¹ï¼Œæœ€åä¸€ä¸ªç»“ç‚¹çš„çˆ¶èŠ‚ç‚¹åŠå®ƒï¼ˆè¿™ä¸ªçˆ¶èŠ‚ç‚¹ï¼‰ä¹‹å‰çš„å…ƒç´ ï¼Œéƒ½æ˜¯éå¶èŠ‚ç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœèŠ‚ç‚¹ä¸ªæ•°ä¸ºnï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å¯¹n/2åˆ°1çš„èŠ‚ç‚¹è¿›è¡Œè‡ªé¡¶å‘ä¸‹ï¼ˆæ²‰åº•ï¼‰å †åŒ–\nå¦‚å›¾ é¦–å…ˆå°†åˆå§‹çš„æ— åºæ•°ç»„æŠ½è±¡ä¸ºä¸€æ£µæ ‘ï¼Œå›¾ä¸­çš„èŠ‚ç‚¹ä¸ªæ•°ä¸º6ï¼Œæ‰€ä»¥4ï¼Œ5ï¼Œ6æ˜¯å¶å­èŠ‚ç‚¹ï¼Œ1ï¼Œ2ï¼Œ3èŠ‚ç‚¹ä¸ºéå¶èŠ‚ç‚¹ å¯¹1ï¼Œ2ï¼Œ3èŠ‚ç‚¹è¿›è¡Œ**è‡ªé¡¶å‘ä¸‹ï¼ˆæ²‰åº•ï¼‰**å †åŒ–ï¼Œæ³¨æ„ï¼Œé¡ºåºæ˜¯ä»åå¾€å‰å †åŒ–ï¼Œä»3å·å¼€å§‹ï¼Œä¸€ç›´åˆ°1å·èŠ‚ç‚¹ã€‚ 3å·èŠ‚ç‚¹å †åŒ–ç»“æœ\n2å·èŠ‚ç‚¹å †åŒ–ç»“æœ 1å·èŠ‚ç‚¹å †åŒ–ç»“æœ æ’åº # æ–¹æ³•ï¼šç”±äºå †é¡¶å…ƒç´ æ˜¯æ‰€æœ‰å…ƒç´ ä¸­æœ€å¤§çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡å¤å–å‡ºå †é¡¶å…ƒç´ ï¼Œå°†è¿™ä¸ªæœ€å¤§çš„å †é¡¶å…ƒç´ æ”¾è‡³æ•°ç»„æœ«å°¾ï¼Œå¹¶å¯¹å‰©ä¸‹çš„å…ƒç´ è¿›è¡Œå †åŒ–å³å¯ ç°åœ¨æ€è€ƒä¸¤ä¸ªé—®é¢˜ï¼š åˆ é™¤å †é¡¶å…ƒç´ åéœ€è¦æ‰§è¡Œ**è‡ªé¡¶å‘ä¸‹ï¼ˆæ²‰åº•ï¼‰å †åŒ–è¿˜æ˜¯è‡ªåº•å‘ä¸Šï¼ˆä¸Šæµ®ï¼‰**å †åŒ–ï¼Ÿ å–å‡ºçš„å †é¡¶å…ƒç´ å­˜åœ¨å“ªï¼Œæ–°å»ºä¸€ä¸ªæ•°ç»„å­˜ï¼Ÿ ç­”æ¡ˆ éœ€è¦ä½¿ç”¨è‡ªé¡¶å‘ä¸‹ï¼ˆæ²‰åº•ï¼‰å †åŒ–ï¼Œè¿™ä¸ªå †åŒ–ä¸€å¼€å§‹è¦å°†æœ«å°¾å…ƒç´ ç§»åŠ¨è‡³å †é¡¶ã€‚ç”±äºè¿™ä¸ªæ—¶å€™æœ«å°¾çš„ä½ç½®å·²ç»ç©ºå‡ºæ¥äº†ç”±äºå †ä¸­å…ƒç´ å·²ç»å‡å°ï¼Œè¿™ä¸ªä½ç½®ä¸ä¼šå†è¢«ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å–å‡ºçš„å…ƒç´ æ”¾åœ¨æœ«å°¾ã€‚ å…¶å®æ˜¯åšäº†ä¸€æ¬¡äº¤æ¢æ“ä½œï¼Œå°†å †é¡¶å’Œæœ«å°¾å…ƒç´ è°ƒæ¢ä½ç½®ï¼Œä»è€Œå°†å–å‡ºå †é¡¶å…ƒç´ å’Œ**å †åŒ–çš„ç¬¬ä¸€æ­¥(å°†æœ«å°¾å…ƒç´ æ”¾è‡³æ ¹ç»“ç‚¹ä½ç½®)**è¿›è¡Œåˆå¹¶ æ­¥éª¤ å–å‡ºç¬¬ä¸€ä¸ªå…ƒç´ å¹¶å †åŒ– å–å‡ºç¬¬2ä¸ªå…ƒç´ å¹¶å †åŒ– å–å‡ºç¬¬3ä¸ªå…ƒç´ å¹¶å †åŒ– å–å‡ºç¬¬4ä¸ªå…ƒç´ å¹¶å †åŒ– å–å‡ºç¬¬5ä¸ªå…ƒç´ å¹¶å †åŒ– å–å‡ºç¬¬6ä¸ªå…ƒç´ å¹¶å †åŒ– æ’åºå®Œæˆ "},{"id":116,"href":"/zh/docs/study/Review/java_guide/cs_basics/data-structure/graph/","title":"å›¾","section":"æ•°æ®ç»“æ„","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nå›¾æ˜¯ä¸€ç§è¾ƒä¸ºå¤æ‚çš„éçº¿æ€§ç»“æ„ çº¿æ€§æ•°æ®ç»“æ„çš„å…ƒç´ æ»¡è¶³å”¯ä¸€çš„çº¿æ€§å…³ç³»ï¼Œæ¯ä¸ªå…ƒç´ ï¼ˆé™¤ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå¤–ï¼‰åªæœ‰ä¸€ä¸ªç›´æ¥å‰é©±å’Œä¸€ä¸ªç›´æ¥åç»§ æ ‘å½¢æ•°æ®ç»“æ„çš„å…ƒç´ ä¹‹é—´æœ‰ç€æ˜æ˜¾çš„å±‚çº§å…³ç³» å›¾å½¢ç»“æ„çš„å…ƒç´ ä¹‹é—´çš„å…³ç³»æ˜¯ä»»æ„çš„ å›¾å°±æ˜¯ç”±é¡¶ç‚¹çš„æœ‰ç©·éç©ºé›†åˆå’Œé¡¶ç‚¹ä¹‹é—´çš„è¾¹ç»„æˆçš„é›†åˆï¼Œé€šå¸¸è¡¨ç¤ºä¸ºï¼šGï¼ˆVï¼ŒEï¼‰ï¼Œå…¶ä¸­ï¼ŒGè¡¨ç¤ºä¸€ä¸ªå›¾ï¼ŒVè¡¨ç¤ºé¡¶ç‚¹çš„é›†åˆï¼ŒEè¡¨ç¤ºè¾¹çš„é›†åˆ ä¸‹é¢æ˜¾ç¤ºçš„å³å›¾è¿™ç§æ•°æ®ç»“æ„ï¼Œè€Œä¸”è¿˜æ˜¯ä¸€å¼ æœ‰å‘å›¾ å›¾çš„åŸºæœ¬æ¦‚å¿µ # é¡¶ç‚¹ # å›¾ä¸­çš„æ•°æ®å…ƒç´ ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºé¡¶ç‚¹ï¼Œå›¾è‡³å°‘æœ‰ä¸€ä¸ªé¡¶ç‚¹ï¼ˆæœ‰ç©·éç©ºé›†åˆï¼‰ å¯¹åº”åˆ°å¥½å‹å…³ç³»å›¾ï¼Œæ¯ä¸€ä¸ªç”¨æˆ·å°±ä»£è¡¨ä¸€ä¸ªé¡¶ç‚¹ è¾¹ # é¡¶ç‚¹ä¹‹é—´çš„å…³ç³»ç”¨è¾¹è¡¨ç¤º å¯¹åº”åˆ°å¥½å‹å…³ç³»å›¾ï¼Œä¸¤ä¸ªç”¨æˆ·æ˜¯å¥½å‹çš„è¯ï¼Œé‚£ä¸¤è€…ä¹‹é—´å°±å­˜åœ¨ä¸€æ¡è¾¹ åº¦ # åº¦è¡¨ç¤ºä¸€ä¸ªé¡¶ç‚¹åŒ…å«å¤šå°‘æ¡è¾¹ æœ‰å‘å›¾ä¸­ï¼Œåˆ†ä¸ºå‡ºåº¦å’Œå…¥åº¦ï¼Œå‡ºåº¦è¡¨ç¤ºä»è¯¥é¡¶ç‚¹å‡ºå»çš„è¾¹çš„æ¡æ•°ï¼Œå…¥åº¦è¡¨ç¤ºä»è¿›å…¥è¯¥é¡¶ç‚¹çš„è¾¹çš„æ¡æ•° å¯¹åº”åˆ°å¥½å‹å…³ç³»å›¾ï¼Œåº¦å°±ä»£è¡¨äº†æŸä¸ªäººçš„å¥½å‹æ•°é‡ æ— å‘å›¾å’Œæœ‰å‘å›¾ # è¾¹è¡¨ç¤ºçš„æ˜¯é¡¶ç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œæœ‰çš„å…³ç³»æ˜¯åŒå‘çš„ï¼Œæ¯”å¦‚åŒå­¦å…³ç³»ï¼ŒAæ˜¯Bçš„åŒå­¦ï¼Œé‚£ä¹ˆBä¹Ÿè‚¯å®šæ˜¯Açš„åŒå­¦ï¼Œé‚£ä¹ˆåœ¨è¡¨ç¤ºAå’ŒBçš„å…³ç³»æ—¶ï¼Œå°±ä¸ç”¨å…³æ³¨æ–¹å‘ï¼Œç”¨ä¸å¸¦ç®­å¤´çš„è¾¹è¡¨ç¤ºï¼Œè¿™æ ·çš„å›¾å°±æ˜¯æ— å‘å›¾ã€‚\næœ‰çš„å…³ç³»æ˜¯æœ‰æ–¹å‘çš„ï¼Œæ¯”å¦‚çˆ¶å­å…³ç³»ï¼Œå¸ˆç”Ÿå…³ç³»ï¼Œå¾®åšçš„å…³æ³¨å…³ç³»ï¼ŒAæ˜¯Bçš„çˆ¸çˆ¸ï¼Œä½†Bè‚¯å®šä¸æ˜¯Açš„çˆ¸çˆ¸ï¼ŒAå…³æ³¨Bï¼ŒBä¸ä¸€å®šå…³æ³¨Aã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±ç”¨å¸¦ç®­å¤´çš„è¾¹è¡¨ç¤ºäºŒè€…çš„å…³ç³»ï¼Œè¿™æ ·çš„å›¾å°±æ˜¯æœ‰å‘å›¾ã€‚\næ— æƒå›¾å’Œå¸¦æƒå›¾ # å¯¹äºä¸€ä¸ªå…³ç³»ï¼Œå¦‚æœæˆ‘ä»¬åªå…³å¿ƒå…³ç³»çš„æœ‰æ— ï¼Œè€Œä¸å…³å¿ƒå…³ç³»æœ‰å¤šå¼ºï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨æ— æƒå›¾è¡¨ç¤ºäºŒè€…çš„å…³ç³»ã€‚\nå¯¹äºä¸€ä¸ªå…³ç³»ï¼Œå¦‚æœæˆ‘ä»¬æ—¢å…³å¿ƒå…³ç³»çš„æœ‰æ— ï¼Œä¹Ÿå…³å¿ƒå…³ç³»çš„å¼ºåº¦ï¼Œæ¯”å¦‚æè¿°åœ°å›¾ä¸Šä¸¤ä¸ªåŸå¸‚çš„å…³ç³»ï¼Œéœ€è¦ç”¨åˆ°è·ç¦»ï¼Œé‚£ä¹ˆå°±ç”¨å¸¦æƒå›¾æ¥è¡¨ç¤ºï¼Œå¸¦æƒå›¾ä¸­çš„æ¯ä¸€æ¡è¾¹ä¸€ä¸ªæ•°å€¼è¡¨ç¤ºæƒå€¼ï¼Œä»£è¡¨å…³ç³»çš„å¼ºåº¦ã€‚\nä¸‹å›¾å°±æ˜¯ä¸€ä¸ªå¸¦æƒæœ‰å‘å›¾ã€‚\nå›¾çš„å­˜å‚¨ # é‚»æ¥çŸ©é˜µå­˜å‚¨ # é‚»æ¥çŸ©é˜µå°†å›¾ç”¨äºŒç»´çŸ©é˜µå­˜å‚¨ï¼Œæ˜¯ä¸€ç§æ¯”è¾ƒç›´è§‚çš„è¡¨ç¤ºæ–¹å¼ å¦‚æœç¬¬iä¸ªé¡¶ç‚¹å’Œç¬¬jä¸ªé¡¶ç‚¹æœ‰å…³ç³»ï¼Œä¸”å…³ç³»æƒå€¼ä¸ºnï¼Œåˆ™A[i] [j] = n åœ¨æ— å‘å›¾ä¸­ï¼Œæˆ‘ä»¬åªå…³å¿ƒå…³ç³»çš„æœ‰æ— ï¼Œæ‰€ä»¥å½“é¡¶ç‚¹iå’Œé¡¶ç‚¹jæœ‰å…³ç³»æ—¶ï¼ŒA[i] [j]=1 ; å½“é¡¶ç‚¹iå’Œé¡¶ç‚¹jæ²¡æœ‰å…³ç³»æ—¶ï¼ŒA[i] [j] = 0 ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\næ— å‘å›¾çš„é‚»æ¥çŸ©é˜µæ˜¯ä¸€ä¸ªå¯¹ç§°çŸ©é˜µï¼Œå› ä¸ºåœ¨æ— å‘å›¾ä¸­ï¼Œé¡¶ç‚¹iå’Œé¡¶ç‚¹jæœ‰å…³ç³»ï¼Œåˆ™é¡¶ç‚¹jå’Œé¡¶ç‚¹iå¿…æœ‰å…³ç³» æœ‰å‘å›¾çš„é‚»æ¥çŸ©é˜µå­˜å‚¨ é‚»æ¥çŸ©é˜µå­˜å‚¨çš„æ–¹å¼ä¼˜ç‚¹æ˜¯ç®€å•ç›´æ¥ï¼ˆç›´æ¥ä½¿ç”¨ä¸€ä¸ªäºŒç»´æ•°ç»„å³å¯ï¼‰ï¼Œå¹¶ä¸”åœ¨è·å–ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´çš„å…³ç³»çš„æ—¶å€™ä¹Ÿéå¸¸é«˜æ•ˆ*ç›´æ¥è·å–æŒ‡å®šä½ç½®çš„æ•°ç»„å…ƒç´ ã€‚ä½†æ˜¯è¿™ç§å­˜å‚¨æ–¹å¼çš„ç¡®å®šå•Šä¹Ÿæ¯”è¾ƒæ˜æ˜¾å³ æ¯”è¾ƒæµªè´¹ç©ºé—´ é‚»æ¥è¡¨å­˜å‚¨ # é’ˆå¯¹ä¸Šé¢é‚»æ¥çŸ©é˜µæ¯”è¾ƒæµªè´¹å†…å­˜ç©ºé—´çš„é—®é¢˜ï¼Œè¯ç”Ÿäº†å›¾çš„å¦ä¸€ç§å­˜å‚¨æ–¹æ³•\u0026ndash;é‚»æ¥è¡¨\né‚»æ¥é“¾è¡¨ä½¿ç”¨ä¸€ä¸ªé“¾è¡¨æ¥å­˜å‚¨æŸä¸ªé¡¶ç‚¹çš„æ‰€æœ‰åç»§ç›¸é‚»é¡¶ç‚¹ã€‚å¯¹äºå›¾ä¸­æ¯ä¸ªé¡¶ç‚¹Vi ï¼ŒæŠŠæ‰€æœ‰é‚»æ¥äºVi çš„é¡¶ç‚¹Vj é“¾æ¥æˆä¸€ä¸ªå•é“¾è¡¨\næ— å‘å›¾çš„é‚»æ¥è¡¨å­˜å‚¨ æœ‰å‘å›¾çš„é‚»æ¥è¡¨å­˜å‚¨ é‚»æ¥è¡¨ä¸­å­˜å‚¨çš„å…ƒç´ çš„ä¸ªæ•°ï¼ˆé¡¶ç‚¹æ•°ï¼‰ä»¥åŠå›¾ä¸­è¾¹çš„æ¡æ•°\næ— å‘å›¾ä¸­ï¼Œé‚»æ¥è¡¨çš„å…ƒç´ ä¸ªæ•°ç­‰äºè¾¹çš„æ¡æ•°çš„ä¸¤å€ï¼Œå¦‚ä¸‹å›¾ 7æ¡è¾¹ï¼Œé‚»æ¥è¡¨å­˜å‚¨çš„å…ƒç´ ä¸ªæ•°ä¸º14 ï¼ˆå³æ¯æ¡è¾¹å­˜å‚¨äº†ä¸¤æ¬¡ï¼‰\næœ‰å‘å›¾ä¸­ï¼Œé‚»æ¥è¡¨å…ƒç´ ä¸ªæ•°ç­‰äºè¾¹çš„æ¡æ•°ï¼Œå¦‚å›¾æ‰€ç¤ºçš„æœ‰å‘å›¾ä¸­ï¼Œè¾¹çš„æ¡æ•°ä¸º8ï¼Œé‚»æ¥è¡¨ å›¾çš„æœç´¢ # å¹¿åº¦ä¼˜å…ˆæœç´¢ # å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼šåƒæ°´é¢ä¸Šçš„æ³¢çº¹ä¸€æ ·ï¼Œä¸€å±‚ä¸€å±‚å‘å¤–æ‰©å±•ï¼Œå¦‚å›¾ å…·ä½“å®ç°æ–¹å¼ï¼Œç”¨åˆ°äº†é˜Ÿåˆ—ï¼Œè¿‡ç¨‹å¦‚ä¸‹\nåˆå§‹çŠ¶æ€ï¼šå°†è¦æœç´¢çš„æºé¡¶ç‚¹æ”¾å…¥é˜Ÿåˆ— å–å‡ºé˜Ÿé¦–èŠ‚ç‚¹ï¼Œè¾“å‡º0ï¼Œå°†0çš„åç»§é¡¶ç‚¹ï¼ˆå…¨éƒ¨ï¼‰ï¼ˆæœªè®¿é—®è¿‡çš„ï¼‰æ”¾å…¥é˜Ÿåˆ— å–å‡ºé˜Ÿé¦–èŠ‚ç‚¹ï¼Œè¾“å‡º1ï¼Œå°†1çš„åç»§é¡¶ç‚¹ï¼ˆæ‰€æœ‰ï¼‰ï¼ˆæœªè®¿é—®è¿‡çš„ï¼‰æ”¾å…¥é˜Ÿåˆ— æˆªæ­¢åˆ°ç¬¬3æ­¥å°±å¾ˆæ¸…æ¥šäº†ï¼Œå°±æ˜¯è¾“å‡ºæœ€è¿‘çš„ä¸€ä¸ªç»“ç‚¹çš„å…¨éƒ¨å…³ç³»èŠ‚ç‚¹\nå–å‡ºé˜Ÿé¦–èŠ‚ç‚¹ï¼Œè¾“å‡º4ï¼Œå°†4çš„åç»§é¡¶ç‚¹ï¼ˆæœªè®¿é—®è¿‡çš„ï¼‰æ”¾å…¥é˜Ÿåˆ— å–å‡ºé˜Ÿé¦–èŠ‚ç‚¹ï¼Œè¾“å‡º2ï¼Œå°†2çš„åç»§é¡¶ç‚¹ï¼ˆæœªè®¿é—®è¿‡çš„ï¼‰æ”¾å…¥é˜Ÿåˆ— å–å‡ºé˜Ÿé¦–èŠ‚ç‚¹ï¼Œè¾“å‡º3ï¼Œå°†3çš„åç»§é¡¶ç‚¹ï¼ˆæœªè®¿é—®è¿‡çš„ï¼‰æ”¾å…¥é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸ºç©ºï¼Œç»“æŸ æ€»ç»“ å…ˆåˆå§‹åŒ–é¦–ç»“ç‚¹ï¼Œä¹‹åä¸æ–­ä»é˜Ÿåˆ—å–å‡ºå¹¶å°†è¿™ä¸ªç»“ç‚¹çš„æœ‰å…³ç³»çš„ç»“ç‚¹ ä¾æ¬¡æ”¾å…¥é˜Ÿåˆ—\næ·±åº¦ä¼˜å…ˆæœç´¢ # æ·±åº¦ä¼˜å…ˆï¼Œå³ä¸€æ¡è·¯èµ°åˆ°é»‘ã€‚ä»æºé¡¶ç‚¹å¼€å§‹ï¼Œä¸€ç›´èµ°åˆ°åç»§èŠ‚ç‚¹ï¼Œæ‰å›æº¯åˆ°ä¸Šä¸€é¡¶ç‚¹ï¼Œç„¶åç»§ç»­ä¸€æ¡è·¯èµ°åˆ°é»‘ å’Œå¹¿åº¦ä¼˜å…ˆæœç´¢ç±»ä¼¼ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢çš„å…·ä½“å®ç°ï¼Œç”¨åˆ°äº†å¦ä¸€ç§çº¿æ€§æ•°æ®ç»“æ„\u0026mdash;æ ˆ åˆå§‹çŠ¶æ€ï¼Œå°†è¦æœç´¢çš„æºé¡¶ç‚¹æ”¾å…¥æ ˆä¸­ å–å‡ºæ ˆé¡¶å…ƒç´ ï¼Œè¾“å‡º0ï¼Œå°†0çš„åç»§é¡¶ç‚¹ï¼ˆæœªè®¿é—®è¿‡çš„ï¼‰æ”¾å…¥æ ˆä¸­ å–å‡ºæ ˆé¡¶å…ƒç´ ï¼Œè¾“å‡º4ï¼ˆå› ä¸ºåè¿›å…ˆå‡ºï¼‰ï¼Œå°†4çš„åç»§é¡¶ç‚¹ï¼ˆæœªè®¿é—®è¿‡çš„ï¼‰æ”¾å…¥æ ˆä¸­ å–å‡ºæ ˆé¡¶å…ƒç´ ï¼Œè¾“å‡º3ï¼Œå°†3çš„åç»§é¡¶ç‚¹ï¼ˆæœªè®¿é—®è¿‡çš„ï¼‰æ”¾å…¥æ ˆä¸­ å…¶å®åˆ°è¿™éƒ¨å°±éå¸¸æ˜æ˜¾äº†ï¼Œå³ å‰é¢å…ƒç´ çš„å…³ç³»å…ƒç´ ï¼Œå¤§å¤šéƒ½æ˜¯è¢«ä¸€ç›´å‹åœ¨æ ˆåº•çš„ï¼Œä¼šä¸€ç›´èµ°èµ°åˆ° æºé¡¶ç‚¹çš„ç›´ç³»å…³ç³»é¡¶ç‚¹æ²¡æœ‰äº†ï¼Œå†å¾€å›èµ°\nå–å‡ºæ ˆé¡¶å…ƒç´ ï¼Œè¾“å‡º2ï¼Œå°†2çš„åç»§é¡¶ç‚¹ï¼ˆä¸ºè®¿é—®è¿‡çš„ï¼‰æ”¾å…¥æ ˆä¸­ å–å‡ºæ ˆé¡¶å…ƒç´ ï¼Œè¾“å‡º1ï¼Œå°†1çš„åç»§é¡¶ç‚¹ï¼ˆæœªè®¿é—®è¿‡çš„ï¼‰æ”¾å…¥æ ˆä¸­ï¼Œæ ˆä¸ºç©ºï¼Œç»“æŸ "},{"id":117,"href":"/zh/docs/study/Review/java_guide/cs_basics/data-structure/linear-data-structure/","title":"çº¿æ€§æ•°æ®ç»“æ„","section":"æ•°æ®ç»“æ„","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\næ•°ç»„ # æ•°ç»„ï¼ˆArrayï¼‰æ˜¯ä¸€ç§å¸¸è§æ•°æ®ç»“æ„ï¼Œç”±ç›¸åŒç±»å‹çš„å…ƒç´ ï¼ˆelementï¼‰ç»„æˆï¼Œå¹¶ä¸”æ˜¯ä½¿ç”¨ä¸€å—è¿ç»­çš„å†…å­˜æ¥å­˜å‚¨ ç›´æ¥å¯ä»¥åˆ©ç”¨å…ƒç´ çš„**ç´¢å¼•ï¼ˆindexï¼‰**å¯ä»¥è®¡ç®—å‡ºè¯¥å…ƒç´ å¯¹åº”çš„å­˜å‚¨åœ°å€ æ•°ç»„çš„ç‰¹ç‚¹æ˜¯ï¼šæä¾›éšæœºè®¿é—®å¹¶ä¸”å®¹é‡æœ‰é™ å‡è®¾æ•°ç»„é•¿åº¦ä¸ºnï¼š\nè®¿é—®ï¼šO(1) //è®¿é—®ç‰¹å®šä½ç½®çš„å…ƒç´ \næ’å…¥ï¼šO(n) //æœ€åçš„æƒ…å†µæ’å…¥åœ¨æ•°ç»„çš„é¦–éƒ¨å¹¶éœ€è¦ç§»åŠ¨æ‰€æœ‰å…ƒç´ æ—¶\nåˆ é™¤ï¼šO(n) //æœ€åçš„æƒ…å†µå‘ç”Ÿåœ¨åˆ é™¤æ•°ç»„çš„å¼€å¤´å¹¶éœ€è¦ç§»åŠ¨ç¬¬ä¸€å…ƒç´ åé¢æ‰€æœ‰çš„å…ƒç´ æ—¶\né“¾è¡¨ # é“¾è¡¨ç®€ä»‹ # é“¾è¡¨ï¼ˆLinkedListï¼‰è™½ç„¶æ˜¯ä¸€ç§çº¿æ€§è¡¨ï¼Œä½†æ˜¯å¹¶ä¸ä¼šæŒ‰çº¿æ€§çš„é¡ºåºå­˜å‚¨æ•°æ®ï¼Œä½¿ç”¨çš„ä¸æ˜¯è¿ç»­çš„å†…å­˜ç©ºé—´æ¥å­˜å‚¨æ•°æ®\né“¾è¡¨çš„æ’å…¥å’Œåˆ é™¤æ“ä½œçš„å¤æ‚åº¦ä¸ºO(1)ï¼Œåªéœ€è¦ç›´åˆ°ç›®æ ‡ä½ç½®å…ƒç´ çš„ä¸Šä¸€ä¸ªå…ƒç´ å³å¯ã€‚ä½†æ˜¯ï¼Œåœ¨æŸ¥æ‰¾ä¸€ä¸ªèŠ‚ç‚¹æˆ–è€…è®¿é—®ç‰¹å®šä½ç½®çš„èŠ‚ç‚¹çš„æ—¶å€™å¤æ‚åº¦ä¸ºO(n)\nä½¿ç”¨é“¾è¡¨ç»“æ„å¯ä»¥å…‹æœæ•°ç»„éœ€è¦é¢„å…ˆçŸ¥é“æ•°æ®å¤§å°çš„ç¼ºç‚¹ï¼Œé“¾è¡¨ç»“æ„å¯ä»¥å……åˆ†åˆ©ç”¨è®¡ç®—æœºå†…å­˜ç©ºé—´ï¼Œå®ç°çµæ´»çš„å†…å­˜åŠ¨æ€ç®¡ç†\nä½†é“¾è¡¨ä¸ä¼šèŠ‚çœç©ºé—´ï¼Œç›¸æ¯”äºæ•°ç»„ä¼šå ç”¨æ›´å¤šç©ºé—´ï¼Œå› ä¸ºé“¾è¡¨ä¸­æ¯ä¸ªèŠ‚ç‚¹å­˜æ”¾çš„è¿˜æœ‰æŒ‡å‘å…¶ä»–èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚é™¤æ­¤ä¹‹å¤–ï¼Œé“¾è¡¨ä¸å…·æœ‰æ•°ç»„éšæœºè¯»å–çš„ä¼˜ç‚¹\né“¾è¡¨åˆ†ç±» # å•é“¾è¡¨ã€åŒå‘é“¾è¡¨ã€å¾ªç¯é“¾è¡¨ã€åŒå‘å¾ªç¯é“¾è¡¨\nå‡è®¾é“¾è¡¨ä¸­æœ‰nä¸ªå…ƒç´ \nè®¿é—®ï¼šO(n) //è®¿é—®ç‰¹åœ°ç»™ä½ç½®çš„å…ƒç´ \næ’å…¥åˆ é™¤ï¼šO(1) //å¿…é¡»è¦çŸ¥é“æ’å…¥å…ƒç´ çš„ä½ç½®\nå•é“¾è¡¨ # å•é“¾è¡¨åªæœ‰ä¸€ä¸ªæ–¹å‘ï¼Œç»“ç‚¹åªæœ‰ä¸€ä¸ªåç»§æŒ‡é’ˆnextæŒ‡å‘åé¢çš„èŠ‚ç‚¹ã€‚å› æ­¤ï¼Œé“¾è¡¨è¿™ç§æ•°æ®ç»“æ„é€šå¸¸åœ¨ç‰©ç†å†…å­˜ä¸Šæ˜¯ä¸è¿ç»­çš„ æˆ‘ä»¬ä¹ æƒ¯æ€§åœ°æŠŠç¬¬ä¸€ä¸ªç»“ç‚¹å«åšå¤´ç»“ç‚¹ï¼Œé“¾è¡¨é€šå¸¸æœ‰ä¸€ä¸ªä¸ä¿å­˜ä»»ä½•å€¼çš„headèŠ‚ç‚¹ï¼ˆå¤´ç»“ç‚¹ï¼‰ï¼Œé€šè¿‡å¤´ç»“ç‚¹æˆ‘ä»¬å¯ä»¥éå†æ•´ä¸ªé“¾è¡¨ï¼Œå°¾ç»“ç‚¹é€šå¸¸æŒ‡å‘null å¦‚ä¸‹å›¾ å¾ªç¯é“¾è¡¨ # å¾ªç¯é“¾è¡¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„å•é“¾è¡¨ï¼Œå’Œå•é“¾è¡¨ä¸åŒçš„æ˜¯å¾ªç¯é“¾è¡¨çš„å°¾ç»“ç‚¹ä¸æ˜¯æŒ‡å‘nullï¼Œè€Œæ˜¯æŒ‡å‘é“¾è¡¨çš„å¤´ç»“ç‚¹ å¦‚å›¾ åŒå‘é“¾è¡¨ # åŒå‘é“¾è¡¨åŒ…å«ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªprevæŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦ä¸€ä¸ªnextæŒ‡å‘ å¦‚å›¾ åŒå‘å¾ªç¯é“¾è¡¨ # åŒå‘å¾ªç¯é“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„nextæŒ‡å‘headï¼Œè€Œheadçš„prevæŒ‡å‘æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ„æˆä¸€ä¸ªç¯\nåº”ç”¨åœºæ™¯ # å¦‚æœéœ€è¦æ”¯æŒéšæœºè®¿é—®çš„è¯ï¼Œé“¾è¡¨æ— æ³•åšåˆ° å¦‚æœéœ€è¦å­˜å‚¨çš„æ•°æ®å…ƒç´ ä¸ªæ•°ä¸ç¡®å®šï¼Œå¹¶ä¸”éœ€è¦ç»å¸¸æ·»åŠ å’Œåˆ é™¤æ•°æ®çš„è¯ï¼Œä½¿ç”¨é“¾è¡¨æ¯”è¾ƒåˆé€‚ å¦‚æœéœ€è¦å­˜å‚¨çš„æ•°æ®å…ƒç´ çš„ä¸ªæ•°ç¡®å®šï¼Œå¹¶ä¸”ä¸éœ€è¦ç»å¸¸æ·»åŠ å’Œåˆ é™¤æ•°æ®çš„è¯ï¼Œä½¿ç”¨æ•°ç»„æ¯”è¾ƒåˆé€‚ æ•°ç»„ vs é“¾è¡¨ # æ•°ç»„æ”¯æŒéšæœºè®¿é—®ï¼Œé“¾è¡¨ä¸æ”¯æŒ æ•°ç»„ä½¿ç”¨çš„æ˜¯è¿ç»­å†…å­˜ç©ºé—´ å¯¹CPUç¼“å­˜æœºåˆ¶å‹å¥½ï¼Œé“¾è¡¨åˆ™ç›¸å æ•°ç»„çš„å¤§å°å›ºå®šï¼Œè€Œé“¾è¡¨åˆ™å¤©ç„¶æ”¯æŒåŠ¨æ€æ‰©å®¹ã€‚å¦‚æœç”Ÿå‘½çš„æ•°ç»„è¿‡å°ï¼Œéœ€è¦å¦å¤–ç”³è¯·ä¸€ä¸ªæ›´å¤§çš„å†…å­˜ç©ºé—´å­˜æ”¾æ•°ç»„å…ƒç´ ï¼Œç„¶åå°†åŸæ•°ç»„æ‹·è´è¿›å»ï¼Œè¿™ä¸ªæ“ä½œæ¯”è¾ƒè€—æ—¶ æ ˆ # æ ˆç®€ä»‹ # æ ˆï¼ˆstackï¼‰åªå…è®¸åœ¨æœ‰åºçš„çº¿æ€§æ•°æ®é›†åˆçš„ä¸€ç«¯ï¼ˆç§°ä¸ºæ ˆé¡¶topï¼‰è¿›è¡ŒåŠ å…¥æ•°æ®ï¼ˆpushï¼‰å’Œç§»é™¤æ•°æ®ï¼ˆpopï¼‰ã€‚å› è€ŒæŒ‰ç…§**åè¿›å…ˆå‡ºï¼ˆLIFOï¼ŒLast In First Outï¼‰**çš„åŸç†è¿ä½œã€‚ æ ˆä¸­ï¼Œpushå’Œpopçš„æ“ä½œéƒ½å‘ç”Ÿåœ¨æ ˆé¡¶ æ ˆå¸¸ç”¨ä¸€ç»´æ•°ç»„æˆ–é“¾è¡¨æ¥å®ç°ï¼Œç”¨æ•°ç»„å®ç°çš„å«é¡ºåºæ ˆï¼Œç”¨é“¾è¡¨å®ç°çš„å«åšé“¾å¼æ ˆ å‡è®¾å †æ ˆä¸­æœ‰nä¸ªå…ƒç´ ã€‚ è®¿é—®ï¼šOï¼ˆnï¼‰//æœ€åæƒ…å†µ æ’å…¥åˆ é™¤ï¼šOï¼ˆ1ï¼‰//é¡¶ç«¯æ’å…¥å’Œåˆ é™¤å…ƒç´ \nå¦‚å›¾ï¼š\næ ˆçš„å¸¸è§åº”ç”¨åœºæ™¯ # å½“æˆ‘ä»¬è¦å¤„ç†çš„æ•°æ®ï¼Œåªæ¶‰åŠåœ¨ä¸€ç«¯æ’å…¥å’Œåˆ é™¤æ•°æ®ï¼Œå¹¶ä¸”æ»¡è¶³åè¿›å…ˆå‡ºï¼ˆLIFOï¼ŒLastInFirstOutï¼‰çš„ç‰¹æ€§æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ ˆè¿™ä¸ªæ•°æ®ç»“æ„ã€‚\nå®ç°æµè§ˆå™¨çš„å›é€€å’Œå‰è¿›åŠŸèƒ½ # æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ä¸¤ä¸ªæ ˆ(Stack1 å’Œ Stack2)å’Œå°±èƒ½å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚æ¯”å¦‚ä½ æŒ‰é¡ºåºæŸ¥çœ‹äº† 1,2,3,4 è¿™å››ä¸ªé¡µé¢ï¼Œæˆ‘ä»¬ä¾æ¬¡æŠŠ 1,2,3,4 è¿™å››ä¸ªé¡µé¢å‹å…¥ Stack1 ä¸­ã€‚å½“ä½ æƒ³å›å¤´çœ‹ 2 è¿™ä¸ªé¡µé¢çš„æ—¶å€™ï¼Œä½ ç‚¹å‡»å›é€€æŒ‰é’®ï¼Œæˆ‘ä»¬ä¾æ¬¡æŠŠ 4,3 è¿™ä¸¤ä¸ªé¡µé¢ä» Stack1 å¼¹å‡ºï¼Œç„¶åå‹å…¥ Stack2 ä¸­ã€‚å‡å¦‚ä½ åˆæƒ³å›åˆ°é¡µé¢ 3ï¼Œä½ ç‚¹å‡»å‰è¿›æŒ‰é’®ï¼Œæˆ‘ä»¬å°† 3 é¡µé¢ä» Stack2 å¼¹å‡ºï¼Œç„¶åå‹å…¥åˆ° Stack1 ä¸­ã€‚ç¤ºä¾‹å›¾å¦‚ä¸‹\næ£€æŸ¥ç¬¦å·æ˜¯å¦æ‰¿å…‘å‡ºç° # ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ '('ï¼Œ')'ï¼Œ'{'ï¼Œ'}'ï¼Œ'['ï¼Œ']' çš„å­—ç¬¦ä¸²ï¼Œåˆ¤æ–­è¯¥å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚\næœ‰æ•ˆå­—ç¬¦ä¸²éœ€æ»¡è¶³ï¼š\nå·¦æ‹¬å·å¿…é¡»ç”¨ç›¸åŒç±»å‹çš„å³æ‹¬å·é—­åˆã€‚ å·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆã€‚ æ¯”å¦‚ \u0026ldquo;()\u0026quot;ã€\u0026rdquo;()[]{}\u0026quot;ã€\u0026quot;{[]}\u0026quot; éƒ½æ˜¯æœ‰æ•ˆå­—ç¬¦ä¸²ï¼Œè€Œ \u0026ldquo;(]\u0026rdquo; ã€\u0026quot;([)]\u0026quot; åˆ™ä¸æ˜¯ã€‚\nè¿™ä¸ªé—®é¢˜å®é™…æ˜¯ Leetcode çš„ä¸€é“é¢˜ç›®ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ ˆ Stack æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\né¦–å…ˆæˆ‘ä»¬å°†æ‹¬å·é—´çš„å¯¹åº”è§„åˆ™å­˜æ”¾åœ¨ Map ä¸­ï¼Œè¿™ä¸€ç‚¹åº”è¯¥æ¯‹å®¹ç½®ç–‘ï¼› åˆ›å»ºä¸€ä¸ªæ ˆã€‚éå†å­—ç¬¦ä¸²ï¼Œå¦‚æœå­—ç¬¦æ˜¯å·¦æ‹¬å·å°±ç›´æ¥åŠ å…¥stackä¸­ï¼Œå¦åˆ™å°†stack çš„æ ˆé¡¶å…ƒç´ ä¸è¿™ä¸ªæ‹¬å·åšæ¯”è¾ƒï¼Œå¦‚æœä¸ç›¸ç­‰å°±ç›´æ¥è¿”å› falseã€‚éå†ç»“æŸï¼Œå¦‚æœstackä¸ºç©ºï¼Œè¿”å› trueã€‚ public boolean isValid(String s){ // æ‹¬å·ä¹‹é—´çš„å¯¹åº”è§„åˆ™ HashMap\u0026lt;Character, Character\u0026gt; mappings = new HashMap\u0026lt;Character, Character\u0026gt;(); mappings.put(\u0026#39;)\u0026#39;, \u0026#39;(\u0026#39;); mappings.put(\u0026#39;}\u0026#39;, \u0026#39;{\u0026#39;); mappings.put(\u0026#39;]\u0026#39;, \u0026#39;[\u0026#39;); Stack\u0026lt;Character\u0026gt; stack = new Stack\u0026lt;Character\u0026gt;(); char[] chars = s.toCharArray(); for (int i = 0; i \u0026lt; chars.length; i++) { if (mappings.containsKey(chars[i])) { char topElement = stack.empty() ? \u0026#39;#\u0026#39; : stack.pop(); if (topElement != mappings.get(chars[i])) { return false; } } else { stack.push(chars[i]); } } return stack.isEmpty(); } åè½¬å­—ç¬¦ä¸² # å°†å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦å…ˆå…¥æ ˆå†å‡ºæ ˆå°±å¯ä»¥äº†ã€‚\nç»´æŠ¤å‡½æ•°è°ƒç”¨ # æœ€åä¸€ä¸ªè¢«è°ƒç”¨çš„å‡½æ•°å¿…é¡»å…ˆå®Œæˆæ‰§è¡Œï¼Œç¬¦åˆæ ˆçš„ åè¿›å…ˆå‡ºï¼ˆLIFO, Last In First Outï¼‰ ç‰¹æ€§ã€‚\næ ˆçš„å®ç° # æ ˆæ—¢å¯ä»¥é€šè¿‡æ•°ç»„å®ç°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é“¾è¡¨å®ç°ã€‚ä¸¤ç§æƒ…å†µä¸‹ï¼Œå…¥æ ˆã€å‡ºæ ˆçš„æ—¶é—´å¤æ‚åº¦å‡ä¸ºO(1)\nä¸‹é¢ä½¿ç”¨æ•°ç»„ä¸‹å®ç°æ ˆï¼Œå…·æœ‰push()ã€pop() ï¼ˆè¿”å›æ ˆé¡¶å…ƒç´ å¹¶å‡ºæ ˆï¼‰ã€peek() ï¼ˆè¿”å›æ ˆé¡¶å…ƒç´ ä¸å‡ºæ ˆï¼‰ã€isEmpty() ã€size() è¿™äº›åŸºæœ¬çš„æ–¹æ³•\næ¯æ¬¡å…¥æ ˆå‰å…ˆåˆ¤æ–­æ ˆå®¹é‡æ˜¯å¦å¤Ÿç”¨ï¼Œå¦‚æœä¸å¤Ÿç”¨å°±ç”¨Arrays.copyOf() è¿›è¡Œæ‰©å®¹\npublic class MyStack { private int[] storage;//å­˜æ”¾æ ˆä¸­å…ƒç´ çš„æ•°ç»„ private int capacity;//æ ˆçš„å®¹é‡ private int count;//æ ˆä¸­å…ƒç´ æ•°é‡ private static final int GROW_FACTOR = 2; //ä¸å¸¦åˆå§‹å®¹é‡çš„æ„é€ æ–¹æ³•ã€‚é»˜è®¤å®¹é‡ä¸º8 public MyStack() { this.capacity = 8; this.storage=new int[8]; this.count = 0; } //å¸¦åˆå§‹å®¹é‡çš„æ„é€ æ–¹æ³• public MyStack(int initialCapacity) { if (initialCapacity \u0026lt; 1) throw new IllegalArgumentException(\u0026#34;Capacity too small.\u0026#34;); this.capacity = initialCapacity; this.storage = new int[initialCapacity]; this.count = 0; } //å…¥æ ˆ public void push(int value) { if (count == capacity) { ensureCapacity(); } storage[count++] = value; } //ç¡®ä¿å®¹é‡å¤§å° private void ensureCapacity() { int newCapacity = capacity * GROW_FACTOR; storage = Arrays.copyOf(storage, newCapacity); capacity = newCapacity; } //è¿”å›æ ˆé¡¶å…ƒç´ å¹¶å‡ºæ ˆ private int pop() { if (count == 0) throw new IllegalArgumentException(\u0026#34;Stack is empty.\u0026#34;); count--; return storage[count]; } //è¿”å›æ ˆé¡¶å…ƒç´ ä¸å‡ºæ ˆ private int peek() { if (count == 0){ throw new IllegalArgumentException(\u0026#34;Stack is empty.\u0026#34;); }else { return storage[count-1]; } } //åˆ¤æ–­æ ˆæ˜¯å¦ä¸ºç©º private boolean isEmpty() { return count == 0; } //è¿”å›æ ˆä¸­å…ƒç´ çš„ä¸ªæ•° private int size() { return count; } } /*---- MyStack myStack = new MyStack(3); myStack.push(1); myStack.push(2); myStack.push(3); myStack.push(4); myStack.push(5); myStack.push(6); myStack.push(7); myStack.push(8); System.out.println(myStack.peek());//8 System.out.println(myStack.size());//8 for (int i = 0; i \u0026lt; 8; i++) { System.out.println(myStack.pop()); } System.out.println(myStack.isEmpty());//true myStack.pop();//æŠ¥é”™ï¼šjava.lang.IllegalArgumentException: Stack is empty. */ é˜Ÿåˆ— # é˜Ÿåˆ—ç®€ä»‹ # é˜Ÿåˆ—æ˜¯**å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼ŒFirst Inï¼ŒFirst Outï¼‰**çš„çº¿æ€§è¡¨\né€šå¸¸ç”¨é“¾è¡¨æˆ–æ•°ç»„æ¥å®ç°ï¼Œç”¨æ•°ç»„å®ç°çš„é˜Ÿåˆ—å«åšé¡ºåºé˜Ÿåˆ—ï¼Œç”¨é“¾è¡¨å®ç°çš„é˜Ÿåˆ—å«åšé“¾å¼é˜Ÿåˆ—ã€‚\né˜Ÿåˆ—åªå…è®¸åœ¨åç«¯ï¼ˆrearï¼‰è¿›è¡Œæ’å…¥æ“ä½œä¹Ÿå°±æ˜¯å…¥é˜Ÿenqueueï¼Œåœ¨å‰ç«¯ï¼ˆfrontï¼‰è¿›è¡Œåˆ é™¤æ“ä½œä¹Ÿå°±æ˜¯å‡ºé˜Ÿ dequeue\né˜Ÿåˆ—çš„æ“ä½œæ–¹å¼å’Œå †æ ˆç±»ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºé˜Ÿåˆ—åªå…è®¸æ–°æ•°æ®åœ¨åç«¯è¿›è¡Œæ·»åŠ ï¼ˆä¸å…è®¸åœ¨åç«¯åˆ é™¤ï¼‰\nå‡è®¾é˜Ÿåˆ—ä¸­æœ‰nä¸ªå…ƒç´ ã€‚ è®¿é—®ï¼šOï¼ˆnï¼‰//æœ€åæƒ…å†µ æ’å…¥åˆ é™¤ï¼šOï¼ˆ1ï¼‰//åç«¯æ’å…¥å‰ç«¯åˆ é™¤å…ƒç´ \né˜Ÿåˆ—åˆ†ç±» # å•é˜Ÿåˆ— # è¿™æ˜¯å¸¸è§çš„é˜Ÿåˆ—ï¼Œæ¯æ¬¡æ·»åŠ å…ƒç´ æ—¶ï¼Œéƒ½æ˜¯æ·»åŠ åˆ°é˜Ÿå°¾ã€‚å•é˜Ÿåˆ—åˆåˆ†ä¸ºé¡ºåºé˜Ÿåˆ—ï¼ˆæ•°ç»„å®ç°ï¼‰å’Œé“¾å¼é˜Ÿåˆ—ï¼ˆé“¾è¡¨å®ç°ï¼‰\né¡ºåºé˜Ÿåˆ—å­˜åœ¨å‡æº¢å‡ºï¼šå³æ˜æ˜æœ‰ä½ç½®å´ä¸èƒ½æ·»åŠ \nå‡è®¾ä¸‹å›¾æ˜¯ä¸€ä¸ªé¡ºåºé˜Ÿåˆ—ï¼Œæˆ‘ä»¬å°†å‰ä¸¤ä¸ªå…ƒç´  1,2 å‡ºé˜Ÿï¼Œå¹¶å…¥é˜Ÿä¸¤ä¸ªå…ƒç´  7,8ã€‚å½“è¿›è¡Œå…¥é˜Ÿã€å‡ºé˜Ÿæ“ä½œçš„æ—¶å€™ï¼Œfront å’Œ rear éƒ½ä¼šæŒç»­å¾€åç§»åŠ¨ï¼Œå½“ rear ç§»åŠ¨åˆ°æœ€åçš„æ—¶å€™,æˆ‘ä»¬æ— æ³•å†å¾€é˜Ÿåˆ—ä¸­æ·»åŠ æ•°æ®ï¼Œå³ä½¿æ•°ç»„ä¸­è¿˜æœ‰ç©ºä½™ç©ºé—´ï¼Œè¿™ç§ç°è±¡å°±æ˜¯ â€å‡æº¢å‡ºâ€œ ã€‚é™¤äº†å‡æº¢å‡ºé—®é¢˜ä¹‹å¤–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“æ·»åŠ å…ƒç´  8 çš„æ—¶å€™ï¼Œrear æŒ‡é’ˆç§»åŠ¨åˆ°æ•°ç»„ä¹‹å¤–ï¼ˆè¶Šç•Œï¼‰\nä¸ºäº†é¿å…å½“åªæœ‰ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œé˜Ÿå¤´å’Œé˜Ÿå°¾é‡åˆä½¿å¤„ç†å˜å¾—éº»çƒ¦ï¼Œæ‰€ä»¥å¼•å…¥ä¸¤ä¸ªæŒ‡é’ˆï¼Œfront æŒ‡é’ˆæŒ‡å‘å¯¹å¤´å…ƒç´ ï¼ˆä¸æ˜¯å¤´ç»“ç‚¹ï¼‰ï¼Œrear æŒ‡é’ˆæŒ‡å‘é˜Ÿåˆ—æœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œè¿™æ ·å½“ front ç­‰äº rear æ—¶ï¼Œæ­¤é˜Ÿåˆ—ä¸æ˜¯è¿˜å‰©ä¸€ä¸ªå…ƒç´ ï¼Œè€Œæ˜¯ç©ºé˜Ÿåˆ—ã€‚â€”â€”From ã€Šå¤§è¯æ•°æ®ç»“æ„ã€‹\nï¼ˆå½“åªæœ‰ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œfront æŒ‡å‘0ï¼ŒrearæŒ‡å‘1ï¼‰\nå¾ªç¯é˜Ÿåˆ— # å¾ªç¯é˜Ÿåˆ—å¯ä»¥è§£å†³é¡ºåºé˜Ÿåˆ—çš„å‡æº¢å‡ºå’Œè¶Šç•Œé—®é¢˜ã€‚è§£å†³åŠæ³•å°±æ˜¯ï¼šä»å¤´å¼€å§‹ï¼Œè¿™æ ·ä¹Ÿå°±ä¼šå½¢æˆå¤´å°¾ç›¸æ¥çš„å¾ªç¯ï¼Œè¿™ä¹Ÿå°±æ˜¯å¾ªç¯é˜Ÿåˆ—åå­—çš„ç”±æ¥ã€‚ ï¼ˆè¶…å‡ºçš„æ—¶å€™ï¼Œå°†rearæŒ‡å‘0ä¸‹æ ‡ï¼‰ã€‚ä¹‹åå†æ·»åŠ æ—¶ï¼Œå‘åç§»åŠ¨å³å¯\né¡ºåºé˜Ÿåˆ—ä¸­ï¼Œæˆ‘ä»¬è¯´ front==rear çš„æ—¶å€™é˜Ÿåˆ—ä¸ºç©ºï¼Œå¾ªç¯é˜Ÿåˆ—ä¸­åˆ™ä¸ä¸€æ ·ï¼Œä¹Ÿå¯èƒ½ä¸ºæ»¡ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚è§£å†³åŠæ³•æœ‰ä¸¤ç§ï¼š å¯ä»¥è®¾ç½®ä¸€ä¸ªæ ‡å¿—å˜é‡ flag,å½“ front==rear å¹¶ä¸” flag=0 çš„æ—¶å€™é˜Ÿåˆ—ä¸ºç©ºï¼Œå½“front==rear å¹¶ä¸” flag=1 çš„æ—¶å€™é˜Ÿåˆ—ä¸ºæ»¡ã€‚ é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™å°±æ˜¯ front==rear ï¼Œé˜Ÿåˆ—æ»¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¿è¯æ•°ç»„è¿˜æœ‰ä¸€ä¸ªç©ºé—²çš„ä½ç½®ï¼Œrear å°±æŒ‡å‘è¿™ä¸ªç©ºé—²ä½ç½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé‚£ä¹ˆç°åœ¨åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºæ»¡çš„æ¡ä»¶å°±æ˜¯ï¼š (rear+1) % QueueSize= front ã€‚ å…¶å®ä¹Ÿå°±æ˜¯æ¢ä¸€ä¸ªå®šä¹‰ç½¢äº† å¸¸è§åº”ç”¨åœºæ™¯ # å½“æˆ‘ä»¬éœ€è¦æŒ‰ç…§ä¸€å®šé¡ºåºæ¥å¤„ç†æ•°æ®çš„æ—¶å€™å¯ä»¥è€ƒè™‘ä½¿ç”¨é˜Ÿåˆ—è¿™ä¸ªæ•°æ®ç»“æ„\né˜»å¡é˜Ÿåˆ—ï¼š é˜»å¡é˜Ÿåˆ—å¯ä»¥çœ‹æˆåœ¨é˜Ÿåˆ—åŸºç¡€ä¸ŠåŠ äº†é˜»å¡æ“ä½œçš„é˜Ÿåˆ—ã€‚å½“é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™ï¼Œå‡ºé˜Ÿæ“ä½œé˜»å¡ï¼Œå½“é˜Ÿåˆ—æ»¡çš„æ—¶å€™ï¼Œå…¥é˜Ÿæ“ä½œé˜»å¡ã€‚ä½¿ç”¨é˜»å¡é˜Ÿåˆ—æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“**å®ç°â€œç”Ÿäº§è€… - æ¶ˆè´¹è€…â€œ**æ¨¡å‹ çº¿ç¨‹æ± ä¸­çš„è¯·æ±‚/ä»»åŠ¡é˜Ÿåˆ—ï¼š çº¿ç¨‹æ± ä¸­æ²¡æœ‰ç©ºé—²çº¿ç¨‹æ—¶ï¼Œæ–°çš„ä»»åŠ¡è¯·æ±‚çº¿ç¨‹èµ„æºæ—¶ï¼Œçº¿ç¨‹æ± è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å°†è¿™äº›è¯·æ±‚æ”¾åœ¨é˜Ÿåˆ—ä¸­ï¼Œå½“æœ‰ç©ºé—²çº¿ç¨‹çš„æ—¶å€™ï¼Œä¼šå¾ªç¯ä¸­åå¤ä»é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡æ¥æ‰§è¡Œã€‚é˜Ÿåˆ—åˆ†ä¸ºæ— ç•Œé˜Ÿåˆ—(åŸºäºé“¾è¡¨)å’Œæœ‰ç•Œé˜Ÿåˆ—(åŸºäºæ•°ç»„)ã€‚æ— ç•Œé˜Ÿåˆ—çš„ç‰¹ç‚¹å°±æ˜¯å¯ä»¥ä¸€ç›´å…¥åˆ—ï¼Œé™¤éç³»ç»Ÿèµ„æºè€—å°½ï¼Œæ¯”å¦‚ ï¼šFixedThreadPool ä½¿ç”¨æ— ç•Œé˜Ÿåˆ— LinkedBlockingQueueã€‚ä½†æ˜¯æœ‰ç•Œé˜Ÿåˆ—å°±ä¸ä¸€æ ·äº†ï¼Œå½“é˜Ÿåˆ—æ»¡çš„è¯åé¢å†æœ‰ä»»åŠ¡/è¯·æ±‚å°±ä¼šæ‹’ç»ï¼Œåœ¨ Java ä¸­çš„ä½“ç°å°±æ˜¯ä¼šæŠ›å‡º**java.util.concurrent.RejectedExecutionException** å¼‚å¸¸ã€‚ Linux å†…æ ¸è¿›ç¨‹é˜Ÿåˆ—ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’é˜Ÿï¼‰ ç°å®ç”Ÿæ´»ä¸­çš„æ´¾å¯¹ï¼Œæ’­æ”¾å™¨ä¸Šçš„æ’­æ”¾åˆ—è¡¨; æ¶ˆæ¯é˜Ÿåˆ— ç­‰ç­‰\u0026hellip;\u0026hellip; "},{"id":118,"href":"/zh/docs/study/Review/java_guide/database/ly0501lybasis/","title":"æ•°æ®åº“åŸºç¡€","section":"æ•°æ®åº“","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nè¿™éƒ¨åˆ†å†…å®¹ç”±äºæ¶‰åŠå¤ªå¤šæ¦‚å¿µæ€§å†…å®¹ï¼Œæ‰€ä»¥å‚è€ƒäº†ç»´åŸºç™¾ç§‘å’Œç™¾åº¦ç™¾ç§‘ç›¸åº”çš„ä»‹ç»ã€‚\nä»€ä¹ˆæ˜¯æ•°æ®åº“ï¼Œæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œæ•°æ®åº“ç³»ç»Ÿï¼Œæ•°æ®åº“ç®¡ç†å‘˜ # æ•°æ®åº“ï¼šæ•°æ®åº“ï¼ˆDataBase ç®€ç§°DBï¼‰å°±æ˜¯ä¿¡æ¯çš„é›†åˆæˆ–è€…è¯´æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç®¡ç†çš„æ•°æ®çš„é›†åˆã€‚ æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼šæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDatabase Management System ç®€ç§°DBMSï¼‰æ˜¯ä¸€ç§æ“çºµå’Œç®¡ç†æ•°æ®åº“çš„å¤§å‹è½¯ä»¶ï¼Œé€šå¸¸ç”¨äºå»ºç«‹ã€ä½¿ç”¨å’Œç»´æŠ¤ æ•°æ®åº“ã€‚ æ•°æ®åº“ç³»ç»Ÿï¼ˆèŒƒå›´æœ€å¤§ï¼‰ï¼šæ•°æ®åº“ç³»ç»Ÿï¼ˆData Base Systemï¼Œç®€ç§°DBSï¼‰é€šå¸¸ç”±**è½¯ä»¶ã€æ•°æ®å’Œæ•°æ®ç®¡ç†å‘˜ï¼ˆDBAï¼‰**ç»„æˆã€‚ æ•°æ®åº“ç®¡ç†å‘˜ï¼šæ•°æ®åº“ç®¡ç†å‘˜ï¼ˆDatabase Adminitratorï¼Œç®€ç§°DBAï¼‰è´Ÿè´£å…¨é¢ç®¡ç†å’Œæ§åˆ¶æ•°æ®åº“ç³»ç»Ÿ (æ˜¯ä¸€ä¸ªäºº) æ•°æ®åº“ç³»ç»ŸåŸºæœ¬æ„æˆå¦‚ä¸‹å›¾æ‰€ç¤º\nä»€ä¹ˆæ˜¯å…ƒç»„ï¼Œç ï¼Œå€™é€‰ç ï¼Œä¸»ç ï¼Œå¤–ç ï¼Œä¸»å±æ€§ï¼Œéä¸»å±æ€§ # å…ƒç»„ï¼šå…ƒç»„ï¼ˆtupleï¼‰æ˜¯å…³ç³»æ•°æ®åº“ä¸­çš„åŸºæœ¬æ¦‚å¿µï¼Œå…³ç³»æ˜¯ä¸€å¼ è¡¨ï¼Œè¡¨ä¸­çš„æ¯è¡Œï¼ˆå³æ•°æ®åº“ä¸­çš„æ¯æ¡è®°å½•ï¼‰å°±æ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œæ¯åˆ—å°±æ˜¯ä¸€ä¸ªå±æ€§ã€‚åœ¨äºŒç»´è¡¨é‡Œï¼Œå…ƒç»„ä¹Ÿæˆä¸ºè¡Œ ç ï¼šç å°±æ˜¯èƒ½å”¯ä¸€æ ‡è¯†å®ä½“çš„å±æ€§ï¼Œå¯¹åº”è¡¨ä¸­çš„åˆ— å€™é€‰ç ï¼šè‹¥å…³ç³»ä¸­çš„æŸä¸€å±æ€§æˆ–å±æ€§ç»„çš„å€¼èƒ½å”¯ä¸€çš„æ ‡è¯†ä¸€ä¸ªå…ƒç»„ï¼Œè€Œå…¶ä»»ä½•ã€å­é›†éƒ½ä¸èƒ½å†æ ‡è¯†ï¼Œåˆ™ç§°è¯¥å±æ€§ç»„ä¸ºå€™é€‰ç ã€‚ä¾‹å¦‚ï¼šåœ¨å­¦ç”Ÿå®ä½“ä¸­ï¼Œâ€œå­¦å·â€æ˜¯èƒ½å”¯ä¸€çš„åŒºåˆ†å­¦ç”Ÿå®ä½“çš„ï¼ŒåŒæ—¶åˆå‡è®¾â€œå§“åâ€ã€â€œç­çº§â€çš„å±æ€§ç»„åˆè¶³ä»¥åŒºåˆ†å­¦ç”Ÿå®ä½“ï¼Œé‚£ä¹ˆ**{å­¦å·}å’Œ{å§“åï¼Œç­çº§}éƒ½æ˜¯å€™é€‰ç **ã€‚ ä¸»ç ï¼šä¸»ç ä¹Ÿå«ä¸»é”®ï¼Œä¸»ç æ˜¯ä»å€™é€‰ç ä¸­é€‰å‡ºæ¥çš„ã€‚ä¸€ä¸ªå®ä½“é›†ä¸­åªèƒ½æœ‰ä¸€ä¸ªä¸»ç ï¼Œä½†å¯ä»¥æœ‰å¤šä¸ªå€™é€‰ç  å¤–ç ï¼šå¤–ç ä¹Ÿå«å¤–é”®ã€‚å¦‚æœä¸€ä¸ªå…³ç³»ä¸­çš„ä¸€ä¸ªå±æ€§æ˜¯å¦å¤–ä¸€ä¸ªå…³ç³»ä¸­çš„ä¸»ç åˆ™è¿™ä¸ªå±æ€§ä¸ºå¤–ç ã€‚ ä¸»å±æ€§ ï¼š å€™é€‰ç ä¸­å‡ºç°è¿‡çš„å±æ€§ç§°ä¸ºä¸»å±æ€§(è¿™é‡Œå¼ºè°ƒå•ä¸ªï¼‰ã€‚æ¯”å¦‚å…³ç³» å·¥äººï¼ˆå·¥å·ï¼Œèº«ä»½è¯å·ï¼Œå§“åï¼Œæ€§åˆ«ï¼Œéƒ¨é—¨ï¼‰. æ˜¾ç„¶å·¥å·å’Œèº«ä»½è¯å·éƒ½èƒ½å¤Ÿå”¯ä¸€æ ‡ç¤ºè¿™ä¸ªå…³ç³»ï¼Œæ‰€ä»¥éƒ½æ˜¯å€™é€‰ç ã€‚å·¥å·ã€èº«ä»½è¯å·è¿™ä¸¤ä¸ªå±æ€§å°±æ˜¯ä¸»å±æ€§ã€‚å¦‚æœä¸»ç æ˜¯ä¸€ä¸ªå±æ€§ç»„ï¼Œé‚£ä¹ˆå±æ€§ç»„ä¸­çš„å±æ€§éƒ½æ˜¯ä¸»å±æ€§ã€‚ éä¸»å±æ€§ï¼š ä¸åŒ…å«åœ¨ä»»ä½•ä¸€ä¸ªå€™é€‰ç ä¸­çš„å±æ€§ç§°ä¸ºéä¸»å±æ€§ã€‚æ¯”å¦‚åœ¨å…³ç³»â€”â€”å­¦ç”Ÿï¼ˆå­¦å·ï¼Œå§“åï¼Œå¹´é¾„ï¼Œæ€§åˆ«ï¼Œç­çº§ï¼‰ä¸­ï¼Œä¸»ç æ˜¯â€œå­¦å·â€ï¼Œé‚£ä¹ˆå…¶ä»–çš„â€œå§“åâ€ã€â€œå¹´é¾„â€ã€â€œæ€§åˆ«â€ã€â€œç­çº§â€å°±éƒ½å¯ä»¥ç§°ä¸ºéä¸»å±æ€§ã€‚ ä¸»é”®å’Œå¤–é”®æœ‰ä»€ä¹ˆåŒºåˆ« # ä¸»é”®(ä¸»ç ) ï¼šä¸»é”®ç”¨äºå”¯ä¸€æ ‡è¯†ä¸€ä¸ªå…ƒç»„ï¼Œä¸èƒ½æœ‰é‡å¤ï¼Œä¸å…è®¸ä¸ºç©ºã€‚ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ã€‚ å¤–é”®(å¤–ç ) ï¼šå¤–é”®ç”¨æ¥å’Œå…¶ä»–è¡¨å»ºç«‹è”ç³»ç”¨ï¼Œå¤–é”®æ˜¯å¦ä¸€è¡¨çš„ä¸»é”®ï¼Œå¤–é”®æ˜¯å¯ä»¥æœ‰é‡å¤çš„ï¼Œå¯ä»¥æ˜¯ç©ºå€¼ã€‚ä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå¤–é”® ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨å¤–é”®ä¸çº§è” # å¯¹äºå¤–é”®å’Œçº§è”ï¼Œé˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œè¿™æ ·è¯´é“\nã€å¼ºåˆ¶ã€‘ä¸å¾—ä½¿ç”¨å¤–é”®ä¸çº§è”ï¼Œä¸€åˆ‡å¤–é”®æ¦‚å¿µå¿…é¡»åœ¨åº”ç”¨å±‚è§£å†³ã€‚\nè¯´æ˜: ä»¥å­¦ç”Ÿå’Œæˆç»©çš„å…³ç³»ä¸ºä¾‹ï¼Œå­¦ç”Ÿè¡¨ä¸­çš„ student_id æ˜¯ä¸»é”®ï¼Œé‚£ä¹ˆæˆç»©è¡¨ä¸­çš„ student_id åˆ™ä¸ºå¤–é”®ã€‚å¦‚æœæ›´æ–°å­¦ç”Ÿè¡¨ä¸­çš„ student_idï¼ŒåŒæ—¶è§¦å‘æˆç»©è¡¨ä¸­çš„ student_id æ›´æ–°ï¼Œå³ä¸ºçº§è”æ›´æ–°ã€‚\nç¼ºç‚¹ï¼š å¤–é”®ä¸çº§è”æ›´æ–°é€‚ç”¨äºå•æœºä½å¹¶å‘ï¼Œä¸é€‚åˆåˆ†å¸ƒå¼ã€é«˜å¹¶å‘é›†ç¾¤; çº§è”æ›´æ–°æ˜¯å¼ºé˜»å¡ï¼Œå­˜åœ¨æ•°æ®åº“æ›´æ–°é£æš´çš„é£ é™©; å¤–é”®å½±å“æ•°æ®åº“çš„æ’å…¥é€Ÿåº¦\nä¸ºä»€ä¹ˆä¸è¦ä½¿ç”¨å¤–é”®\nå¢åŠ äº†å¤æ‚æ€§\na. æ¯æ¬¡åšDELETE æˆ–è€…UPDATEéƒ½å¿…é¡»è€ƒè™‘å¤–é”®çº¦æŸï¼Œä¼šå¯¼è‡´å¼€å‘çš„æ—¶å€™å¾ˆç—›è‹¦, æµ‹è¯•æ•°æ®æä¸ºä¸æ–¹ä¾¿; b. å¤–é”®çš„ä¸»ä»å…³ç³»æ˜¯å®šçš„ï¼Œå‡å¦‚é‚£å¤©éœ€æ±‚æœ‰å˜åŒ–ï¼Œæ•°æ®åº“ä¸­çš„è¿™ä¸ªå­—æ®µæ ¹æœ¬ä¸éœ€è¦å’Œå…¶ä»–è¡¨æœ‰å…³è”çš„è¯å°±ä¼šå¢åŠ å¾ˆå¤šéº»çƒ¦ã€‚\nå¢åŠ äº†é¢å¤–æ“ä½œ\næ•°æ®åº“éœ€è¦å¢åŠ ç»´æŠ¤å¤–é”®çš„å·¥ä½œï¼Œæ¯”å¦‚å½“æˆ‘ä»¬åšä¸€äº›æ¶‰åŠå¤–é”®å­—æ®µçš„å¢ï¼Œåˆ ï¼Œæ›´æ–°æ“ä½œä¹‹åï¼Œéœ€è¦è§¦å‘ç›¸å…³æ“ä½œå»æ£€æŸ¥ï¼Œä¿è¯æ•°æ®çš„çš„ä¸€è‡´æ€§å’Œæ­£ç¡®æ€§ï¼Œè¿™æ ·ä¼šä¸å¾—ä¸æ¶ˆè€—èµ„æºï¼›ï¼ˆä¸ªäººè§‰å¾—è¿™ä¸ªä¸æ˜¯ä¸ç”¨å¤–é”®çš„åŸå› ï¼Œå› ä¸ºå³ä½¿ä½ ä¸ä½¿ç”¨å¤–é”®ï¼Œä½ åœ¨åº”ç”¨å±‚é¢ä¹Ÿè¿˜æ˜¯è¦ä¿è¯çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªå½±å“å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ï¼‰\nå¯¹åˆ†åº“åˆ†è¡¨å¾ˆä¸å‹å¥½ï¼šå› ä¸ºåˆ†åº“åˆ†è¡¨ä¸‹å¤–é”®æ— æ³•ç”Ÿæ•ˆ\n\u0026hellip;\nå¤–é”®çš„ä¸€äº›å¥½å¤„\nä¿è¯äº†æ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ï¼› çº§è”æ“ä½œæ–¹ä¾¿ï¼Œå‡è½»äº†ç¨‹åºä»£ç é‡ï¼› \u0026hellip;\u0026hellip; å¦‚æœç³»ç»Ÿä¸æ¶‰åŠåˆ†åº“åˆ†è¡¨ï¼Œå¹¶å‘é‡ä¸æ˜¯å¾ˆé«˜çš„æƒ…å†µè¿˜æ˜¯å¯ä»¥è€ƒè™‘ä½¿ç”¨å¤–é”®çš„\nä»€ä¹ˆæ˜¯ERå›¾ # åšä¸€ä¸ªé¡¹ç›®çš„æ—¶å€™ä¸€å®šè¦è¯•ç€ç”» ER å›¾æ¥æ‹æ¸…æ•°æ®åº“è®¾è®¡ï¼Œè¿™ä¸ªä¹Ÿæ˜¯é¢è¯•å®˜é—®ä½ é¡¹ç›®çš„æ—¶å€™ç»å¸¸ä¼šè¢«é—®é“çš„ã€‚\nE-Rå›¾ï¼Œä¹Ÿç§° å®ä½“-è”ç³»å›¾ï¼ˆEntity Relationship Diagramï¼‰ï¼Œæä¾›è¡¨ç¤ºå®ä½“ç±»å‹ã€å±æ€§å’Œå…³ç³»ï¼Œç”¨æ¥æè¿°ç°å®ä¸–ç•Œçš„æ¦‚å¿µæ¨¡å‹ã€‚å®ƒæ˜¯æè¿°ç°å®ä¸–ç•Œå…³ç³»æ¦‚å¿µæ¨¡å‹çš„æœ‰æ•ˆæ–¹æ³•ï¼Œæ˜¯è¡¨ç¤ºæ¦‚å¿µå…³ç³»æ¨¡å‹çš„ä¸€ç§æ–¹å¼ ä¸‹å›¾æ˜¯ä¸€ä¸ªå­¦ç”Ÿé€‰è¯¾çš„ ER å›¾ï¼Œæ¯ä¸ªå­¦ç”Ÿå¯ä»¥é€‰è‹¥å¹²é—¨è¯¾ç¨‹ï¼ŒåŒä¸€é—¨è¯¾ç¨‹ä¹Ÿå¯ä»¥è¢«è‹¥å¹²äººé€‰æ‹©ï¼Œæ‰€ä»¥å®ƒä»¬ä¹‹é—´çš„å…³ç³»æ˜¯å¤šå¯¹å¤šï¼ˆM: Nï¼‰ã€‚å¦å¤–ï¼Œè¿˜æœ‰å…¶ä»–ä¸¤ç§å…³ç³»æ˜¯ï¼š1 å¯¹ 1ï¼ˆ1:1ï¼‰ã€1 å¯¹å¤šï¼ˆ1: Nï¼‰ å°†ERå›¾è½¬æ¢æˆæ•°æ®åº“å®é™…çš„å…³ç³»æ¨¡å‹ï¼ˆå®é™…è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°†ä»»è¯¾æ•™å¸ˆä¹Ÿä½œä¸ºä¸€ä¸ªå®ä½“æ¥å¤„ç†ï¼‰\næ•°æ®åº“èŒƒå¼äº†è§£å— # 1NF(ç¬¬ä¸€èŒƒå¼) å±æ€§ï¼ˆå¯¹åº”äºè¡¨ä¸­çš„å­—æ®µï¼‰ä¸èƒ½å†è¢«åˆ†å‰²ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªå­—æ®µåªèƒ½æ˜¯ä¸€ä¸ªå€¼ï¼Œä¸èƒ½å†åˆ†ä¸ºå¤šä¸ªå…¶ä»–çš„å­—æ®µäº†ã€‚1NF æ˜¯æ‰€æœ‰å…³ç³»å‹æ•°æ®åº“çš„æœ€åŸºæœ¬è¦æ±‚ ï¼Œä¹Ÿå°±æ˜¯è¯´å…³ç³»å‹æ•°æ®åº“ä¸­åˆ›å»ºçš„è¡¨ä¸€å®šæ»¡è¶³ç¬¬ä¸€èŒƒå¼ã€‚\n2NF(ç¬¬äºŒèŒƒå¼) 2NF åœ¨ 1NF çš„åŸºç¡€ä¹‹ä¸Šï¼Œæ¶ˆé™¤äº†éä¸»å±æ€§å¯¹äºç çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå±•ç¤ºäº†ç¬¬ä¸€èŒƒå¼åˆ°ç¬¬äºŒèŒƒå¼çš„è¿‡æ¸¡ã€‚ç¬¬äºŒèŒƒå¼åœ¨ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€ä¸ªåˆ—ï¼Œè¿™ä¸ªåˆ—ç§°ä¸ºä¸»é”®ï¼Œéä¸»å±æ€§éƒ½ä¾èµ–äºä¸»é”®ã€‚\nç¬¬äºŒèŒƒå¼è¦æ±‚ï¼Œåœ¨æ»¡è¶³ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šï¼Œè¿˜è¦æ»¡è¶³æ•°æ®è¡¨é‡Œå¾—æ¯ä¸€æ¡æ•°æ®è®°å½•ï¼Œéƒ½æ˜¯å¯å”¯ä¸€æ ‡è¯†çš„ã€‚è€Œä¸”æ‰€æœ‰éä¸»é”®å­—æ®µï¼Œéƒ½å¿…é¡»å®Œå…¨ä¾èµ–ä¸»é”®ï¼Œä¸èƒ½åªä¾èµ–ä¸»é”®çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚ä¸‹ï¼Œä¸»é”®ä¸ºå•†å“åç§°ã€ä¾›åº”å•†åç§°ï¼Œæ˜¯ä¸»ç æ˜¯å±æ€§ç»„ã€‚è€Œä¾›åº”å•†ç”µè¯åªä¾èµ–äºä¾›åº”å•†idï¼Œå•†å“ä»·æ ¼åªä¾èµ–äºä»·æ ¼ã€‚æ‰€ä»¥ä¸æ»¡è¶³ç¬¬äºŒèŒƒå¼\n3NF(ç¬¬ä¸‰èŒƒå¼)3NF åœ¨ 2NF çš„åŸºç¡€ä¹‹ä¸Šï¼Œæ¶ˆé™¤äº†éä¸»å±æ€§å¯¹äºç çš„ä¼ é€’å‡½æ•°ä¾èµ– ã€‚ç¬¦åˆ 3NF è¦æ±‚çš„æ•°æ®åº“è®¾è®¡ï¼ŒåŸºæœ¬ä¸Šè§£å†³äº†æ•°æ®å†—ä½™è¿‡å¤§ï¼Œæ’å…¥å¼‚å¸¸ï¼Œä¿®æ”¹å¼‚å¸¸ï¼Œåˆ é™¤å¼‚å¸¸çš„é—®é¢˜ã€‚æ¯”å¦‚åœ¨å…³ç³» R(å­¦å· , å§“å, ç³»åï¼Œç³»ä¸»ä»»)ä¸­ï¼Œå­¦å· â†’ ç³»åï¼Œç³»å â†’ ç³»ä¸»ä»»ï¼Œæ‰€ä»¥å­˜åœ¨éä¸»å±æ€§ç³»ä¸»ä»»å¯¹äºå­¦å·çš„ä¼ é€’å‡½æ•°ä¾èµ–ï¼Œæ‰€ä»¥è¯¥è¡¨çš„è®¾è®¡ï¼Œä¸ç¬¦åˆ 3NF çš„è¦æ±‚ã€‚\nç¡®ä¿æ•°æ®è¡¨ä¸­çš„æ¯ä¸€ä¸ªéä¸»é”®å­—æ®µéƒ½å’Œä¸»é”®å­—æ®µç›¸å…³ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¦æ±‚æ•°æ®è¡¨ä¸­çš„æ‰€æœ‰éä¸»é”®å­—æ®µä¸èƒ½ä¾èµ–äºå…¶ä»–éä¸»é”®å­—æ®µã€‚ï¼ˆå³ï¼Œä¸èƒ½å­˜åœ¨éä¸»å±æ€§Aä¾èµ–äºéä¸»å±æ€§Bï¼Œéä¸»å±æ€§Bä¾èµ–äºä¸»é”®Cçš„æƒ…å†µï¼Œå³å­˜åœ¨A \u0026ndash;\u0026gt; B \u0026ndash;\u0026gt; C çš„å†³å®šå…³ç³»ï¼‰ï¼Œè§„åˆ™çš„æ„æ€æ˜¯æ‰€æœ‰éä¸»é”®å±æ€§ä¹‹é—´ä¸èƒ½æœ‰ä¾èµ–å…³ç³»ï¼Œå¿…é¡»äº’ç›¸ç‹¬ç«‹\nç®€å•ä¸¾ä¾‹ï¼š\néƒ¨é—¨ä¿¡æ¯è¡¨ï¼šæ¯ä¸ªéƒ¨é—¨æœ‰éƒ¨é—¨ç¼–å·(dept_id)ã€éƒ¨é—¨åç§°ã€éƒ¨é—¨ç®€ä»‹ç­‰æ¶ˆæ¯\nå‘˜å·¥ä¿¡æ¯è¡¨ï¼šæ¯ä¸ªå‘˜å·¥æœ‰å‘˜å·¥ç¼–å·ã€å§“åã€éƒ¨é—¨ç¼–å·ã€‚ï¼ˆæ³¨æ„ï¼Œåˆ—å‡ºéƒ¨é—¨ç¼–å·å°±ä¸èƒ½å†å°†éƒ¨é—¨åç§°ã€éƒ¨é—¨ç®€ä»‹ç­‰éƒ¨é—¨ç›¸å…³çš„ä¿¡æ¯å†åŠ å…¥å‘˜å·¥ä¿¡æ¯è¡¨ä¸­ï¼Œå¦åˆ™å°†ä¸æ»¡è¶³ç¬¬3èŒƒå¼ï¼ˆä½†å…¶å®æ˜¯æ»¡è¶³ç¬¬äºŒèŒƒå¼çš„ï¼‰ï¼‰\næ€»ç»“\n1NFï¼šå±æ€§ä¸å¯å†åˆ†ã€‚ 2NFï¼š1NF çš„åŸºç¡€ä¹‹ä¸Šï¼Œæ¶ˆé™¤äº†éä¸»å±æ€§å¯¹äºç çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–ã€‚ 3NFï¼š3NF åœ¨ 2NF çš„åŸºç¡€ä¹‹ä¸Šï¼Œæ¶ˆé™¤äº†éä¸»å±æ€§å¯¹äºç çš„ä¼ é€’å‡½æ•°ä¾èµ– ã€‚ ä¸€äº›æ¦‚å¿µï¼š\nå‡½æ•°ä¾èµ–ï¼ˆfunctional dependencyï¼‰ ï¼šè‹¥åœ¨ä¸€å¼ è¡¨ä¸­ï¼Œåœ¨å±æ€§ï¼ˆæˆ–å±æ€§ç»„ï¼‰X çš„å€¼ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œå¿…å®šèƒ½ç¡®å®šå±æ€§ Y çš„å€¼ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¯´ Y å‡½æ•°ä¾èµ–äº Xï¼Œå†™ä½œ X â†’ Yã€‚ éƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼ˆpartial functional dependencyï¼‰ ï¼šå¦‚æœ Xâ†’Yï¼Œå¹¶ä¸”å­˜åœ¨ X çš„ä¸€ä¸ªçœŸå­é›† X0ï¼Œä½¿å¾— X0â†’Yï¼Œåˆ™ç§° Y å¯¹ X éƒ¨åˆ†å‡½æ•°ä¾èµ–ã€‚æ¯”å¦‚å­¦ç”ŸåŸºæœ¬ä¿¡æ¯è¡¨ R ä¸­ï¼ˆå­¦å·ï¼Œèº«ä»½è¯å·ï¼Œå§“åï¼‰å½“ç„¶å­¦å·å±æ€§å–å€¼æ˜¯å”¯ä¸€çš„ï¼Œåœ¨ R å…³ç³»ä¸­ï¼Œï¼ˆå­¦å·ï¼Œèº«ä»½è¯å·ï¼‰-\u0026gt;ï¼ˆå§“åï¼‰ï¼Œï¼ˆå­¦å·ï¼‰-\u0026gt;ï¼ˆå§“åï¼‰ï¼Œï¼ˆèº«ä»½è¯å·ï¼‰-\u0026gt;ï¼ˆå§“åï¼‰ï¼›æ‰€ä»¥å§“åéƒ¨åˆ†å‡½æ•°ä¾èµ–ä¸ï¼ˆå­¦å·ï¼Œèº«ä»½è¯å·ï¼‰ï¼›ï¼ˆæ„Ÿè§‰è¿™ä¸ªä¾‹å­è™½ç„¶æ˜¯å¯¹çš„ï¼Œä½†æ˜¯ä¸åˆ©äºç†è§£ç¬¬äºŒèŒƒå¼ï¼‰ å®Œå…¨å‡½æ•°ä¾èµ–(Full functional dependency) ï¼šåœ¨ä¸€ä¸ªå…³ç³»ä¸­ï¼Œè‹¥æŸä¸ªéä¸»å±æ€§æ•°æ®é¡¹ä¾èµ–äºå…¨éƒ¨å…³é”®å­—ç§°ä¹‹ä¸ºå®Œå…¨å‡½æ•°ä¾èµ–ã€‚æ¯”å¦‚å­¦ç”ŸåŸºæœ¬ä¿¡æ¯è¡¨ Rï¼ˆå­¦å·ï¼Œç­çº§ï¼Œå§“åï¼‰å‡è®¾ä¸åŒçš„ç­çº§å­¦å·æœ‰ç›¸åŒçš„ï¼Œç­çº§å†…å­¦å·ä¸èƒ½ç›¸åŒï¼Œåœ¨ R å…³ç³»ä¸­ï¼Œï¼ˆå­¦å·ï¼Œç­çº§ï¼‰-\u0026gt;ï¼ˆå§“åï¼‰ï¼Œä½†æ˜¯ï¼ˆå­¦å·ï¼‰-\u0026gt;(å§“å)ä¸æˆç«‹ï¼Œï¼ˆç­çº§ï¼‰-\u0026gt;(å§“å)ä¸æˆç«‹ï¼Œæ‰€ä»¥å§“åå®Œå…¨å‡½æ•°ä¾èµ–ä¸ï¼ˆå­¦å·ï¼Œç­çº§ï¼‰ï¼› ä¼ é€’å‡½æ•°ä¾èµ– ï¼š åœ¨å…³ç³»æ¨¡å¼ R(U)ä¸­ï¼Œè®¾ Xï¼ŒYï¼ŒZ æ˜¯ U çš„ä¸åŒçš„å±æ€§å­é›†ï¼Œå¦‚æœ X ç¡®å®š Yã€Y ç¡®å®š Zï¼Œä¸”æœ‰ X ä¸åŒ…å« Yï¼ŒY ä¸ç¡®å®š Xï¼Œï¼ˆXâˆªYï¼‰âˆ©Z=ç©ºé›†åˆï¼Œåˆ™ç§° Z ä¼ é€’å‡½æ•°ä¾èµ–(transitive functional dependency) äº Xã€‚ä¼ é€’å‡½æ•°ä¾èµ–ä¼šå¯¼è‡´æ•°æ®å†—ä½™å’Œå¼‚å¸¸ã€‚ä¼ é€’å‡½æ•°ä¾èµ–çš„ Y å’Œ Z å­é›†å¾€å¾€åŒå±äºæŸä¸€ä¸ªäº‹ç‰©ï¼Œå› æ­¤å¯å°†å…¶åˆå¹¶æ”¾åˆ°ä¸€ä¸ªè¡¨ä¸­ã€‚æ¯”å¦‚åœ¨å…³ç³» R(å­¦å· , å§“å, ç³»åï¼Œç³»ä¸»ä»»)ä¸­ï¼Œå­¦å· â†’ ç³»åï¼Œç³»å â†’ ç³»ä¸»ä»»ï¼Œæ‰€ä»¥å­˜åœ¨éä¸»å±æ€§ç³»ä¸»ä»»å¯¹äºå­¦å·çš„ä¼ é€’å‡½æ•°ä¾èµ–ã€‚ã€‚ ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ # ä½œç”¨ï¼šæˆ‘ä»¬å¯ä»¥æŠŠå­˜å‚¨è¿‡ç¨‹çœ‹æˆæ˜¯ä¸€äº› SQL è¯­å¥çš„é›†åˆï¼Œä¸­é—´åŠ äº†ç‚¹é€»è¾‘æ§åˆ¶è¯­å¥ã€‚å­˜å‚¨è¿‡ç¨‹åœ¨ä¸šåŠ¡æ¯”è¾ƒå¤æ‚çš„æ—¶å€™æ˜¯éå¸¸å®ç”¨çš„ï¼Œæ¯”å¦‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å®Œæˆä¸€ä¸ªæ“ä½œå¯èƒ½éœ€è¦å†™ä¸€å¤§ä¸² SQL è¯­å¥ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥å†™æœ‰ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹ï¼Œè¿™æ ·ä¹Ÿæ–¹ä¾¿äº†æˆ‘ä»¬ä¸‹ä¸€æ¬¡çš„è°ƒç”¨ã€‚å­˜å‚¨è¿‡ç¨‹ä¸€æ—¦è°ƒè¯•å®Œæˆé€šè¿‡åå°±èƒ½ç¨³å®šè¿è¡Œï¼Œå¦å¤–ï¼Œä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æ¯”å•çº¯ SQL è¯­å¥æ‰§è¡Œè¦å¿«ï¼Œå› ä¸ºå­˜å‚¨è¿‡ç¨‹æ˜¯é¢„ç¼–è¯‘è¿‡çš„ã€‚\nå­˜å‚¨è¿‡ç¨‹åœ¨äº’è”ç½‘å…¬å¸åº”ç”¨ä¸å¤šï¼Œå› ä¸ºå­˜å‚¨è¿‡ç¨‹éš¾ä»¥è°ƒè¯•å’Œæ‰©å±•ï¼Œè€Œä¸”æ²¡æœ‰ç§»æ¤æ€§ï¼Œè¿˜ä¼šæ¶ˆè€—æ•°æ®åº“èµ„æº\né˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œè¦æ±‚ç¦æ­¢ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ dropã€deleteä¸truncateåŒºåˆ« # ç”¨æ³•ä¸åŒ # drop(ä¸¢å¼ƒæ•°æ®): drop table è¡¨å ï¼Œç›´æ¥å°†è¡¨éƒ½åˆ é™¤æ‰ï¼Œåœ¨åˆ é™¤è¡¨çš„æ—¶å€™ä½¿ç”¨ã€‚ truncate (æ¸…ç©ºæ•°æ®) : truncate table è¡¨å ï¼Œåªåˆ é™¤è¡¨ä¸­çš„æ•°æ®ï¼Œå†æ’å…¥æ•°æ®çš„æ—¶å€™è‡ªå¢é•¿ id åˆä» 1 å¼€å§‹ï¼Œåœ¨æ¸…ç©ºè¡¨ä¸­æ•°æ®çš„æ—¶å€™ä½¿ç”¨ã€‚ deleteï¼ˆåˆ é™¤æ•°æ®ï¼‰ : delete from è¡¨å where åˆ—å=å€¼ï¼Œåˆ é™¤æŸä¸€è¡Œçš„æ•°æ®ï¼Œå¦‚æœä¸åŠ  where å­å¥å’Œtruncate table è¡¨åä½œç”¨ç±»ä¼¼ã€‚ truncate å’Œä¸å¸¦ where å­å¥çš„ deleteã€ä»¥åŠ drop éƒ½ä¼šåˆ é™¤è¡¨å†…çš„æ•°æ®ï¼Œä½†æ˜¯ truncate å’Œ delete åªåˆ é™¤æ•°æ®ä¸åˆ é™¤è¡¨çš„ç»“æ„(å®šä¹‰)ï¼Œæ‰§è¡Œ drop è¯­å¥ï¼Œæ­¤è¡¨çš„ç»“æ„ä¹Ÿä¼šåˆ é™¤ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œ drop ä¹‹åå¯¹åº”çš„è¡¨ä¸å¤å­˜åœ¨ã€‚\nå±äºä¸åŒçš„æ•°æ®åº“è¯­è¨€ # truncate å’Œ drop å±äº DDL(æ•°æ®å®šä¹‰è¯­è¨€)è¯­å¥ï¼Œæ“ä½œç«‹å³ç”Ÿæ•ˆï¼ŒåŸæ•°æ®ä¸æ”¾åˆ° rollback segment ä¸­ï¼Œä¸èƒ½å›æ»šï¼Œæ“ä½œä¸è§¦å‘ triggerã€‚è€Œ **delete è¯­å¥æ˜¯ DML (æ•°æ®åº“æ“ä½œè¯­è¨€)**è¯­å¥ï¼Œè¿™ä¸ªæ“ä½œä¼šæ”¾åˆ° rollback segement ä¸­ï¼Œäº‹åŠ¡æäº¤ä¹‹åæ‰ç”Ÿæ•ˆã€‚ DMLè¯­å¥å’ŒDDLè¯­å¥åŒºåˆ« DML æ˜¯**æ•°æ®åº“æ“ä½œè¯­è¨€ï¼ˆData Manipulation Languageï¼‰**çš„ç¼©å†™ï¼Œæ˜¯æŒ‡å¯¹æ•°æ®åº“ä¸­è¡¨è®°å½•çš„æ“ä½œï¼Œä¸»è¦åŒ…æ‹¬è¡¨è®°å½•çš„æ’å…¥ï¼ˆinsertï¼‰ã€æ›´æ–°ï¼ˆupdateï¼‰ã€åˆ é™¤ï¼ˆdeleteï¼‰å’ŒæŸ¥è¯¢ï¼ˆselectï¼‰ï¼Œæ˜¯å¼€å‘äººå‘˜æ—¥å¸¸ä½¿ç”¨æœ€é¢‘ç¹çš„æ“ä½œã€‚ **DDL ï¼ˆData Definition Languageï¼‰**æ˜¯æ•°æ®å®šä¹‰è¯­è¨€çš„ç¼©å†™ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¯¹æ•°æ®åº“å†…éƒ¨çš„å¯¹è±¡è¿›è¡Œåˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹çš„æ“ä½œè¯­è¨€ã€‚å®ƒå’Œ DML è¯­è¨€çš„æœ€å¤§åŒºåˆ«æ˜¯ DML åªæ˜¯å¯¹è¡¨å†…éƒ¨æ•°æ®çš„æ“ä½œï¼Œè€Œä¸æ¶‰åŠåˆ°è¡¨çš„å®šä¹‰ã€ç»“æ„çš„ä¿®æ”¹ï¼Œæ›´ä¸ä¼šæ¶‰åŠåˆ°å…¶ä»–å¯¹è±¡ã€‚DDL è¯­å¥æ›´å¤šçš„è¢«æ•°æ®åº“ç®¡ç†å‘˜ï¼ˆDBAï¼‰æ‰€ä½¿ç”¨ï¼Œä¸€èˆ¬çš„å¼€å‘äººå‘˜å¾ˆå°‘ä½¿ç”¨ã€‚ ç”±äºselectä¸ä¼šå¯¹è¡¨è¿›è¡Œç ´åï¼Œæ‰€ä»¥æœ‰çš„åœ°æ–¹ä¹Ÿä¼šæŠŠselectå•ç‹¬åŒºåˆ†å¼€å«åšæ•°æ®åº“æŸ¥è¯¢è¯­è¨€DQLï¼ˆData Query Languageï¼‰ æ‰§è¡Œé€Ÿåº¦ä¸åŒ # ä¸€èˆ¬æ¥è¯´ï¼šdrop \u0026gt; truncate \u0026gt; deleteï¼ˆè¿™ä¸ªæˆ‘æ²¡æœ‰è®¾è®¡æµ‹è¯•è¿‡ï¼‰\ndeleteå‘½ä»¤æ‰§è¡Œçš„æ—¶å€™ä¼šäº§ç”Ÿæ•°æ®åº“çš„binlogæ—¥å¿—ï¼Œè€Œæ—¥å¿—è®°å½•æ˜¯éœ€è¦æ¶ˆè€—æ—¶é—´çš„ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸ªå¥½å¤„æ–¹ä¾¿æ•°æ®å›æ»šæ¢å¤ã€‚\ntruncateå‘½ä»¤æ‰§è¡Œçš„æ—¶å€™ä¸ä¼šäº§ç”Ÿæ•°æ®åº“æ—¥å¿—ï¼Œå› æ­¤æ¯”deleteè¦å¿«ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜ä¼šæŠŠè¡¨çš„è‡ªå¢å€¼é‡ç½®å’Œç´¢å¼•æ¢å¤åˆ°åˆå§‹å¤§å°ç­‰ã€‚\ndropå‘½ä»¤ä¼šæŠŠè¡¨å ç”¨çš„ç©ºé—´å…¨éƒ¨é‡Šæ”¾æ‰ã€‚\nTipsï¼šä½ åº”è¯¥æ›´å¤šåœ°å…³æ³¨åœ¨ä½¿ç”¨åœºæ™¯ä¸Šï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ•ˆç‡ã€‚\næ•°æ®åº“è®¾è®¡é€šå¸¸åˆ†ä¸ºå“ªå‡ æ­¥ # éœ€æ±‚åˆ†æ : åˆ†æç”¨æˆ·çš„éœ€æ±‚ï¼ŒåŒ…æ‹¬æ•°æ®ã€åŠŸèƒ½å’Œæ€§èƒ½éœ€æ±‚ã€‚ æ¦‚å¿µç»“æ„è®¾è®¡ : ä¸»è¦é‡‡ç”¨ E-R æ¨¡å‹è¿›è¡Œè®¾è®¡ï¼ŒåŒ…æ‹¬ç”» E-R å›¾ã€‚ é€»è¾‘ç»“æ„è®¾è®¡ : é€šè¿‡å°† E-R å›¾è½¬æ¢æˆè¡¨ï¼Œå®ç°ä» E-R æ¨¡å‹åˆ°å…³ç³»æ¨¡å‹çš„è½¬æ¢ã€‚ ç‰©ç†ç»“æ„è®¾è®¡ : ä¸»è¦æ˜¯ä¸ºæ‰€è®¾è®¡çš„æ•°æ®åº“é€‰æ‹©åˆé€‚çš„å­˜å‚¨ç»“æ„å’Œå­˜å–è·¯å¾„ã€‚ æ•°æ®åº“å®æ–½ : åŒ…æ‹¬ç¼–ç¨‹ã€æµ‹è¯•å’Œè¯•è¿è¡Œ æ•°æ®åº“çš„è¿è¡Œå’Œç»´æŠ¤ : ç³»ç»Ÿçš„è¿è¡Œä¸æ•°æ®åº“çš„æ—¥å¸¸ç»´æŠ¤ã€‚ "},{"id":119,"href":"/zh/docs/study/Review/java_guide/java/JVM/ly0408lyjdk-monitoring-and-troubleshooting-tools/","title":"jvmç›‘æ§å’Œæ•…éšœå¤„ç†å·¥å…· æ€»ç»“","section":"JavaåŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nJDK å‘½ä»¤è¡Œå·¥å…· # è¿™äº›å‘½ä»¤åœ¨ JDK å®‰è£…ç›®å½•ä¸‹çš„ bin ç›®å½•ä¸‹ï¼š\njps (JVM Process Statusï¼‰: ç±»ä¼¼ UNIX çš„ ps å‘½ä»¤ã€‚ç”¨äºæŸ¥çœ‹æ‰€æœ‰ Java è¿›ç¨‹çš„å¯åŠ¨ç±»ã€ä¼ å…¥å‚æ•°å’Œ Java è™šæ‹Ÿæœºå‚æ•°ç­‰ä¿¡æ¯ï¼› jstatï¼ˆJVM Statistics Monitoring Toolï¼‰: ç”¨äºæ”¶é›† HotSpot è™šæ‹Ÿæœºå„æ–¹é¢çš„è¿è¡Œæ•°æ®; jinfo (Configuration Info for Java) : Configuration Info for Java,æ˜¾ç¤ºè™šæ‹Ÿæœºé…ç½®ä¿¡æ¯; jmap (Memory Map for Java) : ç”Ÿæˆå †è½¬å‚¨å¿«ç…§; jhat (JVM Heap Dump Browser) : ç”¨äºåˆ†æ heapdump æ–‡ä»¶ï¼Œå®ƒä¼šå»ºç«‹ä¸€ä¸ª HTTP/HTML æœåŠ¡å™¨ï¼Œè®©ç”¨æˆ·å¯ä»¥åœ¨æµè§ˆå™¨ä¸ŠæŸ¥çœ‹åˆ†æç»“æœ; jstack (Stack Trace for Java) : ç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ï¼Œçº¿ç¨‹å¿«ç…§å°±æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆã€‚ jps: æŸ¥çœ‹æ‰€æœ‰ Java è¿›ç¨‹ # jps(JVM Process Status) å‘½ä»¤ç±»ä¼¼ UNIX çš„ ps å‘½ä»¤ã€‚\njpsï¼šæ˜¾ç¤ºè™šæ‹Ÿæœºæ‰§è¡Œä¸»ç±»åç§°ä»¥åŠè¿™äº›è¿›ç¨‹çš„æœ¬åœ°è™šæ‹Ÿæœºå”¯ä¸€ IDï¼ˆLocal Virtual Machine Identifier,LVMIDï¼‰ã€‚jps -q ï¼šåªè¾“å‡ºè¿›ç¨‹çš„æœ¬åœ°è™šæ‹Ÿæœºå”¯ä¸€ IDã€‚\nC:\\Users\\SnailClimb\u0026gt;jps 7360 NettyClient2 17396 7972 Launcher 16504 Jps 17340 NettyServer jps -l:è¾“å‡ºä¸»ç±»çš„å…¨åï¼Œå¦‚æœè¿›ç¨‹æ‰§è¡Œçš„æ˜¯ Jar åŒ…ï¼Œè¾“å‡º Jar è·¯å¾„ã€‚\nC:\\Users\\SnailClimb\u0026gt;jps -l 7360 firstNettyDemo.NettyClient2 17396 7972 org.jetbrains.jps.cmdline.Launcher 16492 sun.tools.jps.Jps 17340 firstNettyDemo.NettyServer jps -vï¼šè¾“å‡ºè™šæ‹Ÿæœºè¿›ç¨‹å¯åŠ¨æ—¶ JVM å‚æ•°ã€‚\njps -mï¼šè¾“å‡ºä¼ é€’ç»™ Java è¿›ç¨‹ main() å‡½æ•°çš„å‚æ•°ã€‚\njstatï¼šç›‘è§†è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯ # jstat ( JVM Statistics Monitoring Tool ) ä½¿ç”¨äºç›‘è§†è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤è¡Œå·¥å…·ã€‚\nå¯ä»¥æ˜¾ç¤ºæœ¬åœ°æˆ–è€…è¿œç¨‹ï¼ˆéœ€è¦è¿œç¨‹ä¸»æœºæä¾›RMIæ”¯æŒï¼‰è™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»ä¿¡æ¯ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JITç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ï¼Œåœ¨æ²¡æœ‰GUIï¼Œåªæä¾›äº†çº¯æ–‡æœ¬æ§åˆ¶å°ç¯å¢ƒçš„æœåŠ¡å™¨ä¸Šï¼Œå®ƒå°†æ˜¯è¿è¡ŒæœŸé—´å®šä½è™šæ‹Ÿæœºæ€§èƒ½é—®é¢˜çš„é¦–é€‰å·¥å…·\njstat å‘½ä»¤ä½¿ç”¨æ ¼å¼\njstat -\u0026lt;option\u0026gt; [-t] [-h\u0026lt;lines\u0026gt;] \u0026lt;vmid\u0026gt; [\u0026lt;interval\u0026gt; [\u0026lt;count\u0026gt;]] æ¯”å¦‚ jstat -gc -h3 31736 1000 10è¡¨ç¤ºåˆ†æè¿›ç¨‹ id ä¸º 31736 çš„ gc æƒ…å†µï¼Œæ¯éš” 1000ms æ‰“å°ä¸€æ¬¡è®°å½•ï¼Œæ‰“å° 10 æ¬¡åœæ­¢ï¼Œæ¯ 3 è¡Œåæ‰“å°æŒ‡æ ‡å¤´éƒ¨ã€‚\nÎ» jstat -gc -h3 12224 1000 10 å¸¸è§çš„optionå¦‚ä¸‹ , ä¸‹é¢çš„vmidï¼Œå³vmçš„id ï¼ˆidå€¼ï¼‰\njstat -class vmid ï¼šæ˜¾ç¤º ClassLoader çš„ç›¸å…³ä¿¡æ¯ï¼› jstat -compiler vmid ï¼šæ˜¾ç¤º JIT ç¼–è¯‘çš„ç›¸å…³ä¿¡æ¯ï¼› jstat -gc vmid ï¼šæ˜¾ç¤ºä¸ GC ç›¸å…³çš„å †ä¿¡æ¯ï¼› jstat -gccapacity vmid ï¼šæ˜¾ç¤ºå„ä¸ªä»£çš„å®¹é‡åŠä½¿ç”¨æƒ…å†µï¼› jstat -gcnew vmid ï¼šæ˜¾ç¤ºæ–°ç”Ÿä»£ä¿¡æ¯ï¼› jstat -gcnewcapcacity vmid ï¼šæ˜¾ç¤ºæ–°ç”Ÿä»£å¤§å°ä¸ä½¿ç”¨æƒ…å†µï¼› jstat -gcold vmid ï¼šæ˜¾ç¤ºè€å¹´ä»£å’Œæ°¸ä¹…ä»£çš„è¡Œä¸ºç»Ÿè®¡ï¼Œä»jdk1.8å¼€å§‹,è¯¥é€‰é¡¹ä»…è¡¨ç¤ºè€å¹´ä»£ï¼Œå› ä¸ºæ°¸ä¹…ä»£è¢«ç§»é™¤äº†ï¼› jstat -gcoldcapacity vmid ï¼šæ˜¾ç¤ºè€å¹´ä»£çš„å¤§å°ï¼› jstat -gcpermcapacity vmid ï¼šæ˜¾ç¤ºæ°¸ä¹…ä»£å¤§å°ï¼Œä»jdk1.8å¼€å§‹,è¯¥é€‰é¡¹ä¸å­˜åœ¨äº†ï¼Œå› ä¸ºæ°¸ä¹…ä»£è¢«ç§»é™¤äº†ï¼› jstat -gcutil vmid ï¼šæ˜¾ç¤ºåƒåœ¾æ”¶é›†ä¿¡æ¯ ä½¿ç”¨jstat -gcutil -h3 12224 1000 10\nå¦å¤–ï¼ŒåŠ ä¸Š -tå‚æ•°å¯ä»¥åœ¨è¾“å‡ºä¿¡æ¯ä¸ŠåŠ ä¸€ä¸ª Timestamp åˆ—ï¼Œæ˜¾ç¤ºç¨‹åºçš„è¿è¡Œæ—¶é—´ã€‚ å„ä¸ªå‚æ•°çš„å«ä¹‰\njinfoï¼šå®æ—¶åœ°æŸ¥çœ‹å’Œè°ƒæ•´è™šæ‹Ÿæœºå„é¡¹å‚æ•° # jinfo vmid :è¾“å‡ºå½“å‰ jvm è¿›ç¨‹çš„å…¨éƒ¨å‚æ•°å’Œç³»ç»Ÿå±æ€§ (ç¬¬ä¸€éƒ¨åˆ†æ˜¯ç³»ç»Ÿçš„å±æ€§ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯ JVM çš„å‚æ•°)ã€‚ å¦‚ä¸‹å›¾ï¼š jinfo -flag name vmid :è¾“å‡ºå¯¹åº”åç§°çš„å‚æ•°çš„å…·ä½“å€¼ã€‚æ¯”å¦‚è¾“å‡º MaxHeapSizeã€æŸ¥çœ‹å½“å‰ jvm è¿›ç¨‹æ˜¯å¦å¼€å¯æ‰“å° GC æ—¥å¿— ( -XX:PrintGCDetails :è¯¦ç»† GC æ—¥å¿—æ¨¡å¼ï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯é»˜è®¤å…³é—­çš„)ã€‚\nC:\\Users\\SnailClimb\u0026gt;jinfo -flag MaxHeapSize 17340 -XX:MaxHeapSize=2124414976 C:\\Users\\SnailClimb\u0026gt;jinfo -flag PrintGC 17340 -XX:-PrintGC ä½¿ç”¨ jinfo å¯ä»¥åœ¨ä¸é‡å¯è™šæ‹Ÿæœºçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åŠ¨æ€çš„ä¿®æ”¹ jvm çš„å‚æ•°ã€‚å°¤å…¶åœ¨çº¿ä¸Šçš„ç¯å¢ƒç‰¹åˆ«æœ‰ç”¨,è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š ä½¿ç”¨```jinfo -flag [+|-]name vmid å¼€å¯æˆ–è€…å…³é—­å¯¹åº”åç§°çš„å‚æ•°ï¼š\nC:\\Users\\SnailClimb\u0026gt;jinfo -flag PrintGC 17340 -XX:-PrintGC C:\\Users\\SnailClimb\u0026gt;jinfo -flag +PrintGC 17340 C:\\Users\\SnailClimb\u0026gt;jinfo -flag PrintGC 17340 -XX:+PrintGC jmapï¼šç”Ÿæˆå †è½¬å‚¨å¿«ç…§ # jmap(Memory Map for Java )å‘½ä»¤ç”¨äºç”Ÿæˆå †è½¬å‚¨å¿«ç…§ã€‚å¦‚æœä¸ä½¿ç”¨jmapå‘½ä»¤ï¼Œè¦æƒ³è·å–javaå †è½¬å‚¨ï¼Œå¯ä»¥ä½¿ç”¨-XX:+HeapDumpOutOfMemoryErrorå‚æ•°ï¼Œå¯ä»¥è®©è™šæ‹Ÿæœºåœ¨OOMå¼‚å¸¸å‡ºç°ä¹‹åï¼Œè‡ªåŠ¨ç”Ÿæˆdumpæ–‡ä»¶ï¼ŒLinuxå‘½ä»¤ä¸‹é€šè¿‡kill -3å‘é€è¿›ç¨‹æ¨å‡ºä¿¡å·ä¹Ÿèƒ½æ‹¿åˆ°dumpæ–‡ä»¶\njmap çš„ä½œç”¨å¹¶ä¸ä»…ä»…æ˜¯ä¸ºäº†è·å– dump æ–‡ä»¶ï¼Œå®ƒè¿˜å¯ä»¥æŸ¥è¯¢ finalizer æ‰§è¡Œé˜Ÿåˆ—ã€Java å †å’Œæ°¸ä¹…ä»£çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ç©ºé—´ä½¿ç”¨ç‡ã€å½“å‰ä½¿ç”¨çš„æ˜¯å“ªç§æ”¶é›†å™¨ç­‰ã€‚å’Œjinfoä¸€æ ·ï¼Œjmapæœ‰ä¸å°‘åŠŸèƒ½åœ¨ Windows å¹³å°ä¸‹ä¹Ÿæ˜¯å—é™åˆ¶çš„ã€‚\nå°†æŒ‡å®šåº”ç”¨ç¨‹åºçš„å † å¿«ç…§è¾“å‡ºåˆ°æ¡Œé¢ï¼Œåé¢å¯ä»¥é€šè¿‡jhatã€Visual VMç­‰å·¥å…·åˆ†æè¯¥å †æ–‡ä»¶\nC:\\Users\\SnailClimb\u0026gt;jmap -dump:format=b,file=C:\\Users\\SnailClimb\\Desktop\\heap.hprof 17340 Dumping heap to C:\\Users\\SnailClimb\\Desktop\\heap.hprof ... Heap dump file created jhatï¼šåˆ†æheapdumpæ–‡ä»¶ # jhat ç”¨äºåˆ†æ heapdump æ–‡ä»¶ï¼Œå®ƒä¼šå»ºç«‹ä¸€ä¸ª HTTP/HTML æœåŠ¡å™¨ï¼Œè®©ç”¨æˆ·å¯ä»¥åœ¨æµè§ˆå™¨ä¸ŠæŸ¥çœ‹åˆ†æç»“æœã€‚\nC:\\Users\\SnailClimb\u0026gt;jhat C:\\Users\\SnailClimb\\Desktop\\heap.hprof Reading from C:\\Users\\SnailClimb\\Desktop\\heap.hprof... Dump file created Sat May 04 12:30:31 CST 2019 Snapshot read, resolving... Resolving 131419 objects... Chasing references, expect 26 dots.......................... Eliminating duplicate references.......................... Snapshot resolved. Started HTTP server on port 7000 Server is ready. ä¹‹åè®¿é—® http://localhost:7000/ å³å¯ï¼Œå¦‚ä¸‹ï¼š è¿›å…¥/histo ä¼šå‘ç°ï¼Œæœ‰è¿™ä¸ªä¸œè¥¿ è¿™ä¸ªå¯¹è±¡åˆ›å»ºäº†9æ¬¡ï¼Œå› ä¸ºæˆ‘æ˜¯åœ¨ç¬¬9æ¬¡å¾ªç¯ådumpå †å¿«ç…§çš„\n//æµ‹è¯•ä»£ç å¦‚ä¸‹ public class MyMain { private byte[] x = new byte[10 * 1024 * 1024];//10M public static void main(String[] args) throws InterruptedException { System.out.println(\u0026#34;å¼€å§‹å¾ªç¯--\u0026#34;); int i=0; while (++i\u0026gt;0) { String a=new Date().toString(); MyMain myMain = new MyMain(); System.out.println(i+\u0026#34;å¾ªç¯ä¸­---\u0026#34; + new Date()); TimeUnit.SECONDS.sleep(10); } } } jstackï¼š ç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ # jstack (Stack Trace for Java ) å‘½ä»¤ç”¨äºç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ã€‚çº¿ç¨‹å¿«ç…§å°±æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆ\nç”Ÿæˆçº¿ç¨‹å¿«ç…§çš„ç›®çš„ä¸»è¦æ˜¯å®šä½çº¿ç¨‹é•¿æ—¶é—´å‡ºç°åœé¡¿çš„åŸå› ï¼Œå¦‚çº¿ç¨‹é—´æ­»é”ã€æ­»å¾ªç¯ã€è¯·æ±‚å¤–éƒ¨èµ„æºå¯¼è‡´çš„é•¿æ—¶é—´ç­‰å¾…ç­‰éƒ½æ˜¯å¯¼è‡´çº¿ç¨‹é•¿æ—¶é—´åœé¡¿çš„åŸå› ã€‚çº¿ç¨‹å‡ºç°åœé¡¿çš„æ—¶å€™é€šè¿‡jstackæ¥æŸ¥çœ‹å„ä¸ªçº¿ç¨‹çš„è°ƒç”¨å †æ ˆï¼Œå°±å¯ä»¥çŸ¥é“æ²¡æœ‰å“åº”çš„çº¿ç¨‹åˆ°åº•åœ¨åå°åšäº›ä»€ä¹ˆäº‹æƒ…ï¼Œæˆ–è€…åœ¨ç­‰å¾…äº›ä»€ä¹ˆèµ„æºã€‚\nçº¿ç¨‹æ­»é”çš„ä»£ç ï¼Œé€šè¿‡jstack å‘½ä»¤è¿›è¡Œæ­»é”æ£€æŸ¥ï¼Œè¾“å‡ºæ­»é”ä¿¡æ¯ï¼Œæ‰¾åˆ°å‘ç”Ÿæ­»é”çš„çº¿ç¨‹\npackage com.jvm; public class DeadLockDemo { private static Object resource1 = new Object();//èµ„æº 1 private static Object resource2 = new Object();//èµ„æº 2 public static void main(String[] args) { new Thread(() -\u0026gt; { synchronized (resource1) { System.out.println(Thread.currentThread() + \u0026#34;get resource1\u0026#34;); try { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread() + \u0026#34;waiting get resource2\u0026#34;); synchronized (resource2) { System.out.println(Thread.currentThread() + \u0026#34;get resource2\u0026#34;); } } }, \u0026#34;çº¿ç¨‹ 1\u0026#34;).start(); new Thread(() -\u0026gt; { synchronized (resource2) { System.out.println(Thread.currentThread() + \u0026#34;get resource2\u0026#34;); try { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread() + \u0026#34;waiting get resource1\u0026#34;); synchronized (resource1) { System.out.println(Thread.currentThread() + \u0026#34;get resource1\u0026#34;); } } }, \u0026#34;çº¿ç¨‹ 2\u0026#34;).start(); } } /*------ Thread[çº¿ç¨‹ 1,5,main]get resource1 Thread[çº¿ç¨‹ 2,5,main]get resource2 Thread[çº¿ç¨‹ 2,5,main]waiting get resource1 Thread[çº¿ç¨‹ 1,5,main]waiting get resource2 */ åˆ†æ çº¿ç¨‹ A é€šè¿‡ synchronized (resource1) è·å¾— resource1 çš„ç›‘è§†å™¨é”ï¼Œç„¶åé€šè¿‡ Thread.sleep(1000);è®©çº¿ç¨‹ A ä¼‘çœ  1s ä¸ºçš„æ˜¯è®©çº¿ç¨‹ B å¾—åˆ°æ‰§è¡Œç„¶åè·å–åˆ° resource2 çš„ç›‘è§†å™¨é”ã€‚çº¿ç¨‹ A å’Œçº¿ç¨‹ B ä¼‘çœ ç»“æŸäº†éƒ½å¼€å§‹ä¼å›¾è¯·æ±‚è·å–å¯¹æ–¹çš„èµ„æºï¼Œç„¶åè¿™ä¸¤ä¸ªçº¿ç¨‹å°±ä¼šé™·å…¥äº’ç›¸ç­‰å¾…çš„çŠ¶æ€ï¼Œè¿™ä¹Ÿå°±äº§ç”Ÿäº†æ­»é”ã€‚\né€šè¿‡jstack å‘½ä»¤åˆ†æ\n# å…ˆä½¿ç”¨jps æ‰¾åˆ°æ€ç´¢åœ°é‚£ä¸ªç±» C:\\Users\\SnailClimb\u0026gt;jps 13792 KotlinCompileDaemon 7360 NettyClient2 17396 7972 Launcher 8932 Launcher 9256 DeadLockDemo 10764 Jps 17340 NettyServer ## ç„¶åä½¿ç”¨jstackå‘½ä»¤åˆ†æ C:\\Users\\SnailClimb\u0026gt;jstack 9256 è¾“å‡ºçš„éƒ¨åˆ†å¦‚ä¸‹\nFound one Java-level deadlock: ============================= \u0026#34;çº¿ç¨‹ 2\u0026#34;: waiting to lock monitor 0x000000000333e668 (object 0x00000000d5efe1c0, a java.lang.Object), which is held by \u0026#34;çº¿ç¨‹ 1\u0026#34; \u0026#34;çº¿ç¨‹ 1\u0026#34;: waiting to lock monitor 0x000000000333be88 (object 0x00000000d5efe1d0, a java.lang.Object), which is held by \u0026#34;çº¿ç¨‹ 2\u0026#34; Java stack information for the threads listed above: =================================================== \u0026#34;çº¿ç¨‹ 2\u0026#34;: at DeadLockDemo.lambda$main$1(DeadLockDemo.java:31) - waiting to lock \u0026lt;0x00000000d5efe1c0\u0026gt; (a java.lang.Object) - locked \u0026lt;0x00000000d5efe1d0\u0026gt; (a java.lang.Object) at DeadLockDemo$$Lambda$2/1078694789.run(Unknown Source) at java.lang.Thread.run(Thread.java:748) \u0026#34;çº¿ç¨‹ 1\u0026#34;: at DeadLockDemo.lambda$main$0(DeadLockDemo.java:16) - waiting to lock \u0026lt;0x00000000d5efe1d0\u0026gt; (a java.lang.Object) - locked \u0026lt;0x00000000d5efe1c0\u0026gt; (a java.lang.Object) at DeadLockDemo$$Lambda$1/1324119927.run(Unknown Source) at java.lang.Thread.run(Thread.java:748) Found 1 deadlock. æ‰¾åˆ°äº†å‘ç”Ÿæ­»é”çš„çº¿ç¨‹çš„å…·ä½“ä¿¡æ¯\nJDKå¯è§†åŒ–åˆ†æå·¥å…· # JConsoleï¼šJavaç›‘è§†ä¸ç®¡ç†æ§åˆ¶å° # JConsole æ˜¯åŸºäº JMX çš„å¯è§†åŒ–ç›‘è§†ã€ç®¡ç†å·¥å…·ã€‚å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç›‘è§†æœ¬åœ°åŠè¿œç¨‹æœåŠ¡å™¨çš„ java è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚ä½ å¯ä»¥åœ¨æ§åˆ¶å°è¾“å‡º**consoleå‘½ä»¤å¯åŠ¨æˆ–è€…åœ¨ JDK ç›®å½•ä¸‹çš„ bin ç›®å½•æ‰¾åˆ°jconsole.exeç„¶ååŒå‡»å¯åŠ¨**. å¯¹äºè¿œç¨‹è¿æ¥\nåœ¨å¯åŠ¨æ–¹\n-Djava.rmi.server.hostname=å¤–ç½‘è®¿é—® ip åœ°å€ -Dcom.sun.management.jmxremote.port=60001 //ç›‘æ§çš„ç«¯å£å· -Dcom.sun.management.jmxremote.authenticate=false //å…³é—­è®¤è¯ -Dcom.sun.management.jmxremote.ssl=false å®ä¾‹ï¼š\njava -Djava.rmi.server.hostname=192.168.200.200 -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=60001 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false com.jvm.DeadLockDemo # å…¶ä¸­ 192.168.200.200 ä¸ºå¯åŠ¨è¯¥ç±»çš„æœºå™¨çš„ipï¼Œè€Œä¸æ˜¯è°è¦è¿æ¥ åœ¨ä½¿ç”¨ JConsole è¿æ¥æ—¶ï¼Œè¿œç¨‹è¿›ç¨‹åœ°å€å¦‚ä¸‹ï¼š\nå¤–ç½‘è®¿é—® ip åœ°å€:60001 æ³¨æ„ï¼Œè™šæ‹Ÿæœºä¸­ï¼ˆè¿™é‡Œip xxx.200æ˜¯è™šæ‹Ÿæœºipï¼‰ï¼Œéœ€è¦å¼€æ”¾çš„ç«¯å£ä¸åªæ˜¯60001ï¼Œè¿˜è¦é€šè¿‡ netstat -nltpå¼€æ”¾å¦å¤–ä¸¤ä¸ªç«¯å£ centosä¸­ä½¿ç”¨\nfirewall-cmd --zone=public --add-port=45443/tcp --permanent firewall-cmd --zone=public --add-port=36521/tcp --permanent firewall-cmd --zone=public --add-port=60001/tcp --permanent firewall-cmd --reload #é‡å¯firewall ä¹‹åæ‰èƒ½è¿æ¥ä¸Š\nå†…å­˜ç›‘æ§ # JConsole å¯ä»¥æ˜¾ç¤ºå½“å‰å†…å­˜çš„è¯¦ç»†ä¿¡æ¯ã€‚ä¸ä»…åŒ…æ‹¬å †å†…å­˜/éå †å†…å­˜çš„æ•´ä½“ä¿¡æ¯ï¼Œè¿˜å¯ä»¥ç»†åŒ–åˆ° eden åŒºã€survivor åŒºç­‰çš„ä½¿ç”¨æƒ…å†µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\nç‚¹å‡»å³è¾¹çš„â€œæ‰§è¡Œ GC(G)â€æŒ‰é’®å¯ä»¥å¼ºåˆ¶åº”ç”¨ç¨‹åºæ‰§è¡Œä¸€ä¸ª Full GCã€‚\næ–°ç”Ÿä»£ GCï¼ˆMinor GCï¼‰:æŒ‡å‘ç”Ÿæ–°ç”Ÿä»£çš„çš„åƒåœ¾æ”¶é›†åŠ¨ä½œï¼ŒMinor GC éå¸¸é¢‘ç¹ï¼Œå›æ”¶é€Ÿåº¦ä¸€èˆ¬ä¹Ÿæ¯”è¾ƒå¿«ã€‚\nè€å¹´ä»£ GCï¼ˆMajor GC/Full GCï¼‰:æŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„ GCï¼Œå‡ºç°äº† Major GC ç»å¸¸ä¼šä¼´éšè‡³å°‘ä¸€æ¬¡çš„ Minor GCï¼ˆå¹¶éç»å¯¹ï¼‰ï¼ŒMajor GC çš„é€Ÿåº¦ä¸€èˆ¬ä¼šæ¯” Minor GC çš„æ…¢ 10 å€ä»¥ä¸Šã€‚\nçº¿ç¨‹ç›‘æ§ # ç±»ä¼¼æˆ‘ä»¬å‰é¢è®²çš„ jstack å‘½ä»¤ï¼Œä¸è¿‡è¿™ä¸ªæ˜¯å¯è§†åŒ–çš„ã€‚\næœ€ä¸‹é¢æœ‰ä¸€ä¸ª\u0026quot;æ£€æµ‹æ­»é” (D)\u0026ldquo;æŒ‰é’®ï¼Œç‚¹å‡»è¿™ä¸ªæŒ‰é’®å¯ä»¥è‡ªåŠ¨ä¸ºä½ æ‰¾åˆ°å‘ç”Ÿæ­»é”çš„çº¿ç¨‹ä»¥åŠå®ƒä»¬çš„è¯¦ç»†ä¿¡æ¯ ã€‚ VisualVMï¼š å¤šåˆä¸€æ•…éšœå¤„ç†å·¥å…· # VisualVM æä¾›åœ¨ Java è™šæ‹Ÿæœº (Java Virutal Machine, JVM) ä¸Šè¿è¡Œçš„ Java åº”ç”¨ç¨‹åºçš„è¯¦ç»†ä¿¡æ¯ã€‚åœ¨ VisualVM çš„å›¾å½¢ç”¨æˆ·ç•Œé¢ä¸­ï¼Œæ‚¨å¯ä»¥æ–¹ä¾¿ã€å¿«æ·åœ°æŸ¥çœ‹å¤šä¸ª Java åº”ç”¨ç¨‹åºçš„ç›¸å…³ä¿¡æ¯ã€‚Visual VM å®˜ç½‘ï¼šhttps://visualvm.github.io/open in new window ã€‚Visual VM ä¸­æ–‡æ–‡æ¡£:https://visualvm.github.io/documentation.htmlopen in new windowã€‚\nä¸‹é¢è¿™æ®µè¯æ‘˜è‡ªã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹ã€‚\nVisualVMï¼ˆAll-in-One Java Troubleshooting Toolï¼‰æ˜¯åˆ°ç›®å‰ä¸ºæ­¢éš JDK å‘å¸ƒçš„åŠŸèƒ½æœ€å¼ºå¤§çš„è¿è¡Œç›‘è§†å’Œæ•…éšœå¤„ç†ç¨‹åºï¼Œå®˜æ–¹åœ¨ VisualVM çš„è½¯ä»¶è¯´æ˜ä¸­å†™ä¸Šäº†â€œAll-in-Oneâ€çš„æè¿°å­—æ ·ï¼Œé¢„ç¤ºç€ä»–é™¤äº†è¿è¡Œç›‘è§†ã€æ•…éšœå¤„ç†å¤–ï¼Œè¿˜æä¾›äº†å¾ˆå¤šå…¶ä»–æ–¹é¢çš„åŠŸèƒ½ï¼Œå¦‚æ€§èƒ½åˆ†æï¼ˆProfilingï¼‰ã€‚VisualVM çš„æ€§èƒ½åˆ†æåŠŸèƒ½ç”šè‡³æ¯”èµ· JProfilerã€YourKit ç­‰ä¸“ä¸šä¸”æ”¶è´¹çš„ Profiling å·¥å…·éƒ½ä¸ä¼šé€Šè‰²å¤šå°‘ï¼Œè€Œä¸” VisualVM è¿˜æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜ç‚¹ï¼šä¸éœ€è¦è¢«ç›‘è§†çš„ç¨‹åºåŸºäºç‰¹æ®Š Agent è¿è¡Œï¼Œå› æ­¤ä»–å¯¹åº”ç”¨ç¨‹åºçš„å®é™…æ€§èƒ½çš„å½±å“å¾ˆå°ï¼Œä½¿å¾—ä»–å¯ä»¥ç›´æ¥åº”ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ã€‚è¿™ä¸ªä¼˜ç‚¹æ˜¯ JProfilerã€YourKit ç­‰å·¥å…·æ— æ³•ä¸ä¹‹åª²ç¾çš„ã€‚\nVisualVM åŸºäº NetBeans å¹³å°å¼€å‘ï¼Œå› æ­¤ä»–ä¸€å¼€å§‹å°±å…·å¤‡äº†æ’ä»¶æ‰©å±•åŠŸèƒ½çš„ç‰¹æ€§ï¼Œé€šè¿‡æ’ä»¶æ‰©å±•æ”¯æŒï¼ŒVisualVM å¯ä»¥åšåˆ°ï¼š\næ˜¾ç¤ºè™šæ‹Ÿæœºè¿›ç¨‹ä»¥åŠè¿›ç¨‹çš„é…ç½®ã€ç¯å¢ƒä¿¡æ¯ï¼ˆjpsã€jinfoï¼‰ã€‚ ç›‘è§†åº”ç”¨ç¨‹åºçš„ CPUã€GCã€å †ã€æ–¹æ³•åŒºä»¥åŠçº¿ç¨‹çš„ä¿¡æ¯ï¼ˆjstatã€jstackï¼‰ã€‚ dump ä»¥åŠåˆ†æå †è½¬å‚¨å¿«ç…§ï¼ˆjmapã€jhatï¼‰ã€‚ æ–¹æ³•çº§çš„ç¨‹åºè¿è¡Œæ€§èƒ½åˆ†æï¼Œæ‰¾åˆ°è¢«è°ƒç”¨æœ€å¤šã€è¿è¡Œæ—¶é—´æœ€é•¿çš„æ–¹æ³•ã€‚ ç¦»çº¿ç¨‹åºå¿«ç…§ï¼šæ”¶é›†ç¨‹åºçš„è¿è¡Œæ—¶é…ç½®ã€çº¿ç¨‹ dumpã€å†…å­˜ dump ç­‰ä¿¡æ¯å»ºç«‹ä¸€ä¸ªå¿«ç…§ï¼Œå¯ä»¥å°†å¿«ç…§å‘é€å¼€å‘è€…å¤„è¿›è¡Œ Bug åé¦ˆã€‚ å…¶ä»– plugins çš„æ— é™çš„å¯èƒ½æ€§\u0026hellip;\u0026hellip; è¿™é‡Œå°±ä¸å…·ä½“ä»‹ç» VisualVM çš„ä½¿ç”¨ï¼Œå¦‚æœæƒ³äº†è§£çš„è¯å¯ä»¥çœ‹:\nhttps://visualvm.github.io/documentation.htmlopen in new window https://www.ibm.com/developerworks/cn/java/j-lo-visualvm/index.html "},{"id":120,"href":"/zh/docs/study/Review/java_guide/java/JVM/ly0406lyjvm-params/","title":"jvmå‚æ•°","section":"JavaåŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\næœ¬æ–‡ç”± JavaGuide ç¿»è¯‘è‡ª https://www.baeldung.com/jvm-parametersopen in new windowï¼Œå¹¶å¯¹æ–‡ç« è¿›è¡Œäº†å¤§é‡çš„å®Œå–„è¡¥å……ã€‚ç¿»è¯‘ä¸æ˜“ï¼Œå¦‚éœ€è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œä½œè€…ï¼šbaeldungopen in new window ã€‚\næ¦‚è¿° # æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œå°†æŒæ¡æœ€å¸¸ç”¨çš„JVMå‚æ•°é…ç½®ã€‚ä¸‹é¢æåˆ°äº†ä¸€äº›æ¦‚å¿µï¼Œå †ã€æ–¹æ³•åŒºã€åƒåœ¾å›æ”¶ç­‰ã€‚\nå †å†…å­˜ç›¸å…³ # Java è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼ŒJava å †æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹ æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚\næ˜¾å¼æŒ‡å®šå †å†…å­˜-Xmså’Œ-Xmx # ä¸æ€§èƒ½ç›¸å…³çš„æœ€å¸¸è§å®è·µä¹‹ä¸€æ˜¯æ ¹æ®åº”ç”¨ç¨‹åºè¦æ±‚åˆå§‹åŒ–å †å†…å­˜ã€‚\nå¦‚æœæˆ‘ä»¬éœ€è¦æŒ‡å®šæœ€å°å’Œæœ€å¤§å †å¤§å°ï¼ˆæ¨èæ˜¾ç¤ºæŒ‡å®šå¤§å°ï¼‰ï¼š\n-Xms\u0026lt;heap size\u0026gt;[unit] -Xmx\u0026lt;heap size\u0026gt;[unit] heap size è¡¨ç¤ºè¦åˆå§‹åŒ–å†…å­˜çš„å…·ä½“å¤§å°ã€‚ unit è¡¨ç¤ºè¦åˆå§‹åŒ–å†…å­˜çš„å•ä½ã€‚å•ä½ä¸º***â€œ gâ€*** (GB) ã€â€œ mâ€ï¼ˆMBï¼‰ã€â€œ kâ€ï¼ˆKBï¼‰ã€‚ ä¸¾ä¾‹ï¼Œä¸ºJVMåˆ†é…æœ€å°2GBå’Œæœ€å¤§5GBçš„å †å†…å­˜å¤§å°\n-Xms2G -Xmx5G æ˜¾ç¤ºæ–°ç”Ÿä»£å†…å­˜ï¼ˆYoung Generationï¼‰ # åœ¨å †æ€»å¯ç”¨å†…å­˜é…ç½®å®Œæˆä¹‹åï¼Œç¬¬äºŒå¤§å½±å“å› ç´ æ˜¯ä¸º Young Generation åœ¨å †å†…å­˜æ‰€å çš„æ¯”ä¾‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒYG çš„æœ€å°å¤§å°ä¸º 1310 MBï¼Œæœ€å¤§å¤§å°ä¸ºæ— é™åˆ¶ã€‚\nä¸¤ç§æŒ‡å®š æ–°ç”Ÿä»£å†…å­˜(Young Generation) å¤§å°çš„æ–¹æ³•\né€šè¿‡ -XX:NewSize å’Œ -XX:MaxNewSize -XX:NewSize=\u0026lt;young size\u0026gt;[unit] -XX:MaxNewSize=\u0026lt;young size\u0026gt;[unit] å¦‚ï¼Œä¸ºæ–°ç”Ÿä»£åˆ†é…æœ€å°256mçš„å†…å­˜ï¼Œæœ€å¤§1024mçš„å†…å­˜æˆ‘ä»¬çš„å‚æ•°ä¸ºï¼š\n-XX:NewSize=256m -XX:MaxNewSize=1024m é€šè¿‡-Xmn\u0026lt;young size\u0026gt;[unit] æŒ‡å®š ä¸¾ä¾‹ï¼Œä¸ºæ–°ç”Ÿä»£åˆ†é…256mçš„å†…å­˜ï¼ˆNewSizeä¸MaxNewSizeè®¾ä¸ºä¸€è‡´ï¼‰ -Xmn256m å°†æ–°å¯¹è±¡é¢„ç•™åœ¨æ–°ç”Ÿä»£ï¼Œç”±äº Full GC çš„æˆæœ¬è¿œé«˜äº Minor GCï¼Œå› æ­¤å°½å¯èƒ½å°†å¯¹è±¡åˆ†é…åœ¨æ–°ç”Ÿä»£æ˜¯æ˜æ™ºçš„åšæ³•ï¼Œå®é™…é¡¹ç›®ä¸­æ ¹æ® GC æ—¥å¿—åˆ†ææ–°ç”Ÿä»£ç©ºé—´å¤§å°åˆ†é…æ˜¯å¦åˆç†ï¼Œé€‚å½“é€šè¿‡â€œ-Xmnâ€å‘½ä»¤è°ƒèŠ‚æ–°ç”Ÿä»£å¤§å°ï¼Œæœ€å¤§é™åº¦é™ä½æ–°å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£çš„æƒ…å†µã€‚\nå¦å¤–ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡ -XX:NewRatio=\u0026lt;int\u0026gt; æ¥è®¾ç½®è€å¹´ä»£ä¸æ–°ç”Ÿä»£å†…å­˜çš„æ¯”å€¼ã€‚\nä¸‹é¢çš„å‚æ•°ï¼Œè®¾ç½®è€å¹´ä»£ä¸æ–°ç”Ÿä»£å†…å­˜çš„æ¯”ä¾‹ä¸º1ï¼Œå³ è€å¹´ä»£ï¼šæ–°ç”Ÿä»£ = 1ï¼š1ï¼Œæ–°ç”Ÿä»£å æ•´ä¸ªå †æ ˆçš„1/2 -XX:NewRadio=1\næ˜¾ç¤ºæŒ‡å®šæ°¸ä¹…ä»£/å…ƒç©ºé—´çš„å¤§å° # ä»Java 8å¼€å§‹ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰æŒ‡å®š Metaspace(å…ƒç©ºé—´) çš„å¤§å°ï¼Œéšç€æ›´å¤šç±»çš„åˆ›å»ºï¼Œè™šæ‹Ÿæœºä¼šè€—å°½æ‰€æœ‰å¯ç”¨çš„ç³»ç»Ÿå†…å­˜ï¼ˆæ°¸ä¹…ä»£å¹¶ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼‰\nJDK 1.8 ä¹‹å‰æ°¸ä¹…ä»£è¿˜æ²¡è¢«å½»åº•ç§»é™¤çš„æ—¶å€™é€šå¸¸é€šè¿‡ä¸‹é¢è¿™äº›å‚æ•°æ¥è°ƒèŠ‚æ–¹æ³•åŒºå¤§å°\n-XX:PermSize=N //æ–¹æ³•åŒº (æ°¸ä¹…ä»£) åˆå§‹å¤§å° -XX:MaxPermSize=N //æ–¹æ³•åŒº (æ°¸ä¹…ä»£) æœ€å¤§å¤§å°,è¶…è¿‡è¿™ä¸ªå€¼å°†ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸:java.lang.OutOfMemoryError: PermGen ç›¸å¯¹è€Œè¨€ï¼Œåƒåœ¾æ”¶é›†è¡Œä¸ºåœ¨è¿™ä¸ªåŒºåŸŸæ˜¯æ¯”è¾ƒå°‘å‡ºç°çš„ï¼Œä½†**å¹¶éæ•°æ®è¿›å…¥æ–¹æ³•åŒºåå°±â€œæ°¸ä¹…å­˜åœ¨â€**äº†ã€‚\nJDK 1.8 çš„æ—¶å€™ï¼Œæ–¹æ³•åŒºï¼ˆHotSpot çš„æ°¸ä¹…ä»£ï¼‰è¢«å½»åº•ç§»é™¤äº†ï¼ˆJDK1.7 å°±å·²ç»å¼€å§‹äº†ï¼‰ï¼Œå–è€Œä»£ä¹‹æ˜¯å…ƒç©ºé—´ï¼Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯æœ¬åœ°å†…å­˜\n-XX:MetaspaceSize=N //è®¾ç½® Metaspace çš„åˆå§‹ï¼ˆå’Œæœ€å°å¤§å°ï¼‰ -XX:MaxMetaspaceSize=N //è®¾ç½® Metaspace çš„æœ€å¤§å¤§å°ï¼Œå¦‚æœä¸æŒ‡å®šå¤§å°çš„è¯ï¼Œéšç€æ›´å¤šç±»çš„åˆ›å»ºï¼Œè™šæ‹Ÿæœºä¼šè€—å°½æ‰€æœ‰å¯ç”¨çš„ç³»ç»Ÿå†…å­˜ã€‚ åƒåœ¾æ”¶é›†ç›¸å…³ # åƒåœ¾å›æ”¶å™¨ # ä¸ºäº†æé«˜åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§ï¼Œé€‰æ‹©æ­£ç¡®çš„åƒåœ¾æ”¶é›†ç®—æ³•è‡³å…³é‡è¦\nJVMå…·æœ‰å››ç§ç±»å‹çš„GCå®ç°ï¼š\nä¸²è¡Œåƒåœ¾æ”¶é›†å™¨ å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨ CMSåƒåœ¾æ”¶é›†å™¨ï¼ˆå¹¶å‘ï¼‰ G1åƒåœ¾æ”¶é›†å™¨ï¼ˆå¹¶å‘ï¼‰ ä½¿ç”¨ä¸‹åˆ—å‚æ•°å®ç°ï¼š\n-XX:+UseSerialGC -XX:+UseParallelGC -XX:+UseParNewGC -XX:+UseG1GC GCè®°å½• # ä¸ºäº†ä¸¥æ ¼ç›‘æ§åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶å†µï¼Œåº”è¯¥å§‹ç»ˆæ£€æŸ¥JVMçš„åƒåœ¾å›æ”¶æ€§èƒ½ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä»¥äººç±»å¯è¯»çš„æ ¼å¼è®°å½•GCæ´»åŠ¨\né€šè¿‡ä»¥ä¸‹å‚æ•°\n-XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=\u0026lt; number of log files \u0026gt; -XX:GCLogFileSize=\u0026lt; file size \u0026gt;[ unit ] -Xloggc:/path/to/gc.log "},{"id":121,"href":"/zh/docs/study/Review/java_guide/java/JVM/ly0403lyclass-structure/","title":"ç±»æ–‡ä»¶ç»“æ„","section":"JavaåŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\næ¦‚è¿° # Javaä¸­ï¼ŒJVMå¯ä»¥ç†è§£çš„ä»£ç å°±å«åšå­—èŠ‚ç ï¼ˆå³æ‰©å±•åä¸º.classçš„æ–‡ä»¶ï¼‰ï¼Œå®ƒä¸é¢å‘ä»»ä½•ç‰¹å®šçš„å¤„ç†å™¨ï¼Œåªé¢å‘è™šæ‹Ÿæœº Javaè¯­è¨€é€šè¿‡å­—èŠ‚ç çš„æ–¹å¼ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†ä¼ ç»Ÿè§£é‡Šå‹è¯­è¨€æ‰§è¡Œæ•ˆç‡ä½çš„é—®é¢˜ï¼ŒåŒæ—¶åˆä¿ç•™äº†è§£é‡Šå‹è¯­è¨€å¯ç§»æ¤çš„ç‰¹ç‚¹ã€‚æ‰€ä»¥Javaç¨‹åºè¿è¡Œæ—¶æ•ˆç‡æé«˜ï¼Œä¸”ç”±äºå­—èŠ‚ç å¹¶ä¸é’ˆå¯¹ä¸€ç§ç‰¹å®šçš„æœºå™¨ã€‚å› æ­¤ï¼ŒJavaç¨‹åºæ— éœ€é‡æ–°ç¼–è¯‘ä¾¿å¯åœ¨å¤šç§ä¸é€šæ“ä½œç³»ç»Ÿçš„è®¡ç®—æœºè¿è¡Œ Clojureï¼ˆLisp è¯­è¨€çš„ä¸€ç§æ–¹è¨€ï¼‰ã€Groovyã€Scala ç­‰è¯­è¨€éƒ½æ˜¯è¿è¡Œåœ¨ Java è™šæ‹Ÿæœºä¹‹ä¸Šã€‚ä¸‹å›¾å±•ç¤ºäº†ä¸åŒçš„è¯­è¨€è¢«ä¸åŒçš„ç¼–è¯‘å™¨ç¼–è¯‘æˆ.classæ–‡ä»¶æœ€ç»ˆè¿è¡Œåœ¨ Java è™šæ‹Ÿæœºä¹‹ä¸Šã€‚.classæ–‡ä»¶çš„äºŒè¿›åˆ¶æ ¼å¼å¯ä»¥ä½¿ç”¨ WinHexopen in new window æŸ¥çœ‹ã€‚ .classæ–‡ä»¶æ˜¯ä¸åŒè¯­è¨€åœ¨Javaè™šæ‹Ÿæœºä¹‹é—´çš„é‡è¦æ¡¥æ¢ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æ”¯æŒJavaè·¨å¹³å°å¾ˆé‡è¦çš„ä¸€ä¸ªåŸå› \nClassæ–‡ä»¶ç»“æ„æ€»ç»“ # æ ¹æ®Javaè™šæ‹Ÿæœºè§„èŒƒï¼ŒClassæ–‡ä»¶é€šè¿‡ClassFileå®šä¹‰ï¼Œæœ‰ç‚¹ç±»ä¼¼Cè¯­è¨€çš„ç»“æ„ä½“\nClassFileçš„ç»“æ„å¦‚ä¸‹ï¼š\nClassFile { u4 magic; //Class æ–‡ä»¶çš„æ ‡å¿— u2 minor_version;//Class çš„å°ç‰ˆæœ¬å· u2 major_version;//Class çš„å¤§ç‰ˆæœ¬å· u2 constant_pool_count;//å¸¸é‡æ± çš„æ•°é‡ cp_info constant_pool[constant_pool_count-1];//å¸¸é‡æ±  u2 access_flags;//Class çš„è®¿é—®æ ‡è®° u2 this_class;//å½“å‰ç±» u2 super_class;//çˆ¶ç±» u2 interfaces_count;//æ¥å£ u2 interfaces[interfaces_count];//ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ u2 fields_count;//Class æ–‡ä»¶çš„å­—æ®µå±æ€§ field_info fields[fields_count];//ä¸€ä¸ªç±»å¯ä»¥æœ‰å¤šä¸ªå­—æ®µ u2 methods_count;//Class æ–‡ä»¶çš„æ–¹æ³•æ•°é‡ method_info methods[methods_count];//ä¸€ä¸ªç±»å¯ä»¥æœ‰ä¸ªå¤šä¸ªæ–¹æ³• u2 attributes_count;//æ­¤ç±»çš„å±æ€§è¡¨ä¸­çš„å±æ€§æ•° attribute_info attributes[attributes_count];//å±æ€§è¡¨é›†åˆ } é€šè¿‡IDEAæ’ä»¶jclasslibæŸ¥çœ‹ï¼Œå¯ä»¥ç›´è§‚çœ‹åˆ°Class æ–‡ä»¶ç»“æ„\nä½¿ç”¨jclasslibä¸å…‰èƒ½ç›´è§‚åœ°æŸ¥çœ‹æŸä¸ªç±»å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œè¿˜å¯ä»¥æŸ¥çœ‹ç±»çš„åŸºæœ¬ä¿¡æ¯ã€å¸¸é‡æ± ã€æ¥å£ã€å±æ€§ã€å‡½æ•°ç­‰ä¿¡æ¯\nä¸‹é¢ä»‹ç»ä¸€ä¸‹Classæ–‡ä»¶ç»“æ„æ¶‰åŠåˆ°çš„ä¸€äº›ç»„ä»¶\né­”æ•°ï¼ˆMagic Numberï¼‰ # u4 magic; //Class æ–‡ä»¶çš„æ ‡å¿— æ¯ä¸ªClassæ–‡ä»¶çš„å¤´4ä¸ªå­—èŠ‚ç§°ä¸ºé­”æ•°ï¼ˆMagic Numberï¼‰ï¼Œå®ƒçš„å”¯ä¸€ä½œç”¨æ˜¯ç¡®å®šè¿™ä¸ªæ–‡ä»¶æ˜¯å¦ä¸ºä¸€ä¸ªèƒ½è¢«è™šæ‹Ÿæœºæ¥æ”¶çš„Classæ–‡ä»¶\nç¨‹åºè®¾è®¡è€…å¾ˆå¤šæ—¶å€™éƒ½å–œæ¬¢ç”¨ä¸€äº›ç‰¹æ®Šçš„æ•°å­—è¡¨ç¤ºå›ºå®šçš„æ–‡ä»¶ç±»å‹æˆ–è€…å…¶å®ƒç‰¹æ®Šçš„å«ä¹‰ã€‚\nè¿™é‡Œå‰ä¸¤ä¸ªå­—èŠ‚æ˜¯cafe è‹±[ËˆkÃ¦feÉª]ï¼Œåä¸¤ä¸ªå­—èŠ‚ babe è‹±[beÉªb]\nJAVAä¸º CA FE BA BEï¼Œåå…­è¿›åˆ¶(ä¸€ä¸ªè‹±æ–‡å­—æ¯[è¿™é‡Œè¯´çš„æ˜¯å­—æ¯ï¼Œä¸æ˜¯è‹±æ–‡ä¸­æ–‡ä¹‹åˆ†]ä»£è¡¨4ä½ï¼Œå³2ä¸ªè‹±æ–‡å­—æ¯ä¸º1å­—èŠ‚ï¼‰\nClassæ–‡ä»¶ç‰ˆæœ¬å·ï¼ˆMinor\u0026amp;Major Versionï¼‰ # u2 minor_version;//Class çš„å°ç‰ˆæœ¬å· u2 major_version;//Class çš„å¤§ç‰ˆæœ¬å· å‰4ä¸ªå­—èŠ‚å­˜å‚¨Class æ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼šç¬¬5ä½å’Œç¬¬6ä½æ˜¯æ¬¡ç‰ˆæœ¬å·ï¼Œç¬¬7ä½å’Œç¬¬8ä½æ˜¯ä¸»ç‰ˆæœ¬å·ã€‚ æ¯”å¦‚Java1.8 ä¸º00 00 00 34 JDK1.8 = 52 JDK1.7 = 51 JDK1.6 = 50 JDK1.5 = 49 JDK1.4 = 48 å¦‚å›¾ï¼Œä¸‹å›¾æ˜¯åœ¨java8ä¸­ç¼–è¯‘çš„ï¼Œä½¿ç”¨javap -v æŸ¥çœ‹ æ¯å½“Javaå‘å¸ƒå¤§ç‰ˆæœ¬ï¼ˆæ¯”å¦‚Java8 ï¼ŒJava9 ï¼‰çš„æ—¶å€™ï¼Œä¸»ç‰ˆæœ¬å·éƒ½ä¼š+1\næ³¨ï¼šé«˜ç‰ˆæœ¬çš„ Java è™šæ‹Ÿæœºå¯ä»¥æ‰§è¡Œä½ç‰ˆæœ¬ç¼–è¯‘å™¨ç”Ÿæˆçš„ Class æ–‡ä»¶ï¼Œä½†æ˜¯ä½ç‰ˆæœ¬çš„ Java è™šæ‹Ÿæœºä¸èƒ½æ‰§è¡Œé«˜ç‰ˆæœ¬ç¼–è¯‘å™¨ç”Ÿæˆçš„ Class æ–‡ä»¶ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨å®é™…å¼€å‘çš„æ—¶å€™è¦ç¡®ä¿å¼€å‘çš„çš„ JDK ç‰ˆæœ¬å’Œç”Ÿäº§ç¯å¢ƒçš„ JDK ç‰ˆæœ¬ä¿æŒä¸€è‡´\nå¸¸é‡æ± ï¼ˆConstant Poolï¼‰ # u2 constant_pool_count;//å¸¸é‡æ± çš„æ•°é‡ cp_info constant_pool[constant_pool_count-1];//å¸¸é‡æ±  ä¸»æ¬¡ç‰ˆæœ¬å·ä¹‹åçš„æ˜¯å¸¸é‡æ± ï¼Œå¸¸é‡æ± å®é™…æ•°é‡ä¸ºconstant_pool_count -1 ï¼ˆå¸¸é‡æ± è®¡æ•°å™¨æ˜¯ä» 1 å¼€å§‹è®¡æ•°çš„ï¼Œå°†ç¬¬ 0 é¡¹å¸¸é‡ç©ºå‡ºæ¥æ˜¯æœ‰ç‰¹æ®Šè€ƒè™‘çš„ï¼Œç´¢å¼•å€¼ä¸º 0 ä»£è¡¨â€œä¸å¼•ç”¨ä»»ä½•ä¸€ä¸ªå¸¸é‡æ± é¡¹â€ï¼‰\nå¸¸é‡æ± ä¸»è¦åŒ…æ‹¬ä¸¤å¤§å¸¸é‡ï¼šå­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚\nå­—é¢é‡æ¯”è¾ƒæ¥è¿‘äºJavaè¯­è¨€å±‚é¢çš„å¸¸é‡æ¦‚å¿µï¼Œå¦‚æ–‡æœ¬å­—ç¬¦ä¸²ã€å£°æ˜ä¸ºfinalçš„å¸¸é‡å€¼ç­‰\næ³¨æ„ï¼Œéå¸¸é‡æ˜¯ä¸ä¼šåœ¨è¿™é‡Œçš„ï¼Œ æ²¡æœ‰æ‰¾åˆ°3\nç¬¦å·å¼•ç”¨åˆ™å±äºç¼–è¯‘åŸç†æ–¹é¢çš„æ¦‚å¿µï¼ŒåŒ…æ‹¬ä¸‹é¢ä¸‰ç±»å¸¸é‡\nç±»å’Œæ¥å£çš„å…¨é™å®šå å­—æ®µçš„åç§°å’Œæè¿°ç¬¦ æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦ å¸¸é‡æ± ä¸­çš„æ¯ä¸€é¡¹å¸¸é‡éƒ½æ˜¯ä¸€ä¸ªè¡¨ï¼Œè¿™14ç§è¡¨æœ‰ä¸€ä¸ªå…±åŒç‰¹ç‚¹ï¼šå¼€å§‹ç¬¬ä¸€ä½æ˜¯ä¸€ä¸ªu1ç±»å‹çš„æ ‡å¿—ä½ -tag æ¥æ ‡è¯†å¸¸é‡çš„ç±»å‹ï¼Œä»£è¡¨å½“å‰è¿™ä¸ªå¸¸é‡å±äºå“ªç§å¸¸é‡ç±»å‹\n.class æ–‡ä»¶å¯ä»¥é€šè¿‡javap -v classç±»å æŒ‡ä»¤æ¥çœ‹ä¸€ä¸‹å…¶å¸¸é‡æ± ä¸­çš„ä¿¡æ¯(javap -v classç±»å-\u0026gt; temp.txt ï¼šå°†ç»“æœè¾“å‡ºåˆ° temp.txt æ–‡ä»¶)ã€‚\nè®¿é—®æ ‡å¿—ï¼ˆAccess Flagï¼‰ # å¸¸é‡æ± ç»“æŸåï¼Œç´§æ¥ç€ä¸¤ä¸ªå­—èŠ‚ä»£è¡¨è®¿é—®æ ‡å¿—ï¼Œè¿™ä¸ªæ ‡å¿—ç”¨äºè¯†åˆ«ä¸€äº›ç±»æˆ–è€…æ¥å£ å±‚æ¬¡çš„è®¿é—®ä¿¡æ¯ï¼ŒåŒ…æ‹¬\nè¿™ä¸ªClassæ˜¯ç±»è¿˜æ˜¯æ¥å£ï¼Œæ˜¯å¦ä¸ºpublicæˆ–è€…abstractç±»å‹ï¼Œå¦‚æœæ˜¯ç±»çš„è¯æ˜¯å¦å£°æ˜ä¸ºfinalç­‰ç­‰\nç±»è®¿é—®å’Œå±æ€§ä¿®é¥°ç¬¦\nã€è¿™é‡Œå¥½åƒæ¼äº†ä¸€ä¸ª0x0002 ï¼Œprivate ã€‘\nä¸Šå›¾è½¬è‡ªï¼š https://www.cnblogs.com/qdhxhz/p/10676337.html\nå…¶å®æ˜¯æ‰€æœ‰å€¼ç›¸åŠ ï¼Œæ‰€ä»¥å¯¹äº public interface A ï¼Œæ˜¯0x601 ï¼Œå³ 0x200 + 0x400 + 0x001\nå¯¹äº public final class MyEntity extends MyInterfaceå³0x31ï¼š0x0001 + 0x0010 + 0x0020\nå†ä¸¾ä¸ªä¾‹å­ï¼š\npackage top.snailclimb.bean; public class Employee { ... } é€šè¿‡ javap -v classç±»åæŒ‡ä»¤æ¥çœ‹ä¸€ä¸‹ç±»çš„è®¿é—®æ ‡å¿—\nå½“å‰ç±»ï¼ˆThis Classï¼‰ã€çˆ¶ç±»ï¼ˆSuper Classï¼‰ã€æ¥å£ï¼ˆInterfacesï¼‰ç´¢å¼•é›†åˆ # u2 this_class;//å½“å‰ç±» u2 super_class;//çˆ¶ç±» u2 interfaces_count;//æ¥å£ u2 interfaces[interfaces_count];//ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„å…¨é™å®šåï¼Œçˆ¶ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„çˆ¶ç±»çš„å…¨é™å®šåï¼Œç”±äº Java è¯­è¨€çš„å•ç»§æ‰¿ï¼Œæ‰€ä»¥çˆ¶ç±»ç´¢å¼•åªæœ‰ä¸€ä¸ªï¼Œé™¤äº† java.lang.Object ä¹‹å¤–ï¼Œæ‰€æœ‰çš„ java ç±»éƒ½æœ‰çˆ¶ç±»ï¼Œå› æ­¤é™¤äº† java.lang.Object å¤–ï¼Œæ‰€æœ‰ Java ç±»çš„çˆ¶ç±»ç´¢å¼•éƒ½ä¸ä¸º 0ã€‚ æ¥å£ç´¢å¼•é›†åˆç”¨æ¥æè¿°è¿™ä¸ªç±»å®ç°äº†é‚£äº›æ¥å£ï¼Œè¿™äº›è¢«å®ç°çš„æ¥å£å°†æŒ‰ implements (å¦‚æœè¿™ä¸ªç±»æœ¬èº«æ˜¯æ¥å£çš„è¯åˆ™æ˜¯extends) åçš„æ¥å£é¡ºåºä»å·¦åˆ°å³æ’åˆ—åœ¨æ¥å£ç´¢å¼•é›†åˆä¸­ã€‚ å­—æ®µè¡¨é›†åˆ ï¼ˆFieldsï¼‰ # u2 fields_count;//Class æ–‡ä»¶çš„å­—æ®µçš„ä¸ªæ•° field_info fields[fields_count];//ä¸€ä¸ªç±»å¯ä»¥æœ‰å¤šä¸ªå­—æ®µ å­—æ®µè¡¨ï¼ˆfiled infoï¼‰ç”¨äºæè¿°æ¥å£æˆ–ç±»ä¸­å£°æ˜çš„å˜é‡\nå­—æ®µåŒ…æ‹¬ç±»çº§å˜é‡ä»¥åŠå®ä¾‹å˜é‡ï¼Œä½†ä¸åŒ…æ‹¬åœ¨æ–¹æ³•å†…éƒ¨å£°æ˜çš„å±€éƒ¨å˜é‡ filed info(å­—æ®µè¡¨)çš„ç»“æ„ï¼š\naccess_flagï¼šå­—æ®µçš„ä½œç”¨åŸŸï¼ˆpublicã€privateã€protectedä¿®é¥°ç¬¦ï¼‰ã€æ˜¯å®ä¾‹å˜é‡è¿˜æ˜¯ç±»å˜é‡ï¼ˆstaticä¿®é¥°ç¬¦ï¼‰ã€å¯å¦è¢«åºåˆ—åŒ–ï¼ˆtransientä¿®é¥°ç¬¦ï¼‰ã€å¯å˜æ€§ï¼ˆfinalï¼‰ã€å¯è§æ€§ï¼ˆvolatileä¿®é¥°ç¬¦ï¼Œæ˜¯å¦å¼ºåˆ¶ä»ä¸»å†…å­˜è¯»å†™ï¼‰ name_indexï¼šå¯¹å¸¸é‡æ± çš„å¼•ç”¨ï¼Œè¡¨ç¤ºçš„å­—æ®µçš„åç§° descriptor_indexï¼šå¯¹å¸¸é‡æ± çš„å¼•ç”¨ï¼Œè¡¨ç¤ºå­—æ®µå’Œæ–¹æ³•çš„æè¿°ç¬¦ attributes_countï¼šä¸€ä¸ªå­—æ®µè¿˜ä¼šæ‹¥æœ‰é¢å¤–çš„å±æ€§ï¼Œattributes_count å­˜æ”¾å±æ€§çš„ä¸ªæ•° attributes[attriutes_count]: å­˜æ”¾å…·ä½“å±æ€§å…·ä½“å†…å®¹ ä¸Šè¿°è¿™äº›ä¿¡æ¯ä¸­ï¼Œå„ä¸ªä¿®é¥°ç¬¦éƒ½æ˜¯å¸ƒå°”å€¼ï¼Œè¦ä¹ˆæœ‰æŸä¸ªä¿®é¥°ç¬¦ï¼Œè¦ä¹ˆæ²¡æœ‰ï¼Œå¾ˆé€‚åˆä½¿ç”¨æ ‡å¿—ä½æ¥è¡¨ç¤ºã€‚è€Œå­—æ®µå«ä»€ä¹ˆåå­—ã€å­—æ®µè¢«å®šä¹‰ä¸ºä»€ä¹ˆæ•°æ®ç±»å‹è¿™äº›éƒ½æ˜¯æ— æ³•å›ºå®šçš„ï¼Œåªèƒ½å¼•ç”¨å¸¸é‡æ± ä¸­å¸¸é‡æ¥æè¿°ã€‚\næ–¹æ³•è¡¨é›†åˆï¼ˆMethodsï¼‰ # u2 methods_count;//Class æ–‡ä»¶çš„æ–¹æ³•çš„æ•°é‡ method_info methods[methods_count];//ä¸€ä¸ªç±»å¯ä»¥æœ‰ä¸ªå¤šä¸ªæ–¹æ³• methods_count è¡¨ç¤ºæ–¹æ³•çš„æ•°é‡ï¼Œè€Œ method_info è¡¨ç¤ºæ–¹æ³•è¡¨ã€‚-\nClass æ–‡ä»¶å­˜å‚¨æ ¼å¼ä¸­å¯¹æ–¹æ³•çš„æè¿°ä¸å¯¹å­—æ®µçš„æè¿°å‡ ä¹é‡‡ç”¨äº†å®Œå…¨ä¸€è‡´çš„æ–¹å¼ã€‚æ–¹æ³•è¡¨çš„ç»“æ„å¦‚åŒå­—æ®µè¡¨ä¸€æ ·ï¼Œä¾æ¬¡åŒ…æ‹¬äº†è®¿é—®æ ‡å¿—ã€åç§°ç´¢å¼•ã€æè¿°ç¬¦ç´¢å¼•ã€å±æ€§è¡¨é›†åˆå‡ é¡¹ã€‚\nmethod_infoï¼ˆæ–¹æ³•è¡¨çš„ï¼‰ç»“æ„\næ–¹æ³•è¡¨çš„ access_flag å–å€¼ï¼š æ³¨æ„ï¼šå› ä¸ºvolatileä¿®é¥°ç¬¦å’Œtransientä¿®é¥°ç¬¦ä¸å¯ä»¥ä¿®é¥°æ–¹æ³•ï¼Œæ‰€ä»¥æ–¹æ³•è¡¨çš„è®¿é—®æ ‡å¿—ä¸­æ²¡æœ‰è¿™ä¸¤ä¸ªå¯¹åº”çš„æ ‡å¿—ï¼Œä½†æ˜¯å¢åŠ äº†synchronizedã€nativeã€abstractç­‰å…³é”®å­—ä¿®é¥°æ–¹æ³•ï¼Œæ‰€ä»¥ä¹Ÿå°±å¤šäº†è¿™äº›å…³é”®å­—å¯¹åº”çš„æ ‡å¿—ã€‚\nå±æ€§è¡¨é›†åˆï¼ˆAttributesï¼‰ # å¦‚ä¸Šï¼Œå­—æ®µå’Œæ–¹æ³•éƒ½æ‹¥æœ‰å±æ€§ å±æ€§å¤§æ¦‚å°±æ˜¯è¿™ç§ u2 attributes_count;//æ­¤ç±»çš„å±æ€§è¡¨ä¸­çš„å±æ€§æ•° attribute_info attributes[attributes_count];//å±æ€§è¡¨é›†åˆ åœ¨ Class æ–‡ä»¶ï¼Œå­—æ®µè¡¨ï¼Œæ–¹æ³•è¡¨ä¸­éƒ½å¯ä»¥æºå¸¦è‡ªå·±çš„å±æ€§è¡¨é›†åˆï¼Œä»¥ç”¨äºæè¿°æŸäº›åœºæ™¯ä¸“æœ‰çš„ä¿¡æ¯ ä¸ Class æ–‡ä»¶ä¸­å…¶å®ƒçš„æ•°æ®é¡¹ç›®è¦æ±‚çš„é¡ºåºã€é•¿åº¦å’Œå†…å®¹ä¸åŒï¼Œå±æ€§è¡¨é›†åˆçš„é™åˆ¶ç¨å¾®å®½æ¾ä¸€äº›ï¼Œä¸å†è¦æ±‚å„ä¸ªå±æ€§è¡¨å…·æœ‰ä¸¥æ ¼çš„é¡ºåºï¼Œå¹¶ä¸”åªè¦ä¸ä¸å·²æœ‰çš„å±æ€§åé‡å¤ï¼Œä»»ä½•äººå®ç°çš„ç¼–è¯‘å™¨éƒ½å¯ä»¥å‘å±æ€§è¡¨ä¸­å†™ å…¥è‡ªå·±å®šä¹‰çš„å±æ€§ä¿¡æ¯ï¼ŒJava è™šæ‹Ÿæœºè¿è¡Œæ—¶ä¼šå¿½ç•¥æ‰å®ƒä¸è®¤è¯†çš„å±æ€§ "},{"id":122,"href":"/zh/docs/study/Review/java_guide/java/JVM/ly0405lyclassloader-detail/","title":"ç±»åŠ è½½å™¨è¯¦è§£","section":"JavaåŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nå›é¡¾ä¸€ä¸‹ç±»åŠ è½½è¿‡ç¨‹ # å¼€å§‹ä»‹ç»ç±»åŠ è½½å™¨å’ŒåŒäº²å§”æ´¾æ¨¡å‹ä¹‹å‰ï¼Œç®€å•å›é¡¾ä¸€ä¸‹ç±»åŠ è½½è¿‡ç¨‹ã€‚\nç±»åŠ è½½è¿‡ç¨‹ï¼šåŠ è½½-\u0026gt;è¿æ¥-\u0026gt;åˆå§‹åŒ–ã€‚ è¿æ¥è¿‡ç¨‹åˆå¯åˆ†ä¸ºä¸‰æ­¥ï¼šéªŒè¯-\u0026gt;å‡†å¤‡-\u0026gt;è§£æã€‚ [\nåŠ è½½æ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œä¸»è¦å®Œæˆä¸‹é¢ 3 ä»¶äº‹æƒ…ï¼š\né€šè¿‡å…¨ç±»åè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬æ¢ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ Class å¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™äº›æ•°æ®çš„è®¿é—®å…¥å£ ç±»åŠ è½½å™¨ # ç±»åŠ è½½å™¨ä»‹ç» # ç±»åŠ è½½å™¨ä» JDK 1.0 å°±å‡ºç°äº†ï¼Œæœ€åˆåªæ˜¯ä¸ºäº†æ»¡è¶³ Java Appletï¼ˆå·²ç»è¢«æ·˜æ±°ï¼‰ çš„éœ€è¦ã€‚åæ¥ï¼Œæ…¢æ…¢æˆä¸º Java ç¨‹åºä¸­çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œèµ‹äºˆäº† Java ç±»å¯ä»¥è¢«åŠ¨æ€åŠ è½½åˆ° JVM ä¸­å¹¶æ‰§è¡Œçš„èƒ½åŠ›ã€‚\næ ¹æ®å®˜æ–¹ API æ–‡æ¡£çš„ä»‹ç»ï¼š\nA class loader is an object that is responsible for loading classes. The class ClassLoader is an abstract class. Given the binary name of a class, a class loader should attempt to locate or generate data that constitutes a definition for the class. A typical strategy is to transform the name into a file name and then read a \u0026ldquo;class file\u0026rdquo; of that name from a file system.\nEvery Class object contains a reference to the ClassLoader that defined it.\nClass objects for array classes are not created by class loaders, but are created automatically as required by the Java runtime. The class loader for an array class, as returned by Class.getClassLoader() is the same as the class loader for its element type; if the element type is a primitive type, then the array class has no class loader.\nç¿»è¯‘è¿‡æ¥å¤§æ¦‚çš„æ„æ€æ˜¯ï¼š\nç±»åŠ è½½å™¨æ˜¯ä¸€ä¸ªè´Ÿè´£åŠ è½½ç±»çš„å¯¹è±¡ã€‚ClassLoader æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ã€‚ç»™å®šç±»çš„äºŒè¿›åˆ¶åç§°ï¼Œç±»åŠ è½½å™¨åº”å°è¯•å®šä½æˆ–ç”Ÿæˆæ„æˆç±»å®šä¹‰çš„æ•°æ®ã€‚å…¸å‹çš„ç­–ç•¥æ˜¯å°†åç§°è½¬æ¢ä¸ºæ–‡ä»¶åï¼Œç„¶åä»æ–‡ä»¶ç³»ç»Ÿä¸­è¯»å–è¯¥åç§°çš„â€œç±»æ–‡ä»¶â€ã€‚\næ¯ä¸ª Java ç±»éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨æŒ‡å‘åŠ è½½å®ƒçš„ ClassLoaderã€‚ä¸è¿‡ï¼Œæ•°ç»„ç±»ä¸æ˜¯é€šè¿‡ ClassLoader åˆ›å»ºçš„ï¼Œè€Œæ˜¯ JVM åœ¨éœ€è¦çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºçš„ï¼Œæ•°ç»„ç±»é€šè¿‡getClassLoader()æ–¹æ³•è·å– ClassLoader çš„æ—¶å€™å’Œè¯¥æ•°ç»„çš„å…ƒç´ ç±»å‹çš„ ClassLoader æ˜¯ä¸€è‡´çš„ã€‚\nä»ä¸Šé¢çš„ä»‹ç»å¯ä»¥çœ‹å‡º:\nç±»åŠ è½½å™¨æ˜¯ä¸€ä¸ªè´Ÿè´£åŠ è½½ç±»çš„å¯¹è±¡ï¼Œç”¨äºå®ç°ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„åŠ è½½è¿™ä¸€æ­¥ã€‚ æ¯ä¸ª Java ç±»éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨æŒ‡å‘åŠ è½½å®ƒçš„ ClassLoaderã€‚ æ•°ç»„ç±»ä¸æ˜¯é€šè¿‡ ClassLoader åˆ›å»ºçš„ï¼ˆæ•°ç»„ç±»æ²¡æœ‰å¯¹åº”çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼‰ï¼Œæ˜¯ç”± JVM ç›´æ¥ç”Ÿæˆçš„ã€‚ class Class\u0026lt;T\u0026gt; { ... private final ClassLoader classLoader; @CallerSensitive public ClassLoader getClassLoader() { //... } ... } ç®€å•æ¥è¯´ï¼Œç±»åŠ è½½å™¨çš„ä¸»è¦ä½œç”¨å°±æ˜¯åŠ è½½ Java ç±»çš„å­—èŠ‚ç ï¼ˆ .class æ–‡ä»¶ï¼‰åˆ° JVM ä¸­ï¼ˆåœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ Class å¯¹è±¡ï¼‰ã€‚ å­—èŠ‚ç å¯ä»¥æ˜¯ Java æºç¨‹åºï¼ˆ.javaæ–‡ä»¶ï¼‰ç»è¿‡ javac ç¼–è¯‘å¾—æ¥ï¼Œä¹Ÿå¯ä»¥æ˜¯é€šè¿‡å·¥å…·åŠ¨æ€ç”Ÿæˆæˆ–è€…é€šè¿‡ç½‘ç»œä¸‹è½½å¾—æ¥ã€‚\nå…¶å®é™¤äº†åŠ è½½ç±»ä¹‹å¤–ï¼Œç±»åŠ è½½å™¨è¿˜å¯ä»¥åŠ è½½ Java åº”ç”¨æ‰€éœ€çš„èµ„æºå¦‚æ–‡æœ¬ã€å›¾åƒã€é…ç½®æ–‡ä»¶ã€è§†é¢‘ç­‰ç­‰æ–‡ä»¶èµ„æºã€‚æœ¬æ–‡åªè®¨è®ºå…¶æ ¸å¿ƒåŠŸèƒ½ï¼šåŠ è½½ç±»ã€‚\nç±»åŠ è½½å™¨åŠ è½½è§„åˆ™ # JVM å¯åŠ¨çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰çš„ç±»ï¼Œè€Œæ˜¯æ ¹æ®éœ€è¦å»åŠ¨æ€åŠ è½½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¤§éƒ¨åˆ†ç±»åœ¨å…·ä½“ç”¨åˆ°çš„æ—¶å€™æ‰ä¼šå»åŠ è½½ï¼Œè¿™æ ·å¯¹å†…å­˜æ›´åŠ å‹å¥½ã€‚\nå¯¹äºå·²ç»åŠ è½½çš„ç±»ä¼šè¢«æ”¾åœ¨ ClassLoader ä¸­ã€‚åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šé¦–å…ˆåˆ¤æ–­å½“å‰ç±»æ˜¯å¦è¢«åŠ è½½è¿‡ã€‚å·²ç»è¢«åŠ è½½çš„ç±»ä¼šç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰ä¼šå°è¯•åŠ è½½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºä¸€ä¸ªç±»åŠ è½½å™¨æ¥è¯´ï¼Œç›¸åŒäºŒè¿›åˆ¶åç§°çš„ç±»åªä¼šè¢«åŠ è½½ä¸€æ¬¡ã€‚\npublic abstract class ClassLoader { ... private final ClassLoader parent; // ç”±è¿™ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„ç±»ã€‚ private final Vector\u0026lt;Class\u0026lt;?\u0026gt;\u0026gt; classes = new Vector\u0026lt;\u0026gt;(); // ç”±VMè°ƒç”¨ï¼Œç”¨æ­¤ç±»åŠ è½½å™¨è®°å½•æ¯ä¸ªå·²åŠ è½½ç±»ã€‚ void addClass(Class\u0026lt;?\u0026gt; c) { classes.addElement(c); } ... } ç±»åŠ è½½å™¨æ€»ç»“ # JVM ä¸­å†…ç½®äº†ä¸‰ä¸ªé‡è¦çš„ ClassLoaderï¼š\nBootstrapClassLoader(å¯åŠ¨ç±»åŠ è½½å™¨) ï¼šæœ€é¡¶å±‚çš„åŠ è½½ç±»ï¼Œç”± C++å®ç°ï¼Œé€šå¸¸è¡¨ç¤ºä¸º nullï¼ˆæ„æ€æ˜¯å¦‚æœç”¨ä»£ç æ¥getï¼Œä¼šå¾—åˆ°nullï¼‰ï¼Œå¹¶ä¸”æ²¡æœ‰çˆ¶çº§ï¼Œä¸»è¦ç”¨æ¥åŠ è½½ JDK å†…éƒ¨çš„æ ¸å¿ƒç±»åº“ï¼ˆ **%JAVA_HOME%/lib**ç›®å½•ä¸‹çš„ rt.jar ã€resources.jar ã€charsets.jarç­‰ jar åŒ…å’Œç±»ï¼‰ä»¥åŠè¢« -Xbootclasspathå‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸‹çš„æ‰€æœ‰ç±»ã€‚ ExtensionClassLoader(æ‰©å±•ç±»åŠ è½½å™¨) ï¼šä¸»è¦è´Ÿè´£åŠ è½½ %JRE_HOME%/lib/ext ç›®å½•ä¸‹çš„ jar åŒ…å’Œç±»ä»¥åŠè¢« java.ext.dirs ç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸‹çš„æ‰€æœ‰ç±»ã€‚ AppClassLoader(åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨) ï¼šé¢å‘æˆ‘ä»¬ç”¨æˆ·çš„åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½å½“å‰åº”ç”¨ classpath ä¸‹çš„æ‰€æœ‰ jar åŒ…å’Œç±»ã€‚ ğŸŒˆ æ‹“å±•ä¸€ä¸‹ï¼š\nrt.jar ï¼š rt ä»£è¡¨â€œRunTimeâ€ï¼Œrt.jaræ˜¯JavaåŸºç¡€ç±»åº“ï¼ŒåŒ…å«Java docé‡Œé¢çœ‹åˆ°çš„æ‰€æœ‰çš„ç±»çš„ç±»æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¸¸ç”¨å†…ç½®åº“ java.xxx.* éƒ½åœ¨é‡Œé¢ï¼Œæ¯”å¦‚java.util.*ã€java.io.*ã€java.nio.*ã€java.lang.*ã€java.sql.*ã€java.math.*ã€‚ Java 9 å¼•å…¥äº†æ¨¡å—ç³»ç»Ÿï¼Œå¹¶ä¸”ç•¥å¾®æ›´æ”¹äº†ä¸Šè¿°çš„ç±»åŠ è½½å™¨ã€‚æ‰©å±•ç±»åŠ è½½å™¨è¢«æ”¹åä¸ºå¹³å°ç±»åŠ è½½å™¨ï¼ˆplatform class loaderï¼‰ã€‚Java SE ä¸­é™¤äº†å°‘æ•°å‡ ä¸ªå…³é”®æ¨¡å—ï¼Œæ¯”å¦‚è¯´ java.base æ˜¯ç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ä¹‹å¤–ï¼Œå…¶ä»–çš„æ¨¡å—å‡ç”±å¹³å°ç±»åŠ è½½å™¨æ‰€åŠ è½½ã€‚ é™¤äº†è¿™ä¸‰ç§ç±»åŠ è½½å™¨ä¹‹å¤–ï¼Œç”¨æˆ·è¿˜å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æ¥è¿›è¡Œæ‹“å±•ï¼Œä»¥æ»¡è¶³è‡ªå·±çš„ç‰¹æ®Šéœ€æ±‚ã€‚å°±æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ Java ç±»çš„å­—èŠ‚ç ï¼ˆ .class æ–‡ä»¶ï¼‰è¿›è¡ŒåŠ å¯†ï¼ŒåŠ è½½æ—¶å†åˆ©ç”¨è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨å¯¹å…¶è§£å¯†ã€‚\né™¤äº† BootstrapClassLoader æ˜¯ JVM è‡ªèº«çš„ä¸€éƒ¨åˆ†ä¹‹å¤–ï¼Œå…¶ä»–æ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½æ˜¯åœ¨ JVM å¤–éƒ¨å®ç°çš„ï¼Œå¹¶ä¸”å…¨éƒ½ç»§æ‰¿è‡ª ClassLoaderæŠ½è±¡ç±»ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œä»¥ä¾¿è®©åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•å»è·å–æ‰€éœ€çš„ç±»ã€‚\næ¯ä¸ª ClassLoader å¯ä»¥é€šè¿‡**getParent()è·å–å…¶çˆ¶ ClassLoaderï¼Œå¦‚æœè·å–åˆ° ClassLoader ä¸ºnull**çš„è¯ï¼Œé‚£ä¹ˆè¯¥ç±»æ˜¯é€šè¿‡ BootstrapClassLoader åŠ è½½çš„ã€‚\npublic abstract class ClassLoader { ... // çˆ¶åŠ è½½å™¨ private final ClassLoader parent; @CallerSensitive public final ClassLoader getParent() { //... } ... } ä¸ºä»€ä¹ˆ è·å–åˆ° ClassLoader ä¸ºnullå°±æ˜¯ BootstrapClassLoader åŠ è½½çš„å‘¢ï¼Ÿ è¿™æ˜¯å› ä¸ºBootstrapClassLoader ç”± C++ å®ç°ï¼Œç”±äºè¿™ä¸ª C++ å®ç°çš„ç±»åŠ è½½å™¨åœ¨ Java ä¸­æ˜¯æ²¡æœ‰ä¸ä¹‹å¯¹åº”çš„ç±»çš„ï¼Œæ‰€ä»¥æ‹¿åˆ°çš„ç»“æœæ˜¯ nullã€‚\nä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªè·å– ClassLoader çš„å°æ¡ˆä¾‹ï¼š\npublic class PrintClassLoaderTree { public static void main(String[] args) { ClassLoader classLoader = PrintClassLoaderTree.class.getClassLoader(); StringBuilder split = new StringBuilder(\u0026#34;|--\u0026#34;); boolean needContinue = true; while (needContinue){ System.out.println(split.toString() + classLoader); if(classLoader == null){ needContinue = false; }else{ classLoader = classLoader.getParent(); split.insert(0, \u0026#34;\\t\u0026#34;); } } } } è¾“å‡ºç»“æœ(JDK 8 )ï¼š\n|--sun.misc.Launcher$AppClassLoader@18b4aac2 |--sun.misc.Launcher$ExtClassLoader@53bd815b |--null ä»è¾“å‡ºç»“æœå¯ä»¥çœ‹å‡ºï¼š\næˆ‘ä»¬ç¼–å†™çš„ Java ç±» PrintClassLoaderTree çš„ ClassLoader æ˜¯AppClassLoaderï¼› AppClassLoaderçš„çˆ¶ ClassLoader æ˜¯ExtClassLoaderï¼› ExtClassLoaderçš„çˆ¶ClassLoaderæ˜¯Bootstrap ClassLoaderï¼Œå› æ­¤è¾“å‡ºç»“æœä¸º nullã€‚ è‡ªå®šä¹‰ç±»åŠ è½½å™¨ # æˆ‘ä»¬å‰é¢ä¹Ÿè¯´è¯´äº†ï¼Œé™¤äº† BootstrapClassLoader å…¶ä»–ç±»åŠ è½½å™¨å‡ç”± Java å®ç°ä¸”å…¨éƒ¨ç»§æ‰¿è‡ªjava.lang.ClassLoaderã€‚å¦‚æœæˆ‘ä»¬è¦è‡ªå®šä¹‰è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œå¾ˆæ˜æ˜¾éœ€è¦ç»§æ‰¿ ClassLoaderæŠ½è±¡ç±»ã€‚\nClassLoader ç±»æœ‰ä¸¤ä¸ªå…³é”®çš„æ–¹æ³•ï¼š\nprotected Class loadClass(String name, boolean resolve)ï¼šåŠ è½½æŒ‡å®šäºŒè¿›åˆ¶åç§°çš„ç±»**ï¼Œå®ç°äº†åŒäº²å§”æ´¾æœºåˆ¶** ã€‚name ä¸ºç±»çš„äºŒè¿›åˆ¶åç§°ï¼Œresove å¦‚æœä¸º trueï¼Œåœ¨åŠ è½½æ—¶è°ƒç”¨ resolveClass(Class\u0026lt;?\u0026gt; c) æ–¹æ³•è§£æè¯¥ç±»ã€‚ protected Class findClass(String name)ï¼šæ ¹æ®ç±»çš„äºŒè¿›åˆ¶åç§°æ¥æŸ¥æ‰¾ç±»ï¼Œé»˜è®¤å®ç°æ˜¯ç©ºæ–¹æ³•ã€‚ å®˜æ–¹ API æ–‡æ¡£ä¸­å†™åˆ°ï¼š\nSubclasses of ClassLoader are encouraged to override findClass(String name), rather than this method.\nå»ºè®® ClassLoaderçš„å­ç±»é‡å†™ findClass(String name)æ–¹æ³•è€Œä¸æ˜¯loadClass(String name, boolean resolve) æ–¹æ³•ã€‚\nå¦‚æœæˆ‘ä»¬ä¸æƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹ï¼Œå°±é‡å†™ ClassLoader ç±»ä¸­çš„ findClass() æ–¹æ³•å³å¯ï¼Œæ— æ³•è¢«çˆ¶ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æœ€ç»ˆä¼šé€šè¿‡è¿™ä¸ªæ–¹æ³•è¢«åŠ è½½ã€‚ä½†æ˜¯ï¼Œå¦‚æœæƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹åˆ™éœ€è¦é‡å†™ loadClass() æ–¹æ³•ã€‚\nåŒäº²å§”æ´¾æ¨¡å‹ # åŒäº²å§”æ´¾æ¨¡å‹ä»‹ç» # ç±»åŠ è½½å™¨æœ‰å¾ˆå¤šç§ï¼Œå½“æˆ‘ä»¬æƒ³è¦åŠ è½½ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå…·ä½“æ˜¯å“ªä¸ªç±»åŠ è½½å™¨åŠ è½½å‘¢ï¼Ÿè¿™å°±éœ€è¦æåˆ°åŒäº²å§”æ´¾æ¨¡å‹äº†ã€‚\næ ¹æ®å®˜ç½‘ä»‹ç»ï¼š\nThe ClassLoader class uses a delegation model to search for classes and resources. Each instance of ClassLoader has an associated parent class loader. When requested to find a class or resource, a ClassLoader instance will delegate the search for the class or resource to its parent class loader before attempting to find the class or resource itself. The virtual machine\u0026rsquo;s built-in class loader, called the \u0026ldquo;bootstrap class loader\u0026rdquo;, does not itself have a parent but may serve as the parent of a ClassLoader instance.\nç¿»è¯‘è¿‡æ¥å¤§æ¦‚çš„æ„æ€æ˜¯ï¼š\nClassLoader ç±»ä½¿ç”¨å§”æ‰˜æ¨¡å‹æ¥æœç´¢ç±»å’Œèµ„æºã€‚æ¯ä¸ª ClassLoader å®ä¾‹éƒ½æœ‰ä¸€ä¸ªç›¸å…³çš„çˆ¶ç±»åŠ è½½å™¨ã€‚éœ€è¦æŸ¥æ‰¾ç±»æˆ–èµ„æºæ—¶ï¼ŒClassLoader å®ä¾‹ä¼šåœ¨è¯•å›¾äº²è‡ªæŸ¥æ‰¾ç±»æˆ–èµ„æºä¹‹å‰ï¼Œå°†æœç´¢ç±»æˆ–èµ„æºçš„ä»»åŠ¡å§”æ‰˜ç»™å…¶çˆ¶ç±»åŠ è½½å™¨ã€‚ è™šæ‹Ÿæœºä¸­è¢«ç§°ä¸º \u0026ldquo;bootstrap class loader\u0026quot;çš„å†…ç½®ç±»åŠ è½½å™¨æœ¬èº«æ²¡æœ‰çˆ¶ç±»åŠ è½½å™¨ï¼Œä½†æ˜¯å¯ä»¥ä½œä¸º ClassLoader å®ä¾‹çš„çˆ¶ç±»åŠ è½½å™¨ã€‚\nä»ä¸Šé¢çš„ä»‹ç»å¯ä»¥çœ‹å‡ºï¼š\nClassLoader ç±»ä½¿ç”¨å§”æ‰˜æ¨¡å‹æ¥æœç´¢ç±»å’Œèµ„æºã€‚ åŒäº²å§”æ´¾æ¨¡å‹è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ã€‚ ClassLoader å®ä¾‹ä¼šåœ¨è¯•å›¾äº²è‡ªæŸ¥æ‰¾ç±»æˆ–èµ„æºä¹‹å‰ï¼Œå°†æœç´¢ç±»æˆ–èµ„æºçš„ä»»åŠ¡å§”æ‰˜ç»™å…¶çˆ¶ç±»åŠ è½½å™¨ã€‚ ä¸‹å›¾å±•ç¤ºçš„å„ç§ç±»åŠ è½½å™¨ä¹‹é—´çš„å±‚æ¬¡å…³ç³»è¢«ç§°ä¸ºç±»åŠ è½½å™¨çš„â€œåŒäº²å§”æ´¾æ¨¡å‹(Parents Delegation Model)â€ã€‚\næ³¨æ„âš ï¸ï¼šåŒäº²å§”æ´¾æ¨¡å‹å¹¶ä¸æ˜¯ä¸€ç§å¼ºåˆ¶æ€§çš„çº¦æŸï¼Œåªæ˜¯ JDK å®˜æ–¹æ¨èçš„ä¸€ç§æ–¹å¼ã€‚å¦‚æœæˆ‘ä»¬å› ä¸ºæŸäº›ç‰¹æ®Šéœ€æ±‚æƒ³è¦æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåæ–‡ä¼šä»‹ç»å…·ä½“çš„æ–¹æ³•ã€‚\nå…¶å®è¿™ä¸ªåŒäº²ç¿»è¯‘çš„å®¹æ˜“è®©åˆ«äººè¯¯è§£ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç†è§£çš„åŒäº²éƒ½æ˜¯çˆ¶æ¯ï¼Œè¿™é‡Œçš„åŒäº²æ›´å¤šåœ°è¡¨è¾¾çš„æ˜¯â€œçˆ¶æ¯è¿™ä¸€è¾ˆâ€çš„äººè€Œå·²ï¼Œå¹¶ä¸æ˜¯è¯´çœŸçš„æœ‰ä¸€ä¸ª MotherClassLoader å’Œä¸€ä¸ªFatherClassLoader ã€‚ä¸ªäººè§‰å¾—ç¿»è¯‘æˆå•äº²å§”æ´¾æ¨¡å‹æ›´å¥½ä¸€äº›ï¼Œä¸è¿‡ï¼Œå›½å†…æ—¢ç„¶ç¿»è¯‘æˆäº†åŒäº²å§”æ´¾æ¨¡å‹å¹¶æµä¼ äº†ï¼ŒæŒ‰ç…§è¿™ä¸ªæ¥ä¹Ÿæ²¡é—®é¢˜ï¼Œä¸è¦è¢«è¯¯è§£äº†å°±å¥½ã€‚\nå¦å¤–ï¼Œç±»åŠ è½½å™¨ä¹‹é—´çš„çˆ¶å­å…³ç³»ä¸€èˆ¬ä¸æ˜¯ä»¥ç»§æ‰¿çš„å…³ç³»æ¥å®ç°çš„ï¼Œè€Œæ˜¯é€šå¸¸ä½¿ç”¨ç»„åˆå…³ç³»æ¥å¤ç”¨çˆ¶åŠ è½½å™¨çš„ä»£ç ã€‚\npublic abstract class ClassLoader { ... // ç»„åˆ private final ClassLoader parent; protected ClassLoader(ClassLoader parent) { this(checkCreateClassLoader(), parent); } ... } åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œæœ‰ä¸€æ¡éå¸¸ç»å…¸çš„è®¾è®¡åŸåˆ™ï¼š ç»„åˆä¼˜äºç»§æ‰¿ï¼Œå¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿ã€‚\nåŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹ # åŒäº²å§”æ´¾æ¨¡å‹çš„å®ç°ä»£ç éå¸¸ç®€å•ï¼Œé€»è¾‘éå¸¸æ¸…æ™°ï¼Œéƒ½é›†ä¸­åœ¨ java.lang.ClassLoader çš„ loadClass() ä¸­ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚\nprivate final ClassLoader parent; protected Class\u0026lt;?\u0026gt; loadClass(String name, boolean resolve) throws ClassNotFoundException { synchronized (getClassLoadingLock(name)) { // é¦–å…ˆï¼Œæ£€æŸ¥è¯·æ±‚çš„ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡ Class\u0026lt;?\u0026gt; c = findLoadedClass(name); if (c == null) { //å¦‚æœ c ä¸º nullï¼Œåˆ™è¯´æ˜è¯¥ç±»æ²¡æœ‰è¢«åŠ è½½è¿‡ long t0 = System.nanoTime(); try { if (parent != null) {//çˆ¶åŠ è½½å™¨ä¸ä¸ºç©ºï¼Œè°ƒç”¨çˆ¶åŠ è½½å™¨loadClass()æ–¹æ³•å¤„ç† //æ³¨æ„ï¼Œè¿™é‡Œæ˜¯ä¸€å±‚å±‚æŠ›ä¸Šå»ï¼Œæœ‰ç‚¹ç±»ä¼¼æŠŠæ–¹æ³•æ”¾è¿›æ ˆï¼Œç„¶åå¦‚æœBootstrapClassLoaderåŠ è½½ä¸äº†ï¼Œå°±ä¼šæŠ›å¼‚å¸¸ï¼Œç”±è‡ªå·±åŠ è½½ï¼ˆå¦‚æœè‡ªå·±åŠ è½½ä¸äº†ï¼Œè¿˜æ˜¯ä¼šæŠ›å¼‚å¸¸ï¼Œç„¶åå†æ¬¡åŠ è½½æƒå›åˆ°å­ç±»ï¼‰ c = parent.loadClass(name, false); } else {//çˆ¶åŠ è½½å™¨ä¸ºç©ºï¼Œä½¿ç”¨å¯åŠ¨ç±»åŠ è½½å™¨ BootstrapClassLoader åŠ è½½ c = findBootstrapClassOrNull(name); } } catch (ClassNotFoundException e) { //æŠ›å‡ºå¼‚å¸¸è¯´æ˜çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®ŒæˆåŠ è½½è¯·æ±‚ } if (c == null) { //å½“çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½æ—¶ï¼Œåˆ™è°ƒç”¨findClassæ–¹æ³•æ¥åŠ è½½è¯¥ç±» //ç”¨æˆ·å¯é€šè¿‡è¦†å†™è¯¥æ–¹æ³•ï¼Œæ¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨ long t1 = System.nanoTime(); //è‡ªå·±å°è¯•åŠ è½½ c = findClass(name); //ç”¨äºç»Ÿè®¡ç±»åŠ è½½å™¨ç›¸å…³çš„ä¿¡æ¯ // this is the defining class loader; record the stats sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0); sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1); sun.misc.PerfCounter.getFindClasses().increment(); } } if (resolve) { //å¯¹ç±»è¿›è¡Œlinkæ“ä½œ resolveClass(c); } return c; } } æ¯å½“ä¸€ä¸ªç±»åŠ è½½å™¨æ¥æ”¶åˆ°åŠ è½½è¯·æ±‚æ—¶ï¼Œå®ƒä¼šå…ˆå°†è¯·æ±‚è½¬å‘ç»™çˆ¶ç±»åŠ è½½å™¨ã€‚åœ¨çˆ¶ç±»åŠ è½½å™¨æ²¡æœ‰æ‰¾åˆ°æ‰€è¯·æ±‚çš„ç±»çš„æƒ…å†µä¸‹ï¼Œè¯¥ç±»åŠ è½½å™¨æ‰ä¼šå°è¯•å»åŠ è½½ã€‚\nç»“åˆä¸Šé¢çš„æºç ï¼Œç®€å•æ€»ç»“ä¸€ä¸‹åŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹ï¼š\nåœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šé¦–å…ˆåˆ¤æ–­å½“å‰ç±»æ˜¯å¦è¢«åŠ è½½è¿‡ã€‚å·²ç»è¢«åŠ è½½çš„ç±»ä¼šç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰ä¼šå°è¯•åŠ è½½ï¼ˆæ¯ä¸ªçˆ¶ç±»åŠ è½½å™¨éƒ½ä¼šèµ°ä¸€éè¿™ä¸ªæµç¨‹ï¼‰ã€‚ ç±»åŠ è½½å™¨åœ¨è¿›è¡Œç±»åŠ è½½çš„æ—¶å€™ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼ˆè°ƒç”¨çˆ¶åŠ è½½å™¨ loadClass()æ–¹æ³•æ¥åŠ è½½ç±»ï¼‰ã€‚è¿™æ ·çš„è¯ï¼Œæ‰€æœ‰çš„è¯·æ±‚æœ€ç»ˆéƒ½ä¼šä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ BootstrapClassLoader ä¸­ã€‚ åªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚ï¼ˆå®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼‰æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ï¼ˆè°ƒç”¨è‡ªå·±çš„ findClass() æ–¹æ³•æ¥åŠ è½½ç±»ï¼‰ã€‚ ğŸŒˆ æ‹“å±•ä¸€ä¸‹ï¼š\nJVM åˆ¤å®šä¸¤ä¸ª Java ç±»æ˜¯å¦ç›¸åŒçš„å…·ä½“è§„åˆ™ ï¼šJVM ä¸ä»…è¦çœ‹ç±»çš„å…¨åæ˜¯å¦ç›¸åŒï¼Œè¿˜è¦çœ‹åŠ è½½æ­¤ç±»çš„ç±»åŠ è½½å™¨æ˜¯å¦ä¸€æ ·ã€‚åªæœ‰ä¸¤è€…éƒ½ç›¸åŒçš„æƒ…å†µï¼Œæ‰è®¤ä¸ºä¸¤ä¸ªç±»æ˜¯ç›¸åŒçš„ã€‚å³ä½¿ä¸¤ä¸ªç±»æ¥æºäºåŒä¸€ä¸ª Class æ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªè™šæ‹ŸæœºåŠ è½½ï¼Œåªè¦åŠ è½½å®ƒä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œé‚£è¿™ä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸åŒã€‚\nåŒäº²å§”æ´¾æ¨¡å‹çš„å¥½å¤„ # åŒäº²å§”æ´¾æ¨¡å‹ä¿è¯äº† Java ç¨‹åºçš„ç¨³å®šè¿è¡Œï¼Œå¯ä»¥é¿å…ç±»çš„é‡å¤åŠ è½½ï¼ˆJVM åŒºåˆ†ä¸åŒç±»çš„æ–¹å¼ä¸ä»…ä»…æ ¹æ®ç±»åï¼Œç›¸åŒçš„ç±»æ–‡ä»¶è¢«ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½äº§ç”Ÿçš„æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»ï¼‰ï¼Œä¹Ÿä¿è¯äº† Java çš„æ ¸å¿ƒ API ä¸è¢«ç¯¡æ”¹ã€‚\nå¦‚æœæ²¡æœ‰ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹ï¼Œè€Œæ˜¯æ¯ä¸ªç±»åŠ è½½å™¨åŠ è½½è‡ªå·±çš„è¯å°±ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç§°ä¸º java.lang.Object ç±»çš„è¯ï¼Œé‚£ä¹ˆç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œç³»ç»Ÿå°±ä¼šå‡ºç°ä¸¤ä¸ªä¸åŒçš„ Object ç±»ã€‚åŒäº²å§”æ´¾æ¨¡å‹å¯ä»¥ä¿è¯åŠ è½½çš„æ˜¯ JRE é‡Œçš„é‚£ä¸ª Object ç±»ï¼Œè€Œä¸æ˜¯ä½ å†™çš„ Object ç±»ã€‚è¿™æ˜¯å› ä¸º AppClassLoader åœ¨åŠ è½½ä½ çš„ Object ç±»æ—¶ï¼Œä¼šå§”æ‰˜ç»™ ExtClassLoader å»åŠ è½½ï¼Œè€Œ ExtClassLoader åˆä¼šå§”æ‰˜ç»™ BootstrapClassLoaderï¼ŒBootstrapClassLoader å‘ç°è‡ªå·±å·²ç»åŠ è½½è¿‡äº† Object ç±»ï¼Œä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå»åŠ è½½ä½ å†™çš„ Object ç±»ã€‚\næ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹æ–¹æ³• # ä¸ºäº†é¿å…åŒäº²å§”æ‰˜æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œç„¶åé‡å†™ loadClass() å³å¯ã€‚\nğŸ› ä¿®æ­£ï¼ˆå‚è§ï¼šissue871 ï¼‰ ï¼šè‡ªå®šä¹‰åŠ è½½å™¨çš„è¯ï¼Œéœ€è¦ç»§æ‰¿ ClassLoader ã€‚å¦‚æœæˆ‘ä»¬ä¸æƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹ï¼Œå°±é‡å†™ ClassLoader ç±»ä¸­çš„ findClass() æ–¹æ³•å³å¯ï¼Œæ— æ³•è¢«çˆ¶ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æœ€ç»ˆä¼šé€šè¿‡è¿™ä¸ªæ–¹æ³•è¢«åŠ è½½ã€‚ä½†æ˜¯ï¼Œå¦‚æœæƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹åˆ™éœ€è¦é‡å†™ loadClass() æ–¹æ³•ã€‚\nä¸ºä»€ä¹ˆæ˜¯é‡å†™ loadClass() æ–¹æ³•æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹å‘¢ï¼ŸåŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹å·²ç»è§£é‡Šäº†ï¼š\nç±»åŠ è½½å™¨åœ¨è¿›è¡Œç±»åŠ è½½çš„æ—¶å€™ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼ˆè°ƒç”¨çˆ¶åŠ è½½å™¨ loadClass()æ–¹æ³•æ¥åŠ è½½ç±»ï¼‰ã€‚\næˆ‘ä»¬æ¯”è¾ƒç†Ÿæ‚‰çš„ Tomcat æœåŠ¡å™¨ä¸ºäº†èƒ½å¤Ÿä¼˜å…ˆåŠ è½½ Web åº”ç”¨ç›®å½•ä¸‹çš„ç±»ï¼Œç„¶åå†åŠ è½½å…¶ä»–ç›®å½•ä¸‹çš„ç±»ï¼Œå°±è‡ªå®šä¹‰äº†ç±»åŠ è½½å™¨ WebAppClassLoader æ¥æ‰“ç ´åŒäº²å§”æ‰˜æœºåˆ¶ã€‚è¿™ä¹Ÿæ˜¯ Tomcat ä¸‹ Web åº”ç”¨ä¹‹é—´çš„ç±»å®ç°éš”ç¦»çš„å…·ä½“åŸç†ã€‚\nTomcat çš„ç±»åŠ è½½å™¨çš„å±‚æ¬¡ç»“æ„å¦‚ä¸‹ï¼š\næ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œç ”ç©¶ä¸€ä¸‹ Tomcat ç±»åŠ è½½å™¨çš„å±‚æ¬¡ç»“æ„ï¼Œè¿™æœ‰åŠ©äºæˆ‘ä»¬ææ‡‚ Tomcat éš”ç¦» Web åº”ç”¨çš„åŸç†ï¼Œæ¨èèµ„æ–™æ˜¯ã€Šæ·±å…¥æ‹†è§£ Tomcat \u0026amp; Jettyã€‹ã€‚\næ¨èé˜…è¯» # ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹ æ·±å…¥åˆ†æ Java ClassLoader åŸç†ï¼šhttps://blog.csdn.net/xyang81/article/details/7292380 Java ç±»åŠ è½½å™¨(ClassLoader)ï¼šhttp://gityuan.com/2016/01/24/java-classloader/ Class Loaders in Javaï¼šhttps://www.baeldung.com/java-classloaders Class ClassLoader - Oracle å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.oracle.com/javase/8/docs/api/java/lang/ClassLoader.html è€å¤§éš¾çš„ Java ClassLoader å†ä¸ç†è§£å°±è€äº†ï¼šhttps://zhuanlan.zhihu.com/p/51374915 "},{"id":123,"href":"/zh/docs/study/Review/java_guide/java/JVM/ly0404lyclassloader-process/","title":"ç±»åŠ è½½è¿‡ç¨‹","section":"JavaåŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nç±»çš„å£°æ˜å‘¨æœŸ # ç±»åŠ è½½è¿‡ç¨‹ # Classæ–‡ä»¶ï¼Œéœ€è¦åŠ è½½åˆ°è™šæ‹Ÿæœºä¸­ä¹‹åæ‰èƒ½è¿è¡Œå’Œä½¿ç”¨ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºæ˜¯å¦‚ä½•åŠ è½½è¿™äº›Classæ–‡ä»¶å‘¢ ç³»ç»ŸåŠ è½½Classç±»æ–‡ä»¶éœ€è¦ä¸‰æ­¥ï¼šåŠ è½½-\u0026gt;è¿æ¥-\u0026gt;åˆå§‹åŒ–ã€‚è¿æ¥è¿‡ç¨‹åˆåˆ†ä¸ºä¸‰æ­¥ï¼šéªŒè¯-\u0026gt;å‡†å¤‡-\u0026gt;è§£æ\nåŠ è½½ # ç±»åŠ è½½çš„ç¬¬ä¸€æ­¥ï¼Œä¸»è¦å®Œæˆ3ä»¶äº‹æƒ…\næ„é€ ä¸ç±»ç›¸å…³è”çš„æ–¹æ³•è¡¨\né€šè¿‡å…¨ç±»åè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ï¼Œè½¬æ¢ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªè¯¥ç±»çš„Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™äº›æ•°æ®çš„è®¿é—®å…¥å£ è™šæ‹Ÿæœºè§„èŒƒå¯¹ä¸Šé¢3ç‚¹ä¸å…·ä½“ï¼Œæ¯”è¾ƒçµæ´»\nå¯¹äº1 æ²¡æœ‰å…·ä½“æŒ‡æ˜ä»å“ªé‡Œè·å–ã€æ€æ ·è·å–ã€‚å¯ä»¥ä»ZIPåŒ…è¯»å– ï¼ˆJAR/EAR/WARæ ¼å¼çš„åŸºç¡€ï¼‰ã€å…¶ä»–æ–‡ä»¶ç”Ÿæˆï¼ˆJSPï¼‰ç­‰ éæ•°ç»„ç±»çš„åŠ è½½é˜¶æ®µï¼ˆåŠ è½½é˜¶æ®µè·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµçš„åŠ¨ä½œï¼‰æ˜¯å¯æ§æ€§æœ€å¼ºçš„é˜¶æ®µï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬å¯ä»¥å»å®Œæˆè¿˜å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨å»æ§åˆ¶å­—èŠ‚æµçš„è·å–æ–¹å¼ï¼ˆé‡å†™ä¸€ä¸ªç±»åŠ è½½å™¨çš„**loadClass()**æ–¹æ³• æ•°ç»„ç±»å‹ä¸é€šè¿‡ç±»åŠ è½½å™¨åˆ›å»ºï¼Œå®ƒç”±Javaè™šæ‹Ÿæœºç›´æ¥åˆ›å»º åŠ è½½é˜¶æ®µå’Œè¿æ¥é˜¶æ®µçš„éƒ¨åˆ†å†…å®¹æ˜¯äº¤å‰æ‰§è¡Œçš„ï¼Œå³åŠ è½½é˜¶æ®µå°šæœªç»“æŸï¼Œè¿æ¥é˜¶æ®µå°±å¯èƒ½å·²ç»å¼€å§‹äº†\néªŒè¯ # éªŒè¯æ˜¯è¿æ¥é˜¶æ®µçš„ç¬¬ä¸€æ­¥ï¼Œè¿™ä¸€é˜¶æ®µçš„ç›®çš„æ˜¯ç¡®ä¿ Class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹çš„å…¨éƒ¨çº¦æŸè¦æ±‚ï¼Œä¿è¯è¿™äº›ä¿¡æ¯è¢«å½“ä½œä»£ç è¿è¡Œåä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚\néªŒè¯é˜¶æ®µä¸»è¦ç”±å››ä¸ªæ£€éªŒé˜¶æ®µç»„æˆï¼š\næ–‡ä»¶æ ¼å¼éªŒè¯ï¼ˆClass æ–‡ä»¶æ ¼å¼æ£€æŸ¥ï¼‰ å…ƒæ•°æ®éªŒè¯ï¼ˆå­—èŠ‚ç è¯­ä¹‰æ£€æŸ¥ï¼‰ å­—èŠ‚ç éªŒè¯ï¼ˆç¨‹åºè¯­ä¹‰æ£€æŸ¥ï¼‰ ç¬¦å·å¼•ç”¨éªŒè¯ï¼ˆç±»çš„æ­£ç¡®æ€§æ£€æŸ¥ï¼‰ å‡†å¤‡ # å‡†å¤‡é˜¶æ®µæ˜¯æ­£å¼ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼çš„é˜¶æ®µï¼Œè¿™äº›å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­åˆ†é…ï¼Œæ³¨æ„ï¼š\nè¿™æ—¶å€™è¿›è¡Œå†…å­˜åˆ†é…çš„ä»…åŒ…æ‹¬ç±»å˜é‡ï¼ˆClassVariablesï¼Œå³é™æ€å˜é‡ï¼šè¢«staticå…³é”®å­—ä¿®é¥°çš„å˜é‡ï¼Œåªä¸ç±»ç›¸å…³ï¼Œå› æ­¤è¢«ç§°ä¸ºç±»å˜é‡ï¼‰ï¼Œè€Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ã€‚\nå®ä¾‹å˜é‡ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶ï¼Œéšç€å¯¹è±¡ä¸€å—åˆ†é…åˆ°Javaå †ä¸­\nä»æ¦‚å¿µä¸Šè®²ï¼Œç±»å˜é‡æ‰€ä½¿ç”¨çš„å†…å­˜éƒ½åº”å½“åœ¨ æ–¹æ³•åŒº ä¸­è¿›è¡Œåˆ†é…ã€‚ä¸è¿‡æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼šJDK 7 ä¹‹å‰ï¼ŒHotSpot ä½¿ç”¨æ°¸ä¹…ä»£æ¥å®ç°æ–¹æ³•åŒºçš„æ—¶å€™ï¼Œå®ç°æ˜¯å®Œå…¨ç¬¦åˆè¿™ç§é€»è¾‘æ¦‚å¿µçš„ã€‚ è€Œåœ¨ JDK 7 åŠä¹‹åï¼ŒHotSpot å·²ç»æŠŠåŸæœ¬æ”¾åœ¨æ°¸ä¹…ä»£çš„å­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡ç­‰ç§»åŠ¨åˆ°å †ä¸­ï¼Œè¿™ä¸ªæ—¶å€™ç±»å˜é‡åˆ™ä¼šéšç€ **Class å¯¹è±¡ï¼ˆä¸Šé¢æœ‰æåˆ°ï¼Œå†…å­˜åŒºç”ŸæˆClasså¯¹è±¡ï¼‰**ä¸€èµ·å­˜æ”¾åœ¨ Java å †ä¸­\nè¿™é‡Œæ‰€è®¾ç½®çš„åˆå§‹å€¼**\u0026ldquo;é€šå¸¸æƒ…å†µ\u0026rdquo;ä¸‹æ˜¯æ•°æ®ç±»å‹é»˜è®¤çš„é›¶å€¼ï¼ˆå¦‚ 0ã€0Lã€nullã€false ç­‰**ï¼‰ï¼Œæ¯”å¦‚æˆ‘ä»¬å®šä¹‰äº†**public static int value=111** ï¼Œé‚£ä¹ˆ value å˜é‡åœ¨å‡†å¤‡é˜¶æ®µçš„åˆå§‹å€¼å°±æ˜¯ 0 è€Œä¸æ˜¯ 111ï¼ˆåˆå§‹åŒ–é˜¶æ®µæ‰ä¼šèµ‹å€¼ï¼‰ã€‚ç‰¹æ®Šæƒ…å†µï¼šæ¯”å¦‚ç»™ value å˜é‡åŠ ä¸Šäº† final å…³é”®å­—public static final int value=111 ï¼Œé‚£ä¹ˆå‡†å¤‡é˜¶æ®µ value çš„å€¼å°±è¢«èµ‹å€¼ä¸º 111\nåŸºæœ¬æ•°æ®ç±»å‹çš„é›¶å€¼ è§£æ # è§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹\nè§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨é™å®šç¬¦7ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œ\nç¬¦å·å¼•ç”¨å°±æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°ç›®æ ‡ï¼Œå¯ä»¥æ˜¯ä»»ä½•å­—é¢é‡ã€‚ç›´æ¥å¼•ç”¨å°±æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–ä¸€ä¸ªé—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„\nç¨‹åºå®é™…è¿è¡Œæ—¶ï¼Œåªæœ‰ç¬¦å·å¼•ç”¨æ˜¯ä¸å¤Ÿçš„ã€‚ åœ¨ç¨‹åºæ‰§è¡Œæ–¹æ³•æ—¶ï¼Œç³»ç»Ÿéœ€è¦æ˜ç¡®çŸ¥é“è¿™ä¸ªæ–¹æ³•æ‰€åœ¨çš„ä½ç½® Javaè™šæ‹Ÿæœºä¸ºæ¯ä¸ªç±»éƒ½å‡†å¤‡äº†ä¸€å¼ æ–¹æ³•è¡¨æ¥å­˜æ”¾ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•ã€‚å½“éœ€è¦è°ƒç”¨ä¸€ä¸ªç±»çš„æ–¹æ³•çš„æ—¶å€™ï¼Œåªè¦çŸ¥é“è¿™ä¸ªæ–¹æ³•åœ¨æ–¹æ³•è¡¨ä¸­çš„åç§»é‡å°±å¯ä»¥ç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•äº†ï¼ˆé’ˆå¯¹å…¶ä»–ç±»Xæˆ–è€…å½“å‰ç±»çš„æ–¹æ³•ï¼‰\né€šè¿‡è§£ææ“ä½œç¬¦å·å¼•ç”¨å°±å¯ä»¥ç›´æ¥è½¬å˜ä¸ºç›®æ ‡æ–¹æ³•åœ¨ç±»ä¸­æ–¹æ³•è¡¨çš„ä½ç½®ï¼Œä»è€Œä½¿å¾—æ–¹æ³•å¯ä»¥è¢«è°ƒç”¨ã€‚ï¼ˆå°†å½“å‰ç±»ä¸­ä»£ç è½¬ä¸º ä¸Šé¢è¯´çš„ç±»çš„åç§»é‡ï¼‰\nå¯¹ä¸‹é¢çš„å†…å®¹ç®€åŒ–ä¸€ä¸‹å°±æ˜¯ï¼Œç¼–è¯‘åçš„classæ–‡ä»¶ä¸­ï¼Œä»¥ [ç±»æ•°ç»„] çš„æ–¹å¼ï¼Œä¿å­˜äº†ç±»ä¸­çš„æ–¹æ³•è¡¨çš„ä½ç½®ï¼ˆåç§»é‡ï¼‰ï¼ˆé€šè¿‡å¾—åˆ°æ¯ä¸ªæ•°ç»„å…ƒç´ å¯ä»¥å¾—åˆ°æ–¹æ³•çš„ä¿¡æ¯ï¼‰ã€‚è€Œè¿™é‡Œæˆ‘ä»¬åªèƒ½çŸ¥é“åç§»é‡ï¼Œä½†æ˜¯å½“æ­£å¼åŠ è½½åˆ°æ–¹æ³•åŒºä¹‹åï¼Œæˆ‘ä»¬å°±èƒ½æ ¹æ®åç§»é‡ï¼Œè®¡ç®—å‡ºå…·ä½“çš„ [å†…å­˜åœ°å€] äº†ã€‚\nå…·ä½“è¯¦æƒ…https://blog.csdn.net/luanlouis/article/details/41113695 ï¼Œè¿™é‡Œæ¶‰åŠåˆ°å‡ ä¸ªæ¦‚å¿µï¼Œä¸€ä¸ªæ˜¯æ–¹æ³•è¡¨ã€‚é€šè¿‡ javap -v xxxæŸ¥çœ‹åç¼–è¯‘çš„ä¿¡æ¯ï¼ˆclassæ–‡ä»¶çš„ä¿¡æ¯ï¼‰\nclassæ–‡ä»¶æ˜¯è¿™æ ·çš„ç»“æ„ï¼Œé‡Œé¢æœ‰ä¸ªæ–¹æ³•è¡¨çš„æ¦‚å¿µ\nå¦‚ä¸‹ï¼Œå¯èƒ½ä¼šæœ‰å¥½å‡ ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥æ–¹æ³•è¡¨ï¼Œå…¶å®æ˜¯ä¸€ä¸ªç±»æ•°ç»„ç»“æ„ï¼Œè€Œæ¯ä¸ªæ–¹æ³•ä¿¡æ¯ï¼ˆmethod_infoï¼‰å‘¢ï¼Œ\nè¿›ä¸€æ­¥ï¼Œå¯¹äºæ¯ä¸ªmethod_infoç»“æ„ä½“çš„å®šä¹‰\næ–¹æ³•è¡¨çš„ç»“æ„ä½“ç”±ï¼šè®¿é—®æ ‡å¿—(*access_flags*)ã€åç§°ç´¢å¼•(*name_index*)ã€æè¿°ç´¢å¼•(*descriptor_index*)ã€å±æ€§è¡¨(*attribute_info*)é›†åˆç»„æˆã€‚\nè€Œå¯¹äºå±æ€§è¡¨ï¼Œï¼ˆå…¶ä¸­ï¼šå±æ€§è¡¨é›†åˆ\u0026ndash;ç”¨æ¥è®°å½•æ–¹æ³•çš„æœºå™¨æŒ‡ä»¤å’ŒæŠ›å‡ºå¼‚å¸¸ç­‰ä¿¡æ¯ï¼‰\nJavaä¹‹æ‰€ä»¥èƒ½å¤Ÿè¿è¡Œï¼Œå°±æ˜¯ä»Codeå±æ€§ä¸­ï¼Œå–å‡ºçš„æœºå™¨ç \nè§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯å¾—åˆ°ç±»æˆ–è€…å­—æ®µã€æ–¹æ³•åœ¨å†…å­˜ä¸­çš„æŒ‡é’ˆæˆ–è€…åç§»é‡ã€‚ï¼ˆå› ä¸ºæ­¤æ—¶é‚£äº›classæ–‡ä»¶å·²ç»æ—©å°±åŠ è½½åˆ°æ–¹æ³•åŒºä¹‹ä¸­äº†ï¼Œæ‰€ä»¥å¯ä»¥æ”¹æˆæŒ‡å‘æ–¹æ³•åŒºçš„æŸä¸ªå†…å­˜åœ°å€\nå¦‚ä¸‹ï¼Œæˆ‘çš„ç†è§£æ˜¯ï¼ŒæŠŠä¸‹é¢çš„ com/test/Student.a ()V ä¿®æ”¹æˆäº†ç›´æ¥çš„å†…å­˜åœ°å€ ç±»ä¼¼çš„æ„æ€\nåˆå§‹åŒ– # åˆå§‹åŒ–é˜¶æ®µï¼Œæ˜¯æ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•clinit()æ–¹æ³•çš„è¿‡ç¨‹ï¼Œæ˜¯ç±»åŠ è½½çš„æœ€åä¸€æ­¥ï¼Œè¿™ä¸€æ­¥JVMæ‰å¼€å§‹çœŸæ­£æ‰§è¡Œç±»ä¸­å®šä¹‰çš„Javaç¨‹åºä»£ç ï¼ˆå­—èŠ‚ç ï¼‰\nclinit()æ–¹æ³•æ˜¯ç¼–è¯‘ä¹‹åè‡ªåŠ¨ç”Ÿæˆçš„\nå¯¹äºclinit () æ–¹æ³•çš„è°ƒç”¨ï¼Œè™šæ‹Ÿæœºä¼šè‡ªå·±ç¡®ä¿å…¶åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„å®‰å…¨æ€§ã€‚å› ä¸º clinit () æ–¹æ³•æ˜¯å¸¦é”çº¿ç¨‹å®‰å…¨ï¼Œæ‰€ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è¿›è¡Œç±»åˆå§‹åŒ–çš„è¯å¯èƒ½ä¼šå¼•èµ·å¤šä¸ªçº¿ç¨‹é˜»å¡ï¼Œå¹¶ä¸”è¿™ç§é˜»å¡å¾ˆéš¾è¢«å‘ç°ã€‚\nå¯¹äºåˆå§‹åŒ–é˜¶æ®µï¼Œè™šæ‹Ÿæœºä¸¥æ ¼è§„èŒƒäº†æœ‰ä¸”åªæœ‰ 5 ç§æƒ…å†µä¸‹ï¼Œå¿…é¡»å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–(åªæœ‰ä¸»åŠ¨å»ä½¿ç”¨ç±»æ‰ä¼šåˆå§‹åŒ–ç±»)ï¼š\nå½“é‡åˆ° new ã€ getstaticã€putstatic æˆ– invokestatic è¿™ 4 æ¡ç›´æ¥ç æŒ‡ä»¤æ—¶ï¼Œæ¯”å¦‚ new ä¸€ä¸ªç±»ï¼Œè¯»å–ä¸€ä¸ªé™æ€å­—æ®µ(æœªè¢« final ä¿®é¥°)ã€æˆ–è°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•æ—¶ã€‚\nå½“ jvm æ‰§è¡Œ new æŒ‡ä»¤æ—¶ä¼šåˆå§‹åŒ–ç±»ã€‚å³å½“ç¨‹åºåˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹å¯¹è±¡ã€‚ å½“ jvm æ‰§è¡Œ getstatic æŒ‡ä»¤æ—¶ä¼šåˆå§‹åŒ–ç±»ã€‚å³ç¨‹åºè®¿é—®ç±»çš„é™æ€å˜é‡(ä¸æ˜¯é™æ€å¸¸é‡ï¼Œå¸¸é‡ä¼šè¢«åŠ è½½åˆ°è¿è¡Œæ—¶å¸¸é‡æ± )ã€‚ å½“ jvm æ‰§è¡Œ putstatic æŒ‡ä»¤æ—¶ä¼šåˆå§‹åŒ–ç±»ã€‚å³ç¨‹åºç»™ç±»çš„é™æ€å˜é‡èµ‹å€¼ã€‚ å½“ jvm æ‰§è¡Œ invokestatic æŒ‡ä»¤æ—¶ä¼šåˆå§‹åŒ–ç±»ã€‚å³ç¨‹åºè°ƒç”¨ç±»çš„é™æ€æ–¹æ³•ã€‚ ä½¿ç”¨ java.lang.reflect åŒ…çš„æ–¹æ³•å¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨æ—¶å¦‚ Class.forname(\u0026quot;...\u0026quot;), newInstance() ç­‰ç­‰ã€‚å¦‚æœç±»æ²¡åˆå§‹åŒ–ï¼Œéœ€è¦è§¦å‘å…¶åˆå§‹åŒ–ã€‚\nåˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œå¦‚æœå…¶çˆ¶ç±»è¿˜æœªåˆå§‹åŒ–ï¼Œåˆ™å…ˆè§¦å‘è¯¥çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚\nå½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦å®šä¹‰ä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±» (åŒ…å« main æ–¹æ³•çš„é‚£ä¸ªç±»)ï¼Œè™šæ‹Ÿæœºä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªç±»ã€‚\nMethodHandle å’Œ VarHandle å¯ä»¥çœ‹ä½œæ˜¯è½»é‡çº§çš„åå°„è°ƒç”¨æœºåˆ¶ï¼Œè€Œè¦æƒ³ä½¿ç”¨è¿™ 2 ä¸ªè°ƒç”¨ï¼Œ å°±å¿…é¡»å…ˆä½¿ç”¨ findStaticVarHandle æ¥åˆå§‹åŒ–è¦è°ƒç”¨çš„ç±»ã€‚\nã€Œè¡¥å……ï¼Œæ¥è‡ªissue745open in new windowã€ å½“ä¸€ä¸ªæ¥å£ä¸­å®šä¹‰äº† JDK8 æ–°åŠ å…¥çš„é»˜è®¤æ–¹æ³•ï¼ˆè¢« default å…³é”®å­—ä¿®é¥°çš„æ¥å£æ–¹æ³•ï¼‰æ—¶ï¼Œå¦‚æœæœ‰è¿™ä¸ªæ¥å£çš„å®ç°ç±»å‘ç”Ÿäº†åˆå§‹åŒ–ï¼Œé‚£è¯¥æ¥å£è¦åœ¨å…¶ä¹‹å‰è¢«åˆå§‹åŒ–ã€‚\nå¸è½½ # å¸è½½ç±»å³è¯¥ç±»çš„ Class å¯¹è±¡è¢« GCã€‚\nå¸è½½ç±»éœ€è¦æ»¡è¶³ 3 ä¸ªè¦æ±‚:\nè¯¥ç±»çš„æ‰€æœ‰çš„å®ä¾‹å¯¹è±¡éƒ½å·²è¢« GCï¼Œä¹Ÿå°±æ˜¯è¯´å †ä¸å­˜åœ¨è¯¥ç±»çš„å®ä¾‹å¯¹è±¡ã€‚ è¯¥ç±»æ²¡æœ‰åœ¨å…¶ä»–ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ è¯¥ç±»çš„ç±»åŠ è½½å™¨çš„å®ä¾‹å·²è¢« GC JVMçš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œç”±jvmè‡ªå¸¦çš„ç±»åŠ è½½å™¨çš„ç±»æ˜¯ä¸ä¼šè¢«å¸è½½çš„ï¼Œè€Œç”±æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æ˜¯å¯èƒ½è¢«å¸è½½çš„\nåªè¦æƒ³é€šä¸€ç‚¹å°±å¥½äº†ï¼Œjdk è‡ªå¸¦çš„ BootstrapClassLoader, ExtClassLoader, AppClassLoader è´Ÿè´£åŠ è½½ jdk æä¾›çš„ç±»ï¼Œæ‰€ä»¥å®ƒä»¬(ç±»åŠ è½½å™¨çš„å®ä¾‹)è‚¯å®šä¸ä¼šè¢«å›æ”¶ã€‚è€Œæˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨çš„å®ä¾‹æ˜¯å¯ä»¥è¢«å›æ”¶çš„ï¼Œæ‰€ä»¥ä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰åŠ è½½å™¨åŠ è½½çš„ç±»æ˜¯å¯ä»¥è¢«å¸è½½æ‰çš„ã€‚\n"},{"id":124,"href":"/zh/docs/study/Review/java_guide/java/JVM/ly0402lygarbage-collection/","title":"javaåƒåœ¾å›æ”¶","section":"JavaåŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nå‰è¨€ # å½“éœ€è¦æ’æŸ¥å„ç§å†…å­˜æº¢å‡ºé—®é¢˜ã€å½“åƒåœ¾æ”¶é›†æˆä¸ºç³»ç»Ÿè¾¾åˆ°æ›´é«˜å¹¶å‘çš„ç“¶é¢ˆæ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦å¯¹è¿™äº›**â€œè‡ªåŠ¨åŒ–â€çš„æŠ€æœ¯å®æ–½å¿…è¦çš„ç›‘æ§å’Œè°ƒèŠ‚**\nå †ç©ºé—´çš„åŸºæœ¬ç»“æ„ # Javaçš„è‡ªåŠ¨å†…å­˜ç®¡ç†ä¸»è¦æ˜¯é’ˆå¯¹å¯¹è±¡å†…å­˜çš„å›æ”¶å’Œå¯¹è±¡å†…å­˜çš„åˆ†é…ã€‚ä¸”Javaè‡ªåŠ¨å†…å­˜ç®¡ç†æœ€æ ¸å¿ƒçš„åŠŸèƒ½æ˜¯å †å†…å­˜ä¸­çš„å¯¹è±¡åˆ†é…å’Œå›æ”¶\nJavaå †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œGCå †ï¼ˆGarbage Collected Heapï¼‰\nä»åƒåœ¾å›æ”¶çš„è§’åº¦æ¥è¯´ï¼Œç”±äºç°åœ¨æ”¶é›†å™¨åŸºæœ¬éƒ½é‡‡ç”¨åˆ†ä»£åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥Javaå †è¢«åˆ’åˆ†ä¸ºäº†å‡ ä¸ªä¸åŒçš„åŒºåŸŸï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ ¹æ®å„ä¸ªåŒºåŸŸçš„ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†ç®—æ³•\nJDK7ç‰ˆæœ¬åŠJDK7ç‰ˆæœ¬ä¹‹å‰ï¼Œå †å†…å­˜è¢«é€šå¸¸åˆ†ä¸ºä¸‹é¢ä¸‰éƒ¨åˆ†ï¼š\næ–°ç”Ÿä»£å†…å­˜ï¼ˆYoung Generationï¼‰ è€ç”Ÿä»£ï¼ˆOld Generationï¼‰ æ°¸ä¹…ä»£ï¼ˆPermanent Generationï¼‰ JDK8ç‰ˆæœ¬ä¹‹åPermGenï¼ˆæ°¸ä¹…ï¼‰å·²è¢«Metaspaceï¼ˆå…ƒç©ºé—´ï¼‰å–ä»£ï¼Œä¸”å·²ç»ä¸åœ¨å †é‡Œé¢äº†ï¼Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯ç›´æ¥å†…å­˜ã€‚\nå†…å­˜åˆ†é…å’Œå›æ”¶åŸåˆ™ # å¯¹è±¡ä¼˜å…ˆåœ¨EdenåŒºåˆ†é… # å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­EdenåŒºåˆ†é…ã€‚å½“EdenåŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œä¼šè§¦å‘ä¸€æ¬¡MinorGC é¦–å…ˆï¼Œå…ˆæ·»åŠ ä¸€ä¸‹å‚æ•°æ‰“å°GCè¯¦æƒ…ï¼š-XX:+PrintGCDetails\npublic class GCTest { public static void main(String[] args) { byte[] allocation1, allocation2; allocation1 = new byte[30900*1024];//ä¼šç”¨æ‰3ä¸‡å¤šK } } è¿è¡Œåçš„ç»“æœï¼ˆè¿™é‡Œåº”è¯¥æ˜¯é…è¿‡xmså’Œxmxäº†ï¼Œå³å †å†…å­˜å¤§å°ï¼‰ å¦‚ä¸Šï¼ŒEdenåŒºå†…å­˜å‡ ä¹è¢«åˆ†é…å®Œå…¨ï¼ˆå³ä½¿ç¨‹åºä»€ä¹ˆéƒ½ä¸åšï¼Œæ–°ç”Ÿä»£ä¹Ÿä¼šä½¿ç”¨2000å¤šKï¼‰\næ³¨ï¼š PSYoungGen ä¸º 38400K ï¼Œ= 33280K + 5120K ï¼ˆSurvivoråŒºæ€»ä¼šæœ‰ä¸€ä¸ªæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥åªåŠ äº†ä¸€ä¸ª5120K ï¼‰\nå‡å¦‚æˆ‘ä»¬å†ä¸ºallocation2åˆ†é…å†…å­˜ä¼šæ€ä¹ˆæ ·(ä¸å¤„ç†çš„è¯ï¼Œå¹´è½»ä»£ä¼šæº¢å‡º)\nallocation2 = new byte[900 * 1024]; åœ¨ç»™allocation2åˆ†é…å†…å­˜ä¹‹å‰ï¼ŒEdenåŒºå†…å­˜å‡ ä¹å·²ç»è¢«åˆ†é…å®Œã€‚æ‰€ä»¥å½“EdenåŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œè™šæ‹Ÿæœºå°†å‘èµ·ä¸€æ¬¡MinorGCã€‚GCæœŸé—´è™šæ‹Ÿæœºåˆå‘ç°allocation1æ— æ³•å­˜å…¥ç©ºé—´ï¼Œæ‰€ä»¥åªå¥½é€šè¿‡åˆ†é…æ‹…ä¿æœºåˆ¶ï¼ŒæŠŠæ–°ç”Ÿä»£çš„å¯¹è±¡ï¼Œæå‰è½¬ç§»åˆ°è€å¹´ä»£å»ï¼Œè€å¹´ä»£çš„ç©ºé—´è¶³å¤Ÿå­˜æ”¾allocation1ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°Full GCï¼ˆè¿™é‡Œå¯èƒ½æ˜¯ä¹‹å‰çš„è¯´æ³•ï¼Œå¯èƒ½åªæ˜¯è¦è¡¨è¾¾è€å¹´ä»£çš„GCï¼Œè€Œä¸æ˜¯Full GC(æ•´å †GC) ï¼‰ã€€æ‰§è¡ŒMinorGCåï¼Œåé¢åˆ†é…çš„å¯¹è±¡å¦‚æœèƒ½å¤Ÿå­˜åœ¨EdenåŒºçš„è¯ï¼Œè¿˜æ˜¯ä¼šåœ¨EdenåŒºåˆ†é…å†…å­˜\næ‰§è¡Œå¦‚ä¸‹ä»£ç éªŒè¯ï¼š\npublic class GCTest { public static void main(String[] args) { byte[] allocation1, allocation2,allocation3,allocation4,allocation5; allocation1 = new byte[32000*1024]; allocation2 = new byte[1000*1024]; allocation3 = new byte[1000*1024]; allocation4 = new byte[1000*1024]; allocation5 = new byte[1000*1024]; } } å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ # å¤§å¯¹è±¡å°±æ˜¯éœ€è¦è¿ç»­ç©ºé—´çš„å¯¹è±¡ï¼ˆå­—ç¬¦ä¸²ã€æ•°ç»„ç­‰ï¼‰ å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œä¸»è¦æ˜¯ä¸ºäº†é¿å…ä¸ºå¤§å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œç”±äºåˆ†é…æ‹…ä¿æœºåˆ¶(è¿™å¥½åƒè·Ÿåˆ†é…æ‹…ä¿æœºåˆ¶æ²¡æœ‰å¤ªå¤§å…³ç³»)å¸¦æ¥çš„å¤åˆ¶è€Œé™ä½æ•ˆç‡ã€‚ å‡è®¾å¤§å¯¹è±¡æœ€åä¼šæ™‹å‡è€å¹´ä»£ï¼Œè€Œæ–°ç”Ÿä»£æ˜¯åŸºäºå¤åˆ¶ç®—æ³•æ¥å›æ”¶åƒåœ¾çš„ï¼Œç”±ä¸¤ä¸ªSurvivoråŒºåŸŸé…åˆå®Œæˆå¤åˆ¶ç®—æ³•ï¼Œå¦‚æœæ–°ç”Ÿä»£ä¸­å‡ºç°å¤§å¯¹è±¡ä¸”èƒ½å±¡æ¬¡èº²è¿‡GCï¼Œé‚£è¿™ä¸ªå¯¹è±¡å°±ä¼šåœ¨ä¸¤ä¸ªSurvivoråŒºåŸŸä¸­æ¥å›å¤åˆ¶ï¼Œç›´è‡³æœ€åå‡å…¥è€å¹´ä»£ï¼Œè€Œå¤§å¯¹è±¡åœ¨å†…å­˜é‡Œæ¥å›å¤åˆ¶ç§»åŠ¨ï¼Œå°±ä¼šæ¶ˆè€—æ›´å¤šçš„æ—¶é—´ã€‚\nå‡è®¾å¤§å¯¹è±¡æœ€åä¸ä¼šæ™‹å‡è€å¹´ä»£ï¼Œæ–°ç”Ÿä»£ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œåœ¨æ–°ç”Ÿä»£é‡Œçš„å¯¹è±¡å¤§éƒ¨åˆ†éƒ½æ˜¯æœç”Ÿå¤•æ­»çš„ï¼Œå¦‚æœè®©ä¸€ä¸ªå¤§å¯¹è±¡å æ®äº†æ–°ç”Ÿä»£ç©ºé—´ï¼Œé‚£ä¹ˆç›¸æ¯”èµ·æ­£å¸¸çš„å¯¹è±¡è¢«åˆ†é…åœ¨æ–°ç”Ÿä»£ï¼Œå¤§å¯¹è±¡æ— ç–‘ä¼šè®©æ–°ç”Ÿä»£GCææ—©å‘ç”Ÿï¼Œå› ä¸ºå†…å­˜ç©ºé—´ä¼šæ›´å¿«ä¸å¤Ÿç”¨ï¼Œå¦‚æœè¿™ä¸ªå¤§å¯¹è±¡å› ä¸ºä¸šåŠ¡åŸå› ï¼Œå¹¶ä¸ä¼šé©¬ä¸Šè¢«GCå›æ”¶ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±ä¼šè¿›å…¥åˆ°SurvivoråŒºåŸŸï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒSurvivoråŒºåŸŸæœ¬æ¥å°±ä¸ä¼šè¢«åˆ†é…çš„å¾ˆå¤§ï¼Œé‚£æ­¤æ—¶è¢«å¤§å¯¹è±¡å æ®äº†å¤§éƒ¨åˆ†ç©ºé—´ï¼Œå¾ˆå¯èƒ½ä¼šå¯¼è‡´ä¹‹åçš„æ–°ç”Ÿä»£GCåï¼Œå­˜æ´»ä¸‹æ¥çš„å¯¹è±¡ï¼ŒSurvivoråŒºåŸŸç©ºé—´ä¸å¤Ÿæ”¾ä¸ä¸‹ï¼Œå¯¼è‡´å¤§éƒ¨åˆ†å¯¹è±¡è¿›å…¥è€å¹´ä»£ï¼Œè¿™å°±åŠ å¿«äº†è€å¹´ä»£GCå‘ç”Ÿçš„æ—¶é—´ï¼Œè€Œè€å¹´ä»£GCå¯¹ç³»ç»Ÿæ€§èƒ½çš„è´Ÿé¢å½±å“åˆ™è¿œè¿œå¤§äºæ–°ç”Ÿä»£GCäº†ã€‚\né•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ # å†…å­˜å›æ”¶æ—¶å¿…é¡»èƒ½å¤Ÿè¯†åˆ«ï¼Œå“ªäº›å¯¹è±¡æ”¾åœ¨æ–°ç”Ÿä»£ï¼Œå“ªäº›å¯¹è±¡æ”¾åœ¨è€å¹´ä»£\u0026mdash;\u0026gt; å› æ­¤ï¼Œè™šæ‹Ÿæœºç»™æ¯ä¸ªå¯¹è±¡ä¸€ä¸ª**å¯¹è±¡å¹´é¾„ï¼ˆAgeï¼‰**è®¡æ•°å™¨\n\u0026lt;æµç¨‹\u0026gt; : å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå¯¹è±¡éƒ½ä¼šé¦–å…ˆåœ¨EdenåŒºåŸŸåˆ†é…ã€‚å¦‚æœå¯¹è±¡åœ¨Edenå‡ºç”Ÿå¹¶ç»è¿‡ç¬¬ä¸€æ¬¡MinorGCåä»ç„¶èƒ½å¤Ÿå­˜æ´»ï¼Œå¹¶ä¸”èƒ½è¢«Survivorå®¹çº³çš„è¯ï¼Œå°†è¢«ç§»åŠ¨åˆ°Survivorç©ºé—´ï¼ˆS0æˆ–S1ï¼‰ä¸­ï¼Œå¹¶å°†å¯¹è±¡å¹´é¾„è®¾ä¸º1(EdenåŒº \u0026ndash;\u0026gt; SurvivoråŒºåå¯¹è±¡åˆå§‹å¹´é¾„å˜ä¸º1 )\nåç»­ï¼Œå¯¹è±¡åœ¨SurvivoråŒºä¸­æ¯ç†¬è¿‡ä¸€æ¬¡MinorGCï¼Œå¹´é¾„å°±å¢åŠ 1å²ï¼Œå½“å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åºï¼ˆé»˜è®¤ä¸º15å²ï¼‰ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œå¯ä»¥é€šè¿‡å‚æ•°**-XX:MaxTenuringThreshold**æ¥è®¾ç½® â˜…â˜…ä¿®æ­£ï¼š â€œHotspot éå†æ‰€æœ‰å¯¹è±¡æ—¶ï¼ŒæŒ‰ç…§å¹´é¾„ä»å°åˆ°å¤§å¯¹å…¶æ‰€å ç”¨çš„å¤§å°è¿›è¡Œç´¯ç§¯ï¼Œå½“ç´¯ç§¯çš„æŸä¸ªå¹´é¾„å¤§å°è¶…è¿‡äº† survivor åŒºçš„ 50% æ—¶ï¼ˆé»˜è®¤å€¼æ˜¯ 50%ï¼Œå¯ä»¥é€šè¿‡ -XX:TargetSurvivorRatio=percent æ¥è®¾ç½®ï¼Œå‚è§ issue1199open in new window ï¼‰ï¼Œå–è¿™ä¸ªå¹´é¾„å’Œ MaxTenuringThreshold ä¸­æ›´å°çš„ä¸€ä¸ªå€¼ï¼Œä½œä¸ºæ–°çš„æ™‹å‡å¹´é¾„é˜ˆå€¼â€ã€‚ åŠ¨æ€å¹´é¾„è®¡ç®—çš„ä»£ç ï¼š\nuint ageTable::compute_tenuring_threshold(size_t survivor_capacity) { //survivor_capacityæ˜¯survivorç©ºé—´çš„å¤§å° size_t desired_survivor_size = (size_t)((((double)survivor_capacity)*TargetSurvivorRatio)/100); size_t total = 0; uint age = 1; while (age \u0026lt; table_size) { //sizesæ•°ç»„æ˜¯æ¯ä¸ªå¹´é¾„æ®µå¯¹è±¡å¤§å° total += sizes[age]; if (total \u0026gt; desired_survivor_size) { break; } age++; //æ³¨æ„è¿™é‡Œï¼Œageæ˜¯é€’å¢çš„ï¼Œæœ€ç»ˆæ˜¯å»æŸä¸ªå€¼ï¼Œè€Œä¸æ˜¯åŒºé—´çš„å€¼è®¡ç®— } uint result = age \u0026lt; MaxTenuringThreshold ? age : MaxTenuringThreshold; ... } ä¾‹å­ï¼š å¦‚**å¯¹è±¡å¹´é¾„5çš„å 30%ï¼Œå¹´é¾„6çš„å 36%ï¼Œå¹´é¾„7çš„å 34%ï¼ŒåŠ å…¥æŸä¸ªå¹´é¾„æ®µï¼ˆå¦‚ä¾‹å­ä¸­çš„å¹´é¾„6ï¼‰**åï¼Œæ€»å ç”¨è¶…è¿‡Survivorç©ºé—´*TargetSurvivorRatioçš„æ—¶å€™ï¼Œä»è¯¥å¹´é¾„æ®µå¼€å§‹åŠå¤§äºçš„å¹´é¾„å¯¹è±¡å°±è¦è¿›å…¥è€å¹´ä»£ï¼ˆå³ä¾‹å­ä¸­çš„å¹´é¾„6å¯¹è±¡ï¼Œå°±æ˜¯å¹´é¾„6å’Œå¹´é¾„7æ™‹å‡åˆ°è€å¹´ä»£ï¼‰ï¼Œè¿™æ—¶å€™æ— éœ€ç­‰åˆ°MaxTenuringThresholdä¸­è¦æ±‚çš„15\nå…³äºé»˜è®¤çš„æ™‹å‡å¹´é¾„æ˜¯ 15ï¼Œè¿™ä¸ªè¯´æ³•çš„æ¥æºå¤§éƒ¨åˆ†éƒ½æ˜¯ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹è¿™æœ¬ä¹¦ã€‚ å¦‚æœä½ å» Oracle çš„å®˜ç½‘é˜…è¯»ç›¸å…³çš„è™šæ‹Ÿæœºå‚æ•°open in new windowï¼Œä½ ä¼šå‘ç°-XX:MaxTenuringThreshold=thresholdè¿™é‡Œæœ‰ä¸ªè¯´æ˜\nSets the maximum tenuring threshold for use in adaptive GC sizing. The largest value is 15. The default value is 15 for the parallel (throughput) collector, and 6 for the CMS collector.é»˜è®¤æ™‹å‡å¹´é¾„å¹¶ä¸éƒ½æ˜¯ 15ï¼Œè¿™ä¸ªæ˜¯è¦åŒºåˆ†åƒåœ¾æ”¶é›†å™¨çš„ï¼ŒCMS å°±æ˜¯ 6.\nä¸»è¦è¿›è¡Œgcçš„åŒºåŸŸ # å¦‚å›¾ï¼šï¼ˆå¤ªé•¿è·³è¿‡äº†ï¼Œç›´æ¥çœ‹ä¸‹é¢çš„æ€»ç»“ï¼‰\næ€»ç»“ï¼š\né’ˆå¯¹HotSpotVMçš„å®ç°ï¼Œå®ƒé‡Œé¢çš„GCå‡†ç¡®åˆ†ç±»åªæœ‰ä¸¤å¤§ç§ï¼š\néƒ¨åˆ†æ”¶é›†ï¼ˆPartial GCï¼‰ æ–°ç”Ÿä»£æ”¶é›†ï¼ˆMinor GC/ Young GC ï¼‰ï¼šåªå¯¹æ–°ç”Ÿä»£è¿›è¡Œåƒåœ¾æ”¶é›† è€å¹´ä»£ï¼ˆMajor GC / Old GC )ï¼šåªå¯¹è€å¹´ä»£è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚â˜…â˜…ï¼šæ³¨æ„ï¼ŒMajorGCåœ¨æœ‰çš„è¯­å¢ƒä¸­ä¹Ÿç”¨äºæŒ‡ä»£æ•´å †æ”¶é›† æ··åˆæ”¶é›†ï¼ˆMixed GCï¼‰ï¼šå¯¹æ•´ä¸ªæ–°ç”Ÿä»£å’Œéƒ¨åˆ†è€å¹´ä»£è¿›è¡Œåƒåœ¾æ”¶é›† æ•´å †æ”¶é›†ï¼ˆFull GCï¼‰ï¼šæ”¶é›†æ•´ä¸ªJavaå †å’Œæ–¹æ³•åŒº ç©ºé—´åˆ†é…æ‹…ä¿ # ä¸ºäº†ç¡®ä¿åœ¨MinorGCä¹‹å‰è€å¹´ä»£æœ¬èº«è¿˜æœ‰å®¹çº³æ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡çš„å‰©ä½™ç©ºé—´\nã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ç¬¬ä¸‰ç« å¯¹äºç©ºé—´åˆ†é…æ‹…ä¿çš„æè¿°å¦‚ä¸‹ï¼š\nJDK 6 Update 24 ä¹‹å‰ï¼Œåœ¨å‘ç”Ÿ Minor GC ä¹‹å‰ï¼Œè™šæ‹Ÿæœºå¿…é¡»å…ˆæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡æ€»ç©ºé—´ï¼Œå¦‚æœè¿™ä¸ªæ¡ä»¶æˆç«‹ï¼Œé‚£è¿™ä¸€æ¬¡ Minor GC å¯ä»¥ç¡®ä¿æ˜¯å®‰å…¨çš„ã€‚å¦‚æœä¸æˆç«‹ï¼Œåˆ™è™šæ‹Ÿæœºä¼šå…ˆæŸ¥çœ‹ -XX:HandlePromotionFailure å‚æ•°çš„è®¾ç½®å€¼æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥(Handle Promotion Failure);å¦‚æœå…è®¸ï¼Œé‚£ä¼šç»§ç»­æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå¦‚æœå¤§äºï¼Œå°†å°è¯•è¿›è¡Œä¸€æ¬¡ Minor GCï¼Œå°½ç®¡è¿™æ¬¡ Minor GC æ˜¯æœ‰é£é™©çš„;å¦‚æœå°äºï¼Œæˆ–è€… -XX: HandlePromotionFailure è®¾ç½®ä¸å…è®¸å†’é™©ï¼Œé‚£è¿™æ—¶å°±è¦æ”¹ä¸ºè¿›è¡Œä¸€æ¬¡ Full GCã€‚\nJDK6 Update24ä¹‹åï¼Œè§„åˆ™å˜ä¸ºåªè¦è€å¹´ä»£çš„è¿ç»­ç©ºé—´å¤§äºæ–°ç”Ÿä»£å¯¹è±¡æ€»å¤§å°ï¼Œæˆ–è€…å†æ¬¡æ™‹å‡çš„å¹³å‡å¤§å°ï¼Œå°±ä¼šè¿›è¡ŒMinorGCï¼Œå¦åˆ™å°†è¿›è¡ŒFull GC\næ­»äº¡å¯¹è±¡åˆ¤æ–­æ–¹æ³• # å †ä¸­å‡ ä¹æ”¾ç€æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ï¼Œå¯¹å †åƒåœ¾å›æ”¶å‰çš„ç¬¬ä¸€æ­¥å°±æ˜¯è¦åˆ¤æ–­å“ªäº›å¯¹è±¡å·²ç»æ­»äº¡ï¼ˆå³ä¸èƒ½å†è¢«ä»»ä½•é€”å¾„ä½¿ç”¨çš„å¯¹è±¡ï¼‰\nå¼•ç”¨è®¡æ•°æ³• # ç»™å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨\næ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒï¼Œè®¡æ•°å™¨å°±åŠ 1 å½“å¼•ç”¨å¤±æ•ˆï¼Œè®¡æ•°å™¨å°±å‡1 ä»»ä½•æ—¶å€™è®¡æ•°å™¨ä¸º0çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ è¿™ä¸ªæ–¹æ³•å®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ï¼Œä½†æ˜¯ç›®å‰ä¸»æµçš„è™šæ‹Ÿæœºä¸­å¹¶æ²¡æœ‰é€‰æ‹©è¿™ä¸ªç®—æ³•æ¥ç®¡ç†å†…å­˜ï¼Œå…¶æœ€ä¸»è¦çš„åŸå› æ˜¯å®ƒå¾ˆéš¾è§£å†³å¯¹è±¡ä¹‹é—´ç›¸äº’å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚\né™¤äº†å¯¹è±¡ objA å’Œ objB ç›¸äº’å¼•ç”¨ç€å¯¹æ–¹ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´å†æ— ä»»ä½•å¼•ç”¨ã€‚ä½†æ˜¯ä»–ä»¬å› ä¸ºäº’ç›¸å¼•ç”¨å¯¹æ–¹ï¼Œå¯¼è‡´å®ƒä»¬çš„å¼•ç”¨è®¡æ•°å™¨éƒ½ä¸ä¸º 0ï¼Œäºæ˜¯å¼•ç”¨è®¡æ•°ç®—æ³•æ— æ³•é€šçŸ¥ GC å›æ”¶å™¨å›æ”¶ä»–ä»¬\nâ˜…å…¶å®æˆ‘è§‰å¾—åªè·Ÿç›¸äº’æœ‰å…³ï¼Œè·Ÿæ˜¯ä¸æ˜¯å¾ªç¯å…³ç³»ä¸ä¼šå¤ªå¤§\nly æ”¹ï¼šç›¸äº’åœ¨è¯­è¨€é€»è¾‘ä¸Šä¹Ÿå¯ä»¥ç†è§£æˆ**â€œå¾ªç¯â€**\npublic class ReferenceCountingGc { Object instance = null; public static void main(String[] args) { ReferenceCountingGc objA = new ReferenceCountingGc(); ReferenceCountingGc objB = new ReferenceCountingGc(); objA.instance = objB; objB.instance = objA; objA = null; objB = null; } } å¯è¾¾æ€§åˆ†æç®—æ³• # è¯¥ç®—æ³•çš„åŸºæœ¬æ€æƒ³å°±æ˜¯é€šè¿‡ä¸€ç³»åˆ—ç§°ä¸º**â€œGC Roots\u0026quot;çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢**ï¼ŒèŠ‚ç‚¹æ‰€èµ°è¿‡çš„è·¯å¾„ ç§°ä¸ºå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ°GC Rootsæ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿çš„è¯ï¼Œè¯æ˜è¯¥å¯¹è±¡ä¸å¯ç”¨ï¼Œéœ€è¦è¢«å›æ”¶ ä¸‹å›¾ä¸­ç”±äºObject 6 ~ Object 10ä¹‹é—´æœ‰å¼•ç”¨å…³ç³»ï¼Œä½†å®ƒä»¬åˆ°GCä¸å¯è¾¾ï¼Œæ‰€ä»¥éœ€è¦è¢«å›æ”¶ å“ªäº›å¯¹è±¡å¯ä»¥ä½œä¸ºGC Rootså‘¢\nè™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNativeæ–¹æ³•ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ ï¼ˆClass çš„staticå˜é‡ï¼‰ æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å˜é‡ï¼ˆClass çš„final staticå˜é‡ï¼‰ æ‰€æœ‰è¢«åŒæ­¥é”æŒæœ‰çš„å¯¹è±¡ ï¼ˆsynchronized(obj)) å¯¹è±¡å¯ä»¥è¢«å›æ”¶ï¼Œå°±ä»£ç ä¸€å®šä¼šè¢«å›æ”¶å— å³ä½¿åœ¨å¯è¾¾æ€§åˆ†ææ³•ä¸­ä¸å¯è¾¾çš„å¯¹è±¡ï¼Œä¹Ÿå¹¶éæ˜¯â€œéæ­»ä¸å¯â€çš„ï¼Œè¿™æ—¶å€™å®ƒä»¬æš‚æ—¶å¤„äºâ€œç¼“åˆ‘é˜¶æ®µâ€ï¼Œè¦çœŸæ­£å®£å‘Šä¸€ä¸ªå¯¹è±¡æ­»äº¡ï¼Œè‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼š\nå¯è¾¾æ€§åˆ†æä¸­ä¸å¯è¾¾çš„å¯¹è±¡è¢«ç¬¬ä¸€æ¬¡æ ‡è®°å¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼šç­›é€‰çš„æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinalizeæ–¹æ³•ï¼ˆæœ‰å¿…è¦åˆ™æ”¾å…¥ï¼‰\nå½“å¯¹è±¡æ²¡æœ‰è¦†ç›–finalizeæ–¹æ³•ï¼Œæˆ–finalizeæ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡ï¼Œåˆ™è™šæ‹Ÿæœºå°†ä¸¤ç§æƒ…å†µè§†ä¸ºæ²¡æœ‰å¿…è¦æ‰§è¡Œï¼Œè¯¥å¯¹è±¡ä¼šè¢«ç›´æ¥å›æ”¶\nå¦‚æœè¿™ä¸ªå¯¹è±¡è¢«åˆ¤å®šä¸ºæœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°†ä¼šè¢«æ”¾ç½®åœ¨ä¸€ä¸ªå«åšF-Queueçš„é˜Ÿåˆ—ä¸­ï¼Œç„¶åç”±Finalizerçº¿ç¨‹å»æ‰§è¡Œã€‚GCå°†ä¼šå¯¹F-Queueä¸­çš„å¯¹è±¡è¿›è¡Œç¬¬äºŒæ¬¡æ ‡è®°ï¼Œå¦‚æœå¯¹è±¡åœ¨finalize()æ–¹æ³•ä¸­é‡æ–°ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹å…³è”ï¼Œé‚£ä¹ˆåœ¨ç¬¬äºŒæ¬¡æ ‡è®°æ—¶å°†ä¼šè¢«ç§»é™¤â€œå³å°†å›æ”¶â€çš„é›†åˆï¼Œå¦åˆ™è¯¥å¯¹è±¡å°†ä¼šè¢«å›æ”¶ã€‚\nï¼ˆæ¯”å¦‚ï¼šæŠŠè‡ªå·±ï¼ˆthiså…³é”®å­—ï¼‰èµ‹å€¼ç»™æŸä¸ªç±»å˜é‡(staticä¿®é¥°)æˆ–è€…å¯¹è±¡çš„æˆå‘˜å˜é‡(åœ¨finalizeæ–¹æ³•ä¸­) ï¼‰\nObject ç±»ä¸­çš„ finalize æ–¹æ³•ä¸€ç›´è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªç³Ÿç³•çš„è®¾è®¡ï¼Œæˆä¸ºäº† Java è¯­è¨€çš„è´Ÿæ‹…ï¼Œå½±å“äº† Java è¯­è¨€çš„å®‰å…¨å’Œ GC çš„æ€§èƒ½ã€‚JDK9 ç‰ˆæœ¬åŠåç»­ç‰ˆæœ¬ä¸­å„ä¸ªç±»ä¸­çš„ finalize æ–¹æ³•ä¼šè¢«é€æ¸å¼ƒç”¨ç§»é™¤ã€‚å¿˜æ‰å®ƒçš„å­˜åœ¨å§ï¼\nå¼•ç”¨ç±»å‹æ€»ç»“ # ä¸è®ºæ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°æ³•åˆ¤æ–­å¯¹è±¡å¼•ç”¨æ•°é‡ï¼Œè¿˜æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†ææ³•åˆ¤æ–­å¯¹è±¡çš„å¼•ç”¨é“¾æ˜¯å¦å¯è¾¾ï¼Œåˆ¤å®šå¯¹è±¡çš„å­˜æ´»éƒ½ä¸**â€å¼•ç”¨â€œ**æœ‰å…³ JDK1.2 ä¹‹å‰ï¼ŒJavaä¸­å¼•ç”¨çš„å®šä¹‰å¾ˆä¼ ç»Ÿï¼šå¦‚æœreferenceç±»å‹çš„æ•°æ®å­˜å‚¨çš„æ•°å€¼ä»£è¡¨çš„æ˜¯å¦ä¸€å—å†…å­˜çš„èµ·å§‹åœ°å€ï¼Œå°±ç§°è¿™å—å†…å­˜ä»£è¡¨ä¸€ä¸ªå¼•ç”¨ JDK1.2 ä¹‹åï¼ŒJavaå¯¹å¼•ç”¨çš„æ¦‚å¿µè¿›è¡Œäº†æ‰©å……ï¼Œå°†å¼•ç”¨(å…·ä½“)åˆ†ä¸ºå¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨å››ç§ï¼ˆå¼•ç”¨å¼ºåº¦é€æ¸å‡å¼±ï¼‰ å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰\nå¤§éƒ¨åˆ†å¼•ç”¨å®é™…ä¸Šæ˜¯å¼ºå¼•ç”¨ã€‚å¦‚æœå¯¹è±¡å…·æœ‰å¼ºå¼•ç”¨ï¼Œé‚£ä¹ˆç±»ä¼¼äºç”Ÿæ´»ä¸­å¿…ä¸å¯å°‘ï¼Œåƒåœ¾å›æ”¶å™¨ç»ä¸ä¼šå›æ”¶å®ƒ å†…å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œå®æ„¿æŠ›å‡ºOutOfMemoryErroé”™è¯¯ï¼Œä½¿ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ï¼Œä¹Ÿä¸ä¼šå›æ”¶å¼ºå¼•ç”¨å¯¹è±¡è§£å†³å¯¹è±¡å†…å­˜ä¸è¶³ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰\nå¦‚æœå¯¹è±¡åªå…·æœ‰è½¯å¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼å¯æœ‰å¯æ— çš„ç”Ÿæ´»ç”¨å“ã€‚ å†…å­˜å¤Ÿåˆ™ä¸ä¼šå›æ”¶ï¼›å†…å­˜ä¸è¶³åˆ™å›æ”¶è¿™äº›å¯¹è±¡ã€‚åªè¦åƒåœ¾å›æ”¶å™¨æ²¡æœ‰å›æ”¶ï¼Œé‚£ä¹ˆå¯¹è±¡å°±å¯ä»¥è¢«ç¨‹åºä½¿ç”¨ã€‚ è½¯å¼•ç”¨å¯ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ è½¯å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJavaè™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªè½¯å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰\nå¦‚æœå¯¹è±¡åªå…·æœ‰å¼±å¼•ç”¨ï¼Œåˆ™ç±»ä¼¼äºå¯æœ‰å¯æ— çš„ç”Ÿæ´»ç”¨å“ å¼±å¼•ç”¨å’Œè½¯å¼•ç”¨çš„åŒºåˆ«ï¼šåªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ‹¥æœ‰æ›´çŸ­æš‚çš„ç”Ÿå‘½å‘¨æœŸ åƒåœ¾å›æ”¶å™¨çº¿ç¨‹æ‰«æå®ƒæ‰€ç®¡è¾–çš„å†…å­˜åŒºåŸŸçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜ã€‚ä¸è¿‡åƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹ï¼Œå› æ­¤ä¸ä¸€å®šä¼šå¾ˆå¿«å‘ç°é‚£äº›åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ å¼±å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœå¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJavaè™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªå¼±å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ [ËˆfÃ¦ntÉ™m] è‹±\nä¸å…¶ä»–å¼•ç”¨ä¸åŒï¼Œè™šå¼•ç”¨å¹¶ä¸ä¼šå†³å®šå¯¹è±¡å£°æ˜å‘¨æœŸã€‚å¦‚æœä¸€ä¸ªä»…æŒæœ‰è™šæ‹Ÿå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±è·Ÿæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶\nè™šå¼•ç”¨ä¸»è¦ç”¨æ¥è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„æ´»åŠ¨\nè™šå¼•ç”¨ã€è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„åŒºåˆ«ï¼šè™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ã€‚\nå½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ã€‚ ç¨‹åºå¯ä»¥é€šè¿‡åˆ¤æ–­å¼•ç”¨é˜Ÿåˆ—æ˜¯å¦åŠ å…¥è™šå¼•ç”¨ï¼Œæ¥äº†è§£è¢«å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å°†è¢«åƒåœ¾å›æ”¶ å¦‚æœå‘ç°æŸä¸ªè™šå¼•ç”¨å·²ç»è¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«å›æ”¶ä¹‹å‰é‡‡å–å¿…è¦çš„è¡ŒåŠ¨ åœ¨ç¨‹åºè®¾è®¡ä¸­ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨å¼±å¼•ç”¨ä¸è™šå¼•ç”¨ï¼Œä½¿ç”¨è½¯å¼•ç”¨çš„æƒ…å†µè¾ƒå¤šï¼Œè¿™æ˜¯å› ä¸ºè½¯å¼•ç”¨å¯ä»¥åŠ é€Ÿ JVM å¯¹åƒåœ¾å†…å­˜çš„å›æ”¶é€Ÿåº¦ï¼Œå¯ä»¥ç»´æŠ¤ç³»ç»Ÿçš„è¿è¡Œå®‰å…¨ï¼Œé˜²æ­¢å†…å­˜æº¢å‡ºï¼ˆOutOfMemoryï¼‰ç­‰é—®é¢˜çš„äº§ç”Ÿ\nThreadLocalä¸­çš„keyç”¨åˆ°äº†å¼±å¼•ç”¨\nå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¸¸é‡æ˜¯åºŸå¼ƒå¸¸é‡ # è¿è¡Œæ—¶å¸¸é‡æ± ä¸»è¦å›æ”¶çš„æ˜¯åºŸå¼ƒçš„å¸¸é‡\nJDK1.7 ä¹‹å‰ï¼Œè¿è¡Œæ—¶å¸¸é‡æ± é€»è¾‘ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œå­˜æ”¾åœ¨æ–¹æ³•åŒºï¼Œæ­¤æ—¶hotspotè™šæ‹Ÿæœºå¯¹æ–¹æ³•åŒºçš„å®ç°ä¸ºæ°¸ä¹…ä»£ JDK1.7å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆä»¥åŠé™æ€å˜é‡ï¼‰è¢«ä»æ–¹æ³•åŒºæ‹¿åˆ°äº†å †ä¸­ï¼Œè¿™é‡Œæ²¡æœ‰æåˆ°è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œä¹Ÿå°±æ˜¯è¯´å­—ç¬¦ä¸²å¸¸é‡æ± è¢«å•ç‹¬æ‹¿åˆ°å †ï¼Œè¿è¡Œæ—¶å¸¸é‡æ± å‰©ä¸‹çš„ä¸œè¥¿ï¼Œè¿˜åœ¨æ–¹æ³•åŒºã€‚å³hotspotä¸­çš„æ°¸ä¹…ä»£ JDK1.8 hotspotç§»é™¤äº†æ°¸ä¹…ä»£ï¼Œç”¨å…ƒç©ºé—´Metaspaceå–ä»£ä¹‹ï¼Œè¿™æ—¶å€™å­—ç¬¦ä¸²å¸¸é‡æ± è¿˜åœ¨å †ï¼Œè¿è¡Œæ—¶å¸¸é‡æ± è¿˜åœ¨æ–¹æ³•åŒºï¼Œåªä¸è¿‡æ–¹æ³•åŒºçš„å®ç°ä»æ°¸ä¹…ä»£å˜æˆäº†å…ƒç©ºé—´Metaspace â˜…â˜… å‡å¦‚å­—ç¬¦ä¸²å¸¸é‡æ± å­˜åœ¨å­—ç¬¦ä¸²â€œabcâ€ï¼Œå¦‚æœå½“å‰æ²¡æœ‰ä»»ä½•Stringå¯¹è±¡å¼•ç”¨è¯¥å­—ç¬¦ä¸²å¸¸é‡çš„è¯ï¼Œå°±è¯´æ˜å¸¸é‡â€œabcâ€æ˜¯åºŸå¼ƒå¸¸é‡ã€‚å¦‚æœè¿™æ—¶å‘ç”Ÿå†…å­˜å›æ”¶å¹¶ä¸”æœ‰å¿…è¦çš„è¯ï¼Œâ€œabcâ€å°±ä¼šè¢«ç³»ç»Ÿæ¸…ç†å‡ºå¸¸é‡æ± \nå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨ç±» # æ–¹æ³•åŒºä¸»è¦å›æ”¶çš„æ˜¯æ— ç”¨çš„ç±»ï¼Œåˆ¤æ–­ä¸€ä¸ªç±»æ˜¯å¦æ˜¯æ— ç”¨çš„ç±»ç›¸å¯¹è‹›åˆ»ï¼Œéœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢æ¡ä»¶\nè¯¥ç±»æ‰€æœ‰å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œå³Javaå †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ åŠ è½½è¯¥ç±»çš„ClassLoaderå·²ç»è¢«å›æ”¶ è¯¥ç±»å¯¹åº”çš„java.lang.Classå¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»æ–¹æ³• Javaè™šæ‹Ÿæœºå¯ä»¥å¯¹æ»¡è¶³ä¸Šè¿°3ä¸ªæ¡ä»¶çš„æ— ç”¨ç±»è¿›è¡Œå›æ”¶ï¼Œæ˜¯**â€œå¯ä»¥â€ï¼Œè€Œä¸æ˜¯å¿…ç„¶**\nåƒåœ¾æ”¶é›†ç®—æ³• # æ ‡è®°-æ¸…é™¤ç®—æ³• # è¯¥ç®—æ³•åˆ†ä¸º**â€œæ ‡è®°â€å’Œâ€œæ¸…é™¤â€é˜¶æ®µï¼š\næ ‡è®°å‡ºæ‰€æœ‰ä¸éœ€è¦å›æ”¶çš„å¯¹è±¡**ï¼Œåœ¨æ ‡è®°å®Œæˆåç»Ÿä¸€å›æ”¶æ‰æ‰€æœ‰æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡\nè¿™æ˜¯æœ€åŸºç¡€çš„æ”¶é›†ç®—æ³•ï¼Œåç»­çš„ç®—æ³•éƒ½æ˜¯å¯¹å…¶ä¸è¶³è¿›è¡Œæ”¹è¿›å¾—åˆ°ï¼Œæœ‰ä¸¤ä¸ªæ˜æ˜¾é—®é¢˜ï¼š\næ•ˆç‡é—®é¢˜ ç©ºé—´é—®é¢˜ï¼ˆæ ‡è®°æ¸…é™¤åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­ç¢ç‰‡ï¼‰ æ ‡è®°-å¤åˆ¶ç®—æ³• # å°†å†…å­˜åˆ†ä¸ºå¤§å°ç›¸åŒçš„ä¸¤å—ï¼Œæ¯æ¬¡ä½¿ç”¨å…¶ä¸­ä¸€å— å½“è¿™å—å†…å­˜ä½¿ç”¨å®Œåï¼Œå°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—å»ï¼Œç„¶åå†æŠŠä½¿ç”¨çš„ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ è¿™æ ·æ¯æ¬¡å†…å­˜å›æ”¶éƒ½æ˜¯å¯¹å†…å­˜åŒºé—´çš„ä¸€åŠè¿›è¡Œå›æ”¶ æ ‡è®°-æ•´ç†ç®—æ³• # æ ¹æ®è€å¹´ä»£ç‰¹ç‚¹æå‡ºçš„ä¸€ç§æ ‡è®°ç®—æ³•ï¼Œæ ‡è®°è¿‡ç¨‹ä»ç„¶ä¸**â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸€æ ·ï¼Œä½†åç»­ä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡å›æ”¶ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨**ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜\nåˆ†ä»£æ”¶é›†ç®—æ³• # å½“å‰è™šæ‹Ÿæœºçš„åƒåœ¾æ”¶é›†éƒ½é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œæ²¡æœ‰æ–°çš„æ€æƒ³ï¼Œåªæ˜¯æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ†ä¸ºå‡ å—ã€‚\nå¯¹è±¡å­˜æ´»å‘¨æœŸï¼Œä¹Ÿå°±æ˜¯æœ‰äº›å¯¹è±¡æ´»çš„æ—¶é—´çŸ­ï¼Œæœ‰äº›å¯¹è±¡æ´»çš„æ—¶é—´é•¿ã€‚\nä¸€èˆ¬å°†Javaå †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹ï¼Œé€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†ç®—æ³•\næ–°ç”Ÿä»£ä¸­ï¼Œæ¯æ¬¡æ”¶é›†éƒ½ä¼šæœ‰å¤§é‡å¯¹è±¡æ­»å»ï¼Œæ‰€ä»¥å¯ä»¥é€‰æ‹©**â€œæ ‡è®°-å¤åˆ¶â€ç®—æ³•ï¼Œåªéœ€è¦ä»˜å‡ºå°‘é‡å¯¹è±¡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆæ¯æ¬¡åƒåœ¾æ”¶é›†** è€å¹´ä»£å¯¹è±¡å­˜æ´»å‡ ç‡æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œè€Œä¸”æ²¡æœ‰é¢å¤–çš„ç©ºé—´å¯¹å®ƒè¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œæ‰€ä»¥å¿…é¡»é€‰æ‹©æ ‡è®°-æ¸…é™¤æˆ–è€…**â€œæ ‡è®°-æ•´ç†â€**ç®—æ³•è¿›è¡Œåƒåœ¾æ”¶é›† åƒåœ¾æ”¶é›†å™¨ # æ”¶é›†ç®—æ³•æ˜¯å†…å­˜å›æ”¶çš„æ–¹æ³•è®ºï¼Œè€Œåƒåœ¾æ”¶é›†å™¨åˆ™æ˜¯å†…å­˜å›æ”¶çš„å…·ä½“å®ç° æ²¡æœ‰æœ€å¥½çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä¹Ÿæ²¡æœ‰ä¸‡èƒ½çš„ï¼Œåº”è¯¥æ ¹æ®å…·ä½“åº”ç”¨åœºæ™¯ï¼Œé€‰æ‹©é€‚åˆè‡ªå·±çš„åƒåœ¾æ”¶é›†å™¨ æ±‡æ€» # æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶å™¨ï¼šSerialï¼ˆä¸²è¡Œ\u0026ndash;æ ‡è®°å¤åˆ¶ï¼‰ï¼ŒParNewï¼ˆå¹¶è¡Œ\u0026ndash;æ ‡è®°å¤åˆ¶ï¼‰ï¼ŒParallelScavengeï¼ˆå¹¶è¡Œ\u0026ndash;æ ‡è®°å¤åˆ¶ï¼‰ è€å¹´ä»£çš„åƒåœ¾å›æ”¶å™¨ï¼šSerialOldï¼ˆä¸²è¡Œ\u0026ndash;æ ‡è®°æ•´ç†ï¼‰ï¼ŒParallelOldï¼ˆå¹¶è¡Œ\u0026ndash;æ ‡è®°æ•´ç†ï¼‰ï¼ŒCMSï¼ˆå¹¶å‘\u0026ndash;æ ‡è®°æ¸…é™¤ï¼‰ åªæœ‰CMSå’ŒG1æ˜¯å¹¶å‘ï¼Œä¸”CMSåªä½œç”¨äºè€å¹´ä»£ï¼Œè€ŒG1éƒ½æœ‰ JDK8ä¸ºæ­¢ï¼Œé»˜è®¤åƒåœ¾å›æ”¶å™¨æ˜¯Parallel Scavengeå’ŒParallel Oldã€å¹¶è¡Œ\u0026ndash;å¤åˆ¶å’Œå¹¶è¡Œ\u0026ndash;æ ‡è®°æ•´ç†ã€‘ JDK9å¼€å§‹ï¼ŒG1æ”¶é›†å™¨æˆä¸ºé»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨ï¼Œç›®å‰æ¥çœ‹ï¼ŒG1å›æ”¶æœŸåœé¡¿æ—¶é—´æœ€çŸ­ä¸”æ²¡æœ‰æ˜æ˜¾ç¼ºç‚¹ï¼Œåé€‚åˆWebåº”ç”¨ jdk8ä¸­æµ‹è¯•Webåº”ç”¨ï¼Œå †å†…å­˜6Gä¸­æ–°ç”Ÿä»£4.5Gçš„æƒ…å†µä¸‹\nParallelScavengeå›æ”¶æ–°ç”Ÿä»£åœé¡¿é•¿è¾¾1.5ç§’ã€‚ G1å›æ”¶å™¨å›æ”¶åŒæ ·å¤§å°çš„æ–°ç”Ÿä»£åªåœé¡¿0.2ç§’ Serial æ”¶é›†å™¨ # Serial ä¸²è¡Œ æ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬ã€å†å²æœ€æ‚ ä¹…çš„åƒåœ¾æ”¶é›†å™¨\nè¿™æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œå®ƒçš„å•çº¿ç¨‹æ„ä¹‰ä¸ä»…æ„å‘³ç€å®ƒåªä¼šä½¿ç”¨ä¸€æ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œï¼Œæ›´é‡è¦çš„æ˜¯å®ƒåœ¨è¿›è¡Œåƒåœ¾æ”¶é›†å·¥ä½œæ—¶å¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹**ï¼ˆâ€Stop The Worldâ€œï¼‰ï¼Œç›´åˆ°å®ƒæ”¶é›†ç»“æŸ**ã€‚\næ–°ç”Ÿä»£é‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³• StopTheWorldä¼šå¸¦æ¥ä¸è‰¯ç”¨æˆ·ä½“éªŒï¼Œæ‰€ä»¥åœ¨åç»­åƒåœ¾æ”¶é›†å™¨è®¾è®¡ä¸­åœé¡¿æ—¶é—´ä¸æ–­ç¼©çŸ­ã€‚ï¼ˆä»ç„¶æœ‰åœé¡¿ï¼Œåƒåœ¾æ”¶é›†å™¨çš„è¿‡ç¨‹ä»ç„¶åœ¨ç»§ç»­ï¼‰ ä¼˜ç‚¹ï¼šç®€å•è€Œé«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹ç›¸æ¯”ï¼‰ ä¸”ç”±äºå…¶æ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œè‡ªç„¶å¯ä»¥è·å¾—å¾ˆé«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ Serialæ”¶é›†å™¨å¯¹äºè¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºæ¥è¯´æ˜¯ä¸ªä¸é”™çš„é€‰æ‹© -XX:+UseSerialGC #è™šæ‹Ÿæœºè¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹çš„é»˜è®¤å€¼ï¼ŒSerial+Serial Oldã€‚ ParNew æ”¶é›†å™¨ # ParNewæ”¶é›†å™¨å…¶å®å°±æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œé™¤äº†ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†å¤–ï¼Œå…¶ä½™è¡Œä¸ºï¼ˆæ§åˆ¶å‚æ•°ã€æ”¶é›†ç®—æ³•ã€å›æ”¶ç­–ç•¥ç­‰ç­‰ï¼‰å’ŒSerialæ”¶é›†å™¨å®Œå…¨ä¸€æ ·\næ–°ç”Ÿä»£é‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•\nâ˜…â˜…â˜… è¿™æ˜¯è®¸å¤šè¿è¡Œåœ¨Serveræ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºçš„é¦–è¦é€‰æ‹©ï¼Œé™¤äº†Serialæ”¶é›†å™¨å¤–ï¼Œåªæœ‰å®ƒèƒ½ä¸CMSæ”¶é›†å™¨ï¼ˆçœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ï¼‰é…åˆå·¥ä½œï¼ˆParNewæ˜¯å¹¶è¡Œï¼‰\nå¹¶è¡Œå’Œå¹¶å‘æ¦‚å¿µè¡¥å……\nå¹¶è¡Œï¼ˆParallelï¼‰ï¼šæŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹ä»ç„¶å¤„äºç­‰å¾…çŠ¶æ€ å¹¶å‘ï¼ˆConcurrentï¼‰ï¼šæŒ‡ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹ åŒæ—¶æ‰§è¡Œï¼ˆä¸ä¸€å®šå¹¶è¡Œï¼Œå¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ï¼Œç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­æ‰§è¡Œï¼Œè€Œæ”¶é›†æ”¶é›†å™¨è¿è¡Œåœ¨å¦ä¸€ä¸ªCPUä¸Š -XX:+UseParNewGC #ParNew+Serial Oldï¼Œåœ¨JDK1.8è¢«åºŸå¼ƒï¼Œåœ¨JDK1.7è¿˜å¯ä»¥ä½¿ç”¨ã€‚ ParallelScavenge æ”¶é›†å™¨ # å®ƒä¹Ÿæ˜¯æ ‡è®°-å¤åˆ¶ç®—æ³•çš„å¤šçº¿ç¨‹æ”¶é›†å™¨ï¼Œçœ‹ä¸Šå»å‡ ä¹å’ŒParNewä¸€æ ·ï¼ŒåŒºåˆ«\néƒ¨åˆ†å‚æ•° (æœ‰ç‚¹äº‰è®®ï¼Œå…ˆä»¥ä¸‹é¢ä¸ºå‡†)\n-XX:+UseParallelGC # è™šæ‹Ÿæœºè¿è¡Œåœ¨Serveræ¨¡å¼ä¸‹çš„é»˜è®¤å€¼(1.8) æ–°ç”Ÿä»£ä½¿ç”¨ParallelGCï¼Œè€å¹´ä»£ä½¿ç”¨å›æ”¶å™¨ ; â˜…â˜… JDK1.7ä¹‹åï¼Œèƒ½è¾¾åˆ°UseParallelOldGC çš„æ•ˆæœ ## å‚è€ƒè‡ª https://zhuanlan.zhihu.com/p/353458348 -XX:+UseParallelOldGC # æ–°ç”Ÿä»£ä½¿ç”¨ParallelGCï¼Œè€å¹´ä»£ä½¿ç”¨ParallelOldGC Parallel Scavengeæ”¶é›†å™¨å…³æ³¨ç‚¹æ˜¯ååé‡ï¼ˆé«˜æ•ˆç‡åˆ©ç”¨CPUï¼‰ï¼ŒCMSç­‰åƒåœ¾æ”¶é›†å™¨å…³æ³¨ç‚¹æ˜¯ç”¨æˆ·çš„åœé¡¿æ—¶é—´ï¼ˆæé«˜ç”¨æˆ·ä½“éªŒï¼‰\næ‰€è°“ååé‡å°±æ˜¯CPUä¸­ç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸CPUæ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ ï¼ˆä¹Ÿå°±æ˜¯å¸Œæœ›æ¶ˆè€—å°‘é‡CPUå°±èƒ½è¿è¡Œæ›´å¤šä»£ç ï¼‰\nParallel Scavenge æ”¶é›†å™¨æä¾›äº†å¾ˆå¤šå‚æ•°ä¾›ç”¨æˆ·æ‰¾åˆ°æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–æœ€å¤§ååé‡ï¼Œå¦‚æœå¯¹äºæ”¶é›†å™¨è¿ä½œä¸å¤ªäº†è§£ï¼Œæ‰‹å·¥ä¼˜åŒ–å­˜åœ¨å›°éš¾çš„æ—¶å€™ï¼Œä½¿ç”¨ Parallel Scavenge æ”¶é›†å™¨é…åˆè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ï¼ŒæŠŠå†…å­˜ç®¡ç†ä¼˜åŒ–äº¤ç»™è™šæ‹Ÿæœºå»å®Œæˆä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚\næ–°ç”Ÿä»£é‡‡ç”¨æ ‡è®°-å¤åˆ¶ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³• è¿™æ˜¯JDK1.8 çš„é»˜è®¤æ”¶é›†å™¨ ä½¿ç”¨ java -XX:+PrintCommandLineFlags -version å‘½ä»¤æŸ¥çœ‹ å¦‚ä¸‹ï¼Œä¸¤ç§æƒ…å†µï¼š\n#é»˜è®¤ Î» java -XX:+PrintCommandLineFlags -version -XX:InitialHeapSize=531924800 -XX:MaxHeapSize=8510796800 -XX:+PrintCommandLineFlags -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:-UseLargePagesIndividualAllocation -XX:+UseParallelGC java version \u0026#34;1.8.0_202\u0026#34; Java(TM) SE Runtime Environment (build 1.8.0_202-b08) Java HotSpot(TM) 64-Bit Server VM (build 25.202-b08, mixed mode) ç¬¬äºŒç§æƒ…å†µï¼š(æ³¨æ„ï¼š-XX:-UseParallelOldGC)\nÎ» java -XX:-UseParallelOldGC -XX:+PrintCommandLineFlags -version -XX:InitialHeapSize=531924800 -XX:MaxHeapSize=8510796800 -XX:+PrintCommandLineFlags -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:-UseLargePagesIndividualAllocation -XX:+UseParallelGC -XX:-UseParallelOldGC java version \u0026#34;1.8.0_202\u0026#34; Java(TM) SE Runtime Environment (build 1.8.0_202-b08) Java HotSpot(TM) 64-Bit Server VM (build 25.202-b08, mixed mode) SerialOld æ”¶é›†å™¨ # Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œæ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ åœ¨JDK1.5ä»¥åŠä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œä¸Parallel Scavengeæ”¶é›†å™¨æ­é…æ—¶å€™ ä½œä¸ºCMSæ”¶é›†å™¨çš„åå¤‡æ–¹æ¡ˆ ParallelOld æ”¶é›†å™¨ # Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä½¿ç”¨å¤šçº¿ç¨‹å’Œæ ‡è®°-æ•´ç†ç®—æ³• åœ¨æ³¨é‡ååé‡ä»¥åŠCPUèµ„æºçš„åœºåˆï¼Œéƒ½å¯ä»¥è€ƒè™‘ParallelScavengeå’ŒParallelOldæ”¶é›†å™¨ CMS æ”¶é›†å™¨ # CMSï¼ŒConcurrent Mark Sweepï¼Œæ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œéå¸¸ç¬¦åˆæ³¨é‡ç”¨æˆ·ä½“éªŒçš„å¼•ç”¨ä¸Šä½¿ç”¨\nCMSæ”¶é›†å™¨æ˜¯HotSpotè™šæ‹Ÿæœºä¸Šç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ï¼Œç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹ï¼ˆåŸºæœ¬ä¸Šï¼‰åŒæ—¶å·¥ä½œ\nMark-Sweepï¼Œæ˜¯ä¸€ç§â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ï¼Œè¿ä½œè¿‡ç¨‹ç›¸æ¯”å‰é¢å‡ ç§åƒåœ¾æ”¶é›†å™¨æ¥è¯´æ›´åŠ å¤æ‚ï¼Œæ­¥éª¤ï¼š\nåˆå§‹æ ‡è®°ï¼šæš‚åœæ‰€æœ‰å…¶ä»–çº¿ç¨‹ï¼Œè®°å½•ç›´æ¥ä¸rootç›¸è¿çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«\nå¹¶å‘æ ‡è®°ï¼šåŒæ—¶ å¼€å¯GCå’Œç”¨æˆ·çº¿ç¨‹ ï¼Œç”¨ä¸€ä¸ªé—­åŒ…ç»“æ„è®°å½•å¯è¾¾å¯¹è±¡ã€‚ä½†è¿™ä¸ªé˜¶æ®µç»“æŸï¼Œè¿™ä¸ªé—­åŒ…ç»“æ„å¹¶ä¸èƒ½ä¿è¯åŒ…å«å½“å‰æ‰€æœ‰çš„å¯è¾¾å¯¹è±¡ã€‚\nå› ä¸ºç”¨æˆ·çº¿ç¨‹ä¼šä¸æ–­æ›´æ–°å¼•ç”¨åŸŸï¼Œæ‰€ä»¥GCçº¿ç¨‹æ— æ³•ä¿è¯å¯è¾¾æ€§åˆ†æçš„å®æ—¶æ€§\næ‰€ä»¥è¿™ä¸ªç®—æ³•é‡Œä¼šè·Ÿè¸ªè®°å½•è¿™äº›å‘ç”Ÿå¼•ç”¨æ›´æ–°çš„åœ°æ–¹\né‡æ–°æ ‡è®°ï¼šç›®çš„æ˜¯ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ä¸ºç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ã€‚\nè¿™ä¸ªé˜¶æ®µåœé¡¿æ—¶é—´ä¸€èˆ¬ä¼šè¢«åˆå§‹æ ‡è®°é˜¶æ®µæ—¶é—´ç¨é•¿ï¼Œè¿œè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µæ—¶é—´çŸ­\nå¹¶å‘æ¸…é™¤ï¼šå¼€å¯ç”¨æˆ·çº¿ç¨‹ï¼ŒåŒæ—¶GCçº¿ç¨‹å¼€å§‹å¯¹æœªæ‰«æçš„åŒºåŸŸåšæ¸…æ‰«\nä»åå­—å¯ä»¥çœ‹å‡ºè¿™æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æ”¶é›†å™¨ï¼šå¹¶å‘æ”¶é›†ã€ä½åœé¡¿ã€‚ä½†æœ‰ä¸‰ä¸ªæ˜æ˜¾ç¼ºç‚¹\nå¯¹CPUèµ„æºæ•æ„Ÿ\næ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾\næµ®åŠ¨åƒåœ¾çš„è§£é‡Šï¼šå°±æ˜¯ä¹‹å‰è¢«gc æ ‡è®°ä¸º å¯è¾¾å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ å­˜æ´»å¯¹è±¡ï¼Œåœ¨ä¸¤æ¬¡gcçº¿ç¨‹ä¹‹é—´è¢«ä¸šåŠ¡çº¿ç¨‹åˆ é™¤äº†å¼•ç”¨ï¼Œé‚£ä¹ˆé¢œè‰²ä¸ä¼šæ›´æ”¹ï¼Œè¿˜æ˜¯ä¹‹å‰çš„é¢œè‰²ï¼ˆé»‘è‰²orç°è‰²ï¼‰ï¼Œä½†æ˜¯å…¶å®æ˜¯ç™½è‰²ï¼Œæ‰€ä»¥è¿™ä¸€æ¬¡gc æ— æ³•å¯¹å…¶å›æ”¶ï¼Œéœ€è¦ç­‰ä¸‹ä¸€æ¬¡gcåˆå§‹æ ‡è®°å¯åŠ¨æ‰ä¼šè¢«åˆ·æˆç™½è‰² ä½œè€…ï¼šYellowtail é“¾æ¥ï¼šhttps://www.jianshu.com/p/6590aaad82f7 æ¥æºï¼šç®€ä¹¦\nå®ƒä½¿ç”¨çš„æ”¶é›†ç®—æ³•**â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¼šå¯¼è‡´æ”¶é›†ç»“æŸæ—¶ä¼šæœ‰å¤§é‡ç©ºé—´ç¢ç‰‡äº§ç”Ÿ**\nG1 æ”¶é›†å™¨ # G1(Garbage-First)ï¼Œæ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡å™¨çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä¸»è¦é’ˆå¯¹é…å¤‡å¤šé¢—å¤„ç†å™¨ä»¥åŠå¤§å®¹é‡å†…å­˜çš„æå…¶ï¼Œä»¥æé«˜æ¦‚ç‡æ»¡è¶³GCåœé¡¿æ—¶é—´è¦æ±‚çš„åŒæ—¶ï¼Œè¿˜å…·å¤‡é«˜ååé‡æ€§èƒ½ç‰¹å¾\nJDK1.7ä¸­HotSpotè™šæ‹Ÿæœºçš„ä¸€ä¸ªé‡è¦è¿›åŒ–ç‰¹å¾ï¼Œå…·å¤‡ç‰¹ç‚¹ï¼š\nå¹¶è¡Œä¸å¹¶å‘ï¼š\nG1 èƒ½å……åˆ†åˆ©ç”¨ CPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œä½¿ç”¨å¤šä¸ª CPUï¼ˆCPU æˆ–è€… CPU æ ¸å¿ƒï¼‰æ¥ç¼©çŸ­ Stop-The-World åœé¡¿æ—¶é—´ã€‚éƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿ Java çº¿ç¨‹æ‰§è¡Œçš„ GC åŠ¨ä½œï¼ŒG1 æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®© java ç¨‹åºç»§ç»­æ‰§è¡Œ\nåˆ†ä»£æ”¶é›†ï¼š\nè™½ç„¶ G1 å¯ä»¥ä¸éœ€è¦å…¶ä»–æ”¶é›†å™¨é…åˆå°±èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ª GC å †ï¼Œä½†æ˜¯è¿˜æ˜¯ä¿ç•™äº†åˆ†ä»£çš„æ¦‚å¿µã€‚\nç©ºé—´æ•´åˆï¼š\nä¸ CMS çš„â€œæ ‡è®°-æ¸…ç†â€ç®—æ³•ä¸åŒï¼ŒG1 ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäº**â€œæ ‡è®°-æ•´ç†â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼›ä»å±€éƒ¨ä¸Šæ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°-å¤åˆ¶â€**ç®—æ³•å®ç°çš„ã€‚\nå¯é¢„æµ‹çš„åœé¡¿ï¼š\nè¿™æ˜¯ G1 ç›¸å¯¹äº CMS çš„å¦ä¸€ä¸ªå¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯ G1 å’Œ CMS å…±åŒçš„å…³æ³¨ç‚¹ï¼Œä½† G1 é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸º M æ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ã€‚\nG1 æ”¶é›†å™¨çš„è¿ä½œå¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤\nåˆå§‹æ ‡è®° å¹¶å‘æ ‡è®° æœ€ç»ˆæ ‡è®° ç­›é€‰å›æ”¶ G1 æ”¶é›†å™¨åœ¨åå°ç»´æŠ¤äº†ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆé€‰æ‹©å›æ”¶ä»·å€¼æœ€å¤§çš„ Region(è¿™ä¹Ÿå°±æ˜¯å®ƒçš„åå­— Garbage-First çš„ç”±æ¥) ã€‚è¿™ç§ä½¿ç”¨ Region åˆ’åˆ†å†…å­˜ç©ºé—´ä»¥åŠæœ‰ä¼˜å…ˆçº§çš„åŒºåŸŸå›æ”¶æ–¹å¼ï¼Œï¼Œä¿è¯äº† G1 æ”¶é›†å™¨åœ¨æœ‰é™æ—¶é—´å†…å¯ä»¥å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡ï¼ˆæŠŠå†…å­˜åŒ–æ•´ä¸ºé›¶ï¼‰\nZGC æ”¶é›†å™¨ # The Z Garbage Collector\nä¸ CMS ä¸­çš„ ParNew å’Œ G1 ç±»ä¼¼ï¼ŒZGC ä¹Ÿé‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œä¸è¿‡ ZGC å¯¹è¯¥ç®—æ³•åšäº†é‡å¤§æ”¹è¿›ã€‚\nåœ¨ ZGC ä¸­å‡ºç° Stop The World çš„æƒ…å†µä¼šæ›´å°‘ï¼\nJDK11ï¼Œç›¸å…³æ–‡ç«  https://tech.meituan.com/2020/08/06/new-zgc-practice-in-meituan.html\n"},{"id":125,"href":"/zh/docs/study/Review/java_guide/java/JVM/ly0407lyjvm-intro/","title":"jvm-intro","section":"JavaåŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuideï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nåŸæ–‡åœ°å€ï¼š https://juejin.im/post/5e1505d0f265da5d5d744050#heading-28 æ„Ÿè°¢åŸä½œè€…åˆ†äº«ï¼ï¼\nJVMçš„åŸºæœ¬ä»‹ç» # JVMï¼ŒJavaVirtualMachineçš„ç¼©å†™ï¼Œè™šæ‹Ÿå‡ºæ¥çš„è®¡ç®—æœºï¼Œé€šè¿‡åœ¨å®é™…çš„è®¡ç®—æœºä¸Šä»¿çœŸæ¨¡æ‹Ÿå„ç±»è®¡ç®—æœºåŠŸèƒ½å®ç° JVMç±»ä¼¼ä¸€å°å°ç”µè„‘ï¼Œè¿è¡Œåœ¨windowsæˆ–è€…linuxè¿™äº›çœŸå®æ“ä½œç³»ç»Ÿç¯å¢ƒä¸‹ï¼Œç›´æ¥å’Œæ“ä½œç³»ç»Ÿäº¤äº’ï¼Œä¸ç¡¬ä»¶ä¸ç›´æ¥äº¤äº’ï¼Œæ“ä½œç³»ç»Ÿå¸®æˆ‘ä»¬å®Œæˆå’Œç¡¬ä»¶äº¤äº’çš„å·¥ä½œ Javaæ–‡ä»¶æ˜¯å¦‚ä½•è¿è¡Œçš„ # åœºæ™¯å‡è®¾ï¼šæˆ‘ä»¬å†™äº†ä¸€ä¸ªHelloWorld.javaï¼Œè¿™æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ã€‚JVMä¸è®¤è¯†æ–‡æœ¬æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªç¼–è¯‘ï¼Œè®©å…¶(xxx.java)æˆä¸ºä¸€ä¸ªJVMä¼šè¯»çš„äºŒè¿›åˆ¶æ–‡ä»¶\u0026mdash;\u0026gt; HelloWorld.class\nç±»åŠ è½½å™¨ å¦‚æœJVMæƒ³è¦æ‰§è¡Œè¿™ä¸ª.classæ–‡ä»¶ï¼Œéœ€è¦å°†å…¶**(è¿™é‡Œåº”è¯¥æŒ‡çš„äºŒè¿›åˆ¶æ–‡ä»¶)è£…è¿›ç±»åŠ è½½å™¨**ä¸­ï¼Œå®ƒå°±åƒä¸€ä¸ªæ¬è¿å·¥ä¸€æ ·ï¼Œä¼šæŠŠæ‰€æœ‰çš„.classæ–‡ä»¶å…¨éƒ¨æ¬è¿›JVMé‡Œé¢ æ–¹æ³•åŒº\nç±»åŠ è½½å™¨å°†.classæ–‡ä»¶æ¬è¿‡æ¥ï¼Œå°±æ˜¯å…ˆä¸¢åˆ°è¿™ä¸€å—ä¸Š\næ–¹æ³•åŒºæ˜¯ç”¨äºå­˜æ”¾ç±»ä¼¼äºå…ƒæ•°æ®ä¿¡æ¯æ–¹é¢çš„æ•°æ®çš„ï¼Œæ¯”å¦‚ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€ç¼–è¯‘åä»£ç \u0026hellip;ç­‰\nå † å †ä¸»è¦æ”¾ä¸€äº›å­˜å‚¨çš„æ•°æ®ï¼Œæ¯”å¦‚å¯¹è±¡å®ä¾‹ã€æ•°ç»„\u0026hellip;ç­‰ï¼Œå®ƒå’Œæ–¹æ³•åŒºéƒ½åŒå±äºçº¿ç¨‹å…±äº«åŒºåŸŸï¼Œå³å®ƒä»¬éƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„\næ ˆ\nçº¿ç¨‹ç‹¬äº«\næ ˆæ˜¯æˆ‘ä»¬ä»£ç è¿è¡Œç©ºé—´ï¼Œæˆ‘ä»¬ç¼–å†™çš„æ¯ä¸€ä¸ªæ–¹æ³•éƒ½ä¼šæ”¾åˆ°æ ˆé‡Œé¢è¿è¡Œã€‚\nåè¯ï¼šæœ¬åœ°æ–¹æ³•æ ˆæˆ–æœ¬åœ°æ–¹æ³•æ¥å£ï¼Œä¸è¿‡æˆ‘ä»¬åŸºæœ¬ä¸ä¼šæ¶‰åŠè¿™ä¸¤å—å†…å®¹ï¼Œè¿™ä¸¤åº•å±‚ä½¿ç”¨Cè¿›è¡Œå·¥ä½œï¼Œå’ŒJavaæ²¡æœ‰å¤ªå¤§å…³ç³»\nç¨‹åºè®¡æ•°å™¨ ä¸»è¦å°±æ˜¯å®Œæˆä¸€ä¸ªåŠ è½½å·¥ä½œï¼Œç±»ä¼¼äºä¸€ä¸ªæŒ‡é’ˆä¸€æ ·çš„ï¼ŒæŒ‡å‘ä¸‹ä¸€è¡Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„ä»£ç ã€‚å’Œæ ˆä¸€æ ·ï¼Œéƒ½æ˜¯çº¿ç¨‹ç‹¬äº«çš„ï¼Œå°±æ˜¯æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½ä¼šè‡ªå·±å¯¹åº”çš„ä¸€å—åŒºåŸŸè€Œä¸ä¼šå­˜åœ¨å¹¶å‘å’Œå¤šçº¿ç¨‹é—®é¢˜ã€‚\nå°æ€»ç»“ Javaæ–‡ä»¶ç»è¿‡ç¼–è¯‘åç¼–ç¨‹.classå­—èŠ‚ç æ–‡ä»¶ å­—èŠ‚ç æ–‡ä»¶é€šè¿‡ç±»åŠ è½½å™¨è¢«æ¬è¿åˆ° JVMè™šæ‹Ÿæœºä¸­ è™šæ‹Ÿæœºä¸»è¦çš„5å¤§å—ï¼šæ–¹æ³•åŒºã€å † éƒ½ä¸ºçº¿ç¨‹å…±äº«åŒºåŸŸï¼Œæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼›æ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆå’Œè®¡æ•°å™¨éƒ½æ˜¯ç‹¬äº«åŒºåŸŸï¼Œä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œè€ŒJVMçš„è°ƒä¼˜ä¸»è¦å°±æ˜¯å›´ç»•å †ã€æ ˆä¸¤å¤§å—è¿›è¡Œ ç®€å•çš„ä»£ç ä¾‹å­ # ä¸€ä¸ªç®€å•çš„å­¦ç”Ÿç±»åŠmainæ–¹æ³•:\npublic class Student { public String name; public Student(String name) { this.name = name; } public void sayName() { System.out.println(\u0026#34;student\u0026#39;s name is : \u0026#34; + name); } } mainæ–¹æ³•ï¼š\npublic class App { public static void main(String[] args) { Student student = new Student(\u0026#34;tellUrDream\u0026#34;); student.sayName(); } } â˜…â˜… æ‰§è¡Œmainæ–¹æ³•çš„æ­¥éª¤å¦‚ä¸‹\nç¼–è¯‘å¥½App.javaåå¾—åˆ°App.classåï¼Œæ‰§è¡ŒAPP.classï¼Œç³»ç»Ÿä¼šå¯åŠ¨ä¸€ä¸ªJVMè¿›ç¨‹ï¼Œä»classpathç±»è·¯å¾„ä¸­æ‰¾åˆ°ä¸€ä¸ªåä¸ºAPP.classçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå°†APPçš„ç±»ä¿¡æ¯åŠ è½½åˆ°è¿è¡Œæ—¶æ•°æ®åŒºçš„æ–¹æ³•åŒºå†…ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšAPPç±»çš„åŠ è½½ JVMæ‰¾åˆ°APPçš„ä¸»ç¨‹åºå…¥å£ï¼Œæ‰§è¡Œmainæ–¹æ³• è¿™ä¸ªmainçš„ç¬¬ä¸€æ¡è¯­å¥**(æŒ‡ä»¤)**ä¸º Student student = new Student(\u0026quot;tellUrDream\u0026quot;)ï¼Œå°±æ˜¯è®©JVMåˆ›å»ºä¸€ä¸ªStudentå¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™æ–¹æ³•åŒºæ˜¯æ²¡æœ‰Studentç±»çš„ä¿¡æ¯çš„ï¼Œæ‰€ä»¥JVMé©¬ä¸ŠåŠ è½½Studentç±»ï¼ŒæŠŠStudentç±»çš„ä¿¡æ¯æ”¾åˆ°æ–¹æ³•åŒºä¸­ åŠ è½½å®ŒStudentç±»åï¼ŒJVMåœ¨å †ä¸­ä¸ºä¸€ä¸ªæ–°çš„Studentå®ä¾‹åˆ†é…å†…å­˜ï¼Œç„¶åè°ƒç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–Studentå®ä¾‹ï¼Œè¿™ä¸ªStudentå®ä¾‹**(å¯¹è±¡)æŒæœ‰æŒ‡å‘æ–¹æ³•åŒºä¸­çš„Studentç±»çš„ç±»å‹ä¿¡æ¯**çš„å¼•ç”¨ æ‰§è¡Œstudent.sayName;æ—¶ï¼ŒJVMæ ¹æ®studentçš„å¼•ç”¨æ‰¾åˆ°studentå¯¹è±¡ï¼Œç„¶åæ ¹æ®studentå¯¹è±¡æŒæœ‰çš„å¼•ç”¨å®šä½åˆ°æ–¹æ³•åŒºä¸­studentç±»çš„ç±»å‹ä¿¡æ¯çš„æ–¹æ³•è¡¨ï¼Œè·å¾—sayName()çš„å­—èŠ‚ç åœ°å€ã€‚ æ‰§è¡ŒsayName() å…¶å®ä¹Ÿä¸ç”¨ç®¡å¤ªå¤šï¼Œåªéœ€è¦çŸ¥é“å¯¹è±¡å®ä¾‹åˆå§‹åŒ–æ—¶ï¼Œä¼šå»æ–¹æ³•åŒºä¸­æ‰¾åˆ°ç±»ä¿¡æ¯ï¼ˆæ²¡æœ‰çš„è¯å…ˆåŠ è½½ï¼‰ï¼Œå®Œæˆåå†åˆ°æ ˆé‚£é‡Œå»è¿è¡Œæ–¹æ³•\nç±»åŠ è½½å™¨çš„ä»‹ç» # ç±»åŠ è½½å™¨è´Ÿè´£åŠ è½½.classæ–‡ä»¶ï¼Œ.classæ–‡ä»¶çš„å¼€å¤´ä¼šæœ‰ç‰¹å®šçš„æ–‡ä»¶æ ‡è¯†ï¼Œå°†classæ–‡ä»¶å­—èŠ‚ç å†…å®¹åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶å°†è¿™äº›å†…å®¹è½¬æ¢æˆæ–¹æ³•åŒºä¸­çš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”ClassLoaderåªè´Ÿè´£classæ–‡ä»¶çš„åŠ è½½ï¼Œè€Œèƒ½å¦è¿è¡Œåˆ™ç”±Execution Engineæ¥å†³å®š\nç±»åŠ è½½å™¨çš„æµç¨‹ # ä»ç±»è¢«åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­å¼€å§‹ï¼Œåˆ°é‡Šæ”¾å†…å­˜æ€»å…±æœ‰7ä¸ªæ­¥éª¤ï¼š\nåŠ è½½ï¼ŒéªŒè¯ï¼Œå‡†å¤‡ï¼Œè§£æï¼Œåˆå§‹åŒ–ï¼Œä½¿ç”¨ï¼Œå¸è½½ã€‚\nå…¶ä¸­éªŒè¯ï¼Œå‡†å¤‡ï¼Œè§£æä¸‰ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºé“¾æ¥\nåŠ è½½ # å°†classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ å°†é™æ€æ•°æ®ç»“æ„è½¬åŒ–æˆæ–¹æ³•åŒºä¸­è¿è¡Œçš„æ•°æ®ç»“æ„ åœ¨å †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ä½œä¸ºæ•°æ®è®¿é—®çš„å…¥å£ é“¾æ¥ # éªŒè¯ï¼šç¡®ä¿åŠ è½½çš„ç±»ç¬¦åˆJVMè§„èŒƒå’Œå®‰å…¨ï¼Œä¿è¯è¢«æ ¡éªŒç±»çš„æ–¹æ³•åœ¨è¿è¡Œæ—¶ä¸ä¼šåšå‡ºå±å®³è™šæ‹Ÿæœºçš„äº‹ä»¶ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå®‰å…¨æ£€æŸ¥ å‡†å¤‡ï¼šä¸ºstaticå˜é‡åœ¨æ–¹æ³•åŒºåˆ†é…å†…å­˜ç©ºé—´ï¼Œè®¾ç½®å˜é‡çš„åˆå§‹å€¼ï¼Œä¾‹å¦‚static int = 3 ï¼ˆæ³¨æ„ï¼šå‡†å¤‡é˜¶æ®µåªè®¾ç½®ç±»ä¸­çš„é™æ€å˜é‡ï¼ˆæ–¹æ³•åŒºä¸­ï¼‰ï¼Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ï¼ˆå †å†…å­˜ä¸­ï¼‰ï¼Œå®ä¾‹å˜é‡æ˜¯å¯¹è±¡åˆå§‹åŒ–æ—¶èµ‹å€¼çš„ï¼‰ è§£æï¼šè™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨ï¼Œæ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ï¼ˆç¬¦å·å¼•ç”¨æ¯”å¦‚æˆ‘ç°åœ¨ import java.util.ArrayList è¿™å°±ç®—ç¬¦å·å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨å°±æ˜¯æŒ‡é’ˆæˆ–è€…å¯¹è±¡åœ°å€ï¼Œæ³¨æ„å¼•ç”¨å¯¹è±¡ä¸€å®šæ˜¯åœ¨å†…å­˜è¿›è¡Œï¼‰ åˆå§‹åŒ– # åˆå§‹åŒ–å°±æ˜¯æ‰§è¡Œç±»æ„é€ å™¨æ–¹æ³•çš„clinit()çš„è¿‡ç¨‹ï¼Œè€Œä¸”è¦ä¿è¯æ‰§è¡Œå‰çˆ¶ç±»çš„clinit()æ–¹æ³•å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚ è¿™ä¸ªæ–¹æ³•ç”±ç¼–è¯‘å™¨æ”¶é›†(ä¹Ÿå°±æ˜¯ç¼–è¯‘æ—¶äº§ç”Ÿ)ï¼Œé¡ºåºæ‰§è¡Œæ‰€æœ‰ç±»å˜é‡(static ä¿®é¥°çš„æˆå‘˜å˜é‡) æ˜¾ç¤ºåˆå§‹åŒ–å’Œé™æ€ä»£ç å—ä¸­è¯­å¥ æ­¤æ—¶å‡†å¤‡é˜¶æ®µæ—¶çš„é‚£ä¸ªstatic int a ç”±é»˜è®¤åˆå§‹åŒ–çš„0å˜æˆäº†æ˜¾ç¤ºåˆå§‹åŒ–çš„3ã€‚ç”±äºæ‰§è¡Œé¡ºåºç¼˜æ•…ï¼Œåˆå§‹åŒ–é˜¶æ®µç±»å˜é‡å¦‚æœåœ¨é™æ€ä»£ç ä¸­åˆè¿›è¡Œæ›´æ”¹ï¼Œåˆ™ä¼šè¦†ç›–ç±»å˜é‡çš„æ˜¾å¼åˆå§‹åŒ–ï¼Œæœ€ç»ˆå€¼ä¼šä¸ºé™æ€ä»£ç å—ä¸­çš„èµ‹å€¼ å­—èŠ‚ç æ–‡ä»¶ä¸­åˆå§‹åŒ–æ–¹æ³•æœ‰ä¸¤ç§ï¼Œéé™æ€èµ„æºåˆå§‹åŒ–çš„initå’Œé™æ€èµ„æºåˆå§‹åŒ–çš„clinit ç±»æ„é€ å™¨æ–¹æ³•clinit() ä¸åŒäºç±»çš„æ„é€ å™¨ï¼Œè¿™äº›æ–¹æ³•éƒ½æ˜¯å­—èŠ‚ç æ–‡ä»¶ä¸­åªèƒ½ç»™JVMè¯†åˆ«çš„ç‰¹æ®Šæ–¹æ³• å¸è½½ # GCå°†æ— ç”¨å¯¹è±¡ä»å†…å­˜ä¸­å¸è½½\nç±»åŠ è½½å™¨çš„åŠ è½½é¡ºåº # åŠ è½½ä¸€ä¸ªClassç±»çš„é¡ºåºä¹Ÿæ˜¯æœ‰ä¼˜å…ˆçº§çš„**(åŠ è½½ï¼Œä¹Ÿå¯ä»¥ç§°\u0026quot;æŸ¥æ‰¾\u0026quot;)** ï¼Œç±»åŠ è½½å™¨ ä»æœ€åº•å±‚å¼€å§‹å¾€ä¸Šçš„é¡ºåºï¼š\nBootStrap ClassLoaderï¼š rt.jar (lib/rt.jar) Extension ClassLoader: åŠ è½½æ‰©å±•çš„jaråŒ… (lib/ext/xxx.jar) APP ClassLoaderï¼š æŒ‡å®šçš„classpathä¸‹é¢çš„jaråŒ… Custom ClassLoaderï¼š è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ åŒäº²å§”æ´¾æœºåˆ¶ # å½“ä¸€ä¸ªç±»æ”¶åˆ°äº†åŠ è½½è¯·æ±‚æ—¶ï¼Œå®ƒæ˜¯ä¸ä¼šå…ˆè‡ªå·±å»å°è¯•åŠ è½½çš„ï¼Œè€Œæ˜¯å§”æ´¾ç»™çˆ¶ç±»å»å®Œæˆï¼Œæ¯”å¦‚æˆ‘ç°åœ¨è¦ new ä¸€ä¸ª Personï¼Œè¿™ä¸ª Person æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»ï¼Œå¦‚æœæˆ‘ä»¬è¦åŠ è½½å®ƒï¼Œå°±ä¼šå…ˆå§”æ´¾ App ClassLoader ï¼Œåªæœ‰å½“çˆ¶ç±»åŠ è½½å™¨éƒ½åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªè¯·æ±‚ï¼ˆä¹Ÿå°±æ˜¯çˆ¶ç±»åŠ è½½å™¨éƒ½æ²¡æœ‰æ‰¾åˆ°åŠ è½½æ‰€éœ€çš„ Classï¼‰æ—¶ï¼Œå­ç±»åŠ è½½å™¨æ‰ä¼šè‡ªè¡Œå°è¯•åŠ è½½ã€‚\nå¥½å¤„ï¼šåŠ è½½ä½äº rt.jar åŒ…ä¸­çš„ç±»æ—¶ä¸ç®¡æ˜¯å“ªä¸ªåŠ è½½å™¨åŠ è½½ï¼Œæœ€ç»ˆéƒ½ä¼šå§”æ‰˜åˆ° BootStrap ClassLoader è¿›è¡ŒåŠ è½½ï¼Œè¿™æ ·ä¿è¯äº†ä½¿ç”¨ä¸åŒçš„ç±»åŠ è½½å™¨å¾—åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ªç»“æœã€‚\nå…¶å®è¿™èµ·äº†ä¸€ä¸ªéš”ç¦»çš„ä½œç”¨ï¼Œé¿å…è‡ªå·±å†™çš„ä»£ç å½±å“JDKçš„ä»£ç \npackage java.lang; public class String { public static void main(String[] args) { System.out.println(); } } å°è¯•è¿è¡Œå½“å‰ç±»çš„ main å‡½æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„ä»£ç è‚¯å®šä¼šæŠ¥é”™ã€‚è¿™æ˜¯å› ä¸ºåœ¨åŠ è½½çš„æ—¶å€™å…¶å®æ˜¯æ‰¾åˆ°äº† rt.jar ä¸­çš„java.lang.Stringï¼Œç„¶è€Œå‘ç°è¿™ä¸ªé‡Œé¢å¹¶æ²¡æœ‰ main æ–¹æ³•ã€‚\nè¿è¡Œæ—¶æ•°æ®åŒº # æœ¬åœ°æ–¹æ³•æ ˆå’Œç¨‹åºè®¡æ•°å™¨ # æ¯”å¦‚è¯´æˆ‘ä»¬ç°åœ¨ç‚¹å¼€Threadç±»çš„æºç ï¼Œä¼šçœ‹åˆ°å®ƒçš„start0æ–¹æ³•å¸¦æœ‰ä¸€ä¸ªnativeå…³é”®å­—ä¿®é¥°ï¼Œè€Œä¸”ä¸å­˜åœ¨æ–¹æ³•ä½“ï¼Œè¿™ç§ç”¨nativeä¿®é¥°çš„æ–¹æ³•å°±æ˜¯æœ¬åœ°æ–¹æ³•ï¼Œè¿™æ˜¯ä½¿ç”¨Cæ¥å®ç°çš„ï¼Œç„¶åä¸€èˆ¬è¿™äº›æ–¹æ³•éƒ½ä¼šæ”¾åˆ°ä¸€ä¸ªå«åšæœ¬åœ°æ–¹æ³•æ ˆçš„åŒºåŸŸã€‚ ç¨‹åºè®¡æ•°å™¨å…¶å®å°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘äº†æˆ‘ä»¬ç¨‹åºä¸­ä¸‹ä¸€å¥éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œå®ƒä¹Ÿæ˜¯å†…å­˜åŒºåŸŸä¸­å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç°OutOfMemoryErrorçš„åŒºåŸŸï¼Œè€Œä¸”å ç”¨å†…å­˜ç©ºé—´å°åˆ°åŸºæœ¬å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚è¿™ä¸ªå†…å­˜ä»…ä»£è¡¨å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ï¼Œå­—èŠ‚ç è§£æå™¨é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚ å¦‚æœæ‰§è¡Œçš„æ˜¯nativeæ–¹æ³•ï¼Œé‚£è¿™ä¸ªæŒ‡é’ˆå°±ä¸å·¥ä½œäº† æ–¹æ³•åŒº # ä¸»è¦å­˜æ”¾ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¸¸é‡å’Œé™æ€å˜é‡\u0026hellip;ç­‰ã€‚ å­˜å‚¨è¿‡å¤§æ—¶ï¼Œä¼šåœ¨æ— æ³•æ»¡è¶³å†…å­˜åˆ†é…æ—¶æŠ¥é”™ è™šæ‹Ÿæœºæ ˆå’Œè™šæ‹Ÿæœºå † # æ ˆç®¡è¿è¡Œï¼Œå †ç®¡å­˜å‚¨ è™šæ‹Ÿæœºæ ˆè´Ÿè´£è¿è¡Œä»£ç ï¼Œè™šæ‹Ÿæœºå †è´Ÿè´£å­˜å‚¨æ•°æ® è™šæ‹Ÿæœºæ ˆçš„æ¦‚å¿µ # è™šæ‹Ÿæœºæ ˆæ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ å¯¹å±€éƒ¨å˜é‡ã€åŠ¨æ€é“¾è¡¨ã€æ–¹æ³•å‡ºå£ã€æ ˆçš„æ“ä½œ(å…¥æ ˆå’Œå‡ºæ ˆ)è¿›è¡Œå­˜å‚¨ï¼Œä¸”çº¿ç¨‹ç‹¬äº«ã€‚ å¦‚æœæˆ‘ä»¬å¬åˆ°å±€éƒ¨å˜é‡è¡¨ï¼Œå°±æ˜¯åœ¨è¯´è™šæ‹Ÿæœºæ ˆ public class Person{ int a = 1; public void doSomething(){ int b = 2; } } è™šæ‹Ÿæœºæ ˆå­˜åœ¨çš„å¼‚å¸¸ # å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆçš„æ·±åº¦ï¼Œå¤§äºè™šæ‹Ÿæœºæ ˆçš„æœ€å¤§æ·±åº¦ï¼Œå°±ä¼šæŠ¥StackOverflowError(æ¯”å¦‚é€’å½’) Javaè™šæ‹Ÿæœºä¹Ÿå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œä½†éšç€æ‰©å±•ä¼šä¸æ–­åœ°ç”³è¯·å†…å­˜ï¼Œå½“æ— æ³•ç”³è¯·è¶³å¤Ÿå†…å­˜æ—¶å°±ä¼šæŠ¥é”™ OutOfMemoryError è™šæ‹Ÿæœºæ ˆçš„ç”Ÿå‘½å‘¨æœŸ # æ ˆä¸å­˜åœ¨åƒåœ¾å›æ”¶ï¼Œåªè¦ç¨‹åºè¿è¡Œç»“æŸï¼Œæ ˆçš„ç©ºé—´è‡ªç„¶é‡Šæ”¾ æ ˆçš„ç”Ÿå‘½å‘¨æœŸå’Œæ‰€å¤„çš„çº¿ç¨‹ä¸€è‡´ 8ç§åŸºæœ¬ç±»å‹çš„å˜é‡+å¯¹è±¡çš„å¼•ç”¨å˜é‡+å®ä¾‹æ–¹æ³•ï¼Œéƒ½æ˜¯åœ¨æ ˆé‡Œé¢åˆ†é…å†…å­˜ è™šæ‹Ÿæœºæ ˆçš„æ‰§è¡Œ # æ ˆå¸§æ•°æ®ï¼Œåœ¨JVMä¸­å«æ ˆå¸§ï¼ŒJavaä¸­å«æ–¹æ³•ï¼Œå®ƒä¹Ÿæ˜¯æ”¾åœ¨æ ˆä¸­ æ ˆä¸­çš„æ•°æ®ä»¥æ ˆå¸§çš„æ ¼å¼å­˜åœ¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…³äºæ–¹æ³•å’Œè¿è¡ŒæœŸæ•°æ®çš„æ•°æ®é›† æ¯”å¦‚æˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªæ–¹æ³•aï¼Œå°±ä¼šå¯¹åº”äº§ç”Ÿä¸€ä¸ªæ ˆå¸§A1ï¼Œç„¶åA1ä¼šè¢«å‹å…¥æ ˆä¸­ã€‚åŒç†æ–¹æ³•bä¼šæœ‰ä¸€ä¸ªB1ï¼Œæ–¹æ³•cä¼šæœ‰ä¸€ä¸ªC1ï¼Œç­‰åˆ°è¿™ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œæ ˆä¼šå…ˆå¼¹å‡ºC1ï¼ŒåB1,A1ã€‚å®ƒæ˜¯ä¸€ä¸ªå…ˆè¿›åå‡ºï¼Œåè¿›å…ˆå‡ºåŸåˆ™ã€‚\nå±€éƒ¨å˜é‡çš„å¤ç”¨ # ç”¨äºå­˜æ”¾æ–¹æ³•å‚æ•°å’Œæ–¹æ³•å†…éƒ¨æ‰€å®šä¹‰çš„å±€éƒ¨å˜é‡\nå®¹é‡ä»¥Slotä¸ºæœ€å°å•ä½ï¼Œä¸€ä¸ªslotå¯ä»¥å­˜æ”¾32ä»¥å†…çš„æ•°æ®ç±»å‹ã€‚\nåœ¨å±€éƒ¨å˜é‡è¡¨é‡Œï¼Œ32ä½ä»¥å†…çš„ç±»å‹åªå ç”¨ä¸€ä¸ªslotï¼ˆåŒ…æ‹¬returnAddressç±»å‹ï¼‰ï¼Œ64ä½çš„ç±»å‹ï¼ˆlongå’Œdoubleï¼‰å ä¸¤ä¸ªslotã€‚\nè™šæ‹Ÿæœºé€šè¿‡ç´¢å¼•æ–¹å¼ä½¿ç”¨å±€éƒ¨å˜é‡è¡¨ï¼ŒèŒƒå›´ä¸º [ 0 , å±€éƒ¨å˜é‡è¡¨çš„slotçš„æ•°é‡ ]ã€‚æ–¹æ³•ä¸­çš„å‚æ•°å°±ä¼šæŒ‰ä¸€å®šé¡ºåºæ’åˆ—åœ¨è¿™ä¸ªå±€éƒ¨å˜é‡è¡¨ä¸­\nä¸ºäº†èŠ‚çœæ ˆå¸§ç©ºé—´ï¼Œè¿™äº›slotæ˜¯å¯ä»¥å¤ç”¨çš„ã€‚å½“æ–¹æ³•æ‰§è¡Œä½ç½®è¶…è¿‡äº†æŸä¸ªå˜é‡ï¼ˆè¿™é‡Œæ„æ€åº”è¯¥æ˜¯ç”¨è¿‡äº†è¿™ä¸ªå˜é‡ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡çš„slotå¯ä»¥è¢«å…¶å®ƒå˜é‡å¤ç”¨ã€‚å½“ç„¶å¦‚æœéœ€è¦å¤ç”¨ï¼Œé‚£æˆ‘ä»¬çš„åƒåœ¾å›æ”¶è‡ªç„¶å°±ä¸ä¼šå»åŠ¨è¿™äº›å†…å­˜\nè™šæ‹Ÿæœºå †çš„æ¦‚å¿µ # JVMå†…å­˜ä¼šåˆ’åˆ†ä¸ºå †å†…å­˜å’Œéå †å†…å­˜ï¼Œå †å†…å­˜ä¹Ÿä¼šåˆ’åˆ†ä¸ºå¹´è½»ä»£å’Œè€å¹´ä»£ï¼Œè€Œéå †å†…å­˜åˆ™ä¸ºæ°¸ä¹…ä»£ã€‚\nå¹´è½»ä»£åˆåˆ†ä¸ºEdenå’ŒSurvivoråŒºï¼ŒSurvivorè¿˜åˆ†ä¸ºFromPlaceå’ŒToPlaceï¼ŒtoPlaceçš„survivoråŒºåŸŸæ˜¯ç©ºçš„\nEdenï¼šFromPlaceï¼šToPlaceçš„é»˜è®¤å æ¯”æ˜¯8ï¼š1ï¼š1ï¼Œå½“ç„¶è¿™ä¸ªä¸œè¥¿ä¹Ÿå¯ä»¥é€šè¿‡ä¸€ä¸ª-XX:+UsePSAdaptiveSurvivorSizePolicyå‚æ•°æ¥æ ¹æ®ç”Ÿæˆå¯¹è±¡çš„é€Ÿç‡åŠ¨æ€è°ƒæ•´\nï¼ˆå› ä¸ºå­˜æ´»çš„å¯¹è±¡ç›¸å¯¹è¾ƒå°‘ï¼‰\nå †å†…å­˜ä¸­å­˜æ”¾çš„æ˜¯å¯¹è±¡ï¼Œåƒåœ¾æ”¶é›†å°±æ˜¯æ”¶é›†è¿™äº›å¯¹è±¡ç„¶åäº¤ç»™GCç®—æ³•è¿›è¡Œå›æ”¶ã€‚éå †å†…å­˜å…¶å®æˆ‘ä»¬å·²ç»è¯´è¿‡äº†ï¼Œå°±æ˜¯æ–¹æ³•åŒºã€‚åœ¨1.8ä¸­å·²ç»ç§»é™¤æ°¸ä¹…ä»£ï¼Œæ›¿ä»£å“æ˜¯ä¸€ä¸ªå…ƒç©ºé—´(MetaSpace)ï¼Œæœ€å¤§åŒºåˆ«æ˜¯metaSpaceæ˜¯ä¸å­˜åœ¨äºJVMä¸­çš„ï¼Œå®ƒä½¿ç”¨çš„æ˜¯æœ¬åœ°å†…å­˜ã€‚å¹¶æœ‰ä¸¤ä¸ªå‚æ•°ï¼š\nMetaspaceSizeï¼šåˆå§‹åŒ–å…ƒç©ºé—´å¤§å°ï¼Œæ§åˆ¶å‘ç”ŸGC MaxMetaspaceSizeï¼šé™åˆ¶å…ƒç©ºé—´å¤§å°ä¸Šé™ï¼Œé˜²æ­¢å ç”¨è¿‡å¤šç‰©ç†å†…å­˜ã€‚ ç§»é™¤çš„åŸå› \nèåˆHotSpot JVMå’ŒJRockit VMè€Œåšå‡ºçš„æ”¹å˜ï¼Œå› ä¸ºJRockitæ˜¯æ²¡æœ‰æ°¸ä¹…ä»£çš„ï¼Œä¸è¿‡è¿™ä¹Ÿé—´æ¥æ€§åœ°è§£å†³äº†æ°¸ä¹…ä»£çš„OOMé—®é¢˜ã€‚\nEdenå¹´è½»ä»£çš„ä»‹ç» # å½“newä¸€ä¸ªå¯¹è±¡åï¼Œä¼šæ”¾åˆ°Edenåˆ’åˆ†å‡ºæ¥çš„ä¸€å—ä½œä¸ºå­˜å‚¨ç©ºé—´çš„å†…å­˜ï¼Œç”±äºå †å†…å­˜å…±äº«ï¼Œæ‰€ä»¥å¯èƒ½å‡ºç°ä¸¤ä¸ªå¯¹è±¡å…±ç”¨ä¸€ä¸ªå†…å­˜çš„æƒ…å†µã€‚\nJVMçš„å¤„ç†ï¼šä¸ºæ¯ä¸ªå†…å­˜éƒ½é¢„å…ˆç”³è¯·å¥½ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´å¹¶è§„å®šå¯¹è±¡å­˜æ”¾çš„ä½ç½®ï¼Œå¦‚æœç©ºé—´ä¸è¶³ä¼šå†ç”³è¯·å¤šå—å†…å­˜ç©ºé—´ã€‚è¿™ä¸ªæ“ä½œç§°ä¸ºTLAB\nEdenç©ºé—´æ»¡äº†ä¹‹åï¼Œä¼šè§¦å‘MinorGCï¼ˆå‘ç”Ÿåœ¨å¹´è½»ä»£çš„GCï¼‰æ“ä½œï¼Œå­˜æ´»ä¸‹æ¥çš„å¯¹è±¡ç§»åŠ¨åˆ°Survivor0åŒºã€‚Survivor0æ»¡åä¼šè§¦å‘MInorGCï¼Œå°†å­˜æ´»å¯¹è±¡ï¼ˆè¿™é‡Œåº”è¯¥åŒ…æ‹¬Edençš„å­˜æ´»å¯¹è±¡?ï¼‰ç§»åŠ¨åˆ°Survivor1åŒºï¼Œæ­¤æ—¶è¿˜ä¼šæŠŠfromå’Œtoä¸¤ä¸ªæŒ‡é’ˆäº¤æ¢ï¼Œè¿™æ ·ä¿è¯ä¸€æ®µæ—¶é—´å†…æ€»æœ‰ä¸€ä¸ªsurvivoråŒºä¸ºç©ºä¸”æ‰€æŒ‡å‘çš„survivoråŒºä¸ºç©ºã€‚\nç»è¿‡å¤šæ¬¡çš„MinorGCåä»ç„¶å­˜æ´»çš„å¯¹è±¡(è¿™é‡Œå­˜æ´»åˆ¤æ–­æ˜¯15æ¬¡ï¼Œå¯¹åº”çš„è™šæ‹Ÿæœºå‚æ•°ä¸º-XX:MaxTenuringThreshold ã€‚HotSpotä¼šåœ¨å¯¹è±¡ä¸­çš„æ ‡è®°å­—æ®µé‡Œè®°å½•å¹´é¾„ï¼Œåˆ†é…åˆ°çš„ç©ºé—´ä»…æœ‰4ä½ï¼Œæ‰€ä»¥æœ€å¤šè®°å½•åˆ°15)ä¼šç§»åŠ¨åˆ°è€å¹´ä»£ã€‚\nè€å¹´ä»£æ˜¯å­˜å‚¨é•¿æœŸå­˜æ´»å¯¹è±¡çš„ï¼Œå æ»¡æ—¶å°±ä¼šè§¦å‘æˆ‘ä»¬å¸¸è¯´çš„FullGCï¼ŒæœŸé—´ä¼šåœæ­¢æ‰€æœ‰çº¿ç¨‹ç­‰å¾…GCçš„å®Œæˆã€‚æ‰€ä»¥å¯¹äºå“åº”è¦æ±‚é«˜çš„åº”ç”¨ï¼Œåº”è¯¥å°½é‡å»å‡å°‘å‘ç”ŸFullGCä»è€Œé¿å…å“åº”è¶…æ—¶çš„é—®é¢˜\nå½“è€å¹´åŒºæ‰§è¡Œfull gcå‘¨ä»ç„¶æ— æ³•è¿›è¡Œå¯¹è±¡ä¿å­˜æ“ä½œï¼Œå°±ä¼šäº§ç”ŸOOMã€‚è¿™æ—¶å€™å°±æ˜¯è™šæ‹Ÿæœºä¸­å †å†…å­˜ä¸è¶³ï¼ŒåŸå› å¯èƒ½ä¼šæ˜¯å †å†…å­˜è®¾ç½®å¤§å°è¿‡å°ï¼Œå¯ä»¥é€šè¿‡å‚æ•°**-Xmsã€-Xmxæ¥è°ƒæ•´ã€‚ä¹Ÿå¯èƒ½æ˜¯ä»£ç ä¸­åˆ›å»ºå¯¹è±¡å¤§ä¸”å¤š**ï¼Œè€Œä¸”å®ƒä»¬ä¸€ç›´åœ¨è¢«å¼•ç”¨ä»è€Œé•¿æ—¶é—´åƒåœ¾æ”¶é›†æ— æ³•æ”¶é›†å®ƒä»¬\nå…³äº-XX:TargetSurvivorRatioå‚æ•°çš„é—®é¢˜ã€‚å…¶å®ä¹Ÿä¸ä¸€å®šæ˜¯è¦æ»¡è¶³-XX:MaxTenuringThresholdæ‰ç§»åŠ¨åˆ°è€å¹´ä»£ã€‚å¯ä»¥ä¸¾ä¸ªä¾‹å­ï¼šå¦‚**å¯¹è±¡å¹´é¾„5çš„å 30%ï¼Œå¹´é¾„6çš„å 36%ï¼Œå¹´é¾„7çš„å 34%ï¼ŒåŠ å…¥æŸä¸ªå¹´é¾„æ®µï¼ˆå¦‚ä¾‹å­ä¸­çš„å¹´é¾„6ï¼‰**åï¼Œæ€»å ç”¨è¶…è¿‡Survivorç©ºé—´*TargetSurvivorRatioçš„æ—¶å€™ï¼Œä»è¯¥å¹´é¾„æ®µå¼€å§‹åŠå¤§äºçš„å¹´é¾„å¯¹è±¡å°±è¦è¿›å…¥è€å¹´ä»£ï¼ˆå³ä¾‹å­ä¸­çš„å¹´é¾„6å¯¹è±¡ï¼Œå°±æ˜¯å¹´é¾„6å’Œå¹´é¾„7æ™‹å‡åˆ°è€å¹´ä»£ï¼‰ï¼Œè¿™æ—¶å€™æ— éœ€ç­‰åˆ°MaxTenuringThresholdä¸­è¦æ±‚çš„15\nå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡éœ€è¦è¢«å¹²æ‰ # é¦–å…ˆçœ‹ä¸€ä¸‹å¯¹è±¡çš„è™šæ‹Ÿæœºçš„ä¸€äº›æµç¨‹\nå›¾ä¾‹æœ‰ç‚¹é—®é¢˜ï¼Œæ©™è‰²æ˜¯çº¿ç¨‹å…±äº«ï¼Œé’ç»¿è‰²æ˜¯çº¿ç¨‹ç‹¬äº« å›¾ä¸­ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆï¼Œ3ä¸ªåŒºåŸŸéšç€çº¿ç¨‹ç”Ÿå­˜è€Œç”Ÿå­˜ã€‚å†…å­˜åˆ†é…å’Œå›æ”¶éƒ½æ˜¯ç¡®å®šçš„ï¼Œéšç€çº¿ç¨‹çš„ç»“æŸå†…å­˜è‡ªç„¶å°±è¢«å›æ”¶äº†ï¼Œå› æ­¤ä¸éœ€è¦è€ƒè™‘åƒåœ¾å›æ”¶é—®é¢˜ã€‚\nJavaå †å’Œæ–¹æ³•åŒºåˆ™ä¸ä¸€æ ·ï¼Œå„çº¿ç¨‹å…±äº«ï¼Œå†…å­˜çš„åˆ†é…å’Œå›æ”¶éƒ½æ˜¯åŠ¨æ€çš„ï¼Œåƒåœ¾æ”¶é›†å™¨æ‰€å…³æ³¨çš„å°±æ˜¯å †å’Œæ–¹æ³•åŒºè¿™éƒ¨åˆ†å†…å­˜\nåƒåœ¾å›æ”¶å‰ï¼Œåˆ¤æ–­å“ªäº›å¯¹è±¡è¿˜å­˜æ´»ï¼Œå“ªäº›å·²ç»æ­»å»ã€‚ä¸‹é¢ä»‹ç»è¿ä¸ªåŸºç¡€è®¡ç®—æ–¹æ³•ï¼š\nå¼•ç”¨è®¡æ•°å™¨è®¡ç®—ï¼šç»™å¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯æ¬¡å¼•ç”¨è¿™ä¸ªå¯¹è±¡æ—¶è®¡æ•°å™¨åŠ ä¸€ï¼Œå¼•ç”¨å¤±æ•ˆæ—¶å‡ä¸€ï¼Œè®¡æ•°å™¨ç­‰äº0å°±æ˜¯ä¸ä¼šå†æ¬¡ä½¿ç”¨çš„ã€‚ä¸è¿‡æœ‰ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯ å‡ºç°å¯¹è±¡çš„å¾ªç¯å¼•ç”¨æ—¶GCæ²¡æ³•å›æ”¶ï¼ˆæˆ‘è§‰å¾—ä¸æ˜¯éå¾—å¾ªç¯ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡aä¸­æœ‰å±æ€§å¼•ç”¨å¦ä¸€ä¸ªå¯¹è±¡bï¼Œè€ŒaæŒ‡å‘nullï¼Œé‚£ä¹ˆæŒ‰è¿™ç§æ–¹å¼ï¼Œbå°±æ²¡æœ‰åŠæ³•è¢«å›æ”¶ï¼‰ã€‚\nå¯è¾¾æ€§åˆ†æè®¡ç®—ï¼šä¸€ç§ç±»ä¼¼äºŒå‰æ ‘çš„å®ç°ï¼Œå°†ä¸€ç³»åˆ—çš„GC ROOTSä½œä¸ºèµ·å§‹çš„å­˜æ´»å¯¹è±¡é›†ï¼Œä»è¿™ä¸ªç»“ç‚¹å¾€ä¸‹æœç´¢ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„æˆä¸ºå¼•ç”¨é“¾ï¼ŒæŠŠèƒ½è¢«è¯¥é›†åˆå¼•ç”¨åˆ°çš„å¯¹è±¡åŠ å…¥è¯¥é›†åˆä¸­ã€‚\nå½“ä¸€ä¸ªå¯¹è±¡åˆ°GC Rootsæ²¡æœ‰ä½¿ç”¨ä»»ä½•å¼•ç”¨é“¾æ—¶ï¼Œåˆ™è¯´æ˜è¯¥å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚Javaï¼ŒC#éƒ½æ˜¯ç”¨è¿™ä¸ªæ–¹æ³•åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»\nJavaè¯­è¨€æ±‡æ€»ä½œä¸ºGCRootsçš„å¯¹è±¡åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š\nè™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°æ–¹æ³•è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ï¼ˆå±€éƒ¨å˜é‡ï¼‰\næ–¹æ³•åŒºä¸­é™æ€å˜é‡æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼ˆé™æ€å˜é‡ï¼‰\næ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å˜é‡\næœ¬åœ°æ–¹æ³•æ ˆï¼ˆå³nativeä¿®é¥°çš„æ–¹æ³•ï¼‰ä¸­JNIå¼•ç”¨çš„å¯¹è±¡\nï¼ˆJNIæ˜¯Javaè™šæ‹Ÿæœºè°ƒç”¨å¯¹åº”çš„Cå‡½æ•°çš„æ–¹å¼ï¼Œé€šè¿‡JNIå‡½æ•°ä¹Ÿå¯ä»¥åˆ›å»ºæ–°çš„Javaå¯¹è±¡ã€‚ä¸”JNIå¯¹äºå¯¹è±¡çš„å±€éƒ¨å¼•ç”¨æˆ–è€…å…¨å±€å¼•ç”¨éƒ½ä¼šæŠŠå®ƒä»¬æŒ‡å‘çš„å¯¹è±¡éƒ½æ ‡è®°ä¸ºä¸å¯å›æ”¶ï¼‰\nå·²å¯åŠ¨çš„ä¸”æœªç»ˆæ­¢çš„Javaçº¿ç¨‹ã€è¿™ä¸ªæè¿°å¥½åƒæ˜¯æœ‰é—®é¢˜çš„(ä¸å…¨)ï¼Œåº”è¯¥æ˜¯ç”¨ä½œåŒæ­¥ç›‘è§†å™¨çš„å¯¹è±¡ã€‘\nè¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯ï¼Œèƒ½å¤Ÿè§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œå¯å®ƒçš„å®ç°è€—è´¹å¤§é‡èµ„æºå’Œæ—¶é—´ï¼Œä¹Ÿéœ€è¦GC(åˆ†æè¿‡ç¨‹å¼•ç”¨å…³ç³»ä¸èƒ½å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦åœæ­¢æ‰€æœ‰è¿›ç¨‹)\nå¦‚ä½•å®£å‘Šä¸€ä¸ªå¯¹è±¡çš„çœŸæ­£æ­»äº¡ # é¦–å…ˆï¼Œéœ€è¦æåˆ°finalize()æ–¹æ³•ï¼Œæ˜¯Objectç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªå¯¹è±¡çš„finalize()æ–¹æ³•åªä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡ï¼Œç»è¿‡finalize()æ–¹æ³•é€ƒè„±æ­»äº¡çš„å¯¹è±¡(æ¯”å¦‚åœ¨æ–¹æ³•ä¸­ï¼Œå…¶ä»–å˜é‡åˆä¸€æ¬¡å¼•ç”¨äº†è¯¥å¯¹è±¡)ï¼Œç¬¬äºŒæ¬¡ä¸ä¼šå†è¢«è°ƒç”¨\nå¹¶ä¸æå€¡åœ¨ç¨‹åºä¸­è°ƒç”¨finalize()æ¥è¿›è¡Œè‡ªæ•‘ã€‚å»ºè®®å¿˜æ‰Javaç¨‹åºä¸­è¯¥æ–¹æ³•çš„å­˜åœ¨ã€‚å› ä¸ºå®ƒæ‰§è¡Œçš„æ—¶é—´ä¸ç¡®å®šï¼Œç”šè‡³æ˜¯å¦è¢«æ‰§è¡Œä¹Ÿä¸ç¡®å®šï¼ˆJavaç¨‹åºçš„ä¸æ­£å¸¸é€€å‡ºï¼‰ï¼Œè€Œä¸”è¿è¡Œä»£ä»·é«˜æ˜‚ï¼Œæ— æ³•ä¿è¯å„ä¸ªå¯¹è±¡çš„è°ƒç”¨é¡ºåºï¼ˆç”šè‡³æœ‰ä¸åŒçº¿ç¨‹ä¸­è°ƒç”¨ï¼‰ã€‚åœ¨Java9ä¸­å·²ç»è¢«æ ‡è®°ä¸º deprecated ï¼Œä¸” java.lang.ref.Cleanerï¼ˆä¹Ÿå°±æ˜¯å¼ºã€è½¯ã€å¼±ã€å¹»è±¡å¼•ç”¨çš„é‚£ä¸€å¥—ï¼‰ä¸­å·²ç»é€æ­¥æ›¿æ¢æ‰å®ƒï¼Œä¼šæ¯” finalize æ¥\ndeprecatedè‹±[ËˆdeprÉ™keÉªtÉªd]ç¾[ËˆdeprÉ™keÉªtÉªd]\nåˆ¤æ–­ä¸€ä¸ªå¯¹è±¡çš„æ­»äº¡è‡³å°‘éœ€è¦ä¸¤æ¬¡æ ‡è®°\nå¦‚æœå¯¹è±¡å¯è¾¾æ€§åˆ†æä¹‹åæ²¡å‘ç°ä¸GC Rootsç›¸è¿çš„å¼•ç”¨é“¾ï¼Œé‚£å®ƒå°†ä¼šè¢«ç¬¬ä¸€æ¬¡æ ‡è®°å¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œåˆ¤æ–­æ¡ä»¶æ˜¯æ˜¯å†³å®š**è¿™ä¸ªå¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinalize()**æ–¹æ³•ã€‚å¦‚æœå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œfinalize()ï¼Œåˆ™è¢«æ”¾å…¥F-Queueé˜Ÿåˆ— GCå †F-Queueé˜Ÿåˆ—ä¸­çš„å¯¹è±¡è¿›è¡ŒäºŒæ¬¡æ ‡è®°ã€‚å¦‚æœå¯¹è±¡åœ¨finalize()æ–¹æ³•ä¸­é‡æ–°ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹äº†å…³è”ï¼Œé‚£ä¹ˆäºŒæ¬¡æ ‡è®°æ—¶åˆ™ä¼šå°†å®ƒç§»å‡ºâ€œå³å°†å›æ”¶â€é›†åˆã€‚å¦‚æœæ­¤æ—¶å¯¹è±¡è¿˜æ²¡æˆåŠŸé€ƒè„±ï¼Œé‚£ä¹ˆåªèƒ½è¢«å›æ”¶äº†ã€‚ åƒåœ¾å›æ”¶ç®—æ³• # ç¡®å®šå¯¹è±¡å·²ç»æ­»äº¡ï¼Œæ­¤åˆ»éœ€è¦å›æ”¶è¿™äº›åƒåœ¾ã€‚å¸¸ç”¨çš„æœ‰æ ‡è®°æ¸…é™¤ã€å¤åˆ¶ã€æ ‡è®°æ•´ç†ã€å’Œåˆ†ä»£æ”¶é›†ç®—æ³•ã€‚\næ ‡è®°æ¸…é™¤ç®—æ³• # æ ‡è®°æ¸…é™¤ç®—æ³•å°±æ˜¯åˆ†ä¸º**â€æ ‡è®°â€œå’Œâ€æ¸…é™¤â€œ**ä¸¤ä¸ªé˜¶æ®µã€‚æ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œæ ‡è®°ç»“æŸåç»Ÿä¸€å›æ”¶ã€‚åç»­ç®—æ³•éƒ½æ ¹æ®è¿™ä¸ªåŸºç¡€æ¥åŠ ä»¥æ”¹è¿› å³ï¼šæŠŠå·²æ­»äº¡çš„å¯¹è±¡æ ‡è®°ä¸ºç©ºé—²å†…å­˜ï¼Œç„¶åè®°å½•åœ¨ç©ºé—²åˆ—è¡¨ä¸­ï¼Œå½“æˆ‘ä»¬éœ€è¦newä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå†…å­˜ç®¡ç†æ¨¡å—ä¼šä»ç©ºé—²åˆ—è¡¨ä¸­å¯»æ‰¾ç©ºé—²çš„å†…å­˜æ¥åˆ†ç»™æ–°çš„å¯¹è±¡ ä¸è¶³æ–¹é¢ï¼šæ ‡è®°å’Œæ¸…é™¤æ•ˆç‡æ¯”è¾ƒä½ï¼Œä¸”è¿™ç§åšæ³•è®©å†…å­˜ä¸­ç¢ç‰‡éå¸¸å¤š ã€‚å¯¼è‡´å¦‚æœæˆ‘ä»¬éœ€è¦ä½¿ç”¨è¾ƒå¤§å†…å­˜å¡æ—¶ï¼Œæ— æ³•åˆ†é…åˆ°è¶³å¤Ÿçš„è¿ç»­å†…å­˜ å¦‚å›¾ï¼Œå¯ä½¿ç”¨çš„å†…å­˜éƒ½æ˜¯é›¶é›¶æ•£æ•£çš„ï¼Œå¯¼è‡´å¤§å†…å­˜å¯¹è±¡é—®é¢˜ å¤åˆ¶ç®—æ³• # ä¸ºäº†è§£å†³æ•ˆç‡é—®é¢˜ï¼Œå‡ºç°äº†å¤åˆ¶ç®—æ³•ã€‚å°†å†…å­˜æŒ‰å®¹é‡åˆ’åˆ†æˆä¸¤ç­‰ä»½ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—ï¼Œå’Œsurvivorä¸€æ ·ç”¨fromå’Œtoä¸¤ä¸ªæŒ‡é’ˆã€‚fromPlaceå­˜æ»¡äº†ï¼Œå°±æŠŠå­˜æ´»å¯¹è±¡copyåˆ°å¦ä¸€å—toPlaceä¸Šï¼Œç„¶åäº¤æ¢æŒ‡é’ˆå†…å®¹ï¼Œå°±è§£å†³äº†ç¢ç‰‡é—®é¢˜\nä»£ä»·ï¼šå†…å­˜ç¼©æ°´ï¼Œå³å †å†…å­˜çš„ä½¿ç”¨æ•ˆç‡å˜ä½äº† é»˜è®¤æƒ…å†µEdenå’ŒSurvivor ä¸º 8: 2 ï¼ˆEden : S0 : S1 = 8ï¼š1ï¼š1ï¼‰\næ ‡è®°æ•´ç† # å¤åˆ¶ç®—æ³•åœ¨å¯¹è±¡å­˜æ´»ç‡é«˜çš„æ—¶å€™ï¼Œä»ç„¶æœ‰æ•ˆç‡é—®é¢˜ï¼ˆè¦å¤åˆ¶çš„å¤šï¼‰ã€‚ æ ‡è®°æ•´ç†\u0026ndash;\u0026gt; æ ‡è®°è¿‡ç¨‹ä¸æ ‡è®°-æ¸…é™¤ä¸€æ ·ï¼Œä½†åç»­ä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰è¾¹ç•Œä»¥å¤–å†…å­˜ åˆ†ä»£æ”¶é›†ç®—æ³• # è¿™ç§ç®—æ³•å¹¶æ²¡æœ‰ä»€ä¹ˆæ–°çš„æ€æƒ³ï¼Œåªæ˜¯æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å— ä¸€èˆ¬æ˜¯å°†Javaå †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œå³å¯æ ¹æ®å„ä¸ªå¹´ä»£ç‰¹ç‚¹é‡‡ç”¨æœ€é€‚å½“çš„æ”¶é›†ç®—æ³• æ–°ç”Ÿä»£ä¸­ï¼Œæ¯æ¬¡åƒåœ¾æ”¶é›†æ—¶ä¼šæœ‰å¤§æ‰¹å¯¹è±¡æ­»å»ï¼Œåªæœ‰å°‘é‡å­˜æ´»ï¼Œå°±é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œåªéœ€è¦ä»˜å‡ºå°‘é‡å­˜æ´»å¯¹è±¡çš„å¤åˆ¶æˆæœ¬å³å¯å®Œæˆæ”¶é›† è€å¹´ä»£ä¸­ï¼Œå› ä¸ºå­˜æ´»å¯¹è±¡å­˜æ´»ç‡é«˜ï¼Œä¹Ÿæ²¡æœ‰é¢å¤–ç©ºé—´å¯¹å®ƒè¿›è¡Œåˆ†é…æ‹…ä¿ï¼ˆæ–°ç”Ÿä»£å¦‚æœä¸å¤Ÿå¯ä»¥æ”¾è€å¹´ä»£ï¼Œè€Œè€å¹´ä»£æ¸…ç†å¤±è´¥å°±ä¼šOutOfMemoryï¼Œä¸åƒæ–°ç”Ÿä»£å¯ä»¥ç§»åŠ¨åˆ°è€å¹´ä»£ï¼‰ï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨**â€œæ ‡è®°-æ¸…ç†â€æˆ–è€…â€œæ ‡è®°-æ•´ç†â€**æ¥è¿›è¡Œå›æ”¶ å³ï¼šå…·ä½“é—®é¢˜å…·ä½“åˆ†æ ï¼ˆäº†è§£ï¼‰å„ç§å„æ ·çš„åƒåœ¾å›æ”¶å™¨ # æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶å™¨ï¼šSerialï¼ˆä¸²è¡Œ\u0026ndash;å¤åˆ¶ï¼‰ï¼ŒParNewï¼ˆå¹¶è¡Œ\u0026ndash;å¤åˆ¶ï¼‰ï¼ŒParallelScavengeï¼ˆå¹¶è¡Œ\u0026ndash;å¤åˆ¶ï¼‰\nè€å¹´ä»£çš„åƒåœ¾å›æ”¶å™¨ï¼šSerialOldï¼ˆä¸²è¡Œ\u0026ndash;æ ‡è®°æ•´ç†ï¼‰ï¼ŒParallelOldï¼ˆå¹¶è¡Œ\u0026ndash;æ ‡è®°æ•´ç†ï¼‰ï¼ŒCMSï¼ˆå¹¶å‘\u0026ndash;æ ‡è®°æ¸…é™¤ï¼‰\nåªæœ‰CMSå’ŒG1æ˜¯å¹¶å‘ï¼Œä¸”CMSåªä½œç”¨äºè€å¹´ä»£ï¼Œè€ŒG1éƒ½æœ‰\nJDK8ä¸ºæ­¢ï¼Œé»˜è®¤åƒåœ¾å›æ”¶å™¨æ˜¯Parallel Scavengeå’ŒParallel Oldã€å¹¶è¡Œ\u0026ndash;å¤åˆ¶å’Œå¹¶è¡Œ\u0026ndash;æ ‡è®°æ•´ç†ã€‘\nJDK9å¼€å§‹ï¼ŒG1æ”¶é›†å™¨æˆä¸ºé»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨ï¼Œç›®å‰æ¥çœ‹ï¼ŒG1å›æ”¶æœŸåœé¡¿æ—¶é—´æœ€çŸ­ä¸”æ²¡æœ‰æ˜æ˜¾ç¼ºç‚¹ï¼Œåé€‚åˆWebåº”ç”¨\njdk8ä¸­æµ‹è¯•Webåº”ç”¨ï¼Œå †å†…å­˜6Gä¸­æ–°ç”Ÿä»£4.5Gçš„æƒ…å†µä¸‹\nParallelScavengeå›æ”¶æ–°ç”Ÿä»£åœé¡¿é•¿è¾¾1.5ç§’ã€‚ G1å›æ”¶å™¨å›æ”¶åŒæ ·å¤§å°çš„æ–°ç”Ÿä»£åªåœé¡¿0.2ç§’ ï¼ˆäº†è§£ï¼‰ JVMçš„å¸¸ç”¨å‚æ•° # JVMçš„å‚æ•°éå¸¸ä¹‹å¤šï¼Œè¿™é‡Œåªåˆ—ä¸¾æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªï¼Œé€šè¿‡å„ç§å„æ ·çš„æœç´¢å¼•æ“ä¹Ÿå¯ä»¥å¾—çŸ¥è¿™äº›ä¿¡æ¯ã€‚\nå‚æ•°åç§° å«ä¹‰ é»˜è®¤å€¼ è¯´æ˜ -Xms åˆå§‹å †å¤§å° ç‰©ç†å†…å­˜çš„1/64(\u0026lt;1GB) é»˜è®¤(MinHeapFreeRatioå‚æ•°å¯ä»¥è°ƒæ•´)ç©ºä½™å †å†…å­˜å°äº40%æ—¶ï¼ŒJVMå°±ä¼šå¢å¤§å †ç›´åˆ°-Xmxçš„æœ€å¤§é™åˆ¶. -Xmx æœ€å¤§å †å¤§å° ç‰©ç†å†…å­˜çš„1/4(\u0026lt;1GB) é»˜è®¤(MaxHeapFreeRatioå‚æ•°å¯ä»¥è°ƒæ•´)ç©ºä½™å †å†…å­˜å¤§äº70%æ—¶ï¼ŒJVMä¼šå‡å°‘å †ç›´åˆ° -Xmsçš„æœ€å°é™åˆ¶ -Xmn å¹´è½»ä»£å¤§å°(1.4or later) æ³¨æ„ï¼šæ­¤å¤„çš„å¤§å°æ˜¯ï¼ˆeden+ 2 survivor space).ä¸jmap -heapä¸­æ˜¾ç¤ºçš„New genæ˜¯ä¸åŒçš„ã€‚æ•´ä¸ªå †å¤§å°=å¹´è½»ä»£å¤§å° + è€å¹´ä»£å¤§å° + æŒä¹…ä»£ï¼ˆæ°¸ä¹…ä»£ï¼‰å¤§å°.å¢å¤§å¹´è½»ä»£å,å°†ä¼šå‡å°å¹´è€ä»£å¤§å°.æ­¤å€¼å¯¹ç³»ç»Ÿæ€§èƒ½å½±å“è¾ƒå¤§,Sunå®˜æ–¹æ¨èé…ç½®ä¸ºæ•´ä¸ªå †çš„3/8 -XX:NewSize è®¾ç½®å¹´è½»ä»£å¤§å°(for 1.3/1.4) -XX:MaxNewSize å¹´è½»ä»£æœ€å¤§å€¼(for 1.3/1.4) -XX:PermSize è®¾ç½®æŒä¹…ä»£(perm gen)åˆå§‹å€¼ ç‰©ç†å†…å­˜çš„1/64 -XX:MaxPermSize è®¾ç½®æŒä¹…ä»£æœ€å¤§å€¼ ç‰©ç†å†…å­˜çš„1/4 -Xss æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆå¤§å° JDK5.0ä»¥åæ¯ä¸ªçº¿ç¨‹å †æ ˆå¤§å°ä¸º1M,ä»¥å‰æ¯ä¸ªçº¿ç¨‹å †æ ˆå¤§å°ä¸º256K.æ ¹æ®åº”ç”¨çš„çº¿ç¨‹æ‰€éœ€å†…å­˜å¤§å°è¿›è¡Œ è°ƒæ•´.åœ¨ç›¸åŒç‰©ç†å†…å­˜ä¸‹,å‡å°è¿™ä¸ªå€¼èƒ½ç”Ÿæˆæ›´å¤šçš„çº¿ç¨‹.ä½†æ˜¯æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹æ•°è¿˜æ˜¯æœ‰é™åˆ¶çš„,ä¸èƒ½æ— é™ç”Ÿæˆ,ç»éªŒå€¼åœ¨3000~5000å·¦å³ä¸€èˆ¬å°çš„åº”ç”¨ï¼Œ å¦‚æœæ ˆä¸æ˜¯å¾ˆæ·±ï¼Œ åº”è¯¥æ˜¯128kå¤Ÿç”¨çš„ å¤§çš„åº”ç”¨å»ºè®®ä½¿ç”¨256kã€‚è¿™ä¸ªé€‰é¡¹å¯¹æ€§èƒ½å½±å“æ¯”è¾ƒå¤§ï¼Œéœ€è¦ä¸¥æ ¼çš„æµ‹è¯•ã€‚ï¼ˆæ ¡é•¿ï¼‰å’Œthreadstacksizeé€‰é¡¹è§£é‡Šå¾ˆç±»ä¼¼,å®˜æ–¹æ–‡æ¡£ä¼¼ä¹æ²¡æœ‰è§£é‡Š,åœ¨è®ºå›ä¸­æœ‰è¿™æ ·ä¸€å¥è¯:-Xss is translated in a VM flag named ThreadStackSizeâ€ä¸€èˆ¬è®¾ç½®è¿™ä¸ªå€¼å°±å¯ä»¥äº† -XX:NewRatio å¹´è½»ä»£(åŒ…æ‹¬Edenå’Œä¸¤ä¸ªSurvivoråŒº)ä¸å¹´è€ä»£çš„æ¯”å€¼(é™¤å»æŒä¹…ä»£) -XX:NewRatio=4è¡¨ç¤ºå¹´è½»ä»£ä¸å¹´è€ä»£æ‰€å æ¯”å€¼ä¸º1:4,å¹´è½»ä»£å æ•´ä¸ªå †æ ˆçš„1/5Xms=Xmxå¹¶ä¸”è®¾ç½®äº†Xmnçš„æƒ…å†µä¸‹ï¼Œè¯¥å‚æ•°ä¸éœ€è¦è¿›è¡Œè®¾ç½®ã€‚ -XX:SurvivorRatio EdenåŒºä¸SurvivoråŒºçš„å¤§å°æ¯”å€¼ è®¾ç½®ä¸º8,åˆ™ä¸¤ä¸ªSurvivoråŒºä¸ä¸€ä¸ªEdenåŒºçš„æ¯”å€¼ä¸º2:8,ä¸€ä¸ªSurvivoråŒºå æ•´ä¸ªå¹´è½»ä»£çš„1/10 -XX:+DisableExplicitGC å…³é—­System.gc() è¿™ä¸ªå‚æ•°éœ€è¦ä¸¥æ ¼çš„æµ‹è¯• -XX:PretenureSizeThreshold å¯¹è±¡è¶…è¿‡å¤šå¤§æ˜¯ç›´æ¥åœ¨æ—§ç”Ÿä»£åˆ†é… 0 å•ä½å­—èŠ‚ æ–°ç”Ÿä»£é‡‡ç”¨Parallel ScavengeGCæ—¶æ— æ•ˆå¦ä¸€ç§ç›´æ¥åœ¨æ—§ç”Ÿä»£åˆ†é…çš„æƒ…å†µæ˜¯å¤§çš„æ•°ç»„å¯¹è±¡,ä¸”æ•°ç»„ä¸­æ— å¤–éƒ¨å¼•ç”¨å¯¹è±¡. -XX:ParallelGCThreads å¹¶è¡Œæ”¶é›†å™¨çš„çº¿ç¨‹æ•° æ­¤å€¼æœ€å¥½é…ç½®ä¸å¤„ç†å™¨æ•°ç›®ç›¸ç­‰ åŒæ ·é€‚ç”¨äºCMS -XX:MaxGCPauseMillis æ¯æ¬¡å¹´è½»ä»£åƒåœ¾å›æ”¶çš„æœ€é•¿æ—¶é—´(æœ€å¤§æš‚åœæ—¶é—´) å¦‚æœæ— æ³•æ»¡è¶³æ­¤æ—¶é—´,JVMä¼šè‡ªåŠ¨è°ƒæ•´å¹´è½»ä»£å¤§å°,ä»¥æ»¡è¶³æ­¤å€¼. å…¶å®è¿˜æœ‰ä¸€äº›æ‰“å°åŠCMSæ–¹é¢çš„å‚æ•°ï¼Œè¿™é‡Œå°±ä¸ä»¥ä¸€ä¸€åˆ—ä¸¾äº†\nå…³äºJVMè°ƒä¼˜çš„ä¸€äº›æ–¹é¢ # é»˜è®¤\nå¹´è½»ä»£ï¼šè€å¹´ä»£ = 1: 2 å¹´è½»ä»£ä¸­ Eden : S0 : S 1 = 8 : 1 ï¼š1 æ ¹æ®åˆšåˆšæ¶‰åŠçš„jvmçŸ¥è¯†ç‚¹ï¼Œå¯ä»¥å°è¯•å¯¹JVMè¿›è¡Œè°ƒä¼˜ï¼Œä¸»è¦æ˜¯å †å†…å­˜é‚£å—\næ‰€æœ‰çº¿ç¨‹å…±äº«æ•°æ®åŒºå¤§å°=æ–°ç”Ÿä»£å¤§å°+è€å¹´ä»£å¤§å°+æŒä¹…ä»£å¤§å° ï¼ˆå³ å † + æ–¹æ³•åŒºï¼‰\næŒä¹…ä»£ä¸€èˆ¬å›ºå®šå¤§å°ä¸º64mï¼Œ\njavaå †ä¸­å¢å¤§å¹´è½»ä»£åï¼Œä¼šå‡å°‘è€å¹´ä»£å¤§å°ï¼ˆå› ä¸ºè€å¹´ä»£çš„æ¸…ç†ä½¿ç”¨fullgcï¼Œæ‰€ä»¥è€å¹´ä»£è¿‡å°çš„è¯åè€Œä¼šå¢å¤šfullgcï¼‰ã€‚ å¹´è½»ä»£ -Xmnçš„å€¼æ¨èé…ç½®ä¸ºjavaå †çš„3/8\nè°ƒæ•´æœ€å¤§å †å†…å­˜å’Œæœ€å°å †å†…å­˜ # -Xmx -Xmsï¼šæŒ‡å®šjavaå †æœ€å¤§å€¼ï¼ˆé»˜è®¤ ç‰©ç†å†…å­˜çš„1/4 (\u0026lt;1 GB ) ) å’Œ åˆå§‹javaå †æœ€å°å€¼ï¼ˆé»˜è®¤å€¼æ˜¯ç‰©ç†å†…å­˜çš„1/64 (\u0026lt;1GB) ï¼‰\né»˜è®¤(MinHeapFreeRatioå‚æ•°å¯ä»¥è°ƒæ•´)ç©ºä½™å †å†…å­˜å°äº40%æ—¶ï¼ŒJVMå°±ä¼šå¢å¤§å †ç›´åˆ°-Xmxçš„æœ€å¤§é™åˆ¶.ï¼Œé»˜è®¤(MaxHeapFreeRatioå‚æ•°å¯ä»¥è°ƒæ•´)ç©ºä½™å †å†…å­˜å¤§äº70%æ—¶ï¼ŒJVMä¼šå‡å°‘å †ç›´åˆ° -Xmsçš„æœ€å°é™åˆ¶ã€‚\nç®€å•ç‚¹æ¥è¯´ï¼Œä½ ä¸åœåœ°å¾€å †å†…å­˜é‡Œé¢ä¸¢æ•°æ®ï¼Œç­‰å®ƒå‰©ä½™å¤§å°å°äº40%äº†ï¼ŒJVMå°±ä¼šåŠ¨æ€ç”³è¯·å†…å­˜ç©ºé—´ä¸è¿‡ä¼šå°äº-Xmxï¼Œå¦‚æœå‰©ä½™å¤§å°å¤§äº70%ï¼Œåˆä¼šåŠ¨æ€ç¼©å°ä¸è¿‡ä¸ä¼šå°äºâ€“Xmsã€‚å°±è¿™ä¹ˆç®€å•\nå¼€å‘è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ä¼šå°† -Xms ä¸ Xmx ä¸¤ä¸ªå‚æ•°è®¾ç½®æˆç›¸åŒçš„å€¼\nä¸ºçš„æ˜¯èƒ½å¤Ÿåœ¨javaåƒåœ¾å›æ”¶æœºåˆ¶æ¸…ç†å®Œå †åŒºåï¼Œä¸éœ€è¦é‡æ–°åˆ†éš”è®¡ç®—å †åŒºçš„å¤§å°è€Œæµªè´¹èµ„æºï¼ˆå‘ç³»ç»Ÿè¯·æ±‚/é‡Šæ”¾å†…å­˜èµ„æºï¼‰\nä»£ç \npublic class App { public static void main(String[] args) { System.out.println(\u0026#34;Xmx=\u0026#34; + Runtime.getRuntime().maxMemory() / 1024.0 + \u0026#34;KB\u0026#34;); //ç³»ç»Ÿçš„æœ€å¤§ç©ºé—´-Xmx--è¿è¡Œå‡ æ¬¡éƒ½ä¸å˜ System.out.println(\u0026#34;free mem=\u0026#34; + Runtime.getRuntime().freeMemory() / 1024.0 + \u0026#34;KB\u0026#34;); //ç³»ç»Ÿçš„ç©ºé—²ç©ºé—´--æ¯æ¬¡è¿è¡Œéƒ½å˜ System.out.println(\u0026#34;total mem=\u0026#34; + Runtime.getRuntime().totalMemory() / 1024.0 + \u0026#34;KB\u0026#34;); //å½“å‰å¯ç”¨çš„æ€»ç©ºé—´ ä¸Xmsæœ‰å…³--è¿è¡Œå‡ æ¬¡éƒ½ä¸å˜ } } /* ----- Xmx=7389184.0KB free mem=493486.0546875KB total mem=498688.0KB */ maxMemory()è¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯javaè™šæ‹Ÿæœº(è¿™ä¸ªè¿›ç¨‹)èƒ½æ„ä»æ“çºµç³»ç»Ÿé‚£é‡ŒæŒ–åˆ°çš„æœ€å¤§çš„å†…å­˜ freeMemoryï¼šæŒ–è¿‡æ¥è€Œåˆæ²¡æœ‰ç”¨ä¸Šçš„å†…å­˜ï¼Œå®é™…ä¸Šå°±æ˜¯ freeMemory()ï¼Œæ‰€ä»¥freeMemory()çš„å€¼ä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯å¾ˆå°çš„(totalMemoryä¸€èˆ¬æ¯”éœ€è¦ç”¨å¾—å¤šä¸€ç‚¹ï¼Œå‰©ä¸‹çš„ä¸€ç‚¹å°±æ˜¯freeMemory) totalMemoryï¼šç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå†…å­˜æ€»æ˜¯æ…¢æ…¢çš„ä»æ“çºµç³»ç»Ÿé‚£é‡ŒæŒ–çš„ï¼ŒåŸºæœ¬ä¸Šæ˜¯ç”¨å¤šå°‘æŒ–å¤šå°‘ï¼Œç›´ æŒ–åˆ°maxMemory()ä¸ºæ­¢ï¼Œæ‰€ä»¥totalMemory()æ˜¯æ…¢æ…¢å¢å¤§çš„ åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/weixin_35671171/article/details/114189796 ç¼–è¾‘VM optionså‚æ•°åå†çœ‹æ•ˆæœï¼š\n-Xmx20m -Xms5m -XX:+PrintGCDetailsï¼Œå †æœ€å¤§ä»¥åŠå †åˆå§‹å€¼ 20må’Œ5m\n/* æ•ˆæœ [GC (Allocation Failure) [PSYoungGen: 1024K-\u0026gt;488K(1536K)] 1024K-\u0026gt;608K(5632K), 0.0007606 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] Xmx=18432.0KB free mem=4249.90625KB total mem=5632.0KB Heap PSYoungGen total 1536K, used 1326K [0x00000000ff980000, 0x00000000ffb80000, 0x0000000100000000) eden space 1024K, 81% used [0x00000000ff980000,0x00000000ffa51ad0,0x00000000ffa80000) from space 512K, 95% used [0x00000000ffa80000,0x00000000ffafa020,0x00000000ffb00000) to space 512K, 0% used [0x00000000ffb00000,0x00000000ffb00000,0x00000000ffb80000) ParOldGen total 4096K, used 120K [0x00000000fec00000, 0x00000000ff000000, 0x00000000ff980000) object space 4096K, 2% used [0x00000000fec00000,0x00000000fec1e010,0x00000000ff000000) Metaspace used 3164K, capacity 4496K, committed 4864K, reserved 1056768K class space used 344K, capacity 388K, committed 512K, reserved 1048576K */ å¦‚ä¸Šï¼Œ Allocation Failure å› ä¸ºåˆ†é…å¤±è´¥å¯¼è‡´YoungGen total mem (æ­¤æ—¶ç”³è¯·åˆ°çš„æ€»å†…å­˜)ï¼š\nPSYoungGen + ParOldGen = 1536 + 4096 = 5632 KB freeMemory (ç”³è¯·åæ²¡æœ‰ä½¿ç”¨çš„å†…å­˜)\n1324 + 120 = 1444 KB 5632 - 4249 = 1383 KB å·®ä¸å¤š ä½¿ç”¨1Må\npublic class App { public static void main(String[] args) { System.out.println(\u0026#34;Xmx=\u0026#34; + Runtime.getRuntime().maxMemory() / 1024.0 + \u0026#34;KB\u0026#34;); //ç³»ç»Ÿçš„æœ€å¤§ç©ºé—´-Xmx--è¿è¡Œå‡ æ¬¡éƒ½ä¸å˜ System.out.println(\u0026#34;free mem=\u0026#34; + Runtime.getRuntime().freeMemory() / 1024.0 + \u0026#34;KB\u0026#34;); //ç³»ç»Ÿçš„ç©ºé—²ç©ºé—´--æ¯æ¬¡è¿è¡Œéƒ½å˜ System.out.println(\u0026#34;total mem=\u0026#34; + Runtime.getRuntime().totalMemory() / 1024.0 + \u0026#34;KB\u0026#34;); //å½“å‰å¯ç”¨çš„æ€»ç©ºé—´ ä¸Xmsæœ‰å…³--è¿è¡Œå‡ æ¬¡éƒ½ä¸å˜ byte[] b = new byte[1 * 1024 * 1024]; System.out.println(\u0026#34;åˆ†é…äº†1Mç©ºé—´ç»™æ•°ç»„\u0026#34;); System.out.println(\u0026#34;Xmx=\u0026#34; + Runtime.getRuntime().maxMemory() / 1024.0 / 1024 + \u0026#34;M\u0026#34;); //ç³»ç»Ÿçš„æœ€å¤§ç©ºé—´ System.out.println(\u0026#34;free mem=\u0026#34; + Runtime.getRuntime().freeMemory() / 1024.0 / 1024 + \u0026#34;M\u0026#34;); //ç³»ç»Ÿçš„ç©ºé—²ç©ºé—´ System.out.println(\u0026#34;total mem=\u0026#34; + Runtime.getRuntime().totalMemory() / 1024.0 / 1024 + \u0026#34;M\u0026#34;); } } /** [GC (Allocation Failure) [PSYoungGen: 1024K-\u0026gt;488K(1536K)] 1024K-\u0026gt;608K(5632K), 0.0007069 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] Xmx=18432.0KB free mem=4270.15625KB total mem=5632.0KB åˆ†é…äº†1Mç©ºé—´ç»™æ•°ç»„ Xmx=18.0M free mem=3.1700592041015625M //å°‘äº†1M total mem=5.5M Heap PSYoungGen total 1536K, used 1270K [0x00000000ff980000, 0x00000000ffb80000, 0x0000000100000000) eden space 1024K, 76% used [0x00000000ff980000,0x00000000ffa43aa0,0x00000000ffa80000) from space 512K, 95% used [0x00000000ffa80000,0x00000000ffafa020,0x00000000ffb00000) to space 512K, 0% used [0x00000000ffb00000,0x00000000ffb00000,0x00000000ffb80000) ParOldGen total 4096K, used 1144K [0x00000000fec00000, 0x00000000ff000000, 0x00000000ff980000) object space 4096K, 27% used [0x00000000fec00000,0x00000000fed1e020,0x00000000ff000000) Metaspace used 3155K, capacity 4496K, committed 4864K, reserved 1056768K class space used 344K, capacity 388K, committed 512K, reserved 1048576K */ æ­¤æ—¶free memoryå°±åˆç¼©æ°´äº†ï¼Œä¸è¿‡total memoryæ˜¯æ²¡æœ‰å˜åŒ–çš„ã€‚Javaä¼šå°½å¯èƒ½å°†total memçš„å€¼ç»´æŒåœ¨æœ€å°å †å†…å­˜å¤§å°\nè¿™æ—¶å€™æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª10Mçš„å­—èŠ‚æ•°æ®ï¼Œè¿™æ—¶å€™æœ€å°å †å†…å­˜æ˜¯é¡¶ä¸ä½çš„ã€‚æˆ‘ä»¬ä¼šå‘ç°ç°åœ¨çš„total memoryå·²ç»å˜æˆäº†15Mï¼Œè¿™å°±æ˜¯å·²ç»ç”³è¯·äº†ä¸€æ¬¡å†…å­˜çš„ç»“æœã€‚\npublic class App { public static void main(String[] args) { System.out.println(\u0026#34;Xmx=\u0026#34; + Runtime.getRuntime().maxMemory() / 1024.0 + \u0026#34;KB\u0026#34;); //ç³»ç»Ÿçš„æœ€å¤§ç©ºé—´-Xmx--è¿è¡Œå‡ æ¬¡éƒ½ä¸å˜ System.out.println(\u0026#34;free mem=\u0026#34; + Runtime.getRuntime().freeMemory() / 1024.0 + \u0026#34;KB\u0026#34;); //ç³»ç»Ÿçš„ç©ºé—²ç©ºé—´--æ¯æ¬¡è¿è¡Œéƒ½å˜ System.out.println(\u0026#34;total mem=\u0026#34; + Runtime.getRuntime().totalMemory() / 1024.0 + \u0026#34;KB\u0026#34;); //å½“å‰å¯ç”¨çš„æ€»ç©ºé—´ ä¸Xmsæœ‰å…³--è¿è¡Œå‡ æ¬¡éƒ½ä¸å˜ byte[] b = new byte[1 * 1024 * 1024]; System.out.println(\u0026#34;åˆ†é…äº†1Mç©ºé—´ç»™æ•°ç»„\u0026#34;); System.out.println(\u0026#34;Xmx=\u0026#34; + Runtime.getRuntime().maxMemory() / 1024.0 / 1024 + \u0026#34;M\u0026#34;); //ç³»ç»Ÿçš„æœ€å¤§ç©ºé—´ System.out.println(\u0026#34;free mem=\u0026#34; + Runtime.getRuntime().freeMemory() / 1024.0 / 1024 + \u0026#34;M\u0026#34;); //ç³»ç»Ÿçš„ç©ºé—²ç©ºé—´ System.out.println(\u0026#34;total mem=\u0026#34; + Runtime.getRuntime().totalMemory() / 1024.0 / 1024 + \u0026#34;M\u0026#34;); byte[] c = new byte[10 * 1024 * 1024]; System.out.println(\u0026#34;åˆ†é…äº†10Mç©ºé—´ç»™æ•°ç»„\u0026#34;); System.out.println(\u0026#34;Xmx=\u0026#34; + Runtime.getRuntime().maxMemory() / 1024.0 / 1024 + \u0026#34;M\u0026#34;); //ç³»ç»Ÿçš„æœ€å¤§ç©ºé—´ System.out.println(\u0026#34;free mem=\u0026#34; + Runtime.getRuntime().freeMemory() / 1024.0 / 1024 + \u0026#34;M\u0026#34;); //ç³»ç»Ÿçš„ç©ºé—²ç©ºé—´ System.out.println(\u0026#34;total mem=\u0026#34; + Runtime.getRuntime().totalMemory() / 1024.0 / 1024 + \u0026#34;M\u0026#34;); //å½“å‰å¯ç”¨çš„æ€»ç©ºé—´ } } /** ---- [GC (Allocation Failure) [PSYoungGen: 1024K-\u0026gt;488K(1536K)] 1024K-\u0026gt;600K(5632K), 0.0006681 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] Xmx=18432.0KB free mem=4257.953125KB total mem=5632.0KB åˆ†é…äº†1Mç©ºé—´ç»™æ•°ç»„ Xmx=18.0M free mem=3.1153564453125M total mem=5.5M åˆ†é…äº†10Mç©ºé—´ç»™æ•°ç»„ Xmx=18.0M free mem=2.579681396484375M total mem=15.0M Heap PSYoungGen total 1536K, used 1363K [0x00000000ff980000, 0x00000000ffb80000, 0x0000000100000000) eden space 1024K, 85% used [0x00000000ff980000,0x00000000ffa5acc0,0x00000000ffa80000) from space 512K, 95% used [0x00000000ffa80000,0x00000000ffafa020,0x00000000ffb00000) to space 512K, 0% used [0x00000000ffb00000,0x00000000ffb00000,0x00000000ffb80000) ParOldGen total 13824K, used 11376K [0x00000000fec00000, 0x00000000ff980000, 0x00000000ff980000) object space 13824K, 82% used [0x00000000fec00000,0x00000000ff71c020,0x00000000ff980000) Metaspace used 3242K, capacity 4500K, committed 4864K, reserved 1056768K class space used 351K, capacity 388K, committed 512K, reserved 1048576K */ æ­¤æ—¶æˆ‘ä»¬å†è·‘ä¸€ä¸‹è¿™ä¸ªä»£ç \næ­¤æ—¶è¦è°ƒæ•´åƒåœ¾æ”¶é›†å™¨(-XX:+UseG1GC)ä¸”bã€cè¦æŒ‡å‘nullï¼Œæ‰èƒ½è®©ç³»ç»Ÿå›æ”¶è¿™éƒ¨åˆ†å†…å­˜ï¼Œå³-Xmx20m -Xms5m -XX:+PrintGCDetails -XX:+UseG1GC æ³¨ï¼šä½¿ç”¨-XX: +UseSerialGCæˆ–è€…-XX:+UseParallelGCéƒ½æ˜¯ä¸èƒ½è¾¾åˆ°æ•ˆæœçš„\næ­¤æ—¶æˆ‘ä»¬æ‰‹åŠ¨æ‰§è¡Œäº†ä¸€æ¬¡fullgcï¼Œæ­¤æ—¶total memoryçš„å†…å­˜ç©ºé—´åˆå˜å›6.0Mäº†ï¼Œæ­¤æ—¶åˆæ˜¯æŠŠç”³è¯·çš„å†…å­˜é‡Šæ”¾æ‰çš„ç»“æœã€‚\npublic class App { public static void main(String[] args) throws InterruptedException { System.out.println(\u0026#34;Xmx=\u0026#34; + Runtime.getRuntime().maxMemory() / 1024.0 + \u0026#34;KB\u0026#34;); //ç³»ç»Ÿçš„æœ€å¤§ç©ºé—´-Xmx--è¿è¡Œå‡ æ¬¡éƒ½ä¸å˜ System.out.println(\u0026#34;free mem=\u0026#34; + Runtime.getRuntime().freeMemory() / 1024.0 + \u0026#34;KB\u0026#34;); //ç³»ç»Ÿçš„ç©ºé—²ç©ºé—´--æ¯æ¬¡è¿è¡Œéƒ½å˜ System.out.println(\u0026#34;total mem=\u0026#34; + Runtime.getRuntime().totalMemory() / 1024.0 + \u0026#34;KB\u0026#34;); //å½“å‰å¯ç”¨çš„æ€»ç©ºé—´ ä¸Xmsæœ‰å…³--è¿è¡Œå‡ æ¬¡éƒ½ä¸å˜ byte[] b = new byte[1 * 1024 * 1024]; System.out.println(\u0026#34;åˆ†é…äº†1Mç©ºé—´ç»™æ•°ç»„\u0026#34;); System.out.println(\u0026#34;Xmx=\u0026#34; + Runtime.getRuntime().maxMemory() / 1024.0 / 1024 + \u0026#34;M\u0026#34;); //ç³»ç»Ÿçš„æœ€å¤§ç©ºé—´ System.out.println(\u0026#34;free mem=\u0026#34; + Runtime.getRuntime().freeMemory() / 1024.0 / 1024 + \u0026#34;M\u0026#34;); //ç³»ç»Ÿçš„ç©ºé—²ç©ºé—´ System.out.println(\u0026#34;total mem=\u0026#34; + Runtime.getRuntime().totalMemory() / 1024.0 / 1024 + \u0026#34;M\u0026#34;); byte[] c = new byte[10 * 1024 * 1024]; System.out.println(\u0026#34;åˆ†é…äº†10Mç©ºé—´ç»™æ•°ç»„\u0026#34;); System.out.println(\u0026#34;Xmx=\u0026#34; + Runtime.getRuntime().maxMemory() / 1024.0 / 1024 + \u0026#34;M\u0026#34;); //ç³»ç»Ÿçš„æœ€å¤§ç©ºé—´ System.out.println(\u0026#34;free mem=\u0026#34; + Runtime.getRuntime().freeMemory() / 1024.0 / 1024 + \u0026#34;M\u0026#34;); //ç³»ç»Ÿçš„ç©ºé—²ç©ºé—´ System.out.println(\u0026#34;total mem=\u0026#34; + Runtime.getRuntime().totalMemory() / 1024.0 / 1024 + \u0026#34;M\u0026#34;); //å½“å‰å¯ç”¨çš„æ€»ç©ºé—´ b=null; c=null; System.gc(); System.out.println(\u0026#34;è¿›è¡Œäº†gc\u0026#34;); System.out.println(\u0026#34;Xmx=\u0026#34; + Runtime.getRuntime().maxMemory() / 1024.0 / 1024 + \u0026#34;M\u0026#34;); //ç³»ç»Ÿçš„æœ€å¤§ç©ºé—´ System.out.println(\u0026#34;free mem=\u0026#34; + Runtime.getRuntime().freeMemory() / 1024.0 / 1024 + \u0026#34;M\u0026#34;); //ç³»ç»Ÿçš„ç©ºé—²ç©ºé—´ System.out.println(\u0026#34;total mem=\u0026#34; + Runtime.getRuntime().totalMemory() / 1024.0 / 1024 + \u0026#34;M\u0026#34;); //å½“å‰å¯ç”¨çš„æ€»ç©ºé—´ } } /*-------- Xmx=20480.0KB free mem=4290.3671875KB total mem=6144.0KB åˆ†é…äº†1Mç©ºé—´ç»™æ•°ç»„ Xmx=20.0M free mem=3.1897964477539062M total mem=6.0M [GC pause (G1 Humongous Allocation) (young) (initial-mark), 0.0014754 secs] [Parallel Time: 1.1 ms, GC Workers: 8] [GC Worker Start (ms): Min: 105.0, Avg: 105.1, Max: 105.3, Diff: 0.3] [Ext Root Scanning (ms): Min: 0.5, Avg: 0.5, Max: 0.8, Diff: 0.4, Sum: 4.4] [Update RS (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.0] [Processed Buffers: Min: 0, Avg: 0.0, Max: 0, Diff: 0, Sum: 0] [Scan RS (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.0] [Code Root Scanning (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.0] [Object Copy (ms): Min: 0.1, Avg: 0.3, Max: 0.4, Diff: 0.2, Sum: 2.5] [Termination (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.3] [Termination Attempts: Min: 1, Avg: 6.0, Max: 9, Diff: 8, Sum: 48] [GC Worker Other (ms): Min: 0.0, Avg: 0.0, Max: 0.1, Diff: 0.1, Sum: 0.2] [GC Worker Total (ms): Min: 0.8, Avg: 0.9, Max: 1.0, Diff: 0.3, Sum: 7.4] [GC Worker End (ms): Min: 106.0, Avg: 106.1, Max: 106.1, Diff: 0.0] [Code Root Fixup: 0.0 ms] [Code Root Purge: 0.0 ms] [Clear CT: 0.1 ms] [Other: 0.3 ms] [Choose CSet: 0.0 ms] [Ref Proc: 0.1 ms] [Ref Enq: 0.0 ms] [Redirty Cards: 0.1 ms] [Humongous Register: 0.0 ms] [Humongous Reclaim: 0.0 ms] [Free CSet: 0.0 ms] [Eden: 2048.0K(3072.0K)-\u0026gt;0.0B(1024.0K) Survivors: 0.0B-\u0026gt;1024.0K Heap: 2877.6K(6144.0K)-\u0026gt;1955.9K(6144.0K)] [Times: user=0.00 sys=0.00, real=0.00 secs] [GC concurrent-root-region-scan-start] [GC concurrent-root-region-scan-end, 0.0005373 secs] [GC concurrent-mark-start] [GC concurrent-mark-end, 0.0000714 secs] [GC remark [Finalize Marking, 0.0001034 secs] [GC ref-proc, 0.0000654 secs] [Unloading, 0.0005193 secs], 0.0007843 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] [GC cleanup 11M-\u0026gt;11M(17M), 0.0003613 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] åˆ†é…äº†10Mç©ºé—´ç»™æ•°ç»„ Xmx=20.0M free mem=5.059120178222656M total mem=17.0M [Full GC (System.gc()) 11M-\u0026gt;654K(6144K), 0.0031959 secs] [Eden: 1024.0K(1024.0K)-\u0026gt;0.0B(2048.0K) Survivors: 1024.0K-\u0026gt;0.0B Heap: 11.9M(17.0M)-\u0026gt;654.4K(6144.0K)], [Metaspace: 3152K-\u0026gt;3152K(1056768K)] [Times: user=0.00 sys=0.00, real=0.00 secs] è¿›è¡Œäº†gc Xmx=20.0M free mem=5.2661590576171875M total mem=6.0M Heap garbage-first heap total 6144K, used 654K [0x00000000fec00000, 0x00000000fed00030, 0x0000000100000000) region size 1024K, 1 young (1024K), 0 survivors (0K) Metaspace used 3243K, capacity 4500K, committed 4864K, reserved 1056768K class space used 351K, capacity 388K, committed 512K, reserved 1048576K */ è°ƒæ•´æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”å€¼ # -XX:NewRatio \u0026mdash; æ–°ç”Ÿä»£ï¼ˆeden+2*Survivorï¼‰å’Œè€å¹´ä»£ï¼ˆä¸åŒ…å«æ°¸ä¹…åŒºï¼‰çš„æ¯”å€¼\nä¾‹å¦‚ï¼š-XX:NewRatio=4ï¼Œè¡¨ç¤ºæ–°ç”Ÿä»£:è€å¹´ä»£=1:4ï¼Œå³æ–°ç”Ÿä»£å æ•´ä¸ªå †çš„1/5ã€‚åœ¨Xms=Xmxå¹¶ä¸”è®¾ç½®äº†Xmnçš„æƒ…å†µä¸‹ï¼Œè¯¥å‚æ•°ä¸éœ€è¦è¿›è¡Œè®¾ç½®ã€‚ æ³¨ï¼šXmnä¸ºç›´æ¥è®¾ç½®å¤§å°ï¼Œå¦‚-Xmn2G\nè°ƒæ•´SurvivoråŒºå’ŒEdenåŒºçš„æ¯”å€¼ # -XX:SurvivorRatioï¼ˆå¹¸å­˜ä»£ï¼‰\u0026mdash; è®¾ç½®ä¸¤ä¸ªSurvivoråŒºå’Œedençš„æ¯”å€¼\nä¾‹å¦‚ï¼š8ï¼Œè¡¨ç¤ºä¸¤ä¸ªSurvivor:eden=2:8ï¼Œå³ä¸€ä¸ªSurvivorå å¹´è½»ä»£çš„1/10\nè®¾ç½®å¹´è½»ä»£å’Œè€å¹´ä»£çš„å¤§å° # -XX:NewSize \u0026mdash; è®¾ç½®å¹´è½»ä»£å¤§å°\n-XX:MaxNewSize \u0026mdash; è®¾ç½®å¹´è½»ä»£æœ€å¤§å€¼\nå¯ä»¥é€šè¿‡è®¾ç½®ä¸åŒå‚æ•°æ¥æµ‹è¯•ä¸åŒçš„æƒ…å†µï¼Œåæ­£æœ€ä¼˜è§£å½“ç„¶å°±æ˜¯å®˜æ–¹çš„Edenå’ŒSurvivorçš„å æ¯”ä¸º8:1:1ï¼Œç„¶ååœ¨åˆšåˆšä»‹ç»è¿™äº›å‚æ•°çš„æ—¶å€™éƒ½å·²ç»é™„å¸¦äº†ä¸€äº›è¯´æ˜ï¼Œæ„Ÿå…´è¶£çš„ä¹Ÿå¯ä»¥çœ‹çœ‹ã€‚åæ­£æœ€å¤§å †å†…å­˜å’Œæœ€å°å †å†…å­˜å¦‚æœæ•°å€¼ä¸åŒä¼šå¯¼è‡´å¤šæ¬¡çš„gcï¼Œéœ€è¦æ³¨æ„ã€‚\næˆ‘çš„ç†è§£æ˜¯ä¼šç»å¸¸è°ƒæ•´totalMemoryè€Œå¯¼è‡´å¤šæ¬¡gcï¼Œé¿å…ä¸´ç•Œæ¡ä»¶ä¸‹çš„åƒåœ¾å›æ”¶å’Œå†…å­˜ç”³è¯·å’Œåˆ†é…\næ³¨ï¼š æœ€å¤§å †å†…å­˜å’Œæœ€å°å †å†…å­˜è®¾ç½®æˆä¸€æ ·ï¼Œä¸ºçš„æ˜¯èƒ½å¤Ÿåœ¨javaåƒåœ¾å›æ”¶æœºåˆ¶æ¸…ç†å®Œå †åŒºåï¼Œä¸éœ€è¦é‡æ–°åˆ†éš”è®¡ç®—å †åŒºçš„å¤§å°è€Œæµªè´¹èµ„æºï¼ˆå‘ç³»ç»Ÿè¯·æ±‚/é‡Šæ”¾å†…å­˜èµ„æºï¼‰\nå°æ€»ç»“ # æ ¹æ®å®é™…äº‹æƒ…è°ƒæ•´æ–°ç”Ÿä»£å’Œå¹¸å­˜ä»£çš„å¤§å°ï¼Œå®˜æ–¹æ¨èæ–°ç”Ÿä»£å javaå †çš„3/8ï¼Œå¹¸å­˜ä»£å æ–°ç”Ÿä»£çš„1/10\nJavaå †ï¼šæ–°ç”Ÿä»£ (3/8)ï¼Œè€å¹´ä»£\næ–°ç”Ÿä»£ï¼šSO (1/10) ï¼ŒS1 ï¼ŒEden\nåœ¨OOMæ—¶ï¼Œè®°å¾—Dumpå‡ºå †ï¼Œç¡®ä¿å¯ä»¥æ’æŸ¥ç°åœºé—®é¢˜ï¼Œé€šè¿‡ä¸‹é¢å‘½ä»¤å¯ä»¥è¾“å‡ºä¸€ä¸ª.dump æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ç”¨VisualVMæˆ–Javaè‡ªå¸¦çš„JavaVisualVM å·¥å…·\n-Xmx20m -Xms5m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=ä½ è¦è¾“å‡ºçš„æ—¥å¿—è·¯å¾„ ä¸€èˆ¬æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç¼–å†™è„šæœ¬çš„æ–¹å¼æ¥è®©OOMå‡ºç°æ—¶ç»™æˆ‘ä»¬æŠ¥ä¸ªä¿¡ï¼Œå¯ä»¥é€šè¿‡å‘é€é‚®ä»¶æˆ–è€…é‡å¯ç¨‹åºç­‰æ¥è§£å†³\næ°¸ä¹…åŒºçš„è®¾ç½® # -XX:PermSize -XX:MaxPermSizeï¼Œåº”è¯¥è¯´çš„æ˜¯æ°¸ä¹…ä»£\nåˆå§‹ç©ºé—´ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„1/64ï¼‰å’Œæœ€å¤§ç©ºé—´ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„1/4ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œjvmå¯åŠ¨æ—¶ï¼Œæ°¸ä¹…åŒºä¸€å¼€å§‹å°±å ç”¨äº†PermSizeå¤§å°çš„ç©ºé—´ï¼Œå¦‚æœç©ºé—´è¿˜ä¸å¤Ÿï¼Œå¯ä»¥ç»§ç»­æ‰©å±•ï¼Œä½†æ˜¯ä¸èƒ½è¶…è¿‡MaxPermSizeï¼Œå¦åˆ™ä¼šOOMã€‚\nå¦‚æœå †ç©ºé—´æ²¡æœ‰ç”¨å®Œä¹ŸæŠ›å‡ºäº†OOMï¼Œæœ‰å¯èƒ½æ˜¯æ°¸ä¹…åŒºå¯¼è‡´çš„ã€‚å †ç©ºé—´å®é™…å ç”¨éå¸¸å°‘ï¼Œä½†æ˜¯æ°¸ä¹…åŒºæº¢å‡º ä¸€æ ·æŠ›å‡ºOOM\nJVMçš„æ ˆå‚æ•°è°ƒä¼˜ # è°ƒæ•´æ¯ä¸ªçº¿ç¨‹æ ˆç©ºé—´çš„å¤§å° # å¯ä»¥é€šè¿‡**-Xss**ï¼šè°ƒæ•´æ¯ä¸ªçº¿ç¨‹æ ˆç©ºé—´çš„å¤§å°\nJDK5.0ä»¥åæ¯ä¸ªçº¿ç¨‹å †æ ˆå¤§å°ä¸º1Mï¼Œä»¥å‰æ¯ä¸ªçº¿ç¨‹å †æ ˆå¤§å°ä¸º256Kã€‚åœ¨ç›¸åŒç‰©ç†å†…å­˜ä¸‹,å‡å°è¿™ä¸ªå€¼èƒ½ç”Ÿæˆæ›´å¤šçš„çº¿ç¨‹ã€‚ä½†æ˜¯æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹æ•°è¿˜æ˜¯æœ‰é™åˆ¶çš„ï¼Œä¸èƒ½æ— é™ç”Ÿæˆï¼Œç»éªŒå€¼åœ¨3000~5000å·¦å³\nè®¾ç½®çº¿ç¨‹æ ˆçš„å¤§å° # -XXThreadStackSizeï¼š #è®¾ç½®çº¿ç¨‹æ ˆçš„å¤§å°(0 means use default stack size) è¡¥å……ï¼š\n-Xssæ˜¯OpenJDKå’ŒOracle JDKçš„-XX:ThreadStackSizeçš„åˆ«åã€‚\nå°½ç®¡ä»–ä»¬å¯¹å‚æ•°çš„è§£æä¸åŒï¼š -Xsså¯ä»¥æ¥å—å¸¦Kï¼ŒMæˆ–Gåç¼€çš„æ•°å­—ï¼› -XX:ThreadStackSize=éœ€è¦ä¸€ä¸ªæ•´æ•°(æ— åç¼€)-å †æ ˆå¤§å°(ä»¥åƒå­—èŠ‚ä¸ºå•ä½)\n(å¯ä»¥ç›´æ¥è·³è¿‡äº†)JVMå…¶ä»–å‚æ•°ä»‹ç» # å½¢å½¢è‰²è‰²çš„å‚æ•°å¾ˆå¤šï¼Œå°±ä¸ä¼šè¯´æŠŠæ‰€æœ‰éƒ½æ‰¯ä¸ªéäº†ï¼Œå› ä¸ºå¤§å®¶å…¶å®ä¹Ÿä¸ä¼šè¯´ä¸€å®šè¦å»æ·±ç©¶åˆ°åº•ã€‚\nè®¾ç½®å†…å­˜é¡µçš„å¤§å° # -XXThreadStackSizeï¼š è®¾ç½®å†…å­˜é¡µçš„å¤§å°ï¼Œä¸å¯è®¾ç½®è¿‡å¤§ï¼Œä¼šå½±å“Permçš„å¤§å° è®¾ç½®åŸå§‹ç±»å‹çš„å¿«é€Ÿä¼˜åŒ– # -XX:+UseFastAccessorMethodsï¼š è®¾ç½®åŸå§‹ç±»å‹çš„å¿«é€Ÿä¼˜åŒ– è®¾ç½®å…³é—­æ‰‹åŠ¨GC # -XX:+DisableExplicitGCï¼š è®¾ç½®å…³é—­System.gc()(è¿™ä¸ªå‚æ•°éœ€è¦ä¸¥æ ¼çš„æµ‹è¯•) è®¾ç½®åƒåœ¾æœ€å¤§å¹´é¾„ # -XX:MaxTenuringThreshold è®¾ç½®åƒåœ¾æœ€å¤§å¹´é¾„ã€‚å¦‚æœè®¾ç½®ä¸º0çš„è¯,åˆ™å¹´è½»ä»£å¯¹è±¡ä¸ç»è¿‡SurvivoråŒº,ç›´æ¥è¿›å…¥å¹´è€ä»£. å¯¹äºå¹´è€ä»£æ¯”è¾ƒå¤šçš„åº”ç”¨,å¯ä»¥æé«˜æ•ˆç‡ã€‚å¦‚æœå°†æ­¤å€¼è®¾ç½®ä¸ºä¸€ä¸ªè¾ƒå¤§å€¼, åˆ™å¹´è½»ä»£å¯¹è±¡ä¼šåœ¨SurvivoråŒºè¿›è¡Œå¤šæ¬¡å¤åˆ¶,è¿™æ ·å¯ä»¥å¢åŠ å¯¹è±¡å†å¹´è½»ä»£çš„å­˜æ´»æ—¶é—´, å¢åŠ åœ¨å¹´è½»ä»£å³è¢«å›æ”¶çš„æ¦‚ç‡ã€‚è¯¥å‚æ•°åªæœ‰åœ¨ä¸²è¡ŒGCæ—¶æ‰æœ‰æ•ˆ. åŠ å¿«ç¼–è¯‘é€Ÿåº¦ # -XX:+AggressiveOpts åŠ å¿«ç¼–è¯‘é€Ÿåº¦\næ”¹å–„é”æœºåˆ¶æ€§èƒ½ # -XX:+UseBiasedLocking ç¦ç”¨åƒåœ¾å›æ”¶ # -Xnoclassgc è®¾ç½®å †ç©ºé—´å­˜æ´»æ—¶é—´ # -XX:SoftRefLRUPolicyMSPerMB è®¾ç½®æ¯å…†å †ç©ºé—²ç©ºé—´ä¸­SoftReferenceçš„å­˜æ´»æ—¶é—´ï¼Œé»˜è®¤å€¼æ˜¯1sã€‚ è®¾ç½®å¯¹è±¡ç›´æ¥åˆ†é…åœ¨è€å¹´ä»£ # -XX:PretenureSizeThreshold è®¾ç½®å¯¹è±¡è¶…è¿‡å¤šå¤§æ—¶ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ï¼Œé»˜è®¤å€¼æ˜¯0ã€‚ è®¾ç½®TLABå edenåŒºçš„æ¯”ä¾‹ # -XX:TLABWasteTargetPercent è®¾ç½®TLABå edenåŒºçš„ç™¾åˆ†æ¯”ï¼Œé»˜è®¤å€¼æ˜¯1% ã€‚ è®¾ç½®æ˜¯å¦ä¼˜å…ˆYGC # -XX:+CollectGen0First è®¾ç½®FullGCæ—¶æ˜¯å¦å…ˆYGCï¼Œé»˜è®¤å€¼æ˜¯falseã€‚ finally # é™„å½•ï¼š\nçœŸçš„æ‰¯äº†å¾ˆä¹…è¿™ä¸œè¥¿ï¼Œå‚è€ƒäº†å¤šæ–¹çš„èµ„æ–™ï¼Œæœ‰æå®¢æ—¶é—´çš„ã€Šæ·±å…¥æ‹†è§£è™šæ‹Ÿæœºã€‹å’Œã€ŠJavaæ ¸å¿ƒæŠ€æœ¯é¢è¯•ç²¾è®²ã€‹ï¼Œä¹Ÿæœ‰ç™¾åº¦ï¼Œä¹Ÿæœ‰è‡ªå·±åœ¨å­¦ä¹ çš„ä¸€äº›çº¿ä¸Šè¯¾ç¨‹çš„æ€»ç»“ã€‚å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè°¢è°¢ã€‚\n"},{"id":126,"href":"/zh/docs/study/Review/java_guide/java/JVM/ly0401lymemory-area/","title":"memory-area","section":"JavaåŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nå¦‚æœæ²¡æœ‰ç‰¹æ®Šè¯´æ˜ï¼Œé’ˆå¯¹çš„éƒ½æ˜¯HotSpotè™šæ‹Ÿæœº\nå‰è¨€ # å¯¹äºJavaç¨‹åºå‘˜ï¼Œè™šæ‹Ÿæœºè‡ªåŠ¨ç®¡ç†æœºåˆ¶ï¼Œä¸éœ€è¦åƒC/C++ç¨‹åºå‘˜ä¸ºæ¯ä¸€ä¸ªnew æ“ä½œå»å†™å¯¹åº”çš„delete/free æ“ä½œï¼Œä¸å®¹æ˜“å‡ºç°å†…å­˜æ³„æ¼ å’Œ å†…å­˜æº¢å‡ºé—®é¢˜ ä½†ç”±äºå†…å­˜æ§åˆ¶æƒäº¤ç»™Javaè™šæ‹Ÿæœºï¼Œä¸€æ—¦å‡ºç°å†…å­˜æ³„æ¼å’Œæº¢å‡ºæ–¹é¢é—®é¢˜ï¼Œå¦‚æœä¸äº†è§£è™šæ‹Ÿæœºæ˜¯æ€ä¹ˆæ ·ä½¿ç”¨å†…å­˜ï¼Œé‚£ä¹ˆå¾ˆéš¾æ’æŸ¥ä»»åŠ¡ è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ # Javaè™šæ‹Ÿæœºåœ¨æ‰§è¡ŒJavaç¨‹åºçš„è¿‡ç¨‹ä¸­ï¼Œä¼šæŠŠå®ƒç®¡ç†çš„å†…å­˜ï¼Œåˆ’åˆ†æˆè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸ\nJDK1.8ä¹‹å‰ï¼š\nçº¿ç¨‹å…±äº« å †ï¼Œæ–¹æ³•åŒºã€æ°¸ä¹…ä»£ã€‘(åŒ…æ‹¬è¿è¡Œæ—¶å¸¸é‡æ± ) çº¿ç¨‹ç§æœ‰ è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨ æœ¬åœ°å†…å­˜(åŒ…æ‹¬ç›´æ¥å†…å­˜) JDK1.8ä¹‹åï¼š\n1.8ä¹‹åæ•´ä¸ªæ°¸ä¹…ä»£æ”¹åå«\u0026quot;å…ƒç©ºé—´\u0026quot;ï¼Œä¸”ç§»åˆ°äº†æœ¬åœ°å†…å­˜ä¸­\nè§„èŒƒï¼ˆæ¦‚æ‹¬ï¼‰ï¼š\nçº¿ç¨‹ç§æœ‰ï¼šç¨‹åºè®¡æ•°å™¨ï¼Œè™šæ‹Ÿæœºæ ˆï¼Œæœ¬åœ°æ–¹æ³•æ ˆ\nçº¿ç¨‹å…±äº«ï¼šå †ï¼Œæ–¹æ³•åŒºï¼Œç›´æ¥å†…å­˜ï¼ˆéè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼‰\nJavaè™šæ‹Ÿæœºè§„èŒƒå¯¹äºè¿è¡Œæ—¶æ•°æ®åŒºåŸŸçš„è§„å®šæ˜¯ç›¸å½“å®½æ¾çš„ï¼Œä»¥å †ä¸ºä¾‹ï¼š\nå †å¯ä»¥æ˜¯è¿ç»­ï¼Œä¹Ÿå¯ä»¥ä¸è¿ç»­ å¤§å°å¯ä»¥å›ºå®šï¼Œä¹Ÿå¯ä»¥è¿è¡Œæ—¶æŒ‰éœ€æ‰©å±• è™šæ‹Ÿæœºå®ç°è€…å¯ä»¥ä½¿ç”¨ä»»ä½•åƒåœ¾å›æ”¶ç®—æ³•ç®¡ç†å †ï¼Œè®¾ç½®ä¸è¿›è¡Œåƒåœ¾æ”¶é›† ç¨‹åºè®¡æ•°å™¨ # æ˜¯ä¸€å—è¾ƒå°å†…å­˜ç©ºé—´ï¼Œçœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨\njavaç¨‹åºæµç¨‹\nå­—èŠ‚ç è§£é‡Šå™¨ï¼Œå·¥ä½œæ—¶é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤\nåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨\nè€Œä¸”ï¼Œä¸ºäº†çº¿ç¨‹åˆ‡æ¢åæ¢å¤åˆ°æ­£ç¡®æ‰§è¡Œä½ç½®ï¼Œæ¯æ¡çº¿ç¨‹éœ€è¦ä¸€ä¸ªç‹¬ç«‹ç¨‹åºè®¡æ•°å™¨ï¼Œå„çº¿ç¨‹è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ï¼Œæˆ‘ä»¬ç§°è¿™ç±»å†…å­˜åŒºåŸŸä¸º**\u0026ldquo;çº¿ç¨‹ç§æœ‰\u0026rdquo;**çš„å†…å­˜\næ€»ç»“ï¼Œç¨‹åºè®¡æ•°å™¨çš„ä½œç”¨\nå­—èŠ‚ç è§£é‡Šå™¨é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨æ¥ä¾æ¬¡è¯»å–æŒ‡ä»¤ï¼Œä»è€Œå®ç°ä»£ç çš„æµç¨‹æ§åˆ¶ å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œç¨‹åºè®¡æ•°å™¨ç”¨äºè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®ï¼Œä»è€Œå½“çº¿ç¨‹è¢«åˆ‡å›æ¥çš„æ—¶å€™èƒ½å¤ŸçŸ¥é“è¯¥çº¿ç¨‹ä¸Šæ¬¡è¿è¡Œåˆ°å“ª ç¨‹åºè®¡æ•°å™¨æ˜¯å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç°OutOfMemoryErrorçš„å†…å­˜åŒºåŸŸï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸéšçº¿ç¨‹åˆ›å»ºè€Œåˆ›å»ºï¼Œçº¿ç¨‹ç»“æŸè€Œæ­»äº¡\nJavaè™šæ‹Ÿæœºæ ˆ # Javaè™šæ‹Ÿæœºæ ˆï¼Œç®€ç§°\u0026quot;æ ˆ\u0026quot;ï¼Œä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ç›¸åŒï¼Œéšçº¿ç¨‹åˆ›å»ºè€Œåˆ›å»ºï¼Œçº¿ç¨‹æ­»äº¡è€Œæ­»äº¡ é™¤äº†Nativeæ–¹æ³•è°ƒç”¨çš„æ˜¯é€šè¿‡æœ¬åœ°æ–¹æ³•æ ˆå®ç°çš„ï¼Œå…¶ä»–æ‰€æœ‰çš„Javaæ–¹æ³•è°ƒç”¨éƒ½æ˜¯é€šè¿‡æ ˆæ¥å®ç°çš„ï¼ˆéœ€è¦å’Œå…¶ä»–è¿è¡Œæ—¶æ•°æ®åŒºåŸŸæ¯”å¦‚ç¨‹åºè®¡æ•°å™¨é…åˆï¼‰ æ–¹æ³•è°ƒç”¨çš„æ•°æ®éœ€è¦é€šè¿‡æ ˆè¿›è¡Œä¼ é€’ï¼Œæ¯ä¸€æ¬¡æ–¹æ³•è°ƒç”¨éƒ½ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„æ ˆå¸§è¢«å‹å…¥æ ˆï¼Œæ¯ä¸€ä¸ªæ–¹æ³•è°ƒç”¨ç»“æŸåï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªæ ˆå¸§è¢«å¼¹å‡ºã€‚ æ ˆç”±ä¸€ä¸ªä¸ªæ ˆå¸§ç»„æˆï¼Œæ¯ä¸ªæ ˆå¸§åŒ…æ‹¬å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•è¿”å›åœ°å€ã€‚ æ ˆä¸ºå…ˆè¿›åå‡ºï¼Œä¸”åªæ”¯æŒå‡ºæ ˆå’Œå…¥æ ˆ å±€éƒ¨å˜é‡è¡¨ï¼šå­˜æ”¾ç¼–è¯‘å™¨å¯çŸ¥çš„å„ç§æ•°æ®ç±»å‹(booleanã€byteã€charã€shortã€intã€floatã€longã€double)ã€å¯¹è±¡å¼•ç”¨(reference ç±»å‹ï¼Œä¸åŒäºå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–ä¸æ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®) æ“ä½œæ•°æ ˆ ä½œä¸ºæ–¹æ³•è°ƒç”¨çš„ä¸­è½¬ç«™ä½¿ç”¨ï¼Œç”¨äºå­˜æ”¾æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸­é—´è®¡ç®—ç»“æœã€‚è®¡ç®—è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸´æ—¶å˜é‡ä¹Ÿæ”¾åœ¨æ“ä½œæ•°æ ˆä¸­\nåŠ¨æ€é“¾æ¥ ä¸»è¦æœåŠ¡ä¸€ä¸ªæ–¹æ³•éœ€è¦è°ƒç”¨å…¶ä»–æ–¹æ³•çš„åœºæ™¯ã€‚\nåœ¨ Java æºæ–‡ä»¶è¢«ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶æ—¶ï¼Œæ‰€æœ‰çš„å˜é‡å’Œæ–¹æ³•å¼•ç”¨éƒ½ä½œä¸ºç¬¦å·å¼•ç”¨ï¼ˆSymbilic Referenceï¼‰ä¿å­˜åœ¨ Class æ–‡ä»¶çš„å¸¸é‡æ± é‡Œã€‚å½“ä¸€ä¸ªæ–¹æ³•è¦è°ƒç”¨å…¶ä»–æ–¹æ³•ï¼Œéœ€è¦å°†å¸¸é‡æ± ä¸­æŒ‡å‘æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºå…¶åœ¨å†…å­˜åœ°å€ä¸­çš„ç›´æ¥å¼•ç”¨ã€‚åŠ¨æ€é“¾æ¥çš„ä½œç”¨å°±æ˜¯ä¸ºäº†å°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºè°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ã€‚\nå¦‚æœå‡½æ•°è°ƒç”¨é™·å…¥æ— é™å¾ªç¯ï¼Œä¼šå¯¼è‡´æ ˆä¸­è¢«å‹å…¥å¤ªå¤šæ ˆå¸§è€Œå ç”¨å¤ªå¤šç©ºé—´ï¼Œå¯¼è‡´æ ˆç©ºé—´è¿‡æ·±ã€‚å½“çº¿ç¨‹è¯·æ±‚æ ˆçš„æ·±åº¦è¶…è¿‡å½“å‰Javaè™šæ‹Ÿæœºæ ˆçš„æœ€å¤§æ·±åº¦æ—¶ï¼Œå°±ä¼šæŠ›å‡ºStackOverFlowErroré”™è¯¯\nJava æ–¹æ³•æœ‰ä¸¤ç§è¿”å›æ–¹å¼ï¼Œä¸€ç§æ˜¯ return è¯­å¥æ­£å¸¸è¿”å›ï¼Œä¸€ç§æ˜¯æŠ›å‡ºå¼‚å¸¸ã€‚ä¸ç®¡å“ªç§è¿”å›æ–¹å¼ï¼Œéƒ½ä¼šå¯¼è‡´æ ˆå¸§è¢«å¼¹å‡ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ æ ˆå¸§éšç€æ–¹æ³•è°ƒç”¨è€Œåˆ›å»ºï¼Œéšç€æ–¹æ³•ç»“æŸè€Œé”€æ¯ã€‚æ— è®ºæ–¹æ³•æ­£å¸¸å®Œæˆè¿˜æ˜¯å¼‚å¸¸å®Œæˆéƒ½ç®—ä½œæ–¹æ³•ç»“æŸã€‚\né™¤äº† StackOverFlowError é”™è¯¯ä¹‹å¤–ï¼Œæ ˆè¿˜å¯èƒ½ä¼šå‡ºç°OutOfMemoryErroré”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœæ ˆçš„å†…å­˜å¤§å°å¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œ å¦‚æœè™šæ‹Ÿæœºåœ¨åŠ¨æ€æ‰©å±•æ ˆæ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œåˆ™æŠ›å‡º**OutOfMemoryError**å¼‚å¸¸ã€‚\næ€»ç»“ï¼Œç¨‹åºè¿è¡Œä¸­æ ˆå¯èƒ½å‡ºç°çš„ä¸¤ç§é”™è¯¯\nStackOverFlowErrorï¼šè‹¥æ ˆçš„å†…å­˜å¤§å°ä¸å…è®¸åŠ¨æ€æ‰©å±•ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹è¯·æ±‚æ ˆçš„æ·±åº¦è¶…è¿‡å½“å‰ Java è™šæ‹Ÿæœºæ ˆçš„æœ€å¤§æ·±åº¦çš„æ—¶å€™ï¼Œå°±æŠ›å‡º StackOverFlowError é”™è¯¯ã€‚ OutOfMemoryErrorï¼š å¦‚æœæ ˆçš„å†…å­˜å¤§å°å¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œ å¦‚æœè™šæ‹Ÿæœºåœ¨åŠ¨æ€æ‰©å±•æ ˆæ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œåˆ™æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚ æœ¬åœ°æ–¹æ³•æ ˆ # å’Œè™šæ‹Ÿæœºæ ˆä½œç”¨ç›¸ä¼¼ï¼ŒåŒºåˆ«ï¼šè™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡ŒJavaæ–¹æ³•ï¼ˆå­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„Nativeæ–¹æ³•æœåŠ¡ã€‚HotSpotè™šæ‹Ÿæœºä¸­å’ŒJavaè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€\nåŒä¸Šï¼Œæœ¬åœ°æ–¹æ³•è¢«æ‰§è¡Œæ—¶ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜æ”¾æœ¬åœ°æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€å‡ºå£ä¿¡æ¯\næ–¹æ³•æ‰§è¡Œå®Œæ¯•åç›¸åº”çš„æ ˆå¸§ä¹Ÿä¼šå‡ºæ ˆå¹¶é‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œä¹Ÿä¼šå‡ºç°StackOverFlowErrorå’ŒOutOfMemoryErrorä¸¤ç§é”™è¯¯\nå † # Javaè™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼ŒJavaå †æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»º\næ­¤å†…å­˜åŒºåŸŸå”¯ä¸€ç›®çš„æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹åŠæ•°ç»„ï¼Œéƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜\nâ€œå‡ ä¹â€ï¼Œå› ä¸ºéšç€JITç¼–è¯‘å™¨çš„å‘å±•ä¸é€ƒé€¸åˆ†ææŠ€æœ¯é€æ¸æˆç†Ÿï¼Œæ ˆä¸Šåˆ†é…ã€æ ‡é‡æ›¿æ¢å¯¼è‡´å¾®å¦™å˜åŒ–ã€‚ä»JDK1.7å¼€å§‹å·²ç»é»˜è®¤é€ƒé€¸åˆ†æï¼Œå¦‚æœæŸäº›æ–¹æ³•çš„å¯¹è±¡å¼•ç”¨æ²¡æœ‰è¢«è¿”å›æˆ–è€…æœªè¢«å¤–é¢ä½¿ç”¨ï¼ˆæœªé€ƒé€¸å‡ºå»ï¼‰ï¼Œé‚£ä¹ˆå¯¹è±¡å¯ä»¥ç›´æ¥åœ¨æ ˆä¸Šåˆ†é…å†…å­˜ã€‚\nJavaå †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿç§°GCå †ï¼ˆGarbage Collected Heapï¼‰\nç°åœ¨æ”¶é›†å™¨åŸºæœ¬éƒ½é‡‡ç”¨åˆ†ä»£åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œä»åƒåœ¾å›æ”¶çš„è§’åº¦ï¼ŒJavaå †è¿˜ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚å†ç»†è‡´ï¼šEdenï¼ŒSurvivorï¼ŒOldç­‰ç©ºé—´ã€‚\u0026gt; ç›®çš„æ˜¯æ›´å¥½çš„å›æ”¶å†…å­˜ï¼Œæˆ–æ›´å¿«åœ°åˆ†é…å†…å­˜\nJDK7åŠJDK7ä¹‹å‰ï¼Œå †å†…å­˜è¢«åˆ†ä¸ºä¸‰éƒ¨åˆ†\næ–°ç”Ÿä»£å†…å­˜(Young Generation)ï¼ŒåŒ…æ‹¬EdenåŒºã€ä¸¤ä¸ªSurvivoråŒºS0å’ŒS1ã€8:1:1ã€‘ è€ç”Ÿä»£(Old Generation) ã€æ–°ç”Ÿä»£ : è€å¹´ä»£= 1: 2ã€‘ æ°¸ä¹…ä»£(Permanent Generation) JDK8ä¹‹åPermGenï¼ˆæ°¸ä¹…ï¼‰å·²è¢«Metaspaceï¼ˆå…ƒç©ºé—´ï¼‰å–ä»£ï¼Œä¸”å…ƒç©ºé—´ä½¿ç”¨ç›´æ¥å†…å­˜\nå¤§éƒ¨åˆ†æƒ…å†µï¼Œå¯¹è±¡éƒ½ä¼šé¦–å…ˆåœ¨ Eden åŒºåŸŸåˆ†é…ï¼Œåœ¨ä¸€æ¬¡æ–°ç”Ÿä»£åƒåœ¾å›æ”¶åï¼Œå¦‚æœå¯¹è±¡è¿˜å­˜æ´»ï¼Œåˆ™ä¼šè¿›å…¥ S0 æˆ–è€… S1ï¼Œå¹¶ä¸”å¯¹è±¡çš„å¹´é¾„è¿˜ä¼šåŠ  1(Eden åŒº-\u0026gt;Survivor åŒºåå¯¹è±¡çš„åˆå§‹å¹´é¾„å˜ä¸º 1)ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º 15 å²ï¼‰ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚\nå¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œå¯ä»¥é€šè¿‡å‚æ•° -XX:MaxTenuringThreshold æ¥è®¾ç½®ã€‚\nä¿®æ­£ï¼ˆå‚è§ï¼šissue552open in new windowï¼‰ ï¼šâ€œHotspot éå†æ‰€æœ‰å¯¹è±¡æ—¶ï¼ŒæŒ‰ç…§å¹´é¾„ä»å°åˆ°å¤§å¯¹å…¶æ‰€å ç”¨çš„å¤§å°è¿›è¡Œç´¯ç§¯ï¼Œå½“ç´¯ç§¯çš„æŸä¸ªå¹´é¾„å¤§å°è¶…è¿‡äº† survivor åŒºçš„ä¸€åŠæ—¶ï¼Œå–è¿™ä¸ªå¹´é¾„å’Œ MaxTenuringThreshold ä¸­æ›´å°çš„ä¸€ä¸ªå€¼ï¼Œä½œä¸ºæ–°çš„æ™‹å‡å¹´é¾„é˜ˆå€¼â€ã€‚å›¾è§£ï¼š\nä»£ç å¦‚ä¸‹ï¼š\nuint ageTable::compute_tenuring_threshold(size_t survivor_capacity) { //survivor_capacityæ˜¯survivorç©ºé—´çš„å¤§å° size_t desired_survivor_size = (size_t)((((double) survivor_capacity)*TargetSurvivorRatio)/100); size_t total = 0; uint age = 1; while (age \u0026lt; table_size) { total += sizes[age];//sizesæ•°ç»„æ˜¯æ¯ä¸ªå¹´é¾„æ®µå¯¹è±¡å¤§å° if (total \u0026gt; desired_survivor_size) break; age++; } uint result = age \u0026lt; MaxTenuringThreshold ? age : MaxTenuringThreshold; ... } å †é‡Œæœ€å®¹æ˜“å‡ºç°OutOfMemoryErroré”™è¯¯ï¼Œå‡ºç°è¿™ä¸ªé”™è¯¯ä¹‹åçš„è¡¨ç°å½¢å¼ï¼š\njava.lang.OutOfMemoryError: GC Overhead Limit Exceeded ï¼š å½“ JVM èŠ±å¤ªå¤šæ—¶é—´æ‰§è¡Œåƒåœ¾å›æ”¶å¹¶ä¸”åªèƒ½å›æ”¶å¾ˆå°‘çš„å †ç©ºé—´æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤é”™è¯¯ã€‚\njava.lang.OutOfMemoryError: Java heap space :å‡å¦‚åœ¨åˆ›å»ºæ–°çš„å¯¹è±¡æ—¶, å †å†…å­˜ä¸­çš„ç©ºé—´ä¸è¶³ä»¥å­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡, å°±ä¼šå¼•å‘æ­¤é”™è¯¯ã€‚\n(å’Œé…ç½®çš„æœ€å¤§å †å†…å­˜æœ‰å…³ï¼Œä¸”å—åˆ¶äºç‰©ç†å†…å­˜å¤§å°ã€‚æœ€å¤§å †å†…å­˜å¯é€šè¿‡-Xmxå‚æ•°é…ç½®ï¼Œè‹¥æ²¡æœ‰ç‰¹åˆ«é…ç½®ï¼Œå°†ä¼šä½¿ç”¨é»˜è®¤å€¼ï¼Œè¯¦è§ï¼šDefault Java 8 max heap sizeopen in new window)\n\u0026hellip;\næ–¹æ³•åŒº # æ–¹æ³•åŒºå±äºJVMè¿è¡Œæ—¶æ•°æ®åŒºåŸŸçš„ä¸€å—é€»è¾‘åŒºåŸŸï¼Œæ˜¯å„çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸ\nâ€œé€»è¾‘â€ï¼Œã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹è§„å®šäº†æœ‰æ–¹æ³•åŒºè¿™ä¹ˆä¸ªæ¦‚å¿µå’Œå®ƒçš„ä½œç”¨ï¼Œæ–¹æ³•åŒºå¦‚ä½•å®ç°æ˜¯è™šæ‹Ÿæœºçš„äº‹ã€‚å³ï¼Œä¸åŒè™šæ‹Ÿæœºå®ç°ä¸Šï¼Œæ–¹æ³•åŒºçš„å®ç°æ˜¯ä¸åŒçš„\nå½“è™šæ‹Ÿæœºè¦ä½¿ç”¨ä¸€ä¸ªç±»æ—¶ï¼Œå®ƒéœ€è¦è¯»å–å¹¶è§£æClassæ–‡ä»¶è·å–ç›¸å…³ä¿¡æ¯ï¼Œå†å°†ä¿¡æ¯å­˜å…¥æ–¹æ³•åŒºã€‚æ–¹æ³•åŒºä¼šå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å­—æ®µä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ç­‰æ•°æ®\næ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£ä»¥åŠå…ƒç©ºé—´æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ\næ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£ä»¥åŠå…ƒç©ºé—´çš„å…³ç³»å¾ˆåƒJavaä¸­æ¥å£å’Œç±»çš„å…³ç³»ï¼Œç±»å®ç°äº†æ¥å£ï¼Œè¿™é‡Œçš„ç±»å°±å¯ä»¥çœ‹ä½œæ˜¯æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´ï¼Œæ¥å£åˆ™çœ‹ä½œæ˜¯æ–¹æ³•åŒº æ°¸ä¹…ä»£åŠå…ƒç©ºé—´ï¼Œæ˜¯HotSpotè™šæ‹Ÿæœºå¯¹è™šæ‹Ÿæœºè§„èŒƒä¸­æ–¹æ³•åŒºçš„ä¸¤ç§å®ç°æ–¹å¼ æ°¸ä¹…ä»£æ˜¯JDK1.8ä¹‹å‰çš„æ–¹æ³•åŒºå®ç°ï¼Œå…ƒç©ºé—´æ˜¯JDK1.8åŠä¹‹åæ–¹æ³•åŒºçš„å®ç° ä¸ºä»€ä¹ˆå°†æ°¸ä¹…ä»£ï¼ˆPermGenï¼‰æ›¿æ¢æˆå…ƒç©ºé—´ï¼ˆMetaSpaceï¼‰å‘¢\nä¸‹å›¾æ¥è‡ªã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ç¬¬3ç‰ˆ\næ•´ä¸ªæ°¸ä¹…ä»£æœ‰ä¸€ä¸ªJVMæœ¬èº«è®¾ç½®çš„å›ºå®šå¤§å°ä¸Šé™ï¼ˆä¹Ÿå°±æ˜¯å‚æ•°æŒ‡å®šï¼‰ï¼Œæ— æ³•è¿›è¡Œè°ƒæ•´ï¼Œè€Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯ç›´æ¥å†…å­˜ï¼Œå—æœ¬æœºå¯ç”¨å†…å­˜çš„é™åˆ¶ã€‚è™½ç„¶å…ƒç©ºé—´ä»æ—§å¯èƒ½æº¢å‡ºï¼Œä½†æ¯”åŸæ¥å‡ºç°çš„æœºç‡ä¼šæ›´å°\nå…ƒç©ºé—´æº¢å‡ºå°†å¾—åˆ°é”™è¯¯ï¼š java.lang.OutOfMemoryError: MetaSpace\n-XX: MaxMetaspaceSizeè®¾ç½®æœ€å¤§å…ƒç©ºé—´å¤§å°ï¼Œé»˜è®¤ä¸ºunlimitedï¼Œå³åªå—ç³»ç»Ÿå†…å­˜é™åˆ¶ -XX: MetaspaceSizeè°ƒæ•´æ ‡å¿—å®šä¹‰å…ƒç©ºé—´çš„åˆå§‹å¤§å°ï¼Œå¦‚æœæœªæŒ‡å®šæ­¤æ ‡å¿—ï¼Œåˆ™Metaspaceå°†æ ¹æ®è¿è¡Œæ—¶åº”ç”¨ç¨‹åºéœ€æ±‚ï¼ŒåŠ¨æ€åœ°é‡æ–°è°ƒæ•´å¤§å°ã€‚ å…ƒç©ºé—´é‡Œå­˜æ”¾çš„æ˜¯ç±»çš„å…ƒæ•°æ®ï¼Œè¿™æ ·åŠ è½½å¤šå°‘ç±»çš„å…ƒæ•°æ®å°±ä¸ç”±MaxPermSizeæ§åˆ¶äº†ï¼Œè€Œç”±ç³»ç»Ÿçš„å®é™…å¯ç”¨ç©ºé—´æ§åˆ¶ï¼Œè¿™æ ·åŠ è½½çš„ç±»å°±æ›´å¤šäº†\nåœ¨ JDK8ï¼Œåˆå¹¶ HotSpot å’Œ JRockit çš„ä»£ç æ—¶, JRockit ä»æ¥æ²¡æœ‰ä¸€ä¸ªå«æ°¸ä¹…ä»£çš„ä¸œè¥¿, åˆå¹¶ä¹‹åå°±æ²¡æœ‰å¿…è¦é¢å¤–çš„è®¾ç½®è¿™ä¹ˆä¸€ä¸ªæ°¸ä¹…ä»£çš„åœ°æ–¹äº†\næ–¹æ³•åŒºå¸¸ç”¨å‚æ•°æœ‰å“ªäº› JDK1.8ä¹‹å‰æ°¸ä¹…ä»£è¿˜æ²¡æœ‰è¢«å½»åº•ç§»é™¤æ—¶é€šè¿‡ä¸‹é¢å‚æ•°è°ƒèŠ‚æ–¹æ³•åŒºå¤§å°\n-XX:PermSize=N//æ–¹æ³•åŒº (æ°¸ä¹…ä»£) åˆå§‹å¤§å° -XX:MaxPermSize=N//æ–¹æ³•åŒº (æ°¸ä¹…ä»£) æœ€å¤§å¤§å°,è¶…è¿‡è¿™ä¸ªå€¼å°†ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸:java.lang.OutOfMemoryError: PermGen ç›¸å¯¹è€Œè¨€ï¼Œåƒåœ¾æ”¶é›†è¡Œä¸ºåœ¨è¿™ä¸ªåŒºåŸŸæ˜¯æ¯”è¾ƒå°‘å‡ºç°çš„ï¼Œä½†**å¹¶éæ•°æ®è¿›å…¥æ–¹æ³•åŒºåå°±â€œæ°¸ä¹…å­˜åœ¨â€**äº†ã€‚\nJDK1.7æ–¹æ³•åŒº(HotSpotçš„æ°¸ä¹…ä»£)è¢«ç§»é™¤ä¸€éƒ¨åˆ†ï¼ŒJDK1.8æ—¶æ–¹æ³•åŒºè¢«å½»åº•ç§»é™¤ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å…ƒç©ºé—´ï¼Œå…ƒç©ºé—´ä½¿ç”¨ç›´æ¥å†…å­˜ï¼Œä¸‹é¢æ˜¯å¸¸ç”¨å‚æ•°\n-XX:MetaspaceSize=N //è®¾ç½® Metaspace çš„åˆå§‹ï¼ˆå’Œæœ€å°å¤§å°ï¼‰ -XX:MaxMetaspaceSize=N //è®¾ç½® Metaspace çš„æœ€å¤§å¤§å° ä¸æ°¸ä¹…ä»£ä¸åŒï¼Œå¦‚æœä¸æŒ‡å®šå¤§å°ï¼Œéšç€æ›´å¤šç±»çš„åˆ›å»ºï¼Œè™šæ‹Ÿæœºä¼šè€—å°½æ‰€æœ‰å¯ç”¨çš„ç³»ç»Ÿå†…å­˜ã€‚\nè¿è¡Œæ—¶å¸¸é‡æ±  # Classæ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰ç”¨äºå­˜æ”¾ç¼–è¯‘å™¨æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡ï¼ˆLiteralï¼‰å’Œç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referenceï¼‰çš„å¸¸é‡æ± è¡¨ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œçš„å¸¸é‡æ± è¡¨ï¼Œè¯´çš„æ˜¯åˆšåˆšç¼–è¯‘åçš„é‚£ä¸ªclassæ–‡ä»¶å­—èŠ‚ç ä»£è¡¨çš„å«ä¹‰ï¼‰\nå­—é¢é‡æ˜¯æºä»£ç ä¸­çš„å›ºå®šå€¼è¡¨ç¤ºæ³•ï¼Œå³é€šè¿‡å­—é¢æˆ‘ä»¬å°±çŸ¥é“å…¶å€¼çš„å«ä¹‰ã€‚å­—é¢é‡åŒ…æ‹¬æ•´æ•°ã€æµ®ç‚¹æ•°å’Œå­—ç¬¦ä¸²å­—é¢é‡ï¼›ç¬¦å·å¼•ç”¨åŒ…æ‹¬ç±»ç¬¦å·å¼•ç”¨ã€å­—æ®µç¬¦å·å¼•ç”¨ã€æ–¹æ³•ç¬¦å·å¼•ç”¨å’Œæ¥å£æ–¹æ³•ç¬¦å·å¼•ç”¨ã€‚\nå¸¸é‡æ± è¡¨ä¼šåœ¨ç±»åŠ è½½åå­˜æ”¾åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­\nè¿è¡Œæ—¶å¸¸é‡æ± çš„åŠŸèƒ½ç±»ä¼¼äºä¼ ç»Ÿç¼–ç¨‹è¯­è¨€çš„ç¬¦å·è¡¨(ä½†æ˜¯åŒ…å«äº†æ¯”å…¸å‹ç¬¦å·è¡¨æ›´å¹¿æ³›çš„æ•°æ®)\nè¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥å—åˆ°æ–¹æ³•åŒºå†…å­˜çš„é™åˆ¶ï¼Œå½“å¸¸é‡æ± æ— æ³•å†ç”³è¯·åˆ°å†…å­˜æ—¶ä¼šæŠ›å‡ºOutOfMemoryErrorçš„é”™è¯¯\nå­—ç¬¦ä¸²å¸¸é‡æ±  # å­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯JVMä¸ºäº†æå‡æ€§èƒ½å’Œå‡å°‘å†…å­˜æ¶ˆè€—é’ˆå¯¹å­—ç¬¦ä¸²(Stringç±»)ä¸“é—¨å¼€è¾Ÿçš„ä¸€å—åŒºåŸŸï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†é¿å…å­—ç¬¦ä¸²å¾—é‡å¤åˆ›å»º\n// åœ¨å †ä¸­åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡â€abâ€œ // å°†å­—ç¬¦ä¸²å¯¹è±¡â€abâ€œçš„å¼•ç”¨ä¿å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ String aa = \u0026#34;ab\u0026#34;; // ç›´æ¥è¿”å›å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­—ç¬¦ä¸²å¯¹è±¡â€abâ€œçš„å¼•ç”¨ String bb = \u0026#34;ab\u0026#34;; System.out.println(aa==bb);// true HotSpot è™šæ‹Ÿæœºä¸­å­—ç¬¦ä¸²å¸¸é‡æ± çš„å®ç°æ˜¯ src/hotspot/share/classfile/stringTable.cpp ,StringTable æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªHashSet\u0026lt;String\u0026gt; ,å®¹é‡ä¸º StringTableSizeï¼ˆå¯ä»¥é€šè¿‡ -XX:StringTableSize å‚æ•°æ¥è®¾ç½®ï¼‰ã€‚\nStringTable ä¸­ä¿å­˜çš„æ˜¯å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ï¼Œå­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨æŒ‡å‘å †ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚\nJDK1.7ä¹‹å‰ï¼Œ (å­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡)å­˜æ”¾åœ¨æ°¸ä¹…ä»£ã€‚JDK1.7å­—ç¬¦ä¸²å¸¸é‡æ± å’Œé™æ€å˜é‡ä»æ°¸ä¹…ä»£ç§»åŠ¨åˆ°äº†Javaå †ä¸­ JDK1.7ä¸ºä»€ä¹ˆè¦å°†å­—ç¬¦ä¸²å¸¸é‡æ± ç§»åŠ¨åˆ°å †ä¸­\nå› ä¸ºæ°¸ä¹…ä»£ï¼ˆæ–¹æ³•åŒºå®ç°ï¼‰çš„GCå›æ”¶æ•ˆç‡å¤ªä½ï¼Œåªæœ‰åœ¨æ•´å †æ”¶é›†ï¼ˆFull GCï¼‰çš„æ—¶å€™æ‰ä¼šè¢«æ‰§è¡ŒGCã€‚Javaç¨‹åºä¸­é€šå¸¸æœ‰å¤§é‡çš„è¢«åˆ›å»ºçš„å­—ç¬¦ä¸²ç­‰å¾…å›æ”¶ï¼Œå°†å­—ç¬¦ä¸²å¸¸é‡æ± æ”¾åˆ°å †ä¸­ï¼Œèƒ½å¤Ÿé«˜æ•ˆåŠæ—¶åœ°å›æ”¶å­—ç¬¦ä¸²å†…å­˜ã€‚\nJVMå¸¸é‡æ± ä¸­å­˜å‚¨çš„æ˜¯å¯¹è±¡è¿˜æ˜¯å¼•ç”¨\nå¦‚æœæ‚¨è¯´çš„ç¡®å®æ˜¯runtime constant poolï¼ˆè€Œä¸æ˜¯interned string pool / StringTableä¹‹ç±»çš„å…¶ä»–ä¸œè¥¿ï¼‰çš„è¯ï¼Œå…¶ä¸­çš„å¼•ç”¨ç±»å‹å¸¸é‡ï¼ˆä¾‹å¦‚CONSTANT_Stringã€CONSTANT_Classã€CONSTANT_MethodHandleã€CONSTANT_MethodTypeä¹‹ç±»ï¼‰éƒ½å­˜çš„æ˜¯å¼•ç”¨ï¼Œå®é™…çš„å¯¹è±¡è¿˜æ˜¯å­˜åœ¨Java heapä¸Šçš„ã€‚ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€‘\nè¿è¡Œæ—¶å¸¸é‡æ± ã€æ–¹æ³•åŒºã€å­—ç¬¦ä¸²å¸¸é‡æ± è¿™äº›éƒ½æ˜¯ä¸éšè™šæ‹Ÿæœºå®ç°è€Œæ”¹å˜çš„é€»è¾‘æ¦‚å¿µï¼Œæ˜¯å…¬å…±ä¸”æŠ½è±¡çš„ï¼ŒMetaspaceã€Heap æ˜¯ä¸å…·ä½“æŸç§è™šæ‹Ÿæœºå®ç°ç›¸å…³çš„ç‰©ç†æ¦‚å¿µï¼Œæ˜¯ç§æœ‰ä¸”å…·ä½“çš„ã€‚\næ€»ç»“ # ç›´æ¥å†…å­˜ # ç›´æ¥å†…å­˜å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸï¼Œä½†æ˜¯è¿™éƒ¨åˆ†å†…å­˜ä¹Ÿè¢«é¢‘ç¹ä½¿ç”¨ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´OutOfMemoryErroré”™è¯¯å‡ºç° JDK1.4ä¸­æ–°åŠ å…¥çš„NIO(New Input/Output)ç±»ï¼Œå¼•å…¥ä¸€ç§åŸºäºé€šé“ï¼ˆChannelï¼‰ä¸ç¼“å†²åŒºï¼ˆBufferï¼‰çš„I/Oæ–¹å¼ï¼Œå®ƒå¯ä»¥ç›´æ¥ä½¿ç”¨Nativeå‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨Javaå †ä¸­çš„DirectByteBufferå¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·å°±èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨Javaå †å’ŒNativeå †ä¹‹é—´æ¥å›å¤åˆ¶æ•°æ® æœ¬æœºç›´æ¥å†…å­˜çš„åˆ†é…ä¸ä¼šå—åˆ°Javaå †çš„é™åˆ¶ï¼Œä½†æ˜¯ï¼Œæ—¢ç„¶æ˜¯å†…å­˜å°±ä¼šå—åˆ°æœ¬æœºæ€»å†…å­˜å¤§å°ä»¥åŠå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶ HotSpotè™šæ‹Ÿæœºå¯¹è±¡æ¢ç§˜ # äº†è§£ä¸€ä¸‹HotSportè™šæ‹Ÿæœºåœ¨Javaå †ä¸­å¯¹è±¡åˆ†é…ã€å¸ƒå±€å’Œè®¿é—®çš„å…¨è¿‡ç¨‹\nå¯¹è±¡çš„åˆ›å»º # é»˜è®¤ï¼š\nç±»åŠ è½½æ£€æŸ¥ è™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡newæŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆå°†å»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°ï¼ˆä¹Ÿå°±æ˜¯åé¢è¯´çš„ç¬¦å·å¼•ç”¨ï¼‰ï¼Œçœ‹æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½è¿‡ã€è§£æå’Œåˆå§‹åŒ–è¿‡ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£å¿…é¡»å…ˆæ‰§è¡Œç›¸åº”çš„ç±»åŠ è½½è¿‡ç¨‹\nåˆ†é…å†…å­˜ ç±»åŠ è½½æ£€æŸ¥é€šè¿‡åï¼Œæ¥ä¸‹æ¥è™šæ‹Ÿæœºå°†ä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜ã€‚å¯¹è±¡æ‰€éœ€å†…å­˜å¤§å°åœ¨ç±»åŠ è½½åä¾¿å¯ç¡®å®šï¼Œä¸ºå¯¹è±¡åˆ†é…ç©ºé—´çš„ä»»åŠ¡ï¼Œç­‰åŒäºæŠŠä¸€å—ç¡®å®šå¤§å°çš„å†…å­˜ä»Javaå †ä¸­åˆ’åˆ†å‡ºæ¥**ã€‚ åˆ†é…æ–¹å¼æœ‰**â€æŒ‡é’ˆç¢°æ’â€œå’Œâ€ç©ºé—²åˆ—è¡¨â€œä¸¤ç§ï¼Œé€‰æ‹©å“ªç§åˆ†é…æ–¹å¼ç”±Javaå †æ˜¯å¦è§„æ•´å†³å®š**ï¼Œè€ŒJavaå †æ˜¯å¦è§„æ•´åˆç”±æ‰€é‡‡ç”¨çš„åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰å‹ç¼©æ•´ç†åŠŸèƒ½å†³å®š å†…å­˜åˆ†é…çš„ä¸¤ç§æ–¹å¼ï¼š\næŒ‡é’ˆç¢°æ’\né€‚ç”¨åœºåˆï¼š**å †å†…å­˜è§„æ•´ï¼ˆå³æ²¡æœ‰å†…å­˜ç¢ç‰‡ï¼‰**çš„æƒ…å†µä¸‹ åŸç†ï¼šç”¨è¿‡çš„å†…å­˜å…¨éƒ¨æ•´åˆåˆ°ä¸€è¾¹ï¼Œæ²¡æœ‰ç”¨è¿‡çš„å†…å­˜æ”¾åœ¨å¦ä¸€è¾¹ï¼Œä¸­é—´æœ‰ä¸€ä¸ªåˆ†ç•ŒæŒ‡é’ˆåªéœ€è¦å‘ç€æ²¡ç”¨è¿‡çš„å†…å­˜æ–¹å‘ï¼Œå°†è¯¥æŒ‡é’ˆç§»åŠ¨å¯¹è±¡å†…å­˜çš„å¤§å°çš„ä½ç½®å³å¯ ä½¿ç”¨è¯¥åˆ†é…æ–¹å¼çš„GCæ”¶é›†å™¨ï¼šSerialï¼ŒPartNew ç©ºé—²åˆ—è¡¨\né€‚åˆåœºåˆï¼šå †å†…å­˜ä¸è§„æ•´çš„æƒ…å†µä¸‹ åŸç†ï¼šè™šæ‹Ÿæœºä¼šç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨ä¸­ä¼šè®°å½•å“ªäº›å†…å­˜å—æ˜¯å¯ç”¨çš„ï¼Œåœ¨åˆ†é…çš„æ—¶å€™ï¼Œæ‰¾ä¸€å—è¶³å¤Ÿå¤§çš„å†…å­˜å—æ¥åˆ’åˆ†ç»™å¯¹è±¡å®ä¾‹ï¼Œæœ€åæ›´æ–°åˆ—è¡¨è®°å½• ä½¿ç”¨è¯¥åˆ†é…æ–¹å¼çš„GCæ”¶é›†å™¨ï¼šCMS é€‰æ‹©ä»¥ä¸Šä¸¤ç§æ–¹å¼ä¸­çš„å“ªä¸€ç§ï¼Œå–å†³äº Java å †å†…å­˜æ˜¯å¦è§„æ•´ã€‚è€Œ Java å †å†…å­˜æ˜¯å¦è§„æ•´ï¼Œå–å†³äº GC æ”¶é›†å™¨çš„ç®—æ³•æ˜¯**\u0026ldquo;æ ‡è®°-æ¸…é™¤\u0026rdquo;ï¼Œè¿˜æ˜¯\u0026ldquo;æ ‡è®°-æ•´ç†\u0026rdquo;ï¼ˆä¹Ÿç§°ä½œ\u0026ldquo;æ ‡è®°-å‹ç¼©\u0026rdquo;**ï¼‰ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¤åˆ¶ç®—æ³•å†…å­˜ä¹Ÿæ˜¯è§„æ•´çš„\nå†…å­˜åˆ†é…å¹¶å‘é—®é¢˜ï¼š\nåˆ›å»ºå¯¹è±¡æ—¶çš„é‡è¦é—®é¢˜\u0026mdash;çº¿ç¨‹å®‰å…¨ï¼Œå› ä¸ºåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåˆ›å»ºå¯¹è±¡æ˜¯å¾ˆé¢‘ç¹çš„äº‹ï¼Œä½œä¸ºè™šæ‹Ÿæœºæ¥è¯´ï¼Œå¿…é¡»è¦ä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè™šæ‹Ÿæœºé‡‡ç”¨ä¸¤ç§æ–¹å¼ä¿è¯çº¿ç¨‹å®‰å…¨ï¼š\nCAS+å¤±è´¥é‡è¯•:\nCAS æ˜¯ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼ã€‚æ‰€è°“ä¹è§‚é”å°±æ˜¯ï¼Œæ¯æ¬¡ä¸åŠ é”è€Œæ˜¯å‡è®¾æ²¡æœ‰å†²çªè€Œå»å®ŒæˆæŸé¡¹æ“ä½œï¼Œå¦‚æœå› ä¸ºå†²çªå¤±è´¥å°±é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢\nè™šæ‹Ÿæœºé‡‡ç”¨CAS+å¤±è´¥é‡è¯•çš„æ–¹å¼ä¿è¯æ›´æ–°æ“ä½œçš„åŸå­æ€§\nTLABï¼šä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹ é¢„å…ˆ åœ¨EdenåŒºåˆ†é…ä¸€å—å†…å­˜ï¼ŒJVMåœ¨ç»™çº¿ç¨‹ä¸­çš„å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œé¦–å…ˆåœ¨TLABï¼ˆè¯¥å†…å­˜åŒºåŸŸï¼‰åˆ†é…ï¼Œå½“å¯¹è±¡å¤§äºTLABä¸­çš„å‰©ä½™å†…å­˜æˆ–TLABçš„å†…å­˜å·²ç”¨å°½æ—¶ï¼Œå†é‡‡ç”¨ä¸Šè¿°çš„CASè¿›è¡Œå†…å­˜åˆ†é…\nåœ¨é¢„ç•™è¿™ä¸ªæ“ä½œå‘ç”Ÿçš„æ—¶å€™ï¼Œéœ€è¦è¿›è¡ŒåŠ é”æˆ–è€…é‡‡ç”¨CASç­‰æ“ä½œè¿›è¡Œä¿æŠ¤ï¼Œé¿å…å¤šä¸ªçº¿ç¨‹é¢„ç•™åŒä¸€ä¸ªåŒºåŸŸ\nåˆå§‹åŒ–é›¶å€¼ å†…å­˜åˆ†é…å®Œæˆåï¼Œè™šæ‹Ÿæœºéœ€è¦å°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼ˆä¸åŒ…æ‹¬å¯¹è±¡å¤´ï¼‰ï¼Œè¿™ä¸€æ­¥æ“ä½œä¿è¯äº†å¯¹è±¡çš„å®ä¾‹å­—æ®µåœ¨ Java ä»£ç ä¸­å¯ä»¥ä¸èµ‹åˆå§‹å€¼å°±ç›´æ¥ä½¿ç”¨ï¼Œç¨‹åºèƒ½è®¿é—®åˆ°è¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹æ‰€å¯¹åº”çš„é›¶å€¼ã€‚\nè®¾ç½®å¯¹è±¡å¤´\nåˆå§‹åŒ–é›¶å€¼å®Œæˆä¹‹åï¼Œè™šæ‹Ÿæœºè¦å¯¹å¯¹è±¡è¿›è¡Œå¿…è¦çš„è®¾ç½®ï¼Œä¾‹å¦‚è¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œç ã€å¯¹è±¡çš„ GC åˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ã€‚ è¿™äº›ä¿¡æ¯å­˜æ”¾åœ¨å¯¹è±¡å¤´ä¸­ã€‚ å¦å¤–ï¼Œæ ¹æ®è™šæ‹Ÿæœºå½“å‰è¿è¡ŒçŠ¶æ€çš„ä¸åŒï¼Œå¦‚æ˜¯å¦å¯ç”¨åå‘é”ç­‰ï¼Œå¯¹è±¡å¤´ä¼šæœ‰ä¸åŒçš„è®¾ç½®æ–¹å¼ã€‚\næ‰§è¡Œinitæ–¹æ³•\nåœ¨ä¸Šé¢å·¥ä½œéƒ½å®Œæˆä¹‹åï¼Œä»è™šæ‹Ÿæœºçš„è§†è§’æ¥çœ‹ï¼Œä¸€ä¸ªæ–°çš„å¯¹è±¡å·²ç»äº§ç”Ÿäº†ï¼Œä½†ä» Java ç¨‹åºçš„è§†è§’æ¥çœ‹ï¼Œå¯¹è±¡åˆ›å»ºæ‰åˆšå¼€å§‹ï¼Œ\u0026lt;init\u0026gt; æ–¹æ³•è¿˜æ²¡æœ‰æ‰§è¡Œï¼Œæ‰€æœ‰çš„å­—æ®µéƒ½è¿˜ä¸ºé›¶ã€‚æ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œæ‰§è¡Œ new æŒ‡ä»¤ä¹‹åä¼šæ¥ç€æ‰§è¡Œ \u0026lt;init\u0026gt; æ–¹æ³•ï¼ŒæŠŠå¯¹è±¡æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ ·ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„å¯¹è±¡æ‰ç®—å®Œå…¨äº§ç”Ÿå‡ºæ¥ã€‚\né™„ï¼š Java åœ¨ç¼–è¯‘ä¹‹åä¼šåœ¨å­—èŠ‚ç æ–‡ä»¶ä¸­ç”Ÿæˆ init æ–¹æ³•ï¼Œç§°ä¹‹ä¸ºå®ä¾‹æ„é€ å™¨ï¼Œè¯¥å®ä¾‹æ„é€ å™¨ä¼šå°†è¯­å¥å—ï¼Œå˜é‡åˆå§‹åŒ–ï¼Œè°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨ç­‰æ“ä½œæ”¶æ•›åˆ° init æ–¹æ³•ä¸­ï¼Œæ”¶æ•›é¡ºåºä¸ºï¼š å˜é‡---\u0026gt; è¯­å¥å— ---\u0026gt; æ„é€ å‡½æ•°\nçˆ¶ç±»å˜é‡åˆå§‹åŒ– çˆ¶ç±»è¯­å¥å— çˆ¶ç±»æ„é€ å‡½æ•° å­ç±»å˜é‡åˆå§‹åŒ– å­ç±»è¯­å¥å— å­ç±»æ„é€ å‡½æ•° æ”¶æ•›åˆ° init æ–¹æ³•çš„æ„æ€æ˜¯ï¼šå°†è¿™äº›æ“ä½œæ”¾å…¥åˆ° init ä¸­å»æ‰§è¡Œã€‚ è½¬è‡ªï¼š https://juejin.cn/post/6844903957836333063\nå¯¹è±¡çš„å†…å­˜å¸ƒå±€ # Hotspotè™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€åˆ†ä¸º3å—åŒºåŸŸï¼šå¯¹è±¡å¤´ã€å®ä¾‹æ•°æ®å’Œå¯¹é½å¡«å…… å¯¹è±¡å¤´åˆåŒ…æ‹¬ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼Œç¬¬ä¸€éƒ¨åˆ†ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼ˆå“ˆå¸Œç ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ç­‰ç­‰ï¼‰ï¼Œå³markwordï¼›ç¬¬äºŒéƒ¨åˆ†æ˜¯ç±»å‹æŒ‡é’ˆï¼Œå³å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚ å®ä¾‹æ•°æ®éƒ¨åˆ†æ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯ï¼Œä¹Ÿæ˜¯åœ¨ç¨‹åºä¸­æ‰€å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µå†…å®¹ å¯¹é½å¡«å……éƒ¨åˆ†ä¸æ˜¯å¿…ç„¶å­˜åœ¨çš„ï¼Œæ²¡ç‰¹åˆ«å«ä¹‰ï¼Œåªèµ·å ä½ä½œç”¨ã€‚å› ä¸ºHotspotè™šæ‹Ÿæœºçš„è‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼Œå³å¯¹è±¡çš„å¤§å°å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ã€‚è€Œå¯¹è±¡å¤´éƒ¨åˆ†æ­£å¥½æ˜¯8å­—èŠ‚çš„å€æ•°ï¼ˆ1å€æˆ–2å€ï¼‰ï¼Œå› æ­¤å½“å¯¹è±¡å®ä¾‹æ•°æ®éƒ¨åˆ†æ²¡æœ‰å¯¹é½æ—¶ï¼Œå°±éœ€è¦é€šè¿‡å¯¹é½å¡«å……æ¥è¡¥å…¨ å¯¹è±¡çš„è®¿é—®å®šä½ # å»ºç«‹å¯¹è±¡å°±æ˜¯ä¸ºäº†ä½¿ç”¨å¯¹è±¡ï¼Œæˆ‘ä»¬çš„ Java ç¨‹åºé€šè¿‡æ ˆä¸Šçš„ reference æ•°æ®æ¥æ“ä½œå †ä¸Šçš„å…·ä½“å¯¹è±¡ã€‚å¯¹è±¡çš„è®¿é—®æ–¹å¼ç”±è™šæ‹Ÿæœºå®ç°è€Œå®šï¼Œç›®å‰ä¸»æµçš„è®¿é—®æ–¹å¼æœ‰ï¼šä½¿ç”¨å¥æŸ„ã€ç›´æ¥æŒ‡é’ˆã€‚\nå¥æŸ„ å¦‚æœä½¿ç”¨å¥æŸ„çš„è¯ï¼Œé‚£ä¹ˆ Java å †ä¸­å°†ä¼šåˆ’åˆ†å‡ºä¸€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œreference ä¸­å­˜å‚¨çš„å°±æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œè€Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡å®ä¾‹æ•°æ®ä¸å¯¹è±¡ç±»å‹æ•°æ®å„è‡ªçš„å…·ä½“åœ°å€ä¿¡æ¯ã€‚\nã€ä¹Ÿå°±æ˜¯å¤šäº†ä¸€å±‚ã€‘\nç›´æ¥æŒ‡é’ˆ å¦‚æœä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼Œreference ä¸­å­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡çš„åœ°å€ã€‚ è¿™ä¸¤ç§å¯¹è±¡è®¿é—®æ–¹å¼å„æœ‰ä¼˜åŠ¿ã€‚ä½¿ç”¨å¥æŸ„æ¥è®¿é—®çš„æœ€å¤§å¥½å¤„æ˜¯ reference ä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šçš„å¥æŸ„åœ°å€ï¼Œåœ¨å¯¹è±¡è¢«ç§»åŠ¨æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œè€Œ reference æœ¬èº«ä¸éœ€è¦ä¿®æ”¹ã€‚ä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®æ–¹å¼æœ€å¤§çš„å¥½å¤„å°±æ˜¯é€Ÿåº¦å¿«ï¼Œå®ƒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€ã€‚\nHotSpot è™šæ‹Ÿæœºä¸»è¦ä½¿ç”¨çš„å°±æ˜¯è¿™ç§æ–¹å¼**(ç›´æ¥æŒ‡é’ˆ**)æ¥è¿›è¡Œå¯¹è±¡è®¿é—®ã€‚\n"},{"id":127,"href":"/zh/docs/study/Review/java_guide/java/Concurrent/ly0311lycompletablefuture-intro/","title":"completablefuture-intro","section":"å¹¶å‘","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nJava8è¢«å¼•å…¥çš„ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„ç”¨äºå¼‚æ­¥ç¼–ç¨‹çš„ç±»ã€æ²¡çœ‹ã€‘\nç®€å•ä»‹ç» # CompletableFutureåŒæ—¶å®ç°äº†Futureå’ŒCompletionStageæ¥å£\npublic class CompletableFuture\u0026lt;T\u0026gt; implements Future\u0026lt;T\u0026gt;, CompletionStage\u0026lt;T\u0026gt; { } CompletableFuture é™¤äº†æä¾›äº†æ›´ä¸ºå¥½ç”¨å’Œå¼ºå¤§çš„ Future ç‰¹æ€§ä¹‹å¤–ï¼Œè¿˜æä¾›äº†å‡½æ•°å¼ç¼–ç¨‹çš„èƒ½åŠ›ã€‚\nFutureæ¥å£æœ‰5ä¸ªæ–¹æ³•ï¼š\nboolean cancel(boolean mayInterruptIfRunning) ï¼šå°è¯•å–æ¶ˆæ‰§è¡Œä»»åŠ¡ã€‚ boolean isCancelled() ï¼šåˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆã€‚ boolean isDone() ï¼š åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»è¢«æ‰§è¡Œå®Œæˆã€‚ get() ï¼šç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆå¹¶è·å–è¿ç®—ç»“æœã€‚ get(long timeout, TimeUnit unit) ï¼šå¤šäº†ä¸€ä¸ªè¶…æ—¶æ—¶é—´ã€‚ CompletionStage\u0026lt;T\u0026gt; æ¥å£ä¸­çš„æ–¹æ³•æ¯”è¾ƒå¤šï¼ŒCompoletableFutureçš„å‡½æ•°å¼èƒ½åŠ›å°±æ˜¯è¿™ä¸ªæ¥å£èµ‹äºˆçš„ï¼Œå¤§é‡ä½¿ç”¨Java8å¼•å…¥çš„å‡½æ•°å¼ç¼–ç¨‹\nå¸¸è§æ“ä½œ # åˆ›å»ºCompletableFuture # ä¸¤ç§æ–¹æ³•ï¼šnewå…³é”®å­—æˆ– CompletableFutureè‡ªå¸¦çš„é™æ€å·¥å‚æ–¹æ³• runAysnc()æˆ–supplyAsync()\né€šè¿‡newå…³é”®å­— è¿™ä¸ªæ–¹å¼ï¼Œå¯ä»¥çœ‹ä½œæ˜¯å°†CompletableFutureå½“ä½œFutureæ¥ä½¿ç”¨ï¼Œå¦‚ä¸‹ï¼š\næˆ‘ä»¬é€šè¿‡åˆ›å»ºäº†ä¸€ä¸ªç»“æœå€¼ç±»å‹ä¸º RpcResponse\u0026lt;Object\u0026gt; çš„ CompletableFutureï¼Œä½ å¯ä»¥æŠŠ resultFuture çœ‹ä½œæ˜¯å¼‚æ­¥è¿ç®—ç»“æœçš„è½½ä½“\nCompletableFuture\u0026lt;RpcResponse\u0026lt;Object\u0026gt;\u0026gt; resultFuture = new CompletableFuture\u0026lt;\u0026gt;(); å¦‚æœåé¢æŸä¸ªæ—¶åˆ»ï¼Œå¾—åˆ°äº†æœ€ç»ˆç»“æœï¼Œå¯ä»¥è°ƒç”¨complete()æ–¹æ³•ä¼ å…¥ç»“æœï¼Œè¡¨ç¤ºresultFutureå·²ç»è¢«å®Œæˆï¼š\n// complete() æ–¹æ³•åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œåç»­è°ƒç”¨å°†è¢«å¿½ç•¥ã€‚ resultFuture.complete(rpcResponse); é€šè¿‡isDone()æ£€æŸ¥æ˜¯å¦å®Œæˆï¼š\npublic boolean isDone() { return result != null; } è·å–å¼‚æ­¥ç»“æœï¼Œä½¿ç”¨get() ï¼Œè°ƒç”¨get()æ–¹æ³•çš„çº¿ç¨‹ä¼šé˜»å¡ ç›´åˆ°CompletableFutureå®Œæˆè¿ç®—ï¼š rpcResponse = completableFuture.get();\npublic class CompletableFutureTest { public static void main(String[] args) throws ExecutionException, InterruptedException { /*CompletableFuture\u0026lt;Object\u0026gt; resultFuture=new CompletableFuture\u0026lt;\u0026gt;(); resultFuture.complete(\u0026#34;hello world\u0026#34;); System.out.println(resultFuture.get());*/ CompletableFuture\u0026lt;String\u0026gt; stringCompletableFuture = CompletableFuture.supplyAsync(() -\u0026gt; { try { TimeUnit.SECONDS.sleep(3); } catch (InterruptedException e) { e.printStackTrace(); } return \u0026#34;hello,world!\u0026#34;; }); System.out.println(\u0026#34;è¢«é˜»å¡å•¦----\u0026#34;); String s = stringCompletableFuture.get(); System.out.println(\u0026#34;ç»“æœ---\u0026#34;+s); } } å¦‚æœå·²ç»çŸ¥é“ç»“æœï¼š\nCompletableFuture\u0026lt;String\u0026gt; future = CompletableFuture.completedFuture(\u0026#34;hello!\u0026#34;); assertEquals(\u0026#34;hello!\u0026#34;, future.get()); //completedFuture() æ–¹æ³•åº•å±‚è°ƒç”¨çš„æ˜¯å¸¦å‚æ•°çš„ new æ–¹æ³•ï¼Œåªä¸è¿‡ï¼Œè¿™ä¸ªæ–¹æ³•ä¸å¯¹å¤–æš´éœ²ã€‚ public static CompletableFuture completedFuture(U value) { return new CompletableFuture((value == null) ? NIL : value); } åŸºäºCompletableFutureè‡ªå¸¦çš„é™æ€å·¥å‚æ–¹æ³•ï¼šrunAsync()ã€supplyAsync() Supplier ä¾›åº”å•†; ä¾›è´§å•†; ä¾›åº”è€…; ä¾›è´§æ–¹; è¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥å¸®åŠ©æˆ‘ä»¬å°è£…è®¡ç®—é€»è¾‘\nstatic CompletableFuture supplyAsync(Supplier supplier); // ä½¿ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ± (æ¨è) static CompletableFuture supplyAsync(Supplier supplier, Executor executor); static CompletableFuture\u0026lt;Void\u0026gt; runAsync(Runnable runnable); // ä½¿ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ± (æ¨è) static CompletableFuture\u0026lt;Void\u0026gt; runAsync(Runnable runnable, Executor executor); //ç®€å•ä½¿ç”¨ public class CompletableFutureTest { public static void main(String[] args) throws ExecutionException, InterruptedException { CompletableFuture\u0026lt;String\u0026gt; completableFuture = CompletableFuture.supplyAsync(() -\u0026gt; { //3såè¿”å›ç»“æœ try { TimeUnit.SECONDS.sleep(3); } catch (InterruptedException e) { e.printStackTrace(); } return \u0026#34;abc\u0026#34;; }); //è¿™é‡Œä¼šè¢«é˜»å¡ String s = completableFuture.get(); System.out.println(s); } } //ä¾‹å­2 import java.util.concurrent.CompletableFuture; import java.util.concurrent.CountDownLatch; import java.util.concurrent.ExecutionException; import java.util.concurrent.TimeUnit; public class CompletableFutureTest { public static void main(String[] args) throws ExecutionException, InterruptedException { CountDownLatch countDownLatch=new CountDownLatch(2); //ç›¸å½“äºä½¿ç”¨äº†ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå¼€å¯çº¿ç¨‹ï¼Œæäº¤äº†ä»»åŠ¡ CompletableFuture\u0026lt;Void\u0026gt; a = CompletableFuture.runAsync(() -\u0026gt; { System.out.println(\u0026#34;a\u0026#34;); //æ‰§è¡Œäº†3sçš„ä»»åŠ¡ try { TimeUnit.SECONDS.sleep(3); } catch (InterruptedException e) { e.printStackTrace(); } countDownLatch.countDown(); }); CompletableFuture\u0026lt;Void\u0026gt; b = CompletableFuture.runAsync(() -\u0026gt; { System.out.println(\u0026#34;b\u0026#34;); //æ‰§è¡Œäº†3sçš„ä»»åŠ¡ try { TimeUnit.SECONDS.sleep(2); } catch (InterruptedException e) { e.printStackTrace(); } countDownLatch.countDown(); }); countDownLatch.await(); System.out.println(\u0026#34;æ‰§è¡Œå®Œæ¯•\u0026#34;);//3såä¼šæ‰§è¡Œ } } å¤‡æ³¨ï¼Œè‡ªå®šä¹‰çº¿ç¨‹æ± ä½¿ç”¨ï¼š\nThreadPoolExecutor executor = new ThreadPoolExecutor( CORE_POOL_SIZE, //5 MAX_POOL_SIZE, //10 KEEP_ALIVE_TIME, //1L TimeUnit.SECONDS, //å•ä½ new ArrayBlockingQueue\u0026lt;\u0026gt;(QUEUE_CAPACITY),//100 new ThreadPoolExecutor.CallerRunsPolicy()); //ä¸»çº¿ç¨‹ä¸­è¿è¡Œ runAsync() æ–¹æ³•æ¥å—çš„å‚æ•°æ˜¯ Runnable ï¼Œè¿™æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œä¸å…è®¸è¿”å›å€¼ã€‚å½“ä½ éœ€è¦å¼‚æ­¥æ“ä½œä¸”ä¸å…³å¿ƒè¿”å›ç»“æœçš„æ—¶å€™å¯ä»¥ä½¿ç”¨ runAsync() æ–¹æ³•ã€‚\n@FunctionalInterface public interface Runnable { public abstract void run(); } supplyAsync() æ–¹æ³•æ¥å—çš„å‚æ•°æ˜¯ Supplier ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼ŒU æ˜¯è¿”å›ç»“æœå€¼çš„ç±»å‹ã€‚\n@FunctionalInterface public interface Supplier\u0026lt;T\u0026gt; { /** * Gets a result. * * @return a result */ T get(); } å½“éœ€è¦å¼‚æ­¥æ“ä½œä¸”å…³å¿ƒè¿”å›çš„ç»“æœæ—¶ï¼Œå¯ä»¥ä½¿ç”¨supplyAsync()æ–¹æ³•\n```java CompletableFuture\u0026lt;Void\u0026gt; future = CompletableFuture.runAsync(() -\u0026gt; System.out.println(\u0026quot;hello!\u0026quot;)); future.get();// è¾“å‡º \u0026quot;hello!\u0026quot; **æ³¨æ„ï¼Œä¸æ˜¯get()è¿”å›çš„** CompletableFuture\u0026lt;String\u0026gt; future2 = CompletableFuture.supplyAsync(() -\u0026gt; \u0026quot;hello!\u0026quot;); assertEquals(\u0026quot;hello!\u0026quot;, future2.get()); ``` å¤„ç†å¼‚æ­¥ç»“ç®—çš„ç»“æœ # å¯ä»¥å¯¹å¼‚æ­¥è®¡ç®—çš„ç»“æœï¼Œè¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ï¼Œå¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼š\nthenApply() æ¥æ”¶ç»“æœ äº§ç”Ÿç»“æœ ``thenAccept()` æ¥å—ç»“æœä¸äº§ç”Ÿç»“æœ\nthenRun ä¸æ¥å—ç»“æœä¸äº§ç”Ÿç»“æœ whenComplete() ç»“æŸæ—¶å¤„ç†ç»“æœ\nä¾‹å­ï¼š\npublic class CompletableFutureTest { public static void main(String[] args) throws ExecutionException, InterruptedException { CompletableFuture\u0026lt;String\u0026gt; stringCompletableFuture = CompletableFuture.supplyAsync(() -\u0026gt; { try { TimeUnit.SECONDS.sleep(3); } catch (InterruptedException e) { e.printStackTrace(); } return \u0026#34;hello,world!\u0026#34;; }); System.out.println(\u0026#34;è¢«é˜»å¡å•¦----\u0026#34;); stringCompletableFuture .whenComplete((s,e)-\u0026gt;{ System.out.println(\u0026#34;complete1----\u0026#34;+s); }) .whenComplete((s,e)-\u0026gt;{ System.out.println(\u0026#34;complete2----\u0026#34;+s); }) .thenAccept(s-\u0026gt;{ System.out.println(\u0026#34;æ‰“å°ç»“æœ\u0026#34;+s); }) .thenRun(()-\u0026gt;{ System.out.println(\u0026#34;é˜»å¡ç»“æŸå•¦\u0026#34;); }); while (true){ } } } /*------------- 2022-12-07 10:16:44 ä¸Šåˆ [Thread: main] INFO:è¢«é˜»å¡å•¦---- 2022-12-07 10:16:47 ä¸Šåˆ [Thread: ForkJoinPool.commonPool-worker-1] INFO:complete1----hello,world! 2022-12-07 10:16:47 ä¸Šåˆ [Thread: ForkJoinPool.commonPool-worker-1] INFO:complete2----hello,world! 2022-12-07 10:16:47 ä¸Šåˆ [Thread: ForkJoinPool.commonPool-worker-1] INFO:æ‰“å°ç»“æœhello,world! 2022-12-07 10:16:47 ä¸Šåˆ [Thread: ForkJoinPool.commonPool-worker-1] INFO:é˜»å¡ç»“æŸå•¦ */ thenApply()æ–¹æ³•æ¥å—Functionå®ä¾‹ï¼Œç”¨å®ƒæ¥å¤„ç†ç»“æœ // æ²¿ç”¨ä¸Šä¸€ä¸ªä»»åŠ¡çš„çº¿ç¨‹æ±  public CompletableFuture thenApply( Function\u0026lt;? super T,? extends U\u0026gt; fn) { return uniApplyStage(null, fn); } //ä½¿ç”¨é»˜è®¤çš„ ForkJoinPool çº¿ç¨‹æ± ï¼ˆä¸æ¨èï¼‰ public CompletableFuture thenApplyAsync( Function\u0026lt;? super T,? extends U\u0026gt; fn) { return uniApplyStage(defaultExecutor(), fn); } // ä½¿ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ± (æ¨è) public CompletableFuture thenApplyAsync( Function\u0026lt;? super T,? extends U\u0026gt; fn, Executor executor) { return uniApplyStage(screenExecutor(executor), fn); } ä½¿ç”¨ç¤ºä¾‹ï¼š\nCompletableFuture\u0026lt;String\u0026gt; future = CompletableFuture.completedFuture(\u0026#34;hello!\u0026#34;) .thenApply(s -\u0026gt; s + \u0026#34;world!\u0026#34;); assertEquals(\u0026#34;hello!world!\u0026#34;, future.get()); // è¿™æ¬¡è°ƒç”¨å°†è¢«å¿½ç•¥ã€‚ //**æˆ‘çŒœæ˜¯å› ä¸ºåªèƒ½get()ä¸€æ¬¡** future.thenApply(s -\u0026gt; s + \u0026#34;nice!\u0026#34;); assertEquals(\u0026#34;hello!world!\u0026#34;, future.get()); æµå¼è°ƒç”¨ï¼š\nCompletableFuture\u0026lt;String\u0026gt; future = CompletableFuture.completedFuture(\u0026#34;hello!\u0026#34;) .thenApply(s -\u0026gt; s + \u0026#34;world!\u0026#34;).thenApply(s -\u0026gt; s + \u0026#34;nice!\u0026#34;); assertEquals(\u0026#34;hello!world!nice!\u0026#34;, future.get()); å¦‚æœä¸éœ€è¦ä»å›è°ƒå‡½æ•°ä¸­è¿”å›ç»“æœï¼Œå¯ä»¥ä½¿ç”¨thenAccept()æˆ–è€…thenRun() ï¼Œä¸¤ä¸ªæ–¹æ³•åŒºåˆ«åœ¨äºthenRun()ä¸èƒ½è®¿é—®å¼‚æ­¥è®¡ç®—çš„ç»“æœ(å› ä¸ºthenAcceptæ–¹æ³•çš„å‚æ•°ä¸º Consumer\u0026lt;? super T\u0026gt; ) public CompletableFuture\u0026lt;Void\u0026gt; thenAccept(Consumer\u0026lt;? super T\u0026gt; action) { return uniAcceptStage(null, action); } public CompletableFuture\u0026lt;Void\u0026gt; thenAcceptAsync(Consumer\u0026lt;? super T\u0026gt; action) { return uniAcceptStage(defaultExecutor(), action); } public CompletableFuture\u0026lt;Void\u0026gt; thenAcceptAsync(Consumer\u0026lt;? super T\u0026gt; action, Executor executor) { return uniAcceptStage(screenExecutor(executor), action); } é¡¾åæ€ä¹‰ï¼ŒConsumer å±äºæ¶ˆè´¹å‹æ¥å£ï¼Œå®ƒå¯ä»¥æ¥æ”¶ 1 ä¸ªè¾“å…¥å¯¹è±¡ç„¶åè¿›è¡Œâ€œæ¶ˆè´¹â€ã€‚\n@FunctionalInterface public interface Consumer\u0026lt;T\u0026gt; { void accept(T t); default Consumer\u0026lt;T\u0026gt; andThen(Consumer\u0026lt;? super T\u0026gt; after) { Objects.requireNonNull(after); return (T t) -\u0026gt; { accept(t); after.accept(t); }; } } thenRun() çš„æ–¹æ³•æ˜¯çš„å‚æ•°æ˜¯ Runnable\npublic CompletableFuture\u0026lt;Void\u0026gt; thenRun(Runnable action) { return uniRunStage(null, action); } public CompletableFuture\u0026lt;Void\u0026gt; thenRunAsync(Runnable action) { return uniRunStage(defaultExecutor(), action); } public CompletableFuture\u0026lt;Void\u0026gt; thenRunAsync(Runnable action, Executor executor) { return uniRunStage(screenExecutor(executor), action); } ä½¿ç”¨å¦‚ä¸‹ï¼š\nCompletableFuture.completedFuture(\u0026#34;hello!\u0026#34;) .thenApply(s -\u0026gt; s + \u0026#34;world!\u0026#34;).thenApply(s -\u0026gt; s + \u0026#34;nice!\u0026#34;).thenAccept(System.out::println);//hello!world!nice! //å¯ä»¥æ¥æ”¶å‚æ•° CompletableFuture.completedFuture(\u0026#34;hello!\u0026#34;) .thenApply(s -\u0026gt; s + \u0026#34;world!\u0026#34;).thenApply(s -\u0026gt; s + \u0026#34;nice!\u0026#34;).thenRun(() -\u0026gt; System.out.println(\u0026#34;hello!\u0026#34;));//hello! whenComplete()çš„æ–¹æ³•å‚æ•°æ˜¯BiConsumer\u0026lt;? super T , ? super Throwable \u0026gt;\npublic CompletableFuture\u0026lt;T\u0026gt; whenComplete( BiConsumer\u0026lt;? super T, ? super Throwable\u0026gt; action) { return uniWhenCompleteStage(null, action); } public CompletableFuture\u0026lt;T\u0026gt; whenCompleteAsync( BiConsumer\u0026lt;? super T, ? super Throwable\u0026gt; action) { return uniWhenCompleteStage(defaultExecutor(), action); } // ä½¿ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ± (æ¨è) public CompletableFuture\u0026lt;T\u0026gt; whenCompleteAsync( BiConsumer\u0026lt;? super T, ? super Throwable\u0026gt; action, Executor executor) { return uniWhenCompleteStage(screenExecutor(executor), action); } ç›¸æ¯”Consumerï¼ŒBiConsumerå¯ä»¥æ¥æ”¶2ä¸ªè¾“å…¥å¯¹è±¡ç„¶åè¿›è¡Œ\u0026quot;æ¶ˆè´¹\u0026quot;\n@FunctionalInterface public interface BiConsumer\u0026lt;T, U\u0026gt; { void accept(T t, U u); default BiConsumer\u0026lt;T, U\u0026gt; andThen(BiConsumer\u0026lt;? super T, ? super U\u0026gt; after) { Objects.requireNonNull(after); return (l, r) -\u0026gt; { accept(l, r); after.accept(l, r); }; } } ä½¿ç”¨ï¼š\nCompletableFuture\u0026lt;String\u0026gt; future = CompletableFuture.supplyAsync(() -\u0026gt; \u0026#34;hello!\u0026#34;) .whenComplete((res, ex) -\u0026gt; { // res ä»£è¡¨è¿”å›çš„ç»“æœ // ex çš„ç±»å‹ä¸º Throwable ï¼Œä»£è¡¨æŠ›å‡ºçš„å¼‚å¸¸ System.out.println(res); // è¿™é‡Œæ²¡æœ‰æŠ›å‡ºå¼‚å¸¸æ‰€æœ‰ä¸º null assertNull(ex); }); assertEquals(\u0026#34;hello!\u0026#34;, future.get()); å…¶ä»–åŒºåˆ«æš‚æ—¶ä¸çŸ¥é“\nå¼‚å¸¸å¤„ç† # ä½¿ç”¨handleï¼ˆï¼‰ æ–¹æ³•æ¥å¤„ç†ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„æŠ›å‡ºå¼‚å¸¸çš„æƒ…å†µ\npublic CompletableFuture handle( BiFunction\u0026lt;? super T, Throwable, ? extends U\u0026gt; fn) { return uniHandleStage(null, fn); } public CompletableFuture handleAsync( BiFunction\u0026lt;? super T, Throwable, ? extends U\u0026gt; fn) { return uniHandleStage(defaultExecutor(), fn); } public CompletableFuture handleAsync( BiFunction\u0026lt;? super T, Throwable, ? extends U\u0026gt; fn, Executor executor) { return uniHandleStage(screenExecutor(executor), fn); } ä»£ç ï¼š\npublic static void test() throws ExecutionException, InterruptedException { CompletableFuture\u0026lt;String\u0026gt; future = CompletableFuture.supplyAsync(() -\u0026gt; { if (true) { throw new RuntimeException(\u0026#34;Computation error!\u0026#34;); } return \u0026#34;hello!\u0026#34;; }).handle((res, ex) -\u0026gt; { // res ä»£è¡¨è¿”å›çš„ç»“æœ // ex çš„ç±»å‹ä¸º Throwable ï¼Œä»£è¡¨æŠ›å‡ºçš„å¼‚å¸¸ return res != null ? res : ex.toString()+\u0026#34;world!\u0026#34;; }); String s = future.get(); log.info(s); } /** 2022-12-07 11:14:44 ä¸Šåˆ [Thread: main] INFO:java.util.concurrent.CompletionException: java.lang.RuntimeException: Computation error!world! */ é€šè¿‡exceptionallyå¤„ç†å¼‚å¸¸\nCompletableFuture\u0026lt;String\u0026gt; future = CompletableFuture.supplyAsync(() -\u0026gt; { if (true) { throw new RuntimeException(\u0026#34;Computation error!\u0026#34;); } return \u0026#34;hello!\u0026#34;; }).exceptionally(ex -\u0026gt; { System.out.println(ex.toString());// CompletionException return \u0026#34;world!\u0026#34;; }); assertEquals(\u0026#34;world!\u0026#34;, future.get()); è®©å¼‚æ­¥çš„ç»“æœç›´æ¥å°±æŠ›å¼‚å¸¸\nCompletableFuture\u0026lt;String\u0026gt; completableFuture = new CompletableFuture\u0026lt;\u0026gt;(); // ... completableFuture.completeExceptionally( new RuntimeException(\u0026#34;Calculation failed!\u0026#34;)); // ... completableFuture.get(); // ExecutionException ç»„åˆCompletableFuture # ä½¿ç”¨thenCompose() æŒ‰é¡ºåºè¿æ¥ä¸¤ä¸ªCompletableFutureå¯¹è±¡\npublic CompletableFuture thenCompose( Function\u0026lt;? super T, ? extends CompletionStage\u0026gt; fn) { return uniComposeStage(null, fn); } public CompletableFuture thenComposeAsync( Function\u0026lt;? super T, ? extends CompletionStage\u0026gt; fn) { return uniComposeStage(defaultExecutor(), fn); } public CompletableFuture thenComposeAsync( Function\u0026lt;? super T, ? extends CompletionStage\u0026gt; fn, Executor executor) { return uniComposeStage(screenExecutor(executor), fn); } ä½¿ç”¨ç¤ºä¾‹ï¼š\nCompletableFuture\u0026lt;String\u0026gt; future = CompletableFuture.supplyAsync(() -\u0026gt; \u0026#34;hello!\u0026#34;) .thenCompose(s -\u0026gt; CompletableFuture.supplyAsync(() -\u0026gt; s + \u0026#34;world!\u0026#34;)); assertEquals(\u0026#34;hello!world!\u0026#34;, future.get()); åœ¨å®é™…å¼€å‘ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•è¿˜æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å…ˆè¦è·å–ç”¨æˆ·ä¿¡æ¯ç„¶åå†ç”¨ç”¨æˆ·ä¿¡æ¯å»åšå…¶ä»–äº‹æƒ…ã€‚\nå’ŒthenCompose()æ–¹æ³•ç±»ä¼¼çš„è¿˜æœ‰thenCombine()æ–¹æ³•ï¼ŒthenCombine()åŒæ ·å¯ä»¥ç»„åˆä¸¤ä¸ªCompletableFutureå¯¹è±¡\nCompletableFuture\u0026lt;String\u0026gt; completableFuture = CompletableFuture.supplyAsync(() -\u0026gt; \u0026#34;hello!\u0026#34;) .thenCombine(CompletableFuture.supplyAsync( () -\u0026gt; \u0026#34;world!\u0026#34;), (s1, s2) -\u0026gt; s1 + s2) .thenCompose(s -\u0026gt; CompletableFuture.supplyAsync(() -\u0026gt; s + \u0026#34;nice!\u0026#34;)); assertEquals(\u0026#34;hello!world!nice!\u0026#34;, completableFuture.get()); â˜…â˜… thenCompose() å’Œ thenCombine()æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢\nthenCompose() å¯ä»¥ä¸¤ä¸ª CompletableFuture å¯¹è±¡ï¼Œå¹¶å°†å‰ä¸€ä¸ªä»»åŠ¡çš„è¿”å›ç»“æœä½œä¸ºä¸‹ä¸€ä¸ªä»»åŠ¡çš„å‚æ•°ï¼Œå®ƒä»¬ä¹‹é—´å­˜åœ¨ç€å…ˆåé¡ºåºã€‚ thenCombine() ä¼šåœ¨ä¸¤ä¸ªä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆåï¼ŒæŠŠä¸¤ä¸ªä»»åŠ¡çš„ç»“æœåˆå¹¶ã€‚ä¸¤ä¸ªä»»åŠ¡æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œå®ƒä»¬ä¹‹é—´å¹¶æ²¡æœ‰å…ˆåä¾èµ–é¡ºåºã€‚ /* ç»“æœæ˜¯æœ‰é¡ºåºçš„ï¼Œä½†æ˜¯æ‰§è¡Œçš„è¿‡ç¨‹æ˜¯æ— åºçš„ */ CompletableFuture\u0026lt;String\u0026gt; completableFuture = CompletableFuture.supplyAsync(() -\u0026gt; { System.out.println(\u0026#34;æ‰§è¡Œäº†ç¬¬1ä¸ª\u0026#34;); try { TimeUnit.SECONDS.sleep(3); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(\u0026#34;ç¬¬1ä¸ªæ‰§è¡Œç»“æŸå•¦\u0026#34;); return \u0026#34;hello!\u0026#34;; }) .thenCombine(CompletableFuture.supplyAsync( () -\u0026gt; { System.out.println(\u0026#34;æ‰§è¡Œäº†ç¬¬2ä¸ª\u0026#34;); System.out.println(\u0026#34;ç¬¬2ä¸ªæ‰§è¡Œç»“æŸå•¦\u0026#34;); return \u0026#34;world!\u0026#34;; }), (s1, s2) -\u0026gt; s1 + s2); System.out.println(completableFuture.get()); /* æ‰§è¡Œäº†ç¬¬1ä¸ª æ‰§è¡Œäº†ç¬¬2ä¸ª ç¬¬2ä¸ªæ‰§è¡Œç»“æŸå•¦ ç¬¬1ä¸ªæ‰§è¡Œç»“æŸå•¦ hello!world! */ å¹¶è¡Œè¿è¡Œå¤šä¸ªCompletableFuture # é€šè¿‡CompletableFutureçš„allOf()è¿™ä¸ªé™æ€æ–¹æ³•å¹¶è¡Œè¿è¡Œå¤šä¸ªCompletableFuture\nå®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¹¶è¡Œè¿è¡Œå¤šä¸ªäº’ä¸ç›¸å…³çš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡æ²¡æœ‰ä¾èµ–å…³ç³»\næ¯”å¦‚è¯»å–å¤„ç†6ä¸ªæ–‡ä»¶ï¼Œæ²¡æœ‰é¡ºåºä¾èµ–å…³ç³» ä½†æˆ‘ä»¬éœ€è¦è¿”å›ç»™ç”¨æˆ·çš„æ—¶å€™å°†è¿™å‡ ä¸ªæ–‡ä»¶çš„å¤„ç†ç»“æœç»Ÿè®¡æ•´ç†ï¼Œç¤ºä¾‹ï¼š\nCompletableFuture\u0026lt;Void\u0026gt; task1 = CompletableFuture.supplyAsync(()-\u0026gt;{ //è‡ªå®šä¹‰ä¸šåŠ¡æ“ä½œ }); ...... CompletableFuture\u0026lt;Void\u0026gt; task6 = CompletableFuture.supplyAsync(()-\u0026gt;{ //è‡ªå®šä¹‰ä¸šåŠ¡æ“ä½œ }); ...... CompletableFuture\u0026lt;Void\u0026gt; headerFuture=CompletableFuture.allOf(task1,.....,task6); try { headerFuture.join(); } catch (Exception ex) { ...... } System.out.println(\u0026#34;all done. \u0026#34;); è°ƒç”¨join()å¯ä»¥è®©ç¨‹åºç­‰future1å’Œfuture2éƒ½è¿è¡Œå®Œåç»§ç»­æ‰§è¡Œ\nCompletableFuture\u0026lt;Void\u0026gt; completableFuture = CompletableFuture.allOf(future1, future2); completableFuture.join(); assertTrue(completableFuture.isDone()); System.out.println(\u0026#34;all futures done...\u0026#34;); /**--- future1 done... future2 done... all futures done... */ anyOfåˆ™å…¶ä¸­ä¸€ä¸ªæ‰§è¡Œå®Œå°±ç«‹é©¬è¿”å›\nCompletableFuture\u0026lt;Object\u0026gt; f = CompletableFuture.anyOf(future1, future2); System.out.println(f.get()); /* future2 done... efg */ //æˆ– /* future1 done... abc */ ä¾‹å­2\nCompletableFuture\u0026lt;Object\u0026gt; a = CompletableFuture.supplyAsync(() -\u0026gt; { System.out.println(\u0026#34;a\u0026#34;); //æ‰§è¡Œäº†3sçš„ä»»åŠ¡ try { TimeUnit.SECONDS.sleep(3); } catch (InterruptedException e) { e.printStackTrace(); } return \u0026#34;a-hello\u0026#34;; }); CompletableFuture\u0026lt;Object\u0026gt; b = CompletableFuture.supplyAsync(() -\u0026gt; { System.out.println(\u0026#34;b\u0026#34;); //æ‰§è¡Œäº†3sçš„ä»»åŠ¡ try { TimeUnit.SECONDS.sleep(10); } catch (InterruptedException e) { e.printStackTrace(); } return \u0026#34;b-hello\u0026#34;; }); /* //ä¼šç­‰ä¸¤ä¸ªä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ‰ç»§ç»­ CompletableFuture\u0026lt;Void\u0026gt; voidCompletableFuture = CompletableFuture.allOf(a, b); voidCompletableFuture.join(); //åœé¡¿10s System.out.println(\u0026#34;ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ\u0026#34;);*/ //ä»»ä½•ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œå°±ä¼šç»§ç»­æ‰§è¡Œ CompletableFuture\u0026lt;Object\u0026gt; objectCompletableFuture = CompletableFuture.anyOf(a, b); objectCompletableFuture.join(); //ä¼šå¾—åˆ°æœ€å¿«è¿”å›å€¼çš„é‚£ä¸ªCompletableFutureçš„å€¼ System.out.println(objectCompletableFuture.get()); //åœé¡¿3s System.out.println(\u0026#34;ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ\u0026#34;); åè®° # äº¬ä¸œçš„aysncToolæ¡†æ¶\nhttps://gitee.com/jd-platform-opensource/asyncTool#%E5%B9%B6%E8%A1%8C%E5%9C%BA%E6%99%AF%E4%B9%8B%E6%A0%B8%E5%BF%83%E4%BB%BB%E6%84%8F%E7%BC%96%E6%8E%92\n"},{"id":128,"href":"/zh/docs/study/Review/java_guide/java/Concurrent/ly0310lythreadlocal/","title":"ThreadLocalè¯¦è§£","section":"å¹¶å‘","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\næœ¬æ–‡æ¥è‡ªä¸€æèŠ±ç®—ä¸ç®—æµªæ¼«æŠ•ç¨¿ï¼Œ åŸæ–‡åœ°å€ï¼šhttps://juejin.cn/post/6844904151567040519open in new windowã€‚ æ„Ÿè°¢ä½œè€…!\næ€ç»´å¯¼å›¾\nç›®å½• # ThreadLocalä»£ç æ¼”ç¤º # ç®€å•ä½¿ç”¨\npublic class ThreadLocalTest { private List\u0026lt;String\u0026gt; messages = Lists.newArrayList(); public static final ThreadLocal\u0026lt;ThreadLocalTest\u0026gt; holder = ThreadLocal.withInitial(ThreadLocalTest::new); public static void add(String message) { holder.get().messages.add(message); } public static List\u0026lt;String\u0026gt; clear() { List\u0026lt;String\u0026gt; messages = holder.get().messages; holder.remove(); System.out.println(\u0026#34;size: \u0026#34; + holder.get().messages.size()); return messages; } public static void main(String[] args) { ThreadLocalTest.add(\u0026#34;ä¸€æèŠ±ç®—ä¸ç®—æµªæ¼«\u0026#34;); System.out.println(holder.get().messages); ThreadLocalTest.clear(); } } /* ç»“æœ [ä¸€æèŠ±ç®—ä¸ç®—æµªæ¼«] size: 0 */ ç®€å•ä½¿ç”¨2\n@Data class LyTest{ private ThreadLocal\u0026lt;String\u0026gt; threadLocal=ThreadLocal.withInitial(()-\u0026gt;{ return \u0026#34;hello\u0026#34;; }); } public class ThreadLocalTest { public static void main(String[] args) throws InterruptedException { CountDownLatch countDownLatch=new CountDownLatch(2); LyTest lyTest=new LyTest(); ThreadLocal\u0026lt;String\u0026gt; threadLocal = lyTest.getThreadLocal(); new Thread(()-\u0026gt;{ String name = Thread.currentThread().getName(); threadLocal.set(name+ \u0026#34;-ly\u0026#34;); System.out.println(name+\u0026#34;ï¼šthreadLocalå½“å‰å€¼\u0026#34;+threadLocal.get()); countDownLatch.countDown(); },\u0026#34;çº¿ç¨‹1\u0026#34;).start(); new Thread(()-\u0026gt;{ String name = Thread.currentThread().getName(); threadLocal.set(name+ \u0026#34;-ly\u0026#34;); System.out.println(name+\u0026#34;ï¼šthreadLocalå½“å‰å€¼\u0026#34;+threadLocal.get()); countDownLatch.countDown(); },\u0026#34;çº¿ç¨‹2\u0026#34;).start(); /*while (true){}*/ countDownLatch.await(); System.out.println(Thread.currentThread().getName()+\u0026#34;ï¼šthreadLocalå½“å‰å€¼\u0026#34;+threadLocal.get()); } } /* çº¿ç¨‹1ï¼šthreadLocalå½“å‰å€¼çº¿ç¨‹1-ly çº¿ç¨‹2ï¼šthreadLocalå½“å‰å€¼çº¿ç¨‹2-ly mainï¼šthreadLocalå½“å‰å€¼hello */ ThreadLocalå¯¹è±¡å¯ä»¥æä¾›çº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œæ¯ä¸ªçº¿ç¨‹Threadæ‹¥æœ‰ä¸€ä»½è‡ªå·±çš„å‰¯æœ¬å˜é‡ï¼Œå¤šä¸ªçº¿ç¨‹äº’ä¸å¹²æ‰°ã€‚\nå›é¡¾ä¹‹å‰çš„çŸ¥è¯†ç‚¹\npublic void set(T value) { //è·å–å½“å‰è¯·æ±‚çš„çº¿ç¨‹ Thread t = Thread.currentThread(); //å–å‡º Thread ç±»å†…éƒ¨çš„ threadLocals å˜é‡(å“ˆå¸Œè¡¨ç»“æ„) ThreadLocalMap map = getMap(t); if (map != null) // å°†éœ€è¦å­˜å‚¨çš„å€¼æ”¾å…¥åˆ°è¿™ä¸ªå“ˆå¸Œè¡¨ä¸­ //â˜…â˜…å®é™…ä½¿ç”¨çš„æ–¹æ³• map.set(this, value); else //â˜…â˜…å®é™…ä½¿ç”¨çš„æ–¹æ³• createMap(t, value); } ThreadLocalMap getMap(Thread t) { return t.threadLocals; } å¦‚ä¸Šï¼Œå®é™…å­˜å–éƒ½æ˜¯ä»Threadçš„threadLocals ï¼ˆThreadLocalMapç±»ï¼‰ä¸­ï¼Œå¹¶ä¸æ˜¯å­˜åœ¨ThreadLocalä¸Šï¼ŒThreadLocalç”¨æ¥ä¼ é€’äº†å˜é‡å€¼ï¼Œåªæ˜¯ThreadLocalMapçš„å°è£… ThreadLocalç±»ä¸­é€šè¿‡Thread.currentThread()è·å–åˆ°å½“å‰çº¿ç¨‹å¯¹è±¡åï¼Œç›´æ¥é€šè¿‡getMap(Thread t) å¯ä»¥è®¿é—®åˆ°è¯¥çº¿ç¨‹çš„ThreadLocalMapå¯¹è±¡ æ¯ä¸ªThreadä¸­å…·å¤‡ä¸€ä¸ªThreadLocalMapï¼Œè€ŒThreadLocalMapå¯ä»¥å­˜å‚¨ä»¥ThreadLocalä¸ºkeyï¼ŒObjectå¯¹è±¡ä¸ºvalueçš„é”®å€¼å¯¹ ThreadLocalçš„æ•°æ®ç»“æ„ # ç”±ä¸Šé¢å›é¡¾çš„çŸ¥è¯†ç‚¹å¯çŸ¥ï¼Œvalueå®é™…ä¸Šéƒ½æ˜¯ä¿å­˜åœ¨**çº¿ç¨‹ç±»(Threadç±»)ä¸­çš„æŸä¸ªå±æ€§(ThreadLocalMapç±»)**ä¸­\nThreadLocalMapçš„åº•å±‚æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ˆmapçš„åº•å±‚æ˜¯æ•°ç»„ï¼‰\nThreadç±»æœ‰ä¸€ä¸ªç±»å‹ä¸º**ThreadLocal.ThreadLocalMap**çš„å®ä¾‹å˜é‡threadLocalsï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªçº¿ç¨‹æœ‰ä¸€ä¸ªè‡ªå·±çš„ThreadLocalMapã€‚ ThreadLocalMapæ˜¯ä¸€ä¸ªé™æ€å†…éƒ¨ç±»\næ²¡æœ‰ä¿®é¥°ç¬¦ï¼Œä¸ºåŒ…å¯è§ã€‚æ¯”å¦‚çˆ¶ç±»æœ‰ä¸€ä¸ªprotectedä¿®é¥°çš„æ–¹æ³•f()ï¼Œä¸åŒåŒ…ä¸‹å­˜åœ¨å­ç±»Aå’Œå…¶ä»–ç±»Xï¼Œåœ¨å­ç±»ä¸­å¯ä»¥è®¿é—®æ–¹æ³•f()ï¼Œå³ä½¿åœ¨å…¶ä»–ç±»Xåˆ›å»ºå­ç±»Aå®ä¾‹a1ï¼Œä¹Ÿä¸èƒ½è°ƒç”¨a1.f()\u0026ndash;\u0026gt; å…¶ä»–åŒ…ä¸å¯è§\nThreadLocalMapæœ‰è‡ªå·±ç‹¬ç«‹å®ç°ï¼Œç®€å•åœ°å°†å®ƒçš„keyè§†ä½œThreadLocalï¼Œvalueä¸ºä»£ç ä¸­æ”¾å…¥çš„å€¼ï¼Œï¼ˆçœ‹åº•å±‚ä»£ç å¯çŸ¥ï¼Œå®é™…keyä¸æ˜¯ThreadLocalæœ¬èº«ï¼Œè€Œæ˜¯å®ƒçš„ä¸€ä¸ªå¼±å¼•ç”¨ï¼‰\nâ˜…æ¯ä¸ªçº¿ç¨‹åœ¨å¾€ThreadLocalé‡Œæ”¾å€¼çš„æ—¶å€™ï¼Œéƒ½ä¼šå¾€è‡ªå·±çš„ThreadLocalMapé‡Œå­˜ï¼Œè¯»ä¹Ÿæ˜¯ä»¥ThreadLocalä½œä¸ºå¼•ç”¨ï¼Œåœ¨è‡ªå·±çš„mapé‡Œæ‰¾å¯¹åº”çš„keyï¼Œä»è€Œå®ç°äº†çº¿ç¨‹éš”ç¦»ã€‚\nThreadLocalMapæœ‰ç‚¹ç±»ä¼¼HashMapçš„ç»“æ„ï¼Œåªæ˜¯HashMapæ˜¯ç”±æ•°ç»„+é“¾è¡¨å®ç°çš„ï¼Œè€ŒThreadLocalMapä¸­å¹¶æ²¡æœ‰é“¾è¡¨ç»“æ„ã€‚å…¶ä¸­ï¼Œè¿˜è¦æ³¨æ„Entryç±»ï¼Œ å®ƒçš„keyæ˜¯ThreadLocal\u0026lt;?\u0026gt; k ï¼Œ(Entryç±»)ç»§æ‰¿è‡ªWeakReferenceï¼Œ ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„å¼±å¼•ç”¨ç±»å‹ã€‚\nå¦‚ä¸‹ï¼Œæœ‰ä¸ªæ•°ç»„å­˜æ”¾Entry(å¼±å¼•ç”¨ç±»ï¼Œä¸”æœ‰å±æ€§value)ï¼Œä¸”\nstatic class ThreadLocalMap { static class Entry extends WeakReference\u0026lt;ThreadLocal\u0026lt;?\u0026gt;\u0026gt; { /** The value associated with this ThreadLocal. */ Object value; Entry(ThreadLocal\u0026lt;?\u0026gt; k, Object v) { super(k); value = v; } } //..... } ä¸ºä¸Šé¢çš„çŸ¥è¯†ç‚¹æ€»ç»“ä¸€å¼ å›¾ # GCä¹‹åkeyæ˜¯å¦ä¸ºnull # WeakReferenceçš„ä½¿ç”¨\nWeakReference\u0026lt;Car\u0026gt; weakCar = new WeakReference(Car)(car); weakCar.get(); //å¦‚æœå€¼ä¸ºnullè¡¨ç¤ºå·²ç»è¢«å›æ”¶äº† é—®é¢˜ï¼š ThreadLocalçš„keyä¸ºå¼±å¼•ç”¨ï¼Œé‚£ä¹ˆåœ¨ThreadLocal.get()çš„æ—¶å€™ï¼Œå‘ç”ŸGCä¹‹åï¼Œkeyæ˜¯å¦ä¸ºnull\nJavaçš„å››ç§å¼•ç”¨ç±»å‹ å¼ºå¼•ç”¨ï¼šé€šå¸¸æƒ…å†µnewå‡ºæ¥çš„ä¸ºå¼ºå¼•ç”¨ï¼Œåªè¦å¼ºå¼•ç”¨å­˜åœ¨ï¼Œåƒåœ¾å›æ”¶å™¨æ°¸è¿œä¸ä¼šå›æ”¶è¢«å¼•ç”¨çš„å¯¹è±¡ï¼ˆå³ä½¿å†…å­˜ä¸è¶³ï¼‰ è½¯å¼•ç”¨ï¼šä½¿ç”¨SoftReferenceä¿®é¥°çš„å¯¹è±¡ç§°è½¯å¼•ç”¨ï¼Œè½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡åœ¨å†…å­˜è¦æº¢å‡ºçš„æ—¶å€™è¢«å›æ”¶ å¼±å¼•ç”¨ï¼šä½¿ç”¨WeakReferenceä¿®é¥°çš„å¯¹è±¡ç§°ä¸ºå¼±å¼•ç”¨ï¼Œåªè¦å‘ç”Ÿåƒåœ¾å›æ”¶ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡åªè¢«å¼±å¼•ç”¨æŒ‡å‘ï¼Œé‚£ä¹ˆå°±ä¼šè¢«å›æ”¶ è™šå¼•ç”¨ï¼šè™šå¼•ç”¨æ˜¯æœ€å¼±çš„å¼•ç”¨ï¼Œç”¨PhantomReferenceå®šä¹‰ã€‚å”¯ä¸€çš„ä½œç”¨å°±æ˜¯ç”¨é˜Ÿåˆ—æ¥æ”¶å¯¹è±¡å³å°†æ­»äº¡çš„é€šçŸ¥ ä½¿ç”¨åå°„æ–¹å¼æŸ¥çœ‹GCåThreadLocalä¸­çš„æ•°æ®æƒ…å†µ\nimport java.lang.reflect.Field; /* t.join()æ–¹æ³•é˜»å¡è°ƒç”¨æ­¤æ–¹æ³•çš„çº¿ç¨‹(calling thread)è¿›å…¥ TIMED_WAITING çŠ¶æ€ï¼Œç›´åˆ°çº¿ç¨‹tå®Œæˆï¼Œæ­¤çº¿ç¨‹å†ç»§ç»­ */ public class ThreadLocalDemo { public static void main(String[] args) throws NoSuchFieldException, IllegalAccessException, InterruptedException { Thread t = new Thread(()-\u0026gt;test(\u0026#34;abc\u0026#34;,false)); t.start(); t.join(); System.out.println(\u0026#34;--gcå--\u0026#34;); Thread t2 = new Thread(() -\u0026gt; test(\u0026#34;def\u0026#34;, true)); t2.start(); t2.join(); } private static void test(String s,boolean isGC) { try { //æ³¨æ„è¿™ä¸€è¡Œ,è¿™ä¸ªThreadLocalå¯¹è±¡æ˜¯ä¸å­˜åœ¨ä»»ä½•å¼ºå¼•ç”¨çš„ new ThreadLocal\u0026lt;\u0026gt;().set(s);//å½“å‰çº¿ç¨‹è®¾ç½®äº†ä¸€ä¸ªå€¼ s if (isGC) { System.gc(); } Thread t = Thread.currentThread(); Class\u0026lt;? extends Thread\u0026gt; clz = t.getClass(); Field field = clz.getDeclaredField(\u0026#34;threadLocals\u0026#34;); field.setAccessible(true); Object threadLocalMap = field.get(t);//å¾—åˆ°å½“å‰çº¿ç¨‹çš„ThreadLocalMap Class\u0026lt;?\u0026gt; tlmClass = threadLocalMap.getClass(); Field tableField = tlmClass.getDeclaredField(\u0026#34;table\u0026#34;); tableField.setAccessible(true); //æ³¨æ„ï¼šè¿™é‡Œè·å–çš„æ˜¯threadLocalMapå†…éƒ¨çš„(ç»´æŠ¤)æ•°ç»„ private Entry[] table; Object[] arr = (Object[]) tableField.get(threadLocalMap); for (Object o : arr) { if (o != null) { Class\u0026lt;?\u0026gt; entryClass = o.getClass(); /* Entryç»“æ„ static class Entry extends WeakReference\u0026lt;ThreadLocal\u0026lt;?\u0026gt;\u0026gt; { //The value associated with this ThreadLocal. Object value; Entry(ThreadLocal\u0026lt;?\u0026gt; k, Object v) { super(k); value = v; } } */ //è·å–Entryä¸­çš„å€¼ï¼ˆé”®å€¼å¯¹çš„â€œå€¼â€ï¼‰ Field valueField = entryClass.getDeclaredField(\u0026#34;value\u0026#34;); //Entry extends WeakReference //WeakReference\u0026lt;T\u0026gt; extends Reference\u0026lt;T\u0026gt; //Reference é‡Œé¢æœ‰ä¸€ä¸ªå±æ€§ referent ï¼ŒæŒ‡å‘å®é™…çš„å¯¹è±¡ï¼Œå³keyå®é™…çš„å¯¹è±¡ Field referenceField = entryClass.getSuperclass().getSuperclass().getDeclaredField(\u0026#34;referent\u0026#34;); valueField.setAccessible(true); referenceField.setAccessible(true); System.out.println(String.format(\u0026#34;å¼±å¼•ç”¨key:%s,å€¼:%s\u0026#34;, referenceField.get(o), valueField.get(o))); } } } catch (Exception e) { e.printStackTrace(); } } } /* ç»“æœå¦‚ä¸‹ å¼±å¼•ç”¨key:java.lang.ThreadLocal@433619b6,å€¼:abc å¼±å¼•ç”¨key:java.lang.ThreadLocal@418a15e3,å€¼:java.lang.ref.SoftReference@bf97a12 --gcå-- å¼±å¼•ç”¨key:null,å€¼:def */ gcä¹‹åçš„å›¾ï¼š\nnew ThreadLocal\u0026lt;\u0026gt;().set(s); GCä¹‹åï¼Œkeyå°±ä¼šè¢«å›æ”¶ï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸Šé¢çš„debugä¸­referent=null\nå¦‚æœè¿™é‡Œä¿®æ”¹ä»£ç ï¼Œ\nThreadLocal\u0026lt;Object\u0026gt; threadLocal=new ThreadLocal\u0026lt;\u0026gt;(); threadLocal.set(s); ä½¿ç”¨å¼±å¼•ç”¨+åƒåœ¾å›æ”¶\nå¦‚ä¸Šï¼Œåƒåœ¾å›æ”¶å‰ï¼ŒThreadLoalæ˜¯å­˜åœ¨å¼ºå¼•ç”¨çš„ï¼Œå› æ­¤å¦‚æœå¦‚ä¸Šä¿®æ”¹ä»£ç ï¼Œåˆ™keyä¸ä¸ºnull\nå½“ä¸å­˜åœ¨å¼ºå¼•ç”¨æ—¶ï¼Œkeyä¼šè¢«å›æ”¶ï¼Œå³å‡ºç°valueæ²¡è¢«å›æ”¶ï¼Œkeyè¢«å›æ”¶ï¼Œå¯¼è‡´keyæ°¸è¿œå­˜åœ¨ï¼Œå†…å­˜æ³„æ¼\nThreadLocal.set()æ–¹æ³•æºç è¯¦è§£ # å¦‚å›¾æ‰€ç¤º\nThreadLocalä¸­çš„set()æ–¹æ³•åŸç†å¦‚ä¸Šï¼Œå…ˆå–å‡ºçº¿ç¨‹Threadä¸­çš„threadLocalsï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œç„¶åä½¿ç”¨ThreadLocalä¸­çš„setæ–¹æ³•è¿›è¡Œæ•°æ®å¤„ç†\npublic void set(T value) { Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value); } void createMap(Thread t, T firstValue) { t.threadLocals = new ThreadLocalMap(this, firstValue); } ThreadLocalMap Hashç®—æ³• # ThreadLocalMapå®ç°äº†è‡ªå·±çš„hashç®—æ³•æ¥è§£å†³æ•£åˆ—è¡¨æ•°ç»„å†²çªé—®é¢˜ï¼š\n//iä¸ºå½“å‰keyåœ¨æ•£åˆ—è¡¨ä¸­å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ä½ç½® //å³(len-1)å’Œå’Œæ–æ³¢é‚£å¥‘æ•°åš ä¸è¿ç®— int i = key.threadLocalHashCode \u0026amp; (len-1); threadLocalHashCodeå€¼çš„è®¡ç®—ï¼ŒThreadLocalä¸­æœ‰ä¸€ä¸ªå±æ€§ä¸ºHASH_INCREMENT = 0x61c88647\n0x61c88647ï¼Œåˆç§°ä¸ºæ–æ³¢é‚£å¥‘æ•°ä¹Ÿå«é»„é‡‘åˆ†å‰²æ•°ï¼Œhashå¢é‡ä¸ºè¿™ä¸ªæ•°ï¼Œå¥½å¤„æ˜¯hash åˆ†å¸ƒéå¸¸å‡åŒ€\npublic class ThreadLocal\u0026lt;T\u0026gt; { private final int threadLocalHashCode = nextHashCode(); private static AtomicInteger nextHashCode = new AtomicInteger(); private static final int HASH_INCREMENT = 0x61c88647; //hashCodeå¢åŠ  private static int nextHashCode() { return nextHashCode.getAndAdd(HASH_INCREMENT); } static class ThreadLocalMap { ThreadLocalMap(ThreadLocal\u0026lt;?\u0026gt; firstKey, Object firstValue) { table = new Entry[INITIAL_CAPACITY]; int i = firstKey.threadLocalHashCode \u0026amp; (INITIAL_CAPACITY - 1); table[i] = new Entry(firstKey, firstValue); size = 1; setThreshold(INITIAL_CAPACITY); } } } ä¾‹å­å¦‚ä¸‹ï¼Œäº§ç”Ÿçš„å“ˆå¸Œç åˆ†å¸ƒååˆ†å‡åŒ€\nâ˜…â˜… è¯´æ˜ï¼Œä¸‹é¢çš„æ‰€æœ‰ç¤ºä¾‹å›¾ä¸­ï¼Œç»¿è‰²å—Entryä»£è¡¨ä¸ºæ­£å¸¸æ•°æ®ï¼Œç°è‰²å—ä»£è¡¨Entryçš„keyä¸ºnullï¼Œå·²è¢«åƒåœ¾å›æ”¶ã€‚ç™½è‰²å—ä»£è¡¨Entryä¸ºnullï¼ˆæˆ–è€…è¯´æ•°ç»„é‚£ä¸ªä½ç½®ä¸ºnull(æ²¡æœ‰æŒ‡å‘)ï¼‰\nThreadLocalMap Hashå†²çª # ThreadLocalMap ä¸­ä½¿ç”¨é»„é‡‘åˆ†å‰²æ•°ä½œä¸ºhashè®¡ç®—å› å­ï¼Œå¤§å¤§å‡å°‘Hashå†²çªçš„æ¦‚ç‡ HashMapä¸­è§£å†³å†²çªçš„æ–¹æ³•ï¼Œæ˜¯åœ¨æ•°ç»„ä¸Šæ„é€ ä¸€ä¸ªé“¾è¡¨ç»“æ„ï¼Œå†²çªçš„æ•°æ®æŒ‚è½½åˆ°é“¾è¡¨ä¸Šï¼Œå¦‚æœé“¾è¡¨é•¿åº¦è¶…è¿‡ä¸€å®šæ•°é‡åˆ™ä¼šè½¬åŒ–ä¸ºçº¢é»‘æ ‘ ThreadLocalMapä¸­æ²¡æœ‰é“¾è¡¨ç»“æ„ï¼ˆä½¿ç”¨çº¿æ€§å‘åæŸ¥æ‰¾ï¼‰ å¦‚å›¾ å‡è®¾éœ€è¦æ’å…¥value = 27 çš„æ•°æ®ï¼Œhashååº”è¯¥è½å…¥æ§½ä½4ï¼Œè€Œæ§½ä½å·²ç»æœ‰äº†Entryæ•°æ® æ­¤æ—¶çº¿æ€§å‘åæŸ¥æ‰¾ï¼Œä¸€ç›´æ‰¾åˆ°Entryä¸ºnullçš„æ“ä½œæ‰ä¼šåœæ­¢æŸ¥æ‰¾ï¼Œå°†å½“å‰å…ƒç´ æ”¾å…¥è¯¥æ§½ä½ä¸­ çº¿æ€§å‘åæŸ¥æ‰¾è¿­ä»£ä¸­ï¼Œä¼šé‡åˆ°Entryä¸ä¸ºnullä¸”keyå€¼ç›¸ç­‰ï¼Œä»¥åŠ**Entryä¸­çš„keyä¸ºnullï¼ˆå›¾ä¸­Entry ä¸º 2ï¼‰**çš„æƒ…å†µï¼Œå¤„ç†æ–¹å¼ä¸åŒ setè¿‡ç¨‹ä¸­å¦‚æœé‡åˆ°äº†keyè¿‡æœŸ(keyä¸ºnull)çš„Entryæ•°æ®ï¼Œå®é™…ä¸Šä¼šè¿›è¡Œä¸€è½®æ¢æµ‹å¼æ¸…ç†æ“ä½œ ThreadLocalMap.set() è¯¦è§£ # ThreadLocalMap.set() åŸç†å›¾è§£\nå¾€ThreadLocalMapä¸­setæ•°æ®ï¼ˆæ–°å¢æˆ–æ›´æ–°æ•°æ®ï¼‰åˆ†ä¸ºå¥½å‡ ç§\né€šè¿‡hashè®¡ç®—åçš„æ§½ä½å¯¹åº”çš„Entryæ•°æ®ä¸ºç©º ç›´æ¥å°†æ•°æ®æ”¾åˆ°è¯¥æ§½ä½å³å¯\næ§½ä½æ•°æ®ä¸ä¸ºç©ºï¼Œkeyå€¼ä¸å½“å‰ThreadLocalé€šè¿‡hashè®¡ç®—è·å–çš„keyå€¼ä¸€è‡´ ç›´æ¥æ›´æ–°è¯¥æ§½ä½çš„æ•°æ®\næ§½ä½æ•°æ®ä¸ä¸ºç©ºï¼Œå¾€åéå†è¿‡ç¨‹ä¸­ï¼Œåœ¨æ‰¾åˆ°Entryä¸ºnullçš„æ§½ä½ä¹‹å‰ï¼Œæ²¡æœ‰é‡åˆ°è¿‡æœŸçš„Entry éå†æ•£åˆ—æ•°ç»„çš„è¿‡ç¨‹ä¸­ï¼Œçº¿æ€§å¾€åæŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°Entryä¸ºnullçš„æ§½ä½åˆ™å°†æ•°æ®æ”¾å…¥æ§½ä½ä¸­ï¼›æˆ–è€…å¾€åéå†è¿‡ç¨‹ä¸­é‡åˆ°keyå€¼ç›¸ç­‰çš„æ•°æ®åˆ™æ›´æ–°\næ§½ä½æ•°æ®ä¸ä¸ºç©ºï¼Œåœ¨æ‰¾åˆ°Entryä¸ºnullçš„æ§½ä½ä¹‹å‰ï¼Œé‡åˆ°äº†è¿‡æœŸçš„Entryï¼Œå¦‚ä¸‹å›¾ æ­¤æ—¶ä¼šæ‰§è¡ŒreplaceStableEntry()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å«ä¹‰æ˜¯æ›¿æ¢è¿‡æœŸæ•°æ®çš„é€»è¾‘\n\u0026hellip; ä»¥ä¸‹çœç•¥ï¼Œå¤ªå¤æ‚\næ›¿æ¢å®Œæˆåä¹Ÿæ˜¯è¿›è¡Œè¿‡æœŸå…ƒç´ æ¸…ç†å·¥ä½œï¼Œæ¸…ç†å·¥ä½œä¸»è¦æ˜¯æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼šexpungeStaleEntry()å’ŒcleanSomeSlots()\nç»è¿‡è¿­ä»£å¤„ç†åï¼Œæœ‰è¿‡Hashå†²çªæ•°æ®çš„Entryä½ç½®ä¼šæ›´é è¿‘æ­£ç¡®ä½ç½®ï¼Œè¿™æ ·çš„è¯ï¼ŒæŸ¥è¯¢çš„æ—¶å€™ æ•ˆç‡æ‰ä¼šæ›´é«˜ã€‚\nThreadLocalMapè¿‡æœŸ key çš„æ¢æµ‹å¼æ¸…ç†æµç¨‹(ç•¥è¿‡) # ThreadLocalMapæ‰©å®¹æœºåˆ¶ # åœ¨ThreadLocalMap.set()æ–¹æ³•çš„æœ€åï¼Œå¦‚æœæ‰§è¡Œå®Œå¯å‘å¼æ¸…ç†å·¥ä½œåï¼Œæœªæ¸…ç†åˆ°ä»»ä½•æ•°æ®ï¼Œä¸”å½“å‰æ•£åˆ—æ•°ç»„ä¸­Entryçš„æ•°é‡å·²ç»è¾¾åˆ°äº†åˆ—è¡¨çš„æ‰©å®¹é˜ˆå€¼(len*2/3)ï¼Œå°±å¼€å§‹æ‰§è¡Œrehash()é€»è¾‘ï¼š\nif (!cleanSomeSlots(i, sz) \u0026amp;\u0026amp; sz \u0026gt;= threshold) rehash(); rehash()çš„å…·ä½“å®ç°\nprivate void rehash() { expungeStaleEntries(); if (size \u0026gt;= threshold - threshold / 4) resize(); } private void expungeStaleEntries() { Entry[] tab = table; int len = tab.length; for (int j = 0; j \u0026lt; len; j++) { Entry e = tab[j]; if (e != null \u0026amp;\u0026amp; e.get() == null) expungeStaleEntry(j); } } æ³¨æ„ï¼š\nthreshold [ËˆÎ¸reÊƒhÉ™ÊŠld], é—¨æ§› = length * 2/3\nrehashä¹‹å‰è¿›è¡Œä¸€æ¬¡å®¹é‡åˆ¤æ–­( æ˜¯å¦ \u0026gt; threshold , æ˜¯åˆ™rehash)\nrehashæ—¶å…ˆè¿›è¡ŒexpungeStaleEntries() ï¼ˆæ¢ç´¢å¼æ¸…ç†ï¼Œä»tableèµ·å§‹ä¸ºæ­¢ï¼‰\nè¿™é‡Œé¦–å…ˆæ˜¯ä¼šè¿›è¡Œæ¢æµ‹å¼æ¸…ç†å·¥ä½œï¼Œä»tableçš„èµ·å§‹ä½ç½®å¾€åæ¸…ç†ï¼Œä¸Šé¢æœ‰åˆ†ææ¸…ç†çš„è¯¦ç»†æµç¨‹ã€‚æ¸…ç†å®Œæˆä¹‹åï¼Œtableä¸­å¯èƒ½æœ‰ä¸€äº›keyä¸ºnullçš„Entryæ•°æ®è¢«æ¸…ç†æ‰ï¼Œæ‰€ä»¥æ­¤æ—¶é€šè¿‡åˆ¤æ–­size \u0026gt;= threshold - threshold / 4 ä¹Ÿå°±æ˜¯size \u0026gt;= threshold * 3/4 æ¥å†³å®šæ˜¯å¦æ‰©å®¹ã€‚\næ¸…ç†åå¦‚æœå¤§äº threshold çš„3/4 ï¼Œåˆ™è¿›è¡Œæ‰©å®¹ å…·ä½“çš„resize()æ–¹æ³• ä»¥oldTab .len = 8\nå®¹åçš„tabçš„å¤§å°ä¸ºoldLen * 2 =16\néå†è€çš„æ•£åˆ—è¡¨ï¼Œé‡æ–°è®¡ç®—hashä½ç½®ï¼Œç„¶åæ”¾åˆ°æ–°çš„tabæ•°ç»„ä¸­ï¼Œå¦‚æœå‡ºç°hashå†²çªåˆ™å¾€åå¯»æ‰¾æœ€è¿‘çš„entryä¸ºnullçš„æ§½ä½\néå†å®Œæˆä¹‹åï¼ŒoldTabä¸­æ‰€æœ‰çš„entryæ•°æ®éƒ½å·²ç»æ”¾å…¥åˆ°æ–°çš„tabä¸­äº†ã€‚é‡æ–°è®¡ç®—tabä¸‹æ¬¡æ‰©å®¹çš„é˜ˆå€¼ ä»£ç å¦‚ä¸‹\nprivate void resize() { Entry[] oldTab = table; int oldLen = oldTab.length; int newLen = oldLen * 2; Entry[] newTab = new Entry[newLen]; int count = 0; for (int j = 0; j \u0026lt; oldLen; ++j) { Entry e = oldTab[j]; if (e != null) { ThreadLocal\u0026lt;?\u0026gt; k = e.get(); if (k == null) { e.value = null; } else { int h = k.threadLocalHashCode \u0026amp; (newLen - 1); while (newTab[h] != null) h = nextIndex(h, newLen); newTab[h] = e; count++; } } } setThreshold(newLen); size = count; table = newTab; } ThreadLocalMap.get() è¯¦è§£ # é€šè¿‡æŸ¥æ‰¾keyå€¼è®¡ç®—å‡ºæ•£åˆ—è¡¨ä¸­slotä½ç½®ï¼Œç„¶åè¯¥slotä½ç½®ä¸­çš„Entry.keyå’ŒæŸ¥æ‰¾çš„keyä¸€è‡´ï¼Œåˆ™ç›´æ¥è¿”å› slotä½ç½®ä¸­çš„Entry.keyå’Œè¦æŸ¥æ‰¾çš„keyä¸ä¸€è‡´ï¼Œä¹‹åæ¸…ç†+éå† æˆ‘ä»¬ä»¥get(ThreadLocal1)ä¸ºä¾‹ï¼Œé€šè¿‡hashè®¡ç®—åï¼Œæ­£ç¡®çš„slotä½ç½®åº”è¯¥æ˜¯ 4ï¼Œè€Œindex=4çš„æ§½ä½å·²ç»æœ‰äº†æ•°æ®ï¼Œä¸”keyå€¼ä¸ç­‰äºThreadLocal1ï¼Œæ‰€ä»¥éœ€è¦ç»§ç»­å¾€åè¿­ä»£æŸ¥æ‰¾ã€‚\nè¿­ä»£åˆ°index=5çš„æ•°æ®æ—¶ï¼Œæ­¤æ—¶Entry.key=nullï¼Œè§¦å‘ä¸€æ¬¡æ¢æµ‹å¼æ•°æ®å›æ”¶æ“ä½œï¼Œæ‰§è¡ŒexpungeStaleEntry()æ–¹æ³•ï¼Œæ‰§è¡Œå®Œåï¼Œindex 5,8çš„æ•°æ®éƒ½ä¼šè¢«å›æ”¶ï¼Œè€Œindex 6,7çš„æ•°æ®éƒ½ä¼šå‰ç§»ã€‚index 6,7å‰ç§»ä¹‹åï¼Œç»§ç»­ä» index=5 å¾€åè¿­ä»£ï¼Œäºæ˜¯å°±åœ¨ index=5 æ‰¾åˆ°äº†keyå€¼ç›¸ç­‰çš„Entryæ•°æ®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ThreadLocalMap.get()æºç è¯¦è§£\nprivate Entry getEntry(ThreadLocal\u0026lt;?\u0026gt; key) { int i = key.threadLocalHashCode \u0026amp; (table.length - 1); Entry e = table[i]; if (e != null \u0026amp;\u0026amp; e.get() == key) return e; else return getEntryAfterMiss(key, i, e); } private Entry getEntryAfterMiss(ThreadLocal\u0026lt;?\u0026gt; key, int i, Entry e) { Entry[] tab = table; int len = tab.length; while (e != null) { ThreadLocal\u0026lt;?\u0026gt; k = e.get(); if (k == key) return e; if (k == null) expungeStaleEntry(i); else i = nextIndex(i, len); e = tab[i]; } return null; } ThreadLocalMapè¿‡æœŸkeyçš„å¯å‘å¼æ¸…ç†æµç¨‹(ç•¥è¿‡ï¼Œè·Ÿç§»ä½è¿ç®—ç¬¦æœ‰å…³) # ä¸Šé¢å¤šæ¬¡æåŠåˆ°ThreadLocalMapè¿‡æœŸkeyçš„ä¸¤ç§æ¸…ç†æ–¹å¼ï¼šæ¢æµ‹å¼æ¸…ç†(expungeStaleEntry())ã€å¯å‘å¼æ¸…ç†(cleanSomeSlots())\næ¢æµ‹å¼æ¸…ç†æ˜¯ä»¥å½“å‰Entry å¾€åæ¸…ç†ï¼Œé‡åˆ°å€¼ä¸ºnullåˆ™ç»“æŸæ¸…ç†ï¼Œå±äºçº¿æ€§æ¢æµ‹æ¸…ç†ã€‚\nè€Œå¯å‘å¼æ¸…ç†è¢«ä½œè€…å®šä¹‰ä¸ºï¼šHeuristically scan some cells looking for stale entries.\nInheritable ThreadLocal # ä½¿ç”¨ThreadLocalçš„æ—¶å€™ï¼Œåœ¨å¼‚æ­¥åœºæ™¯ä¸‹æ˜¯æ— æ³•ç»™å­çº¿ç¨‹å…±äº«çˆ¶çº¿ç¨‹ä¸­åˆ›å»ºçš„çº¿ç¨‹å‰¯æœ¬æ•°æ®çš„ã€‚JDKä¸­å­˜åœ¨InheritableThreadLocalç±»å¯ä»¥è§£å†³å¤„ç†è¿™ä¸ªé—®é¢˜\nåŸç†ï¼š å­çº¿ç¨‹æ˜¯é€šè¿‡åœ¨çˆ¶çº¿ç¨‹ä¸­é€šè¿‡new Thread()æ–¹æ³•åˆ›å»ºå­çº¿ç¨‹ï¼ŒThread#init æ–¹æ³•åœ¨Threadçš„æ„é€ æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼Œinitæ–¹æ³•ä¸­æ‹·è´çˆ¶çº¿ç¨‹æ•°æ®åˆ°å­çº¿ç¨‹ä¸­\nprivate void init(ThreadGroup g, Runnable target, String name, long stackSize, AccessControlContext acc, boolean inheritThreadLocals) { if (name == null) { throw new NullPointerException(\u0026#34;name cannot be null\u0026#34;); } if (inheritThreadLocals \u0026amp;\u0026amp; parent.inheritableThreadLocals != null) this.inheritableThreadLocals = ThreadLocal.createInheritedMap(parent.inheritableThreadLocals); this.stackSize = stackSize; tid = nextThreadID(); } public class InheritableThreadLocalDemo { public static void main(String[] args) { ThreadLocal\u0026lt;String\u0026gt; ThreadLocal = new ThreadLocal\u0026lt;\u0026gt;(); ThreadLocal\u0026lt;String\u0026gt; inheritableThreadLocal = new InheritableThreadLocal\u0026lt;\u0026gt;(); ThreadLocal.set(\u0026#34;çˆ¶ç±»æ•°æ®:threadLocal\u0026#34;); inheritableThreadLocal.set(\u0026#34;çˆ¶ç±»æ•°æ®:inheritableThreadLocal\u0026#34;); new Thread(new Runnable() { @Override public void run() { System.out.println(\u0026#34;å­çº¿ç¨‹è·å–çˆ¶ç±»ThreadLocalæ•°æ®ï¼š\u0026#34; + ThreadLocal.get()); System.out.println(\u0026#34;å­çº¿ç¨‹è·å–çˆ¶ç±»inheritableThreadLocalæ•°æ®ï¼š\u0026#34; + inheritableThreadLocal.get()); } }).start(); } } /*ç»“æœ å­çº¿ç¨‹è·å–çˆ¶ç±»ThreadLocalæ•°æ®ï¼šnull å­çº¿ç¨‹è·å–çˆ¶ç±»inheritableThreadLocalæ•°æ®ï¼šçˆ¶ç±»æ•°æ®:inheritableThreadLocal */ ä½†æ˜¯å¦‚æœä¸æ˜¯ç›´æ¥new()ï¼Œä¹Ÿå°±æ˜¯å®é™…ä¸­æˆ‘ä»¬éƒ½æ˜¯é€šè¿‡ä½¿ç”¨çº¿ç¨‹æ± æ¥è·å–æ–°çº¿ç¨‹çš„ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨é˜¿é‡Œå¼€æºçš„ä¸€ä¸ªç»„ä»¶è§£å†³è¿™ä¸ªé—®é¢˜ TransmittableThreadLocal\nThreadLocalé¡¹ç›®ä¸­ä½¿ç”¨å®æˆ˜ # è¿™é‡Œæ¶‰åŠåˆ°requestIdï¼Œæ²¡ç”¨è¿‡ï¼Œä¸æ˜¯å¾ˆæ‡‚ï¼Œç•¥è¿‡\nThreadLocalä½¿ç”¨åœºæ™¯ # Feignè¿œç¨‹è°ƒç”¨è§£å†³æ–¹æ¡ˆ # çº¿ç¨‹æ± å¼‚æ­¥è°ƒç”¨,requestId ä¼ é€’ # ä½¿ç”¨MQå‘é€æ¶ˆæ¯ç»™ç¬¬ä¸‰æ–¹ç³»ç»Ÿ # "},{"id":129,"href":"/zh/docs/study/Review/java_guide/java/Concurrent/ly0309lyatomic-classes/","title":"AtomicåŸå­ç±»ä»‹ç»","section":"å¹¶å‘","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\næ–‡ç« å¼€å¤´å…ˆç”¨ä¾‹å­ä»‹ç»å‡ ç§ç±»å‹çš„apiä½¿ç”¨\npackage com.aqs; import lombok.*; import java.util.concurrent.atomic.*; @Data @Getter @Setter @AllArgsConstructor @ToString class User { private String name; //å¦‚æœè¦ä¸ºatomicReferenceFieldUpdateræœåŠ¡,å¿…é¡»åŠ ä¸Švolatileä¿®é¥° public volatile Integer age; } public class AtomicTest { public static void main(String[] args) { System.out.println(\u0026#34;åŸå­æ›´æ–°æ•°å€¼---------------\u0026#34;); AtomicInteger atomicInteger = new AtomicInteger(); int i1 = atomicInteger.incrementAndGet(); System.out.println(\u0026#34;åŸå­å¢åŠ åä¸º\u0026#34; + i1); System.out.println(\u0026#34;åŸå­æ›´æ–°æ•°ç»„---------------\u0026#34;); int[] a = new int[3]; AtomicIntegerArray atomicIntegerArray = new AtomicIntegerArray(a); int i = atomicIntegerArray.addAndGet(1, 3); System.out.println(\u0026#34;æ•°ç»„å…ƒç´ [\u0026#34; + 1 + \u0026#34;]å¢åŠ åä¸º\u0026#34; + i); System.out.println(\u0026#34;æ•°ç»„ä¸º\u0026#34; + atomicIntegerArray); System.out.println(\u0026#34;åŸå­æ›´æ–°å¯¹è±¡---------------\u0026#34;); User user1 = new User(\u0026#34;ly1\u0026#34;, 10); User user2 = new User(\u0026#34;ly2\u0026#34;, 20); User user3 = new User(\u0026#34;ly3\u0026#34;, 30); AtomicReference\u0026lt;User\u0026gt; atomicReference = new AtomicReference\u0026lt;\u0026gt;(user1); boolean b = atomicReference.compareAndSet(user2, user3); System.out.println(\u0026#34;æ›´æ–°\u0026#34; + (b ? \u0026#34;æˆåŠŸ\u0026#34; : \u0026#34;å¤±è´¥\u0026#34;)); System.out.println(\u0026#34;å¼•ç”¨é‡Œå€¼ä¸º\u0026#34;+atomicReference.get()); boolean b1 = atomicReference.compareAndSet(user1, user3); System.out.println(\u0026#34;æ›´æ–°\u0026#34; + (b1 ? \u0026#34;æˆåŠŸ\u0026#34; : \u0026#34;å¤±è´¥\u0026#34;)); System.out.println(\u0026#34;å¼•ç”¨é‡Œå€¼ä¸º\u0026#34;+atomicReference.get()); System.out.println(\u0026#34;åŸå­æ›´æ–°å¯¹è±¡å±æ€§---------------\u0026#34;); User user4=new User(\u0026#34;ly4\u0026#34;,40); AtomicReferenceFieldUpdater\u0026lt;User, Integer\u0026gt; atomicReferenceFieldUpdater = AtomicReferenceFieldUpdater.newUpdater(User.class, Integer.class, \u0026#34;age\u0026#34;); boolean b2 = atomicReferenceFieldUpdater.compareAndSet(user4, 41, 400); System.out.println(\u0026#34;æ›´æ–°\u0026#34;+(b2?\u0026#34;æˆåŠŸ\u0026#34;:\u0026#34;å¤±è´¥\u0026#34;)); System.out.println(\u0026#34;å¼•ç”¨é‡Œuser4å€¼ä¸º\u0026#34;+atomicReferenceFieldUpdater.get(user4)); boolean b3 = atomicReferenceFieldUpdater.compareAndSet(user4, 40, 400); System.out.println(\u0026#34;æ›´æ–°\u0026#34;+(b3?\u0026#34;æˆåŠŸ\u0026#34;:\u0026#34;å¤±è´¥\u0026#34;)); System.out.println(\u0026#34;å¼•ç”¨é‡Œuser4å€¼ä¸º\u0026#34;+atomicReferenceFieldUpdater.get(user4)); System.out.println(\u0026#34;å…¶ä»–ä½¿ç”¨---------------\u0026#34;); User user5=new User(\u0026#34;ly5\u0026#34;,50); User user6=new User(\u0026#34;ly6\u0026#34;,60); User user7=new User(\u0026#34;ly7\u0026#34;,70); AtomicMarkableReference\u0026lt;User\u0026gt; userAtomicMarkableReference=new AtomicMarkableReference\u0026lt;\u0026gt;(user5,true); boolean b4 = userAtomicMarkableReference.weakCompareAndSet(user6, user7, true, false); System.out.println(\u0026#34;æ›´æ–°\u0026#34;+(b4?\u0026#34;æˆåŠŸ\u0026#34;:\u0026#34;å¤±è´¥\u0026#34;)); System.out.println(\u0026#34;å¼•ç”¨é‡Œå€¼ä¸º\u0026#34;+userAtomicMarkableReference.getReference()); boolean b5 = userAtomicMarkableReference.weakCompareAndSet(user5, user7, false, true); System.out.println(\u0026#34;æ›´æ–°\u0026#34;+(b5?\u0026#34;æˆåŠŸ\u0026#34;:\u0026#34;å¤±è´¥\u0026#34;)); System.out.println(\u0026#34;å¼•ç”¨é‡Œå€¼ä¸º\u0026#34;+userAtomicMarkableReference.getReference()); boolean b6 = userAtomicMarkableReference.weakCompareAndSet(user5, user7, true, false); System.out.println(\u0026#34;æ›´æ–°\u0026#34;+(b6?\u0026#34;æˆåŠŸ\u0026#34;:\u0026#34;å¤±è´¥\u0026#34;)); System.out.println(\u0026#34;å¼•ç”¨é‡Œå€¼ä¸º\u0026#34;+userAtomicMarkableReference.getReference()); System.out.println(\u0026#34;AtomicStampedReferenceä½¿ç”¨---------------\u0026#34;); User user80=new User(\u0026#34;ly8\u0026#34;,80); User user90=new User(\u0026#34;ly9\u0026#34;,90); User user100=new User(\u0026#34;ly10\u0026#34;,100); AtomicStampedReference\u0026lt;User\u0026gt; userAtomicStampedReference=new AtomicStampedReference\u0026lt;\u0026gt;(user80,80);//ç‰ˆæœ¬80 //...æ¯æ¬¡æ›´æ”¹stampéƒ½åŠ 1 //è¿™é‡Œå‡è®¾ä¸­é€”è¢«æ”¹æˆ81äº† boolean b7 = userAtomicStampedReference.compareAndSet(user80, user100,81,90); System.out.println(\u0026#34;æ›´æ–°\u0026#34;+(b7?\u0026#34;æˆåŠŸ\u0026#34;:\u0026#34;å¤±è´¥\u0026#34;)); System.out.println(\u0026#34;å¼•ç”¨é‡Œå€¼ä¸º\u0026#34;+userAtomicStampedReference.getReference()); boolean b8 = userAtomicStampedReference.compareAndSet(user80, user100,80,90); System.out.println(\u0026#34;æ›´æ–°\u0026#34;+(b8?\u0026#34;æˆåŠŸ\u0026#34;:\u0026#34;å¤±è´¥\u0026#34;)); System.out.println(\u0026#34;å¼•ç”¨é‡Œå€¼ä¸º\u0026#34;+userAtomicStampedReference.getReference()); } } /* åŸå­æ›´æ–°æ•°å€¼--------------- åŸå­å¢åŠ åä¸º1 åŸå­æ›´æ–°æ•°ç»„--------------- æ•°ç»„å…ƒç´ [1]å¢åŠ åä¸º3 æ•°ç»„ä¸º[0, 3, 0] åŸå­æ›´æ–°å¯¹è±¡--------------- æ›´æ–°å¤±è´¥ å¼•ç”¨é‡Œå€¼ä¸ºUser(name=ly1, age=10) æ›´æ–°æˆåŠŸ å¼•ç”¨é‡Œå€¼ä¸ºUser(name=ly3, age=30) åŸå­æ›´æ–°å¯¹è±¡å±æ€§--------------- æ›´æ–°å¤±è´¥ å¼•ç”¨é‡Œuser4å€¼ä¸º40 æ›´æ–°æˆåŠŸ å¼•ç”¨é‡Œuser4å€¼ä¸º400 å…¶ä»–ä½¿ç”¨--------------- æ›´æ–°å¤±è´¥ å¼•ç”¨é‡Œå€¼ä¸ºUser(name=ly5, age=50) æ›´æ–°å¤±è´¥ å¼•ç”¨é‡Œå€¼ä¸ºUser(name=ly5, age=50) æ›´æ–°æˆåŠŸ å¼•ç”¨é‡Œå€¼ä¸ºUser(name=ly7, age=70) AtomicStampedReferenceä½¿ç”¨--------------- æ›´æ–°å¤±è´¥ å¼•ç”¨é‡Œå€¼ä¸ºUser(name=ly8, age=80) æ›´æ–°æˆåŠŸ å¼•ç”¨é‡Œå€¼ä¸ºUser(name=ly10, age=100) Process finished with exit code 0 */ åŸå­ç±»ä»‹ç» # åœ¨åŒ–å­¦ä¸Šï¼ŒåŸå­æ˜¯æ„æˆä¸€èˆ¬ç‰©è´¨çš„æœ€å°å•ä½ï¼ŒåŒ–å­¦ååº”ä¸­æ˜¯ä¸å¯åˆ†å‰²çš„ï¼ŒAtomicæŒ‡ä¸€ä¸ªæ“ä½œæ˜¯ä¸å¯ä¸­æ–­çš„ï¼Œå³ä½¿åœ¨å¤šä¸ªçº¿ç¨‹ä¸€èµ·æ‰§è¡Œæ—¶ï¼Œä¸€ä¸ªæ“ä½œä¸€æ—¦å¼€å§‹å°±ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹å¹²æ‰° åŸå­ç±»\u0026ndash;\u0026gt;å…·æœ‰åŸå­/åŸå­æ“ä½œç‰¹å¾çš„ç±» å¹¶å‘åŒ…java.util.concurrent çš„åŸå­ç±»éƒ½æ”¾ç€java.util.concurrent.atomicä¸­ æ ¹æ®æ“ä½œçš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥å°†JUCåŒ…ä¸­çš„åŸå­ç±»åˆ†ä¸º4ç±»ï¼ˆåŸºæœ¬ç±»å‹ã€æ•°ç»„ç±»å‹ã€å¼•ç”¨ç±»å‹ã€å¯¹è±¡çš„å±æ€§ä¿®æ”¹ç±»å‹ï¼‰ åŸºæœ¬ç±»å‹ ä½¿ç”¨åŸå­æ–¹å¼æ›´æ–°åŸºæœ¬ç±»å‹ï¼ŒåŒ…æ‹¬AtomicInteger æ•´å‹åŸå­ç±»ï¼ŒAtomicLong é•¿æ•´å‹åŸå­ç±»ï¼ŒAtomicBoolean å¸ƒå°”å‹åŸå­ç±»\næ•°ç»„ç±»å‹ ä½¿ç”¨åŸå­æ–¹å¼æ›´æ–°æ•°ç»„é‡ŒæŸä¸ªå…ƒç´ ï¼ŒåŒ…æ‹¬AtomicIntegerArray æ•´å‹æ•°ç»„åŸå­ç±»ï¼ŒAtomicLongArray é•¿æ•´å‹æ•°ç»„åŸå­ç±»ï¼ŒAtomicReferenceArray å¼•ç”¨ç±»å‹æ•°ç»„åŸå­ç±»\nå¼•ç”¨ç±»å‹ AtomicReference å¼•ç”¨ç±»å‹åŸå­ç±»ï¼ŒAtomicMarkableReference åŸå­æ›´æ–°å¸¦æœ‰æ ‡è®°çš„å¼•ç”¨ç±»å‹ï¼Œè¯¥ç±»å°†booleanæ ‡è®°ä¸å¼•ç”¨å…³è”ï¼ˆä¸å¯è§£å†³CASè¿›è¡ŒåŸå­æ“ä½œå‡ºç°çš„ABAé—®é¢˜ï¼‰ï¼ŒAtomicStampedReference åŸå­æ›´æ–°å¸¦æœ‰ç‰ˆæœ¬å·çš„å¼•ç”¨ç±»å‹ è¯¥ç±»å°†æ•´æ•°å€¼ä¸å¼•ç”¨å…³è”ï¼Œå¯ç”¨äºè§£å†³åŸå­æ›´æ–°æ•°æ®å’Œæ•°æ®çš„ç‰ˆæœ¬å·(è§£å†³ä½¿ç”¨CASè¿›è¡ŒåŸå­æ›´æ–°æ—¶å¯èƒ½å‡ºç°çš„ABAé—®é¢˜)\nå¯¹è±¡çš„å±æ€§ä¿®æ”¹ç±»å‹ AtomicIntegerFieldUpdater åŸå­æ›´æ–°æ•´å‹å­—æ®µçš„æ›´æ–°å™¨ï¼ŒAtomicLongFieldUpdater åŸå­æ›´æ–°é•¿æ•´å‹å­—æ®µçš„æ›´æ–°å™¨ï¼Œ AtomicReferenceFieldUpdater åŸå­æ›´æ–°å¼•ç”¨ç±»å‹é‡Œçš„å­—æ®µ\nAtomicMarkableReference ä¸èƒ½è§£å†³ ABA é—®é¢˜\npublic class SolveABAByAtomicMarkableReference { private static AtomicMarkableReference atomicMarkableReference = new AtomicMarkableReference(100, false); public static void main(String[] args) { Thread refT1 = new Thread(() -\u0026gt; { try { TimeUnit.SECONDS.sleep(1); } catch (InterruptedException e) { e.printStackTrace(); } atomicMarkableReference.compareAndSet(100, 101, atomicMarkableReference.isMarked(), !atomicMarkableReference.isMarked());//æ ¹æ®æœŸæœ›å€¼100å’Œfalse ä¿®æ”¹ä¸º101å’Œtrue atomicMarkableReference.compareAndSet(101, 100, atomicMarkableReference.isMarked(), !atomicMarkableReference.isMarked());//æ ¹æ®æœŸæœ›å€¼101å’Œtrue ä¿®æ”¹ä¸º100å’Œfalse }); Thread refT2 = new Thread(() -\u0026gt; { //è·å–åŸæ¥çš„markedæ ‡è®°(false) boolean marked = atomicMarkableReference.isMarked(); //2sä¹‹åè¿›è¡Œæ›¿æ¢,ä¸åº”è¯¥æ›¿æ¢æˆåŠŸ try { TimeUnit.SECONDS.sleep(2); } catch (InterruptedException e) { e.printStackTrace(); } boolean c3 = atomicMarkableReference.compareAndSet(100, 101, marked, !marked); System.out.println(c3); // è¿”å›true,å®é™…åº”è¯¥è¿”å›false }); //å¯¼è‡´äº†ABAé—®é¢˜ refT1.start(); refT2.start(); } } CAS ABAé—®é¢˜\næè¿°: ç¬¬ä¸€ä¸ªçº¿ç¨‹å–åˆ°äº†å˜é‡ x çš„å€¼ Aï¼Œç„¶åå·´æ‹‰å·´æ‹‰å¹²åˆ«çš„äº‹ï¼Œæ€»ä¹‹å°±æ˜¯åªæ‹¿åˆ°äº†å˜é‡ x çš„å€¼ Aã€‚è¿™æ®µæ—¶é—´å†…ç¬¬äºŒä¸ªçº¿ç¨‹ä¹Ÿå–åˆ°äº†å˜é‡ x çš„å€¼ Aï¼Œç„¶åæŠŠå˜é‡ x çš„å€¼æ”¹ä¸º Bï¼Œç„¶åå·´æ‹‰å·´æ‹‰å¹²åˆ«çš„äº‹ï¼Œæœ€ååˆæŠŠå˜é‡ x çš„å€¼å˜ä¸º A ï¼ˆç›¸å½“äºè¿˜åŸäº†ï¼‰ã€‚åœ¨è¿™ä¹‹åç¬¬ä¸€ä¸ªçº¿ç¨‹ç»ˆäºè¿›è¡Œäº†å˜é‡ x çš„æ“ä½œï¼Œä½†æ˜¯æ­¤æ—¶å˜é‡ x çš„å€¼è¿˜æ˜¯ Aï¼Œæ‰€ä»¥ compareAndSet æ“ä½œæ˜¯æˆåŠŸã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹ä¸€æ— æ³•ä¿è¯è‡ªå·±æ“ä½œæœŸé—´ï¼Œè¯¥å€¼è¢«ä¿®æ”¹äº†\nä¾‹å­æè¿°(å¯èƒ½ä¸å¤ªåˆé€‚ï¼Œä½†å¥½ç†è§£): å¹´åˆï¼Œç°é‡‘ä¸ºé›¶ï¼Œç„¶åé€šè¿‡æ­£å¸¸åŠ³åŠ¨èµšäº†ä¸‰ç™¾ä¸‡ï¼Œä¹‹åæ­£å¸¸æ¶ˆè´¹äº†ï¼ˆæ¯”å¦‚ä¹°æˆ¿å­ï¼‰ä¸‰ç™¾ä¸‡ã€‚å¹´æœ«ï¼Œè™½ç„¶ç°é‡‘é›¶æ”¶å…¥ï¼ˆå¯èƒ½å˜æˆå…¶ä»–å½¢å¼äº†ï¼‰ï¼Œä½†æ˜¯èµšäº†é’±æ˜¯äº‹å®ï¼Œè¿˜æ˜¯å¾—äº¤ç¨çš„ï¼\nä»£ç æè¿°\nimport java.util.concurrent.atomic.AtomicInteger; public class AtomicIntegerDefectDemo { public static void main(String[] args) { defectOfABA(); } static void defectOfABA() { final AtomicInteger atomicInteger = new AtomicInteger(1); Thread coreThread = new Thread( () -\u0026gt; { final int currentValue = atomicInteger.get(); System.out.println(Thread.currentThread().getName() + \u0026#34; ------ currentValue=\u0026#34; + currentValue); // è¿™æ®µç›®çš„ï¼šæ¨¡æ‹Ÿå¤„ç†å…¶ä»–ä¸šåŠ¡èŠ±è´¹çš„æ—¶é—´ //ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å·®å€¼300-100=200mså†…ï¼Œå€¼è¢«æ“ä½œäº†ä¸¤æ¬¡(ä½†åˆæ”¹å›å»äº†)ï¼Œç„¶åçº¿ç¨‹coreThreadå¹¶æ²¡æœ‰æ„ŸçŸ¥åˆ°ï¼Œå½“ä½œæ²¡æœ‰ä¿®æ”¹è¿‡æ¥å¤„ç† try { Thread.sleep(300); } catch (InterruptedException e) { e.printStackTrace(); } boolean casResult = atomicInteger.compareAndSet(1, 2); System.out.println(Thread.currentThread().getName() + \u0026#34; ------ currentValue=\u0026#34; + currentValue + \u0026#34;, finalValue=\u0026#34; + atomicInteger.get() + \u0026#34;, compareAndSet Result=\u0026#34; + casResult); } ); coreThread.start(); // è¿™æ®µç›®çš„ï¼šä¸ºäº†è®© coreThread çº¿ç¨‹å…ˆè·‘èµ·æ¥ try { Thread.sleep(100); } catch (InterruptedException e) { e.printStackTrace(); } Thread amateurThread = new Thread( () -\u0026gt; { int currentValue = atomicInteger.get(); boolean casResult = atomicInteger.compareAndSet(1, 2); System.out.println(Thread.currentThread().getName() + \u0026#34; ------ currentValue=\u0026#34; + currentValue + \u0026#34;, finalValue=\u0026#34; + atomicInteger.get() + \u0026#34;, compareAndSet Result=\u0026#34; + casResult); currentValue = atomicInteger.get(); casResult = atomicInteger.compareAndSet(2, 1); System.out.println(Thread.currentThread().getName() + \u0026#34; ------ currentValue=\u0026#34; + currentValue + \u0026#34;, finalValue=\u0026#34; + atomicInteger.get() + \u0026#34;, compareAndSet Result=\u0026#34; + casResult); } ); amateurThread.start(); } } /*è¾“å‡ºå†…å®¹ Thread-0 ------ currentValue=1 Thread-1 ------ currentValue=1, finalValue=2, compareAndSet Result=true Thread-1 ------ currentValue=2, finalValue=1, compareAndSet Result=true Thread-0 ------ currentValue=1, finalValue=2, compareAndSet Result=true */ åŸºæœ¬ç±»å‹åŸå­ç±» # ä½¿ç”¨åŸå­æ–¹å¼æ›´æ–°åŸºæœ¬ç±»å‹ï¼šAtomicInteger æ•´å‹åŸå­ç±»ï¼ŒAtomicLong é•¿æ•´å‹åŸå­ç±» ï¼ŒAtomicBoolean å¸ƒå°”å‹åŸå­ç±»ï¼Œä¸‹æ–‡ä»¥AtomicIntegerä¸ºä¾‹å­æ¥ä»‹ç» å¸¸ç”¨æ–¹æ³•ï¼š\npublic final int get() //è·å–å½“å‰çš„å€¼ public final int getAndSet(int newValue)//è·å–å½“å‰çš„å€¼ï¼Œå¹¶è®¾ç½®æ–°çš„å€¼ public final int getAndIncrement()//è·å–å½“å‰çš„å€¼ï¼Œå¹¶è‡ªå¢ public final int getAndDecrement() //è·å–å½“å‰çš„å€¼ï¼Œå¹¶è‡ªå‡ public final int getAndAdd(int delta) //è·å–å½“å‰çš„å€¼ï¼Œå¹¶åŠ ä¸Šé¢„æœŸçš„å€¼ boolean compareAndSet(int expect, int update) //å¦‚æœè¾“å…¥çš„æ•°å€¼ç­‰äºé¢„æœŸå€¼ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†è¯¥å€¼è®¾ç½®ä¸ºè¾“å…¥å€¼ï¼ˆupdateï¼‰ public final void lazySet(int newValue)//æœ€ç»ˆè®¾ç½®ä¸ºnewValue,ä½¿ç”¨ lazySet è®¾ç½®ä¹‹åå¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹åœ¨ä¹‹åçš„ä¸€å°æ®µæ—¶é—´å†…è¿˜æ˜¯å¯ä»¥è¯»åˆ°æ—§çš„å€¼ã€‚ å¸¸è§æ–¹æ³•ä½¿ç”¨\nimport java.util.concurrent.atomic.AtomicInteger; public class AtomicIntegerTest { public static void main(String[] args) { // TODO Auto-generated method stub int temvalue = 0; AtomicInteger i = new AtomicInteger(0); temvalue = i.getAndSet(3); System.out.println(\u0026#34;temvalue:\u0026#34; + temvalue + \u0026#34;; i:\u0026#34; + i);//temvalue:0; i:3 temvalue = i.getAndIncrement(); System.out.println(\u0026#34;temvalue:\u0026#34; + temvalue + \u0026#34;; i:\u0026#34; + i);//temvalue:3; i:4 temvalue = i.getAndAdd(5); System.out.println(\u0026#34;temvalue:\u0026#34; + temvalue + \u0026#34;; i:\u0026#34; + i);//temvalue:4; i:9 } } åŸºæœ¬æ•°æ®ç±»å‹åŸå­ç±»çš„ä¼˜åŠ¿ # å¤šçº¿ç¨‹ç¯å¢ƒä¸ä½¿ç”¨åŸå­ç±»ä¿è¯çº¿ç¨‹å®‰å…¨ï¼ˆåŸºæœ¬æ•°æ®ç±»å‹ï¼‰\nclass Test { private volatile int count = 0; //è‹¥è¦çº¿ç¨‹å®‰å…¨æ‰§è¡Œæ‰§è¡Œcount++ï¼Œéœ€è¦åŠ é” public synchronized void increment() { count++; } public int getCount() { return count; } } å¤šçº¿ç¨‹ç¯å¢ƒä½¿ç”¨åŸå­ç±»ä¿è¯çº¿ç¨‹å®‰å…¨(åŸºæœ¬æ•°æ®ç±»å‹)\nclass Test2 { private AtomicInteger count = new AtomicInteger(); //ä½¿ç”¨AtomicIntegerä¹‹åï¼Œä¸éœ€è¦åŠ é”ï¼Œä¹Ÿå¯ä»¥å®ç°çº¿ç¨‹å®‰å…¨ã€‚ public void increment() { count.incrementAndGet(); } public int getCount() { return count.get(); } } AtomicIntegerçº¿ç¨‹å®‰å…¨åŸç†ç®€å•åˆ†æ # éƒ¨åˆ†æºç ï¼š\n/ setup to use Unsafe.compareAndSwapInt for updatesï¼ˆæ›´æ–°æ“ä½œæ—¶æä¾›â€œæ¯”è¾ƒå¹¶æ›¿æ¢â€çš„ä½œç”¨ï¼‰ private static final Unsafe unsafe = Unsafe.getUnsafe(); private static final long valueOffset; static { try { valueOffset = unsafe.objectFieldOffset (AtomicInteger.class.getDeclaredField(\u0026#34;value\u0026#34;)); } catch (Exception ex) { throw new Error(ex); } } private volatile int value; AtomicIntegerç±»ä¸»è¦åˆ©ç”¨CASï¼ˆcompare and swap) + volatile å’Œ nativeæ–¹æ³•æ¥ä¿è¯åŸå­æ“ä½œï¼Œä»è€Œé¿å…synchronizedé«˜å¼€é”€ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡ CASçš„åŸç†æ˜¯æ‹¿æœŸæœ›çš„å€¼å’ŒåŸæœ¬çš„å€¼åšæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒåˆ™æ›´æ–°æˆæ–°å€¼ UnSafeç±»çš„objectFieldOffset()æ–¹æ³•æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨æ¥æ‹¿åˆ°**\u0026ldquo;åŸæ¥çš„å€¼\u0026quot;çš„å†…å­˜åœ°å€** valueæ˜¯ä¸€ä¸ªvolatileå˜é‡ï¼Œåœ¨å†…å­˜ä¸­å¯è§ï¼Œå› æ­¤JVMå¯ä»¥ä¿è¯ä»»ä½•æ—¶åˆ»ä»»ä½•çº¿ç¨‹æ€»èƒ½æ‹¿åˆ°è¯¥å˜é‡çš„æœ€æ–°å€¼ æ•°ç»„ç±»å‹åŸå­ç±» # ä½¿ç”¨åŸå­çš„æ–¹å¼æ›´æ–°æ•°ç»„é‡Œçš„æŸä¸ªå…ƒç´ \nAtomicIntegerArray æ•´å‹æ•°ç»„åŸå­ç±»ï¼ŒAtomicLongArray é•¿æ•´å‹æ•°ç»„åŸå­ç±»ï¼ŒAtomicReferenceArray å¼•ç”¨ç±»å‹æ•°ç»„åŸå­ç±»\nå¸¸ç”¨æ–¹æ³•ï¼š\npublic final int get(int i) //è·å– index=i ä½ç½®å…ƒç´ çš„å€¼ public final int getAndSet(int i, int newValue)//è¿”å› index=i ä½ç½®çš„å½“å‰çš„å€¼ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºæ–°å€¼ï¼šnewValue public final int getAndIncrement(int i)//è·å– index=i ä½ç½®å…ƒç´ çš„å€¼ï¼Œå¹¶è®©è¯¥ä½ç½®çš„å…ƒç´ è‡ªå¢ public final int getAndDecrement(int i) //è·å– index=i ä½ç½®å…ƒç´ çš„å€¼ï¼Œå¹¶è®©è¯¥ä½ç½®çš„å…ƒç´ è‡ªå‡ public final int getAndAdd(int i, int delta) //è·å– index=i ä½ç½®å…ƒç´ çš„å€¼ï¼Œå¹¶åŠ ä¸Šé¢„æœŸçš„å€¼ boolean compareAndSet(int i, int expect, int update) //å¦‚æœè¾“å…¥çš„æ•°å€¼ç­‰äºé¢„æœŸå€¼ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°† index=i ä½ç½®çš„å…ƒç´ å€¼è®¾ç½®ä¸ºè¾“å…¥å€¼ï¼ˆupdateï¼‰ public final void lazySet(int i, int newValue)//æœ€ç»ˆ å°†index=i ä½ç½®çš„å…ƒç´ è®¾ç½®ä¸ºnewValue,ä½¿ç”¨ lazySet è®¾ç½®ä¹‹åå¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹åœ¨ä¹‹åçš„ä¸€å°æ®µæ—¶é—´å†…è¿˜æ˜¯å¯ä»¥è¯»åˆ°æ—§çš„å€¼ã€‚ å¸¸è§æ–¹æ³•ä½¿ç”¨\nimport java.util.concurrent.atomic.AtomicIntegerArray; public class AtomicIntegerArrayTest { public static void main(String[] args) { // TODO Auto-generated method stub int temvalue = 0; int[] nums = { 1, 2, 3, 4, 5, 6 }; AtomicIntegerArray i = new AtomicIntegerArray(nums); for (int j = 0; j \u0026lt; nums.length; j++) { System.out.println(i.get(j)); } temvalue = i.getAndSet(0, 2); System.out.println(\u0026#34;temvalue:\u0026#34; + temvalue + \u0026#34;; i:\u0026#34; + i); temvalue = i.getAndIncrement(0); System.out.println(\u0026#34;temvalue:\u0026#34; + temvalue + \u0026#34;; i:\u0026#34; + i); temvalue = i.getAndAdd(0, 5); System.out.println(\u0026#34;temvalue:\u0026#34; + temvalue + \u0026#34;; i:\u0026#34; + i); } } å¼•ç”¨ç±»å‹åŸå­ç±» # åŸºæœ¬ç±»å‹åŸå­ç±»åªèƒ½æ›´æ–°ä¸€ä¸ªå˜é‡ï¼Œå¦‚æœéœ€è¦åŸå­æ›´æ–°å¤šä¸ªå˜é‡ï¼Œåˆ™éœ€è¦ä½¿ç”¨å¼•ç”¨ç±»å‹åŸå­ç±»\nAtomicReference å¼•ç”¨ç±»å‹åŸå­ç±»ï¼›\nAtomicStampedReference åŸå­æ›´æ–°å¸¦æœ‰ç‰ˆæœ¬å·çš„å¼•ç”¨ç±»å‹ï¼Œè¯¥ç±»å°†æ•´æ•°å€¼ä¸å¼•ç”¨å…³è”èµ·æ¥ï¼Œå¯ç”¨äºè§£å†³åŸå­çš„æ›´æ–°æ•°æ®å’Œæ•°æ®çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥è§£å†³ä½¿ç”¨CASè¿›è¡ŒåŸå­æ›´æ–°æ—¶å¯èƒ½å‡ºç°çš„ABAé—®é¢˜ï¼›\nAtomicMarkableReferenceï¼šåŸå­æ›´æ–°å¸¦æœ‰æ ‡è®°çš„å¼•ç”¨ç±»å‹ã€‚è¯¥ç±»å°†booleanæ ‡è®°ä¸å¼•ç”¨å…³è”**ï¼ˆæ³¨ï¼šæ— æ³•è§£å†³ABAé—®é¢˜ï¼‰**\nä¸‹é¢ä»¥AtomicReferenceä¸ºä¾‹ä»‹ç»\nimport java.util.concurrent.atomic.AtomicReference; public class AtomicReferenceTest { public static void main(String[] args) { AtomicReference\u0026lt;Person\u0026gt; ar = new AtomicReference\u0026lt;Person\u0026gt;(); Person person = new Person(\u0026#34;SnailClimb\u0026#34;, 22); ar.set(person); Person updatePerson = new Person(\u0026#34;Daisy\u0026#34;, 20); ar.compareAndSet(person, updatePerson);//å¦‚æœæœŸæœ›å€¼ä¸ºpersonï¼Œåˆ™æ›¿æ¢æˆupdatePerson System.out.println(ar.get().getName()); System.out.println(ar.get().getAge()); } } class Person { private String name; private int age; public Person(String name, int age) { super(); this.name = name; this.age = age; } public String getName() { return name; } public void setName(String name) { this.name = name; } public int getAge() { return age; } public void setAge(int age) { this.age = age; } } ä¸Šè¿°ä»£ç é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª Person å¯¹è±¡ï¼Œç„¶åæŠŠ Person å¯¹è±¡è®¾ç½®è¿› AtomicReference å¯¹è±¡ä¸­ï¼Œç„¶åè°ƒç”¨ compareAndSet æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°±æ˜¯é€šè¿‡ CAS æ“ä½œè®¾ç½® arã€‚å¦‚æœ ar çš„å€¼ä¸º person çš„è¯ï¼Œåˆ™å°†å…¶è®¾ç½®ä¸º updatePersonã€‚å®ç°åŸç†ä¸ AtomicInteger ç±»ä¸­çš„ compareAndSet æ–¹æ³•ç›¸åŒã€‚è¿è¡Œä¸Šé¢çš„ä»£ç åçš„è¾“å‡ºç»“æœå¦‚ä¸‹\nDaisy 20 AtomicStampedReferenceç±»ä½¿ç”¨ç¤ºä¾‹\nimport java.util.concurrent.atomic.AtomicStampedReference; public class AtomicStampedReferenceDemo { public static void main(String[] args) { // å®ä¾‹åŒ–ã€å–å½“å‰å€¼å’Œ stamp å€¼ final Integer initialRef = 0, initialStamp = 0; final AtomicStampedReference\u0026lt;Integer\u0026gt; asr = new AtomicStampedReference\u0026lt;\u0026gt;(initialRef, initialStamp); System.out.println(\u0026#34;currentValue=\u0026#34; + asr.getReference() + \u0026#34;, currentStamp=\u0026#34; + asr.getStamp()); // compare and set final Integer newReference = 666, newStamp = 999; final boolean casResult = asr.compareAndSet(initialRef, newReference, initialStamp, newStamp); System.out.println(\u0026#34;currentValue=\u0026#34; + asr.getReference() + \u0026#34;, currentStamp=\u0026#34; + asr.getStamp() + \u0026#34;, casResult=\u0026#34; + casResult); // è·å–å½“å‰çš„å€¼å’Œå½“å‰çš„ stamp å€¼ int[] arr = new int[1]; final Integer currentValue = asr.get(arr); final int currentStamp = arr[0]; System.out.println(\u0026#34;currentValue=\u0026#34; + currentValue + \u0026#34;, currentStamp=\u0026#34; + currentStamp); // å•ç‹¬è®¾ç½® stamp å€¼ final boolean attemptStampResult = asr.attemptStamp(newReference, 88); System.out.println(\u0026#34;currentValue=\u0026#34; + asr.getReference() + \u0026#34;, currentStamp=\u0026#34; + asr.getStamp() + \u0026#34;, attemptStampResult=\u0026#34; + attemptStampResult); // é‡æ–°è®¾ç½®å½“å‰å€¼å’Œ stamp å€¼ asr.set(initialRef, initialStamp); System.out.println(\u0026#34;currentValue=\u0026#34; + asr.getReference() + \u0026#34;, currentStamp=\u0026#34; + asr.getStamp()); // [ä¸æ¨èä½¿ç”¨ï¼Œé™¤éææ¸…æ¥šæ³¨é‡Šçš„æ„æ€äº†] weak compare and set // å›°æƒ‘ï¼weakCompareAndSet è¿™ä¸ªæ–¹æ³•æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨ compareAndSet æ–¹æ³•ã€‚[ç‰ˆæœ¬: jdk-8u191] // ä½†æ˜¯æ³¨é‡Šä¸Šå†™ç€ \u0026#34;May fail spuriously and does not provide ordering guarantees, // so is only rarely an appropriate alternative to compareAndSet.\u0026#34; // todo æ„Ÿè§‰æœ‰å¯èƒ½æ˜¯ jvm é€šè¿‡æ–¹æ³•ååœ¨ native æ–¹æ³•é‡Œé¢åšäº†è½¬å‘ final boolean wCasResult = asr.weakCompareAndSet(initialRef, newReference, initialStamp, newStamp); System.out.println(\u0026#34;currentValue=\u0026#34; + asr.getReference() + \u0026#34;, currentStamp=\u0026#34; + asr.getStamp() + \u0026#34;, wCasResult=\u0026#34; + wCasResult); } } /* ç»“æœ currentValue=0, currentStamp=0 currentValue=666, currentStamp=999, casResult=true currentValue=666, currentStamp=999 currentValue=666, currentStamp=88, attemptStampResult=true currentValue=0, currentStamp=0 currentValue=666, currentStamp=999, wCasResult=true */ AtomicMarkableReference ç±»ä½¿ç”¨ç¤ºä¾‹\nimport java.util.concurrent.atomic.AtomicMarkableReference; public class AtomicMarkableReferenceDemo { public static void main(String[] args) { // å®ä¾‹åŒ–ã€å–å½“å‰å€¼å’Œ mark å€¼ final Boolean initialRef = null, initialMark = false; final AtomicMarkableReference\u0026lt;Boolean\u0026gt; amr = new AtomicMarkableReference\u0026lt;\u0026gt;(initialRef, initialMark); System.out.println(\u0026#34;currentValue=\u0026#34; + amr.getReference() + \u0026#34;, currentMark=\u0026#34; + amr.isMarked()); // compare and set final Boolean newReference1 = true, newMark1 = true; final boolean casResult = amr.compareAndSet(initialRef, newReference1, initialMark, newMark1); System.out.println(\u0026#34;currentValue=\u0026#34; + amr.getReference() + \u0026#34;, currentMark=\u0026#34; + amr.isMarked() + \u0026#34;, casResult=\u0026#34; + casResult); // è·å–å½“å‰çš„å€¼å’Œå½“å‰çš„ mark å€¼ boolean[] arr = new boolean[1]; final Boolean currentValue = amr.get(arr); final boolean currentMark = arr[0]; System.out.println(\u0026#34;currentValue=\u0026#34; + currentValue + \u0026#34;, currentMark=\u0026#34; + currentMark); // å•ç‹¬è®¾ç½® mark å€¼ final boolean attemptMarkResult = amr.attemptMark(newReference1, false); System.out.println(\u0026#34;currentValue=\u0026#34; + amr.getReference() + \u0026#34;, currentMark=\u0026#34; + amr.isMarked() + \u0026#34;, attemptMarkResult=\u0026#34; + attemptMarkResult); // é‡æ–°è®¾ç½®å½“å‰å€¼å’Œ mark å€¼ amr.set(initialRef, initialMark); System.out.println(\u0026#34;currentValue=\u0026#34; + amr.getReference() + \u0026#34;, currentMark=\u0026#34; + amr.isMarked()); // [ä¸æ¨èä½¿ç”¨ï¼Œé™¤éææ¸…æ¥šæ³¨é‡Šçš„æ„æ€äº†] weak compare and set // å›°æƒ‘ï¼weakCompareAndSet è¿™ä¸ªæ–¹æ³•æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨ compareAndSet æ–¹æ³•ã€‚[ç‰ˆæœ¬: jdk-8u191] // ä½†æ˜¯æ³¨é‡Šä¸Šå†™ç€ \u0026#34;May fail spuriously and does not provide ordering guarantees, // so is only rarely an appropriate alternative to compareAndSet.\u0026#34; // todo æ„Ÿè§‰æœ‰å¯èƒ½æ˜¯ jvm é€šè¿‡æ–¹æ³•ååœ¨ native æ–¹æ³•é‡Œé¢åšäº†è½¬å‘ final boolean wCasResult = amr.weakCompareAndSet(initialRef, newReference1, initialMark, newMark1); System.out.println(\u0026#34;currentValue=\u0026#34; + amr.getReference() + \u0026#34;, currentMark=\u0026#34; + amr.isMarked() + \u0026#34;, wCasResult=\u0026#34; + wCasResult); } } /* ç»“æœ currentValue=null, currentMark=false currentValue=true, currentMark=true, casResult=true currentValue=true, currentMark=true currentValue=true, currentMark=false, attemptMarkResult=true currentValue=null, currentMark=false currentValue=true, currentMark=true, wCasResult=true */ å¯¹è±¡çš„å±æ€§ä¿®æ”¹ç±»å‹åŸå­ç±» # å¯¹è±¡çš„å±æ€§ä¿®æ”¹ç±»å‹åŸå­ç±»ï¼Œç”¨æ¥åŸå­æ›´æ–°æŸä¸ªç±»é‡Œçš„æŸä¸ªå­—æ®µ\nåŒ…æ‹¬ï¼š AtomicIntegerFieldUpdater åŸå­æ›´æ–°æ•´å‹å­—æ®µçš„æ›´æ–°å™¨ï¼ŒAtomicLongFieldUpdater åŸå­æ›´æ–°é•¿æ•´å‹å­—æ®µçš„æ›´æ–°å™¨ï¼ŒAtomicReferenceFieldUpdater åŸå­æ›´æ–°å¼•ç”¨ç±»å‹é‡Œçš„å­—æ®µçš„æ›´æ–°å™¨\nåŸå­åœ°æ›´æ–°å¯¹è±¡å±æ€§éœ€è¦ä¸¤æ­¥éª¤ï¼š\nå¯¹è±¡çš„å±æ€§ä¿®æ”¹ç±»å‹åŸå­ç±»éƒ½æ˜¯æŠ½è±¡ç±»ï¼Œæ‰€ä»¥æ¯æ¬¡ä½¿ç”¨éƒ½å¿…é¡»ä½¿ç”¨é™æ€æ–¹æ³•newUpdater()åˆ›å»ºä¸€ä¸ªæ›´æ–°å™¨ï¼Œä¸”è®¾ç½®æƒ³è¦æ›´æ–°çš„ç±»å’Œå±æ€§ æ›´æ–°çš„å¯¹è±¡å±æ€§å¿…é¡»ä½¿ç”¨public volatileä¿®é¥°ç¬¦ ä¸‹é¢ä»¥AtomicIntegerFieldUpdaterä¸ºä¾‹å­æ¥ä»‹ç»\nimport java.util.concurrent.atomic.AtomicIntegerFieldUpdater; public class AtomicIntegerFieldUpdaterTest { public static void main(String[] args) { AtomicIntegerFieldUpdater\u0026lt;User\u0026gt; a = AtomicIntegerFieldUpdater.newUpdater(User.class, \u0026#34;age\u0026#34;); User user = new User(\u0026#34;Java\u0026#34;, 22); System.out.println(a.getAndIncrement(user));// 22 System.out.println(a.get(user));// 23 } } class User { private String name; public volatile int age; public User(String name, int age) { super(); this.name = name; this.age = age; } public String getName() { return name; } public void setName(String name) { this.name = name; } public int getAge() { return age; } public void setAge(int age) { this.age = age; } } /* ç»“æœ 22 33 */ "},{"id":130,"href":"/zh/docs/study/Review/java_guide/java/Concurrent/ly0308lyaqs-details/","title":"aqsè¯¦è§£","section":"å¹¶å‘","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nSemaphore [ËˆsemÉ™fÉ”Ë(r)]\nä½•ä¸º AQSï¼ŸAQS åŸç†äº†è§£å—ï¼Ÿ CountDownLatch å’Œ CyclicBarrier äº†è§£å—ï¼Ÿä¸¤è€…çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ç”¨è¿‡ Semaphore å—ï¼Ÿåº”ç”¨åœºæ™¯äº†è§£å—ï¼Ÿ \u0026hellip;\u0026hellip; AQSç®€å•ä»‹ç» # AQS,AbstractQueueSyschronizerï¼Œå³æŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨ï¼Œè¿™ä¸ªç±»åœ¨java.util.concurrent.locksåŒ…ä¸‹é¢\nAQSæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸»è¦ç”¨æ¥æ„å»ºé”å’ŒåŒæ­¥å™¨\npublic abstract class AbstractQueuedSynchronizer extends AbstractOwnableSynchronizer implements java.io.Serializable { } AQS ä¸ºæ„å»ºé”å’ŒåŒæ­¥å™¨æä¾›äº†ä¸€äº›é€šç”¨åŠŸèƒ½çš„å®ç°ï¼Œå› æ­¤ï¼Œä½¿ç”¨ AQS èƒ½ç®€å•ä¸”é«˜æ•ˆåœ°æ„é€ å‡ºåº”ç”¨å¹¿æ³›çš„å¤§é‡çš„åŒæ­¥å™¨ï¼Œæ¯”å¦‚æˆ‘ä»¬æåˆ°çš„ ReentrantLockï¼ŒSemaphoreï¼Œå…¶ä»–çš„è¯¸å¦‚ ReentrantReadWriteLockï¼ŒSynchronousQueueï¼ŒFutureTask(jdk1.7) ç­‰ç­‰çš†æ˜¯åŸºäº AQS çš„ã€‚\nAQSåŸç† # AQSæ ¸å¿ƒæ€æƒ³ # é¢è¯•ä¸æ˜¯èƒŒé¢˜ï¼Œå¤§å®¶ä¸€å®šè¦åŠ å…¥è‡ªå·±çš„æ€æƒ³ï¼Œå³ä½¿åŠ å…¥ä¸äº†è‡ªå·±çš„æ€æƒ³ä¹Ÿè¦ä¿è¯è‡ªå·±èƒ½å¤Ÿé€šä¿—çš„è®²å‡ºæ¥è€Œä¸æ˜¯èƒŒå‡ºæ¥\nAQS æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºï¼ˆAQSå†…éƒ¨ï¼‰ç©ºé—²ï¼Œåˆ™å°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆçš„å·¥ä½œçº¿ç¨‹ï¼Œå¹¶ä¸”å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ã€‚å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºè¢«å ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€å¥—çº¿ç¨‹é˜»å¡ç­‰å¾…ä»¥åŠè¢«å”¤é†’æ—¶é”åˆ†é…çš„æœºåˆ¶ï¼Œè¿™ä¸ªæœºåˆ¶ AQS æ˜¯ç”¨ CLH é˜Ÿåˆ—é”å®ç°çš„ï¼Œå³å°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚\nCLH(Craig,Landin and Hagersten)é˜Ÿåˆ—æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„åŒå‘é˜Ÿåˆ—ï¼ˆè™šæ‹Ÿçš„åŒå‘é˜Ÿåˆ—å³ä¸å­˜åœ¨é˜Ÿåˆ—å®ä¾‹ï¼Œä»…å­˜åœ¨ç»“ç‚¹ä¹‹é—´çš„å…³è”å…³ç³»ï¼‰ã€‚AQS æ˜¯å°†æ¯æ¡è¯·æ±‚å…±äº«èµ„æºçš„çº¿ç¨‹å°è£…æˆä¸€ä¸ª CLH é”é˜Ÿåˆ—çš„ä¸€ä¸ªç»“ç‚¹ï¼ˆNodeï¼‰æ¥å®ç°é”çš„åˆ†é…ã€‚\n[ æœç´¢äº†ä¸€ä¸‹ï¼ŒCLHå¥½åƒæ˜¯äººå ] åœ¨ CLH åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒä¿å­˜ç€çº¿ç¨‹çš„å¼•ç”¨ï¼ˆthreadï¼‰ã€ å½“å‰èŠ‚ç‚¹åœ¨é˜Ÿåˆ—ä¸­çš„çŠ¶æ€ï¼ˆwaitStatusï¼‰ã€å‰é©±èŠ‚ç‚¹ï¼ˆprevï¼‰ã€åç»§èŠ‚ç‚¹ï¼ˆnextï¼‰ã€‚\nCLHé˜Ÿåˆ—ç»“æ„\nAQSï¼ˆAbstractQueuedSynchronizedï¼‰åŸç†å›¾\nAQSä½¿ç”¨ä¸€ä¸ªintæˆå‘˜å˜é‡æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—æ¥è·å–èµ„æºçº¿ç¨‹çš„æ’é˜Ÿå·¥ä½œã€‚\nstate å˜é‡ç”± volatile ä¿®é¥°ï¼Œç”¨äºå±•ç¤ºå½“å‰ä¸´ç•Œèµ„æºçš„è·é”æƒ…å†µã€‚\nprivate volatile int state;//å…±äº«å˜é‡ï¼Œä½¿ç”¨volatileä¿®é¥°ä¿è¯çº¿ç¨‹å¯è§æ€§ çŠ¶æ€ä¿¡æ¯çš„æ“ä½œ\né€šè¿‡ protected ç±»å‹çš„getState()ã€setState()å’ŒcompareAndSetState() è¿›è¡Œæ“ä½œã€‚å¹¶ä¸”ï¼Œè¿™å‡ ä¸ªæ–¹æ³•éƒ½æ˜¯ final ä¿®é¥°çš„ï¼Œåœ¨å­ç±»ä¸­æ— æ³•è¢«é‡å†™ã€‚\n//è¿”å›åŒæ­¥çŠ¶æ€çš„å½“å‰å€¼ protected final int getState() { return state; } //è®¾ç½®åŒæ­¥çŠ¶æ€çš„å€¼ protected final void setState(int newState) { state = newState; } //åŸå­åœ°ï¼ˆCASæ“ä½œï¼‰å°†åŒæ­¥çŠ¶æ€å€¼è®¾ç½®ä¸ºç»™å®šå€¼updateå¦‚æœå½“å‰åŒæ­¥çŠ¶æ€çš„å€¼ç­‰äºexpectï¼ˆæœŸæœ›å€¼ï¼‰ protected final boolean compareAndSetState(int expect, int update) { return unsafe.compareAndSwapInt(this, stateOffset, expect, update); } ä»¥ ReentrantLock ä¸ºä¾‹ï¼Œstate åˆå§‹å€¼ä¸º 0ï¼Œè¡¨ç¤ºæœªé”å®šçŠ¶æ€ã€‚A çº¿ç¨‹ lock() æ—¶ï¼Œä¼šè°ƒç”¨ tryAcquire() ç‹¬å è¯¥é”å¹¶å°† state+1 ã€‚æ­¤åï¼Œå…¶ä»–çº¿ç¨‹å† tryAcquire() æ—¶å°±ä¼šå¤±è´¥ï¼Œç›´åˆ° A çº¿ç¨‹ unlock() åˆ° state=0ï¼ˆå³é‡Šæ”¾é”ï¼‰ä¸ºæ­¢ï¼Œå…¶å®ƒçº¿ç¨‹æ‰æœ‰æœºä¼šè·å–è¯¥é”ã€‚å½“ç„¶ï¼Œé‡Šæ”¾é”ä¹‹å‰ï¼ŒA çº¿ç¨‹è‡ªå·±æ˜¯å¯ä»¥é‡å¤è·å–æ­¤é”çš„ï¼ˆstate ä¼šç´¯åŠ ï¼‰ï¼Œè¿™å°±æ˜¯å¯é‡å…¥çš„æ¦‚å¿µã€‚ä½†è¦æ³¨æ„ï¼Œè·å–å¤šå°‘æ¬¡å°±è¦é‡Šæ”¾å¤šå°‘æ¬¡ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯ state æ˜¯èƒ½å›åˆ°é›¶æ€çš„ã€‚\nå†ä»¥ CountDownLatch ä»¥ä¾‹ï¼Œä»»åŠ¡åˆ†ä¸º N ä¸ªå­çº¿ç¨‹å»æ‰§è¡Œï¼Œstate ä¹Ÿåˆå§‹åŒ–ä¸º Nï¼ˆæ³¨æ„ N è¦ä¸çº¿ç¨‹ä¸ªæ•°ä¸€è‡´ï¼‰ã€‚è¿™ N ä¸ªå­çº¿ç¨‹æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œæ¯ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®ŒåcountDown() ä¸€æ¬¡ï¼Œstate ä¼š CAS(Compare and Swap) å‡ 1ã€‚ç­‰åˆ°æ‰€æœ‰å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œå(å³ state=0 )ï¼Œä¼š unpark() ä¸»è°ƒç”¨çº¿ç¨‹ï¼Œç„¶åä¸»è°ƒç”¨çº¿ç¨‹å°±ä¼šä» await() å‡½æ•°è¿”å›ï¼Œç»§ç»­åä½™åŠ¨ä½œã€‚\nâ€‹\nAQSèµ„æºå…±äº«æ–¹å¼ # åŒ…æ‹¬Exclusiveï¼ˆç‹¬å ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œï¼Œå¦‚ReentrantLockï¼‰å’ŒShareï¼ˆå…±äº«ï¼Œå¤šä¸ªçº¿ç¨‹å¯åŒæ—¶æ‰§è¡Œï¼Œå¦‚Semaphore/CountDownLatchï¼‰\nä»å¦ä¸€ä¸ªè§’åº¦è®²ï¼Œå°±æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ“ä½œstateå˜é‡ä»¥åŠæœ‰nä¸ªçº¿ç¨‹èƒ½æ“ä½œstateå˜é‡çš„åŒºåˆ«\nä¸€èˆ¬æ¥è¯´ï¼Œè‡ªå®šä¹‰åŒæ­¥å™¨çš„å…±äº«æ–¹å¼è¦ä¹ˆæ˜¯ç‹¬å ï¼Œè¦ä¹ˆæ˜¯å…±äº«ï¼Œä»–ä»¬ä¹Ÿåªéœ€å®ç°**tryAcquire-tryReleaseã€tryAcquireShared-tryReleaseSharedä¸­çš„ä¸€ç§å³å¯ã€‚ä½† AQS ä¹Ÿæ”¯æŒè‡ªå®šä¹‰åŒæ­¥å™¨åŒæ—¶å®ç°ç‹¬å å’Œå…±äº«ä¸¤ç§æ–¹å¼ï¼Œå¦‚ReentrantReadWriteLock**ã€‚\nè‡ªå®šä¹‰åŒæ­¥å™¨ # åŒæ­¥å™¨çš„è®¾è®¡æ˜¯åŸºäºæ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ï¼Œå¦‚æœéœ€è¦è‡ªå®šä¹‰åŒæ­¥å™¨ä¸€èˆ¬çš„æ–¹å¼æ˜¯è¿™æ ·ï¼ˆæ¨¡æ¿æ–¹æ³•æ¨¡å¼å¾ˆç»å…¸çš„ä¸€ä¸ªåº”ç”¨ï¼‰ï¼š\nä½¿ç”¨è€…ç»§æ‰¿ AbstractQueuedSynchronizer å¹¶é‡å†™æŒ‡å®šçš„æ–¹æ³•ã€‚ã€ä½¿ç”¨è€…ã€‘ å°† AQS ç»„åˆåœ¨è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶çš„å®ç°ä¸­ï¼Œå¹¶è°ƒç”¨å…¶æ¨¡æ¿æ–¹æ³•ï¼Œè€Œè¿™äº›æ¨¡æ¿æ–¹æ³•ä¼šè°ƒç”¨ä½¿ç”¨è€…é‡å†™çš„æ–¹æ³•ã€‚ã€AQSå†…éƒ¨ã€‘ è¿™å’Œæˆ‘ä»¬ä»¥å¾€é€šè¿‡å®ç°æ¥å£çš„æ–¹å¼æœ‰å¾ˆå¤§åŒºåˆ«ï¼Œè¿™æ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼å¾ˆç»å…¸çš„ä¸€ä¸ªè¿ç”¨ã€‚\n//ç‹¬å æ–¹å¼ã€‚å°è¯•è·å–èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚ protected boolean tryAcquire(int) //ç‹¬å æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚ protected boolean tryRelease(int) //å…±äº«æ–¹å¼ã€‚å°è¯•è·å–èµ„æºã€‚è´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0è¡¨ç¤ºæˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™å¯ç”¨èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œä¸”æœ‰å‰©ä½™èµ„æºã€‚ protected int tryAcquireShared(int) //å…±äº«æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è¿”å›falseã€‚ protected boolean tryReleaseShared(int) //è¯¥çº¿ç¨‹æ˜¯å¦æ­£åœ¨ç‹¬å èµ„æºã€‚åªæœ‰ç”¨åˆ°conditionæ‰éœ€è¦å»å®ç°å®ƒã€‚ protected boolean isHeldExclusively() ä»€ä¹ˆæ˜¯é’©å­æ–¹æ³•å‘¢ï¼Ÿ é’©å­æ–¹æ³•æ˜¯ä¸€ç§è¢«å£°æ˜åœ¨æŠ½è±¡ç±»ä¸­çš„æ–¹æ³•ï¼Œä¸€èˆ¬ä½¿ç”¨ protected å…³é”®å­—ä¿®é¥°ï¼Œå®ƒå¯ä»¥æ˜¯ç©ºæ–¹æ³•ï¼ˆç”±å­ç±»å®ç°ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯é»˜è®¤å®ç°çš„æ–¹æ³•ã€‚æ¨¡æ¿è®¾è®¡æ¨¡å¼é€šè¿‡é’©å­æ–¹æ³•æ§åˆ¶å›ºå®šæ­¥éª¤çš„å®ç°ã€‚\nç¯‡å¹…é—®é¢˜ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»æ¨¡æ¿æ–¹æ³•æ¨¡å¼äº†ï¼Œä¸å¤ªäº†è§£çš„å°ä¼™ä¼´å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼šç”¨ Java8 æ”¹é€ åçš„æ¨¡æ¿æ–¹æ³•æ¨¡å¼çœŸçš„æ˜¯ yyds!open in new windowã€‚\né™¤äº†ä¸Šé¢æåˆ°çš„é’©å­æ–¹æ³•ä¹‹å¤–ï¼ŒAQS ç±»ä¸­çš„å…¶ä»–æ–¹æ³•éƒ½æ˜¯ final ï¼Œæ‰€ä»¥æ— æ³•è¢«å…¶ä»–ç±»é‡å†™ã€‚\nå¸¸è§åŒæ­¥ç±» # Semaphore # Semaphoreï¼ˆä¿¡å·é‡ï¼‰å¯ä»¥æŒ‡å®šå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®æŸä¸ªèµ„æº\n/** * * @author Snailclimb * @date 2018å¹´9æœˆ30æ—¥ * @Description: éœ€è¦ä¸€æ¬¡æ€§æ‹¿ä¸€ä¸ªè®¸å¯çš„æƒ…å†µ */ public class SemaphoreExample1 { // è¯·æ±‚çš„æ•°é‡ private static final int threadCount = 550; public static void main(String[] args) throws InterruptedException { // åˆ›å»ºä¸€ä¸ªå…·æœ‰å›ºå®šçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± å¯¹è±¡ï¼ˆå¦‚æœè¿™é‡Œçº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡ç»™å¤ªå°‘çš„è¯ä½ ä¼šå‘ç°æ‰§è¡Œçš„å¾ˆæ…¢ï¼‰ ExecutorService threadPool = Executors.newFixedThreadPool(300); // ä¸€æ¬¡åªèƒ½å…è®¸æ‰§è¡Œçš„çº¿ç¨‹æ•°é‡ã€‚ final Semaphore semaphore = new Semaphore(20); for (int i = 0; i \u0026lt; threadCount; i++) { final int threadnum = i; threadPool.execute(() -\u0026gt; {// Lambda è¡¨è¾¾å¼çš„è¿ç”¨ try { //é€šè¡Œè¯å‘äº†20ä¸ªä¹‹åï¼Œå°±ä¸èƒ½å†å‘æ”¾äº† semaphore.acquire();// è·å–ä¸€ä¸ªè®¸å¯ï¼Œæ‰€ä»¥å¯è¿è¡Œçº¿ç¨‹æ•°é‡ä¸º20/1=20 test(threadnum); semaphore.release();// é‡Šæ”¾ä¸€ä¸ªè®¸å¯ } catch (InterruptedException e) { // TODO Auto-generated catch block e.printStackTrace(); } }); } threadPool.shutdown(); System.out.println(\u0026#34;finish\u0026#34;); } //æ‹¿äº†é€šè¡Œè¯ä¹‹åï¼Œå¤„ç†2sé’Ÿåæ‰é‡Šæ”¾ public static void test(int threadnum) throws InterruptedException { Thread.sleep(1000);// æ¨¡æ‹Ÿè¯·æ±‚çš„è€—æ—¶æ“ä½œ System.out.println(\u0026#34;threadnum:\u0026#34; + threadnum); Thread.sleep(1000);// æ¨¡æ‹Ÿè¯·æ±‚çš„è€—æ—¶æ“ä½œ } } //å¦ä¸€ä¸ªä¾‹å­\npublic static void main(String[] args) throws InterruptedException{ AtomicInteger atomicInteger=new AtomicInteger(); ExecutorService executorService = Executors.newCachedThreadPool(); Semaphore semaphore=new Semaphore(3); for(int i=0;i\u0026lt;8;i++) { int finalI = i; executorService.submit(()-\u0026gt;{ try { semaphore.acquire(); int i1 = atomicInteger.incrementAndGet(); log.info(\u0026#34;è·å–ä¸€ä¸ªé€šè¡Œè¯\u0026#34;+ finalI); TimeUnit.SECONDS.sleep(finalI+1); } catch (InterruptedException e) { e.printStackTrace(); }finally { log.info(\u0026#34;é€šè¡Œè¯\u0026#34;+ finalI +\u0026#34;é‡Šæ”¾å®Œæ¯•\u0026#34;); semaphore.release(); } }); } log.info(\u0026#34;å…¨éƒ¨è·å–å®Œæ¯•\u0026#34;); //è¿™ä¸ªæ–¹æ³•ä¸ä¼šå¯¼è‡´çº¿ç¨‹ç«‹å³ç»“æŸ executorService.shutdown(); log.info(\u0026#34;çº¿ç¨‹æ± shutdown\u0026#34;); } /* ç»“æœ 2022-12-01 14:21:31 ä¸‹åˆ [Thread: pool-1-thread-3] INFO:è·å–ä¸€ä¸ªé€šè¡Œè¯2 2022-12-01 14:21:31 ä¸‹åˆ [Thread: main] INFO:å…¨éƒ¨è·å–å®Œæ¯• 2022-12-01 14:21:31 ä¸‹åˆ [Thread: main] INFO:çº¿ç¨‹æ± shutdown 2022-12-01 14:21:31 ä¸‹åˆ [Thread: pool-1-thread-2] INFO:è·å–ä¸€ä¸ªé€šè¡Œè¯1 2022-12-01 14:21:31 ä¸‹åˆ [Thread: pool-1-thread-1] INFO:è·å–ä¸€ä¸ªé€šè¡Œè¯0 2022-12-01 14:21:32 ä¸‹åˆ [Thread: pool-1-thread-1] INFO:é€šè¡Œè¯0é‡Šæ”¾å®Œæ¯• 2022-12-01 14:21:32 ä¸‹åˆ [Thread: pool-1-thread-4] INFO:è·å–ä¸€ä¸ªé€šè¡Œè¯3 2022-12-01 14:21:33 ä¸‹åˆ [Thread: pool-1-thread-2] INFO:é€šè¡Œè¯1é‡Šæ”¾å®Œæ¯• 2022-12-01 14:21:33 ä¸‹åˆ [Thread: pool-1-thread-5] INFO:è·å–ä¸€ä¸ªé€šè¡Œè¯4 2022-12-01 14:21:34 ä¸‹åˆ [Thread: pool-1-thread-3] INFO:é€šè¡Œè¯2é‡Šæ”¾å®Œæ¯• 2022-12-01 14:21:34 ä¸‹åˆ [Thread: pool-1-thread-6] INFO:è·å–ä¸€ä¸ªé€šè¡Œè¯5 2022-12-01 14:21:36 ä¸‹åˆ [Thread: pool-1-thread-4] INFO:é€šè¡Œè¯3é‡Šæ”¾å®Œæ¯• 2022-12-01 14:21:36 ä¸‹åˆ [Thread: pool-1-thread-7] INFO:è·å–ä¸€ä¸ªé€šè¡Œè¯6 2022-12-01 14:21:38 ä¸‹åˆ [Thread: pool-1-thread-5] INFO:é€šè¡Œè¯4é‡Šæ”¾å®Œæ¯• 2022-12-01 14:21:38 ä¸‹åˆ [Thread: pool-1-thread-8] INFO:è·å–ä¸€ä¸ªé€šè¡Œè¯7 2022-12-01 14:21:40 ä¸‹åˆ [Thread: pool-1-thread-6] INFO:é€šè¡Œè¯5é‡Šæ”¾å®Œæ¯• 2022-12-01 14:21:43 ä¸‹åˆ [Thread: pool-1-thread-7] INFO:é€šè¡Œè¯6é‡Šæ”¾å®Œæ¯• 2022-12-01 14:21:46 ä¸‹åˆ [Thread: pool-1-thread-8] INFO:é€šè¡Œè¯7é‡Šæ”¾å®Œæ¯• Process finished with exit code 0 å¦‚ä¸Šæ‰€ç¤ºï¼Œå…ˆæ˜¯è·å–äº†210ï¼Œä¹‹åé‡Šæ”¾ä¸€ä¸ªè·å–ä¸€ä¸ª(æœ€å¤šè·å–3ä¸ª)ï¼Œ 3+n*2 =10 ï¼Œä¹‹åé™†ç»­é‡Šæ”¾0è·å–3ï¼Œé‡Šæ”¾1è·å–4ï¼Œé‡Šæ”¾2è·å–5 ä¹‹å é‡Šæ”¾3è·å–6ï¼Œé‡Šæ”¾4è·å–7ï¼› è¿™æ˜¯è¿˜æœ‰5,7,6æ‹¿ç€é€šè¡Œè¯ ä¹‹åéšæœºå°†5ï¼Œ7ï¼Œ6é‡Šæ”¾æ‰å³å¯ã€‚ */ //å¦‚ä¸Šï¼Œshutdownä¸ä¼šç«‹å³åœæ­¢ï¼Œè€Œæ˜¯ï¼š\nçº¿ç¨‹æ± shutdownä¹‹åä¸å†æ¥æ”¶æ–°ä»»åŠ¡\nsutdownåªæ˜¯å°†çº¿ç¨‹æ± çš„çŠ¶æ€è®¾ç½®ä¸ºSHUTWDOWNçŠ¶æ€ï¼Œæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ä¼šç»§ç»­æ‰§è¡Œä¸‹å»ï¼Œæ²¡æœ‰è¢«æ‰§è¡Œçš„åˆ™ä¸­æ–­ã€‚è€ŒshutdownNowåˆ™æ˜¯å°†çº¿ç¨‹æ± çš„çŠ¶æ€è®¾ç½®ä¸ºSTOPï¼Œæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡åˆ™è¢«åœæ­¢ï¼Œæ²¡è¢«æ‰§è¡Œä»»åŠ¡çš„åˆ™è¿”å›ã€‚å¦‚æœæ˜¯shutdownNow,åˆ™ä¼šæŠ¥è¿™ä¸ªé—®é¢˜\njava.lang.InterruptedException: sleep interrupted at java.lang.Thread.sleep(Native Method) at java.lang.Thread.sleep(Thread.java:340) at java.util.concurrent.TimeUnit.sleep(TimeUnit.java:386) at com.ly.SemaphoreExample2.lambda$main$0(SemaphoreExample2.java:45) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) at java.util.concurrent.FutureTask.run(FutureTask.java:266) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.Thread.run(Thread.java:748) è§£é‡Šæœ€ä¸Šé¢çš„ä¾‹å­ï¼š\næ‰§è¡Œacquire()æ–¹æ³•ä¼šå¯¼è‡´é˜»å¡ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªè®¸å¯è¯å¯ä»¥è·å¾—ç„¶åæ‹¿èµ°ä¸€ä¸ªè®¸å¯è¯ æ¯ä¸ªrelease()æ–¹æ³•å¢åŠ ä¸€ä¸ªè®¸å¯è¯ï¼Œè¿™**å¯èƒ½ä¼šé‡Šæ”¾ä¸€ä¸ªé˜»å¡çš„acquire()**æ–¹æ³• Semaphoreåªæ˜¯ç»´æŒäº†ä¸€ä¸ªå¯ä»¥è·å¾—è®¸å¯è¯çš„æ•°é‡ï¼Œæ²¡æœ‰å®é™…çš„è®¸å¯è¯è¿™ä¸ªå¯¹è±¡ Semaphoreç»å¸¸ç”¨äºé™åˆ¶è·å–æŸç§èµ„æºçš„çº¿ç¨‹æ•°é‡ å¯ä»¥ä¸€æ¬¡æ€§è·å–æˆ–é‡Šæ”¾å¤šä¸ªè®¸å¯ï¼Œä¸è¿‡æ²¡å¿…è¦\nsemaphore.acquire(5);// è·å–5ä¸ªè®¸å¯ï¼Œæ‰€ä»¥å¯è¿è¡Œçº¿ç¨‹æ•°é‡ä¸º20/5=4 test(threadnum); semaphore.release(5);// é‡Šæ”¾5ä¸ªè®¸å¯ é™¤äº† acquire() æ–¹æ³•ä¹‹å¤–ï¼Œå¦ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„ä¸ä¹‹å¯¹åº”çš„æ–¹æ³•æ˜¯ tryAcquire() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¦‚æœè·å–ä¸åˆ°è®¸å¯å°±ç«‹å³è¿”å› false\nä»‹ç»\nsynchronized å’Œ ReentrantLock éƒ½æ˜¯ä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®æŸä¸ªèµ„æºï¼Œè€ŒSemaphore(ä¿¡å·é‡)å¯ä»¥ç”¨æ¥æ§åˆ¶åŒæ—¶è®¿é—®ç‰¹å®šèµ„æºçš„çº¿ç¨‹æ•°é‡ã€‚\nSemaphore çš„ä½¿ç”¨ç®€å•ï¼Œæˆ‘ä»¬è¿™é‡Œå‡è®¾æœ‰ N(N\u0026gt;5) ä¸ªçº¿ç¨‹æ¥è·å– Semaphore ä¸­çš„å…±äº«èµ„æºï¼Œä¸‹é¢çš„ä»£ç è¡¨ç¤ºåŒä¸€æ—¶åˆ» N ä¸ªçº¿ç¨‹ä¸­åªæœ‰ 5 ä¸ªçº¿ç¨‹èƒ½è·å–åˆ°å…±äº«èµ„æºï¼Œå…¶ä»–çº¿ç¨‹éƒ½ä¼šé˜»å¡ï¼Œåªæœ‰è·å–åˆ°å…±äº«èµ„æºçš„çº¿ç¨‹æ‰èƒ½æ‰§è¡Œã€‚ç­‰åˆ°æœ‰çº¿ç¨‹é‡Šæ”¾äº†å…±äº«èµ„æºï¼Œå…¶ä»–é˜»å¡çš„çº¿ç¨‹æ‰èƒ½è·å–åˆ°ã€‚\n// åˆå§‹å…±äº«èµ„æºæ•°é‡ final Semaphore semaphore = new Semaphore(5); // è·å–1ä¸ªè®¸å¯ semaphore.acquire(); // é‡Šæ”¾1ä¸ªè®¸å¯ semaphore.release(); /* å½“åˆå§‹çš„èµ„æºä¸ªæ•°ä¸º 1 çš„æ—¶å€™ï¼ŒSemaphore é€€åŒ–ä¸ºæ’ä»–é”ã€‚ */ Semaphoreæœ‰ä¸¤ç§æ¨¡å¼ï¼Œå…¬å¹³æ¨¡å¼å’Œéå…¬å¹³æ¨¡å¼\nå…¬å¹³æ¨¡å¼ï¼šè°ƒç”¨acquire()æ–¹æ³•çš„é¡ºåºï¼Œå°±æ˜¯è·å–è®¸å¯è¯çš„é¡ºåºï¼Œéµå¾ªFIFO éå…¬å¹³æ¨¡å¼ï¼šæŠ¢å å¼çš„ ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼Œå¿…é¡»æä¾›è®¸å¯æ•°é‡ï¼Œç¬¬äºŒä¸ªæ„é€ æ–¹æ³•å¯ä»¥æŒ‡å®šæ˜¯å…¬å¹³æ¨¡å¼è¿˜æ˜¯éå…¬å¹³æ¨¡å¼ï¼Œé»˜è®¤éå…¬å¹³æ¨¡å¼\npublic Semaphore(int permits) { sync = new NonfairSync(permits); } public Semaphore(int permits, boolean fair) { sync = fair ? new FairSync(permits) : new NonfairSync(permits); } Semaphore é€šå¸¸ç”¨äºé‚£äº›èµ„æºæœ‰æ˜ç¡®è®¿é—®æ•°é‡é™åˆ¶çš„åœºæ™¯æ¯”å¦‚é™æµï¼ˆä»…é™äºå•æœºæ¨¡å¼ï¼Œå®é™…é¡¹ç›®ä¸­æ¨èä½¿ç”¨ Redis +Lua æ¥åšé™æµï¼‰\nåŸç†\nSemaphore æ˜¯å…±äº«é”çš„ä¸€ç§å®ç°ï¼Œå®ƒé»˜è®¤æ„é€  AQS çš„ state å€¼ä¸º permitsï¼Œä½ å¯ä»¥å°† permits çš„å€¼ç†è§£ä¸ºè®¸å¯è¯çš„æ•°é‡ï¼Œåªæœ‰æ‹¿åˆ°è®¸å¯è¯çš„çº¿ç¨‹æ‰èƒ½æ‰§è¡Œã€‚\nè°ƒç”¨semaphore.acquire() ï¼Œçº¿ç¨‹å°è¯•è·å–è®¸å¯è¯ï¼Œå¦‚æœ state \u0026gt;= 0 çš„è¯ï¼Œåˆ™è¡¨ç¤ºå¯ä»¥è·å–æˆåŠŸã€‚å¦‚æœè·å–æˆåŠŸçš„è¯ï¼Œä½¿ç”¨ CAS æ“ä½œå»ä¿®æ”¹ state çš„å€¼ state=state-1ã€‚å¦‚æœ state\u0026lt;0 çš„è¯ï¼Œåˆ™è¡¨ç¤ºè®¸å¯è¯æ•°é‡ä¸è¶³ã€‚æ­¤æ—¶ä¼šåˆ›å»ºä¸€ä¸ª Node èŠ‚ç‚¹åŠ å…¥é˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‚èµ·å½“å‰çº¿ç¨‹ã€‚\n/** * è·å–1ä¸ªè®¸å¯è¯ */ public void acquire() throws InterruptedException { sync.acquireSharedInterruptibly(1); } /** * å…±äº«æ¨¡å¼ä¸‹è·å–è®¸å¯è¯ï¼Œè·å–æˆåŠŸåˆ™è¿”å›ï¼Œå¤±è´¥åˆ™åŠ å…¥é˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‚èµ·çº¿ç¨‹ */ public final void acquireSharedInterruptibly(int arg) throws InterruptedException { if (Thread.interrupted()) throw new InterruptedException(); // å°è¯•è·å–è®¸å¯è¯ï¼Œargä¸ºè·å–è®¸å¯è¯ä¸ªæ•°ï¼Œå½“å¯ç”¨è®¸å¯è¯æ•°å‡å½“å‰è·å–çš„è®¸å¯è¯æ•°ç»“æœå°äº0,åˆ™åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹åŠ å…¥é˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‚èµ·å½“å‰çº¿ç¨‹ã€‚ if (tryAcquireShared(arg) \u0026lt; 0) doAcquireSharedInterruptibly(arg); } è°ƒç”¨semaphore.release(); ï¼Œçº¿ç¨‹å°è¯•é‡Šæ”¾è®¸å¯è¯ï¼Œå¹¶ä½¿ç”¨ CAS æ“ä½œå»ä¿®æ”¹ state çš„å€¼ state=state+1ã€‚é‡Šæ”¾è®¸å¯è¯æˆåŠŸä¹‹åï¼ŒåŒæ—¶ä¼šå”¤é†’åŒæ­¥é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ã€‚è¢«å”¤é†’çš„çº¿ç¨‹ä¼šé‡æ–°å°è¯•å»ä¿®æ”¹ state çš„å€¼ state=state-1 ï¼Œå¦‚æœ state\u0026gt;=0 åˆ™è·å–ä»¤ç‰ŒæˆåŠŸï¼Œå¦åˆ™é‡æ–°è¿›å…¥é˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‚èµ·çº¿ç¨‹ã€‚\n// é‡Šæ”¾ä¸€ä¸ªè®¸å¯è¯ public void release() { sync.releaseShared(1); } // é‡Šæ”¾å…±äº«é”ï¼ŒåŒæ—¶ä¼šå”¤é†’åŒæ­¥é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ã€‚ public final boolean releaseShared(int arg) { //é‡Šæ”¾å…±äº«é” if (tryReleaseShared(arg)) { //å”¤é†’åŒæ­¥é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ doReleaseShared(); return true; } return false; } è¡¥å……\nSemaphore ä¸ CountDownLatch ä¸€æ ·ï¼Œä¹Ÿæ˜¯å…±äº«é”çš„ä¸€ç§å®ç°ã€‚å®ƒé»˜è®¤æ„é€  AQS çš„ state ä¸º permitsã€‚å½“æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ•°é‡è¶…å‡º permitsï¼Œé‚£ä¹ˆå¤šä½™çš„çº¿ç¨‹å°†ä¼šè¢«æ”¾å…¥é˜»å¡é˜Ÿåˆ— Park,å¹¶è‡ªæ—‹åˆ¤æ–­ state æ˜¯å¦å¤§äº 0ã€‚åªæœ‰å½“ state å¤§äº 0 çš„æ—¶å€™ï¼Œé˜»å¡çš„çº¿ç¨‹æ‰èƒ½ç»§ç»­æ‰§è¡Œ,æ­¤æ—¶å…ˆå‰æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œ release() æ–¹æ³•ï¼Œrelease() æ–¹æ³•ä½¿å¾— state çš„å˜é‡ä¼šåŠ  1ï¼Œé‚£ä¹ˆè‡ªæ—‹çš„çº¿ç¨‹ä¾¿ä¼šåˆ¤æ–­æˆåŠŸã€‚ å¦‚æ­¤ï¼Œæ¯æ¬¡åªæœ‰æœ€å¤šä¸è¶…è¿‡ permits æ•°é‡çš„çº¿ç¨‹èƒ½è‡ªæ—‹æˆåŠŸï¼Œä¾¿é™åˆ¶äº†æ‰§è¡Œä»»åŠ¡çº¿ç¨‹çš„æ•°é‡ã€‚\nCountDownLatch(å€’è®¡æ—¶) # CountDown å€’è®¡æ—¶å™¨ï¼›Latch é—¨é—© å…è®¸countä¸ªçº¿ç¨‹é˜»å¡åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œç›´è‡³æ‰€æœ‰çº¿ç¨‹çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯• CountDownLatch æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œè®¡æ•°å™¨çš„å€¼åªèƒ½åœ¨æ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–ä¸€æ¬¡ï¼Œä¹‹åæ²¡æœ‰ä»»ä½•æœºåˆ¶å†æ¬¡å¯¹å…¶è®¾ç½®å€¼ï¼Œå½“ CountDownLatch ä½¿ç”¨å®Œæ¯•åï¼Œå®ƒä¸èƒ½å†æ¬¡è¢«ä½¿ç”¨ã€‚ åŸç† CountDownLatchæ˜¯å…±äº«é”çš„ä¸€ç§å®ç°ï¼ˆæˆ‘çš„ç†è§£æ˜¯ æœ¬è´¨ä¸Šæ˜¯è¯´AQSå†…éƒ¨çš„stateå˜é‡å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹ï¼Œæ‰€ä»¥æ˜¯\u0026quot;å…±äº«\u0026quot;ï¼‰ï¼Œé»˜è®¤æ„é€ AQSçš„stateå€¼ä¸ºcountã€‚å½“çº¿ç¨‹ä½¿ç”¨countDown()æ–¹æ³•æ—¶ï¼Œå…¶å®æ˜¯ä½¿ç”¨äº†tryReleaseSharedæ–¹æ³•ä»¥CASæ“ä½œæ¥å‡å°‘stateï¼Œç›´è‡³stateä¸º0 å½“è°ƒç”¨await()æ–¹æ³•æ—¶ï¼Œå¦‚æœstateä¸ä¸º0ï¼Œé‚£å°±è¯æ˜ä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæ¯•,await()æ–¹æ³•ä¼šä¸€ç›´é˜»å¡ï¼Œå³await()æ–¹æ³•ä¹‹åçš„è¯­å¥ä¸ä¼šè¢«æ‰§è¡Œã€‚ä¹‹åCountDownLatchä¼šè‡ªæ—‹CASåˆ¤æ–­state==0ï¼Œå¦‚æœstate == 0å°±ä¼šé‡Šæ”¾æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ï¼Œawait()æ–¹æ³•ä¹‹åçš„è¯­å¥å¾—åˆ°æ‰§è¡Œ CountDownLatchçš„ä¸¤ç§å…¸å‹ç”¨æ³• # å…¶å®å°±æ˜¯nä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–mä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•åå”¤é†’ï¼Œåªæœ‰nä¸º1æ—¶æ˜¯ç¬¬ä¸€ç§æƒ…å†µï¼Œåªæœ‰mä¸º1æ—¶æ˜¯ç¬¬äºŒç§æƒ…å†µ\næŸçº¿ç¨‹åœ¨å¼€å§‹è¿è¡Œå‰ç­‰å¾…nä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•\nå°† CountDownLatch çš„è®¡æ•°å™¨åˆå§‹åŒ–ä¸º n ï¼ˆnew CountDownLatch(n)ï¼‰ï¼Œæ¯å½“ä¸€ä¸ªä»»åŠ¡çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå°±å°†è®¡æ•°å™¨å‡ 1 ï¼ˆcountdownlatch.countDown()ï¼‰ï¼Œå½“è®¡æ•°å™¨çš„å€¼å˜ä¸º 0 æ—¶ï¼Œåœ¨ CountDownLatch ä¸Š await() çš„çº¿ç¨‹å°±ä¼šè¢«å”¤é†’ã€‚ä¸€ä¸ªå…¸å‹åº”ç”¨åœºæ™¯å°±æ˜¯å¯åŠ¨ä¸€ä¸ªæœåŠ¡æ—¶ï¼Œä¸»çº¿ç¨‹éœ€è¦ç­‰å¾…å¤šä¸ªç»„ä»¶åŠ è½½å®Œæ¯•ï¼Œä¹‹åå†ç»§ç»­æ‰§è¡Œã€‚\nå®ç°å¤šä¸ªçº¿ç¨‹å¼€å§‹æ‰§è¡Œä»»åŠ¡çš„æœ€å¤§å¹¶è¡Œæ€§\næ³¨æ„æ˜¯å¹¶è¡Œæ€§ï¼Œä¸æ˜¯å¹¶å‘ï¼Œå¼ºè°ƒçš„æ˜¯å¤šä¸ªçº¿ç¨‹åœ¨æŸä¸€æ—¶åˆ»åŒæ—¶å¼€å§‹æ‰§è¡Œã€‚ç±»ä¼¼äºèµ›è·‘ï¼Œå°†å¤šä¸ªçº¿ç¨‹æ”¾åˆ°èµ·ç‚¹ï¼Œç­‰å¾…å‘ä»¤æªå“ï¼Œç„¶ååŒæ—¶å¼€è·‘ã€‚\nåšæ³•æ˜¯åˆå§‹åŒ–ä¸€ä¸ªå…±äº«çš„ CountDownLatch å¯¹è±¡ï¼Œå°†å…¶è®¡æ•°å™¨åˆå§‹åŒ–ä¸º 1 ï¼ˆnew CountDownLatch(1)ï¼‰ï¼Œå¤šä¸ªçº¿ç¨‹åœ¨å¼€å§‹æ‰§è¡Œä»»åŠ¡å‰é¦–å…ˆ coundownlatch.await()ï¼Œå½“ä¸»çº¿ç¨‹è°ƒç”¨ countDown() æ—¶ï¼Œè®¡æ•°å™¨å˜ä¸º 0ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è¢«å”¤é†’ã€‚\nCountDownLatchä½¿ç”¨ç¤ºä¾‹\n300ä¸ªçº¿ç¨‹(è¯´çš„æ˜¯çº¿ç¨‹æ± æœ‰300ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼Œè€Œä¸æ˜¯CountDown300æ¬¡)ï¼Œ550ä¸ªè¯·æ±‚ï¼ˆåŠcount = 550ï¼‰ã€‚å¯åŠ¨çº¿ç¨‹åï¼Œä¸»çº¿ç¨‹é˜»å¡ã€‚å½“æ‰€æœ‰è¯·æ±‚éƒ½countDownï¼Œä¸»çº¿ç¨‹æ¢å¤è¿è¡Œ\n/** * * @author SnailClimb * @date 2018å¹´10æœˆ1æ—¥ * @Description: CountDownLatch ä½¿ç”¨æ–¹æ³•ç¤ºä¾‹ */ public class CountDownLatchExample1 { // è¯·æ±‚çš„æ•°é‡ private static final int threadCount = 550; public static void main(String[] args) throws InterruptedException { // åˆ›å»ºä¸€ä¸ªå…·æœ‰å›ºå®šçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± å¯¹è±¡ï¼ˆå¦‚æœè¿™é‡Œçº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡ç»™å¤ªå°‘çš„è¯ä½ ä¼šå‘ç°æ‰§è¡Œçš„å¾ˆæ…¢ï¼‰ ExecutorService threadPool = Executors.newFixedThreadPool(300); final CountDownLatch countDownLatch = new CountDownLatch(threadCount); for (int i = 0; i \u0026lt; threadCount; i++) { final int threadnum = i; threadPool.execute(() -\u0026gt; {// Lambda è¡¨è¾¾å¼çš„è¿ç”¨ try { test(threadnum); } catch (InterruptedException e) { // TODO Auto-generated catch block e.printStackTrace(); } finally { countDownLatch.countDown();// è¡¨ç¤ºä¸€ä¸ªè¯·æ±‚å·²ç»è¢«å®Œæˆ } }); } countDownLatch.await(); threadPool.shutdown(); System.out.println(\u0026#34;finish\u0026#34;); } public static void test(int threadnum) throws InterruptedException { Thread.sleep(1000);// æ¨¡æ‹Ÿè¯·æ±‚çš„è€—æ—¶æ“ä½œ System.out.println(\u0026#34;threadnum:\u0026#34; + threadnum); Thread.sleep(1000);// æ¨¡æ‹Ÿè¯·æ±‚çš„è€—æ—¶æ“ä½œ } } ä¸CountDownLatchçš„ç¬¬ä¸€æ¬¡äº¤äº’æ˜¯ä¸»çº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹\nä¸»çº¿ç¨‹å¿…é¡»åœ¨å¯åŠ¨å…¶ä»–çº¿ç¨‹åç«‹å³è°ƒç”¨CountDownLatch.await()æ–¹æ³•ï¼Œè¿™æ ·ä¸»çº¿ç¨‹çš„æ“ä½œå°±ä¼šåœ¨è¿™ä¸ªæ–¹æ³•é˜»å¡ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹å®Œæˆå„è‡ªä»»åŠ¡\nå…¶ä»– N ä¸ªçº¿ç¨‹å¿…é¡»å¼•ç”¨é—­é”å¯¹è±¡ï¼ˆè¯´çš„æ˜¯CountDownLoatchå¯¹è±¡ï¼‰ï¼Œå› ä¸ºä»–ä»¬éœ€è¦é€šçŸ¥ CountDownLatch å¯¹è±¡ï¼Œä»–ä»¬å·²ç»å®Œæˆäº†å„è‡ªçš„ä»»åŠ¡ã€‚è¿™ç§é€šçŸ¥æœºåˆ¶æ˜¯é€šè¿‡ CountDownLatch.countDown()æ–¹æ³•æ¥å®Œæˆçš„ï¼›æ¯è°ƒç”¨ä¸€æ¬¡è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–çš„ count å€¼å°±å‡ 1ã€‚æ‰€ä»¥å½“ N ä¸ªçº¿ç¨‹éƒ½è°ƒ ç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼Œcount çš„å€¼ç­‰äº 0ï¼Œç„¶åä¸»çº¿ç¨‹å°±èƒ½é€šè¿‡ await()æ–¹æ³•ï¼Œæ¢å¤æ‰§è¡Œè‡ªå·±çš„ä»»åŠ¡ã€‚\nCountDownLatch çš„ await() æ–¹æ³•ä½¿ç”¨ä¸å½“å¾ˆå®¹æ˜“äº§ç”Ÿæ­»é”ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸Šé¢ä»£ç ä¸­çš„ for å¾ªç¯æ”¹ä¸ºï¼š\nfor (int i = 0; i \u0026lt; threadCount-1; i++) { ....... } //è¿™æ ·å°±å¯¼è‡´ count çš„å€¼æ²¡åŠæ³•ç­‰äº 0ï¼ˆæœ€ç»ˆä¸º1ï¼‰ï¼Œç„¶åå°±ä¼šå¯¼è‡´ä¸€ç›´ç­‰å¾…ã€‚ CountDownLatch çš„ä¸è¶³ # CountDownLatch æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œè®¡æ•°å™¨çš„å€¼åªèƒ½åœ¨æ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–ä¸€æ¬¡ï¼Œä¹‹åæ²¡æœ‰ä»»ä½•æœºåˆ¶å†æ¬¡å¯¹å…¶è®¾ç½®å€¼ï¼Œå½“ CountDownLatch ä½¿ç”¨å®Œæ¯•åï¼Œå®ƒä¸èƒ½å†æ¬¡è¢«ä½¿ç”¨ã€‚\nCountDownLatch ç›¸å¸¸è§é¢è¯•é¢˜ï¼ˆæ”¹ç‰ˆåæ²¡äº†ï¼‰ # CountDownLatch æ€ä¹ˆç”¨ï¼Ÿåº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ CountDownLatch å’Œ CyclicBarrier çš„ä¸åŒä¹‹å¤„ï¼Ÿ CountDownLatch ç±»ä¸­ä¸»è¦çš„æ–¹æ³•ï¼Ÿ CyclicBarrier # CyclicBarrierå’ŒCountDownLatchç±»ä¼¼ï¼Œå¯ä»¥å®ç°çº¿ç¨‹é—´çš„æŠ€æœ¯ç­‰å¾…ï¼Œä¸»è¦åº”ç”¨åœºæ™¯å’ŒCountDownLatchç±»ä¼¼ï¼Œä½†æ›´å¤æ‚å¼ºå¤§ ä¸»è¦åº”ç”¨åœºæ™¯å’Œ CountDownLatch ç±»ä¼¼ã€‚\nCountDownLatchåŸºäºAQSï¼Œè€ŒCycliBarrieråŸºäºReentrantLockï¼ˆReentrantLockå±äºAQSåŒæ­¥å™¨ï¼‰å’ŒCondition\nCyclicBarrier çš„å­—é¢æ„æ€æ˜¯å¯å¾ªç¯ä½¿ç”¨ï¼ˆCyclicï¼‰çš„å±éšœï¼ˆBarrierï¼‰ã€‚å®ƒè¦åšçš„äº‹æƒ…æ˜¯ï¼šè®©ä¸€ç»„çº¿ç¨‹(ä¸­çš„ä¸€ä¸ª)åˆ°è¾¾ä¸€ä¸ªå±éšœï¼ˆä¹Ÿå¯ä»¥å«åŒæ­¥ç‚¹ï¼‰æ—¶è¢«é˜»å¡ï¼Œç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœæ—¶ï¼Œå±éšœæ‰ä¼šå¼€é—¨ï¼Œæ‰€æœ‰è¢«å±éšœæ‹¦æˆªçš„çº¿ç¨‹æ‰ä¼šç»§ç»­å¹²æ´»ã€‚\nåŸç† # CyclicBarrier å†…éƒ¨é€šè¿‡ä¸€ä¸ª count å˜é‡ä½œä¸ºè®¡æ•°å™¨ï¼Œcount çš„åˆå§‹å€¼ä¸º parties å±æ€§çš„åˆå§‹åŒ–å€¼ï¼Œæ¯å½“ä¸€ä¸ªçº¿ç¨‹åˆ°äº†æ …æ è¿™é‡Œäº†ï¼Œé‚£ä¹ˆå°±å°†è®¡æ•°å™¨å‡ 1ã€‚å¦‚æœ count å€¼ä¸º 0 äº†ï¼Œè¡¨ç¤ºè¿™æ˜¯è¿™ä¸€ä»£æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾æ …æ ï¼Œå°±å°è¯•æ‰§è¡Œæˆ‘ä»¬æ„é€ æ–¹æ³•ä¸­è¾“å…¥çš„ä»»åŠ¡ï¼ˆä¹‹åå†é‡Šæ”¾æ‰€æœ‰é˜»å¡çš„çº¿ç¨‹ï¼‰ã€‚\n//æ¯æ¬¡æ‹¦æˆªçš„çº¿ç¨‹æ•° private final int parties; //è®¡æ•°å™¨ private int count; CyclicBarrier é»˜è®¤çš„æ„é€ æ–¹æ³•æ˜¯ CyclicBarrier(int parties)ï¼Œå…¶å‚æ•°è¡¨ç¤ºå±éšœæ‹¦æˆªçš„çº¿ç¨‹æ•°é‡ï¼Œæ¯ä¸ªçº¿ç¨‹è°ƒç”¨ await() æ–¹æ³•å‘Šè¯‰ CyclicBarrier æˆ‘å·²ç»åˆ°è¾¾äº†å±éšœï¼Œç„¶åå½“å‰çº¿ç¨‹è¢«é˜»å¡ã€‚\npublic CyclicBarrier(int parties) { this(parties, null); } public CyclicBarrier(int parties, Runnable barrierAction) { if (parties \u0026lt;= 0) throw new IllegalArgumentException(); this.parties = parties; this.count = parties; this.barrierCommand = barrierAction; } å…ˆçœ‹ä¸€ä¸ªä¾‹å­\n/** * * @author Snailclimb * @date 2018å¹´10æœˆ1æ—¥ * @Description: æµ‹è¯• CyclicBarrier ç±»ä¸­å¸¦å‚æ•°çš„ await() æ–¹æ³• */ public class CyclicBarrierExample2 { // è¯·æ±‚çš„æ•°é‡ private static final int threadCount = 550; // éœ€è¦åŒæ­¥çš„çº¿ç¨‹æ•°é‡ private static final CyclicBarrier cyclicBarrier = new CyclicBarrier(5, () -\u0026gt; { System.out.println(\u0026#34;------å½“çº¿ç¨‹æ•°è¾¾åˆ°ä¹‹åï¼Œä¼˜å…ˆæ‰§è¡Œ------\u0026#34;); }); public static void main(String[] args) throws InterruptedException { // åˆ›å»ºçº¿ç¨‹æ±  ExecutorService threadPool = Executors.newFixedThreadPool(10); for (int i = 0; i \u0026lt; threadCount; i++) { final int threadNum = i; Thread.sleep(1000); ///æ³¨æ„è¿™è¡Œ threadPool.execute(() -\u0026gt; { try { test(threadNum); } catch (InterruptedException e) { // TODO Auto-generated catch block e.printStackTrace(); } catch (BrokenBarrierException e) { // TODO Auto-generated catch block e.printStackTrace(); } }); } threadPool.shutdown(); } public static void test(int threadnum) throws InterruptedException, BrokenBarrierException { System.out.println(\u0026#34;threadnum:\u0026#34; + threadnum + \u0026#34;is ready\u0026#34;); try { /**ç­‰å¾…60ç§’ï¼Œä¿è¯å­çº¿ç¨‹å®Œå…¨æ‰§è¡Œç»“æŸ*/ //å¦‚æœç­‰å¾…çš„æ—¶é—´ï¼Œè¶…è¿‡äº†60ç§’ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¸”è¿˜ä¼šè¿›è¡Œé‡ç½®(å˜ä¸º0ä¸ªçº¿ç¨‹å†ç­‰å¾…) cyclicBarrier.await(60, TimeUnit.SECONDS); //æœ€åä¸€ä¸ª(ç¬¬5ä¸ªåˆ°è¾¾åï¼Œcountä¼šé‡ç½®ä¸º0) } catch (Exception e) { System.out.println(\u0026#34;-----CyclicBarrierException------\u0026#34;); } System.out.println(\u0026#34;threadnum:\u0026#34; + threadnum + \u0026#34;is finish\u0026#34;); } } /* ç»“æœ threadnum:0is ready threadnum:1is ready threadnum:2is ready threadnum:3is ready threadnum:4is ready threadnum:4is finish threadnum:0is finish threadnum:1is finish threadnum:2is finish threadnum:3is finish threadnum:5is ready threadnum:6is ready threadnum:7is ready threadnum:8is ready threadnum:9is ready threadnum:9is finish threadnum:5is finish threadnum:8is finish threadnum:7is finish threadnum:6is finish ...... */ /* 1.å¯ä»¥çœ‹åˆ°å½“çº¿ç¨‹æ•°é‡ä¹Ÿå°±æ˜¯è¯·æ±‚æ•°é‡è¾¾åˆ°æˆ‘ä»¬å®šä¹‰çš„ 5 ä¸ªçš„æ—¶å€™ï¼Œ await() æ–¹æ³•ä¹‹åçš„æ–¹æ³•æ‰è¢«æ‰§è¡Œã€‚ 2.å¦å¤–ï¼ŒCyclicBarrier è¿˜æä¾›ä¸€ä¸ªæ›´é«˜çº§çš„æ„é€ å‡½æ•° CyclicBarrier(int parties, Runnable barrierAction)ï¼Œç”¨äºåœ¨çº¿ç¨‹åˆ°è¾¾å±éšœæ—¶ï¼Œä¼˜å…ˆæ‰§è¡Œ barrierActionï¼Œæ–¹ä¾¿å¤„ç†æ›´å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ã€‚ */ //æ³¨æ„è¿™é‡Œï¼Œå¦‚æœæŠŠThread.sleep(1000)å»æ‰ï¼Œé¡ºåº(æƒ…å†µä¹‹ä¸€)ä¸ºï¼š //ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šé¢çš„ä»£ç ï¼Œå¯¼è‡´çš„ç°è±¡ï¼šæ‰€æœ‰çš„readyéƒ½æŒ¤åœ¨ä¸€èµ·äº†(è€Œä¸”ä¸åˆ†å…ˆåï¼Œéšæ—¶æ‰§è¡Œï¼Œè€ŒæŸ5ä¸ªçš„finishï¼Œä¼šç­‰å¾…é‚£5ä¸ªçš„readyæ‰§è¡Œå®Œæ‰ä¼šæ‰§è¡Œï¼Œä¸”finishæ²¡æœ‰é¡ºåºçš„) //â˜…å¦‚ä¸Šï¼Œreadyä¹Ÿæ˜¯æ²¡æœ‰é¡ºåºçš„ /*threadnum:0is ready threadnum:5is ready threadnum:9is ready threadnum:7is ready threadnum:3is ready threadnum:8is ready threadnum:4is ready threadnum:2is ready threadnum:1is ready threadnum:6is ready ------å½“çº¿ç¨‹æ•°è¾¾åˆ°ä¹‹åï¼Œä¼˜å…ˆæ‰§è¡Œ------ å½“readyæ•°é‡ä¸º5çš„å€æ•°æ—¶ï¼ˆæ …æ æ˜¯5ä¸ªï¼Œå°±ä¼šæ‰§è¡Œè¿™ä¸ªï¼‰ threadnum:3is finish threadnum:10is ready ------å½“çº¿ç¨‹æ•°è¾¾åˆ°ä¹‹åï¼Œä¼˜å…ˆæ‰§è¡Œ------ threadnum:10is finish threadnum:11is ready threadnum:0is finish threadnum:5is finish threadnum:4is finish threadnum:1is finish threadnum:8is finish threadnum:12is ready threadnum:9is finish threadnum:7is finish threadnum:16is ready threadnum:15is ready ------å½“çº¿ç¨‹æ•°è¾¾åˆ°ä¹‹åï¼Œä¼˜å…ˆæ‰§è¡Œ------ threadnum:14is ready threadnum:6is finish threadnum:13is ready threadnum:2is finish threadnum:19is ready threadnum:16is finish threadnum:12is finish threadnum:18is ready threadnum:11is finish threadnum:23is ready ------å½“çº¿ç¨‹æ•°è¾¾åˆ°ä¹‹åï¼Œä¼˜å…ˆæ‰§è¡Œ------ threadnum:17is ready threadnum:19is finish threadnum:15is finish threadnum:25is ready threadnum:24is ready threadnum:18is finish threadnum:26is ready threadnum:13is finish threadnum:14is finish threadnum:23is finish threadnum:22is ready threadnum:21is ready threadnum:20is ready ------å½“çº¿ç¨‹æ•°è¾¾åˆ°ä¹‹åï¼Œä¼˜å…ˆæ‰§è¡Œ------ threadnum:29is ready threadnum:28is ready threadnum:27is ready threadnum:22is finish threadnum:24is finish threadnum:25is finish threadnum:32is ready ..... */ åœ¨çœ‹ä¸€ä¸ªä¾‹å­ï¼š\npublic class BarrierTest1 { public static void main(String[] args) throws InterruptedException, TimeoutException, BrokenBarrierException { CyclicBarrier cyclicBarrier = new CyclicBarrier(3); ExecutorService executorService = Executors.newFixedThreadPool(10); executorService.submit(() -\u0026gt; { try { TimeUnit.SECONDS.sleep(1); } catch (InterruptedException e) { e.printStackTrace(); } try { cyclicBarrier.await( ); System.out.println(\u0026#34;æ•°é‡11====\u0026#34;+cyclicBarrier.getNumberWaiting()); System.out.println(\u0026#34;111\u0026#34;); } catch (Exception e) { System.out.println(\u0026#34;æ•°é‡å¼‚å¸¸1111===\u0026#34;+cyclicBarrier.getNumberWaiting()); // e.printStackTrace(); System.out.println(\u0026#34;æŠ¥é”™1\u0026#34;); } }); executorService.submit(() -\u0026gt; { try { TimeUnit.SECONDS.sleep(3); } catch (InterruptedException e) { e.printStackTrace(); } try { System.out.println(\u0026#34;æ•°é‡2222====\u0026#34;+cyclicBarrier.getNumberWaiting()); cyclicBarrier.await(111,TimeUnit.SECONDS); System.out.println(\u0026#34;222\u0026#34;); } catch (Exception e) { System.out.println(\u0026#34;æ•°é‡å¼‚å¸¸2222====\u0026#34;+cyclicBarrier.getNumberWaiting()); System.out.println(\u0026#34;æŠ¥é”™2\u0026#34;); } }); executorService.submit(() -\u0026gt; { try { TimeUnit.SECONDS.sleep(10); } catch (InterruptedException e) { e.printStackTrace(); } try { System.out.println(\u0026#34;æ•°é‡33 awaitå‰====\u0026#34;+cyclicBarrier.getNumberWaiting()); cyclicBarrier.await(); System.out.println(\u0026#34;æ•°é‡33 awaitå====\u0026#34;+cyclicBarrier.getNumberWaiting()); System.out.println(\u0026#34;333\u0026#34;); } catch (Exception e) { System.out.println(\u0026#34;æ•°é‡å¼‚å¸¸333====\u0026#34;+cyclicBarrier.getNumberWaiting()); System.out.println(\u0026#34;æŠ¥é”™3\u0026#34;); } }); } } /* æ•°é‡2222====1 æ•°é‡33 awaitå‰====2 (ç¬¬1ã€2ä¸ªå¤„äºwaitçŠ¶æ€) æ•°é‡33 awaitå====0 ï¼ˆå¾—åˆ°æ …æ æ•°é‡3ï¼Œwaitçº¿ç¨‹æ•°é‡ç½®ä¸º0ï¼‰ 333 æ•°é‡11====0 ï¼ˆæ­¤æ—¶ç¬¬1ã€2ä¸ªçº¿ç¨‹éƒ½ä¼šé‡Šæ”¾ï¼Œä¸”æ•°é‡é‡ç½®ä¸º0ï¼‰ 111 222 */ CyclicBarrieræºç åˆ†æ # å½“è°ƒç”¨CyclicBarrierå¯¹è±¡è°ƒç”¨await() æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯dowait(false,0L )æ–¹æ³•ã€ä¸»è¦ç”¨åˆ°falseã€‘\nawait() æ–¹æ³•å°±åƒæ ‘ç«‹èµ·ä¸€ä¸ªæ …æ çš„è¡Œä¸ºä¸€æ ·ï¼Œå°†çº¿ç¨‹æŒ¡ä½äº†ï¼Œå½“æ‹¦ä½çš„çº¿ç¨‹æ•°é‡è¾¾åˆ° parties çš„å€¼æ—¶ï¼Œæ …æ æ‰ä¼šæ‰“å¼€ï¼Œçº¿ç¨‹æ‰å¾—ä»¥é€šè¿‡æ‰§è¡Œã€‚\npublic int await() throws InterruptedException, BrokenBarrierException { try { return dowait(false, 0L); } catch (TimeoutException toe) { throw new Error(toe); // cannot happen } } dowait(false,0L)æ–¹æ³•\n// å½“çº¿ç¨‹æ•°é‡æˆ–è€…è¯·æ±‚æ•°é‡è¾¾åˆ° count æ—¶ await ä¹‹åçš„æ–¹æ³•æ‰ä¼šè¢«æ‰§è¡Œã€‚ä¸Šé¢çš„ç¤ºä¾‹ä¸­ count çš„å€¼å°±ä¸º 5ã€‚ private int count; /** * Main barrier code, covering the various policies. */ private int dowait(boolean timed, long nanos) throws InterruptedException, BrokenBarrierException, TimeoutException { final ReentrantLock lock = this.lock; // é”ä½ lock.lock(); try { final Generation g = generation; if (g.broken) throw new BrokenBarrierException(); // å¦‚æœçº¿ç¨‹ä¸­æ–­äº†ï¼ŒæŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) { breakBarrier(); throw new InterruptedException(); } // coutå‡1 //â˜…å‰é¢é”ä½äº†ï¼Œæ‰€ä»¥ä¸éœ€è¦CAS int index = --count; //â˜…â˜… å½“ count æ•°é‡å‡ä¸º 0 ä¹‹åè¯´æ˜æœ€åä¸€ä¸ªçº¿ç¨‹å·²ç»åˆ°è¾¾æ …æ äº†ï¼Œä¹Ÿå°±æ˜¯è¾¾åˆ°äº†å¯ä»¥æ‰§è¡Œawait æ–¹æ³•ä¹‹åçš„æ¡ä»¶ if (index == 0) { // tripped boolean ranAction = false; try { final Runnable command = barrierCommand; if (command != null) command.run(); ranAction = true; // å°† count é‡ç½®ä¸º parties å±æ€§çš„åˆå§‹åŒ–å€¼ // å”¤é†’ä¹‹å‰ç­‰å¾…çš„çº¿ç¨‹ // ä¸‹ä¸€æ³¢æ‰§è¡Œå¼€å§‹ nextGeneration(); return 0; } finally { if (!ranAction) breakBarrier(); } } // loop until tripped, broken, interrupted, or timed out for (;;) { try { if (!timed) trip.await(); else if (nanos \u0026gt; 0L) nanos = trip.awaitNanos(nanos); } catch (InterruptedException ie) { if (g == generation \u0026amp;\u0026amp; ! g.broken) { breakBarrier(); throw ie; } else { // We\u0026#39;re about to finish waiting even if we had not // been interrupted, so this interrupt is deemed to // \u0026#34;belong\u0026#34; to subsequent execution. Thread.currentThread().interrupt(); } } if (g.broken) throw new BrokenBarrierException(); if (g != generation) return index; if (timed \u0026amp;\u0026amp; nanos \u0026lt;= 0L) { breakBarrier(); throw new TimeoutException(); } } } finally { lock.unlock(); } } æ€»ç»“ï¼šCyclicBarrier å†…éƒ¨é€šè¿‡ä¸€ä¸ª count å˜é‡ä½œä¸ºè®¡æ•°å™¨ï¼Œcount çš„åˆå§‹å€¼ä¸º parties å±æ€§çš„åˆå§‹åŒ–å€¼ï¼Œæ¯å½“ä¸€ä¸ªçº¿ç¨‹åˆ°äº†æ …æ è¿™é‡Œäº†ï¼Œé‚£ä¹ˆå°±å°†è®¡æ•°å™¨å‡ä¸€ã€‚å¦‚æœ count å€¼ä¸º 0 äº†ï¼Œè¡¨ç¤ºè¿™æ˜¯è¿™ä¸€ä»£æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾æ …æ ï¼Œå°±å°è¯•æ‰§è¡Œæˆ‘ä»¬æ„é€ æ–¹æ³•ä¸­è¾“å…¥çš„ä»»åŠ¡\nCyclicBarrierå’ŒCountDownLatchåŒºåˆ« # CountDownLatch æ˜¯è®¡æ•°å™¨ï¼Œåªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œè€Œ CyclicBarrier çš„è®¡æ•°å™¨æä¾› reset åŠŸèƒ½ï¼Œå¯ä»¥å¤šæ¬¡ä½¿ç”¨ã€‚\nä»jdkä½œè€…è®¾è®¡çš„ç›®çš„æ¥çœ‹ï¼Œjavadocæ˜¯è¿™ä¹ˆæè¿°ä»–ä»¬çš„\nCountDownLatch: A synchronization aid that allows one or more threads to wait until a set of operations being performed in other threads completes.(CountDownLatch: ä¸€ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹ï¼Œç­‰å¾…å…¶ä»–å¤šä¸ªçº¿ç¨‹å®ŒæˆæŸä»¶äº‹æƒ…ä¹‹åæ‰èƒ½æ‰§è¡Œï¼›) CyclicBarrier : A synchronization aid that allows a set of threads to all wait for each other to reach a common barrier point.(CyclicBarrier : å¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œç›´åˆ°åˆ°è¾¾åŒä¸€ä¸ªåŒæ­¥ç‚¹ï¼Œå†ç»§ç»­ä¸€èµ·æ‰§è¡Œã€‚)\néœ€è¦ç»“åˆä¸Šé¢çš„ä»£ç ç¤ºä¾‹ï¼ŒCyclicBarrierç¤ºä¾‹æ˜¯è¿™ä¸ªæ„æ€\nå¯¹äº CountDownLatch æ¥è¯´ï¼Œé‡ç‚¹æ˜¯â€œä¸€ä¸ªçº¿ç¨‹ï¼ˆå¤šä¸ªçº¿ç¨‹ï¼‰ç­‰å¾…â€ï¼Œè€Œå…¶ä»–çš„ N ä¸ªçº¿ç¨‹åœ¨å®Œæˆâ€œæŸä»¶äº‹æƒ…â€ä¹‹åï¼Œå¯ä»¥ç»ˆæ­¢ï¼Œä¹Ÿå¯ä»¥ç­‰å¾…ã€‚ã€å¼ºè°ƒçš„æ˜¯æŸä¸ª(ç»„)ç­‰å¦ä¸€ç»„çº¿ç¨‹å®Œæˆã€‘\nè€Œå¯¹äº CyclicBarrierï¼Œé‡ç‚¹æ˜¯å¤šä¸ªçº¿ç¨‹ï¼Œåœ¨ä»»æ„ä¸€ä¸ªçº¿ç¨‹æ²¡æœ‰å®Œæˆï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½å¿…é¡»ç­‰å¾…ã€‚ã€å¼ºè°ƒçš„æ˜¯äº’ç›¸ã€‘\nCountDownLatch æ˜¯è®¡æ•°å™¨ï¼Œçº¿ç¨‹å®Œæˆä¸€ä¸ªè®°å½•ä¸€ä¸ªï¼Œåªä¸è¿‡è®¡æ•°ä¸æ˜¯é€’å¢è€Œæ˜¯é€’å‡ï¼Œè€Œ CyclicBarrier æ›´åƒæ˜¯ä¸€ä¸ªé˜€é—¨ï¼Œéœ€è¦æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾ï¼Œé˜€é—¨æ‰èƒ½æ‰“å¼€ï¼Œç„¶åç»§ç»­æ‰§è¡Œã€‚\nReentrantLockå’ŒReentrantReadWriteLock # è¯»å†™é” ReentrantReadWriteLock å¯ä»¥ä¿è¯å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¯»ï¼Œæ‰€ä»¥åœ¨è¯»æ“ä½œè¿œå¤§äºå†™æ“ä½œçš„æ—¶å€™ï¼Œè¯»å†™é”å°±éå¸¸æœ‰ç”¨äº†ã€‚\n"},{"id":131,"href":"/zh/docs/study/Review/java_guide/java/Concurrent/ly0307lyconcurrent-collections/","title":"javaå¸¸è§å¹¶å‘å®¹å™¨","section":"å¹¶å‘","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nJDKæä¾›çš„å®¹å™¨ï¼Œå¤§éƒ¨åˆ†åœ¨java.util.concurrentåŒ…ä¸­\nConcurrentHashMapï¼šçº¿ç¨‹å®‰å…¨çš„HashMap CopyOnWriteArrayListï¼šçº¿ç¨‹å®‰å…¨çš„Listï¼Œåœ¨è¯»å¤šå†™å°‘çš„åœºåˆæ€§èƒ½éå¸¸å¥½ï¼Œè¿œå¥½äºVector ConcurrentLinkedQueueï¼šé«˜æ•ˆçš„å¹¶å‘é˜Ÿåˆ—ï¼Œä½¿ç”¨é“¾è¡¨å®ç°ï¼Œå¯ä»¥çœ‹ä½œä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„LinkedListï¼Œæ˜¯ä¸€ä¸ªéé˜»å¡é˜Ÿåˆ— BlockingQueueï¼šè¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼ŒJDKå†…éƒ¨é€šè¿‡é“¾è¡¨ã€æ•°ç»„ç­‰æ–¹å¼å®ç°äº†è¯¥æ¥å£ã€‚è¡¨ç¤ºé˜»å¡é˜Ÿåˆ—ï¼Œéå¸¸é€‚åˆç”¨äºä½œä¸ºæ•°æ®å…±äº«çš„é€šé“ ConcorrentSkipListMapï¼šè·³è¡¨çš„å®ç°ï¼Œæ˜¯ä¸€ä¸ªMapï¼Œä½¿ç”¨è·³è¡¨çš„æ•°æ®ç»“æ„è¿›è¡Œå¿«é€ŸæŸ¥æ‰¾ ConcurrentHashMap # HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå¹¶å‘åœºæ™¯ä¸‹è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨Collections.synchronizedMap()æ–¹æ³•æ¥åŒ…è£…HashMapï¼Œä½†è¿™æ˜¯é€šè¿‡ä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„é”æ¥åŒæ­¥ä¸åŒçº¿ç¨‹é—´çš„å¹¶å‘è®¿é—®ï¼Œå› æ­¤ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ å»ºè®®ä½¿ç”¨ConcurrentHashMapï¼Œä¸è®ºæ˜¯è¯»æ“ä½œè¿˜æ˜¯å†™æ“ä½œéƒ½èƒ½ä¿è¯é«˜æ€§èƒ½ï¼šè¯»æ“ä½œï¼ˆå‡ ä¹ï¼‰ä¸éœ€è¦åŠ é”ï¼Œè€Œå†™æ“ä½œæ—¶é€šè¿‡é”åˆ†æ®µ(è¿™é‡Œè¯´çš„æ˜¯JDK1.7ï¼Ÿ)æŠ€æœ¯ï¼Œåªå¯¹æ‰€æ“ä½œçš„æ®µåŠ é”è€Œä¸å½±å“å®¢æˆ·ç«¯å¯¹å…¶ä»–æ®µçš„è®¿é—® CopyOnWriteArrayList # //æºç  public class CopyOnWriteArrayList\u0026lt;E\u0026gt; extends Object implements List\u0026lt;E\u0026gt;, RandomAccess, Cloneable, Serializable åœ¨å¾ˆå¤šåº”ç”¨åœºæ™¯ä¸­ï¼Œè¯»æ“ä½œå¯èƒ½ä¼šè¿œè¿œå¤§äºå†™æ“ä½œ æˆ‘ä»¬åº”è¯¥å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®Listå†…éƒ¨æ•°æ®ï¼ˆé’ˆå¯¹è¯»ï¼‰ ä¸ReentrantReadWriteLockè¯»å†™é”æ€æƒ³éå¸¸ç±»ä¼¼ï¼Œå³è¯»è¯»å…±äº«ã€å†™å†™äº’æ–¥ã€è¯»å†™äº’æ–¥ã€å†™è¯»äº’æ–¥ ä¸ä¸€æ ·çš„æ˜¯ï¼ŒCopyOnWriteArrayListè¯»å–æ—¶å®Œå…¨ä¸éœ€è¦åŠ é”ï¼Œä¸”å†™å…¥ä¹Ÿä¸ä¼šé˜»å¡è¯»å–æ“ä½œï¼Œåªæœ‰å†™å…¥å’Œå†™å…¥ä¹‹é—´éœ€è¦åŒæ­¥ç­‰å¾…ã€‚ CopyOnWriteArrayListæ˜¯å¦‚ä½•åšåˆ°çš„ # CopyOnWriteArrayList ç±»çš„æ‰€æœ‰å¯å˜æ“ä½œï¼ˆaddï¼Œset ç­‰ç­‰ï¼‰éƒ½æ˜¯é€šè¿‡åˆ›å»ºåº•å±‚æ•°ç»„çš„æ–°å‰¯æœ¬æ¥å®ç°çš„ã€‚å½“ List éœ€è¦è¢«ä¿®æ”¹çš„æ—¶å€™ï¼Œå¹¶ä¸ä¿®æ”¹åŸæœ‰å†…å®¹ï¼Œè€Œæ˜¯å¯¹åŸæœ‰æ•°æ®è¿›è¡Œä¸€æ¬¡å¤åˆ¶ï¼Œå°†ä¿®æ”¹çš„å†…å®¹å†™å…¥å‰¯æœ¬ã€‚å†™å®Œä¹‹åï¼Œå†å°†ä¿®æ”¹å®Œçš„å‰¯æœ¬æ›¿æ¢åŸæ¥çš„æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯å†™æ“ä½œä¸ä¼šå½±å“è¯»æ“ä½œäº†ã€‚ ä» CopyOnWriteArrayList çš„åå­—å°±èƒ½çœ‹å‡º CopyOnWriteArrayList æ˜¯æ»¡è¶³ CopyOnWrite çš„ åœ¨è®¡ç®—æœºï¼Œå¦‚æœä½ æƒ³è¦å¯¹ä¸€å—å†…å­˜è¿›è¡Œä¿®æ”¹æ—¶ï¼Œæˆ‘ä»¬ä¸åœ¨åŸæœ‰å†…å­˜å—ä¸­è¿›è¡Œå†™æ“ä½œï¼Œè€Œæ˜¯å°†å†…å­˜æ‹·è´ä¸€ä»½ï¼Œåœ¨æ–°çš„å†…å­˜ä¸­è¿›è¡Œå†™æ“ä½œï¼Œå†™å®Œä¹‹åå‘¢ï¼Œå°±å°†æŒ‡å‘åŸæ¥å†…å­˜æŒ‡é’ˆæŒ‡å‘æ–°çš„å†…å­˜(æ³¨æ„ï¼Œæ˜¯æŒ‡å‘ï¼Œè€Œä¸æ˜¯é‡æ–°æ‹·è´â˜…é‡è¦â˜…)ï¼ŒåŸæ¥çš„å†…å­˜å°±å¯ä»¥è¢«å›æ”¶æ‰äº† CopyOnWriteArrayList è¯»å–å’Œå†™å…¥æºç ç®€å•åˆ†æ # CopyOnWriteArrayListè¯»å–æ“ä½œçš„å®ç° è¯»å–æ“ä½œæ²¡æœ‰ä»»ä½•åŒæ­¥æ§åˆ¶å’Œé”æ“ä½œï¼Œç†ç”±å°±æ˜¯å†…éƒ¨æ•°ç»„arrayä¸ä¼šå‘ç”Ÿä¿®æ”¹ï¼Œåªä¼šè¢«å¦ä¸€ä¸ªarrayæ›¿æ¢ï¼Œå› æ­¤å¯ä»¥ä¿è¯æ•°æ®å®‰å…¨\n/** The array, accessed only via getArray/setArray. */ private transient volatile Object[] array; public E get(int index) { return get(getArray(), index); } @SuppressWarnings(\u0026#34;unchecked\u0026#34;) private E get(Object[] a, int index) { return (E) a[index]; } final Object[] getArray() { return array; } CopyOnWriteArrayListå†™å…¥æ“ä½œçš„å®ç° åœ¨æ·»åŠ é›†åˆçš„æ—¶å€™åŠ äº†é”ï¼Œä¿è¯åŒæ­¥ï¼Œé¿å…å¤šçº¿ç¨‹å†™çš„æ—¶å€™ä¼šcopyå‡ºå¤šä¸ªå‰¯æœ¬\n/** * Appends the specified element to the end of this list. * * @param e element to be appended to this list * @return {@code true} (as specified by {@link Collection#add}) */ public boolean add(E e) { final ReentrantLock lock = this.lock; lock.lock();//åŠ é” try { Object[] elements = getArray(); int len = elements.length; Object[] newElements = Arrays.copyOf(elements, len + 1);//æ‹·è´æ–°æ•°ç»„ newElements[len] = e; setArray(newElements); return true; } finally { lock.unlock();//é‡Šæ”¾é” } } ConcurrentLinkedQueue # Javaæä¾›çš„çº¿ç¨‹å®‰å…¨çš„Queueåˆ†ä¸ºé˜»å¡é˜Ÿåˆ—å’Œéé˜»å¡é˜Ÿåˆ— é˜»å¡é˜Ÿåˆ—çš„å…¸å‹ä¾‹å­æ˜¯BlockingQueueï¼Œéé˜»å¡é˜Ÿåˆ—çš„å…¸å‹ä¾‹å­æ˜¯ConcurrentLinkedQueue é˜»å¡é˜Ÿåˆ—é€šè¿‡é”æ¥å®ç°ï¼Œéé˜»å¡é˜Ÿåˆ—é€šè¿‡CASå®ç° ConcurrentLinkedQueueä½¿ç”¨é“¾è¡¨ä½œä¸ºæ•°æ®ç»“æ„ï¼Œæ˜¯é«˜å¹¶å‘ç¯å¢ƒä¸­æ€§èƒ½æœ€å¥½çš„é˜Ÿåˆ— ConcurrentLinkedQueue é€‚åˆåœ¨å¯¹æ€§èƒ½è¦æ±‚ç›¸å¯¹è¾ƒé«˜ï¼ŒåŒæ—¶å¯¹é˜Ÿåˆ—çš„è¯»å†™å­˜åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œçš„åœºæ™¯ï¼Œå³å¦‚æœå¯¹é˜Ÿåˆ—åŠ é”çš„æˆæœ¬è¾ƒé«˜åˆ™é€‚åˆä½¿ç”¨æ— é”çš„ ConcurrentLinkedQueueï¼Œå³CAS æ¥æ›¿ä»£ BlockingQueue # é˜»å¡é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰è¢«å¹¿æ³›ä½¿ç”¨åœ¨â€œç”Ÿäº§è€…-æ¶ˆè´¹è€…â€é—®é¢˜ä¸­ï¼Œå…¶åŸå› æ˜¯ BlockingQueue æä¾›äº†å¯é˜»å¡çš„æ’å…¥å’Œç§»é™¤çš„æ–¹æ³•ã€‚å½“é˜Ÿåˆ—å®¹å™¨å·²æ»¡ï¼Œç”Ÿäº§è€…çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—æœªæ»¡ï¼›å½“é˜Ÿåˆ—å®¹å™¨ä¸ºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´è‡³é˜Ÿåˆ—éç©ºæ—¶ä¸ºæ­¢\nBlockingQueueæ˜¯ä¸€ä¸ªæ¥å£ï¼Œç»§æ‰¿è‡ªQueueï¼Œè€ŒQueueåˆç»§æ‰¿è‡ªCollectionæ¥å£ï¼Œä¸‹é¢æ˜¯BlockingQueueçš„ç›¸å…³å®ç°ç±»ï¼š\nä»£ç ä¾‹å­ï¼ˆä¸»è¦æ˜¯**put()å’Œtake()**ä¸¤ä¸ªæ–¹æ³•ï¼‰ï¼š\npublic class TestBlockingQueue { public static void main(String[] args) { BlockingQueue\u0026lt;String\u0026gt; blockingQueue = new ArrayBlockingQueue\u0026lt;\u0026gt;(2); for (int i = 10; i \u0026lt; 20; i++) { int finalI = i; new Thread(() -\u0026gt; { try { TimeUnit.SECONDS.sleep(finalI); } catch (InterruptedException e) { e.printStackTrace(); } try { blockingQueue.put(finalI + \u0026#34;\u0026#34;); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread() .getName() + \u0026#34;æ”¾å…¥äº†å…ƒç´ [\u0026#34; + finalI + \u0026#34;\u0026#34;); }, \u0026#34;çº¿ç¨‹\u0026#34; + i).start(); } for (int i = 20; i \u0026lt; 30; i++) { int finalI = i; new Thread(() -\u0026gt; { try { TimeUnit.SECONDS.sleep(finalI); } catch (InterruptedException e) { e.printStackTrace(); } String remove = null; try { remove = blockingQueue.take(); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread() .getName() + \u0026#34;å–å‡ºäº†å…ƒç´ [\u0026#34; + remove + \u0026#34;\u0026#34;); }, \u0026#34;çº¿ç¨‹\u0026#34; + i).start(); } } } /* ç”±ä¸‹å¯ä»¥çŸ¥é“ï¼Œæ”¾å…¥äº†ä¸¤ä¸ªå…ƒç´ ä¹‹åï¼Œéœ€è¦ç­‰å¾…å–å‡ºåï¼Œæ‰èƒ½ç»§ç»­æ”¾å…¥ çº¿ç¨‹10æ”¾å…¥äº†å…ƒç´ [10 çº¿ç¨‹11æ”¾å…¥äº†å…ƒç´ [11 ----\u0026gt; ä¹‹åè¿™é‡Œå‘ç”Ÿäº†åœé¡¿ çº¿ç¨‹20å–å‡ºäº†å…ƒç´ [10 çº¿ç¨‹12æ”¾å…¥äº†å…ƒç´ [12 çº¿ç¨‹21å–å‡ºäº†å…ƒç´ [11 çº¿ç¨‹13æ”¾å…¥äº†å…ƒç´ [13 çº¿ç¨‹22å–å‡ºäº†å…ƒç´ [12 çº¿ç¨‹14æ”¾å…¥äº†å…ƒç´ [14 çº¿ç¨‹23å–å‡ºäº†å…ƒç´ [13 çº¿ç¨‹15æ”¾å…¥äº†å…ƒç´ [15 çº¿ç¨‹24å–å‡ºäº†å…ƒç´ [14 çº¿ç¨‹16æ”¾å…¥äº†å…ƒç´ [16 çº¿ç¨‹25å–å‡ºäº†å…ƒç´ [15 çº¿ç¨‹17æ”¾å…¥äº†å…ƒç´ [17 çº¿ç¨‹26å–å‡ºäº†å…ƒç´ [16 çº¿ç¨‹18æ”¾å…¥äº†å…ƒç´ [18 çº¿ç¨‹27å–å‡ºäº†å…ƒç´ [17 çº¿ç¨‹19æ”¾å…¥äº†å…ƒç´ [19 çº¿ç¨‹28å–å‡ºäº†å…ƒç´ [18 çº¿ç¨‹29å–å‡ºäº†å…ƒç´ [19 Process finished with exit code 0 */ ArrayBockingQueue # ArrayBlockingQueueæ˜¯BlockingQueueæ¥å£çš„æœ‰ç•Œé˜Ÿåˆ—å®ç°ç±»ï¼Œåº•å±‚é‡‡ç”¨æ•°ç»„æ¥å®ç°\npublic class ArrayBlockingQueue\u0026lt;E\u0026gt; extends AbstractQueue\u0026lt;E\u0026gt; implements BlockingQueue\u0026lt;E\u0026gt;, Serializable{} ArrayBlockingQueue ä¸€æ—¦åˆ›å»ºï¼Œå®¹é‡ä¸èƒ½æ”¹å˜ã€‚å…¶å¹¶å‘æ§åˆ¶é‡‡ç”¨å¯é‡å…¥é” ReentrantLock ï¼Œä¸ç®¡æ˜¯æ’å…¥æ“ä½œè¿˜æ˜¯è¯»å–æ“ä½œï¼Œéƒ½éœ€è¦è·å–åˆ°é”æ‰èƒ½è¿›è¡Œæ“ä½œã€‚å½“é˜Ÿåˆ—å®¹é‡æ»¡æ—¶ï¼Œå°è¯•å°†å…ƒç´ æ”¾å…¥é˜Ÿåˆ—å°†å¯¼è‡´æ“ä½œé˜»å¡;å°è¯•ä»ä¸€ä¸ªç©ºé˜Ÿåˆ—ä¸­å–ä¸€ä¸ªå…ƒç´ ä¹Ÿä¼šåŒæ ·é˜»å¡ã€‚\nArrayBlockingQueue é»˜è®¤æƒ…å†µä¸‹ä¸èƒ½ä¿è¯çº¿ç¨‹è®¿é—®é˜Ÿåˆ—çš„å…¬å¹³æ€§ï¼Œæ‰€è°“å…¬å¹³æ€§æ˜¯æŒ‡ä¸¥æ ¼æŒ‰ç…§çº¿ç¨‹ç­‰å¾…çš„ç»å¯¹æ—¶é—´é¡ºåºï¼Œå³æœ€å…ˆç­‰å¾…çš„çº¿ç¨‹èƒ½å¤Ÿæœ€å…ˆè®¿é—®åˆ° ArrayBlockingQueueã€‚è€Œéå…¬å¹³æ€§åˆ™æ˜¯æŒ‡è®¿é—® ArrayBlockingQueue çš„é¡ºåºä¸æ˜¯éµå®ˆä¸¥æ ¼çš„æ—¶é—´é¡ºåºï¼Œæœ‰å¯èƒ½å­˜åœ¨ï¼Œå½“ ArrayBlockingQueue å¯ä»¥è¢«è®¿é—®æ—¶ï¼Œé•¿æ—¶é—´é˜»å¡çš„çº¿ç¨‹ä¾ç„¶æ— æ³•è®¿é—®åˆ° ArrayBlockingQueueã€‚å¦‚æœä¿è¯å…¬å¹³æ€§ï¼Œé€šå¸¸ä¼šé™ä½ååé‡ã€‚å¦‚æœéœ€è¦è·å¾—å…¬å¹³æ€§çš„ ArrayBlockingQueueï¼Œå¯é‡‡ç”¨å¦‚ä¸‹ä»£ç (ä¸»è¦æ˜¯ç¬¬äºŒä¸ªå‚æ•°)\nprivate static ArrayBlockingQueue\u0026lt;Integer\u0026gt; blockingQueue = new ArrayBlockingQueue\u0026lt;Integer\u0026gt;(10,true); LinkedBlockingQueue # åº•å±‚åŸºäºå•å‘é“¾è¡¨å®ç°é˜»å¡é˜Ÿåˆ—ï¼Œå¯ä»¥å½“ä½œæ— ç•Œé˜Ÿåˆ—ä¹Ÿå¯ä»¥å½“ä½œæœ‰ç•Œé˜Ÿåˆ—\næ»¡è¶³FIFOç‰¹æ€§ï¼Œä¸ArrayBlockingQueueç›¸æ¯”æœ‰æ›´é«˜ååé‡ï¼Œä¸ºé˜²æ­¢LinkedBlockingQueueå®¹é‡è¿…é€Ÿå¢åŠ ï¼ŒæŸè€—å¤§é‡å†…å­˜ï¼Œä¸€èˆ¬åˆ›å»ºLinkedBlockingQueueå¯¹è±¡æ—¶ä¼šæŒ‡å®šå¤§å°****ï¼›å¦‚æœæœªæŒ‡å®šåˆ™å®¹é‡ç­‰äºInteger.MAX_VALUE\nç›¸å…³æ„é€ æ–¹æ³•\n/** *æŸç§æ„ä¹‰ä¸Šçš„æ— ç•Œé˜Ÿåˆ— * Creates a {@code LinkedBlockingQueue} with a capacity of * {@link Integer#MAX_VALUE}. */ public LinkedBlockingQueue() { this(Integer.MAX_VALUE); } /** *æœ‰ç•Œé˜Ÿåˆ— * Creates a {@code LinkedBlockingQueue} with the given (fixed) capacity. * * @param capacity the capacity of this queue * @throws IllegalArgumentException if {@code capacity} is not greater * than zero */ public LinkedBlockingQueue(int capacity) { if (capacity \u0026lt;= 0) throw new IllegalArgumentException(); this.capacity = capacity; last = head = new Node\u0026lt;E\u0026gt;(null); } PriorityBlockingQueue # æ”¯æŒä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œé»˜è®¤æƒ…å†µå…ƒç´ é‡‡ç”¨è‡ªç„¶é¡ºåºè¿›è¡Œæ’åºï¼Œæˆ–é€šè¿‡è‡ªå®šä¹‰ç±»å®ç°compareTo()æ–¹æ³•æŒ‡å®šå…ƒç´ æ’åºï¼Œæˆ–åˆå§‹åŒ–æ—¶é€šè¿‡æ„é€ å™¨å‚æ•°Comparatoræ¥æŒ‡å®šæ’åºè§„åˆ™ PriorityBlockingQueue å¹¶å‘æ§åˆ¶é‡‡ç”¨çš„æ˜¯å¯é‡å…¥é” ReentrantLockï¼Œé˜Ÿåˆ—ä¸ºæ— ç•Œé˜Ÿåˆ—ï¼ˆArrayBlockingQueue æ˜¯æœ‰ç•Œé˜Ÿåˆ—ï¼ŒLinkedBlockingQueue ä¹Ÿå¯ä»¥é€šè¿‡åœ¨æ„é€ å‡½æ•°ä¸­ä¼ å…¥ capacity æŒ‡å®šé˜Ÿåˆ—æœ€å¤§çš„å®¹é‡ï¼Œä½†æ˜¯ PriorityBlockingQueue åªèƒ½æŒ‡å®šåˆå§‹çš„é˜Ÿåˆ—å¤§å°ï¼Œåé¢æ’å…¥å…ƒç´ çš„æ—¶å€™ï¼Œå¦‚æœç©ºé—´ä¸å¤Ÿçš„è¯ä¼šè‡ªåŠ¨æ‰©å®¹ï¼‰ å®ƒå°±æ˜¯ PriorityQueue çš„çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬ã€‚ä¸å¯ä»¥æ’å…¥ null å€¼ï¼ŒåŒæ—¶ï¼Œæ’å…¥é˜Ÿåˆ—çš„å¯¹è±¡å¿…é¡»æ˜¯å¯æ¯”è¾ƒå¤§å°çš„ï¼ˆcomparableï¼‰ï¼Œå¦åˆ™æŠ¥ ClassCastException å¼‚å¸¸ã€‚å®ƒçš„æ’å…¥æ“ä½œ put æ–¹æ³•ä¸ä¼š block(æ˜¯block é˜»å¡ï¼Œä¸æ˜¯lock é”)ï¼Œå› ä¸ºå®ƒæ˜¯æ— ç•Œé˜Ÿåˆ—ï¼ˆtake æ–¹æ³•åœ¨é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™ä¼šé˜»å¡ï¼‰ ConcurrentSkipListMap # å¯¹äºä¸€ä¸ªå•é“¾è¡¨ï¼Œå³ä½¿é“¾è¡¨æ˜¯æœ‰åºçš„ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨å…¶ä¸­æŸ¥æ‰¾æŸä¸ªæ•°æ®ï¼Œä¹Ÿåªèƒ½ä»å¤´åˆ°å°¾éå†é“¾è¡¨ï¼Œè¿™æ ·æ•ˆç‡è‡ªç„¶å°±ä¼šå¾ˆä½ï¼Œè·³è¡¨å°±ä¸ä¸€æ ·äº†ã€‚è·³è¡¨æ˜¯ä¸€ç§å¯ä»¥ç”¨æ¥å¿«é€ŸæŸ¥æ‰¾çš„æ•°æ®ç»“æ„ï¼Œæœ‰ç‚¹ç±»ä¼¼äºå¹³è¡¡æ ‘ã€‚å®ƒä»¬éƒ½å¯ä»¥å¯¹å…ƒç´ è¿›è¡Œå¿«é€Ÿçš„æŸ¥æ‰¾ã€‚ä½†ä¸€ä¸ªé‡è¦çš„åŒºåˆ«æ˜¯ï¼šå¯¹å¹³è¡¡æ ‘çš„æ’å…¥å’Œåˆ é™¤å¾€å¾€å¾ˆå¯èƒ½å¯¼è‡´å¹³è¡¡æ ‘è¿›è¡Œä¸€æ¬¡å…¨å±€çš„è°ƒæ•´ã€‚è€Œå¯¹è·³è¡¨çš„æ’å…¥å’Œåˆ é™¤åªéœ€è¦å¯¹æ•´ä¸ªæ•°æ®ç»“æ„çš„å±€éƒ¨è¿›è¡Œæ“ä½œå³å¯ã€‚è¿™æ ·å¸¦æ¥çš„å¥½å¤„æ˜¯ï¼šåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œä½ ä¼šéœ€è¦ä¸€ä¸ªå…¨å±€é”æ¥ä¿è¯æ•´ä¸ªå¹³è¡¡æ ‘çš„çº¿ç¨‹å®‰å…¨ã€‚è€Œå¯¹äºè·³è¡¨ï¼Œä½ åªéœ€è¦éƒ¨åˆ†é”å³å¯ã€‚è¿™æ ·ï¼Œåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ï¼Œä½ å°±å¯ä»¥æ‹¥æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚è€Œå°±æŸ¥è¯¢çš„æ€§èƒ½è€Œè¨€ï¼Œè·³è¡¨çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ O(logn) æ‰€ä»¥åœ¨å¹¶å‘æ•°æ®ç»“æ„ä¸­ï¼ŒJDK ä½¿ç”¨è·³è¡¨æ¥å®ç°ä¸€ä¸ª Mapã€‚\nè·³è¡¨çš„æœ¬è´¨æ˜¯ç»´æŠ¤å¤šä¸ªé“¾è¡¨ï¼Œä¸”é“¾è¡¨æ˜¯åˆ†å±‚çš„ æœ€ä½å±‚çš„é“¾è¡¨ç»´æŠ¤è·³è¡¨å†…æ‰€æœ‰å…ƒç´ ï¼Œæ¯ä¸Šé¢ä¸€å±‚é“¾è¡¨éƒ½æ˜¯ä¸‹é¢ä¸€å±‚çš„å­é›† è·³è¡¨å†…æ‰€æœ‰é“¾è¡¨çš„å…ƒç´ éƒ½æ˜¯æ’åºçš„ æŸ¥æ‰¾æ—¶ï¼Œå¯ä»¥ä»é¡¶çº§é“¾è¡¨å¼€å§‹æ‰¾ã€‚ä¸€æ—¦å‘ç°è¢«æŸ¥æ‰¾çš„å…ƒç´ å¤§äºå½“å‰é“¾è¡¨ä¸­çš„å–å€¼ï¼ˆè¿™é‡Œåº”è¯¥åŠ ä¸Šä¸€å¥ï¼Œå°äºå‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ¯”å¦‚ä¸‹é¢å¦‚æœæ˜¯æŸ¥æ‰¾3ï¼Œé‚£ä¹ˆå°±ä»1è·³ä¸‹å»ï¼‰ï¼Œå°±ä¼šè½¬å…¥ä¸‹ä¸€å±‚é“¾è¡¨ç»§ç»­æ‰¾ã€‚è¿™ä¹Ÿå°±æ˜¯è¯´åœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­ï¼Œæœç´¢æ˜¯è·³è·ƒå¼çš„ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨è·³è¡¨ä¸­æŸ¥æ‰¾å…ƒç´  18ã€‚ æŸ¥æ‰¾ 18 çš„æ—¶å€™åŸæ¥éœ€è¦éå† 18 æ¬¡ï¼Œç°åœ¨åªéœ€è¦ 7 æ¬¡å³å¯ã€‚é’ˆå¯¹é“¾è¡¨é•¿åº¦æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œæ„å»ºç´¢å¼•æŸ¥æ‰¾æ•ˆç‡çš„æå‡å°±ä¼šéå¸¸æ˜æ˜¾ ï¼ˆè¿™é‡Œå¥½åƒä¸å¤ªå¯¹ï¼ŒåŸæ¥ä¹Ÿä¸éœ€è¦éå†18æ¬¡,åæ­£å¤§æ¦‚ç‡æ˜¯è¯´æ•ˆç‡é«˜å°±æ˜¯äº†ï¼‰\nä½¿ç”¨è·³è¡¨å®ç° Map å’Œä½¿ç”¨å“ˆå¸Œç®—æ³•å®ç° Map çš„å¦å¤–ä¸€ä¸ªä¸åŒä¹‹å¤„æ˜¯ï¼šå“ˆå¸Œå¹¶ä¸ä¼šä¿å­˜å…ƒç´ çš„é¡ºåºï¼Œè€Œè·³è¡¨å†…æ‰€æœ‰çš„å…ƒç´ éƒ½æ˜¯æ’åºçš„ã€‚å› æ­¤åœ¨å¯¹è·³è¡¨è¿›è¡Œéå†æ—¶ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªæœ‰åºçš„ç»“æœã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ çš„åº”ç”¨éœ€è¦æœ‰åºæ€§ï¼Œé‚£ä¹ˆè·³è¡¨å°±æ˜¯ä½ ä¸äºŒçš„é€‰æ‹©ã€‚JDK ä¸­å®ç°è¿™ä¸€æ•°æ®ç»“æ„çš„ç±»æ˜¯ ConcurrentSkipListMapã€‚\n"},{"id":132,"href":"/zh/docs/study/Review/java_guide/java/Concurrent/ly0306lythread-pool-best/","title":"çº¿ç¨‹æ± æœ€ä½³å®è·µ","section":"å¹¶å‘","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nçº¿ç¨‹æ± çŸ¥è¯†å›é¡¾ # 1. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ±  # æ± åŒ–æŠ€æœ¯çš„æ€æƒ³ï¼Œä¸»è¦æ˜¯ä¸ºäº†å‡å°‘æ¯æ¬¡è·å–èµ„æºï¼ˆçº¿ç¨‹èµ„æºï¼‰çš„æ¶ˆè€—ï¼Œæé«˜å¯¹èµ„æºçš„åˆ©ç”¨ç‡ çº¿ç¨‹æ± æä¾›äº†ä¸€ç§é™åˆ¶å’Œç®¡ç†èµ„æºï¼ˆåŒ…æ‹¬æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼‰çš„æ–¹æ³•ï¼Œæ¯ä¸ªçº¿ç¨‹æ± è¿˜ç»´æŠ¤ä¸€äº›åŸºæœ¬ç»Ÿè®¡ä¿¡æ¯ï¼Œä¾‹å¦‚å·²å®Œæˆä»»åŠ¡çš„æ•°é‡ å¥½å¤„ï¼š\né™ä½èµ„æºæ¶ˆè€— æé«˜å“åº”é€Ÿåº¦ æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ 2. çº¿ç¨‹æ± åœ¨å®é™…é¡¹ç›®çš„ä½¿ç”¨åœºæ™¯ # çº¿ç¨‹æ± ä¸€èˆ¬ç”¨äºæ‰§è¡Œå¤šä¸ªä¸ç›¸å…³è”çš„è€—æ—¶ä»»åŠ¡ï¼Œæ²¡æœ‰å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œä»»åŠ¡é¡ºåºæ‰§è¡Œï¼Œä½¿ç”¨äº†çº¿ç¨‹æ± çš„è¯å¯è®©å¤šä¸ªä¸ç›¸å…³è”çš„ä»»åŠ¡åŒæ—¶æ‰§è¡Œã€‚\n3. å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ±  # ä¸€èˆ¬æ˜¯é€šè¿‡ ThreadPoolExecutor çš„æ„é€ å‡½æ•°æ¥åˆ›å»ºçº¿ç¨‹æ± ï¼Œç„¶åæäº¤ä»»åŠ¡ç»™çº¿ç¨‹æ± æ‰§è¡Œå°±å¯ä»¥äº†ã€‚æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š\n/** * ç”¨ç»™å®šçš„åˆå§‹å‚æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ThreadPoolExecutorã€‚ */ public ThreadPoolExecutor(int corePoolSize,//çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°é‡ int maximumPoolSize,//çº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•° long keepAliveTime,//å½“çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œå¤šä½™çš„ç©ºé—²çº¿ç¨‹å­˜æ´»çš„æœ€é•¿æ—¶é—´ TimeUnit unit,//æ—¶é—´å•ä½ BlockingQueue\u0026lt;Runnable\u0026gt; workQueue,//ä»»åŠ¡é˜Ÿåˆ—ï¼Œç”¨æ¥å‚¨å­˜ç­‰å¾…æ‰§è¡Œä»»åŠ¡çš„é˜Ÿåˆ— ThreadFactory threadFactory,//çº¿ç¨‹å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºçº¿ç¨‹ï¼Œä¸€èˆ¬é»˜è®¤å³å¯ RejectedExecutionHandler handler//æ‹’ç»ç­–ç•¥ï¼Œå½“æäº¤çš„ä»»åŠ¡è¿‡å¤šè€Œä¸èƒ½åŠæ—¶å¤„ç†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶ç­–ç•¥æ¥å¤„ç†ä»»åŠ¡ ) { if (corePoolSize \u0026lt; 0 || maximumPoolSize \u0026lt;= 0 || maximumPoolSize \u0026lt; corePoolSize || keepAliveTime \u0026lt; 0) throw new IllegalArgumentException(); if (workQueue == null || threadFactory == null || handler == null) throw new NullPointerException(); this.corePoolSize = corePoolSize; this.maximumPoolSize = maximumPoolSize; this.workQueue = workQueue; this.keepAliveTime = unit.toNanos(keepAliveTime); this.threadFactory = threadFactory; this.handler = handler; } ä½¿ç”¨ä»£ç ï¼š\nprivate static final int CORE_POOL_SIZE = 5; private static final int MAX_POOL_SIZE = 10; private static final int QUEUE_CAPACITY = 100; private static final Long KEEP_ALIVE_TIME = 1L; public static void main(String[] args) { //ä½¿ç”¨é˜¿é‡Œå·´å·´æ¨èçš„åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼ //é€šè¿‡ThreadPoolExecutoræ„é€ å‡½æ•°è‡ªå®šä¹‰å‚æ•°åˆ›å»º ThreadPoolExecutor executor = new ThreadPoolExecutor( CORE_POOL_SIZE, MAX_POOL_SIZE, KEEP_ALIVE_TIME, TimeUnit.SECONDS, new ArrayBlockingQueue\u0026lt;\u0026gt;(QUEUE_CAPACITY), new ThreadPoolExecutor.CallerRunsPolicy()); for (int i = 0; i \u0026lt; 10; i++) { executor.execute(() -\u0026gt; { try { Thread.sleep(2000); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(\u0026#34;CurrentThread name:\u0026#34; + Thread.currentThread().getName() + \u0026#34;dateï¼š\u0026#34; + Instant.now()); }); } //ç»ˆæ­¢çº¿ç¨‹æ±  executor.shutdown(); try { /* awaitTermination()æ–¹æ³•çš„ä½œç”¨: å½“å‰çº¿ç¨‹é˜»å¡ï¼Œç›´åˆ° 1. ç­‰æ‰€æœ‰å·²æäº¤çš„ä»»åŠ¡ï¼ˆåŒ…æ‹¬æ­£åœ¨è·‘çš„å’Œé˜Ÿåˆ—ä¸­ç­‰å¾…çš„ï¼‰æ‰§è¡Œå®Œ 2. æˆ–è€…ç­‰è¶…æ—¶æ—¶é—´åˆ° 3. æˆ–è€…çº¿ç¨‹è¢«ä¸­æ–­ï¼ŒæŠ›å‡ºInterruptedException ç„¶åè¿”å›trueï¼ˆshutdownè¯·æ±‚åæ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼‰æˆ–falseï¼ˆå·²è¶…æ—¶ï¼‰ */ executor.awaitTermination(5, TimeUnit.SECONDS); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(\u0026#34;Finished all threads\u0026#34;); } /*è¾“å‡º CurrentThread name:pool-1-thread-5dateï¼š2020-06-06T11:45:31.639Z CurrentThread name:pool-1-thread-3dateï¼š2020-06-06T11:45:31.639Z CurrentThread name:pool-1-thread-1dateï¼š2020-06-06T11:45:31.636Z CurrentThread name:pool-1-thread-4dateï¼š2020-06-06T11:45:31.639Z CurrentThread name:pool-1-thread-2dateï¼š2020-06-06T11:45:31.639Z CurrentThread name:pool-1-thread-2dateï¼š2020-06-06T11:45:33.656Z CurrentThread name:pool-1-thread-4dateï¼š2020-06-06T11:45:33.656Z CurrentThread name:pool-1-thread-1dateï¼š2020-06-06T11:45:33.656Z CurrentThread name:pool-1-thread-3dateï¼š2020-06-06T11:45:33.656Z CurrentThread name:pool-1-thread-5dateï¼š2020-06-06T11:45:33.656Z Finished all threads */ çº¿ç¨‹æ± æœ€ä½³å®è·µ # 1. ä½¿ç”¨ThreadPoolExecutorçš„æ„é€ å‡½æ•°å£°æ˜çº¿ç¨‹æ±  # çº¿ç¨‹æ± å¿…é¡»æ‰‹åŠ¨é€šè¿‡ ThreadPoolExecutor çš„æ„é€ å‡½æ•°æ¥å£°æ˜ï¼Œé¿å…ä½¿ç”¨Executors ç±»çš„ newFixedThreadPool å’Œ newCachedThreadPool ï¼Œå› ä¸ºå¯èƒ½ä¼šæœ‰ OOM çš„é£é™©ã€‚\nFixedThreadPool å’Œ SingleThreadExecutor ï¼š å…è®¸è¯·æ±‚çš„é˜Ÿåˆ—é•¿åº¦ä¸º Integer.MAX_VALUE,å¯èƒ½å †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ OOMã€‚\nCachedThreadPool å’Œ ScheduledThreadPool ï¼š å…è®¸åˆ›å»ºçš„çº¿ç¨‹æ•°é‡ä¸º Integer.MAX_VALUE ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ OOMã€‚\næ€»ç»“ï¼šä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—ï¼Œæ§åˆ¶çº¿ç¨‹åˆ›å»ºæ•°é‡\nå…¶ä»–åŸå› ï¼š\nå®é™…ä¸­è¦æ ¹æ®è‡ªå·±æœºå™¨çš„æ€§èƒ½ã€ä¸šåŠ¡åœºæ™¯æ¥æ‰‹åŠ¨é…ç½®çº¿ç¨‹æ± å‚æ•°ï¼Œæ¯”å¦‚æ ¸å¿ƒçº¿ç¨‹æ•°ã€ä½¿ç”¨çš„ä»»åŠ¡é˜Ÿåˆ—ã€é¥±å’Œç­–ç•¥ ç»™çº¿ç¨‹æ± å‘½åï¼Œæ–¹ä¾¿å®šä½é—®é¢˜ 2. ç›‘æµ‹çº¿ç¨‹æ± è¿è¡ŒçŠ¶æ€ # å¯ä»¥é€šè¿‡ä¸€äº›æ‰‹æ®µæ£€æµ‹çº¿ç¨‹æ± è¿è¡ŒçŠ¶æ€ï¼Œæ¯”å¦‚SpringBootä¸­çš„Actuatorç»„ä»¶\næˆ–è€…åˆ©ç”¨ThreadPoolExecutorç›¸å…³çš„APIåšç®€é™‹ç›‘æ§ï¼ŒThreadPoolExecutoræä¾›äº†è·å–çº¿ç¨‹æ± å½“å‰çš„çº¿ç¨‹æ•°å’Œæ´»è·ƒçº¿ç¨‹æ•°ã€å·²ç»æ‰§è¡Œå®Œæˆçš„ä»»åŠ¡æ•°ï¼Œæ­£åœ¨æ’é˜Ÿä¸­çš„ä»»åŠ¡æ•°ç­‰\nç®€å•çš„demoï¼Œä½¿ç”¨ScheduleExecutorServiceå®šæ—¶æ‰“å°çº¿ç¨‹æ± ä¿¡æ¯\n/** * æ‰“å°çº¿ç¨‹æ± çš„çŠ¶æ€ * * @param threadPool çº¿ç¨‹æ± å¯¹è±¡ */ public static void printThreadPoolStatus(ThreadPoolExecutor threadPool) { ScheduledExecutorService scheduledExecutorService = new ScheduledThreadPoolExecutor(1, createThreadFactory(\u0026#34;print-images/thread-pool-status\u0026#34;, false)); scheduledExecutorService.scheduleAtFixedRate(() -\u0026gt; { log.info(\u0026#34;=========================\u0026#34;); log.info(\u0026#34;ThreadPool Size: [{}]\u0026#34;, threadPool.getPoolSize()); log.info(\u0026#34;Active Threads: {}\u0026#34;, threadPool.getActiveCount()); log.info(\u0026#34;Number of Tasks : {}\u0026#34;, threadPool.getCompletedTaskCount()); log.info(\u0026#34;Number of Tasks in Queue: {}\u0026#34;, threadPool.getQueue().size()); log.info(\u0026#34;=========================\u0026#34;); }, 0, 1, TimeUnit.SECONDS); } 3. å»ºè®®ä¸åŒç±»åˆ«çš„ä¸šåŠ¡ç”¨ä¸åŒçš„çº¿ç¨‹æ±  # å»ºè®®æ˜¯ä¸åŒçš„ä¸šåŠ¡ä½¿ç”¨ä¸åŒçš„çº¿ç¨‹æ± ï¼Œé…ç½®çº¿ç¨‹æ± çš„æ—¶å€™æ ¹æ®å½“å‰ä¸šåŠ¡çš„æƒ…å†µå¯¹å½“å‰çº¿ç¨‹æ± è¿›è¡Œé…ç½®ï¼Œå› ä¸ºä¸åŒçš„ä¸šåŠ¡çš„å¹¶å‘ä»¥åŠå¯¹èµ„æºçš„ä½¿ç”¨æƒ…å†µéƒ½ä¸åŒï¼Œé‡å¿ƒä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆç›¸å…³çš„ä¸šåŠ¡\næç«¯æƒ…å†µå¯¼è‡´æ­»é”ï¼š\nå‡å¦‚æˆ‘ä»¬çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º nï¼Œçˆ¶ä»»åŠ¡ï¼ˆæ‰£è´¹ä»»åŠ¡ï¼‰æ•°é‡ä¸º nï¼Œçˆ¶ä»»åŠ¡ä¸‹é¢æœ‰ä¸¤ä¸ªå­ä»»åŠ¡ï¼ˆæ‰£è´¹ä»»åŠ¡ä¸‹çš„å­ä»»åŠ¡ï¼‰ï¼Œå…¶ä¸­ä¸€ä¸ªå·²ç»æ‰§è¡Œå®Œæˆï¼Œå¦å¤–ä¸€ä¸ªè¢«æ”¾åœ¨äº†ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚ç”±äºçˆ¶ä»»åŠ¡æŠŠçº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹èµ„æºç”¨å®Œï¼Œæ‰€ä»¥å­ä»»åŠ¡å› ä¸ºæ— æ³•è·å–åˆ°çº¿ç¨‹èµ„æºæ— æ³•æ­£å¸¸æ‰§è¡Œï¼Œä¸€ç›´è¢«é˜»å¡åœ¨é˜Ÿåˆ—ä¸­ã€‚çˆ¶ä»»åŠ¡ç­‰å¾…å­ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œè€Œå­ä»»åŠ¡ç­‰å¾…çˆ¶ä»»åŠ¡é‡Šæ”¾çº¿ç¨‹æ± èµ„æºï¼Œè¿™ä¹Ÿå°±é€ æˆäº† \u0026ldquo;æ­»é”\u0026rdquo;ã€‚\n4. åˆ«å¿˜è®°ç»™çº¿ç¨‹æ± å‘½å # åˆå§‹åŒ–çº¿ç¨‹æ± æ—¶æ˜¾ç¤ºå‘½åï¼ˆè®¾ç½®çº¿ç¨‹æ± åç§°å‰ç¼€ï¼‰ï¼Œæœ‰åˆ©äºå®šä½é—®é¢˜\nåˆ©ç”¨guavaçš„ThreadFactoryBuilder\nThreadFactory threadFactory = new ThreadFactoryBuilder() .setNameFormat(threadNamePrefix + \u0026#34;-%d\u0026#34;) .setDaemon(true).build(); ExecutorService threadPool = new ThreadPoolExecutor(corePoolSize, maximumPoolSize, keepAliveTime, TimeUnit.MINUTES, workQueue, threadFactory) è‡ªå·±å®ç°ThreadFactor\nimport java.util.concurrent.Executors; import java.util.concurrent.ThreadFactory; import java.util.concurrent.atomic.AtomicInteger; /** * çº¿ç¨‹å·¥å‚ï¼Œå®ƒè®¾ç½®çº¿ç¨‹åç§°ï¼Œæœ‰åˆ©äºæˆ‘ä»¬å®šä½é—®é¢˜ã€‚ */ public final class NamingThreadFactory implements ThreadFactory { private final AtomicInteger threadNum = new AtomicInteger(); private final ThreadFactory delegate; private final String name; /** * åˆ›å»ºä¸€ä¸ªå¸¦åå­—çš„çº¿ç¨‹æ± ç”Ÿäº§å·¥å‚ */ public NamingThreadFactory(ThreadFactory delegate, String name) { this.delegate = delegate; this.name = name; // TODO consider uniquifying this } @Override public Thread newThread(Runnable r) { Thread t = delegate.newThread(r); t.setName(name + \u0026#34; [#\u0026#34; + threadNum.incrementAndGet() + \u0026#34;]\u0026#34;); return t; } } 5. æ­£ç¡®é…ç½®çº¿ç¨‹æ± å‚æ•° # å¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¤ªå¤šï¼Œå°±ä¼šå¢åŠ ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æˆæœ¬\nå¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ä¸€èˆ¬çº¿ç¨‹çš„ä¸ªæ•°éƒ½å¤§äº CPU æ ¸å¿ƒçš„ä¸ªæ•°ï¼Œè€Œä¸€ä¸ª CPU æ ¸å¿ƒåœ¨ä»»æ„æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œä¸ºäº†è®©è¿™äº›çº¿ç¨‹éƒ½èƒ½å¾—åˆ°æœ‰æ•ˆæ‰§è¡Œï¼ŒCPU é‡‡å–çš„ç­–ç•¥æ˜¯ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…æ—¶é—´ç‰‡å¹¶è½®è½¬çš„å½¢å¼ã€‚å½“ä¸€ä¸ªçº¿ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œçš„æ—¶å€™å°±ä¼šé‡æ–°å¤„äºå°±ç»ªçŠ¶æ€è®©ç»™å…¶ä»–çº¿ç¨‹ä½¿ç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å±äºä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚æ¦‚æ‹¬æ¥è¯´å°±æ˜¯ï¼šå½“å‰ä»»åŠ¡åœ¨æ‰§è¡Œå®Œ CPU æ—¶é—´ç‰‡åˆ‡æ¢åˆ°å¦ä¸€ä¸ªä»»åŠ¡ä¹‹å‰ä¼šå…ˆä¿å­˜è‡ªå·±çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡å†åˆ‡æ¢å›è¿™ä¸ªä»»åŠ¡æ—¶ï¼Œå¯ä»¥å†åŠ è½½è¿™ä¸ªä»»åŠ¡çš„çŠ¶æ€ã€‚ä»»åŠ¡ä»ä¿å­˜åˆ°å†åŠ è½½çš„è¿‡ç¨‹å°±æ˜¯ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚\nä¸Šä¸‹æ–‡åˆ‡æ¢é€šå¸¸æ˜¯è®¡ç®—å¯†é›†å‹çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒéœ€è¦ç›¸å½“å¯è§‚çš„å¤„ç†å™¨æ—¶é—´ï¼Œåœ¨æ¯ç§’å‡ åä¸Šç™¾æ¬¡çš„åˆ‡æ¢ä¸­ï¼Œæ¯æ¬¡åˆ‡æ¢éƒ½éœ€è¦çº³ç§’é‡çº§çš„æ—¶é—´ã€‚æ‰€ä»¥ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢å¯¹ç³»ç»Ÿæ¥è¯´æ„å‘³ç€æ¶ˆè€—å¤§é‡çš„ CPU æ—¶é—´ï¼Œäº‹å®ä¸Šï¼Œå¯èƒ½æ˜¯æ“ä½œç³»ç»Ÿä¸­æ—¶é—´æ¶ˆè€—æœ€å¤§çš„æ“ä½œã€‚\nLinux ç›¸æ¯”ä¸å…¶ä»–æ“ä½œç³»ç»Ÿï¼ˆåŒ…æ‹¬å…¶ä»–ç±» Unix ç³»ç»Ÿï¼‰æœ‰å¾ˆå¤šçš„ä¼˜ç‚¹ï¼Œå…¶ä¸­æœ‰ä¸€é¡¹å°±æ˜¯ï¼Œå…¶ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œæ¨¡å¼åˆ‡æ¢çš„æ—¶é—´æ¶ˆè€—éå¸¸å°‘ã€‚\nè¿‡å¤§è·Ÿè¿‡å°éƒ½ä¸è¡Œ\nå¦‚æœæˆ‘ä»¬è®¾ç½®çš„çº¿ç¨‹æ± æ•°é‡å¤ªå°çš„è¯ï¼Œå¦‚æœåŒä¸€æ—¶é—´æœ‰å¤§é‡ä»»åŠ¡/è¯·æ±‚éœ€è¦å¤„ç†ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤§é‡çš„è¯·æ±‚/ä»»åŠ¡åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…æ‰§è¡Œï¼Œç”šè‡³ä¼šå‡ºç°ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ä¹‹åä»»åŠ¡/è¯·æ±‚æ— æ³•å¤„ç†çš„æƒ…å†µï¼Œæˆ–è€…å¤§é‡ä»»åŠ¡å †ç§¯åœ¨ä»»åŠ¡é˜Ÿåˆ—å¯¼è‡´ OOM è®¾ç½®çº¿ç¨‹æ•°é‡å¤ªå¤§ï¼Œå¤§é‡çº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶åœ¨äº‰å– CPU èµ„æºï¼Œè¿™æ ·ä¼šå¯¼è‡´å¤§é‡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»è€Œå¢åŠ çº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´ï¼Œå½±å“äº†æ•´ä½“æ‰§è¡Œæ•ˆç‡ ç®€å•ä¸”é€‚ç”¨é¢è¾ƒå¹¿çš„å…¬å¼\nCPU å¯†é›†å‹ä»»åŠ¡(N+1)ï¼š è¿™ç§ä»»åŠ¡æ¶ˆè€—çš„ä¸»è¦æ˜¯ CPU èµ„æºï¼Œå¯ä»¥å°†çº¿ç¨‹æ•°è®¾ç½®ä¸º Nï¼ˆCPU æ ¸å¿ƒæ•°ï¼‰+1ï¼Œæ¯” CPU æ ¸å¿ƒæ•°å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹æ˜¯ä¸ºäº†é˜²æ­¢çº¿ç¨‹å¶å‘çš„ç¼ºé¡µä¸­æ–­ï¼Œæˆ–è€…å…¶å®ƒåŸå› å¯¼è‡´çš„ä»»åŠ¡æš‚åœè€Œå¸¦æ¥çš„å½±å“ã€‚ä¸€æ—¦ä»»åŠ¡æš‚åœï¼ŒCPU å°±ä¼šå¤„äºç©ºé—²çŠ¶æ€ï¼Œè€Œåœ¨è¿™ç§æƒ…å†µä¸‹å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å……åˆ†åˆ©ç”¨ CPU çš„ç©ºé—²æ—¶é—´ã€‚\nI/O å¯†é›†å‹ä»»åŠ¡(2N)ï¼š è¿™ç§ä»»åŠ¡åº”ç”¨èµ·æ¥ï¼Œç³»ç»Ÿä¼šç”¨å¤§éƒ¨åˆ†çš„æ—¶é—´æ¥å¤„ç† I/O äº¤äº’ï¼Œè€Œçº¿ç¨‹åœ¨å¤„ç† I/O çš„æ—¶é—´æ®µå†…ä¸ä¼šå ç”¨ CPU æ¥å¤„ç†ï¼Œè¿™æ—¶å°±å¯ä»¥å°† CPU äº¤å‡ºç»™å…¶å®ƒçº¿ç¨‹ä½¿ç”¨ã€‚å› æ­¤åœ¨ I/O å¯†é›†å‹ä»»åŠ¡çš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¤šé…ç½®ä¸€äº›çº¿ç¨‹ï¼Œå…·ä½“çš„è®¡ç®—æ–¹æ³•æ˜¯ 2Nã€‚\nå¦‚ä½•åˆ¤æ–­æ˜¯CPUå¯†é›†ä»»åŠ¡è¿˜æ˜¯IOå¯†é›†ä»»åŠ¡\nCPU å¯†é›†å‹ç®€å•ç†è§£å°±æ˜¯åˆ©ç”¨ CPU è®¡ç®—èƒ½åŠ›çš„ä»»åŠ¡æ¯”å¦‚ä½ åœ¨å†…å­˜ä¸­å¯¹å¤§é‡æ•°æ®è¿›è¡Œæ’åºã€‚ä½†å‡¡æ¶‰åŠåˆ°ç½‘ç»œè¯»å–ï¼Œæ–‡ä»¶è¯»å–è¿™ç±»éƒ½æ˜¯ IO å¯†é›†å‹ï¼Œè¿™ç±»ä»»åŠ¡çš„ç‰¹ç‚¹æ˜¯ CPU è®¡ç®—è€—è´¹æ—¶é—´ç›¸æ¯”äºç­‰å¾… IO æ“ä½œå®Œæˆçš„æ—¶é—´æ¥è¯´å¾ˆå°‘ï¼Œå¤§éƒ¨åˆ†æ—¶é—´éƒ½èŠ±åœ¨äº†ç­‰å¾… IO æ“ä½œå®Œæˆä¸Šã€‚\nç¾å›¢çº¿ç¨‹æ± çš„å¤„ç† ä¸»è¦å¯¹çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°å®ç°è‡ªå®šä¹‰å¯é…ç½®\ncorePoolSize : æ ¸å¿ƒçº¿ç¨‹æ•°çº¿ç¨‹æ•°å®šä¹‰äº†æœ€å°å¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡ã€‚ maximumPoolSize : å½“é˜Ÿåˆ—ä¸­å­˜æ”¾çš„ä»»åŠ¡è¾¾åˆ°é˜Ÿåˆ—å®¹é‡çš„æ—¶å€™ï¼Œå½“å‰å¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡å˜ä¸ºæœ€å¤§çº¿ç¨‹æ•°ã€‚ workQueue: å½“æ–°ä»»åŠ¡æ¥çš„æ—¶å€™ä¼šå…ˆåˆ¤æ–­å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°é‡æ˜¯å¦è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¦‚æœè¾¾åˆ°çš„è¯ï¼Œæ–°ä»»åŠ¡å°±ä¼šè¢«å­˜æ”¾åœ¨é˜Ÿåˆ—ä¸­ å‚æ•°åŠ¨æ€é…ç½® æ ¼å¤–éœ€è¦æ³¨æ„çš„æ˜¯corePoolSizeï¼Œ ç¨‹åºè¿è¡ŒæœŸé—´çš„æ—¶å€™ï¼Œæˆ‘ä»¬è°ƒç”¨ setCorePoolSizeï¼ˆï¼‰è¿™ä¸ªæ–¹æ³•çš„è¯ï¼Œçº¿ç¨‹æ± ä¼šé¦–å…ˆåˆ¤æ–­å½“å‰å·¥ä½œçº¿ç¨‹æ•°æ˜¯å¦å¤§äºcorePoolSizeï¼Œå¦‚æœå¤§äºçš„è¯å°±ä¼šå›æ”¶å·¥ä½œçº¿ç¨‹ã€‚ã€ThreadPoolExecutoré‡Œé¢çš„ã€‘ å¦å¤–ï¼Œä½ ä¹Ÿçœ‹åˆ°äº†ä¸Šé¢å¹¶æ²¡æœ‰åŠ¨æ€æŒ‡å®šé˜Ÿåˆ—é•¿åº¦çš„æ–¹æ³•ï¼Œç¾å›¢çš„æ–¹å¼æ˜¯è‡ªå®šä¹‰äº†ä¸€ä¸ªå«åš ResizableCapacityLinkedBlockIngQueue çš„é˜Ÿåˆ—ï¼ˆä¸»è¦å°±æ˜¯æŠŠLinkedBlockingQueueçš„ capacity å­—æ®µçš„ final å…³é”®å­—ä¿®é¥°ç»™å»æ‰äº†ï¼Œè®©å®ƒå˜ä¸ºå¯å˜çš„ï¼‰ "},{"id":133,"href":"/zh/docs/study/Review/java_guide/java/Concurrent/ly0305lyjava-thread-pool/","title":"javaçº¿ç¨‹æ± è¯¦è§£","section":"å¹¶å‘","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nä¸€ ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„ # æ± åŒ–æŠ€æœ¯ï¼šå‡å°‘æ¯æ¬¡è·å–èµ„æºçš„æ¶ˆè€—ï¼Œæé«˜å¯¹èµ„æºçš„åˆ©ç”¨ç‡ çº¿ç¨‹æ± æä¾›ä¸€ç§é™åˆ¶å’Œç®¡ç†èµ„æºï¼ˆåŒ…æ‹¬æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼‰çš„æ–¹å¼ï¼Œæ¯ä¸ªçº¿ç¨‹æ± è¿˜ç»´æŠ¤ä¸€äº›åŸºæœ¬ç»Ÿè®¡ä¿¡æ¯ï¼Œä¾‹å¦‚å·²å®Œæˆä»»åŠ¡çš„æ•°é‡ çº¿ç¨‹æ± çš„å¥½å¤„ é™ä½èµ„æºæ¶ˆè€—ï¼ˆé‡å¤åˆ©ç”¨ï¼Œé™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ï¼‰ æé«˜å“åº”é€Ÿåº¦ï¼ˆä»»åŠ¡åˆ°è¾¾ç›´æ¥æ‰§è¡Œï¼Œæ— éœ€ç­‰å¾…çº¿ç¨‹åˆ›å»ºï¼‰ æé«˜çº¿ç¨‹å¯ç®¡ç†æ€§ï¼ˆé¿å…æ— ä¼‘æ­¢åˆ›å»ºï¼Œä½¿ç”¨çº¿ç¨‹æ± ç»Ÿä¸€åˆ†é…ã€è°ƒä¼˜ã€ç›‘æ§ï¼‰ äºŒ Executoræ¡†æ¶ # Java5ä¹‹åï¼Œé€šè¿‡Executorå¯åŠ¨çº¿ç¨‹ï¼Œæ¯”ä½¿ç”¨Threadçš„startæ–¹æ³•æ›´å¥½ï¼Œæ›´æ˜“äºç®¡ç†ï¼Œæ•ˆç‡é«˜ï¼Œè¿˜èƒ½æœ‰åŠ©äºé¿å…thisé€ƒé€¸çš„é—®é¢˜\nthisé€ƒé€¸ï¼ŒæŒ‡çš„æ˜¯æ„é€ å‡½æ•°è¿”å›ä¹‹å‰ï¼Œå…¶ä»–çº¿ç¨‹å°±æŒæœ‰è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼Œä¼šå¯¼è‡´è°ƒç”¨å°šæœªæ„é€ å®Œå…¨çš„å¯¹è±¡\nä¾‹å­ï¼š\npublic class ThisEscape { public ThisEscape() { new Thread(new EscapeRunnable()).start(); // ... } private class EscapeRunnable implements Runnable { @Override public void run() { // é€šè¿‡ThisEscape.thiså°±å¯ä»¥å¼•ç”¨å¤–å›´ç±»å¯¹è±¡, ä½†æ˜¯æ­¤æ—¶å¤–å›´ç±»å¯¹è±¡å¯èƒ½è¿˜æ²¡æœ‰æ„é€ å®Œæˆ, å³å‘ç”Ÿäº†å¤–å›´ç±»çš„thiså¼•ç”¨çš„é€ƒé€¸ } } } å¤„ç†åŠæ³• //ä¸è¦åœ¨æ„é€ å‡½æ•°ä¸­è¿è¡Œçº¿ç¨‹\npublic class ThisEscape { private Thread t; public ThisEscape() { t = new Thread(new EscapeRunnable()); // ... } public void init() { //ä¹Ÿå°±æ˜¯è¯´å¯¹è±¡æ²¡æœ‰æ„é€ å®Œæˆå‰ï¼Œä¸è¦è°ƒç”¨ThisEscape.thiså³å¯ t.start(); } private class EscapeRunnable implements Runnable { @Override public void run() { // é€šè¿‡ThisEscape.thiså°±å¯ä»¥å¼•ç”¨å¤–å›´ç±»å¯¹è±¡, æ­¤æ—¶å¯ä»¥ä¿è¯å¤–å›´ç±»å¯¹è±¡å·²ç»æ„é€ å®Œæˆ } } } Executoræ¡†æ¶ä¸ä»…åŒ…æ‹¬çº¿ç¨‹æ± çš„ç®¡ç†ï¼Œæä¾›çº¿ç¨‹å·¥å‚ã€é˜Ÿåˆ—ä»¥åŠæ‹’ç»ç­–ç•¥ã€‚\nExecutoræ¡†æ¶ç»“æ„ # ä¸»è¦æ˜¯ä¸‰å¤§éƒ¨åˆ†ï¼šä»»åŠ¡ï¼ˆRunnable/Callableï¼‰ï¼Œä»»åŠ¡çš„æ‰§è¡Œ(Executor)ï¼Œå¼‚æ­¥è®¡ç®—çš„ç»“æœFuture\nä»»åŠ¡ æ‰§è¡Œçš„ä»»åŠ¡éœ€è¦çš„Runnable/Callableæ¥å£ï¼Œä»–ä»¬çš„å®ç°ç±»ï¼Œéƒ½å¯ä»¥è¢«ThreadPoolExecutoræˆ–ScheduleThreadPoolExecutoræ‰§è¡Œ\nä»»åŠ¡çš„æ‰§è¡Œ æˆ‘ä»¬æ›´å¤šå…³æ³¨çš„ï¼Œæ˜¯ThreadPoolExecutorç±»ã€‚å¦å¤–ï¼ŒScheduledThreadPoolExecutorç±»ï¼Œç»§æ‰¿äº†ThreadPoolExecutorç±»ï¼Œå¹¶å®ç°äº†ScheduledExecutorServiceæ¥å£\n//ThreadPoolExecutorç±»æè¿° //AbstractExecutorServiceå®ç°äº†ExecutorServiceæ¥å£ public class ThreadPoolExecutor extends AbstractExecutorService{} //ScheduledThreadPoolExecutorç±»æè¿° //ScheduledExecutorServiceç»§æ‰¿ExecutorServiceæ¥å£ public class ScheduledThreadPoolExecutor extends ThreadPoolExecutor implements ScheduledExecutorService {} å¼‚æ­¥è®¡ç®—çš„ç»“æœ Futureæ¥å£ä»¥åŠå…¶å®ç°ç±»FutueTaskç±»éƒ½å¯ä»¥ä»£è¡¨å¼‚æ­¥è®¡ç®—çš„ç»“æœ(ä¸‹é¢å°±æ˜¯Futureæ¥å£) å½“æˆ‘ä»¬æŠŠRunnableæ¥å£ï¼ˆç»“æœä¸ºnullï¼‰æˆ–Callableæ¥å£çš„å®ç°ç±»æäº¤ç»™ThreadPoolExecutoræˆ–ScheduledThreadPoolExecutoræ‰§è¡Œï¼ˆï¼‰\nExecutorService executorService = Executors.newCachedThreadPool(); Callable\u0026lt;MyClass\u0026gt; myClassCallable = new Callable\u0026lt;MyClass\u0026gt;() { public MyClass call() throws Exception { MyClass myClass1 = new MyClass(); myClass1.setName(\u0026#34;ly-callable-æµ‹è¯•\u0026#34;); TimeUnit.SECONDS.sleep(2); return myClass1; } }; Future\u0026lt;?\u0026gt; submit = executorService.submit(myClassCallable); //è¿™é‡Œä¼šé˜»å¡ Object o = submit.get(); log.info(\u0026#34;ly-callable-æ‰“å°ç»“æœ1:\u0026#34; + o); FutureTask\u0026lt;MyClass\u0026gt; futureTask = new FutureTask\u0026lt;\u0026gt;(() -\u0026gt; { MyClass myClass1 = new MyClass(); myClass1.setName(\u0026#34;ly-FutureTask-æµ‹è¯•\u0026#34;); TimeUnit.SECONDS.sleep(2); return myClass1; }); Future\u0026lt;?\u0026gt; submit2 = executorService.submit(futureTask); //è¿™é‡Œä¼šé˜»å¡ Object o2 = submit2.get(); log.info(\u0026#34;ly-callable-æ‰“å°ç»“æœ2:\u0026#34; + o2); executorService.shutdown(); /*ç»“æœ 2022-11-09 10:19:10 ä¸Šåˆ [Thread: main] INFO:ly-callable-æ‰“å°ç»“æœ1:MyClass(name=ly-callable-æµ‹è¯•) 2022-11-09 10:19:12 ä¸Šåˆ [Thread: main] INFO:ly-callable-æ‰“å°ç»“æœ2:null */ Executoræ¡†æ¶çš„ä½¿ç”¨ç¤ºæ„å›¾ # ä¸»çº¿ç¨‹é¦–å…ˆè¦åˆ›å»ºå®ç° Runnable æˆ–è€… Callable æ¥å£çš„ä»»åŠ¡å¯¹è±¡ã€‚\næŠŠåˆ›å»ºå®Œæˆçš„å®ç° Runnable/Callableæ¥å£çš„ å¯¹è±¡ç›´æ¥äº¤ç»™ ExecutorService æ‰§è¡Œ: ExecutorService.executeï¼ˆRunnable commandï¼‰ï¼‰æˆ–è€…ä¹Ÿå¯ä»¥æŠŠ Runnable å¯¹è±¡æˆ–Callable å¯¹è±¡æäº¤ç»™ ExecutorService æ‰§è¡Œï¼ˆExecutorService.submitï¼ˆRunnable taskï¼‰æˆ– ExecutorService.submitï¼ˆCallable \u0026lt;T\u0026gt; taskï¼‰ï¼‰ã€‚\nå¦‚æœæ‰§è¡Œ ExecutorService.submitï¼ˆâ€¦ï¼‰ï¼ŒExecutorService å°†è¿”å›ä¸€ä¸ªå®ç°Futureæ¥å£çš„å¯¹è±¡ï¼ˆæˆ‘ä»¬åˆšåˆšä¹Ÿæåˆ°è¿‡äº†æ‰§è¡Œ execute()æ–¹æ³•å’Œ submit()æ–¹æ³•çš„åŒºåˆ«ï¼Œsubmit()ä¼šè¿”å›ä¸€ä¸ª FutureTask å¯¹è±¡ï¼‰ã€‚ç”±äº FutureTask å®ç°äº† Runnableï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»º FutureTaskï¼Œç„¶åç›´æ¥äº¤ç»™ ExecutorService æ‰§è¡Œï¼ˆFutureTaskå®ç°äº†Runnableï¼Œä¸æ˜¯ä¸€ä¸ªCallable æ‰€ä»¥ç›´æ¥ä½¿ç”¨future.get()è·å–çš„æ˜¯nullï¼‰ã€‚\npublic class MyMain { private byte[] x = new byte[10 * 1024 * 1024];//10M public static void main(String[] args) throws Exception { Callable\u0026lt;Object\u0026gt; abc = Executors.callable(() -\u0026gt; { try { TimeUnit.SECONDS.sleep(2); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(\u0026#34;aaa\u0026#34;);//è¾“å‡ºaaa }, \u0026#34;abcccc\u0026#34;);//å¦‚æœæ²¡æœ‰\u0026#34;abcccc\u0026#34;ï¼Œåˆ™ä¸‹é¢è¾“å‡ºnull FutureTask\u0026lt;Object\u0026gt; futureTask = new FutureTask\u0026lt;\u0026gt;(abc); /*new Thread(futureTask).start(); Object o = futureTask.get(); System.out.println(\u0026#34;è·å–å€¼ï¼š\u0026#34;+o); //è¾“å‡ºabc */ ExecutorService executorService = Executors.newSingleThreadExecutor(); Future\u0026lt;?\u0026gt; future = executorService.submit(futureTask); Future\u0026lt;?\u0026gt; future1 = executorService.submit(new Callable\u0026lt;String\u0026gt;() { @Override public String call() throws Exception { try { TimeUnit.SECONDS.sleep(2); } catch (InterruptedException e) { e.printStackTrace(); } return \u0026#34;hello\u0026#34;; } }); /*System.out.println(future.get());//è¾“å‡ºnull*/ System.out.println(future1.get()); //è¾“å‡ºhello //System.out.println(futureTask.get());//è¾“å‡ºabcccc System.out.println(\u0026#34;é˜»å¡ç»“æŸ\u0026#34;); executorService.shutdown(); } } æœ€åï¼Œä¸»çº¿ç¨‹å¯ä»¥æ‰§è¡Œ FutureTask.get()æ–¹æ³•æ¥ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚ä¸»çº¿ç¨‹ä¹Ÿå¯ä»¥æ‰§è¡Œ FutureTask.cancelï¼ˆboolean mayInterruptIfRunningï¼‰æ¥å–æ¶ˆæ­¤ä»»åŠ¡çš„æ‰§è¡Œã€‚\nä¸‰ (é‡è¦)ThreadPoolExecutorç±»ç®€å•ä»‹ç» # çº¿ç¨‹æ± å®ç°ç±» ThreadPoolExecutor æ˜¯ Executor æ¡†æ¶æœ€æ ¸å¿ƒçš„ç±»ã€‚\nThreadPoolExecutorç±»åˆ†æ # è¿™é‡Œçœ‹æœ€é•¿çš„é‚£ä¸ªï¼Œå…¶ä½™ä¸‰ä¸ªéƒ½æ˜¯åœ¨è¯¥æ„é€ æ–¹æ³•çš„åŸºç¡€ä¸Šäº§ç”Ÿï¼Œå³ç»™å®šæŸäº›é»˜è®¤å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œæ¯”å¦‚é»˜è®¤çš„æ‹’ç»ç­–ç•¥\n/** * ç”¨ç»™å®šçš„åˆå§‹å‚æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ThreadPoolExecutorã€‚ */ public ThreadPoolExecutor(int corePoolSize,//çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°é‡ int maximumPoolSize,//çº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•° long keepAliveTime,//å½“çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œå¤šä½™çš„ç©ºé—²çº¿ç¨‹å­˜æ´»çš„æœ€é•¿æ—¶é—´ TimeUnit unit,//æ—¶é—´å•ä½ BlockingQueue\u0026lt;Runnable\u0026gt; workQueue,//ä»»åŠ¡é˜Ÿåˆ—ï¼Œç”¨æ¥å‚¨å­˜ç­‰å¾…æ‰§è¡Œä»»åŠ¡çš„é˜Ÿåˆ— ThreadFactory threadFactory,//çº¿ç¨‹å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºçº¿ç¨‹ï¼Œä¸€èˆ¬é»˜è®¤å³å¯ RejectedExecutionHandler handler//æ‹’ç»ç­–ç•¥ï¼Œå½“æäº¤çš„ä»»åŠ¡è¿‡å¤šè€Œä¸èƒ½åŠæ—¶å¤„ç†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶ç­–ç•¥æ¥å¤„ç†ä»»åŠ¡ ) { if (corePoolSize \u0026lt; 0 || maximumPoolSize \u0026lt;= 0 || maximumPoolSize \u0026lt; corePoolSize || keepAliveTime \u0026lt; 0) throw new IllegalArgumentException(); if (workQueue == null || threadFactory == null || handler == null) throw new NullPointerException(); this.corePoolSize = corePoolSize; this.maximumPoolSize = maximumPoolSize; this.workQueue = workQueue; this.keepAliveTime = unit.toNanos(keepAliveTime); this.threadFactory = threadFactory; this.handler = handler; } ThreadPoolExecutorä¸­ï¼Œ3ä¸ªæœ€é‡è¦çš„å‚æ•°\ncorePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå®šä¹‰äº†æœ€å°å¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡ maximumPoolSizeï¼šå½“é˜Ÿåˆ—ä¸­å­˜æ”¾çš„ä»»åŠ¡è¾¾åˆ°é˜Ÿåˆ—å®¹é‡æ—¶ï¼Œå½“å‰å¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡å˜ä¸ºæœ€å¤§çº¿ç¨‹æ•° workQueueï¼šå½“æ–°ä»»åŠ¡æ¥çš„æ—¶å€™ï¼Œä¼šå…ˆåˆ¤æ–­å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°é‡æ˜¯å¦è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¦‚æœè¾¾åˆ°çš„è¯ï¼Œæ–°ä»»åŠ¡å°±ä¼šè¢«å­˜æ”¾åœ¨é˜Ÿåˆ—ä¸­ ThreadPoolExecutorå…¶ä»–å¸¸è§å‚æ•°\nkeepAliveTimeï¼šå½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºcorePoolSizeæ—¶ï¼Œå¦‚æœæ­¤æ—¶æ²¡æœ‰æ–°ä»»åŠ¡æäº¤ï¼Œæ ¸å¿ƒçº¿ç¨‹å¤–çš„çº¿ç¨‹ä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ï¼Œç›´åˆ°ç­‰å¾…æ—¶é—´è¶…è¿‡äº†keepAliveTimeæ‰ä¼šè¢«å›æ”¶é”€æ¯ unitï¼škeepAliveTimeå‚æ•°çš„æ—¶é—´å•ä½ threadFactoryï¼šexecutoråˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶å€™ä¼šç”¨åˆ° handlerï¼šé¥±å’Œç­–ç•¥ çº¿ç¨‹æ± å„ä¸ªå‚æ•°çš„ç›¸äº’å…³ç³»çš„ç†è§£\nThreadPoolExecutoré¥±å’Œç­–ç•¥å®šä¹‰ å¦‚æœå½“å‰åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°é‡å¹¶ä¸”é˜Ÿåˆ—ä¹Ÿå·²ç»è¢«æ”¾æ»¡äº†ä»»åŠ¡æ—¶ï¼ŒThreadPoolTaskExecutorå®šä¹‰äº†ä¸€äº›ç­–ç•¥ï¼š\nThreadPoolExecutor.AbortPolicy ï¼šæŠ›å‡º RejectedExecutionExceptionæ¥æ‹’ç»æ–°ä»»åŠ¡çš„å¤„ç†ã€‚ ThreadPoolExecutor.CallerRunsPolicy ï¼šè°ƒç”¨æ‰§è¡Œè‡ªå·±çš„çº¿ç¨‹è¿è¡Œä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥åœ¨è°ƒç”¨executeæ–¹æ³•çš„çº¿ç¨‹ä¸­è¿è¡Œ(run)è¢«æ‹’ç»çš„ä»»åŠ¡ï¼Œå¦‚æœæ‰§è¡Œç¨‹åºå·²å…³é—­ï¼Œåˆ™ä¼šä¸¢å¼ƒè¯¥ä»»åŠ¡ã€‚å› æ­¤è¿™ç§ç­–ç•¥ä¼šé™ä½å¯¹äºæ–°ä»»åŠ¡æäº¤é€Ÿåº¦ï¼Œå½±å“ç¨‹åºçš„æ•´ä½“æ€§èƒ½ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥æ‰¿å—æ­¤å»¶è¿Ÿå¹¶ä¸”ä½ è¦æ±‚ä»»ä½•ä¸€ä¸ªä»»åŠ¡è¯·æ±‚éƒ½è¦è¢«æ‰§è¡Œçš„è¯ï¼Œä½ å¯ä»¥é€‰æ‹©è¿™ä¸ªç­–ç•¥ã€‚ ThreadPoolExecutor.DiscardPolicy ï¼šä¸å¤„ç†æ–°ä»»åŠ¡ï¼Œç›´æ¥ä¸¢å¼ƒæ‰ã€‚ ThreadPoolExecutor.DiscardOldestPolicy ï¼š æ­¤ç­–ç•¥å°†ä¸¢å¼ƒæœ€æ—©çš„æœªå¤„ç†çš„ä»»åŠ¡è¯·æ±‚ã€‚ ä¸¾ä¾‹ï¼š Spring é€šè¿‡ ThreadPoolTaskExecutor æˆ–è€…æˆ‘ä»¬ç›´æ¥é€šè¿‡ ThreadPoolExecutor çš„æ„é€ å‡½æ•°åˆ›å»ºçº¿ç¨‹æ± çš„æ—¶å€™ï¼Œå½“æˆ‘ä»¬ä¸æŒ‡å®š RejectedExecutionHandler é¥±å’Œç­–ç•¥çš„è¯æ¥é…ç½®çº¿ç¨‹æ± çš„æ—¶å€™é»˜è®¤ä½¿ç”¨çš„æ˜¯ ThreadPoolExecutor.AbortPolicyã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒThreadPoolExecutor å°†æŠ›å‡º RejectedExecutionException æ¥æ‹’ç»æ–°æ¥çš„ä»»åŠ¡ ï¼Œè¿™ä»£è¡¨ä½ å°†ä¸¢å¤±å¯¹è¿™ä¸ªä»»åŠ¡çš„å¤„ç†ã€‚ å¯¹äºå¯ä¼¸ç¼©çš„åº”ç”¨ç¨‹åºï¼Œå»ºè®®ä½¿ç”¨ ThreadPoolExecutor.CallerRunsPolicyã€‚å½“æœ€å¤§æ± è¢«å¡«æ»¡æ—¶ï¼Œæ­¤ç­–ç•¥ä¸ºæˆ‘ä»¬æä¾›å¯ä¼¸ç¼©é˜Ÿåˆ—ã€‚ï¼ˆè¿™ä¸ªç›´æ¥æŸ¥çœ‹ ThreadPoolExecutor çš„æ„é€ å‡½æ•°æºç å°±å¯ä»¥çœ‹å‡ºï¼Œæ¯”è¾ƒç®€å•çš„åŸå› ï¼Œè¿™é‡Œå°±ä¸è´´ä»£ç äº†ã€‚\næ¨èä½¿ç”¨ ThreadPoolExecutor æ„é€ å‡½æ•°åˆ›å»ºçº¿ç¨‹æ±  # é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ\u0026quot;å¹¶å‘å¤„ç†\u0026quot;è¿™ä¸€ç« èŠ‚ï¼Œæ˜ç¡®æŒ‡å‡ºï¼Œçº¿ç¨‹èµ„æºå¿…é¡»é€šè¿‡çº¿ç¨‹æ± æä¾›ï¼Œä¸å…è®¸åœ¨åº”ç”¨ä¸­è‡ªè¡Œæ˜¾ç¤ºåˆ›å»ºçº¿ç¨‹\nåŸå› ï¼šä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„æ˜¯å‡å°‘åœ¨åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ä¸Šæ‰€æ¶ˆè€—çš„æ—¶é—´ä»¥åŠç³»ç»Ÿèµ„æºå¼€é”€ï¼Œè§£å†³èµ„æºä¸è¶³çš„é—®é¢˜ã€‚å¦‚æœä¸ä½¿ç”¨çº¿ç¨‹æ± ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆç³»ç»Ÿåˆ›å»ºå¤§é‡åŒç±»çº¿ç¨‹è€Œå¯¼è‡´æ¶ˆè€—å®Œå†…å­˜æˆ–è€…â€œè¿‡åº¦åˆ‡æ¢â€çš„é—®é¢˜ã€‚ä¹Ÿä¸å…è®¸ä½¿ç”¨Executorså»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ThreadPoolExecutoræ„é€ æ–¹å¼\nExecutorsè¿”å›çº¿ç¨‹æ± å¯¹è±¡çš„å¼Šç«¯ï¼š\nFixedThreadPoolå’ŒSingleThreadExecutorï¼šå…è®¸è¯·æ±‚çš„é˜Ÿåˆ—é•¿åº¦ä¸ºInteger.MAV_VALUE å¯èƒ½å †ç§¯å¤§é‡è¯·æ±‚ï¼Œå¯¼è‡´OOM CachedThreadPoolå’ŒScheduledThreadPoolï¼Œå…è®¸åˆ›å»ºçš„çº¿ç¨‹æ•°é‡ä¸ºInteger.MAX_VALUE å¯èƒ½åˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´OOM åˆ›å»ºçº¿ç¨‹çš„å‡ ç§æ–¹æ³•\né€šè¿‡ThreadPoolExecutoræ„é€ å‡½æ•°å®ç°ï¼ˆæ¨èï¼‰ é€šè¿‡Executorsæ¡†æ¶çš„å·¥å…·ç±»Executorsæ¥å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸‰çº¢ç±»å‹çš„ThreadPoolExecutor FixedThreadPoolã€SingleThreadExecutorã€CachedThreadPool å›› ThreadPoolExecutorä½¿ç”¨+åŸç†åˆ†æ # ç¤ºä¾‹ä»£ç ï¼šRunnable+ThreadPoolExecutor # å…ˆåˆ›å»ºä¸€ä¸ªRunnableæ¥å£çš„å®ç°ç±»\n//MyRunnable.java import java.util.Date; /** * è¿™æ˜¯ä¸€ä¸ªç®€å•çš„Runnableç±»ï¼Œéœ€è¦å¤§çº¦5ç§’é’Ÿæ¥æ‰§è¡Œå…¶ä»»åŠ¡ã€‚ * @author shuang.kou */ public class MyRunnable implements Runnable { private String command; public MyRunnable(String s) { this.command = s; } @Override public void run() { System.out.println(Thread.currentThread().getName() + \u0026#34; Start. Time = \u0026#34; + new Date()); processCommand(); System.out.println(Thread.currentThread().getName() + \u0026#34; End. Time = \u0026#34; + new Date()); } private void processCommand() { try { Thread.sleep(5000); } catch (InterruptedException e) { e.printStackTrace(); } } @Override public String toString() { return this.command; } } ä½¿ç”¨è‡ªå®šä¹‰çš„çº¿ç¨‹æ± \nimport java.util.concurrent.ArrayBlockingQueue; import java.util.concurrent.ThreadPoolExecutor; import java.util.concurrent.TimeUnit; public class ThreadPoolExecutorDemo { private static final int CORE_POOL_SIZE = 5; private static final int MAX_POOL_SIZE = 10; private static final int QUEUE_CAPACITY = 100; private static final Long KEEP_ALIVE_TIME = 1L; public static void main(String[] args) { //ä½¿ç”¨é˜¿é‡Œå·´å·´æ¨èçš„åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼ //é€šè¿‡ThreadPoolExecutoræ„é€ å‡½æ•°è‡ªå®šä¹‰å‚æ•°åˆ›å»º ThreadPoolExecutor executor = new ThreadPoolExecutor( CORE_POOL_SIZE, //5 MAX_POOL_SIZE, //10 KEEP_ALIVE_TIME, //1L TimeUnit.SECONDS, //å•ä½ new ArrayBlockingQueue\u0026lt;\u0026gt;(QUEUE_CAPACITY),//100 new ThreadPoolExecutor.CallerRunsPolicy()); //ä¸»çº¿ç¨‹ä¸­è¿è¡Œ for (int i = 0; i \u0026lt; 10; i++) { //åˆ›å»ºWorkerThreadå¯¹è±¡ï¼ˆWorkerThreadç±»å®ç°äº†Runnable æ¥å£ï¼‰ Runnable worker = new MyRunnable(\u0026#34;\u0026#34; + i); //æ‰§è¡ŒRunnable executor.execute(worker); } //ç»ˆæ­¢çº¿ç¨‹æ±  executor.shutdown(); // isTerminated åˆ¤æ–­æ‰€æœ‰æäº¤çš„ä»»åŠ¡æ˜¯å¦å®Œæˆ(ä¿è¯ä¹‹å‰è°ƒç”¨è¿‡shutdownæ–¹æ³•) while (!executor.isTerminated()) { } System.out.println(\u0026#34;Finished all threads\u0026#34;); } } //ç»“æœï¼š /* corePoolSize: æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º 5ã€‚ maximumPoolSize ï¼šæœ€å¤§çº¿ç¨‹æ•° 10 keepAliveTime : ç­‰å¾…æ—¶é—´ä¸º 1Lã€‚ unit: ç­‰å¾…æ—¶é—´çš„å•ä½ä¸º TimeUnit.SECONDSã€‚ workQueueï¼šä»»åŠ¡é˜Ÿåˆ—ä¸º ArrayBlockingQueueï¼Œå¹¶ä¸”å®¹é‡ä¸º 100; handler:é¥±å’Œç­–ç•¥ä¸º CallerRunsPolicy ---output--- pool-1-thread-3 Start. Time = Sun Apr 12 11:14:37 CST 2020 pool-1-thread-5 Start. Time = Sun Apr 12 11:14:37 CST 2020 pool-1-thread-2 Start. Time = Sun Apr 12 11:14:37 CST 2020 pool-1-thread-1 Start. Time = Sun Apr 12 11:14:37 CST 2020 pool-1-thread-4 Start. Time = Sun Apr 12 11:14:37 CST 2020 pool-1-thread-3 End. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-4 End. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-1 End. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-5 End. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-1 Start. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-2 End. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-5 Start. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-4 Start. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-3 Start. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-2 Start. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-1 End. Time = Sun Apr 12 11:14:47 CST 2020 pool-1-thread-4 End. Time = Sun Apr 12 11:14:47 CST 2020 pool-1-thread-5 End. Time = Sun Apr 12 11:14:47 CST 2020 pool-1-thread-3 End. Time = Sun Apr 12 11:14:47 CST 2020 pool-1-thread-2 End. Time = Sun Apr 12 11:14:47 CST 2020 ------ */ çº¿ç¨‹æ± åŸç†åˆ†æ # å¦‚ä¸Šï¼Œçº¿ç¨‹æ± é¦–å…ˆä¼šå…ˆæ‰§è¡Œ 5 ä¸ªä»»åŠ¡ï¼Œç„¶åè¿™äº›ä»»åŠ¡æœ‰ä»»åŠ¡è¢«æ‰§è¡Œå®Œçš„è¯ï¼Œå°±ä¼šå»æ‹¿æ–°çš„ä»»åŠ¡æ‰§è¡Œ\nexecuteæ–¹æ³•æºç \n// å­˜æ”¾çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ (runState) å’Œçº¿ç¨‹æ± å†…æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡ (workerCount) private final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0)); private static int workerCountOf(int c) { return c \u0026amp; CAPACITY; } //ä»»åŠ¡é˜Ÿåˆ— private final BlockingQueue\u0026lt;Runnable\u0026gt; workQueue; public void execute(Runnable command) { // å¦‚æœä»»åŠ¡ä¸ºnullï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ if (command == null) throw new NullPointerException(); // ctl ä¸­ä¿å­˜çš„çº¿ç¨‹æ± å½“å‰çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ int c = ctl.get(); // ä¸‹é¢ä¼šæ¶‰åŠåˆ° 3 æ­¥ æ“ä½œ // 1.é¦–å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ± ä¸­æ‰§è¡Œçš„ä»»åŠ¡æ•°é‡æ˜¯å¦å°äº corePoolSize // å¦‚æœå°äºçš„è¯ï¼Œé€šè¿‡addWorker(command, true)æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶å°†ä»»åŠ¡(command)æ·»åŠ åˆ°è¯¥çº¿ç¨‹ä¸­ï¼›ç„¶åï¼Œå¯åŠ¨è¯¥çº¿ç¨‹ä»è€Œæ‰§è¡Œä»»åŠ¡ã€‚ if (workerCountOf(c) \u0026lt; corePoolSize) { if (addWorker(command, true)) return; c = ctl.get(); } // 2.å¦‚æœå½“å‰æ‰§è¡Œçš„ä»»åŠ¡æ•°é‡å¤§äºç­‰äº corePoolSize çš„æ—¶å€™å°±ä¼šèµ°åˆ°è¿™é‡Œ // é€šè¿‡ isRunning æ–¹æ³•åˆ¤æ–­çº¿ç¨‹æ± çŠ¶æ€ï¼Œçº¿ç¨‹æ± å¤„äº RUNNING çŠ¶æ€å¹¶ä¸”é˜Ÿåˆ—å¯ä»¥åŠ å…¥ä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡æ‰ä¼šè¢«åŠ å…¥è¿›å» if (isRunning(c) \u0026amp;\u0026amp; workQueue.offer(command)) { int recheck = ctl.get(); // å†æ¬¡è·å–çº¿ç¨‹æ± çŠ¶æ€ï¼Œå¦‚æœçº¿ç¨‹æ± çŠ¶æ€ä¸æ˜¯ RUNNING çŠ¶æ€å°±éœ€è¦ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­ç§»é™¤ä»»åŠ¡ï¼Œå¹¶å°è¯•åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚åŒæ—¶æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚ if (!isRunning(recheck) \u0026amp;\u0026amp; remove(command)) reject(command); // å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸ºç©ºå°±æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¹¶æ‰§è¡Œã€‚ else if (workerCountOf(recheck) == 0) addWorker(null, false); } //3. é€šè¿‡addWorker(command, false)æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶å°†ä»»åŠ¡(command)æ·»åŠ åˆ°è¯¥çº¿ç¨‹ä¸­ï¼›ç„¶åï¼Œå¯åŠ¨è¯¥çº¿ç¨‹ä»è€Œæ‰§è¡Œä»»åŠ¡ã€‚ //å¦‚æœaddWorker(command, false)æ‰§è¡Œå¤±è´¥ï¼Œåˆ™é€šè¿‡reject()æ‰§è¡Œç›¸åº”çš„æ‹’ç»ç­–ç•¥çš„å†…å®¹ã€‚ else if (!addWorker(command, false)) reject(command); } ------ å›¾ç¤ºï¼š\næºç \n// å…¨å±€é”ï¼Œå¹¶å‘æ“ä½œå¿…å¤‡ private final ReentrantLock mainLock = new ReentrantLock(); // è·Ÿè¸ªçº¿ç¨‹æ± çš„æœ€å¤§å¤§å°ï¼Œåªæœ‰åœ¨æŒæœ‰å…¨å±€é”mainLockçš„å‰æä¸‹æ‰èƒ½è®¿é—®æ­¤é›†åˆ private int largestPoolSize; // å·¥ä½œçº¿ç¨‹é›†åˆï¼Œå­˜æ”¾çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„ï¼ˆæ´»è·ƒçš„ï¼‰å·¥ä½œçº¿ç¨‹ï¼Œåªæœ‰åœ¨æŒæœ‰å…¨å±€é”mainLockçš„å‰æä¸‹æ‰èƒ½è®¿é—®æ­¤é›†åˆ private final HashSet\u0026lt;Worker\u0026gt; workers = new HashSet\u0026lt;\u0026gt;(); //è·å–çº¿ç¨‹æ± çŠ¶æ€ private static int runStateOf(int c) { return c \u0026amp; ~CAPACITY; } //åˆ¤æ–­çº¿ç¨‹æ± çš„çŠ¶æ€æ˜¯å¦ä¸º Running private static boolean isRunning(int c) { return c \u0026lt; SHUTDOWN; } /** * æ·»åŠ æ–°çš„å·¥ä½œçº¿ç¨‹åˆ°çº¿ç¨‹æ±  * @param firstTask è¦æ‰§è¡Œ * @param coreå‚æ•°ä¸ºtrueçš„è¯è¡¨ç¤ºä½¿ç”¨çº¿ç¨‹æ± çš„åŸºæœ¬å¤§å°ï¼Œä¸ºfalseä½¿ç”¨çº¿ç¨‹æ± æœ€å¤§å¤§å° * @return æ·»åŠ æˆåŠŸå°±è¿”å›trueå¦åˆ™è¿”å›false */ private boolean addWorker(Runnable firstTask, boolean core) { retry: for (;;) { //è¿™ä¸¤å¥ç”¨æ¥è·å–çº¿ç¨‹æ± çš„çŠ¶æ€ int c = ctl.get(); int rs = runStateOf(c); // Check if queue empty only if necessary. if (rs \u0026gt;= SHUTDOWN \u0026amp;\u0026amp; ! (rs == SHUTDOWN \u0026amp;\u0026amp; firstTask == null \u0026amp;\u0026amp; ! workQueue.isEmpty())) return false; for (;;) { //è·å–çº¿ç¨‹æ± ä¸­å·¥ä½œçš„çº¿ç¨‹çš„æ•°é‡ int wc = workerCountOf(c); // coreå‚æ•°ä¸ºfalseçš„è¯è¡¨æ˜é˜Ÿåˆ—ä¹Ÿæ»¡äº†ï¼Œçº¿ç¨‹æ± å¤§å°å˜ä¸º maximumPoolSize if (wc \u0026gt;= CAPACITY || wc \u0026gt;= (core ? corePoolSize : maximumPoolSize)) return false; //åŸå­æ“ä½œå°†workcountçš„æ•°é‡åŠ 1 if (compareAndIncrementWorkerCount(c)) break retry; // å¦‚æœçº¿ç¨‹çš„çŠ¶æ€æ”¹å˜äº†å°±å†æ¬¡æ‰§è¡Œä¸Šè¿°æ“ä½œ c = ctl.get(); if (runStateOf(c) != rs) continue retry; // else CAS failed due to workerCount change; retry inner loop } } // æ ‡è®°å·¥ä½œçº¿ç¨‹æ˜¯å¦å¯åŠ¨æˆåŠŸ boolean workerStarted = false; // æ ‡è®°å·¥ä½œçº¿ç¨‹æ˜¯å¦åˆ›å»ºæˆåŠŸ boolean workerAdded = false; Worker w = null; try { w = new Worker(firstTask); final Thread t = w.thread; if (t != null) { // åŠ é” final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try { //è·å–çº¿ç¨‹æ± çŠ¶æ€ int rs = runStateOf(ctl.get()); //rs \u0026lt; SHUTDOWN å¦‚æœçº¿ç¨‹æ± çŠ¶æ€ä¾ç„¶ä¸ºRUNNING,å¹¶ä¸”çº¿ç¨‹çš„çŠ¶æ€æ˜¯å­˜æ´»çš„è¯ï¼Œå°±ä¼šå°†å·¥ä½œçº¿ç¨‹æ·»åŠ åˆ°å·¥ä½œçº¿ç¨‹é›†åˆä¸­ //(rs=SHUTDOWN \u0026amp;\u0026amp; firstTask == null)å¦‚æœçº¿ç¨‹æ± çŠ¶æ€å°äºSTOPï¼Œä¹Ÿå°±æ˜¯RUNNINGæˆ–è€…SHUTDOWNçŠ¶æ€ä¸‹ï¼ŒåŒæ—¶ä¼ å…¥çš„ä»»åŠ¡å®ä¾‹firstTaskä¸ºnullï¼Œåˆ™éœ€è¦æ·»åŠ åˆ°å·¥ä½œçº¿ç¨‹é›†åˆå’Œå¯åŠ¨æ–°çš„Worker // firstTask == nullè¯æ˜åªæ–°å»ºçº¿ç¨‹è€Œä¸æ‰§è¡Œä»»åŠ¡ if (rs \u0026lt; SHUTDOWN || (rs == SHUTDOWN \u0026amp;\u0026amp; firstTask == null)) { if (t.isAlive()) // precheck that t is startable throw new IllegalThreadStateException(); workers.add(w); //æ›´æ–°å½“å‰å·¥ä½œçº¿ç¨‹çš„æœ€å¤§å®¹é‡ int s = workers.size(); if (s \u0026gt; largestPoolSize) largestPoolSize = s; // å·¥ä½œçº¿ç¨‹æ˜¯å¦å¯åŠ¨æˆåŠŸ workerAdded = true; } } finally { // é‡Šæ”¾é” mainLock.unlock(); } //// å¦‚æœæˆåŠŸæ·»åŠ å·¥ä½œçº¿ç¨‹ï¼Œåˆ™è°ƒç”¨Workerå†…éƒ¨çš„çº¿ç¨‹å®ä¾‹tçš„Thread#start()æ–¹æ³•å¯åŠ¨çœŸå®çš„çº¿ç¨‹å®ä¾‹ if (workerAdded) { t.start(); /// æ ‡è®°çº¿ç¨‹å¯åŠ¨æˆåŠŸ workerStarted = true; } } } finally { // çº¿ç¨‹å¯åŠ¨å¤±è´¥ï¼Œéœ€è¦ä»å·¥ä½œçº¿ç¨‹ä¸­ç§»é™¤å¯¹åº”çš„Worker if (! workerStarted) addWorkerFailed(w); } return workerStarted; } ------ å®Œæ•´æºç åˆ†æ https://www.throwx.cn/2020/08/23/java-concurrency-thread-pool-executor/\nå¯¹äºä»£ç ä¸­ï¼Œè¿›è¡Œåˆ†æï¼š\næˆ‘ä»¬åœ¨ä»£ç ä¸­æ¨¡æ‹Ÿäº† 10 ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬é…ç½®çš„æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º 5 ã€ç­‰å¾…é˜Ÿåˆ—å®¹é‡ä¸º 100 ï¼Œæ‰€ä»¥æ¯æ¬¡åªå¯èƒ½å­˜åœ¨ 5 ä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œï¼Œå‰©ä¸‹çš„ 5 ä¸ªä»»åŠ¡ä¼šè¢«æ”¾åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­å»ã€‚å½“å‰çš„ 5 ä¸ªä»»åŠ¡ä¸­å¦‚æœæœ‰ä»»åŠ¡è¢«æ‰§è¡Œå®Œäº†ï¼Œçº¿ç¨‹æ± å°±ä¼šå»æ‹¿æ–°çš„ä»»åŠ¡æ‰§è¡Œã€‚\nå‡ ä¸ªå¸¸è§çš„å¯¹æ¯” # Runnable VS Callable Runnable Java 1.0ï¼Œä¸ä¼šè¿”å›ç»“æœæˆ–æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸\nCallable Java 1.5 å¯ä»¥\nå·¥å…·ç±»Executorså¯ä»¥å®ç°ï¼Œå°†Runnableå¯¹è±¡è½¬æ¢æˆCallableå¯¹è±¡( Executors.callable(Runnable task)æˆ–Executors.callable(Runnable task, Object result) )\n//Runnable @FunctionalInterface public interface Runnable { /** * è¢«çº¿ç¨‹æ‰§è¡Œï¼Œæ²¡æœ‰è¿”å›å€¼ä¹Ÿæ— æ³•æŠ›å‡ºå¼‚å¸¸ */ public abstract void run(); } ------ //Callable @FunctionalInterface public interface Callable\u0026lt;V\u0026gt; { /** * è®¡ç®—ç»“æœï¼Œæˆ–åœ¨æ— æ³•è¿™æ ·åšæ—¶æŠ›å‡ºå¼‚å¸¸ã€‚ * @return è®¡ç®—å¾—å‡ºçš„ç»“æœ * @throws å¦‚æœæ— æ³•è®¡ç®—ç»“æœï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ */ V call() throws Exception; } execute() VS submit()\nexecute()æ–¹æ³•ç”¨äºæäº¤ä¸éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ï¼Œæ‰€ä»¥æ— æ³•åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«çº¿ç¨‹æ± æ‰§è¡ŒæˆåŠŸä¸å¦ï¼› submit()æ–¹æ³•ç”¨äºæäº¤éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ã€‚çº¿ç¨‹æ± ä¼šè¿”å›ä¸€ä¸ª Future ç±»å‹çš„å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ª Future å¯¹è±¡å¯ä»¥åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ Future çš„ get()æ–¹æ³•æ¥è·å–è¿”å›å€¼ï¼Œget()æ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°ä»»åŠ¡å®Œæˆï¼Œè€Œä½¿ç”¨ getï¼ˆlong timeoutï¼ŒTimeUnit unitï¼‰æ–¹æ³•çš„è¯ï¼Œå¦‚æœåœ¨ timeout æ—¶é—´å†…ä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œå°±ä¼šæŠ›å‡º java.util.concurrent.TimeoutExceptionã€‚ //çœŸå®ä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨ThreadPoolExecutoræ„é€ æ–¹æ³• ExecutorService executorService = Executors.newFixedThreadPool(3); Future\u0026lt;String\u0026gt; submit = executorService.submit(() -\u0026gt; { try { Thread.sleep(5000L); } catch (InterruptedException e) { e.printStackTrace(); } return \u0026#34;abc\u0026#34;; }); String s = submit.get(); System.out.println(s); executorService.shutdown(); /* abc */ ä½¿ç”¨æŠ›å¼‚å¸¸çš„æ–¹æ³•\nExecutorService executorService = Executors.newFixedThreadPool(3); Future\u0026lt;String\u0026gt; submit = executorService.submit(() -\u0026gt; { try { Thread.sleep(5000L); } catch (InterruptedException e) { e.printStackTrace(); } return \u0026#34;abc\u0026#34;; }); String s = submit.get(3, TimeUnit.SECONDS); System.out.println(s); executorService.shutdown(); /* æ§åˆ¶å°è¾“å‡º Exception in thread \u0026#34;main\u0026#34; java.util.concurrent.TimeoutException at java.util.concurrent.FutureTask.get(FutureTask.java:205) */ shutdown() VS shutdownNow() shutdownï¼ˆï¼‰ :å…³é—­çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± çš„çŠ¶æ€å˜ä¸º SHUTDOWNã€‚çº¿ç¨‹æ± ä¸å†æ¥å—æ–°ä»»åŠ¡äº†ï¼Œä½†æ˜¯é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡å¾—æ‰§è¡Œå®Œæ¯•ã€‚ shutdownNowï¼ˆï¼‰ :å…³é—­çº¿ç¨‹æ± ï¼Œçº¿ç¨‹çš„çŠ¶æ€å˜ä¸º STOPã€‚çº¿ç¨‹æ± ä¼šç»ˆæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ï¼Œå¹¶åœæ­¢å¤„ç†æ’é˜Ÿçš„ä»»åŠ¡å¹¶è¿”å›æ­£åœ¨ç­‰å¾…æ‰§è¡Œçš„ Listã€‚ isTerminated() VS isshutdown()\nisShutDown å½“è°ƒç”¨ shutdown() æ–¹æ³•åè¿”å›ä¸º trueã€‚ isTerminated å½“è°ƒç”¨ shutdown() æ–¹æ³•åï¼Œå¹¶ä¸”æ‰€æœ‰æäº¤çš„ä»»åŠ¡å®Œæˆåè¿”å›ä¸º true callable+ThreadPoolExecutorç¤ºä¾‹ä»£ç  æºä»£ç  //MyCallable.java\nimport java.util.ArrayList; import java.util.Date; import java.util.List; import java.util.concurrent.ArrayBlockingQueue; import java.util.concurrent.Callable; import java.util.concurrent.ExecutionException; import java.util.concurrent.Future; import java.util.concurrent.ThreadPoolExecutor; import java.util.concurrent.TimeUnit; public class CallableDemo { private static final int CORE_POOL_SIZE = 5; private static final int MAX_POOL_SIZE = 10; private static final int QUEUE_CAPACITY = 100; private static final Long KEEP_ALIVE_TIME = 1L; public static void main(String[] args) { //ä½¿ç”¨é˜¿é‡Œå·´å·´æ¨èçš„åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼ //é€šè¿‡ThreadPoolExecutoræ„é€ å‡½æ•°è‡ªå®šä¹‰å‚æ•°åˆ›å»º ThreadPoolExecutor executor = new ThreadPoolExecutor( CORE_POOL_SIZE, MAX_POOL_SIZE, KEEP_ALIVE_TIME, TimeUnit.SECONDS, new ArrayBlockingQueue\u0026lt;\u0026gt;(QUEUE_CAPACITY), new ThreadPoolExecutor.CallerRunsPolicy()); List\u0026lt;Future\u0026lt;String\u0026gt;\u0026gt; futureList = new ArrayList\u0026lt;\u0026gt;(); Callable\u0026lt;String\u0026gt; callable = new MyCallable(); for (int i = 0; i \u0026lt; 10; i++) { //æäº¤ä»»åŠ¡åˆ°çº¿ç¨‹æ±  Future\u0026lt;String\u0026gt; future = executor.submit(callable); //å°†è¿”å›å€¼ future æ·»åŠ åˆ° listï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ future è·å¾— æ‰§è¡Œ Callable å¾—åˆ°çš„è¿”å›å€¼ futureList.add(future); } for (Future\u0026lt;String\u0026gt; fut : futureList) { try { System.out.println(new Date() + \u0026#34;::\u0026#34; + fut.get()); } catch (InterruptedException | ExecutionException e) { e.printStackTrace(); } } //å…³é—­çº¿ç¨‹æ±  executor.shutdown(); } } /* è¿è¡Œç»“æœ Wed Nov 13 13:40:41 CST 2019::pool-1-thread-1 Wed Nov 13 13:40:42 CST 2019::pool-1-thread-2 Wed Nov 13 13:40:42 CST 2019::pool-1-thread-3 Wed Nov 13 13:40:42 CST 2019::pool-1-thread-4 Wed Nov 13 13:40:42 CST 2019::pool-1-thread-5 Wed Nov 13 13:40:42 CST 2019::pool-1-thread-3 Wed Nov 13 13:40:43 CST 2019::pool-1-thread-2 Wed Nov 13 13:40:43 CST 2019::pool-1-thread-1 Wed Nov 13 13:40:43 CST 2019::pool-1-thread-4 Wed Nov 13 13:40:43 CST 2019::pool-1-thread-5 ------ */ å‡ ç§å¸¸è§çš„çº¿ç¨‹æ± è¯¦è§£ # FixedThreadPool ç§°ä¹‹ä¸ºå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ï¼ŒExecutorsç±»ä¸­æºç ï¼š\n/** * åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨å›ºå®šæ•°é‡çº¿ç¨‹çš„çº¿ç¨‹æ±  */ public static ExecutorService newFixedThreadPool(int nThreads, ThreadFactory threadFactory) { return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue\u0026lt;Runnable\u0026gt;(), threadFactory); } //================æˆ–================ public static ExecutorService newFixedThreadPool(int nThreads) { return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue\u0026lt;Runnable\u0026gt;()); } å¦‚ä¸Šå¾—çŸ¥ï¼Œæ–°åˆ›å»ºçš„FixedThreadPoolçš„corePoolSizeå’ŒmaximumPoolSizeéƒ½è¢«è®¾ç½®ä¸ºnThreads\næ‰§è¡Œä»»åŠ¡è¿‡ç¨‹ä»‹ç» FixedThreadPoolçš„execute()æ–¹æ³•è¿è¡Œç¤ºæ„å›¾\nä¸Šå›¾åˆ†æ å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å°äº corePoolSizeï¼Œ å¦‚æœå†æ¥æ–°ä»»åŠ¡çš„è¯ï¼Œå°±åˆ›å»ºæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼› å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°ç­‰äº corePoolSize åï¼Œ å¦‚æœå†æ¥æ–°ä»»åŠ¡çš„è¯ï¼Œä¼šå°†ä»»åŠ¡åŠ å…¥ LinkedBlockingQueueï¼› çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ‰§è¡Œå®Œ æ‰‹å¤´çš„ä»»åŠ¡åï¼Œä¼šåœ¨å¾ªç¯ä¸­åå¤ä» LinkedBlockingQueue ä¸­è·å–ä»»åŠ¡æ¥æ‰§è¡Œï¼› ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨FixedThreadPool ä¸»è¦åŸå› ï¼ŒFixedThreadPoolä½¿ç”¨æ— ç•Œé˜Ÿåˆ—LinkedBlockingQueueï¼ˆé˜Ÿåˆ—å®¹é‡ä¸ºInteger.MAX_VALUE)ä½œä¸ºçº¿ç¨‹æ± çš„å·¥ä½œé˜Ÿåˆ— çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°è¾¾åˆ°corePoolSizeåï¼Œæ–°ä»»åŠ¡åœ¨æ— ç•Œé˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œå› æ­¤çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°ä¸è¶…è¿‡corePoolSize ç”±äºä½¿ç”¨æ— ç•Œé˜Ÿåˆ—æ—¶ maximumPoolSize å°†æ˜¯ä¸€ä¸ªæ— æ•ˆå‚æ•°ï¼Œå› ä¸ºä¸å¯èƒ½å­˜åœ¨ä»»åŠ¡é˜Ÿåˆ—æ»¡çš„æƒ…å†µã€‚æ‰€ä»¥ï¼Œã€ä¸éœ€è¦ç©ºé—²çº¿ç¨‹ï¼Œå› ä¸ºcorePoolï¼Œç„¶åQueueï¼Œæœ€åæ‰æ˜¯ç©ºé—²çº¿ç¨‹ã€‘é€šè¿‡åˆ›å»º FixedThreadPoolçš„æºç å¯ä»¥çœ‹å‡ºåˆ›å»ºçš„ FixedThreadPool çš„ corePoolSize å’Œ maximumPoolSize è¢«è®¾ç½®ä¸ºåŒä¸€ä¸ªå€¼ã€‚ åˆç”±äº1ã€2åŸå› ï¼Œä½¿ç”¨æ— ç•Œé˜Ÿåˆ—æ—¶ï¼ŒkeepAliveTimeå°†æ˜¯æ— æ•ˆå‚æ•° è¿è¡Œä¸­çš„FixedThreadPoolï¼ˆå¦‚æœæœªæ‰§è¡Œshutdown()æˆ–shutdownNow()ï¼‰åˆ™ä¸ä¼šæ‹’ç»ä»»åŠ¡ï¼Œå› æ­¤åœ¨ä»»åŠ¡è¾ƒå¤šæ—¶ä¼šå¯¼è‡´OOMï¼ˆå†…å­˜æº¢å‡º,Out Of Memoryï¼‰ SingleThreadExecutor\nSingleThreadExecutoræ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œæºç ï¼š\n/** *è¿”å›åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ±  */ public static ExecutorService newSingleThreadExecutor(ThreadFactory threadFactory) { return new FinalizableDelegatedExecutorService (new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue\u0026lt;Runnable\u0026gt;(), threadFactory)); } //å¦ä¸€ç§æ„é€ å‡½æ•° public static ExecutorService newSingleThreadExecutor() { return new FinalizableDelegatedExecutorService (new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue\u0026lt;Runnable\u0026gt;())); } æ–°åˆ›å»ºçš„ SingleThreadExecutor çš„ corePoolSize å’Œ maximumPoolSize éƒ½è¢«è®¾ç½®ä¸º 1.å…¶ä»–å‚æ•°å’Œ FixedThreadPool ç›¸åŒ\næ‰§è¡Œè¿‡ç¨‹ å¦‚æœå½“å‰è¿è¡Œçº¿ç¨‹æ•°å°‘äºcorePoolSizeï¼ˆ1ï¼‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼›å½“å‰çº¿ç¨‹æ± æœ‰ä¸€ä¸ªè¿è¡Œçš„çº¿ç¨‹åï¼Œå°†ä»»åŠ¡åŠ å…¥LinkedBlockingQueueï¼›çº¿ç¨‹æ‰§è¡Œå®Œå½“å‰çš„ä»»åŠ¡åï¼Œä¼šåœ¨å¾ªç¯ä¸­åå¤ä»LinkedBlockingQueueä¸­è·å–ä»»åŠ¡æ‰§è¡Œ\nä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨SingleThreadExecutor SingleThreadExecutorä½¿ç”¨æ— ç•Œé˜Ÿåˆ—LinkedBlockingQueueä½œä¸ºçº¿ç¨‹æ± çš„å·¥ä½œé˜Ÿåˆ—ï¼ˆå®¹é‡ä¸ºInteger.MAX_VALUE) ã€‚SingleThreadExecutorä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ä½œä¸ºçº¿ç¨‹æ± çš„å·¥ä½œé˜Ÿåˆ—ä¼šå¯¹çº¿ç¨‹æ± å¸¦æ¥çš„å½±å“ä¸FixedThreadPollç›¸åŒï¼Œå³å¯¼è‡´OOM\nCachedThreadPool CachedThreadPoolæ˜¯ä¸€ä¸ªä¼šæ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œæºç ï¼š\n/** * åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œæ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹ï¼Œä½†ä¼šåœ¨å…ˆå‰æ„å»ºçš„çº¿ç¨‹å¯ç”¨æ—¶é‡ç”¨å®ƒã€‚ */ public static ExecutorService newCachedThreadPool(ThreadFactory threadFactory) { return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue\u0026lt;Runnable\u0026gt;(), threadFactory); } //å…¶ä»–æ„é€ å‡½æ•° public static ExecutorService newCachedThreadPool() { return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue\u0026lt;Runnable\u0026gt;()); } CachedThreadPool çš„**corePoolSize è¢«è®¾ç½®ä¸ºç©ºï¼ˆ0ï¼‰ï¼ŒmaximumPoolSizeè¢«è®¾ç½®ä¸º Integer.MAX.VALUEï¼Œå³å®ƒæ˜¯æ— ç•Œçš„ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€å¦‚æœä¸»çº¿ç¨‹æäº¤ä»»åŠ¡çš„é€Ÿåº¦é«˜äº maximumPool ä¸­çº¿ç¨‹å¤„ç†ä»»åŠ¡çš„é€Ÿåº¦æ—¶ï¼ŒCachedThreadPool ä¼šä¸æ–­åˆ›å»ºæ–°çš„çº¿ç¨‹**ã€‚æç«¯æƒ…å†µä¸‹ï¼Œè¿™æ ·ä¼šå¯¼è‡´è€—å°½ cpu å’Œå†…å­˜èµ„æº\nâ˜…ï¼šSynchronousQueueé˜Ÿåˆ—åªèƒ½å®¹çº³é›¶ä¸ªå…ƒç´  æ‰§è¡Œè¿‡ç¨‹ï¼ˆexecute()ç¤ºæ„å›¾ï¼‰\nä¸Šå›¾è¯´æ˜ï¼š\né¦–å…ˆæ‰§è¡Œ SynchronousQueue.offer(Runnable task) æäº¤ä»»åŠ¡åˆ°ä»»åŠ¡é˜Ÿåˆ—ã€‚å¦‚æœå½“å‰ maximumPool ä¸­æœ‰é—²çº¿ç¨‹æ­£åœ¨æ‰§è¡Œ SynchronousQueue.poll(keepAliveTime,TimeUnit.NANOSECONDS)ï¼Œé‚£ä¹ˆä¸»çº¿ç¨‹æ‰§è¡Œ offer æ“ä½œä¸ç©ºé—²çº¿ç¨‹æ‰§è¡Œçš„ poll æ“ä½œé…å¯¹æˆåŠŸï¼Œä¸»çº¿ç¨‹æŠŠä»»åŠ¡äº¤ç»™ç©ºé—²çº¿ç¨‹æ‰§è¡Œï¼Œexecute()æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œå¦åˆ™æ‰§è¡Œä¸‹é¢çš„æ­¥éª¤ 2ï¼› å½“åˆå§‹ maximumPool ä¸ºç©ºï¼Œæˆ–è€… maximumPool ä¸­æ²¡æœ‰ç©ºé—²çº¿ç¨‹æ—¶ï¼Œå°†æ²¡æœ‰çº¿ç¨‹æ‰§è¡Œ SynchronousQueue.poll(keepAliveTime,TimeUnit.NANOSECONDS)ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ­¥éª¤ 1 å°†å¤±è´¥ï¼Œæ­¤æ—¶ CachedThreadPool ä¼šåˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œexecute æ–¹æ³•æ‰§è¡Œå®Œæˆï¼› ä¸æ¨èä½¿ç”¨CachedThreadPool? å› ä¸ºå®ƒå…è®¸åˆ›å»ºçš„çº¿ç¨‹æ•°é‡ä¸ºInteger.MAX_VALUE,å¯èƒ½åˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´OOM\nScheduledThreadPoolExecutorè¯¦è§£ # é¡¹ç›®ä¸­åŸºæœ¬ä¸ä¼šç”¨åˆ°ï¼Œä¸»è¦ç”¨æ¥åœ¨ç»™å®šçš„å»¶è¿Ÿåè¿è¡Œä»»åŠ¡ï¼Œæˆ–è€…å®šæœŸæ‰§è¡Œä»»åŠ¡ å®ƒä½¿ç”¨çš„ä»»åŠ¡é˜Ÿåˆ—DelayQueueå°è£…äº†ä¸€ä¸ªPriorityQueueï¼ŒPriorityQueueä¼šå¯¹é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡è¿›è¡Œæ’åºï¼Œæ‰§è¡Œæ‰€éœ€æ—¶é—´ï¼ˆç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶é—´ï¼‰çŸ­çš„æ”¾åœ¨å‰é¢å…ˆè¢«æ‰§è¡Œ(ScheduledFutureTaskçš„timeå˜é‡å°çš„å…ˆæ‰§è¡Œ)ï¼Œå¦‚æœä¸€è‡´åˆ™å…ˆæäº¤çš„å…ˆæ‰§è¡Œ(ScheduleFutureTaskçš„sequenceNumberå˜é‡)\nScheduleFutureTask\n/** * å…¶ä¸­, triggerTime(initialDelay, unit) çš„ç»“æœå³ä¸Šé¢è¯´çš„timeï¼Œè¯´çš„åº”è¯¥æ˜¯ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶é—´ï¼Œè€Œä¸æ˜¯æ•´ä¸ªä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ * @throws RejectedExecutionException {@inheritDoc} * @throws NullPointerException {@inheritDoc} * @throws IllegalArgumentException {@inheritDoc} */ public ScheduledFuture\u0026lt;?\u0026gt; scheduleAtFixedRate(Runnable command, long initialDelay, long period, TimeUnit unit) { if (command == null || unit == null) throw new NullPointerException(); if (period \u0026lt;= 0) throw new IllegalArgumentException(); ScheduledFutureTask\u0026lt;Void\u0026gt; sft = new ScheduledFutureTask\u0026lt;Void\u0026gt;(command, null, triggerTime(initialDelay, unit), unit.toNanos(period)); RunnableScheduledFuture\u0026lt;Void\u0026gt; t = decorateTask(command, sft); sft.outerTask = t; delayedExecute(t); return t; } ä»£ç ï¼ŒTimerTask\n@Slf4j class MyTimerTask extends TimerTask{ @Override public void run() { log.info(\u0026#34;hello\u0026#34;); } } public class TimerTaskTest { public static void main(String[] args) { Timer timer = new Timer(); Calendar calendar = Calendar.getInstance(); calendar.set(Calendar.HOUR_OF_DAY, 17);//æ§åˆ¶å°æ—¶ calendar.set(Calendar.MINUTE, 1);//æ§åˆ¶åˆ†é’Ÿ calendar.set(Calendar.SECOND, 0);//æ§åˆ¶ç§’ Date time = calendar.getTime();//æ‰§è¡Œä»»åŠ¡æ—¶é—´ä¸º17:01:00 //æ¯å¤©å®šæ—¶17:02æ‰§è¡Œæ“ä½œï¼Œæ¯5ç§’æ‰§è¡Œä¸€æ¬¡ timer.schedule(new MyTimerTask(), time, 5000 ); } } ä»£ç ï¼ŒScheduleThreadPoolExecutor\n@Slf4j public class ScheduleTask { public static void main(String[] args) throws InterruptedException { ScheduledExecutorService scheduledExecutorService = Executors.newScheduledThreadPool(3); scheduledExecutorService.scheduleAtFixedRate(new Runnable() { @Override public void run() { log.info(\u0026#34;hello world!\u0026#34;); } }, 3, 5, TimeUnit.SECONDS);//10è¡¨ç¤ºé¦–æ¬¡æ‰§è¡Œä»»åŠ¡çš„å»¶è¿Ÿæ—¶é—´ï¼Œ5è¡¨ç¤ºæ¯æ¬¡æ‰§è¡Œä»»åŠ¡çš„é—´éš”æ—¶é—´ï¼ŒThread.sleep(10000); System.out.println(\u0026#34;Shutting down executor...\u0026#34;); TimeUnit.SECONDS.sleep(4); //çº¿ç¨‹æ± ä¸€å…³é—­ï¼Œå®šæ—¶å™¨å°±ä¸ä¼šå†æ‰§è¡Œ scheduledExecutorService.shutdown(); while (true){} } } /*ç»“æœ Shutting down executor... 2022-11-28 17:25:06 ä¸‹åˆ [Thread: pool-1-thread-1] INFO:hello world! ä¸ä¼šå†æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼Œå› ä¸ºçº¿ç¨‹æ± å·²ç»å…³äº†*/ ScheduleThreadPoolExecutorå’ŒTimerçš„æ¯”è¾ƒ Timerå¯¹ç³»ç»Ÿæ—¶é’Ÿå˜åŒ–æ•æ„Ÿï¼ŒScheduledThreadPoolExecutorä¸æ˜¯\nTimerä½¿ç”¨çš„æ˜¯System.currentTime()ï¼Œè€ŒScheduledThreadPoolExecutorä½¿ç”¨çš„æ˜¯System.nanoTime()\nTimeråªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼ˆå¯¼è‡´é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡å»¶è¿Ÿå…¶ä»–ä»»åŠ¡ï¼‰ï¼ŒScheduleThreadPoolExecutorå¯ä»¥é…ç½®ä»»æ„æ•°é‡çº¿ç¨‹\nTimerTaskä¸­æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ä¼šæ€æ­»ä¸€ä¸ªçº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´Timeræ­»æœºï¼ˆå³è®¡åˆ’ä»»åŠ¡å°†ä¸åœ¨è¿è¡Œï¼‰ï¼›è€ŒScheduleThreadExecutorä¸ä»…æ•è·è¿è¡Œæ—¶å¼‚å¸¸ï¼Œè¿˜å…è®¸éœ€è¦æ—¶å¤„ç†ï¼ˆafterExecuteæ–¹æ³•ï¼‰ï¼ŒæŠ›å‡ºå¼‚å¸¸çš„ä»»åŠ¡ä¼šè¢«å–æ¶ˆè€Œå…¶ä»–ä»»åŠ¡å°†ç»§ç»­è¿è¡Œ\nJDK1.5 ä¹‹åï¼Œæ²¡æœ‰ç†ç”±å†ä½¿ç”¨Timerè¿›è¡Œä»»åŠ¡è°ƒåº¦\nè¿è¡Œæœºåˆ¶ //ä¸‹é¢è¿™å—å†…å®¹åé¢æ›´æ–°ååŸä½œè€…åˆ é™¤äº† ScheduledThreadPoolExecutorçš„æ‰§è¡Œåˆ†ä¸ºï¼š\nå½“è°ƒç”¨scheduleAtFixedRate()æˆ–scheduleWithFixedDelay()æ–¹æ³•æ—¶ï¼Œä¼šå‘ScheduleThreadPoolExectorçš„DelayQueueæ·»åŠ ä¸€ä¸ªå®ç°äº†RunnableScheduleFutureæ¥å£çš„ScheduleFutureTask(ç§æœ‰å†…éƒ¨ç±») çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä»DelayQueueä¸­è·å–ScheduleFutureTaskï¼Œç„¶åæ‰§è¡Œä»»åŠ¡ ä¸ºäº†æ‰§è¡Œå‘¨æœŸæ€§ä»»åŠ¡ï¼Œå¯¹ThreadPoolExecutoråšäº†å¦‚ä¸‹ä¿®æ”¹ï¼š\nä½¿ç”¨DelayQueueä½œä¸ºä»»åŠ¡é˜Ÿåˆ— è·å–ä»»åŠ¡çš„æ–¹å¼ä¸åŒ è·å–å‘¨æœŸä»»åŠ¡ååšäº†é¢å¤–å¤„ç† è·å–ä»»åŠ¡ï¼Œæ‰§è¡Œä»»åŠ¡ï¼Œä¿®æ”¹ä»»åŠ¡(time)ï¼Œå›æ”¾(æ·»åŠ )ä»»åŠ¡\nçº¿ç¨‹ 1 ä» DelayQueue ä¸­è·å–å·²åˆ°æœŸçš„ ScheduledFutureTaskï¼ˆDelayQueue.take()ï¼‰ã€‚åˆ°æœŸä»»åŠ¡æ˜¯æŒ‡ ScheduledFutureTaskçš„ time å¤§äºç­‰äºå½“å‰ç³»ç»Ÿçš„æ—¶é—´ï¼› çº¿ç¨‹ 1 æ‰§è¡Œè¿™ä¸ª ScheduledFutureTaskï¼› çº¿ç¨‹ 1 ä¿®æ”¹ ScheduledFutureTask çš„ time å˜é‡ä¸ºä¸‹æ¬¡å°†è¦è¢«æ‰§è¡Œçš„æ—¶é—´ï¼› çº¿ç¨‹ 1 æŠŠè¿™ä¸ªä¿®æ”¹ time ä¹‹åçš„ ScheduledFutureTask æ”¾å› DelayQueue ä¸­ï¼ˆDelayQueue.add())ã€‚ çº¿ç¨‹æ± å¤§å°ç¡®å®š # å¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¤ªå¤šï¼Œå°±ä¼šå¢åŠ ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æˆæœ¬\nå¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ä¸€èˆ¬çº¿ç¨‹çš„ä¸ªæ•°éƒ½å¤§äº CPU æ ¸å¿ƒçš„ä¸ªæ•°ï¼Œè€Œä¸€ä¸ª CPU æ ¸å¿ƒåœ¨ä»»æ„æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œä¸ºäº†è®©è¿™äº›çº¿ç¨‹éƒ½èƒ½å¾—åˆ°æœ‰æ•ˆæ‰§è¡Œï¼ŒCPU é‡‡å–çš„ç­–ç•¥æ˜¯ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…æ—¶é—´ç‰‡å¹¶è½®è½¬çš„å½¢å¼ã€‚å½“ä¸€ä¸ªçº¿ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œçš„æ—¶å€™å°±ä¼šé‡æ–°å¤„äºå°±ç»ªçŠ¶æ€è®©ç»™å…¶ä»–çº¿ç¨‹ä½¿ç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å±äºä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚æ¦‚æ‹¬æ¥è¯´å°±æ˜¯ï¼šå½“å‰ä»»åŠ¡åœ¨æ‰§è¡Œå®Œ CPU æ—¶é—´ç‰‡åˆ‡æ¢åˆ°å¦ä¸€ä¸ªä»»åŠ¡ä¹‹å‰ä¼šå…ˆä¿å­˜è‡ªå·±çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡å†åˆ‡æ¢å›è¿™ä¸ªä»»åŠ¡æ—¶ï¼Œå¯ä»¥å†åŠ è½½è¿™ä¸ªä»»åŠ¡çš„çŠ¶æ€ã€‚ä»»åŠ¡ä»ä¿å­˜åˆ°å†åŠ è½½çš„è¿‡ç¨‹å°±æ˜¯ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚\nä¸Šä¸‹æ–‡åˆ‡æ¢é€šå¸¸æ˜¯è®¡ç®—å¯†é›†å‹çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒéœ€è¦ç›¸å½“å¯è§‚çš„å¤„ç†å™¨æ—¶é—´ï¼Œåœ¨æ¯ç§’å‡ åä¸Šç™¾æ¬¡çš„åˆ‡æ¢ä¸­ï¼Œæ¯æ¬¡åˆ‡æ¢éƒ½éœ€è¦çº³ç§’é‡çº§çš„æ—¶é—´ã€‚æ‰€ä»¥ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢å¯¹ç³»ç»Ÿæ¥è¯´æ„å‘³ç€æ¶ˆè€—å¤§é‡çš„ CPU æ—¶é—´ï¼Œäº‹å®ä¸Šï¼Œå¯èƒ½æ˜¯æ“ä½œç³»ç»Ÿä¸­æ—¶é—´æ¶ˆè€—æœ€å¤§çš„æ“ä½œã€‚\nLinux ç›¸æ¯”ä¸å…¶ä»–æ“ä½œç³»ç»Ÿï¼ˆåŒ…æ‹¬å…¶ä»–ç±» Unix ç³»ç»Ÿï¼‰æœ‰å¾ˆå¤šçš„ä¼˜ç‚¹ï¼Œå…¶ä¸­æœ‰ä¸€é¡¹å°±æ˜¯ï¼Œå…¶ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œæ¨¡å¼åˆ‡æ¢çš„æ—¶é—´æ¶ˆè€—éå¸¸å°‘ã€‚\nè¿‡å¤§è·Ÿè¿‡å°éƒ½ä¸è¡Œ\nå¦‚æœæˆ‘ä»¬è®¾ç½®çš„çº¿ç¨‹æ± æ•°é‡å¤ªå°çš„è¯ï¼Œå¦‚æœåŒä¸€æ—¶é—´æœ‰å¤§é‡ä»»åŠ¡/è¯·æ±‚éœ€è¦å¤„ç†ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤§é‡çš„è¯·æ±‚/ä»»åŠ¡åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…æ‰§è¡Œï¼Œç”šè‡³ä¼šå‡ºç°ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ä¹‹åä»»åŠ¡/è¯·æ±‚æ— æ³•å¤„ç†çš„æƒ…å†µï¼Œæˆ–è€…å¤§é‡ä»»åŠ¡å †ç§¯åœ¨ä»»åŠ¡é˜Ÿåˆ—å¯¼è‡´ OOM è®¾ç½®çº¿ç¨‹æ•°é‡å¤ªå¤§ï¼Œå¤§é‡çº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶åœ¨äº‰å– CPU èµ„æºï¼Œè¿™æ ·ä¼šå¯¼è‡´å¤§é‡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»è€Œå¢åŠ çº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´ï¼Œå½±å“äº†æ•´ä½“æ‰§è¡Œæ•ˆç‡ ç®€å•ä¸”é€‚ç”¨é¢è¾ƒå¹¿çš„å…¬å¼\nCPU å¯†é›†å‹ä»»åŠ¡(N+1)ï¼š è¿™ç§ä»»åŠ¡æ¶ˆè€—çš„ä¸»è¦æ˜¯ CPU èµ„æºï¼Œå¯ä»¥å°†çº¿ç¨‹æ•°è®¾ç½®ä¸º Nï¼ˆCPU æ ¸å¿ƒæ•°ï¼‰+1ï¼Œæ¯” CPU æ ¸å¿ƒæ•°å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹æ˜¯ä¸ºäº†é˜²æ­¢çº¿ç¨‹å¶å‘çš„ç¼ºé¡µä¸­æ–­ï¼Œæˆ–è€…å…¶å®ƒåŸå› å¯¼è‡´çš„ä»»åŠ¡æš‚åœè€Œå¸¦æ¥çš„å½±å“ã€‚ä¸€æ—¦ä»»åŠ¡æš‚åœï¼ŒCPU å°±ä¼šå¤„äºç©ºé—²çŠ¶æ€ï¼Œè€Œåœ¨è¿™ç§æƒ…å†µä¸‹å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å……åˆ†åˆ©ç”¨ CPU çš„ç©ºé—²æ—¶é—´ã€‚\nI/O å¯†é›†å‹ä»»åŠ¡(2N)ï¼š è¿™ç§ä»»åŠ¡åº”ç”¨èµ·æ¥ï¼Œç³»ç»Ÿä¼šç”¨å¤§éƒ¨åˆ†çš„æ—¶é—´æ¥å¤„ç† I/O äº¤äº’ï¼Œè€Œçº¿ç¨‹åœ¨å¤„ç† I/O çš„æ—¶é—´æ®µå†…ä¸ä¼šå ç”¨ CPU æ¥å¤„ç†ï¼Œè¿™æ—¶å°±å¯ä»¥å°† CPU äº¤å‡ºç»™å…¶å®ƒçº¿ç¨‹ä½¿ç”¨ã€‚å› æ­¤åœ¨ I/O å¯†é›†å‹ä»»åŠ¡çš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¤šé…ç½®ä¸€äº›çº¿ç¨‹ï¼Œå…·ä½“çš„è®¡ç®—æ–¹æ³•æ˜¯ 2Nã€‚\nå¦‚ä½•åˆ¤æ–­æ˜¯CPUå¯†é›†ä»»åŠ¡è¿˜æ˜¯IOå¯†é›†ä»»åŠ¡\nCPU å¯†é›†å‹ç®€å•ç†è§£å°±æ˜¯åˆ©ç”¨ CPU è®¡ç®—èƒ½åŠ›çš„ä»»åŠ¡æ¯”å¦‚ä½ åœ¨å†…å­˜ä¸­å¯¹å¤§é‡æ•°æ®è¿›è¡Œæ’åºã€‚ä½†å‡¡æ¶‰åŠåˆ°ç½‘ç»œè¯»å–ï¼Œæ–‡ä»¶è¯»å–è¿™ç±»éƒ½æ˜¯ IO å¯†é›†å‹ï¼Œè¿™ç±»ä»»åŠ¡çš„ç‰¹ç‚¹æ˜¯ CPU è®¡ç®—è€—è´¹æ—¶é—´ç›¸æ¯”äºç­‰å¾… IO æ“ä½œå®Œæˆçš„æ—¶é—´æ¥è¯´å¾ˆå°‘ï¼Œå¤§éƒ¨åˆ†æ—¶é—´éƒ½èŠ±åœ¨äº†ç­‰å¾… IO æ“ä½œå®Œæˆä¸Šã€‚\n"},{"id":134,"href":"/zh/docs/study/Review/java_guide/java/Concurrent/ly0304lyjmm/","title":"javaå†…å­˜æ¨¡å‹","section":"å¹¶å‘","content":" å¼•ç”¨è‡ªhttps://github.com/Snailclimb/JavaGuide\nä»CPUç¼“å­˜æ¨¡å‹è¯´èµ· # redisæ˜¯ä¸ºäº†è§£å†³ç¨‹åºå¤„ç†é€Ÿåº¦å’Œè®¿é—®å¸¸è§„å…³ç³»å‹æ•°æ®åº“é€Ÿåº¦ä¸å¯¹ç­‰çš„é—®é¢˜ï¼ŒCPUç¼“å­˜åˆ™æ˜¯ä¸ºäº†è§£å†³CPUå¤„ç†é€Ÿåº¦å’Œå†…å­˜å¤„ç†é€Ÿåº¦ä¸å¯¹ç­‰çš„é—®é¢˜\næˆ‘ä»¬æŠŠå†…å­˜çœ‹ä½œå¤–å­˜çš„é«˜é€Ÿç¼“å­˜ï¼Œç¨‹åºè¿è¡Œæ—¶æŠŠå¤–å­˜çš„æ•°æ®å¤åˆ¶åˆ°å†…å­˜ï¼Œç”±äºå†…å­˜çš„å¤„ç†é€Ÿåº¦è¿œé«˜äºå¤–å­˜ï¼Œè¿™æ ·æé«˜äº†å¤„ç†é€Ÿåº¦\næ€»ç»“ï¼ŒCPU Cacheç¼“å­˜çš„æ˜¯å†…å­˜æ•°æ®ï¼Œç”¨äºè§£å†³CPUå¤„ç†é€Ÿåº¦å’Œå†…å­˜ä¸åŒ¹é…çš„é—®é¢˜ï¼Œå†…å­˜ç¼“å­˜çš„æ˜¯ç¡¬ç›˜æ•°æ®ç”¨äºè§£å†³ç¡¬ç›˜è®¿é—®é€Ÿåº¦è¿‡æ…¢çš„é—®é¢˜ CPU Cacheç¤ºæ„å›¾ï¼š\nCPU Cacheé€šå¸¸åˆ†ä¸ºä¸‰å±‚ï¼Œåˆ†åˆ«å«L1ï¼ŒL2ï¼ŒL3 Cache å·¥ä½œæ–¹å¼ï¼š å…ˆå¤åˆ¶ä¸€ä»½æ•°æ®åˆ°CPUCacheä¸­ï¼Œå½“CPUéœ€è¦ç”¨çš„æ—¶å€™å°±å¯ä»¥ä»CPUCacheä¸­è¯»å–æ•°æ®ï¼Œè¿ç®—å®Œæˆåï¼Œå°†è¿ç®—å¾—åˆ°çš„æ•°æ®ï¼Œå†™å›MainMemoryä¸­ï¼Œæ­¤æ—¶ï¼Œä¼šå‡ºç°å†…å­˜ç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œä¾‹å­ï¼šæ‰§è¡Œäº†i++ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œå‡è®¾ä¸¤ä¸ªçº¿ç¨‹ä»CPUCachä¸­è¯»å–çš„i=1ï¼Œä¸¤ä¸ªçº¿ç¨‹åšäº†1++è¿ç®—å®Œä¹‹åå†å†™å›MainMemoryï¼Œæ­¤æ—¶i=2 è€Œæ­£ç¡®ç»“æœä¸º3\nCPUä¸ºäº†è§£å†³å†…å­˜ç¼“å­˜ä¸ä¸€è‡´é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡åˆ¶å®šç¼“å­˜ä¸€è‡´åè®®ï¼ˆæ¯”å¦‚MESIåè®®ï¼‰æˆ–å…¶ä»–æ‰‹æ®µã€‚è¿™ä¸ªç¼“å­˜ä¸€è‡´åè®®ï¼ŒæŒ‡çš„æ˜¯åœ¨ CPU é«˜é€Ÿç¼“å­˜ä¸ä¸»å†…å­˜äº¤äº’çš„æ—¶å€™éœ€è¦éµå®ˆçš„åŸåˆ™å’Œè§„èŒƒ æ“ä½œç³»ç»Ÿï¼Œé€šè¿‡å†…å­˜æ¨¡å‹MemoryModelå®šä¹‰ä¸€ç³»åˆ—è§„èŒƒæ¥è§£å†³è¿™ä¸ªé—®é¢˜\nJavaå†…å­˜æ¨¡å‹ # æŒ‡ä»¤é‡æ’åº # ä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’åºï¼Ÿ ç®€å•æ¥è¯´å°±æ˜¯ç³»ç»Ÿåœ¨æ‰§è¡Œä»£ç çš„æ—¶å€™å¹¶ä¸ä¸€å®šæ˜¯æŒ‰ç…§ä½ å†™çš„ä»£ç çš„é¡ºåºä¾æ¬¡æ‰§è¡Œ\næŒ‡ä»¤é‡æ’æœ‰ä¸‹é¢2ç§\nç¼–è¯‘å™¨ä¼˜åŒ–é‡æ’ï¼šç¼–è¯‘å™¨ï¼ˆåŒ…æ‹¬ JVMã€JIT ç¼–è¯‘å™¨ç­‰ï¼‰åœ¨ä¸æ”¹å˜å•çº¿ç¨‹ç¨‹åºè¯­ä¹‰çš„å‰æä¸‹ï¼Œé‡æ–°å®‰æ’è¯­å¥çš„æ‰§è¡Œé¡ºåºã€‚ æŒ‡ä»¤å¹¶è¡Œé‡æ’ï¼šç°ä»£å¤„ç†å™¨é‡‡ç”¨äº†æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯(Instruction-Level Parallelismï¼ŒILP)æ¥å°†å¤šæ¡æŒ‡ä»¤é‡å æ‰§è¡Œã€‚å¦‚æœä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§ï¼Œå¤„ç†å™¨å¯ä»¥æ”¹å˜è¯­å¥å¯¹åº”æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåº å¦å¤–ï¼Œå†…å­˜ç³»ç»Ÿä¹Ÿä¼šæœ‰â€œé‡æ’åºâ€ï¼Œä½†åˆä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„é‡æ’åºã€‚åœ¨ JMM é‡Œè¡¨ç°ä¸ºä¸»å­˜å’Œæœ¬åœ°å†…å­˜çš„å†…å®¹å¯èƒ½ä¸ä¸€è‡´ï¼Œè¿›è€Œå¯¼è‡´ç¨‹åºåœ¨å¤šçº¿ç¨‹ä¸‹æ‰§è¡Œå¯èƒ½å‡ºç°é—®é¢˜ã€‚\nå³Javaæºä»£ç ä¼šç»å† ç¼–è¯‘å™¨ä¼˜åŒ–é‡æ’\u0026mdash;\u0026gt;æŒ‡ä»¤å¹¶è¡Œé‡æ’\u0026mdash;\u0026gt;å†…å­˜ç³»ç»Ÿé‡æ’ï¼Œæœ€ç»ˆç¼–ç¨‹æ“ä½œç³»ç»Ÿå¯æ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—\næå…¶é‡è¦â˜…ï¼šæŒ‡ä»¤é‡æ’åºå¯ä»¥ä¿è¯ä¸²è¡Œè¯­ä¹‰ä¸€è‡´ï¼Œä½†æ˜¯æ²¡æœ‰ä¹‰åŠ¡ä¿è¯å¤šçº¿ç¨‹é—´çš„è¯­ä¹‰ä¹Ÿä¸€è‡´ï¼Œæ‰€ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹æŒ‡ä»¤é‡æ’å¯èƒ½å¯¼è‡´ä¸€äº›é—®é¢˜\nç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„æŒ‡ä»¤é‡æ’åºçš„å¤„ç†æ–¹å¼ä¸ä¸€æ ·ã€‚å¯¹äºç¼–è¯‘å™¨ï¼Œé€šè¿‡ç¦æ­¢ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨é‡æ’åºçš„æ–¹å¼æ¥ç¦æ­¢é‡æ’åºã€‚å¯¹äºå¤„ç†å™¨ï¼Œé€šè¿‡æ’å…¥å†…å­˜å±éšœï¼ˆMemory Barrierï¼Œæˆ–æœ‰æ—¶å«åšå†…å­˜æ …æ ï¼ŒMemory Fenceï¼‰çš„æ–¹å¼æ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºã€‚æŒ‡ä»¤å¹¶è¡Œé‡æ’å’Œå†…å­˜ç³»ç»Ÿé‡æ’éƒ½å±äºæ˜¯å¤„ç†å™¨çº§åˆ«çš„æŒ‡ä»¤é‡æ’åºã€‚\nå†…å­˜å±éšœï¼ˆMemory Barrierï¼Œæˆ–æœ‰æ—¶å«åšå†…å­˜æ …æ ï¼ŒMemory Fenceï¼‰æ˜¯ä¸€ç§ CPU æŒ‡ä»¤ï¼Œç”¨æ¥ç¦æ­¢å¤„ç†å™¨æŒ‡ä»¤å‘ç”Ÿé‡æ’åºï¼ˆåƒå±éšœä¸€æ ·ï¼‰ï¼Œä»è€Œä¿éšœæŒ‡ä»¤æ‰§è¡Œçš„æœ‰åºæ€§ã€‚å¦å¤–ï¼Œä¸ºäº†è¾¾åˆ°å±éšœçš„æ•ˆæœï¼Œå®ƒä¹Ÿä¼šä½¿å¤„ç†å™¨å†™å…¥ã€è¯»å–å€¼ä¹‹å‰ï¼Œå°†ä¸»å†…å­˜çš„å€¼å†™å…¥é«˜é€Ÿç¼“å­˜ï¼Œæ¸…ç©ºæ— æ•ˆé˜Ÿåˆ—ï¼Œä»è€Œä¿éšœå˜é‡çš„å¯è§æ€§ã€‚\nJMMï¼ˆJavaMemoryModeï¼‰ # ä»€ä¹ˆæ˜¯ JMMï¼Ÿä¸ºä»€ä¹ˆéœ€è¦ JMMï¼Ÿ # ä¸€èˆ¬æ¥è¯´ï¼Œç¼–ç¨‹è¯­è¨€ä¹Ÿå¯ä»¥ç›´æ¥å¤ç”¨æ“ä½œç³»ç»Ÿå±‚é¢çš„å†…å­˜æ¨¡å‹ã€‚ä¸è¿‡ï¼Œä¸åŒçš„æ“ä½œç³»ç»Ÿå†…å­˜æ¨¡å‹ä¸åŒã€‚å¦‚æœç›´æ¥å¤ç”¨æ“ä½œç³»ç»Ÿå±‚é¢çš„å†…å­˜æ¨¡å‹ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´åŒæ ·ä¸€å¥—ä»£ç æ¢äº†ä¸€ä¸ªæ“ä½œç³»ç»Ÿå°±æ— æ³•æ‰§è¡Œäº†ã€‚Java è¯­è¨€æ˜¯è·¨å¹³å°çš„ï¼Œå®ƒéœ€è¦è‡ªå·±æä¾›ä¸€å¥—å†…å­˜æ¨¡å‹ä»¥å±è”½ç³»ç»Ÿå·®å¼‚ã€‚\nå®é™…ä¸Šï¼Œå¯¹äºJavaæ¥è¯´ï¼Œå¯ä»¥æŠŠJMMçœ‹ä½œæ˜¯Javaå®šä¹‰çš„å¹¶å‘ç¼–ç¨‹ç›¸å…³çš„ä¸€ç»„è§„èŒƒï¼Œé™¤äº†æŠ½è±¡äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„å…³ç³»ä¹‹å¤–ï¼Œè¿˜è§„å®šäº†ä»Javaæºä»£ç åˆ°CPUå¯æ‰§è¡ŒæŒ‡ä»¤çš„è½¬åŒ–è¿‡ç¨‹è¦éµå®ˆå“ªäº›å’Œå¹¶å‘ç›¸å…³çš„åŸåˆ™å’Œè§„èŒƒï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ç®€åŒ–å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œå¢å¼ºç¨‹åºå¯ç§»æ¤æ€§ã€‚\nä¸ºä»€ä¹ˆè¦éµå®ˆè¿™äº›å¹¶å‘ç›¸å…³çš„åŸåˆ™å’Œè§„èŒƒå‘¢ï¼Ÿå› ä¸ºåœ¨å¹¶å‘ç¼–ç¨‹ä¸‹ï¼ŒCPUå¤šçº§ç¼“å­˜å’ŒæŒ‡ä»¤é‡æ’è¿™ç±»è®¾è®¡ä¼šå¯¼è‡´ç¨‹åºè¿è¡Œå‡ºé—®é¢˜ï¼Œæ¯”å¦‚æŒ‡ä»¤é‡æ’ï¼Œä¸ºæ­¤JMMæŠ½è±¡äº†happens-beforeåŸåˆ™\nJMM è¯´ç™½äº†å°±æ˜¯å®šä¹‰äº†ä¸€äº›è§„èŒƒæ¥è§£å†³è¿™äº›é—®é¢˜ï¼Œå¼€å‘è€…å¯ä»¥åˆ©ç”¨è¿™äº›è§„èŒƒæ›´æ–¹ä¾¿åœ°å¼€å‘å¤šçº¿ç¨‹ç¨‹åºã€‚å¯¹äº Java å¼€å‘è€…è¯´ï¼Œä½ ä¸éœ€è¦äº†è§£åº•å±‚åŸç†ï¼Œç›´æ¥ä½¿ç”¨å¹¶å‘ç›¸å…³çš„ä¸€äº›å…³é”®å­—å’Œç±»ï¼ˆæ¯”å¦‚ volatileã€synchronizedã€å„ç§ Lockï¼‰å³å¯å¼€å‘å‡ºå¹¶å‘å®‰å…¨çš„ç¨‹åºã€‚\nJMM æ˜¯å¦‚ä½•æŠ½è±¡çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„å…³ç³»ï¼Ÿ # Javaå†…å­˜æ¨¡å‹(JMM)ï¼ŒæŠ½è±¡äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„å…³ç³»ï¼Œæ¯”å¦‚çº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å¿…é¡»å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­\nJDK1.2ä¹‹å‰ï¼ŒJavaå†…å­˜æ¨¡å‹æ€»æ˜¯ä»ä¸»å­˜(å…±äº«å†…å­˜)è¯»å–å˜é‡ï¼›è€Œå½“å‰çš„Javaå†…å­˜æ¨¡å‹ä¸‹ï¼Œçº¿ç¨‹å¯ä»¥æŠŠå˜é‡ä¿å­˜æœ¬åœ°å†…å­˜ï¼ˆæœºå™¨çš„å¯„å­˜å™¨ï¼‰ä¸­ï¼Œè€Œä¸ç›´æ¥åœ¨ä¸»å­˜ä¸­è¯»å†™ã€‚è¿™å¯èƒ½é€ æˆï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨ä¸»å­˜ä¸­ä¿®æ”¹äº†ä¸€ä¸ªå˜é‡çš„å€¼ï¼Œè€Œåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ç»§ç»­ä½¿ç”¨å®ƒåœ¨å¯„å­˜å™¨ä¸­çš„å˜é‡å€¼çš„æ‹·è´ï¼Œé€ æˆæ•°æ®ä¸ä¸€è‡´\nä¸Šé¢æ‰€è¿°è·ŸCPUç¼“å­˜æ¨¡å‹éå¸¸ç›¸ä¼¼\nä»€ä¹ˆæ˜¯ä¸»å†…å­˜ï¼Ÿä»€ä¹ˆæ˜¯æœ¬åœ°å†…å­˜ï¼Ÿ\nä¸»å†…å­˜ï¼šâ˜…é‡è¦ï¼ï¼â˜…æ‰€æœ‰çº¿ç¨‹åˆ›å»ºçš„å®ä¾‹å¯¹è±¡éƒ½å­˜æ”¾åœ¨ä¸»å†…å­˜ä¸­ï¼ˆæ„Ÿè§‰è¿™é‡Œè¯´çš„æ˜¯å †ï¼Ÿï¼‰ï¼Œä¸ç®¡è¯¥å®ä¾‹å¯¹è±¡æ˜¯æˆå‘˜å˜é‡è¿˜æ˜¯æ–¹æ³•ä¸­çš„æœ¬åœ°å˜é‡ï¼ˆä¹Ÿç§°å±€éƒ¨å˜é‡ï¼‰\næœ¬åœ°å†…å­˜ ï¼šæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„æœ¬åœ°å†…å­˜æ¥å­˜å‚¨å…±äº«å˜é‡çš„å‰¯æœ¬ï¼Œå¹¶ä¸”ï¼Œæ¯ä¸ªçº¿ç¨‹åªèƒ½è®¿é—®è‡ªå·±çš„æœ¬åœ°å†…å­˜ï¼Œæ— æ³•è®¿é—®å…¶ä»–çº¿ç¨‹çš„æœ¬åœ°å†…å­˜ã€‚æœ¬åœ°å†…å­˜æ˜¯ JMM æŠ½è±¡å‡ºæ¥çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå­˜å‚¨äº†ä¸»å†…å­˜ä¸­çš„å…±äº«å˜é‡å‰¯æœ¬\nJava å†…å­˜æ¨¡å‹çš„æŠ½è±¡ç¤ºæ„å›¾å¦‚ä¸‹ï¼š\nå¦‚ä¸Šï¼Œè‹¥çº¿ç¨‹1å’Œçº¿ç¨‹2ä¹‹é—´è¦é€šä¿¡ï¼Œåˆ™\nçº¿ç¨‹1æŠŠæœ¬åœ°å†…å­˜ä¸­ä¿®æ”¹è¿‡çš„å…±äº«å˜é‡å‰¯æœ¬çš„å€¼ï¼ŒåŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ çº¿ç¨‹2åˆ°ä¸»å­˜ä¸­ï¼Œè¯»å–å¯¹åº”çš„å…±äº«å˜é‡çš„å€¼ å³ï¼ŒJMMä¸ºå…±äº«å˜é‡æä¾›äº†å¯è§æ€§çš„ä¿éšœ\nå¤šçº¿ç¨‹ä¸‹ï¼Œä¸»å†…å­˜ä¸­ä¸€ä¸ªå…±äº«å˜é‡è¿›è¡Œæ“ä½œå¼•å‘çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼š\nçº¿ç¨‹1ã€2åˆ†åˆ«å¯¹åŒä¸€ä¸ªå…±äº«å˜é‡æ“ä½œï¼Œä¸€ä¸ªæ‰§è¡Œä¿®æ”¹ï¼Œä¸€ä¸ªæ‰§è¡Œè¯»å– çº¿ç¨‹2è¯»å–åˆ°çš„æ˜¯çº¿ç¨‹1ä¿®æ”¹ä¹‹å‰çš„è¿˜æ˜¯ä¿®æ”¹ä¹‹åçš„å€¼ï¼Œä¸ç¡®å®š å…³äºä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜ç›´æ¥çš„å…·ä½“äº¤äº’åè®®ï¼Œå³ä¸€ä¸ªå˜é‡ï¼Œå¦‚ä½•ä»ä¸»å†…å­˜æ‹·è´åˆ°å·¥ä½œå†…å­˜ï¼Œå¦‚ä½•ä»å·¥ä½œå†…å­˜åŒæ­¥åˆ°ä¸»å†…å­˜ï¼ŒJMMå®šä¹‰å…«ç§åŒæ­¥æ“ä½œï¼š\né”å®šï¼ˆlockï¼‰: ä½œç”¨äºä¸»å†…å­˜ä¸­çš„å˜é‡ï¼Œå°†ä»–æ ‡è®°ä¸ºä¸€ä¸ªçº¿ç¨‹ç‹¬äº«å˜é‡ã€‚\nè§£é”ï¼ˆunlockï¼‰: ä½œç”¨äºä¸»å†…å­˜ä¸­çš„å˜é‡ï¼Œè§£é™¤å˜é‡çš„é”å®šçŠ¶æ€ï¼Œè¢«è§£é™¤é”å®šçŠ¶æ€çš„å˜é‡æ‰èƒ½è¢«å…¶ä»–çº¿ç¨‹é”å®šã€‚\nreadï¼ˆè¯»å–ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„ load åŠ¨ä½œä½¿ç”¨ã€‚\nload(è½½å…¥)ï¼šæŠŠ read æ“ä½œä»ä¸»å†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡çš„å‰¯æœ¬ä¸­ã€‚\nuse(ä½¿ç”¨)ï¼šæŠŠå·¥ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡çš„å€¼ä¼ ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªä½¿ç”¨åˆ°å˜é‡çš„æŒ‡ä»¤æ—¶éƒ½ä¼šä½¿ç”¨è¯¥æŒ‡ä»¤ã€‚\nassignï¼ˆèµ‹å€¼ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜çš„å˜é‡ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚\nstoreï¼ˆå­˜å‚¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„ write æ“ä½œä½¿ç”¨ã€‚\nwriteï¼ˆå†™å…¥ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠ store æ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­\nä¸‹é¢çš„åŒæ­¥è§„åˆ™ï¼Œä¿è¯è¿™äº›åŒæ­¥æ“ä½œçš„æ­£ç¡®æ‰§è¡Œï¼š (æ²¡çœ‹æ‡‚)\nä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹æ— åŸå› åœ°ï¼ˆæ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½• assign æ“ä½œï¼‰æŠŠæ•°æ®ä»çº¿ç¨‹çš„å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜ä¸­ã€‚\nä¸€ä¸ªæ–°çš„å˜é‡åªèƒ½åœ¨ä¸»å†…å­˜ä¸­ â€œè¯ç”Ÿâ€ï¼Œä¸å…è®¸åœ¨å·¥ä½œå†…å­˜ä¸­ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–ï¼ˆload æˆ– assignï¼‰çš„å˜é‡ï¼Œæ¢å¥è¯è¯´å°±æ˜¯å¯¹ä¸€ä¸ªå˜é‡å®æ–½ use å’Œ store æ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‰§è¡Œè¿‡äº† assign å’Œ load æ“ä½œã€‚\nä¸€ä¸ªå˜é‡åœ¨åŒä¸€ä¸ªæ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡Œ lock æ“ä½œï¼Œä½† lock æ“ä½œå¯ä»¥è¢«åŒä¸€æ¡çº¿ç¨‹é‡å¤æ‰§è¡Œå¤šæ¬¡ï¼Œå¤šæ¬¡æ‰§è¡Œ lock åï¼Œåªæœ‰æ‰§è¡Œç›¸åŒæ¬¡æ•°çš„ unlock æ“ä½œï¼Œå˜é‡æ‰ä¼šè¢«è§£é”ã€‚\nå¦‚æœå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œ lock æ“ä½œï¼Œå°†ä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ï¼Œåœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨è¿™ä¸ªå˜é‡å‰ï¼Œéœ€è¦é‡æ–°æ‰§è¡Œ load æˆ– assign æ“ä½œåˆå§‹åŒ–å˜é‡çš„å€¼ã€‚\nå¦‚æœä¸€ä¸ªå˜é‡äº‹å…ˆæ²¡æœ‰è¢« lock æ“ä½œé”å®šï¼Œåˆ™ä¸å…è®¸å¯¹å®ƒæ‰§è¡Œ unlock æ“ä½œï¼Œä¹Ÿä¸å…è®¸å» unlock ä¸€ä¸ªè¢«å…¶ä»–çº¿ç¨‹é”å®šä½çš„å˜é‡ã€‚\n\u0026hellip;\u0026hellip;\nJava å†…å­˜åŒºåŸŸå’Œ JMM æœ‰ä½•åŒºåˆ«ï¼Ÿ # JVM å†…å­˜ç»“æ„å’Œ Java è™šæ‹Ÿæœºçš„è¿è¡Œæ—¶åŒºåŸŸç›¸å…³ï¼Œå®šä¹‰äº† JVM åœ¨è¿è¡Œæ—¶å¦‚ä½•åˆ†åŒºå­˜å‚¨ç¨‹åºæ•°æ®ï¼Œå°±æ¯”å¦‚è¯´å †ä¸»è¦ç”¨äºå­˜æ”¾å¯¹è±¡å®ä¾‹ã€‚ Java å†…å­˜æ¨¡å‹å’Œ Java çš„å¹¶å‘ç¼–ç¨‹ç›¸å…³ï¼ŒæŠ½è±¡äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„å…³ç³»å°±æ¯”å¦‚è¯´çº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å¿…é¡»å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œè§„å®šäº†ä» Java æºä»£ç åˆ° CPU å¯æ‰§è¡ŒæŒ‡ä»¤çš„è¿™ä¸ªè½¬åŒ–è¿‡ç¨‹è¦éµå®ˆå“ªäº›å’Œå¹¶å‘ç›¸å…³çš„åŸåˆ™å’Œè§„èŒƒï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ç®€åŒ–å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œå¢å¼ºç¨‹åºå¯ç§»æ¤æ€§çš„ã€‚ happens-before åŸåˆ™æ˜¯ä»€ä¹ˆï¼Ÿ # é€šè¿‡é€»è¾‘æ—¶é’Ÿèƒ½å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„äº‹ä»¶çš„å…ˆåå…³ç³»è¿›è¡Œåˆ¤æ–­\né€»è¾‘æ—¶é’Ÿå¹¶ä¸åº¦é‡æ—¶é—´æœ¬èº«ï¼Œä»…åŒºåˆ†äº‹ä»¶å‘ç”Ÿçš„å‰åé¡ºåºï¼Œå…¶æœ¬è´¨å°±æ˜¯å®šä¹‰äº†ä¸€ç§ happens-before å…³ç³»ã€‚\nJSR 133å¼•å…¥happens-beforeè¿™ä¸ªæ¦‚å¿µæ¥æè¿°ä¸¤ä¸ªæ“ä½œä¹‹é—´çš„å†…å­˜å¯è§æ€§\nä¸ºä»€ä¹ˆéœ€è¦ happens-before åŸåˆ™ï¼Ÿ happens-before åŸåˆ™çš„è¯ç”Ÿæ˜¯ä¸ºäº†ç¨‹åºå‘˜å’Œç¼–è¯‘å™¨ã€å¤„ç†å™¨ä¹‹é—´çš„å¹³è¡¡ã€‚ç¨‹åºå‘˜è¿½æ±‚çš„æ˜¯æ˜“äºç†è§£å’Œç¼–ç¨‹çš„å¼ºå†…å­˜æ¨¡å‹ï¼Œéµå®ˆæ—¢å®šè§„åˆ™ç¼–ç å³å¯ã€‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨è¿½æ±‚çš„æ˜¯è¾ƒå°‘çº¦æŸçš„å¼±å†…å­˜æ¨¡å‹ï¼Œè®©å®ƒä»¬å°½å·±æ‰€èƒ½åœ°å»ä¼˜åŒ–æ€§èƒ½ï¼Œè®©æ€§èƒ½æœ€å¤§åŒ–ã€‚\nhappens-beforeåŸåˆ™çš„è®¾è®¡æ€æƒ³\nä¸ºäº†å¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„çº¦æŸå°½å¯èƒ½å°‘ï¼Œåªè¦ä¸æ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æœï¼ˆå•çº¿ç¨‹ç¨‹åºå’Œæ­£ç¡®æ‰§è¡Œçš„å¤šçº¿ç¨‹ç¨‹åºï¼‰ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨æ€ä¹ˆè¿›è¡Œé‡æ’åºä¼˜åŒ–éƒ½è¡Œã€‚ å¯¹äºä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„é‡æ’åºï¼ŒJMM è¦æ±‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¿…é¡»ç¦æ­¢è¿™ç§é‡æ’åºã€‚ JSR-133å¯¹happens-beforeåŸåˆ™çš„å®šä¹‰ï¼š\nå¦‚æœä¸€ä¸ªæ“ä½œhappens-beforeå¦ä¸€ä¸ªæ“ä½œï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œç»“æœå°†å¯¹ç¬¬äºŒä¸ªæ“ä½œå¯è§ï¼Œå¹¶ä¸”ç¬¬ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºæ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ è¿™æ˜¯ JMM å¯¹ç¨‹åºå‘˜å¼ºå†…å­˜æ¨¡å‹çš„æ‰¿è¯ºã€‚ä»ç¨‹åºå‘˜çš„è§’åº¦æ¥è¯´ï¼Œå¯ä»¥è¿™æ ·ç†è§£ Happens-before å…³ç³»ï¼šå¦‚æœ A Happens-before Bï¼Œé‚£ä¹ˆ JMM å°†å‘ç¨‹åºå‘˜ä¿è¯ â€” A æ“ä½œçš„ç»“æœå°†å¯¹ B å¯è§ï¼Œä¸” A çš„æ‰§è¡Œé¡ºåºæ’åœ¨ B ä¹‹å‰ã€‚æ³¨æ„ï¼Œè¿™åªæ˜¯ Javaå†…å­˜æ¨¡å‹å‘ç¨‹åºå‘˜åšå‡ºçš„ä¿è¯ï¼Œå³Happens-beforeæä¾›è·¨çº¿ç¨‹çš„å†…å­˜å¯è§æ€§ä¿è¯\nå¯¹äºè¿™æ¡å®šä¹‰ï¼Œä¸¾ä¸ªä¾‹å­ï¼ˆä¸ä»£è¡¨ä»£ç å°±æ˜¯è¿™æ ·çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¦‚æ‹¬æ€§çš„å‡è®¾æƒ…å†µï¼‰\n// ä»¥ä¸‹æ“ä½œåœ¨çº¿ç¨‹ A ä¸­æ‰§è¡Œ i = 1; // a // ä»¥ä¸‹æ“ä½œåœ¨çº¿ç¨‹ B ä¸­æ‰§è¡Œ j = i; // b // ä»¥ä¸‹æ“ä½œåœ¨çº¿ç¨‹ C ä¸­æ‰§è¡Œ i = 2; // c å‡è®¾çº¿ç¨‹ A ä¸­çš„æ“ä½œ a Happens-before çº¿ç¨‹ B çš„æ“ä½œ bï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥ç¡®å®šæ“ä½œ b æ‰§è¡Œåï¼Œå˜é‡ j çš„å€¼ä¸€å®šæ˜¯ç­‰äº 1ã€‚\nå¾—å‡ºè¿™ä¸ªç»“è®ºçš„ä¾æ®æœ‰ä¸¤ä¸ªï¼šä¸€æ˜¯æ ¹æ® Happens-before åŸåˆ™ï¼Œa æ“ä½œçš„ç»“æœå¯¹ b å¯è§ï¼Œå³ â€œi=1â€ çš„ç»“æœå¯ä»¥è¢«è§‚å¯Ÿåˆ°ï¼›äºŒæ˜¯çº¿ç¨‹ C è¿˜æ²¡è¿è¡Œï¼Œçº¿ç¨‹ A æ“ä½œç»“æŸä¹‹åæ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¼šä¿®æ”¹å˜é‡ i çš„å€¼ã€‚\nç°åœ¨å†æ¥è€ƒè™‘çº¿ç¨‹ Cï¼Œæˆ‘ä»¬ä¾ç„¶ä¿æŒ a Happens-before b ï¼Œè€Œ c å‡ºç°åœ¨ a å’Œ b çš„æ“ä½œä¹‹é—´ï¼Œä½†æ˜¯ c ä¸ b æ²¡æœ‰ Happens-before å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´ b å¹¶ä¸ä¸€å®šèƒ½çœ‹åˆ° c çš„æ“ä½œç»“æœã€‚é‚£ä¹ˆ b æ“ä½œçš„ç»“æœä¹Ÿå°±æ˜¯ j çš„å€¼å°±ä¸ç¡®å®šäº†ï¼Œå¯èƒ½æ˜¯ 1 ä¹Ÿå¯èƒ½æ˜¯ 2ï¼Œé‚£è¿™æ®µä»£ç å°±æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚\nä¸¤ä¸ªæ“ä½œä¹‹é—´å­˜åœ¨ happens-before å…³ç³»ï¼Œå¹¶ä¸æ„å‘³ç€ Java å¹³å°çš„å…·ä½“å®ç°å¿…é¡»è¦æŒ‰ç…§ happens-before å…³ç³»æŒ‡å®šçš„é¡ºåºæ¥æ‰§è¡Œã€‚å¦‚æœé‡æ’åºä¹‹åçš„æ‰§è¡Œç»“æœï¼Œä¸æŒ‰ happens-before å…³ç³»æ¥æ‰§è¡Œçš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆ JMM ä¹Ÿå…è®¸è¿™æ ·çš„é‡æ’åº ä¾‹å­ï¼š\nint userNum = getUserNum(); // 1 int teacherNum = getTeacherNum();\t// 2 int totalNum = userNum + teacherNum;\t// 3 å¦‚ä¸Šï¼Œ1 happens-before 2ï¼Œ2 happens-before 3ï¼Œ1 happens-before 3\nè™½ç„¶ 1 happens-before 2ï¼Œä½†å¯¹ 1 å’Œ 2 è¿›è¡Œé‡æ’åºä¸ä¼šå½±å“ä»£ç çš„æ‰§è¡Œç»“æœï¼Œæ‰€ä»¥ JMM æ˜¯å…è®¸ç¼–è¯‘å™¨å’Œå¤„ç†å™¨æ‰§è¡Œè¿™ç§é‡æ’åºçš„ã€‚ä½† 1 å’Œ 2 å¿…é¡»æ˜¯åœ¨ 3 æ‰§è¡Œä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯è¯´ 1,2 happens-before 3 ã€‚\nhappens-before åŸåˆ™è¡¨è¾¾çš„æ„ä¹‰å…¶å®å¹¶ä¸æ˜¯ä¸€ä¸ªæ“ä½œå‘ç”Ÿåœ¨å¦å¤–ä¸€ä¸ªæ“ä½œçš„å‰é¢ï¼Œè™½ç„¶è¿™ä»ç¨‹åºå‘˜çš„è§’åº¦ä¸Šæ¥è¯´ä¹Ÿå¹¶æ— å¤§ç¢ã€‚æ›´å‡†ç¡®åœ°æ¥è¯´ï¼Œå®ƒæ›´æƒ³è¡¨è¾¾çš„æ„ä¹‰æ˜¯å‰ä¸€ä¸ªæ“ä½œçš„ç»“æœå¯¹äºåä¸€ä¸ªæ“ä½œæ˜¯å¯è§çš„ï¼Œæ— è®ºè¿™ä¸¤ä¸ªæ“ä½œæ˜¯å¦åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œã€‚\nä¸¾ä¸ªä¾‹å­ï¼šæ“ä½œ 1 happens-before æ“ä½œ 2ï¼Œå³ä½¿æ“ä½œ 1 å’Œæ“ä½œ 2 ä¸åœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…ï¼ŒJMM ä¹Ÿä¼šä¿è¯æ“ä½œ 1 çš„ç»“æœå¯¹æ“ä½œ 2 æ˜¯å¯è§çš„ã€‚\nhappens-before å¸¸è§è§„åˆ™æœ‰å“ªäº›ï¼Ÿè°ˆè°ˆä½ çš„ç†è§£ï¼Ÿ # ä¸»è¦çš„5æ¡è§„åˆ™ï¼š\nç¨‹åºé¡ºåºè§„åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹å†…ï¼ŒæŒ‰ç…§ä»£ç é¡ºåºï¼Œä¹¦å†™åœ¨å‰é¢çš„æ“ä½œhappens-beforeäºä¹¦å†™åœ¨åé¢çš„æ“ä½œ è§£é”è§„åˆ™ï¼šè§£é”happens-beforeäºåŠ é” volatileå˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ª volatile å˜é‡çš„å†™æ“ä½œ happens-before äºåé¢å¯¹è¿™ä¸ª volatile å˜é‡çš„è¯»æ“ä½œã€‚è¯´ç™½äº†å°±æ˜¯å¯¹ volatile å˜é‡çš„å†™æ“ä½œçš„ç»“æœå¯¹äºå‘ç”Ÿäºå…¶åçš„ä»»ä½•æ“ä½œéƒ½æ˜¯å¯è§çš„ã€‚ ä¼ é€’è§„åˆ™ï¼šå¦‚æœA happens-before Bï¼Œä¸”B happens-before C ï¼Œé‚£ä¹ˆA happens-before C çº¿ç¨‹å¯åŠ¨è§„åˆ™ï¼šThreadå¯¹è±¡çš„start() æ–¹æ³• happens-before äºæ­¤çº¿ç¨‹çš„æ¯ä¸€ä¸ªæ“ä½œ å¦‚æœä¸¤ä¸ªæ“ä½œï¼Œä¸æ»¡è¶³äºä¸Šè¿°ä»»ä½•ä¸€ä¸ªhappens-beforeè§„åˆ™ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ“ä½œå°±æ²¡æœ‰é¡ºåºçš„ä¿éšœï¼ŒJVMå¯ä»¥å¯¹è¿™ä¸¤ä¸ªæ“ä½œè¿›è¡Œé‡æ’åº\nhappens-before å’ŒJMMä»€ä¹ˆå…³ç³» # æ ¹æ®happens-beforeè§„åˆ™ï¼Œå‘Šè¯‰ç¨‹åºå‘˜ï¼Œæœ‰å“ªäº›happens-beforeè§„åˆ™ï¼ˆå“ªäº›æƒ…å†µä¸ä¼šè¢«é‡æ’åºï¼‰\nä¸ºäº†é¿å… Java ç¨‹åºå‘˜ä¸ºäº†ç†è§£ JMM æä¾›çš„å†…å­˜å¯è§æ€§ä¿è¯è€Œå»å­¦ä¹ å¤æ‚çš„é‡æ’åºè§„åˆ™ä»¥åŠè¿™äº›è§„åˆ™çš„å…·ä½“å®ç°æ–¹æ³•ï¼ŒJMM å°±å‡ºäº†è¿™ä¹ˆä¸€ä¸ªç®€å•æ˜“æ‡‚çš„ Happens-before åŸåˆ™ï¼Œä¸€ä¸ª Happens-before è§„åˆ™å°±å¯¹åº”äºä¸€ä¸ªæˆ–å¤šä¸ªç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„é‡æ’åºè§„åˆ™\nas-if-serial è¯­ä¹‰ä¿è¯å•çº¿ç¨‹å†…ç¨‹åºçš„æ‰§è¡Œç»“æœä¸è¢«æ”¹å˜ï¼ŒHappens-before å…³ç³»ä¿è¯æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œç»“æœä¸è¢«æ”¹å˜ã€‚ as-if-serial è¯­ä¹‰ç»™ç¼–å†™å•çº¿ç¨‹ç¨‹åºçš„ç¨‹åºå‘˜åˆ›é€ äº†ä¸€ä¸ªå¹»å¢ƒï¼šå•çº¿ç¨‹ç¨‹åºæ˜¯æŒ‰ç¨‹åºçš„é¡ºåºæ¥æ‰§è¡Œçš„ã€‚Happens-before å…³ç³»ç»™ç¼–å†™æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºçš„ç¨‹åºå‘˜åˆ›é€ äº†ä¸€ä¸ªå¹»å¢ƒï¼šæ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºæ˜¯æŒ‰ Happens-before æŒ‡å®šçš„é¡ºåºæ¥æ‰§è¡Œçš„ã€‚ JMMå®šä¹‰çš„\nå†çœ‹å¹¶å‘ç¼–ç¨‹ä¸‰ä¸ªé‡è¦ç‰¹æ€§ # åŸå­æ€§ï¼Œå¯è§æ€§ï¼Œæœ‰åºæ€§\nåŸå­æ€§ ä¸€æ¬¡æ“ä½œæˆ–å¤šæ¬¡æ“ä½œï¼Œè¦ä¹ˆæ‰€æœ‰çš„æ“ä½œï¼Œå…¨éƒ¨éƒ½å¾—åˆ°æ‰§è¡Œå¹¶ä¸”ä¸ä¼šå—åˆ°ä»»ä½•å› ç´ çš„å¹²æ‰°è€Œä¸­æ–­ï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ\nJavaä¸­ï¼Œä½¿ç”¨synchronizedã€å„ç§Lockä»¥åŠå„ç§åŸå­ç±»å®ç°åŸå­æ€§(AtomicIntegerç­‰)\nsynchronized å’Œå„ç§ Lock å¯ä»¥ä¿è¯ä»»ä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®è¯¥ä»£ç å—ï¼Œå› æ­¤å¯ä»¥ä¿éšœåŸå­æ€§ã€‚å„ç§åŸå­ç±»æ˜¯åˆ©ç”¨ CAS (compare and swap) æ“ä½œï¼ˆå¯èƒ½ä¹Ÿä¼šç”¨åˆ° volatileæˆ–è€…finalå…³é”®å­—ï¼‰æ¥ä¿è¯åŸå­æ“ä½œã€‚\nå¯è§æ€§ å½“ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡è¿›è¡Œäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆå¦å¤–çš„çº¿ç¨‹éƒ½æ˜¯ç«‹å³å¯ä»¥çœ‹åˆ°ä¿®æ”¹åçš„æœ€æ–°å€¼ã€‚\nåœ¨ Java ä¸­ï¼Œå¯ä»¥å€ŸåŠ©synchronized ã€volatile ä»¥åŠå„ç§ Lock å®ç°å¯è§æ€§ã€‚\nå¦‚æœæˆ‘ä»¬å°†å˜é‡å£°æ˜ä¸º volatile ï¼Œè¿™å°±æŒ‡ç¤º JVMï¼Œè¿™ä¸ªå˜é‡æ˜¯å…±äº«ä¸”ä¸ç¨³å®šçš„ï¼Œæ¯æ¬¡ä½¿ç”¨å®ƒéƒ½åˆ°ä¸»å­˜ä¸­è¿›è¡Œè¯»å–ã€‚\næœ‰åºæ€§ ç”±äºæŒ‡ä»¤é‡æ’åºé—®é¢˜ï¼Œä»£ç çš„æ‰§è¡Œé¡ºåºæœªå¿…å°±æ˜¯ç¼–å†™ä»£ç æ—¶å€™çš„é¡ºåº\næŒ‡ä»¤é‡æ’åºå¯ä»¥ä¿è¯ä¸²è¡Œè¯­ä¹‰ä¸€è‡´ï¼Œä½†æ˜¯æ²¡æœ‰ä¹‰åŠ¡ä¿è¯å¤šçº¿ç¨‹é—´çš„è¯­ä¹‰ä¹Ÿä¸€è‡´ ï¼Œæ‰€ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹ï¼ŒæŒ‡ä»¤é‡æ’åºå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ã€‚\nJavaä¸­ï¼Œvolatileå…³é”®å­—å¯ä»¥ç¦æ­¢æŒ‡ä»¤è¿›è¡Œé‡æ’åºä¼˜åŒ–ï¼ˆæ³¨æ„ï¼Œsynchronizedä¹Ÿå¯ä»¥ï¼‰\næ€»ç»“ # è¡¥å……ï¼šçº¿ç¨‹join()æ–¹æ³•ï¼Œå¯¼è‡´è°ƒç”¨çº¿ç¨‹æš‚åœï¼Œç›´åˆ°xx.join()ä¸­çš„xxçº¿ç¨‹æ‰§è¡Œå®Œï¼Œè°ƒç”¨joinæ–¹æ³•çš„çº¿ç¨‹æ‰ç»§ç»­æ‰§è¡Œ\nThread thread1 = new Thread(new Runnable() { @Override public void run() { log.info(\u0026#34;æš‚åœ5s\u0026#34;); try { TimeUnit.SECONDS.sleep(5); } catch (InterruptedException e) { e.printStackTrace(); } } }); thread1.start(); Thread thread2 = new Thread(new Runnable() { @Override public void run() { log.info(\u0026#34;æš‚åœ3s\u0026#34;); try { TimeUnit.SECONDS.sleep(3); } catch (InterruptedException e) { e.printStackTrace(); } } }); thread2.start(); thread1.join(); thread2.join(); log.info(\u0026#34;ä¸»çº¿ç¨‹æ‰§è¡Œ\u0026#34;); /*ç»“æœ 2022-11-23 13:57:06 ä¸‹åˆ [Thread: Thread-1] INFO:æš‚åœ5s 2022-11-23 13:57:06 ä¸‹åˆ [Thread: Thread-2] INFO:æš‚åœ3s 2022-11-23 13:57:11 ä¸‹åˆ [Thread: main] INFO:ä¸»çº¿ç¨‹æ‰§è¡Œ */ æŒ‡ä»¤é‡æ’çš„å½±å“ï¼Œä¸¾ä¾‹ï¼šã€â˜…å¾ˆé‡è¦â˜…ã€‘\npublic class Test { private static int x = 0, y = 0; private static int a = 0, b = 0; public static void main(String[] args) throws InterruptedException { for (int i = 0; ; i++) { x = 0; y = 0; a = 0; b = 0; Thread one = new Thread(() -\u0026gt; { a = 1; x = b; }); Thread other = new Thread(() -\u0026gt; { b = 1; y = a; }); one.start(); other.start();; one.join(); other.join(); if (x == 0 \u0026amp;\u0026amp; y == 0) { String result = \u0026#34;ç¬¬\u0026#34; + i + \u0026#34;æ¬¡ï¼ˆ\u0026#34; + x + \u0026#34;, \u0026#34; + y + \u0026#34;ï¼‰\u0026#34;; System.out.println(result); } } } } /* å› ä¸ºçº¿ç¨‹oneä¸­ï¼Œaå’Œxå¹¶ä¸å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œå› æ­¤å¯èƒ½ä¼šå…ˆæ‰§è¡Œx=b;è€Œè¿™ä¸ªæ—¶å€™ï¼Œb=0ã€‚å› æ­¤xä¼šè¢«èµ‹å€¼ä¸º0ï¼Œè€Œa=1è¿™æ¡è¯­å¥è¿˜æ²¡æœ‰è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œçº¿ç¨‹otherå…ˆæ‰§è¡Œäº†y=aè¿™æ¡è¯­å¥ï¼Œè¿™ä¸ªæ—¶å€™aè¿˜æ˜¯a=0;å› æ­¤yè¢«èµ‹å€¼ä¸ºäº†0ã€‚æ‰€ä»¥å­˜åœ¨æƒ…å†µx=0;y=0ã€‚è¿™å°±æ˜¯æŒ‡ä»¤é‡æ’å¯¼è‡´çš„å¤šçº¿ç¨‹é—®é¢˜ã€‚ åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/qq_45948401/article/details/124973903 */ Java æ˜¯æœ€æ—©å°è¯•æä¾›å†…å­˜æ¨¡å‹çš„è¯­è¨€ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ç®€åŒ–å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œå¢å¼ºç¨‹åºå¯ç§»æ¤æ€§çš„ã€‚ CPU å¯ä»¥é€šè¿‡åˆ¶å®šç¼“å­˜ä¸€è‡´åè®®ï¼ˆæ¯”å¦‚ MESI åè®®open in new windowï¼‰æ¥è§£å†³å†…å­˜ç¼“å­˜ä¸ä¸€è‡´æ€§é—®é¢˜ã€‚ ä¸ºäº†æå‡æ‰§è¡Œé€Ÿåº¦/æ€§èƒ½ï¼Œè®¡ç®—æœºåœ¨æ‰§è¡Œç¨‹åºä»£ç çš„æ—¶å€™ï¼Œä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºã€‚ ç®€å•æ¥è¯´å°±æ˜¯ç³»ç»Ÿåœ¨æ‰§è¡Œä»£ç çš„æ—¶å€™å¹¶ä¸ä¸€å®šæ˜¯æŒ‰ç…§ä½ å†™çš„ä»£ç çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚æŒ‡ä»¤é‡æ’åºå¯ä»¥ä¿è¯ä¸²è¡Œè¯­ä¹‰ä¸€è‡´ï¼Œä½†æ˜¯æ²¡æœ‰ä¹‰åŠ¡ä¿è¯å¤šçº¿ç¨‹é—´çš„è¯­ä¹‰ä¹Ÿä¸€è‡´ ï¼Œæ‰€ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹ï¼ŒæŒ‡ä»¤é‡æ’åºå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ã€‚ ä½ å¯ä»¥æŠŠ JMM çœ‹ä½œæ˜¯ Java å®šä¹‰çš„å¹¶å‘ç¼–ç¨‹ç›¸å…³çš„ä¸€ç»„è§„èŒƒï¼Œé™¤äº†æŠ½è±¡äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„å…³ç³»ä¹‹å¤–ï¼Œå…¶è¿˜è§„å®šäº†ä» Java æºä»£ç åˆ° CPU å¯æ‰§è¡ŒæŒ‡ä»¤çš„è¿™ä¸ªè½¬åŒ–è¿‡ç¨‹è¦éµå®ˆå“ªäº›å’Œå¹¶å‘ç›¸å…³çš„åŸåˆ™å’Œè§„èŒƒï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ç®€åŒ–å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œå¢å¼ºç¨‹åºå¯ç§»æ¤æ€§çš„ã€‚ JSR 133 å¼•å…¥äº† happens-before è¿™ä¸ªæ¦‚å¿µæ¥**ï¼ˆæå…¶é‡è¦åˆç²¾ç®€çš„è¯ï¼‰æè¿°ä¸¤ä¸ªæ“ä½œä¹‹é—´çš„å†…å­˜å¯è§æ€§**ã€‚ "},{"id":135,"href":"/zh/docs/study/Review/java_guide/java/Concurrent/ly0303lyconcurrent-03/","title":"å¹¶å‘03","section":"å¹¶å‘","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nçº¿ç¨‹æ±  # ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± \næ± åŒ–æŠ€æœ¯ï¼šçº¿ç¨‹æ± ã€æ•°æ®åº“è¿æ¥æ± ã€Httpè¿æ¥æ±  æ± åŒ–æŠ€æœ¯æ€æƒ³æ„ä¹‰ï¼šä¸ºäº†å‡å°‘æ¯æ¬¡è·å–èµ„æºçš„æ¶ˆè€—ï¼Œæé«˜å¯¹èµ„æºçš„åˆ©ç”¨ç‡ çº¿ç¨‹æ± æä¾›äº†é™åˆ¶å’Œç®¡ç† èµ„æº(åŒ…æ‹¬æ‰§è¡Œä¸€ä¸ªä»»åŠ¡)çš„æ–¹å¼ æ¯ä¸ªçº¿ç¨‹æ± è¿˜ç»´æŠ¤åŸºæœ¬ç»Ÿè®¡ä¿¡æ¯ï¼Œä¾‹å¦‚å·²å®Œæˆä»»åŠ¡çš„æ•°é‡ å¥½å¤„ï¼š é™ä½èµ„æºæ¶ˆè€— é‡å¤åˆ©ç”¨å·²åˆ›å»ºçº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€— æé«˜å“åº”é€Ÿåº¦ ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç»§ç»­æ‰§è¡Œ æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶åˆ›å»ºï¼Œä¸ä»…æ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± ç»Ÿä¸€ç®¡ç†åˆ†é…ã€è°ƒä¼˜å’Œç›‘æ§ã€‚ å®ç°Runnableæ¥å£å’ŒCallableæ¥å£çš„åŒºåˆ«\n//Callableçš„ç”¨æ³• public class TestLy { //å¦‚æœåŠ ä¸Švolatile,å°±èƒ½ä¿è¯å¯è§æ€§ï¼Œçº¿ç¨‹1 æ‰èƒ½åœæ­¢ boolean stop = false;//å¯¹è±¡å±æ€§ public static void main(String[] args) throws InterruptedException, ExecutionException { FutureTask\u0026lt;String\u0026gt; futureTask=new FutureTask\u0026lt;\u0026gt;(new Callable\u0026lt;String\u0026gt;() { @Override public String call() throws Exception { System.out.println(\u0026#34;ç­‰3så†æŠŠç»“æœç»™ä½ \u0026#34;); TimeUnit.SECONDS.sleep(3); return \u0026#34;hello world\u0026#34;; } }); new Thread(futureTask).start(); String s = futureTask.get(); System.out.println(\u0026#34;3såè·å–åˆ°äº†ç»“æœ\u0026#34;+s); new Thread(new Runnable() { @Override public void run() { System.out.println(\u0026#34;abc\u0026#34;); } }).start(); } } /* ç­‰3så†æŠŠç»“æœç»™ä½  3såè·å–åˆ°äº†ç»“æœhello world abc */ Runnableæ¥å£ä¸ä¼šè¿”å›ç»“æœæˆ–æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸ï¼ŒCallableæ¥å£å¯ä»¥\nExecutorså¯ä»¥å®ç°å°†Runnableå¯¹è±¡è½¬æ¢æˆCallableå¯¹è±¡\nExecutors.callable(Runnable task)æˆ–Executors.callable(Runnable task, Object result) //åˆ™ä¸¤ä¸ªæ–¹æ³•ï¼Œè¿è¡Œçš„ç»“æœæ˜¯ Callable\u0026lt;Object\u0026gt;\n//ä¸€ä¸ªä¸æŒ‡å®šç»“æœï¼Œå¦ä¸€ä¸ªæŒ‡å®šç»“æœ public static void main(String[] args) throws Exception { Callable\u0026lt;Object\u0026gt; abc = Executors.callable(() -\u0026gt; { try { TimeUnit.SECONDS.sleep(2); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(\u0026#34;abc\u0026#34;); },\u0026#34;abcccc\u0026#34;);//å¦‚æœæ²¡æœ‰\u0026#34;abcccc\u0026#34;ï¼Œåˆ™ä¸‹é¢è¾“å‡ºnull FutureTask\u0026lt;Object\u0026gt; futureTask = new FutureTask\u0026lt;\u0026gt;(abc); new Thread(futureTask).start(); Object o = futureTask.get(); System.out.println(\u0026#34;è·å–å€¼ï¼š\u0026#34;+o); } Runnableå’ŒCallableï¼š\n//Runnable.java @FunctionalInterface public interface Runnable { /** * è¢«çº¿ç¨‹æ‰§è¡Œï¼Œæ²¡æœ‰è¿”å›å€¼ä¹Ÿæ— æ³•æŠ›å‡ºå¼‚å¸¸ */ public abstract void run(); } //========================================= //Callable.java @FunctionalInterface public interface Callable\u0026lt;V\u0026gt; { /** * è®¡ç®—ç»“æœï¼Œæˆ–åœ¨æ— æ³•è¿™æ ·åšæ—¶æŠ›å‡ºå¼‚å¸¸ã€‚ * @return è®¡ç®—å¾—å‡ºçš„ç»“æœ * @throws å¦‚æœæ— æ³•è®¡ç®—ç»“æœï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ */ V call() throws Exception; } æ‰§è¡Œexecute()å’Œsubmit()æ–¹æ³•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ\nexecute() æ–¹æ³•ç”¨äºæäº¤ä¸éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ï¼Œæ‰€ä»¥æ— æ³•åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«çº¿ç¨‹æ± æ‰§è¡ŒæˆåŠŸ\nsubmit()æ–¹æ³•ç”¨äºæäº¤éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ï¼Œçº¿ç¨‹æ± ä¼šè¿”å›ä¸€ä¸ªFutureç±»å‹çš„å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ªFutureå¯¹è±¡å¯ä»¥åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¿”å›æˆåŠŸ\nè¿™ä¸ªFutureçš„get()æ–¹æ³•æ¥è·å–è¿”å›å€¼ï¼Œget()æ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°ä»»åŠ¡å®Œæˆï¼› ä½¿ç”¨get(long timeout,TimeUnit unit) æ–¹æ³•ä¼šåœ¨é˜»å¡å½“å‰çº¿ç¨‹ä¸€æ®µæ—¶é—´åç«‹å³è¿”å›(æ­¤æ—¶ä»»åŠ¡ä¸ä¸€å®šå·²ç»æ‰§è¡Œå®Œ) æ³¨æ„: è¿™é‡Œçš„get()ä¸ä¸€å®šä¼šæœ‰è¿”å›å€¼çš„ï¼Œä¾‹å­å¦‚ä¸‹\nExecutorService executorService = Executors.newCachedThreadPool(); Callable\u0026lt;MyClass\u0026gt; myClassCallable = new Callable\u0026lt;MyClass\u0026gt;() { @Override public MyClass call() throws Exception { MyClass myClass1 = new MyClass(); myClass1.setName(\u0026#34;ly-callable-æµ‹è¯•\u0026#34;); TimeUnit.SECONDS.sleep(2); return myClass1; } }; Future\u0026lt;?\u0026gt; submit = executorService.submit(myClassCallable); //è¿™é‡Œä¼šé˜»å¡ Object o = submit.get(); log.info(\u0026#34;ly-callable-æ‰“å°ç»“æœ1:\u0026#34; + o); FutureTask\u0026lt;MyClass\u0026gt; futureTask = new FutureTask\u0026lt;\u0026gt;(() -\u0026gt; { MyClass myClass1 = new MyClass(); myClass1.setName(\u0026#34;ly-FutureTask-æµ‹è¯•\u0026#34;); TimeUnit.SECONDS.sleep(2); return myClass1; }); Future\u0026lt;?\u0026gt; submit2 = executorService.submit(futureTask); //è¿™é‡Œä¼šé˜»å¡ Object o2 = submit2.get(); log.info(\u0026#34;ly-callable-æ‰“å°ç»“æœ2:\u0026#34; + o2); executorService.shutdown(); /*ç»“æœ 2022-11-09 10:19:10 ä¸Šåˆ [Thread: main] INFO:ly-callable-æ‰“å°ç»“æœ1:MyClass(name=ly-callable-æµ‹è¯•) 2022-11-09 10:19:12 ä¸Šåˆ [Thread: main] INFO:ly-callable-æ‰“å°ç»“æœ2:null */ å½“submitä¸€ä¸ªCallableå¯¹è±¡çš„æ—¶å€™ï¼Œèƒ½ä»submitè¿”å›çš„Future.getåˆ°è¿”å›å€¼ï¼›å½“submitä¸€ä¸ªFutureTaskå¯¹è±¡ï¼ˆFutureTaskæœ‰å‚æ„é€ å‡½æ•°åŒ…å«Callableå¯¹è±¡ï¼Œä½†å®ƒæœ¬èº«ä¸æ˜¯Callableï¼‰æ—¶ï¼Œæ²¡æ³•è·å–è¿”å›å€¼ï¼Œå› ä¸ºä¼šè¢«å½“ä½œRunnableå¯¹è±¡submitè¿›æ¥\nè™šçº¿æ˜¯å®ç°ï¼Œå®çº¿æ˜¯ç»§æ‰¿ã€‚\nè€Œå…¥å‚ä¸ºRunnableæ—¶è¿”å›å€¼é‡Œæ˜¯getä¸åˆ°ç»“æœçš„\nä¸‹é¢è¿™æ®µæºç ï¼Œè§£é‡Šäº†ä¸ºä»€ä¹ˆå½“ä¼ å…¥çš„ç±»å‹æ˜¯Runnableå¯¹è±¡æ—¶ï¼Œç»“æœä¸ºnull\nåªè¦æ˜¯submitï¼ˆRunnable ï¼‰ï¼Œå°±ä¼šè¿”å›null\n//æºç AbstractExecutorService æ¥å£ä¸­çš„ä¸€ä¸ªsubmitæ–¹æ³• public Future\u0026lt;?\u0026gt; submit(Runnable task) { if (task == null) throw new NullPointerException(); RunnableFuture\u0026lt;Void\u0026gt; ftask = newTaskFor(task, null); execute(ftask); return ftask; } //å…¶ä¸­çš„newTaskForæ–¹æ³• protected \u0026lt;T\u0026gt; RunnableFuture\u0026lt;T\u0026gt; newTaskFor(Runnable runnable, T value) { return new FutureTask\u0026lt;T\u0026gt;(runnable, value); } //execute()æ–¹æ³• public void execute(Runnable command) { ... } FutureTaskã€Threadã€Callableã€Executors\nå¦‚ä½•åˆ›å»ºçº¿ç¨‹æ± \nexecutor [ÉªÉ¡ËˆzekjÉ™tÉ™(r)] é—å˜±æ‰§è¡Œäºº(æˆ–é“¶è¡Œç­‰)\nå…³äºSynchronousQueueï¼ˆå…·æœ‰0ä¸ªå…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼‰ï¼š\nSynchronousQueue\u0026lt;String\u0026gt; synchronousQueue =new SynchronousQueue\u0026lt;\u0026gt;(); new Thread(()-\u0026gt;{ try { log.info(\u0026#34;æ”¾å…¥æ•°æ®A\u0026#34;); synchronousQueue.put(\u0026#34;A\u0026#34;); } catch (InterruptedException e) { e.printStackTrace(); } log.info(\u0026#34;ç»§ç»­æ‰§è¡Œ\u0026#34;); },\u0026#34;å­çº¿ç¨‹1\u0026#34;).start(); new Thread(()-\u0026gt;{ try { TimeUnit.SECONDS.sleep(3); } catch (InterruptedException e) { e.printStackTrace(); } String poll = null; try { poll = synchronousQueue.take(); } catch (InterruptedException e) { e.printStackTrace(); } log.info(poll); },\u0026#34;å­çº¿ç¨‹2\u0026#34;).start(); /**è¾“å‡º 2023-03-07 15:20:17 ä¸‹åˆ [Thread: å­çº¿ç¨‹1] INFO:æ”¾å…¥æ•°æ®A ---è¿™é‡Œä¼šç­‰å¾…3s(ç­‰å­çº¿ç¨‹2 task()æ¶ˆè´¹æ‰) 2023-03-07 15:20:20 ä¸‹åˆ [Thread: å­çº¿ç¨‹2] INFO:A 2023-03-07 15:20:20 ä¸‹åˆ [Thread: å­çº¿ç¨‹1] INFO:ç»§ç»­æ‰§è¡Œ */ ä¸å…è®¸ä½¿ç”¨Executorså»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡new ThreadPoolExecutorçš„æ–¹å¼ï¼šèƒ½è®©å†™çš„åŒå­¦æ˜ç¡®çº¿ç¨‹æ± è¿è¡Œè§„åˆ™ï¼Œè§„é¿èµ„æºè€—å°½\n/* å·¥å…·çš„æ–¹å¼åˆ›å»ºçº¿ç¨‹æ±  */ void test(){ ExecutorService executorService = Executors.newCachedThreadPool(); Callable\u0026lt;MyClass\u0026gt; myClassCallable = new Callable\u0026lt;MyClass\u0026gt;() { @Override public MyClass call() throws Exception { MyClass myClass1 = new MyClass(); myClass1.setName(\u0026#34;ly-callable-æµ‹è¯•\u0026#34;); TimeUnit.SECONDS.sleep(2); return myClass1; } }; Future\u0026lt;?\u0026gt; submit = executorService.submit(myClassCallable); //è¿™é‡Œä¼šé˜»å¡ Object o = submit.get(); log.info(\u0026#34;ly-callable-æ‰“å°ç»“æœ1:\u0026#34; + o); } ä½¿ç”¨Executorsè¿”å›çº¿ç¨‹æ± å¯¹è±¡çš„å¼Šç«¯ï¼š\nThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue\u0026lt;Runnable\u0026gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler){} //#####æ—¶é—´è¡¨ç¤ºkeepAliveTime##### //########çº¿ç¨‹æ•°é‡å›ºå®šï¼Œé˜Ÿåˆ—é•¿åº¦ä¸ºInteger.MAX################ Executors.newFixedThreadPool(3); public static ExecutorService newFixedThreadPool(int nThreads) { return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue\u0026lt;Runnable\u0026gt;()); } //############çº¿ç¨‹æ•°é‡å›ºå®šï¼Œé˜Ÿåˆ—é•¿åº¦ä¸ºInteger.MAX############## Executors.newSingleThreadExecutor(Executors.defaultThreadFactory()); public static ExecutorService newSingleThreadExecutor(ThreadFactory threadFactory) { return new FinalizableDelegatedExecutorService (new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue\u0026lt;Runnable\u0026gt;(), threadFactory)); //############çº¿ç¨‹æ•°é‡ä¸ºInteger.MAX############# Executors.newCachedThreadPool(Executors.defaultThreadFactory()); public static ExecutorService newCachedThreadPool(ThreadFactory threadFactory) { return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue\u0026lt;Runnable\u0026gt;(), threadFactory); } //#############çº¿ç¨‹æ•°é‡ä¸ºInteger.MAX############# Executors.newScheduledThreadPool(3, Executors.defaultThreadFactory()); public static ScheduledExecutorService newScheduledThreadPool( int corePoolSize, ThreadFactory threadFactory) { return new ScheduledThreadPoolExecutor(corePoolSize, threadFactory); } ====================\u0026gt; public ScheduledThreadPoolExecutor(int corePoolSize, ThreadFactory threadFactory) { super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS, new DelayedWorkQueue(), threadFactory); } FixedThreadPoolå’ŒSingleThreadExecutorï¼šè¿™ä¸¤ä¸ªæ–¹æ¡ˆå…è®¸è¯·æ±‚çš„é˜Ÿåˆ—é•¿åº¦ä¸ºInteger.MAX_VALUEï¼Œå¯èƒ½å †ç§¯å¤§é‡è¯·æ±‚ï¼Œå¯¼è‡´OOM CachedThreadPoolå’ŒScheduledThreadPoolï¼šå…è®¸åˆ›å»ºçš„çº¿ç¨‹æ•°é‡ä¸ºInteger.MAX_VALUEï¼Œå¯èƒ½åˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œå¯¼è‡´OOM é€šè¿‡æ„é€ æ–¹æ³•å®ç° é€šè¿‡Executoræ¡†æ¶çš„å·¥å…·ç±»Executorsæ¥å®ç° ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•ï¼Œè¿”å›çš„ç±»å‹éƒ½æ˜¯ThreadPoolExecutor\nFixedThreadPool : è¯¥æ–¹æ³•è¿”å›å›ºå®šçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ•°é‡å§‹ç»ˆä¸å˜ã€‚å½“æœ‰æ–°ä»»åŠ¡æäº¤æ—¶ï¼Œçº¿ç¨‹æ± ä¸­è‹¥æœ‰ç©ºé—²çº¿ç¨‹åˆ™ç«‹å³æ‰§è¡Œï¼›è‹¥æ²¡æœ‰ï¼Œåˆ™æ–°ä»»åŠ¡è¢«æš‚å­˜åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå¾…æœ‰çº¿ç¨‹ç©ºé—²æ—¶ï¼Œåˆ™å¤„ç†åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ SingleThreadExecutorï¼šæ–¹æ³•è¿”å›ä¸€ä¸ªåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚è‹¥å¤šä½™ä¸€ä¸ªä»»åŠ¡è¢«æäº¤åˆ°è¯¥çº¿ç¨‹æ± ï¼Œä»»åŠ¡è¢«ä¿å­˜åˆ°ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå¾…çº¿ç¨‹ç©ºé—²ï¼ŒæŒ‰å…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ‰§è¡Œé˜Ÿåˆ—ä¸­ä»»åŠ¡ CachedThreadPoolï¼šè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´çº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± ã€‚ æ•°é‡ä¸å›ºå®šï¼Œè‹¥æœ‰ç©ºé—²çº¿ç¨‹å¯ä»¥å¤ç”¨åˆ™ä¼˜å…ˆä½¿ç”¨å¯å¤ç”¨çº¿ç¨‹ã€‚è‹¥æ‰€æœ‰çº¿ç¨‹å‡å·¥ä½œï¼Œæ­¤æ—¶åˆæœ‰æ–°ä»»åŠ¡æäº¤ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹å¤„ç†ä»»åŠ¡ã€‚æ‰€æœ‰çº¿ç¨‹åœ¨å½“å‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åè¿”å›çº¿ç¨‹æ± è¿›è¡Œå¤ç”¨ Executorså·¥å…·ç±»ä¸­çš„æ–¹æ³•\næ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ è¯¥ç±»æä¾›å››ä¸ªæ„é€ æ–¹æ³•ï¼Œçœ‹æœ€é•¿é‚£ä¸ªï¼Œå…¶ä½™çš„éƒ½æ˜¯ï¼ˆç»™å®šé»˜è®¤å€¼åï¼‰è°ƒç”¨è¿™ä¸ªæ–¹æ³•\n/** * ç”¨ç»™å®šçš„åˆå§‹å‚æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ThreadPoolExecutorã€‚ */ public ThreadPoolExecutor(int corePoolSize,//çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°é‡ int maximumPoolSize,//çº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•° long keepAliveTime,//å½“çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œå¤šä½™çš„ç©ºé—²çº¿ç¨‹å­˜æ´»çš„æœ€é•¿æ—¶é—´ TimeUnit unit,//æ—¶é—´å•ä½ BlockingQueue\u0026lt;Runnable\u0026gt; workQueue,//ä»»åŠ¡é˜Ÿåˆ—ï¼Œç”¨æ¥å‚¨å­˜ç­‰å¾…æ‰§è¡Œä»»åŠ¡çš„é˜Ÿåˆ— ThreadFactory threadFactory,//çº¿ç¨‹å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºçº¿ç¨‹ï¼Œä¸€èˆ¬é»˜è®¤å³å¯ RejectedExecutionHandler handler//æ‹’ç»ç­–ç•¥ï¼Œå½“æäº¤çš„ä»»åŠ¡è¿‡å¤šè€Œä¸èƒ½åŠæ—¶å¤„ç†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶ç­–ç•¥æ¥å¤„ç†ä»»åŠ¡ ) { if (corePoolSize \u0026lt; 0 || maximumPoolSize \u0026lt;= 0 || maximumPoolSize \u0026lt; corePoolSize || keepAliveTime \u0026lt; 0) throw new IllegalArgumentException(); if (workQueue == null || threadFactory == null || handler == null) throw new NullPointerException(); this.corePoolSize = corePoolSize; this.maximumPoolSize = maximumPoolSize; this.workQueue = workQueue; this.keepAliveTime = unit.toNanos(keepAliveTime); this.threadFactory = threadFactory; this.handler = handler; } æ„é€ å‡½æ•°é‡è¦å‚æ•°åˆ†æ\ncorePoolSize : æ ¸å¿ƒçº¿ç¨‹æ•°å®šä¹‰æœ€å°å¯ä»¥è¿è¡Œçš„çº¿ç¨‹æ•°é‡\nmaximumPoolSize: å½“é˜Ÿåˆ—ä¸­å­˜æ”¾çš„ä»»åŠ¡è¾¾åˆ°é˜Ÿåˆ—å®¹é‡æ—¶ï¼Œå½“å‰å¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡å˜ä¸ºæœ€å¤§çº¿ç¨‹æ•°\nworkQueueï¼šå½“æ–°çº¿ç¨‹æ¥çš„æ—¶å€™å…ˆåˆ¤æ–­å½“å‰è¿è¡Œçº¿ç¨‹æ•°é‡æ˜¯å¦è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¦‚æœè¾¾åˆ°çš„è¯ï¼Œæ–°ä»»åŠ¡å°±ä¼šè¢«å­˜æ”¾åœ¨é˜Ÿåˆ—ä¸­ ThreadPoolExecutorå…¶ä»–å¸¸è§å‚æ•°ï¼š\nkeepAliveTimeï¼šå¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºcorePoolSizeæ—¶ï¼Œå¦‚æœè¿™æ—¶æ²¡æœ‰æ–°ä»»åŠ¡æäº¤ï¼Œæ ¸å¿ƒçº¿ç¨‹å¤–çš„çº¿ç¨‹ä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ç­‰å¾…ï¼Œç­‰å¾…çš„æ—¶é—´è¶…è¿‡äº†keepAliveTimeå°±ä¼šè¢«å›æ”¶\nunit: keepAliveTimeå‚æ•°çš„æ—¶é—´å•ä½\nthreadFactory: executoråˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶å€™ä¼šç”¨åˆ°\nhandle: é¥±å’Œç­–ç•¥\nå¦‚æœåŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼Œä¸”é˜Ÿåˆ—å·²ç»è¢«æ”¾æ»¡ä»»åŠ¡ï¼ŒThreadPoolTaskExecutorå®šä¹‰è¯¥æƒ…å†µä¸‹çš„ç­–ç•¥ï¼š\nThreadPoolExecutor.AbortPolicyï¼š æŠ›å‡º RejectedExecutionExceptionæ¥æ‹’ç»æ–°ä»»åŠ¡çš„å¤„ç†ã€‚ ThreadPoolExecutor.CallerRunsPolicyï¼š è°ƒç”¨æ‰§è¡Œè‡ªå·±çš„çº¿ç¨‹(å¦‚æœåœ¨mainæ–¹æ³•ä¸­ï¼Œé‚£å°±æ˜¯mainçº¿ç¨‹)è¿è¡Œä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥åœ¨è°ƒç”¨executeæ–¹æ³•çš„çº¿ç¨‹ä¸­è¿è¡Œ(run)è¢«æ‹’ç»çš„ä»»åŠ¡ï¼Œå¦‚æœæ‰§è¡Œç¨‹åºå·²å…³é—­ï¼Œåˆ™ä¼šä¸¢å¼ƒè¯¥ä»»åŠ¡ã€‚å› æ­¤è¿™ç§ç­–ç•¥ä¼šé™ä½å¯¹äºæ–°ä»»åŠ¡æäº¤é€Ÿåº¦ï¼Œå½±å“ç¨‹åºçš„æ•´ä½“æ€§èƒ½ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥æ‰¿å—æ­¤å»¶è¿Ÿå¹¶ä¸”ä½ è¦æ±‚ä»»ä½•ä¸€ä¸ªä»»åŠ¡è¯·æ±‚éƒ½è¦è¢«æ‰§è¡Œçš„è¯ï¼Œä½ å¯ä»¥é€‰æ‹©è¿™ä¸ªç­–ç•¥ã€‚ ThreadPoolExecutor.DiscardPolicyï¼š ä¸å¤„ç†æ–°ä»»åŠ¡ï¼Œç›´æ¥ä¸¢å¼ƒæ‰ã€‚ ThreadPoolExecutor.DiscardOldestPolicyï¼š æ­¤ç­–ç•¥å°†ä¸¢å¼ƒæœ€æ—©çš„æœªå¤„ç†çš„ä»»åŠ¡è¯·æ±‚ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœåœ¨Springä¸­é€šè¿‡ThreadPoolTaskExecutoræˆ–ç›´æ¥é€šè¿‡ThreadPoolExecutoræ„é€ å‡½æ•°åˆ›å»ºçº¿ç¨‹æ± æ—¶ï¼Œè‹¥ä¸æŒ‡å®šRejectExcecutorHandleré¥±å’Œç­–ç•¥åˆ™é»˜è®¤ä½¿ç”¨ThreadPoolExecutor.AbortPolicyï¼Œå³æŠ›å‡ºRejectedExecutionæ¥æ‹’ç»æ–°æ¥çš„ä»»åŠ¡ï¼›å¯¹äºå¯ä¼¸ç¼©ç¨‹åºï¼Œå»ºè®®ä½¿ç”¨ThreadPoolExecutor.CallerRunsPolicyï¼Œ\nä¸€ä¸ªç®€å•çš„çº¿ç¨‹æ± Demo\n//å®šä¹‰ä¸€ä¸ªRunnableæ¥å£å®ç°ç±» import java.util.Date; /** * è¿™æ˜¯ä¸€ä¸ªç®€å•çš„Runnableç±»ï¼Œéœ€è¦å¤§çº¦5ç§’é’Ÿæ¥æ‰§è¡Œå…¶ä»»åŠ¡ã€‚ * @author shuang.kou */ public class MyRunnable implements Runnable { private String command; public MyRunnable(String s) { this.command = s; } @Override public void run() { System.out.println(Thread.currentThread().getName() + \u0026#34; Start. Time = \u0026#34; + new Date()); processCommand(); System.out.println(Thread.currentThread().getName() + \u0026#34; End. Time = \u0026#34; + new Date()); } private void processCommand() { try { Thread.sleep(5000); } catch (InterruptedException e) { e.printStackTrace(); } } @Override public String toString() { return this.command; } } //å®é™…æ‰§è¡Œ import java.util.concurrent.ArrayBlockingQueue; import java.util.concurrent.ThreadPoolExecutor; import java.util.concurrent.TimeUnit; public class ThreadPoolExecutorDemo { private static final int CORE_POOL_SIZE = 5;//æ ¸å¿ƒçº¿ç¨‹æ•°5 private static final int MAX_POOL_SIZE = 10;//æœ€å¤§çº¿ç¨‹æ•°10 private static final int QUEUE_CAPACITY = 100;//é˜Ÿåˆ—å®¹é‡100 private static final Long KEEP_ALIVE_TIME = 1L;//ç­‰å¾…æ—¶é—´ public static void main(String[] args) { //ä½¿ç”¨é˜¿é‡Œå·´å·´æ¨èçš„åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼ //é€šè¿‡ThreadPoolExecutoræ„é€ å‡½æ•°è‡ªå®šä¹‰å‚æ•°åˆ›å»º ThreadPoolExecutor executor = new ThreadPoolExecutor( CORE_POOL_SIZE, MAX_POOL_SIZE, KEEP_ALIVE_TIME,8 TimeUnit.SECONDS, new ArrayBlockingQueue\u0026lt;\u0026gt;(QUEUE_CAPACITY), new ThreadPoolExecutor.CallerRunsPolicy()); for (int i = 0; i \u0026lt; 10; i++) { //åˆ›å»º MyRunnable å¯¹è±¡ï¼ˆMyRunnable ç±»å®ç°äº†Runnable æ¥å£ï¼‰ Runnable worker = new MyRunnable(\u0026#34;\u0026#34; + i); //æ‰§è¡ŒRunnable executor.execute(worker); } //ç»ˆæ­¢çº¿ç¨‹æ±  executor.shutdown(); while (!executor.isTerminated()) { } System.out.println(\u0026#34;Finished all threads\u0026#34;); } } /*------è¾“å‡º pool-1-thread-3 Start. Time = Sun Apr 12 11:14:37 CST 2020 pool-1-thread-5 Start. Time = Sun Apr 12 11:14:37 CST 2020 pool-1-thread-2 Start. Time = Sun Apr 12 11:14:37 CST 2020 pool-1-thread-1 Start. Time = Sun Apr 12 11:14:37 CST 2020 pool-1-thread-4 Start. Time = Sun Apr 12 11:14:37 CST 2020 pool-1-thread-3 End. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-4 End. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-1 End. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-5 End. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-1 Start. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-2 End. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-5 Start. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-4 Start. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-3 Start. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-2 Start. Time = Sun Apr 12 11:14:42 CST 2020 pool-1-thread-1 End. Time = Sun Apr 12 11:14:47 CST 2020 pool-1-thread-4 End. Time = Sun Apr 12 11:14:47 CST 2020 pool-1-thread-5 End. Time = Sun Apr 12 11:14:47 CST 2020 pool-1-thread-3 End. Time = Sun Apr 12 11:14:47 CST 2020 pool-1-thread-2 End. Time = Sun Apr 12 11:14:47 CST 2020 ------ */ çº¿ç¨‹æ± åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ\nç”±ç»“æœå¯ä»¥çœ‹å‡ºï¼Œçº¿ç¨‹æ± å…ˆæ‰§è¡Œ5ä¸ªä»»åŠ¡ï¼Œæ­¤æ—¶å¤šå‡ºçš„ä»»åŠ¡ä¼šæ”¾åˆ°é˜Ÿåˆ—ï¼Œé‚£5ä¸ªä»»åŠ¡ä¸­æœ‰ä»»åŠ¡æ‰§è¡Œå®Œçš„è¯ï¼Œä¼šæ‹¿æ–°çš„ä»»åŠ¡æ‰§è¡Œ\nä¸ºäº†ææ‡‚çº¿ç¨‹æ± çš„åŸç†ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆåˆ†æä¸€ä¸‹ executeæ–¹æ³•ã€‚\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ executor.execute(worker)æ¥æäº¤ä¸€ä¸ªä»»åŠ¡åˆ°çº¿ç¨‹æ± ä¸­å»ï¼Œè¿™ä¸ªæ–¹æ³•éå¸¸é‡è¦ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„æºç ï¼š\n//æºç åˆ†æ // å­˜æ”¾çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ (runState) å’Œçº¿ç¨‹æ± å†…æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡ (workerCount) private final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0)); private static int workerCountOf(int c) { return c \u0026amp; CAPACITY; } private final BlockingQueue\u0026lt;Runnable\u0026gt; workQueue; public void execute(Runnable command) { // å¦‚æœä»»åŠ¡ä¸ºnullï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ if (command == null) throw new NullPointerException(); // ctl ä¸­ä¿å­˜çš„çº¿ç¨‹æ± å½“å‰çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ int c = ctl.get(); // ä¸‹é¢ä¼šæ¶‰åŠåˆ° 3 æ­¥ æ“ä½œ // 1.é¦–å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ± ä¸­æ‰§è¡Œçš„ä»»åŠ¡æ•°é‡æ˜¯å¦å°äº corePoolSize // å¦‚æœå°äºçš„è¯ï¼Œé€šè¿‡addWorker(command, true)æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶å°†ä»»åŠ¡(command)æ·»åŠ åˆ°è¯¥çº¿ç¨‹ä¸­ï¼›ç„¶åï¼Œå¯åŠ¨è¯¥çº¿ç¨‹ä»è€Œæ‰§è¡Œä»»åŠ¡ã€‚ if (workerCountOf(c) \u0026lt; corePoolSize) { if (addWorker(command, true)) return; c = ctl.get(); } // 2.å¦‚æœå½“å‰æ‰§è¡Œçš„ä»»åŠ¡æ•°é‡å¤§äºç­‰äº corePoolSize çš„æ—¶å€™å°±ä¼šèµ°åˆ°è¿™é‡Œ // é€šè¿‡ isRunning æ–¹æ³•åˆ¤æ–­çº¿ç¨‹æ± çŠ¶æ€ï¼Œçº¿ç¨‹æ± å¤„äº RUNNING çŠ¶æ€å¹¶ä¸”é˜Ÿåˆ—å¯ä»¥åŠ å…¥ä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡æ‰ä¼šè¢«åŠ å…¥è¿›å» if (isRunning(c) \u0026amp;\u0026amp; workQueue.offer(command)) { int recheck = ctl.get(); // å†æ¬¡è·å–çº¿ç¨‹æ± çŠ¶æ€ï¼Œå¦‚æœçº¿ç¨‹æ± çŠ¶æ€ä¸æ˜¯ RUNNING çŠ¶æ€å°±éœ€è¦ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­ç§»é™¤ä»»åŠ¡ï¼Œå¹¶å°è¯•åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚åŒæ—¶æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚ if (!isRunning(recheck) \u0026amp;\u0026amp; remove(command)) reject(command); // å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸ºç©ºå°±æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¹¶æ‰§è¡Œã€‚ else if (workerCountOf(recheck) == 0) addWorker(null, false); } //3. é€šè¿‡addWorker(command, false)æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶å°†ä»»åŠ¡(command)æ·»åŠ åˆ°è¯¥çº¿ç¨‹ä¸­ï¼›ç„¶åï¼Œå¯åŠ¨è¯¥çº¿ç¨‹ä»è€Œæ‰§è¡Œä»»åŠ¡ã€‚ //å¦‚æœaddWorker(command, false)æ‰§è¡Œå¤±è´¥ï¼Œåˆ™é€šè¿‡reject()æ‰§è¡Œç›¸åº”çš„æ‹’ç»ç­–ç•¥çš„å†…å®¹ã€‚ else if (!addWorker(command, false)) reject(command); } ------ å¦‚å›¾ åˆ†æä¸Šé¢çš„ä¾‹å­ï¼Œ\næˆ‘ä»¬åœ¨ä»£ç ä¸­æ¨¡æ‹Ÿäº† 10 ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬é…ç½®çš„æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º 5 ã€ç­‰å¾…é˜Ÿåˆ—å®¹é‡ä¸º 100 ï¼Œæ‰€ä»¥æ¯æ¬¡åªå¯èƒ½å­˜åœ¨ 5 ä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œï¼Œå‰©ä¸‹çš„ 5 ä¸ªä»»åŠ¡ä¼šè¢«æ”¾åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­å»ã€‚å½“å‰çš„5ä¸ªä»»åŠ¡ä¸­å¦‚æœæœ‰ä»»åŠ¡è¢«æ‰§è¡Œå®Œäº†ï¼Œçº¿ç¨‹æ± å°±ä¼šå»æ‹¿æ–°çš„ä»»åŠ¡æ‰§è¡Œã€‚\naddWorker è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨æ¥åˆ›å»ºæ–°çš„å·¥ä½œçº¿ç¨‹ï¼Œå¦‚æœè¿”å› true è¯´æ˜åˆ›å»ºå’Œå¯åŠ¨å·¥ä½œçº¿ç¨‹æˆåŠŸï¼Œå¦åˆ™çš„è¯è¿”å›çš„å°±æ˜¯ falseã€‚\n// å…¨å±€é”ï¼Œå¹¶å‘æ“ä½œå¿…å¤‡ private final ReentrantLock mainLock = new ReentrantLock(); // è·Ÿè¸ªçº¿ç¨‹æ± çš„æœ€å¤§å¤§å°ï¼Œåªæœ‰åœ¨æŒæœ‰å…¨å±€é”mainLockçš„å‰æä¸‹æ‰èƒ½è®¿é—®æ­¤é›†åˆ private int largestPoolSize; // å·¥ä½œçº¿ç¨‹é›†åˆï¼Œå­˜æ”¾çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„ï¼ˆæ´»è·ƒçš„ï¼‰å·¥ä½œçº¿ç¨‹ï¼Œåªæœ‰åœ¨æŒæœ‰å…¨å±€é”mainLockçš„å‰æä¸‹æ‰èƒ½è®¿é—®æ­¤é›†åˆ private final HashSet\u0026lt;Worker\u0026gt; workers = new HashSet\u0026lt;\u0026gt;(); //è·å–çº¿ç¨‹æ± çŠ¶æ€ private static int runStateOf(int c) { return c \u0026amp; ~CAPACITY; } //åˆ¤æ–­çº¿ç¨‹æ± çš„çŠ¶æ€æ˜¯å¦ä¸º Running private static boolean isRunning(int c) { return c \u0026lt; SHUTDOWN; } /** * æ·»åŠ æ–°çš„å·¥ä½œçº¿ç¨‹åˆ°çº¿ç¨‹æ±  * @param firstTask è¦æ‰§è¡Œ * @param coreå‚æ•°ä¸ºtrueçš„è¯è¡¨ç¤ºä½¿ç”¨çº¿ç¨‹æ± çš„åŸºæœ¬å¤§å°ï¼Œä¸ºfalseä½¿ç”¨çº¿ç¨‹æ± æœ€å¤§å¤§å° * @return æ·»åŠ æˆåŠŸå°±è¿”å›trueå¦åˆ™è¿”å›false */ private boolean addWorker(Runnable firstTask, boolean core) { retry: for (;;) { //è¿™ä¸¤å¥ç”¨æ¥è·å–çº¿ç¨‹æ± çš„çŠ¶æ€ int c = ctl.get(); int rs = runStateOf(c); // Check if queue empty only if necessary. if (rs \u0026gt;= SHUTDOWN \u0026amp;\u0026amp; ! (rs == SHUTDOWN \u0026amp;\u0026amp; firstTask == null \u0026amp;\u0026amp; ! workQueue.isEmpty())) return false; for (;;) { //è·å–çº¿ç¨‹æ± ä¸­å·¥ä½œçš„çº¿ç¨‹çš„æ•°é‡ int wc = workerCountOf(c); // coreå‚æ•°ä¸ºfalseçš„è¯è¡¨æ˜é˜Ÿåˆ—ä¹Ÿæ»¡äº†ï¼Œçº¿ç¨‹æ± å¤§å°å˜ä¸º maximumPoolSize if (wc \u0026gt;= CAPACITY || wc \u0026gt;= (core ? corePoolSize : maximumPoolSize)) return false; //åŸå­æ“ä½œå°†workcountçš„æ•°é‡åŠ 1 if (compareAndIncrementWorkerCount(c)) break retry; // å¦‚æœçº¿ç¨‹çš„çŠ¶æ€æ”¹å˜äº†å°±å†æ¬¡æ‰§è¡Œä¸Šè¿°æ“ä½œ c = ctl.get(); if (runStateOf(c) != rs) continue retry; // else CAS failed due to workerCount change; retry inner loop } } // æ ‡è®°å·¥ä½œçº¿ç¨‹æ˜¯å¦å¯åŠ¨æˆåŠŸ boolean workerStarted = false; // æ ‡è®°å·¥ä½œçº¿ç¨‹æ˜¯å¦åˆ›å»ºæˆåŠŸ boolean workerAdded = false; Worker w = null; try { w = new Worker(firstTask); final Thread t = w.thread; if (t != null) { // åŠ é” final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try { //è·å–çº¿ç¨‹æ± çŠ¶æ€ int rs = runStateOf(ctl.get()); //rs \u0026lt; SHUTDOWN å¦‚æœçº¿ç¨‹æ± çŠ¶æ€ä¾ç„¶ä¸ºRUNNING,å¹¶ä¸”çº¿ç¨‹çš„çŠ¶æ€æ˜¯å­˜æ´»çš„è¯ï¼Œå°±ä¼šå°†å·¥ä½œçº¿ç¨‹æ·»åŠ åˆ°å·¥ä½œçº¿ç¨‹é›†åˆä¸­ //(rs=SHUTDOWN \u0026amp;\u0026amp; firstTask == null)å¦‚æœçº¿ç¨‹æ± çŠ¶æ€å°äºSTOPï¼Œä¹Ÿå°±æ˜¯RUNNINGæˆ–è€…SHUTDOWNçŠ¶æ€ä¸‹ï¼ŒåŒæ—¶ä¼ å…¥çš„ä»»åŠ¡å®ä¾‹firstTaskä¸ºnullï¼Œåˆ™éœ€è¦æ·»åŠ åˆ°å·¥ä½œçº¿ç¨‹é›†åˆå’Œå¯åŠ¨æ–°çš„Worker // firstTask == nullè¯æ˜åªæ–°å»ºçº¿ç¨‹è€Œä¸æ‰§è¡Œä»»åŠ¡ if (rs \u0026lt; SHUTDOWN || (rs == SHUTDOWN \u0026amp;\u0026amp; firstTask == null)) { if (t.isAlive()) // precheck that t is startable throw new IllegalThreadStateException(); workers.add(w); //æ›´æ–°å½“å‰å·¥ä½œçº¿ç¨‹çš„æœ€å¤§å®¹é‡ int s = workers.size(); if (s \u0026gt; largestPoolSize) largestPoolSize = s; // å·¥ä½œçº¿ç¨‹æ˜¯å¦å¯åŠ¨æˆåŠŸ workerAdded = true; } } finally { // é‡Šæ”¾é” mainLock.unlock(); } //// å¦‚æœæˆåŠŸæ·»åŠ å·¥ä½œçº¿ç¨‹ï¼Œåˆ™è°ƒç”¨Workerå†…éƒ¨çš„çº¿ç¨‹å®ä¾‹tçš„Thread#start()æ–¹æ³•å¯åŠ¨çœŸå®çš„çº¿ç¨‹å®ä¾‹ if (workerAdded) { t.start(); /// æ ‡è®°çº¿ç¨‹å¯åŠ¨æˆåŠŸ workerStarted = true; } } } finally { // çº¿ç¨‹å¯åŠ¨å¤±è´¥ï¼Œéœ€è¦ä»å·¥ä½œçº¿ç¨‹ä¸­ç§»é™¤å¯¹åº”çš„Worker if (! workerStarted) addWorkerFailed(w); } return workerStarted; } å¦‚ä½•è®¾å®šçº¿ç¨‹æ± çš„å¤§å°\nå¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¤ªå¤šï¼Œå°±ä¼šå¢åŠ ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æˆæœ¬\nå¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ä¸€èˆ¬çº¿ç¨‹çš„ä¸ªæ•°éƒ½å¤§äº CPU æ ¸å¿ƒçš„ä¸ªæ•°ï¼Œè€Œä¸€ä¸ª CPU æ ¸å¿ƒåœ¨ä»»æ„æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œä¸ºäº†è®©è¿™äº›çº¿ç¨‹éƒ½èƒ½å¾—åˆ°æœ‰æ•ˆæ‰§è¡Œï¼ŒCPU é‡‡å–çš„ç­–ç•¥æ˜¯ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…æ—¶é—´ç‰‡å¹¶è½®è½¬çš„å½¢å¼ã€‚å½“ä¸€ä¸ªçº¿ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œçš„æ—¶å€™å°±ä¼šé‡æ–°å¤„äºå°±ç»ªçŠ¶æ€è®©ç»™å…¶ä»–çº¿ç¨‹ä½¿ç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å±äºä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚æ¦‚æ‹¬æ¥è¯´å°±æ˜¯ï¼šå½“å‰ä»»åŠ¡åœ¨æ‰§è¡Œå®Œ CPU æ—¶é—´ç‰‡åˆ‡æ¢åˆ°å¦ä¸€ä¸ªä»»åŠ¡ä¹‹å‰ä¼šå…ˆä¿å­˜è‡ªå·±çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡å†åˆ‡æ¢å›è¿™ä¸ªä»»åŠ¡æ—¶ï¼Œå¯ä»¥å†åŠ è½½è¿™ä¸ªä»»åŠ¡çš„çŠ¶æ€ã€‚ä»»åŠ¡ä»ä¿å­˜åˆ°å†åŠ è½½çš„è¿‡ç¨‹å°±æ˜¯ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚\nä¸Šä¸‹æ–‡åˆ‡æ¢é€šå¸¸æ˜¯è®¡ç®—å¯†é›†å‹çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒéœ€è¦ç›¸å½“å¯è§‚çš„å¤„ç†å™¨æ—¶é—´ï¼Œåœ¨æ¯ç§’å‡ åä¸Šç™¾æ¬¡çš„åˆ‡æ¢ä¸­ï¼Œæ¯æ¬¡åˆ‡æ¢éƒ½éœ€è¦çº³ç§’é‡çº§çš„æ—¶é—´ã€‚æ‰€ä»¥ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢å¯¹ç³»ç»Ÿæ¥è¯´æ„å‘³ç€æ¶ˆè€—å¤§é‡çš„ CPU æ—¶é—´ï¼Œäº‹å®ä¸Šï¼Œå¯èƒ½æ˜¯æ“ä½œç³»ç»Ÿä¸­æ—¶é—´æ¶ˆè€—æœ€å¤§çš„æ“ä½œã€‚\nLinux ç›¸æ¯”ä¸å…¶ä»–æ“ä½œç³»ç»Ÿï¼ˆåŒ…æ‹¬å…¶ä»–ç±» Unix ç³»ç»Ÿï¼‰æœ‰å¾ˆå¤šçš„ä¼˜ç‚¹ï¼Œå…¶ä¸­æœ‰ä¸€é¡¹å°±æ˜¯ï¼Œå…¶ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œæ¨¡å¼åˆ‡æ¢çš„æ—¶é—´æ¶ˆè€—éå¸¸å°‘ã€‚\nè¿‡å¤§è·Ÿè¿‡å°éƒ½ä¸è¡Œ\nå¦‚æœæˆ‘ä»¬è®¾ç½®çš„çº¿ç¨‹æ± æ•°é‡å¤ªå°çš„è¯ï¼Œå¦‚æœåŒä¸€æ—¶é—´æœ‰å¤§é‡ä»»åŠ¡/è¯·æ±‚éœ€è¦å¤„ç†ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤§é‡çš„è¯·æ±‚/ä»»åŠ¡åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…æ‰§è¡Œï¼Œç”šè‡³ä¼šå‡ºç°ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ä¹‹åä»»åŠ¡/è¯·æ±‚æ— æ³•å¤„ç†çš„æƒ…å†µï¼Œæˆ–è€…å¤§é‡ä»»åŠ¡å †ç§¯åœ¨ä»»åŠ¡é˜Ÿåˆ—å¯¼è‡´ OOM è®¾ç½®çº¿ç¨‹æ•°é‡å¤ªå¤§ï¼Œå¤§é‡çº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶åœ¨äº‰å– CPU èµ„æºï¼Œè¿™æ ·ä¼šå¯¼è‡´å¤§é‡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»è€Œå¢åŠ çº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´ï¼Œå½±å“äº†æ•´ä½“æ‰§è¡Œæ•ˆç‡ï¼ˆå¯¹äºCPUå¯†é›†å‹ä»»åŠ¡ä¸èƒ½ä½¿ç”¨è¿™ä¸ªï¼Œå› ä¸ºæœ¬æ¥CPUèµ„æºå°±ç´§å¼ ï¼Œéœ€è¦è®¾ç½®å°ä¸€ç‚¹ï¼Œå‡å°ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰ ç®€å•ä¸”é€‚ç”¨é¢è¾ƒå¹¿çš„å…¬å¼\nCPU å¯†é›†å‹ä»»åŠ¡(N+1)ï¼š è¿™ç§ä»»åŠ¡æ¶ˆè€—çš„ä¸»è¦æ˜¯ CPU èµ„æºï¼Œå¯ä»¥å°†çº¿ç¨‹æ•°è®¾ç½®ä¸º Nï¼ˆCPU æ ¸å¿ƒæ•°ï¼‰+1ï¼Œæ¯” CPU æ ¸å¿ƒæ•°å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹æ˜¯ä¸ºäº†é˜²æ­¢çº¿ç¨‹å¶å‘çš„ç¼ºé¡µä¸­æ–­ï¼Œæˆ–è€…å…¶å®ƒåŸå› å¯¼è‡´çš„ä»»åŠ¡æš‚åœè€Œå¸¦æ¥çš„å½±å“ã€‚ä¸€æ—¦ä»»åŠ¡æš‚åœï¼ŒCPU å°±ä¼šå¤„äºç©ºé—²çŠ¶æ€ï¼Œè€Œåœ¨è¿™ç§æƒ…å†µä¸‹å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å……åˆ†åˆ©ç”¨ CPU çš„ç©ºé—²æ—¶é—´ã€‚\nI/O å¯†é›†å‹ä»»åŠ¡(2N)ï¼š è¿™ç§ä»»åŠ¡åº”ç”¨èµ·æ¥ï¼Œç³»ç»Ÿä¼šç”¨å¤§éƒ¨åˆ†çš„æ—¶é—´æ¥å¤„ç† I/O äº¤äº’ï¼Œè€Œçº¿ç¨‹åœ¨å¤„ç† I/O çš„æ—¶é—´æ®µå†…ä¸ä¼šå ç”¨ CPU æ¥å¤„ç†ï¼Œè¿™æ—¶å°±å¯ä»¥å°† CPU äº¤å‡ºç»™å…¶å®ƒçº¿ç¨‹ä½¿ç”¨ã€‚å› æ­¤åœ¨ I/O å¯†é›†å‹ä»»åŠ¡çš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¤šé…ç½®ä¸€äº›çº¿ç¨‹ï¼Œå…·ä½“çš„è®¡ç®—æ–¹æ³•æ˜¯ 2Nã€‚\nå¦‚ä½•åˆ¤æ–­æ˜¯CPUå¯†é›†ä»»åŠ¡è¿˜æ˜¯IOå¯†é›†ä»»åŠ¡\nCPU å¯†é›†å‹ç®€å•ç†è§£å°±æ˜¯åˆ©ç”¨ CPU è®¡ç®—èƒ½åŠ›çš„ä»»åŠ¡æ¯”å¦‚ä½ åœ¨å†…å­˜ä¸­å¯¹å¤§é‡æ•°æ®è¿›è¡Œæ’åºã€‚ä½†å‡¡æ¶‰åŠåˆ°ç½‘ç»œè¯»å–ï¼Œæ–‡ä»¶è¯»å–è¿™ç±»éƒ½æ˜¯ IO å¯†é›†å‹ï¼Œè¿™ç±»ä»»åŠ¡çš„ç‰¹ç‚¹æ˜¯ CPU è®¡ç®—è€—è´¹æ—¶é—´ç›¸æ¯”äºç­‰å¾… IO æ“ä½œå®Œæˆçš„æ—¶é—´æ¥è¯´å¾ˆå°‘ï¼Œå¤§éƒ¨åˆ†æ—¶é—´éƒ½èŠ±åœ¨äº†ç­‰å¾… IO æ“ä½œå®Œæˆä¸Šã€‚\nAtomicåŸå­ç±» # Atomic è‹±[É™ËˆtÉ’mÉªk]åŸå­ï¼Œå³ä¸å¯åˆ†å‰²\nçº¿ç¨‹ä¸­ï¼ŒAtomicï¼ŒæŒ‡ä¸€ä¸ªæ“ä½œæ˜¯ä¸å¯ä¸­æ–­çš„ï¼Œå³ä½¿åœ¨å¤šçº¿ç¨‹ä¸€èµ·æ‰§è¡Œæ—¶ï¼Œä¸€ä¸ªæ“ä½œä¸€æ—¦å¼€å§‹ï¼Œå°±ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹å¹²æ‰°\nåŸå­ç±»ï¼Œå³å…·æœ‰åŸå­/åŸå­æ“ä½œç‰¹æ€§çš„ç±»ã€‚å¹¶å‘åŒ…java.util.concurrentåŸå­ç±»éƒ½æ”¾åœ¨java.util.concurrent.atomit Javaä¸­å­˜åœ¨å››ç§åŸå­ç±»ï¼ˆåŸºæœ¬ã€æ•°ç»„ã€å¼•ç”¨ã€å¯¹è±¡å±æ€§ï¼‰\nåŸºæœ¬ç±»å‹ï¼šAtomicIntegerï¼ŒAtomicLongï¼ŒAtomicBoolean æ•°ç»„ç±»å‹ï¼šAtomicIntegerArrayï¼ŒAtomicLongArrayï¼ŒAtomicReferenceArray å¼•ç”¨ç±»å‹ï¼šAtomicReferenceï¼ŒAtomicStampedReferenceï¼ˆ[åŸå­æ›´æ–°] å¸¦æœ‰ç‰ˆæœ¬å·çš„å¼•ç”¨ç±»å‹ã€‚è¯¥ç±»å°†æ•´æ•°å€¼ä¸å¼•ç”¨å…³è”ï¼Œè§£å†³åŸå­çš„æ›´æ–°æ•°æ®å’Œæ•°æ®çš„ç‰ˆæœ¬å·ï¼Œè§£å†³ä½¿ç”¨CASè¿›è¡ŒåŸå­æ›´æ–°å¯èƒ½å‡ºç°çš„ABAé—®é¢˜ï¼‰ï¼ŒAtomicMarkableReferenceï¼ˆåŸå­æ›´æ–°å¸¦æœ‰æ ‡è®°ä½çš„å¼•ç”¨ç±»å‹ï¼‰ å¯¹è±¡å±æ€§ä¿®æ”¹ç±»å‹ï¼šAtomicIntegerFiledUpdateråŸå­æ›´æ–°æ•´å‹å­—æ®µçš„æ›´æ–°å™¨ï¼›AtomicLongFiledUpdaterï¼›AtomicReferenceFieldUpdater è¯¦è§\nAQS # AQSä»‹ç» å…¨ç¨‹ï¼ŒAbstractQueuedSynchronizeræŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨ï¼Œåœ¨java.util.concurrent.locksåŒ…ä¸‹ AQSæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸»è¦ç”¨æ¥æ„å»ºé”å’ŒåŒæ­¥å™¨\npublic abstract class AbstractQueuedSynchronizer extends AbstractOwnableSynchronizer implements java.io.Serializable { } AQS ä¸ºæ„å»ºé”å’ŒåŒæ­¥å™¨æä¾›äº†ä¸€äº›é€šç”¨åŠŸèƒ½çš„å®ç°ï¼Œèƒ½ç®€å•ä¸”é«˜æ•ˆåœ°æ„é€ å‡ºå¤§é‡åº”ç”¨å¹¿æ³›çš„åŒæ­¥å™¨ï¼Œä¾‹å¦‚ReentrantLockï¼ŒSemaphore[ËˆsemÉ™fÉ”Ë(r)]ä»¥åŠReentrantReadWriteLockï¼ŒSynchronousQueue ç­‰ç­‰éƒ½åŸºäºAQS\nAQSåŸç†åˆ†æ\né¢è¯•ä¸æ˜¯èƒŒé¢˜ï¼Œå¤§å®¶ä¸€å®šè¦åŠ å…¥è‡ªå·±çš„æ€æƒ³ï¼Œå³ä½¿åŠ å…¥ä¸äº†è‡ªå·±çš„æ€æƒ³ä¹Ÿè¦ä¿è¯è‡ªå·±èƒ½å¤Ÿé€šä¿—çš„è®²å‡ºæ¥è€Œä¸æ˜¯èƒŒå‡ºæ¥\nAQS æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²ï¼Œåˆ™å°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆçš„å·¥ä½œçº¿ç¨‹ï¼Œå¹¶ä¸”å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ã€‚å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºè¢«å ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€å¥—çº¿ç¨‹é˜»å¡ç­‰å¾…ä»¥åŠè¢«å”¤é†’æ—¶é”åˆ†é…çš„æœºåˆ¶ï¼Œè¿™ä¸ªæœºåˆ¶ AQS æ˜¯ç”¨ CLH é˜Ÿåˆ—é”å®ç°çš„ï¼Œå³å°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚\nCLH(Craig,Landin and Hagersten)é˜Ÿåˆ—æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„åŒå‘é˜Ÿåˆ—ï¼ˆè™šæ‹Ÿçš„åŒå‘é˜Ÿåˆ—å³ä¸å­˜åœ¨é˜Ÿåˆ—å®ä¾‹ï¼Œä»…å­˜åœ¨ç»“ç‚¹ä¹‹é—´çš„å…³è”å…³ç³»ï¼‰ã€‚AQS æ˜¯å°†æ¯æ¡è¯·æ±‚å…±äº«èµ„æºçš„çº¿ç¨‹å°è£…æˆä¸€ä¸ª CLH é”é˜Ÿåˆ—çš„ä¸€ä¸ªç»“ç‚¹ï¼ˆNodeï¼‰æ¥å®ç°é”çš„åˆ†é…ã€‚ æœç´¢äº†ä¸€ä¸‹ï¼ŒCLHå¥½åƒæ˜¯äººå\nCLHé˜Ÿåˆ—ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º\nAQSï¼ˆAbstractQueuedSynchronizedï¼‰åŸç†å›¾\nAQS ä½¿ç”¨ int æˆå‘˜å˜é‡ state è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„ çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ— æ¥å®Œæˆè·å–èµ„æºçº¿ç¨‹çš„æ’é˜Ÿå·¥ä½œã€‚\n//state å˜é‡ç”± volatile ä¿®é¥°ï¼Œç”¨äºå±•ç¤ºå½“å‰ä¸´ç•Œèµ„æºçš„è·é”æƒ…å†µã€‚ private volatile int state;//å…±äº«å˜é‡ï¼Œä½¿ç”¨volatileä¿®é¥°ä¿è¯çº¿ç¨‹å¯è§æ€§ çŠ¶æ€ä¿¡æ¯çš„æ“ä½œ\n//è¿”å›åŒæ­¥çŠ¶æ€çš„å½“å‰å€¼ protected final int getState() { return state; } //è®¾ç½®åŒæ­¥çŠ¶æ€çš„å€¼ protected final void setState(int newState) { state = newState; } //åŸå­åœ°ï¼ˆCASæ“ä½œï¼‰å°†åŒæ­¥çŠ¶æ€å€¼è®¾ç½®ä¸ºç»™å®šå€¼updateå¦‚æœå½“å‰åŒæ­¥çŠ¶æ€çš„å€¼ç­‰äºexpectï¼ˆæœŸæœ›å€¼ï¼‰ protected final boolean compareAndSetState(int expect, int update) { return unsafe.compareAndSwapInt(this, stateOffset, expect, update); } ä»¥ ReentrantLock ä¸ºä¾‹ï¼Œstate åˆå§‹å€¼ä¸º 0ï¼Œè¡¨ç¤ºæœªé”å®šçŠ¶æ€ã€‚A çº¿ç¨‹ lock() æ—¶ï¼Œä¼šè°ƒç”¨ tryAcquire() ç‹¬å è¯¥é”å¹¶å°† state+1 ã€‚æ­¤åï¼Œå…¶ä»–çº¿ç¨‹å† tryAcquire() æ—¶å°±ä¼šå¤±è´¥ï¼Œç›´åˆ° A çº¿ç¨‹ unlock() åˆ° state=0ï¼ˆå³é‡Šæ”¾é”ï¼‰ä¸ºæ­¢ï¼Œå…¶å®ƒçº¿ç¨‹æ‰æœ‰æœºä¼šè·å–è¯¥é”ã€‚å½“ç„¶ï¼Œé‡Šæ”¾é”ä¹‹å‰ï¼ŒA çº¿ç¨‹è‡ªå·±æ˜¯å¯ä»¥é‡å¤è·å–æ­¤é”çš„ï¼ˆstate ä¼šç´¯åŠ ï¼‰ï¼Œè¿™å°±æ˜¯å¯é‡å…¥çš„æ¦‚å¿µã€‚ä½†è¦æ³¨æ„ï¼Œè·å–å¤šå°‘æ¬¡å°±è¦é‡Šæ”¾å¤šå°‘æ¬¡ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯ state æ˜¯èƒ½å›åˆ°é›¶æ€çš„ã€‚\nä»¥ CountDownLatch ä¸ºä¾‹ï¼Œä»»åŠ¡åˆ†ä¸º N ä¸ªå­çº¿ç¨‹å»æ‰§è¡Œï¼Œstate ä¹Ÿåˆå§‹åŒ–ä¸º Nï¼ˆæ³¨æ„ N è¦ä¸çº¿ç¨‹ä¸ªæ•°ä¸€è‡´ï¼‰ã€‚è¿™ N ä¸ªå­çº¿ç¨‹æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œæ¯ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®ŒåcountDown() ä¸€æ¬¡ï¼Œstate ä¼š CAS(Compare and Swap) å‡ 1ã€‚ç­‰åˆ°æ‰€æœ‰å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œå(å³ state=0 )ï¼Œä¼š unpark() ä¸»è°ƒç”¨çº¿ç¨‹ï¼Œç„¶åä¸»è°ƒç”¨çº¿ç¨‹å°±ä¼šä» await() å‡½æ•°è¿”å›ï¼Œç»§ç»­åä½™åŠ¨ä½œ\n//ä¾‹å­ public class TestCountDownLatch { public static void main(String[] args) { CountDownLatch countDownLatch=new CountDownLatch(3); new Thread(()-\u0026gt;{ try { TimeUnit.SECONDS.sleep(1); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread().getName()+\u0026#34;æ‰§è¡Œå®Œæ¯•\u0026#34;); countDownLatch.countDown(); },\u0026#34;çº¿ç¨‹1\u0026#34;).start(); new Thread(()-\u0026gt;{ try { TimeUnit.SECONDS.sleep(2); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread().getName()+\u0026#34;æ‰§è¡Œå®Œæ¯•\u0026#34;); countDownLatch.countDown(); },\u0026#34;çº¿ç¨‹2\u0026#34;).start(); new Thread(()-\u0026gt;{ try { TimeUnit.SECONDS.sleep(3); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread().getName()+\u0026#34;æ‰§è¡Œå®Œæ¯•\u0026#34;); countDownLatch.countDown(); },\u0026#34;çº¿ç¨‹3\u0026#34;).start(); try { System.out.println(Thread.currentThread().getName()+\u0026#34;ç­‰å¾…ä¸­....\u0026#34;); countDownLatch.await();//é˜»å¡ System.out.println(Thread.currentThread().getName()+\u0026#34;ç­‰å¾…å®Œæ¯•ï¼Œç»§ç»­æ‰§è¡Œ\u0026#34;); } catch (InterruptedException e) { e.printStackTrace(); } } } /* mainç­‰å¾…ä¸­.... çº¿ç¨‹1æ‰§è¡Œå®Œæ¯• çº¿ç¨‹2æ‰§è¡Œå®Œæ¯• çº¿ç¨‹3æ‰§è¡Œå®Œæ¯• mainç­‰å¾…å®Œæ¯•ï¼Œç»§ç»­æ‰§è¡Œ */ Semaphore # Semaphore æœ‰ä»€ä¹ˆç”¨ï¼Ÿ synchronized å’Œ ReentrantLock éƒ½æ˜¯ä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®æŸä¸ªèµ„æºï¼Œè€ŒSemaphore(ä¿¡å·é‡)å¯ä»¥ç”¨æ¥æ§åˆ¶åŒæ—¶è®¿é—®ç‰¹å®šèµ„æºçš„çº¿ç¨‹æ•°é‡ã€‚\n//ä½¿ç”¨ public class TestSemaphore { public static void main(String[] args) { Semaphore semaphore = new Semaphore(3);//èƒ½åŒæ—¶è¿è¡Œ3ä¸ª for (int i = 0; i \u0026lt; 15; i++) { int finalI = i; new Thread(() -\u0026gt; { try { semaphore.acquire();//è·å–é€šè¡Œè¯ System.out.println(Thread.currentThread().getName() + \u0026#34;æ‰§è¡Œä¸­...\u0026#34;); TimeUnit.SECONDS.sleep(finalI); System.out.println(Thread.currentThread().getName() + \u0026#34;é‡Šæ”¾äº†é€šè¡Œè¯\u0026#34;); semaphore.release(); } catch (InterruptedException e) { e.printStackTrace(); } },\u0026#34;çº¿ç¨‹\u0026#34;+finalI).start(); } } } /*ç»“æœ çº¿ç¨‹0æ‰§è¡Œä¸­... çº¿ç¨‹2æ‰§è¡Œä¸­... çº¿ç¨‹1æ‰§è¡Œä¸­... çº¿ç¨‹0é‡Šæ”¾äº†é€šè¡Œè¯ çº¿ç¨‹3æ‰§è¡Œä¸­... çº¿ç¨‹1é‡Šæ”¾äº†é€šè¡Œè¯ çº¿ç¨‹4æ‰§è¡Œä¸­... çº¿ç¨‹2é‡Šæ”¾äº†é€šè¡Œè¯ çº¿ç¨‹5æ‰§è¡Œä¸­... çº¿ç¨‹3é‡Šæ”¾äº†é€šè¡Œè¯ çº¿ç¨‹6æ‰§è¡Œä¸­... çº¿ç¨‹4é‡Šæ”¾äº†é€šè¡Œè¯ çº¿ç¨‹7æ‰§è¡Œä¸­... çº¿ç¨‹5é‡Šæ”¾äº†é€šè¡Œè¯ çº¿ç¨‹8æ‰§è¡Œä¸­... çº¿ç¨‹6é‡Šæ”¾äº†é€šè¡Œè¯ çº¿ç¨‹10æ‰§è¡Œä¸­... çº¿ç¨‹7é‡Šæ”¾äº†é€šè¡Œè¯ çº¿ç¨‹11æ‰§è¡Œä¸­... çº¿ç¨‹8é‡Šæ”¾äº†é€šè¡Œè¯ çº¿ç¨‹9æ‰§è¡Œä¸­... çº¿ç¨‹10é‡Šæ”¾äº†é€šè¡Œè¯ çº¿ç¨‹12æ‰§è¡Œä¸­... çº¿ç¨‹11é‡Šæ”¾äº†é€šè¡Œè¯ çº¿ç¨‹13æ‰§è¡Œä¸­... çº¿ç¨‹9é‡Šæ”¾äº†é€šè¡Œè¯ çº¿ç¨‹14æ‰§è¡Œä¸­... çº¿ç¨‹12é‡Šæ”¾äº†é€šè¡Œè¯ çº¿ç¨‹13é‡Šæ”¾äº†é€šè¡Œè¯ çº¿ç¨‹14é‡Šæ”¾äº†é€šè¡Œè¯ */ Semaphore çš„ä½¿ç”¨ç®€å•ï¼Œæˆ‘ä»¬è¿™é‡Œå‡è®¾æœ‰ N(N\u0026gt;5) ä¸ªçº¿ç¨‹æ¥è·å– Semaphore ä¸­çš„å…±äº«èµ„æºï¼Œä¸‹é¢çš„ä»£ç è¡¨ç¤ºåŒä¸€æ—¶åˆ» N ä¸ªçº¿ç¨‹ä¸­åªæœ‰ 5 ä¸ªçº¿ç¨‹èƒ½è·å–åˆ°å…±äº«èµ„æºï¼Œå…¶ä»–çº¿ç¨‹éƒ½ä¼šé˜»å¡ï¼Œåªæœ‰è·å–åˆ°å…±äº«èµ„æºçš„çº¿ç¨‹æ‰èƒ½æ‰§è¡Œã€‚ç­‰åˆ°æœ‰çº¿ç¨‹é‡Šæ”¾äº†å…±äº«èµ„æºï¼Œå…¶ä»–é˜»å¡çš„çº¿ç¨‹æ‰èƒ½è·å–åˆ°\n// åˆå§‹å…±äº«èµ„æºæ•°é‡ final Semaphore semaphore = new Semaphore(5); // è·å–1ä¸ªè®¸å¯ semaphore.acquire(); // é‡Šæ”¾1ä¸ªè®¸å¯ semaphore.release(); å½“åˆå§‹çš„èµ„æºä¸ªæ•°ä¸º 1 çš„æ—¶å€™ï¼ŒSemaphore é€€åŒ–ä¸ºæ’ä»–é”ã€‚\nSemaphoreå¯¹åº”çš„ä¸¤ä¸ªæ„é€ æ–¹æ³•\npublic Semaphore(int permits) { sync = new NonfairSync(permits); } public Semaphore(int permits, boolean fair) { sync = fair ? new FairSync(permits) : new NonfairSync(permits); } è¿™ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œéƒ½å¿…é¡»æä¾›è®¸å¯çš„æ•°é‡ï¼Œç¬¬äºŒä¸ªæ„é€ æ–¹æ³•å¯ä»¥æŒ‡å®šæ˜¯å…¬å¹³æ¨¡å¼è¿˜æ˜¯éå…¬å¹³æ¨¡å¼ï¼Œé»˜è®¤éå…¬å¹³æ¨¡å¼ã€‚\nSemaphore é€šå¸¸ç”¨äºé‚£äº›èµ„æºæœ‰æ˜ç¡®è®¿é—®æ•°é‡é™åˆ¶çš„åœºæ™¯æ¯”å¦‚é™æµï¼ˆä»…é™äºå•æœºæ¨¡å¼ï¼Œå®é™…é¡¹ç›®ä¸­æ¨èä½¿ç”¨ Redis +Lua æ¥åšé™æµï¼‰ã€‚\nSemaphore çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ\nSemaphore æ˜¯å…±äº«é”çš„ä¸€ç§å®ç°ï¼Œå®ƒé»˜è®¤æ„é€  AQS çš„ state å€¼ä¸º permitsï¼Œä½ å¯ä»¥å°† permits çš„å€¼ç†è§£ä¸ºè®¸å¯è¯çš„æ•°é‡ï¼Œåªæœ‰æ‹¿åˆ°è®¸å¯è¯çš„çº¿ç¨‹æ‰èƒ½æ‰§è¡Œã€‚\nè°ƒç”¨semaphore.acquire() ï¼Œçº¿ç¨‹å°è¯•è·å–è®¸å¯è¯ï¼Œå¦‚æœ state \u0026gt;= 0 çš„è¯ï¼Œåˆ™è¡¨ç¤ºå¯ä»¥è·å–æˆåŠŸã€‚å¦‚æœè·å–æˆåŠŸçš„è¯ï¼Œä½¿ç”¨ CAS æ“ä½œå»ä¿®æ”¹ state çš„å€¼ state=state-1ã€‚å¦‚æœ state\u0026lt;0 çš„è¯ï¼Œåˆ™è¡¨ç¤ºè®¸å¯è¯æ•°é‡ä¸è¶³ã€‚æ­¤æ—¶ä¼šåˆ›å»ºä¸€ä¸ª Node èŠ‚ç‚¹åŠ å…¥é˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‚èµ·å½“å‰çº¿ç¨‹ã€‚\n/** * è·å–1ä¸ªè®¸å¯è¯ */ public void acquire() throws InterruptedException { sync.acquireSharedInterruptibly(1); } /** * å…±äº«æ¨¡å¼ä¸‹è·å–è®¸å¯è¯ï¼Œè·å–æˆåŠŸåˆ™è¿”å›ï¼Œå¤±è´¥åˆ™åŠ å…¥é˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‚èµ·çº¿ç¨‹ */ public final void acquireSharedInterruptibly(int arg) throws InterruptedException { if (Thread.interrupted()) throw new InterruptedException(); // å°è¯•è·å–è®¸å¯è¯ï¼Œargä¸ºè·å–è®¸å¯è¯ä¸ªæ•°ï¼Œå½“å¯ç”¨è®¸å¯è¯æ•°å‡å½“å‰è·å–çš„è®¸å¯è¯æ•°ç»“æœå°äº0,åˆ™åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹åŠ å…¥é˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‚èµ·å½“å‰çº¿ç¨‹ã€‚ if (tryAcquireShared(arg) \u0026lt; 0) doAcquireSharedInterruptibly(arg); } è°ƒç”¨semaphore.release(); ï¼Œçº¿ç¨‹å°è¯•é‡Šæ”¾è®¸å¯è¯ï¼Œå¹¶ä½¿ç”¨ CAS æ“ä½œå»ä¿®æ”¹ state çš„å€¼ state=state+1ã€‚é‡Šæ”¾è®¸å¯è¯æˆåŠŸä¹‹åï¼ŒåŒæ—¶ä¼šå”¤é†’åŒæ­¥é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ã€‚è¢«å”¤é†’çš„çº¿ç¨‹ä¼šé‡æ–°å°è¯•å»ä¿®æ”¹ state çš„å€¼ state=state-1 ï¼Œå¦‚æœ state\u0026gt;=0 åˆ™è·å–ä»¤ç‰ŒæˆåŠŸï¼Œå¦åˆ™é‡æ–°è¿›å…¥é˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‚èµ·çº¿ç¨‹ã€‚\n// é‡Šæ”¾ä¸€ä¸ªè®¸å¯è¯ public void release() { sync.releaseShared(1); } // é‡Šæ”¾å…±äº«é”ï¼ŒåŒæ—¶ä¼šå”¤é†’åŒæ­¥é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ã€‚ public final boolean releaseShared(int arg) { //é‡Šæ”¾å…±äº«é” if (tryReleaseShared(arg)) { //å”¤é†’åŒæ­¥é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ doReleaseShared(); return true; } return false; } CountDownLatch # CountDownLatchæœ‰ä»€ä¹ˆç”¨\nCountDownLatch å…è®¸ count ä¸ªçº¿ç¨‹é˜»å¡åœ¨ä¸€ä¸ªåœ°æ–¹(ä¸€èˆ¬ä¾‹å­æ˜¯é˜»å¡åœ¨ä¸»çº¿ç¨‹ä¸­ countDownLatch.await())ï¼Œç›´è‡³æ‰€æœ‰çº¿ç¨‹çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•**(å†ä»é˜»å¡çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œ)**ã€‚ CountDownLatch æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œè®¡æ•°å™¨çš„å€¼åªèƒ½åœ¨æ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–ä¸€æ¬¡ï¼Œä¹‹åæ²¡æœ‰ä»»ä½•æœºåˆ¶å†æ¬¡å¯¹å…¶è®¾ç½®å€¼ï¼Œå½“ CountDownLatch ä½¿ç”¨å®Œæ¯•åï¼Œå®ƒä¸èƒ½å†æ¬¡è¢«ä½¿ç”¨ã€‚ CountDownLatchçš„åŸç†æ˜¯ä»€ä¹ˆ CountDownLatch æ˜¯å…±äº«é”çš„ä¸€ç§å®ç°,å®ƒé»˜è®¤æ„é€  AQS çš„ state å€¼ä¸º countã€‚å½“çº¿ç¨‹ä½¿ç”¨ countDown() æ–¹æ³•æ—¶,å…¶å®ä½¿ç”¨äº†**tryReleaseSharedæ–¹æ³•ä»¥ CAS çš„æ“ä½œæ¥å‡å°‘ state,ç›´è‡³ state ä¸º 0 ã€‚å½“è°ƒç”¨ await() æ–¹æ³•çš„æ—¶å€™ï¼Œå¦‚æœ state ä¸ä¸º 0ï¼Œé‚£å°±è¯æ˜ä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œawait() æ–¹æ³•å°±ä¼šä¸€ç›´é˜»å¡**ï¼Œä¹Ÿå°±æ˜¯è¯´ await() æ–¹æ³•ä¹‹åçš„è¯­å¥ä¸ä¼šè¢«æ‰§è¡Œã€‚ç„¶åï¼ŒCountDownLatch ä¼šè‡ªæ—‹ CAS åˆ¤æ–­ state == 0ï¼Œå¦‚æœ state == 0 çš„è¯ï¼Œå°±ä¼šé‡Šæ”¾æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œawait() æ–¹æ³•ä¹‹åçš„è¯­å¥å¾—åˆ°æ‰§è¡Œã€‚\nç”¨è¿‡ CountDownLatch ä¹ˆï¼Ÿä»€ä¹ˆåœºæ™¯ä¸‹ç”¨çš„ï¼Ÿ\nCountDownLatch çš„ä½œç”¨å°±æ˜¯ å…è®¸ count ä¸ªçº¿ç¨‹é˜»å¡åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œç›´è‡³æ‰€æœ‰çº¿ç¨‹çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•ã€‚ä¹‹å‰åœ¨é¡¹ç›®ä¸­ï¼Œæœ‰ä¸€ä¸ªä½¿ç”¨å¤šçº¿ç¨‹è¯»å–å¤šä¸ªæ–‡ä»¶å¤„ç†çš„åœºæ™¯ï¼Œæˆ‘ç”¨åˆ°äº† CountDownLatch ã€‚å…·ä½“åœºæ™¯æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š\næˆ‘ä»¬è¦è¯»å–å¤„ç† 6 ä¸ªæ–‡ä»¶ï¼Œè¿™ 6 ä¸ªä»»åŠ¡éƒ½æ˜¯æ²¡æœ‰æ‰§è¡Œé¡ºåºä¾èµ–çš„ä»»åŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦è¿”å›ç»™ç”¨æˆ·çš„æ—¶å€™å°†è¿™å‡ ä¸ªæ–‡ä»¶çš„å¤„ç†çš„ç»“æœè¿›è¡Œç»Ÿè®¡æ•´ç†ã€‚\nä¸ºæ­¤æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªçº¿ç¨‹æ± å’Œ count ä¸º 6 çš„CountDownLatchå¯¹è±¡ ã€‚ä½¿ç”¨çº¿ç¨‹æ± å¤„ç†è¯»å–ä»»åŠ¡ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹å¤„ç†å®Œä¹‹åå°±å°† count-1ï¼Œè°ƒç”¨CountDownLatchå¯¹è±¡çš„ await()æ–¹æ³•ï¼Œç›´åˆ°æ‰€æœ‰æ–‡ä»¶è¯»å–å®Œä¹‹åï¼Œæ‰ä¼šæ¥ç€æ‰§è¡Œåé¢çš„é€»è¾‘ã€‚\n//ä¼ªä»£ç  public class CountDownLatchExample1 { // å¤„ç†æ–‡ä»¶çš„æ•°é‡ private static final int threadCount = 6; public static void main(String[] args) throws InterruptedException { // åˆ›å»ºä¸€ä¸ªå…·æœ‰å›ºå®šçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± å¯¹è±¡ï¼ˆæ¨èä½¿ç”¨æ„é€ æ–¹æ³•åˆ›å»ºï¼‰ ExecutorService threadPool = Executors.newFixedThreadPool(10); final CountDownLatch countDownLatch = new CountDownLatch(threadCount); for (int i = 0; i \u0026lt; threadCount; i++) { final int threadnum = i; threadPool.execute(() -\u0026gt; { try { //å¤„ç†æ–‡ä»¶çš„ä¸šåŠ¡æ“ä½œ //...... } catch (InterruptedException e) { e.printStackTrace(); } finally { //è¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶å·²ç»è¢«å®Œæˆ countDownLatch.countDown(); } }); } countDownLatch.await(); //è¿™é‡Œåº”è¯¥æ˜¯è¦å¯¹threadCoundä¸ªçº¿ç¨‹çš„ç»“æœï¼Œè¿›è¡Œæ±‡æ€» threadPool.shutdown(); System.out.println(\u0026#34;finish\u0026#34;); } } ä¸Šé¢çš„ä¾‹å­ï¼Œä¹Ÿå¯ä»¥ç”¨CompletableFutureè¿›è¡Œæ”¹è¿›\nJava8 çš„ CompletableFuture æä¾›äº†å¾ˆå¤šå¯¹å¤šçº¿ç¨‹å‹å¥½çš„æ–¹æ³•ï¼Œä½¿ç”¨å®ƒå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¸ºæˆ‘ä»¬ç¼–å†™å¤šçº¿ç¨‹ç¨‹åºï¼Œä»€ä¹ˆå¼‚æ­¥ã€ä¸²è¡Œã€å¹¶è¡Œæˆ–è€…ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡ä»€ä¹ˆçš„éƒ½éå¸¸æ–¹ä¾¿ã€‚\nCompletableFuture\u0026lt;Void\u0026gt; task1 = CompletableFuture.supplyAsync(()-\u0026gt;{ //è‡ªå®šä¹‰ä¸šåŠ¡æ“ä½œ }); ...... CompletableFuture\u0026lt;Void\u0026gt; task6 = CompletableFuture.supplyAsync(()-\u0026gt;{ //è‡ªå®šä¹‰ä¸šåŠ¡æ“ä½œ }); ...... CompletableFuture\u0026lt;Void\u0026gt; headerFuture=CompletableFuture.allOf(task1,.....,task6); try { headerFuture.join(); } catch (Exception ex) { //...... } System.out.println(\u0026#34;all done. \u0026#34;); é€šè¿‡å¾ªç¯æ·»åŠ ä»»åŠ¡\n//æ–‡ä»¶å¤¹ä½ç½® List\u0026lt;String\u0026gt; filePaths = Arrays.asList(...) // å¼‚æ­¥å¤„ç†æ‰€æœ‰æ–‡ä»¶ List\u0026lt;CompletableFuture\u0026lt;String\u0026gt;\u0026gt; fileFutures = filePaths.stream() .map(filePath -\u0026gt; doSomeThing(filePath)) .collect(Collectors.toList()); // å°†ä»–ä»¬åˆå¹¶èµ·æ¥ CompletableFuture\u0026lt;Void\u0026gt; allFutures = CompletableFuture.allOf( fileFutures.toArray(new CompletableFuture[fileFutures.size()]) ); CyclicBarrier # //ä½¿ç”¨åœºæ™¯ï¼Œä¸å¤ªä¸€æ ·çš„æ˜¯ï¼Œå®ƒä¸€èˆ¬æ˜¯è®©å­ä»»åŠ¡é˜»å¡åï¼Œåˆ°æ—¶å€™ä¸€èµ·æ‰§è¡Œ public class TestCyclicBarrier { public static void main(String[] args) { CyclicBarrier cyclicBarrier = new CyclicBarrier(3, () -\u0026gt; { try { TimeUnit.SECONDS.sleep(3); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread().getName() + \u0026#34;æ‰§è¡Œå’¯\u0026#34;); }); for (int n = 0; n \u0026lt; 15; n++) { int finalN = n; new Thread(() -\u0026gt; { try { TimeUnit.SECONDS.sleep(finalN); System.out.println(Thread.currentThread().getName() + \u0026#34;æ•°æ®éƒ½å‡†å¤‡å¥½äº†,ç­‰å¾…ä¸­....\u0026#34;); cyclicBarrier.await(); } catch (InterruptedException | BrokenBarrierException e) { e.printStackTrace(); } System.out.println(Thread.currentThread().getName() + \u0026#34;å‡ºå‘å’¯!\u0026#34;); }, \u0026#34;çº¿ç¨‹\u0026#34; + n).start(); } } } /* çº¿ç¨‹0æ•°æ®éƒ½å‡†å¤‡å¥½äº†,ç­‰å¾…ä¸­.... çº¿ç¨‹1æ•°æ®éƒ½å‡†å¤‡å¥½äº†,ç­‰å¾…ä¸­.... çº¿ç¨‹2æ•°æ®éƒ½å‡†å¤‡å¥½äº†,ç­‰å¾…ä¸­.... çº¿ç¨‹3æ•°æ®éƒ½å‡†å¤‡å¥½äº†,ç­‰å¾…ä¸­.... çº¿ç¨‹4æ•°æ®éƒ½å‡†å¤‡å¥½äº†,ç­‰å¾…ä¸­.... çº¿ç¨‹5æ•°æ®éƒ½å‡†å¤‡å¥½äº†,ç­‰å¾…ä¸­.... çº¿ç¨‹2æ‰§è¡Œå’¯ çº¿ç¨‹2å‡ºå‘å’¯! çº¿ç¨‹6æ•°æ®éƒ½å‡†å¤‡å¥½äº†,ç­‰å¾…ä¸­.... çº¿ç¨‹7æ•°æ®éƒ½å‡†å¤‡å¥½äº†,ç­‰å¾…ä¸­.... çº¿ç¨‹8æ•°æ®éƒ½å‡†å¤‡å¥½äº†,ç­‰å¾…ä¸­.... çº¿ç¨‹5æ‰§è¡Œå’¯ çº¿ç¨‹5å‡ºå‘å’¯! çº¿ç¨‹0å‡ºå‘å’¯! çº¿ç¨‹1å‡ºå‘å’¯! çº¿ç¨‹9æ•°æ®éƒ½å‡†å¤‡å¥½äº†,ç­‰å¾…ä¸­.... çº¿ç¨‹10æ•°æ®éƒ½å‡†å¤‡å¥½äº†,ç­‰å¾…ä¸­.... çº¿ç¨‹11æ•°æ®éƒ½å‡†å¤‡å¥½äº†,ç­‰å¾…ä¸­.... çº¿ç¨‹8æ‰§è¡Œå’¯ çº¿ç¨‹3å‡ºå‘å’¯! çº¿ç¨‹8å‡ºå‘å’¯! çº¿ç¨‹4å‡ºå‘å’¯! çº¿ç¨‹12æ•°æ®éƒ½å‡†å¤‡å¥½äº†,ç­‰å¾…ä¸­.... çº¿ç¨‹13æ•°æ®éƒ½å‡†å¤‡å¥½äº†,ç­‰å¾…ä¸­.... çº¿ç¨‹14æ•°æ®éƒ½å‡†å¤‡å¥½äº†,ç­‰å¾…ä¸­.... çº¿ç¨‹11æ‰§è¡Œå’¯ çº¿ç¨‹11å‡ºå‘å’¯! çº¿ç¨‹6å‡ºå‘å’¯! çº¿ç¨‹7å‡ºå‘å’¯! çº¿ç¨‹14æ‰§è¡Œå’¯ çº¿ç¨‹14å‡ºå‘å’¯! çº¿ç¨‹12å‡ºå‘å’¯! çº¿ç¨‹10å‡ºå‘å’¯! çº¿ç¨‹9å‡ºå‘å’¯! çº¿ç¨‹13å‡ºå‘å’¯! Process finished with exit code 0 */ CyclicBarrier æœ‰ä»€ä¹ˆç”¨ï¼Ÿ\nCyclicBarrier å’Œ CountDownLatch éå¸¸ç±»ä¼¼ï¼Œå®ƒä¹Ÿå¯ä»¥å®ç°çº¿ç¨‹é—´çš„æŠ€æœ¯ç­‰å¾…ï¼Œä½†æ˜¯å®ƒçš„åŠŸèƒ½æ¯” CountDownLatch æ›´åŠ å¤æ‚å’Œå¼ºå¤§ã€‚ä¸»è¦åº”ç”¨åœºæ™¯å’Œ CountDownLatch ç±»ä¼¼ã€‚\nCountDownLatch çš„å®ç°æ˜¯åŸºäº AQS çš„ï¼Œè€Œ CycliBarrier æ˜¯åŸºäº **ReentrantLock(ReentrantLock ä¹Ÿå±äº AQS åŒæ­¥å™¨)**å’Œ Condition çš„ã€‚\nCyclicBarrier çš„å­—é¢æ„æ€æ˜¯å¯å¾ªç¯ä½¿ç”¨ï¼ˆCyclicï¼‰çš„å±éšœï¼ˆBarrierï¼‰ã€‚å®ƒè¦åšçš„äº‹æƒ…æ˜¯ï¼šè®©ä¸€ç»„çº¿ç¨‹åˆ°è¾¾ä¸€ä¸ªå±éšœï¼ˆä¹Ÿå¯ä»¥å«åŒæ­¥ç‚¹ï¼‰æ—¶è¢«é˜»å¡ï¼Œç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœæ—¶ï¼Œå±éšœæ‰ä¼šå¼€é—¨ï¼Œæ‰€æœ‰è¢«å±éšœæ‹¦æˆªçš„çº¿ç¨‹æ‰ä¼šç»§ç»­å¹²æ´»ã€‚\nCyclicBarrierçš„åŸç†\nCyclicBarrier å†…éƒ¨é€šè¿‡ä¸€ä¸ª count å˜é‡ä½œä¸ºè®¡æ•°å™¨ï¼Œcount çš„åˆå§‹å€¼ä¸º parties å±æ€§çš„åˆå§‹åŒ–å€¼ï¼Œæ¯å½“ä¸€ä¸ªçº¿ç¨‹åˆ°äº†æ …æ è¿™é‡Œäº†ï¼Œé‚£ä¹ˆå°±å°†è®¡æ•°å™¨å‡ 1ã€‚å¦‚æœ count å€¼ä¸º 0 äº†ï¼Œè¡¨ç¤ºè¿™æ˜¯è¿™ä¸€ä»£æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾æ …æ ï¼Œå°±å°è¯•æ‰§è¡Œæˆ‘ä»¬æ„é€ æ–¹æ³•ä¸­è¾“å…¥çš„ä»»åŠ¡ï¼Œä¹‹åå†ä»çº¿ç¨‹é˜»å¡çš„ä½ç½®ç»§ç»­æ‰§è¡Œã€‚\n//æ¯æ¬¡æ‹¦æˆªçš„çº¿ç¨‹æ•°, æ³¨æ„ï¼šè¿™ä¸ªæ˜¯ä¸å¯å˜çš„å“¦ private final int parties; //è®¡æ•°å™¨ private int count; ç»“åˆæºç \nCyclicBarrier é»˜è®¤çš„æ„é€ æ–¹æ³•æ˜¯ CyclicBarrier(int parties)ï¼Œå…¶å‚æ•°è¡¨ç¤ºå±éšœæ‹¦æˆªçš„çº¿ç¨‹æ•°é‡ï¼Œæ¯ä¸ªçº¿ç¨‹è°ƒç”¨ await() æ–¹æ³•å‘Šè¯‰ CyclicBarrier æˆ‘å·²ç»åˆ°è¾¾äº†å±éšœï¼Œç„¶åå½“å‰çº¿ç¨‹è¢«é˜»å¡ã€‚\npublic CyclicBarrier(int parties) { this(parties, null); } public CyclicBarrier(int parties, Runnable barrierAction) { if (parties \u0026lt;= 0) throw new IllegalArgumentException(); this.parties = parties; this.count = parties; this.barrierCommand = barrierAction; } å…¶ä¸­ï¼Œparties å°±ä»£è¡¨äº†æœ‰ï¼ˆéœ€è¦ï¼‰æ‹¦æˆªçš„çº¿ç¨‹çš„æ•°é‡ï¼Œå½“æ‹¦æˆªçš„çº¿ç¨‹æ•°é‡è¾¾åˆ°è¿™ä¸ªå€¼çš„æ—¶å€™å°±æ‰“å¼€æ …æ ï¼Œè®©æ‰€æœ‰çº¿ç¨‹é€šè¿‡ã€‚\nå½“è°ƒç”¨ CyclicBarrier å¯¹è±¡è°ƒç”¨ await() æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯ dowait(false, 0L)æ–¹æ³•ã€‚ await() æ–¹æ³•å°±åƒæ ‘ç«‹èµ·ä¸€ä¸ªæ …æ çš„è¡Œä¸ºä¸€æ ·ï¼Œå°†çº¿ç¨‹æŒ¡ä½äº†ï¼Œå½“æ‹¦ä½çš„çº¿ç¨‹æ•°é‡è¾¾åˆ° parties çš„å€¼æ—¶ï¼Œæ …æ æ‰ä¼šæ‰“å¼€ï¼Œçº¿ç¨‹æ‰å¾—ä»¥é€šè¿‡æ‰§è¡Œ\nublic int await() throws InterruptedException, BrokenBarrierException { try { return dowait(false, 0L); } catch (TimeoutException toe) { throw new Error(toe); // cannot happen } } dowait(false,0L)æ–¹æ³•æºç å¦‚ä¸‹\n// å½“çº¿ç¨‹æ•°é‡æˆ–è€…è¯·æ±‚æ•°é‡è¾¾åˆ° count æ—¶ await ä¹‹åçš„æ–¹æ³•æ‰ä¼šè¢«æ‰§è¡Œã€‚ä¸Šé¢çš„ç¤ºä¾‹ä¸­ count çš„å€¼å°±ä¸º 5ã€‚ private int count; /** * Main barrier code, covering the various policies. */ private int dowait(boolean timed, long nanos) throws InterruptedException, BrokenBarrierException, TimeoutException { final ReentrantLock lock = this.lock; // é”ä½ lock.lock(); try { final Generation g = generation; if (g.broken) throw new BrokenBarrierException(); // å¦‚æœçº¿ç¨‹ä¸­æ–­äº†ï¼ŒæŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) { breakBarrier(); throw new InterruptedException(); } // coutå‡1 int index = --count; // å½“ count æ•°é‡å‡ä¸º 0 ä¹‹åè¯´æ˜æœ€åä¸€ä¸ªçº¿ç¨‹å·²ç»åˆ°è¾¾æ …æ äº†ï¼Œä¹Ÿå°±æ˜¯è¾¾åˆ°äº†å¯ä»¥æ‰§è¡Œawait æ–¹æ³•ä¹‹åçš„æ¡ä»¶ if (index == 0) { // tripped boolean ranAction = false; try { final Runnable command = barrierCommand; if (command != null) command.run(); ranAction = true; // å°† count é‡ç½®ä¸º parties å±æ€§çš„åˆå§‹åŒ–å€¼ // å”¤é†’ä¹‹å‰ç­‰å¾…çš„çº¿ç¨‹ // ä¸‹ä¸€æ³¢æ‰§è¡Œå¼€å§‹ nextGeneration(); return 0; } finally { if (!ranAction) breakBarrier(); } } // loop until tripped, broken, interrupted, or timed out for (;;) { try { if (!timed) trip.await(); else if (nanos \u0026gt; 0L) nanos = trip.awaitNanos(nanos); } catch (InterruptedException ie) { if (g == generation \u0026amp;\u0026amp; ! g.broken) { breakBarrier(); throw ie; } else { // We\u0026#39;re about to finish waiting even if we had not // been interrupted, so this interrupt is deemed to // \u0026#34;belong\u0026#34; to subsequent execution. Thread.currentThread().interrupt(); } } if (g.broken) throw new BrokenBarrierException(); if (g != generation) return index; if (timed \u0026amp;\u0026amp; nanos \u0026lt;= 0L) { breakBarrier(); throw new TimeoutException(); } } } finally { lock.unlock(); } } ä¸‰è€…åŒºåˆ« # CountDownLatchä¹Ÿèƒ½å®ç°CyclicBarrierç±»ä¼¼åŠŸèƒ½ï¼Œä¸è¿‡å®ƒçš„æ …æ è¢«æ¨åˆ°åå°±ä¸ä¼šå†é‡æ–°å­˜åœ¨äº†(CyclicBarrierä¼šé‡æ–°å»ºç«‹æ …æ )\nCountDownLatch countDownLatch=new CountDownLatch(5); new Thread(()-\u0026gt;{ try { countDownLatch.await(); log.info(\u0026#34;æ …æ è¢«æ¨å¼€äº†\u0026#34;); } catch (InterruptedException e) { e.printStackTrace(); } },\u0026#34;çº¿ç¨‹A\u0026#34;).start(); new Thread(()-\u0026gt;{ try { countDownLatch.await(); log.info(\u0026#34;æ …æ è¢«æ¨å¼€äº†\u0026#34;); } catch (InterruptedException e) { e.printStackTrace(); } },\u0026#34;çº¿ç¨‹B\u0026#34;).start(); new Thread(()-\u0026gt;{ try { countDownLatch.await(); log.info(\u0026#34;æ …æ è¢«æ¨å¼€äº†\u0026#34;); } catch (InterruptedException e) { e.printStackTrace(); } },\u0026#34;çº¿ç¨‹C\u0026#34;).start(); new Thread(()-\u0026gt;{ try { countDownLatch.await(); log.info(\u0026#34;æ …æ è¢«æ¨å¼€äº†\u0026#34;); } catch (InterruptedException e) { e.printStackTrace(); } },\u0026#34;çº¿ç¨‹D\u0026#34;).start(); new Thread(()-\u0026gt;{ try { countDownLatch.await(); log.info(\u0026#34;æ …æ è¢«æ¨å¼€äº†\u0026#34;); } catch (InterruptedException e) { e.printStackTrace(); } },\u0026#34;çº¿ç¨‹E\u0026#34;).start(); new Thread(()-\u0026gt;{ //countDownLatch.await(); for(int i=0;i\u0026lt;5;i++) { //æ¯éš”ä¸€ç§’é’Ÿæ¨å¼€ä¸€ä¸ªæ …æ  try { TimeUnit.SECONDS.sleep(1); } catch (InterruptedException e) { e.printStackTrace(); } log.info(\u0026#34;æ¨å¼€ä¸€ä¸ªæ …æ \u0026#34;); countDownLatch.countDown(); } },\u0026#34;çº¿ç¨‹F\u0026#34;).start(); while (true){} /**è¾“å‡º 2023-03-07 23:23:19 ä¸‹åˆ [Thread: çº¿ç¨‹F] INFO:æ¨å¼€ä¸€ä¸ªæ …æ  2023-03-07 23:23:20 ä¸‹åˆ [Thread: çº¿ç¨‹F] INFO:æ¨å¼€ä¸€ä¸ªæ …æ  2023-03-07 23:23:21 ä¸‹åˆ [Thread: çº¿ç¨‹F] INFO:æ¨å¼€ä¸€ä¸ªæ …æ  2023-03-07 23:23:22 ä¸‹åˆ [Thread: çº¿ç¨‹F] INFO:æ¨å¼€ä¸€ä¸ªæ …æ  2023-03-07 23:23:24 ä¸‹åˆ [Thread: çº¿ç¨‹F] INFO:æ¨å¼€ä¸€ä¸ªæ …æ  ///////////////////////////////////////////æ¨å¼€5ä¸ªæ …æ å(è¿™é‡Œæ˜¯ä¸€ä¸ªçº¿ç¨‹æ¨å¼€äº”ä¸ªï¼Œä¹Ÿå¯ä»¥5ä¸ªçº¿ç¨‹-\u0026gt;æ¯ä¸ªå„æ¨å¼€ä¸€ä¸ª)ï¼Œ5ä¸ªè¢«é˜»å¡çš„çº¿ç¨‹ä¸€èµ·æ‰§è¡Œäº† 2023-03-07 23:23:24 ä¸‹åˆ [Thread: çº¿ç¨‹A] INFO:æ …æ è¢«æ¨å¼€äº† 2023-03-07 23:23:24 ä¸‹åˆ [Thread: çº¿ç¨‹E] INFO:æ …æ è¢«æ¨å¼€äº† 2023-03-07 23:23:24 ä¸‹åˆ [Thread: çº¿ç¨‹C] INFO:æ …æ è¢«æ¨å¼€äº† 2023-03-07 23:23:24 ä¸‹åˆ [Thread: çº¿ç¨‹D] INFO:æ …æ è¢«æ¨å¼€äº† 2023-03-07 23:23:24 ä¸‹åˆ [Thread: çº¿ç¨‹B] INFO:æ …æ è¢«æ¨å¼€äº† */ "},{"id":136,"href":"/zh/docs/study/Review/java_guide/java/Concurrent/ly03122lylock_escalation/","title":"é”å‡çº§","section":"å¹¶å‘","content":" ä»¥ä¸‹å†…å®¹å‡è½¬è‡ª https://www.cnblogs.com/wuqinglong/p/9945618.htmlï¼Œéƒ¨åˆ†ç–‘æƒ‘å‚è€ƒè‡ªå¦ä¸€ä½œè€… https://github.com/farmerjohngit/myblog/issues/12 ï¼Œæ„Ÿè°¢åŸä½œè€…ã€‚\nã€ç›®å‰è¿˜æ˜¯å­˜æœ‰éƒ¨åˆ†ç–‘è™‘ï¼ˆè½»é‡çº§é”é‚£å—ï¼‰ï¼Œå¯èƒ½éœ€è¦è¯¦ç»†çœ‹æºç æ‰èƒ½é‡Šç–‘ã€‘\næ¦‚è¿° # ä¼ ç»Ÿçš„synchronizedä¸ºé‡é‡çº§é”ï¼ˆä½¿ç”¨æ“ä½œç³»ç»Ÿäº’æ–¥é‡ï¼ˆmutexï¼‰æ¥å®ç°çš„ä¼ ç»Ÿé”ï¼‰ï¼Œä½†æ˜¯éšç€JavaSE1.6å¯¹synchronizedä¼˜åŒ–åï¼Œéƒ¨åˆ†æƒ…å†µä¸‹ä»–å°±æ²¡æœ‰é‚£ä¹ˆé‡äº†ã€‚æœ¬æ–‡ä»‹ç»äº†JavaSE1.6ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—è€Œå¼•å…¥çš„åå‘é”å’Œè½»é‡çº§é”ï¼Œä»¥åŠé”ç»“æ„ã€åŠé”å‡çº§è¿‡ç¨‹\nå®ç°åŒæ­¥çš„åŸºç¡€ # Javaä¸­æ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºé”ï¼Œå…·ä½“å˜ç°å½¢å¼\nå¯¹äºæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ å¯¹äºé™æ€åŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰ç±»çš„Classå¯¹è±¡ å¯¹äºåŒæ­¥æ–¹æ³•å—ï¼Œé”æ˜¯synchronizedæ‹¬å·é‡Œé…ç½®çš„å¯¹è±¡ ä¸€ä¸ªçº¿ç¨‹è¯•å›¾è®¿é—®åŒæ­¥ä»£ç å—æ—¶ï¼Œå¿…é¡»è·å–é”ï¼›åœ¨é€€å‡ºæˆ–è€…æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œå¿…é¡»é‡Šæ”¾é”\nå®ç°æ–¹å¼ # JVM åŸºäºè¿›å…¥å’Œé€€å‡º Monitor å¯¹è±¡æ¥å®ç°æ–¹æ³•åŒæ­¥å’Œä»£ç å—åŒæ­¥ï¼Œä½†æ˜¯ä¸¤è€…çš„å®ç°ç»†èŠ‚ä¸ä¸€æ ·\nä»£ç å—åŒæ­¥ï¼šé€šè¿‡ä½¿ç”¨ monitorenter å’Œ monitorexit æŒ‡ä»¤å®ç°çš„ åŒæ­¥æ–¹æ³•ï¼šACC_SYNCHRONIZED ä¿®é¥° monitorenter æŒ‡ä»¤æ˜¯åœ¨ç¼–è¯‘åæ’å…¥åˆ°åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œè€Œ monitorexit æŒ‡ä»¤æ˜¯åœ¨ç¼–è¯‘åæ’å…¥åˆ°åŒæ­¥ä»£ç å—çš„ç»“æŸå¤„æˆ–å¼‚å¸¸å¤„\nå¯¹äºåŒæ­¥æ–¹æ³•ï¼Œè¿›å…¥æ–¹æ³•å‰æ·»åŠ ä¸€ä¸ª monitorenter æŒ‡ä»¤ï¼Œé€€å‡ºæ–¹æ³•åæ·»åŠ ä¸€ä¸ª monitorexit æŒ‡ä»¤ã€‚\ndemoï¼š\npublic class Demo { public void f1() { synchronized (Demo.class) { System.out.println(\u0026#34;Hello World.\u0026#34;); } } public synchronized void f2() { System.out.println(\u0026#34;Hello World.\u0026#34;); } } ç¼–è¯‘ä¹‹åçš„å­—èŠ‚ç ï¼ˆä½¿ç”¨ javap )\npublic void f1(); descriptor: ()V flags: ACC_PUBLIC Code: stack=2, locals=3, args_size=1 0: ldc #2 // class me/snail/base/Demo 2: dup 3: astore_1 4: monitorenter 5: getstatic #3 // Field java/lang/System.out:Ljava/io/PrintStream; 8: ldc #4 // String Hello World. 10: invokevirtual #5 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 13: aload_1 14: monitorexit 15: goto 23 18: astore_2 19: aload_1 20: monitorexit 21: aload_2 22: athrow 23: return Exception table: from to target type 5 15 18 any 18 21 18 any LineNumberTable: line 6: 0 line 7: 5 line 8: 13 line 9: 23 StackMapTable: number_of_entries = 2 frame_type = 255 /* full_frame */ offset_delta = 18 locals = [ class me/snail/base/Demo, class java/lang/Object ] stack = [ class java/lang/Throwable ] frame_type = 250 /* chop */ offset_delta = 4 public synchronized void f2(); descriptor: ()V flags: ACC_PUBLIC, ACC_SYNCHRONIZED Code: stack=2, locals=1, args_size=1 0: getstatic #3 // Field java/lang/System.out:Ljava/io/PrintStream; 3: ldc #4 // String Hello World. 5: invokevirtual #5 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 8: return LineNumberTable: line 12: 0 line 13: 8 å…ˆè¯´ f1() æ–¹æ³•ï¼Œå‘ç°å…¶ä¸­ä¸€ä¸ª monitorenter å¯¹åº”äº†ä¸¤ä¸ª monitorexitï¼Œè¿™æ˜¯ä¸å¯¹çš„ã€‚ä½†æ˜¯ä»”ç»†çœ‹ #15: goto è¯­å¥ï¼Œç›´æ¥è·³è½¬åˆ°äº† #23: return å¤„ï¼Œå†çœ‹ #22: athrow è¯­å¥å‘ç°ï¼ŒåŸæ¥ç¬¬äºŒä¸ª monitorexit æ˜¯ä¿è¯åŒæ­¥ä»£ç å—æŠ›å‡ºå¼‚å¸¸æ—¶é”èƒ½å¾—åˆ°æ­£ç¡®çš„é‡Šæ”¾è€Œå­˜åœ¨çš„ï¼Œè¿™å°±ç†è§£äº†ã€‚\nJavaå¯¹è±¡å¤´ï¼ˆå­˜å‚¨é”ç±»å‹ï¼‰ # HotSpotè™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€åˆ†ä¸ºä¸‰å—åŒºåŸŸï¼šå¯¹è±¡å¤´ã€å®ä¾‹æ•°æ®ã€å¯¹é½å¡«å……\nå¯¹è±¡å¤´åˆåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šMarkWordå’Œç±»å‹æŒ‡é’ˆï¼Œå¯¹äºæ•°ç»„å¯¹è±¡ï¼Œå¯¹è±¡å¤´ä¸­è¿˜æœ‰ä¸€éƒ¨åˆ†æ—¶å­˜å‚¨æ•°ç»„çš„é•¿åº¦\nå¤šçº¿ç¨‹ä¸‹synchronizedçš„åŠ é”ï¼Œå°±æ˜¯å¯¹åŒä¸€ä¸ªå¯¹è±¡çš„å¯¹è±¡å¤´ä¸­çš„MarkWordä¸­çš„å˜é‡è¿›è¡ŒCASæ“ä½œ\nMarkWord\nç±»å‹æŒ‡é’ˆ è™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆç¡®å®šè¯¥å¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹\nå¯¹è±¡å¤´çš„é•¿åº¦\né•¿åº¦ å†…å®¹ è¯´æ˜ 32/64bit MarkWord å­˜å‚¨å¯¹è±¡çš„hashCodeæˆ–é”ä¿¡æ¯ç­‰ 32/64bit Class Metadada Address å­˜å‚¨å¯¹è±¡ç±»å‹æ•°æ®çš„æŒ‡é’ˆ 32/64bit Array Length æ•°ç»„çš„é•¿åº¦(å¦‚æœå½“å‰å¯¹è±¡æ˜¯æ•°ç»„) å¦‚æœæ˜¯æ•°ç»„å¯¹è±¡çš„è¯ï¼Œè™šæ‹Ÿæœºç”¨3ä¸ªå­—å®½(32/64bit + 32/64bit + 32/64bit)å­˜å‚¨å¯¹è±¡å¤´ï¼Œå¦‚æœæ˜¯æ™®é€šå¯¹è±¡çš„è¯ï¼Œè™šæ‹Ÿæœºç”¨2å­—å®½å­˜å‚¨å¯¹è±¡å¤´(32/64bit + 32/64bit)ã€‚\n32ä½çš„å­—å®½ä¸º32bitï¼Œ64ä½çš„å­—å®½ä½64bit\nä¼˜åŒ–åsynchronizedé”çš„åˆ†ç±» # çº§åˆ«ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼šæ— é”çŠ¶æ€ -\u0026gt; åå‘é”çŠ¶æ€ -\u0026gt; è½»é‡çº§é”çŠ¶æ€ -\u0026gt; é‡é‡çº§é”çŠ¶æ€\né”å¯ä»¥å‡çº§ï¼Œä½†ä¸èƒ½é™çº§ï¼Œå³é¡ºåºä¸ºå•å‘\nä¸‹é¢ä»¥32ä½ç³»ç»Ÿä¸ºä¾‹ï¼Œæ¯ä¸ªé”çŠ¶æ€ä¸‹ï¼Œæ¯ä¸ªå­—å®½ä¸­çš„å†…å®¹\næ— é”çŠ¶æ€\n25bit 4bit 1bit(æ˜¯å¦æ˜¯åå‘é”) 2bit(é”æ ‡å¿—ä½) å¯¹è±¡çš„hashCode å¯¹è±¡åˆ†ä»£å¹´é¾„ 0 01 è¿™é‡Œçš„ hashCode æ˜¯ Object#hashCode æˆ–è€… System#identityHashCode è®¡ç®—å‡ºæ¥çš„å€¼ï¼Œä¸æ˜¯ç”¨æˆ·è¦†ç›–äº§ç”Ÿçš„ hashCodeã€‚\nåå‘é”çŠ¶æ€\n25bit 4bit 1bit(æ˜¯å¦æ˜¯åå‘é”) 2bit(é”æ ‡å¿—ä½) çº¿ç¨‹ID epoch 1 01 è¿™é‡Œ çº¿ç¨‹ID å’Œ epoch å ç”¨äº† hashCode çš„ä½ç½®ï¼Œæ‰€ä»¥ï¼Œå¦‚æœå¯¹è±¡å¦‚æœè®¡ç®—è¿‡ identityHashCode åï¼Œä¾¿æ— æ³•è¿›å…¥åå‘é”çŠ¶æ€ï¼Œåè¿‡æ¥ï¼Œå¦‚æœå¯¹è±¡å¤„äºåå‘é”çŠ¶æ€ï¼Œå¹¶ä¸”éœ€è¦è®¡ç®—å…¶ identityHashCode çš„è¯ï¼Œåˆ™åå‘é”ä¼šè¢«æ’¤é”€ï¼Œå‡çº§ä¸ºé‡é‡çº§é”ã€‚ å¯¹äºåå‘é”ï¼Œå¦‚æœçº¿ç¨‹ID=0 è¡¨ç¤ºä¸ºåŠ é”\nä»€ä¹ˆæ—¶å€™ä¼šè®¡ç®— HashCode å‘¢ï¼Ÿæ¯”å¦‚ï¼šå°†å¯¹è±¡ä½œä¸º Map çš„ Key æ—¶ä¼šè‡ªåŠ¨è§¦å‘è®¡ç®—ï¼ŒList å°±ä¸ä¼šè®¡ç®—ï¼Œæ—¥å¸¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ŒæŒä¹…åŒ–åˆ°åº“é‡Œï¼Œè¿›è¡Œ json åºåˆ—åŒ–ï¼Œæˆ–è€…ä½œä¸ºä¸´æ—¶å¯¹è±¡ç­‰ï¼Œè¿™äº›æƒ…å†µä¸‹ï¼Œå¹¶ä¸ä¼šè§¦å‘è®¡ç®— hashCodeï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æƒ…å†µä¸ä¼šè§¦å‘è®¡ç®— hashCodeã€‚\nIdentity hash codeæ˜¯æœªè¢«è¦†å†™çš„ java.lang.Object.hashCode() æˆ–è€… java.lang.System.identityHashCode(Object) æ‰€è¿”å›çš„å€¼ã€‚\nè½»é‡çº§é”çŠ¶æ€\n30bit 2bit æŒ‡å‘ çº¿ç¨‹æ ˆ é”è®°å½•çš„æŒ‡é’ˆ 00 è¿™é‡ŒæŒ‡å‘æ ˆå¸§ä¸­çš„LockRecordè®°å½•ï¼Œé‡Œé¢å½“ç„¶å¯ä»¥è®°å½•å¯¹è±¡çš„identityHashCode\né‡é‡çº§é”çŠ¶æ€\n30bit 2bit æŒ‡å‘é”ç›‘è§†å™¨çš„æŒ‡é’ˆ 10 è¿™é‡ŒæŒ‡å‘äº†å†…å­˜ä¸­å¯¹è±¡çš„ ObjectMonitor å¯¹è±¡ï¼Œè€Œ ObectMontitor å¯¹è±¡å¯ä»¥å­˜å‚¨å¯¹è±¡çš„ identityHashCode çš„å€¼ã€‚\né”çš„å‡çº§ # åå‘é” # åå‘é”æ˜¯é’ˆå¯¹äºä¸€ä¸ªçº¿ç¨‹è€Œè¨€çš„ï¼Œçº¿ç¨‹è·å¾—é”ä¹‹åå°±ä¸ä¼šå†æœ‰è§£é”ç­‰æ“ä½œäº†ï¼Œè¿™æ ·å¯ä»¥çœç•¥å¾ˆå¤šå¼€é”€ã€‚å‡å¦‚æœ‰ä¸¤ä¸ªçº¿ç¨‹æ¥ç«äº‰è¯¥é”è¯ï¼Œé‚£ä¹ˆåå‘é”å°±å¤±æ•ˆäº†ï¼Œè¿›è€Œå‡çº§æˆè½»é‡çº§é”äº†ã€æ³¨æ„è¿™æ®µè§£é‡Šï¼Œç½‘ä¸Šå¾ˆå¤šéƒ½é”™äº†ï¼Œæ²¡æœ‰ä»€ä¹ˆCASå¤±è´¥æ‰å‡çº§ï¼Œåªè¦æœ‰çº¿ç¨‹æ¥æŠ¢ï¼Œå°±ç›´æ¥å‡çº§ä¸ºè½»é‡çº§é”ã€‘\nä¸ºä»€ä¹ˆè¦è¿™æ ·åšå‘¢ï¼Ÿå› ä¸ºç»éªŒè¡¨æ˜ï¼Œå…¶å®å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½ä¼šæ˜¯åŒä¸€ä¸ªçº¿ç¨‹è¿›å…¥åŒä¸€å—åŒæ­¥ä»£ç å—çš„ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰åå‘é”å‡ºç°çš„åŸå› ã€‚\nå¦‚æœæ”¯æŒåå‘é”ï¼ˆæ²¡æœ‰è®¡ç®— hashCodeï¼‰ï¼Œé‚£ä¹ˆåœ¨åˆ†é…(åˆ›å»º)å¯¹è±¡æ—¶ï¼Œåˆ†é…ä¸€ä¸ªå¯åå‘è€Œæœªåå‘çš„å¯¹è±¡ï¼ˆMarkWordçš„æœ€å 3 ä½ä¸º 101ï¼Œå¹¶ä¸” Thread Id å­—æ®µçš„å€¼ä¸º 0ï¼‰\n1. åå‘é”çš„åŠ é” # åå‘é”æ ‡å¿—æ˜¯æœªåå‘çŠ¶æ€ï¼Œä½¿ç”¨ CAS å°† MarkWord ä¸­çš„çº¿ç¨‹IDè®¾ç½®ä¸ºè‡ªå·±çš„çº¿ç¨‹ID\nå¦‚æœæˆåŠŸï¼Œåˆ™è·å–åå‘é”æˆåŠŸ å¦‚æœå¤±è´¥ï¼Œåˆ™è¿›è¡Œé”å‡çº§ï¼ˆä¹Ÿå°±æ˜¯è¢«åˆ«äººæŠ¢äº†ï¼Œæ²¡æŠ¢è¿‡ï¼‰ åå‘é”çŠ¶æ€æ˜¯å·²åå‘çŠ¶æ€\nMarkWordä¸­çš„çº¿ç¨‹IDæ˜¯è‡ªå·±çš„çº¿ç¨‹IDï¼Œåˆ™æˆåŠŸè·å–é”\nMarkWordä¸­çš„çº¿ç¨‹IDä¸æ˜¯è‡ªå·±çš„çº¿ç¨‹IDï¼Œåˆ™éœ€è¦è¿›è¡Œé”å‡çº§\næ³¨æ„ï¼Œè¿™é‡Œè¯´çš„é”å‡çº§ï¼Œéœ€è¦è¿›è¡Œåå‘é”çš„æ’¤é”€\n2. åå‘é”çš„æ’¤é”€ # å‰æï¼šæ’¤é”€åå‘çš„æ“ä½œéœ€è¦åœ¨å…¨å±€æ£€æŸ¥ç‚¹æ‰§è¡Œ ã€‚æˆ‘ä»¬å‡è®¾çº¿ç¨‹Aæ›¾ç»æ‹¥æœ‰é”ï¼ˆä¸ç¡®å®šæ˜¯å¦é‡Šæ”¾é”ï¼‰ï¼Œ çº¿ç¨‹Bæ¥ç«äº‰é”å¯¹è±¡ï¼Œå¦‚æœå½“çº¿ç¨‹Aä¸å†æ‹¥æœ‰é”æ—¶æˆ–è€…æ­»äº¡æ—¶ï¼Œçº¿ç¨‹Bç›´æ¥å»å°è¯•è·å¾—é”ï¼ˆæ ¹æ®æ˜¯å¦ å…è®¸é‡åå‘ï¼ˆrebiasingï¼‰ï¼Œè·å¾—åå‘é”æˆ–è€…è½»é‡çº§é”ï¼‰ï¼›å¦‚æœçº¿ç¨‹Aä»ç„¶æ‹¥æœ‰é”ï¼Œé‚£ä¹ˆé” å‡çº§ä¸ºè½»é‡çº§é”ï¼Œçº¿ç¨‹Bè‡ªæ—‹è¯·æ±‚è·å¾—é”ã€‚\nå¯¹è±¡æ˜¯ä¸å¯åå‘çŠ¶æ€ ä¸éœ€è¦æ’¤é”€\nå¯¹è±¡æ˜¯å¯åå‘çŠ¶æ€\nå¦‚æœMarkWordä¸­æŒ‡å‘çš„çº¿ç¨‹ä¸å­˜æ´» ï¼ˆè¿™é‡Œè¯´çš„æ˜¯æ‹¥æœ‰åå‘é”çš„çº¿ç¨‹æ­£å¸¸æ‰§è¡Œå®Œæ¯•åé‡Šæ”¾é”ï¼Œä¸å­˜æ´»é‚£ä¸€å®šè¦é‡Šæ”¾é”å’¯ï¼‰ å¦‚æœå…è®¸é‡åå‘ï¼ˆrebiasingï¼‰ï¼Œåˆ™é€€å›åˆ°å¯åå‘ä½†æœªåå‘çš„çŠ¶æ€ï¼›å¦‚æœä¸å…è®¸é‡åå‘ï¼Œåˆ™å˜ä¸ºæ— é”çŠ¶æ€ å¦‚æœMarkWordä¸­çš„çº¿ç¨‹ä»ç„¶å­˜æ´»ï¼ˆæ³¨æ„ï¼Œå…³æ³¨çš„æ˜¯å­˜æ´»ï¼Œä¸æ˜¯æ˜¯å¦æ‹¥æœ‰é”ï¼‰ ï¼ˆè¿™é‡Œè¯´çš„æ˜¯æ‹¥æœ‰åå‘é”çš„çº¿ç¨‹æœªæ‰§è¡Œå®Œæ¯•ä½†è¿›è¡Œäº†é”æ’¤é”€ï¼šï¼ˆåŒ…æ‹¬é‡Šæ”¾é”åŠæœªé‡Šæ”¾é”(æœ‰çº¿ç¨‹æ¥æŠ¢)ä¸¤ç§æƒ…å½¢ï¼‰ï¼‰ å¦‚æœçº¿ç¨‹IDæŒ‡å‘çš„çº¿ç¨‹ä»ç„¶æ‹¥æœ‰é”ï¼Œåˆ™**â˜…â˜…å‡çº§ä¸ºè½»é‡çº§é”ï¼ŒMarkWordå¤åˆ¶åˆ°çº¿ç¨‹æ ˆä¸­ï¼ˆå¾ˆé‡è¦ï¼‰â˜…â˜…ï¼›å¦‚æœçº¿ç¨‹IDä¸å†æ‹¥æœ‰é”**ï¼ˆé‚£ä¸ªçº¿ç¨‹å·²ç»é‡Šæ”¾äº†é”ï¼‰ï¼Œåˆ™åŒæ ·æ˜¯é€€å›åˆ°å¯åå‘(å¦‚æœå…è®¸)ä½†æœªåå‘çš„çŠ¶æ€ï¼ˆå³çº¿ç¨‹IDæœªç©ºï¼‰ï¼Œå¦‚æœä¸å…è®¸é‡åå‘ï¼Œåˆ™å˜ä¸ºæ— é”çŠ¶æ€ åå‘é”çš„æ’¤é”€æµç¨‹å¦‚å›¾ï¼š\nè½»é‡çº§é” # ä¹‹æ‰€ä»¥ç§°ä¸ºè½»é‡çº§ï¼Œæ˜¯å› ä¸ºå®ƒä»…ä»…ä½¿ç”¨CASè¿›è¡Œæ“ä½œï¼Œå®ç°è·å–é”\n1. åŠ é”æµç¨‹ # å¦‚æœçº¿ç¨‹å‘ç°å¯¹è±¡å¤´ä¸­Mark Wordå·²ç»å­˜åœ¨æŒ‡å‘è‡ªå·±æ ˆå¸§çš„æŒ‡é’ˆï¼Œå³çº¿ç¨‹å·²ç»è·å¾—è½»é‡çº§é”ï¼Œé‚£ä¹ˆåªéœ€è¦å°†0å­˜å‚¨åœ¨è‡ªå·±çš„æ ˆå¸§ä¸­ï¼ˆæ­¤è¿‡ç¨‹ç§°ä¸ºé€’å½’åŠ é”ï¼‰ï¼›åœ¨è§£é”çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°é”è®°å½•çš„å†…å®¹ä¸º0ï¼Œ é‚£ä¹ˆåªéœ€è¦ç§»é™¤æ ˆå¸§ä¸­çš„é”è®°å½•å³å¯ï¼Œè€Œä¸éœ€è¦æ›´æ–°Mark Wordã€‚\nçº¿ç¨‹å°è¯•ä½¿ç”¨ CAS å°†å¯¹è±¡å¤´ä¸­çš„ Mark Word æ›¿æ¢ä¸ºæŒ‡å‘é”è®°å½•ï¼ˆLock Recordï¼‰çš„æŒ‡é’ˆï¼ˆâ˜…å¦‚æœå½“å‰é”çš„çŠ¶æ€ä¸æ˜¯æ— é”çŠ¶æ€ï¼Œåˆ™CASå¤±è´¥â˜…å¾ˆé‡è¦ï¼Œä¸ç„¶åé¢æœ‰ä¸€å †ç–‘é—®ï¼‰ï¼Œå¦‚æœæˆåŠŸå½“å‰çº¿ç¨‹è·å¾—è½»é‡çº§é”ï¼Œ å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚ï¼ˆæˆ‘è§‰å¾—**â˜…è¿™é‡Œçš„CASï¼ŒåŸå€¼ä¸ºåŸæ¥çš„markwordï¼Œè€Œä¸æ˜¯æŒ‡å‘å…¶ä»–çº¿ç¨‹çš„çº¿ç¨‹æ ˆåœ°å€ï¼Œå¦åˆ™è¿™æ ·æ„ä¹‰å°±ä¸å¯¹äº†ï¼Œä¼šå¯¼è‡´åˆ«çš„çº¿ç¨‹æ‰§è¡Œåˆ°ä¸€åŠå¤±å»é”ã€æ³¨æ„ï¼šè¦ç»“åˆä¸‹é¢çš„æ’¤é”€æµç¨‹çœ‹ï¼Œé”æ˜¯ä¸ä¼šé™çº§çš„ï¼Œä½†æ˜¯ä¼šæ’¤é”€ã€‚æ’¤é”€åå¯¹è±¡å¤´å°±å˜ä¸ºåŠ é”å‰äº†(ä½†ä¸æ˜¯01å“¦ï¼Œè½»é‡çº§é”æ˜¯00)ã€‘â˜…**ï¼‰\nå¦‚æœæˆåŠŸï¼Œå½“å‰çº¿ç¨‹è·å¾—è½»é‡çº§é” å¦‚æœå¤±è´¥ï¼Œè™šæ‹Ÿæœºå…ˆæ£€æŸ¥å½“å‰å¯¹è±¡å¤´çš„ Mark Word æ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§ å¦‚æœæŒ‡å‘ï¼Œåˆ™è¯´æ˜å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œåˆ™å¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å— æ‰§è¡Œæ“ä½œ å¦åˆ™è¡¨ç¤ºå…¶ä»–çº¿ç¨‹ç«äº‰é”ï¼Œå½“å‰çº¿ç¨‹ä¾¿å°è¯•ä½¿ç”¨è‡ªæ—‹æ¥è·å–é”ã€‚å½“ç«äº‰çº¿ç¨‹çš„è‡ªæ—‹æ¬¡æ•° è¾¾åˆ°ç•Œé™å€¼ï¼ˆthresholdï¼‰ï¼Œè½»é‡çº§é”å°†ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚ 2. æ’¤é”€æµç¨‹ # è½»é‡çº§é”è§£é”æ—¶ï¼Œå¦‚æœå¯¹è±¡çš„Mark Wordä»ç„¶æŒ‡å‘ç€çº¿ç¨‹çš„é”è®°å½•ï¼ˆLockRecordï¼‰ï¼Œä¼šä½¿ç”¨CASæ“ä½œï¼Œ å°†Dispalced Mark Wordæ›¿æ¢åˆ°å¯¹è±¡å¤´ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰ç«äº‰å‘ç”Ÿã€‚å¦‚æœå¤±è´¥ï¼Œ è¡¨ç¤ºå½“å‰é”å­˜åœ¨é”ç«äº‰ï¼Œé”å°±ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚\né‡é‡çº§é” # é‡é‡çº§é”ï¼ˆheavy weight lockï¼‰ï¼Œæ˜¯ä½¿ç”¨æ“ä½œç³»ç»Ÿäº’æ–¥é‡ï¼ˆmutexï¼‰æ¥å®ç°çš„ä¼ ç»Ÿé”ã€‚ å½“æ‰€æœ‰å¯¹é”çš„ä¼˜åŒ–éƒ½å¤±æ•ˆæ—¶ï¼Œå°†é€€å›åˆ°é‡é‡çº§é”ã€‚å®ƒä¸è½»é‡çº§é”ä¸åŒç«äº‰çš„çº¿ç¨‹ä¸å†é€šè¿‡è‡ªæ—‹æ¥ç«äº‰çº¿ç¨‹ï¼Œ è€Œæ˜¯ç›´æ¥è¿›å…¥å µå¡çŠ¶æ€ï¼Œæ­¤æ—¶ä¸æ¶ˆè€—CPUï¼Œç„¶åç­‰æ‹¥æœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”åï¼Œå”¤é†’å µå¡çš„çº¿ç¨‹ï¼Œ ç„¶åçº¿ç¨‹å†æ¬¡ç«äº‰é”ã€‚ä½†æ˜¯æ³¨æ„ï¼Œå½“é”è†¨èƒ€ï¼ˆinflateï¼‰ä¸ºé‡é‡é”æ—¶ï¼Œå°±ä¸èƒ½å†é€€å›åˆ°è½»é‡çº§é”ã€‚\næ€»ç»“ # é¦–å…ˆè¦æ˜ç¡®ä¸€ç‚¹æ˜¯å¼•å…¥è¿™äº›é”æ˜¯ä¸ºäº†æé«˜è·å–é”çš„æ•ˆç‡, è¦æ˜ç™½æ¯ç§é”çš„ä½¿ç”¨åœºæ™¯, æ¯”å¦‚åå‘é”é€‚åˆä¸€ä¸ªçº¿ç¨‹å¯¹ä¸€ä¸ªé”çš„å¤šæ¬¡è·å–çš„æƒ…å†µ; è½»é‡çº§é”é€‚åˆé”æ‰§è¡Œä½“æ¯”è¾ƒç®€å•(å³å‡å°‘é”ç²’åº¦æˆ–æ—¶é—´), è‡ªæ—‹ä¸€ä¼šå„¿å°±å¯ä»¥æˆåŠŸè·å–é”çš„æƒ…å†µ.\nè¦æ˜ç™½MarkWordä¸­çš„å†…å®¹è¡¨ç¤ºçš„å«ä¹‰.\n"},{"id":137,"href":"/zh/docs/study/Review/java_guide/java/Concurrent/lock_escalation_deprecated2/","title":"(è¯¥æ–‡å¼ƒç”¨)é”å‡çº§","section":"å¹¶å‘","content":"æœ¬æ–‡ä¸»è¦è®²è§£synchronizedåŸç†å’Œåå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”çš„å‡çº§è¿‡ç¨‹ï¼ŒåŸºæœ¬éƒ½è½¬è‡ª\nhttps://blog.csdn.net/MariaOzawa/article/details/107665689 åŸä½œè€…:MariaOzawa\nç®€ä»‹ # ä¸ºä»€ä¹ˆéœ€è¦é”\nå¹¶å‘ç¼–ç¨‹ä¸­ï¼Œå¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€å…±äº«èµ„æºæ—¶ï¼Œå¿…é¡»è€ƒè™‘å¦‚ä½•ç»´æŠ¤æ•°æ®çš„åŸå­æ€§ å†å² JDK1.5ä¹‹å‰ï¼ŒJavaä¾é Synchronizedå…³é”®å­—å®ç°é”åŠŸèƒ½ï¼ŒSynchronizedæ˜¯Jvmå®ç°çš„å†…ç½®é”ï¼Œé”çš„è·å–ä¸é‡Šæ”¾ç”±JVMéšå¼å®ç° JDK1.5ï¼Œå¹¶å‘åŒ…æ–°å¢Lockæ¥å£å®ç°é”åŠŸèƒ½ï¼Œæä¾›åŒæ­¥åŠŸèƒ½ï¼Œä½¿ç”¨æ—¶æ˜¾å¼è·å–å’Œé‡Šæ”¾é” åŒºåˆ« LockåŒæ­¥é”åŸºäºJavaå®ç°ï¼ŒSynchronizedåŸºäºåº•å±‚æ“ä½œç³»ç»Ÿçš„MutexLockå®ç° /ËˆmjuËtÉ›ks/ ï¼Œæ¯æ¬¡è·å–å’Œé‡Šæ”¾é”éƒ½ä¼šå¸¦æ¥ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢ï¼Œä»è€Œå¢åŠ ç³»ç»Ÿæ€§èƒ½å¼€é”€ï¼Œæ€§èƒ½ç³Ÿç³•ï¼Œåˆç§°é‡é‡çº§é” JDK1.6ä¹‹åï¼Œå¯¹SynchronizedåŒæ­¥é”åšäº†å……åˆ†ä¼˜åŒ– SynchronizedåŒæ­¥é”å®ç°åŸç† # Synchronizedå®ç°åŒæ­¥é”çš„ä¸¤ç§æ–¹å¼ï¼šä¿®é¥°æ–¹æ³•ï¼›ä¿®é¥°æ–¹æ³•å—\n// å…³é”®å­—åœ¨å®ä¾‹æ–¹æ³•ä¸Šï¼Œé”ä¸ºå½“å‰å®ä¾‹ public synchronized void method1() { // code } // å…³é”®å­—åœ¨ä»£ç å—ä¸Šï¼Œé”ä¸ºæ‹¬å·é‡Œé¢çš„å¯¹è±¡ public void method2() { Object o = new Object(); synchronized (o) { // code } } è¿™é‡Œä½¿ç”¨ç¼–è¯‘\u0026ndash;åŠjavap æ‰“å°å­—èŠ‚æ–‡ä»¶\njavac -encoding UTF-8 SyncTest.java //å…ˆè¿è¡Œç¼–è¯‘classæ–‡ä»¶å‘½ä»¤ javap -v SyncTest.class //å†é€šè¿‡javapæ‰“å°å‡ºå­—èŠ‚æ–‡ä»¶ ç»“æœå¦‚ä¸‹ï¼ŒSynchronizedä¿®é¥°ä»£ç å—æ—¶ï¼Œç”±monitorenterå’ŒmonitorexistæŒ‡ä»¤å®ç°åŒæ­¥ã€‚è¿›å…¥monitorenteræŒ‡ä»¤åçº¿ç¨‹æŒæœ‰Monitorå¯¹è±¡ï¼›é€€å‡ºmonitorenteræŒ‡ä»¤åï¼Œçº¿ç¨‹é‡Šæ”¾è¯¥Monitorå¯¹è±¡\npublic void method2(); descriptor: ()V flags: ACC_PUBLIC Code: stack=2, locals=4, args_size=1 0: new #2 3: dup 4: invokespecial #1 7: astore_1 8: aload_1 9: dup 10: astore_2 11: monitorenter //monitorenter æŒ‡ä»¤ 12: aload_2 13: monitorexit //monitorexit æŒ‡ä»¤ 14: goto 22 17: astore_3 18: aload_2 19: monitorexit 20: aload_3 21: athrow 22: return Exception table: from to target type 12 14 17 any 17 20 17 any LineNumberTable: line 18: 0 line 19: 8 line 21: 12 line 22: 22 StackMapTable: number_of_entries = 2 frame_type = 255 /* full_frame */ offset_delta = 17 locals = [ class com/demo/io/SyncTest, class java/lang/Object, class java/lang/Object ] stack = [ class java/lang/Throwable ] frame_type = 250 /* chop */ offset_delta = 4 å¦‚æœSynchronizedä¿®é¥°åŒæ­¥æ–¹æ³•ï¼Œä»£æ›¿monitorenterå’Œmonitorexitçš„æ˜¯ ACC_SYNCHRONIZEDæ ‡å¿—ï¼Œå³ï¼šJVMä½¿ç”¨è¯¥è®¿é—®æ ‡å¿—åŒºåˆ†æ–¹æ³•æ˜¯å¦ä¸ºåŒæ­¥æ–¹æ³•ã€‚æ–¹æ³•è°ƒç”¨æ—¶ï¼Œè°ƒç”¨æŒ‡ä»¤æ£€æŸ¥æ˜¯å¦è®¾ç½®ACC_SYNCHRONIZEDæ ‡å¿—ï¼Œå¦‚æœ‰ï¼Œåˆ™æ‰§è¡Œçº¿ç¨‹å…ˆæŒæœ‰è¯¥Monitorå¯¹è±¡ï¼Œå†æ‰§è¡Œè¯¥æ–¹æ³•ï¼›è¿è¡ŒæœŸé—´ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è·å–åˆ°è¯¥Monitorå¯¹è±¡ï¼›æ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œé‡Šæ”¾è¯¥Monitorå¯¹è±¡ javap -v xx.class å­—èŠ‚æ–‡ä»¶æŸ¥çœ‹\npublic synchronized void method1(); descriptor: ()V flags: ACC_PUBLIC, ACC_SYNCHRONIZED // ACC_SYNCHRONIZED æ ‡å¿— Code: stack=0, locals=1, args_size=1 0: return LineNumberTable: line 8: 0 Monitorï¼šJVMä¸­çš„åŒæ­¥æ˜¯åŸºäºè¿›å…¥å’Œé€€å‡ºç®¡ç¨‹ï¼ˆMonitorï¼‰å¯¹è±¡å®ç°çš„ã€‚æ¯ä¸ªå¯¹è±¡å®ä¾‹éƒ½ä¼šæœ‰ä¸€ä¸ªMonitorï¼ŒMonitorå¯ä»¥å’Œå¯¹è±¡ä¸€èµ·åˆ›å»ºã€é”€æ¯ã€‚Monitorç”±ObjectMonitorå®ç°ï¼Œè€ŒObjectMonitorç”±C++çš„ObjectMonitor.hppæ–‡ä»¶å®ç°ï¼Œå¦‚ä¸‹ï¼š\nObjectMonitor() { _header = NULL; _count = 0; //è®°å½•ä¸ªæ•° _waiters = 0, _recursions = 0; _object = NULL; _owner = NULL; _WaitSet = NULL; //å¤„äºwaitçŠ¶æ€çš„çº¿ç¨‹ï¼Œä¼šè¢«åŠ å…¥åˆ°_WaitSet _WaitSetLock = 0 ; _Responsible = NULL ; _succ = NULL ; _cxq = NULL ; FreeNext = NULL ; _EntryList = NULL ; //å¤„äºç­‰å¾…é”blockçŠ¶æ€çš„çº¿ç¨‹ï¼Œä¼šè¢«åŠ å…¥åˆ°è¯¥åˆ—è¡¨(Contention Listä¸­é‚£äº›æœ‰èµ„æ ¼æˆä¸ºå€™é€‰èµ„æºçš„çº¿ç¨‹è¢«ç§»åŠ¨åˆ°Entry Listä¸­ï¼›) _SpinFreq = 0 ; _SpinClock = 0 ; OwnerIsThread = 0 ; } //Contention Listï¼šç«äº‰é˜Ÿåˆ—ï¼Œæ‰€æœ‰è¯·æ±‚é”çš„çº¿ç¨‹é¦–å…ˆè¢«æ”¾åœ¨è¿™ä¸ªç«äº‰é˜Ÿåˆ—ä¸­ å¦‚ä¸Šï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€æ®µåŒæ­¥ä»£ç æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹ä¼šå…ˆè¢«å­˜æ”¾åœ¨ContentionListå’Œ**_EntryList**é›†åˆä¸­ï¼Œå¤„äºblockçŠ¶æ€çš„çº¿ç¨‹éƒ½ä¼šåŠ å…¥è¯¥åˆ—è¡¨ã€‚ å½“çº¿ç¨‹è·å–åˆ°å¯¹è±¡çš„Monitoræ—¶ï¼ŒMonitorä¾é åº•å±‚æ“ä½œç³»ç»Ÿçš„MutexLockå®ç°äº’æ–¥ï¼Œçº¿ç¨‹ç”³è¯·MutexæˆåŠŸï¼Œåˆ™æŒæœ‰è¯¥Mutexï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è·å–ï¼›ç«äº‰å¤±è´¥çš„çº¿ç¨‹å†æ¬¡è¿›å…¥ContentionListè¢«æŒ‚èµ· å¦‚æœçº¿ç¨‹è°ƒç”¨wait()æ–¹æ³•ï¼Œåˆ™ä¼šé‡Šæ”¾å½“å‰æŒæœ‰çš„Mutexï¼Œå¹¶ä¸”è¯¥çº¿ç¨‹è¿›å…¥WaitSeté›†åˆä¸­ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡è¢«å”¤é†’ï¼ˆæˆ–è€…é¡ºåˆ©æ‰§è¡Œå®Œæ–¹æ³•ä¹Ÿä¼šé‡Šæ”¾Mutexï¼‰ é”å‡çº§ # ä¸ºäº†æå‡æ€§èƒ½ï¼ŒJava1.6ï¼Œå¼•å…¥äº†åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ï¼Œæ¥å‡å°‘é”ç«äº‰å¸¦æ¥çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œç”±æ–°å¢çš„Javaå¯¹è±¡å¤´å®ç°äº†é”å‡çº§ã€‚é”åªèƒ½å‡çº§ä¸èƒ½é™çº§ï¼Œç›®çš„æ˜¯æé«˜è·å¾—é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡ å½“Javaå¯¹è±¡è¢«Synchronizedå…³é”®å­—ä¿®é¥°ä¸ºåŒæ­¥é”åï¼Œå›´ç»•è¿™ä¸ªé”çš„ä¸€ç³»åˆ—å‡çº§æ“ä½œéƒ½å’ŒJavaå¯¹è±¡å¤´æœ‰å…³ JDK1.6 JVMä¸­ï¼Œå¯¹è±¡å®ä¾‹åœ¨å †å†…å­˜ä¸­è¢«åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šå¯¹è±¡å¤´ã€å®ä¾‹æ•°æ®å’Œå¯¹é½å¡«å……ã€‚å…¶ä¸­å¯¹è±¡å¤´ç”±MarkWordã€æŒ‡å‘ç±»çš„æŒ‡é’ˆä»¥åŠæ•°ç»„é•¿åº¦ä¸‰éƒ¨åˆ†ç»„æˆ MarkWordè®°å½•äº†å¯¹è±¡å’Œé”ç›¸å…³çš„ä¿¡æ¯ï¼Œå®ƒåœ¨64ä¸ºJVMçš„é•¿åº¦æ˜¯64bitï¼Œä¸‹å›¾ä¸º64ä½JVMçš„å­˜å‚¨ç»“æ„ï¼š 32ä½å¦‚ä¸‹ é”æ ‡å¿—ä½æ˜¯ä¸¤ä½ï¼Œæ— é”å’Œåå‘é”çš„é”æ ‡å¿—ä½å®é™…ä¸º01ï¼Œè½»é‡çº§é”çš„é”æ ‡å¿—ä½ä¸º00 é”å‡çº§åŠŸèƒ½ï¼Œä¸»è¦ä¾èµ–äºMarkWordä¸­çš„é”æ ‡å¿—ä½å’Œé‡Šæ”¾åå‘é”æ ‡å¿—ä½ï¼ŒSynchronizedåŒæ­¥é”ï¼Œæ˜¯ä»åå‘é”å¼€å§‹çš„ï¼Œéšç€ç«äº‰è¶Šæ¥è¶Šæ¿€çƒˆï¼Œåå‘é”å‡çº§åˆ°è½»é‡çº§é”ï¼Œæœ€ç»ˆå‡çº§åˆ°é‡é‡çº§é” =================================ä»è¿™ä¹‹åå¾€ä¸‹ï¼Œæ˜¯æœ‰è¯¯çš„çš„============================= # åå‘é” # JVMä¼šä¸ºæ¯ä¸ªå½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­ï¼Œåˆ›å»ºç”¨äºå­˜å‚¨é”è®°å½•çš„ç©ºé—´ï¼Œå®˜æ–¹ç§°ä¸ºDisplaced Mark Wordï¼ˆè½»é‡çº§é”ä¼šç”¨åˆ°ï¼‰\nä¸ºä»€ä¹ˆå¼•å…¥åå‘é”\nå¤šæ•°æƒ…å†µï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œä¸”ç»å¸¸ç”±åŒä¸€çº¿ç¨‹è·å¾—ï¼Œä¸ºäº†åœ¨è¿™ç§æƒ…å†µè®©çº¿ç¨‹è·å¾—é”çš„ä»£ä»·æ›´ä½è€Œå¼•å…¥äº†åå‘é”ã€‚ä¾‹å¦‚ï¼šçº¿ç¨‹æ“ä½œä¸€ä¸ªçº¿ç¨‹å®‰å…¨é›†åˆæ—¶ï¼ŒåŒä¸€çº¿ç¨‹æ¯æ¬¡éƒ½éœ€è¦è·å–å’Œé‡Šæ”¾é”ï¼Œåˆ™æ¯æ¬¡æ“ä½œéƒ½ä¼šå‘ç”Ÿç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢ï¼ˆé‡é‡çº§é”ï¼‰\nè§£å†³æ–¹æ¡ˆï¼ˆåå‘é”çš„ä½œç”¨ï¼‰\nå½“ä¸€ä¸ªçº¿ç¨‹å†æ¬¡è®¿é—®è¿™ä¸ªåŒæ­¥ä»£ç æˆ–æ–¹æ³•æ—¶ï¼Œè¯¥çº¿ç¨‹åªéœ€å»å¯¹è±¡å¤´çš„MarkWordä¸­ï¼Œåˆ¤æ–­ä¸€ä¸‹æ˜¯å¦æœ‰åå‘é”æŒ‡å‘è¯¥çº¿ç¨‹çš„IDï¼Œè€Œæ— éœ€å†è¿›å…¥Monitorå»ç«äº‰å¯¹è±¡ å½“å¯¹è±¡è¢«å½“ä½œåŒæ­¥é”å¹¶æœ‰ä¸€ä¸ªçº¿ç¨‹æŠ¢åˆ°äº†é”ï¼Œé”æ ‡å¿—ä½è¿˜æ˜¯01ï¼Œæ˜¯å¦åå‘é”æ ‡å¿—ä½ä¸º1ï¼Œå¹¶ä¸”è®°å½•æŠ¢åˆ°é”çš„çº¿ç¨‹IDï¼Œè¡¨ç¤ºè¿›å…¥åå‘é”çŠ¶æ€ åå‘é”çš„æ’¤é”€ ä¸€æ—¦å‡ºç°å…¶ä»–çº¿ç¨‹ç«äº‰é”èµ„æºï¼ˆç«äº‰ä¸”CASå¤±è´¥ï¼‰æ—¶ï¼Œåå‘é”å°±ä¼šè¢«æ’¤é”€ã€‚åå‘é”çš„æ’¤é”€éœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹ï¼Œæš‚åœæŒæœ‰è¯¥é”çš„çº¿ç¨‹ï¼ŒåŒæ—¶æ£€æŸ¥è¯¥çº¿ç¨‹æ˜¯å¦è¿˜åœ¨æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå¦‚æœæ˜¯å‡çº§é”ï¼Œåä¹‹(è¯¥é”)è¢«å…¶ä»–çº¿ç¨‹æŠ¢å \næ³¨ï¼šå¯¹äºâ€œCASæ“ä½œæ›¿æ¢çº¿ç¨‹IDâ€è¿™ä¸ªè§£é‡Šï¼Œæˆ‘çš„ç†è§£æ˜¯ï¼š\nåå‘é”æ˜¯ä¸ä¼šè¢«ä¸»åŠ¨é‡Šæ”¾çš„ åå‘é”é»˜è®¤å¼€å¯ï¼ˆJDK15é»˜è®¤å…³é—­)ï¼Œå¦‚æœåº”ç”¨ç¨‹åºé‡Œæ‰€æœ‰çš„é”é€šå¸¸æƒ…å†µä¸‹å¤„äºç«äº‰çŠ¶æ€ï¼Œæ­¤æ—¶å¯ä»¥æ·»åŠ JVMå‚æ•°å…³é—­åå‘é”æ¥è°ƒä¼˜ç³»ç»Ÿæ€§èƒ½\n-XX:-UseBiasedLocking //å…³é—­åå‘é”ï¼ˆé»˜è®¤æ‰“å¼€ï¼‰ è½»é‡çº§é” # ä½•æ—¶å‡çº§ä¸ºè½»é‡çº§é” å½“æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹è·å–è¿™ä¸ªé”ï¼Œç”±äºè¯¥é”å·²ç»æ˜¯åå‘é”ï¼Œå½“å‘ç°å¯¹è±¡å¤´MarkWordä¸­çš„çº¿ç¨‹IDä¸æ˜¯è‡ªå·±çš„çº¿ç¨‹IDï¼Œå°±ä¼šè¿›è¡ŒCASæ“ä½œè·å–é” å¦‚æœè·å–æˆåŠŸï¼Œç›´æ¥æ›¿æ¢MarkWordä¸­çš„çº¿ç¨‹IDä¸ºè‡ªå·±IDï¼Œè¯¥é”æŠŠæŒåå‘é”çŠ¶æ€ å¦‚æœè·å–å¤±è´¥ï¼Œä»£è¡¨å½“å‰é”æœ‰ä¸€å®šçš„ç«äº‰ï¼Œåå‘é”å°†å‡çº§ä¸ºè½»é‡çº§é” é€‚ç”¨åœºæ™¯ **â€ç»å¤§éƒ¨åˆ†çš„é”ï¼Œåœ¨æ•´ä¸ªåŒæ­¥å‘¨æœŸå†…éƒ½ä¸å­˜åœ¨é•¿æ—¶é—´çš„ç«äº‰â€œ**çš„åœºæ™¯ "},{"id":138,"href":"/zh/docs/problem/Linux/20221101/","title":"post","section":"Linux","content":" åœ¨å®‰è£…å¯è§†åŒ–çš„æ—¶å€™ï¼Œå‡ºç°éœ€è¦libmysqlclient.so.18()(64bit)è§£å†³æ–¹æ¡ˆ\nå°†mysqlå¸è½½å³å¯ http://wenfeifei.com/art/detail/yGM1BG4\n"},{"id":139,"href":"/zh/docs/study/Review/java_guide/java/Concurrent/lock_escalation_deprecated/","title":"(è¯¥æ–‡å¼ƒç”¨)é”å‡çº§","section":"å¹¶å‘","content":" ç®€ä»‹ # æ— é” =\u0026gt; åå‘é” =\u0026gt; è½»é‡é” =\u0026gt; é‡é‡é”\nå¤ä¹ Classç±»é”å’Œå®ä¾‹å¯¹è±¡é”ï¼Œè¯´æ˜Classç±»é”å’Œå®ä¾‹å¯¹è±¡é”ä¸æ˜¯åŒä¸€æŠŠé”ï¼Œäº’ç›¸ä¸å½±å“\npublic static void main(String[] args) throws InterruptedException { Object object=new Object(); new Thread(()-\u0026gt;{ synchronized (Customer.class){ System.out.println(Thread.currentThread().getName()+\u0026#34;Object.classç±»é”\u0026#34;); try { TimeUnit.SECONDS.sleep(5); } catch (InterruptedException e) { e.printStackTrace(); } } System.out.println(Thread.currentThread().getName()+\u0026#34;ç»“æŸå¹¶é‡Šæ”¾é”\u0026#34;); },\u0026#34;çº¿ç¨‹1\u0026#34;).start(); //ä¿è¯çº¿ç¨‹1å·²ç»è·å¾—ç±»é” try { TimeUnit.SECONDS.sleep(2); } catch (InterruptedException e) { e.printStackTrace(); } new Thread(()-\u0026gt;{ synchronized (object){ System.out.println(Thread.currentThread().getName()+\u0026#34;è·å¾—objectå®ä¾‹å¯¹è±¡é”\u0026#34;); } System.out.println(Thread.currentThread().getName()+\u0026#34;ç»“æŸå¹¶é‡Šæ”¾é”\u0026#34;); },\u0026#34;çº¿ç¨‹2\u0026#34;).start(); } /* è¾“å‡º çº¿ç¨‹1Object.classç±»é” çº¿ç¨‹2è·å¾—objectå®ä¾‹å¯¹è±¡é” çº¿ç¨‹2ç»“æŸå¹¶é‡Šæ”¾é” çº¿ç¨‹1ç»“æŸå¹¶é‡Šæ”¾é” */ æ€»ç»“å›¾ , 00 , 01 , 10 ï¼Œæ²¡æœ‰11\n001ï¼ˆæ— é”ï¼‰å’Œ101ï¼ˆåå‘é”ï¼‰ï¼Œ00ï¼ˆè½»é‡çº§é”ï¼‰ï¼Œ10ï¼ˆé‡é‡çº§é”ï¼‰\nèƒŒæ™¯ # ä¸‹é¢è¿™éƒ¨åˆ†ï¼Œå…¶å®åœ¨ioæ¨¡å—æœ‰æåˆ°è¿‡\nä¸ºäº†ä¿è¯ç³»ç»Ÿç¨³å®šæ€§å’Œå®‰å…¨æ€§ï¼Œä¸€ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´åˆ’åˆ†ä¸ºç”¨æˆ·ç©ºé—´User spaceå’Œå†…æ ¸ç©ºé—´Kernel space å¹³å¸¸è¿è¡Œçš„åº”ç”¨ç¨‹åºéƒ½è¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´ï¼Œåªæœ‰å†…æ ¸ç©ºé—´æ‰èƒ½è¿›è¡Œç³»ç»Ÿæ€çº§åˆ«çš„èµ„æºæœ‰å…³æ“ä½œ\u0026mdash;æ–‡ä»¶ç®¡ç†ã€è¿›ç¨‹é€šä¿¡ã€å†…å­˜ç®¡ç† å¦‚æœç›´æ¥synchronizedåŠ é”ï¼Œä¼šæœ‰ä¸‹é¢å›¾çš„æµç¨‹å‡ºç°ï¼Œé¢‘ç¹è¿›è¡Œç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢(é˜»å¡å’Œå”¤é†’çº¿ç¨‹[çº¿ç¨‹é€šä¿¡]ï¼Œéœ€è¦é¢‘ç¹åˆ‡æ¢cpuçš„çŠ¶æ€)\nä¸ºä»€ä¹ˆæ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥æˆä¸ºä¸€ä¸ªé” markOop.hpp ï¼ˆå¯¹åº”å¯¹è±¡æ ‡è¯†ï¼‰ æ¯ä¸€ä¸ªjavaå¯¹è±¡é‡Œé¢ï¼Œæœ‰ä¸€ä¸ªMonitorå¯¹è±¡ï¼ˆObjectMonitor.cpp)å…³è” å¦‚å›¾ï¼Œ_owneræŒ‡å‘æŒæœ‰ObjectMonitorå¯¹è±¡çš„çº¿ç¨‹ Monitoræœ¬è´¨ä¾èµ–äºåº•å±‚æ“ä½œç³»ç»Ÿçš„MutexLockå®ç°ï¼Œæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢ï¼Œéœ€è¦ä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢ï¼Œæˆæœ¬æé«˜ â˜…â˜… é‡ç‚¹ï¼šMonitorä¸Javaå¯¹è±¡ä»¥åŠçº¿ç¨‹æ˜¯å¦‚ä½•å…³è” å¦‚æœä¸€ä¸ªjavaå¯¹è±¡è¢«æŸä¸ªçº¿ç¨‹é”ä½ï¼Œåˆ™è¯¥å¯¹è±¡çš„MarkWordå­—æ®µä¸­ï¼ŒLockWordæŒ‡å‘monitorçš„èµ·å§‹åœ°å€ï¼ˆè¿™é‡Œè¯´çš„åº”è¯¥æ˜¯é‡é‡çº§é”ï¼‰ Monitorçš„Ownerå­—æ®µä¼šå­˜æ”¾æ‹¥æœ‰ç›¸å…³è”å¯¹è±¡é”çš„çº¿ç¨‹id å›¾ é”å‡çº§ # synchronizedç”¨çš„é”ï¼Œå­˜åœ¨Javaå¯¹è±¡å¤´é‡Œçš„MarkWordä¸­ï¼Œé”å‡çº§åŠŸèƒ½ä¸»è¦ä¾èµ–MarkWordä¸­é”æ ‡å¿—ä½(å2ä½)å’Œé‡Šæ”¾åå‘é”æ ‡å¿—ä½(æ— é”å’Œåå‘é”ï¼Œå€’æ•°ç¬¬3ä½)\nå¯¹äºé”çš„æŒ‡å‘\næ— é”æƒ…å†µï¼šï¼ˆæ”¾hashcode(è°ƒç”¨äº†Object.hashcodeæ‰æœ‰)) åå‘é”ï¼šMarkWordå­˜å‚¨çš„æ˜¯åå‘çš„çº¿ç¨‹ID è½»é‡é”ï¼šMarkWordå­˜å‚¨çš„æ˜¯æŒ‡å‘çº¿ç¨‹æ ˆä¸­LockRecordçš„æŒ‡é’ˆ é‡é‡é”ï¼šMarkWordå­˜å‚¨çš„æ˜¯æŒ‡å‘å †ä¸­çš„monitorå¯¹è±¡çš„æŒ‡é’ˆ =================================ä»è¿™ä¹‹åå¾€ä¸‹ï¼Œæ˜¯æœ‰è¯¯çš„çš„============================= # æ— é”çŠ¶æ€ åˆå§‹çŠ¶æ€ï¼Œä¸€ä¸ªå¯¹è±¡è¢«å®ä¾‹åŒ–åï¼Œå¦‚æœè¿˜æ²¡æœ‰ä»»ä½•çº¿ç¨‹ç«äº‰é”ï¼Œé‚£ä¹ˆå®ƒå°±ä¸ºæ— é”çŠ¶æ€ï¼ˆ001ï¼‰\npublic static void main(String[] args) { Object o = new Object(); System.out.println(ClassLayout.parseInstance(o).toPrintable()); //16å­—èŠ‚ } /* è¾“å‡º( è¿™é‡Œçš„mark,VALUEä¸º0x0000000000000001ï¼Œæ²¡æœ‰hashCodeçš„å€¼): java.lang.Object object internals: OFF SZ TYPE DESCRIPTION VALUE 0 8 (object header: mark) 0x0000000000000001 (non-biasable; age: 0) 8 4 (object header: class) 0xf80001e5 12 4 (object alignment gap) Instance size: 16 bytes Space losses: 0 bytes internal + 4 bytes external = 4 bytes total */ ä¸‹é¢æ˜¯è°ƒç”¨äº†hashCode()è¿™ä¸ªæ–¹æ³•çš„æƒ…å½¢:\npublic static void main(String[] args) { Object o = new Object(); System.out.println(Integer.toHexString(o.hashCode())); System.out.println(ClassLayout.parseInstance(o).toPrintable()); //16å­—èŠ‚ } /**è¾“å‡º: 74a14482 java.lang.Object object internals: OFF SZ TYPE DESCRIPTION VALUE 0 8 (object header: mark) 0x00000074a1448201 (hash: 0x74a14482; age: 0) 8 4 (object header: class) 0xf80001e5 12 4 (object alignment gap) Instance size: 16 bytes Space losses: 0 bytes internal + 4 bytes external = 4 bytes total */ åå‘é”ï¼šå•çº¿ç¨‹ç«äº‰\nå½“çº¿ç¨‹Aç¬¬ä¸€æ¬¡ç«äº‰åˆ°é”æ—¶ï¼Œé€šè¿‡æ“ä½œä¿®æ”¹MarkWordä¸­çš„åå‘çº¿ç¨‹IDã€åå‘æ¨¡å¼ã€‚å¦‚æœä¸å­˜åœ¨å…¶ä»–çº¿ç¨‹ç«äº‰ï¼Œé‚£ä¹ˆæŒæœ‰åå‘é”çš„çº¿ç¨‹å°†æ°¸è¿œä¸éœ€è¦åŒæ­¥\nå¦‚æœæ²¡æœ‰åå‘é”ï¼Œé‚£ä¹ˆå°±ä¼šé¢‘ç¹å‡ºç°ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢\næ„ä¹‰ï¼šå½“ä¸€æ®µåŒæ­¥ä»£ç ï¼Œä¸€ç›´è¢«åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è®¿é—®ï¼Œç”±äºåªæœ‰ä¸€ä¸ªçº¿ç¨‹é‚£ä¹ˆè¯¥çº¿ç¨‹åœ¨åç»­è®¿é—®æ—¶ä¾¿ä¼šè‡ªåŠ¨è·å¾—é” é”åœ¨ç¬¬ä¸€æ¬¡è¢«æ‹¥æœ‰çš„æ—¶å€™ï¼Œè®°å½•ä¸‹åå‘çº¿ç¨‹IDï¼ˆåç»­è¿™ä¸ªçº¿ç¨‹è¿›å…¥å’Œé€€å‡ºè¿™æ®µåŠ äº†åŒæ­¥é”çš„ä»£ç å—æ—¶ï¼Œä¸éœ€è¦å†æ¬¡åŠ é”å’Œé‡Šæ”¾é”ï¼Œåªéœ€è¦ç›´æ¥æ£€æŸ¥é”çš„MarkWordæ˜¯ä¸æ˜¯æ”¾çš„è‡ªå·±çš„çº¿ç¨‹IDï¼‰\nå¦‚æœç›¸ç­‰ï¼Œè¡¨ç¤ºåå‘é”æ˜¯åå‘äºå½“å‰çº¿ç¨‹çš„ï¼Œä¸éœ€è¦å†å°è¯•è·å¾—é”ï¼Œç›´åˆ°ç«äº‰æ‰ä¼šé‡Šæ”¾é”ï¼›ä»¥åæ¯æ¬¡åŒæ­¥ï¼Œæ£€æŸ¥é”çš„åå‘çº¿ç¨‹IDä¸å½“å‰çº¿ç¨‹IDæ˜¯å¦ä¸€è‡´ï¼Œè‹¥ä¸€è‡´åˆ™è¿›å…¥åŒæ­¥ï¼Œæ— éœ€æ¯æ¬¡éƒ½åŠ é”è§£é”å»CASæ›´æ–°å¯¹è±¡å¤´ï¼›å¦‚æœè‡ªå§‹è‡³ç»ˆä½¿ç”¨é”çš„çº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼Œå¾ˆæ˜æ˜¾åå‘é”å‡ ä¹æ²¡æœ‰é¢å¤–å¼€é”€ å¦‚æœä¸ç­‰ï¼Œè¡¨ç¤ºå‘ç”Ÿäº†ç«äº‰ï¼Œé”å·²ç»ä¸åå‘äºåŒä¸€ä¸ªçº¿ç¨‹ï¼Œæ­¤æ—¶ä¼šå°è¯•ä½¿ç”¨CASæ¥æ›¿æ¢MarkWordé‡Œé¢çš„çº¿ç¨‹IDä¸ºæ–°çº¿ç¨‹çš„ID ç«äº‰æˆåŠŸï¼Œè¯´æ˜ä¹‹å‰çº¿ç¨‹ä¸å­˜åœ¨äº†ï¼ŒMarkWordé‡Œçš„çº¿ç¨‹IDä¸ºæ–°çº¿ç¨‹IDï¼Œæ‰€ä¸ä¼šå‡çº§ï¼Œä»ç„¶ä¸ºåå‘é” ç«äº‰å¤±è´¥ï¼Œéœ€è¦å‡çº§ä¸ºè½»é‡çº§é”ï¼Œæ‰èƒ½ä¿è¯çº¿ç¨‹é—´å…¬å¹³ç«äº‰é” åå‘é”åªæœ‰é‡åˆ°å…¶ä»–çº¿ç¨‹å°è¯•ç«äº‰åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ï¼Œçº¿ç¨‹æ˜¯ä¸ä¼šä¸»åŠ¨é‡Šæ”¾é”çš„ï¼ˆå°½é‡ä¸ä¼šæ¶‰åŠç”¨æˆ·åˆ°å†…æ ¸æ€è½¬æ¢ï¼‰\nä¸€ä¸ªsynchronizedæ–¹æ³•è¢«ä¸€ä¸ªçº¿ç¨‹æŠ¢åˆ°é”æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•æ‰€åœ¨çš„å¯¹è±¡ï¼Œå°±ä¼šåœ¨å…¶æ‰€åœ¨çš„MarkWordä¸­**å°†åå‘é”ä¿®æ”¹çŠ¶æ€ä½\nå¦‚å›¾\nJVMä¸ç”¨å’Œæ“ä½œç³»ç»Ÿåå•†è®¾ç½®Mutexï¼ˆäº‰å–å†…æ ¸ï¼‰ï¼Œä¸éœ€è¦æ“ä½œç³»ç»Ÿä»‹å…¥\nåå‘é”ç›¸å…³å‚æ•°\njava -XX:+PrintFlagsInitial | grep BiasedLock* intx BiasedLockingBulkRebiasThreshold = 20 {product} intx BiasedLockingBulkRevokeThreshold = 40 {product} intx BiasedLockingDecayTime = 25000 {product} intx BiasedLockingStartupDelay = 4000 #åå‘é”å¯åŠ¨å»¶è¿Ÿ 4s {product} bool TraceBiasedLocking = false {product} bool UseBiasedLocking = true #é»˜è®¤å¼€å¯åå‘é” {product} # ä½¿ç”¨-XX:UseBiasedLocking å…³é—­åå‘é” ä¾‹å­ï¼š\npublic static void main(String[] args) throws InterruptedException { TimeUnit.SECONDS.sleep(5); //1 å¦‚æœ1è·Ÿä¸‹é¢çš„2å…‘æ¢ï¼Œåˆ™å°±ä¸æ˜¯åå‘é”ï¼Œæ˜¯å¦æ˜¯åå‘é”ï¼Œåœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œå°±å·²ç»ç¡®è®¤äº† Object o = new Object(); //2 //System.out.println(Integer.toHexString(o.hashCode())); synchronized (o){ } System.out.println(ClassLayout.parseInstance(o).toPrintable()); //16å­—èŠ‚ } //å»¶è¿Ÿ5ç§’(\u0026gt;4)åï¼Œå°±ä¼šçœ‹åˆ°åå‘é” /* æ‰“å°ï¼Œ005ï¼Œå³äºŒè¿›åˆ¶101 java.lang.Object object internals: OFF SZ TYPE DESCRIPTION VALUE 0 8 (object header: mark) 0x0000000002f93005 (biased: 0x000000000000be4c; epoch: 0; age: 0) 8 4 (object header: class) 0xf80001e5 12 4 (object alignment gap) Instance size: 16 bytes Space losses: 0 bytes internal + 4 bytes external = 4 bytes total */ åå‘é”çš„å‡çº§\næ˜¯ä¸€ç§ç­‰åˆ°ç«äº‰å‡ºç°æ‰é‡Šæ”¾é”çš„æœºåˆ¶ï¼Œåªæœ‰å½“å…¶ä»–çº¿ç¨‹ç«äº‰é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„åŸæ¥çº¿ç¨‹æ‰ä¼šè¢«æ’¤é”€ï¼›æ’¤é”€éœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹ï¼ˆè¯¥æ—¶é—´ç‚¹æ²¡æœ‰å­—èŠ‚ç åœ¨æ‰§è¡Œï¼‰ï¼ŒåŒæ—¶æ£€æŸ¥æŒæœ‰åå‘é”çš„çº¿ç¨‹æ˜¯å¦è¿˜åœ¨æ‰§è¡Œ å¦‚æœæ­¤æ—¶ç¬¬ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œsynchronizedæ–¹æ³•ï¼ˆå¤„äºåŒæ­¥å—ï¼‰ï¼Œè¿˜æ²¡æ‰§è¡Œå®Œå…¶ä»–çº¿ç¨‹æ¥æŠ¢ï¼Œè¯¥åå‘é”è¢«å–æ¶ˆå¹¶å‡ºç°é”å‡çº§ï¼›æ­¤æ—¶è½»é‡çº§é”ç”±åŸæŒæœ‰åå‘é”çš„çº¿ç¨‹æŒæœ‰ï¼Œç»§ç»­æ‰§è¡Œå…¶åŒæ­¥ä»£ç ï¼Œè€Œæ­£åœ¨ç«äº‰çš„çº¿ç¨‹ä¼šè¿›å…¥è‡ªæ—‹ç­‰å¾…è·å¾—è¯¥è½»é‡çº§é” å¦‚æœç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆsynchronizedæ–¹æ³•ï¼ˆé€€å‡ºåŒæ­¥å—ï¼‰ï¼Œè€Œå°†å¯¹è±¡å¤´è®¾ç½®æˆæ— é”çŠ¶æ€å¹¶æ’¤é”€åå‘é”ï¼Œé‡æ–°åå‘ Java15ä¹‹åï¼ŒHotSpotä¸å†é»˜è®¤å¼€å¯åå‘é”ï¼Œä½¿ç”¨+XX:UseBiasedLockingæ‰‹åŠ¨å¼€å¯\nåå‘é”æµç¨‹æ€»ç»“ (è½¬è‡ªhttps://blog.csdn.net/MariaOzawa/article/details/107665689) è½»é‡çº§é” ä¸»è¦æ˜¯ä¸ºäº†åœ¨çº¿ç¨‹è¿‘ä¹äº¤æ›¿æ‰§è¡ŒåŒæ­¥å—æ—¶æé«˜æ€§èƒ½ å‡çº§æ—¶æœºï¼Œå½“å…³é—­åå‘é”æˆ–å¤šçº¿ç¨‹ç«äº‰åå‘é”ä¼šå¯¼è‡´åå‘é”å‡çº§ä¸ºè½»é‡çº§é” æ ‡å¿—ä½ä¸º00\n"},{"id":140,"href":"/zh/docs/study/Review/java_guide/java/Concurrent/ly03121lyobject-concurrent/","title":"å¯¹è±¡å†…å­˜å¸ƒå±€å’Œå¯¹è±¡å¤´","section":"å¹¶å‘","content":" å¯¹è±¡å¸ƒå±€ # heap ï¼ˆwhereï¼‰: new (eden ,s0 ,s1) ,old, metaspace\nå¯¹è±¡çš„æ„æˆå…ƒç´ ï¼ˆwhatï¼‰ HotSpotè™šæ‹Ÿæœºé‡Œï¼Œå¯¹è±¡åœ¨å †å†…å­˜ä¸­çš„å­˜å‚¨å¸ƒå±€åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ† å¯¹è±¡å¤´ï¼ˆHeaderï¼‰ å¯¹è±¡æ ‡è®° MarkWord ç±»å…ƒä¿¡æ¯ï¼ˆç±»å‹æŒ‡é’ˆ Class Pointerï¼ŒæŒ‡å‘æ–¹æ³•åŒºçš„åœ°å€ï¼‰ å¯¹è±¡å¤´å¤šå¤§ lengthï¼ˆæ•°ç»„æ‰æœ‰ï¼‰ å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰ å¯¹å…¶å¡«å……ï¼ˆPaddingï¼Œä¿è¯æ•´ä¸ªå¯¹è±¡å¤§å°ï¼Œæ˜¯8ä¸ªå­—èŠ‚çš„å€æ•°ï¼‰ å¯¹è±¡å¤´ # å¯¹è±¡æ ‡è®°\nObject o= new Object(); //newä¸€ä¸ªå¯¹è±¡ï¼Œå å†…å­˜å¤šå°‘ o.hashCode() //hashCodeå­˜åœ¨å¯¹è±¡å“ªä¸ªåœ°æ–¹ synchronized(o){ } //å¯¹è±¡è¢«é”äº†å¤šå°‘æ¬¡ï¼ˆå¯é‡å…¥é”ï¼‰ System.gc(); //èº²è¿‡äº†å‡ æ¬¡gcï¼ˆæ¬¡æ•°ï¼‰ ä¸Šé¢è¿™äº›ï¼Œå“ˆå¸Œç ã€gcæ ‡è®°ã€gcæ¬¡æ•°ã€åŒæ­¥é”æ ‡è®°ã€åå‘é”æŒæœ‰è€…ï¼Œéƒ½ä¿å­˜åœ¨å¯¹è±¡æ ‡è®°é‡Œé¢ å¦‚æœåœ¨64ä½ç³»ç»Ÿä¸­ï¼Œå¯¹è±¡å¤´ä¸­ï¼Œ**mark wordï¼ˆå¯¹è±¡æ ‡è®°ï¼‰**å ç”¨8ä¸ªå­—èŠ‚ï¼ˆ64ä½ï¼‰ï¼›**class pointerï¼ˆç±»å…ƒä¿¡æ¯ï¼‰**å ç”¨8ä¸ªå­—èŠ‚ï¼Œæ€»å…±16å­—èŠ‚ï¼ˆå¿½ç•¥å‹ç¼©æŒ‡é’ˆï¼‰ æ— é”çš„æ—¶å€™ï¼Œ ç±»å‹æŒ‡é’ˆ æ³¨æ„ä¸‹å›¾ï¼ŒæŒ‡å‘æ–¹æ³•åŒºä¸­ï¼ˆæ¨¡æ¿ï¼‰çš„åœ°å€ å®ä¾‹æ•°æ®å’Œå¯¹é½å¡«å…… # å®ä¾‹æ•°æ®\nç”¨æ¥å­˜æ”¾ç±»çš„å±æ€§ï¼ˆFiledï¼‰æ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬çˆ¶ç±»çš„å±æ€§ä¿¡æ¯\nå¯¹é½å¡«å……\nå¡«å……åˆ°é•¿åº¦ä¸º8å­—èŠ‚ï¼Œå› ä¸ºè™šæ‹Ÿæœºè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼ˆå¯¹é½å¡«å……ä¸ä¸€å®šå­˜åœ¨ï¼‰\nç¤ºä¾‹\nclass Customer{ int id;//4å­—èŠ‚ boolean flag=false; //1å­—èŠ‚ } //Customer customer=new Customer(); //è¯¥å¯¹è±¡å¤§å°ï¼šå¯¹è±¡å¤´ï¼ˆå¯¹è±¡æ ‡è®°8+ç±»å‹æŒ‡é’ˆ8ï¼‰+å®ä¾‹æ•°æ®ï¼ˆ4+1ï¼‰=21å­—èŠ‚ ===\u0026gt; ä¸ºäº†å¯¹é½å¡«å……ï¼Œåˆ™ä¸º24å­—èŠ‚ æºç æŸ¥çœ‹ # å…·ä½“çš„ï¼ˆ64ä½è™šæ‹Ÿæœºä¸ºä¸»ï¼‰ # æ— é”å’Œåå‘é”çš„é”æ ‡å¿—ä½(æœ€å2ä½)éƒ½æ˜¯01 æ— é”çš„å€’æ•°ç¬¬3ä½ï¼Œä¸º0ï¼Œè¡¨ç¤ºéåå‘é” åå‘é”çš„å€’æ•°ç¬¬3ä½ï¼Œä¸º1ï¼Œè¡¨ç¤ºåå‘é” è½»é‡çº§é”çš„é”æ ‡å¿—ä½ï¼ˆæœ€å2ä½ï¼‰æ˜¯00 é‡é‡çº§é”çš„é”æ ‡å¿—ä½ï¼ˆæœ€å2ä½ï¼‰æ˜¯10 GCæ ‡å¿—ï¼ˆæœ€å2ä½ï¼‰æ˜¯11 å¦‚ä¸Šæ‰€ç¤ºï¼Œå¯¹è±¡åˆ†ä»£å¹´é¾„4ä½ï¼Œå³æœ€å¤§å€¼ä¸º15ï¼ˆåè¿›åˆ¶ï¼‰\næºç ä¸­\nä½¿ç”¨ä»£ç æ¼”ç¤ºä¸Šè¿°ç†è®ºï¼ˆJOL) # \u0026lt;!--å¼•å…¥ä¾èµ–ï¼Œç”¨æ¥åˆ†æå¯¹è±¡åœ¨JVMä¸­çš„å¤§å°å’Œåˆ†å¸ƒ--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.openjdk.jol\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jol-core\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.16\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; //ä½¿ç”¨\n//VMçš„ç»†èŠ‚è¯¦ç»†æƒ…å†µ System.out.println(VM.current().details()); //æ‰€æœ‰å¯¹è±¡åˆ†é…å­—èŠ‚éƒ½æ˜¯8çš„æ•´æ•°å€ System.out.println(VM.current().objectAlignment()); /* è¾“å‡ºï¼š # Running 64-bit HotSpot VM. # Using compressed oop with 3-bit shift. # Using compressed klass with 3-bit shift. # Objects are 8 bytes aligned. # Field sizes by type: 4, 1, 1, 2, 2, 4, 4, 8, 8 [bytes] # Array element sizes: 4, 1, 1, 2, 2, 4, 4, 8, 8 [bytes] 8 */ ç®€å•çš„æƒ…å½¢ æ³¨æ„ï¼Œä¸‹é¢çš„8 4 (object header: class) 0xf80001e5ï¼Œç”±äºå¼€å¯äº†ç±»å‹æŒ‡é’ˆå‹ç¼©ï¼Œåªç”¨äº†4ä¸ªå­—èŠ‚\npublic class Hello4 { public static void main(String[] args) throws InterruptedException { Object o = new Object(); System.out.println(ClassLayout.parseInstance(o).toPrintable()); //16å­—èŠ‚ Customer customer = new Customer(); System.out.println(ClassLayout.parseInstance(customer).toPrintable()); //16å­—èŠ‚ } } class Customer{ } /*è¾“å‡º java.lang.Object object internals: OFF SZ TYPE DESCRIPTION VALUE 0 8 (object header: mark) 0x0000000000000001 (non-biasable; age: 0) 8 4 (object header: class) 0xf80001e5 12 4 (object alignment gap) Instance size: 16 bytes Space losses: 0 bytes internal + 4 bytes external = 4 bytes total com.ly.Customer object internals: OFF SZ TYPE DESCRIPTION VALUE 0 8 (object header: mark) 0x0000000000000001 (non-biasable; age: 0) 8 4 (object header: class) 0xf800cc94 12 4 (object alignment gap) Instance size: 16 bytes Space losses: 0 bytes internal + 4 bytes external = 4 bytes total Process finished with exit code 0 */ å¸¦æœ‰å®ä¾‹æ•°æ®\npublic class Hello4 { public static void main(String[] args) throws InterruptedException { Customer customer = new Customer(); System.out.println(ClassLayout.parseInstance(customer).toPrintable()); //16å­—èŠ‚ } } class Customer{ private int a; private boolean b; } /*è¾“å‡º com.ly.Customer object internals: OFF SZ TYPE DESCRIPTION VALUE 0 8 (object header: mark) 0x0000000000000001 (non-biasable; age: 0) 8 4 (object header: class) 0xf800cc94 12 4 int Customer.a 0 16 1 boolean Customer.b false 17 7 (object alignment gap) Instance size: 24 bytes Space losses: 0 bytes internal + 7 bytes external = 7 bytes total */ java è¿è¡Œä¸­æ·»åŠ å‚æ•° -XX:MaxTenuringThreshold = 16 ï¼Œåˆ™ä¼šå‡ºç°ä¸‹é¢é”™è¯¯ï¼Œå³åˆ†ä»£gcæœ€å¤§å¹´é¾„ä¸º15 å‹ç¼©æŒ‡é’ˆçš„ç›¸å…³è¯´æ˜\nä½¿ç”¨ java -XX:+PrintComandLineFlags -version ï¼Œæ‰“å°å‚æ•°\nå…¶ä¸­æœ‰ä¸€ä¸ª, -XX:+UseCompressedClassPointers ï¼Œå³å¼€å¯äº†ç±»å‹æŒ‡é’ˆå‹ç¼©ï¼Œåªéœ€è¦4å­—èŠ‚\nå½“ä½¿ç”¨äº†ç±»å‹æŒ‡é’ˆå‹ç¼©ï¼ˆé»˜è®¤ï¼‰æ—¶ï¼Œä¸€ä¸ªæ— ä»»ä½•å±æ€§å¯¹è±¡æ˜¯ 8å­—èŠ‚(markWord) + 4å­—èŠ‚ï¼ˆclassPointer) + 4å­—èŠ‚(å¯¹é½å¡«å……) = 16å­—èŠ‚\nä¸‹é¢ä»£ç ï¼Œä½¿ç”¨äº† -XX:-UseCompressedClassPointersè¿›è¡Œå…³é—­å‹ç¼©æŒ‡é’ˆ ä¸€ä¸ªæ— ä»»ä½•å±æ€§å¯¹è±¡æ˜¯ 8å­—èŠ‚(markWord) + 8å­—èŠ‚ï¼ˆclassPointer) = 16å­—èŠ‚\npublic class Hello4 { public static void main(String[] args) throws InterruptedException { Object o = new Object(); System.out.println(ClassLayout.parseInstance(o).toPrintable()); //16å­—èŠ‚ //16å­—èŠ‚ } } /*è¾“å‡º java.lang.Object object internals: OFF SZ TYPE DESCRIPTION VALUE 0 8 (object header: mark) 0x0000000000000001 (non-biasable; age: 0) 8 8 (object header: class) 0x000000001dab1c00 Instance size: 16 bytes Space losses: 0 bytes internal + 0 bytes external = 0 bytes total */ "},{"id":141,"href":"/zh/docs/study/Review/java_guide/java/Concurrent/ly0302lyconcurrent-02/","title":"å¹¶å‘02","section":"å¹¶å‘","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nJMMï¼ˆJavaMemoryModel) # è¯¦è§-çŸ¥è¯†ç‚¹ volatileå…³é”®å­— # ä¿è¯å˜é‡å¯è§æ€§\nä½¿ç”¨volatileå…³é”®å­—ä¿è¯å˜é‡å¯è§æ€§ï¼Œå¦‚æœå°†å˜é‡å£°æ˜ä¸ºvolatileåˆ™æŒ‡ç¤ºJVMè¯¥å˜é‡æ˜¯å…±äº«ä¸”ä¸ç¨³å®šçš„ï¼Œæ¯æ¬¡ä½¿ç”¨å®ƒéƒ½åˆ°ä¸»å­˜ä¸­è¯»å–\nvolatileå…³é”®å­—å¹¶éJavaè¯­è¨€ç‰¹æœ‰ï¼Œåœ¨Cè¯­è¨€é‡Œä¹Ÿæœ‰ï¼Œå®ƒæœ€åŸå§‹çš„æ„ä¹‰å°±æ˜¯ç¦ç”¨CPUç¼“å­˜ã€‚\nvolatileå…³é”®å­—åªèƒ½ä¿è¯æ•°æ®å¯è§æ€§ï¼Œä¸èƒ½ä¿è¯æ•°æ®åŸå­æ€§ã€‚synchronizedå…³é”®å­—ä¸¤è€…éƒ½èƒ½ä¿è¯\nä¸å¯è§çš„ä¾‹å­\npackage com.concurrent; import java.util.concurrent.TimeUnit; public class TestLy { //å¦‚æœåŠ ä¸Švolatile,å°±èƒ½ä¿è¯å¯è§æ€§ï¼Œçº¿ç¨‹1 æ‰èƒ½åœæ­¢ boolean stop = false;//å¯¹è±¡å±æ€§ public static void main(String[] args) throws InterruptedException { TestLy atomicTest = new TestLy(); new Thread(() -\u0026gt; { while (!atomicTest.stop) { //è¿™é‡Œä¸èƒ½åŠ System.out.println ,å› ä¸ºè¿™ä¸ªæ–¹æ³•å†…éƒ¨ç”¨äº†synchronizedä¿®é¥°,ä¼šå¯¼è‡´è·å–ä¸»å†…å­˜çš„å€¼ï¼Œ //å°±æ²¡æ³•å±•ç¤ºæ•ˆæœäº† /*System.out.println(\u0026#34;1è¿˜æ²¡æœ‰åœæ­¢\u0026#34;);*/ } System.out.println(Thread.currentThread().getName()+\u0026#34;åœæ­¢äº†\u0026#34;); },\u0026#34;çº¿ç¨‹1\u0026#34;).start(); new Thread(() -\u0026gt; { try { TimeUnit.SECONDS.sleep(1); } catch (InterruptedException e) { e.printStackTrace(); } atomicTest.stop= true; System.out.println(Thread.currentThread().getName()+\u0026#34;è®©çº¿ç¨‹1åœæ­¢\u0026#34;); },\u0026#34;çº¿ç¨‹2\u0026#34;).start(); while (true){} } } å¦‚ä½•ç¦æ­¢æŒ‡ä»¤é‡æ’ ä½¿ç”¨volatileå…³é”®å­—ï¼Œé™¤äº†å¯ä»¥ä¿è¯å˜é‡çš„å¯è§æ€§ï¼Œè¿˜èƒ½é˜²æ­¢JVMæŒ‡ä»¤é‡æ’ã€‚å½“æˆ‘ä»¬å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œè¯»å†™æ“ä½œçš„æ—¶å€™ï¼Œ-ä¼šé€šè¿‡æ’å…¥ç‰¹å®šçš„å†…å­˜å±éšœæ¥ç¦æ­¢æŒ‡ä»¤é‡æ’\nJavaä¸­ï¼ŒUnsafeç±»æä¾›äº†ä¸‰ä¸ªå¼€ç®±å³ç”¨å…³äºå†…å­˜å±éšœç›¸å…³çš„æ–¹æ³•ï¼Œå±è”½äº†æ“ä½œç³»ç»Ÿåº•å±‚çš„å·®å¼‚\nå¯ä»¥ç”¨æ¥å®ç°å’Œvolatileç¦æ­¢é‡æ’åºçš„æ•ˆæœ\npublic native void loadFence(); //è¯»æŒ‡ä»¤å±éšœ public native void storeFence(); //å†™æŒ‡ä»¤å±éšœ public native void fullFence(); //è¯»å†™æŒ‡ä»¤å±éšœ ä¾‹å­ï¼ˆé€šè¿‡åŒé‡æ ¡éªŒé”å®ç°å¯¹è±¡å•ä¾‹ï¼‰ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨\npublic class Singleton { private volatile static Singleton uniqueInstance; private Singleton() { } public static Singleton getUniqueInstance() { //å…ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²ç»å®ä¾‹è¿‡ï¼Œæ²¡æœ‰å®ä¾‹åŒ–è¿‡æ‰è¿›å…¥åŠ é”ä»£ç (ç¬¬3ã€4æ¬¡ //å°±ä¸éœ€è¦å†è¿›æ¥(synchronizedäº†)) //é¿å…äº†ä¸è®ºå¦‚ä½•éƒ½è¿›è¡ŒåŠ é”çš„æƒ…å†µ if (uniqueInstance == null) { //...ä¸€äº›å…¶ä»–ä»£ç  //åŠ é”ï¼Œå¹¶åˆ¤æ–­å¦‚æœæœªåˆå§‹åŒ–åˆ™è¿›è¡Œåˆå§‹åŒ– synchronized (Singleton.class) { //åˆ«æ™•äº†ï¼Œè¿™ä¸ªæ˜¯ä¸€å®šè¦åˆ¤æ–­çš„ã€åˆ¤æ–­æ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼Œ //å¦‚æœè¿˜æœªåˆå§‹åŒ–æ‰è¿›è¡Œnewå¯¹è±¡ã€‘ if (uniqueInstance == null) { uniqueInstance = new Singleton(); } } } return uniqueInstance; } } è¿™é‡Œï¼ŒuniqueInstanceé‡‡ç”¨volatileçš„å¿…è¦æ€§ï¼šä¸»è¦åˆ†æ``` uniqueInstance = new Singleton(); ```åˆ†ä¸‰æ­¥ï¼ˆæ­£å¸¸æƒ…å†µï¼‰ 1. ä¸ºuniqueInstance**åˆ†é…å†…å­˜ç©ºé—´** 2. **åˆå§‹åŒ–** uniqueInstance 3. å°†uniqueInstance**æŒ‡å‘**è¢«åˆ†é…çš„ç©ºé—´ ç”±äºæŒ‡ä»¤é‡æ’çš„å…³ç³»ï¼Œå¯èƒ½ä¼šç¼–ç¨‹1-\u0026gt;3-\u0026gt;2 ï¼ŒæŒ‡ä»¤é‡æ’åœ¨å•çº¿ç¨‹æƒ…å†µä¸‹ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œè€Œå¤šçº¿ç¨‹ï¼Œ - å°±ä¼šå¯¼è‡´å¯èƒ½æŒ‡é’ˆéç©ºçš„æ—¶å€™ï¼Œå®é™…è¯¥æŒ‡é’ˆæ‰€æŒ‡å‘çš„å¯¹è±¡ï¼ˆå®ä¾‹ï¼‰å¹¶è¿˜æ²¡æœ‰åˆå§‹åŒ– - ä¾‹å¦‚ï¼Œçº¿ç¨‹ T1 æ‰§è¡Œäº† 1 å’Œ 3ï¼Œæ­¤æ—¶ T2 è°ƒç”¨ `getUniqueInstance`() åå‘ç° `uniqueInstance` ä¸ä¸ºç©ºï¼Œå› æ­¤è¿”å› `uniqueInstance`ï¼Œä½†æ­¤æ—¶ `uniqueInstance` è¿˜æœªè¢«åˆå§‹åŒ–**ï¼ˆå°±ä¼šé€ æˆä¸€äº›é—®é¢˜ï¼‰** - å³å¯èƒ½å­˜åœ¨1ï¼Œ3å·²ç»å®Œæˆï¼Œ2è¿˜æœªå®Œæˆ volatileä¸èƒ½ä¿è¯åŸå­æ€§\nä¸‹é¢çš„ä»£ç ï¼Œè¾“å‡ºç»“æœå°äº2500\npublic class VolatoleAtomicityDemo { public volatile static int inc = 0; public void increase() { inc++; } public static void main(String[] args) throws InterruptedException { ExecutorService threadPool = Executors.newFixedThreadPool(5); VolatoleAtomicityDemo volatoleAtomicityDemo = new VolatoleAtomicityDemo(); for (int i = 0; i \u0026lt; 5; i++) { threadPool.execute(() -\u0026gt; { for (int j = 0; j \u0026lt; 500; j++) { volatoleAtomicityDemo.increase(); } }); } // ç­‰å¾…1.5ç§’ï¼Œä¿è¯ä¸Šé¢ç¨‹åºæ‰§è¡Œå®Œæˆ Thread.sleep(1500); System.out.println(inc); threadPool.shutdown(); } } å¯¹äºä¸Šé¢ä¾‹å­, å¾ˆå¤šäººä¼šè¯¯ä»¥ä¸ºinc++ æ˜¯åŸå­æ€§çš„ï¼Œå®é™…ä¸Šinc ++ æ˜¯ä¸€ä¸ªå¤åˆæ“ä½œï¼Œå³\nè¯»å–incçš„å€¼**ï¼ˆåˆ°çº¿ç¨‹å†…å­˜ï¼‰** å¯¹incåŠ 1 å°†åŠ 1åçš„å€¼å†™å›å†…å­˜ï¼ˆä¸»å†…å­˜ï¼‰ è¿™ä¸‰éƒ¨æ“ä½œå¹¶ä¸æ˜¯åŸå­æ€§çš„ï¼Œæœ‰å¯èƒ½å‡ºç°ï¼š\nçº¿ç¨‹1å¯¹incè¯»å–åï¼Œå°šæœªä¿®æ”¹ çº¿ç¨‹2åˆè¯»å–äº†ï¼Œå¹¶å¯¹ä»–è¿›è¡Œ+1ï¼Œç„¶åå°†+1åçš„å€¼å†™å›ä¸»å­˜ æ­¤æ—¶çº¿ç¨‹2æ“ä½œå®Œæ¯•åï¼Œçº¿ç¨‹1åœ¨ä¹‹å‰è¯»å–çš„åŸºç¡€ä¸Šè¿›è¡Œä¸€æ¬¡è‡ªå¢ï¼Œè¿™å°†è¦†ç›–ç¬¬2æ­¥æ“ä½œçš„å€¼ï¼Œå¯¼è‡´incåªå¢åŠ äº†1ï¼ˆå®é™…ä¸¤ä¸ªçº¿ç¨‹å¤„ç†äº†ï¼Œåº”è¯¥åŠ 2æ‰å¯¹ï¼‰ å¦‚æœè¦ä¿è¯ä¸Šé¢ä»£ç è¿è¡Œæ­£ç¡®ï¼Œå¯ä»¥ä½¿ç”¨synchronizedã€Lockæˆ–è€…AtomicIntegerï¼Œå¦‚\n//synchronized public synchronized void increase() { inc++; } //æˆ–è€…AtomicInteger public AtomicInteger inc = new AtomicInteger(); public void increase() { inc.getAndIncrement(); } //æˆ–è€…ReentrantLockæ”¹è¿› Lock lock = new ReentrantLock(); public void increase() { lock.lock(); try { inc++; } finally { lock.unlock(); } } synchronizedå…³é”®å­— # è¯´ä¸€è¯´è‡ªå·±å¯¹synchronizedçš„ç†è§£\nç¿»è¯‘æˆä¸­æ–‡æ˜¯åŒæ­¥çš„æ„æ€ï¼Œä¸»è¦è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ï¼Œä¿è¯è¢«å®ƒä¿®é¥°çš„æ–¹æ³•/ä»£ç å—ï¼Œåœ¨ä»»ä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ Javaæ—©æœŸç‰ˆæœ¬ä¸­ï¼Œsynchronizedå±äºé‡é‡çº§é”ï¼›ç›‘è§†å™¨é”ï¼ˆmonitorï¼‰ä¾èµ–åº•å±‚æ“ä½œç³»ç»Ÿçš„Mutex Lockæ¥å®ç°ï¼ŒJavaçº¿ç¨‹æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçš„åŸç”Ÿçº¿ç¨‹ä¸Š æŒ‚èµ·æˆ–å”¤é†’çº¿ç¨‹ï¼Œéƒ½éœ€è¦æ“ä½œç³»ç»Ÿå¸®å¿™å®Œæˆï¼Œå³æ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´åˆ‡æ¢ï¼Œéœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢åˆ°å†…æ ¸æ€ï¼Œè¿™ä¸ªè½¬æ¢æ—¶é—´æˆæœ¬é«˜ Java 6 ä¹‹åï¼ŒJavaå®˜æ–¹å¯¹synchronizedè¾ƒå¤§ä¼˜åŒ–ï¼Œå¼•å…¥äº†å¤§é‡ä¼˜åŒ–ï¼šè‡ªæ—‹é”ã€é€‚åº”æ€§è‡ªæ—‹é”ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€åå‘é”ã€è½»é‡çº§é”ç­‰å‡å°‘æ‰€æ“ä½œçš„å¼€é”€ å¦‚ä½•ä½¿ç”¨synchronizedå…³é”®å­—\nä¿®é¥°å®ä¾‹æ–¹æ³• ä¿®é¥°é™æ€æ–¹æ³• ä¿®é¥°ä»£ç å— ä¿®é¥°å®ä¾‹æ–¹æ³•ï¼ˆé”å½“å‰å¯¹è±¡å®ä¾‹ï¼‰ ç»™å½“å‰å¯¹è±¡å®ä¾‹åŠ é”ï¼Œè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾—å½“å‰å¯¹è±¡å®ä¾‹çš„é”\nsynchronized void method() { //ä¸šåŠ¡ä»£ç  } ä¿®é¥°é™æ€æ–¹æ³•ï¼ˆé”å½“å‰ç±»ï¼‰ ç»™å½“å‰ç±»æ·é”ï¼Œä¼šä½œç”¨äºç±»çš„æ‰€æœ‰å¯¹è±¡å®ä¾‹ï¼Œè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾—å½“å‰classçš„é”; è¿™æ˜¯å› ä¸ºé™æ€æˆå‘˜å½’æ•´ä¸ªç±»æ‰€æœ‰ï¼Œè€Œä¸å±äºä»»ä½•ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œä¸ä¾èµ–äºç±»çš„ç‰¹å®šå®ä¾‹ï¼Œè¢«ç±»æ‰€æœ‰å®ä¾‹å…±äº«\nsynchronized static void method() { //ä¸šåŠ¡ä»£ç  } é™æ€synchronizedæ–¹æ³•å’Œéé™æ€synchronizedæ–¹æ³•ä¹‹é—´çš„è°ƒç”¨äº’æ–¥å—ï¼šä¸äº’æ–¥\nå¦‚æœçº¿ç¨‹Aè°ƒç”¨å®ä¾‹å¯¹è±¡çš„éé™æ€æ–¹æ³•ï¼Œè€Œçº¿ç¨‹Bè°ƒç”¨è¿™ä¸ªå®ä¾‹æ‰€å±ç±»çš„é™æ€synchronizedæ–¹æ³•ï¼Œæ˜¯å…è®¸çš„ï¼Œä¸ä¼šå‘ç”Ÿäº’æ–¥ï¼›å› ä¸ºè®¿é—®é™æ€synchronizedæ–¹æ³•å ç”¨çš„é”æ˜¯å½“å‰ç±»çš„é”ï¼›éé™æ€synchronizedæ–¹æ³•å ç”¨çš„æ˜¯å½“å‰å®ä¾‹å¯¹è±¡çš„é”\nä¿®é¥°ä»£ç å—ï¼ˆé”æŒ‡å®šå¯¹è±¡/ç±»ï¼‰\nsynchronized(object) è¡¨ç¤ºè¿›å…¥åŒæ­¥ä»£ç åº“å‰è¦è·å¾— ç»™å®šå¯¹è±¡çš„é”ã€‚ synchronized(ç±».class) è¡¨ç¤ºè¿›å…¥åŒæ­¥ä»£ç å‰è¦è·å¾— ç»™å®š Class çš„é” synchronized(this) { //ä¸šåŠ¡ä»£ç  } æ€»ç»“\nsynchronized å…³é”®å­—åŠ åˆ° static é™æ€æ–¹æ³•å’Œ synchronized(class) ä»£ç å—ä¸Šéƒ½æ˜¯æ˜¯ç»™ Class ç±»ä¸Šé”ï¼› synchronized å…³é”®å­—åŠ åˆ°å®ä¾‹æ–¹æ³•ä¸Šæ˜¯ç»™å¯¹è±¡å®ä¾‹ä¸Šé”ï¼› å°½é‡ä¸è¦ä½¿ç”¨ synchronized(String a) å› ä¸º JVM ä¸­ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å…·æœ‰ç¼“å­˜åŠŸèƒ½ã€‚(æ‰€ä»¥å°±ä¼šå¯¼è‡´ï¼Œå®¹æ˜“**å’Œå…¶ä»–åœ°æ–¹çš„ä»£ç ï¼ˆåŒæ ·çš„å€¼çš„å­—ç¬¦ä¸²ï¼‰**äº’æ–¥ï¼Œå› ä¸ºæ˜¯ç¼“å†²æ± çš„åŒä¸€ä¸ªå¯¹è±¡) è®²ä¸€ä¸‹synchronizedå…³é”®å­—çš„åº•å±‚åŸç† synchronizedåº•å±‚åŸç†æ˜¯å±äºJVMå±‚é¢çš„\nsynchronized + ä»£ç å— ä¾‹å­ï¼š\npublic class SynchronizedDemo { public void method() { synchronized (this) { System.out.println(\u0026#34;synchronized ä»£ç å—\u0026#34;); } } } ä½¿ç”¨javapå‘½ä»¤æŸ¥çœ‹SynchronizedDemoç±»ç›¸å…³å­—èŠ‚ç ä¿¡æ¯ï¼šå¯¹ç¼–è¯‘åçš„SynchronizedDemo.classæ–‡ä»¶ï¼Œä½¿ç”¨javap -c -s -v -l SynchronizedDemo.class\nåŒæ­¥ä»£ç å—çš„å®ç°ï¼Œä½¿ç”¨çš„æ˜¯monitorenterå’ŒmonitorexitæŒ‡ä»¤ï¼Œå…¶ä¸­monitorenteræŒ‡ä»¤æŒ‡å‘åŒæ­¥ä»£ç å—å¼€å§‹çš„åœ°æ–¹ï¼ŒmonitorexitæŒ‡å‘åŒæ­¥ä»£ç å—ç»“æŸçš„ç»“æŸä½ç½® æ‰§è¡ŒmonitorenteræŒ‡ä»¤å°±æ˜¯è·å–å¯¹è±¡ç›‘è§†å™¨monitorçš„æŒæœ‰æƒ\nåœ¨HotSportè™šæ‹Ÿæœºä¸­ï¼ŒMonitoråŸºäºC++å®ç°ï¼Œç”±ObjectMonitorå®ç°ï¼šæ¯ä¸ªå¯¹è±¡å†…ç½®äº†ObjectMonitorå¯¹è±¡ã€‚wait/notifyç­‰æ–¹æ³•ä¹ŸåŸºäºmonitorå¯¹è±¡ï¼Œæ‰€ä»¥åªæœ‰åœ¨åŒæ­¥å—æˆ–è€…æ–¹æ³•ä¸­ï¼ˆè·å¾—é”ï¼‰æ‰èƒ½è°ƒç”¨wait/notifyæ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ›å‡ºjava.lang.IllegalMonitorStateExceptionå¼‚å¸¸çš„åŸå› \nnotify()ä»…ä»…æ˜¯é€šçŸ¥ï¼Œå¹¶ä¸ä¼šé‡Šæ”¾é”ï¼›wait()ä¼šç«‹å³é‡Šæ”¾é”ï¼Œä¾‹å­ï¼š\nObject obj = new Object(); new Thread(() -\u0026gt; { synchronized (obj) { try { log.info(\u0026#34;è¿è¡Œä¸­\u0026#34;); TimeUnit.SECONDS.sleep(3); log.info(\u0026#34;3såé‡Šæ”¾é”\u0026#34;); obj.wait();//ä¼šé‡Šæ”¾é” log.info(\u0026#34;å®Œæˆæ‰§è¡Œ\u0026#34;); } catch (InterruptedException e) { e.printStackTrace(); } } }, \u0026#34;çº¿ç¨‹1\u0026#34;).start(); //ä¿è¯çº¿ç¨‹2åœ¨çº¿ç¨‹1ä¹‹åå¯åŠ¨ TimeUnit.SECONDS.sleep(1); new Thread(() -\u0026gt; { synchronized (obj) { log.info(\u0026#34;è·å¾—é”\u0026#34;); try { TimeUnit.SECONDS.sleep(5); } catch (InterruptedException e) { e.printStackTrace(); } log.info(\u0026#34;5såå”¤é†’çº¿ç¨‹1\u0026#34;); obj.notify(); try { TimeUnit.SECONDS.sleep(3); } catch (InterruptedException e) { e.printStackTrace(); } log.info(\u0026#34;å®Œæˆæ‰§è¡Œ\u0026#34;); } }, \u0026#34;çº¿ç¨‹2\u0026#34;).start(); /**æ‰“å° 2023-03-07 11:33:00 ä¸Šåˆ [Thread: çº¿ç¨‹1] INFO:è¿è¡Œä¸­ 2023-03-07 11:33:03 ä¸Šåˆ [Thread: çº¿ç¨‹1] INFO:3såé‡Šæ”¾é” 2023-03-07 11:33:03 ä¸Šåˆ [Thread: çº¿ç¨‹2] INFO:è·å¾—é” 2023-03-07 11:33:08 ä¸Šåˆ [Thread: çº¿ç¨‹2] INFO:5såå”¤é†’çº¿ç¨‹1 2023-03-07 11:33:21 ä¸Šåˆ [Thread: çº¿ç¨‹2] INFO:å®Œæˆæ‰§è¡Œ 2023-03-07 11:33:21 ä¸Šåˆ [Thread: çº¿ç¨‹1] //è¿™æ®µè¾“å‡ºæ°¸è¿œä¼šåœ¨æœ€åï¼ˆçº¿ç¨‹2é‡Šæ”¾é”æ‰ä¼šè¾“å‡ºï¼‰ INFO:å®Œæˆæ‰§è¡Œ Process finished with exit code 0 */ æ‰§è¡Œmonitorenteræ—¶ï¼Œ**å°è¯•è·å–**å¯¹è±¡çš„é”ï¼Œå¦‚æœé”è®¡æ•°å™¨ä¸º0åˆ™è¡¨ç¤ºæ‰€å¯ä»¥è¢«è·å–ï¼Œè·å–åé”è®¡æ•°å™¨è®¾ä¸º1ï¼Œç®€å•çš„æµç¨‹ åªæœ‰æ‹¥æœ‰è€…çº¿ç¨‹æ‰èƒ½æ‰§è¡Œmonitorexitæ¥é‡Šæ”¾é”ï¼Œæ‰§è¡ŒmonitorexitæŒ‡ä»¤åï¼Œé”è®¡æ•°å™¨è®¾ä¸º0ï¼ˆåº”è¯¥æ˜¯å‡ä¸€ï¼Œä¸å¯é‡å…¥é”æœ‰å…³ï¼‰ï¼Œå½“è®¡æ•°å™¨ä¸º0æ—¶ï¼Œè¡¨æ˜é”è¢«é‡Šæ”¾ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥å°è¯•è·å¾—é”(å¦‚æœæŸä¸ªçº¿ç¨‹è·å–é”å¤±è´¥ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å°±ä¼šé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°é”è¢«ï¼ˆå¦ä¸€ä¸ªçº¿ç¨‹ï¼‰é‡Šæ”¾) synchronizedä¿®é¥°æ–¹æ³•\npublic class SynchronizedDemo2 { public synchronized void method() { System.out.println(\u0026#34;synchronized æ–¹æ³•\u0026#34;); } } å¦‚å›¾ : å¯¹æ¯”ï¼ˆä¸‹é¢æ˜¯å¯¹synchronizedä»£ç å—ï¼‰ï¼š\nsynchronizedä¿®é¥°çš„æ–¹æ³•æ²¡æœ‰monitorenterå’ŒmonitorexitæŒ‡ä»¤ï¼Œè€Œæ˜¯ACC_SYNCHRONIZEDæ ‡è¯†ï¼ˆflagsï¼‰ï¼Œè¯¥æ ‡è¯†æŒ‡æ˜æ–¹æ³•æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ï¼ˆJVMé€šè¿‡è®¿é—®æ ‡å¿—åˆ¤æ–­æ–¹æ³•æ˜¯å¦å£°æ˜ä¸ºåŒæ­¥æ–¹æ³•ï¼‰ï¼Œä»è€Œæ‰§è¡ŒåŒæ­¥è°ƒç”¨ å¦‚æœæ˜¯å®ä¾‹æ–¹æ³•ï¼ŒJVM ä¼šå°è¯•è·å–å®ä¾‹å¯¹è±¡çš„é”ã€‚å¦‚æœæ˜¯é™æ€æ–¹æ³•ï¼ŒJVM ä¼šå°è¯•è·å–å½“å‰ class çš„é”ã€‚\næ€»ç»“\nsynchronized åŒæ­¥è¯­å¥å—çš„å®ç°ä½¿ç”¨çš„æ˜¯ monitorenter å’Œ monitorexit æŒ‡ä»¤ï¼Œå…¶ä¸­ monitorenter æŒ‡ä»¤æŒ‡å‘åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œmonitorexit æŒ‡ä»¤åˆ™æŒ‡æ˜åŒæ­¥ä»£ç å—çš„ç»“æŸä½ç½®ã€‚\nsynchronized ä¿®é¥°çš„æ–¹æ³•å¹¶æ²¡æœ‰ monitorenter æŒ‡ä»¤å’Œ monitorexit æŒ‡ä»¤ï¼Œå–å¾—ä»£ä¹‹çš„ç¡®å®æ˜¯ ACC_SYNCHRONIZED æ ‡è¯†ï¼Œè¯¥æ ‡è¯†æŒ‡æ˜äº†è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ã€‚\nä¸è¿‡ä¸¤è€…çš„æœ¬è´¨éƒ½æ˜¯å¯¹å¯¹è±¡ç›‘è§†å™¨ monitor çš„è·å–ã€‚\nJava1.6ä¹‹åçš„synchronizedå…³é”®å­—åº•å±‚åšäº†å“ªäº›ä¼˜åŒ– è¿™æ˜¯ä¸€ä¸ªé“¾æ¥ è¯¦æƒ…è§å¦ä¸€ä¸ªæ–‡ç« \nJDK1.6å¯¹é”çš„å®ç°ï¼Œå¼•å…¥äº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå¦‚åå‘é”ã€è½»é‡çº§é”ã€è‡ªæ—‹é”ã€é€‚åº”æ€§è‡ªæ—‹é”ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ç­‰æŠ€æœ¯æ¥å‡å°‘æ“ä½œçš„å¼€é”€ é”ä¸»è¦å­˜åœ¨å››ç§çŠ¶æ€ï¼Œä¾æ¬¡æ˜¯ï¼šæ— é”çŠ¶æ€ã€åå‘é”çŠ¶æ€ã€è½»é‡çº§é”çŠ¶æ€ã€é‡é‡çº§é”çŠ¶æ€ï¼Œä»–ä»¬ä¼šéšç€ç«äº‰çš„æ¿€çƒˆè€Œé€æ¸å‡çº§ã€‚é”å¯ä»¥å‡çº§ä½†ä¸å¯ä»¥é™çº§ï¼Œè¿™ç§ç­–ç•¥æ˜¯ä¸ºäº†æé«˜è·å¾—é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡ synchronizedå’Œvolatileçš„åŒºåˆ« synchronizedå’Œvolatileæ˜¯äº’è¡¥çš„å­˜åœ¨ï¼Œè€Œéå¯¹ç«‹\nvolatileå…³é”®å­—æ˜¯çº¿ç¨‹åŒæ­¥çš„è½»é‡çº§å®ç°ï¼Œæ‰€ä»¥volatileæ€§èƒ½è‚¯å®šæ¯”synchronizedå…³é”®å­—å¥½ï¼Œä½†volatileç”¨äºå˜é‡è€Œsynchronizedå…³é”®å­—ä¿®é¥°æ–¹æ³•åŠä»£ç å— volatileå…³é”®å­—èƒ½ä¿è¯æ•°æ®çš„å¯è§æ€§ã€æœ‰åºæ€§ï¼Œä½†æ— æ³•ä¿è¯åŸå­æ€§ï¼›synchronizedä¸‰è€…éƒ½èƒ½ä¿è¯ volatileä¸»è¦è¿˜æ˜¯ç”¨äºè§£å†³å˜é‡åœ¨çº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œè€Œsynchronizedå…³é”®å­—è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ synchronized å’Œ ReentrantLock çš„åŒºåˆ«\nä¸¤è€…éƒ½æ˜¯å¯é‡å…¥é” â€å¯é‡å…¥é”â€œæŒ‡çš„æ˜¯ï¼Œè‡ªå·±å¯ä»¥å†æ¬¡è·å–è‡ªå·±çš„å†…éƒ¨é”ã€‚æ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹è·å¾—äº†æŸä¸ªå¯¹è±¡çš„é”ï¼Œæ­¤æ—¶è¿™ä¸ªå¯¹è±¡é”è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå½“å…¶å†æ¬¡æƒ³è¦è·å–è¿™ä¸ªå¯¹è±¡çš„é”çš„æ—¶å€™è¿˜æ˜¯å¯ä»¥è·å–çš„\nåä¹‹ï¼Œå¦‚æœæ˜¯ä¸å¯é‡å…¥é”çš„è¯ï¼Œå°±ä¼šé€ æˆæ­»é”ã€‚ åŒä¸€ä¸ªçº¿ç¨‹ï¼Œæ¯æ¬¡è·å–é”ï¼Œé”çš„è®¡æ•°å™¨éƒ½è‡ªå¢1ï¼Œæ‰€ä»¥è¦ç­‰åˆ°é”çš„è®¡æ•°å™¨ä¸‹é™ä¸º0æ—¶æ‰èƒ½é‡Šæ”¾é” synchronizedä¾èµ–äºJVMï¼Œè€ŒReentrantLockä¾èµ–äºAPI synchronizedä¸ºè™šæ‹Ÿæœºåœ¨JDK1.6è¿›è¡Œçš„ä¼˜åŒ–ï¼Œä½†è¿™äº›ä¼˜åŒ–æ˜¯åœ¨è™šæ‹Ÿæœºå±‚é¢å®ç°çš„ï¼›ReentrantLockæ˜¯JDKå±‚é¢å®ç°çš„ï¼Œä½¿ç”¨æ—¶ï¼Œä½¿ç”¨lock()å’Œunlock()å¹¶é…åˆtry/finallyè¯­å¥å—æ¥å®Œæˆ ï¼ˆJavaä»£ç ï¼‰ ReentrantLock æ¯” synchronized å¢åŠ äº†ä¸€äº›é«˜çº§åŠŸèƒ½ ReentrantLockå¢åŠ äº†ä¸€äº›é«˜çº§åŠŸèƒ½ï¼Œä¸»è¦æœ‰\nç­‰å¾…å¯ä¸­æ–­ï¼Œæä¾›äº†èƒ½å¤Ÿä¸­æ–­ç­‰å¾…é”çš„çº¿ç¨‹çš„æœºåˆ¶ï¼Œé€šè¿‡lock.lockInterruptibly()æ¥å®ç°è¯¥æœºåˆ¶ã€‚å³æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹å¯ä»¥æ”¾å¼ƒç­‰å¾…ï¼Œæ”¹ä¸ºå¤„ç†å…¶ä»–äº‹æƒ…\nå¯å®ç°å…¬å¹³é”ï¼šå¯ä»¥æŒ‡å®šæ˜¯å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ï¼Œè€Œsynchronizedåªèƒ½æ˜¯éå…¬å¹³é”ã€‚ æ‰€è°“å…¬å¹³é”å°±æ˜¯å…ˆç­‰å¾…çš„çº¿ç¨‹å…ˆè·å¾—é”ã€‚ReentrantLocké»˜è®¤æ˜¯éå…¬å¹³çš„ï¼Œå¯ä»¥é€šè¿‡æ„é€ æ–¹æ³•æŒ‡å®šæ˜¯å¦å…¬å¹³\nå¯å®ç°é€‰æ‹©æ€§çš„é€šçŸ¥ï¼ˆé”å¯ä»¥ç»‘å®šå¤šä¸ªæ¡ä»¶ï¼‰ synchronizedå…³é”®å­—ä¸wait()å’Œnotify()/notifyAll()æ–¹æ³•ç›¸ç»“åˆå¯ä»¥å®ç°ç­‰å¾…/é€šçŸ¥æœºåˆ¶ã€‚**ReentrantLockç±»å½“ç„¶ä¹Ÿå¯ä»¥å®ç°ï¼Œä½†æ˜¯éœ€è¦å€ŸåŠ©äºConditionæ¥å£ä¸newCondition()**æ–¹æ³•ã€‚\nReentrantLock reentrantLock=new ReentrantLock(); Condition condition = reentrantLock.newCondition(); condition.await(); condition.signal(); Conditionæ˜¯ JDK1.5 ä¹‹åæ‰æœ‰çš„ï¼Œå®ƒå…·æœ‰å¾ˆå¥½çš„çµæ´»æ€§ï¼Œæ¯”å¦‚å¯ä»¥å®ç°å¤šè·¯é€šçŸ¥åŠŸèƒ½ä¹Ÿå°±æ˜¯åœ¨ä¸€ä¸ªLockå¯¹è±¡ä¸­å¯ä»¥åˆ›å»ºå¤šä¸ªConditionå®ä¾‹ï¼ˆå³å¯¹è±¡ç›‘è§†å™¨ï¼‰ï¼Œ**çº¿ç¨‹å¯¹è±¡å¯ä»¥æ³¨å†Œåœ¨æŒ‡å®šçš„Conditionä¸­ï¼Œä»è€Œå¯ä»¥æœ‰é€‰æ‹©æ€§çš„è¿›è¡Œçº¿ç¨‹é€šçŸ¥ï¼Œåœ¨è°ƒåº¦çº¿ç¨‹ä¸Šæ›´åŠ çµæ´»ã€‚ ** åœ¨ä½¿ç”¨notify()/notifyAll()æ–¹æ³•è¿›è¡Œé€šçŸ¥æ—¶ï¼Œè¢«é€šçŸ¥çš„çº¿ç¨‹æ˜¯ç”± JVM é€‰æ‹©çš„ï¼Œç”¨ReentrantLockç±»ç»“åˆConditionå®ä¾‹å¯ä»¥å®ç°â€œé€‰æ‹©æ€§é€šçŸ¥â€ ï¼Œè¿™ä¸ªåŠŸèƒ½éå¸¸é‡è¦ï¼Œè€Œä¸”æ˜¯ Condition æ¥å£é»˜è®¤æä¾›çš„ã€‚ synchronizedå…³é”®å­—å°±ç›¸å½“äºæ•´ä¸ª Lock å¯¹è±¡ä¸­åªæœ‰ä¸€ä¸ªConditionå®ä¾‹ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½æ³¨å†Œåœ¨å®ƒä¸€ä¸ªèº«ä¸Šã€‚å¦‚æœæ‰§è¡ŒnotifyAll()æ–¹æ³•çš„è¯å°±ä¼šé€šçŸ¥æ‰€æœ‰å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹è¿™æ ·ä¼šé€ æˆå¾ˆå¤§çš„æ•ˆç‡é—®é¢˜ï¼Œ Conditionå®ä¾‹çš„signalAll()æ–¹æ³• åªä¼šå”¤é†’æ³¨å†Œåœ¨è¯¥Conditionå®ä¾‹ä¸­çš„æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ã€‚ ThreadLocal # ThreadLocalæœ‰ä»€ä¹ˆç”¨\né€šå¸¸æƒ…å†µä¸‹ï¼Œåˆ›å»ºçš„å˜é‡æ˜¯å¯ä»¥è¢«ä»»ä½•ä¸€ä¸ªçº¿ç¨‹è®¿é—®å¹¶ä¿®æ”¹çš„ JDKè‡ªå¸¦çš„ThreadLocalç±»ï¼Œè¯¥ç±»ä¸»è¦è§£å†³çš„å°±æ˜¯è®©æ¯ä¸ªçº¿ç¨‹ç»‘å®šè‡ªå·±çš„å€¼ï¼Œå¯ä»¥å°†ThreadLocalç±»å½¢è±¡çš„æ¯”å–»æˆå­˜æ”¾æ•°æ®çš„ç›’å­ï¼Œç›’å­ä¸­å¯ä»¥å­˜å‚¨æ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰æ•°æ® å¯¹äºThreadLocalå˜é‡ï¼Œè®¿é—®è¿™ä¸ªå˜é‡çš„æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è¿™ä¸ªå˜é‡çš„æœ¬åœ°å‰¯æœ¬ã€‚ä½¿ç”¨get()å’Œset()æ¥è·å–é»˜è®¤å€¼æˆ–å°†å…¶å€¼æ›´æ”¹ä¸ºå½“å‰çº¿ç¨‹æ‰€å­˜çš„å‰¯æœ¬çš„å€¼ å¦‚å›¾\nå¦‚ä½•ä½¿ç”¨ThreadLocal Demoæ¼”ç¤ºå®é™…ä¸­å¦‚ä½•ä½¿ç”¨ThreadLocal\nimport java.text.SimpleDateFormat; import java.util.Random; public class ThreadLocalExample implements Runnable{ // SimpleDateFormat ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥æ¯ä¸ªçº¿ç¨‹éƒ½è¦æœ‰è‡ªå·±ç‹¬ç«‹çš„å‰¯æœ¬ private static final ThreadLocal\u0026lt;SimpleDateFormat\u0026gt; formatter = ThreadLocal.withInitial(() -\u0026gt; new SimpleDateFormat(\u0026#34;yyyyMMdd HHmm\u0026#34;)); /* élambdaå†™æ³• private static final ThreadLocal\u0026lt;SimpleDateFormat\u0026gt; formatter = new ThreadLocal\u0026lt;SimpleDateFormat\u0026gt;(){ @Override protected SimpleDateFormat initialValue(){ return new SimpleDateFormat(\u0026#34;yyyyMMdd HHmm\u0026#34;); } }; */ public static void main(String[] args) throws InterruptedException { ThreadLocalExample obj = new ThreadLocalExample(); for(int i=0 ; i\u0026lt;10; i++){ Thread t = new Thread(obj, \u0026#34;\u0026#34;+i); Thread.sleep(new Random().nextInt(1000)); t.start(); } } //formatter.get().toPattern() åŒä¸€ä¸ªå¯¹è±¡çš„çº¿ç¨‹å˜é‡formatter(é‡Œé¢å°è£…äº†ä¸€ä¸ªsimpleDateFormateå¯¹è±¡ï¼Œå…·æœ‰åˆå§‹å€¼) //æ¯ä¸ªçº¿ç¨‹è®¿é—®æ—¶ï¼Œå…ˆæ‰“å°å®ƒçš„åˆå§‹å€¼ï¼Œç„¶åä¼‘çœ 1sï¼ˆ1så†…çš„éšæœºæ•°ï¼‰ï¼Œåæ­£æ¯ä¸ªçº¿ç¨‹éšæœºæ•°ä¸åŒï¼Œç„¶åä¿®æ”¹å®ƒ //ç»“æœï¼šè™½ç„¶å‰é¢æ‰§è¡Œçš„çº¿ç¨‹ï¼Œä¿®æ”¹å€¼ï¼Œä½†æ˜¯åé¢æ‰§è¡Œçš„çº¿ç¨‹æ‰“å°çš„å€¼è¿˜æ˜¯ä¸€æ ·çš„ æ²¡æœ‰ä¿®æ”¹ @Override public void run() { System.out.println(\u0026#34;Thread Name= \u0026#34;+Thread.currentThread().getName()+\u0026#34; default Formatter = \u0026#34;+formatter.get().toPattern()); try { Thread.sleep(new Random().nextInt(1000)); } catch (InterruptedException e) { e.printStackTrace(); } //formatter pattern is changed here by thread, but it won\u0026#39;t reflect to other threads formatter.set(new SimpleDateFormat());//new SimpleDateFormat().toPattern()é»˜è®¤å€¼ä¸º\u0026#34;yy-M-d ah:mm\u0026#34; System.out.println(\u0026#34;Thread Name= \u0026#34;+Thread.currentThread().getName()+\u0026#34; formatter = \u0026#34;+formatter.get().toPattern()); } } /*è™½ç„¶å‰é¢æ‰§è¡Œçš„çº¿ç¨‹ï¼Œä¿®æ”¹å€¼ï¼Œä½†æ˜¯åé¢æ‰§è¡Œçš„çº¿ç¨‹æ‰“å°çš„å€¼è¿˜æ˜¯ä¸€æ ·çš„ æ²¡æœ‰ä¿®æ”¹ , ç»“æœå¦‚ä¸‹ï¼š Thread Name= 0 default Formatter = yyyyMMdd HHmm Thread Name= 0 formatter = yy-M-d ah:mm Thread Name= 1 default Formatter = yyyyMMdd HHmm Thread Name= 2 default Formatter = yyyyMMdd HHmm Thread Name= 1 formatter = yy-M-d ah:mm Thread Name= 3 default Formatter = yyyyMMdd HHmm Thread Name= 2 formatter = yy-M-d ah:mm Thread Name= 4 default Formatter = yyyyMMdd HHmm Thread Name= 3 formatter = yy-M-d ah:mm Thread Name= 4 formatter = yy-M-d ah:mm Thread Name= 5 default Formatter = yyyyMMdd HHmm Thread Name= 5 formatter = yy-M-d ah:mm Thread Name= 6 default Formatter = yyyyMMdd HHmm Thread Name= 6 formatter = yy-M-d ah:mm Thread Name= 7 default Formatter = yyyyMMdd HHmm Thread Name= 7 formatter = yy-M-d ah:mm Thread Name= 8 default Formatter = yyyyMMdd HHmm Thread Name= 9 default Formatter = yyyyMMdd HHmm Thread Name= 8 formatter = yy-M-d ah:mm Thread Name= 9 formatter = yy-M-d ah:mm */ ThreadLocalåŸç†äº†è§£å—\nä»Threadç±»æºä»£ç å…¥æ‰‹\npublic class Thread implements Runnable { //...... //ä¸æ­¤çº¿ç¨‹æœ‰å…³çš„ThreadLocalå€¼ã€‚ç”±ThreadLocalç±»ç»´æŠ¤ ThreadLocal.ThreadLocalMap threadLocals = null; //ä¸æ­¤çº¿ç¨‹æœ‰å…³çš„InheritableThreadLocalå€¼ã€‚ç”±InheritableThreadLocalç±»ç»´æŠ¤ ThreadLocal.ThreadLocalMap inheritableThreadLocals = null; //...... } Threadç±»ä¸­æœ‰ä¸€ä¸ªthreadLocalså’Œä¸€ä¸ªinheritableThreadLocalså˜é‡ï¼Œå®ƒä»¬éƒ½æ˜¯ThreadLocalMapç±»å‹çš„å˜é‡ï¼ŒThreadLocalMapå¯ä»¥ç†è§£ä¸ºThreadLocalç±»å®ç°çš„å®šåˆ¶åŒ–HashMap ( keyä¸ºthreadLocal , value ä¸ºå€¼) é»˜è®¤ä¸¤ä¸ªå˜é‡éƒ½æ˜¯nullï¼Œå½“è°ƒç”¨setæˆ–getæ—¶ä¼šåˆ›å»ºï¼Œå®é™…è°ƒç”¨çš„æ˜¯ThreadLocalMapç±»å¯¹åº”çš„get()ã€set()æ–¹æ³•\n//â˜…â˜…ThreadLocalç±»çš„set() æ–¹æ³• public void set(T value) { //è·å–å½“å‰è¯·æ±‚çš„çº¿ç¨‹ Thread t = Thread.currentThread(); //å–å‡º Thread ç±»å†…éƒ¨çš„ threadLocals å˜é‡(å“ˆå¸Œè¡¨ç»“æ„) ThreadLocalMap map = getMap(t); if (map != null) // å°†éœ€è¦å­˜å‚¨çš„å€¼æ”¾å…¥åˆ°è¿™ä¸ªå“ˆå¸Œè¡¨ä¸­ //â˜…â˜…å®é™…ä½¿ç”¨çš„æ–¹æ³• map.set(this, value); else //â˜…â˜…å®é™…ä½¿ç”¨çš„æ–¹æ³• createMap(t, value); } ThreadLocalMap getMap(Thread t) { return t.threadLocals; } void createMap(Thread t, T firstValue) { t.threadLocals = new ThreadLocalMap(this, firstValue); } public T get() { Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) { ThreadLocalMap.Entry e = map.getEntry(this); if (e != null) { @SuppressWarnings(\u0026#34;unchecked\u0026#34;) T result = (T)e.value; return result; } } return setInitialValue(); } /** * Set the value associated with key. * * @param key the thread local object * @param value the value to be set */ private void set(ThreadLocal\u0026lt;?\u0026gt; key, Object value) { // We don\u0026#39;t use a fast path as with get() because it is at // least as common to use set() to create new entries as // it is to replace existing ones, in which case, a fast // path would fail more often than not. Entry[] tab = table; int len = tab.length; int i = key.threadLocalHashCode \u0026amp; (len-1); for (Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) { ThreadLocal\u0026lt;?\u0026gt; k = e.get(); if (k == key) { e.value = value; return; } if (k == null) { replaceStaleEntry(key, value, i); return; } } tab[i] = new Entry(key, value); int sz = ++size; if (!cleanSomeSlots(i, sz) \u0026amp;\u0026amp; sz \u0026gt;= threshold) rehash(); } å¦‚ä¸Šï¼Œå®é™…å­˜å–éƒ½æ˜¯ä»Threadçš„threadLocals ï¼ˆThreadLocalMapç±»ï¼‰ä¸­ï¼Œå¹¶ä¸æ˜¯å­˜åœ¨ThreadLocalä¸Šï¼ŒThreadLocalç”¨æ¥ä¼ é€’äº†å˜é‡å€¼ï¼Œåªæ˜¯ThreadLocalMapçš„å°è£…\nThreadLocalç±»ä¸­é€šè¿‡Thread.currentThread()è·å–åˆ°å½“å‰çº¿ç¨‹å¯¹è±¡åï¼Œç›´æ¥é€šè¿‡getMap(Thread t) å¯ä»¥è®¿é—®åˆ°è¯¥çº¿ç¨‹çš„ThreadLocalMapå¯¹è±¡\nã€â˜…â˜…æœ€é‡è¦â˜…â˜…ã€‘æ¯ä¸ªThreadä¸­å…·å¤‡ä¸€ä¸ªThreadLocalMapï¼Œè€ŒThreadLocalMapå¯ä»¥å­˜å‚¨ä»¥ThreadLocalä¸ºkeyï¼ŒObjectå¯¹è±¡ä¸ºvalueçš„é”®å€¼å¯¹\nThreadLocalMap(ThreadLocal\u0026lt;?\u0026gt; firstKey, Object firstValue) { //...... } æ¯”å¦‚æˆ‘ä»¬åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­å£°æ˜äº†ä¸¤ä¸ª ThreadLocal å¯¹è±¡çš„è¯ï¼Œ Threadå†…éƒ¨éƒ½æ˜¯ä½¿ç”¨ä»…æœ‰çš„é‚£ä¸ªThreadLocalMap å­˜æ”¾æ•°æ®çš„ï¼ŒThreadLocalMapçš„ key å°±æ˜¯ ThreadLocalå¯¹è±¡ï¼Œvalue å°±æ˜¯ ThreadLocal å¯¹è±¡è°ƒç”¨setæ–¹æ³•è®¾ç½®çš„å€¼\nThreadLocalæ•°æ®ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º ThreadLocalMapæ˜¯ThreadLocalçš„é™æ€å†…éƒ¨ç±»ã€‚ ThreadLocalå†…å­˜æ³„éœ²é—®é¢˜æ—¶æ€ä¹ˆå¯¼è‡´çš„\nå‰æçŸ¥è¯†ï¼šå¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨çš„åŒºåˆ«\nå¼ºå¼•ç”¨StrongReference\næ˜¯æœ€æ™®éçš„ä¸€ç§å¼•ç”¨æ–¹å¼ï¼Œåªè¦å¼ºå¼•ç”¨å­˜åœ¨ï¼Œåˆ™åƒåœ¾å›æ”¶å™¨å°±ä¸ä¼šå›æ”¶è¿™ä¸ªå¯¹è±¡\nè½¯å¼•ç”¨ SoftReference\nå¦‚æœå†…å­˜è¶³å¤Ÿä¸å›æ”¶ï¼Œå¦‚æœå†…å­˜ä¸è¶³åˆ™å›æ”¶\nå¼±å¼•ç”¨WeakReference å¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰å¼±å¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¯æœ‰å¯æ— çš„ç”Ÿæ´»ç”¨å“ã€‚å¼±å¼•ç”¨ä¸è½¯å¼•ç”¨çš„åŒºåˆ«åœ¨äºï¼šåªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ‹¥æœ‰æ›´çŸ­æš‚çš„ç”Ÿå‘½å‘¨æœŸã€‚åœ¨åƒåœ¾å›æ”¶å™¨çº¿ç¨‹æ‰«æå®ƒ æ‰€ç®¡è¾–çš„å†…å­˜åŒºåŸŸçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°äº†åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜ã€‚ä¸è¿‡ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹ï¼Œ å› æ­¤ä¸ä¸€å®šä¼šå¾ˆå¿«å‘ç°é‚£äº›åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚\nå¼±å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœå¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJava è™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªå¼±å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚\nè™šå¼•ç”¨PhantomReference [ËˆfÃ¦ntÉ™m] å¹»å½±\nå¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚è™šå¼•ç”¨ä¸»è¦ç”¨æ¥è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„æ´»åŠ¨ è™šå¼•ç”¨ä¸è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„ä¸€ä¸ªåŒºåˆ«åœ¨äºï¼šè™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ— ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ã€‚å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ ThreadLocalMapä¸­ï¼Œä½¿ç”¨çš„keyä¸ºThreadLocalçš„å¼±å¼•ç”¨ï¼ˆæºç ä¸­ï¼Œå³Entryï¼‰ï¼Œè€Œvalueæ˜¯å¼ºå¼•ç”¨\n//æ³¨æ„çœ‹ThreadLocalçš„set()æ–¹æ³• /** * Set the value associated with key. * * @param key the thread local object * @param value the value to be set */ private void set(ThreadLocal\u0026lt;?\u0026gt; key, Object value) { // We don\u0026#39;t use a fast path as with get() because it is at // least as common to use set() to create new entries as // it is to replace existing ones, in which case, a fast // path would fail more often than not. Entry[] tab = table; int len = tab.length; int i = key.threadLocalHashCode \u0026amp; (len-1); for (Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) { ThreadLocal\u0026lt;?\u0026gt; k = e.get(); if (k == key) { e.value = value; return; } if (k == null) { replaceStaleEntry(key, value, i); return; } } //â˜…â˜…æ³¨æ„çœ‹è¿™è¡Œï¼Œç»“åˆä¸‹é¢ tab[i] = new Entry(key, value); int sz = ++size; if (!cleanSomeSlots(i, sz) \u0026amp;\u0026amp; sz \u0026gt;= threshold) rehash(); } æ‰€ä»¥ï¼ŒThreadLocalæ²¡æœ‰è¢«å¤–éƒ¨å¼ºå¼•ç”¨çš„æƒ…å†µä¸‹ï¼Œåƒåœ¾å›æ”¶çš„æ—¶å€™ keyä¼šè¢«æ¸…ç†æ‰ï¼Œè€Œvalueä¸ä¼š ```java static class Entry extends WeakReference\u0026lt;ThreadLocal\u0026lt;?\u0026gt;\u0026gt; { /** The value associated with this ThreadLocal. */ Object value; Entry(ThreadLocal\u0026lt;?\u0026gt; k, Object v) { super(k); value = v; } } ``` æ­¤æ—¶ï¼ŒThreadLocalMapä¸­å°±ä¼šå‡ºç°keyä¸ºnullçš„Entryï¼Œå¦‚æœä¸åšä»»ä½•æªæ–½ï¼Œvalueæ°¸è¿œæ— æ³•è¢«GCå›æ”¶ï¼Œæ­¤æ—¶ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼ã€‚ThreadLocaMapå®ç°ä¸­å·²ç»è€ƒè™‘äº†è¿™ç§æƒ…å†µï¼Œåœ¨è°ƒç”¨set()ã€get()ã€**remove()**æ–¹æ³•æ—¶ï¼Œæ¸…ç†æ‰keyä¸ºnullçš„è®°å½• æ‰€ä»¥ä½¿ç”¨å®ŒThreadLocalçš„æ–¹æ³•åï¼Œæœ€å¥½æ‰‹åŠ¨è°ƒç”¨remove()æ–¹æ³•\nset()æ–¹æ³•ä¸­çš„cleanSomeSlots() å·²ç»æ¸…é™¤äº†éƒ¨åˆ†keyä¸ºnullçš„è®°å½•ã€‚ä½†æ˜¯è¿˜ä¸å®Œæ•´ï¼Œè¿˜è¦ä¾èµ– expungeStaleEntry() æ–¹æ³•ï¼ˆåœ¨removeä¸­ï¼‰\n//remove()æ–¹æ³• public void remove() { ThreadLocalMap m = getMap(Thread.currentThread()); if (m != null) m.remove(this); } /** * Remove the entry for key. */ private void remove(ThreadLocal\u0026lt;?\u0026gt; key) { Entry[] tab = table; int len = tab.length; int i = key.threadLocalHashCode \u0026amp; (len-1); for (Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) { if (e.get() == key) { e.clear(); expungeStaleEntry(i); return; } } } /** * Expunge a stale entry by rehashing any possibly colliding entries * lying between staleSlot and the next null slot. This also expunges * any other stale entries encountered before the trailing null. See * Knuth, Section 6.4 * * @param staleSlot index of slot known to have null key * @return the index of the next null slot after staleSlot * (all between staleSlot and this slot will have been checked * for expunging). */ private int expungeStaleEntry(int staleSlot) { Entry[] tab = table; int len = tab.length; // expunge entry at staleSlot tab[staleSlot].value = null; tab[staleSlot] = null; size--; // Rehash until we encounter null Entry e; int i; for (i = nextIndex(staleSlot, len); (e = tab[i]) != null; i = nextIndex(i, len)) { ThreadLocal\u0026lt;?\u0026gt; k = e.get(); if (k == null) { e.value = null; tab[i] = null; size--; } else { int h = k.threadLocalHashCode \u0026amp; (len - 1); if (h != i) { tab[i] = null; // Unlike Knuth 6.4 Algorithm R, we must scan until // null because multiple entries could have been stale. while (tab[h] != null) h = nextIndex(h, len); tab[h] = e; } } } return i; } "},{"id":142,"href":"/zh/docs/study/springCloud/bl_zhouyang/base/","title":"åŸºç¡€","section":"åŸºç¡€(å°šç¡…è°·)_","content":" springCloudæ¶‰åŠåˆ°çš„æŠ€æœ¯æœ‰å“ªäº› çº¦å®š \u0026gt; é…ç½® \u0026gt; ç¼–ç  "},{"id":143,"href":"/zh/docs/study/Review/java_guide/java/Concurrent/ly0301lyconcurrent-01/","title":"å¹¶å‘01","section":"å¹¶å‘","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nä»€ä¹ˆæ˜¯è¿›ç¨‹å’Œçº¿ç¨‹\nè¿›ç¨‹ï¼šæ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿè¿è¡Œç¨‹åºçš„åŸºæœ¬å•ä½ ç³»ç»Ÿè¿è¡Œä¸€ä¸ªç¨‹åºï¼Œå³ä¸€ä¸ªè¿›ç¨‹ä»åˆ›å»ºã€è¿è¡Œåˆ°æ¶ˆäº¡çš„è¿‡ç¨‹\nå¯åŠ¨mainå‡½æ•°åˆ™å¯åŠ¨äº†ä¸€ä¸ªJVMè¿›ç¨‹ï¼Œmainå‡½æ•°æ‰€åœ¨çº¿ç¨‹ä¸ºè¿›ç¨‹ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿç§°ä¸»çº¿ç¨‹\nä»¥ä¸‹ä¸ºä¸€ä¸ªä¸ªçš„è¿›ç¨‹\næŸ¥çœ‹javaè¿›ç¨‹\njps -l 32 org.jetbrains.jps.cmdline.Launcher 10084 16244 com.Test 17400 sun.tools.jps.Jps æ€æ­»è¿›ç¨‹\ntaskkill /f /pid 16244 ä½•ä¸ºçº¿ç¨‹\nçº¿ç¨‹ï¼Œæ¯”è¿›ç¨‹æ›´å°çš„æ‰§è¡Œå•ä½\nåŒç±»çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„å †å’Œæ–¹æ³•åŒºèµ„æºï¼Œä½†æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆï¼Œåˆè¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹\nJavaå¤©ç”Ÿå°±æ˜¯å¤šçº¿ç¨‹ç¨‹åºï¼Œå¦‚ï¼š\npublic class MultiThread { public static void main(String[] args) { // è·å– Java çº¿ç¨‹ç®¡ç† MXBean ThreadMXBean threadMXBean = ManagementFactory.getThreadMXBean(); // ä¸éœ€è¦è·å–åŒæ­¥çš„ monitor å’Œ synchronizer ä¿¡æ¯ï¼Œä»…è·å–çº¿ç¨‹å’Œçº¿ç¨‹å †æ ˆä¿¡æ¯ ThreadInfo[] threadInfos = threadMXBean.dumpAllThreads(false, false); // éå†çº¿ç¨‹ä¿¡æ¯ï¼Œä»…æ‰“å°çº¿ç¨‹ ID å’Œçº¿ç¨‹åç§°ä¿¡æ¯ for (ThreadInfo threadInfo : threadInfos) { System.out.println(\u0026#34;[\u0026#34; + threadInfo.getThreadId() + \u0026#34;] \u0026#34; + threadInfo.getThreadName()); } } } //è¾“å‡º [5] Attach Listener //æ·»åŠ äº‹ä»¶ [4] Signal Dispatcher // åˆ†å‘å¤„ç†ç»™ JVM ä¿¡å·çš„çº¿ç¨‹ [3] Finalizer //è°ƒç”¨å¯¹è±¡ finalize æ–¹æ³•çš„çº¿ç¨‹ [2] Reference Handler //æ¸…é™¤ reference çº¿ç¨‹ [1] main //main çº¿ç¨‹,ç¨‹åºå…¥å£ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªJavaç¨‹åºçš„è¿è¡Œï¼Œæ˜¯mainçº¿ç¨‹å’Œå¤šä¸ªå…¶ä»–çº¿ç¨‹åŒæ—¶è¿è¡Œ\nè¯·ç®€è¦æè¿°çº¿ç¨‹ä¸è¿›ç¨‹çš„å…³ç³»ï¼ŒåŒºåˆ«åŠä¼˜ç¼ºç‚¹\nä»JVMè§’åº¦è¯´æ˜ Javaå†…å­˜åŒºåŸŸ ä¸€ä¸ªè¿›ç¨‹æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„å †å’Œæ–¹æ³•åŒºï¼ˆJDK1.8: å…ƒç©ºé—´ï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆ æ€»ç»“\nçº¿ç¨‹æ˜¯è¿›ç¨‹åˆ’åˆ†æˆçš„æ›´å°è¿è¡Œå•ä½ çº¿ç¨‹å’Œè¿›ç¨‹æœ€å¤§ä¸åŒåœ¨äºå„è¿›ç¨‹åŸºæœ¬ç‹¬ç«‹ï¼Œè€Œå„çº¿ç¨‹ææœ‰å¯èƒ½äº’ç›¸å½±å“ çº¿ç¨‹å¼€é”€å°ï¼Œä½†ä¸åˆ©äºèµ„æºä¿æŠ¤ï¼›è¿›ç¨‹åä¹‹ ç¨‹åºè®¡æ•°å™¨ä¸ºä»€ä¹ˆæ˜¯ç§æœ‰\nç¨‹åºè®¡æ•°å™¨çš„ä½œç”¨\nå•çº¿ç¨‹æƒ…å†µä¸‹ï¼Œå­—èŠ‚ç è§£é‡Šå™¨é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨æ¥ä¾æ¬¡è¯»å–æŒ‡ä»¤ï¼Œä»è€Œå®ç°ä»£ç çš„æµç¨‹æ§åˆ¶ï¼Œå¦‚ï¼šé¡ºåºæ‰§è¡Œã€é€‰æ‹©ã€å¾ªç¯ã€å¼‚å¸¸å¤„ç†ã€‚ åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œç¨‹åºè®¡æ•°å™¨ç”¨äºè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®ï¼Œä»è€Œå½“çº¿ç¨‹è¢«åˆ‡æ¢å›æ¥çš„æ—¶å€™èƒ½å¤ŸçŸ¥é“è¯¥çº¿ç¨‹ä¸Šæ¬¡è¿è¡Œåˆ°å“ªå„¿äº†ã€‚ å¦‚æœæ‰§è¡Œçš„æ˜¯nativeæ–¹æ³•ï¼Œåˆ™ç¨‹åºè®¡æ•°å™¨è®°å½•çš„æ˜¯undefinedåœ°å€ï¼›æ‰§è¡ŒJavaæ–¹æ³•åˆ™è®°å½•çš„æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€\nç§æœ‰ï¼Œæ˜¯ä¸ºäº†çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®\nè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆä¸ºä»€ä¹ˆç§æœ‰\nè™šæ‹Ÿæœºæ ˆï¼šæ¯ä¸ªJavaæ–¹æ³•æ‰§è¡Œæ—¶åŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€å¸¸é‡æ± å¼•ç”¨ç­‰ä¿¡æ¯ æœ¬åœ°æ–¹æ³•æ ˆï¼šå’Œè™šæ‹Ÿæœºæ ˆç±»ä¼¼ï¼ŒåŒºåˆ«æ˜¯è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡ŒJavaæ–¹æ³• ï¼ˆå­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„Nativeæ–¹æ³•æœåŠ¡ã€‚HotSpotè™šæ‹Ÿæœºä¸­å’ŒJavaè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ ä¸ºäº†ä¿è¯çº¿ç¨‹ä¸­å±€éƒ¨å˜é‡ä¸è¢«åˆ«çš„çº¿ç¨‹è®¿é—®åˆ°ï¼Œè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯ç§æœ‰çš„ å †å’Œæ–¹æ³•åŒºæ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„èµ„æºï¼Œå †æ˜¯è¿›ç¨‹ä¸­æœ€å¤§ä¸€å—å†…å­˜ï¼Œç”¨äºå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ï¼ˆå‡ ä¹æ‰€æœ‰å¯¹è±¡éƒ½åœ¨è¿™åˆ†é…å†…å­˜ï¼‰; æ–¹æ³•åŒºåˆ™å­˜æ”¾**å·²è¢«åŠ è½½çš„ ** ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®\nå¹¶å‘ä¸å¹¶è¡Œçš„åŒºåˆ«\nå¹¶å‘ï¼šä¸¤ä¸ªåŠä¸¤ä¸ªä»¥ä¸Šçš„ä½œä¸šåœ¨åŒä¸€æ—¶é—´æ®µå†…æ‰§è¡Œï¼ˆçº¿ç¨‹ï¼ŒåŒä¸€ä¸ªä»£ç åŒä¸€ç§’åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼‰ å¹¶è¡Œï¼šä¸¤ä¸ªåŠä¸¤ä¸ªä»¥ä¸Šçš„ä½œä¸šåŒä¸€æ—¶åˆ»æ‰§è¡Œ å…³é”®ç‚¹ï¼šæ˜¯å¦åŒæ—¶æ‰§è¡Œï¼Œåªæœ‰å¹¶è¡Œæ‰èƒ½åŒæ—¶æ‰§è¡Œ åŒæ­¥å’Œå¼‚æ­¥\nåŒæ­¥ï¼šå‘å‡ºè°ƒç”¨åï¼Œæ²¡æœ‰å¾—åˆ°ç»“æœå‰ï¼Œè¯¥è°ƒç”¨ä¸èƒ½è¿”å›ï¼Œä¸€ç›´ç­‰å¾… å¼‚æ­¥ï¼šå‘å‡ºè°ƒç”¨åï¼Œä¸ç”¨ç­‰è¿”å›ç»“æœï¼Œè¯¥è°ƒç”¨ç›´æ¥è¿”å› ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹\nä»è®¡ç®—æœºåº•å±‚æ¥è¯´ï¼šçº¿ç¨‹æ˜¯è½»é‡çº§è¿›ç¨‹ï¼Œç¨‹åºæ‰§è¡Œæœ€å°å•ä½ï¼Œçº¿ç¨‹é—´åˆ‡æ¢å’Œè°ƒåº¦ æˆæœ¬è¿œå°äºè¿›ç¨‹ã€‚å¤šæ ¸CPUæ—¶ä»£æ„å‘³ç€å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¿è¡Œï¼Œå‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ ä»å½“ä»£äº’è”ç½‘å‘å±•è¶‹åŠ¿ï¼šå¦‚ä»Šç³»ç»Ÿå¹¶å‘é‡å¤§ï¼Œåˆ©ç”¨å¤šçº¿ç¨‹æœºåˆ¶å¯ä»¥å¤§å¤§æé«˜ç³»ç»Ÿæ•´ä½“å¹¶å‘èƒ½åŠ›åŠæ€§èƒ½ æ·±å…¥è®¡ç®—æœºåº•å±‚ å•æ ¸æ—¶ä»£ï¼šæé«˜å•è¿›ç¨‹åˆ©ç”¨CPUå’ŒIOç³»ç»Ÿçš„æ•ˆç‡ã€‚å½“è¯·æ±‚IOçš„æ—¶å€™ï¼Œå¦‚æœJavaè¿›ç¨‹ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œæ­¤çº¿ç¨‹è¢«IOé˜»å¡åˆ™æ•´ä¸ªè¿›ç¨‹è¢«é˜»å¡ï¼ŒCPUå’ŒIOè®¾å¤‡åªæœ‰ä¸€ä¸ªè¿è¡Œï¼Œç³»ç»Ÿæ•´ä½“æ•ˆç‡50%ï¼›è€Œå¤šçº¿ç¨‹æ—¶ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹è¢«IOé˜»å¡ï¼Œå…¶ä»–çº¿ç¨‹è¿˜å¯ä»¥ç»§ç»­ä½¿ç”¨CPU å¤šæ ¸æ—¶ä»£ï¼šå¤šæ ¸æ—¶ä»£å¤šçº¿ç¨‹ä¸»è¦æ˜¯æé«˜è¿›ç¨‹åˆ©ç”¨å¤šæ ¸CPUçš„èƒ½åŠ›ï¼Œå¦‚æœè¦è®¡ç®—å¤æ‚ä»»åŠ¡ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„è¯ï¼Œä¸è®ºç³»ç»Ÿå‡ ä¸ªCPUæ ¸å¿ƒï¼Œéƒ½åªæœ‰ä¸€ä¸ªCPUæ ¸å¿ƒè¢«åˆ©ç”¨ï¼›è€Œåˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹å¯ä»¥è¢«æ˜ å°„åˆ°åº•å±‚å¤šä¸ªCPUä¸Šæ‰§è¡Œï¼Œå¦‚æœä»»åŠ¡ä¸­çš„å¤šä¸ªçº¿ç¨‹æ²¡æœ‰èµ„æºç«äº‰ï¼Œé‚£ä¹ˆæ‰§è¡Œæ•ˆç‡ä¼šæ˜¾è‘—æé«˜ å¤šçº¿ç¨‹å¸¦æ¥çš„é—®é¢˜ï¼šå†…å­˜æ³„æ¼ï¼ˆå¯¹è±¡ï¼Œæ²¡æœ‰é‡Šæ”¾ï¼‰ã€æ­»é”ã€çº¿ç¨‹ä¸å®‰å…¨ç­‰\nè¯´è¯´çº¿ç¨‹çš„å£°æ˜å‘¨æœŸå’ŒçŠ¶æ€ Javaçº¿ç¨‹åœ¨è¿è¡Œçš„ç”Ÿå‘½å‘¨æœŸä¸­çš„æŒ‡å®šæ—¶åˆ»ï¼Œåªå¯èƒ½å¤„äºä¸‹é¢6ç§ä¸åŒçŠ¶æ€ä¸­çš„ä¸€ä¸ª\nNEWï¼šåˆå§‹çŠ¶æ€ï¼Œçº¿ç¨‹è¢«åˆ›å»ºå‡ºæ¥ä½†æ²¡æœ‰è°ƒç”¨start()\nRUNNABLEï¼šè¿è¡ŒçŠ¶æ€ï¼Œçº¿ç¨‹è¢«è°ƒç”¨äº†start() ç­‰å¾…è¿è¡Œçš„çŠ¶æ€\nBLOCKEDï¼šé˜»å¡çŠ¶æ€ï¼Œéœ€è¦ç­‰å¾…é”é‡Šæ”¾\nWAITINGï¼šç­‰å¾…çŠ¶æ€ï¼Œè¡¨ç¤ºè¯¥çº¿ç¨‹éœ€è¦ç­‰å¾…å…¶ä»–çº¿ç¨‹åšå‡ºä¸€äº›ç‰¹å®šåŠ¨ä½œï¼ˆé€šçŸ¥æˆ–ä¸­æ–­ï¼‰\nTIME_WAITINGï¼šè¶…æ—¶ç­‰å¾…çŠ¶æ€ï¼Œåœ¨æŒ‡å®šçš„æ—¶é—´åè‡ªè¡Œè¿”å›è€Œä¸æ˜¯åƒWAITINGä¸€ç›´ç­‰å¾…\nTERMINATEDï¼šç»ˆæ­¢çŠ¶æ€ï¼Œè¡¨ç¤ºè¯¥çº¿ç¨‹å·²ç»è¿è¡Œå®Œæ¯• å¦‚å›¾\nå¯¹äºè¯¥å›¾æœ‰ä»¥ä¸‹å‡ ç‚¹è¦æ³¨æ„ï¼š\nçº¿ç¨‹åˆ›å»ºåå¤„äºNEWçŠ¶æ€ï¼Œä¹‹åè°ƒç”¨start()æ–¹æ³•è¿è¡Œï¼Œæ­¤æ—¶çº¿ç¨‹å¤„äºREADYï¼Œå¯è¿è¡Œçš„çº¿ç¨‹è·å¾—CPUæ—¶é—´ç‰‡ï¼ˆtimesliceï¼‰åå¤„äºRUNNINGçŠ¶æ€\næ“ä½œç³»ç»Ÿä¸­æœ‰READYå’ŒRUNNINGä¸¤ä¸ªçŠ¶æ€ï¼Œè€ŒJVMä¸­åªæœ‰RUNNABLEçŠ¶æ€ ç°åœ¨çš„æ“ä½œç³»ç»Ÿé€šå¸¸éƒ½æ˜¯**â€œæ—¶é—´åˆ†ç‰‡â€œæ–¹æ³•è¿›è¡ŒæŠ¢å å¼ è½®è½¬è°ƒåº¦**â€œï¼Œä¸€ä¸ªçº¿ç¨‹æœ€å¤šåªèƒ½åœ¨CPUä¸Šè¿è¡Œ10-20msçš„æ—¶é—´ï¼ˆæ­¤æ—¶å¤„äºRUNNING)çŠ¶æ€ï¼Œæ—¶é—´è¿‡çŸ­ï¼Œæ—¶é—´ç‰‡ä¹‹åæ”¾å…¥è°ƒåº¦é˜Ÿåˆ—æœ«å°¾ç­‰å¾…å†æ¬¡è°ƒåº¦ï¼ˆå›åˆ°READYçŠ¶æ€ï¼‰ï¼Œå¤ªå¿«æ‰€ä»¥ä¸åŒºåˆ†ä¸¤ç§çŠ¶æ€ çº¿ç¨‹æ‰§è¡Œwait()æ–¹æ³•åï¼Œè¿›å…¥WAITING(ç­‰å¾… )çŠ¶æ€ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹éœ€è¦ä¾é å…¶ä»–çº¿ç¨‹é€šçŸ¥æ‰èƒ½å›åˆ°è¿è¡ŒçŠ¶æ€\nTIMED_WAITING(è¶…æ—¶ç­‰å¾…)çŠ¶æ€ï¼Œåœ¨ç­‰å¾…çŠ¶æ€çš„åŸºç¡€ä¸Šå¢åŠ è¶…æ—¶é™åˆ¶ï¼Œé€šè¿‡sleep(long millis)æˆ–wait(long millis) æ–¹æ³•å¯ä»¥å°†çº¿ç¨‹ç½®äºTIMED_WAITINGçŠ¶æ€ï¼Œè¶…æ—¶ç»“æŸåè¿”å›åˆ°RUNNABLEçŠ¶æ€ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯RUNNINGï¼‰\nå½“çº¿ç¨‹è¿›å…¥synchronizedæ–¹æ³•/å—æˆ–è€…è°ƒç”¨waitå(è¢«notify)é‡æ–°è¿›å…¥synchronizedæ–¹æ³•/å—ï¼Œä½†æ˜¯é”è¢«å…¶ä»–çº¿ç¨‹å æœ‰ï¼Œè¿™ä¸ªæ—¶å€™çº¿ç¨‹å°±ä¼šè¿›å…¥BLOCKEDï¼ˆé˜»å¡ï¼‰çŠ¶æ€\nçº¿ç¨‹åœ¨æ‰§è¡Œå®Œäº†**run()æ–¹æ³•ä¹‹åå°±ä¼šè¿›å…¥åˆ°TERMINATEDï¼ˆç»ˆæ­¢ï¼‰**çŠ¶æ€\næ³¨æ„ä¸Šè¿°ï¼Œé˜»å¡å’Œç­‰å¾…çš„åŒºåˆ«\nä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢\nçº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šæœ‰è‡ªå·±çš„è¿è¡Œæ¡ä»¶å’ŒçŠ¶æ€ï¼ˆä¹Ÿç§°ä¸Šä¸‹æ–‡ï¼‰ï¼Œæ¯”å¦‚ä¸Šæ–‡æåˆ°çš„ç¨‹åºè®¡æ•°å™¨ï¼Œæ ˆä¿¡æ¯ç­‰ã€‚å½“å‡ºç°ä¸‹é¢æƒ…å†µæ—¶ï¼Œçº¿ç¨‹ä»å ç”¨CPUçŠ¶æ€ä¸­é€€å‡ºï¼š\nä¸»åŠ¨è®©å‡ºCPUï¼Œå¦‚sleep(),wait()ç­‰ æ—¶é—´ç‰‡ç”¨å®Œäº† è°ƒç”¨äº†é˜»å¡ç±»å‹çš„ç³»ç»Ÿä¸­æ–­ï¼ˆè¯·æ±‚IOï¼Œçº¿ç¨‹è¢«é˜»å¡ï¼‰ è¢«ç»ˆæ­¢æˆ–ç»“æŸè¿è¡Œ å‰3ç§ä¼šå‘ç”Ÿçº¿ç¨‹åˆ‡æ¢ï¼šéœ€è¦ä¿å­˜å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼Œç•™å¾…çº¿ç¨‹ä¸‹æ¬¡å ç”¨CPUçš„æ—¶å€™æ¢å¤ï¼Œå¹¶åŠ è½½ä¸‹ä¸€ä¸ªå°†è¦å ç”¨CPUçš„çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼Œå³æ‰€è°“çš„ä¸Šä¸‹æ–‡åˆ‡æ¢\næ˜¯ç°ä»£ç³»ç»ŸåŸºæœ¬åŠŸèƒ½ï¼Œæ¯æ¬¡éƒ½è¦ä¿å­˜ä¿¡æ¯æ¢å¤ä¿¡æ¯ï¼Œå°†ä¼šå ç”¨CPUï¼Œå†…å­˜ç­‰ç³»ç»Ÿèµ„æºï¼Œå³æ•ˆç‡æœ‰ä¸€å®šæŸè€—ï¼Œé¢‘ç¹åˆ‡æ¢ä¼šé€ æˆæ•´ä½“æ•ˆç‡ä½ä¸‹\nçº¿ç¨‹æ­»é”æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é¿å…?\nå¤šä¸ªçº¿ç¨‹åŒæ—¶è¢«é˜»å¡ï¼Œå®ƒä»¬ä¸­çš„ä¸€ä¸ªæˆ–è€…å…¨éƒ¨ï¼Œéƒ½åœ¨ç­‰å¾…æŸä¸ªèµ„æºè¢«é‡Šæ”¾ã€‚ç”±äºçº¿ç¨‹è¢«æ— é™æœŸåœ°é˜»å¡ï¼Œå› æ­¤ç¨‹åºä¸å¯èƒ½æ­£å¸¸ç»ˆæ­¢\nå‰æï¼šçº¿ç¨‹AæŒæœ‰èµ„æº2ï¼Œçº¿ç¨‹BæŒæœ‰èµ„æº1ã€‚ç°è±¡ï¼šçº¿ç¨‹Aåœ¨ç­‰å¾…ç”³è¯·èµ„æº1ï¼Œçº¿ç¨‹Båœ¨ç­‰å¾…ç”³è¯·èµ„æº2ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªçº¿ç¨‹å°±ä¼šäº’ç›¸ç­‰å¾…è€Œè¿›å…¥æ­»é”çŠ¶æ€ ä½¿ç”¨ä»£ç æè¿°ä¸Šè¿°é—®é¢˜\npublic class DeadLockDemo { private static Object resource1 = new Object();//èµ„æº 1 private static Object resource2 = new Object();//èµ„æº 2 public static void main(String[] args) { new Thread(() -\u0026gt; { synchronized (resource1) { System.out.println(Thread.currentThread() + \u0026#34;get resource1\u0026#34;); try { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread() + \u0026#34;waiting get resource2\u0026#34;); synchronized (resource2) { System.out.println(Thread.currentThread() + \u0026#34;get resource2\u0026#34;); } } }, \u0026#34;çº¿ç¨‹ 1\u0026#34;).start(); new Thread(() -\u0026gt; { synchronized (resource2) { System.out.println(Thread.currentThread() + \u0026#34;get resource2\u0026#34;); try { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread() + \u0026#34;waiting get resource1\u0026#34;); synchronized (resource1) { System.out.println(Thread.currentThread() + \u0026#34;get resource1\u0026#34;); } } }, \u0026#34;çº¿ç¨‹ 2\u0026#34;).start(); } } /* - çº¿ç¨‹Aé€šè¿‡synchronized(resource1)è·å¾—resource1çš„ç›‘è§†å™¨é”ï¼Œç„¶åä¼‘çœ 1sï¼ˆæ˜¯ä¸ºäº†ä¿è¯çº¿ç¨‹Bè·å¾—æ‰§è¡Œç„¶åæ‹¿åˆ°resource2ç›‘è§†å™¨é”ï¼‰ - ä¼‘çœ ç»“æŸäº†ä¸¤çº¿ç¨‹éƒ½ä¼å›¾è¯·æ±‚è·å¾—å¯¹æ–¹çš„èµ„æºï¼Œé™·å…¥äº’ç›¸ç­‰å¾…çš„çŠ¶æ€ï¼Œäºæ˜¯äº§ç”Ÿäº†æ­»é” */ æ­»é”äº§ç”Ÿæ¡ä»¶\näº’æ–¥ï¼šè¯¥èµ„æºä»»æ„ä¸€ä¸ªæ—¶åˆ»åªç”±ä¸€ä¸ªçº¿ç¨‹å æœ‰ è¯·æ±‚ä¸ä¿æŒï¼šä¸€çº¿ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ ä¸å‰¥å¤ºæ¡ä»¶ï¼šçº¿ç¨‹å·²è·å¾—çš„èµ„æºæœªä½¿ç”¨å®Œä¹‹å‰ä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹å¼ºè¡Œå‰¥å¤ºï¼Œåªæœ‰è‡ªå·±ä½¿ç”¨å®Œæ‰é‡Šæ”¾ï¼ˆèµ„æºï¼‰ å¾ªç¯ç­‰å¾…ï¼šè‹¥å¹²çº¿ç¨‹ä¹‹é—´å½¢æˆå¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³» å¦‚ä½•é¢„é˜²æ­»é”\u0026mdash;\u0026gt;ç ´åæ­»é”çš„å¿…è¦æ¡ä»¶\nç ´åè¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼šä¸€æ¬¡æ€§ç”³è¯·æ‰€æœ‰èµ„æº ç ´åä¸å‰¥å¤ºæ¡ä»¶ï¼šå ç”¨éƒ¨åˆ†èµ„æºçš„çº¿ç¨‹è¿›ä¸€æ­¥ç”³è¯·å…¶ä»–èµ„æºæ—¶ï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œå¯ä»¥ä¸»åŠ¨é‡Šæ”¾å®ƒå æœ‰çš„èµ„æº ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶ï¼šé æŒ‰éœ€ç”³è¯·èµ„æºæ¥é¢„é˜²ï¼ˆæŒ‰æŸé¡ºåºç”³è¯·èµ„æºï¼Œé‡Šæ”¾èµ„æºæ—¶ååºï¼‰ å¦‚ä½•å°†é¿å…æ­»é”\nåœ¨èµ„æºåˆ†é…æ—¶ï¼Œå€ŸåŠ©äºç®—æ³•ï¼ˆé“¶è¡Œå®¶ç®—æ³•)å¯¹èµ„æºåˆ†é…è®¡ç®—è¯„ä¼°ï¼Œä½¿å…¶è¿›å…¥å®‰å…¨çŠ¶æ€\nå®‰å…¨çŠ¶æ€ æŒ‡çš„æ˜¯ç³»ç»Ÿèƒ½å¤ŸæŒ‰ç…§æŸç§çº¿ç¨‹æ¨è¿›é¡ºåºï¼ˆP1ã€P2ã€P3\u0026hellip;..Pnï¼‰æ¥ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…æ‰€éœ€èµ„æºï¼Œç›´åˆ°æ»¡è¶³æ¯ä¸ªçº¿ç¨‹å¯¹èµ„æºçš„æœ€å¤§éœ€æ±‚ï¼Œä½¿æ¯ä¸ªçº¿ç¨‹éƒ½å¯é¡ºåˆ©å®Œæˆã€‚ç§° \u0026lt;P1ã€P2ã€P3.....Pn\u0026gt; åºåˆ—ä¸ºå®‰å…¨åºåˆ—\nä¿®æ”¹çº¿ç¨‹2çš„ä»£ç  åŸçº¿ç¨‹1ä»£ç ä¸å˜\nnew Thread(() -\u0026gt; { synchronized (resource1) { System.out.println(Thread.currentThread() + \u0026#34;get resource1\u0026#34;); try { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread() + \u0026#34;waiting get resource2\u0026#34;); synchronized (resource2) { System.out.println(Thread.currentThread() + \u0026#34;get resource2\u0026#34;); } } }, \u0026#34;çº¿ç¨‹ 1\u0026#34;).start(); çº¿ç¨‹2ä»£ç ä¿®æ”¹ï¼š\nnew Thread(() -\u0026gt; { synchronized (resource1) { System.out.println(Thread.currentThread() + \u0026#34;get resource1\u0026#34;); try { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread() + \u0026#34;waiting get resource2\u0026#34;); synchronized (resource2) { System.out.println(Thread.currentThread() + \u0026#34;get resource2\u0026#34;); } } }, \u0026#34;çº¿ç¨‹ 2\u0026#34;).start(); /* è¾“å‡º Thread[çº¿ç¨‹ 1,5,main]get resource1 Thread[çº¿ç¨‹ 1,5,main]waiting get resource2 Thread[çº¿ç¨‹ 1,5,main]get resource2 Thread[çº¿ç¨‹ 2,5,main]get resource1 Thread[çº¿ç¨‹ 2,5,main]waiting get resource2 Thread[çº¿ç¨‹ 2,5,main]get resource2\nProcess finished with exit code 0 */\nåˆ†æ \u0026gt; çº¿ç¨‹ 1 é¦–å…ˆè·å¾—åˆ° resource1 çš„ç›‘è§†å™¨é”,è¿™æ—¶å€™çº¿ç¨‹ 2 å°±è·å–ä¸åˆ°äº†ã€‚ç„¶åçº¿ç¨‹ 1 å†å»è·å– resource2 çš„ç›‘è§†å™¨é”ï¼Œå¯ä»¥è·å–åˆ°ã€‚ç„¶å**çº¿ç¨‹ 1 é‡Šæ”¾äº†å¯¹ resource1ã€resource2 çš„ç›‘è§†å™¨é”çš„å ç”¨ï¼Œçº¿ç¨‹ 2 è·å–åˆ°ï¼ˆresource1ï¼‰å°±å¯ä»¥æ‰§è¡Œäº†**ã€‚è¿™æ ·å°±ç ´åäº†ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶ï¼Œå› æ­¤é¿å…äº†æ­»é”ã€‚ sleep()æ–¹æ³•å’Œwait()æ–¹æ³•å¯¹æ¯”\nå…±åŒç‚¹ï¼š ä¸¤è€…éƒ½å¯æš‚åœçº¿ç¨‹æ‰§è¡Œ åŒºåˆ« seep() æ–¹æ³•æ²¡æœ‰é‡Šæ”¾é”ï¼Œwait() æ–¹æ³•é‡Šæ”¾äº†é” wait() é€šå¸¸ç”¨äºçº¿ç¨‹é—´äº¤äº’/é€šä¿¡ï¼Œsleep()ç”¨äºæš‚åœæ‰§è¡Œ wait()æ–¹æ³•è¢«è°ƒç”¨åï¼Œçº¿ç¨‹ä¸ä¼šè‡ªåŠ¨è‹é†’ï¼Œéœ€è¦åˆ«çš„çº¿ç¨‹è°ƒç”¨åŒä¸€å¯¹è±¡ï¼ˆç›‘è§†å™¨monitorï¼‰çš„notify()æˆ–è€…notifyAll()æ–¹æ³•ï¼›sleep()æ–¹æ³•æ‰§è¡Œå®Œæˆå/æˆ–è€…wait(long timeout)è¶…æ—¶åï¼Œçº¿ç¨‹ä¼šè‡ªåŠ¨è‹é†’ sleepæ—¶Threadç±»çš„é™æ€æœ¬åœ°æ–¹æ³•ï¼Œwait()åˆ™æ˜¯Objectç±»çš„æœ¬åœ°æ–¹æ³• ä¸ºä»€ä¹ˆwait()æ–¹æ³•ä¸å®šä¹‰åœ¨Threadä¸­\nwait() ç›®çš„æ˜¯è®©è·å¾—å¯¹è±¡é”çš„çº¿ç¨‹å®ç°ç­‰å¾…ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾å½“å‰çº¿ç¨‹å æœ‰çš„å¯¹è±¡é” æ¯ä¸ªå¯¹è±¡(Object)éƒ½æ‹¥æœ‰å¯¹è±¡é”ï¼Œæ—¢ç„¶æ˜¯è®©è·å¾—å¯¹è±¡é”çš„çº¿ç¨‹ç­‰å¾…ï¼Œæ‰€ä»¥æ–¹æ³•åº”è¯¥å‡ºç°åœ¨å¯¹è±¡Objectä¸Š sleep()æ˜¯è®©å½“å‰çº¿ç¨‹æš‚åœæ‰§è¡Œï¼Œä¸æ¶‰åŠå¯¹è±¡ç±»ï¼Œä¹Ÿä¸éœ€è¦è·å¾—å¯¹è±¡é” å¯ä»¥ç›´æ¥è°ƒç”¨Threadç±»çš„runæ–¹æ³•å—\nnewä¸€ä¸ªThreadä¹‹åï¼Œçº¿ç¨‹è¿›å…¥æ–°å»ºçŠ¶æ€ è°ƒç”¨start()ï¼Œä¼šå¯åŠ¨çº¿ç¨‹å¹¶ä½¿ä»–è¿›å…¥å°±ç»ªçŠ¶æ€ï¼ˆRunableï¼Œå¯è¿è¡ŒçŠ¶æ€ï¼Œåˆåˆ†ä¸ºReadyå’ŒRunningï¼‰ï¼Œåˆ†é…åˆ°æ—¶é—´ç‰‡åå°±å¼€å§‹è¿è¡Œ start()æ‰§è¡Œçº¿ç¨‹ç›¸åº”å‡†å¤‡å·¥ä½œï¼Œä¹‹å**è‡ªåŠ¨æ‰§è¡Œrun()**æ–¹æ³•çš„å†…å®¹ å¦‚æœç›´æ¥æ‰§è¡Œrun()æ–¹æ³•ï¼Œåˆ™ä¼šæŠŠrun()æ–¹æ³•å½“ä½œmainçº¿ç¨‹ä¸‹æ™®é€šæ–¹æ³•å»æ‰§è¡Œï¼Œå¹¶ä¸ä¼šåœ¨æŸä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œå®ƒ åªæœ‰è°ƒç”¨start()æ–¹æ³•æ‰å¯ä»¥å¯åŠ¨æ–°çš„çº¿ç¨‹ä½¿ä»–è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œç­‰å¾…è·å–æ—¶é—´ç‰‡åè¿è¡Œ "},{"id":144,"href":"/zh/docs/study/Review/java_guide/java/IO/ly0203lyio-model/","title":"ioæ¨¡å‹","section":"IO","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nhttps://zhuanlan.zhihu.com/p/360878783 IOå¤šè·¯å¤ç”¨è®²è§£ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸ç³»ç»Ÿåº•å±‚æœ‰å…³çš„çŸ¥è¯†ç‚¹ï¼Œéœ€è¦ä¸€äº›æ“ä½œç³»ç»Ÿè°ƒç”¨ä»£ç æ‰çŸ¥é“IOå¤šè·¯å¤ç”¨çœçš„æ—¶é—´ã€‚\nI/O # ä½•ä¸ºI/O # I/O(Input/Output)ï¼Œå³è¾“å…¥/è¾“å‡º ä»è®¡ç®—æœºç»“æ„çš„è§’åº¦æ¥è§£è¯»ä¸€ä¸‹I/Oï¼Œæ ¹æ®å†¯è¯ºä¾æ›¼ç»“æ„ï¼Œè®¡ç®—æœºç»“æ„åˆ†ä¸º5å¤§éƒ¨åˆ†ï¼šè¿ç®—å™¨ã€æ§åˆ¶å™¨ã€å­˜å‚¨å™¨ã€è¾“å…¥è®¾å¤‡ã€è¾“å‡ºè®¾å¤‡ å…¶ä¸­ï¼Œè¾“å…¥è®¾å¤‡ï¼šé”®ç›˜ï¼›è¾“å‡ºè®¾å¤‡ï¼šæ˜¾ç¤ºå™¨ ç½‘å¡ã€ç¡¬ç›˜æ—¢å±äºè¾“å…¥è®¾å¤‡ä¹Ÿå±äºè¾“å‡ºè®¾å¤‡ è¾“å…¥è®¾å¤‡å‘è®¡ç®—æœºè¾“å…¥ï¼ˆå†…å­˜ï¼‰æ•°æ®ï¼Œè¾“å‡ºè®¾å¤‡æ¥æ”¶è®¡ç®—æœºï¼ˆå†…å­˜ï¼‰è¾“å‡ºçš„æ•°æ®ï¼Œå³I/Oæè¿°äº†è®¡ç®—æœºç³»ç»Ÿä¸å¤–éƒ¨è®¾å¤‡ä¹‹é—´é€šä¿¡çš„è¿‡ç¨‹ ä»åº”ç”¨ç¨‹åºçš„è§’åº¦è§£è¯»I/O ä¸ºäº†ä¿è¯ç³»ç»Ÿç¨³å®šæ€§å’Œå®‰å…¨æ€§ï¼Œä¸€ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´åˆ’åˆ†ä¸ºç”¨æˆ·ç©ºé—´User spaceå’Œå†…æ ¸ç©ºé—´Kernel space kernel\tè‹±[ËˆkÉœËnl] å¹³å¸¸è¿è¡Œçš„åº”ç”¨ç¨‹åºéƒ½è¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´ï¼Œåªæœ‰å†…æ ¸ç©ºé—´æ‰èƒ½è¿›è¡Œç³»ç»Ÿæ€çº§åˆ«çš„èµ„æºæœ‰å…³æ“ä½œ\u0026mdash;æ–‡ä»¶ç®¡ç†ã€è¿›ç¨‹é€šä¿¡ã€å†…å­˜ç®¡ç† å¦‚æœè¦è¿›è¡ŒIOæ“ä½œï¼Œå°±å¾—ä¾èµ–å†…æ ¸ç©ºé—´çš„èƒ½åŠ›ï¼Œç”¨æˆ·ç©ºé—´çš„ç¨‹åºä¸èƒ½ç›´æ¥è®¿é—®å†…æ ¸ç©ºé—´ ç”¨æˆ·è¿›ç¨‹è¦æƒ³æ‰§è¡ŒIOæ“ä½œï¼Œå¿…é¡»é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥é—´æ¥è®¿é—®å†…æ ¸ç©ºé—´ å¯¹äºç£ç›˜IOï¼ˆè¯»å†™æ–‡ä»¶ï¼‰å’Œç½‘ç»œIOï¼ˆç½‘ç»œè¯·æ±‚å’Œå“åº”ï¼‰ï¼Œä»åº”ç”¨ç¨‹åºè§†è§’æ¥çœ‹ï¼Œåº”ç”¨ç¨‹åºå¯¹æ“ä½œç³»ç»Ÿçš„å†…æ ¸å‘èµ·IOè°ƒç”¨ï¼ˆç³»ç»Ÿè°ƒç”¨ï¼‰ï¼Œæ“ä½œç³»ç»Ÿè´Ÿè´£çš„å†…æ ¸æ‰§è¡Œå…·ä½“IOæ“ä½œ åº”ç”¨ç¨‹åºåªæ˜¯å‘èµ·äº†IOæ“ä½œè°ƒç”¨ï¼Œè€Œå…·ä½“çš„IOæ‰§è¡Œåˆ™ç”±æ“ä½œç³»ç»Ÿå†…æ ¸å®Œæˆ åº”ç”¨ç¨‹åºå‘èµ·I/Oåï¼Œç»å†ä¸¤ä¸ªæ­¥éª¤ å†…æ ¸ç­‰å¾…I/Oè®¾å¤‡å‡†å¤‡å¥½æ•°æ® å†…æ ¸å°†æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ æœ‰å“ªäº›å¸¸è§çš„IOæ¨¡å‹ # UNIXç³»ç»Ÿä¸‹ï¼ŒåŒ…æ‹¬5ç§ï¼šåŒæ­¥é˜»å¡I/Oï¼ŒåŒæ­¥éé˜»å¡I/Oï¼ŒI/Oå¤šè·¯å¤ç”¨ã€ä¿¡å·é©±åŠ¨I/Oå’Œå¼‚æ­¥I/O\nJavaä¸­3ä¸­å¸¸è§I/Oæ¨¡å‹ # BIO (Blocking I/O ) # åº”ç”¨ç¨‹åºå‘èµ·readè°ƒç”¨åï¼Œä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°å†…æ ¸æŠŠæ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ NIO (Non-blocking/New I/O) # å¯¹äºjava.nioåŒ…ï¼Œæä¾›äº†Channelã€Selectorã€Bufferç­‰æŠ½è±¡æ¦‚å¿µï¼Œå¯¹äºé«˜è´Ÿè½½é«˜å¹¶å‘ï¼Œåº”ä½¿ç”¨NIO NIOæ˜¯I/Oå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Œå±äºåŒæ­¥éé˜»å¡IOæ¨¡å‹ ä¸€èˆ¬çš„åŒæ­¥éé˜»å¡ IO æ¨¡å‹ä¸­ï¼Œåº”ç”¨ç¨‹åºä¼šä¸€ç›´å‘èµ· read è°ƒç”¨ã€‚\nç­‰å¾…æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´çš„è¿™æ®µæ—¶é—´é‡Œï¼Œçº¿ç¨‹ä¾ç„¶æ˜¯é˜»å¡çš„**ï¼Œ**ç›´åˆ°åœ¨å†…æ ¸æŠŠæ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚\nç›¸æ¯”äºåŒæ­¥é˜»å¡ IO æ¨¡å‹ï¼ŒåŒæ­¥éé˜»å¡ IO æ¨¡å‹ç¡®å®æœ‰äº†å¾ˆå¤§æ”¹è¿›ã€‚é€šè¿‡è½®è¯¢æ“ä½œï¼Œé¿å…äº†ä¸€ç›´é˜»å¡ã€‚\nä½†æ˜¯ï¼Œè¿™ç§ IO æ¨¡å‹åŒæ ·å­˜åœ¨é—®é¢˜ï¼šåº”ç”¨ç¨‹åºä¸æ–­è¿›è¡Œ I/O ç³»ç»Ÿè°ƒç”¨è½®è¯¢æ•°æ®æ˜¯å¦å·²ç»å‡†å¤‡å¥½çš„è¿‡ç¨‹æ˜¯ååˆ†æ¶ˆè€— CPU èµ„æºçš„ã€‚\nâ˜…â˜… ä¹Ÿå°±æ˜¯è¯´ï¼Œã€å‡†å¤‡æ•°æ®ï¼Œæ•°æ®å°±ç»ªã€‘æ˜¯ä¸é˜»å¡çš„ã€‚è€Œã€æ‹·è´æ•°æ®ã€‘æ˜¯é˜»å¡çš„ I/Oå¤šè·¯å¤ç”¨ çº¿ç¨‹é¦–å…ˆå‘èµ·selectè°ƒç”¨ï¼Œè¯¢é—®å†…æ ¸æ•°æ®æ˜¯å¦å‡†å¤‡å°±ç»ªï¼Œç­‰å‡†å¤‡å¥½äº†ï¼Œç”¨æˆ·çº¿ç¨‹å†å‘èµ·readè°ƒç”¨ï¼Œr**eadè°ƒç”¨çš„è¿‡ç¨‹ï¼ˆæ•°æ®ä»å†…æ ¸ç©ºé—´\u0026ndash;\u0026gt;ç”¨æˆ·ç©ºé—´ï¼‰**è¿˜æ˜¯é˜»å¡çš„\nIO å¤šè·¯å¤ç”¨æ¨¡å‹ï¼Œé€šè¿‡å‡å°‘æ— æ•ˆçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå‡å°‘äº†å¯¹ CPU èµ„æºçš„æ¶ˆè€—ã€‚\nJava ä¸­çš„ NIO ï¼Œæœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„é€‰æ‹©å™¨ ( Selector ) çš„æ¦‚å¿µï¼Œä¹Ÿå¯ä»¥è¢«ç§°ä¸º å¤šè·¯å¤ç”¨å™¨ã€‚é€šè¿‡å®ƒï¼Œåªéœ€è¦ä¸€ä¸ªçº¿ç¨‹ä¾¿å¯ä»¥ç®¡ç†å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ã€‚å½“å®¢æˆ·ç«¯æ•°æ®åˆ°äº†ä¹‹åï¼Œæ‰ä¼šä¸ºå…¶æœåŠ¡ã€‚\nSelectorï¼Œå³å¤šè·¯å¤ç”¨å™¨ï¼Œä¸€ä¸ªçº¿ç¨‹ç®¡ç†å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ AIO(Asynchronous I/O ) # å¼‚æ­¥ IO æ˜¯åŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æ“ä½œä¹‹åä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå µå¡åœ¨é‚£é‡Œï¼Œå½“åå°å¤„ç†å®Œæˆï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥ç›¸åº”çš„çº¿ç¨‹è¿›è¡Œåç»­çš„æ“ä½œ å¦‚å›¾\nä¸‰è€…åŒºåˆ« # "},{"id":145,"href":"/zh/docs/study/Review/java_guide/java/IO/ly0202lyio-design-patterns/","title":"ioè®¾è®¡æ¨¡å¼","section":"IO","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nè£…é¥°å™¨æ¨¡å¼ # â€‹\tç±»å›¾ï¼š\nâ€‹\tè£…é¥°å™¨ï¼ŒDecoratorï¼Œè£…é¥°å™¨æ¨¡å¼å¯ä»¥åœ¨ä¸æ”¹å˜åŸæœ‰å¯¹è±¡çš„æƒ…å†µä¸‹æ‹“å±•å…¶åŠŸèƒ½\nâ˜…è£…é¥°å™¨æ¨¡å¼ï¼Œé€šè¿‡ç»„åˆæ›¿ä»£ç»§æ‰¿æ¥æ‰©å±•åŸå§‹ç±»åŠŸèƒ½ï¼Œåœ¨ä¸€äº›ç»§æ‰¿å…³ç³»è¾ƒå¤æ‚çš„åœºæ™¯ï¼ˆIOè¿™ä¸€åœºæ™¯å„ç§ç±»çš„ç»§æ‰¿å…³ç³»å°±æ¯”è¾ƒå¤æ‚ï¼‰ä¸‹æ›´åŠ å®ç”¨\nå¯¹äºå­—èŠ‚æµï¼ŒFilterInputStreamï¼ˆå¯¹åº”è¾“å…¥æµï¼‰å’ŒFilterOutputStreamï¼ˆå¯¹åº”è¾“å‡ºæµï¼‰æ˜¯è£…é¥°å™¨æ¨¡å¼çš„æ ¸å¿ƒï¼Œåˆ†åˆ«ç”¨äºå¢å¼ºï¼ˆç»§æ‰¿äº†ï¼‰InputStreamå’ŒOutputStreamå­ç±»å¯¹è±¡çš„åŠŸèƒ½ Filter ï¼ˆè¿‡æ»¤çš„æ„æ€ï¼‰ï¼Œä¸­é—´ï¼ˆCloseableï¼‰ä¸‹é¢è¿™ä¸¤æ¡è™šçº¿ä»£è¡¨å®ç°ï¼›æœ€ä¸‹é¢çš„å®çº¿ä»£è¡¨ç»§æ‰¿ å…¶ä¸­BufferedInputStreamï¼ˆå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼‰ã€DataInputStreamç­‰ç­‰éƒ½æ˜¯FilterInputStreamçš„å­ç±»ï¼Œå¯¹åº”çš„BufferedOutputStreamå’ŒDataOutputStreaméƒ½æ˜¯FilterOutputStreamçš„å­ç±»\nä¾‹å­ï¼Œä½¿ç”¨BufferedInputStreamï¼ˆå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼‰æ¥å¢å¼ºFileInputStreamåŠŸèƒ½\nBufferedInputStreamæºç ï¼ˆæ„é€ å‡½æ•°ï¼‰\nprivate static int DEFAULT_BUFFER_SIZE = 8192; public BufferedInputStream(InputStream in) { this(in, DEFAULT_BUFFER_SIZE); } public BufferedInputStream(InputStream in, int size) { super(in); if (size \u0026lt;= 0) { throw new IllegalArgumentException(\u0026#34;Buffer size \u0026lt;= 0\u0026#34;); } buf = new byte[size]; } ä½¿ç”¨\ntry (BufferedInputStream bis = new BufferedInputStream(new FileInputStream(\u0026#34;input.txt\u0026#34;))) { int content; long skip = bis.skip(2); while ((content = bis.read()) != -1) { System.out.print((char) content); } } catch (IOException e) { e.printStackTrace(); } ZipInputStreamå’ŒZipOutputStreamè¿˜å¯ä»¥ç”¨æ¥å¢å¼ºBufferedInputStreamå’ŒBufferedOutputStreamçš„èƒ½åŠ›\n//ä½¿ç”¨ BufferedInputStream bis = new BufferedInputStream(new FileInputStream(fileName)); ZipInputStream zis = new ZipInputStream(bis); BufferedOutputStream bos = new BufferedOutputStream(new FileOutputStream(fileName)); ZipOutputStream zipOut = new ZipOutputStream(bos); è£…é¥°å™¨æ¨¡å¼é‡è¦çš„ä¸€ç‚¹ï¼Œå°±æ˜¯å¯ä»¥å¯¹åŸå§‹ç±»åµŒå¥—ä½¿ç”¨å¤šä¸ªè£…é¥°å™¨ï¼Œæ‰€ä»¥è£…é¥°å™¨éœ€è¦è·ŸåŸå§‹ç±»ç»§æ‰¿ç›¸åŒçš„æŠ½è±¡ç±»æˆ–å®ç°ç›¸åŒæ¥å£ï¼Œä¸Šé¢ä»‹ç»çš„IOç›¸å…³è£…é¥°å™¨å’ŒåŸå§‹ç±»å…±åŒçˆ¶ç±»éƒ½æ˜¯InputStreamå’ŒOutputStream è€Œå¯¹äºå­—ç¬¦æµæ¥è¯´ï¼ŒBufferedReaderç”¨æ¥å¢å¼ºReaderï¼ˆå­—ç¬¦è¾“å…¥æµï¼‰å­ç±»åŠŸèƒ½ï¼ŒBufferWriterç”¨æ¥å¢åŠ Writerï¼ˆå­—ç¬¦è¾“å‡ºæµï¼‰å­ç±»åŠŸèƒ½\nBufferedWriter bw = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(fileName), \u0026#34;UTF-8\u0026#34;)); IOæµä¸­å¤§é‡ä½¿ç”¨äº†è£…é¥°å™¨æ¨¡å¼ï¼Œä¸éœ€è¦ç‰¹æ„è®°å¿†\né€‚é…å™¨æ¨¡å¼ # é€‚é…å™¨ï¼ˆAdapter Patternï¼‰æ¨¡å¼ï¼šä¸»è¦ç”¨äºæ¥å£äº’ä¸å…¼å®¹çš„ç±»çš„åè°ƒå·¥ä½œï¼Œä½ å¯ä»¥å°†å…¶è”æƒ³åˆ°æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„ç”µæºé€‚é…å™¨\nå…¶ä¸­è¢«é€‚é…çš„å¯¹è±¡/ç±»ç§°ä¸ºé€‚é…è€…ï¼ˆAdapteeï¼‰ï¼Œä½œç”¨äºé€‚é…è€…çš„å¯¹è±¡æˆ–è€…ç±»ç§°ä¸ºé€‚é…å™¨ï¼ˆAdapterï¼‰ã€‚å¯¹è±¡é€‚é…å™¨ä½¿ç”¨ç»„åˆå…³ç³»å®ç°ï¼Œç±»é€‚é…å™¨ä½¿ç”¨ç»§æ‰¿å…³ç³»å®ç° IOä¸­å­—ç¬¦æµå’Œå­—èŠ‚æµæ¥å£ä¸åŒï¼Œè€Œä»–ä»¬èƒ½åè°ƒå·¥ä½œå°±æ˜¯åŸºäºé€‚é…å™¨æ¨¡å¼æ¥åšçš„ï¼Œå…·ä½“çš„ï¼Œæ˜¯å¯¹è±¡é€‚é…å™¨ï¼šå°†å­—èŠ‚æµå¯¹è±¡é€‚é…æˆå­—ç¬¦æµå¯¹è±¡ï¼Œç„¶åé€šè¿‡å­—èŠ‚æµå¯¹è±¡ï¼Œè¯»å–/å†™å…¥å­—ç¬¦æ•°æ®\nInputStreamReaderå’ŒOutputStreamWriterä¸ºä¸¤ä¸ªé€‚é…å™¨ï¼Œä¹Ÿæ˜¯å­—èŠ‚æµå’Œå­—ç¬¦æµä¹‹é—´çš„æ¡¥æ¢\nInputStreamReaderä½¿ç”¨StreamDecodeï¼ˆæµè§£ç å™¨ï¼‰å¯¹å­—èŠ‚è¿›è¡Œè§£ç ï¼Œå®ç°å­—èŠ‚æµåˆ°å­—ç¬¦æµçš„è½¬æ¢\nOutputStreamWriterä½¿ç”¨StreamEncoderï¼ˆæµç¼–ç å™¨ï¼‰å¯¹å­—ç¬¦è¿›è¡Œç¼–ç ï¼Œå®ç°å­—ç¬¦åˆ°å­—èŠ‚æµçš„è½¬æ¢\nInputStreamå’ŒOutputStreamçš„å­ç±»æ˜¯è¢«é€‚é…è€…ï¼ŒInputStreamReaderå’ŒOutputStreamWriteræ˜¯é€‚é…å™¨ ä½¿ç”¨ï¼š\n// InputStreamReader æ˜¯é€‚é…å™¨ï¼ŒFileInputStream æ˜¯è¢«é€‚é…çš„ç±» InputStreamReader isr = new InputStreamReader(new FileInputStream(fileName), \u0026#34;UTF-8\u0026#34;); // BufferedReader å¢å¼º InputStreamReader çš„åŠŸèƒ½ï¼ˆè£…é¥°å™¨æ¨¡å¼ï¼‰ BufferedReader bufferedReader = new BufferedReader(isr); fileReaderçš„æºç ï¼š\npublic class FileReader extends InputStreamReader { public FileReader(String fileName) throws FileNotFoundException { super(new FileInputStream(fileName)); } } //å…¶çˆ¶ç±»InputStreamReader public class InputStreamReader extends Reader { //ç”¨äºè§£ç çš„å¯¹è±¡ private final StreamDecoder sd; public InputStreamReader(InputStream in) { super(in); try { // è·å– StreamDecoder å¯¹è±¡ sd = StreamDecoder.forInputStreamReader(in, this, (String)null); } catch (UnsupportedEncodingException e) { throw new Error(e); } } // ä½¿ç”¨ StreamDecoder å¯¹è±¡åšå…·ä½“çš„è¯»å–å·¥ä½œ public int read() throws IOException { return sd.read(); } } åŒç†ï¼Œjava.io.OutputStreamWriteréƒ¨åˆ†æºç ï¼š\npublic class OutputStreamWriter extends Writer { // ç”¨äºç¼–ç çš„å¯¹è±¡ private final StreamEncoder se; public OutputStreamWriter(OutputStream out) { super(out); try { // è·å– StreamEncoder å¯¹è±¡ se = StreamEncoder.forOutputStreamWriter(out, this, (String)null); } catch (UnsupportedEncodingException e) { throw new Error(e); } } // ä½¿ç”¨ StreamEncoder å¯¹è±¡åšå…·ä½“çš„å†™å…¥å·¥ä½œ public void write(int c) throws IOException { se.write(c); } } é€‚é…å™¨æ¨¡å¼å’Œè£…é¥°å™¨æ¨¡å¼åŒºåˆ«\nè£…é¥°å™¨æ¨¡å¼æ›´ä¾§é‡äºåŠ¨æ€å¢å¼ºåŸå§‹ç±»çš„åŠŸèƒ½ï¼Œï¼ˆä¸ºäº†åµŒå¥—ï¼‰è£…é¥°å™¨ç±»éœ€è¦è·ŸåŸå§‹ç±»ç»§æ‰¿ç›¸åŒæŠ½è±¡ç±»/æˆ–å®ç°ç›¸åŒæ¥å£ã€‚è£…é¥°å™¨æ¨¡å¼æ”¯æŒå¯¹åŸå§‹ç±»åµŒå¥—\né€‚é…å™¨æ¨¡å¼ä¾§é‡äºè®©æ¥å£ä¸å…¼å®¹è€Œä¸èƒ½äº¤äº’çš„ç±»ä¸€èµ·å·¥ä½œï¼Œå½“è°ƒç”¨é€‚é…å™¨æ–¹æ³•æ—¶ï¼Œé€‚é…å™¨å†…éƒ¨ä¼šè°ƒç”¨é€‚é…è€…ç±»æˆ–è€…å’Œé€‚é…è€…ç±»ç›¸å…³ç±»çš„æ–¹æ³•ï¼Œè¿™ä¸ªè¿‡ç¨‹é€æ˜çš„ã€‚å°±æ¯”å¦‚è¯´ StreamDecoder ï¼ˆæµè§£ç å™¨ï¼‰å’ŒStreamEncoderï¼ˆæµç¼–ç å™¨ï¼‰å°±æ˜¯åˆ†åˆ«åŸºäº InputStream å’Œ OutputStream æ¥è·å– FileChannelå¯¹è±¡å¹¶è°ƒç”¨å¯¹åº”çš„ read æ–¹æ³•å’Œ write æ–¹æ³•è¿›è¡Œå­—èŠ‚æ•°æ®çš„è¯»å–å’Œå†™å…¥ã€‚\nStreamDecoder(InputStream in, Object lock, CharsetDecoder dec) { // çœç•¥å¤§éƒ¨åˆ†ä»£ç  // æ ¹æ® InputStream å¯¹è±¡è·å– FileChannel å¯¹è±¡ ch = getChannel((FileInputStream)in); } é€‚é…å™¨å’Œé€‚é…è€…ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œè¯´çš„éƒ½æ˜¯é€‚é…å™¨æ¨¡å¼ï¼‰ä¸¤è€…ä¸éœ€è¦ç»§æ‰¿ç›¸åŒæŠ½è±¡ç±»/ä¸éœ€è¦å®ç°ç›¸åŒæ¥å£ FutureTaskä½¿ç”¨äº†é€‚é…å™¨æ¨¡å¼ ç›´æ¥è°ƒç”¨(æ„é€ å™¨)\npublic FutureTask(Runnable runnable, V result) { // è°ƒç”¨ Executors ç±»çš„ callable æ–¹æ³• this.callable = Executors.callable(runnable, result); this.state = NEW; } é—´æ¥ï¼š\n// å®é™…è°ƒç”¨çš„æ˜¯ Executors çš„å†…éƒ¨ç±» RunnableAdapter çš„æ„é€ æ–¹æ³• public static \u0026lt;T\u0026gt; Callable\u0026lt;T\u0026gt; callable(Runnable task, T result) { if (task == null) throw new NullPointerException(); return new RunnableAdapter\u0026lt;T\u0026gt;(task, result); } // é€‚é…å™¨ static final class RunnableAdapter\u0026lt;T\u0026gt; implements Callable\u0026lt;T\u0026gt; { final Runnable task; final T result; RunnableAdapter(Runnable task, T result) { this.task = task; this.result = result; } public T call() { task.run(); return result; } } å·¥å‚æ¨¡å¼ # NIOä¸­å¤§é‡å‡ºç°ï¼Œä¾‹å¦‚Filesç±»çš„newInputStreamï¼ŒPathsç±»ä¸­çš„getæ–¹æ³•ï¼ŒZipFileSystemç±»ä¸­çš„getPath\nInputStream is = Files.newInputStream(Paths.get(generatorLogoPath)) è§‚å¯Ÿè€…æ¨¡å¼ # æ¯”å¦‚NIOä¸­çš„æ–‡ä»¶ç›®å½•ç›‘å¬æœåŠ¡ è¯¥æœåŠ¡åŸºäºWatchServiceæ¥å£ï¼ˆè§‚å¯Ÿè€…ï¼‰å’ŒWatchableæ¥å£ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰\nWatchableæ¥å£å…¶ä¸­æœ‰ä¸€ä¸ªregisteræ–¹æ³•ï¼Œç”¨äºå°†å¯¹è±¡æ³¨å†Œåˆ°WatchServiceï¼ˆç›‘æ§æœåŠ¡ï¼‰å¹¶ç»‘å®šç›‘å¬äº‹ä»¶çš„æ–¹æ³•\nä¾‹å­\n// åˆ›å»º WatchService å¯¹è±¡ WatchService watchService = FileSystems.getDefault().newWatchService(); // åˆå§‹åŒ–ä¸€ä¸ªè¢«ç›‘æ§æ–‡ä»¶å¤¹çš„ Path ç±»: Path path = Paths.get(\u0026#34;workingDirectory\u0026#34;); // å°†è¿™ä¸ª path å¯¹è±¡æ³¨å†Œåˆ° WatchServiceï¼ˆç›‘æ§æœåŠ¡ï¼‰ ä¸­å» WatchKey watchKey = path.register( watchService, StandardWatchEventKinds...); å¯ä»¥é€šè¿‡WatchKeyå¯¹è±¡è·å–äº‹ä»¶å…·ä½“ä¿¡æ¯\nWatchKey key; while ((key = watchService.take()) != null) { for (WatchEvent\u0026lt;?\u0026gt; event : key.pollEvents()) { // å¯ä»¥è°ƒç”¨ WatchEvent å¯¹è±¡çš„æ–¹æ³•åšä¸€äº›äº‹æƒ…æ¯”å¦‚è¾“å‡ºäº‹ä»¶çš„å…·ä½“ä¸Šä¸‹æ–‡ä¿¡æ¯ } key.reset(); } å®Œæ•´çš„ä»£ç åº”è¯¥æ˜¯å¦‚ä¸‹\n@Test public void myTest() throws IOException, InterruptedException { // åˆ›å»º WatchService å¯¹è±¡ WatchService watchService = FileSystems.getDefault().newWatchService(); // åˆå§‹åŒ–ä¸€ä¸ªè¢«ç›‘æ§æ–‡ä»¶å¤¹çš„ Path ç±»: Path path = Paths.get(\u0026#34;F:\\\\java_test\\\\git\\\\hexo\\\\review_demo\\\\src\\\\com\\\\hp\u0026#34;); // å°†è¿™ä¸ª path å¯¹è±¡æ³¨å†Œåˆ° WatchServiceï¼ˆç›‘æ§æœåŠ¡ï¼‰ ä¸­å» WatchKey key = path.register( watchService, StandardWatchEventKinds.ENTRY_CREATE,StandardWatchEventKinds.ENTRY_DELETE ,StandardWatchEventKinds.ENTRY_MODIFY); while ((key = watchService.take()) != null) { System.out.println(\u0026#34;æ£€æµ‹åˆ°äº†äº‹ä»¶--start--\u0026#34;); for (WatchEvent\u0026lt;?\u0026gt; event : key.pollEvents()) { // å¯ä»¥è°ƒç”¨ WatchEvent å¯¹è±¡çš„æ–¹æ³•åšä¸€äº›äº‹æƒ…æ¯”å¦‚è¾“å‡ºäº‹ä»¶çš„å…·ä½“ä¸Šä¸‹æ–‡ä¿¡æ¯ System.out.println(\u0026#34;event.kind().name()\u0026#34;+event.kind().name()); } key.reset(); System.out.println(\u0026#34;æ£€æµ‹åˆ°äº†äº‹ä»¶--end--\u0026#34;); } } public interface Path extends Comparable\u0026lt;Path\u0026gt;, Iterable\u0026lt;Path\u0026gt;, Watchable{ } public interface Watchable { WatchKey register(WatchService watcher, WatchEvent.Kind\u0026lt;?\u0026gt;[] events, WatchEvent.Modifier... modifiers) throws IOException; //eventsï¼Œéœ€è¦ç›‘å¬çš„äº‹ä»¶ï¼ŒåŒ…æ‹¬åˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹ã€‚ @Override WatchKey register(WatchService watcher, WatchEvent.Kind\u0026lt;?\u0026gt;... events) throws IOException; } å…¶ä¸­eventsåŒ…æ‹¬ä¸‹é¢3ç§:\nStandardWatchEventKinds.ENTRY_CREATE ï¼šæ–‡ä»¶åˆ›å»ºã€‚\nStandardWatchEventKinds.ENTRY_DELETE : æ–‡ä»¶åˆ é™¤ã€‚\nStandardWatchEventKinds.ENTRY_MODIFY : æ–‡ä»¶ä¿®æ”¹ã€‚\nWatchServiceå†…éƒ¨é€šè¿‡ä¸€ä¸ªdaemon thread ï¼ˆå®ˆæŠ¤çº¿ç¨‹ï¼‰ï¼Œé‡‡ç”¨å®šæœŸè½®è¯¢çš„æ–¹å¼æ£€æµ‹æ–‡ä»¶å˜åŒ–\nclass PollingWatchService extends AbstractWatchService { // å®šä¹‰ä¸€ä¸ª daemon threadï¼ˆå®ˆæŠ¤çº¿ç¨‹ï¼‰è½®è¯¢æ£€æµ‹æ–‡ä»¶å˜åŒ– private final ScheduledExecutorService scheduledExecutor; PollingWatchService() { scheduledExecutor = Executors .newSingleThreadScheduledExecutor(new ThreadFactory() { @Override public Thread newThread(Runnable r) { Thread t = new Thread(r); t.setDaemon(true); return t; }}); } void enable(Set\u0026lt;? extends WatchEvent.Kind\u0026lt;?\u0026gt;\u0026gt; events, long period) { synchronized (this) { // æ›´æ–°ç›‘å¬äº‹ä»¶ this.events = events; // å¼€å¯å®šæœŸè½®è¯¢ Runnable thunk = new Runnable() { public void run() { poll(); }}; this.poller = scheduledExecutor .scheduleAtFixedRate(thunk, period, period, TimeUnit.SECONDS); } } } "},{"id":146,"href":"/zh/docs/study/Review/java_guide/java/IO/ly0201lyio/","title":"ioåŸºç¡€","section":"IO","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nç®€ä»‹ # IOï¼Œå³Input/Outputï¼Œè¾“å…¥å’Œè¾“å‡ºï¼Œè¾“å…¥å°±æ˜¯æ•°æ®è¾“å…¥åˆ°è®¡ç®—æœºå†…å­˜ï¼›è¾“å‡ºåˆ™æ˜¯è¾“å‡ºåˆ°å¤–éƒ¨å­˜å‚¨ï¼ˆå¦‚æ•°æ®åº“ã€æ–‡ä»¶ã€è¿œç¨‹ä¸»æœºï¼‰\næ ¹æ®æ•°æ®å¤„ç†æ–¹å¼ï¼Œåˆåˆ†ä¸ºå­—èŠ‚æµå’Œå­—ç¬¦æµ\nåŸºç±»\nå­—èŠ‚è¾“å…¥æµ InputStreamï¼Œå­—ç¬¦è¾“å…¥æµ Reader å­—èŠ‚è¾“å‡ºæµ OutputStream, å­—ç¬¦è¾“å‡ºæµ Writer å­—èŠ‚æµ # å­—èŠ‚è¾“å…¥æµ InputStream InputStreamç”¨äºä»æºå¤´ï¼ˆé€šå¸¸æ˜¯æ–‡ä»¶ï¼‰è¯»å–æ•°æ®ï¼ˆå­—èŠ‚ä¿¡æ¯ï¼‰åˆ°å†…å­˜ä¸­ï¼Œjava.io.InputStreamæŠ½è±¡ç±»æ˜¯æ‰€æœ‰å­—èŠ‚è¾“å…¥æµçš„çˆ¶ç±»\nå¸¸ç”¨æ–¹æ³•\nread() ï¼šè¿”å›è¾“å…¥æµä¸­ä¸‹ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚è¿”å›çš„å€¼ä»‹äº 0 åˆ° 255 ä¹‹é—´ã€‚å¦‚æœæœªè¯»å–ä»»ä½•å­—èŠ‚ï¼Œåˆ™ä»£ç è¿”å› -1 ï¼Œè¡¨ç¤ºæ–‡ä»¶ç»“æŸã€‚ read(byte b[ ]) : ä»è¾“å…¥æµä¸­è¯»å–ä¸€äº›å­—èŠ‚å­˜å‚¨åˆ°æ•°ç»„ b ä¸­ã€‚å¦‚æœæ•°ç»„ b çš„é•¿åº¦ä¸ºé›¶ï¼Œåˆ™ä¸è¯»å–ã€‚å¦‚æœæ²¡æœ‰å¯ç”¨å­—èŠ‚è¯»å–ï¼Œè¿”å› -1ã€‚å¦‚æœæœ‰å¯ç”¨å­—èŠ‚è¯»å–ï¼Œåˆ™æœ€å¤šè¯»å–çš„å­—èŠ‚æ•°æœ€å¤šç­‰äº b.length ï¼Œ è¿”å›è¯»å–çš„å­—èŠ‚æ•°ã€‚è¿™ä¸ªæ–¹æ³•ç­‰ä»·äº read(b, 0, b.length)ã€‚ read(byte b[], int off, int len) ï¼šåœ¨read(byte b[ ]) æ–¹æ³•çš„åŸºç¡€ä¸Šå¢åŠ äº† off å‚æ•°ï¼ˆåç§»é‡ï¼‰å’Œ len å‚æ•°ï¼ˆè¦è¯»å–çš„æœ€å¤§å­—èŠ‚æ•°ï¼‰ã€‚ skip(long n) ï¼šå¿½ç•¥è¾“å…¥æµä¸­çš„ n ä¸ªå­—èŠ‚ ,è¿”å›å®é™…å¿½ç•¥çš„å­—èŠ‚æ•°ã€‚ available() ï¼šè¿”å›è¾“å…¥æµä¸­å¯ä»¥è¯»å–çš„å­—èŠ‚æ•°ã€‚ close() ï¼šå…³é—­è¾“å…¥æµé‡Šæ”¾ç›¸å…³çš„ç³»ç»Ÿèµ„æºã€‚ Java9 æ–°å¢äº†å¤šä¸ªå®ç”¨æ–¹æ³•\nreadAllBytes() ï¼šè¯»å–è¾“å…¥æµä¸­çš„æ‰€æœ‰å­—èŠ‚ï¼Œè¿”å›å­—èŠ‚æ•°ç»„ã€‚ readNBytes(byte[] b, int off, int len) ï¼šé˜»å¡ç›´åˆ°è¯»å– len ä¸ªå­—èŠ‚ã€‚ transferTo(OutputStream out) ï¼š å°†æ‰€æœ‰å­—èŠ‚ä»ä¸€ä¸ªè¾“å…¥æµä¼ é€’åˆ°ä¸€ä¸ªè¾“å‡ºæµã€‚ FileInputStream \u0026ndash;\u0026gt; å­—èŠ‚è¾“å…¥æµå¯¹è±¡ï¼Œå¯ç›´æ¥æŒ‡å®šæ–‡ä»¶è·¯å¾„ï¼šç”¨æ¥è¯»å–å•å­—èŠ‚æ•°æ®/æˆ–è¯»å–è‡³å­—èŠ‚æ•°ç»„ä¸­ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š\ninput.txtä¸­çš„å­—ç¬¦ä¸ºLLJavaGuide\ntry (InputStream fis = new FileInputStream(\u0026#34;input.txt\u0026#34;)) { System.out.println(\u0026#34;Number of remaining bytes:\u0026#34; + fis.available()); int content; long skip = fis.skip(2); System.out.println(\u0026#34;The actual number of bytes skipped:\u0026#34; + skip); System.out.print(\u0026#34;The content read from file:\u0026#34;); while ((content = fis.read()) != -1) { System.out.print((char) content); } } catch (IOException e) { e.printStackTrace(); } //è¾“å‡º /**Number of remaining bytes:11 The actual number of bytes skipped:2 The content read from file:JavaGuide **/ ä¸€èˆ¬ä¸ä¼šå•ç‹¬ä½¿ç”¨FileInputStreamï¼Œè€Œæ˜¯é…åˆBufferdInputStream(å­—èŠ‚ç¼“å†²è¾“å…¥æµ)ï¼Œä¸‹é¢ä»£ç è½¬ä¸ºString è¾ƒä¸ºå¸¸è§ï¼š\n// æ–°å»ºä¸€ä¸ª BufferedInputStream å¯¹è±¡ BufferedInputStream bufferedInputStream = new BufferedInputStream(new FileInputStream(\u0026#34;input.txt\u0026#34;)); // è¯»å–æ–‡ä»¶çš„å†…å®¹å¹¶å¤åˆ¶åˆ° String å¯¹è±¡ä¸­ String result = new String(bufferedInputStream.readAllBytes()); System.out.println(result); DataInputStream ç”¨äºè¯»å–æŒ‡å®šç±»å‹æ•°æ®ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œå¿…é¡»ç»“åˆFileInputStream\nFileInputStream fileInputStream = new FileInputStream(\u0026#34;input.txt\u0026#34;); //å¿…é¡»å°†fileInputStreamä½œä¸ºæ„é€ å‚æ•°æ‰èƒ½ä½¿ç”¨ DataInputStream dataInputStream = new DataInputStream(fileInputStream); //å¯ä»¥è¯»å–ä»»æ„å…·ä½“çš„ç±»å‹æ•°æ® dataInputStream.readBoolean(); dataInputStream.readInt(); dataInputStream.readUTF(); ObjectInputStream ç”¨äºä»è¾“å…¥æµè¯»å–Javaå¯¹è±¡ï¼ˆä¸€èˆ¬æ˜¯è¢«ååºåˆ—åŒ–åˆ°æ–‡ä»¶ä¸­ï¼Œæˆ–è€…å…¶ä»–ä»‹è´¨çš„æ•°æ®ï¼‰ï¼ŒObjectOutputStreamç”¨äºå°†å¯¹è±¡å†™å…¥åˆ°è¾“å‡ºæµï¼ˆ[å°†å¯¹è±¡]åºåˆ—åŒ–ï¼‰\nObjectInputStream input = new ObjectInputStream(new FileInputStream(\u0026#34;object.data\u0026#34;)); MyClass object = (MyClass) input.readObject(); input.close(); ç”¨äºåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„ç±»å¿…é¡»å®ç°Serializableæ¥å£ï¼Œä¸æƒ³è¢«åºåˆ—åŒ–çš„å±æ€§ç”¨**transizent**ä¿®é¥°\nå­—èŠ‚è¾“å‡ºæµ OutputStream\nOutputStreamç”¨äºå°†å­—èŠ‚æ•°æ®ï¼ˆå­—èŠ‚ä¿¡æ¯ï¼‰å†™å…¥åˆ°ç›®çš„åœ°ï¼ˆé€šå¸¸æ˜¯æ–‡ä»¶ï¼‰ï¼Œjava.io.OutputStreamæŠ½è±¡ç±»æ˜¯æ‰€æœ‰å­—èŠ‚è¾“å‡ºæµçš„çˆ¶ç±»\n//å¸¸ç”¨æ–¹æ³•\nwrite(int b) ï¼šå°†ç‰¹å®šå­—èŠ‚å†™å…¥è¾“å‡ºæµã€‚ write(byte b[ ]) : å°†æ•°ç»„b å†™å…¥åˆ°è¾“å‡ºæµï¼Œç­‰ä»·äº write(b, 0, b.length) ã€‚ write(byte[] b, int off, int len) : åœ¨write(byte b[ ]) æ–¹æ³•çš„åŸºç¡€ä¸Šå¢åŠ äº† off å‚æ•°ï¼ˆåç§»é‡ï¼‰å’Œ len å‚æ•°ï¼ˆè¦è¯»å–çš„æœ€å¤§å­—èŠ‚æ•°ï¼‰ã€‚ flush() ï¼šåˆ·æ–°æ­¤è¾“å‡ºæµå¹¶å¼ºåˆ¶å†™å‡ºæ‰€æœ‰ç¼“å†²çš„è¾“å‡ºå­—èŠ‚ã€‚ //ç›¸æ¯”è¾“å…¥æµå¤šå‡ºçš„æ–¹æ³• close() ï¼šå…³é—­è¾“å‡ºæµé‡Šæ”¾ç›¸å…³çš„ç³»ç»Ÿèµ„æºã€‚ ç¤ºä¾‹ä»£ç ï¼š\ntry (FileOutputStream output = new FileOutputStream(\u0026#34;output.txt\u0026#34;)) { byte[] array = \u0026#34;JavaGuide\u0026#34;.getBytes(); output.write(array); } catch (IOException e) { e.printStackTrace(); } //ç»“æœ /**output.txtæ–‡ä»¶ä¸­å†…å®¹ä¸º: JavaGuide **/ FileOutputStreamä¸€èˆ¬ä¹Ÿæ˜¯é…åˆBufferedOutputStream ï¼ˆå­—èŠ‚ç¼“å†²è¾“å‡ºæµï¼‰ï¼š ```java FileOutputStream fileOutputStream = new FileOutputStream(\u0026#34;output.txt\u0026#34;); BufferedOutputStream bos = new BufferedOutputStream(fileOutputStream) DataOutputStreamç”¨äºå†™å…¥æŒ‡å®šç±»å‹æ•°æ®ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œå¿…é¡»ç»“åˆFileOutputStream\n// è¾“å‡ºæµ FileOutputStream fileOutputStream = new FileOutputStream(\u0026#34;out.txt\u0026#34;); DataOutputStream dataOutputStream = new DataOutputStream(fileOutputStream); // è¾“å‡ºä»»æ„æ•°æ®ç±»å‹ dataOutputStream.writeBoolean(true); dataOutputStream.writeByte(1); ObjectInputStreamç”¨äºä»è¾“å…¥æµä¸­è¯»å–Javaå¯¹è±¡ï¼ˆObjectInputStreamï¼Œååºåˆ—åŒ–ï¼‰ï¼›ObjectOutputStreamç”¨äºå°†å¯¹è±¡å†™å…¥åˆ°è¾“å‡ºæµï¼ˆObjectOutputStreamï¼Œåºåˆ—åŒ–ï¼‰\nObjectOutputStream output = new ObjectOutputStream(new FileOutputStream(\u0026#34;file.txt\u0026#34;) Person person = new Person(\u0026#34;Guideå“¥\u0026#34;, \u0026#34;JavaGuideä½œè€…\u0026#34;); output.writeObject(person); å­—ç¬¦æµ # ç®€ä»‹ æ–‡ä»¶è¯»å†™æˆ–è€…ç½‘ç»œå‘é€æ¥æ”¶ï¼Œä¿¡æ¯çš„æœ€å°å­˜å‚¨å•å…ƒéƒ½æ˜¯å­—èŠ‚ï¼Œä¸ºä»€ä¹ˆI/Oæµæ“ä½œè¦åˆ†ä¸ºå­—èŠ‚æµæ“ä½œå’Œå­—ç¬¦æµæ“ä½œå‘¢\nå­—ç¬¦æµæ˜¯ç”±Javaè™šæ‹Ÿæœºå°†å­—èŠ‚è½¬æ¢å¾—åˆ°çš„ï¼Œè¿‡ç¨‹ç›¸å¯¹è€—æ—¶\nå¦‚æœä¸çŸ¥é“ç¼–ç ç±»å‹ï¼Œå®¹æ˜“å‡ºç°ä¹±ç  å¦‚ä¸Šé¢çš„ä»£ç ï¼Œå°†æ–‡ä»¶å†…å®¹æ”¹ä¸º ï¼š ä½ å¥½ï¼Œæˆ‘æ˜¯Guide\ntry (InputStream fis = new FileInputStream(\u0026#34;input.txt\u0026#34;)) { System.out.println(\u0026#34;Number of remaining bytes:\u0026#34; + fis.available()); int content; long skip = fis.skip(2); System.out.println(\u0026#34;The actual number of bytes skipped:\u0026#34; + skip); System.out.print(\u0026#34;The content read from file:\u0026#34;); while ((content = fis.read()) != -1) { System.out.print((char) content); } } catch (IOException e) { e.printStackTrace(); } //è¾“å‡º /**Number of remaining bytes:9 The actual number of bytes skipped:2 The content read from file:Â§Ã¥Â®Â¶Ã¥Â¥Â½ **/ ä¸ºäº†è§£å†³ä¹±ç é—®é¢˜ï¼ŒI/Oæµæä¾›äº†ä¸€ä¸ªç›´æ¥æ“ä½œå­—ç¬¦çš„æ¥å£ï¼Œæ–¹ä¾¿å¯¹å­—ç¬¦è¿›è¡Œæµæ“ä½œï¼›ä½†å¦‚æœéŸ³é¢‘æ–‡ä»¶ã€å›¾ç‰‡ç­‰åª’ä½“æ–‡ä»¶ç”¨å­—èŠ‚æµæ¯”è¾ƒå¥½ï¼Œæ¶‰åŠå­—ç¬¦çš„è¯ä½¿ç”¨å­—ç¬¦æµ\nâ˜… é‡è¦ï¼š\nå­—ç¬¦æµé»˜è®¤é‡‡ç”¨çš„æ˜¯ Unicode ç¼–ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ æ–¹æ³•è‡ªå®šä¹‰ç¼–ç ã€‚é¡ºä¾¿åˆ†äº«ä¸€ä¸‹ä¹‹å‰é‡åˆ°çš„ç¬”è¯•é¢˜ï¼šå¸¸ç”¨å­—ç¬¦ç¼–ç æ‰€å å­—èŠ‚æ•°ï¼Ÿ\nutf8 :è‹±æ–‡å  1 å­—èŠ‚ï¼Œä¸­æ–‡å  3 å­—èŠ‚ï¼Œ\nunicodeï¼šä»»ä½•å­—ç¬¦éƒ½å  2 ä¸ªå­—èŠ‚ï¼Œ\ngbkï¼šè‹±æ–‡å  1 å­—èŠ‚ï¼Œä¸­æ–‡å  2 å­—èŠ‚ã€‚\nReaderï¼ˆå­—ç¬¦è¾“å…¥æµï¼‰\nç”¨äºä»æºå¤´ï¼ˆé€šå¸¸æ˜¯æ–‡ä»¶ï¼‰è¯»å–æ•°æ®ï¼ˆå­—ç¬¦ä¿¡æ¯ï¼‰åˆ°å†…å­˜ä¸­ï¼Œjava.io.ReaderæŠ½è±¡ç±»æ˜¯æ‰€æœ‰å­—ç¬¦è¾“å…¥æµçš„çˆ¶ç±»\næ³¨æ„ï¼šInputStreamå’ŒReaderéƒ½æ˜¯ç±»ï¼Œå†å¾€ä¸Šå°±æ˜¯æ¥å£äº†ï¼›Readerç”¨äºè¯»å–æ–‡æœ¬ï¼ŒInputStreamç”¨äºè¯»å–åŸå§‹å­—èŠ‚ å¸¸ç”¨æ–¹æ³•ï¼š\nread() : ä»è¾“å…¥æµè¯»å–ä¸€ä¸ªå­—ç¬¦ã€‚ read(char[] cbuf) : ä»è¾“å…¥æµä¸­è¯»å–ä¸€äº›å­—ç¬¦ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åˆ°å­—ç¬¦æ•°ç»„ cbufä¸­ï¼Œç­‰ä»·äº read(cbuf, 0, cbuf.length) ã€‚ read(char[] cbuf, int off, int len) ï¼šåœ¨read(char[] cbuf) æ–¹æ³•çš„åŸºç¡€ä¸Šå¢åŠ äº† off å‚æ•°ï¼ˆåç§»é‡ï¼‰å’Œ len å‚æ•°ï¼ˆè¦è¯»å–çš„æœ€å¤§å­—èŠ‚æ•°ï¼‰ã€‚ skip(long n) ï¼šå¿½ç•¥è¾“å…¥æµä¸­çš„ n ä¸ªå­—ç¬¦ ,è¿”å›å®é™…å¿½ç•¥çš„å­—ç¬¦æ•°ã€‚ close() : å…³é—­è¾“å…¥æµå¹¶é‡Šæ”¾ç›¸å…³çš„ç³»ç»Ÿèµ„æºã€‚ InputStreamReaderæ˜¯å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµçš„æ¡¥æ¢ï¼Œå­ç±»FileReaderåŸºäºè¯¥åŸºç¡€ä¸Šçš„å°è£…ï¼Œå¯ä»¥ç›´æ¥æ“ä½œå­—ç¬¦æ–‡ä»¶\n// å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµçš„æ¡¥æ¢ public class InputStreamReader extends Reader { } // ç”¨äºè¯»å–å­—ç¬¦æ–‡ä»¶ public class FileReader extends InputStreamReader { } ç¤ºä¾‹ï¼šinput.txtä¸­å†…å®¹ä¸º\u0026quot;ä½ å¥½ï¼Œæˆ‘æ˜¯Guide\u0026quot;\ntry (FileReader fileReader = new FileReader(\u0026#34;input.txt\u0026#34;);) { int content; long skip = fileReader.skip(3); System.out.println(\u0026#34;The actual number of bytes skipped:\u0026#34; + skip); System.out.print(\u0026#34;The content read from file:\u0026#34;); while ((content = fileReader.read()) != -1) { System.out.print((char) content); } } catch (IOException e) { e.printStackTrace(); } /*è¾“å‡º The actual number of bytes skipped:3 The content read from file:æˆ‘æ˜¯Guideã€‚ */ Writeï¼ˆå­—ç¬¦è¾“å‡ºæµï¼‰ ç”¨äºå°†æ•°æ®ï¼ˆå­—ç¬¦ä¿¡æ¯ï¼‰å†™åˆ°ç›®çš„åœ°ï¼ˆé€šå¸¸æ˜¯æ–‡ä»¶ï¼‰ï¼Œjava.io.WriteræŠ½è±¡ç±»æ˜¯æ‰€æœ‰å­—èŠ‚è¾“å‡ºæµçš„çˆ¶ç±»\nwrite(int c) : å†™å…¥å•ä¸ªå­—ç¬¦ã€‚ write(char[] cbuf) ï¼šå†™å…¥å­—ç¬¦æ•°ç»„ cbufï¼Œç­‰ä»·äºwrite(cbuf, 0, cbuf.length)ã€‚ write(char[] cbuf, int off, int len) ï¼šåœ¨write(char[] cbuf) æ–¹æ³•çš„åŸºç¡€ä¸Šå¢åŠ äº† off å‚æ•°ï¼ˆåç§»é‡ï¼‰å’Œ len å‚æ•°ï¼ˆè¦è¯»å–çš„æœ€å¤§å­—èŠ‚æ•°ï¼‰ã€‚ write(String str) ï¼šå†™å…¥å­—ç¬¦ä¸²ï¼Œç­‰ä»·äº write(str, 0, str.length()) ã€‚ write(String str, int off, int len) ï¼šåœ¨write(String str) æ–¹æ³•çš„åŸºç¡€ä¸Šå¢åŠ äº† off å‚æ•°ï¼ˆåç§»é‡ï¼‰å’Œ len å‚æ•°ï¼ˆè¦è¯»å–çš„æœ€å¤§å­—èŠ‚æ•°ï¼‰ã€‚ append(CharSequence csq) ï¼šå°†æŒ‡å®šçš„å­—ç¬¦åºåˆ—é™„åŠ åˆ°æŒ‡å®šçš„ Writer å¯¹è±¡å¹¶è¿”å›è¯¥ Writer å¯¹è±¡ã€‚ append(char c) ï¼šå°†æŒ‡å®šçš„å­—ç¬¦é™„åŠ åˆ°æŒ‡å®šçš„ Writer å¯¹è±¡å¹¶è¿”å›è¯¥ Writer å¯¹è±¡ã€‚ flush() ï¼šåˆ·æ–°æ­¤è¾“å‡ºæµå¹¶å¼ºåˆ¶å†™å‡ºæ‰€æœ‰ç¼“å†²çš„è¾“å‡ºå­—ç¬¦ã€‚//ç›¸å¯¹äºReaderå¢åŠ çš„ close():å…³é—­è¾“å‡ºæµé‡Šæ”¾ç›¸å…³çš„ç³»ç»Ÿèµ„æºã€‚ OutputStreamWriteræ˜¯å­—ç¬¦æµè½¬æ¢ä¸ºå­—èŠ‚æµçš„æ¡¥æ¢ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œæ²¡æœ‰é”™ï¼‰ï¼Œå…¶å­ç±»FileWriteræ˜¯åŸºäºè¯¥åŸºç¡€ä¸Šçš„å°è£…ï¼Œå¯ä»¥ç›´æ¥å°†å­—ç¬¦å†™å…¥åˆ°æ–‡ä»¶\n// å­—ç¬¦æµè½¬æ¢ä¸ºå­—èŠ‚æµçš„æ¡¥æ¢ public class OutputStreamWriter extends Writer { } // ç”¨äºå†™å…¥å­—ç¬¦åˆ°æ–‡ä»¶ public class FileWriter extends OutputStreamWriter { } FileWriterä»£ç ç¤ºä¾‹ï¼š\ntry (Writer output = new FileWriter(\u0026#34;output.txt\u0026#34;)) { output.write(\u0026#34;ä½ å¥½ï¼Œæˆ‘æ˜¯Guideã€‚\u0026#34;); //å­—ç¬¦æµï¼Œè½¬ä¸ºå­—èŠ‚æµ } catch (IOException e) { e.printStackTrace(); } /*ç»“æœï¼šoutput.txtä¸­ ä½ å¥½ï¼Œæˆ‘æ˜¯Guide */ InputStreamWriterå’ŒOutputStreamWriter æ¯”è¾ƒ\nå‰è€…InputStreamWriterï¼Œæ˜¯éœ€è¦ä»æ–‡ä»¶ä¸­è¯»æ•°æ®å‡ºæ¥ï¼ˆè¯»åˆ°å†…å­˜ä¸­ï¼‰ï¼Œè€Œæ–‡ä»¶æ˜¯é€šè¿‡äºŒè¿›åˆ¶ï¼ˆå­—èŠ‚ï¼‰ä¿å­˜çš„ï¼Œæ‰€ä»¥InputStreamWriteræ˜¯å°†ï¼ˆçœ‹ä¸æ‡‚çš„ï¼‰å­—èŠ‚æµè½¬æ¢ä¸ºï¼ˆçœ‹å¾—æ‡‚çš„ï¼‰å­—ç¬¦æµ åè€…OutputStreamWriterï¼Œæ˜¯éœ€è¦**å°†ï¼ˆçœ‹å¾—æ‡‚çš„ï¼‰å­—ç¬¦æµè½¬æ¢ä¸ºï¼ˆçœ‹ä¸æ‡‚çš„ï¼‰å­—èŠ‚æµï¼ˆç„¶åä»å†…å­˜è¯»å‡ºï¼‰**å¹¶ä¿å­˜åˆ°ä»‹è´¨ä¸­ å­—èŠ‚ç¼“å†²æµ # ç®€ä»‹\nIOæ“ä½œæ˜¯å¾ˆæ¶ˆè€—æ€§èƒ½çš„ï¼Œç¼“å†²æµå°†æ•°æ®åŠ è½½è‡³ç¼“å†²åŒºï¼Œä¸€æ¬¡æ€§è¯»å–/å†™å…¥å¤šä¸ªå­—èŠ‚ï¼Œä»è€Œé¿å…é¢‘ç¹çš„IOæ“ä½œï¼Œæé«˜æµçš„æ•ˆç‡\né‡‡ç”¨è£…é¥°å™¨æ¨¡å¼æ¥å¢å¼ºInputStreamå’ŒOutputStreamå­ç±»å¯¹è±¡çš„åŠŸèƒ½\nä¾‹å­ï¼š\n// æ–°å»ºä¸€ä¸ª BufferedInputStream å¯¹è±¡ BufferedInputStream bufferedInputStream = new BufferedInputStream(new FileInputStream(\u0026#34;input.txt\u0026#34;)); å­—èŠ‚æµå’Œå­—èŠ‚ç¼“å†²æµçš„æ€§èƒ½å·®åˆ«ä¸»è¦ä½“ç°åœ¨ï¼šå½“ä½¿ç”¨ä¸¤è€…æ—¶éƒ½è°ƒç”¨çš„æ˜¯write(int b)å’Œread() è¿™ä¸¤ä¸ªä¸€æ¬¡åªè¯»å–ä¸€ä¸ªå­—èŠ‚çš„æ–¹æ³•çš„æ—¶å€™ï¼Œç”±äºå­—èŠ‚ç¼“å†²æµå†…éƒ¨æœ‰ç¼“å†²åŒºï¼ˆå­—èŠ‚æ•°ç»„ï¼‰ï¼Œå› æ­¤å­—èŠ‚ç¼“å†²æµä¼šå°†è¯»å–åˆ°çš„å­—èŠ‚å­˜æ”¾åœ¨ç¼“å­˜åŒºï¼Œå¤§å¹…å‡å°‘IOæ¬¡æ•°ï¼Œæé«˜è¯»å–æ•ˆç‡\nå¯¹æ¯”ï¼šå¤åˆ¶524.9mbæ–‡ä»¶ï¼Œç¼“å†²æµ15sï¼Œæ™®é€šå­—èŠ‚æµ2555s(30min)\næµ‹è¯•ä»£ç \n@Test void copy_pdf_to_another_pdf_buffer_stream() { // è®°å½•å¼€å§‹æ—¶é—´ long start = System.currentTimeMillis(); try (BufferedInputStream bis = new BufferedInputStream(new FileInputStream(\u0026#34;æ·±å…¥ç†è§£è®¡ç®—æœºæ“ä½œç³»ç»Ÿ.pdf\u0026#34;)); BufferedOutputStream bos = new BufferedOutputStream(new FileOutputStream(\u0026#34;æ·±å…¥ç†è§£è®¡ç®—æœºæ“ä½œç³»ç»Ÿ-å‰¯æœ¬.pdf\u0026#34;))) { int content; while ((content = bis.read()) != -1) { bos.write(content); } } catch (IOException e) { e.printStackTrace(); } // è®°å½•ç»“æŸæ—¶é—´ long end = System.currentTimeMillis(); System.out.println(\u0026#34;ä½¿ç”¨ç¼“å†²æµå¤åˆ¶PDFæ–‡ä»¶æ€»è€—æ—¶:\u0026#34; + (end - start) + \u0026#34; æ¯«ç§’\u0026#34;); } @Test void copy_pdf_to_another_pdf_stream() { // è®°å½•å¼€å§‹æ—¶é—´ long start = System.currentTimeMillis(); try (FileInputStream fis = new FileInputStream(\u0026#34;æ·±å…¥ç†è§£è®¡ç®—æœºæ“ä½œç³»ç»Ÿ.pdf\u0026#34;); FileOutputStream fos = new FileOutputStream(\u0026#34;æ·±å…¥ç†è§£è®¡ç®—æœºæ“ä½œç³»ç»Ÿ-å‰¯æœ¬.pdf\u0026#34;)) { int content; while ((content = fis.read()) != -1) { fos.write(content); } } catch (IOException e) { e.printStackTrace(); } // è®°å½•ç»“æŸæ—¶é—´ long end = System.currentTimeMillis(); System.out.println(\u0026#34;ä½¿ç”¨æ™®é€šæµå¤åˆ¶PDFæ–‡ä»¶æ€»è€—æ—¶:\u0026#34; + (end - start) + \u0026#34; æ¯«ç§’\u0026#34;); } ä½†æ˜¯å¦‚æœæ˜¯ä½¿ç”¨æ™®é€šå­—èŠ‚æµçš„ read(byte b[] )å’Œwrite(byte b[] , int off, int len) è¿™ä¸¤ä¸ªå†™å…¥ä¸€ä¸ªå­—èŠ‚æ•°ç»„çš„æ–¹æ³•çš„è¯ï¼Œåªè¦å­—èŠ‚æ•°ç»„å¤§å°åˆé€‚ï¼Œå·®è·æ€§èƒ½ä¸å¤§ åŒç†ï¼Œä½¿ç”¨read(byte b[]) å’Œwrite(byte b[] ,int off, int len)æ–¹æ³•(å­—èŠ‚æµåŠç¼“å†²å­—èŠ‚æµ)ï¼Œåˆ†åˆ«å¤åˆ¶524mbæ–‡ä»¶ï¼Œç¼“å†²æµéœ€è¦0.7s , æ™®é€šå­—èŠ‚æµéœ€è¦1s ä»£ç å¦‚ä¸‹ï¼š\n@Test void copy_pdf_to_another_pdf_with_byte_array_buffer_stream() { // è®°å½•å¼€å§‹æ—¶é—´ long start = System.currentTimeMillis(); try (BufferedInputStream bis = new BufferedInputStream(new FileInputStream(\u0026#34;æ·±å…¥ç†è§£è®¡ç®—æœºæ“ä½œç³»ç»Ÿ.pdf\u0026#34;)); BufferedOutputStream bos = new BufferedOutputStream(new FileOutputStream(\u0026#34;æ·±å…¥ç†è§£è®¡ç®—æœºæ“ä½œç³»ç»Ÿ-å‰¯æœ¬.pdf\u0026#34;))) { int len; byte[] bytes = new byte[4 * 1024]; while ((len = bis.read(bytes)) != -1) { bos.write(bytes, 0, len); } } catch (IOException e) { e.printStackTrace(); } // è®°å½•ç»“æŸæ—¶é—´ long end = System.currentTimeMillis(); System.out.println(\u0026#34;ä½¿ç”¨ç¼“å†²æµå¤åˆ¶PDFæ–‡ä»¶æ€»è€—æ—¶:\u0026#34; + (end - start) + \u0026#34; æ¯«ç§’\u0026#34;); } @Test void copy_pdf_to_another_pdf_with_byte_array_stream() { // è®°å½•å¼€å§‹æ—¶é—´ long start = System.currentTimeMillis(); try (FileInputStream fis = new FileInputStream(\u0026#34;æ·±å…¥ç†è§£è®¡ç®—æœºæ“ä½œç³»ç»Ÿ.pdf\u0026#34;); FileOutputStream fos = new FileOutputStream(\u0026#34;æ·±å…¥ç†è§£è®¡ç®—æœºæ“ä½œç³»ç»Ÿ-å‰¯æœ¬.pdf\u0026#34;)) { int len; byte[] bytes = new byte[4 * 1024]; while ((len = fis.read(bytes)) != -1) { fos.write(bytes, 0, len); } } catch (IOException e) { e.printStackTrace(); } // è®°å½•ç»“æŸæ—¶é—´ long end = System.currentTimeMillis(); System.out.println(\u0026#34;ä½¿ç”¨æ™®é€šæµå¤åˆ¶PDFæ–‡ä»¶æ€»è€—æ—¶:\u0026#34; + (end - start) + \u0026#34; æ¯«ç§’\u0026#34;); } å­—èŠ‚ç¼“å†²è¾“å…¥æµ BufferedInputStream\nBufferedInputStream ä»æºå¤´ï¼ˆé€šå¸¸æ˜¯æ–‡ä»¶ï¼‰è¯»å–æ•°æ®ï¼ˆå­—èŠ‚ä¿¡æ¯ï¼‰åˆ°å†…å­˜çš„è¿‡ç¨‹ä¸­ä¸ä¼šä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„è¯»å–ï¼Œè€Œæ˜¯ä¼šå…ˆå°†è¯»å–åˆ°çš„å­—èŠ‚å­˜æ”¾åœ¨ç¼“å­˜åŒºï¼Œå¹¶ä»å†…éƒ¨ç¼“å†²åŒºä¸­å•ç‹¬è¯»å–å­—èŠ‚ã€‚è¿™æ ·å¤§å¹…å‡å°‘äº† IO æ¬¡æ•°ï¼Œæé«˜äº†è¯»å–æ•ˆç‡ã€‚\nBufferedInputStream å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªç¼“å†²åŒºï¼Œè¿™ä¸ªç¼“å†²åŒºå®é™…å°±æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œé€šè¿‡é˜…è¯» BufferedInputStream æºç å³å¯å¾—åˆ°è¿™ä¸ªç»“è®ºã€‚\næºç \npublic class BufferedInputStream extends FilterInputStream { // å†…éƒ¨ç¼“å†²åŒºæ•°ç»„ protected volatile byte buf[]; // ç¼“å†²åŒºçš„é»˜è®¤å¤§å° private static int DEFAULT_BUFFER_SIZE = 8192; // ä½¿ç”¨é»˜è®¤çš„ç¼“å†²åŒºå¤§å° public BufferedInputStream(InputStream in) { this(in, DEFAULT_BUFFER_SIZE); } // è‡ªå®šä¹‰ç¼“å†²åŒºå¤§å° public BufferedInputStream(InputStream in, int size) { super(in); if (size \u0026lt;= 0) { throw new IllegalArgumentException(\u0026#34;Buffer size \u0026lt;= 0\u0026#34;); } buf = new byte[size]; } } å­—èŠ‚ç¼“å†²è¾“å‡ºæµ BufferedOutputStream BufferedOutputStream å°†æ•°æ®ï¼ˆå­—èŠ‚ä¿¡æ¯ï¼‰å†™å…¥åˆ°ç›®çš„åœ°ï¼ˆé€šå¸¸æ˜¯æ–‡ä»¶ï¼‰çš„è¿‡ç¨‹ä¸­ä¸ä¼šä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„å†™å…¥ï¼Œè€Œæ˜¯ä¼šå…ˆå°†è¦å†™å…¥çš„å­—èŠ‚å­˜æ”¾åœ¨ç¼“å­˜åŒºï¼Œå¹¶ä»å†…éƒ¨ç¼“å†²åŒºä¸­å•ç‹¬å†™å…¥å­—èŠ‚ã€‚è¿™æ ·å¤§å¹…å‡å°‘äº† IO æ¬¡æ•°ï¼Œæé«˜äº†è¯»å–æ•ˆç‡ ä½¿ç”¨\ntry (BufferedOutputStream bos = new BufferedOutputStream(new FileOutputStream(\u0026#34;output.txt\u0026#34;))) { byte[] array = \u0026#34;JavaGuide\u0026#34;.getBytes(); bos.write(array); } catch (IOException e) { e.printStackTrace(); } å­—ç¬¦ç¼“å†²æµ # BufferedReader ï¼ˆå­—ç¬¦ç¼“å†²è¾“å…¥æµï¼‰å’Œ BufferedWriterï¼ˆå­—ç¬¦ç¼“å†²è¾“å‡ºæµï¼‰ç±»ä¼¼äº BufferedInputStreamï¼ˆå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼‰å’ŒBufferedOutputStreamï¼ˆå­—èŠ‚ç¼“å†²è¾“å…¥æµï¼‰ï¼Œå†…éƒ¨éƒ½ç»´æŠ¤äº†ä¸€ä¸ªå­—èŠ‚æ•°ç»„ä½œä¸ºç¼“å†²åŒºã€‚ä¸è¿‡ï¼Œå‰è€…ä¸»è¦æ˜¯ç”¨æ¥æ“ä½œå­—ç¬¦ä¿¡æ¯ã€‚\nè¿™é‡Œè¡¨è¿°å¥½åƒä¸å¤ªå¯¹ï¼Œåº”è¯¥æ˜¯ç»´æŠ¤äº†å­—ç¬¦æ•°ç»„ï¼š\npublic class BufferedReader extends Reader { private Reader in; private char cb[]; } æ‰“å°æµ # PrintStreamå±äºå­—èŠ‚æ‰“å°æµï¼Œå¯¹åº”çš„æ˜¯PrintWriterï¼ˆå­—ç¬¦æ‰“å°æµï¼‰\nSystem.out å®é™…ä¸Šè·å–äº†ä¸€ä¸ªPrintStreamï¼Œprintæ–¹æ³•è°ƒç”¨çš„æ˜¯PrintStreamçš„writeæ–¹æ³•\nPrintStream æ˜¯ OutputStream çš„å­ç±»ï¼ŒPrintWriter æ˜¯ Writer çš„å­ç±»ã€‚\npublic class PrintStream extends FilterOutputStream implements Appendable, Closeable { } public class PrintWriter extends Writer { } éšæœºè®¿é—®æµ RandomAccessFile # æŒ‡çš„æ˜¯æ”¯æŒéšæ„è·³è½¬åˆ°æ–‡ä»¶çš„ä»»æ„ä½ç½®è¿›è¡Œè¯»å†™çš„RandomAccessFile æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼Œå¯ä»¥æŒ‡å®šmode (è¯»å†™æ¨¡å¼)\n// openAndDelete å‚æ•°é»˜è®¤ä¸º false è¡¨ç¤ºæ‰“å¼€æ–‡ä»¶å¹¶ä¸”è¿™ä¸ªæ–‡ä»¶ä¸ä¼šè¢«åˆ é™¤ public RandomAccessFile(File file, String mode) throws FileNotFoundException { this(file, mode, false); } // ç§æœ‰æ–¹æ³• private RandomAccessFile(File file, String mode, boolean openAndDelete) throws FileNotFoundException{ // çœç•¥å¤§éƒ¨åˆ†ä»£ç  } è¯»å†™æ¨¡å¼ä¸»è¦æœ‰ä»¥ä¸‹å››ç§ï¼š\nr : åªè¯»ï¼›rwï¼šè¯»å†™\nrws :ç›¸å¯¹äºrwï¼ŒrwsåŒæ­¥æ›´æ–°å¯¹\u0026quot;æ–‡ä»¶å†…å®¹\u0026quot;æˆ–å…ƒæ•°æ®çš„ä¿®æ”¹åˆ°å¤–éƒ¨å­˜å‚¨è®¾å¤‡\nrwd:ç›¸å¯¹äºrw,rwdåŒæ­¥æ›´æ–°å¯¹\u0026quot;æ–‡ä»¶å†…å®¹\u0026quot;çš„ä¿®æ”¹åˆ°å¤–éƒ¨å­˜å‚¨è®¾å¤‡\nè§£é‡Šï¼š\næ–‡ä»¶å†…å®¹æŒ‡å®é™…ä¿å­˜çš„æ•°æ®ï¼Œå…ƒæ•°æ®åˆ™æè¿°å±æ€§ä¾‹å¦‚æ–‡ä»¶å¤§å°ä¿¡æ¯ã€åˆ›å»ºå’Œä¿®æ”¹æ—¶é—´ é»˜è®¤æƒ…å½¢ä¸‹(rwæ¨¡å¼ä¸‹),æ˜¯ä½¿ç”¨bufferçš„,åªæœ‰cacheæ»¡çš„æˆ–è€…ä½¿ç”¨RandomAccessFile.close()å…³é—­æµçš„æ—¶å€™å„¿æ‰çœŸæ­£çš„å†™åˆ°æ–‡ä»¶ã€‚ è°ƒè¯•éº»çƒ¦çš„\u0026hellip;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;ä½¿ç”¨writeæ–¹æ³•ä¿®æ”¹byteçš„æ—¶å€™å„¿,åªä¿®æ”¹åˆ°ä¸ªå†…å­˜å…°,è¿˜æ²¡åˆ°ä¸ªæ–‡ä»¶,é—ªçš„è°ƒè¯•éº»çƒ¦çš„,ä¸èƒ½ä½¿ç”¨notepad++å·¥å…·ç«‹å³çœ‹è§ä¿®æ”¹æ•ˆæœ.. å½“ç³»ç»Ÿhaltçš„æ—¶å€™å„¿,ä¸èƒ½å†™åˆ°æ–‡ä»¶\u0026hellip;å®‰å…¨æ€§ç¨å¾®å·®ç‚¹å„¿\u0026hellip; rwsï¼šå°±æ˜¯åŒæ­¥ï¼ˆsynchronizedï¼‰æ¨¡å¼,æ¯writeä¿®æ”¹ä¸€ä¸ªbyte,ç«‹é©¬å†™åˆ°ç£ç›˜..å½“ç„¶ä¸­é—´æ€§èƒ½èµ°å·®ç‚¹å„¿,é€‚åˆå°çš„æ–‡ä»¶\u0026hellip;and debugæ¨¡å¼\u0026hellip;æˆ–è€…å®‰å…¨æ€§é«˜çš„éœ€è¦çš„æ—¶å€™å„¿ rwdï¼š åªå¯¹â€œæ–‡ä»¶çš„å†…å®¹â€åŒæ­¥æ›´æ–°åˆ°ç£ç›˜\u0026hellip;ä¸å¯¹metadataåŒæ­¥æ›´æ–° rwdä»‹äºrwå’Œrwsä¹‹é—´ RandomAccessFileï¼šæ–‡ä»¶æŒ‡é’ˆè¡¨ç¤ºä¸‹ä¸€ä¸ªå°†è¦è¢«å†™å…¥æˆ–è¯»å–çš„å­—èŠ‚æ‰€å¤„ä½ç½®\né€šè¿‡seek(long pos)æ–¹æ³•è®¾ç½®æ–‡ä»¶æŒ‡é’ˆåç§»é‡ï¼ˆè·ç¦»å¼€å¤´posä¸ªå­—èŠ‚å¤„ï¼Œä»0å¼€å§‹ï¼‰\nä½¿ç”¨getFilePointer()æ–¹æ³•è·å–æ–‡ä»¶æŒ‡é’ˆå½“å‰ä½ç½®\nRandomAccessFile randomAccessFile = new RandomAccessFile(new File(\u0026#34;input.txt\u0026#34;), \u0026#34;rw\u0026#34;); System.out.println(\u0026#34;è¯»å–ä¹‹å‰çš„åç§»é‡ï¼š\u0026#34; + randomAccessFile.getFilePointer() + \u0026#34;,å½“å‰è¯»å–åˆ°çš„å­—ç¬¦\u0026#34; + (char) randomAccessFile.read() + \u0026#34;ï¼Œè¯»å–ä¹‹åçš„åç§»é‡ï¼š\u0026#34; + randomAccessFile.getFilePointer()); // æŒ‡é’ˆå½“å‰åç§»é‡ä¸º 6 randomAccessFile.seek(6); System.out.println(\u0026#34;è¯»å–ä¹‹å‰çš„åç§»é‡ï¼š\u0026#34; + randomAccessFile.getFilePointer() + \u0026#34;,å½“å‰è¯»å–åˆ°çš„å­—ç¬¦\u0026#34; + (char) randomAccessFile.read() + \u0026#34;ï¼Œè¯»å–ä¹‹åçš„åç§»é‡ï¼š\u0026#34; + randomAccessFile.getFilePointer()); // ä»åç§»é‡ 7 çš„ä½ç½®å¼€å§‹å¾€åå†™å…¥å­—èŠ‚æ•°æ® randomAccessFile.write(new byte[]{\u0026#39;H\u0026#39;, \u0026#39;I\u0026#39;, \u0026#39;J\u0026#39;, \u0026#39;K\u0026#39;}); // æŒ‡é’ˆå½“å‰åç§»é‡ä¸º 0ï¼Œå›åˆ°èµ·å§‹ä½ç½® randomAccessFile.seek(0); System.out.println(\u0026#34;è¯»å–ä¹‹å‰çš„åç§»é‡ï¼š\u0026#34; + randomAccessFile.getFilePointer() + \u0026#34;,å½“å‰è¯»å–åˆ°çš„å­—ç¬¦\u0026#34; + (char) randomAccessFile.read() + \u0026#34;ï¼Œè¯»å–ä¹‹åçš„åç§»é‡ï¼š\u0026#34; + randomAccessFile.getFilePointer()); input.txtæ–‡ä»¶å†…å®¹ï¼š ABCDEFG\nè¾“å‡º\nè¯»å–ä¹‹å‰çš„åç§»é‡ï¼š0,å½“å‰è¯»å–åˆ°çš„å­—ç¬¦Aï¼Œè¯»å–ä¹‹åçš„åç§»é‡ï¼š1 è¯»å–ä¹‹å‰çš„åç§»é‡ï¼š6,å½“å‰è¯»å–åˆ°çš„å­—ç¬¦Gï¼Œè¯»å–ä¹‹åçš„åç§»é‡ï¼š7 è¯»å–ä¹‹å‰çš„åç§»é‡ï¼š0,å½“å‰è¯»å–åˆ°çš„å­—ç¬¦Aï¼Œè¯»å–ä¹‹åçš„åç§»é‡ï¼š1 æ–‡ä»¶å†…å®¹ï¼š ABCDEFGHIJK\nwriteæ–¹æ³•åœ¨å†™å…¥å¯¹è±¡æ—¶å¦‚æœå¯¹åº”ä½ç½®å·²æœ‰æ•°æ®ï¼Œä¼šå°†å…¶è¦†ç›–\nRandomAccessFile randomAccessFile = new RandomAccessFile(new File(\u0026#34;input.txt\u0026#34;), \u0026#34;rw\u0026#34;); randomAccessFile.write(new byte[]{\u0026#39;H\u0026#39;, \u0026#39;I\u0026#39;, \u0026#39;J\u0026#39;, \u0026#39;K\u0026#39;}); //å¦‚æœç¨‹åºä¹‹å‰input.txtå†…å®¹ä¸ºABCDï¼Œåˆ™è¿è¡Œåå˜ä¸ºHIJK å¸¸è§åº”ç”¨ï¼šè§£å†³æ–­ç‚¹ç»­ä¼ ï¼šä¸Šä¼ æ–‡ä»¶ä¸­é€”æš‚åœæˆ–å¤±è´¥ï¼ˆç½‘ç»œé—®é¢˜ï¼‰ï¼Œä¹‹åä¸éœ€è¦é‡æ–°ä¸Šä¼ ï¼Œåªéœ€ä¸Šä¼ æœªæˆåŠŸä¸Šä¼ çš„æ–‡ä»¶åˆ†ç‰‡å³å¯ åˆ†ç‰‡ï¼ˆå…ˆå°†æ–‡ä»¶åˆ‡åˆ†æˆå¤šä¸ªæ–‡ä»¶åˆ†ç‰‡ï¼‰ä¸Šä¼ æ˜¯æ–­ç‚¹ç»­ä¼ çš„åŸºç¡€ã€‚ ä½¿ç”¨RandomAccessFileå¸®åŠ©æˆ‘ä»¬åˆå¹¶æ–‡ä»¶åˆ†ç‰‡ï¼ˆä½†æ˜¯ä¸‹é¢ä»£ç å¥½åƒä¸æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºä»–æ˜¯å•çº¿ç¨‹è¿ç»­å†™å…¥ï¼Ÿï¼Ÿï¼Œè¿™é‡Œé™„ä¸Šå¦ä¸€ç¯‡æ–‡ç« çš„å¦ä¸€æ®µè¯ï¼šï¼‰\nä½†æ˜¯ç”±äº RandomAccessFile å¯ä»¥è‡ªç”±è®¿é—®æ–‡ä»¶çš„ä»»æ„ä½ç½®ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦è®¿é—®æ–‡ä»¶çš„éƒ¨åˆ†å†…å®¹ï¼Œè€Œä¸æ˜¯æŠŠæ–‡ä»¶ä»å¤´è¯»åˆ°å°¾ï¼Œå› æ­¤ RandomAccessFile çš„ä¸€ä¸ªé‡è¦ä½¿ç”¨åœºæ™¯å°±æ˜¯ç½‘ç»œè¯·æ±‚ä¸­çš„å¤šçº¿ç¨‹ä¸‹è½½åŠæ–­ç‚¹ç»­ä¼ ã€‚ https://blog.csdn.net/li1669852599/article/details/122214104\nly: ä¸ªäººæ„Ÿè§‰ï¼Œmysqlæ•°æ®åº“çš„å†™å…¥å¯èƒ½ä¹Ÿæ˜¯ä¾èµ–ç±»ä¼¼çš„è§„åˆ™ï¼Œæ‰èƒ½åœ¨æŸä¸ªä½ç½®è¯»å†™\n"},{"id":147,"href":"/zh/docs/study/Review/java_guide/java/Collection/ly0105lysource-code-concurrenthashmap/","title":"ConcurrentHashMapæºç ","section":"é›†åˆ","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\næ€»ç»“ # Java7 ä¸­ ConcurrentHashMap ä½¿ç”¨çš„åˆ†æ®µé”ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ª Segment ä¸ŠåŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ“ä½œï¼Œæ¯ä¸€ä¸ª Segment éƒ½æ˜¯ä¸€ä¸ªç±»ä¼¼ HashMap æ•°ç»„çš„ç»“æ„ï¼Œæ¯ä¸€ä¸ªHashMapå¯ä»¥æ‰©å®¹ï¼Œå®ƒçš„å†²çªä¼šè½¬åŒ–ä¸ºé“¾è¡¨ã€‚ä½†æ˜¯ Segment çš„ä¸ªæ•°ä¸€ä½†åˆå§‹åŒ–å°±ä¸èƒ½æ”¹å˜ã€‚\nJava8 ä¸­çš„ ConcurrentHashMap ä½¿ç”¨çš„ Synchronized é”åŠ  CAS çš„æœºåˆ¶ã€‚ç»“æ„ä¹Ÿç”± Java7 ä¸­çš„ Segment æ•°ç»„ + HashEntry æ•°ç»„ + é“¾è¡¨ è¿›åŒ–æˆäº† Node æ•°ç»„ + é“¾è¡¨ / çº¢é»‘æ ‘ï¼ŒNode æ˜¯ç±»ä¼¼äºä¸€ä¸ª HashEntry çš„ç»“æ„ã€‚å®ƒçš„å†²çªå†è¾¾åˆ°ä¸€å®šå¤§å°æ—¶ä¼šè½¬åŒ–æˆçº¢é»‘æ ‘ï¼Œåœ¨å†²çªå°äºä¸€å®šæ•°é‡æ—¶åˆé€€å›é“¾è¡¨ã€‚\næºç  ï¼ˆç•¥è¿‡ï¼‰ # ConcurrentHashMap1.7 # å­˜å‚¨ç»“æ„ Segmentæ•°ç»„ï¼ˆè¯¥æ•°ç»„ç”¨æ¥åŠ é”ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ æ˜¯ä¸€ä¸ªHashEntryæ•°ç»„ï¼ˆè¯¥æ•°ç»„å¯èƒ½åŒ…å«é“¾è¡¨ï¼‰ å¦‚å›¾ï¼ŒConcurrentHashMapç”±å¤šä¸ªSegmentç»„åˆï¼Œæ¯ä¸€ä¸ªSegmentæ˜¯ä¸€ä¸ªç±»ä¼¼HashMapçš„ç»“æ„ï¼Œæ¯ä¸€ä¸ªHashMapå†…éƒ¨å¯ä»¥æ‰©å®¹ï¼Œä½†æ˜¯Segmentä¸ªæ•°åˆå§‹åŒ–åä¸èƒ½æ”¹å˜ï¼Œé»˜è®¤16ä¸ªï¼ˆå³é»˜è®¤æ”¯æŒ16ä¸ªçº¿ç¨‹å¹¶å‘ï¼‰ ConcurrentHashMap1.8 # å­˜å‚¨ç»“æ„ å¯ä»¥å‘ç° Java8 çš„ ConcurrentHashMap ç›¸å¯¹äº Java7 æ¥è¯´å˜åŒ–æ¯”è¾ƒå¤§ï¼Œä¸å†æ˜¯ä¹‹å‰çš„ Segment æ•°ç»„ + HashEntry æ•°ç»„ + é“¾è¡¨ï¼Œè€Œæ˜¯ Node æ•°ç»„ + é“¾è¡¨ / çº¢é»‘æ ‘ã€‚å½“å†²çªé“¾è¡¨è¾¾åˆ°ä¸€å®šé•¿åº¦æ—¶ï¼Œé“¾è¡¨ä¼šè½¬æ¢æˆçº¢é»‘æ ‘ã€‚\nåˆå§‹åŒ– initTable\n/** * Initializes table, using the size recorded in sizeCtl. */ private final Node\u0026lt;K,V\u0026gt;[] initTable() { Node\u0026lt;K,V\u0026gt;[] tab; int sc; while ((tab = table) == null || tab.length == 0) { //ã€€å¦‚æœ sizeCtl \u0026lt; 0 ,è¯´æ˜å¦å¤–çš„çº¿ç¨‹æ‰§è¡ŒCAS æˆåŠŸï¼Œæ­£åœ¨è¿›è¡Œåˆå§‹åŒ–ã€‚ if ((sc = sizeCtl) \u0026lt; 0) // è®©å‡º CPU ä½¿ç”¨æƒ Thread.yield(); // lost initialization race; just spin else if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) { try { if ((tab = table) == null || tab.length == 0) { int n = (sc \u0026gt; 0) ? sc : DEFAULT_CAPACITY; @SuppressWarnings(\u0026#34;unchecked\u0026#34;) Node\u0026lt;K,V\u0026gt;[] nt = (Node\u0026lt;K,V\u0026gt;[])new Node\u0026lt;?,?\u0026gt;[n]; table = tab = nt; sc = n - (n \u0026gt;\u0026gt;\u0026gt; 2); } } finally { sizeCtl = sc; } break; } } return tab; } æ˜¯é€šè¿‡è‡ªæ—‹å’ŒCASæ“ä½œå®Œæˆçš„ï¼Œæ³¨æ„çš„å˜é‡æ˜¯sizeCtlï¼Œå®ƒçš„å€¼å†³å®šç€å½“å‰çš„åˆå§‹åŒ–çŠ¶æ€\n-1 è¯´æ˜æ­£åœ¨åˆå§‹åŒ– -N è¯´æ˜æœ‰N-1ä¸ªçº¿ç¨‹æ­£åœ¨è¿›è¡Œæ‰©å®¹ è¡¨ç¤º table åˆå§‹åŒ–å¤§å°ï¼Œå¦‚æœ table æ²¡æœ‰åˆå§‹åŒ– è¡¨ç¤º table å®¹é‡ï¼Œå¦‚æœ tableã€€å·²ç»åˆå§‹åŒ–ã€‚ put\næ ¹æ® key è®¡ç®—å‡º hashcode ã€‚\nåˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œåˆå§‹åŒ–ã€‚\nå³ä¸ºå½“å‰ key å®šä½å‡ºçš„ Nodeï¼Œå¦‚æœä¸ºç©ºè¡¨ç¤ºå½“å‰ä½ç½®å¯ä»¥å†™å…¥æ•°æ®ï¼Œåˆ©ç”¨ CAS å°è¯•å†™å…¥ï¼Œå¤±è´¥åˆ™è‡ªæ—‹ä¿è¯æˆåŠŸã€‚\nå¦‚æœå½“å‰ä½ç½®çš„ hashcode == MOVED == -1,åˆ™éœ€è¦è¿›è¡Œæ‰©å®¹ã€‚\nå¦‚æœéƒ½ä¸æ»¡è¶³ï¼Œåˆ™åˆ©ç”¨ synchronized é”å†™å…¥æ•°æ®ã€‚\nå¦‚æœæ•°é‡å¤§äº TREEIFY_THRESHOLD åˆ™è¦æ‰§è¡Œæ ‘åŒ–æ–¹æ³•ï¼Œåœ¨ treeifyBin ä¸­ä¼šé¦–å…ˆåˆ¤æ–­å½“å‰æ•°ç»„é•¿åº¦â‰¥64æ—¶æ‰ä¼šå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚\nget æµç¨‹æ¯”è¾ƒç®€å•\næ ¹æ® hash å€¼è®¡ç®—ä½ç½®ã€‚ æŸ¥æ‰¾åˆ°æŒ‡å®šä½ç½®ï¼Œå¦‚æœå¤´èŠ‚ç‚¹å°±æ˜¯è¦æ‰¾çš„ï¼Œç›´æ¥è¿”å›å®ƒçš„ value. å¦‚æœå¤´èŠ‚ç‚¹ hash å€¼å°äº 0 ï¼Œè¯´æ˜æ­£åœ¨æ‰©å®¹æˆ–è€…æ˜¯çº¢é»‘æ ‘ï¼ŒæŸ¥æ‰¾ä¹‹ã€‚ å¦‚æœæ˜¯é“¾è¡¨ï¼Œéå†æŸ¥æ‰¾ä¹‹ã€‚ "},{"id":148,"href":"/zh/docs/study/Review/java_guide/java/Collection/ly0106lysource-code-hashmap/","title":"HashMapæºç ","section":"é›†åˆ","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nHashMapç®€ä»‹ # HashMapç”¨æ¥å­˜æ”¾é”®å€¼å¯¹ï¼ŒåŸºäºå“ˆå¸Œè¡¨çš„Mapæ¥å£å®ç°ï¼Œæ˜¯éçº¿ç¨‹å®‰å…¨çš„ å¯ä»¥å­˜å‚¨nullçš„keyå’Œvalueï¼Œä½†nullä½œä¸ºé”®åªèƒ½æœ‰ä¸€ä¸ª JDK8ä¹‹å‰ï¼ŒHashMapç”±æ•°ç»„å’Œé“¾è¡¨ç»„æˆï¼Œé“¾è¡¨æ˜¯ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨ï¼›JDK8ä¹‹åï¼Œå½“é“¾è¡¨å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤8ï¼‰ï¼Œåˆ™ä¼šé€‰æ‹©è½¬ä¸ºçº¢é»‘æ ‘ï¼ˆå½“æ•°ç»„é•¿åº¦å¤§äº64åˆ™è¿›è¡Œè½¬æ¢ï¼Œå¦åˆ™åªæ˜¯æ‰©å®¹ï¼‰ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ HashMapé»˜è®¤åˆå§‹åŒ–å¤§å°ä¸º16ï¼Œæ¯æ¬¡æ‰©å®¹ä¸ºåŸå®¹é‡2å€ï¼Œä¸”æ€»æ˜¯ä½¿ç”¨2çš„å¹‚ä½œä¸ºå“ˆå¸Œè¡¨çš„å¤§å° åº•å±‚æ•°æ®ç»“æ„åˆ†æ # JDK8ä¹‹å‰ï¼ŒHashMapåº•å±‚æ˜¯æ•°ç»„å’Œé“¾è¡¨ï¼Œå³é“¾è¡¨æ•£åˆ—ï¼›é€šè¿‡keyçš„hashCodeï¼Œç»è¿‡æ‰°åŠ¨å‡½æ•°ï¼Œè·å¾—hashå€¼ï¼Œç„¶åå†é€šè¿‡(n-1) \u0026amp; hash åˆ¤æ–­å½“å‰å…ƒç´ å­˜æ”¾ä½ç½®ï¼ˆnæŒ‡çš„æ˜¯æ•°ç»„é•¿åº¦ï¼‰ï¼Œå¦‚æœå½“å‰ä½ç½®å­˜åœ¨å…ƒç´ ï¼Œå°±åˆ¤æ–­å…ƒç´ ä¸è¦å­˜å…¥çš„å…ƒç´ çš„hashå€¼ä»¥åŠkeyæ˜¯å¦ç›¸åŒï¼Œç›¸åŒåˆ™è¦†ç›–ï¼Œå¦åˆ™é€šè¿‡æ‹‰é“¾æ³•è§£å†³\næ‰°åŠ¨å‡½æ•°ï¼Œå³hash(Object key)æ–¹æ³•\n//JDK1.8 static final int hash(Object key) { int h; // key.hashCode()ï¼šè¿”å›æ•£åˆ—å€¼ä¹Ÿå°±æ˜¯hashcode // ^ ï¼šæŒ‰ä½å¼‚æˆ– // \u0026gt;\u0026gt;\u0026gt;:æ— ç¬¦å·å³ç§»ï¼Œå¿½ç•¥ç¬¦å·ä½ï¼Œç©ºä½éƒ½ä»¥0è¡¥é½ return (key == null) ? 0 : (h = key.hashCode()) ^ (h \u0026gt;\u0026gt;\u0026gt; 16); } JDK1.7\n//JDK1.7 , åˆ™æ‰°åŠ¨äº†4æ¬¡ï¼Œæ€§èƒ½è¾ƒå·® static int hash(int h) { // This function ensures that hashCodes that differ only by // constant multiples at each bit position have a bounded // number of collisions (approximately 8 at default load factor). h ^= (h \u0026gt;\u0026gt;\u0026gt; 20) ^ (h \u0026gt;\u0026gt;\u0026gt; 12); return h ^ (h \u0026gt;\u0026gt;\u0026gt; 7) ^ (h \u0026gt;\u0026gt;\u0026gt; 4); } JDK1.8ä¹‹åï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8ï¼‰æ—¶ï¼Œä¼šé¦–å…ˆè°ƒç”¨ treeifyBin()æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šæ ¹æ® HashMap æ•°ç»„æ¥å†³å®šæ˜¯å¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚åªæœ‰å½“æ•°ç»„é•¿åº¦å¤§äºæˆ–è€…ç­‰äº 64 çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šæ‰§è¡Œè½¬æ¢çº¢é»‘æ ‘æ“ä½œï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚å¦åˆ™ï¼Œå°±æ˜¯åªæ˜¯æ‰§è¡Œ resize() æ–¹æ³•å¯¹æ•°ç»„æ‰©å®¹ã€‚ç›¸å…³æºç è¿™é‡Œå°±ä¸è´´äº†ï¼Œé‡ç‚¹å…³æ³¨ treeifyBin()æ–¹æ³•å³å¯ï¼\nHashMapä¸€äº›å±æ€§\npublic class HashMap\u0026lt;K,V\u0026gt; extends AbstractMap\u0026lt;K,V\u0026gt; implements Map\u0026lt;K,V\u0026gt;, Cloneable, Serializable { // åºåˆ—å· private static final long serialVersionUID = 362498820763181265L; // é»˜è®¤çš„åˆå§‹å®¹é‡æ˜¯16 static final int DEFAULT_INITIAL_CAPACITY = 1 \u0026lt;\u0026lt; 4; // æœ€å¤§å®¹é‡ static final int MAXIMUM_CAPACITY = 1 \u0026lt;\u0026lt; 30; // é»˜è®¤çš„å¡«å……å› å­ static final float DEFAULT_LOAD_FACTOR = 0.75f; // å½“æ¡¶(bucket)ä¸Šçš„ç»“ç‚¹æ•°å¤§äºè¿™ä¸ªå€¼æ—¶ä¼šè½¬æˆçº¢é»‘æ ‘ static final int TREEIFY_THRESHOLD = 8; // å½“æ¡¶(bucket)ä¸Šçš„ç»“ç‚¹æ•°å°äºè¿™ä¸ªå€¼æ—¶æ ‘è½¬é“¾è¡¨ static final int UNTREEIFY_THRESHOLD = 6; // æ¡¶ä¸­ç»“æ„è½¬åŒ–ä¸ºçº¢é»‘æ ‘å¯¹åº”çš„tableçš„æœ€å°å®¹é‡ static final int MIN_TREEIFY_CAPACITY = 64; // å­˜å‚¨å…ƒç´ çš„æ•°ç»„ï¼Œæ€»æ˜¯2çš„å¹‚æ¬¡å€ transient Node\u0026lt;k,v\u0026gt;[] table; // å­˜æ”¾å…·ä½“å…ƒç´ çš„é›† transient Set\u0026lt;map.entry\u0026lt;k,v\u0026gt;\u0026gt; entrySet; // å­˜æ”¾å…ƒç´ çš„ä¸ªæ•°ï¼Œæ³¨æ„è¿™ä¸ªä¸ç­‰äºæ•°ç»„çš„é•¿åº¦ã€‚ transient int size; // æ¯æ¬¡æ‰©å®¹å’Œæ›´æ”¹mapç»“æ„çš„è®¡æ•°å™¨ transient int modCount; // ä¸´ç•Œå€¼(å®¹é‡*å¡«å……å› å­) å½“å®é™…å¤§å°è¶…è¿‡ä¸´ç•Œå€¼æ—¶ï¼Œä¼šè¿›è¡Œæ‰©å®¹ int threshold; // åŠ è½½å› å­ final float loadFactor; } LoadFactor åŠ è½½å› å­\nloadFactor åŠ è½½å› å­æ˜¯æ§åˆ¶æ•°ç»„å­˜æ”¾æ•°æ®çš„ç–å¯†ç¨‹åº¦ï¼ŒloadFactor è¶Šè¶‹è¿‘äº 1ï¼Œé‚£ä¹ˆ æ•°ç»„ä¸­å­˜æ”¾çš„æ•°æ®(entry)ã€è¯´çš„å°±æ˜¯æ•°ç»„ä¸ªæ•°ã€‘ä¹Ÿå°±è¶Šå¤š**ï¼Œä¹Ÿå°±è¶Šå¯†ï¼Œä¹Ÿå°±æ˜¯ä¼šè®©é“¾è¡¨çš„é•¿åº¦å¢åŠ ï¼ŒloadFactor è¶Šå°ï¼Œä¹Ÿå°±æ˜¯è¶‹è¿‘äº 0ï¼Œæ•°ç»„ä¸­å­˜æ”¾çš„æ•°æ®(entry)ä¹Ÿå°±è¶Šå°‘ï¼Œä¹Ÿå°±è¶Šç¨€ç–ã€‚\nloadFactor å¤ªå¤§å¯¼è‡´æŸ¥æ‰¾å…ƒç´ æ•ˆç‡ä½ï¼Œå¤ªå°å¯¼è‡´æ•°ç»„çš„åˆ©ç”¨ç‡ä½ï¼Œå­˜æ”¾çš„æ•°æ®ä¼šå¾ˆåˆ†æ•£ã€‚loadFactor çš„é»˜è®¤å€¼ä¸º 0.75f æ˜¯å®˜æ–¹ç»™å‡ºçš„ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä¸´ç•Œå€¼ã€‚\nç»™å®šçš„é»˜è®¤å®¹é‡ä¸º 16ï¼Œè´Ÿè½½å› å­ä¸º 0.75ã€‚Map åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸æ–­çš„å¾€é‡Œé¢å­˜æ”¾æ•°æ®ï¼Œå½“æ•°é‡è¾¾åˆ°äº† 16 * 0.75 = 12 å°±éœ€è¦å°†å½“å‰ 16 çš„å®¹é‡è¿›è¡Œæ‰©å®¹ï¼Œè€Œæ‰©å®¹è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ° rehashã€å¤åˆ¶æ•°æ®ç­‰æ“ä½œï¼Œæ‰€ä»¥éå¸¸æ¶ˆè€—æ€§èƒ½ã€‚\nthreshold threshold è‹±[ËˆÎ¸reÊƒhÉ™ÊŠld] threshold = capacity * loadFactorï¼Œå³å­˜æ”¾çš„å…ƒç´ Size å¦‚æœ \u0026gt; threshold ï¼Œå³capacity * 0.75çš„æ—¶å€™ï¼Œå°±è¦è€ƒè™‘æ‰©å®¹äº†\nNodeç±»ç»“ç‚¹æºç \n// ç»§æ‰¿è‡ª Map.Entry\u0026lt;K,V\u0026gt; static class Node\u0026lt;K,V\u0026gt; implements Map.Entry\u0026lt;K,V\u0026gt; { final int hash;// å“ˆå¸Œå€¼ï¼Œå­˜æ”¾å…ƒç´ åˆ°hashmapä¸­æ—¶ç”¨æ¥ä¸å…¶ä»–å…ƒç´ hashå€¼æ¯”è¾ƒ final K key;//é”® V value;//å€¼ // æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ Node\u0026lt;K,V\u0026gt; next; Node(int hash, K key, V value, Node\u0026lt;K,V\u0026gt; next) { this.hash = hash; this.key = key; this.value = value; this.next = next; } public final K getKey() { return key; } public final V getValue() { return value; } public final String toString() { return key + \u0026#34;=\u0026#34; + value; } // é‡å†™hashCode()æ–¹æ³• public final int hashCode() { return Objects.hashCode(key) ^ Objects.hashCode(value); } public final V setValue(V newValue) { V oldValue = value; value = newValue; return oldValue; } // é‡å†™ equals() æ–¹æ³• public final boolean equals(Object o) { if (o == this) return true; if (o instanceof Map.Entry) { Map.Entry\u0026lt;?,?\u0026gt; e = (Map.Entry\u0026lt;?,?\u0026gt;)o; if (Objects.equals(key, e.getKey()) \u0026amp;\u0026amp; Objects.equals(value, e.getValue())) return true; } return false; } } æ ‘èŠ‚ç‚¹ç±»æºç \nstatic final class TreeNode\u0026lt;K,V\u0026gt; extends LinkedHashMap.Entry\u0026lt;K,V\u0026gt; { TreeNode\u0026lt;K,V\u0026gt; parent; // çˆ¶ TreeNode\u0026lt;K,V\u0026gt; left; // å·¦ TreeNode\u0026lt;K,V\u0026gt; right; // å³ TreeNode\u0026lt;K,V\u0026gt; prev; // needed to unlink next upon deletion boolean red; // åˆ¤æ–­é¢œè‰² TreeNode(int hash, K key, V val, Node\u0026lt;K,V\u0026gt; next) { super(hash, key, val, next); } // è¿”å›æ ¹èŠ‚ç‚¹ final TreeNode\u0026lt;K,V\u0026gt; root() { for (TreeNode\u0026lt;K,V\u0026gt; r = this, p;;) { if ((p = r.parent) == null) return r; r = p; } HashMapæºç åˆ†æ # æ„é€ æ–¹æ³•(4ä¸ªï¼Œç©ºå‚/Map/æŒ‡å®šå®¹é‡å¤§å°/å®¹é‡å¤§å°åŠåŠ è½½å› å­)\n// é»˜è®¤æ„é€ å‡½æ•°ã€‚ public HashMap() { this.loadFactor = DEFAULT_LOAD_FACTOR; // all other fields defaulted } // åŒ…å«å¦ä¸€ä¸ªâ€œMapâ€çš„æ„é€ å‡½æ•° public HashMap(Map\u0026lt;? extends K, ? extends V\u0026gt; m) { this.loadFactor = DEFAULT_LOAD_FACTOR; putMapEntries(m, false);//ä¸‹é¢ä¼šåˆ†æåˆ°è¿™ä¸ªæ–¹æ³• } // æŒ‡å®šâ€œå®¹é‡å¤§å°â€çš„æ„é€ å‡½æ•° public HashMap(int initialCapacity) { this(initialCapacity, DEFAULT_LOAD_FACTOR); } // æŒ‡å®šâ€œå®¹é‡å¤§å°â€å’Œâ€œåŠ è½½å› å­â€çš„æ„é€ å‡½æ•° public HashMap(int initialCapacity, float loadFactor) { if (initialCapacity \u0026lt; 0) throw new IllegalArgumentException(\u0026#34;Illegal initial capacity: \u0026#34; + initialCapacity); if (initialCapacity \u0026gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; if (loadFactor \u0026lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException(\u0026#34;Illegal load factor: \u0026#34; + loadFactor); this.loadFactor = loadFactor; this.threshold = tableSizeFor(initialCapacity); } //putMapEntriesæ–¹æ³• final void putMapEntries(Map\u0026lt;? extends K, ? extends V\u0026gt; m, boolean evict) { int s = m.size(); if (s \u0026gt; 0) { // åˆ¤æ–­tableæ˜¯å¦å·²ç»åˆå§‹åŒ– if (table == null) { // pre-size // æœªåˆå§‹åŒ–ï¼Œsä¸ºmçš„å®é™…å…ƒç´ ä¸ªæ•° float ft = ((float)s / loadFactor) + 1.0F; int t = ((ft \u0026lt; (float)MAXIMUM_CAPACITY) ? (int)ft : MAXIMUM_CAPACITY); // è®¡ç®—å¾—åˆ°çš„tå¤§äºé˜ˆå€¼ï¼Œåˆ™åˆå§‹åŒ–é˜ˆå€¼ if (t \u0026gt; threshold) threshold = tableSizeFor(t); } // å·²åˆå§‹åŒ–ï¼Œå¹¶ä¸”må…ƒç´ ä¸ªæ•°å¤§äºé˜ˆå€¼ï¼Œè¿›è¡Œæ‰©å®¹å¤„ç† else if (s \u0026gt; threshold) resize(); // å°†mä¸­çš„æ‰€æœ‰å…ƒç´ æ·»åŠ è‡³HashMapä¸­ for (Map.Entry\u0026lt;? extends K, ? extends V\u0026gt; e : m.entrySet()) { K key = e.getKey(); V value = e.getValue(); putVal(hash(key), key, value, false, evict); } } } putæ–¹æ³•ï¼ˆå¯¹å¤–åªæä¾›putï¼Œæ²¡æœ‰putVal) putValæ–¹æ³•æ·»åŠ å…ƒç´ åˆ†æ\nå¦‚æœå®šä½åˆ°çš„æ•°ç»„ä½ç½®æ²¡æœ‰å…ƒç´ ç›´æ¥æ’å…¥\nå¦‚æœæœ‰ï¼Œåˆ™æ¯”è¾ƒkeyï¼Œå¦‚æœkeyç›¸åŒåˆ™è¦†ç›–ï¼Œä¸åŒåˆ™åˆ¤æ–­æ˜¯å¦æ˜¯å¦æ˜¯ä¸€ä¸ªæ ‘èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯å°±è°ƒç”¨e = ((TreeNode\u0026lt;K,V\u0026gt;)p).putTreeVal(this, tab, hash, key, value)å°†å…ƒç´ æ·»åŠ è¿›å…¥ï¼›å¦‚æœä¸æ˜¯ï¼Œåˆ™éå†é“¾è¡¨æ’å…¥(é“¾è¡¨å°¾éƒ¨) ```java //æºç  public V put(K key, V value) { return putVal(hash(key), key, value, false, true); }\nfinal V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) { Node\u0026lt;K,V\u0026gt;[] tab; Node\u0026lt;K,V\u0026gt; p; int n, i; // tableæœªåˆå§‹åŒ–æˆ–è€…é•¿åº¦ä¸º0ï¼Œè¿›è¡Œæ‰©å®¹ if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; // (n - 1) \u0026amp; hash ç¡®å®šå…ƒç´ å­˜æ”¾åœ¨å“ªä¸ªæ¡¶ä¸­ï¼Œæ¡¶ä¸ºç©ºï¼Œæ–°ç”Ÿæˆç»“ç‚¹æ”¾å…¥æ¡¶ä¸­(æ­¤æ—¶ï¼Œè¿™ä¸ªç»“ç‚¹æ˜¯æ”¾åœ¨æ•°ç»„ä¸­) if ((p = tab[i = (n - 1) \u0026amp; hash]) == null) tab[i] = newNode(hash, key, value, null); // æ¡¶ä¸­å·²ç»å­˜åœ¨å…ƒç´ ï¼ˆå¤„ç†hashå†²çªï¼‰ else { Node\u0026lt;K,V\u0026gt; e; K k; // åˆ¤æ–­table[i]ä¸­çš„å…ƒç´ æ˜¯å¦ä¸æ’å…¥çš„keyä¸€æ ·ï¼Œè‹¥ç›¸åŒé‚£å°±ç›´æ¥ä½¿ç”¨æ’å…¥çš„å€¼pæ›¿æ¢æ‰æ—§çš„å€¼eã€‚ if (p.hash == hash \u0026amp;\u0026amp; ((k = p.key) == key || (key != null \u0026amp;\u0026amp; key.equals(k)))) e = p; // åˆ¤æ–­æ’å…¥çš„æ˜¯å¦æ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ else if (p instanceof TreeNode) // æ”¾å…¥æ ‘ä¸­ e = ((TreeNode\u0026lt;K,V\u0026gt;)p).putTreeVal(this, tab, hash, key, value); // ä¸æ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹åˆ™è¯´æ˜ä¸ºé“¾è¡¨ç»“ç‚¹ else { // åœ¨é“¾è¡¨æœ€æœ«æ’å…¥ç»“ç‚¹ for (int binCount = 0; ; ++binCount) { // åˆ°è¾¾é“¾è¡¨çš„å°¾éƒ¨ if ((e = p.next) == null) { // åœ¨å°¾éƒ¨æ’å…¥æ–°ç»“ç‚¹ p.next = newNode(hash, key, value, null); // ç»“ç‚¹æ•°é‡è¾¾åˆ°é˜ˆå€¼(é»˜è®¤ä¸º 8 )ï¼Œæ‰§è¡Œ treeifyBin æ–¹æ³• // è¿™ä¸ªæ–¹æ³•ä¼šæ ¹æ® HashMap æ•°ç»„æ¥å†³å®šæ˜¯å¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚ // åªæœ‰å½“æ•°ç»„é•¿åº¦å¤§äºæˆ–è€…ç­‰äº 64 çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šæ‰§è¡Œè½¬æ¢çº¢é»‘æ ‘æ“ä½œï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚å¦åˆ™ï¼Œå°±æ˜¯åªæ˜¯å¯¹æ•°ç»„æ‰©å®¹ã€‚ if (binCount \u0026gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st treeifyBin(tab, hash); // è·³å‡ºå¾ªç¯ break; } // åˆ¤æ–­é“¾è¡¨ä¸­ç»“ç‚¹çš„keyå€¼ä¸æ’å…¥çš„å…ƒç´ çš„keyå€¼æ˜¯å¦ç›¸ç­‰ if (e.hash == hash \u0026amp;\u0026amp; ((k = e.key) == key || (key != null \u0026amp;\u0026amp; key.equals(k)))) // ç›¸ç­‰ï¼Œè·³å‡ºå¾ªç¯ break; // ç”¨äºéå†æ¡¶ä¸­çš„é“¾è¡¨ï¼Œä¸å‰é¢çš„e = p.nextç»„åˆï¼Œå¯ä»¥éå†é“¾è¡¨ p = e; } } // è¡¨ç¤ºåœ¨æ¡¶ä¸­æ‰¾åˆ°keyå€¼ã€hashå€¼ä¸æ’å…¥å…ƒç´ ç›¸ç­‰çš„ç»“ç‚¹ if (e != null) { // è®°å½•eçš„value V oldValue = e.value; // onlyIfAbsentä¸ºfalseæˆ–è€…æ—§å€¼ä¸ºnull if (!onlyIfAbsent || oldValue == null) //ç”¨æ–°å€¼æ›¿æ¢æ—§å€¼ e.value = value; // è®¿é—®åå›è°ƒ afterNodeAccess(e); // è¿”å›æ—§å€¼ return oldValue; } } // ç»“æ„æ€§ä¿®æ”¹ ++modCount; // å®é™…å¤§å°å¤§äºé˜ˆå€¼åˆ™æ‰©å®¹ if (++size \u0026gt; threshold) resize(); // æ’å…¥åå›è°ƒ afterNodeInsertion(evict); return null; } ``` å¯¹æ¯”1.7ä¸­çš„putæ–¹æ³•\nâ‘  å¦‚æœå®šä½åˆ°çš„æ•°ç»„ä½ç½®æ²¡æœ‰å…ƒç´  å°±ç›´æ¥æ’å…¥ã€‚\nâ‘¡ å¦‚æœå®šä½åˆ°çš„æ•°ç»„ä½ç½®æœ‰å…ƒç´ ï¼Œéå†ä»¥è¿™ä¸ªå…ƒç´ ä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨ï¼Œä¾æ¬¡å’Œæ’å…¥çš„ key æ¯”è¾ƒï¼Œå¦‚æœ key ç›¸åŒå°±ç›´æ¥è¦†ç›–ï¼Œä¸åŒå°±é‡‡ç”¨å¤´æ’æ³•æ’å…¥å…ƒç´ ã€‚\n//æºç  public V put(K key, V value) if (table == EMPTY_TABLE) { inflateTable(threshold); } if (key == null) return putForNullKey(value); int hash = hash(key); int i = indexFor(hash, table.length); for (Entry\u0026lt;K,V\u0026gt; e = table[i]; e != null; e = e.next) { // å…ˆéå† Object k; if (e.hash == hash \u0026amp;\u0026amp; ((k = e.key) == key || key.equals(k))) { V oldValue = e.value; e.value = value; e.recordAccess(this); return oldValue; } }\nmodCount++; addEntry(hash, key, value, i); // å†æ’å…¥ return null; }\ngetæ–¹æ³• //å…ˆç®—hashå€¼ï¼Œç„¶åç®—å‡ºkeyåœ¨æ•°ç»„ä¸­çš„indexä¸‹æ ‡ï¼Œç„¶åå°±è¦åœ¨æ•°ç»„ä¸­å–å€¼äº†ï¼ˆå…ˆåˆ¤æ–­ç¬¬ä¸€ä¸ªç»“ç‚¹(é“¾è¡¨/æ ‘))ã€‚å¦‚æœç›¸ç­‰ï¼Œåˆ™è¿”å›ï¼Œå¦‚æœä¸ç›¸ç­‰åˆ™åˆ†ä¸¤ç§æƒ…å†µï¼šåœ¨ï¼ˆçº¢é»‘æ ‘ï¼‰æ ‘ä¸­getæˆ–è€… é“¾è¡¨ä¸­getï¼ˆéœ€è¦éå†ï¼‰\npublic V get(Object key) { Node\u0026lt;K,V\u0026gt; e; return (e = getNode(hash(key), key)) == null ? null : e.value; }\nfinal Node\u0026lt;K,V\u0026gt; getNode(int hash, Object key) { Node\u0026lt;K,V\u0026gt;[] tab; Node\u0026lt;K,V\u0026gt; first, e; int n; K k; if ((tab = table) != null \u0026amp;\u0026amp; (n = tab.length) \u0026gt; 0 \u0026amp;\u0026amp; (first = tab[(n - 1) \u0026amp; hash]) != null) { // æ•°ç»„å…ƒç´ ç›¸ç­‰ if (first.hash == hash \u0026amp;\u0026amp; // always check first node ((k = first.key) == key || (key != null \u0026amp;\u0026amp; key.equals(k)))) return first; // æ¡¶ä¸­ä¸æ­¢ä¸€ä¸ªèŠ‚ç‚¹ if ((e = first.next) != null) { // åœ¨æ ‘ä¸­get if (first instanceof TreeNode) return ((TreeNode\u0026lt;K,V\u0026gt;)first).getTreeNode(hash, key); // åœ¨é“¾è¡¨ä¸­get do { if (e.hash == hash \u0026amp;\u0026amp; ((k = e.key) == key || (key != null \u0026amp;\u0026amp; key.equals(k)))) return e; } while ((e = e.next) != null); } } return null; } ``` resizeæ–¹æ³• æ¯æ¬¡æ‰©å®¹ï¼Œéƒ½ä¼šè¿›è¡Œä¸€æ¬¡é‡æ–°hashåˆ†é…ï¼Œä¸”ä¼šéå†æ‰€æœ‰å…ƒç´ ï¼ˆéå¸¸è€—æ—¶ï¼‰\nfinal Node\u0026lt;K,V\u0026gt;[] resize() { Node\u0026lt;K,V\u0026gt;[] oldTab = table; int oldCap = (oldTab == null) ? 0 : oldTab.length; int oldThr = threshold; int newCap, newThr = 0; if (oldCap \u0026gt; 0) { // è¶…è¿‡æœ€å¤§å€¼å°±ä¸å†æ‰©å……äº†ï¼Œå°±åªå¥½éšä½ ç¢°æ’å»å§ if (oldCap \u0026gt;= MAXIMUM_CAPACITY) { threshold = Integer.MAX_VALUE; return oldTab; } // æ²¡è¶…è¿‡æœ€å¤§å€¼ï¼Œå°±æ‰©å……ä¸ºåŸæ¥çš„2å€ else if ((newCap = oldCap \u0026laquo; 1) \u0026lt; MAXIMUM_CAPACITY \u0026amp;\u0026amp; oldCap \u0026gt;= DEFAULT_INITIAL_CAPACITY) newThr = oldThr \u0026laquo; 1; // double threshold } else if (oldThr \u0026gt; 0) // initial capacity was placed in threshold newCap = oldThr; else { // signifies using defaults newCap = DEFAULT_INITIAL_CAPACITY; newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); } // è®¡ç®—æ–°çš„resizeä¸Šé™ if (newThr == 0) { float ft = (float)newCap * loadFactor; newThr = (newCap \u0026lt; MAXIMUM_CAPACITY \u0026amp;\u0026amp; ft \u0026lt; (float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE); } threshold = newThr; @SuppressWarnings({\u0026ldquo;rawtypes\u0026rdquo;,\u0026ldquo;unchecked\u0026rdquo;}) Node\u0026lt;K,V\u0026gt;[] newTab = (Node\u0026lt;K,V\u0026gt;[])new Node[newCap]; table = newTab; if (oldTab != null) { // æŠŠæ¯ä¸ªbucketéƒ½ç§»åŠ¨åˆ°æ–°çš„bucketsä¸­ for (int j = 0; j \u0026lt; oldCap; ++j) { Node\u0026lt;K,V\u0026gt; e; if ((e = oldTab[j]) != null) { oldTab[j] = null; if (e.next == null) newTab[e.hash \u0026amp; (newCap - 1)] = e; else if (e instanceof TreeNode) ((TreeNode\u0026lt;K,V\u0026gt;)e).split(this, newTab, j, oldCap); else { Node\u0026lt;K,V\u0026gt; loHead = null, loTail = null; Node\u0026lt;K,V\u0026gt; hiHead = null, hiTail = null; Node\u0026lt;K,V\u0026gt; next; do { next = e.next; // åŸç´¢å¼• if ((e.hash \u0026amp; oldCap) == 0) { if (loTail == null) loHead = e; else loTail.next = e; loTail = e; } // åŸç´¢å¼•+oldCap else { if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e; } } while ((e = next) != null); // åŸç´¢å¼•æ”¾åˆ°bucketé‡Œ if (loTail != null) { loTail.next = null; newTab[j] = loHead; } // åŸç´¢å¼•+oldCapæ”¾åˆ°bucketé‡Œ if (hiTail != null) { hiTail.next = null; newTab[j + oldCap] = hiHead; } } } } } return newTab; } ```\nHashMapå¸¸ç”¨æ–¹æ³•æµ‹è¯• # package map; import java.util.Collection; import java.util.HashMap; import java.util.Set; public class HashMapDemo { public static void main(String[] args) { HashMap\u0026lt;String, String\u0026gt; map = new HashMap\u0026lt;String, String\u0026gt;(); // é”®ä¸èƒ½é‡å¤ï¼Œå€¼å¯ä»¥é‡å¤ map.put(\u0026#34;san\u0026#34;, \u0026#34;å¼ ä¸‰\u0026#34;); map.put(\u0026#34;si\u0026#34;, \u0026#34;æå››\u0026#34;); map.put(\u0026#34;wu\u0026#34;, \u0026#34;ç‹äº”\u0026#34;); map.put(\u0026#34;wang\u0026#34;, \u0026#34;è€ç‹\u0026#34;); map.put(\u0026#34;wang\u0026#34;, \u0026#34;è€ç‹2\u0026#34;);// è€ç‹è¢«è¦†ç›– map.put(\u0026#34;lao\u0026#34;, \u0026#34;è€ç‹\u0026#34;); System.out.println(\u0026#34;-------ç›´æ¥è¾“å‡ºhashmap:-------\u0026#34;); System.out.println(map); /** * éå†HashMap */ // 1.è·å–Mapä¸­çš„æ‰€æœ‰é”® System.out.println(\u0026#34;-------foreachè·å–Mapä¸­æ‰€æœ‰çš„é”®:------\u0026#34;); Set\u0026lt;String\u0026gt; keys = map.keySet(); for (String key : keys) { System.out.print(key+\u0026#34; \u0026#34;); } System.out.println();//æ¢è¡Œ // 2.è·å–Mapä¸­æ‰€æœ‰å€¼ System.out.println(\u0026#34;-------foreachè·å–Mapä¸­æ‰€æœ‰çš„å€¼:------\u0026#34;); Collection\u0026lt;String\u0026gt; values = map.values(); for (String value : values) { System.out.print(value+\u0026#34; \u0026#34;); } System.out.println();//æ¢è¡Œ // 3.å¾—åˆ°keyçš„å€¼çš„åŒæ—¶å¾—åˆ°keyæ‰€å¯¹åº”çš„å€¼ System.out.println(\u0026#34;-------å¾—åˆ°keyçš„å€¼çš„åŒæ—¶å¾—åˆ°keyæ‰€å¯¹åº”çš„å€¼:-------\u0026#34;); Set\u0026lt;String\u0026gt; keys2 = map.keySet(); for (String key : keys2) { System.out.print(key + \u0026#34;ï¼š\u0026#34; + map.get(key)+\u0026#34; \u0026#34;); } /** * å¦‚æœæ—¢è¦éå†keyåˆè¦valueï¼Œé‚£ä¹ˆå»ºè®®è¿™ç§æ–¹å¼ï¼Œå› ä¸ºå¦‚æœå…ˆè·å–keySetç„¶åå†æ‰§è¡Œmap.get(key)ï¼Œmapå†…éƒ¨ä¼šæ‰§è¡Œä¸¤æ¬¡éå†ã€‚ * ä¸€æ¬¡æ˜¯åœ¨è·å–keySetçš„æ—¶å€™ï¼Œä¸€æ¬¡æ˜¯åœ¨éå†æ‰€æœ‰keyçš„æ—¶å€™ã€‚ */ // å½“æˆ‘è°ƒç”¨put(key,value)æ–¹æ³•çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šæŠŠkeyå’Œvalueå°è£…åˆ° // Entryè¿™ä¸ªé™æ€å†…éƒ¨ç±»å¯¹è±¡ä¸­ï¼ŒæŠŠEntryå¯¹è±¡å†æ·»åŠ åˆ°æ•°ç»„ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬æƒ³è·å– // mapä¸­çš„æ‰€æœ‰é”®å€¼å¯¹ï¼Œæˆ‘ä»¬åªè¦è·å–æ•°ç»„ä¸­çš„æ‰€æœ‰Entryå¯¹è±¡ï¼Œæ¥ä¸‹æ¥ // è°ƒç”¨Entryå¯¹è±¡ä¸­çš„getKey()å’ŒgetValue()æ–¹æ³•å°±èƒ½è·å–é”®å€¼å¯¹äº† Set\u0026lt;java.util.Map.Entry\u0026lt;String, String\u0026gt;\u0026gt; entrys = map.entrySet(); for (java.util.Map.Entry\u0026lt;String, String\u0026gt; entry : entrys) { System.out.println(entry.getKey() + \u0026#34;--\u0026#34; + entry.getValue()); } /** * HashMapå…¶ä»–å¸¸ç”¨æ–¹æ³• */ System.out.println(\u0026#34;after map.size()ï¼š\u0026#34;+map.size()); System.out.println(\u0026#34;after map.isEmpty()ï¼š\u0026#34;+map.isEmpty()); System.out.println(map.remove(\u0026#34;san\u0026#34;)); System.out.println(\u0026#34;after map.remove()ï¼š\u0026#34;+map); System.out.println(\u0026#34;after map.get(si)ï¼š\u0026#34;+map.get(\u0026#34;si\u0026#34;)); System.out.println(\u0026#34;after map.containsKey(si)ï¼š\u0026#34;+map.containsKey(\u0026#34;si\u0026#34;)); System.out.println(\u0026#34;after containsValue(æå››)ï¼š\u0026#34;+map.containsValue(\u0026#34;æå››\u0026#34;)); System.out.println(map.replace(\u0026#34;si\u0026#34;, \u0026#34;æå››2\u0026#34;)); System.out.println(\u0026#34;after map.replace(si, æå››2):\u0026#34;+map); } } å¤§éƒ¨åˆ†è½¬è‡ªhttps://github.com/Snailclimb/JavaGuide\n"},{"id":149,"href":"/zh/docs/study/Review/java_guide/java/Collection/ly0104lysource-code-ArrayList/","title":"ArrayListæºç ","section":"é›†åˆ","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nç®€ä»‹ # åº•å±‚æ˜¯æ•°ç»„é˜Ÿåˆ—ï¼Œç›¸å½“äºåŠ¨æ€æ•°ç»„ï¼Œèƒ½åŠ¨æ€å¢é•¿ï¼Œå¯ä»¥åœ¨æ·»åŠ å¤§é‡å…ƒç´ å‰å…ˆä½¿ç”¨ensureCapacityæ¥å¢åŠ ArrayListå®¹é‡ï¼Œå‡å°‘é€’å¢å¼å†åˆ†é…çš„æ•°é‡ æºç ï¼š\npublic class ArrayList\u0026lt;E\u0026gt; extends AbstractList\u0026lt;E\u0026gt; implements List\u0026lt;E\u0026gt;, RandomAccess, Cloneable, java.io.Serializable{ } Random Accessï¼Œæ ‡å¿—æ¥å£ï¼Œè¡¨æ˜è¿™ä¸ªæ¥å£çš„Listé›†åˆæ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼Œè¿™é‡Œæ˜¯æŒ‡å¯é€šè¿‡å…ƒç´ åºå·å¿«é€Ÿè®¿é—® å®ç°Cloneableæ¥å£ï¼Œèƒ½è¢«å…‹éš† å®ç°java.io.Serializableï¼Œæ”¯æŒåºåˆ—åŒ– ArrayListå’ŒVectoråŒºåˆ«\nArrayListå’ŒVectoréƒ½æ˜¯Listçš„å®ç°ç±»ï¼ŒVectorå‡ºç°çš„æ¯”è¾ƒæ—©ï¼Œåº•å±‚éƒ½æ˜¯Object[] å­˜å‚¨ ArrayListçº¿ç¨‹ä¸å®‰å…¨ï¼ˆé€‚åˆé¢‘ç¹æŸ¥æ‰¾ï¼Œçº¿ç¨‹ä¸å®‰å…¨ ï¼‰ Vector çº¿ç¨‹å®‰å…¨çš„ ArrayListä¸LinkedListåŒºåˆ«\néƒ½æ˜¯ä¸åŒæ­¥çš„ï¼Œå³ä¸ä¿è¯çº¿ç¨‹å®‰å…¨\nArrayListåº•å±‚ä¸ºObjectæ•°ç»„ï¼›LinkedListåº•å±‚ä½¿ç”¨åŒå‘é“¾è¡¨æ•°æ®ç»“æ„(1.6ä¹‹å‰ä¸ºå¾ªç¯é“¾è¡¨ï¼Œ1.7å–æ¶ˆäº†å¾ªç¯)\næ’å…¥å’Œåˆ é™¤æ˜¯å¦å—å…ƒç´ ä½ç½®å½±å“\nArrayListé‡‡ç”¨æ•°ç»„å­˜å‚¨ï¼Œæ‰€ä»¥æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦å—å…ƒç´ ä½ç½®å½±å“[ é»˜è®¤å¢åŠ åˆ°æœ«å°¾ï¼ŒO(1) ; åœ¨æŒ‡å®šä½ç½®ï¼Œåˆ™O(n) , è¦å¾€åç§»åŠ¨]\nLinkedListé‡‡ç”¨é“¾è¡¨å­˜å‚¨ï¼Œæ‰€ä»¥å¯¹äºadd(E e)æ–¹æ³•ï¼Œè¿˜æ˜¯O(1)ï¼›å¦‚æœæ˜¯åœ¨æŒ‡å®šä½ç½®æ’å…¥å’Œåˆ é™¤ï¼Œåˆ™ä¸ºO(n) å› ä¸ºéœ€è¦éå†å°†æŒ‡é’ˆç§»åŠ¨åˆ°æŒ‡å®šä½ç½®\n//LinkedListé»˜è®¤æ·»åŠ åˆ°æœ€å public boolean add(E e) { linkLast(e); return true; } LinkedListä¸æ”¯æŒé«˜æ•ˆéšæœºå…ƒç´ è®¿é—®ï¼Œè€ŒArrayListæ”¯æŒï¼ˆé€šè¿‡get(int index))\nå†…å­˜ç©ºé—´å ç”¨ ArrayListçš„ç©ºé—´æµªè´¹ä¸»è¦ä½“ç°åœ¨liståˆ—è¡¨çš„ç»“å°¾ä¼šé¢„ç•™ä¸€å®šçš„å®¹é‡ç©ºé—´ï¼Œè€ŒLinkedListçš„ç©ºé—´èŠ±è´¹åœ¨ï¼Œæ¯ä¸ªå…ƒç´ éƒ½éœ€è¦æ¯”ArrayListæ›´å¤šç©ºé—´ï¼ˆè¦å­˜æ”¾ç›´æ¥å‰é©±å’Œç›´æ¥åç»§ä»¥åŠ(å½“å‰)æ•°æ®)\n3. æ‰©å®¹æœºåˆ¶åˆ†æ ( JDK8 ) # ArrayListçš„æ„é€ å‡½æ•°\nä¸‰ç§æ–¹å¼åˆå§‹åŒ–ï¼Œæ„é€ æ–¹æ³•æºç  ç©ºå‚ï¼ŒæŒ‡å®šå¤§å°ï¼ŒæŒ‡å®šé›†åˆ ï¼ˆå¦‚æœé›†åˆç±»å‹éObject[].classï¼Œåˆ™ä½¿ç”¨Arrays.copyOfè½¬ä¸ºObject[].class) ä»¥æ— å‚æ„é€ æ–¹å¼åˆ›å»ºArrayListæ—¶ï¼Œå®é™…ä¸Šåˆå§‹åŒ–èµ‹å€¼çš„æ˜¯ç©ºæ•°ç»„ï¼›å½“çœŸæ­£æ“ä½œæ—¶æ‰åˆ†é…å®¹é‡ï¼Œå³æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶æ‰©å®¹ä¸º10 /** * é»˜è®¤åˆå§‹å®¹é‡å¤§å° */ private static final int DEFAULT_CAPACITY = 10; private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {}; /** *é»˜è®¤æ„é€ å‡½æ•°ï¼Œä½¿ç”¨åˆå§‹å®¹é‡10æ„é€ ä¸€ä¸ªç©ºåˆ—è¡¨(æ— å‚æ•°æ„é€ ) */ public ArrayList() { this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA; } /** * å¸¦åˆå§‹å®¹é‡å‚æ•°çš„æ„é€ å‡½æ•°ã€‚ï¼ˆç”¨æˆ·è‡ªå·±æŒ‡å®šå®¹é‡ï¼‰ */ public ArrayList(int initialCapacity) { if (initialCapacity \u0026gt; 0) {//åˆå§‹å®¹é‡å¤§äº0 //åˆ›å»ºinitialCapacityå¤§å°çš„æ•°ç»„ this.elementData = new Object[initialCapacity]; } else if (initialCapacity == 0) {//åˆå§‹å®¹é‡ç­‰äº0 //åˆ›å»ºç©ºæ•°ç»„ this.elementData = EMPTY_ELEMENTDATA; } else {//åˆå§‹å®¹é‡å°äº0ï¼ŒæŠ›å‡ºå¼‚å¸¸ throw new IllegalArgumentException(\u0026#34;Illegal Capacity: \u0026#34;+ initialCapacity); } } /** *æ„é€ åŒ…å«æŒ‡å®šcollectionå…ƒç´ çš„åˆ—è¡¨ï¼Œè¿™äº›å…ƒç´ åˆ©ç”¨è¯¥é›†åˆçš„è¿­ä»£å™¨æŒ‰é¡ºåºè¿”å› *å¦‚æœæŒ‡å®šçš„é›†åˆä¸ºnullï¼Œthrows NullPointerExceptionã€‚ */ public ArrayList(Collection\u0026lt;? extends E\u0026gt; c) { elementData = c.toArray(); if ((size = elementData.length) != 0) { // c.toArray might (incorrectly) not return Object[] (see 6260652) if (elementData.getClass() != Object[].class) elementData = Arrays.copyOf(elementData, size, Object[].class); } else { // replace with empty array. this.elementData = EMPTY_ELEMENTDATA; } } ä»¥æ— å‚æ„é€ å‚æ•°å‡½æ•°ä¸ºä¾‹ å…ˆçœ‹ä¸‹é¢çš„ add()æ–¹æ³•æ‰©å®¹\nå¾—åˆ°æœ€å°æ‰©å®¹é‡( å¦‚æœç©ºæ•°ç»„åˆ™ä¸º10ï¼Œå¦åˆ™åŸæ•°ç»„å¤§å°+1 )\u0026mdash;\u0026gt;ç¡®å®šæ˜¯å¦æ‰©å®¹ã€minCapacity \u0026gt; æ­¤æ—¶çš„æ•°ç»„å¤§å°ã€‘\u0026mdash;\u0026gt; çœŸå®è¿›è¡Œæ‰©å®¹ ã€ grow(int minCapacity) ã€‘\næ‰©å®¹çš„å‰ææ˜¯ æ•°ç»„æœ€å°æ‰©å®¹ \u0026gt; æ•°ç»„å®é™…å¤§å°\nå‡ ä¸ªåè¯ï¼šoldCapacityï¼ŒnewCapacity (oldCapacity * 1.5 )ï¼ŒminCapacityï¼ŒMAX_ARRAY_SIZE ,INT_MAX\nå¯¹äºMAX_ARRAY_SIZEçš„è§£é‡Šï¼š\n/** è¦åˆ†é…çš„æ•°ç»„çš„æœ€å¤§å¤§å°ã€‚ ä¸€äº› VM åœ¨æ•°ç»„ä¸­ä¿ç•™ä¸€äº›æ ‡é¢˜å­—ã€‚ å°è¯•åˆ†é…æ›´å¤§çš„æ•°ç»„å¯èƒ½ä¼šå¯¼è‡´ OutOfMemoryErrorï¼šè¯·æ±‚çš„æ•°ç»„å¤§å°è¶…è¿‡ VM é™åˆ¶**/ Integer.MAX_VALUE = Ingeger.MAX_VALUE - 8 ;\ncapacity è‹±[kÉ™ËˆpÃ¦sÉ™ti] è¿™ä¸ªæ–¹æ³•æœ€åæ˜¯è¦ç”¨newCapacityæ‰©å®¹çš„ï¼Œæ‰€ä»¥è¦ç»™ä»–æ›´æ–°å¯ç”¨çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ï¼š\nå¦‚æœæ‰©å®¹åè¿˜æ¯”minCapacity å°ï¼Œé‚£å°±æŠŠnewCapacityæ›´æ–°ä¸ºminCapacityçš„å€¼\nå¦‚æœæ¯”MAX_ARRAY_SIZEè¿˜å¤§ï¼Œé‚£å°±è¶…è¿‡èŒƒå›´äº†\nå¾—é€šè¿‡hugeCapacity(minCapcacity) ï¼Œå³minCapacityå’ŒMAX_ARRAY_SIZEæ¥è®¾ç½®newCapacity\n-\u0026gt; è¿™é‡Œæœ‰ç‚¹ç»•ï¼Œçœ‹äº†ä¹Ÿè®°ä¸ä½\u0026mdash;\u0026ndash;å…¶å®å‰é¢ç¬¬1æ­¥ï¼Œå°±æ˜¯è¯´æˆ‘è‡³å°‘éœ€è¦minCapcacityçš„æ•°ï¼Œä½†æ˜¯å¦‚æœnewCapacity (1.5 * oldCapacity )æ¯”MAX_ARRAY_SIZEï¼šå¦‚æœå®é™…éœ€è¦çš„å®¹é‡ (miniCapacity \u0026gt; MAX_ARRAY_SIZE , é‚£å°±ç›´æ¥å–Integer.MAX_VALUE ï¼›å¦‚æœæ²¡æœ‰ï¼Œé‚£å°±å–MAX_ARRAY_SIZE )\n//addæ–¹æ³•ï¼Œå…ˆæ‰©å®¹ï¼Œå†èµ‹å€¼ï¼ˆå®é™…å…ƒç´ é•¿åº¦æœ€åï¼‰ /** * å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ã€‚ */ public boolean add(E e) { //æ·»åŠ å…ƒç´ ä¹‹å‰ï¼Œå…ˆè°ƒç”¨ensureCapacityInternalæ–¹æ³• ensureCapacityInternal(size + 1); // Increments modCount!! //jdk11 ç§»é™¤äº†è¯¥æ–¹æ³•ï¼Œç¬¬ä¸€æ¬¡è¿›å…¥æ—¶sizeä¸º0 //è¿™é‡Œçœ‹åˆ°ArrayListæ·»åŠ å…ƒç´ çš„å®è´¨å°±ç›¸å½“äºä¸ºæ•°ç»„èµ‹å€¼ elementData[size++] = e; return true; } //ensureCapacityInternal,ifè¯­å¥è¯´æ˜ç¬¬ä¸€æ¬¡addæ—¶ï¼Œå–å½“å‰å®¹é‡å’Œé»˜è®¤å®¹é‡çš„æœ€å¤§å€¼ä½œä¸ºæ‰©å®¹é‡ //**å¾—åˆ°æœ€å°æ‰©å®¹é‡** private void ensureCapacityInternal(int minCapacity) { if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) { // è·å–é»˜è®¤çš„å®¹é‡å’Œä¼ å…¥å‚æ•°çš„è¾ƒå¤§å€¼ //å½“ è¦ add(E) è¿›ç¬¬ 1 ä¸ªå…ƒç´ æ—¶ï¼ŒminCapacity ä¸º 1ï¼Œåœ¨ Math.max()æ–¹æ³•æ¯”è¾ƒåï¼ŒminCapacity ä¸º 10ã€‚ //ä¸ºä»€ä¹ˆä¸ç›´æ¥å–DEFAULT_CAPACITY,å› ä¸ºè¿™ä¸ªæ–¹æ³•ä¸åªæ˜¯add(E )ä¼šç”¨åˆ°ï¼Œ //å…¶æ¬¡addAll(Collection\u0026lt;? extends E\u0026gt; c)ä¹Ÿç”¨åˆ°äº† minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity); } ensureExplicitCapacity(minCapacity); } //ensureExplicitCapacity åˆ¤æ–­æ˜¯å¦æ‰©å®¹ //åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ private void ensureExplicitCapacity(int minCapacity) { modCount++; // overflow-conscious code if (minCapacity - elementData.length \u0026gt; 0) //è°ƒç”¨growæ–¹æ³•è¿›è¡Œæ‰©å®¹ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ä»£è¡¨å·²ç»å¼€å§‹æ‰©å®¹äº† grow(minCapacity); } /* ifè¯­å¥è¡¨ç¤ºï¼Œå½“minCapacityï¼ˆæ•°ç»„å®é™…*éœ€è¦*å®¹é‡çš„å¤§å°ï¼‰å¤§äºå®é™…å®¹é‡åˆ™è¿›è¡Œæ‰©å®¹ æ·»åŠ ç¬¬1ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œä¼šè¿›å…¥growæ–¹æ³•ï¼Œç›´åˆ°æ·»åŠ ç¬¬10ä¸ªå…ƒç´  éƒ½ä¸ä¼šå†è¿›å…¥grow()æ–¹æ³• å½“æ·»åŠ ç¬¬11ä¸ªå…ƒç´ æ—¶ï¼ŒminCapacity(11)æ¯”elementData.length(10)å¤§ï¼Œè¿›å…¥æ‰©å®¹ */ // grow()æ–¹æ³• /** * è¦åˆ†é…çš„æœ€å¤§æ•°ç»„å¤§å° */ private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8; /** * ArrayListæ‰©å®¹çš„æ ¸å¿ƒæ–¹æ³•ã€‚ */ private void grow(int minCapacity) { // oldCapacityä¸ºæ—§å®¹é‡ï¼ŒnewCapacityä¸ºæ–°å®¹é‡ int oldCapacity = elementData.length; //å°†oldCapacity å³ç§»ä¸€ä½ï¼Œå…¶æ•ˆæœç›¸å½“äºoldCapacity /2ï¼Œ //æˆ‘ä»¬çŸ¥é“ä½è¿ç®—çš„é€Ÿåº¦è¿œè¿œå¿«äºæ•´é™¤è¿ç®—ï¼Œæ•´å¥è¿ç®—å¼çš„ç»“æœå°±æ˜¯å°†æ–°å®¹é‡æ›´æ–°ä¸ºæ—§å®¹é‡çš„1.5å€ï¼Œ int newCapacity = oldCapacity + (oldCapacity \u0026gt;\u0026gt; 1); //ç„¶åæ£€æŸ¥æ–°å®¹é‡æ˜¯å¦å¤§äºæœ€å°éœ€è¦å®¹é‡ï¼Œè‹¥è¿˜æ˜¯å°äºæœ€å°éœ€è¦å®¹é‡ï¼Œé‚£ä¹ˆå°±æŠŠæœ€å°éœ€è¦å®¹é‡å½“ä½œæ•°ç»„çš„æ–°å®¹é‡[1.5å€æ‰©å®¹åè¿˜å°äºï¼Œè¯´æ˜ä¸€æ¬¡æ·»åŠ çš„å¤§äº1.5å€æ‰©å®¹åçš„å¤§å°] if (newCapacity - minCapacity \u0026lt; 0) newCapacity = minCapacity; // å¦‚æœæ–°å®¹é‡å¤§äº MAX_ARRAY_SIZE,è¿›å…¥(æ‰§è¡Œ) `hugeCapacity()` æ–¹æ³•æ¥æ¯”è¾ƒ minCapacity å’Œ MAX_ARRAY_SIZEï¼Œ //å¦‚æœminCapacityå¤§äºæœ€å¤§å®¹é‡ï¼Œåˆ™æ–°å®¹é‡åˆ™ä¸º`Integer.MAX_VALUE`ï¼Œå¦åˆ™ï¼Œæ–°å®¹é‡å¤§å°åˆ™ä¸º MAX_ARRAY_SIZE å³ä¸º `Integer.MAX_VALUE - 8`ã€‚ if (newCapacity - MAX_ARRAY_SIZE \u0026gt; 0) newCapacity = hugeCapacity(minCapacity); // minCapacity is usually close to size, so this is a win: elementData = Arrays.copyOf(elementData, newCapacity); } /* è¿›å…¥çœŸæ­£çš„æ‰©å®¹ int newCapacity = oldCapacity + (oldCapacity \u0026gt;\u0026gt; 1),æ‰€ä»¥ ArrayList æ¯æ¬¡æ‰©å®¹ä¹‹åå®¹é‡éƒ½ä¼šå˜ä¸ºåŸæ¥çš„ 1.5 å€å·¦å³ï¼ˆoldCapacity ä¸ºå¶æ•°å°±æ˜¯ 1.5 å€ï¼Œå¦åˆ™æ˜¯ 1.5 å€å·¦å³ï¼‰ï¼ å¥‡å¶ä¸åŒï¼Œæ¯”å¦‚ ï¼š10+10/2 = 15, 33+33/2=49ã€‚å¦‚æœæ˜¯å¥‡æ•°çš„è¯ä¼šä¸¢æ‰å°æ•°ï¼›å³ç§»è¿ç®—ä¼šæ¯”æ™®é€šè¿ç®—ç¬¦å¿«å¾ˆå¤š */ æ‰©å±•\njava ä¸­çš„ lengthå±æ€§æ˜¯é’ˆå¯¹æ•°ç»„è¯´çš„,æ¯”å¦‚è¯´ä½ å£°æ˜äº†ä¸€ä¸ªæ•°ç»„,æƒ³çŸ¥é“è¿™ä¸ªæ•°ç»„çš„é•¿åº¦åˆ™ç”¨åˆ°äº† length è¿™ä¸ªå±æ€§. java ä¸­çš„ length() æ–¹æ³•æ˜¯é’ˆå¯¹å­—ç¬¦ä¸²è¯´çš„,å¦‚æœæƒ³çœ‹è¿™ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦åˆ™ç”¨åˆ° length() è¿™ä¸ªæ–¹æ³•. java ä¸­çš„ size() æ–¹æ³•æ˜¯é’ˆå¯¹æ³›å‹é›†åˆè¯´çš„,å¦‚æœæƒ³çœ‹è¿™ä¸ªæ³›å‹æœ‰å¤šå°‘ä¸ªå…ƒç´ ,å°±è°ƒç”¨æ­¤æ–¹æ³•æ¥æŸ¥çœ‹! hugeCapacity å½“æ–°å®¹é‡è¶…è¿‡MAX_ARRAY_SIZEæ—¶ï¼Œif (newCapacity - MAX_ARRAY_SIZE \u0026gt; 0) è¿›å…¥è¯¥æ–¹æ³•\nprivate static int hugeCapacity(int minCapacity) { if (minCapacity \u0026lt; 0) // overflow throw new OutOfMemoryError(); //å¯¹minCapacityå’ŒMAX_ARRAY_SIZEè¿›è¡Œæ¯”è¾ƒ //è‹¥minCapacityå¤§ï¼Œå°†Integer.MAX_VALUEä½œä¸ºæ–°æ•°ç»„çš„å¤§å° //è‹¥MAX_ARRAY_SIZEå¤§ï¼Œå°†MAX_ARRAY_SIZEä½œä¸ºæ–°æ•°ç»„çš„å¤§å° //MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8; return (minCapacity \u0026gt; MAX_ARRAY_SIZE) ? Integer.MAX_VALUE : MAX_ARRAY_SIZE; } System.arraycopy() å’Œ Arrays.copyOf()\n//System.arraycopy() æ˜¯ä¸€ä¸ªnativeæ–¹æ³• // æˆ‘ä»¬å‘ç° arraycopy æ˜¯ä¸€ä¸ª native æ–¹æ³•,æ¥ä¸‹æ¥æˆ‘ä»¬è§£é‡Šä¸€ä¸‹å„ä¸ªå‚æ•°çš„å…·ä½“æ„ä¹‰ /** * å¤åˆ¶æ•°ç»„ * @param src æºæ•°ç»„ * @param srcPos æºæ•°ç»„ä¸­çš„èµ·å§‹ä½ç½® * @param dest ç›®æ ‡æ•°ç»„ * @param destPos ç›®æ ‡æ•°ç»„ä¸­çš„èµ·å§‹ä½ç½® * @param length è¦å¤åˆ¶çš„æ•°ç»„å…ƒç´ çš„æ•°é‡ */ public static native void arraycopy(Object src, int srcPos, Object dest, int destPos, int length); ä¾‹å­ï¼š\npublic class ArraycopyTest { public static void main(String[] args) { // TODO Auto-generated method stub int[] a = new int[10]; a[0] = 0; a[1] = 1; a[2] = 2; a[3] = 3; System.arraycopy(a, 2, a, 3, 3); a[2]=99; for (int i = 0; i \u0026lt; a.length; i++) { System.out.print(a[i] + \u0026#34; \u0026#34;); } } } //ç»“æœ 0 1 99 2 3 0 0 0 0 0 Arrays.copyOf() æ–¹æ³•\npublic static int[] copyOf(int[] original, int newLength) { // ç”³è¯·ä¸€ä¸ªæ–°çš„æ•°ç»„ int[] copy = new int[newLength]; // è°ƒç”¨System.arraycopy,å°†æºæ•°ç»„ä¸­çš„æ•°æ®è¿›è¡Œæ‹·è´,å¹¶è¿”å›æ–°çš„æ•°ç»„ System.arraycopy(original, 0, copy, 0, Math.min(original.length, newLength)); return copy; } //åœºæ™¯ /** ä»¥æ­£ç¡®çš„é¡ºåºè¿”å›ä¸€ä¸ªåŒ…å«æ­¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ï¼ˆä»ç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ªå…ƒç´ ï¼‰; è¿”å›çš„æ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹æ˜¯æŒ‡å®šæ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹ã€‚ */ public Object[] toArray() { //elementDataï¼šè¦å¤åˆ¶çš„æ•°ç»„ï¼›sizeï¼šè¦å¤åˆ¶çš„é•¿åº¦ return Arrays.copyOf(elementData, size); } Arrays.copypf() ï¼š ç”¨æ¥æ‰©å®¹ï¼Œæˆ–è€…ç¼©çŸ­\npublic class ArrayscopyOfTest { public static void main(String[] args) { int[] a = new int[3]; a[0] = 0; a[1] = 1; a[2] = 2; int[] b = Arrays.copyOf(a, 10); System.out.println(\u0026#34;b.length\u0026#34;+b.length); } } //ç»“æœï¼š 10 è”ç³»åŠåŒºåˆ«\nçœ‹ä¸¤è€…æºä»£ç å¯ä»¥å‘ç° copyOf()å†…éƒ¨å®é™…è°ƒç”¨äº† System.arraycopy() æ–¹æ³• arraycopy æ›´èƒ½å®ç°è‡ªå®šä¹‰ ensureCapacity æ–¹æ³• æœ€å¥½åœ¨å‘ ArrayList æ·»åŠ å¤§é‡å…ƒç´ ä¹‹å‰ç”¨ ensureCapacity æ–¹æ³•ï¼Œä»¥å‡å°‘å¢é‡é‡æ–°åˆ†é…çš„æ¬¡æ•° å‘ ArrayList æ·»åŠ å¤§é‡å…ƒç´ ä¹‹å‰ä½¿ç”¨ensureCapacity æ–¹æ³•å¯ä»¥æå‡æ€§èƒ½ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªæ€§èƒ½å·®è·å‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚è€Œä¸”ï¼Œå®é™…é¡¹ç›®æ ¹æœ¬ä¹Ÿä¸å¯èƒ½å¾€ ArrayList é‡Œé¢æ·»åŠ è¿™ä¹ˆå¤šå…ƒç´  2. æ ¸å¿ƒæºç è§£è¯» # package java.util; import java.util.function.Consumer; import java.util.function.Predicate; import java.util.function.UnaryOperator; public class ArrayList\u0026lt;E\u0026gt; extends AbstractList\u0026lt;E\u0026gt; implements List\u0026lt;E\u0026gt;, RandomAccess, Cloneable, java.io.Serializable { private static final long serialVersionUID = 8683452581122892189L; /** * é»˜è®¤åˆå§‹å®¹é‡å¤§å° */ private static final int DEFAULT_CAPACITY = 10; /** * ç©ºæ•°ç»„ï¼ˆç”¨äºç©ºå®ä¾‹ï¼‰ã€‚ */ private static final Object[] EMPTY_ELEMENTDATA = {}; //ç”¨äºé»˜è®¤å¤§å°ç©ºå®ä¾‹çš„å…±äº«ç©ºæ•°ç»„å®ä¾‹ã€‚ //æˆ‘ä»¬æŠŠå®ƒä»EMPTY_ELEMENTDATAæ•°ç»„ä¸­åŒºåˆ†å‡ºæ¥ï¼Œä»¥çŸ¥é“åœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶å®¹é‡éœ€è¦å¢åŠ å¤šå°‘ã€‚ private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {}; /** * ä¿å­˜ArrayListæ•°æ®çš„æ•°ç»„ */ transient Object[] elementData; // non-private to simplify nested class access /** * ArrayList æ‰€åŒ…å«çš„å…ƒç´ ä¸ªæ•° */ private int size; /** * å¸¦åˆå§‹å®¹é‡å‚æ•°çš„æ„é€ å‡½æ•°ï¼ˆç”¨æˆ·å¯ä»¥åœ¨åˆ›å»ºArrayListå¯¹è±¡æ—¶è‡ªå·±æŒ‡å®šé›†åˆçš„åˆå§‹å¤§å°ï¼‰ */ public ArrayList(int initialCapacity) { if (initialCapacity \u0026gt; 0) { //å¦‚æœä¼ å…¥çš„å‚æ•°å¤§äº0ï¼Œåˆ›å»ºinitialCapacityå¤§å°çš„æ•°ç»„ this.elementData = new Object[initialCapacity]; } else if (initialCapacity == 0) { //å¦‚æœä¼ å…¥çš„å‚æ•°ç­‰äº0ï¼Œåˆ›å»ºç©ºæ•°ç»„ this.elementData = EMPTY_ELEMENTDATA; } else { //å…¶ä»–æƒ…å†µï¼ŒæŠ›å‡ºå¼‚å¸¸ throw new IllegalArgumentException(\u0026#34;Illegal Capacity: \u0026#34;+ initialCapacity); } } /** *é»˜è®¤æ— å‚æ„é€ å‡½æ•° *DEFAULTCAPACITY_EMPTY_ELEMENTDATA ä¸º0.åˆå§‹åŒ–ä¸º10ï¼Œä¹Ÿå°±æ˜¯è¯´åˆå§‹å…¶å®æ˜¯ç©ºæ•°ç»„ å½“æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™æ•°ç»„å®¹é‡æ‰å˜æˆ10 */ public ArrayList() { this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA; } /** * æ„é€ ä¸€ä¸ªåŒ…å«æŒ‡å®šé›†åˆçš„å…ƒç´ çš„åˆ—è¡¨ï¼ŒæŒ‰ç…§å®ƒä»¬ç”±é›†åˆçš„è¿­ä»£å™¨è¿”å›çš„é¡ºåºã€‚ */ public ArrayList(Collection\u0026lt;? extends E\u0026gt; c) { //å°†æŒ‡å®šé›†åˆè½¬æ¢ä¸ºæ•°ç»„ elementData = c.toArray(); //å¦‚æœelementDataæ•°ç»„çš„é•¿åº¦ä¸ä¸º0 if ((size = elementData.length) != 0) { // å¦‚æœelementDataä¸æ˜¯Objectç±»å‹æ•°æ®ï¼ˆc.toArrayå¯èƒ½è¿”å›çš„ä¸æ˜¯Objectç±»å‹çš„æ•°ç»„æ‰€ä»¥åŠ ä¸Šä¸‹é¢çš„è¯­å¥ç”¨äºåˆ¤æ–­ï¼‰ if (elementData.getClass() != Object[].class) //å°†åŸæ¥ä¸æ˜¯Objectç±»å‹çš„elementDataæ•°ç»„çš„å†…å®¹ï¼Œèµ‹å€¼ç»™æ–°çš„Objectç±»å‹çš„elementDataæ•°ç»„ elementData = Arrays.copyOf(elementData, size, Object[].class); } else { // å…¶ä»–æƒ…å†µï¼Œç”¨ç©ºæ•°ç»„ä»£æ›¿ this.elementData = EMPTY_ELEMENTDATA; } } /** * ä¿®æ”¹è¿™ä¸ªArrayListå®ä¾‹çš„å®¹é‡æ˜¯åˆ—è¡¨çš„å½“å‰å¤§å°ã€‚ åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨æ­¤æ“ä½œæ¥æœ€å°åŒ–ArrayListå®ä¾‹çš„å­˜å‚¨ã€‚ */ public void trimToSize() { modCount++; if (size \u0026lt; elementData.length) { elementData = (size == 0) ? EMPTY_ELEMENTDATA : Arrays.copyOf(elementData, size); } } //ä¸‹é¢æ˜¯ArrayListçš„æ‰©å®¹æœºåˆ¶ //ArrayListçš„æ‰©å®¹æœºåˆ¶æé«˜äº†æ€§èƒ½ï¼Œå¦‚æœæ¯æ¬¡åªæ‰©å……ä¸€ä¸ªï¼Œ //é‚£ä¹ˆé¢‘ç¹çš„æ’å…¥ä¼šå¯¼è‡´é¢‘ç¹çš„æ‹·è´ï¼Œé™ä½æ€§èƒ½ï¼Œè€ŒArrayListçš„æ‰©å®¹æœºåˆ¶é¿å…äº†è¿™ç§æƒ…å†µã€‚ /** * å¦‚æœ‰å¿…è¦ï¼Œå¢åŠ æ­¤ArrayListå®ä¾‹çš„å®¹é‡ï¼Œä»¥ç¡®ä¿å®ƒè‡³å°‘èƒ½å®¹çº³å…ƒç´ çš„æ•°é‡ * @param minCapacity æ‰€éœ€çš„æœ€å°å®¹é‡ */ public void ensureCapacity(int minCapacity) { //å¦‚æœæ˜¯trueï¼ŒminExpandçš„å€¼ä¸º0ï¼Œå¦‚æœæ˜¯false,minExpandçš„å€¼ä¸º10 int minExpand = (elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA) // any size if not default element table ? 0 // larger than default for default empty table. It\u0026#39;s already // supposed to be at default size. : DEFAULT_CAPACITY; //å¦‚æœæœ€å°å®¹é‡å¤§äºå·²æœ‰çš„æœ€å¤§å®¹é‡ if (minCapacity \u0026gt; minExpand) { ensureExplicitCapacity(minCapacity); } } //1.å¾—åˆ°æœ€å°æ‰©å®¹é‡ //2.é€šè¿‡æœ€å°å®¹é‡æ‰©å®¹ private void ensureCapacityInternal(int minCapacity) { if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) { // è·å–â€œé»˜è®¤çš„å®¹é‡â€å’Œâ€œä¼ å…¥å‚æ•°â€ä¸¤è€…ä¹‹é—´çš„æœ€å¤§å€¼ minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity); } ensureExplicitCapacity(minCapacity); } //åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ private void ensureExplicitCapacity(int minCapacity) { modCount++; // overflow-conscious code if (minCapacity - elementData.length \u0026gt; 0) //è°ƒç”¨growæ–¹æ³•è¿›è¡Œæ‰©å®¹ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ä»£è¡¨å·²ç»å¼€å§‹æ‰©å®¹äº† grow(minCapacity); } /** * è¦åˆ†é…çš„æœ€å¤§æ•°ç»„å¤§å° */ private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8; /** * ArrayListæ‰©å®¹çš„æ ¸å¿ƒæ–¹æ³•ã€‚ */ private void grow(int minCapacity) { // oldCapacityä¸ºæ—§å®¹é‡ï¼ŒnewCapacityä¸ºæ–°å®¹é‡ int oldCapacity = elementData.length; //å°†oldCapacity å³ç§»ä¸€ä½ï¼Œå…¶æ•ˆæœç›¸å½“äºoldCapacity /2ï¼Œ //æˆ‘ä»¬çŸ¥é“ä½è¿ç®—çš„é€Ÿåº¦è¿œè¿œå¿«äºæ•´é™¤è¿ç®—ï¼Œæ•´å¥è¿ç®—å¼çš„ç»“æœå°±æ˜¯å°†æ–°å®¹é‡æ›´æ–°ä¸ºæ—§å®¹é‡çš„1.5å€ï¼Œ int newCapacity = oldCapacity + (oldCapacity \u0026gt;\u0026gt; 1); //ç„¶åæ£€æŸ¥æ–°å®¹é‡æ˜¯å¦å¤§äºæœ€å°éœ€è¦å®¹é‡ï¼Œè‹¥è¿˜æ˜¯å°äºæœ€å°éœ€è¦å®¹é‡ï¼Œé‚£ä¹ˆå°±æŠŠæœ€å°éœ€è¦å®¹é‡å½“ä½œæ•°ç»„çš„æ–°å®¹é‡ï¼Œ if (newCapacity - minCapacity \u0026lt; 0) newCapacity = minCapacity; //å†æ£€æŸ¥æ–°å®¹é‡æ˜¯å¦è¶…å‡ºäº†ArrayListæ‰€å®šä¹‰çš„æœ€å¤§å®¹é‡ï¼Œ //è‹¥è¶…å‡ºäº†ï¼Œåˆ™è°ƒç”¨hugeCapacity()æ¥æ¯”è¾ƒminCapacityå’Œ MAX_ARRAY_SIZEï¼Œ //å¦‚æœminCapacityå¤§äºMAX_ARRAY_SIZEï¼Œåˆ™æ–°å®¹é‡åˆ™ä¸ºInterger.MAX_VALUEï¼Œå¦åˆ™ï¼Œæ–°å®¹é‡å¤§å°åˆ™ä¸º MAX_ARRAY_SIZEã€‚ if (newCapacity - MAX_ARRAY_SIZE \u0026gt; 0) newCapacity = hugeCapacity(minCapacity); // minCapacity is usually close to size, so this is a win: elementData = Arrays.copyOf(elementData, newCapacity); } //æ¯”è¾ƒminCapacityå’Œ MAX_ARRAY_SIZE private static int hugeCapacity(int minCapacity) { if (minCapacity \u0026lt; 0) // overflow throw new OutOfMemoryError(); return (minCapacity \u0026gt; MAX_ARRAY_SIZE) ? Integer.MAX_VALUE : MAX_ARRAY_SIZE; } /** *è¿”å›æ­¤åˆ—è¡¨ä¸­çš„å…ƒç´ æ•°ã€‚ */ public int size() { return size; } /** * å¦‚æœæ­¤åˆ—è¡¨ä¸åŒ…å«å…ƒç´ ï¼Œåˆ™è¿”å› true ã€‚ */ public boolean isEmpty() { //æ³¨æ„=å’Œ==çš„åŒºåˆ« return size == 0; } /** * å¦‚æœæ­¤åˆ—è¡¨åŒ…å«æŒ‡å®šçš„å…ƒç´ ï¼Œåˆ™è¿”å›true ã€‚ */ public boolean contains(Object o) { //indexOf()æ–¹æ³•ï¼šè¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šå…ƒç´ çš„é¦–æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸åŒ…å«æ­¤å…ƒç´ ï¼Œåˆ™ä¸º-1 return indexOf(o) \u0026gt;= 0; } /** *è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šå…ƒç´ çš„é¦–æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸åŒ…å«æ­¤å…ƒç´ ï¼Œåˆ™ä¸º-1 */ public int indexOf(Object o) { if (o == null) { for (int i = 0; i \u0026lt; size; i++) if (elementData[i]==null) return i; } else { for (int i = 0; i \u0026lt; size; i++) //equals()æ–¹æ³•æ¯”è¾ƒ if (o.equals(elementData[i])) return i; } return -1; } /** * è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šå…ƒç´ çš„æœ€åä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸åŒ…å«å…ƒç´ ï¼Œåˆ™è¿”å›-1ã€‚. */ public int lastIndexOf(Object o) { if (o == null) { for (int i = size-1; i \u0026gt;= 0; i--) if (elementData[i]==null) return i; } else { for (int i = size-1; i \u0026gt;= 0; i--) if (o.equals(elementData[i])) return i; } return -1; } /** * è¿”å›æ­¤ArrayListå®ä¾‹çš„æµ…æ‹·è´ã€‚ ï¼ˆå…ƒç´ æœ¬èº«ä¸è¢«å¤åˆ¶ã€‚ï¼‰ */ public Object clone() { try { ArrayList\u0026lt;?\u0026gt; v = (ArrayList\u0026lt;?\u0026gt;) super.clone(); //Arrays.copyOfåŠŸèƒ½æ˜¯å®ç°æ•°ç»„çš„å¤åˆ¶ï¼Œè¿”å›å¤åˆ¶åçš„æ•°ç»„ã€‚å‚æ•°æ˜¯è¢«å¤åˆ¶çš„æ•°ç»„å’Œå¤åˆ¶çš„é•¿åº¦ v.elementData = Arrays.copyOf(elementData, size); v.modCount = 0; return v; } catch (CloneNotSupportedException e) { // è¿™ä¸åº”è¯¥å‘ç”Ÿï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯å¯ä»¥å…‹éš†çš„ throw new InternalError(e); } } /** *ä»¥æ­£ç¡®çš„é¡ºåºï¼ˆä»ç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ªå…ƒç´ ï¼‰è¿”å›ä¸€ä¸ªåŒ…å«æ­¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ã€‚ *è¿”å›çš„æ•°ç»„å°†æ˜¯â€œå®‰å…¨çš„â€ï¼Œå› ä¸ºè¯¥åˆ—è¡¨ä¸ä¿ç•™å¯¹å®ƒçš„å¼•ç”¨ã€‚ ï¼ˆæ¢å¥è¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•å¿…é¡»åˆ†é…ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼‰ã€‚ *å› æ­¤ï¼Œè°ƒç”¨è€…å¯ä»¥è‡ªç”±åœ°ä¿®æ”¹è¿”å›çš„æ•°ç»„ã€‚ æ­¤æ–¹æ³•å……å½“åŸºäºé˜µåˆ—å’ŒåŸºäºé›†åˆçš„APIä¹‹é—´çš„æ¡¥æ¢ã€‚ */ public Object[] toArray() { return Arrays.copyOf(elementData, size); } /** * ä»¥æ­£ç¡®çš„é¡ºåºè¿”å›ä¸€ä¸ªåŒ…å«æ­¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ï¼ˆä»ç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ªå…ƒç´ ï¼‰; *è¿”å›çš„æ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹æ˜¯æŒ‡å®šæ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹ã€‚ å¦‚æœåˆ—è¡¨é€‚åˆæŒ‡å®šçš„æ•°ç»„ï¼Œåˆ™è¿”å›å…¶ä¸­ã€‚ *å¦åˆ™ï¼Œå°†ä¸ºæŒ‡å®šæ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹å’Œæ­¤åˆ—è¡¨çš„å¤§å°åˆ†é…ä¸€ä¸ªæ–°æ•°ç»„ã€‚ *å¦‚æœåˆ—è¡¨é€‚ç”¨äºæŒ‡å®šçš„æ•°ç»„ï¼Œå…¶ä½™ç©ºé—´ï¼ˆå³æ•°ç»„çš„åˆ—è¡¨æ•°é‡å¤šäºæ­¤å…ƒç´ ï¼‰ï¼Œåˆ™ç´§è·Ÿåœ¨é›†åˆç»“æŸåçš„æ•°ç»„ä¸­çš„å…ƒç´ è®¾ç½®ä¸ºnull ã€‚ *ï¼ˆè¿™ä»…åœ¨è°ƒç”¨è€…çŸ¥é“åˆ—è¡¨ä¸åŒ…å«ä»»ä½•ç©ºå…ƒç´ çš„æƒ…å†µä¸‹æ‰èƒ½ç¡®å®šåˆ—è¡¨çš„é•¿åº¦ã€‚ï¼‰ */ @SuppressWarnings(\u0026#34;unchecked\u0026#34;) public \u0026lt;T\u0026gt; T[] toArray(T[] a) { if (a.length \u0026lt; size) // æ–°å»ºä¸€ä¸ªè¿è¡Œæ—¶ç±»å‹çš„æ•°ç»„ï¼Œä½†æ˜¯ArrayListæ•°ç»„çš„å†…å®¹ return (T[]) Arrays.copyOf(elementData, size, a.getClass()); //è°ƒç”¨Systemæä¾›çš„arraycopy()æ–¹æ³•å®ç°æ•°ç»„ä¹‹é—´çš„å¤åˆ¶ System.arraycopy(elementData, 0, a, 0, size); if (a.length \u0026gt; size) a[size] = null; return a; } // Positional Access Operations @SuppressWarnings(\u0026#34;unchecked\u0026#34;) E elementData(int index) { return (E) elementData[index]; } /** * è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚ */ public E get(int index) { rangeCheck(index); return elementData(index); } /** * ç”¨æŒ‡å®šçš„å…ƒç´ æ›¿æ¢æ­¤åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚ */ public E set(int index, E element) { //å¯¹indexè¿›è¡Œç•Œé™æ£€æŸ¥ rangeCheck(index); E oldValue = elementData(index); elementData[index] = element; //è¿”å›åŸæ¥åœ¨è¿™ä¸ªä½ç½®çš„å…ƒç´  return oldValue; } /** * å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ã€‚ */ public boolean add(E e) { ensureCapacityInternal(size + 1); // Increments modCount!! //è¿™é‡Œçœ‹åˆ°ArrayListæ·»åŠ å…ƒç´ çš„å®è´¨å°±ç›¸å½“äºä¸ºæ•°ç»„èµ‹å€¼ elementData[size++] = e; return true; } /** * åœ¨æ­¤åˆ—è¡¨ä¸­çš„æŒ‡å®šä½ç½®æ’å…¥æŒ‡å®šçš„å…ƒç´ ã€‚ *å…ˆè°ƒç”¨ rangeCheckForAdd å¯¹indexè¿›è¡Œç•Œé™æ£€æŸ¥ï¼›ç„¶åè°ƒç”¨ ensureCapacityInternal æ–¹æ³•ä¿è¯capacityè¶³å¤Ÿå¤§ï¼› *å†å°†ä»indexå¼€å§‹ä¹‹åçš„æ‰€æœ‰æˆå‘˜åç§»ä¸€ä¸ªä½ç½®ï¼›å°†elementæ’å…¥indexä½ç½®ï¼›æœ€åsizeåŠ 1ã€‚ */ public void add(int index, E element) { rangeCheckForAdd(index); ensureCapacityInternal(size + 1); // Increments modCount!! //arraycopy()è¿™ä¸ªå®ç°æ•°ç»„ä¹‹é—´å¤åˆ¶çš„æ–¹æ³•ä¸€å®šè¦çœ‹ä¸€ä¸‹ï¼Œä¸‹é¢å°±ç”¨åˆ°äº†arraycopy()æ–¹æ³•å®ç°æ•°ç»„è‡ªå·±å¤åˆ¶è‡ªå·± System.arraycopy(elementData, index, elementData, index + 1, size - index); elementData[index] = element; size++; } /** * åˆ é™¤è¯¥åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚ å°†ä»»ä½•åç»­å…ƒç´ ç§»åŠ¨åˆ°å·¦ä¾§ï¼ˆä»å…¶ç´¢å¼•ä¸­å‡å»ä¸€ä¸ªå…ƒç´ ï¼‰ã€‚ */ public E remove(int index) { rangeCheck(index); modCount++; E oldValue = elementData(index); int numMoved = size - index - 1; if (numMoved \u0026gt; 0) System.arraycopy(elementData, index+1, elementData, index, numMoved); elementData[--size] = null; // clear to let GC do its work //ä»åˆ—è¡¨ä¸­åˆ é™¤çš„å…ƒç´  return oldValue; } /** * ä»åˆ—è¡¨ä¸­åˆ é™¤æŒ‡å®šå…ƒç´ çš„ç¬¬ä¸€ä¸ªå‡ºç°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚ å¦‚æœåˆ—è¡¨ä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™å®ƒä¸ä¼šæ›´æ”¹ã€‚ *è¿”å›trueï¼Œå¦‚æœæ­¤åˆ—è¡¨åŒ…å«æŒ‡å®šçš„å…ƒç´  */ public boolean remove(Object o) { if (o == null) { for (int index = 0; index \u0026lt; size; index++) if (elementData[index] == null) { fastRemove(index); return true; } } else { for (int index = 0; index \u0026lt; size; index++) if (o.equals(elementData[index])) { fastRemove(index); return true; } } return false; } /* * Private remove method that skips bounds checking and does not * return the value removed. */ private void fastRemove(int index) { modCount++; int numMoved = size - index - 1; if (numMoved \u0026gt; 0) System.arraycopy(elementData, index+1, elementData, index, numMoved); elementData[--size] = null; // clear to let GC do its work } /** * ä»åˆ—è¡¨ä¸­åˆ é™¤æ‰€æœ‰å…ƒç´ ã€‚ */ public void clear() { modCount++; // æŠŠæ•°ç»„ä¸­æ‰€æœ‰çš„å…ƒç´ çš„å€¼è®¾ä¸ºnull for (int i = 0; i \u0026lt; size; i++) elementData[i] = null; size = 0; } /** * æŒ‰æŒ‡å®šé›†åˆçš„Iteratorè¿”å›çš„é¡ºåºå°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ã€‚ */ public boolean addAll(Collection\u0026lt;? extends E\u0026gt; c) { Object[] a = c.toArray(); int numNew = a.length; ensureCapacityInternal(size + numNew); // Increments modCount System.arraycopy(a, 0, elementData, size, numNew); size += numNew; return numNew != 0; } /** * å°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ æ’å…¥åˆ°æ­¤åˆ—è¡¨ä¸­ï¼Œä»æŒ‡å®šçš„ä½ç½®å¼€å§‹ã€‚ */ public boolean addAll(int index, Collection\u0026lt;? extends E\u0026gt; c) { rangeCheckForAdd(index); Object[] a = c.toArray(); int numNew = a.length; ensureCapacityInternal(size + numNew); // Increments modCount int numMoved = size - index; if (numMoved \u0026gt; 0) System.arraycopy(elementData, index, elementData, index + numNew, numMoved); System.arraycopy(a, 0, elementData, index, numNew); size += numNew; return numNew != 0; } /** * ä»æ­¤åˆ—è¡¨ä¸­åˆ é™¤æ‰€æœ‰ç´¢å¼•ä¸ºfromIndex ï¼ˆå«ï¼‰å’ŒtoIndexä¹‹é—´çš„å…ƒç´ ã€‚ *å°†ä»»ä½•åç»­å…ƒç´ ç§»åŠ¨åˆ°å·¦ä¾§ï¼ˆå‡å°‘å…¶ç´¢å¼•ï¼‰ã€‚ */ protected void removeRange(int fromIndex, int toIndex) { modCount++; int numMoved = size - toIndex; System.arraycopy(elementData, toIndex, elementData, fromIndex, numMoved); // clear to let GC do its work int newSize = size - (toIndex-fromIndex); for (int i = newSize; i \u0026lt; size; i++) { elementData[i] = null; } size = newSize; } /** * æ£€æŸ¥ç»™å®šçš„ç´¢å¼•æ˜¯å¦åœ¨èŒƒå›´å†…ã€‚ */ private void rangeCheck(int index) { if (index \u0026gt;= size) throw new IndexOutOfBoundsException(outOfBoundsMsg(index)); } /** * addå’ŒaddAllä½¿ç”¨çš„rangeCheckçš„ä¸€ä¸ªç‰ˆæœ¬ */ private void rangeCheckForAdd(int index) { if (index \u0026gt; size || index \u0026lt; 0) throw new IndexOutOfBoundsException(outOfBoundsMsg(index)); } /** * è¿”å›IndexOutOfBoundsExceptionç»†èŠ‚ä¿¡æ¯ */ private String outOfBoundsMsg(int index) { return \u0026#34;Index: \u0026#34;+index+\u0026#34;, Size: \u0026#34;+size; } /** * ä»æ­¤åˆ—è¡¨ä¸­åˆ é™¤æŒ‡å®šé›†åˆä¸­åŒ…å«çš„æ‰€æœ‰å…ƒç´ ã€‚ */ public boolean removeAll(Collection\u0026lt;?\u0026gt; c) { Objects.requireNonNull(c); //å¦‚æœæ­¤åˆ—è¡¨è¢«ä¿®æ”¹åˆ™è¿”å›true return batchRemove(c, false); } /** * ä»…ä¿ç•™æ­¤åˆ—è¡¨ä¸­åŒ…å«åœ¨æŒ‡å®šé›†åˆä¸­çš„å…ƒç´ ã€‚ *æ¢å¥è¯è¯´ï¼Œä»æ­¤åˆ—è¡¨ä¸­åˆ é™¤å…¶ä¸­ä¸åŒ…å«åœ¨æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ */ public boolean retainAll(Collection\u0026lt;?\u0026gt; c) { Objects.requireNonNull(c); return batchRemove(c, true); } /** * ä»åˆ—è¡¨ä¸­çš„æŒ‡å®šä½ç½®å¼€å§‹ï¼Œè¿”å›åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼ˆæŒ‰æ­£ç¡®é¡ºåºï¼‰çš„åˆ—è¡¨è¿­ä»£å™¨ã€‚ *æŒ‡å®šçš„ç´¢å¼•è¡¨ç¤ºåˆå§‹è°ƒç”¨å°†è¿”å›çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºnext ã€‚ åˆå§‹è°ƒç”¨previouså°†è¿”å›æŒ‡å®šç´¢å¼•å‡1çš„å…ƒç´ ã€‚ *è¿”å›çš„åˆ—è¡¨è¿­ä»£å™¨æ˜¯fail-fast ã€‚ */ public ListIterator\u0026lt;E\u0026gt; listIterator(int index) { if (index \u0026lt; 0 || index \u0026gt; size) throw new IndexOutOfBoundsException(\u0026#34;Index: \u0026#34;+index); return new ListItr(index); } /** *è¿”å›åˆ—è¡¨ä¸­çš„åˆ—è¡¨è¿­ä»£å™¨ï¼ˆæŒ‰é€‚å½“çš„é¡ºåºï¼‰ã€‚ *è¿”å›çš„åˆ—è¡¨è¿­ä»£å™¨æ˜¯fail-fast ã€‚ */ public ListIterator\u0026lt;E\u0026gt; listIterator() { return new ListItr(0); } /** *ä»¥æ­£ç¡®çš„é¡ºåºè¿”å›è¯¥åˆ—è¡¨ä¸­çš„å…ƒç´ çš„è¿­ä»£å™¨ã€‚ *è¿”å›çš„è¿­ä»£å™¨æ˜¯fail-fast ã€‚ */ public Iterator\u0026lt;E\u0026gt; iterator() { return new Itr(); } "},{"id":150,"href":"/zh/docs/study/Review/java_guide/java/Collection/ly0103lycollections-precautions-for-use/","title":"é›†åˆä½¿ç”¨æ³¨æ„äº‹é¡¹","section":"é›†åˆ","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\né›†åˆåˆ¤ç©º # //é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œ\nåˆ¤æ–­æ‰€æœ‰é›†åˆå†…éƒ¨çš„å…ƒç´ æ˜¯å¦ä¸ºç©ºï¼Œä½¿ç”¨ isEmpty() æ–¹æ³•ï¼Œè€Œä¸æ˜¯ size()==0 çš„æ–¹å¼ã€‚\nisEmpty()å¯è¯»æ€§æ›´å¥½ï¼Œä¸”ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦ä¸ºO(1)\næœ‰ä¾‹å¤–ï¼šConcurrentHashMapçš„size()å’ŒisEmpty() æ—¶é—´å¤æ‚åº¦å‡ä¸æ˜¯O(1)\npublic int size() { long n = sumCount(); return ((n \u0026lt; 0L) ? 0 : (n \u0026gt; (long)Integer.MAX_VALUE) ? Integer.MAX_VALUE : (int)n); } final long sumCount() { CounterCell[] as = counterCells; CounterCell a; long sum = baseCount; if (as != null) { for (int i = 0; i \u0026lt; as.length; ++i) { if ((a = as[i]) != null) sum += a.value; } } return sum; } public boolean isEmpty() { return sumCount() \u0026lt;= 0L; // ignore transient negative values } é›†åˆè½¬Map # //é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œ\nåœ¨ä½¿ç”¨ java.util.stream.Collectors ç±»çš„ toMap() æ–¹æ³•è½¬ä¸º Map é›†åˆæ—¶ï¼Œä¸€å®šè¦æ³¨æ„å½“ value ä¸º null æ—¶ä¼šæŠ› NPE å¼‚å¸¸ã€‚\nclass Person { private String name; private String phoneNumber; // getters and setters } List\u0026lt;Person\u0026gt; bookList = new ArrayList\u0026lt;\u0026gt;(); bookList.add(new Person(\u0026#34;jack\u0026#34;,\u0026#34;18163138123\u0026#34;)); bookList.add(new Person(\u0026#34;martin\u0026#34;,null)); // ç©ºæŒ‡é’ˆå¼‚å¸¸ bookList.stream().collect(Collectors.toMap(Person::getName, Person::getPhoneNumber)); java.util.stream.Collectionsç±»çš„toMap() ï¼Œé‡Œé¢ä½¿ç”¨åˆ°äº†Mapæ¥å£çš„merge()æ–¹æ³•, è°ƒç”¨äº†Objects.requireNonNull()æ–¹æ³•åˆ¤æ–­valueæ˜¯å¦ä¸ºç©º\né›†åˆéå† # //é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œ\nä¸è¦åœ¨ foreach å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„ remove/add æ“ä½œã€‚remove å…ƒç´ è¯·ä½¿ç”¨ Iterator æ–¹å¼ï¼Œå¦‚æœå¹¶å‘æ“ä½œï¼Œéœ€è¦å¯¹ Iterator å¯¹è±¡åŠ é”ã€‚\nforeachè¯­æ³•åº•å±‚ä¾èµ–äºIterator ï¼ˆforeachæ˜¯è¯­æ³•ç³–ï¼‰ï¼Œä¸è¿‡remove/add åˆ™æ˜¯ç›´æ¥è°ƒç”¨é›†åˆçš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯Iteratorçš„ï¼› æ‰€ä»¥æ­¤æ—¶Iteratorè«åå‘ç°è‡ªå·±å…ƒç´ è¢«remove/addï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªConcurrentModificationExceptionæ¥æç¤ºç”¨æˆ·å‘ç”Ÿäº†å¹¶å‘ä¿®æ”¹å¼‚å¸¸ï¼Œå³å•çº¿ç¨‹çŠ¶æ€ä¸‹äº§ç”Ÿçš„fail-fastæœºåˆ¶\njava8å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨Collection#**removeIf()**æ–¹æ³•åˆ é™¤æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„å…ƒç´ ï¼Œä¾‹å­\nList\u0026lt;Integer\u0026gt; list = new ArrayList\u0026lt;\u0026gt;(); for (int i = 1; i \u0026lt;= 10; ++i) { list.add(i); } list.removeIf(filter -\u0026gt; filter % 2 == 0); /* åˆ é™¤listä¸­çš„æ‰€æœ‰å¶æ•° */ System.out.println(list); /* [1, 3, 5, 7, 9] */ å…¶ä»–çš„éå†æ•°ç»„çš„æ–¹æ³•ï¼ˆæ³¨æ„æ˜¯éå†ï¼Œä¸æ˜¯å¢åŠ /åˆ é™¤ï¼‰\nä½¿ç”¨æ™®é€šforå¾ªç¯\nä½¿ç”¨fail-safeé›†åˆç±»ï¼Œjava.utilåŒ…ä¸‹é¢çš„æ‰€æœ‰é›†åˆç±»éƒ½æ˜¯fail-fastï¼Œè€Œjava.util.concurrentåŒ…ä¸‹é¢çš„æ‰€æœ‰ç±»æ˜¯fail-safe\n//ConcurrentHashMapæºç  package java.util.concurrent; public class ConcurrentHashMap\u0026lt;K,V\u0026gt; extends AbstractMap\u0026lt;K,V\u0026gt; implements ConcurrentMap\u0026lt;K,V\u0026gt;, Serializable {} //Listç±»æºç  package java.util; public class HashMap\u0026lt;K,V\u0026gt; extends AbstractMap\u0026lt;K,V\u0026gt; implements Map\u0026lt;K,V\u0026gt;, Cloneable, Serializable { } é›†åˆå»é‡ # //é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œ\nå¯ä»¥åˆ©ç”¨ Set å…ƒç´ å”¯ä¸€çš„ç‰¹æ€§ï¼Œå¯ä»¥å¿«é€Ÿå¯¹ä¸€ä¸ªé›†åˆè¿›è¡Œå»é‡æ“ä½œï¼Œé¿å…ä½¿ç”¨ List çš„ contains() è¿›è¡Œéå†å»é‡æˆ–è€…åˆ¤æ–­åŒ…å«æ“ä½œã€‚\n// Set å»é‡ä»£ç ç¤ºä¾‹ public static \u0026lt;T\u0026gt; Set\u0026lt;T\u0026gt; removeDuplicateBySet(List\u0026lt;T\u0026gt; data) { if (CollectionUtils.isEmpty(data)) { return new HashSet\u0026lt;\u0026gt;(); } return new HashSet\u0026lt;\u0026gt;(data); } // List å»é‡ä»£ç ç¤ºä¾‹ public static \u0026lt;T\u0026gt; List\u0026lt;T\u0026gt; removeDuplicateByList(List\u0026lt;T\u0026gt; data) { if (CollectionUtils.isEmpty(data)) { return new ArrayList\u0026lt;\u0026gt;(); } List\u0026lt;T\u0026gt; result = new ArrayList\u0026lt;\u0026gt;(data.size()); for (T current : data) { if (!result.contains(current)) { result.add(current); } } return result; } Setæ—¶é—´å¤æ‚åº¦ä¸º 1 * n ï¼Œè€ŒListæ—¶é—´å¤æ‚åº¦ä¸º n * n\n//Setçš„Containsï¼Œåº•å±‚ä¾èµ–äºHashMap,æ—¶é—´å¤æ‚åº¦ä¸º 1 private transient HashMap\u0026lt;E,Object\u0026gt; map; public boolean contains(Object o) { return map.containsKey(o); } //ArrayListçš„Containsï¼Œåº•å±‚åˆ™æ˜¯éå†,æ—¶é—´å¤æ‚åº¦ä¸ºO(n) public boolean contains(Object o) { return indexOf(o) \u0026gt;= 0; } public int indexOf(Object o) { if (o == null) { for (int i = 0; i \u0026lt; size; i++) if (elementData[i]==null) return i; } else { for (int i = 0; i \u0026lt; size; i++) if (o.equals(elementData[i])) return i; } return -1; } é›†åˆè½¬æ•°ç»„ # //é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œ\nä½¿ç”¨é›†åˆè½¬æ•°ç»„çš„æ–¹æ³•ï¼Œå¿…é¡»ä½¿ç”¨é›†åˆçš„ toArray(T[] array)ï¼Œä¼ å…¥çš„æ˜¯ç±»å‹å®Œå…¨ä¸€è‡´ã€é•¿åº¦ä¸º 0 çš„ç©ºæ•°ç»„ã€‚\nä¾‹å­ï¼š\nString [] s= new String[]{ \u0026#34;dog\u0026#34;, \u0026#34;lazy\u0026#34;, \u0026#34;a\u0026#34;, \u0026#34;over\u0026#34;, \u0026#34;jumps\u0026#34;, \u0026#34;fox\u0026#34;, \u0026#34;brown\u0026#34;, \u0026#34;quick\u0026#34;, \u0026#34;A\u0026#34; }; List\u0026lt;String\u0026gt; list = Arrays.asList(s); Collections.reverse(list); //æ²¡æœ‰æŒ‡å®šç±»å‹çš„è¯ä¼šæŠ¥é”™ s=list.toArray(new String[0]); å¯¹äº JVM ä¼˜åŒ–ï¼Œnew String[0]ä½œä¸ºCollection.toArray()æ–¹æ³•çš„å‚æ•°ç°åœ¨ä½¿ç”¨æ›´å¥½ï¼Œnew String[0]å°±æ˜¯èµ·ä¸€ä¸ªæ¨¡æ¿çš„ä½œç”¨ï¼ŒæŒ‡å®šäº†è¿”å›æ•°ç»„çš„ç±»å‹ï¼Œ0 æ˜¯ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œå› ä¸ºå®ƒåªæ˜¯ä¸ºäº†è¯´æ˜è¿”å›çš„ç±»å‹\næ•°ç»„è½¬é›†åˆ # //é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œ\nä½¿ç”¨å·¥å…·ç±» Arrays.asList() æŠŠæ•°ç»„è½¬æ¢æˆé›†åˆæ—¶ï¼Œä¸èƒ½ä½¿ç”¨å…¶ä¿®æ”¹é›†åˆç›¸å…³çš„æ–¹æ³•ï¼Œ å®ƒçš„ add/remove/clear æ–¹æ³•ä¼šæŠ›å‡º UnsupportedOperationException å¼‚å¸¸ã€‚\nä¾‹å­åŠæºç ï¼š\nString[] myArray = {\u0026#34;Apple\u0026#34;, \u0026#34;Banana\u0026#34;, \u0026#34;Orange\u0026#34;}; List\u0026lt;String\u0026gt; myList = Arrays.asList(myArray); //ä¸Šé¢ä¸¤ä¸ªè¯­å¥ç­‰ä»·äºä¸‹é¢ä¸€æ¡è¯­å¥ List\u0026lt;String\u0026gt; myList = Arrays.asList(\u0026#34;Apple\u0026#34;,\u0026#34;Banana\u0026#34;, \u0026#34;Orange\u0026#34;); //JDKæºç è¯´æ˜[è¿”å›ç”±æŒ‡å®šæ•°ç»„æ”¯æŒçš„å›ºå®šå¤§å°çš„åˆ—è¡¨] /** *è¿”å›ç”±æŒ‡å®šæ•°ç»„æ”¯æŒçš„å›ºå®šå¤§å°çš„åˆ—è¡¨ã€‚æ­¤æ–¹æ³•ä½œä¸ºåŸºäºæ•°ç»„å’ŒåŸºäºé›†åˆçš„APIä¹‹é—´çš„æ¡¥æ¢ï¼Œ * ä¸ Collection.toArray()ç»“åˆä½¿ç”¨ã€‚è¿”å›çš„Listæ˜¯å¯åºåˆ—åŒ–å¹¶å®ç°RandomAccessæ¥å£ã€‚ */ public static \u0026lt;T\u0026gt; List\u0026lt;T\u0026gt; asList(T... a) { return new ArrayList\u0026lt;\u0026gt;(a); } æ³¨æ„äº‹é¡¹ï¼š\n1ã€Arrays.asList()æ˜¯æ³›å‹æ–¹æ³•ï¼Œä¼ é€’çš„æ•°ç»„å¿…é¡»æ˜¯å¯¹è±¡æ•°ç»„ï¼Œè€Œä¸æ˜¯åŸºæœ¬ç±»å‹ã€‚ å¦‚æœæŠŠåŸç”Ÿæ•°æ®ç±»å‹æ•°ç»„ä¼ å…¥ï¼Œåˆ™ä¼ å…¥çš„ä¸æ˜¯æ•°ç»„çš„å…ƒç´ ï¼Œè€Œæ˜¯æ•°ç»„å¯¹è±¡æœ¬èº«ï¼Œå¯ä»¥ä½¿ç”¨åŒ…è£…ç±»æ•°ç»„è§£å†³è¿™ä¸ªé—®é¢˜\nint[] myArray = {1, 2, 3}; List myList = Arrays.asList(myArray); System.out.println(myList.size());//1 System.out.println(myList.get(0));//æ•°ç»„åœ°å€å€¼ System.out.println(myList.get(1));//æŠ¥é”™ï¼šArrayIndexOutOfBoundsException int[] array = (int[]) myList.get(0); System.out.println(array[0]);//1 2ã€ä½¿ç”¨é›†åˆçš„ä¿®æ”¹æ–¹æ³•add()ï¼Œremove()ï¼Œclear()ä¼šæŠ›å‡ºå¼‚å¸¸UnsupportedOperationException java.util.Arrays$ArrayList ï¼ˆArraysé‡Œé¢æœ‰ä¸€ä¸ªArrayListç±»ï¼Œè¯¥ç±»ç»§æ‰¿äº†AbstractListï¼‰\næºç ï¼š\npublic E remove(int index) { throw new UnsupportedOperationException(); } public boolean add(E e) { add(size(), e); return true; } public void add(int index, E element) { throw new UnsupportedOperationException(); } public void clear() { removeRange(0, size()); } protected void removeRange(int fromIndex, int toIndex) { ListIterator\u0026lt;E\u0026gt; it = listIterator(fromIndex); for (int i=0, n=toIndex-fromIndex; i\u0026lt;n; i++) { it.next(); it.remove(); } } å¦‚ä½•è½¬æ¢æˆæ­£å¸¸çš„ArraysListå‘¢\næ‰‹åŠ¨å®ç°å·¥å…·ç±»\n//ä½¿ç”¨æ³›å‹ //JDK1.5+ static \u0026lt;T\u0026gt; List\u0026lt;T\u0026gt; arrayToList(final T[] array) { final List\u0026lt;T\u0026gt; l = new ArrayList\u0026lt;T\u0026gt;(array.length); for (final T s : array) { l.add(s); } return l; } Integer [] myArray = { 1, 2, 3 }; System.out.println(arrayToList(myArray).getClass());//class java.util.ArrayList ä¾¿æ·çš„æ–¹æ³•\n//å†è½¬ä¸€æ¬¡ List list = new ArrayList\u0026lt;\u0026gt;(Arrays.asList(\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;)) ä½¿ç”¨Java8çš„Streamï¼ˆæ¨èï¼‰ï¼ŒåŒ…æ‹¬åŸºæœ¬ç±»å‹\nInteger [] myArray = { 1, 2, 3 }; List myList = Arrays.stream(myArray).collect(Collectors.toList()); //åŸºæœ¬ç±»å‹ä¹Ÿå¯ä»¥å®ç°è½¬æ¢ï¼ˆä¾èµ–boxedçš„è£…ç®±æ“ä½œï¼‰ int [] myArray2 = { 1, 2, 3 }; List myList = Arrays.stream(myArray2).boxed().collect(Collectors.toList()); ä½¿ç”¨Apache Commons Colletions\nList\u0026lt;String\u0026gt; list = new ArrayList\u0026lt;String\u0026gt;(); CollectionUtils.addAll(list, str); ä½¿ç”¨Java9çš„List.of()\nInteger[] array = {1, 2, 3}; List\u0026lt;Integer\u0026gt; list = List.of(array); å¤§éƒ¨åˆ†è½¬è‡ªhttps://github.com/Snailclimb/JavaGuide\n"},{"id":151,"href":"/zh/docs/study/Review/java_guide/java/Collection/ly0102lycollection_2/","title":"é›†åˆ_2","section":"é›†åˆ","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nMap # HashMapå’ŒHashtableçš„åŒºåˆ«\nHashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼ŒHashtableæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºHashtableå†…éƒ¨æ–¹æ³•éƒ½ç»è¿‡synchronizedä¿®é¥°ï¼ˆä¸è¿‡è¦ä¿è¯çº¿ç¨‹å®‰å…¨ä¸€èˆ¬ç”¨ConcurrentHashMapï¼‰\nç”±äºåŠ äº†synchronizedä¿®é¥°ï¼ŒHashTableæ•ˆç‡æ²¡æœ‰HashMapé«˜\nHashMapå¯ä»¥å­˜å‚¨nullçš„keyå’Œvalueï¼Œä½†nullä½œä¸ºé”®åªèƒ½æœ‰ä¸€ä¸ª**ï¼›HashTableä¸å…è®¸æœ‰nullé”®å’Œnullå€¼**\nåˆå§‹å®¹é‡åŠæ¯æ¬¡æ‰©å®¹\nHashtableé»˜è®¤åˆå§‹å¤§å°11ï¼Œä¹‹åæ‰©å®¹ä¸º2n+1;HashMapåˆå§‹å¤§å°16ï¼Œä¹‹åæ‰©å®¹å˜ä¸ºåŸæ¥çš„2å€ å¦‚æœæŒ‡å®šåˆå§‹å¤§å°ï¼ŒHashTableç›´æ¥ä½¿ç”¨åˆå§‹å¤§å°\nè€ŒHashMap ä¼šå°†å…¶æ‰©å……ä¸º 2 çš„å¹‚æ¬¡æ–¹å¤§å°ï¼ˆHashMap ä¸­çš„**tableSizeFor()**æ–¹æ³•ä¿è¯ï¼Œä¸‹é¢ç»™å‡ºäº†æºä»£ç ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ HashMap æ€»æ˜¯ä½¿ç”¨ 2 çš„å¹‚ä½œä¸ºå“ˆå¸Œè¡¨çš„å¤§å°,åé¢ä¼šä»‹ç»åˆ°ä¸ºä»€ä¹ˆæ˜¯ 2 çš„å¹‚æ¬¡æ–¹ åº•å±‚æ•°æ®ç»“æ„\nJDK1.8ä¹‹åHashMapè§£å†³å“ˆå¸Œå†²çªæ—¶ï¼Œå½“é“¾è¡¨å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤8ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘ï¼ˆè½¬æ¢å‰åˆ¤æ–­ï¼Œå¦‚æœå½“å‰æ•°ç»„é•¿åº¦å°äº64ï¼Œåˆ™å…ˆè¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œè€Œä¸è½¬æˆçº¢é»‘æ ‘ï¼‰ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚ Hashtableæ²¡æœ‰ä¸Šé¢çš„æœºåˆ¶ /** HashMap ä¸­å¸¦æœ‰åˆå§‹å®¹é‡çš„æ„é€ å‡½æ•°ï¼š */ public HashMap(int initialCapacity, float loadFactor) { if (initialCapacity \u0026lt; 0) throw new IllegalArgumentException(\u0026#34;Illegal initial capacity: \u0026#34; + initialCapacity); if (initialCapacity \u0026gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; if (loadFactor \u0026lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException(\u0026#34;Illegal load factor: \u0026#34; + loadFactor); this.loadFactor = loadFactor; this.threshold = tableSizeFor(initialCapacity); } public HashMap(int initialCapacity) { this(initialCapacity, DEFAULT_LOAD_FACTOR); } /*ä¸‹é¢è¿™ä¸ªæ–¹æ³•ä¿è¯äº† HashMap æ€»æ˜¯ä½¿ç”¨ 2 çš„å¹‚ä½œä¸ºå“ˆå¸Œè¡¨çš„å¤§å°ã€‚*/ /** * Returns a power of two size for the given target capacity. */ static final int tableSizeFor(int cap) { int n = cap - 1; n |= n \u0026gt;\u0026gt;\u0026gt; 1; n |= n \u0026gt;\u0026gt;\u0026gt; 2; n |= n \u0026gt;\u0026gt;\u0026gt; 4; n |= n \u0026gt;\u0026gt;\u0026gt; 8; n |= n \u0026gt;\u0026gt;\u0026gt; 16; return (n \u0026lt; 0) ? 1 : (n \u0026gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1; } HashMapå’ŒhashSetåŒºåˆ«\nå¦‚æœä½ çœ‹è¿‡ HashSet æºç çš„è¯å°±åº”è¯¥çŸ¥é“ï¼šHashSet åº•å±‚å°±æ˜¯åŸºäº HashMap å®ç°çš„ã€‚ï¼ˆHashSet çš„æºç éå¸¸éå¸¸å°‘ï¼Œå› ä¸ºé™¤äº† clone()ã€writeObject()ã€readObject()æ˜¯ HashSet è‡ªå·±ä¸å¾—ä¸å®ç°ä¹‹å¤–ï¼Œå…¶ä»–æ–¹æ³•éƒ½æ˜¯ç›´æ¥è°ƒç”¨ HashMap ä¸­çš„æ–¹æ³•\nHashSetåº•å±‚å°±HashMap ä¼šå°†å…¶æ‰©å……ä¸º 2 çš„å¹‚æ¬¡æ–¹å¤§å°ï¼ˆHashMap ä¸­çš„tableSizeFor()æ–¹æ³•ä¿è¯ï¼Œä¸‹é¢ç»™å‡ºäº†æºä»£ç ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ HashMap æ€»æ˜¯ä½¿ç”¨ 2 çš„å¹‚ä½œä¸ºå“ˆå¸Œè¡¨çš„å¤§å°,åé¢ä¼šä»‹ç»åˆ°ä¸ºä»€ä¹ˆæ˜¯ 2 çš„å¹‚æ¬¡æ–¹æ˜¯HashMapå®ç°çš„ HashMapï¼šå®ç°äº†Mapæ¥å£ï¼›å­˜å‚¨é”®å€¼å¯¹ï¼›è°ƒç”¨put()å‘mapä¸­æ·»åŠ å…ƒç´ ï¼›HashMapä½¿ç”¨é”®ï¼ˆkeyï¼‰è®¡ç®—hashcode HashSetï¼šå®ç°Setæ¥å£ï¼›ä»…å­˜å‚¨å¯¹è±¡ï¼›è°ƒç”¨add()æ–¹æ³•å‘Setä¸­æ·»åŠ å…ƒç´ ï¼›HashSetä½¿ç”¨æˆå‘˜å¯¹è±¡è®¡ç®—hashCodeï¼Œå¯¹äºä¸ç›¸ç­‰ä¸¤ä¸ªå¯¹è±¡æ¥è¯´ hashcodeä¹Ÿå¯èƒ½ç›¸åŒï¼Œæ‰€ä»¥**è¿˜è¦å†å€ŸåŠ©equals()**æ–¹æ³•åˆ¤æ–­å¯¹è±¡ç›¸ç­‰æ€§ HashMapå’ŒTreeMap navigable è‹±[ËˆnÃ¦vÉªÉ¡É™bl] é€šèˆªçš„ï¼Œå¯èˆªè¡Œçš„\nHashMapå’ŒTreeMapéƒ½ç»§æ‰¿è‡ªAbstractMap\nTreeMapè¿˜å®ç°äº†NavigableMap ï¼ˆå¯¹é›†åˆå†…å…ƒç´ æœç´¢ï¼‰å’ŒSortedMapï¼ˆå¯¹é›†åˆå†…å…ƒç´ æ ¹æ®é”®æ’åºï¼Œé»˜è®¤keyå‡åºï¼Œå¯æŒ‡å®šæ’åºçš„æ¯”è¾ƒå™¨ï¼‰æ¥å£\nå®ç° NavigableMap æ¥å£è®© TreeMap æœ‰äº†å¯¹é›†åˆå†…å…ƒç´ çš„æœç´¢çš„èƒ½åŠ›ã€‚\nå®ç°SortedMapæ¥å£è®© TreeMap æœ‰äº†å¯¹é›†åˆä¸­çš„å…ƒç´ æ ¹æ®é”®æ’åºçš„èƒ½åŠ›ã€‚é»˜è®¤æ˜¯æŒ‰ key çš„å‡åºæ’åºï¼Œä¸è¿‡æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šæ’åºçš„æ¯”è¾ƒå™¨ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n/** * @author shuang.kou * @createTime 2020å¹´06æœˆ15æ—¥ 17:02:00 */ public class Person { private Integer age; public Person(Integer age) { this.age = age; } public Integer getAge() { return age; } public static void main(String[] args) { TreeMap\u0026lt;Person, String\u0026gt; treeMap = new TreeMap\u0026lt;\u0026gt;(new Comparator\u0026lt;Person\u0026gt;() { @Override public int compare(Person person1, Person person2) { int num = person1.getAge() - person2.getAge(); return Integer.compare(num, 0); } }); treeMap.put(new Person(3), \u0026#34;person1\u0026#34;); treeMap.put(new Person(18), \u0026#34;person2\u0026#34;); treeMap.put(new Person(35), \u0026#34;person3\u0026#34;); treeMap.put(new Person(16), \u0026#34;person4\u0026#34;); treeMap.entrySet().stream().forEach(personStringEntry -\u0026gt; { System.out.println(personStringEntry.getValue()); }); } } //è¾“å‡º /**person1 person4 person2 person3 **/ HashSetå¦‚ä½•æ£€æŸ¥é‡å¤\nå½“åœ¨HashSetåŠ å…¥å¯¹è±¡æ—¶ï¼Œå…ˆè®¡ç®—å¯¹è±¡hashcodeå€¼åˆ¤æ–­åŠ å…¥ä½ç½®ï¼ŒåŒæ—¶ä¸å…¶ä»–åŠ å…¥å¯¹è±¡çš„hashcodeå€¼æ¯”è¾ƒï¼Œå¦‚æœæ²¡æœ‰ç›¸åŒçš„ï¼Œä¼šå‡è®¾å¯¹è±¡æ²¡æœ‰é‡å¤å‡ºç°ï¼›å¦‚æœå‘ç°æœ‰ç›¸åŒçš„hashcodeå€¼çš„å¯¹è±¡ï¼Œåˆ™è°ƒç”¨equals()æ–¹æ³•æ£€æŸ¥hashcodeç›¸ç­‰çš„å¯¹è±¡æ˜¯å¦çœŸçš„ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰åˆ™ä¸ä¼šåŠ å…¥\nJDK1.8ä¸­ï¼ŒHashSetçš„add()æ–¹æ³•è°ƒç”¨äº†HashMapçš„put()æ–¹æ³•ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦æœ‰é‡å¤å…ƒç´ ï¼ˆè¿”å›å€¼æ˜¯å¦null)\n// Returns: true if this set did not already contain the specified element // è¿”å›å€¼ï¼šå½“ set ä¸­æ²¡æœ‰åŒ…å« add çš„å…ƒç´ æ—¶è¿”å›çœŸ public boolean add(E e) { return map.put(e, PRESENT)==null; } //ä¸‹é¢ä¸ºHashMapçš„æºä»£ç  // Returns : previous value, or null if none // è¿”å›å€¼ï¼šå¦‚æœæ’å…¥ä½ç½®æ²¡æœ‰å…ƒç´ è¿”å›nullï¼Œå¦åˆ™è¿”å›ä¸Šä¸€ä¸ªå…ƒç´  final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) { ... } HashMapåº•å±‚å®ç°\nJDK1.8ä¹‹å‰ï¼Œåº•å±‚æ˜¯æ•°ç»„å’Œé“¾è¡¨ç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œå³é“¾è¡¨æ•£åˆ—ã€‚é€šè¿‡keyçš„hashcode ç»è¿‡æ‰°åŠ¨å‡½æ•°å¤„ç†åå¾—åˆ°hashå€¼ï¼Œå¹¶é€šè¿‡ (n-1) \u0026amp; hash åˆ¤æ–­å½“å‰å…ƒç´ å­˜æ”¾çš„ä½ç½® ï¼ˆnä¸ºæ•°ç»„é•¿åº¦ï¼‰ï¼Œå¦‚æœå½“å‰ä½ç½®å­˜åœ¨å…ƒç´ çš„è¯ï¼Œå°±åˆ¤æ–­è¯¥å…ƒç´ ä¸è¦å­˜å…¥çš„å…ƒç´ çš„hashå€¼ä»¥åŠkeyæ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒåˆ™è¦†ç›–ï¼Œä¸åŒåˆ™é€šè¿‡æ‹‰é“¾æ³•è§£å†³å†²çª æ‰°åŠ¨å‡½æ•°æŒ‡çš„æ˜¯HashMapçš„hashæ–¹æ³•ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢ä¸€äº›å®ç°æ¯”è¾ƒå·®çš„hashCodeæ–¹æ³•ï¼Œå‡å°‘ç¢°æ’ JDK1.8çš„hashï¼šå¦‚æœkeyä¸ºnullåˆ™è¿”å›ç©ºï¼Œå¦åˆ™ä½¿ç”¨ (keyçš„hashå€¼) ä¸ (hashå€¼å³ç§»16ä½) åšå¼‚æˆ–æ“ä½œ\nstatic final int hash(Object key) { int h; // key.hashCode()ï¼šè¿”å›æ•£åˆ—å€¼ä¹Ÿå°±æ˜¯hashcode // ^ ï¼šæŒ‰ä½å¼‚æˆ– // \u0026gt;\u0026gt;\u0026gt;:æ— ç¬¦å·å³ç§»ï¼Œå¿½ç•¥ç¬¦å·ä½ï¼Œç©ºä½éƒ½ä»¥0è¡¥é½ return (key == null) ? 0 : (h = key.hashCode()) ^ (h \u0026gt;\u0026gt;\u0026gt; 16); } JDK1.7æ‰°åŠ¨æ¬¡æ•°æ›´å¤š\nstatic int hash(int h) { // This function ensures that hashCodes that differ only by // constant multiples at each bit position have a bounded // number of collisions (approximately 8 at default load factor). h ^= (h \u0026gt;\u0026gt;\u0026gt; 20) ^ (h \u0026gt;\u0026gt;\u0026gt; 12); return h ^ (h \u0026gt;\u0026gt;\u0026gt; 7) ^ (h \u0026gt;\u0026gt;\u0026gt; 4); } æ‹‰é“¾æ³•å³é“¾è¡¨å’Œæ•°ç»„ç»“åˆï¼Œä¹Ÿå°±æ˜¯åˆ›å»ºä¸€ä¸ªé“¾è¡¨æ•°ç»„ï¼Œæ•°ç»„æ¯ä¸€æ ¼ä¸ºä¸€ä¸ªé“¾è¡¨ï¼Œå¦‚æœå‘ç”Ÿå“ˆå¸Œå†²çªï¼Œå°±å°†å†²çªçš„å€¼æ·»åŠ åˆ°é“¾è¡¨ä¸­å³å¯\nJDK8ä¹‹åï¼Œè§£å†³å†²çªå‘ç”Ÿäº†è¾ƒå¤§å˜åŒ–ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤æ˜¯8ï¼‰ï¼ˆå¦‚æœæ•°ç»„å°äº64ï¼Œåˆ™åªä¼šè¿›è¡Œæ‰©å®¹ï¼›å¦‚æœä¸æ˜¯ï¼Œæ‰è½¬æˆçº¢é»‘æ ‘ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šé€€åŒ–æˆçº¿æ€§ç»“æ„ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºn ï¼Œè€Œçº¢é»‘æ ‘è¶‹äºlog n ã€‚TreeMapã€TreeSetä»¥åŠ1.8ä¹‹åçš„HashMapéƒ½ç”¨åˆ°äº†çº¢é»‘æ ‘\nä»£ç \n//å½“é“¾è¡¨é•¿åº¦å¤§äº8æ—¶ï¼Œæ‰§è¡ŒtreeifyBinï¼ˆè½¬æ¢çº¢é»‘æ ‘ï¼‰ // éå†é“¾è¡¨ for (int binCount = 0; ; ++binCount) { // éå†åˆ°é“¾è¡¨æœ€åä¸€ä¸ªèŠ‚ç‚¹ if ((e = p.next) == null) { p.next = newNode(hash, key, value, null); // å¦‚æœé“¾è¡¨å…ƒç´ ä¸ªæ•°å¤§äºç­‰äºTREEIFY_THRESHOLDï¼ˆ8ï¼‰ if (binCount \u0026gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st // çº¢é»‘æ ‘è½¬æ¢ï¼ˆå¹¶ä¸ä¼šç›´æ¥è½¬æ¢æˆçº¢é»‘æ ‘ï¼‰ treeifyBin(tab, hash); break; } if (e.hash == hash \u0026amp;\u0026amp; ((k = e.key) == key || (key != null \u0026amp;\u0026amp; key.equals(k)))) break; p = e; } //åˆ¤æ–­æ˜¯å¦ä¼šè½¬æˆçº¢é»‘æ ‘ final void treeifyBin(Node\u0026lt;K,V\u0026gt;[] tab, int hash) { int n, index; Node\u0026lt;K,V\u0026gt; e; // åˆ¤æ–­å½“å‰æ•°ç»„çš„é•¿åº¦æ˜¯å¦å°äº 64 if (tab == null || (n = tab.length) \u0026lt; MIN_TREEIFY_CAPACITY) // å¦‚æœå½“å‰æ•°ç»„çš„é•¿åº¦å°äº 64ï¼Œé‚£ä¹ˆä¼šé€‰æ‹©å…ˆè¿›è¡Œæ•°ç»„æ‰©å®¹ resize(); else if ((e = tab[index = (n - 1) \u0026amp; hash]) != null) { // å¦åˆ™æ‰å°†åˆ—è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ TreeNode\u0026lt;K,V\u0026gt; hd = null, tl = null; do { TreeNode\u0026lt;K,V\u0026gt; p = replacementTreeNode(e, null); if (tl == null) hd = p; else { p.prev = tl; tl.next = p; } tl = p; } while ((e = e.next) != null); if ((tab[index] = hd) != null) hd.treeify(tab); } } HashMapçš„é•¿åº¦ä¸ºä¸ºä»€ä¹ˆæ˜¯2çš„å¹‚æ¬¡æ–¹\nä¸ºäº†èƒ½è®© HashMap å­˜å–é«˜æ•ˆï¼Œå°½é‡è¾ƒå°‘ç¢°æ’ï¼Œä¹Ÿå°±æ˜¯è¦å°½é‡æŠŠæ•°æ®åˆ†é…å‡åŒ€ã€‚æˆ‘ä»¬ä¸Šé¢ä¹Ÿè®²åˆ°äº†è¿‡äº†ï¼ŒHash å€¼çš„èŒƒå›´å€¼-2147483648 åˆ° 2147483647ï¼Œå‰ååŠ èµ·æ¥å¤§æ¦‚ 40 äº¿çš„æ˜ å°„ç©ºé—´ï¼Œåªè¦å“ˆå¸Œå‡½æ•°æ˜ å°„å¾—æ¯”è¾ƒå‡åŒ€æ¾æ•£ï¼Œä¸€èˆ¬åº”ç”¨æ˜¯å¾ˆéš¾å‡ºç°ç¢°æ’çš„ã€‚ä½†é—®é¢˜æ˜¯ä¸€ä¸ª 40 äº¿é•¿åº¦çš„æ•°ç»„ï¼Œå†…å­˜æ˜¯æ”¾ä¸ä¸‹çš„ã€‚æ‰€ä»¥è¿™ä¸ªæ•£åˆ—å€¼æ˜¯ä¸èƒ½ç›´æ¥æ‹¿æ¥ç”¨çš„ï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ªæ•°ç»„ä¸èƒ½ç›´æ¥æ‹¿æ¥ç”¨ï¼‰ã€‚\nç”¨ä¹‹å‰è¿˜è¦å…ˆåšå¯¹æ•°ç»„çš„é•¿åº¦å–æ¨¡è¿ç®—ï¼Œå¾—åˆ°çš„ä½™æ•°æ‰èƒ½ç”¨æ¥è¦å­˜æ”¾çš„ä½ç½®ä¹Ÿå°±æ˜¯å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ã€‚è¿™ä¸ªæ•°ç»„ä¸‹æ ‡çš„è®¡ç®—æ–¹æ³•æ˜¯â€œ (n - 1) \u0026amp; hashâ€ã€‚ï¼ˆn ä»£è¡¨æ•°ç»„é•¿åº¦ï¼‰ã€‚è¿™ä¹Ÿå°±è§£é‡Šäº† HashMap çš„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯ 2 çš„å¹‚æ¬¡æ–¹ã€‚\nè¿™ä¸ªç®—æ³•åº”è¯¥å¦‚ä½•è®¾è®¡å‘¢ï¼Ÿ\næˆ‘ä»¬é¦–å…ˆå¯èƒ½ä¼šæƒ³åˆ°é‡‡ç”¨%å–ä½™çš„æ“ä½œæ¥å®ç°ã€‚ä½†æ˜¯ï¼Œé‡ç‚¹æ¥äº†ï¼šâ€œå–ä½™(%)æ“ä½œä¸­å¦‚æœé™¤æ•°æ˜¯ 2 çš„å¹‚æ¬¡åˆ™ç­‰ä»·äºä¸å…¶é™¤æ•°å‡ä¸€çš„ä¸(\u0026amp;)æ“ä½œï¼ˆä¹Ÿå°±æ˜¯è¯´ hash%length==hash\u0026amp;(length-1)çš„å‰ææ˜¯ length æ˜¯ 2 çš„ n æ¬¡æ–¹ï¼›ï¼‰ã€‚â€ å¹¶ä¸” é‡‡ç”¨äºŒè¿›åˆ¶ä½æ“ä½œ \u0026amp;ï¼Œç›¸å¯¹äº%èƒ½å¤Ÿæé«˜è¿ç®—æ•ˆç‡ï¼Œè¿™å°±è§£é‡Šäº† HashMap çš„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯ 2 çš„å¹‚æ¬¡æ–¹ã€‚\nHashMapå¤šçº¿ç¨‹æ“ä½œå¯¼è‡´æ­»å¾ªç¯é—®é¢˜ å¤šçº¿ç¨‹ä¸‹ä¸å»ºè®®ä½¿ç”¨HashMapï¼Œ1.8ä¹‹å‰å¹¶å‘ä¸‹è¿›è¡ŒRehashä¼šé€ æˆå…ƒç´ ä¹‹é—´å½¢æˆå¾ªç¯é“¾è¡¨ï¼Œä½†æ˜¯1.8ä¹‹åè¿˜æœ‰å…¶ä»–é—®é¢˜ï¼ˆæ•°æ®ä¸¢å¤±ï¼‰ï¼Œå»ºè®®ä½¿ç”¨concurrentHashMap\nHashMapæœ‰å“ªå‡ ç§å¸¸è§çš„éå†æ–¹å¼\nhttps://mp.weixin.qq.com/s/zQBN3UvJDhRTKP6SzcZFKw\nConcurrentHashMapå’ŒHashtable\nä¸»è¦ä½“ç°åœ¨ï¼Œå®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ä¸Šä¸åŒ\nåº•å±‚æ•°æ®ç»“æ„\nConcurrentHashMapï¼šJDK1.7 åº•å±‚é‡‡ç”¨åˆ†æ®µæ•°ç»„+é“¾è¡¨ï¼ŒJDK1.8 åˆ™æ˜¯æ•°ç»„+é“¾è¡¨/çº¢é»‘äºŒå‰æ ‘ï¼ˆçº¢é»‘æ ‘æ˜¯1.8ä¹‹åæ‰å‡ºç°çš„ï¼‰ HashTableé‡‡ç”¨ æ•°ç»„ (åº”è¯¥ä¸æ˜¯åˆ†æ®µæ•°ç»„) + é“¾è¡¨ å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼\nConcurrentHashMap JDK1.7 æ—¶å¯¹æ•´ä¸ªæ¡¶æ•°è¿›è¡Œåˆ†å‰²åˆ†æ®µ(Segmentï¼Œåˆ†æ®µé”)ï¼Œæ¯ä¸€æŠŠé”åªé”å®¹å™¨å…¶ä¸­ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå½“è®¿é—®ä¸åŒæ•°æ®æ®µçš„æ•°æ®å°±ä¸ä¼šå­˜åœ¨é”ç«äº‰ ConcurrentHashMap JDK1.8æ‘’å¼ƒSegmentæ¦‚å¿µï¼Œç›´æ¥ç”¨Nodeæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼Œå¹¶å‘æ§åˆ¶ä½¿ç”¨synchronizedå’ŒCASæ“ä½œ è€ŒHashtableåˆ™æ˜¯åŒä¸€æŠŠé”ï¼Œä½¿ç”¨synchronizedä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡ä½ä¸‹ã€‚é—®é¢˜ï¼šå½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥æ–¹å¼æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿè®¿é—®åŒæ­¥æ–¹æ³•ï¼Œåˆ™å¯èƒ½è¿›å…¥é˜»å¡/è½®è¯¢çŠ¶æ€ï¼Œå³å¦‚ä½¿ç”¨putæ·»åŠ å…ƒç´ å¦ä¸€ä¸ªçº¿ç¨‹ä¸èƒ½ä½¿ç”¨putå’Œget åº•å±‚æ•°æ®ç»“æ„å›¾\nHashTableï¼šæ•°ç»„+é“¾è¡¨ JDK1.7 çš„ ConcurrentHashMapï¼ˆSegmentæ•°ç»„ï¼ŒHashEntryæ•°ç»„ï¼Œé“¾è¡¨ï¼‰\nSegmentæ˜¯ç”¨æ¥åŠ é”çš„ JDK1.8 çš„ConcurrentHashMapåˆ™æ˜¯Nodeæ•°ç»„+é“¾è¡¨/çº¢é»‘æ ‘ï¼Œä¸è¿‡çº¢é»‘æ ‘æ—¶ï¼Œä¸ç”¨Nodeï¼Œè€Œæ˜¯ç”¨TreeNode\nTreeNodeï¼Œå­˜å‚¨çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œè¢«TreeBinåŒ…è£…\n/** root ç»´æŠ¤çº¢é»‘æ ‘æ ¹èŠ‚ç‚¹ï¼›waiterç»´æŠ¤å½“å‰ä½¿ç”¨è¿™é¢—çº¢é»‘æ ‘çš„çº¿ç¨‹ï¼Œé˜²æ­¢å…¶ä»–çº¿ç¨‹è¿›å…¥ **/ static final class TreeBin\u0026lt;K,V\u0026gt; extends Node\u0026lt;K,V\u0026gt; { TreeNode\u0026lt;K,V\u0026gt; root; volatile TreeNode\u0026lt;K,V\u0026gt; first; volatile Thread waiter; volatile int lockState; // values for lockState static final int WRITER = 1; // set while holding write lock static final int WAITER = 2; // set when waiting for write lock static final int READER = 4; // increment value for setting read lock ... } ConcurrentHashMapçº¿ç¨‹å®‰å…¨çš„å…·ä½“å®ç°æ–¹å¼/åº•å±‚å…·ä½“å®ç°\nJDK1.8ä¹‹å‰çš„ConcurrentHashMap\nSegment ç»§æ‰¿äº† ReentrantLock,æ‰€ä»¥ Segment æ˜¯ä¸€ç§å¯é‡å…¥é”ï¼Œæ‰®æ¼”é”çš„è§’è‰²ã€‚HashEntry ç”¨äºå­˜å‚¨é”®å€¼å¯¹æ•°æ®ã€‚\nstatic class Segment\u0026lt;K,V\u0026gt; extends ReentrantLock implements Serializable { } ä¸€ä¸ª ConcurrentHashMap é‡ŒåŒ…å«ä¸€ä¸ª Segment æ•°ç»„ï¼ŒSegment çš„ä¸ªæ•°ä¸€æ—¦åˆå§‹åŒ–å°±ä¸èƒ½æ”¹å˜ã€‚ Segment æ•°ç»„çš„å¤§å°é»˜è®¤æ˜¯ 16ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤å¯ä»¥åŒæ—¶æ”¯æŒ 16 ä¸ªçº¿ç¨‹å¹¶å‘å†™ã€‚ Segment çš„ç»“æ„å’Œ HashMap ç±»ä¼¼ï¼Œæ˜¯ä¸€ç§æ•°ç»„å’Œé“¾è¡¨ç»“æ„ï¼Œä¸€ä¸ª Segment åŒ…å«ä¸€ä¸ª HashEntry æ•°ç»„ï¼Œæ¯ä¸ª HashEntry æ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„çš„å…ƒç´ ï¼Œæ¯ä¸ª Segment å®ˆæŠ¤ç€ä¸€ä¸ª HashEntry æ•°ç»„é‡Œçš„å…ƒç´ ï¼Œå½“å¯¹ HashEntry æ•°ç»„çš„æ•°æ®è¿›è¡Œä¿®æ”¹æ—¶ï¼Œå¿…é¡»é¦–å…ˆè·å¾—å¯¹åº”çš„ Segment çš„é”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹åŒä¸€ Segment çš„å¹¶å‘å†™å…¥ä¼šè¢«é˜»å¡ï¼Œä¸åŒ Segment çš„å†™å…¥æ˜¯å¯ä»¥å¹¶å‘æ‰§è¡Œçš„ã€‚\nJDK 1.8 ä¹‹å ä½¿ç”¨Nodeæ•°ç»„+é“¾è¡¨/çº¢é»‘æ ‘ï¼Œå‡ ä¹é‡å†™äº†ConcurrentHashMapï¼Œä½¿ç”¨Node+CAS+Synchronizedä¿è¯å¹¶å‘å®‰å…¨ï¼Œæ•°æ®ç»“æ„è·ŸHashMap1.8ç±»ä¼¼ï¼Œè¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼ˆé»˜è®¤8ï¼‰å°†é“¾è¡¨ã€O(N)ã€‘è½¬æˆçº¢é»‘æ ‘ã€O(log (N) )ã€‘ JDK8ä¸­ï¼Œåªé”å®šå½“å‰é“¾è¡¨/çº¢é»‘äºŒå‰æ ‘çš„é¦–èŠ‚ç‚¹ï¼Œè¿™æ ·åªè¦hashä¸å†²çªå°±ä¸ä¼šäº§ç”Ÿå¹¶å‘ï¼Œä¸å½±å“å…¶ä»–Nodeçš„è¯»å†™ï¼Œæé«˜æ•ˆç‡\nCollectionså·¥å…·ç±»ï¼ˆä¸é‡è¦ï¼‰ # åŒ…æ‹¬ æ’åº/æŸ¥æ‰¾/æ›¿æ¢\næ’åº\nvoid reverse(List list)//åè½¬ void shuffle(List list)//éšæœºæ’åº void sort(List list)//æŒ‰è‡ªç„¶æ’åºçš„å‡åºæ’åº void sort(List list, Comparator c)//å®šåˆ¶æ’åºï¼Œç”±Comparatoræ§åˆ¶æ’åºé€»è¾‘ void swap(List list, int i , int j)//äº¤æ¢ä¸¤ä¸ªç´¢å¼•ä½ç½®çš„å…ƒç´  void rotate(List list, int distance)//æ—‹è½¬ã€‚å½“distanceä¸ºæ­£æ•°æ—¶ï¼Œå°†listådistanceä¸ªå…ƒç´ æ•´ä½“ç§»åˆ°å‰é¢ã€‚å½“distanceä¸ºè´Ÿæ•°æ—¶ï¼Œå°† listçš„å‰distanceä¸ªå…ƒç´ æ•´ä½“ç§»åˆ°åé¢ æŸ¥æ‰¾/æ›¿æ¢\nint binarySearch(List list, Object key)//å¯¹Listè¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œè¿”å›ç´¢å¼•ï¼Œæ³¨æ„Listå¿…é¡»æ˜¯æœ‰åºçš„ int max(Collection coll)//æ ¹æ®å…ƒç´ çš„è‡ªç„¶é¡ºåºï¼Œè¿”å›æœ€å¤§çš„å…ƒç´ ã€‚ ç±»æ¯”int min(Collection coll) int max(Collection coll, Comparator c)//æ ¹æ®å®šåˆ¶æ’åºï¼Œè¿”å›æœ€å¤§å…ƒç´ ï¼Œæ’åºè§„åˆ™ç”±Comparatatorç±»æ§åˆ¶ã€‚ç±»æ¯”int min(Collection coll, Comparator c) void fill(List list, Object obj)//ç”¨æŒ‡å®šçš„å…ƒç´ ä»£æ›¿æŒ‡å®šlistä¸­çš„æ‰€æœ‰å…ƒç´  int frequency(Collection c, Object o)//ç»Ÿè®¡å…ƒç´ å‡ºç°æ¬¡æ•° int indexOfSubList(List list, List target)//ç»Ÿè®¡targetåœ¨listä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œæ‰¾ä¸åˆ°åˆ™è¿”å›-1ï¼Œç±»æ¯”int lastIndexOfSubList(List source, list target) boolean replaceAll(List list, Object oldVal, Object newVal)//ç”¨æ–°å…ƒç´ æ›¿æ¢æ—§å…ƒç´  åŒæ­¥æ§åˆ¶ï¼ŒCollectionsæä¾›äº†å¤šä¸ªsynchronizedXxx()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥å°†æŒ‡å®šé›†åˆåŒ…è£…æˆçº¿ç¨‹åŒæ­¥çš„é›†åˆï¼Œä»è€Œè§£å†³å¹¶å‘é—®é¢˜ã€‚ å…¶ä¸­ï¼ŒHashSetã€TreeSetã€ArrayListã€LinkedListã€HashMapã€TreeMapéƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„\n//ä¸æ¨èï¼Œå› ä¸ºæ•ˆç‡æä½ å»ºè®®ä½¿ç”¨JUCåŒ…ä¸‹çš„å¹¶å‘é›†åˆ synchronizedCollection(Collection\u0026lt;T\u0026gt; c) //è¿”å›æŒ‡å®š collection æ”¯æŒ çš„åŒæ­¥ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼‰collectionã€‚ synchronizedList(List\u0026lt;T\u0026gt; list)//è¿”å›æŒ‡å®šåˆ—è¡¨æ”¯æŒçš„åŒæ­¥ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼‰Listã€‚ synchronizedMap(Map\u0026lt;K,V\u0026gt; m) //è¿”å›ç”±æŒ‡å®šæ˜ å°„æ”¯æŒçš„åŒæ­¥ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼‰Mapã€‚ synchronizedSet(Set\u0026lt;T\u0026gt; s) //è¿”å›æŒ‡å®š set æ”¯æŒçš„åŒæ­¥ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼‰setã€‚ "},{"id":152,"href":"/zh/docs/study/Review/java_guide/java/Collection/ly0101lycollection_1/","title":"é›†åˆ_1","section":"é›†åˆ","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\né›†åˆåŒ…æ‹¬Collectionå’ŒMapï¼ŒCollection å­˜æ”¾å•ä¸€å…ƒç´ ã€‚Map å­˜æ”¾é”®å€¼å¯¹ # Listï¼ŒSetï¼ŒQueueï¼ŒMapåŒºåˆ« # List(å¯¹ä»˜é¡ºåºçš„å¥½å¸®æ‰‹): å­˜å‚¨çš„å…ƒç´ æ˜¯æœ‰åºçš„ã€å¯é‡å¤çš„ã€‚ Set(æ³¨é‡ç‹¬ä¸€æ— äºŒçš„æ€§è´¨): å­˜å‚¨çš„å…ƒç´ æ˜¯æ— åºçš„ã€ä¸å¯é‡å¤çš„ã€‚ Queue(å®ç°æ’é˜ŸåŠŸèƒ½çš„å«å·æœº): æŒ‰ç‰¹å®šçš„æ’é˜Ÿè§„åˆ™æ¥ç¡®å®šå…ˆåé¡ºåºï¼Œå­˜å‚¨çš„å…ƒç´ æ˜¯æœ‰åºçš„ã€å¯é‡å¤çš„ã€‚ Map(ç”¨ key æ¥æœç´¢çš„ä¸“å®¶): ä½¿ç”¨é”®å€¼å¯¹ï¼ˆkey-valueï¼‰å­˜å‚¨ï¼Œç±»ä¼¼äºæ•°å­¦ä¸Šçš„å‡½æ•° y=f(x)ï¼Œ\u0026ldquo;x\u0026rdquo; ä»£è¡¨ keyï¼Œ\u0026ldquo;y\u0026rdquo; ä»£è¡¨ valueï¼Œkey æ˜¯æ— åºçš„ã€ä¸å¯é‡å¤çš„ï¼Œvalue æ˜¯æ— åºçš„ã€å¯é‡å¤çš„ï¼Œæ¯ä¸ªé”®æœ€å¤šæ˜ å°„åˆ°ä¸€ä¸ªå€¼ã€‚ å„ç§é›†åˆæ¡†æ¶\u0026ndash;åº•å±‚æ•°æ®ç»“æ„ # List ArrayListã€Vector \u0026mdash;-\u0026gt; Object[] æ•°ç»„ LinkedList åŒå‘é“¾è¡¨ (jdk 1.6 ä¹‹å‰ä¸ºå¾ªç¯é“¾è¡¨, 1.7 å–æ¶ˆäº†å¾ªç¯) Set HashSet ï¼ˆæ— åºï¼Œå”¯ä¸€ï¼‰ï¼Œä¸”åŸºäºHashMap LinkedHashSet æ˜¯HashSetçš„å­ç±»ï¼ŒåŸºäºLinkedHashMap (LinkedHashMapå†…éƒ¨åŸºäºHashMapå®ç°) TreeSet(æœ‰åºï¼Œå”¯ä¸€) ï¼šçº¢é»‘æ ‘ï¼ˆè‡ªå¹³è¡¡çš„æ’åºäºŒå‰æ ‘ï¼‰ Queue (é˜Ÿåˆ—) PriorityQueueï¼šObject[] æ•°ç»„æ¥å®ç°äºŒå‰å † ArrayQueueï¼šObject[] æ•°ç»„+ åŒæŒ‡é’ˆ Map HashMapï¼š JDK1.8 ä¹‹å‰ HashMap ç”±æ•°ç»„+é“¾è¡¨ç»„æˆçš„ï¼Œæ•°ç»„æ˜¯ HashMap çš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ï¼ˆâ€œæ‹‰é“¾æ³•â€è§£å†³å†²çªï¼‰ã€‚JDK1.8 ä»¥ååœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶æœ‰äº†è¾ƒå¤§çš„å˜åŒ–ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8ï¼‰ï¼ˆå°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘å‰ä¼šåˆ¤æ–­ï¼Œå¦‚æœå½“å‰æ•°ç»„çš„é•¿åº¦å°äº 64ï¼Œé‚£ä¹ˆä¼šé€‰æ‹©å…ˆè¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´\nLinkedHashMapï¼š LinkedHashMap ç»§æ‰¿è‡ª HashMapï¼Œæ‰€ä»¥å®ƒçš„åº•å±‚ä»ç„¶æ˜¯åŸºäºæ‹‰é“¾å¼æ•£åˆ—ç»“æ„ å³ç”±æ•°ç»„å’Œé“¾è¡¨æˆ–çº¢é»‘æ ‘ç»„æˆã€‚å¦å¤–ï¼ŒLinkedHashMap åœ¨ä¸Šé¢ç»“æ„çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†ä¸€æ¡åŒå‘é“¾è¡¨ï¼Œä½¿å¾—ä¸Šé¢çš„ç»“æ„å¯ä»¥ä¿æŒé”®å€¼å¯¹çš„æ’å…¥é¡ºåºã€‚åŒæ—¶é€šè¿‡å¯¹é“¾è¡¨è¿›è¡Œç›¸åº”çš„æ“ä½œï¼Œå®ç°äº†è®¿é—®é¡ºåºç›¸å…³é€»è¾‘ã€‚\nä¸Šå›¾ä¸­ï¼Œæ·¡è“è‰²çš„ç®­å¤´è¡¨ç¤ºå‰é©±å¼•ç”¨ï¼Œçº¢è‰²ç®­å¤´è¡¨ç¤ºåç»§å¼•ç”¨ã€‚æ¯å½“æœ‰æ–°é”®å€¼å¯¹èŠ‚ç‚¹æ’å…¥ï¼Œæ–°èŠ‚ç‚¹æœ€ç»ˆä¼šæ¥åœ¨ tail å¼•ç”¨æŒ‡å‘çš„èŠ‚ç‚¹åé¢ï¼ˆæ„Ÿè§‰è¿™å¥è¯æœ‰é—®é¢˜ï¼Œåº”è¯¥æ˜¯headå¼•ç”¨æŒ‡å‘æ—§ç»“ç‚¹ä¸Šï¼‰ã€‚è€Œ tail å¼•ç”¨åˆ™ä¼šç§»åŠ¨åˆ°æ–°çš„èŠ‚ç‚¹ä¸Šï¼Œè¿™æ ·ä¸€ä¸ªåŒå‘é“¾è¡¨å°±å»ºç«‹èµ·æ¥äº†ã€‚ ä½œè€…ï¼šç”°å°æ³¢ é“¾æ¥ï¼šhttps://www.imooc.com/article/22931\nHashtableï¼š æ•°ç»„+é“¾è¡¨ç»„æˆçš„ï¼Œæ•°ç»„æ˜¯ Hashtable çš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„\nTreeMapï¼š çº¢é»‘æ ‘ï¼ˆè‡ªå¹³è¡¡çš„æ’åºäºŒå‰æ ‘ï¼‰\nå¦‚ä½•é€‰ç”¨é›†åˆ # å½“æˆ‘ä»¬åªéœ€è¦å­˜æ”¾å…ƒç´ å€¼æ—¶ï¼Œå°±é€‰æ‹©å®ç°Collection æ¥å£çš„é›†åˆï¼Œéœ€è¦ä¿è¯å…ƒç´ å”¯ä¸€æ—¶é€‰æ‹©å®ç° Set æ¥å£çš„é›†åˆæ¯”å¦‚ TreeSet æˆ– HashSetï¼Œä¸éœ€è¦å°±é€‰æ‹©å®ç° List æ¥å£çš„æ¯”å¦‚ ArrayList æˆ– LinkedListï¼Œç„¶åå†æ ¹æ®å®ç°è¿™äº›æ¥å£çš„é›†åˆçš„ç‰¹ç‚¹æ¥é€‰ç”¨ éœ€è¦æ ¹æ®é”®å€¼è·å–åˆ°å…ƒç´ å€¼æ—¶å°±é€‰ç”¨ Map æ¥å£ä¸‹çš„é›†åˆï¼Œéœ€è¦æ’åºæ—¶é€‰æ‹© TreeMap,ä¸éœ€è¦æ’åºæ—¶å°±é€‰æ‹© HashMap,éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨å°±é€‰ç”¨ ConcurrentHashMapã€‚ ä¸ºä»€ä¹ˆéœ€è¦é›†åˆ # å½“éœ€è¦ä¿å­˜ä¸€ç»„ç±»å‹ç›¸åŒçš„æ•°æ®æ—¶ï¼Œéœ€è¦å®¹å™¨æ¥ä¿å­˜ï¼Œå³æ•°ç»„ï¼Œä½†å®é™…ä¸­å­˜å‚¨çš„ç±»å‹å¤šæ ·ï¼Œ è€Œæ•°ç»„ä¸€æ—¦å£°æ˜åˆ™ä¸å¯å˜é•¿ï¼ŒåŒæ—¶æ•°ç»„æ•°æ®ç±»å‹ä¹Ÿç¡®å®šã€æ•°ç»„æœ‰åºå¯é‡å¤ é›†åˆå¯ä»¥å­˜å‚¨ä¸åŒç±»å‹ä¸åŒæ•°é‡çš„å¯¹è±¡ï¼Œè¿˜å¯ä»¥ä¿å­˜å…·æœ‰æ˜ å°„å…³ç³»çš„æ•°æ® Collection å­æ¥å£ # List # ArrayListå’ŒVectoråŒºåˆ«ï¼šArrayListæ˜¯Listä¸»è¦å®ç°ç±»ï¼Œåº•å±‚ä½¿ç”¨Object[]å­˜å‚¨çº¿ç¨‹ä¸å®‰å…¨ï¼›Vectoræ˜¯Listå¤è€å®ç°ç±»ï¼Œåº•å±‚ä½¿ç”¨Object[]å­˜å‚¨ï¼Œçº¿ç¨‹å®‰å…¨ ï¼ˆsynchronizedå…³é”®å­—ï¼‰\nArrayListä¸LinkedListï¼š\néƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨ ArrayListåº•å±‚ä½¿ç”¨Objectæ•°ç»„ï¼ŒLinkedListåº•å±‚ä½¿ç”¨åŒå‘é“¾è¡¨ç»“æ„ï¼ˆJDK7ä»¥åéå¾ªç¯é“¾è¡¨ï¼‰ ArrayListé‡‡ç”¨æ•°ç»„å­˜å‚¨ï¼Œæ‰€ä»¥æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦å—ä½ç½®å½±å“ï¼›LinkedListé‡‡ç”¨é“¾è¡¨ï¼Œæ‰€ä»¥åœ¨å¤´å°¾æ’å…¥æˆ–è€…åˆ é™¤å…ƒç´ ä¸å—å…ƒç´ ä½ç½®å½±å“ï¼Œè€Œå¦‚æœéœ€è¦æ’å…¥æˆ–è€…åˆ é™¤ä¸­é—´æŒ‡å®šä½ç½®ï¼Œåˆ™æ—¶é—´å¤æ‚åº¦ä¸ºO(n) [ä¸»è¦æ˜¯å› ä¸ºè¦éå†] LinkedListä¸æ”¯æŒé«˜æ•ˆçš„éšæœºå…ƒç´ è®¿é—®ï¼Œè€ŒArrayListæ”¯æŒï¼ˆå³é€šè¿‡å…ƒç´ çš„åºå·å¿«é€Ÿè·å–å…ƒç´ å¯¹è±¡ï¼‰ å†…å­˜ç©ºé—´å ç”¨ï¼šArrayListçš„ç©ºé—´æµªè´¹ä¸»è¦ä½“ç°åœ¨Listç»“å°¾ä¼šé¢„ç•™ä¸€å®šçš„å®¹é‡ç©ºé—´ï¼ˆä¸æ˜¯ç”³è¯·çš„æ‰€æœ‰å®¹é‡éƒ½ä¼šç”¨ä¸Šï¼‰ï¼Œè€ŒLinkedListçš„ç©ºé—´èŠ±è´¹åˆ™ä½“ç°åœ¨å®ƒçš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½éœ€è¦æ¶ˆè€—æ¯”ArrayListæ›´å¤šçš„ç©ºé—´ï¼ˆå­˜æ”¾ç›´æ¥åç»§ã€ç›´æ¥å‰é©±åŠæ•°æ®ï¼‰ å®é™…é¡¹ç›®ä¸­ä¸æ€ä¹ˆä½¿ç”¨LinkedListï¼Œå› ä¸ºArrayListæ€§èƒ½é€šå¸¸ä¼šæ›´å¥½ï¼ŒLinkedListä»…ä»…åœ¨å¤´å°¾æ’å…¥æˆ–è€…åˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦è¿‘ä¼¼O(1)\nåŒå‘é“¾è¡¨ä¸åŒå‘å¾ªç¯é“¾è¡¨\nåŒå‘é“¾è¡¨ï¼ŒåŒ…å«ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ª prev æŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ª next æŒ‡å‘åä¸€ä¸ªèŠ‚ç‚¹ã€‚ åŒå‘å¾ªç¯é“¾è¡¨ï¼Œé¦–å°¾ç›¸è¿ï¼ˆå¤´èŠ‚ç‚¹çš„å‰é©±=å°¾ç»“ç‚¹ï¼Œå°¾ç»“ç‚¹çš„åç»§=å¤´èŠ‚ç‚¹ï¼‰ è¡¥å……ï¼šRandomAccessæ¥å£ï¼Œè¿™ä¸ªæ¥å£åªæ˜¯ç”¨æ¥æ ‡è¯†ï¼šå®ç°è¿™ä¸ªæ¥å£çš„ç±»ï¼Œå…·æœ‰éšæœºè®¿é—®åŠŸèƒ½ï¼Œä½†å¹¶ä¸æ˜¯è¯´å› ä¸ºå®ç°äº†è¯¥æ¥å£æ‰å…·æœ‰çš„å¿«é€Ÿéšæœºè®¿é—®æœºåˆ¶\nCollectionsé‡Œé¢æœ‰è¿™æ ·ä¸€æ®µä»£ç \nåœ¨ binarySearchï¼ˆ) æ–¹æ³•ä¸­ï¼Œå®ƒè¦åˆ¤æ–­ä¼ å…¥çš„ list æ˜¯å¦ RandomAccess çš„å®ä¾‹ï¼Œå¦‚æœæ˜¯ï¼Œè°ƒç”¨indexedBinarySearch()æ–¹æ³•ï¼Œå¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆè°ƒç”¨iteratorBinarySearch()æ–¹æ³•\npublic static \u0026lt;T\u0026gt; int binarySearch(List\u0026lt;? extends Comparable\u0026lt;? super T\u0026gt;\u0026gt; list, T key) { if (list instanceof RandomAccess || list.size()\u0026lt;BINARYSEARCH_THRESHOLD) return Collections.indexedBinarySearch(list, key); else return Collections.iteratorBinarySearch(list, key); } ArrayListå®ç°äº†RandomAccessæ–¹æ³•ï¼Œè€ŒLinkedListæ²¡æœ‰ã€‚æ˜¯ç”±äºArrayListåº•å±‚æ˜¯æ•°ç»„ï¼Œæ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œè€ŒLinkedListåº•å±‚æ˜¯é“¾è¡¨ï¼Œä¸æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)\nSet # Coparableå’ŒComparatorçš„åŒºåˆ«\nComparableå®é™…å‡ºè‡ªjava.langåŒ…ï¼Œæœ‰ä¸€ä¸ªcompareTo(Object obj)æ–¹æ³•ç”¨æ¥æ’åº Comparatorå®é™…å‡ºè‡ªjava.utilåŒ…ï¼Œæœ‰ä¸€ä¸ªcompare(Object obj1,Object obj2)æ–¹æ³•ç”¨æ¥æ’åº Collections.sort(List\u0026lt;T\u0026gt; list, Comparator\u0026lt;? super T\u0026gt; c)é»˜è®¤æ˜¯æ­£åºï¼ŒTå¿…é¡»å®ç°äº†Comparableï¼Œä¸”Arrays.sort()æ–¹æ³•ä¸­çš„éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š\n//ä½¿ç”¨æ’å…¥æ’åº if (length \u0026lt; INSERTIONSORT_THRESHOLD) { for (int i=low; i\u0026lt;high; i++) for (int j=i; j\u0026gt;low \u0026amp;\u0026amp; c.compare(dest[j-1], dest[j])\u0026gt;0; j--) //å¦‚æœå‰ä¸€ä¸ªæ•°è·Ÿåé¢çš„æ•°ç›¸æ¯”å¤§äºé›¶ï¼Œåˆ™è¿›è¡Œäº¤æ¢ï¼Œå³å¤§çš„æ’åé¢ swap(dest, j, j-1); return; } //å½“æ¯”è¾ƒç»“æœ\u0026gt;0æ—¶ï¼Œè°ƒæ¢æ•°ç»„å‰åä¸¤ä¸ªå…ƒç´ çš„å€¼ï¼Œä¹Ÿå°±æ˜¯åé¢çš„ä¸€å®šè¦æ¯”å‰é¢çš„å¤§ï¼Œå³ public int compareTo(Person o) { if (this.age \u0026gt; o.getAge()) { return 1; } if (this.age \u0026lt; o.getAge()) { return -1; } return 0; } //ä¸‹é¢è¿™æ®µä»£ç ï¼ŒæŒ‰ç…§å¹´é¾„é™åºï¼ˆé»˜è®¤æ˜¯å‡åºï¼‰ Collections.sort(arrayList, new Comparator\u0026lt;Integer\u0026gt;() { @Override public int compare(Integer o1, Integer o2) { //å¦‚æœç»“æœå¤§äº0ï¼Œåˆ™ä¸¤ä¸ªæ•°å¯¹è°ƒ //å¦‚æœè¿”å›o2.compareTo(o1)ï¼Œå°±æ˜¯å½“o2\u0026gt;01æ—¶ï¼Œä¸¤ä¸ªç»“æœå¯¹æ¢ï¼Œä¹Ÿå°±æ˜¯é™åº //å¦‚æœè¿”å›o1.compareTo(o2)ï¼Œå°±æ˜¯å½“o1\u0026gt;o2æ—¶ï¼Œä¸¤ä¸ªç»“æœå¯¹æ¢ï¼Œä¹Ÿå°±æ˜¯å‡åº ä¹Ÿå°±æ˜¯å½“å’Œå‚æ•°é¡ºåºä¸€è‡´æ—¶ï¼Œæ˜¯å‡åºï¼›åä¹‹ï¼Œåˆ™æ˜¯é™åº return o2.compareTo(o1); } }); //ä¸Šé¢è¿™æ®µä»£ç ï¼Œæ ‡è¯† æ— åºæ€§å’Œä¸å¯é‡å¤æ€§\næ— åºæ€§ï¼ŒæŒ‡å­˜å‚¨çš„æ•°æ®ï¼Œåœ¨åº•å±‚æ•°æ®ç»“æ„ä¸­ï¼Œå¹¶éæŒ‰ç…§æ•°ç»„ç´¢å¼•çš„é¡ºåºæ·»åŠ ï¼ˆè€Œæ˜¯æ ¹æ®æ•°æ®çš„å“ˆå¸Œå€¼å†³å®šï¼‰ ä¸å¯é‡å¤æ€§ï¼šæŒ‡æ·»åŠ çš„å…ƒç´ æŒ‰ç…§equals()åˆ¤æ–­æ—¶ï¼Œè¿”å›falseã€‚éœ€åŒæ—¶é‡å†™equals()æ–¹æ³•å’ŒhashCode() æ–¹æ³• æ¯”è¾ƒHashSetã€LinkedHashSetå’ŒTreeSetä¸‰è€…å¼‚åŒ\néƒ½æ˜¯Setå®ç°ç±»ï¼Œä¿è¯å…ƒç´ å”¯ä¸€ï¼Œä¸”éçº¿ç¨‹å®‰å…¨ ä¸‰è€…åº•å±‚æ•°æ®ç»“æ„ä¸åŒï¼ŒHashSetåº•å±‚ä¸ºå“ˆå¸Œè¡¨ï¼ˆHashMapï¼‰; LinkedHashSetåº•å±‚ä¸ºé“¾è¡¨+å“ˆå¸Œè¡¨ ï¼Œå…ƒç´ çš„æ’å…¥å’Œå–å‡ºé¡ºåºæ»¡è¶³FIFOã€‚TreeSetåº•å±‚ä¸ºçº¢é»‘æ ‘ï¼Œå…ƒç´ æœ‰åºï¼Œæ’åºæ–¹å¼æœ‰è‡ªç„¶æ’åºå’Œå®šåˆ¶æ’åº Queue # Queueå’ŒDequeçš„åŒºåˆ« # Queue Queueä¸ºå•ç«¯é˜Ÿåˆ—ï¼Œåªèƒ½ä»ä¸€ç«¯æ’å…¥å…ƒç´ ï¼Œå¦ä¸€ç«¯åˆ é™¤å…ƒç´ ï¼Œå®ç°ä¸Šä¸€èˆ¬éµå¾ªå…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰è§„åˆ™ã€Dequeueä¸ºåŒç«¯é˜Ÿåˆ—ï¼Œåœ¨é˜Ÿåˆ—ä¸¤ç«¯å‡å¯æ’å…¥æˆ–åˆ é™¤å…ƒç´ ã€‘ Queueæ‰©å±•äº†Collectionæ¥å£ï¼Œæ ¹æ®å› å®¹é‡é—®é¢˜è€Œå¯¼è‡´æ“ä½œå¤±è´¥åçš„å¤„ç†æ–¹å¼ä¸åŒåˆ†ä¸¤ç±»ï¼Œæ“ä½œå¤±è´¥åæŠ›å¼‚å¸¸æˆ–è¿”å›ç‰¹æ®Šå€¼ Dequeueï¼ŒåŒç«¯é˜Ÿåˆ—ï¼Œåœ¨é˜Ÿåˆ—ä¸¤ç«¯å‡å¯æ’å…¥æˆ–åˆ é™¤å…ƒç´ ï¼Œä¹Ÿä¼šæ ¹æ®å¤±è´¥åå¤„ç†æ–¹å¼åˆ†ä¸¤ç±» Dequeè¿˜æœ‰push()å’Œpop()ç­‰å…¶ä»–æ–¹æ³•ï¼Œå¯ç”¨äºæ¨¡æ‹Ÿæ ˆ ArrayDequeä¸LinkedListåŒºåˆ« # ArrayDequeå’ŒLinkedListéƒ½å®ç°äº†Dequeæ¥å£ï¼Œä¸¤è€…éƒ½å…·æœ‰é˜Ÿåˆ—åŠŸèƒ½ ArrayDequeåŸºäºå¯å˜é•¿çš„æ•°ç»„å’ŒåŒæŒ‡é’ˆæ¥å®ç°ï¼Œè€ŒLinkedListåˆ™é€šè¿‡é“¾è¡¨æ¥å®ç° ArrayDequeä¸æ”¯æŒå­˜å‚¨NULLæ•°æ®ï¼Œä½†LinkedListæ”¯æŒ ArrayDequeæ˜¯åé¢ï¼ˆJDK1.6)å¼•å…¥çš„ï¼Œè€ŒLinkedListåœ¨JDK1.2å°±å­˜åœ¨ ArrayDeque æ’å…¥æ—¶å¯èƒ½å­˜åœ¨æ‰©å®¹è¿‡ç¨‹, ä¸è¿‡å‡æ‘Šåçš„æ’å…¥æ“ä½œä¾ç„¶ä¸º O(1)ã€‚è™½ç„¶ LinkedList ä¸éœ€è¦æ‰©å®¹ï¼Œä½†æ˜¯æ¯æ¬¡æ’å…¥æ•°æ®æ—¶å‡éœ€è¦ç”³è¯·æ–°çš„å †ç©ºé—´ï¼Œå‡æ‘Šæ€§èƒ½ç›¸æ¯”æ›´æ…¢ã€‚ æ€»çš„æ¥è¯´ï¼ŒArrayDequeæ¥å®ç°é˜Ÿåˆ—è¦æ¯”LinkedListæ›´å¥½ï¼Œæ­¤å¤–ï¼ŒArrayDequeä¹Ÿå¯ä»¥ç”¨äºå®ç°æ ˆ\nè¯´ä¸€è¯´PriorityQueue # PriorityQueue æ˜¯åœ¨ JDK1.5 ä¸­è¢«å¼•å…¥çš„, å…¶ä¸ Queue çš„åŒºåˆ«åœ¨äºå…ƒç´ å‡ºé˜Ÿé¡ºåºæ˜¯ä¸ä¼˜å…ˆçº§ç›¸å…³çš„ï¼Œå³æ€»æ˜¯ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ å…ˆå‡ºé˜Ÿã€‚\nè¿™é‡Œåˆ—ä¸¾å…¶ç›¸å…³çš„ä¸€äº›è¦ç‚¹ï¼š\nPriorityQueue åˆ©ç”¨äº†äºŒå‰å †çš„æ•°æ®ç»“æ„æ¥å®ç°çš„ï¼Œåº•å±‚ä½¿ç”¨å¯å˜é•¿çš„æ•°ç»„æ¥å­˜å‚¨æ•°æ® PriorityQueue é€šè¿‡å †å…ƒç´ çš„ä¸Šæµ®å’Œä¸‹æ²‰ï¼Œå®ç°äº†åœ¨ O(logn) çš„æ—¶é—´å¤æ‚åº¦å†…æ’å…¥å…ƒç´ å’Œåˆ é™¤å †é¡¶å…ƒç´ ã€‚ PriorityQueue æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œä¸”ä¸æ”¯æŒå­˜å‚¨ NULL å’Œ non-comparable çš„å¯¹è±¡ã€‚ PriorityQueue é»˜è®¤æ˜¯å°é¡¶å †ï¼Œä½†å¯ä»¥æ¥æ”¶ä¸€ä¸ª Comparator ä½œä¸ºæ„é€ å‚æ•°ï¼Œä»è€Œæ¥è‡ªå®šä¹‰å…ƒç´ ä¼˜å…ˆçº§çš„å…ˆåã€‚ "},{"id":153,"href":"/zh/docs/study/Review/java_guide/java/Basic/ly0011lysyntactic_sugar/","title":"è¯­æ³•ç³–","section":"åŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nç®€ä»‹ # è¯­æ³•ç³–ï¼ˆSyntactic Sugarï¼‰ä¹Ÿç§°ç³–è¡£è¯­æ³•ï¼ŒæŒ‡çš„æ˜¯åœ¨è®¡ç®—æœºè¯­è¨€ä¸­æ·»åŠ çš„æŸç§è¯­æ³•ï¼Œè¿™ç§è¯­æ³•å¯¹è¯­è¨€çš„åŠŸèƒ½å¹¶æ²¡æœ‰å½±å“ï¼Œä½†æ˜¯æ›´æ–¹ä¾¿ç¨‹åºå‘˜ä½¿ç”¨ï¼Œç®€è€Œè¨€ä¹‹ï¼Œè®©ç¨‹åºæ›´åŠ ç®€æ´ï¼Œæœ‰æ›´é«˜çš„å¯è¯»æ€§\nJavaä¸­æœ‰å“ªäº›è¯­æ³•ç³– # Javaè™šæ‹Ÿæœºå¹¶ä¸æ”¯æŒè¿™äº›è¯­æ³•ç³–ï¼Œè¿™äº›è¯­æ³•ç³–åœ¨ç¼–è¯‘é˜¶æ®µå°±ä¼šè¢«è¿˜åŸæˆç®€å•çš„åŸºç¡€è¯­æ³•ç»“æ„ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯è§£è¯­æ³•ç³–\njavacå‘½ä»¤å¯ä»¥å°†åç¼€ä¸º.javaçš„æºæ–‡ä»¶ç¼–è¯‘ä¸ºåç¼€åä¸º.classçš„å¯ä»¥è¿è¡ŒäºJavaè™šæ‹Ÿæœºçš„å­—èŠ‚ç ã€‚å…¶ä¸­ï¼Œcom.sun.tools.javac.main.JavaCompilerçš„æºç ä¸­ï¼Œcompile()ä¸­æœ‰ä¸€ä¸ªæ­¥éª¤å°±æ˜¯è°ƒç”¨desugar()ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯è´Ÿè´£è§£è¯­æ³•ç³–çš„å®ç°çš„ Javaä¸­çš„è¯­æ³•ç³–ï¼ŒåŒ…æ‹¬ æ³›å‹ã€å˜é•¿å‚æ•°ã€æ¡ä»¶ç¼–è¯‘ã€è‡ªåŠ¨æ‹†è£…ç®±ã€å†…éƒ¨ç±»ç­‰ switchæ”¯æŒStringä¸æšä¸¾ # switchæœ¬èº«åŸæœ¬åªæ”¯æŒåŸºæœ¬ç±»å‹ï¼Œå¦‚intã€char\nintæ˜¯æ¯”è¾ƒæ•°å€¼ï¼Œè€Œcharåˆ™æ˜¯æ¯”è¾ƒå…¶asciiç ï¼Œæ‰€ä»¥å…¶å®å¯¹äºç¼–è¯‘å™¨æ¥è¯´ï¼Œéƒ½æ˜¯intç±»å‹(æ•´å‹)ï¼Œæ¯”å¦‚byteã€‚shortï¼Œchar(ackii ç æ˜¯æ•´å‹)ä»¥åŠintã€‚ è€Œå¯¹äºenumç±»å‹ï¼Œ\nå¯¹äºswitchä¸­ä½¿ç”¨Stringï¼Œåˆ™ï¼š\npublic class switchDemoString { public static void main(String[] args) { String str = \u0026#34;world\u0026#34;; switch (str) { case \u0026#34;hello\u0026#34;: System.out.println(\u0026#34;hello\u0026#34;); break; case \u0026#34;world\u0026#34;: System.out.println(\u0026#34;world\u0026#34;); break; default: break; } } } //åç¼–è¯‘ä¹‹å public class switchDemoString { public switchDemoString() { } public static void main(String args[]) { String str = \u0026#34;world\u0026#34;; String s; switch((s = str).hashCode()) { default: break; case 99162322: if(s.equals(\u0026#34;hello\u0026#34;)) System.out.println(\u0026#34;hello\u0026#34;); break; case 113318802: if(s.equals(\u0026#34;world\u0026#34;)) System.out.println(\u0026#34;world\u0026#34;); break; } } } å³switchåˆ¤æ–­æ˜¯é€šè¿‡**equals()å’ŒhashCode()**æ–¹æ³•æ¥å®ç°çš„\nequals()æ£€æŸ¥æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºæœ‰å¯èƒ½å‘ç”Ÿç¢°æ’ï¼Œæ‰€ä»¥æ€§èƒ½æ²¡æœ‰ç›´æ¥ä½¿ç”¨æšä¸¾è¿›è¡Œswitchæˆ–çº¯æ•´æ•°å¸¸é‡æ€§èƒ½é«˜\næ³›å‹ # ç¼–è¯‘å™¨å¤„ç†æ³›å‹æœ‰ä¸¤ç§æ–¹å¼ï¼šCode specializationå’ŒCode sharingã€‚C++å’Œ C#æ˜¯ä½¿ç”¨Code specializationçš„å¤„ç†æœºåˆ¶ï¼Œè€Œ Java ä½¿ç”¨çš„æ˜¯Code sharingçš„æœºåˆ¶\nCode sharing æ–¹å¼ä¸ºæ¯ä¸ªæ³›å‹ç±»å‹åˆ›å»ºå”¯ä¸€çš„å­—èŠ‚ç è¡¨ç¤ºï¼Œå¹¶ä¸”å°†è¯¥æ³›å‹ç±»å‹çš„å®ä¾‹éƒ½æ˜ å°„åˆ°è¿™ä¸ªå”¯ä¸€çš„å­—èŠ‚ç è¡¨ç¤ºä¸Šã€‚å°†å¤šç§æ³›å‹ç±»å½¢å®ä¾‹æ˜ å°„åˆ°å”¯ä¸€çš„å­—èŠ‚ç è¡¨ç¤ºæ˜¯é€šè¿‡**ç±»å‹æ“¦é™¤ï¼ˆtype erasueï¼‰**å®ç°çš„ã€‚\nå¯¹äº Java è™šæ‹Ÿæœºæ¥è¯´ï¼Œä»–æ ¹æœ¬ä¸è®¤è¯†Map\u0026lt;String, String\u0026gt; map è¿™æ ·çš„è¯­æ³•ã€‚éœ€è¦åœ¨ç¼–è¯‘é˜¶æ®µé€šè¿‡ç±»å‹æ“¦é™¤çš„æ–¹å¼è¿›è¡Œè§£è¯­æ³•ç³– ç±»å‹æ“¦é™¤çš„ä¸»è¦è¿‡ç¨‹å¦‚ä¸‹ï¼š 1.å°†æ‰€æœ‰çš„æ³›å‹å‚æ•°ç”¨å…¶æœ€å·¦è¾¹ç•Œï¼ˆæœ€é¡¶çº§çš„çˆ¶ç±»å‹ï¼‰ç±»å‹æ›¿æ¢ã€‚ 2.ç§»é™¤æ‰€æœ‰çš„ç±»å‹å‚æ•°ã€‚ ä¸¤ä¸ªä¾‹å­\nMapæ“¦é™¤\nMap\u0026lt;String, String\u0026gt; map = new HashMap\u0026lt;String, String\u0026gt;(); map.put(\u0026#34;name\u0026#34;, \u0026#34;hollis\u0026#34;); map.put(\u0026#34;wechat\u0026#34;, \u0026#34;Hollis\u0026#34;); map.put(\u0026#34;blog\u0026#34;, \u0026#34;www.hollischuang.com\u0026#34;); //è§£è¯­æ³•ç³–ä¹‹å Map map = new HashMap(); map.put(\u0026#34;name\u0026#34;, \u0026#34;hollis\u0026#34;); map.put(\u0026#34;wechat\u0026#34;, \u0026#34;Hollis\u0026#34;); map.put(\u0026#34;blog\u0026#34;, \u0026#34;www.hollischuang.com\u0026#34;); å…¶ä»–æ“¦é™¤\npublic static \u0026lt;A extends Comparable\u0026lt;A\u0026gt;\u0026gt; A max(Collection\u0026lt;A\u0026gt; xs) { Iterator\u0026lt;A\u0026gt; xi = xs.iterator(); A w = xi.next(); while (xi.hasNext()) { A x = xi.next(); if (w.compareTo(x) \u0026lt; 0) w = x; } return w; } //æ“¦é™¤åå˜æˆ public static Comparable max(Collection xs){ Iterator xi = xs.iterator(); Comparable w = (Comparable)xi.next(); while(xi.hasNext()) { Comparable x = (Comparable)xi.next(); if(w.compareTo(x) \u0026lt; 0) w = x; } return w; } å°ç»“\nè™šæ‹Ÿæœºä¸­å¹¶ä¸å­˜åœ¨æ³›å‹ï¼Œæ³›å‹ç±»æ²¡æœ‰è‡ªå·±ç‹¬æœ‰çš„Classç±»å¯¹è±¡ï¼Œå³ä¸å­˜åœ¨List\u0026lt;String\u0026gt;.class æˆ–æ˜¯ List\u0026lt;Integer\u0026gt;.class ï¼Œè€Œåªæœ‰List.class è™šæ‹Ÿæœºä¸­ï¼Œåªæœ‰æ™®é€šç±»å’Œæ™®é€šæ–¹æ³•ï¼Œæ‰€æœ‰æ³›å‹ç±»çš„ç±»å‹å‚æ•°ï¼Œåœ¨ç¼–è¯‘æ—¶éƒ½ä¼šè¢«æ“¦é™¤ è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®± # è£…ç®±è¿‡ç¨‹ï¼Œé€šè¿‡è°ƒç”¨åŒ…è£…å™¨çš„valueOfæ–¹æ³•å®ç°çš„ï¼Œè€Œæ‹†ç®±è¿‡ç¨‹ï¼Œåˆ™æ˜¯é€šè¿‡è°ƒç”¨åŒ…è£…å™¨çš„xxxValueæ–¹æ³•å®ç°çš„\nè‡ªåŠ¨è£…ç®±\npublic static void main(String[] args) { int i = 10; Integer n = i; } //åç¼–è¯‘åçš„ä»£ç  public static void main(String args[]) { int i = 10; Integer n = Integer.valueOf(i); } è‡ªåŠ¨æ‹†ç®±\npublic static void main(String[] args) { Integer i = 10; int n = i; } //åç¼–è¯‘åçš„ä»£ç  public static void main(String args[]) { Integer i = Integer.valueOf(10); int n = i.intValue(); //æ³¨æ„ï¼Œæ˜¯intValueï¼Œä¸æ˜¯initValue } å¯å˜é•¿å‚æ•° # variable argumentsï¼Œæ˜¯åœ¨Java 1.5ä¸­å¼•å…¥çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…è®¸ä¸€ä¸ªæ–¹æ³•æŠŠä»»æ„æ•°é‡çš„å€¼ä½œä¸ºå‚æ•°ï¼Œä»£ç ï¼š\npublic static void main(String[] args) { print(\u0026#34;Holis\u0026#34;, \u0026#34;å…¬ä¼—å·:Hollis\u0026#34;, \u0026#34;åšå®¢ï¼šwww.hollischuang.com\u0026#34;, \u0026#34;QQï¼š907607222\u0026#34;); } public static void print(String... strs) { for (int i = 0; i \u0026lt; strs.length; i++) { System.out.println(strs[i]); } } //åç¼–è¯‘åä»£ç  public static void main(String args[]) { print(new String[] { \u0026#34;Holis\u0026#34;, \u0026#34;\\u516C\\u4F17\\u53F7:Hollis\u0026#34;, \u0026#34;\\u535A\\u5BA2\\uFF1Awww.hollischuang.com\u0026#34;, \u0026#34;QQ\\uFF1A907607222\u0026#34; }); } public static transient void print(String strs[]) { for(int i = 0; i \u0026lt; strs.length; i++) System.out.println(strs[i]); } å¦‚ä¸Šï¼Œå¯å˜å‚æ•°åœ¨è¢«ä½¿ç”¨çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„é•¿åº¦ï¼Œå°±æ˜¯è°ƒç”¨è¯¥æ–¹æ³•çš„ä¼ é€’çš„å®å‚çš„ä¸ªæ•°ï¼Œç„¶åå†æŠŠå‚æ•°å€¼å…¨éƒ¨æ”¾åˆ°è¿™ä¸ªæ•°ç»„å½“ä¸­ï¼Œæœ€åæŠŠè¿™ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ä¼ é€’åˆ°è¢«è°ƒç”¨çš„æ–¹æ³•ä¸­\næšä¸¾ # å…³é”®å­—enumå¯ä»¥å°†ä¸€ç»„å…·åçš„å€¼çš„æœ‰é™é›†åˆåˆ›å»ºä¸ºä¸€ç§æ–°çš„ç±»å‹ï¼Œè€Œè¿™äº›å…·åçš„å€¼å¯ä»¥ä½œä¸ºå¸¸è§„çš„ç¨‹åºç»„ä»¶ä½¿ç”¨ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸æœ‰ç”¨çš„åŠŸèƒ½\nå†™ä¸€ä¸ªenumç±»è¿›è¡Œæµ‹è¯•\npublic enum T { SPRING,SUMMER; } //åç¼–è¯‘ä¹‹å // Decompiled by Jad v1.5.8g. Copyright 2001 Pavel Kouznetsov. // Jad home page: http://www.kpdus.com/jad.html // Decompiler options: packimports(3) // Source File Name: T.java package com.ly.review.base; public final class T extends Enum { /** ä¸‹é¢è¿™ä¸ªå’Œåšå®¢ä¸å¤ªä¸€æ ·,åšå®¢é‡Œé¢æ˜¯è¿™æ ·çš„ // ENUM$VALUESæ˜¯åšå®¢ç¼–è¯‘åçš„æ•°ç»„å public static T[] values() { T at[]; int i; T at1[]; System.arraycopy(at = ENUM$VALUES, 0, at1 = new T[i = at.length], 0, i); return at1; } */ public static T[] values() { return (T[])$VALUES.clone(); } public static T valueOf(String s) { return (T)Enum.valueOf(com/ly/review/base/T, s); } private T(String s, int i) { super(s, i); } public static final T Spring; public static final T SUMMER; private static final T $VALUES[]; static { Spring = new T(\u0026#34;Spring\u0026#34;, 0); SUMMER = new T(\u0026#34;SUMMER\u0026#34;, 1); $VALUES = (new T[] { Spring, SUMMER }); } } é‡è¦ä»£ç ï¼š\npublic final class T extends Enum è¯´æ˜è¯¥ç±»ä¸å¯ç»§æ‰¿\npublic static final T Spring; public static final T SUMMER; è¯´æ˜æšä¸¾ç±»å‹ä¸å¯ä¿®æ”¹\nå†…éƒ¨ç±» # å†…éƒ¨ç±»åˆç§°ä¸ºåµŒå¥—ç±»ï¼Œå¯ä»¥æŠŠå†…éƒ¨ç±»ç†è§£æˆå¤–éƒ¨ç±»çš„ä¸€ä¸ªæ™®é€šæˆå‘˜ å†…éƒ¨ç±»ä¹‹æ‰€ä»¥ä¹Ÿæ˜¯è¯­æ³•ç³–ï¼Œæ˜¯å› ä¸ºå®ƒä»…ä»…æ˜¯ä¸€ä¸ªç¼–è¯‘æ—¶çš„æ¦‚å¿µï¼Œouter.javaé‡Œé¢å®šä¹‰äº†ä¸€ä¸ªå†…éƒ¨ç±»innerï¼Œä¸€æ—¦ç¼–è¯‘æˆåŠŸï¼Œå°±ä¼šç”Ÿæˆä¸¤ä¸ªå®Œå…¨ä¸åŒçš„.classæ–‡ä»¶äº†ï¼Œåˆ†åˆ«æ˜¯outer.classå’Œouter$inner.classã€‚æ‰€ä»¥å†…éƒ¨ç±»çš„åå­—å®Œå…¨å¯ä»¥å’Œå®ƒçš„å¤–éƒ¨ç±»åå­—ç›¸åŒã€‚\nä»£ç å¦‚ä¸‹ï¼š\npublic class OutterClass { private String userName; public String getUserName() { return userName; } public void setUserName(String userName) { this.userName = userName; } public static void main(String[] args) { } class InnerClass{ private String name; public String getName() { return name; } public void setName(String name) { this.name = name; } } } ç¼–è¯‘ä¹‹åï¼Œä¼šç”Ÿæˆä¸¤ä¸ªclassæ–‡ä»¶OutterClass.classå’ŒOutterClass$InnerClass.classã€‚æ‰€ä»¥å†…éƒ¨ç±»æ˜¯å¯ä»¥è·Ÿå¤–éƒ¨ç±»å®Œå…¨ä¸€æ ·çš„åå­—çš„ å¦‚æœè¦å¯¹OutterClass.classè¿›è¡Œåç¼–è¯‘ï¼Œé‚£ä¹ˆä»–ä¼šæŠŠOutterClass$InnerClass.classä¹Ÿä¸€èµ·è¿›è¡Œåç¼–è¯‘\npublic class OutterClass { class InnerClass { public String getName() { return name; } public void setName(String name) { this.name = name; } private String name; final OutterClass this$0; InnerClass() { this.this$0 = OutterClass.this; super(); } } public OutterClass() { } public String getUserName() { return userName; } public void setUserName(String userName){ this.userName = userName; } public static void main(String args1[]) { } private String userName; } æ¡ä»¶ç¼–è¯‘ # â€”èˆ¬æƒ…å†µä¸‹ï¼Œç¨‹åºä¸­çš„æ¯ä¸€è¡Œä»£ç éƒ½è¦å‚åŠ ç¼–è¯‘ã€‚ä½†æœ‰æ—¶å€™å‡ºäºå¯¹ç¨‹åºä»£ç ä¼˜åŒ–çš„è€ƒè™‘ï¼Œå¸Œæœ›åªå¯¹å…¶ä¸­ä¸€éƒ¨åˆ†å†…å®¹è¿›è¡Œç¼–è¯‘ï¼Œæ­¤æ—¶å°±éœ€è¦åœ¨ç¨‹åºä¸­åŠ ä¸Šæ¡ä»¶ï¼Œè®©ç¼–è¯‘å™¨åªå¯¹æ»¡è¶³æ¡ä»¶çš„ä»£ç è¿›è¡Œç¼–è¯‘ï¼Œå°†ä¸æ»¡è¶³æ¡ä»¶çš„ä»£ç èˆå¼ƒï¼Œè¿™å°±æ˜¯æ¡ä»¶ç¼–è¯‘ã€‚\npublic class ConditionalCompilation { public static void main(String[] args) { final boolean DEBUG = true; if(DEBUG) { System.out.println(\u0026#34;Hello, DEBUG!\u0026#34;); } final boolean ONLINE = false; if(ONLINE){ System.out.println(\u0026#34;Hello, ONLINE!\u0026#34;); } } } //åç¼–è¯‘ä¹‹åå¦‚ä¸‹ public class ConditionalCompilation { public ConditionalCompilation() { } public static void main(String args[]) { boolean DEBUG = true; System.out.println(\u0026#34;Hello, DEBUG!\u0026#34;); boolean ONLINE = false; } } Java è¯­æ³•çš„æ¡ä»¶ç¼–è¯‘ï¼Œæ˜¯é€šè¿‡åˆ¤æ–­æ¡ä»¶ä¸ºå¸¸é‡çš„ if è¯­å¥å®ç°çš„ã€‚å…¶åŸç†ä¹Ÿæ˜¯ Java è¯­è¨€çš„è¯­æ³•ç³–ã€‚æ ¹æ® if åˆ¤æ–­æ¡ä»¶çš„çœŸå‡ï¼Œç¼–è¯‘å™¨ç›´æ¥æŠŠåˆ†æ”¯ä¸º false çš„ä»£ç å—æ¶ˆé™¤ã€‚é€šè¿‡è¯¥æ–¹å¼å®ç°çš„æ¡ä»¶ç¼–è¯‘ï¼Œå¿…é¡»åœ¨æ–¹æ³•ä½“å†…å®ç°ï¼Œè€Œæ— æ³•åœ¨æ­£æ•´ä¸ª Java ç±»çš„ç»“æ„æˆ–è€…ç±»çš„å±æ€§ä¸Šè¿›è¡Œæ¡ä»¶ç¼–è¯‘\næ–­è¨€ # Java åœ¨æ‰§è¡Œçš„æ—¶å€™é»˜è®¤æ˜¯ä¸å¯åŠ¨æ–­è¨€æ£€æŸ¥çš„ï¼ˆè¿™ä¸ªæ—¶å€™ï¼Œæ‰€æœ‰çš„æ–­è¨€è¯­å¥éƒ½å°†å¿½ç•¥ï¼ï¼‰ï¼Œå¦‚æœè¦å¼€å¯æ–­è¨€æ£€æŸ¥ï¼Œåˆ™éœ€è¦ç”¨å¼€å…³-enableassertionsæˆ–-eaæ¥å¼€å¯\nä»£ç å¦‚ä¸‹ï¼š\npublic class AssertTest { public static void main(String args[]) { int a = 1; int b = 1; assert a == b; System.out.println(\u0026#34;å…¬ä¼—å·ï¼šHollis\u0026#34;); assert a != b : \u0026#34;Hollis\u0026#34;; System.out.println(\u0026#34;åšå®¢ï¼šwww.hollischuang.com\u0026#34;); } } //åç¼–è¯‘ä¹‹åä»£ç å¦‚ä¸‹ public class AssertTest { public AssertTest() { } public static void main(String args[]) { int a = 1; int b = 1; if(!$assertionsDisabled \u0026amp;\u0026amp; a != b) throw new AssertionError(); System.out.println(\u0026#34;\\u516C\\u4F17\\u53F7\\uFF1AHollis\u0026#34;); if(!$assertionsDisabled \u0026amp;\u0026amp; a == b) { throw new AssertionError(\u0026#34;Hollis\u0026#34;); } else { System.out.println(\u0026#34;\\u535A\\u5BA2\\uFF1Awww.hollischuang.com\u0026#34;); return; } } static final boolean $assertionsDisabled = !com/hollis/suguar/AssertTest.desiredAssertionStatus(); } æ–­è¨€çš„åº•å±‚æ˜¯ifè¯­è¨€ï¼Œå¦‚æœæ–­è¨€ä¸ºtrueï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åšï¼›å¦‚æœæ–­è¨€ä¸ºfalseï¼Œåˆ™ç¨‹åºæŠ›å‡ºAssertErroræ¥æ‰“æ–­ç¨‹åºæ‰§è¡Œ -enableassertionsä¼šè®¾ç½®$assertionsDisabledå­—æ®µçš„å€¼ æ•°å€¼å­—é¢é‡ # java7ä¸­ï¼Œå­—é¢é‡å…è®¸åœ¨æ•°å­—ä¹‹é—´æ’å…¥ä»»æ„å¤šä¸ªä¸‹åˆ’çº¿ï¼Œä¸ä¼šå¯¹å­—é¢å€¼äº§ç”Ÿå½±å“ï¼Œå¯ä»¥æ–¹ä¾¿é˜…è¯»\næºä»£ç ï¼š\npublic class Test { public static void main(String... args) { int i = 10_000; System.out.println(i); } } //åç¼–è¯‘å public class Test { public static void main(String[] args) { int i = 10000; System.out.println(i); } } for-each # æºä»£ç ï¼š\npublic static void main(String... args) { String[] strs = {\u0026#34;Hollis\u0026#34;, \u0026#34;å…¬ä¼—å·ï¼šHollis\u0026#34;, \u0026#34;åšå®¢ï¼šwww.hollischuang.com\u0026#34;}; for (String s : strs) { System.out.println(s); } List\u0026lt;String\u0026gt; strList = ImmutableList.of(\u0026#34;Hollis\u0026#34;, \u0026#34;å…¬ä¼—å·ï¼šHollis\u0026#34;, \u0026#34;åšå®¢ï¼šwww.hollischuang.com\u0026#34;); for (String s : strList) { System.out.println(s); } } //åç¼–è¯‘ä¹‹å public static transient void main(String args[]) { String strs[] = { \u0026#34;Hollis\u0026#34;, \u0026#34;\\u516C\\u4F17\\u53F7\\uFF1AHollis\u0026#34;, \u0026#34;\\u535A\\u5BA2\\uFF1Awww.hollischuang.com\u0026#34; }; String args1[] = strs; int i = args1.length; for(int j = 0; j \u0026lt; i; j++) { String s = args1[j]; System.out.println(s); } List strList = ImmutableList.of(\u0026#34;Hollis\u0026#34;, \u0026#34;\\u516C\\u4F17\\u53F7\\uFF1AHollis\u0026#34;, \u0026#34;\\u535A\\u5BA2\\uFF1Awww.hollischuang.com\u0026#34;); String s; for(Iterator iterator = strList.iterator(); iterator.hasNext(); System.out.println(s)) s = (String)iterator.next(); } ä¼šæ”¹æˆæ™®é€šçš„forè¯­å¥å¾ªç¯ï¼Œæˆ–è€…ä½¿ç”¨è¿­ä»£å™¨\ntry-with-resource # å…³é—­èµ„æºçš„æ–¹å¼ï¼Œå°±æ˜¯å†finallyå—é‡Œé‡Šæ”¾ï¼Œå³è°ƒç”¨closeæ–¹æ³•\n//æ­£å¸¸ä½¿ç”¨ public static void main(String[] args) { BufferedReader br = null; try { String line; br = new BufferedReader(new FileReader(\u0026#34;d:\\\\hollischuang.xml\u0026#34;)); while ((line = br.readLine()) != null) { System.out.println(line); } } catch (IOException e) { // handle exception } finally { try { if (br != null) { br.close(); } } catch (IOException ex) { // handle exception } } } JDK7ä¹‹åæä¾›çš„å…³é—­èµ„æºçš„æ–¹å¼ï¼š\npublic static void main(String... args) { try (BufferedReader br = new BufferedReader(new FileReader(\u0026#34;d:\\\\ hollischuang.xml\u0026#34;))) { String line; while ((line = br.readLine()) != null) { System.out.println(line); } } catch (IOException e) { // handle exception } } ç¼–è¯‘åï¼š\npublic static transient void main(String args[]) { BufferedReader br; Throwable throwable; br = new BufferedReader(new FileReader(\u0026#34;d:\\\\ hollischuang.xml\u0026#34;)); throwable = null; String line; try { while((line = br.readLine()) != null) System.out.println(line); } catch(Throwable throwable2) { throwable = throwable2; throw throwable2; } if(br != null) if(throwable != null) try { br.close(); } catch(Throwable throwable1) { throwable.addSuppressed(throwable1); } else br.close(); break MISSING_BLOCK_LABEL_113; Exception exception; exception; if(br != null) if(throwable != null) try { br.close(); } catch(Throwable throwable3) { throwable.addSuppressed(throwable3); } else br.close(); throw exception; IOException ioexception; ioexception; } } ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ²¡æœ‰åšå…³é—­çš„æ“ä½œï¼Œç¼–è¯‘å™¨éƒ½å¸®æˆ‘ä»¬åšäº†\nLambdaè¡¨è¾¾ # ä½¿ç”¨lambdaè¡¨è¾¾å¼ä¾¿åˆ©list\npublic static void main(String... args) { List\u0026lt;String\u0026gt; strList = ImmutableList.of(\u0026#34;Hollis\u0026#34;, \u0026#34;å…¬ä¼—å·ï¼šHollis\u0026#34;, \u0026#34;åšå®¢ï¼šwww.hollischuang.com\u0026#34;); strList.forEach( s -\u0026gt; { System.out.println(s); } ); } åç¼–è¯‘ä¹‹å\npublic static /* varargs */ void main(String ... args) { ImmutableList strList = ImmutableList.of((Object)\u0026#34;Hollis\u0026#34;, (Object)\u0026#34;\\u516c\\u4f17\\u53f7\\uff1aHollis\u0026#34;, (Object)\u0026#34;\\u535a\\u5ba2\\uff1awww.hollischuang.com\u0026#34;); strList.forEach((Consumer\u0026lt;String\u0026gt;)LambdaMetafactory.metafactory(null, null, null, (Ljava/lang/Object;)V, lambda$main$0(java.lang.String ), (Ljava/lang/String;)V)()); } private static /* synthetic */ void lambda$main$0(String s) { System.out.println(s); } lambdaè¡¨è¾¾å¼çš„å®ç°å…¶å®æ˜¯ä¾èµ–äº†ä¸€äº›åº•å±‚çš„apiï¼Œåœ¨ç¼–è¯‘é˜¶æ®µï¼Œä¼šæŠŠlambdaè¡¨è¾¾å¼è¿›è¡Œè§£ç³–ï¼Œè½¬æ¢æˆè°ƒç”¨å†…éƒ¨apiçš„æ–¹å¼\nå¯èƒ½é‡åˆ°çš„å‘ # æ³›å‹ # æ³›å‹é‡åˆ°é‡è½½\npublic class GenericTypes { public static void method(List\u0026lt;String\u0026gt; list) { System.out.println(\u0026#34;invoke method(List\u0026lt;String\u0026gt; list)\u0026#34;); } public static void method(List\u0026lt;Integer\u0026gt; list) { System.out.println(\u0026#34;invoke method(List\u0026lt;Integer\u0026gt; list)\u0026#34;); } } è¿™ç§æ–¹æ³•æ˜¯ç¼–è¯‘ä¸è¿‡å»çš„ï¼Œå› ä¸ºå‚æ•°List\u0026lt;Integer\u0026gt; å’ŒList\u0026lt;String\u0026gt;ç¼–è¯‘ä¹‹åéƒ½è¢«æ“¦å‡ºäº†ï¼Œå˜æˆäº†ä¸€æ ·çš„åŸç”Ÿç±»å‹Listï¼Œæ“¦é™¤åŠ¨ä½œå¯¼è‡´è¿™ä¸¤ä¸ªæ–¹æ³•çš„ç‰¹å¾ç­¾åå˜å¾—ä¸€æ¨¡ä¸€æ ·ã€‚\næ³›å‹çš„ç±»å‹å‚æ•°ä¸èƒ½ç”¨åœ¨ Java å¼‚å¸¸å¤„ç†çš„ catch è¯­å¥ä¸­ã€‚å› ä¸ºå¼‚å¸¸å¤„ç†æ˜¯ç”± JVM åœ¨è¿è¡Œæ—¶åˆ»æ¥è¿›è¡Œçš„ã€‚ç”±äºç±»å‹ä¿¡æ¯è¢«æ“¦é™¤ï¼ŒJVM æ˜¯æ— æ³•åŒºåˆ†ä¸¤ä¸ªå¼‚å¸¸ç±»å‹MyException\u0026lt;String\u0026gt;å’ŒMyException\u0026lt;Integer\u0026gt;çš„\næ³›å‹ç±»çš„æ‰€æœ‰é™æ€å˜é‡æ˜¯å…±äº«çš„\npublic class StaticTest{ public static void main(String[] args){ GT\u0026lt;Integer\u0026gt; gti = new GT\u0026lt;Integer\u0026gt;(); gti.var=1; GT\u0026lt;String\u0026gt; gts = new GT\u0026lt;String\u0026gt;(); gts.var=2; System.out.println(gti.var); } } class GT\u0026lt;T\u0026gt;{ public static int var=0; public void nothing(T x){} } ä»¥ä¸Šä»£ç è¾“å‡ºç»“æœä¸ºï¼š2ï¼\nç”±äºç»è¿‡ç±»å‹æ“¦é™¤ï¼Œæ‰€æœ‰çš„æ³›å‹ç±»å®ä¾‹éƒ½å…³è”åˆ°åŒä¸€ä»½å­—èŠ‚ç ä¸Šï¼Œæ³›å‹ç±»çš„æ‰€æœ‰é™æ€å˜é‡æ˜¯å…±äº«çš„ã€‚\nè‡ªåŠ¨è£…ç®±ä¸æ‹†ç®± # å¯¹äºè‡ªåŠ¨è£…ç®±ï¼Œæ•´å½¢å¯¹è±¡é€šè¿‡ä½¿ç”¨ç›¸åŒçš„ç¼“å­˜å’Œé‡ç”¨ï¼Œé€‚ç”¨äºæ•´æ•°å€¼åŒºé—´ [ -128ï¼Œ+127 ]\npublic static void main(String[] args) { Integer a = 1000; Integer b = 1000; Integer c = 100; Integer d = 100; System.out.println(\u0026#34;a == b is \u0026#34; + (a == b)); System.out.println((\u0026#34;c == d is \u0026#34; + (c == d))); } //ç»“æœ a == b is false c == d is true å¢å¼ºforå¾ªç¯ # éå†æ—¶ä¸è¦ä½¿ç”¨listçš„removeæ–¹æ³•ï¼š\nfor (Student stu : students) { if (stu.getId() == 2) students.remove(stu); } //ä¼šæŠ¥ConcurrentModificationExceptionå¼‚å¸¸ï¼ŒIteratoråœ¨å·¥ä½œçš„æ—¶å€™ä¸å…è®¸è¢«è¿­ä»£çš„å¯¹è±¡è¢«æ”¹å˜ï¼Œä½†å¯ä»¥ä½¿ç”¨Iteratoræœ¬èº«çš„remove()æ¥åˆ é™¤å¯¹è±¡ï¼Œä¼šåœ¨åˆ é™¤å½“å‰å¯¹è±¡çš„åŒæ—¶ï¼Œç»´æŠ¤ç´¢å¼•çš„ä¸€è‡´æ€§ "},{"id":154,"href":"/zh/docs/study/Review/java_guide/java/Basic/ly0010lyjava_spi/","title":"java_spi","section":"åŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nç®€ä»‹ # ä¸ºäº†å®ç°åœ¨æ¨¡å—è£…é…çš„æ—¶å€™ä¸ç”¨å†ç¨‹åºé‡Œé¢åŠ¨æ€æŒ‡æ˜ï¼Œè¿™å°±éœ€è¦ä¸€ç§æœåŠ¡å‘ç°æœºåˆ¶ã€‚JavaSPIå°±æ˜¯æä¾›äº†è¿™æ ·çš„ä¸€ä¸ªæœºåˆ¶ï¼šä¸ºæŸä¸ªæ¥å£å¯»æ‰¾æœåŠ¡å®ç°çš„æœºåˆ¶ã€‚æœ‰ç‚¹ç±»ä¼¼IoCçš„æ€æƒ³ï¼Œå°†è£…é…çš„æ§åˆ¶æƒäº¤åˆ°äº†ç¨‹åºä¹‹å¤–\nSPIä»‹ç» # SPIï¼ŒServiceProviderInterface ä½¿ç”¨SPIï¼šSpringæ¡†æ¶ã€æ•°æ®åº“åŠ è½½é©±åŠ¨ã€æ—¥å¿—æ¥å£ã€ä»¥åŠDubboçš„æ‰©å±•å®ç°\næ„Ÿè§‰ä¸‹é¢è¿™ä¸ªå›¾ä¸å¤ªå¯¹ï¼Œè¢«è°ƒç”¨æ–¹åº”è¯¥ ä¸€èˆ¬æ¨¡å—ä¹‹é—´éƒ½æ˜¯é€šè¿‡æ¥å£è¿›è¡Œé€šè®¯ï¼Œ\nå½“å®ç°æ–¹æä¾›äº†æ¥å£å’Œå®ç°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨å®ç°æ–¹çš„æ¥å£ä»è€Œæ‹¥æœ‰å®ç°æ–¹ç»™æˆ‘ä»¬æä¾›çš„èƒ½åŠ›ï¼Œè¿™å°±æ˜¯ API ï¼Œè¿™ç§æ¥å£å’Œå®ç°éƒ½æ˜¯æ”¾åœ¨å®ç°æ–¹çš„ã€‚\nå½“æ¥å£å­˜åœ¨äºè°ƒç”¨æ–¹è¿™è¾¹æ—¶ï¼Œå°±æ˜¯ SPI ï¼Œç”±æ¥å£è°ƒç”¨æ–¹ç¡®å®šæ¥å£è§„åˆ™ï¼Œç„¶åç”±ä¸åŒçš„å‚å•†å»æ ¹æ®è¿™ä¸ªè§„åˆ™å¯¹è¿™ä¸ªæ¥å£è¿›è¡Œå®ç°ï¼Œä»è€Œæä¾›æœåŠ¡ã€‚[å¯ä»¥ç†è§£æˆä¸šåŠ¡æ–¹ï¼Œæˆ–è€…è¯´ä½¿ç”¨æ–¹ã€‚å®ƒä½¿ç”¨äº†è¿™ä¸ªæ¥å£ï¼Œè€Œä¸”åˆ¶å®šäº†æ¥å£è§„èŒƒï¼Œä½†æ˜¯å…·ä½“å®ç°ï¼Œç”±è¢«è°ƒç”¨æ–¹å®ç°]\næˆ‘çš„ç†è§£ï¼šè¢«è°ƒç”¨æ–¹ï¼ˆæä¾›æ¥å£çš„äººï¼‰ï¼Œè°ƒç”¨æ–¹ï¼ˆä½¿ç”¨æ¥å£çš„äººï¼‰ï¼Œä½†æ˜¯å…¶å®è¿™é‡ŒåªæŠŠè°ƒç”¨æ–¹\u0026ndash;\u0026gt;ä½¿ç”¨æ¥å£çš„äºº è¿™ä¸ªå…³ç³»æ˜¯å¯¹çš„ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œæ­£å¸¸æƒ…å†µä¸‹ç”±è¢«è°ƒç”¨æ–¹è‡ªå·±æä¾›æ¥å£å’Œå®ç°ï¼Œå³APIã€‚è€Œç°åœ¨ï¼Œç”±è°ƒç”¨æ–¹ï¼ˆè¿™é‡Œçš„è°ƒç”¨æ–¹å…¶å®å¯ä»¥ç†è§£æˆä¸Šé¢çš„è¢«è°ƒç”¨æ–¹ï¼‰ï¼Œæä¾›äº†æ¥å£è¿˜ä½¿ç”¨äº†æ¥å£ï¼Œè€Œç”±è¢«è°ƒç”¨æ–¹è¿›è¡Œæ¥å£å®ç°\nå®æˆ˜æ¼”ç¤º # SLF4Jåªæ˜¯ä¸€ä¸ªæ—¥å¿—é—¨é¢ï¼ˆæ¥å£ï¼‰ï¼Œä½†æ˜¯SLF4Jçš„å…·ä½“å®ç°å¯ä»¥æœ‰å¤šç§ï¼Œå¦‚ï¼šLogback/Log4j/Log4j2ç­‰ç­‰\nç®€æ˜“ç‰ˆæœ¬ # ServiceProviderInterface\nç›®å½•ç»“æ„\nâ”‚ service-provider-interface.iml â”‚ â”œâ”€.idea â”‚ â”‚ .gitignore â”‚ â”‚ misc.xml â”‚ â”‚ modules.xml â”‚ â””â”€ workspace.xml â”‚ â””â”€src â””â”€edu â””â”€jiangxuan â””â”€up â””â”€spi Logger.java LoggerService.java Main.class Loggeræ¥å£ï¼Œå³SPI æœåŠ¡æä¾›è€…æ¥å£ï¼Œåé¢çš„æœåŠ¡æä¾›è€…è¦é’ˆå¯¹è¿™ä¸ªæ¥å£è¿›è¡Œå®ç°\npackage edu.jiangxuan.up.spi; public interface Logger { void info(String msg); void debug(String msg); } LoggerServiceç±»ï¼Œä¸»è¦æ˜¯ä¸ºæœåŠ¡ä½¿ç”¨è€…ï¼ˆè°ƒç”¨æ–¹ï¼‰æä¾›ç‰¹å®šåŠŸèƒ½ï¼Œè¿™ä¸ªç±»æ˜¯å®ç°JavaSPIæœºåˆ¶çš„å…³é”®æ‰€åœ¨\npackage edu.jiangxuan.up.spi; import java.util.ArrayList; import java.util.List; import java.util.ServiceLoader; public class LoggerService { private static final LoggerService SERVICE = new LoggerService(); private final Logger logger; private final List\u0026lt;Logger\u0026gt; loggerList; private LoggerService() { ServiceLoader\u0026lt;Logger\u0026gt; loader = ServiceLoader.load(Logger.class); List\u0026lt;Logger\u0026gt; list = new ArrayList\u0026lt;\u0026gt;(); for (Logger log : loader) { list.add(log); } // LoggerList æ˜¯æ‰€æœ‰ ServiceProvider loggerList = list; if (!list.isEmpty()) { // Logger åªå–ä¸€ä¸ª logger = list.get(0); } else { logger = null; } } //ç®€å•å•ä¾‹ public static LoggerService getService() { return SERVICE; } public void info(String msg) { if (logger == null) { System.out.println(\u0026#34;info ä¸­æ²¡æœ‰å‘ç° Logger æœåŠ¡æä¾›è€…\u0026#34;); } else { logger.info(msg); } } public void debug(String msg) { if (loggerList.isEmpty()) { System.out.println(\u0026#34;debug ä¸­æ²¡æœ‰å‘ç° Logger æœåŠ¡æä¾›è€…\u0026#34;); } loggerList.forEach(log -\u0026gt; log.debug(msg)); } } Mainç±»ï¼ˆæœåŠ¡ä½¿ç”¨è€…ï¼Œè°ƒç”¨æ–¹ï¼‰\npackage org.spi.service; public class Main { public static void main(String[] args) { LoggerService service = LoggerService.getService(); service.info(\u0026#34;Hello SPI\u0026#34;); service.debug(\u0026#34;Hello SPI\u0026#34;); } } /** ç»“æœ info ä¸­æ²¡æœ‰å‘ç° Logger æœåŠ¡æä¾›è€… debug ä¸­æ²¡æœ‰å‘ç° Logger æœåŠ¡æä¾›è€… */ æ–°çš„é¡¹ç›®ï¼Œæ¥å®ç°Loggeræ¥å£\né¡¹ç›®ç»“æ„\nâ”‚ service-provider.iml â”‚ â”œâ”€.idea â”‚ â”‚ .gitignore â”‚ â”‚ misc.xml â”‚ â”‚ modules.xml â”‚ â””â”€ workspace.xml â”‚ â”œâ”€lib â”‚ service-provider-interface.jar | â””â”€src â”œâ”€edu â”‚ â””â”€jiangxuan â”‚ â””â”€up â”‚ â””â”€spi â”‚ â””â”€service â”‚ Logback.java â”‚ â””â”€META-INF â””â”€services edu.jiangxuan.up.spi.Logger é¦–å…ˆéœ€è¦æœ‰ä¸€ä¸ªå®ç°ç±»\npackage edu.jiangxuan.up.spi.service; import edu.jiangxuan.up.spi.Logger; public class Logback implements Logger { @Override public void info(String s) { System.out.println(\u0026#34;Logback info æ‰“å°æ—¥å¿—ï¼š\u0026#34; + s); } @Override public void debug(String s) { System.out.println(\u0026#34;Logback debug æ‰“å°æ—¥å¿—ï¼š\u0026#34; + s); } } å°†ä¹‹å‰é¡¹ç›®æ‰“åŒ…çš„jarå¯¼å…¥é¡¹ç›®ä¸­\nä¹‹åè¦src ç›®å½•ä¸‹æ–°å»º META-INF/services æ–‡ä»¶å¤¹ï¼Œç„¶åæ–°å»ºæ–‡ä»¶ edu.jiangxuan.up.spi.Logger ï¼ˆSPI çš„å…¨ç±»åï¼Œæ¥å£åï¼‰ï¼Œæ–‡ä»¶é‡Œé¢çš„å†…å®¹æ˜¯ï¼šedu.jiangxuan.up.spi.service.Logback ï¼ˆLogback çš„å…¨ç±»åï¼Œå³ SPI çš„å®ç°ç±»çš„åŒ…å + ç±»åï¼‰\nè¿™æ˜¯ JDK SPI æœºåˆ¶ ServiceLoader çº¦å®šå¥½çš„æ ‡å‡†ã€‚\nJava ä¸­çš„ SPI æœºåˆ¶å°±æ˜¯åœ¨æ¯æ¬¡ç±»åŠ è½½çš„æ—¶å€™ä¼šå…ˆå»æ‰¾åˆ° class ç›¸å¯¹ç›®å½•ä¸‹çš„ META-INF æ–‡ä»¶å¤¹ä¸‹çš„ services æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼Œå°†è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢çš„æ‰€æœ‰æ–‡ä»¶å…ˆåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åæ ¹æ®è¿™äº›æ–‡ä»¶çš„æ–‡ä»¶åå’Œé‡Œé¢çš„æ–‡ä»¶å†…å®¹æ‰¾åˆ°ç›¸åº”æ¥å£çš„å…·ä½“å®ç°ç±»ï¼Œæ‰¾åˆ°å®ç°ç±»åå°±å¯ä»¥é€šè¿‡åå°„å»ç”Ÿæˆå¯¹åº”çš„å¯¹è±¡ï¼Œä¿å­˜åœ¨ä¸€ä¸ª list åˆ—è¡¨é‡Œé¢ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è¿­ä»£æˆ–è€…éå†çš„æ–¹å¼æ‹¿åˆ°å¯¹åº”çš„å®ä¾‹å¯¹è±¡ï¼Œç”Ÿæˆä¸åŒçš„å®ç°ã€‚\nå³ï¼šæ–‡ä»¶åä¸€å®šè¦æ˜¯æ¥å£çš„å…¨ç±»åï¼Œç„¶åé‡Œé¢çš„å†…å®¹ä¸€å®šè¦æ˜¯å®ç°ç±»çš„å…¨ç±»åï¼Œå®ç°ç±»å¯ä»¥æœ‰å¤šä¸ªï¼Œç›´æ¥æ¢è¡Œå°±å¥½äº†ï¼Œå¤šä¸ªå®ç°ç±»çš„æ—¶å€™ï¼Œä¼šä¸€ä¸ªä¸€ä¸ªçš„è¿­ä»£åŠ è½½ã€‚\næ¥ä¸‹æ¥åŒæ ·å°† service-provider é¡¹ç›®æ‰“åŒ…æˆ jar åŒ…ï¼Œè¿™ä¸ª jar åŒ…å°±æ˜¯æœåŠ¡æä¾›æ–¹çš„å®ç°ã€‚é€šå¸¸æˆ‘ä»¬å¯¼å…¥ maven çš„ pom ä¾èµ–å°±æœ‰ç‚¹ç±»ä¼¼è¿™ç§ï¼Œåªä¸è¿‡æˆ‘ä»¬ç°åœ¨æ²¡æœ‰å°†è¿™ä¸ª jar åŒ…å‘å¸ƒåˆ° maven å…¬å…±ä»“åº“ä¸­ï¼Œæ‰€ä»¥åœ¨éœ€è¦ä½¿ç”¨çš„åœ°æ–¹åªèƒ½æ‰‹åŠ¨çš„æ·»åŠ åˆ°é¡¹ç›®ä¸­ æ•ˆæœå±•ç¤º package edu.jiangxuan.up.service; import edu.jiangxuan.up.spi.LoggerService; public class TestJavaSPI { public static void main(String[] args) { LoggerService loggerService = LoggerService.getService(); loggerService.info(\u0026#34;ä½ å¥½\u0026#34;); loggerService.debug(\u0026#34;æµ‹è¯•Java SPI æœºåˆ¶\u0026#34;); } } é€šè¿‡ä½¿ç”¨ SPI æœºåˆ¶ï¼Œå¯ä»¥çœ‹å‡ºæœåŠ¡ï¼ˆLoggerServiceï¼‰å’Œ æœåŠ¡æä¾›è€…ä¸¤è€…ä¹‹é—´çš„è€¦åˆåº¦éå¸¸ä½ï¼Œå¦‚æœè¯´æˆ‘ä»¬æƒ³è¦æ¢ä¸€ç§å®ç°ï¼Œé‚£ä¹ˆå…¶å®åªéœ€è¦ä¿®æ”¹ service-provider é¡¹ç›®ä¸­é’ˆå¯¹ Logger æ¥å£çš„å…·ä½“å®ç°å°±å¯ä»¥äº†ï¼Œåªéœ€è¦æ¢ä¸€ä¸ª jar åŒ…å³å¯ï¼Œä¹Ÿå¯ä»¥æœ‰åœ¨ä¸€ä¸ªé¡¹ç›®é‡Œé¢æœ‰å¤šä¸ªå®ç°ï¼Œè¿™ä¸å°±æ˜¯ SLF4J åŸç†å—ï¼Ÿ\nServiceLoader # JDK å®˜æ–¹ç»™çš„æ³¨é‡Šï¼šä¸€ç§åŠ è½½æœåŠ¡å®ç°çš„å·¥å…·ã€‚\nå…·ä½“å®ç° # è‡ªå·±å®ç° # //ä¸ªäººç®€æ˜“ç‰ˆ\npackage edu.jiangxuan.up.service; import java.io.BufferedReader; import java.io.InputStream; import java.io.InputStreamReader; import java.lang.reflect.Constructor; import java.net.URL; import java.net.URLConnection; import java.util.ArrayList; import java.util.Enumeration; import java.util.List; public class MyServiceLoader\u0026lt;S\u0026gt; { // å¯¹åº”çš„æ¥å£ Class æ¨¡æ¿ private final Class\u0026lt;S\u0026gt; service; // å¯¹åº”å®ç°ç±»çš„ å¯ä»¥æœ‰å¤šä¸ªï¼Œç”¨ List è¿›è¡Œå°è£… private final List\u0026lt;S\u0026gt; providers = new ArrayList\u0026lt;\u0026gt;(); // ç±»åŠ è½½å™¨ private final ClassLoader classLoader; // æš´éœ²ç»™å¤–éƒ¨ä½¿ç”¨çš„æ–¹æ³•ï¼Œé€šè¿‡è°ƒç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥å¼€å§‹åŠ è½½è‡ªå·±å®šåˆ¶çš„å®ç°æµç¨‹ã€‚ public static \u0026lt;S\u0026gt; MyServiceLoader\u0026lt;S\u0026gt; load(Class\u0026lt;S\u0026gt; service) { return new MyServiceLoader\u0026lt;\u0026gt;(service); } // æ„é€ æ–¹æ³•ç§æœ‰åŒ– private MyServiceLoader(Class\u0026lt;S\u0026gt; service) { this.service = service; this.classLoader = Thread.currentThread().getContextClassLoader(); doLoad(); } // å…³é”®æ–¹æ³•ï¼ŒåŠ è½½å…·ä½“å®ç°ç±»çš„é€»è¾‘ private void doLoad() { try { // è¯»å–æ‰€æœ‰ jar åŒ…é‡Œé¢ META-INF/services åŒ…ä¸‹é¢çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åå°±æ˜¯æ¥å£åï¼Œç„¶åæ–‡ä»¶é‡Œé¢çš„å†…å®¹å°±æ˜¯å…·ä½“çš„å®ç°ç±»çš„è·¯å¾„åŠ å…¨ç±»å Enumeration\u0026lt;URL\u0026gt; urls = classLoader.getResources(\u0026#34;META-INF/services/\u0026#34; + service.getName()); // æŒ¨ä¸ªéå†å–åˆ°çš„æ–‡ä»¶ while (urls.hasMoreElements()) { // å–å‡ºå½“å‰çš„æ–‡ä»¶ URL url = urls.nextElement(); System.out.println(\u0026#34;File = \u0026#34; + url.getPath()); // å»ºç«‹é“¾æ¥ URLConnection urlConnection = url.openConnection(); urlConnection.setUseCaches(false); // è·å–æ–‡ä»¶è¾“å…¥æµ InputStream inputStream = urlConnection.getInputStream(); // ä»æ–‡ä»¶è¾“å…¥æµè·å–ç¼“å­˜ BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(inputStream)); // ä»æ–‡ä»¶å†…å®¹é‡Œé¢å¾—åˆ°å®ç°ç±»çš„å…¨ç±»å String className = bufferedReader.readLine(); while (className != null) { // â˜…â˜…ã€é‡ç‚¹ã€‘ é€šè¿‡åå°„æ‹¿åˆ°å®ç°ç±»çš„å®ä¾‹ Class\u0026lt;?\u0026gt; clazz = Class.forName(className, false, classLoader); // å¦‚æœå£°æ˜çš„æ¥å£è·Ÿè¿™ä¸ªå…·ä½“çš„å®ç°ç±»æ˜¯å±äºåŒä¸€ç±»å‹ï¼Œï¼ˆå¯ä»¥ç†è§£ä¸ºJavaçš„ä¸€ç§å¤šæ€ï¼Œæ¥å£è·Ÿå®ç°ç±»ã€çˆ¶ç±»å’Œå­ç±»ç­‰ç­‰è¿™ç§å…³ç³»ã€‚ï¼‰åˆ™æ„é€ å®ä¾‹ if (service.isAssignableFrom(clazz)) { Constructor\u0026lt;? extends S\u0026gt; constructor = (Constructor\u0026lt;? extends S\u0026gt;) clazz.getConstructor(); S instance = constructor.newInstance(); // æŠŠå½“å‰æ„é€ çš„å®ä¾‹å¯¹è±¡æ·»åŠ åˆ° Providerçš„åˆ—è¡¨é‡Œé¢ providers.add(instance); } // ç»§ç»­è¯»å–ä¸‹ä¸€è¡Œçš„å®ç°ç±»ï¼Œå¯ä»¥æœ‰å¤šä¸ªå®ç°ç±»ï¼Œåªéœ€è¦æ¢è¡Œå°±å¯ä»¥äº†ã€‚ className = bufferedReader.readLine(); } } } catch (Exception e) { System.out.println(\u0026#34;è¯»å–æ–‡ä»¶å¼‚å¸¸ã€‚ã€‚ã€‚\u0026#34;); } } // è¿”å›spiæ¥å£å¯¹åº”çš„å…·ä½“å®ç°ç±»åˆ—è¡¨ public List\u0026lt;S\u0026gt; getProviders() { return providers; } } åŸºæœ¬æµç¨‹ï¼š\né€šè¿‡ URL å·¥å…·ç±»ä» jar åŒ…çš„ /META-INF/services ç›®å½•ä¸‹é¢æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ï¼Œ è¯»å–è¿™ä¸ªæ–‡ä»¶çš„åç§°æ‰¾åˆ°å¯¹åº”çš„ spi æ¥å£ï¼Œ é€šè¿‡ InputStream æµå°†æ–‡ä»¶é‡Œé¢çš„å…·ä½“å®ç°ç±»çš„å…¨ç±»åè¯»å–å‡ºæ¥ï¼Œ æ ¹æ®è·å–åˆ°çš„å…¨ç±»åï¼Œå…ˆåˆ¤æ–­è·Ÿ spi æ¥å£æ˜¯å¦ä¸ºåŒä¸€ç±»å‹ï¼Œå¦‚æœæ˜¯çš„ï¼Œé‚£ä¹ˆå°±é€šè¿‡åå°„çš„æœºåˆ¶æ„é€ å¯¹åº”çš„å®ä¾‹å¯¹è±¡ï¼Œ å°†æ„é€ å‡ºæ¥çš„å®ä¾‹å¯¹è±¡æ·»åŠ åˆ° Providers çš„åˆ—è¡¨ä¸­ã€‚ "},{"id":155,"href":"/zh/docs/study/Review/java_guide/java/Basic/ly0009lyunsafe_class/","title":"unsafeç±»","section":"åŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nsun.misc.Unsafe\næä¾›æ‰§è¡Œä½çº§åˆ«ã€ä¸å®‰å…¨æ“ä½œçš„æ–¹æ³•ï¼Œå¦‚ç›´æ¥è®¿é—®ç³»ç»Ÿå†…å­˜èµ„æºã€è‡ªä¸»ç®¡ç†å†…å­˜èµ„æºç­‰ï¼Œæ•ˆç‡å¿«ï¼Œä½†ç”±äºæœ‰äº†æ“ä½œå†…å­˜ç©ºé—´çš„èƒ½åŠ›ï¼Œä¼šå¢åŠ æŒ‡é’ˆé—®é¢˜é£é™©ã€‚ä¸”è¿™äº›åŠŸèƒ½çš„å®ç°ä¾èµ–äºæœ¬åœ°æ–¹æ³•ï¼ŒJavaä»£ç ä¸­åªæ˜¯å£°æ˜æ–¹æ³•å¤´ï¼Œå…·ä½“å®ç°è§„åˆ™äº¤ç»™æœ¬åœ°ä»£ç  ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æœ¬åœ°æ–¹æ³• # éœ€è¦ç”¨åˆ°Javaä¸­ä¸å…·å¤‡çš„ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„ç‰¹æ€§ï¼Œè·¨å¹³å°çš„åŒæ—¶è¦å®ç°å¯¹åº•å±‚æ§åˆ¶ å¯¹äºå…¶ä»–è¯­è¨€å·²ç»å®Œæˆçš„ç°æˆåŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨Javaè°ƒç”¨ å¯¹æ—¶é—´æ•æ„Ÿ/æ€§èƒ½è¦æ±‚éå¸¸é«˜ï¼Œæœ‰å¿…è¦ä½¿ç”¨æ›´ä¸ºåº•å±‚çš„è¯­è¨€ å¯¹äºåŒä¸€æœ¬åœ°æ–¹æ³•ï¼Œä¸åŒçš„æ“ä½œç³»ç»Ÿå¯èƒ½é€šè¿‡ä¸åŒçš„æ–¹å¼æ¥å®ç°çš„\nUnsafeåˆ›å»º # sun.misc.Unsafeéƒ¨åˆ†æºç \npublic final class Unsafe { // å•ä¾‹å¯¹è±¡ private static final Unsafe theUnsafe; ...... private Unsafe() { } //Sensitive : æ•æ„Ÿçš„ è‹±[ËˆsensÉ™tÉªv] @CallerSensitive public static Unsafe getUnsafe() { Class var0 = Reflection.getCallerClass(); // ä»…åœ¨å¼•å¯¼ç±»åŠ è½½å™¨`BootstrapClassLoader`åŠ è½½æ—¶æ‰åˆæ³• if(!VM.isSystemDomainLoader(var0.getClassLoader())) { throw new SecurityException(\u0026#34;Unsafe\u0026#34;); } else { return theUnsafe; } } } ä¼šå…ˆåˆ¤æ–­å½“å‰ç±»æ˜¯å¦ç”±Bootstrap classloaderåŠ è½½ã€‚å³åªæœ‰å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æ‰èƒ½å¤Ÿè°ƒç”¨Unsafeç±»ä¸­çš„æ–¹æ³•\nå¦‚ä½•ä½¿ç”¨Unsafeè¿™ä¸ªç±»\nåˆ©ç”¨åå°„è·å¾—Unsafeç±»ä¸­å·²ç»å®ä¾‹åŒ–å®Œæˆçš„å•ä¾‹å¯¹è±¡theUnsafe\nprivate static Unsafe reflectGetUnsafe() { try { Field field = Unsafe.class.getDeclaredField(\u0026#34;theUnsafe\u0026#34;); field.setAccessible(true); return (Unsafe) field.get(null); } catch (Exception e) { log.error(e.getMessage(), e); return null; } } é€šè¿‡Javaå‘½ä»¤è¡Œå‘½ä»¤-Xbootclasspath/aæŠŠè°ƒç”¨Unsafeç›¸å…³æ–¹æ³•çš„ç±»Aæ‰€åœ¨jaråŒ…è·¯å¾„è¿½åŠ åˆ°é»˜è®¤çš„bootstrapè·¯å¾„ä¸­ï¼Œä½¿å¾—Aè¢«å¼•å¯¼ç±»åŠ è½½å™¨åŠ è½½\njava -Xbootclasspath/a:${path} // å…¶ä¸­pathä¸ºè°ƒç”¨Unsafeç›¸å…³æ–¹æ³•çš„ç±»æ‰€åœ¨jaråŒ…è·¯å¾„ UnsafeåŠŸèƒ½ # å†…å­˜æ“ä½œã€å†…å­˜å±éšœã€å¯¹è±¡æ“ä½œã€æ•°æ®æ“ä½œã€CASæ“ä½œã€çº¿ç¨‹è°ƒåº¦ã€Classæ“ä½œã€ç³»ç»Ÿä¿¡æ¯\nå†…å­˜æ“ä½œ # ç›¸å…³æ–¹æ³•:\n//åˆ†é…æ–°çš„æœ¬åœ°ç©ºé—´ public native long allocateMemory(long bytes); //é‡æ–°è°ƒæ•´å†…å­˜ç©ºé—´çš„å¤§å° public native long reallocateMemory(long address, long bytes); //å°†å†…å­˜è®¾ç½®ä¸ºæŒ‡å®šå€¼ public native void setMemory(Object o, long offset, long bytes, byte value); //å†…å­˜æ‹·è´ public native void copyMemory(Object srcBase, long srcOffset,Object destBase, long destOffset,long bytes); //æ¸…é™¤å†…å­˜ public native void freeMemory(long address); æµ‹è¯•ï¼š\npackage com.unsafe; import lombok.extern.slf4j.Slf4j; import sun.misc.Unsafe; import java.lang.reflect.Field; import java.util.concurrent.TimeUnit; @Slf4j public class UnsafeGet { private Unsafe unsafe; public UnsafeGet() { this.unsafe = UnsafeGet.reflectGetUnsafe(); ; } private static Unsafe reflectGetUnsafe() { try { Field field = Unsafe.class.getDeclaredField(\u0026#34;theUnsafe\u0026#34;); field.setAccessible(true); return (Unsafe) field.get(null); } catch (Exception e) { log.error(e.getMessage(), e); return null; } } public void example() throws InterruptedException { int size = 4; //ä½¿ç”¨allocateMemoryæ–¹æ³•ç”³è¯· 4 å­—èŠ‚é•¿åº¦çš„å†…å­˜ç©ºé—´ long addr = unsafe.allocateMemory(size); //setMemory(Object var1, long var2, long var4, byte var6) //ä»var1çš„åç§»é‡var2å¤„å¼€å§‹ï¼Œæ¯ä¸ªå­—èŠ‚éƒ½è®¾ç½®ä¸ºvar6ï¼Œè®¾ç½®var4ä¸ªå­—èŠ‚ unsafe.setMemory(null, addr, size, (byte) 1); //æ‰¾åˆ°ä¸€ä¸ªæ–°çš„size*2å¤§å°çš„å†…å­˜å—ï¼Œå¹¶ä¸”æ‹·è´åŸæ¥addrçš„å€¼è¿‡æ¥ long addr3 = unsafe.reallocateMemory(addr, size * 2); //å®é™…æ“ä½œä¸­è¿™ä¸ªåœ°å€å¯èƒ½ç­‰äºaddrï¼ˆæœ‰æ¦‚ç‡ï¼Œæ²¡æ‰¾åˆ°åŸå› ï¼Œè¿™é‡Œå…ˆå‡è®¾é‡æ–°åˆ†é…äº†ä¸€å—ï¼‰ System.out.println(\u0026#34;addr: \u0026#34; + addr); System.out.println(\u0026#34;addr3: \u0026#34; + addr3); System.out.println(\u0026#34;addrå€¼: \u0026#34; + unsafe.getInt(addr)); System.out.println(\u0026#34;addr3å€¼: \u0026#34; + unsafe.getLong(addr3)); try { for (int i = 0; i \u0026lt; 2; i++) { // copyMemory(Object var1, long var2, Object var4, long var5, long var7); // ä»var1çš„åç§»é‡var2å¤„å¼€å§‹ï¼Œæ‹·è´æ•°æ®åˆ°var4çš„åç§»é‡var5ä¸Šï¼Œæ¯æ¬¡æ‹·è´var7ä¸ªå­—èŠ‚ //æ‰€ä»¥i = 0æ—¶ï¼Œæ‹·è´åˆ°äº†addr3çš„å‰4ä¸ªå­—èŠ‚ï¼›i = 1 æ—¶ï¼Œæ‹·è´åˆ°äº†addr3çš„å4ä¸ªå­—èŠ‚ unsafe.copyMemory(null, addr, null, addr3 + size * i, 4); } System.out.println(unsafe.getInt(addr)); System.out.println(unsafe.getLong(addr3)); } finally { log.info(\u0026#34;start-------\u0026#34;); unsafe.freeMemory(addr); log.info(\u0026#34;end-------\u0026#34;); unsafe.freeMemory(addr3); //å®é™…æ“ä½œä¸­è¿™å¥è¯æ²¡æ‰§è¡Œï¼Œä¸çŸ¥é“åŸå›  } } public static void main(String[] args) throws InterruptedException { long l = Long.parseLong(\u0026#34;0000000100000001000000010000000100000001000000010000000100000001\u0026#34;, 2); System.out.println(l); new UnsafeGet().example(); /** è¾“å‡º 72340172838076673 addr: 46927104 addr3: 680731776 addrå€¼: 16843009 addr3å€¼: 16843009 16843009 72340172838076673 2023-01-31 14:19:28 ä¸‹åˆ [Thread: main] INFO:start------- */ } } å¯¹äºsetMemoryçš„è§£é‡Š æ¥æº\n/** å°†ç»™å®šå†…å­˜å—ä¸­çš„æ‰€æœ‰å­—èŠ‚è®¾ç½®ä¸ºå›ºå®šå€¼(é€šå¸¸æ˜¯0)ã€‚ å†…å­˜å—çš„åœ°å€ç”±å¯¹è±¡å¼•ç”¨oå’Œåç§»åœ°å€å…±åŒå†³å®šï¼Œå¦‚æœå¯¹è±¡å¼•ç”¨oä¸ºnullï¼Œoffsetå°±æ˜¯ç»å¯¹åœ°å€ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯å†…å­˜å—çš„å¤§å°ï¼Œå¦‚æœä½¿ç”¨allocateMemoryè¿›è¡Œå†…å­˜å¼€è¾Ÿçš„è¯ï¼Œè¿™é‡Œçš„å€¼åº”è¯¥å’ŒallocateMemoryçš„å‚æ•°ä¸€è‡´ã€‚ valueå°±æ˜¯è®¾ç½®çš„å›ºå®šå€¼ï¼Œä¸€èˆ¬ä¸º0(è¿™é‡Œå¯ä»¥å‚è€ƒnettyçš„DirectByteBuffer)ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œoä¸ºnull æ‰€æœ‰æœ‰ä¸ªé‡è½½æ–¹æ³•æ˜¯public native void setMemory(long offset, long bytes, byte value); ç­‰æ•ˆäºsetMemory(null, long offset, long bytes, byte value);ã€‚ */ public native void setMemory(Object o, long offset, long bytes, byte value); åˆ†æï¼š\nåˆ†æä¸€ä¸‹è¿è¡Œç»“æœï¼Œé¦–å…ˆä½¿ç”¨allocateMemoryæ–¹æ³•ç”³è¯· 4 å­—èŠ‚é•¿åº¦çš„å†…å­˜ç©ºé—´ï¼Œåœ¨å¾ªç¯ä¸­è°ƒç”¨setMemoryæ–¹æ³•å‘æ¯ä¸ªå­—èŠ‚å†™å…¥å†…å®¹ä¸ºbyteç±»å‹çš„ 1ï¼Œå½“ä½¿ç”¨ Unsafe è°ƒç”¨getIntæ–¹æ³•æ—¶ï¼Œå› ä¸ºä¸€ä¸ªintå‹å˜é‡å  4 ä¸ªå­—èŠ‚ï¼Œä¼šä¸€æ¬¡æ€§è¯»å– 4 ä¸ªå­—èŠ‚ï¼Œç»„æˆä¸€ä¸ªintçš„å€¼ï¼Œå¯¹åº”çš„åè¿›åˆ¶ç»“æœä¸º 16843009ã€‚\nå¯¹äºreallocateMemoryæ–¹æ³•ï¼š\nåœ¨ä»£ç ä¸­è°ƒç”¨reallocateMemoryæ–¹æ³•é‡æ–°åˆ†é…äº†ä¸€å— 8 å­—èŠ‚é•¿åº¦çš„å†…å­˜ç©ºé—´ï¼Œé€šè¿‡æ¯”è¾ƒaddrå’Œaddr3å¯ä»¥çœ‹åˆ°å’Œä¹‹å‰ç”³è¯·çš„å†…å­˜åœ°å€æ˜¯ä¸åŒçš„ã€‚åœ¨ä»£ç ä¸­çš„ç¬¬äºŒä¸ª for å¾ªç¯é‡Œï¼Œè°ƒç”¨copyMemoryæ–¹æ³•è¿›è¡Œäº†ä¸¤æ¬¡å†…å­˜çš„æ‹·è´ï¼Œæ¯æ¬¡æ‹·è´å†…å­˜åœ°å€addrå¼€å§‹çš„ 4 ä¸ªå­—èŠ‚ï¼Œåˆ†åˆ«æ‹·è´åˆ°ä»¥addr3å’Œaddr3+4å¼€å§‹çš„å†…å­˜ç©ºé—´ä¸Šï¼š\næ‹·è´å®Œæˆåï¼Œä½¿ç”¨getLongæ–¹æ³•ä¸€æ¬¡æ€§è¯»å–8ä¸ªå­—èŠ‚ï¼Œå¾—åˆ°longç±»å‹çš„å€¼\nè¿™ç§åˆ†é…å±äºå †å¤–å†…å­˜ï¼Œæ— æ³•è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œéœ€è¦æˆ‘ä»¬æŠŠè¿™äº›å†…å­˜å½“ä½œèµ„æºå»æ‰‹åŠ¨è°ƒç”¨freeMemoryæ–¹æ³•è¿›è¡Œé‡Šæ”¾ï¼Œå¦åˆ™ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼ã€‚é€šå¸¸æ˜¯try-finallyè¿›è¡Œå†…å­˜é‡Šæ”¾\nä¸ºä»€ä¹ˆä½¿ç”¨å †å¤–å†…å­˜\nå¯¹åƒåœ¾å›æ”¶åœé¡¿çš„æ”¹å–„ï¼Œå †å¤–å†…å­˜ç›´æ¥å—æ“ä½œç³»ç»Ÿç®¡ç†è€Œä¸æ˜¯JVM æå‡ç¨‹åºI/Oæ“ä½œçš„æ€§èƒ½ã€‚é€šå¸¸I/Oé€šä¿¡è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨å †å†…å†…å­˜åˆ°å †å¤–å†…å­˜çš„æ•°æ®æ‹·è´æ“ä½œï¼Œå¯¹äºéœ€è¦é¢‘ç¹è¿›è¡Œå†…å­˜é—´çš„æ•°æ®æ‹·è´ä¸”ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„æš‚å­˜æ•°æ®ï¼Œå»ºè®®éƒ½å­˜å‚¨åˆ°å †å¤–å†…å­˜ å…¸å‹åº”ç”¨ DirectByteBufferï¼ŒJavaç”¨äºå®ç°å †å¤–å†…å­˜çš„é‡è¦ç±»ï¼Œå¯¹äºå †å¤–å†…å­˜çš„åˆ›å»ºã€ä½¿ç”¨ã€é”€æ¯ç­‰é€»è¾‘å‡ç”±Unsafeæä¾›çš„å †å¤–å†…å­˜APIæ¥å®ç°\n//DirectByteBufferç±»æº DirectByteBuffer(int cap) { // package-private super(-1, 0, cap, cap); boolean pa = VM.isDirectMemoryPageAligned(); int ps = Bits.pageSize(); long size = Math.max(1L, (long)cap + (pa ? ps : 0)); Bits.reserveMemory(size, cap); long base = 0; try { // åˆ†é…å†…å­˜å¹¶è¿”å›åŸºåœ°å€ base = unsafe.allocateMemory(size); } catch (OutOfMemoryError x) { Bits.unreserveMemory(size, cap); throw x; } // å†…å­˜åˆå§‹åŒ– unsafe.setMemory(base, size, (byte) 0); if (pa \u0026amp;\u0026amp; (base % ps != 0)) { // Round up to page boundary address = base + ps - (base \u0026amp; (ps - 1)); } else { address = base; } // è·Ÿè¸ª DirectByteBuffer å¯¹è±¡çš„åƒåœ¾å›æ”¶ï¼Œä»¥å®ç°å †å¤–å†…å­˜é‡Šæ”¾ cleaner = Cleaner.create(this, new Deallocator(base, size, cap)); att = null; } å†…å­˜å±éšœ # ä»‹ç»\nç¼–è¯‘å™¨å’Œ CPU ä¼šåœ¨ä¿è¯ç¨‹åºè¾“å‡ºç»“æœä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¹ä»£ç è¿›è¡Œé‡æ’åºï¼Œä»æŒ‡ä»¤ä¼˜åŒ–è§’åº¦æå‡æ€§èƒ½ åæœæ˜¯ï¼Œå¯¼è‡´ CPU çš„é«˜é€Ÿç¼“å­˜å’Œå†…å­˜ä¸­æ•°æ®çš„ä¸ä¸€è‡´ å†…å­˜å±éšœï¼ˆMemory Barrierï¼‰å°±æ˜¯é€šè¿‡é˜»æ­¢å±éšœä¸¤è¾¹çš„æŒ‡ä»¤é‡æ’åºä»è€Œé¿å…ç¼–è¯‘å™¨å’Œç¡¬ä»¶çš„ä¸æ­£ç¡®ä¼˜åŒ–æƒ…å†µ Unsafeæä¾›äº†ä¸‰ä¸ªå†…å­˜å±éšœç›¸å…³æ–¹æ³•\n//å†…å­˜å±éšœï¼Œç¦æ­¢loadæ“ä½œé‡æ’åºã€‚å±éšœå‰çš„loadæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœåï¼Œå±éšœåçš„loadæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœå‰ public native void loadFence(); //å†…å­˜å±éšœï¼Œç¦æ­¢storeæ“ä½œé‡æ’åºã€‚å±éšœå‰çš„storeæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœåï¼Œå±éšœåçš„storeæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœå‰ public native void storeFence(); //å†…å­˜å±éšœï¼Œç¦æ­¢loadã€storeæ“ä½œé‡æ’åº public native void fullFence(); ä»¥loadFenceæ–¹æ³•ä¸ºä¾‹ï¼Œä¼šç¦æ­¢è¯»æ“ä½œé‡æ’åºï¼Œä¿è¯åœ¨è¿™ä¸ªå±éšœä¹‹å‰çš„æ‰€æœ‰è¯»æ“ä½œéƒ½å·²ç»å®Œæˆï¼Œå¹¶ä¸”å°†ç¼“å­˜æ•°æ®è®¾ä¸ºæ— æ•ˆï¼Œé‡æ–°ä»ä¸»å­˜ä¸­è¿›è¡ŒåŠ è½½ åœ¨æŸä¸ªçº¿ç¨‹ä¿®æ”¹Runnableä¸­çš„flag\n@Getter class ChangeThread implements Runnable{ /**volatile**/ boolean flag=false; @Override public void run() { try { Thread.sleep(3000); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(\u0026#34;subThread change flag to:\u0026#34; + flag); flag = true; } } åœ¨ä¸»çº¿ç¨‹çš„whileå¾ªç¯ä¸­ï¼ŒåŠ å…¥å†…å­˜å±éšœï¼Œæµ‹è¯•æ˜¯å¦èƒ½æ„ŸçŸ¥åˆ°flagçš„ä¿®æ”¹å˜åŒ–\npublic static void main(String[] args){ ChangeThread changeThread = new ChangeThread(); new Thread(changeThread).start(); while (true) { boolean flag = changeThread.isFlag(); unsafe.loadFence(); //åŠ å…¥è¯»å†…å­˜å±éšœ //å‡è®¾ä¸Šé¢è¿™å¥unsafe.loadFence()å»æ‰ï¼Œé‚£ä¹ˆ /* æµç¨‹ï¼š1. è¿™é‡Œçš„flagä¸ºä¸»çº¿ç¨‹è¯»å–åˆ°çš„flagï¼Œä¸”æ­¤æ—¶å­çº¿ç¨‹è¿˜æ²¡æœ‰ä¿®æ”¹ 2. 3ç§’åå­çº¿ç¨‹è¿›è¡Œäº†ä¿®æ”¹ï¼Œç”±äºæ²¡æœ‰å†…å­˜å±éšœï¼Œä¸»çº¿ç¨‹ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯ä¸» å­˜å‚¨ï¼Œæ˜¯ä¸»çº¿ç¨‹ï¼‰è¿˜æ˜¯åŸæ¥çš„å€¼ï¼Œå€¼æ²¡æœ‰åˆ·æ–°ï¼Œå¯¼è‡´ä¸ä¸€è‡´ */ if (flag){ System.out.println(\u0026#34;detected flag changed\u0026#34;); break; } //è¿™é‡Œä¸èƒ½æœ‰System.out.printlnè¯­å¥ï¼Œä¸ç„¶ä¼šå¯¼è‡´åŒæ­¥ /* synchronizedçš„è§„å®š çº¿ç¨‹è§£é”å‰,å¿…é¡»æŠŠå…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ çº¿ç¨‹åŠ é”å‰å°†æ¸…ç©ºå·¥ä½œå†…å­˜å…±äº«å˜é‡çš„å€¼,éœ€è¦ä»ä¸»å­˜ä¸­è·å–å…±äº«å˜é‡çš„å€¼ã€‚ */ /** public void println(String x) { synchronized (this) { print(x); newLine(); } } */ } System.out.println(\u0026#34;main thread end\u0026#34;); } //è¿è¡Œç»“æœ subThread change flag to:false detected flag changed main thread end å¦‚æœåˆ é™¤ä¸Šé¢çš„loadFence()æ–¹æ³•ï¼Œå°±ä¼šå‡ºç°ä¸‹é¢çš„æƒ…å†µï¼Œä¸»çº¿ç¨‹æ— æ³•æ„ŸçŸ¥flagå‘ç”Ÿçš„å˜åŒ–ï¼Œä¼šä¸€ç›´åœ¨whileä¸­å¾ªç¯ å…¸å‹åº”ç”¨ Java8æ–°å¼•å…¥çš„é”\u0026mdash;StampedLockï¼Œä¹è§‚é”ï¼Œç±»ä¼¼äºæ— é”çš„æ“ä½œï¼Œå®Œå…¨ä¸ä¼šé˜»å¡å†™çº¿ç¨‹è·å–å†™é”ï¼Œä»è€Œç¼“è§£è¯»å¤šå†™å°‘çš„â€é¥¥é¥¿â€œç°è±¡ã€‚ç”±äºStampedLockæä¾›çš„ä¹è§‚è¯»é”ä¸é˜»å¡å†™çº¿ç¨‹è·å–è¯»é”ï¼Œå½“çº¿ç¨‹å…±äº«å˜é‡ä»ä¸»å†…å­˜loadåˆ°çº¿ç¨‹å·¥ä½œå†…å­˜æ—¶ï¼Œå­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜\n/** StampedLock çš„ validate æ–¹æ³•ä¼šé€šè¿‡ Unsafe çš„ loadFence æ–¹æ³•åŠ å…¥ä¸€ä¸ª load å†…å­˜å±éšœ */ public boolean validate(long stamp) { U.loadFence(); return (stamp \u0026amp; SBITS) == (state \u0026amp; SBITS); } å¯¹è±¡æ“ä½œ # å¯¹è±¡å±æ€§\n//åœ¨å¯¹è±¡çš„æŒ‡å®šåç§»åœ°å€è·å–ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ public native Object getObject(Object o, long offset); //åœ¨å¯¹è±¡æŒ‡å®šåç§»åœ°å€å†™å…¥ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ public native void putObject(Object o, long offset, Object x); å¯¹è±¡å®ä¾‹åŒ– ç±»ï¼š\n@Data public class A { private int b; public A(){ this.b =1; } } å¯¹è±¡å®ä¾‹åŒ–\nå…è®¸æˆ‘ä»¬ä½¿ç”¨éå¸¸è§„çš„æ–¹å¼è¿›è¡Œå¯¹è±¡çš„å®ä¾‹åŒ–\npublic void objTest() throws Exception{ A a1=new A(); System.out.println(a1.getB()); A a2 = A.class.newInstance(); System.out.println(a2.getB()); A a3= (A) unsafe.allocateInstance(A.class); System.out.println(a3.getB()); } //ç»“æœ 1 1 0\n\u0026gt; æ‰“å°ç»“æœåˆ†åˆ«ä¸º 1ã€1ã€0ï¼Œè¯´æ˜é€šè¿‡**`allocateInstance`æ–¹æ³•åˆ›å»ºå¯¹è±¡**è¿‡ç¨‹ä¸­ï¼Œ**ä¸ä¼šè°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•**ã€‚ä½¿ç”¨è¿™ç§æ–¹å¼åˆ›å»ºå¯¹è±¡æ—¶ï¼Œåªç”¨åˆ°äº†`Class`å¯¹è±¡ï¼Œæ‰€ä»¥è¯´å¦‚æœæƒ³è¦**è·³è¿‡å¯¹è±¡çš„åˆå§‹åŒ–é˜¶æ®µ**æˆ–è€…**è·³è¿‡æ„é€ å™¨çš„å®‰å…¨æ£€æŸ¥**ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœå°† A ç±»çš„**æ„é€ å‡½æ•°æ”¹ä¸º`private`**ç±»å‹ï¼Œå°†æ— æ³•é€šè¿‡æ„é€ å‡½æ•°å’Œåå°„åˆ›å»ºå¯¹è±¡ï¼Œä½†**`allocateInstance`æ–¹æ³•ä»ç„¶æœ‰æ•ˆ**ã€‚ - å…¸å‹åº”ç”¨ - å¸¸è§„å¯¹è±¡å®ä¾‹åŒ–æ–¹å¼ï¼Œä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œéƒ½æ˜¯é€šè¿‡newæœºåˆ¶æ¥å®ç°å¯¹è±¡çš„åˆ›å»º - éå¸¸è§„çš„å®ä¾‹åŒ–æ–¹å¼ï¼šUnsafeä¸­æä¾›allocateInstanceæ–¹æ³•ï¼Œ**ä»…é€šè¿‡Classå¯¹è±¡**å°±å¯ä»¥åˆ›å»ºæ­¤ç±»çš„å®ä¾‹å¯¹è±¡ #### æ•°ç»„æ“ä½œ - ä»‹ç» ```java //ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•é…ç½®ä½¿ç”¨ï¼Œå³å¯å®šä½æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ åœ¨å†…å­˜ä¸­çš„ä½ç½® //è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„åç§»åœ°å€ public native int arrayBaseOffset(Class\u0026lt;?\u0026gt; arrayClass); //è¿”å›æ•°ç»„ä¸­ä¸€ä¸ªå…ƒç´ å ç”¨çš„å¤§å° public native int arrayIndexScale(Class\u0026lt;?\u0026gt; arrayClass); å…¸å‹åº”ç”¨\nè¿™ä¸¤ä¸ªä¸æ•°æ®æ“ä½œç›¸å…³çš„æ–¹æ³•ï¼Œåœ¨ java.util.concurrent.atomic åŒ…ä¸‹çš„ AtomicIntegerArrayï¼ˆå¯ä»¥å®ç°å¯¹ Integer æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„åŸå­æ€§æ“ä½œï¼‰ä¸­æœ‰å…¸å‹çš„åº”ç”¨ï¼Œå¦‚ä¸‹å›¾ AtomicIntegerArray æºç æ‰€ç¤ºï¼Œé€šè¿‡ Unsafe çš„ arrayBaseOffset ã€arrayIndexScale åˆ†åˆ«è·å–æ•°ç»„é¦–å…ƒç´ çš„åç§»åœ°å€ base åŠå•ä¸ªå…ƒç´ å¤§å°å› å­ scale ã€‚åç»­ç›¸å…³åŸå­æ€§æ“ä½œï¼Œå‡ä¾èµ–äºè¿™ä¸¤ä¸ªå€¼è¿›è¡Œæ•°ç»„ä¸­å…ƒç´ çš„å®šä½ï¼Œå¦‚ä¸‹å›¾äºŒæ‰€ç¤ºçš„ getAndAdd æ–¹æ³•å³é€šè¿‡ checkedByteOffset æ–¹æ³•è·å–æŸæ•°ç»„å…ƒç´ çš„åç§»åœ°å€ï¼Œè€Œåé€šè¿‡ CAS å®ç°åŸå­æ€§æ“ä½œã€‚\nCASæ“ä½œ # ç›¸å…³æ“ä½œ\n/** * CAS * @param o åŒ…å«è¦ä¿®æ”¹fieldçš„å¯¹è±¡ * @param offset å¯¹è±¡ä¸­æŸfieldçš„åç§»é‡ * @param expected æœŸæœ›å€¼ * @param update æ›´æ–°å€¼ * @return true | false */ public final native boolean compareAndSwapObject(Object o, long offset, Object expected, Object update); public final native boolean compareAndSwapInt(Object o, long offset, int expected,int update); public final native boolean compareAndSwapLong(Object o, long offset, long expected, long update); CASï¼ŒAS å³æ¯”è¾ƒå¹¶æ›¿æ¢ï¼ˆCompare And Swap)ï¼Œæ˜¯å®ç°å¹¶å‘ç®—æ³•æ—¶å¸¸ç”¨åˆ°çš„ä¸€ç§æŠ€æœ¯ã€‚CAS æ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°â€”â€”å†…å­˜ä½ç½®ã€é¢„æœŸåŸå€¼åŠæ–°å€¼ã€‚æ‰§è¡Œ CAS æ“ä½œçš„æ—¶å€™ï¼Œå°†å†…å­˜ä½ç½®çš„å€¼ä¸é¢„æœŸåŸå€¼æ¯”è¾ƒï¼Œå¦‚æœç›¸åŒ¹é…ï¼Œé‚£ä¹ˆå¤„ç†å™¨ä¼šè‡ªåŠ¨å°†è¯¥ä½ç½®å€¼æ›´æ–°ä¸ºæ–°å€¼ï¼Œå¦åˆ™ï¼Œå¤„ç†å™¨ä¸åšä»»ä½•æ“ä½œã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒCAS æ˜¯ä¸€æ¡ CPU çš„åŸå­æŒ‡ä»¤ï¼ˆcmpxchg æŒ‡ä»¤ï¼‰ï¼Œä¸ä¼šé€ æˆæ‰€è°“çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼ŒUnsafe æä¾›çš„ CAS æ–¹æ³•ï¼ˆå¦‚ compareAndSwapXXXï¼‰åº•å±‚å®ç°å³ä¸º CPU æŒ‡ä»¤ cmpxchg\nè¾“å‡º\nprivate volatile int a; public static void main(String[] args){ CasTest casTest=new CasTest(); new Thread(()-\u0026gt;{ /* ä¸€å¼€å§‹a=0çš„æ—¶å€™ï¼Œi=1ï¼Œæ‰€ä»¥a + 1ï¼›ä¹‹å a = 1çš„æ—¶å€™ï¼Œi = 2 ï¼Œæ‰€ä»¥a åˆåŠ 1 ï¼›è€Œå¦‚æœæ˜¯ä¸ç­‰äºçš„è¯ï¼Œå°±ä¼šä¸€ç›´åŸå­è·å–açš„å€¼ï¼Œç›´åˆ°ç­‰äº i -1 */ for (int i = 1; i \u0026lt; 5; i++) { casTest.increment(i); System.out.print(casTest.a+\u0026#34; \u0026#34;); } }).start(); new Thread(()-\u0026gt;{ for (int i = 5 ; i \u0026lt;10 ; i++) { casTest.increment(i); System.out.print(casTest.a+\u0026#34; \u0026#34;); } }).start(); } private void increment(int x){ while (true){ try { long fieldOffset = unsafe.objectFieldOffset(CasTest.class.getDeclaredField(\u0026#34;a\u0026#34;)); if (unsafe.compareAndSwapInt(this,fieldOffset,x-1,x)) break; } catch (NoSuchFieldException e) { e.printStackTrace(); } } } //ç»“æœ 1 2 3 4 5 6 7 8 9 ä½¿ç”¨ä¸¤ä¸ªçº¿ç¨‹å»ä¿®æ”¹intå‹å±æ€§açš„å€¼ï¼Œå¹¶ä¸”åªæœ‰åœ¨açš„å€¼ç­‰äºä¼ å…¥çš„å‚æ•°xå‡ä¸€æ—¶ï¼Œæ‰ä¼šå°†açš„å€¼å˜ä¸ºxï¼Œä¹Ÿå°±æ˜¯å®ç°å¯¹açš„åŠ ä¸€çš„æ“ä½œ çº¿ç¨‹è°ƒåº¦(å¤šçº¿ç¨‹é—®é¢˜) # //Unsafeç±»æä¾›çš„ç›¸å…³æ–¹æ³• //å–æ¶ˆé˜»å¡çº¿ç¨‹ public native void unpark(Object thread); //é˜»å¡çº¿ç¨‹ public native void park(boolean isAbsolute, long time); //è·å¾—å¯¹è±¡é”ï¼ˆå¯é‡å…¥é”ï¼‰ @Deprecated public native void monitorEnter(Object o); //é‡Šæ”¾å¯¹è±¡é” @Deprecated public native void monitorExit(Object o); //å°è¯•è·å–å¯¹è±¡é” @Deprecated public native boolean tryMonitorEnter(Object o); æ–¹æ³• parkã€unpark å³å¯å®ç°çº¿ç¨‹çš„æŒ‚èµ·ä¸æ¢å¤ï¼Œå°†ä¸€ä¸ªçº¿ç¨‹è¿›è¡ŒæŒ‚èµ·æ˜¯é€šè¿‡ park æ–¹æ³•å®ç°çš„ï¼Œè°ƒç”¨ park æ–¹æ³•åï¼Œçº¿ç¨‹å°†ä¸€ç›´é˜»å¡ç›´åˆ°è¶…æ—¶æˆ–è€…ä¸­æ–­ç­‰æ¡ä»¶å‡ºç°ï¼›unpark å¯ä»¥ç»ˆæ­¢ä¸€ä¸ªæŒ‚èµ·çš„çº¿ç¨‹ï¼Œä½¿å…¶æ¢å¤æ­£å¸¸ã€‚\næ­¤å¤–ï¼ŒUnsafe æºç ä¸­monitorç›¸å…³çš„ä¸‰ä¸ªæ–¹æ³•å·²ç»è¢«æ ‡è®°ä¸ºdeprecatedï¼Œä¸å»ºè®®è¢«ä½¿ç”¨ï¼š\n//è·å¾—å¯¹è±¡é” @Deprecated public native void monitorEnter(Object var1); //é‡Šæ”¾å¯¹è±¡é” @Deprecated public native void monitorExit(Object var1); //å°è¯•è·å¾—å¯¹è±¡é” @Deprecated public native boolean tryMonitorEnter(Object var1); monitorEnteræ–¹æ³•ç”¨äºè·å¾—å¯¹è±¡é”ï¼ŒmonitorExitç”¨äºé‡Šæ”¾å¯¹è±¡é”ï¼Œå¦‚æœå¯¹ä¸€ä¸ªæ²¡æœ‰è¢«monitorEnteråŠ é”çš„å¯¹è±¡æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œä¼šæŠ›å‡ºIllegalMonitorStateExceptionå¼‚å¸¸ã€‚tryMonitorEnteræ–¹æ³•å°è¯•è·å–å¯¹è±¡é”ï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å›trueï¼Œåä¹‹è¿”å›falseã€‚\nå…¸å‹æ“ä½œ\nJava é”å’ŒåŒæ­¥å™¨æ¡†æ¶çš„æ ¸å¿ƒç±» AbstractQueuedSynchronizer (AQS)ï¼Œå°±æ˜¯é€šè¿‡è°ƒç”¨**LockSupport.park()å’ŒLockSupport.unpark()å®ç°çº¿ç¨‹çš„é˜»å¡å’Œå”¤é†’**çš„ï¼Œè€Œ LockSupport çš„ park ã€unpark æ–¹æ³•å®é™…æ˜¯è°ƒç”¨ Unsafe çš„ park ã€unpark æ–¹å¼å®ç°çš„ã€‚\npublic static void park(Object blocker) { Thread t = Thread.currentThread(); setBlocker(t, blocker); UNSAFE.park(false, 0L); setBlocker(t, null); } public static void unpark(Thread thread) { if (thread != null) UNSAFE.unpark(thread); } LockSupport çš„parkæ–¹æ³•è°ƒç”¨äº† Unsafe çš„parkæ–¹æ³•æ¥é˜»å¡å½“å‰çº¿ç¨‹ï¼Œæ­¤æ–¹æ³•å°†çº¿ç¨‹é˜»å¡åå°±ä¸ä¼šç»§ç»­å¾€åæ‰§è¡Œï¼Œç›´åˆ°æœ‰å…¶ä»–çº¿ç¨‹è°ƒç”¨unparkæ–¹æ³•å”¤é†’å½“å‰çº¿ç¨‹ã€‚ä¸‹é¢çš„ä¾‹å­å¯¹ Unsafe çš„è¿™ä¸¤ä¸ªæ–¹æ³•è¿›è¡Œæµ‹è¯•ï¼š\npublic static void main(String[] args) { Thread mainThread = Thread.currentThread(); new Thread(()-\u0026gt;{ try { TimeUnit.SECONDS.sleep(5); //5såå”¤é†’mainçº¿ç¨‹ System.out.println(\u0026#34;subThread try to unpark mainThread\u0026#34;); unsafe.unpark(mainThread); } catch (InterruptedException e) { e.printStackTrace(); } }).start(); System.out.println(\u0026#34;park main mainThread\u0026#34;); unsafe.park(false,0L); System.out.println(\u0026#34;unpark mainThread success\u0026#34;); } //è¾“å‡º park main mainThread subThread try to unpark mainThread unpark mainThread success æµç¨‹å›¾å¦‚ä¸‹ï¼š\nClassæ“ä½œ # Unsafeå¯¹classçš„ç›¸å…³æ“ä½œä¸»è¦åŒ…æ‹¬ç±»åŠ è½½å’Œé™æ€å˜é‡çš„æ“ä½œæ–¹æ³•\né™æ€å±æ€§è¯»å–ç›¸å…³çš„æ–¹æ³•\n//è·å–é™æ€å±æ€§çš„åç§»é‡ public native long staticFieldOffset(Field f); //è·å–é™æ€å±æ€§çš„å¯¹è±¡æŒ‡é’ˆ---å¦ä¸€è¯´,è·å–é™æ€å˜é‡æ‰€å±çš„ç±»åœ¨æ–¹æ³•åŒºçš„é¦–åœ°å€ public native Object staticFieldBase(Field f); //åˆ¤æ–­ç±»æ˜¯å¦éœ€è¦å®ä¾‹åŒ–ï¼ˆç”¨äºè·å–ç±»çš„é™æ€å±æ€§å‰è¿›è¡Œæ£€æµ‹ï¼‰ public native boolean shouldBeInitialized(Class\u0026lt;?\u0026gt; c); æµ‹è¯•\n@Data public class User { public static String name=\u0026#34;Hydra\u0026#34;; int age; } private void staticTest() throws Exception { User user=new User(); System.out.println(unsafe.shouldBeInitialized(User.class)); Field sexField = User.class.getDeclaredField(\u0026#34;name\u0026#34;);//è·å–åˆ°é™æ€å±æ€§ long fieldOffset = unsafe.staticFieldOffset(sexField);//è·å–é™æ€å±æ€§çš„åç§»é‡ Object fieldBase = unsafe.staticFieldBase(sexField); //è·å–é™æ€å±æ€§å¯¹åº”çš„æ˜¯å“ªä¸ªç±» Object object = unsafe.getObject(fieldBase, fieldOffset);//è·å–åˆ°é™æ€å±æ€§ å¯¹è±¡ System.out.println(object); } /** è¿è¡Œç»“æœ:falseHydra */ åœ¨ Unsafe çš„å¯¹è±¡æ“ä½œä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†é€šè¿‡objectFieldOffsetæ–¹æ³•è·å–å¯¹è±¡å±æ€§åç§»é‡å¹¶åŸºäºå®ƒå¯¹å˜é‡çš„å€¼è¿›è¡Œå­˜å–ï¼Œä½†æ˜¯å®ƒä¸é€‚ç”¨äºç±»ä¸­çš„é™æ€å±æ€§ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨staticFieldOffsetæ–¹æ³•ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œåªæœ‰åœ¨è·å–Fieldå¯¹è±¡çš„è¿‡ç¨‹ä¸­ä¾èµ–åˆ°äº†Classï¼Œè€Œè·å–é™æ€å˜é‡çš„å±æ€§æ—¶ä¸å†ä¾èµ–äºClassã€‚\nåœ¨ä¸Šé¢çš„ä»£ç ä¸­é¦–å…ˆåˆ›å»ºä¸€ä¸ªUserå¯¹è±¡ï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰è¢«å®ä¾‹åŒ–ï¼Œé‚£ä¹ˆå®ƒçš„é™æ€å±æ€§ä¹Ÿä¸ä¼šè¢«åˆå§‹åŒ–ï¼Œæœ€åè·å–çš„å­—æ®µå±æ€§å°†æ˜¯null(å¦‚æœç›´æ¥ä½¿ç”¨User.name ï¼Œé‚£ä¹ˆæ˜¯ä¼šå¯¼è‡´ç±»è¢«åˆå§‹åŒ–çš„ï¼‰ã€‚æ‰€ä»¥åœ¨è·å–é™æ€å±æ€§å‰ï¼Œéœ€è¦è°ƒç”¨shouldBeInitializedæ–¹æ³•ï¼Œåˆ¤æ–­åœ¨è·å–å‰æ˜¯å¦éœ€è¦åˆå§‹åŒ–è¿™ä¸ªç±»ã€‚å¦‚æœåˆ é™¤åˆ›å»º User å¯¹è±¡çš„è¯­å¥ï¼Œè¿è¡Œç»“æœä¼šå˜ä¸ºï¼štruenull\ndefineClassæ–¹æ³•å…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºä¸€ä¸ªç±»\npublic native Class\u0026lt;?\u0026gt; defineClass(String name, byte[] b, int off, int len, ClassLoader loader,ProtectionDomain protectionDomain); åˆ©ç”¨classç±»å­—èŠ‚ç æ–‡ä»¶ï¼ŒåŠ¨æ€åˆ›å»ºä¸€ä¸ªç±»\nprivate static void defineTest() { String fileName=\u0026#34;F:\\\\workspace\\\\unsafe-test\\\\target\\\\classes\\\\com\\\\cn\\\\model\\\\User.class\u0026#34;; File file = new File(fileName); try(FileInputStream fis = new FileInputStream(file)) { byte[] content=new byte[(int)file.length()]; fis.read(content); Class clazz = unsafe.defineClass(null, content, 0, content.length, null, null); Object o = clazz.newInstance(); Object age = clazz.getMethod(\u0026#34;getAge\u0026#34;).invoke(o, null); System.out.println(age); } catch (Exception e) { e.printStackTrace(); } } ç³»ç»Ÿä¿¡æ¯ # //è·å–ç³»ç»Ÿç›¸å…³ä¿¡æ¯ //è¿”å›ç³»ç»ŸæŒ‡é’ˆçš„å¤§å°ã€‚è¿”å›å€¼ä¸º4ï¼ˆ32ä½ç³»ç»Ÿï¼‰æˆ– 8ï¼ˆ64ä½ç³»ç»Ÿï¼‰ã€‚ ã€åº”è¯¥æ˜¯å­—èŠ‚æ•°ã€‘ public native int addressSize(); //å†…å­˜é¡µçš„å¤§å°ï¼Œæ­¤å€¼ä¸º2çš„å¹‚æ¬¡æ–¹ã€‚ public native int pageSize(); "},{"id":156,"href":"/zh/docs/study/Review/java_guide/java/Basic/ly0008lybig_decimal/","title":"big_decimal","section":"åŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nç²¾åº¦çš„ä¸¢å¤± # float a = 2.0f - 1.9f; float b = 1.8f - 1.7f; System.out.println(a);// 0.100000024 System.out.println(b);// 0.099999905 System.out.println(a == b);// false ä¸ºä»€ä¹ˆä¼šæœ‰ç²¾åº¦ä¸¢å¤±çš„é£é™©\nè¿™ä¸ªå’Œè®¡ç®—æœºä¿å­˜æµ®ç‚¹æ•°çš„æœºåˆ¶æœ‰å¾ˆå¤§å…³ç³»ã€‚æˆ‘ä»¬çŸ¥é“è®¡ç®—æœºæ˜¯äºŒè¿›åˆ¶çš„ï¼Œè€Œä¸”è®¡ç®—æœºåœ¨è¡¨ç¤ºä¸€ä¸ªæ•°å­—æ—¶ï¼Œå®½åº¦æ˜¯æœ‰é™çš„ï¼Œæ— é™å¾ªç¯çš„å°æ•°å­˜å‚¨åœ¨è®¡ç®—æœºæ—¶ï¼Œåªèƒ½è¢«æˆªæ–­ï¼Œæ‰€ä»¥å°±ä¼šå¯¼è‡´å°æ•°ç²¾åº¦å‘ç”ŸæŸå¤±çš„æƒ…å†µã€‚è¿™ä¹Ÿå°±æ˜¯è§£é‡Šäº†ä¸ºä»€ä¹ˆæµ®ç‚¹æ•°æ²¡æœ‰åŠæ³•ç”¨äºŒè¿›åˆ¶ç²¾ç¡®è¡¨ç¤º\nä½¿ç”¨BigDecimalæ¥å®šä¹‰æµ®ç‚¹æ•°çš„å€¼ï¼Œç„¶åå†è¿›è¡Œæµ®ç‚¹æ•°çš„è¿ç®—æ“ä½œå³å¯\nBigDecimalå¸¸è§æ–¹æ³• # æˆ‘ä»¬åœ¨ä½¿ç”¨ BigDecimal æ—¶ï¼Œä¸ºäº†é˜²æ­¢ç²¾åº¦ä¸¢å¤±ï¼Œæ¨èä½¿ç”¨å®ƒçš„BigDecimal(String val)æ„é€ æ–¹æ³•æˆ–è€… BigDecimal.valueOf(double val) é™æ€æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡\nåŠ å‡ä¹˜é™¤\nBigDecimal a = new BigDecimal(\u0026#34;1.0\u0026#34;); BigDecimal b = new BigDecimal(\u0026#34;0.9\u0026#34;); System.out.println(a.add(b));// 1.9 System.out.println(a.subtract(b));// 0.1 System.out.println(a.multiply(b));// 0.90 System.out.println(a.divide(b));// æ— æ³•é™¤å°½ï¼ŒæŠ›å‡º ArithmeticException å¼‚å¸¸ System.out.println(a.divide(b, 2, RoundingMode.HALF_UP));// 1.11 ä½¿ç”¨divideæ–¹æ³•çš„æ—¶å€™ï¼Œå°½é‡ä½¿ç”¨3ä¸ªå‚æ•°ç‰ˆæœ¬ï¼ˆroundingMode.oldMode)\nä¿ç•™è§„åˆ™\npublic enum RoundingMode { // 2.5 -\u0026gt; 3 , 1.6 -\u0026gt; 2 // -1.6 -\u0026gt; -2 , -2.5 -\u0026gt; -3 UP(BigDecimal.ROUND_UP), //æ•°è½´ä¸Šé è¿‘å“ªä¸ªå–å“ªä¸ª // 2.5 -\u0026gt; 2 , 1.6 -\u0026gt; 1 // -1.6 -\u0026gt; -1 , -2.5 -\u0026gt; -2 DOWN(BigDecimal.ROUND_DOWN), //æ•°è½´ä¸Šç¦»å“ªä¸ªè¿œå–å“ªä¸ª // 2.5 -\u0026gt; 3 , 1.6 -\u0026gt; 2 // -1.6 -\u0026gt; -1 , -2.5 -\u0026gt; -2 CEILING(BigDecimal.ROUND_CEILING), // 2.5 -\u0026gt; 2 , 1.6 -\u0026gt; 1 // -1.6 -\u0026gt; -2 , -2.5 -\u0026gt; -3 FLOOR(BigDecimal.ROUND_FLOOR), ////æ•°è½´ä¸Š æ­£æ•°ï¼šè¿œç¦»å“ªä¸ªå–å“ªä¸ª è´Ÿæ•°ï¼šé è¿‘å“ªä¸ªå–å“ªä¸ª // 2.5 -\u0026gt; 3 , 1.6 -\u0026gt; 2 // -1.6 -\u0026gt; -2 , -2.5 -\u0026gt; -3 HALF_UP(BigDecimal.ROUND_HALF_UP),// æ•°è½´ä¸Š æ­£æ•°ï¼šé è¿‘å“ªä¸ªå–å“ªä¸ª è´Ÿæ•°ï¼šè¿œç¦»å“ªä¸ªå–å“ªä¸ª //...... } å¤§å°æ¯”è¾ƒ\nä½¿ç”¨compareTo\nBigDecimal a = new BigDecimal(\u0026#34;1.0\u0026#34;); BigDecimal b = new BigDecimal(\u0026#34;0.9\u0026#34;); System.out.println(a.compareTo(b));// 1 ä¿ç•™å‡ ä½å°æ•°\nBigDecimal m = new BigDecimal(\u0026#34;1.255433\u0026#34;); BigDecimal n = m.setScale(3,RoundingMode.HALF_DOWN); System.out.println(n);// 1.255 ä½¿ç”¨compareToæ›¿æ¢equalsæ–¹æ³•ï¼Œequalsä¸æ­¢ä¼šæ¯”è¾ƒç›´ï¼Œè¿˜ä¼šæ¯”è¾ƒç²¾åº¦ BigDecimalå·¥å…·ç±»åˆ†äº« (ç”¨æ¥æ“ä½œdoubleç®—æœ¯)\nimport java.math.BigDecimal; import java.math.RoundingMode; /** * ç®€åŒ–BigDecimalè®¡ç®—çš„å°å·¥å…·ç±» */ public class BigDecimalUtil { /** * é»˜è®¤é™¤æ³•è¿ç®—ç²¾åº¦ */ private static final int DEF_DIV_SCALE = 10; private BigDecimalUtil() { } /** * æä¾›ç²¾ç¡®çš„åŠ æ³•è¿ç®—ã€‚ * * @param v1 è¢«åŠ æ•° * @param v2 åŠ æ•° * @return ä¸¤ä¸ªå‚æ•°çš„å’Œ */ public static double add(double v1, double v2) { BigDecimal b1 = BigDecimal.valueOf(v1); BigDecimal b2 = BigDecimal.valueOf(v2); return b1.add(b2).doubleValue(); } /** * æä¾›ç²¾ç¡®çš„å‡æ³•è¿ç®—ã€‚ * * @param v1 è¢«å‡æ•° * @param v2 å‡æ•° * @return ä¸¤ä¸ªå‚æ•°çš„å·® */ public static double subtract(double v1, double v2) { BigDecimal b1 = BigDecimal.valueOf(v1); BigDecimal b2 = BigDecimal.valueOf(v2); return b1.subtract(b2).doubleValue(); } /** * æä¾›ç²¾ç¡®çš„ä¹˜æ³•è¿ç®—ã€‚ * * @param v1 è¢«ä¹˜æ•° * @param v2 ä¹˜æ•° * @return ä¸¤ä¸ªå‚æ•°çš„ç§¯ */ public static double multiply(double v1, double v2) { BigDecimal b1 = BigDecimal.valueOf(v1); BigDecimal b2 = BigDecimal.valueOf(v2); return b1.multiply(b2).doubleValue(); } /** * æä¾›ï¼ˆç›¸å¯¹ï¼‰ç²¾ç¡®çš„é™¤æ³•è¿ç®—ï¼Œå½“å‘ç”Ÿé™¤ä¸å°½çš„æƒ…å†µæ—¶ï¼Œç²¾ç¡®åˆ° * å°æ•°ç‚¹ä»¥å10ä½ï¼Œä»¥åçš„æ•°å­—å››èˆäº”å…¥ã€‚ * * @param v1 è¢«é™¤æ•° * @param v2 é™¤æ•° * @return ä¸¤ä¸ªå‚æ•°çš„å•† */ public static double divide(double v1, double v2) { return divide(v1, v2, DEF_DIV_SCALE); } /** * æä¾›ï¼ˆç›¸å¯¹ï¼‰ç²¾ç¡®çš„é™¤æ³•è¿ç®—ã€‚å½“å‘ç”Ÿé™¤ä¸å°½çš„æƒ…å†µæ—¶ï¼Œç”±scaleå‚æ•°æŒ‡ * å®šç²¾åº¦ï¼Œä»¥åçš„æ•°å­—å››èˆäº”å…¥ã€‚ * * @param v1 è¢«é™¤æ•° * @param v2 é™¤æ•° * @param scale è¡¨ç¤ºè¡¨ç¤ºéœ€è¦ç²¾ç¡®åˆ°å°æ•°ç‚¹ä»¥åå‡ ä½ã€‚ * @return ä¸¤ä¸ªå‚æ•°çš„å•† */ public static double divide(double v1, double v2, int scale) { if (scale \u0026lt; 0) { throw new IllegalArgumentException( \u0026#34;The scale must be a positive integer or zero\u0026#34;); } BigDecimal b1 = BigDecimal.valueOf(v1); BigDecimal b2 = BigDecimal.valueOf(v2); return b1.divide(b2, scale, RoundingMode.HALF_UP).doubleValue(); } /** * æä¾›ç²¾ç¡®çš„å°æ•°ä½å››èˆäº”å…¥å¤„ç†ã€‚ * * @param v éœ€è¦å››èˆäº”å…¥çš„æ•°å­— * @param scale å°æ•°ç‚¹åä¿ç•™å‡ ä½ * @return å››èˆäº”å…¥åçš„ç»“æœ */ public static double round(double v, int scale) { if (scale \u0026lt; 0) { throw new IllegalArgumentException( \u0026#34;The scale must be a positive integer or zero\u0026#34;); } BigDecimal b = BigDecimal.valueOf(v); BigDecimal one = new BigDecimal(\u0026#34;1\u0026#34;); return b.divide(one, scale, RoundingMode.HALF_UP).doubleValue(); } /** * æä¾›ç²¾ç¡®çš„ç±»å‹è½¬æ¢(Float) * * @param v éœ€è¦è¢«è½¬æ¢çš„æ•°å­— * @return è¿”å›è½¬æ¢ç»“æœ */ public static float convertToFloat(double v) { BigDecimal b = new BigDecimal(v); return b.floatValue(); } /** * æä¾›ç²¾ç¡®çš„ç±»å‹è½¬æ¢(Int)ä¸è¿›è¡Œå››èˆäº”å…¥ * * @param v éœ€è¦è¢«è½¬æ¢çš„æ•°å­— * @return è¿”å›è½¬æ¢ç»“æœ */ public static int convertsToInt(double v) { BigDecimal b = new BigDecimal(v); return b.intValue(); } /** * æä¾›ç²¾ç¡®çš„ç±»å‹è½¬æ¢(Long) * * @param v éœ€è¦è¢«è½¬æ¢çš„æ•°å­— * @return è¿”å›è½¬æ¢ç»“æœ */ public static long convertsToLong(double v) { BigDecimal b = new BigDecimal(v); return b.longValue(); } /** * è¿”å›ä¸¤ä¸ªæ•°ä¸­å¤§çš„ä¸€ä¸ªå€¼ * * @param v1 éœ€è¦è¢«å¯¹æ¯”çš„ç¬¬ä¸€ä¸ªæ•° * @param v2 éœ€è¦è¢«å¯¹æ¯”çš„ç¬¬äºŒä¸ªæ•° * @return è¿”å›ä¸¤ä¸ªæ•°ä¸­å¤§çš„ä¸€ä¸ªå€¼ */ public static double returnMax(double v1, double v2) { BigDecimal b1 = new BigDecimal(v1); BigDecimal b2 = new BigDecimal(v2); return b1.max(b2).doubleValue(); } /** * è¿”å›ä¸¤ä¸ªæ•°ä¸­å°çš„ä¸€ä¸ªå€¼ * * @param v1 éœ€è¦è¢«å¯¹æ¯”çš„ç¬¬ä¸€ä¸ªæ•° * @param v2 éœ€è¦è¢«å¯¹æ¯”çš„ç¬¬äºŒä¸ªæ•° * @return è¿”å›ä¸¤ä¸ªæ•°ä¸­å°çš„ä¸€ä¸ªå€¼ */ public static double returnMin(double v1, double v2) { BigDecimal b1 = new BigDecimal(v1); BigDecimal b2 = new BigDecimal(v2); return b1.min(b2).doubleValue(); } /** * ç²¾ç¡®å¯¹æ¯”ä¸¤ä¸ªæ•°å­— * * @param v1 éœ€è¦è¢«å¯¹æ¯”çš„ç¬¬ä¸€ä¸ªæ•° * @param v2 éœ€è¦è¢«å¯¹æ¯”çš„ç¬¬äºŒä¸ªæ•° * @return å¦‚æœä¸¤ä¸ªæ•°ä¸€æ ·åˆ™è¿”å›0ï¼Œå¦‚æœç¬¬ä¸€ä¸ªæ•°æ¯”ç¬¬äºŒä¸ªæ•°å¤§åˆ™è¿”å›1ï¼Œåä¹‹è¿”å›-1 */ public static int compareTo(double v1, double v2) { BigDecimal b1 = BigDecimal.valueOf(v1); BigDecimal b2 = BigDecimal.valueOf(v2); return b1.compareTo(b2); } } "},{"id":157,"href":"/zh/docs/study/Review/java_guide/java/Basic/ly0007lyproxy_pattern/","title":"Javaä»£ç†æ¨¡å¼","section":"åŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nä»£ç†æ¨¡å¼ # ä½¿ç”¨ä»£ç†å¯¹è±¡æ¥ä»£æ›¿å¯¹çœŸå®å¯¹è±¡çš„è®¿é—®ï¼Œå°±å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸç›®æ ‡å¯¹è±¡çš„å‰æä¸‹æä¾›é¢å¤–çš„åŠŸèƒ½æ“ä½œï¼Œæ‰©å±•ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½ï¼Œå³åœ¨ç›®æ ‡å¯¹è±¡çš„æŸä¸ªæ–¹æ³•æ‰§è¡Œå‰åå¯ä»¥å¢åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œ\né™æ€ä»£ç† # é™æ€ä»£ç†ä¸­ï¼Œæˆ‘ä»¬å¯¹ç›®æ ‡å¯¹è±¡çš„æ¯ä¸ªæ–¹æ³•çš„å¢å¼ºéƒ½æ˜¯æ‰‹åŠ¨å®Œæˆçš„ï¼ˆ*åé¢ä¼šå…·ä½“æ¼”ç¤ºä»£ç *ï¼‰ï¼Œéå¸¸ä¸çµæ´»ï¼ˆ*æ¯”å¦‚æ¥å£ä¸€æ—¦æ–°å¢åŠ æ–¹æ³•ï¼Œç›®æ ‡å¯¹è±¡å’Œä»£ç†å¯¹è±¡éƒ½è¦è¿›è¡Œä¿®æ”¹*ï¼‰ä¸”éº»çƒ¦(*éœ€è¦å¯¹æ¯ä¸ªç›®æ ‡ç±»éƒ½å•ç‹¬å†™ä¸€ä¸ªä»£ç†ç±»*ï¼‰ã€‚ å®é™…åº”ç”¨åœºæ™¯éå¸¸éå¸¸å°‘ï¼Œæ—¥å¸¸å¼€å‘å‡ ä¹çœ‹ä¸åˆ°ä½¿ç”¨é™æ€ä»£ç†çš„åœºæ™¯ã€‚\nä¸Šé¢æˆ‘ä»¬æ˜¯ä»å®ç°å’Œåº”ç”¨è§’åº¦æ¥è¯´çš„é™æ€ä»£ç†ï¼Œä» JVM å±‚é¢æ¥è¯´ï¼Œ é™æ€ä»£ç†åœ¨ç¼–è¯‘æ—¶å°±å°†æ¥å£ã€å®ç°ç±»ã€ä»£ç†ç±»è¿™äº›éƒ½å˜æˆäº†ä¸€ä¸ªä¸ªå®é™…çš„ class æ–‡ä»¶ã€‚\nå®šä¹‰ä¸€ä¸ªæ¥å£åŠå…¶å®ç°ç±»ï¼› åˆ›å»ºä¸€ä¸ªä»£ç†ç±»åŒæ ·å®ç°è¿™ä¸ªæ¥å£ å°†ç›®æ ‡å¯¹è±¡æ³¨å…¥è¿›ä»£ç†ç±»ï¼Œç„¶ååœ¨ä»£ç†ç±»çš„å¯¹åº”æ–¹æ³•è°ƒç”¨ç›®æ ‡ç±»ä¸­çš„å¯¹åº”æ–¹æ³•ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä»£ç†ç±»å±è”½å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰ååšä¸€äº›è‡ªå·±æƒ³åšçš„äº‹æƒ…ã€‚ ä»£ç :\n//å®šä¹‰å‘é€çŸ­ä¿¡çš„æ¥å£ public interface SmsService { String send(String message); } //å®ç°å‘é€çŸ­ä¿¡çš„æ¥å£ public class SmsServiceImpl implements SmsService { public String send(String message) { System.out.println(\u0026#34;send message:\u0026#34; + message); return message; } } //åˆ›å»ºä»£ç†ç±»å¹¶åŒæ ·å®ç°å‘é€çŸ­ä¿¡çš„æ¥å£ public class SmsProxy implements SmsService { private final SmsService smsService; public SmsProxy(SmsService smsService) { this.smsService = smsService; } @Override public String send(String message) { //è°ƒç”¨æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ System.out.println(\u0026#34;before method send()\u0026#34;); smsService.send(message); //è°ƒç”¨æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ System.out.println(\u0026#34;after method send()\u0026#34;); return null; } } //å®é™…ä½¿ç”¨ public class Main { public static void main(String[] args) { SmsService smsService = new SmsServiceImpl(); SmsProxy smsProxy = new SmsProxy(smsService); smsProxy.send(\u0026#34;java\u0026#34;); } } //æ‰“å°ç»“æœ before method send() send message:java after method send() åŠ¨æ€ä»£ç† # ä»JVMè§’åº¦æ¥è¯´ï¼ŒåŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆç±»å­—èŠ‚ç ï¼Œå¹¶åŠ è½½åˆ°JVMä¸­çš„ã€‚ SpringAOPå’ŒRPCç­‰æ¡†æ¶éƒ½å®ç°äº†åŠ¨æ€ä»£ç†\nJDKåŠ¨æ€ä»£ç† # //å®šä¹‰å¹¶å‘é€çŸ­ä¿¡çš„æ¥å£ public interface SmsService { String send(String message); } public class SmsServiceImpl implements SmsService { public String send(String message) { System.out.println(\u0026#34;send message:\u0026#34; + message); return message; } } //JDKåŠ¨æ€ä»£ç†ç±» import java.lang.reflect.InvocationHandler; import java.lang.reflect.InvocationTargetException; import java.lang.reflect.Method; /** * @author shuang.kou * @createTime 2020å¹´05æœˆ11æ—¥ 11:23:00 */ public class DebugInvocationHandler implements InvocationHandler { /** * ä»£ç†ç±»ä¸­çš„çœŸå®å¯¹è±¡ */ private final Object target; public DebugInvocationHandler(Object target) { this.target = target; }ã€ public Object invoke(Object proxy, Method method, Object[] args) throws InvocationTargetException, IllegalAccessException { //è°ƒç”¨æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ System.out.println(\u0026#34;before method \u0026#34; + method.getName()); Object result = method.invoke(target, args); //è°ƒç”¨æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ System.out.println(\u0026#34;after method \u0026#34; + method.getName()); return result; } } å½“æˆ‘ä»¬çš„åŠ¨æ€ä»£ç†å¯¹è±¡è°ƒç”¨åŸæ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šè°ƒç”¨çš„invoke()ï¼Œç„¶åinvokeä»£æ›¿æˆ‘ä»¬è°ƒç”¨äº†è¢«ä»£ç†å¯¹è±¡çš„åŸç”Ÿæ–¹æ³•\n//å·¥å‚ç±»åŠå®é™…ä½¿ç”¨ public class JdkProxyFactory { public static Object getProxy(Object target) { return Proxy.newProxyInstance( target.getClass().getClassLoader(), // ç›®æ ‡ç±»çš„ç±»åŠ è½½å™¨ target.getClass().getInterfaces(), // ä»£ç†éœ€è¦å®ç°çš„æ¥å£ï¼Œå¯æŒ‡å®šå¤šä¸ª new DebugInvocationHandler(target) // ä»£ç†å¯¹è±¡å¯¹åº”çš„è‡ªå®šä¹‰ InvocationHandler ); } } //å®é™…ä½¿ç”¨ SmsService smsService = (SmsService) JdkProxyFactory.getProxy(new SmsServiceImpl()); smsService.send(\u0026#34;java\u0026#34;); //è¾“å‡º before method send send message:java after method send CGLIBåŠ¨æ€ä»£ç†æœºåˆ¶ # JDKåŠ¨æ€ä»£ç†é—®é¢˜ï¼šåªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»Spring çš„AOPä¸­ï¼Œå¦‚æœä½¿ç”¨äº†æ¥å£ï¼Œåˆ™ä½¿ç”¨JDKåŠ¨æ€ä»£ç†ï¼›å¦åˆ™é‡‡ç”¨CGLB\nç»§æ‰¿\næ ¸å¿ƒæ˜¯Enhancerç±»åŠMethodInterceptoræ¥å£\npublic interface MethodInterceptor extends Callback{ // æ‹¦æˆªè¢«ä»£ç†ç±»ä¸­çš„æ–¹æ³• public Object intercept(Object obj, java.lang.reflect.Method method, Object[] args,MethodProxy proxy) throws Throwable; } å¯¹è±¡ï¼Œè¢«æ‹¦æˆªæ–¹æ³•ï¼Œå‚æ•°ï¼Œè°ƒç”¨åŸå§‹æ–¹æ³•\nå®ä¾‹\n//å®šä¹‰ä¸€ä¸ªç±»ï¼ŒåŠæ–¹æ³•æ‹¦æˆªå™¨ package github.javaguide.dynamicProxy.cglibDynamicProxy; public class AliSmsSer pvice { public String send(String message) { System.out.println(\u0026#34;send message:\u0026#34; + message); return message; } } //MethodInterceptor ï¼ˆæ–¹æ³•æ‹¦æˆªå™¨ï¼‰ import net.sf.cglib.proxy.MethodInterceptor; import net.sf.cglib.proxy.MethodProxy; import java.lang.reflect.Method; /** * è‡ªå®šä¹‰MethodInterceptor */ public class DebugMethodInterceptor implements MethodInterceptor { /** * @param o ä»£ç†å¯¹è±¡ï¼ˆå¢å¼ºçš„å¯¹è±¡ï¼‰ * @param method è¢«æ‹¦æˆªçš„æ–¹æ³•ï¼ˆéœ€è¦å¢å¼ºçš„æ–¹æ³•ï¼‰ * @param args æ–¹æ³•å…¥å‚ * @param methodProxy ç”¨äºè°ƒç”¨åŸå§‹æ–¹æ³• */ @Override public Object intercept(Object o, Method method, Object[] args, MethodProxy methodProxy) throws Throwable { //è°ƒç”¨æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ System.out.println(\u0026#34;before method \u0026#34; + method.getName()); Object object = methodProxy.invokeSuper(o, args); //è°ƒç”¨æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ System.out.println(\u0026#34;after method \u0026#34; + method.getName()); return object; } } // è·å–ä»£ç†ç±» import net.sf.cglib.proxy.Enhancer; public class CglibProxyFactory { public static Object getProxy(Class\u0026lt;?\u0026gt; clazz) { // åˆ›å»ºåŠ¨æ€ä»£ç†å¢å¼ºç±» Enhancer enhancer = new Enhancer(); // è®¾ç½®ç±»åŠ è½½å™¨ enhancer.setClassLoader(clazz.getClassLoader()); // è®¾ç½®è¢«ä»£ç†ç±» enhancer.setSuperclass(clazz); // è®¾ç½®æ–¹æ³•æ‹¦æˆªå™¨ enhancer.setCallback(new DebugMethodInterceptor()); // åˆ›å»ºä»£ç†ç±» return enhancer.create(); } } //å®é™…ä½¿ç”¨ AliSmsService aliSmsService = (AliSmsService) CglibProxyFactory.getProxy(AliSmsService.class); aliSmsService.send(\u0026#34;java\u0026#34;); å¯¹æ¯” # çµæ´»æ€§ï¼šåŠ¨æ€ä»£ç†æ›´ä¸ºçµæ´»ï¼Œä¸”ä¸éœ€è¦å®ç°æ¥å£ï¼Œå¯ä»¥ç›´æ¥ä»£ç†å®ç°ç±»ï¼Œå¹¶ä¸”ä¸éœ€è¦é’ˆå¯¹æ¯ä¸ªå¯¹è±¡éƒ½åˆ›å»ºä»£ç†ç±»ï¼›ä¸€æ—¦æ·»åŠ æ–¹æ³•ï¼ŒåŠ¨æ€ä»£ç†ç±»ä¸éœ€è¦ä¿®æ”¹ï¼› JVMå±‚é¢ï¼šé™æ€ä»£ç†åœ¨ç¼–è¯‘æ—¶å°±å°†æ¥å£ã€å®ç°ç±»å˜æˆå®é™…çš„classæ–‡ä»¶ï¼Œè€ŒåŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶ç”ŸæˆåŠ¨æ€ç±»å­—èŠ‚ç ï¼Œå¹¶åŠ è½½åˆ°JVMä¸­ "},{"id":158,"href":"/zh/docs/study/Review/java_guide/java/Basic/ly0006lyreflex/","title":"java-reflex","section":"åŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nä½•ä¸ºåå°„ # èµ‹äºˆäº†æˆ‘ä»¬åœ¨è¿è¡Œæ—¶åˆ†æç±»ä»¥åŠæ‰§è¡Œç±»ä¸­æ–¹æ³•çš„èƒ½åŠ›ï¼›è¿è¡Œä¸­è·å–ä»»æ„ä¸€ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œä»¥åŠè°ƒç”¨è¿™äº›æ–¹æ³•å’Œå±æ€§\nåº”ç”¨åœºæ™¯ # Spring/Spring Boot ã€MyBatisç­‰æ¡†æ¶éƒ½ç”¨äº†å¤§é‡åå°„æœºåˆ¶ï¼Œä»¥ä¸‹ä¸º\nJDKåŠ¨æ€ä»£ç†\næ¥å£åŠå®ç°ç±»\npackage proxy; public interface Car { public void run(); } //å®ç°ç±» package proxy; public class CarImpl implements Car{ public void run() { System.out.println(\u0026#34;car running\u0026#34;); } } ä»£ç†ç±» åŠmainæ–¹æ³•ä½¿ç”¨ [ËŒÉªnvÉ™ËˆkeÉªÊƒn] ç¥ˆç¥·\npackage proxy; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; //JDKåŠ¨æ€ä»£ç†ä»£ç†ç±» public class CarHandler implements InvocationHandler{ //çœŸå®ç±»çš„å¯¹è±¡ private Object car; //æ„é€ æ–¹æ³•èµ‹å€¼ç»™çœŸå®çš„ç±» public CarHandler(Object obj){ this.car = obj; } //ä»£ç†ç±»æ‰§è¡Œæ–¹æ³•æ—¶ï¼Œè°ƒç”¨çš„æ˜¯è¿™ä¸ªæ–¹æ³• public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { System.out.println(\u0026#34;before\u0026#34;); Object res = method.invoke(car, args); System.out.println(\u0026#34;after\u0026#34;); return res; } } //mainæ–¹æ³•ä½¿ç”¨ package proxy; import java.lang.reflect.Proxy; public class main { public static void main(String[] args) { CarImpl carImpl = new CarImpl(); CarHandler carHandler = new CarHandler(carImpl); Car proxy = (Car)Proxy.newProxyInstance( main.class.getClassLoader(), //ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè·å–ClassLoader carImpl.getClass().getInterfaces(), //ç¬¬äºŒä¸ªå‚æ•°ï¼Œè·å–è¢«ä»£ç†ç±»çš„æ¥å£ carHandler);//ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä¸€ä¸ªInvocationHandlerå¯¹è±¡ï¼Œè¡¨ç¤ºçš„æ˜¯å½“æˆ‘è¿™ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡åœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå…³è”åˆ°å“ªä¸€ä¸ªInvocationHandlerå¯¹è±¡ä¸Š proxy.run(); } } //è¾“å‡º before car running after CglibåŠ¨æ€ä»£ç†ï¼ˆæ²¡æœ‰å®ç°æ¥å£çš„Car\nç±»\npackage proxy; public class CarNoInterface { public void run() { System.out.println(\u0026#34;car running\u0026#34;); } } cglibä»£ç†ç±» [ËŒÉªntÉ™ËˆseptÉ™(r)] interceptor æ‹¦æˆª\npackage proxy; import java.lang.reflect.Method; import org.springframework.cglib.proxy.Enhancer; import org.springframework.cglib.proxy.MethodInterceptor; import org.springframework.cglib.proxy.MethodProxy; public class CglibProxy implements MethodInterceptor{ private Object car; /** * åˆ›å»ºä»£ç†å¯¹è±¡ * * @param target * @return */ public Object getInstance(Object object) { this.car = object; Enhancer enhancer = new Enhancer(); enhancer.setSuperclass(this.car.getClass()); // å›è°ƒæ–¹æ³• enhancer.setCallback(this); // åˆ›å»ºä»£ç†å¯¹è±¡ return enhancer.create(); } @Override public Object intercept(Object obj, Method method, Object[] args,MethodProxy proxy) throws Throwable { System.out.println(\u0026#34;äº‹ç‰©å¼€å§‹\u0026#34;); proxy.invokeSuper(obj, args); System.out.println(\u0026#34;äº‹ç‰©ç»“æŸ\u0026#34;); return null; } } ä½¿ç”¨\npackage proxy; import java.lang.reflect.Proxy; public class main { public static void main(String[] args) { CglibProxy cglibProxy = new CglibProxy(); CarNoInterface carNoInterface = (CarNoInterface)cglibProxy.getInstance(new CarNoInterface()); carNoInterface.run(); } } //è¾“å‡º äº‹ç‰©å¼€å§‹ car running äº‹ç‰©ç»“æŸ æˆ‘ä»¬å¯ä»¥åŸºäºåå°„åˆ†æç±»ï¼Œç„¶åè·å–åˆ°ç±»/å±æ€§/æ–¹æ³•/æ–¹æ³•å‚æ•°ä¸Šçš„æ³¨è§£ï¼Œä¹‹ååšè¿›ä¸€æ­¥çš„å¤„ç†\nåå°„æœºåˆ¶çš„ä¼˜ç¼ºç‚¹\nä¼˜ç‚¹\nè®©ä»£ç æ›´åŠ çµæ´» ç¡®å®šï¼Œå¢åŠ å®‰å…¨é—®é¢˜ï¼Œå¯ä»¥æ— è§†æ³›å‹å‚æ•°çš„å®‰å…¨æ£€æŸ¥ï¼ˆæ³›å‹å‚æ•°çš„å®‰å…¨æ£€æŸ¥å‘ç”Ÿåœ¨ç¼–è¯‘æ—¶ï¼Œä¸”æ€§èƒ½è¾ƒå·®ï¼‰ åå°„å®æˆ˜\nè·å–Classå¯¹è±¡çš„å‡ ç§æ–¹å¼\nClass alunbarClass = TargetObject.class;//ç¬¬ä¸€ç§ Class alunbarClass1 = Class.forName(\u0026#34;cn.javaguide.TargetObject\u0026#34;);//ç¬¬äºŒç§ TargetObject o = new TargetObject(); Class alunbarClass2 = o.getClass(); //ç¬¬ä¸‰ç§ ClassLoader.getSystemClassLoader().loadClass(\u0026#34;cn.javaguide.TargetObject\u0026#34;); //ç¬¬4ç§ï¼Œé€šè¿‡ç±»åŠ è½½å™¨è·å–Classå¯¹è±¡ä¸ä¼šè¿›è¡Œåˆå§‹åŒ–ï¼Œæ„å‘³ç€ä¸è¿›è¡ŒåŒ…æ‹¬åˆå§‹åŒ–ç­‰ä¸€ç³»åˆ—æ“ä½œï¼Œé™æ€ä»£ç å—å’Œé™æ€å¯¹è±¡ä¸ä¼šå¾—åˆ°æ‰§è¡Œ åå°„çš„åŸºæœ¬æ“ä½œ ä¾‹å­ï¼š\npackage cn.javaguide; public class TargetObject { private String value; public TargetObject() { value = \u0026#34;JavaGuide\u0026#34;; } public void publicMethod(String s) { System.out.println(\u0026#34;I love \u0026#34; + s); } private void privateMethod() { System.out.println(\u0026#34;value is \u0026#34; + value); } } é€šè¿‡åå°„æ“ä½œè¿™ä¸ªç±»çš„æ–¹æ³•ä»¥åŠå‚æ•°\npackage cn.javaguide; import java.lang.reflect.Field; import java.lang.reflect.InvocationTargetException; import java.lang.reflect.Method; public class Main { public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, IllegalAccessException, InstantiationException, InvocationTargetException, NoSuchFieldException { /** * è·å– TargetObject ç±»çš„ Class å¯¹è±¡å¹¶ä¸”åˆ›å»º TargetObject ç±»å®ä¾‹ */ Class\u0026lt;?\u0026gt; targetClass = Class.forName(\u0026#34;cn.javaguide.TargetObject\u0026#34;); TargetObject targetObject = (TargetObject) targetClass.newInstance(); /** (Car)Proxy.newProxyInstance( main.class.getClassLoader(), //ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè·å–ClassLoader carImpl.getClass().getInterfaces(), //ç¬¬äºŒä¸ªå‚æ•°ï¼Œè·å–è¢«ä»£ç†ç±»çš„æ¥å£ carHandler); **/ /** * è·å– TargetObject ç±»ä¸­å®šä¹‰çš„æ‰€æœ‰æ–¹æ³• */ Method[] methods = targetClass.getDeclaredMethods(); for (Method method : methods) { System.out.println(method.getName()); } /** * è·å–æŒ‡å®šæ–¹æ³•å¹¶è°ƒç”¨ */ Method publicMethod = targetClass.getDeclaredMethod(\u0026#34;publicMethod\u0026#34;, String.class); publicMethod.invoke(targetObject, \u0026#34;JavaGuide\u0026#34;); /** * è·å–æŒ‡å®šå‚æ•°å¹¶å¯¹å‚æ•°è¿›è¡Œä¿®æ”¹ */ Field field = targetClass.getDeclaredField(\u0026#34;value\u0026#34;); //ä¸ºäº†å¯¹ç±»ä¸­çš„å‚æ•°è¿›è¡Œä¿®æ”¹æˆ‘ä»¬å–æ¶ˆå®‰å…¨æ£€æŸ¥ field.setAccessible(true); field.set(targetObject, \u0026#34;JavaGuide\u0026#34;); /** * è°ƒç”¨ private æ–¹æ³• */ Method privateMethod = targetClass.getDeclaredMethod(\u0026#34;privateMethod\u0026#34;); //ä¸ºäº†è°ƒç”¨privateæ–¹æ³•æˆ‘ä»¬å–æ¶ˆå®‰å…¨æ£€æŸ¥ privateMethod.setAccessible(true); privateMethod.invoke(targetObject); } } //è¾“å‡º publicMethod privateMethod I love JavaGuide value is JavaGuide\n- "},{"id":159,"href":"/zh/docs/study/Review/java_guide/java/Basic/ly0005lyserialize/","title":"Javaåºåˆ—åŒ–è¯¦è§£","section":"åŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nä»€ä¹ˆæ˜¯åºåˆ—åŒ–ï¼Ÿä»€ä¹ˆæ˜¯ååºåˆ—åŒ– # å½“éœ€è¦æŒä¹…åŒ–Javaå¯¹è±¡ï¼Œæ¯”å¦‚å°†Javaå¯¹è±¡ä¿å­˜åœ¨æ–‡ä»¶ä¸­ã€æˆ–è€…åœ¨ç½‘ç»œä¸­ä¼ è¾“Javaå¯¹è±¡ï¼Œè¿™äº›åœºæ™¯éƒ½éœ€è¦ç”¨åˆ°åºåˆ—åŒ–\nå³ï¼š\nåºåˆ—åŒ–ï¼šå°†æ•°æ®ç»“æ„/å¯¹è±¡ï¼Œè½¬æ¢æˆäºŒè¿›åˆ¶å­—èŠ‚æµ ååºåˆ—åŒ–ï¼šå°†åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­æ‰€ç”Ÿæˆçš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼Œè½¬æ¢æˆæ•°æ®ç»“æ„æˆ–è€…å¯¹è±¡çš„è¿‡ç¨‹ å¯¹äºJavaï¼Œåºåˆ—åŒ–çš„æ˜¯å¯¹è±¡(Object)ï¼Œä¹Ÿå°±æ˜¯å®ä¾‹åŒ–åçš„ç±»(Class)\nåºåˆ—åŒ–çš„ç›®çš„ï¼Œæ˜¯é€šè¿‡ç½‘ç»œä¼ è¾“å¯¹è±¡ï¼Œæˆ–è€…è¯´æ˜¯å°†å¯¹è±¡å­˜å‚¨åˆ°æ–‡ä»¶ç³»ç»Ÿã€æ•°æ®åº“ã€å†…å­˜ä¸­ï¼Œå¦‚å›¾ï¼š å®é™…åœºæ™¯ # å¯¹è±¡åœ¨è¿›è¡Œç½‘ç»œä¼ è¾“ï¼ˆæ¯”å¦‚è¿œç¨‹æ–¹æ³•è°ƒç”¨ RPC çš„æ—¶å€™ï¼‰ä¹‹å‰éœ€è¦å…ˆè¢«åºåˆ—åŒ–ï¼Œæ¥æ”¶åˆ°åºåˆ—åŒ–çš„å¯¹è±¡ä¹‹åéœ€è¦å†è¿›è¡Œååºåˆ—åŒ–ï¼› å°†å¯¹è±¡å­˜å‚¨åˆ°æ–‡ä»¶ä¸­çš„æ—¶å€™éœ€è¦è¿›è¡Œåºåˆ—åŒ–ï¼Œå°†å¯¹è±¡ä»æ–‡ä»¶ä¸­è¯»å–å‡ºæ¥éœ€è¦è¿›è¡Œååºåˆ—åŒ–ã€‚ å°†å¯¹è±¡å­˜å‚¨åˆ°ç¼“å­˜æ•°æ®åº“ï¼ˆå¦‚ Redisï¼‰æ—¶éœ€è¦ç”¨åˆ°åºåˆ—åŒ–ï¼Œå°†å¯¹è±¡ä»ç¼“å­˜æ•°æ®åº“ä¸­è¯»å–å‡ºæ¥éœ€è¦ååºåˆ—åŒ– åºåˆ—åŒ–åè®®å¯¹äºTCP/IP 4å±‚æ¨¡å‹çš„å“ªä¸€å±‚ # 4å±‚åŒ…æ‹¬ï¼Œç½‘ç»œæ¥å£å±‚ï¼Œç½‘ç»œå±‚ï¼Œä¼ è¾“å±‚ï¼Œåº”ç”¨å±‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nOSIä¸ƒå±‚åè®®æ¨¡å‹ä¸­ï¼Œè¡¨ç¤ºå±‚å°±æ˜¯å¯¹åº”ç”¨å±‚çš„ç”¨æˆ·æ•°æ®ï¼Œè¿›è¡Œå¤„ç†è½¬æ¢æˆäºŒè¿›åˆ¶æµï¼›åè¿‡æ¥çš„è¯ï¼Œå°±æ˜¯å°†äºŒè¿›åˆ¶æµè½¬æ¢æˆåº”ç”¨å±‚çš„ç”¨æˆ·æ•°æ®ï¼Œå³åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œ\nå› ä¸ºï¼ŒOSI ä¸ƒå±‚åè®®æ¨¡å‹ä¸­çš„åº”ç”¨å±‚ã€è¡¨ç¤ºå±‚å’Œä¼šè¯å±‚å¯¹åº”çš„éƒ½æ˜¯ TCP/IP å››å±‚æ¨¡å‹ä¸­çš„åº”ç”¨å±‚ï¼Œæ‰€ä»¥åºåˆ—åŒ–åè®®å±äº TCP/IP åè®®åº”ç”¨å±‚çš„ä¸€éƒ¨åˆ†\nå¸¸è§åºåˆ—åŒ–åè®®å¯¹æ¯” # kryo è‹±éŸ³ [k\u0026rsquo;rÉªÉ™ÊŠ] ï¼Œé™¤äº†JDKè‡ªå¸¦çš„åºåˆ—åŒ–ï¼Œè¿˜æœ‰hessianã€kryoã€protostuff\nJDKè‡ªå¸¦çš„åºåˆ—åŒ–ï¼Œåªéœ€è¦å®ç°java.io.Serializableæ¥å£å³å¯\n@AllArgsConstructor @NoArgsConstructor @Getter @Builder @ToString public class RpcRequest implements Serializable { private static final long serialVersionUID = 1905122041950251207L; private String requestId; private String interfaceName; private String methodName; private Object[] parameters; private Class\u0026lt;?\u0026gt;[] paramTypes; private RpcMessageTypeEnum rpcMessageTypeEnum; } serialVersionUIDç”¨äºç‰ˆæœ¬æ§åˆ¶ï¼Œä¼šè¢«å†™å…¥äºŒè¿›åˆ¶åºåˆ—ï¼Œååºåˆ—åŒ–å¦‚æœå‘ç°å’Œå½“å‰ç±»ä¸ä¸€è‡´åˆ™ä¼šæŠ›å‡ºInvalidClassExceptionå¼‚å¸¸ã€‚ä¸€èˆ¬ä¸ä½¿ç”¨JDKè‡ªå¸¦åºåˆ—åŒ–ï¼Œ1 ä¸æ”¯æŒè·¨è¯­è¨€è°ƒç”¨ 2 æ€§èƒ½å·®ï¼Œåºåˆ—åŒ–ä¹‹åå­—èŠ‚æ•°ç»„ä½“ç§¯è¿‡å¤§\nKryo ç”±äºå˜é•¿å­˜å‚¨ç‰¹æ€§å¹¶ä½¿ç”¨äº†å­—èŠ‚ç ç”Ÿæˆæœºåˆ¶ï¼Œæ‹¥æœ‰è¾ƒé«˜çš„è¿è¡Œé€Ÿåº¦å’Œè¾ƒå°å­—èŠ‚ç ä½“ç§¯ï¼Œä»£ç ï¼š\n/** * Kryo serialization class, Kryo serialization efficiency is very high, but only compatible with Java language * * @author shuang.kou * @createTime 2020å¹´05æœˆ13æ—¥ 19:29:00 */ @Slf4j public class KryoSerializer implements Serializer { /** * Because Kryo is not thread safe. So, use ThreadLocal to store Kryo objects */ private final ThreadLocal\u0026lt;Kryo\u0026gt; kryoThreadLocal = ThreadLocal.withInitial(() -\u0026gt; { Kryo kryo = new Kryo(); kryo.register(RpcResponse.class); kryo.register(RpcRequest.class); return kryo; }); @Override public byte[] serialize(Object obj) { try (ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); Output output = new Output(byteArrayOutputStream)) { Kryo kryo = kryoThreadLocal.get(); // Object-\u0026gt;byte:å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºbyteæ•°ç»„ kryo.writeObject(output, obj); kryoThreadLocal.remove(); return output.toBytes(); } catch (Exception e) { throw new SerializeException(\u0026#34;Serialization failed\u0026#34;); } } @Override public \u0026lt;T\u0026gt; T deserialize(byte[] bytes, Class\u0026lt;T\u0026gt; clazz) { try (ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes); Input input = new Input(byteArrayInputStream)) { Kryo kryo = kryoThreadLocal.get(); // byte-\u0026gt;Object:ä»byteæ•°ç»„ä¸­ååºåˆ—åŒ–å‡ºå¯¹è±¡ Object o = kryo.readObject(input, clazz); kryoThreadLocal.remove(); return clazz.cast(o); } catch (Exception e) { throw new SerializeException(\u0026#34;Deserialization failed\u0026#34;); } } } Protobuf å‡ºè‡ªgoogle\nProtoStuffï¼Œæ›´ä¸ºæ˜“ç”¨\nhessianï¼Œè½»é‡çº§çš„è‡ªå®šä¹‰æè¿°çš„äºŒè¿›åˆ¶RPCåè®®ï¼Œè·¨è¯­è¨€ï¼Œhessian2ï¼Œä¸ºé˜¿é‡Œä¿®æ”¹è¿‡çš„hessian liteï¼Œæ˜¯dubbo RPCé»˜è®¤å¯ç”¨çš„åºåˆ—åŒ–æ–¹å¼\næ€»ç»“\nå¦‚æœä¸éœ€è¦è·¨è¯­è¨€å¯ä»¥è€ƒè™‘Kryo Protobufï¼ŒProtoStuffï¼Œhessianæ”¯æŒè·¨è¯­è¨€ "},{"id":160,"href":"/zh/docs/study/Review/java_guide/java/Basic/ly0004lypassbyvalue/","title":"ä¸ºä»€ä¹ˆJavaä¸­åªæœ‰å€¼ä¼ é€’","section":"åŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nå½¢å‚\u0026amp;\u0026amp;å®å‚\nå®å‚(å®é™…å‚æ•°ï¼ŒArguments)ï¼Œç”¨äºä¼ é€’ç»™å‡½æ•°/æ–¹æ³•çš„å‚æ•°ï¼Œå¿…é¡»æœ‰ç¡®å®šçš„å€¼\nå½¢å‚(å½¢å¼å‚æ•°ï¼ŒParameters)ï¼Œç”¨äºå®šä¹‰å‡½æ•°/æ–¹æ³•ï¼Œæ¥æ”¶å®å‚ï¼Œä¸éœ€è¦æœ‰ç¡®å®šçš„å€¼\nString hello = \u0026#34;Hello!\u0026#34;; // hello ä¸ºå®å‚ sayHello(hello); // str ä¸ºå½¢å‚ void sayHello(String str) { System.out.println(str); } å€¼ä¼ é€’\u0026amp;\u0026amp;å¼•ç”¨ä¼ é€’\nç¨‹åºè®¾è®¡å°†å®å‚ä¼ é€’ç»™æ–¹æ³•çš„æ–¹å¼åˆ†ä¸ºä¸¤ç§ï¼Œå€¼ä¼ é€’ï¼šæ–¹æ³•æ¥æ”¶å®å‚å€¼çš„æ‹·è´ï¼Œä¼šåˆ›å»ºå‰¯æœ¬ï¼›å¼•ç”¨ä¼ é€’ï¼šæ–¹æ³•æ¥å—çš„æ˜¯å®å‚æ‰€å¼•ç”¨çš„å¯¹è±¡åœ¨å †ä¸­çš„åœ°å€ï¼Œä¸ä¼šåˆ›å»ºå‰¯æœ¬ï¼Œå¯¹å½¢å‚çš„ä¿®æ”¹å°†å½±å“åˆ°å®å‚ Javaä¸­åªæœ‰å€¼ä¼ é€’ï¼ŒåŸå› ï¼š\nä¼ é€’åŸºæœ¬ç±»å‹å‚æ•°\npublic static void main(String[] args) { int num1 = 10; int num2 = 20; swap(num1, num2); System.out.println(\u0026#34;num1 = \u0026#34; + num1); System.out.println(\u0026#34;num2 = \u0026#34; + num2); } public static void swap(int a, int b) { int temp = a; a = b; b = temp; System.out.println(\u0026#34;a = \u0026#34; + a); System.out.println(\u0026#34;b = \u0026#34; + b); } //è¾“å‡º a = 20 b = 10 num1 = 10 num2 = 20 ä¼ é€’å¼•ç”¨ç±»å‹å‚æ•° 1\npublic static void main(String[] args) { int[] arr = { 1, 2, 3, 4, 5 }; System.out.println(arr[0]); //1 change(arr); System.out.println(arr[0]);//0 } public static void change(int[] array) { // å°†æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ å˜ä¸º0 array[0] = 0; } changeæ–¹æ³•çš„å‚æ•°ï¼Œæ‹·è´çš„æ˜¯arr(å®å‚)çš„åœ°å€ï¼Œæ‰€ä»¥arrayå’ŒarræŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªæ•°ç»„å¯¹è±¡ ä¼ é€’å¼•ç”¨ç±»å‹å‚æ•°2\npublic class Person { private String name; // çœç•¥æ„é€ å‡½æ•°ã€Getter\u0026amp;Setteræ–¹æ³• } public static void main(String[] args) { Person xiaoZhang = new Person(\u0026#34;å°å¼ \u0026#34;); Person xiaoLi = new Person(\u0026#34;å°æ\u0026#34;); swap(xiaoZhang, xiaoLi); System.out.println(\u0026#34;xiaoZhang:\u0026#34; + xiaoZhang.getName()); System.out.println(\u0026#34;xiaoLi:\u0026#34; + xiaoLi.getName()); } public static void swap(Person person1, Person person2) { Person temp = person1; person1 = person2; person2 = temp; System.out.println(\u0026#34;person1:\u0026#34; + person1.getName()); System.out.println(\u0026#34;person2:\u0026#34; + person2.getName()); } //ç»“æœ person1:å°æ person2:å°å¼  xiaoZhang:å°å¼  xiaoLi:å°æ è¿™é‡Œå¹¶ä¸ä¼šäº¤æ¢xiaoZhangå’ŒxiaoLiï¼Œåªä¼šäº¤æ¢swapæ–¹æ³•æ ˆé‡Œçš„person1å’Œperson2\nå°ç»“ Java ä¸­å°†å®å‚ä¼ é€’ç»™æ–¹æ³•ï¼ˆæˆ–å‡½æ•°ï¼‰çš„æ–¹å¼æ˜¯ å€¼ä¼ é€’ ï¼š\nå¦‚æœå‚æ•°æ˜¯åŸºæœ¬ç±»å‹çš„è¯ï¼Œå¾ˆç®€å•ï¼Œä¼ é€’çš„å°±æ˜¯åŸºæœ¬ç±»å‹çš„å­—é¢é‡å€¼çš„æ‹·è´ï¼Œä¼šåˆ›å»ºå‰¯æœ¬ã€‚ å¦‚æœå‚æ•°æ˜¯å¼•ç”¨ç±»å‹ï¼Œä¼ é€’çš„å°±æ˜¯å®å‚æ‰€å¼•ç”¨çš„å¯¹è±¡åœ¨å †ä¸­åœ°å€å€¼çš„æ‹·è´ï¼ŒåŒæ ·ä¹Ÿä¼šåˆ›å»ºå‰¯æœ¬ã€‚ "},{"id":161,"href":"/zh/docs/study/Review/java_guide/java/Basic/ly0003lyjava_guide_basic_3/","title":"javaGuideåŸºç¡€3","section":"åŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nå¼‚å¸¸ # unchecked exceptions (è¿è¡Œæ—¶å¼‚å¸¸)\nchecked exceptions (éè¿è¡Œæ—¶å¼‚å¸¸ï¼Œç¼–è¯‘å¼‚å¸¸ï¼‰\nJavaå¼‚å¸¸ç±»å±‚æ¬¡ç»“æ„å›¾ Exceptionå’ŒErroræœ‰ä»€ä¹ˆåŒºåˆ«\né™¤äº†RuntimeExceptionåŠå…¶å­ç±»ä»¥å¤–ï¼Œå…¶ä»–çš„Exceptionç±»åŠå…¶å­ç±»éƒ½å±äºå—æ£€æŸ¥å¼‚å¸¸\nException : ç¨‹åºæœ¬èº«å¯ä»¥å¤„ç†çš„å¼‚å¸¸ï¼ˆå¯é€šè¿‡catchæ•è·ï¼‰\nChecked Exception ï¼Œå—æ£€æŸ¥å¼‚å¸¸ï¼Œå¿…é¡»å¤„ç†(catch æˆ–è€… throws ï¼Œå¦åˆ™ç¼–è¯‘å™¨é€šè¿‡ä¸äº†) IOExceptionï¼ŒClassNotFoundExceptionï¼ŒSQLExceptionï¼ŒFileNotFoundException\nUnchecked Exception ï¼Œ ä¸å—æ£€æŸ¥å¼‚å¸¸ ï¼Œ å¯ä»¥ä¸å¤„ç†\nï¼ˆç®—æ•°å¼‚å¸¸ï¼Œç±»å‹è½¬æ¢å¼‚å¸¸ï¼Œä¸åˆæ³•çš„çº¿ç¨‹çŠ¶æ€å¼‚å¸¸ï¼Œä¸‹æ ‡è¶…å‡ºå¼‚å¸¸ï¼Œç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œå‚æ•°ç±»å‹å¼‚å¸¸ï¼Œæ•°å­—æ ¼å¼å¼‚å¸¸ï¼Œä¸æ”¯æŒæ“ä½œå¼‚å¸¸ï¼‰ ArithmeticExceptionï¼ŒClassCastExceptionï¼ŒIllegalThreadStateExceptionï¼ŒIndexOutOfBoundsException\nNullPointerExceptionï¼ŒIllegalArgumentExceptionï¼ŒNumberFormatExceptionï¼ŒSecurityExceptionï¼ŒUnsupportedOperationException ```illegal è‹±[ÉªËˆliËÉ¡l] éæ³•çš„``` ```Arithmetic è‹±[É™ËˆrÉªÎ¸mÉ™tÉªk] ç®—æœ¯``` Errorï¼š ç¨‹åºæ— æ³•å¤„ç†çš„é”™è¯¯ ï¼Œä¸å»ºè®®é€šè¿‡catch æ•è·ï¼Œå·²åŠé”™è¯¯å‘ç”Ÿæ—¶JVMä¼šé€‰æ‹©çº¿ç¨‹ç»ˆæ­¢\nOutOfMemoryError ï¼ˆå †ï¼ŒJava heap spaceï¼‰ï¼ŒVirtualMachineErrorï¼ŒStackOverFlowErrorï¼ŒAssertionError ï¼ˆæ–­è¨€ï¼‰ï¼ŒIOError\nThrowableç±»å¸¸ç”¨æ–¹æ³•\nString getMessage() //ç®€è¦æè¿° String toString() //è¯¦ç»† String getLocalizedMessage() //æœ¬åœ°åŒ–ä¿¡æ¯ï¼Œå¦‚æœå­ç±»(Throwableçš„å­ç±»)æ²¡æœ‰è¦†ç›–è¯¥æ–¹æ³•ï¼Œåˆ™ä¸gtMessage() ç»“æœä¸€æ · void printStackTrace() //æ‰“å°Throwableå¯¹è±¡å°è£…çš„å¼‚å¸¸ä¿¡æ¯ try-catch-finallyå¦‚ä½•ä½¿ç”¨ tryåé¢å¿…é¡»è¦æœ‰catchæˆ–è€…finallyï¼›æ— è®ºæ˜¯å¦æ•è·å¼‚å¸¸ï¼Œfinallyéƒ½ä¼šæ‰§è¡Œï¼›å½“åœ¨ try å—æˆ– catch å—ä¸­é‡åˆ° return è¯­å¥æ—¶ï¼Œfinally è¯­å¥å—å°†åœ¨æ–¹æ³•è¿”å›ä¹‹å‰è¢«æ‰§è¡Œã€‚\nä¸è¦åœ¨ finally è¯­å¥å—ä¸­ä½¿ç”¨ return! å½“ try è¯­å¥å’Œ finally è¯­å¥ä¸­éƒ½æœ‰ return è¯­å¥æ—¶ï¼Œtry è¯­å¥å—ä¸­çš„ return è¯­å¥ä¼šè¢«å¿½ç•¥ã€‚è¿™æ˜¯å› ä¸º try è¯­å¥ä¸­çš„ return è¿”å›å€¼ä¼šå…ˆè¢«æš‚å­˜åœ¨ä¸€ä¸ªæœ¬åœ°å˜é‡ä¸­ï¼Œå½“æ‰§è¡Œåˆ° finally è¯­å¥ä¸­çš„ return ä¹‹åï¼Œè¿™ä¸ªæœ¬åœ°å˜é‡çš„å€¼å°±å˜ä¸ºäº† finally è¯­å¥ä¸­çš„ return è¿”å›å€¼ã€‚\npublic static void main(String[] args) { System.out.println(f(2)); }\npublic static int f(int value) { try { return value * value; } finally { if (value == 2) { return 0; } } } /*\n0 */\nfinallyä¸­çš„ä»£ç ä¸ä¸€å®šæ‰§è¡Œï¼ˆå¦‚æœfinallyä¹‹å‰è™šæ‹Ÿæœºå°±å·²ç»è¢«ç»ˆæ­¢äº†ï¼‰\nå¦å¤–ä¸¤ç§æƒ…å†µï¼Œç¨‹åºæ‰€åœ¨çš„çº¿ç¨‹æ­»äº¡ï¼›å…³é—­CPUï¼›éƒ½ä¼šå¯¼è‡´ä»£ç ä¸æ‰§è¡Œ ä½¿ç”¨try-with-resourcesä»£æ›¿try-catch-finally\né€‚ç”¨èŒƒå›´ï¼šä»»ä½•å®ç°java.lang.AutoCloseableæˆ–è€…java.io.Closeableçš„å¯¹è±¡ã€æ¯”å¦‚InputStreamã€OutputStreamã€Scannerã€PrintWriterç­‰éœ€è¦è°ƒç”¨close()æ–¹æ³•çš„èµ„æºã€‘\nåœ¨try-with-resourcesä¸­ï¼Œä»»ä½•catchæˆ–finallyå—åœ¨å£°æ˜çš„èµ„æºå…³é—­åè¿è¡Œ\nä¾‹å­\n//è¯»å–æ–‡æœ¬æ–‡ä»¶çš„å†…å®¹ Scanner scanner = null; try { scanner = new Scanner(new File(\u0026#34;D://read.txt\u0026#34;)); while (scanner.hasNext()) { System.out.println(scanner.nextLine()); } } catch (FileNotFoundException e) { e.printStackTrace(); } finally { if (scanner != null) { scanner.close(); } } æ”¹é€ åï¼š\ntry (Scanner scanner = new Scanner(new File(\u0026#34;test.txt\u0026#34;))) { while (scanner.hasNext()) { System.out.println(scanner.nextLine()); } } catch (FileNotFoundException fnfe) { fnfe.printStackTrace(); } å¯ä»¥ä½¿ç”¨åˆ†éš”ç¬¦æ¥åˆ†å‰²\ntry (BufferedInputStream bin = new BufferedInputStream(new FileInputStream(new File(\u0026#34;test.txt\u0026#34;))); BufferedOutputStream bout = new BufferedOutputStream(new FileOutputStream(new File(\u0026#34;out.txt\u0026#34;)))) { int b; while ((b = bin.read()) != -1) { bout.write(b); } } catch (IOException e) { e.printStackTrace(); } éœ€è¦æ³¨æ„çš„åœ°æ–¹\nä¸è¦æŠŠå¼‚å¸¸å®šä¹‰ä¸ºé™æ€å˜é‡ï¼Œå› ä¸ºè¿™æ ·ä¼šå¯¼è‡´å¼‚å¸¸æ ˆä¿¡æ¯é”™ä¹±ã€‚æ¯æ¬¡æ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œæˆ‘ä»¬éƒ½éœ€è¦æ‰‹åŠ¨ new ä¸€ä¸ªå¼‚å¸¸å¯¹è±¡æŠ›å‡ºã€‚ æŠ›å‡ºçš„å¼‚å¸¸ä¿¡æ¯ä¸€å®šè¦æœ‰æ„ä¹‰ã€‚ å»ºè®®æŠ›å‡ºæ›´åŠ å…·ä½“çš„å¼‚å¸¸æ¯”å¦‚å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—æ ¼å¼é”™è¯¯çš„æ—¶å€™åº”è¯¥æŠ›å‡ºNumberFormatExceptionè€Œä¸æ˜¯å…¶çˆ¶ç±»IllegalArgumentExceptionã€‚ ä½¿ç”¨æ—¥å¿—æ‰“å°å¼‚å¸¸ä¹‹åå°±ä¸è¦å†æŠ›å‡ºå¼‚å¸¸äº†ï¼ˆä¸¤è€…ä¸è¦åŒæ—¶å­˜åœ¨ä¸€æ®µä»£ç é€»è¾‘ä¸­ï¼‰ã€‚ æ³›å‹ # ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ Javaæ³›å‹ï¼ˆGenericsï¼‰JDK5ä¸­å¼•å…¥çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œä½¿ç”¨æ³›å‹å‚æ•°ï¼Œå¯ä»¥å¢å¼ºä»£ç çš„å¯è¯»æ€§ä»¥åŠç¨³å®šæ€§\nç¼–è¯‘å™¨å¯ä»¥å¯¹æ³›å‹å‚æ•°è¿›è¡Œæ£€æµ‹ï¼Œå¹¶é€šè¿‡æ³›å‹å‚æ•°å¯ä»¥æŒ‡å®šä¼ å…¥çš„å¯¹è±¡ç±»å‹ï¼Œæ¯”å¦‚ArrayList\u0026lt;Person\u0026gt; persons=new ArrayList\u0026lt;Person\u0026gt;()è¿™è¡Œä»£ç æŒ‡æ˜è¯¥ArrayListå¯¹è±¡åªèƒ½ä¼ å…¥Personå¯¹è±¡ï¼Œè‹¥ä¼ å…¥å…¶ä»–ç±»å‹çš„å¯¹è±¡åˆ™ä¼šæŠ¥é”™\nåŸç”ŸListè¿”å›ç±»å‹ä¸ºObjectï¼Œéœ€è¦æ‰‹åŠ¨è½¬æ¢ç±»å‹æ‰èƒ½ä½¿ç”¨ï¼Œä½¿ç”¨æ³›å‹åç¼–è¯‘å™¨è‡ªåŠ¨è½¬æ¢ æ³›å‹ä½¿ç”¨æ–¹å¼\næ³›å‹ç±»\n//æ­¤å¤„Tå¯ä»¥éšä¾¿å†™ä¸ºä»»æ„æ ‡è¯†ï¼Œå¸¸è§çš„å¦‚Tã€Eã€Kã€Vç­‰å½¢å¼çš„å‚æ•°å¸¸ç”¨äºè¡¨ç¤ºæ³›å‹ //åœ¨å®ä¾‹åŒ–æ³›å‹ç±»æ—¶ï¼Œå¿…é¡»æŒ‡å®šTçš„å…·ä½“ç±»å‹ public class Generic\u0026lt;T\u0026gt;{ private T key; public Generic(T key) { this.key = key; } public T getKey(){ return key; } } // ä½¿ç”¨ Generic\u0026lt;Integer\u0026gt; genericInteger = new Generic\u0026lt;Integer\u0026gt;(123456); æ³›å‹æ¥å£\npublic interface Generator\u0026lt;T\u0026gt; { public T method(); } ä¸æŒ‡å®šç±»å‹ä½¿ç”¨\nclass GeneratorImpl\u0026lt;T\u0026gt; implements Generator\u0026lt;T\u0026gt;{ @Override public T method() { return null; } } æŒ‡å®šç±»å‹ä½¿ç”¨\nclass GeneratorImpl\u0026lt;T\u0026gt; implements Generator\u0026lt;String\u0026gt;{ @Override public String method() { return \u0026#34;hello\u0026#34;; } } æ³›å‹æ–¹æ³•\npublic static \u0026lt; E \u0026gt; void printArray( E[] inputArray ) { for ( E element : inputArray ){ System.out.printf( \u0026#34;%s \u0026#34;, element ); } System.out.println(); } //ä½¿ç”¨ // åˆ›å»ºä¸åŒç±»å‹æ•°ç»„ï¼š Integer, Double å’Œ Character Integer[] intArray = { 1, 2, 3 }; String[] stringArray = { \u0026#34;Hello\u0026#34;, \u0026#34;World\u0026#34; }; printArray( intArray ); printArray( stringArray ); ä¸Šé¢ç§°ä¸ºé™æ€æ–¹æ³•ï¼ŒJavaä¸­æ³›å‹åªæ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œå¿…é¡»åœ¨ä¼ é€’ç±»å‹åæ‰èƒ½ä½¿ç”¨ï¼Œç±»åœ¨å®ä¾‹åŒ–æ—¶æ‰èƒ½ä¼ é€’ç±»å‹å‚æ•°ï¼Œè€Œç±»å‹æ–¹æ³•çš„åŠ è½½ä¼˜å…ˆäºç±»çš„å®ä¾‹åŒ–ï¼Œé™æ€æ³›å‹æ–¹æ³•æ˜¯**æ²¡æœ‰åŠæ³•ä½¿ç”¨ç±»ä¸Šå£°æ˜çš„æ³›å‹ï¼ˆå³ä¸Šé¢çš„ç¬¬äºŒç‚¹ä¸­ç±»åæ—è¾¹çš„Tï¼‰**çš„ï¼Œåªèƒ½ä½¿ç”¨è‡ªå·±å£°æ˜çš„\u0026lt;E\u0026gt;\nä¹Ÿå¯ä»¥æ˜¯éé™æ€çš„\nclass A{ private String name; private int age; public \u0026lt;E\u0026gt; int geA(E e){ System.out.println(e.toString()); return 1; } } //ä½¿ç”¨,å…¶ä¸­ \u0026lt;Object\u0026gt; å¯ä»¥çœç•¥ a.\u0026lt;Object\u0026gt;geA(new Object()); åå°„ # åå°„èµ‹äºˆäº†æˆ‘ä»¬åœ¨è¿è¡Œæ—¶åˆ†æç±»ä»¥åŠæ‰§è¡Œç±»ä¸­æ–¹æ³•çš„èƒ½åŠ›ï¼Œé€šè¿‡åå°„å¯ä»¥è·å–ä»»æ„ä¸€ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•\nåå°„å¢åŠ ï¼ˆå¯¼è‡´ï¼‰äº†å®‰å…¨é—®é¢˜ï¼Œå¯ä»¥æ— è§†æ³›å‹å‚æ•°çš„å®‰å…¨æ£€æŸ¥ï¼ˆæ³›å‹å‚æ•°çš„å®‰å…¨æ£€æŸ¥å‘ç”Ÿåœ¨ç¼–è¯‘æœŸï¼‰ï¼Œä¸è¿‡å…¶å¯¹äºæ¡†æ¶æ¥è¯´å®é™…æ˜¯å½±å“ä¸å¤§çš„\nåº”ç”¨åœºæ™¯\nä¸€èˆ¬ç”¨äºæ¡†æ¶ä¸­ï¼Œæ¡†æ¶ä¸­å¤§é‡ä½¿ç”¨äº†åŠ¨æ€ä»£ç†ï¼Œè€ŒåŠ¨æ€ä»£ç†çš„å®ç°ä¹Ÿä¾èµ–äºåå°„\n//JDKåŠ¨æ€ä»£ç† interface ILy { String say(String word); } class LyImpl implements ILy{ @Override public String say(String word) { return \u0026#34;hello ,\u0026#34;+word; } } @Slf4j class MyInvocationHandler implements InvocationHandler { private final Object target; public MyInvocationHandler(Object target) { this.target = target; } @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { log.info(\u0026#34;è°ƒç”¨å‰\u0026#34;); Object result = method.invoke(target, args); log.info(\u0026#34;ç»“æœæ˜¯:\u0026#34;+result); log.info(\u0026#34;è°ƒç”¨å\u0026#34;); return result; } } public class Test { String a; public static void main(String[] args) { LyImpl target = new LyImpl(); ILy targetProxy = (ILy)Proxy.newProxyInstance(Test.class.getClassLoader(), target.getClass().getInterfaces(), new MyInvocationHandler(target)); targetProxy.say(\u0026#34;dxs\u0026#34;); } } //cglibåŠ¨æ€ä»£ç† @Slf4j class MyCglibProxyInterceptor implements MethodInterceptor{ @Override public Object intercept(Object o, Method method, Object[] args, MethodProxy methodProxy) throws Throwable { log.info(\u0026#34;è°ƒç”¨å‰\u0026#34;); //æ³¨æ„ï¼Œè¿™é‡Œæ˜¯invokeSuperï¼Œå¦‚æœæ˜¯invokeå°±ä¼šè°ƒç”¨è‡ªå·±ï¼Œå¯¼è‡´æ­»å¾ªç¯(é€’å½’) Object result = methodProxy.invokeSuper(o, args); //ä¸Šé¢è¿™ä¸ªå†™æ³•æœ‰é—®é¢˜ï¼Œåº”è¯¥æ˜¯ //Object result = method.invoke(o, args); log.info(\u0026#34;è°ƒç”¨ç»“æœ\u0026#34;+result); log.info(\u0026#34;è°ƒç”¨å\u0026#34;); return result; } } public class Test { String a; public static void main(String[] args) { Enhancer enhancer=new Enhancer(); enhancer.setClassLoader(Test.class.getClassLoader()); enhancer.setSuperclass(LyImpl.class); enhancer.setCallback(new MyCglibProxyInterceptor()); //æ–¹æ³•ä¸€(é€šè¿‡) ILy o = (ILy)enhancer.create(); //æ–¹æ³•äºŒ(é€šè¿‡) //LyImpl o = (LyImpl)enhancer.create(); o.say(\u0026#34;lyly\u0026#34;); } } æ³¨è§£ä¹Ÿä½¿ç”¨åˆ°äº†åå°„ï¼Œæ¯”å¦‚Springä¸Šçš„@Componentæ³¨è§£ã€‚ å¯ä»¥åŸºäºåå°„åˆ†æç±»ï¼Œç„¶åè·å–åˆ°ç±»/å±æ€§/æ–¹æ³•/æ–¹æ³•çš„å‚æ•°ä¸Šçš„æ³¨è§£ï¼Œè·å–æ³¨è§£åï¼Œåšè¿›ä¸€æ­¥çš„å¤„ç†\næ³¨è§£ # æ³¨è§£ï¼ŒJava5å¼•å…¥ï¼Œç”¨äºä¿®é¥°ç±»ã€æ–¹æ³•æˆ–è€…å˜é‡ï¼Œæä¾›æŸäº›ä¿¡æ¯ä¾›ç¨‹åºåœ¨ç¼–è¯‘æˆ–è€…è¿è¡Œæ—¶ä½¿ç”¨\n@Target(ElementType.METHOD) @Retention(RetentionPolicy.SOURCE) public @interface Override { } //æ³¨è§£æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç»§æ‰¿äº†Annotationçš„ç‰¹æ®Šæ¥å£ public interface Override extends Annotation{ } æ³¨è§£åªæœ‰è¢«è§£æåæ‰ä¼šç”Ÿæ•ˆ\nç¼–è¯‘æœŸç›´æ¥æ‰«æ ï¼šç¼–è¯‘å™¨åœ¨ç¼–è¯‘ Java ä»£ç çš„æ—¶å€™æ‰«æå¯¹åº”çš„æ³¨è§£å¹¶å¤„ç†ï¼Œæ¯”å¦‚æŸä¸ªæ–¹æ³•ä½¿ç”¨@Override æ³¨è§£ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¼šæ£€æµ‹å½“å‰çš„æ–¹æ³•æ˜¯å¦é‡å†™äº†çˆ¶ç±»å¯¹åº”çš„æ–¹æ³•ã€‚ è¿è¡ŒæœŸé€šè¿‡åå°„å¤„ç† ï¼šåƒæ¡†æ¶ä¸­è‡ªå¸¦çš„æ³¨è§£(æ¯”å¦‚ Spring æ¡†æ¶çš„ @Value ã€@Component)éƒ½æ˜¯é€šè¿‡åå°„æ¥è¿›è¡Œå¤„ç†çš„ã€‚(åˆ›å»ºç±»çš„æ—¶å€™ä½¿ç”¨åå°„åˆ†æç±»ï¼Œè·å–æ³¨è§£ï¼Œå¯¹åˆ›å»ºçš„å¯¹è±¡è¿›ä¸€æ­¥å¤„ç†) SPI # ä»‹ç» Service Provider Interface ï¼ŒæœåŠ¡æä¾›è€…çš„æ¥å£ ï¼Œ ä¸“é—¨æä¾›ç»™æœåŠ¡æä¾›è€…æˆ–è€…æ‰©å±•æ¡†æ¶åŠŸèƒ½çš„å¼€å‘è€…å»ä½¿ç”¨çš„ä¸€ä¸ªæ¥å£ SPI å°†æœåŠ¡æ¥å£å’Œå…·ä½“çš„æœåŠ¡å®ç°åˆ†ç¦»å¼€æ¥ï¼Œå°†æœåŠ¡è°ƒç”¨æ–¹å’ŒæœåŠ¡å®ç°è€…è§£è€¦ï¼Œèƒ½å¤Ÿæå‡ç¨‹åºçš„æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§ã€‚ä¿®æ”¹æˆ–è€…æ›¿æ¢æœåŠ¡å®ç°å¹¶ä¸éœ€è¦ä¿®æ”¹è°ƒç”¨æ–¹ã€‚ å¾ˆå¤šæ¡†æ¶éƒ½ä½¿ç”¨äº† Java çš„ SPI æœºåˆ¶ï¼Œæ¯”å¦‚ï¼šSpring æ¡†æ¶ã€æ•°æ®åº“åŠ è½½é©±åŠ¨ã€æ—¥å¿—æ¥å£ã€ä»¥åŠ Dubbo çš„æ‰©å±•å®ç°ç­‰ç­‰ã€‚ SPIæ‰©å±•å®ç° APIå’ŒSPIåŒºåˆ« æ¨¡å—ä¹‹é—´é€šè¿‡æ¥å£è¿›è¡Œé€šè®¯ï¼Œåœ¨æœåŠ¡è°ƒç”¨æ–¹å’ŒæœåŠ¡å®ç°æ–¹(æœåŠ¡æä¾›è€…)ä¹‹é—´å¼•å…¥ä¸€ä¸ªâ€œæ¥å£â€ å½“æ¥å£å’Œå®ç°ï¼Œéƒ½æ˜¯æ”¾åœ¨å®ç°æ–¹çš„æ—¶å€™ï¼Œè¿™å°±æ˜¯API\nå½“æ¥å£å­˜åœ¨äºè°ƒç”¨æ–¹ï¼Œç”±æ¥å£è°ƒç”¨æ–¹ç¡®å®šæ¥å£è§„åˆ™ï¼Œç„¶åç”±ä¸åŒçš„å‚å•†å»æ ¹æ®è¿™ä¸ªè§„åˆ™å¯¹è¿™ä¸ªæ¥å£è¿›è¡Œå®ç°ï¼Œä»è€Œæä¾›æœåŠ¡ï¼Œå³SPI\nä¸¾ä¸ªé€šä¿—æ˜“æ‡‚çš„ä¾‹å­ï¼šå…¬å¸ H æ˜¯ä¸€å®¶ç§‘æŠ€å…¬å¸ï¼Œæ–°è®¾è®¡äº†ä¸€æ¬¾èŠ¯ç‰‡ï¼Œç„¶åç°åœ¨éœ€è¦é‡äº§äº†ï¼Œè€Œå¸‚é¢ä¸Šæœ‰å¥½å‡ å®¶èŠ¯ç‰‡åˆ¶é€ ä¸šå…¬å¸ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œåªè¦ H å…¬å¸æŒ‡å®šå¥½äº†è¿™èŠ¯ç‰‡ç”Ÿäº§çš„æ ‡å‡†ï¼ˆå®šä¹‰å¥½äº†æ¥å£æ ‡å‡†ï¼‰ï¼Œé‚£ä¹ˆè¿™äº›åˆä½œçš„èŠ¯ç‰‡å…¬å¸ï¼ˆæœåŠ¡æä¾›è€…ï¼‰å°±æŒ‰ç…§æ ‡å‡†äº¤ä»˜è‡ªå®¶ç‰¹è‰²çš„èŠ¯ç‰‡ï¼ˆæä¾›ä¸åŒæ–¹æ¡ˆçš„å®ç°ï¼Œä½†æ˜¯ç»™å‡ºæ¥çš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼‰\né€šè¿‡ SPI æœºåˆ¶æä¾›äº†æ¥å£è®¾è®¡çš„çµæ´»æ€§ï¼Œç¼ºç‚¹ï¼š éœ€è¦éå†åŠ è½½æ‰€æœ‰çš„å®ç°ç±»ï¼Œä¸èƒ½åšåˆ°æŒ‰éœ€åŠ è½½ï¼Œæ•ˆç‡è¾ƒä½ å½“å¤šä¸ªServiceLoaderåŒæ—¶loadæ—¶ï¼Œä¼šæœ‰å¹¶å‘é—®é¢˜ I/O # åºåˆ—åŒ–å’Œååºåˆ—åŒ–\nåºåˆ—åŒ–ï¼šå°†æ•°æ®ç»“æ„æˆ–å¯¹è±¡æ¢æˆäºŒçº§åˆ¶å­—èŠ‚æµçš„è¿‡ç¨‹ ååºåˆ—åŒ–ï¼šå°†åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­æ‰€ç”Ÿæˆçš„äºŒè¿›åˆ¶å­—èŠ‚æµè½¬æ¢æˆæ•°æ®ç»“æ„æˆ–è€…å¯¹è±¡çš„è¿‡ç¨‹ å¯¹äºJavaï¼Œåºåˆ—åŒ–çš„éƒ½æ˜¯å¯¹è±¡ï¼ˆObjectï¼‰ï¼Œå³å®ä¾‹åŒ–åçš„ç±»ï¼ˆClassï¼‰ ç»´åŸº\nåºåˆ—åŒ–ï¼ˆserializationï¼‰åœ¨è®¡ç®—æœºç§‘å­¦çš„æ•°æ®å¤„ç†ä¸­ï¼Œæ˜¯æŒ‡å°†æ•°æ®ç»“æ„æˆ–å¯¹è±¡çŠ¶æ€è½¬æ¢æˆå¯å–ç”¨æ ¼å¼ï¼ˆä¾‹å¦‚å­˜æˆæ–‡ä»¶ï¼Œå­˜äºç¼“å†²ï¼Œæˆ–ç»ç”±ç½‘ç»œä¸­å‘é€ï¼‰ï¼Œä»¥ç•™å¾…åç»­åœ¨ç›¸åŒæˆ–å¦ä¸€å°è®¡ç®—æœºç¯å¢ƒä¸­ï¼Œèƒ½æ¢å¤åŸå…ˆçŠ¶æ€çš„è¿‡ç¨‹ã€‚ä¾ç…§åºåˆ—åŒ–æ ¼å¼é‡æ–°è·å–å­—èŠ‚çš„ç»“æœæ—¶ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæ¥äº§ç”Ÿä¸åŸå§‹å¯¹è±¡ç›¸åŒè¯­ä¹‰çš„å‰¯æœ¬ã€‚å¯¹äºè®¸å¤šå¯¹è±¡ï¼Œåƒæ˜¯ä½¿ç”¨å¤§é‡å¼•ç”¨çš„å¤æ‚å¯¹è±¡ï¼Œè¿™ç§åºåˆ—åŒ–é‡å»ºçš„è¿‡ç¨‹å¹¶ä¸å®¹æ˜“ã€‚é¢å‘å¯¹è±¡ä¸­çš„å¯¹è±¡åºåˆ—åŒ–ï¼Œå¹¶ä¸æ¦‚æ‹¬ä¹‹å‰åŸå§‹å¯¹è±¡æ‰€å…³ç³»çš„å‡½æ•°ã€‚è¿™ç§è¿‡ç¨‹ä¹Ÿç§°ä¸ºå¯¹è±¡ç¼–ç»„ï¼ˆmarshallingï¼‰ã€‚ä»ä¸€ç³»åˆ—å­—èŠ‚æå–æ•°æ®ç»“æ„çš„åå‘æ“ä½œï¼Œæ˜¯ååºåˆ—åŒ–ï¼ˆä¹Ÿç§°ä¸ºè§£ç¼–ç»„ã€deserializationã€unmarshallingï¼‰ã€‚\nåºåˆ—åŒ–çš„ç›®çš„ï¼Œé€šè¿‡ç½‘ç»œä¼ è¾“å¯¹è±¡ï¼Œæˆ–è€…è¯´æ˜¯å°†å¯¹è±¡å­˜å‚¨åˆ°æ–‡ä»¶ç³»ç»Ÿã€æ•°æ®åº“ã€å†…å­˜ä¸­ è¢«transientä¿®é¥°çš„å˜é‡ï¼Œä¸è¿›è¡Œåºåˆ—åŒ–ï¼šå³å½“å¯¹è±¡è¢«ååºåˆ—åŒ–æ—¶ï¼Œè¢«transientä¿®é¥°çš„å˜é‡å€¼ä¸ä¼šè¢«æŒä¹…åŒ–å’Œæ¢å¤ transient è‹±[ËˆtrÃ¦nziÉ™nt]\ntransient åªèƒ½ä¿®é¥°å˜é‡ï¼Œä¸èƒ½ä¿®é¥°ç±»å’Œæ–¹æ³•ã€‚ transient ä¿®é¥°çš„å˜é‡ï¼Œåœ¨ååºåˆ—åŒ–åå˜é‡å€¼å°†ä¼šè¢«ç½®æˆç±»å‹çš„é»˜è®¤å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ˜¯ä¿®é¥° int ç±»å‹ï¼Œé‚£ä¹ˆååºåˆ—åç»“æœå°±æ˜¯ 0ã€‚ static å˜é‡å› ä¸ºä¸å±äºä»»ä½•å¯¹è±¡(Object)ï¼Œæ‰€ä»¥æ— è®ºæœ‰æ²¡æœ‰ transient å…³é”®å­—ä¿®é¥°ï¼Œå‡ä¸ä¼šè¢«åºåˆ—åŒ–ã€‚ Java IOæµ\nIO å³ Input/Outputï¼Œè¾“å…¥å’Œè¾“å‡ºã€‚æ•°æ®è¾“å…¥åˆ°è®¡ç®—æœºå†…å­˜çš„è¿‡ç¨‹å³è¾“å…¥ï¼Œåä¹‹è¾“å‡ºåˆ°å¤–éƒ¨å­˜å‚¨ï¼ˆæ¯”å¦‚æ•°æ®åº“ï¼Œæ–‡ä»¶ï¼Œè¿œç¨‹ä¸»æœºï¼‰çš„è¿‡ç¨‹å³è¾“å‡ºã€‚æ•°æ®ä¼ è¾“è¿‡ç¨‹ç±»ä¼¼äºæ°´æµï¼Œå› æ­¤ç§°ä¸º IO æµã€‚IO æµåœ¨ Java ä¸­åˆ†ä¸ºè¾“å…¥æµå’Œè¾“å‡ºæµï¼Œè€Œæ ¹æ®æ•°æ®çš„å¤„ç†æ–¹å¼åˆåˆ†ä¸ºå­—èŠ‚æµå’Œå­—ç¬¦æµã€‚\nJavaIOæµçš„ç±»éƒ½æ˜¯ä»å¦‚ä¸‹4ä¸ªæŠ½è±¡ç±»åŸºç±»ä¸­æ´¾ç”Ÿå‡ºæ¥çš„\nInputStream/Reader: æ‰€æœ‰çš„è¾“å…¥æµçš„åŸºç±»ï¼Œå‰è€…æ˜¯å­—èŠ‚è¾“å…¥æµï¼Œåè€…æ˜¯å­—ç¬¦è¾“å…¥æµã€‚ OutputStream/Writer: æ‰€æœ‰è¾“å‡ºæµçš„åŸºç±»ï¼Œå‰è€…æ˜¯å­—èŠ‚è¾“å‡ºæµï¼Œåè€…æ˜¯å­—ç¬¦è¾“å‡ºæµã€‚ ä¸ç®¡æ˜¯æ–‡ä»¶è¯»å†™è¿˜æ˜¯ç½‘ç»œå‘é€æ¥æ”¶ï¼Œä¿¡æ¯çš„æœ€å°å­˜å‚¨å•å…ƒéƒ½æ˜¯å­—èŠ‚ï¼Œé‚£ä¸ºä»€ä¹ˆI/Oæµæ“ä½œè¦åˆ†ä¸ºå­—èŠ‚æµæ“ä½œå’Œå­—ç¬¦æµæ“ä½œ\nå­—ç¬¦æµç”±Javaè™šæ‹Ÿæœºå°†å­—èŠ‚è½¬æ¢å¾—åˆ°ï¼Œè¿‡ç¨‹è¾ƒä¸ºè€—æ—¶ å¦‚æœä¸çŸ¥é“ç¼–ç ç±»å‹çš„è¿‡ï¼Œä½¿ç”¨å­—èŠ‚æµçš„è¿‡ç¨‹ä¸­å¾ˆå®¹æ˜“å‡ºç°ä¹±ç  è¯­æ³•ç³– # syntactic è‹±[sÉªnËˆtÃ¦ktÉªk] å¥æ³•çš„\næŒ‡çš„æ˜¯ä¸ºäº†æ–¹ä¾¿ç¨‹åºå‘˜å¼€å‘ç¨‹åºè€Œè®¾è®¡çš„ä¸€ç§ç‰¹æ®Šè¯­æ³•ï¼Œå¯¹ç¼–ç¨‹è¯­è¨€çš„åŠŸèƒ½å¹¶æ²¡æœ‰å½±å“ï¼Œè¯­æ³•ç³–å†™å‡ºæ¥çš„ä»£ç å¾€å¾€æ›´ç®€å•ç®€æ´ä¸”å®¹æ˜“é˜…è¯»ï¼Œæ¯”å¦‚for-eachï¼ŒåŸç†ï¼šåŸºäºæ™®é€šçš„forå¾ªç¯å’Œè¿­ä»£å™¨\nString[] strs = {\u0026#34;JavaGuide\u0026#34;, \u0026#34;å…¬ä¼—å·ï¼šJavaGuide\u0026#34;, \u0026#34;åšå®¢ï¼šhttps://javaguide.cn/\u0026#34;}; for (String s : strs) { System.out.println(s); } JVM å…¶å®å¹¶ä¸èƒ½è¯†åˆ«è¯­æ³•ç³–ï¼ŒJava è¯­æ³•ç³–è¦æƒ³è¢«æ­£ç¡®æ‰§è¡Œï¼Œéœ€è¦å…ˆé€šè¿‡ç¼–è¯‘å™¨è¿›è¡Œè§£ç³–ï¼Œä¹Ÿå°±æ˜¯åœ¨ç¨‹åºç¼–è¯‘é˜¶æ®µå°†å…¶è½¬æ¢æˆ JVM è®¤è¯†çš„åŸºæœ¬è¯­æ³•ã€‚è¿™ä¹Ÿä¾§é¢è¯´æ˜ï¼ŒJava ä¸­çœŸæ­£æ”¯æŒè¯­æ³•ç³–çš„æ˜¯ Java ç¼–è¯‘å™¨è€Œä¸æ˜¯ JVMã€‚å¦‚æœä½ å»çœ‹com.sun.tools.javac.main.JavaCompilerçš„æºç ï¼Œä½ ä¼šå‘ç°åœ¨compile()ä¸­æœ‰ä¸€ä¸ªæ­¥éª¤å°±æ˜¯è°ƒç”¨desugar()ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯è´Ÿè´£è§£è¯­æ³•ç³–çš„å®ç°çš„ã€‚\nJavaä¸­å¸¸è§çš„è¯­æ³•ç³–ï¼š\næ³›å‹ã€è‡ªåŠ¨æ‹†è£…ç®±ã€å˜é•¿å‚æ•°ã€æšä¸¾ã€å†…éƒ¨ç±»ã€å¢å¼º for å¾ªç¯ã€try-with-resources è¯­æ³•ã€lambda è¡¨è¾¾å¼ç­‰\n"},{"id":162,"href":"/zh/docs/study/Review/java_guide/java/Basic/ly0002lyjava_guide_basic_2/","title":"javaGuideåŸºç¡€2","section":"åŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\né¢å‘å¯¹è±¡åŸºç¡€ # åŒºåˆ«\né¢å‘è¿‡ç¨‹æŠŠè§£å†³é—®é¢˜çš„è¿‡ç¨‹æ‹†æˆä¸€ä¸ªä¸ªæ–¹æ³•ï¼Œé€šè¿‡ä¸€ä¸ªä¸ªæ–¹æ³•çš„æ‰§è¡Œè§£å†³é—®é¢˜ã€‚ é¢å‘å¯¹è±¡ä¼šå…ˆæŠ½è±¡å‡ºå¯¹è±¡ï¼Œç„¶åç”¨å¯¹è±¡æ‰§è¡Œæ–¹æ³•çš„æ–¹å¼è§£å†³é—®é¢˜ã€‚ é¢å‘å¯¹è±¡ç¼–ç¨‹ æ˜“ç»´æŠ¤ã€æ˜“å¤ç”¨ã€æ˜“æ‰©å±• å¯¹è±¡å®ä¾‹ä¸å¯¹è±¡å¼•ç”¨çš„ä¸åŒ\nnew è¿ç®—ç¬¦ï¼Œnew åˆ›å»ºå¯¹è±¡å®ä¾‹ï¼ˆå¯¹è±¡å®ä¾‹åœ¨å †å†…å­˜ä¸­ï¼‰ï¼Œå¯¹è±¡å¼•ç”¨æŒ‡å‘å¯¹è±¡å®ä¾‹ï¼ˆå¯¹è±¡å¼•ç”¨å­˜æ”¾åœ¨æ ˆå†…å­˜ä¸­ï¼‰ã€‚\nä¸€ä¸ªå¯¹è±¡å¼•ç”¨å¯ä»¥æŒ‡å‘ 0 ä¸ªæˆ– 1 ä¸ªå¯¹è±¡ï¼ˆä¸€æ ¹ç»³å­å¯ä»¥ä¸ç³»æ°”çƒï¼Œä¹Ÿå¯ä»¥ç³»ä¸€ä¸ªæ°”çƒï¼‰;ä¸€ä¸ªå¯¹è±¡å¯ä»¥æœ‰ n ä¸ªå¼•ç”¨æŒ‡å‘å®ƒï¼ˆå¯ä»¥ç”¨ n æ¡ç»³å­ç³»ä½ä¸€ä¸ªæ°”çƒï¼‰ã€‚\nå¯¹è±¡çš„ç›¸ç­‰ä¸€èˆ¬æ¯”è¾ƒçš„æ˜¯å†…å­˜ä¸­å­˜æ”¾çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ï¼›å¼•ç”¨ç›¸ç­‰ä¸€èˆ¬æ¯”è¾ƒçš„æ˜¯ä»–ä»¬æŒ‡å‘çš„å†…å­˜åœ°å€æ˜¯å¦ç›¸ç­‰\nå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å£°æ˜æ„é€ æ–¹æ³•ï¼Œè¯¥ç¨‹åºèƒ½æ­£ç¡®æ‰§è¡Œå—? å¦‚æœæˆ‘ä»¬è‡ªå·±æ·»åŠ äº†ç±»çš„æ„é€ æ–¹æ³•ï¼ˆæ— è®ºæ˜¯å¦æœ‰å‚ï¼‰ï¼ŒJava å°±ä¸ä¼šå†æ·»åŠ é»˜è®¤çš„æ— å‚æ•°çš„æ„é€ æ–¹æ³•äº†\næ„é€ æ–¹æ³•ç‰¹ç‚¹ï¼šåå­—ä¸ç±»åç›¸åŒï¼›æ²¡æœ‰è¿”å›å€¼ä½†ä¸èƒ½ç”¨voidå£°æ˜æ„é€ å‡½æ•°ï¼›ç”Ÿæˆç±»çš„å¯¹è±¡æ—¶è‡ªåŠ¨æ‰§è¡Œ æ„é€ æ–¹æ³•ä¸èƒ½é‡å†™(override)ï¼Œä½†èƒ½é‡è½½ (overload) é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹å¾\nå°è£…\næŠŠä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯(å±æ€§)éšè—åœ¨å¯¹è±¡å†…éƒ¨ï¼Œä¸å…è®¸ç›´æ¥è®¿é—®ï¼Œä½†æä¾›å¯ä»¥è¢«å¤–ç•Œè®¿é—®çš„æ–¹æ³•æ¥æ“ä½œå±æ€§\npublic class Student { private int id;//idå±æ€§ç§æœ‰åŒ– private String name;//nameå±æ€§ç§æœ‰åŒ– //è·å–idçš„æ–¹æ³• public int getId() { return id; } //è®¾ç½®idçš„æ–¹æ³• public void setId(int id) { this.id = id; } //è·å–nameçš„æ–¹æ³• public String getName() { return name; } //è®¾ç½®nameçš„æ–¹æ³• public void setName(String name) { this.name = name; } } ç»§æ‰¿\nä¸é€šç±»å‹çš„å¯¹è±¡ï¼Œç›¸äº’ä¹‹é—´æœ‰ä¸€å®šæ•°é‡çš„å…±åŒç‚¹ï¼ŒåŒæ—¶æ¯ä¸ªå¯¹è±¡å®šä¹‰äº†é¢å¤–çš„ç‰¹æ€§ä½¿å¾—ä»–ä»¬ä¸ä¼—ä¸åŒã€‚ç»§æ‰¿æ˜¯ä½¿ç”¨å·²å­˜åœ¨çš„ç±»çš„å®šä¹‰ä½œä¸ºåŸºç¡€å»ºç«‹æ–°ç±»çš„æŠ€æœ¯\nçˆ¶ç±»ä¸­çš„ç§æœ‰å±æ€§å’Œæ–¹æ³•å­ç±»æ— æ³•è®¿é—®ï¼Œåªæ˜¯æ‹¥æœ‰ å­ç±»å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„å±æ€§ã€æ–¹æ³•ï¼Œå³å¯¹çˆ¶ç±»è¿›è¡Œæ‹“å±• å­ç±»å¯ä»¥ç”¨è‡ªå·±çš„æ–¹å¼å®ç°çˆ¶ç±»çš„æ–¹æ³•ï¼ˆé‡å†™ï¼‰ å¤šæ€\nå¯¹è±¡ç±»å‹å’Œå¼•ç”¨ç±»å‹ä¹‹é—´å…·æœ‰ç»§æ‰¿(ç±»)/å®ç°(æ¥å£)çš„å…³ç³» å¼•ç”¨ç±»å‹å˜é‡å‘å‡ºçš„æ–¹æ³•å…·ä½“è°ƒç”¨å“ªä¸ªç±»çš„æ–¹æ³•ï¼Œåªæœ‰ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®š å¤šæ€ä¸èƒ½è°ƒç”¨â€œåªåœ¨å­ç±»å­˜åœ¨è€Œçˆ¶ç±»ä¸å­˜åœ¨â€çš„æ–¹æ³• å¦‚æœå­ç±»é‡å†™äº†çˆ¶ç±»çš„æ–¹æ³•ï¼ŒçœŸæ­£æ‰§è¡Œçš„æ˜¯å­ç±»è¦†ç›–çš„æ–¹æ³•ï¼Œå¦‚æœå­ç±»æ²¡æœ‰è¦†ç›–çˆ¶ç±»çš„æ–¹æ³•ï¼Œæ‰§è¡Œçš„æ˜¯çˆ¶ç±»çš„æ–¹æ³• æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆå…±åŒç‚¹å’ŒåŒºåˆ«\nå…±åŒï¼šéƒ½ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼›éƒ½å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•ï¼›éƒ½å¯ä»¥æœ‰é»˜è®¤å®ç°çš„æ–¹æ³•ã€‚ åŒºåˆ« æ¥å£ä¸»è¦ç”¨äºå¯¹ç±»çš„è¡Œä¸ºè¿›è¡Œçº¦æŸï¼›æŠ½è±¡ç±»ä¸»è¦ç”¨äºä»£ç å¤ç”¨ï¼ˆå¼ºè°ƒæ‰€å±ï¼‰ ç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œä½†èƒ½å®ç°å¤šä¸ªæ¥å£ æ¥å£ä¸­çš„æˆå‘˜åªèƒ½æ˜¯public static finalä¸èƒ½è¢«ä¿®æ”¹ä¸”å…·æœ‰åˆå§‹å€¼ï¼›è€ŒæŠ½è±¡ç±»ä¸­çš„æˆå‘˜å˜é‡é»˜è®¤ä¸ºdefault,ä¹Ÿå¯ä»¥è¢«public,protected,privateä¿®é¥°,å¯ä»¥ä¸ç”¨èµ‹åˆå€¼ å…³äºè®¿é—®æƒé™æ§åˆ¶\npublicï¼šJava è®¿é—®é™åˆ¶æœ€å®½çš„ä¿®é¥°ç¬¦ï¼Œä¸€èˆ¬ç§°ä¹‹ä¸ºâ€œå…¬å…±çš„â€ã€‚è¢«å…¶ä¿®é¥°çš„ç±»ã€å±æ€§ä»¥åŠæ–¹æ³•ä¸ä»…å¯ä»¥è·¨ç±»è®¿é—®ï¼Œè€Œä¸”å¯ä»¥è·¨åŒ…è®¿é—®ã€‚ protectedï¼šä»‹äº public å’Œ private ä¹‹é—´çš„ä¸€ç§è®¿é—®ä¿®é¥°ç¬¦ï¼Œä¸€èˆ¬ç§°ä¹‹ä¸ºâ€œä¿æŠ¤è®¿é—®æƒé™â€ã€‚è¢«å…¶ä¿®é¥°çš„å±æ€§ä»¥åŠæ–¹æ³•åªèƒ½è¢«ç±»æœ¬èº«åŠå…¶å­ç±»(å³ä½¿å­ç±»åœ¨ä¸åŒçš„åŒ…ä¸­)ï¼Œä»¥åŠåŒåŒ…çš„å…¶ä»–ç±»è®¿é—®ã€‚å¤–åŒ…çš„éå­ç±»ä¸å¯ä»¥è®¿é—®ã€‚ defaultï¼šâ€œé»˜è®¤è®¿é—®æƒé™â€œæˆ–â€œåŒ…è®¿é—®æƒé™â€ï¼Œå³ä¸åŠ ä»»ä½•è®¿é—®ä¿®é¥°ç¬¦ã€‚åªå…è®¸åœ¨åŒåŒ…è®¿é—®ï¼Œå¤–åŒ…çš„æ‰€æœ‰ç±»éƒ½ä¸èƒ½è®¿é—®ã€‚æ¥å£ä¾‹å¤– privateï¼šJava è®¿é—®é™åˆ¶æœ€çª„çš„ä¿®é¥°ç¬¦ï¼Œä¸€èˆ¬ç§°ä¹‹ä¸ºâ€œç§æœ‰çš„â€ã€‚è¢«å…¶ä¿®é¥°çš„å±æ€§ä»¥åŠæ–¹æ³•åªèƒ½è¢«è¯¥ç±»çš„å¯¹è±¡è®¿é—®ï¼Œå…¶å­ç±»ä¸èƒ½è®¿é—®ï¼Œæ›´ä¸å…è®¸è·¨åŒ…è®¿é—®ã€‚ æ·±æ‹·è´å’Œæµ…æ‹·è´çš„åŒºåˆ«ï¼Ÿä»€ä¹ˆæ˜¯å¼•ç”¨æ‹·è´\næµ…æ‹·è´ï¼šæµ…æ‹·è´ä¼šåœ¨å †ä¸Šåˆ›å»ºæ–°å¯¹è±¡ï¼Œä½†æ˜¯å¦‚æœåŸå¯¹è±¡å†…éƒ¨çš„å±æ€§æ˜¯å¼•ç”¨ç±»å‹çš„è¯ï¼Œæµ…æ‹·è´ä¼šå¤åˆ¶å†…éƒ¨å¯¹è±¡çš„å¼•ç”¨åœ°å€ï¼Œå³æ‹·è´å¯¹è±¡å’ŒåŸå¯¹è±¡å…±ç”¨ä¸€ä¸ªå†…éƒ¨å¯¹è±¡\næ·±æ‹·è´ï¼Œä¼šå®Œå…¨å¤åˆ¶æ•´ä¸ªå¯¹è±¡ï¼ŒåŒ…æ‹¬å¯¹è±¡å†…åŒ…å«çš„å†…éƒ¨å¯¹è±¡\nä¾‹å­\næµ…æ‹·è´\npublic class Address implements Cloneable{ private String name; // çœç•¥æ„é€ å‡½æ•°ã€Getter\u0026amp;Setteræ–¹æ³• @Override public Address clone() { try { return (Address) super.clone(); } catch (CloneNotSupportedException e) { throw new AssertionError(); } } } public class Person implements Cloneable { private Address address; // çœç•¥æ„é€ å‡½æ•°ã€Getter\u0026amp;Setteræ–¹æ³• @Override public Person clone() { try { Person person = (Person) super.clone(); return person; } catch (CloneNotSupportedException e) { throw new AssertionError(); } } } //------------------æµ‹è¯•-------------------- Person person1 = new Person(new Address(\u0026#34;æ­¦æ±‰\u0026#34;)); Person person1Copy = person1.clone(); // true System.out.println(person1.getAddress() == person1Copy.getAddress()); æ·±æ‹·è´\n//ä¿®æ”¹äº†Personç±»çš„clone()æ–¹æ³•è¿›è¡Œä¿®æ”¹ @Override public Person clone() { try { Person person = (Person) super.clone(); person.setAddress(person.getAddress().clone()); return person; } catch (CloneNotSupportedException e) { throw new AssertionError(); } } //--------------æµ‹è¯•------- Person person1 = new Person(new Address(\u0026#34;æ­¦æ±‰\u0026#34;)); Person person1Copy = person1.clone(); // false System.out.println(person1.getAddress() == person1Copy.getAddress()); å¼•ç”¨æ‹·è´ï¼Œå³ä¸¤ä¸ªä¸åŒçš„å¼•ç”¨æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡\nå¦‚å›¾\nJavaå¸¸è§ç±» # Object # å¸¸è§æ–¹æ³•\n/** * native æ–¹æ³•ï¼Œç”¨äºè¿”å›å½“å‰è¿è¡Œæ—¶å¯¹è±¡çš„ Class å¯¹è±¡ï¼Œä½¿ç”¨äº† final å…³é”®å­—ä¿®é¥°ï¼Œæ•…ä¸å…è®¸å­ç±»é‡å†™ã€‚ */ public final native Class\u0026lt;?\u0026gt; getClass() /** * native æ–¹æ³•ï¼Œç”¨äºè¿”å›å¯¹è±¡çš„å“ˆå¸Œç ï¼Œä¸»è¦ä½¿ç”¨åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œæ¯”å¦‚ JDK ä¸­çš„HashMapã€‚ */ public native int hashCode() /** * ç”¨äºæ¯”è¾ƒ 2 ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€æ˜¯å¦ç›¸ç­‰ï¼ŒString ç±»å¯¹è¯¥æ–¹æ³•è¿›è¡Œäº†é‡å†™ä»¥ç”¨äºæ¯”è¾ƒå­—ç¬¦ä¸²çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚ */ public boolean equals(Object obj) /** * naitive æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºå¹¶è¿”å›å½“å‰å¯¹è±¡çš„ä¸€ä»½æ‹·è´ã€‚ */ protected native Object clone() throws CloneNotSupportedException /** * è¿”å›ç±»çš„åå­—å®ä¾‹çš„å“ˆå¸Œç çš„ 16 è¿›åˆ¶çš„å­—ç¬¦ä¸²ã€‚å»ºè®® Object æ‰€æœ‰çš„å­ç±»éƒ½é‡å†™è¿™ä¸ªæ–¹æ³•ã€‚ */ public String toString() /** * native æ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½é‡å†™ã€‚å”¤é†’ä¸€ä¸ªåœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„çº¿ç¨‹(ç›‘è§†å™¨ç›¸å½“äºå°±æ˜¯é”çš„æ¦‚å¿µ)ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…åªä¼šä»»æ„å”¤é†’ä¸€ä¸ªã€‚ */ public final native void notify() /** * native æ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½é‡å†™ã€‚è·Ÿ notify ä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ä¼šå”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚ */ public final native void notifyAll() /** * nativeæ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½é‡å†™ã€‚æš‚åœçº¿ç¨‹çš„æ‰§è¡Œã€‚æ³¨æ„ï¼šsleep æ–¹æ³•æ²¡æœ‰é‡Šæ”¾é”ï¼Œè€Œ wait æ–¹æ³•é‡Šæ”¾äº†é” ï¼Œtimeout æ˜¯ç­‰å¾…æ—¶é—´ã€‚ */ public final native void wait(long timeout) throws InterruptedException /** * å¤šäº† nanos å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°è¡¨ç¤ºé¢å¤–æ—¶é—´ï¼ˆä»¥æ¯«å¾®ç§’ä¸ºå•ä½ï¼ŒèŒƒå›´æ˜¯ 0-999999ï¼‰ã€‚ æ‰€ä»¥è¶…æ—¶çš„æ—¶é—´è¿˜éœ€è¦åŠ ä¸Š nanos æ¯«ç§’ã€‚ã€‚ */ public final void wait(long timeout, int nanos) throws InterruptedException /** * è·Ÿä¹‹å‰çš„2ä¸ªwaitæ–¹æ³•ä¸€æ ·ï¼Œåªä¸è¿‡è¯¥æ–¹æ³•ä¸€ç›´ç­‰å¾…ï¼Œæ²¡æœ‰è¶…æ—¶æ—¶é—´è¿™ä¸ªæ¦‚å¿µ */ public final void wait() throws InterruptedException /** * å®ä¾‹è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„æ—¶å€™è§¦å‘çš„æ“ä½œ */ protected void finalize() throws Throwable { } == å’Œ equals() åŒºåˆ«\nå¯¹äºåŸºæœ¬ç±»å‹æ¥è¯´ï¼Œ== æ¯”è¾ƒçš„æ˜¯å€¼ å¯¹äºå¼•ç”¨ç±»å‹ï¼Œ== æ¯”è¾ƒçš„æ˜¯å¯¹è±¡çš„å†…å­˜åœ°å€ Javaæ˜¯å€¼ä¼ é€’ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šæ¯”è¾ƒçš„éƒ½æ˜¯å€¼ï¼Œåªæ˜¯å¼•ç”¨ç±»å‹å˜é‡å­˜çš„å€¼æ˜¯å¯¹è±¡åœ°å€ equalsä¸èƒ½ç”¨äºåˆ¤æ–­åŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡ï¼Œä¸”åªå­˜åœ¨äºObjectç±»ä¸­ï¼Œè€ŒObjectç±»æ˜¯æ‰€æœ‰ç±»çš„ç›´æ¥æˆ–é—´æ¥çˆ¶ç±»\nequalsé»˜è®¤å®ç°ï¼š\npublic boolean equals(Object obj) { return (this == obj); } å¦‚æœç±»æ²¡æœ‰é‡å†™è¯¥æ–¹æ³•ï¼Œåˆ™å¦‚ä¸Š\nå¦‚æœé‡å†™äº†ï¼Œåˆ™ä¸€èˆ¬éƒ½æ˜¯é‡å†™equalsæ–¹æ³•æ¥æ¯”è¾ƒå¯¹è±¡ä¸­çš„å±æ€§æ˜¯å¦ç›¸ç­‰\nå…³äºString å’Œ new String çš„åŒºåˆ«ï¼š String a = \u0026ldquo;xxx\u0026rdquo; å§‹ç»ˆè¿”å›çš„æ˜¯å¸¸é‡æ± ä¸­çš„å¼•ç”¨ï¼›è€Œnew String å§‹ç»ˆè¿”å›çš„æ˜¯å †ä¸­çš„å¼•ç”¨\nå¯¹äºString a = \u0026ldquo;xxx\u0026rdquo; ï¼Œå…ˆåˆ°å¸¸é‡æ± ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨å€¼ä¸º\u0026quot;xxx\u0026quot;çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœå­˜åœ¨ï¼Œç›´æ¥å°†å¸¸é‡æ± ä¸­è¯¥å€¼å¯¹åº”çš„å¼•ç”¨è¿”å›ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åœ¨å¸¸é‡æ± ä¸­åˆ›å»ºè¯¥å¯¹è±¡ï¼Œå¹¶è¿”å›å¼•ç”¨ã€‚\nå¯¹äºnew String(\u0026ldquo;xxx\u0026rdquo;)ï¼Œå…ˆåˆ°å¸¸é‡æ± ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨å€¼ä¸º\u0026quot;xxx\u0026quot;çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ç›´æ¥åœ¨å †ä¸­åˆ›å»ºå¯¹è±¡ï¼Œå¹¶è¿”å›å †ä¸­çš„ç´¢å¼•ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å…ˆåœ¨å¸¸é‡æ± ä¸­åˆ›å»ºå¯¹è±¡(å€¼ä¸ºxxx)ï¼Œç„¶åå†åœ¨å †ä¸­åˆ›å»ºå¯¹è±¡ï¼Œå¹¶è¿”å›å †ä¸­è¯¥å¯¹è±¡çš„å¼•ç”¨åœ°å€\næ¥è‡ª https://blog.csdn.net/weixin_44844089/article/details/103648448\nä¾‹å­ï¼š\nString a = new String(\u0026#34;ab\u0026#34;); // a ä¸ºä¸€ä¸ªå¼•ç”¨ String b = new String(\u0026#34;ab\u0026#34;); // bä¸ºå¦ä¸€ä¸ªå¼•ç”¨,å¯¹è±¡çš„å†…å®¹ä¸€æ · String aa = \u0026#34;ab\u0026#34;; // æ”¾åœ¨å¸¸é‡æ± ä¸­ String bb = \u0026#34;ab\u0026#34;; // ä»å¸¸é‡æ± ä¸­æŸ¥æ‰¾ System.out.println(aa == bb);// true System.out.println(a == b);// false System.out.println(a.equals(b));// true System.out.println(42 == 42.0);// true String ç±»é‡å†™äº†equals()æ–¹æ³•\npublic boolean equals(Object anObject) { if (this == anObject) { return true; } if (anObject instanceof String) { String anotherString = (String)anObject; int n = value.length; if (n == anotherString.value.length) { char v1[] = value; char v2[] = anotherString.value; int i = 0; while (n-- != 0) { if (v1[i] != v2[i]) return false; i++; } return true; } } return false; } hashCode()æœ‰ä»€ä¹ˆç”¨\nhashCode()çš„ä½œç”¨æ˜¯è·å–å“ˆå¸Œç (intæ•´æ•°)ï¼Œä¹Ÿç§°ä¸ºæ•£åˆ—ç ï¼Œä½œç”¨æ˜¯ç¡®å®šè¯¥å¯¹è±¡åœ¨å“ˆå¸Œè¡¨ä¸­çš„ç´¢å¼•ä½ç½®ã€‚å‡½æ•°å®šä¹‰åœ¨Objectç±»ä¸­ï¼Œä¸”ä¸ºæœ¬åœ°æ–¹æ³•ï¼Œé€šå¸¸ç”¨æ¥å°†å¯¹è±¡çš„å†…å­˜åœ°å€è½¬æ¢ä¸ºæ•´æ•°ä¹‹åè¿”å›ï¼›æ•£åˆ—è¡¨å­˜å‚¨çš„æ˜¯é”®å€¼å¯¹(key-value)ï¼Œæ ¹æ®â€œé”®â€å¿«é€Ÿæ£€ç´¢å‡ºâ€œå€¼â€ï¼Œå…¶ä¸­åˆ©ç”¨äº†æ•£åˆ—ç \nä¸ºä»€ä¹ˆéœ€è¦hashCode\nå½“ä½ æŠŠå¯¹è±¡åŠ å…¥ HashSet æ—¶ï¼ŒHashSet ä¼šå…ˆè®¡ç®—å¯¹è±¡çš„ hashCode å€¼æ¥åˆ¤æ–­å¯¹è±¡åŠ å…¥çš„ä½ç½®ï¼ŒåŒæ—¶ä¹Ÿä¼šä¸å…¶ä»–å·²ç»åŠ å…¥çš„å¯¹è±¡çš„ hashCode å€¼ä½œæ¯”è¾ƒï¼Œå¦‚æœæ²¡æœ‰ç›¸ç¬¦çš„ hashCodeï¼ŒHashSet ä¼šå‡è®¾å¯¹è±¡æ²¡æœ‰é‡å¤å‡ºç°ã€‚ä½†æ˜¯å¦‚æœå‘ç°æœ‰ç›¸åŒ hashCode å€¼çš„å¯¹è±¡ï¼Œè¿™æ—¶ä¼šè°ƒç”¨ equals() æ–¹æ³•æ¥æ£€æŸ¥ hashCode ç›¸ç­‰çš„å¯¹è±¡æ˜¯å¦çœŸçš„ç›¸åŒã€‚å¦‚æœä¸¤è€…ç›¸åŒï¼ŒHashSet å°±ä¸ä¼šè®©å…¶åŠ å…¥æ“ä½œæˆåŠŸã€‚å¦‚æœä¸åŒçš„è¯ï¼Œå°±ä¼šé‡æ–°æ•£åˆ—åˆ°å…¶ä»–ä½ç½®ã€æ³¨æ„ï¼Œæˆ‘è§‰å¾—è¿™é‡Œåº”è¯¥æ˜¯ä½¿ç”¨æ‹‰é“¾æ³•ï¼Œè¯´æˆæ•£åˆ—åˆ°å…¶ä»–ä½ç½®è²Œä¼¼æœ‰ç‚¹ä¸å¯¹ã€‘ã€‚è¿™æ ·æˆ‘ä»¬å°±å¤§å¤§å‡å°‘äº† equals çš„æ¬¡æ•°ï¼Œç›¸åº”å°±å¤§å¤§æé«˜äº†æ‰§è¡Œé€Ÿåº¦ã€‚\nhashCode()å’Œequals()éƒ½ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œä¸ºä»€ä¹ˆè¦åŒæ—¶æä¾›ä¸¤ä¸ªæ–¹æ³•ï¼ˆå› ä¸ºåœ¨ä¸€äº›å®¹å™¨ä¸­ï¼Œå¦‚HashMapã€HashSetä¸­ï¼Œåˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨å®¹å™¨ä¸­æ•ˆç‡æ›´é«˜)\nä¸¤ä¸ªå¯¹è±¡çš„hashCodeå€¼ç›¸ç­‰å¹¶ä¸ä»£è¡¨ä¸¤ä¸ªå¯¹è±¡å°±ç›¸ç­‰ å› ä¸ºhashCodeæ‰€ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ä¹Ÿè®¸ä¼šè®©å¤šä¸ªå¯¹è±¡ä¼ å›ç›¸åŒå“ˆå¸Œå€¼ï¼Œå–å†³äºå“ˆå¸Œç®—æ³• æ€»ç»“\nå¦‚æœä¸¤ä¸ªå¯¹è±¡çš„hashCode å€¼ç›¸ç­‰ï¼Œé‚£è¿™ä¸¤ä¸ªå¯¹è±¡ä¸ä¸€å®šç›¸ç­‰ï¼ˆå“ˆå¸Œç¢°æ’ï¼‰ã€‚ å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„hashCode å€¼ç›¸ç­‰å¹¶ä¸”equals()æ–¹æ³•ä¹Ÿè¿”å› trueï¼Œæˆ‘ä»¬æ‰è®¤ä¸ºè¿™ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ã€‚ å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„**hashCode å€¼ä¸ç›¸ç­‰**ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è®¤ä¸ºè¿™ä¸¤ä¸ªå¯¹è±¡ä¸ç›¸ç­‰ã€‚ String # Stringã€StringBufferï¼ŒStringBuilderåŒºåˆ« Stringæ˜¯ä¸å¯å˜çš„ï¼ŒStringBufferå’ŒStringBuilderéƒ½ç»§æ‰¿è‡ªAbstractStringBuilderç±»ï¼Œæ˜¯å¯å˜çš„ï¼ˆæä¾›äº†ä¿®æ”¹å­—ç¬¦ä¸²çš„æ–¹æ³•ï¼‰\nStringä¸­çš„å˜é‡ä¸å¯å˜ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€ŒStringBufferå¯¹æ–¹æ³•åŠ äº†åŒæ­¥é”ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›è€ŒStringBuilderæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„\nä¸‰è€…ä½¿ç”¨å»ºè®®\næ“ä½œå°‘é‡çš„æ•°æ®: é€‚ç”¨ String å•çº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ®: é€‚ç”¨ StringBuilder å¤šçº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ®: é€‚ç”¨ StringBuffer String ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„\nä»£ç \npublic final class String implements java.io.Serializable, Comparable\u0026lt;String\u0026gt;, CharSequence { private final char value[]; //... } å¦‚ä¸Šï¼Œä¿å­˜å­—ç¬¦ä¸²çš„æ•°ç»„è¢«finalä¿®é¥°ä¸”ä¸ºç§æœ‰ï¼Œå¹¶ä¸”Stringç±»æ²¡æœ‰æä¾›æš´éœ²ä¿®æ”¹è¯¥å­—ç¬¦ä¸²çš„æ–¹æ³• Stringç±»è¢«ä¿®é¥°ä¸ºfinalä¿®é¥°å¯¼è‡´ä¸èƒ½è¢«ç»§æ‰¿ï¼Œé¿å…å­ç±»ç ´å Java9\npublic final class String implements java.io.Serializable,Comparable\u0026lt;String\u0026gt;, CharSequence { // @Stable æ³¨è§£è¡¨ç¤ºå˜é‡æœ€å¤šè¢«ä¿®æ”¹ä¸€æ¬¡ï¼Œç§°ä¸ºâ€œç¨³å®šçš„â€ã€‚ @Stable private final byte[] value; } abstract class AbstractStringBuilder implements Appendable, CharSequence { byte[] value; } Java9ä¸ºä½•Stringåº•å±‚å®ç°ç”±char[] æ”¹æˆäº† byte[] æ–°ç‰ˆçš„ String å…¶å®æ”¯æŒä¸¤ä¸ªç¼–ç æ–¹æ¡ˆï¼š Latin-1 å’Œ UTF-16ã€‚å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«çš„æ±‰å­—æ²¡æœ‰è¶…è¿‡ Latin-1 å¯è¡¨ç¤ºèŒƒå›´å†…çš„å­—ç¬¦ï¼Œé‚£å°±ä¼šä½¿ç”¨ Latin-1 ä½œä¸ºç¼–ç æ–¹æ¡ˆã€‚Latin-1 ç¼–ç æ–¹æ¡ˆä¸‹ï¼Œbyte å ä¸€ä¸ªå­—èŠ‚(8 ä½)ï¼Œchar å ç”¨ 2 ä¸ªå­—èŠ‚ï¼ˆ16ï¼‰ï¼Œbyte ç›¸è¾ƒ char èŠ‚çœä¸€åŠçš„å†…å­˜ç©ºé—´ã€‚\nJDK å®˜æ–¹å°±è¯´äº†ç»å¤§éƒ¨åˆ†å­—ç¬¦ä¸²å¯¹è±¡åªåŒ…å« Latin-1 å¯è¡¨ç¤ºçš„å­—ç¬¦ã€‚ [ËˆlÃ¦tÉªn] å­—ç¬¦ä¸²ä½¿ç”¨â€œ+â€ è¿˜æ˜¯ Stringbuilder Javaæœ¬èº«ä¸æ”¯æŒè¿ç®—ç¬¦é‡è½½ï¼Œä½† â€œ + â€ å’Œ â€œ+=â€ æ˜¯ä¸“é—¨ä¸ºStringé‡è½½è¿‡çš„è¿ç®—ç¬¦ï¼ŒJavaä¸­ä»…æœ‰çš„ä¸¤ä¸ª\nString str1 = \u0026#34;he\u0026#34;; String str2 = \u0026#34;llo\u0026#34;; String str3 = \u0026#34;world\u0026#34;; String str4 = str1 + str2 + str3; å¯¹åº”çš„å­—èŠ‚ç ï¼š\nå­—ç¬¦ä¸²å¯¹è±¡é€šè¿‡â€œ+â€çš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ StringBuilder è°ƒç”¨ append() æ–¹æ³•å®ç°çš„ï¼Œæ‹¼æ¥å®Œæˆä¹‹åè°ƒç”¨ toString() å¾—åˆ°ä¸€ä¸ª String å¯¹è±¡ã€‚å› æ­¤è¿™é‡Œå°±ä¼šäº§ç”Ÿé—®é¢˜ï¼Œå¦‚ä¸‹ä»£ç ï¼Œä¼šäº§ç”Ÿè¿‡å¤šçš„StringBuilderå¯¹è±¡\nString[] arr = {\u0026#34;he\u0026#34;, \u0026#34;llo\u0026#34;, \u0026#34;world\u0026#34;}; String s = \u0026#34;\u0026#34;; for (int i = 0; i \u0026lt; arr.length; i++) { s += arr[i]; } System.out.println(s); ä¼šå¾ªç¯åˆ›å»ºStringBuilderå¯¹è±¡ï¼Œå»ºè®®è‡ªå·±åˆ›å»ºä¸€ä¸ªæ–°çš„StringBuilderå¹¶ä½¿ç”¨ï¼š\nString[] arr = {\u0026#34;he\u0026#34;, \u0026#34;llo\u0026#34;, \u0026#34;world\u0026#34;}; StringBuilder s = new StringBuilder(); for (String value : arr) { s.append(value); } System.out.println(s); String#equals()å’ŒObject#equals()æœ‰ä½•åŒºåˆ« Stringçš„equalsè¢«é‡å†™è¿‡ï¼Œæ¯”è¾ƒçš„æ˜¯å­—ç¬¦ä¸²çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œè€ŒObjectçš„equalsæ¯”è¾ƒçš„æ˜¯å¯¹è±¡çš„å†…å­˜åœ°å€\nå­—ç¬¦ä¸²å¸¸é‡æ± \næ˜¯JVMä¸ºäº†æå‡æ€§èƒ½å’Œå‡å°‘å†…å­˜æ¶ˆè€—é’ˆå¯¹å­—ç¬¦ä¸²ï¼ˆStringç±»ï¼‰ä¸“é—¨å¼€è¾Ÿçš„ä¸€å—åŒºåŸŸï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†é¿å…å­—ç¬¦ä¸²çš„é‡å¤åˆ›å»º\n// åœ¨å †ä¸­åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡â€abâ€œ (è¿™é‡Œä¹Ÿå¯ä»¥è¯´æ˜¯åœ¨å¸¸é‡æ± ä¸­åˆ›å»ºå¯¹è±¡) // å°†å­—ç¬¦ä¸²å¯¹è±¡â€abâ€œçš„å¼•ç”¨(å¸¸é‡æ± ä¸­çš„é¥®ç”¨)ä¿å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ String aa = \u0026#34;ab\u0026#34;; // ç›´æ¥è¿”å›å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­—ç¬¦ä¸²å¯¹è±¡â€abâ€œçš„å¼•ç”¨ String bb = \u0026#34;ab\u0026#34;; System.out.println(aa==bb);// true String s1 = new String(\u0026ldquo;abc\u0026rdquo;);è¿™å¥è¯åˆ›å»ºäº†å‡ ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Ÿ # ä¼šåˆ›å»º 1 æˆ– 2 ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ã€‚ å¦‚æœå¸¸é‡æ± ä¸­å­˜åœ¨å€¼ä¸º\u0026quot;abc\u0026quot;çš„å¯¹è±¡ï¼Œåˆ™ç›´æ¥åœ¨å †ä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”è¿”å›è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å…ˆåœ¨å¸¸é‡æ± ä¸­åˆ›å»ºè¯¥å¯¹è±¡ï¼Œç„¶åå†åœ¨å †ä¸­åˆ›å»ºè¯¥å¯¹è±¡ï¼Œå¹¶ä¸”è¿”å›è¯¥å¯¹è±¡ï¼ˆå †ä¸­ï¼‰çš„å¼•ç”¨\nä¸‹é¢è¿™ä¸ªè§£é‡Šï¼Œè¯´æ˜å¸¸é‡æ± å­˜å‚¨çš„æ˜¯å¼•ç”¨ï¼ˆå †ä¸­æŸä¸€å—åŒºåŸŸçš„ï¼‰\n// å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å·²å­˜åœ¨å­—ç¬¦ä¸²å¯¹è±¡â€œabcâ€çš„å¼•ç”¨ String s1 = \u0026#34;abc\u0026#34;; // ä¸‹é¢è¿™æ®µä»£ç åªä¼šåœ¨å †ä¸­åˆ›å»º 1 ä¸ªå­—ç¬¦ä¸²å¯¹è±¡â€œabcâ€ String s2 = new String(\u0026#34;abc\u0026#34;); internæ–¹æ³•çš„ä½œç”¨ï¼Œæ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œä½œç”¨æ˜¯å°†æŒ‡å®šçš„å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ä¿å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­\n// åœ¨å †ä¸­åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡â€Javaâ€œ // å°†å­—ç¬¦ä¸²å¯¹è±¡â€Javaâ€œçš„å¼•ç”¨ä¿å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ String s1 = \u0026#34;Java\u0026#34;; // ç›´æ¥è¿”å›å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­—ç¬¦ä¸²å¯¹è±¡â€Javaâ€œå¯¹åº”çš„å¼•ç”¨ String s2 = s1.intern(); // ä¼šåœ¨å †ä¸­åœ¨å•ç‹¬åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ String s3 = new String(\u0026#34;Java\u0026#34;); // ç›´æ¥è¿”å›å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­—ç¬¦ä¸²å¯¹è±¡â€Javaâ€œå¯¹åº”çš„å¼•ç”¨ String s4 = s3.intern(); // s1 å’Œ s2 æŒ‡å‘çš„æ˜¯å †ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡ System.out.println(s1 == s2); // true // s3 å’Œ s4 æŒ‡å‘çš„æ˜¯å †ä¸­ä¸åŒçš„å¯¹è±¡ System.out.println(s3 == s4); // false // s1 å’Œ s4 æŒ‡å‘çš„æ˜¯å †ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡ System.out.println(s1 == s4); //true é—®é¢˜ï¼šString ç±»å‹çš„å˜é‡å’Œå¸¸é‡åšâ€œ+â€è¿ç®—æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ\nString str1 = \u0026#34;str\u0026#34;; String str2 = \u0026#34;ing\u0026#34;; String str3 = \u0026#34;str\u0026#34; + \u0026#34;ing\u0026#34;; String str4 = str1 + str2; String str5 = \u0026#34;string\u0026#34;; System.out.println(str3 == str4);//false System.out.println(str3 == str5);//true System.out.println(str4 == str5);//false å¸¸é‡æŠ˜å \nå¯¹äº String str3 = \u0026quot;str\u0026quot; + \u0026quot;ing\u0026quot;; ç¼–è¯‘å™¨ä¼šç»™ä½ ä¼˜åŒ–æˆ String str3 = \u0026quot;string\u0026quot;; ã€‚\nå¹¶ä¸æ˜¯æ‰€æœ‰çš„å¸¸é‡éƒ½ä¼šè¿›è¡ŒæŠ˜å ï¼Œåªæœ‰ç¼–è¯‘å™¨åœ¨ç¨‹åºç¼–è¯‘æœŸå°±å¯ä»¥ç¡®å®šå€¼çš„å¸¸é‡æ‰å¯ä»¥ï¼š\nåŸºæœ¬æ•°æ®ç±»å‹( byteã€booleanã€shortã€charã€intã€floatã€longã€double)ä»¥åŠå­—ç¬¦ä¸²å¸¸é‡ã€‚ final ä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹å’Œå­—ç¬¦ä¸²å˜é‡ å­—ç¬¦ä¸²é€šè¿‡ â€œ+â€æ‹¼æ¥å¾—åˆ°çš„å­—ç¬¦ä¸²ã€åŸºæœ¬æ•°æ®ç±»å‹ä¹‹é—´ç®—æ•°è¿ç®—ï¼ˆåŠ å‡ä¹˜é™¤ï¼‰ã€åŸºæœ¬æ•°æ®ç±»å‹çš„ä½è¿ç®—ï¼ˆ\u0026laquo;ã€\u0026raquo;ã€\u0026raquo;\u0026gt; ï¼‰ å¼•ç”¨çš„å€¼åœ¨ç¨‹åºç¼–è¯‘æœŸé—´æ˜¯æ— æ³•ç¡®è®¤çš„ï¼Œæ— æ³•å¯¹å…¶ä¼˜åŒ–\nå¯¹è±¡å¼•ç”¨å’Œâ€œ+â€çš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ StringBuilder è°ƒç”¨ append() æ–¹æ³•å®ç°çš„ï¼Œæ‹¼æ¥å®Œæˆä¹‹åè°ƒç”¨ toString() å¾—åˆ°ä¸€ä¸ª String å¯¹è±¡ ã€‚ å¦‚ä¸Šé¢ä»£ç String str4 = str1 + str2; ä½†æ˜¯å¦‚æœä½¿ç”¨äº†finalå…³é”®å­—å£°æ˜ä¹‹åï¼Œå°±å¯ä»¥è®©ç¼–è¯‘å™¨å½“ä½œå¸¸é‡æ¥å¤„ç†\nfinal String str1 = \u0026#34;str\u0026#34;; final String str2 = \u0026#34;ing\u0026#34;; // ä¸‹é¢ä¸¤ä¸ªè¡¨è¾¾å¼å…¶å®æ˜¯ç­‰ä»·çš„ String c = \u0026#34;str\u0026#34; + \u0026#34;ing\u0026#34;;// å¸¸é‡æ± ä¸­çš„å¯¹è±¡ String d = str1 + str2; // å¸¸é‡æ± ä¸­çš„å¯¹è±¡ System.out.println(c == d);// true ä½†æ˜¯å¦‚æœç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶æ‰èƒ½çŸ¥é“å…¶ç¡®åˆ‡å€¼çš„è¯ï¼Œå°±æ— æ³•å¯¹å…¶ä¼˜åŒ–\nfinal String str1 = \u0026#34;str\u0026#34;; final String str2 = getStr(); //str2åªæœ‰åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šå…¶å€¼ String c = \u0026#34;str\u0026#34; + \u0026#34;ing\u0026#34;;// å¸¸é‡æ± ä¸­çš„å¯¹è±¡ String d = str1 + str2; // åœ¨å †ä¸Šåˆ›å»ºçš„æ–°çš„å¯¹è±¡ System.out.println(c == d);// false public static String getStr() { return \u0026#34;ing\u0026#34;; } "},{"id":163,"href":"/zh/docs/study/Review/java_guide/java/Basic/ly0001lyjava_guide_basic_1/","title":"javaGuideåŸºç¡€1","section":"åŸºç¡€","content":" è½¬è½½è‡ªhttps://github.com/Snailclimb/JavaGuide ï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nåŸºç¡€æ¦‚å¿µåŠå¸¸è¯† # Javaè¯­è¨€ç‰¹ç‚¹\né¢å‘å¯¹è±¡ï¼ˆå°è£…ã€ç»§æ‰¿ã€å¤šæ€ï¼‰ å¹³å°æ— å…³æ€§ï¼ˆJavaè™šæ‹Ÿæœºï¼‰ ç­‰ç­‰ JVMå¹¶éåªæœ‰ä¸€ç§ï¼Œåªè¦æ»¡è¶³JVMè§„èŒƒï¼Œå¯ä»¥å¼€å‘è‡ªå·±ä¸“å±JVM\nJDKä¸JRE\nJDKï¼ŒJavaDevelopmentKitï¼ŒåŒ…å«JREï¼Œè¿˜æœ‰ç¼–è¯‘å™¨ï¼ˆjavacï¼‰å’Œå·¥å…·ï¼ˆå¦‚javadocã€jdbï¼‰ã€‚èƒ½å¤Ÿåˆ›å»ºå’Œç¼–è¯‘ç¨‹åº JREï¼ŒJavaè¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒ…æ‹¬Javaè™šæ‹Ÿæœºã€Javaç±»åº“ï¼ŒåŠJavaå‘½ä»¤ç­‰ã€‚ä½†æ˜¯ä¸èƒ½åˆ›å»ºæ–°ç¨‹åº å­—èŠ‚ç ï¼Œé‡‡ç”¨å­—èŠ‚ç çš„å¥½å¤„\nJavaä¸­ï¼ŒJVMå¯ä»¥ç†è§£çš„ä»£ç ç§°ä¸ºå­—èŠ‚ç ï¼ˆ.classæ–‡ä»¶)ï¼Œä¸é¢å‘ä»»ä½•å¤„ç†å™¨ï¼Œåªé¢å‘è™šæ‹Ÿæœº Javaç¨‹åºä»æºä»£ç åˆ°è¿è¡Œçš„è¿‡ç¨‹ javaä»£ç å¿…é¡»å…ˆç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œä¹‹åå‘¢ï¼Œ.class\u0026ndash;\u0026gt;æœºå™¨ç ï¼Œè¿™é‡ŒJVMç±»åŠ è½½å™¨å…ˆåŠ è½½å­—èŠ‚ç æ–‡ä»¶ï¼Œç„¶åé€šè¿‡è§£é‡Šå™¨è¿›è¡Œè§£é‡Šæ‰§è¡Œï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç éœ€è¦ç”±Javaè§£é‡Šå™¨æ¥è§£é‡Šæ‰§è¡Œï¼‰ Javaè§£é‡Šå™¨æ˜¯JVMçš„ä¸€éƒ¨åˆ† ç¼–è¯‘ä¸è§£é‡Šå¹¶å­˜\nç¼–è¯‘å‹ï¼šé€šè¿‡ç¼–è¯‘å™¨å°†æºä»£ç ä¸€æ¬¡æ€§ç¿»è¯‘æˆå¯è¢«è¯¥å¹³å°æ‰§è¡Œçš„æœºå™¨ç ï¼Œæ‰§è¡Œå¿«ã€å¼€å‘æ•ˆç‡ä½ è§£é‡Šå‹ï¼šé€šè¿‡è§£é‡Šå™¨ä¸€å¥ä¸€å¥çš„å°†ä»£ç è§£é‡Šæˆæœºå™¨ä»£ç åæ‰§è¡Œï¼Œæ‰§è¡Œæ…¢ï¼Œå¼€å‘æ•ˆç‡é«˜ å¦‚å›¾ ä¸ºä»€ä¹ˆè¯´ Java è¯­è¨€â€œç¼–è¯‘ä¸è§£é‡Šå¹¶å­˜â€ï¼Ÿ\nè¿™æ˜¯å› ä¸º Java è¯­è¨€æ—¢å…·æœ‰ç¼–è¯‘å‹è¯­è¨€çš„ç‰¹å¾ï¼Œä¹Ÿå…·æœ‰è§£é‡Šå‹è¯­è¨€çš„ç‰¹å¾ã€‚å› ä¸º Java ç¨‹åºè¦ç»è¿‡å…ˆç¼–è¯‘ï¼Œåè§£é‡Šä¸¤ä¸ªæ­¥éª¤ï¼Œç”± Java ç¼–å†™çš„ç¨‹åºéœ€è¦å…ˆç»è¿‡ç¼–è¯‘æ­¥éª¤ï¼Œç”Ÿæˆå­—èŠ‚ç ï¼ˆ.class æ–‡ä»¶ï¼‰ï¼Œè¿™ç§å­—èŠ‚ç å¿…é¡»ç”± Java è§£é‡Šå™¨æ¥è§£é‡Šæ‰§è¡Œã€‚\nJavaä¸C++åŒºåˆ«\næ²¡å­¦è¿‡C++ï¼ŒJavaä¸æä¾›æŒ‡é’ˆç›´æ¥è®¿é—®å†…å­˜ Javaä¸ºå•ç»§æ‰¿ï¼›ä½†æ˜¯Javaæ”¯æŒç»§æ‰¿å¤šæ¥å£ Javaæœ‰è‡ªåŠ¨å†…å­˜ç®¡ç†åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆGCï¼‰ï¼Œä¸éœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨é‡Šæ”¾æ— ç”¨å†…å­˜ æ³¨é‡Šåˆ†ä¸º å•è¡Œæ³¨é‡Šã€å¤šè¡Œæ³¨é‡Šã€æ–‡æ¡£æ³¨é‡Š æ ‡è¯†ç¬¦ä¸å…³é”®å­— æ ‡è¯†ç¬¦å³åå­—ï¼Œå…³é”®å­—åˆ™æ˜¯è¢«èµ‹äºˆç‰¹æ®Šå«ä¹‰çš„æ ‡è¯†ç¬¦\nè‡ªå¢è‡ªå‡è¿ç®—ç¬¦ å½“ b = ++a æ—¶ï¼Œå…ˆè‡ªå¢ï¼ˆè‡ªå·±å¢åŠ  1ï¼‰ï¼Œå†èµ‹å€¼ï¼ˆèµ‹å€¼ç»™ bï¼‰ï¼›å½“ b = a++ æ—¶ï¼Œå…ˆèµ‹å€¼(èµ‹å€¼ç»™ b)ï¼Œå†è‡ªå¢ï¼ˆè‡ªå·±å¢åŠ  1ï¼‰\ncontinue/break/return\ncontinue ï¼šæŒ‡è·³å‡ºå½“å‰çš„è¿™ä¸€æ¬¡å¾ªç¯ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚ break ï¼šæŒ‡è·³å‡ºæ•´ä¸ªå¾ªç¯ä½“ï¼Œç»§ç»­æ‰§è¡Œå¾ªç¯ä¸‹é¢çš„è¯­å¥ã€‚ return ç”¨äºè·³å‡ºæ‰€åœ¨æ–¹æ³•ï¼Œç»“æŸè¯¥æ–¹æ³•çš„è¿è¡Œã€‚ å˜é‡\næˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡ æˆå‘˜å˜é‡å¯ä»¥è¢« public,private,static ç­‰ä¿®é¥°ç¬¦æ‰€ä¿®é¥°ï¼Œè€Œå±€éƒ¨å˜é‡ä¸èƒ½è¢«è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦åŠ static æ‰€ä¿®é¥°ï¼›ä½†æ˜¯ï¼Œæˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡éƒ½èƒ½è¢« final æ‰€ä¿®é¥° ä»å˜é‡åœ¨å†…å­˜ä¸­çš„å­˜å‚¨æ–¹å¼æ¥çœ‹,å¦‚æœæˆå‘˜å˜é‡æ˜¯ä½¿ç”¨ static ä¿®é¥°çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªæˆå‘˜å˜é‡æ˜¯å±äºç±»çš„ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨ static ä¿®é¥°ï¼Œè¿™ä¸ªæˆå‘˜å˜é‡æ˜¯å±äºå®ä¾‹çš„ã€‚è€Œå¯¹è±¡å­˜åœ¨äºå †å†…å­˜ï¼Œå±€éƒ¨å˜é‡åˆ™å­˜åœ¨äºæ ˆå†…å­˜ã€‚ ä»å˜é‡åœ¨å†…å­˜ä¸­çš„ç”Ÿå­˜æ—¶é—´ä¸Šçœ‹ï¼Œæˆå‘˜å˜é‡æ˜¯å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒéšç€å¯¹è±¡çš„åˆ›å»ºè€Œå­˜åœ¨ï¼Œè€Œå±€éƒ¨å˜é‡éšç€æ–¹æ³•çš„è°ƒç”¨è€Œè‡ªåŠ¨ç”Ÿæˆï¼Œéšç€æ–¹æ³•çš„è°ƒç”¨ç»“æŸè€Œæ¶ˆäº¡ï¼ˆå³æ–¹æ³•æ ˆå¼¹å‡ºåæ¶ˆäº¡ï¼‰ã€‚ finalå¿…é¡»æ˜¾ç¤ºèµ‹åˆå§‹å€¼ï¼Œå…¶ä»–éƒ½è‡ªåŠ¨ä»¥ç±»å‹é»˜è®¤å€¼èµ‹å€¼ é™æ€å˜é‡ï¼šè¢«ç±»æ‰€æœ‰å®ä¾‹å…±äº« å­—ç¬¦å‹å¸¸é‡ä¸å­—ç¬¦ä¸²å¸¸é‡åŒºåˆ«\nå½¢å¼ : å­—ç¬¦å¸¸é‡æ˜¯å•å¼•å·å¼•èµ·çš„ä¸€ä¸ªå­—ç¬¦ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ˜¯åŒå¼•å·å¼•èµ·çš„ 0 ä¸ªæˆ–è‹¥å¹²ä¸ªå­—ç¬¦ã€‚ å«ä¹‰ : å­—ç¬¦å¸¸é‡ç›¸å½“äºä¸€ä¸ªæ•´å‹å€¼( ASCII å€¼),å¯ä»¥å‚åŠ è¡¨è¾¾å¼è¿ç®—; å­—ç¬¦ä¸²å¸¸é‡ä»£è¡¨ä¸€ä¸ªåœ°å€å€¼(è¯¥å­—ç¬¦ä¸²åœ¨å†…å­˜ä¸­å­˜æ”¾ä½ç½®)ã€‚ å å†…å­˜å¤§å° ï¼š å­—ç¬¦å¸¸é‡åªå  2 ä¸ªå­—èŠ‚; å­—ç¬¦ä¸²å¸¸é‡å è‹¥å¹²ä¸ªå­—èŠ‚ã€‚ é™æ€æ–¹æ³•ä¸ºä»€ä¹ˆä¸èƒ½è°ƒç”¨éé™æ€æˆå‘˜?\né™æ€æ–¹æ³•æ˜¯å±äºç±»çš„ï¼Œåœ¨ç±»åŠ è½½çš„æ—¶å€™å°±ä¼šåˆ†é…å†…å­˜ï¼Œå¯ä»¥é€šè¿‡ç±»åç›´æ¥è®¿é—®ã€‚è€Œéé™æ€æˆå‘˜å±äºå®ä¾‹å¯¹è±¡ï¼Œåªæœ‰åœ¨å¯¹è±¡å®ä¾‹åŒ–ä¹‹åæ‰å­˜åœ¨ï¼Œéœ€è¦é€šè¿‡ç±»çš„å®ä¾‹å¯¹è±¡å»è®¿é—®ã€‚ åœ¨ç±»çš„éé™æ€æˆå‘˜ä¸å­˜åœ¨çš„æ—¶å€™é™æ€æˆå‘˜å°±å·²ç»å­˜åœ¨äº†ï¼Œæ­¤æ—¶è°ƒç”¨åœ¨å†…å­˜ä¸­è¿˜ä¸å­˜åœ¨çš„éé™æ€æˆå‘˜ï¼Œå±äºéæ³•æ“ä½œã€‚ è°ƒç”¨æ–¹å¼\nä½¿ç”¨ç±»å.æ–¹æ³•å è°ƒç”¨é™æ€æ–¹æ³•ï¼Œæˆ–è€…å¯¹è±¡.æ–¹æ³•å ï¼ˆä¸å»ºè®®ï¼‰ è°ƒç”¨é™æ€æ–¹æ³•å¯ä»¥æ— éœ€åˆ›å»ºå¯¹è±¡ é‡è½½\nå‘ç”Ÿåœ¨åŒä¸€ä¸ªç±»ä¸­ï¼ˆæˆ–è€…çˆ¶ç±»ä¸å­ç±»ä¹‹é—´ï¼‰ï¼Œæ–¹æ³•åå¿…é¡»ç›¸åŒï¼Œå‚æ•°ç±»å‹ä¸åŒã€ä¸ªæ•°ä¸åŒã€é¡ºåºä¸åŒã€æ–¹æ³•è¿”å›å€¼å’Œè®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ä¸åŒ\nä¸å…è®¸å­˜åœ¨ï¼ˆåªæœ‰è¿”å›å€¼ä¸åŒçš„ä¸¤ä¸ªæ–¹æ³•(æ–¹æ³•åå’Œå‚æ•°ä¸ªæ•°åŠç±»å‹ç›¸åŒ)) é‡è½½å°±æ˜¯åŒä¸€ä¸ªç±»ä¸­å¤šä¸ªåŒåæ–¹æ³•æ ¹æ®ä¸åŒçš„ä¼ å‚æ¥æ‰§è¡Œä¸åŒçš„é€»è¾‘å¤„ç†ã€‚ é‡å†™\nå‘ç”Ÿåœ¨è¿è¡ŒæœŸï¼Œå­ç±»å¯¹çˆ¶ç±»çš„å…è®¸è®¿é—®çš„æ–¹æ³•å®ç°è¿‡ç¨‹è¿›è¡Œé‡æ–°ç¼–å†™\næ–¹æ³•åã€å‚æ•°åˆ—è¡¨å¿…é¡»ç›¸åŒï¼Œå­ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹åº”æ¯”çˆ¶ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹æ›´å°æˆ–ç›¸ç­‰ï¼ˆä¹Ÿå°±æ˜¯æ›´å…·ä½“ï¼‰ï¼ŒæŠ›å‡ºçš„å¼‚å¸¸èŒƒå›´å°äºç­‰äºçˆ¶ç±»ï¼Œè®¿é—®ä¿®é¥°ç¬¦èŒƒå›´å¤§äºç­‰äºçˆ¶ç±»ï¼ˆä¸èƒ½è¯´çˆ¶ç±»å¯ä»¥è®¿é—®è€Œå­ç±»ä¸èƒ½è®¿é—®ï¼‰ã€‚ã€æ³¨æ„ï¼Œè¿™é‡Œåªé’ˆå¯¹æ–¹æ³•ï¼Œç±»å±æ€§åˆ™æ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‘\npackage com.javaguide; import java.io.IOException; public class TestParent { private String a; protected AParent x() { return new AParent(); } protected void b() throws Exception { } } class TestChild extends TestParent { public String a; /** * è¿”å›ç±»å‹æœ‰è¯¯ï¼Œæ²¡æœ‰æ¯”çˆ¶ç±»æ›´å…·ä½“ * * @return */ /* protected AParentParent x() { return new AChild(); }*/ protected AChild x() { return new AChild(); } /** * æŠ›å¼‚å¸¸ç±»å‹æœ‰è¯¯ æ²¡æœ‰æ¯”çˆ¶ç±»æ›´å…·ä½“ * * @throws Throwable */ /*protected void b() throws Throwable { }*/ protected void b() throws IOException { } } å¦‚æœçˆ¶ç±»æ–¹æ³•è®¿é—®ä¿®é¥°ç¬¦ä¸º private/final/static åˆ™å­ç±»å°±ä¸èƒ½é‡å†™è¯¥æ–¹æ³•ï¼Œä½†æ˜¯è¢« static ä¿®é¥°çš„æ–¹æ³•èƒ½å¤Ÿè¢«å†æ¬¡å£°æ˜\nclass TestChild extends TestParent { public static void ab(){} } //çˆ¶ç±» public class TestParent { protected static void ab(){} } æ„é€ æ–¹æ³•æ— æ³•è¢«é‡å†™\nå¯å˜é•¿å‚æ•°\nä»£ç  å¯å˜å‚æ•°åªèƒ½ä½œä¸ºå‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°\npublic static void method2(String arg1, String... args) { //...... } é‡åˆ°æ–¹æ³•é‡è½½çš„æƒ…å†µæ€ä¹ˆåŠå‘¢ï¼Ÿä¼šä¼˜å…ˆåŒ¹é…å›ºå®šå‚æ•°è¿˜æ˜¯å¯å˜å‚æ•°çš„æ–¹æ³•å‘¢ï¼Ÿ\nç­”æ¡ˆæ˜¯ä¼šä¼˜å…ˆåŒ¹é…å›ºå®šå‚æ•°çš„æ–¹æ³•\nJava çš„å¯å˜å‚æ•°ç¼–è¯‘åå®é™…ä¼šè¢«è½¬æ¢æˆä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬çœ‹ç¼–è¯‘åç”Ÿæˆçš„ classæ–‡ä»¶å°±å¯ä»¥çœ‹å‡ºæ¥äº†ã€‚\nåŸºæœ¬æ•°æ®ç±»å‹ï¼Œ8ç§\n6ç§æ•°å­—ç±»å‹ï¼Œ1ç§å­—ç¬¦ç±»å‹ï¼Œ1ç§å¸ƒå°”å€¼ byte,short,int,long ; float,double ; char boolean 1ä¸ªå­—èŠ‚8ä½ï¼Œå…¶ä¸­ byte 1å­—èŠ‚ï¼Œshort 2å­—èŠ‚ï¼Œint 4å­—èŠ‚ ï¼Œlong 8å­—èŠ‚ float 4å­—èŠ‚ï¼Œdouble 8 å­—èŠ‚ char 2å­—èŠ‚ï¼Œboolean 1ä½ åŸºæœ¬æ•°æ®ç±»å‹å’ŒåŒ…è£…ç±»å‹çš„åŒºåˆ«\nåŒ…è£…ç±»å‹å¯ç”¨äºæ³›å‹ï¼Œè€ŒåŸºæœ¬ç±»å‹ä¸å¯ä»¥ å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œå±€éƒ¨å˜é‡ä¼šå­˜æ”¾åœ¨Javaè™šæ‹Ÿæœºæ ˆä¸­çš„å±€éƒ¨å˜é‡è¡¨ä¸­ï¼Œæˆå‘˜å˜é‡ï¼ˆæœªè¢«staticä¿®é¥°ï¼‰å­˜æ”¾åœ¨Javaè™šæ‹Ÿæœºå †ä¸­ã€‚\nåŒ…è£…ç±»å‹å±äºå¯¹è±¡ç±»å‹ï¼Œå‡ ä¹æ‰€æœ‰å¯¹è±¡å®ä¾‹éƒ½å­˜åœ¨äºå †ä¸­ ç›¸æ¯”å¯¹è±¡ç±»å‹ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹å ç”¨ç©ºé—´éå¸¸å° \u0026ldquo;åŸºæœ¬æ•°æ®ç±»å‹å­˜æ”¾åœ¨æ ˆä¸­\u0026rdquo; è¿™å¥è¯æ˜¯é”™çš„ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡å¦‚æœæ²¡æœ‰è¢«staticä¿®é¥°çš„è¯ï¼ˆä¸å»ºè®®è¿™ä¹ˆç”¨ï¼Œåº”è¯¥ä½¿ç”¨åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„åŒ…è£…ç±»å‹ï¼‰ï¼Œå°±å­˜æ”¾åœ¨å †ä¸­ã€‚\nï¼ˆå¦‚æœè¢«staticä¿®é¥°äº†ï¼Œå¦‚æœ1.7åˆ™åœ¨æ–¹æ³•åŒºï¼Œ1.7åŠä»¥ä¸Šç§»åˆ°äº† Javaå †ä¸­ï¼‰ åŒ…è£…ç±»å‹çš„ç¼“å­˜æœºåˆ¶ Byteï¼ŒShortï¼ŒIntegerï¼ŒLongè¿™4ä¸­åŒ…è£…ç±»é»˜è®¤åˆ›å»ºäº†æ•°å€¼[-128,127]çš„ç›¸åº”ç±»å‹çš„ç¼“å­˜æ•°æ®ï¼ŒCharacteråˆ›å»ºäº†æ•°å€¼åœ¨[0,127]èŒƒå›´çš„ç¼“å­˜æ•°æ®ï¼ŒBooleanç›´æ¥è¿”å›True or False\nIntegerç¼“å­˜ä»£ç \npublic static Integer valueOf(int i) { if (i \u0026gt;= IntegerCache.low \u0026amp;\u0026amp; i \u0026lt;= IntegerCache.high) return IntegerCache.cache[i + (-IntegerCache.low)]; return new Integer(i); } private static class IntegerCache { static final int low = -128; static final int high; static { // high value may be configured by property int h = 127; } } Characterç¼“å­˜ä»£ç \npublic static Character valueOf(char c) { if (c \u0026lt;= 127) { // must cache return CharacterCache.cache[(int)c]; } return new Character(c); } private static class CharacterCache { private CharacterCache(){} static final Character cache[] = new Character[127 + 1]; static { for (int i = 0; i \u0026lt; cache.length; i++) cache[i] = new Character((char)i); } } Booleanç¼“å­˜ä»£ç \npublic static Boolean valueOf(boolean b) { return (b ? TRUE : FALSE); } æ³¨æ„Floatå’ŒDoubleæ²¡æœ‰ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼Œä¸” åªæœ‰è°ƒç”¨valueOfï¼ˆæˆ–è€…è‡ªåŠ¨è£…ç®±ï¼‰æ‰ä¼šä½¿ç”¨ç¼“å­˜ï¼Œå½“ä½¿ç”¨newçš„æ—¶å€™æ˜¯ç›´æ¥åˆ›å»ºæ–°å¯¹è±¡\npublic Integer(int value) { this.value = value; } ä¸¾ä¾‹\nBoolean t=new Boolean(true); Boolean f=new Boolean(true); System.out.println(t==f); //false System.out.println(t.equals(f)); //true Boolean t1=Boolean.valueOf(true); Boolean f1=Boolean.valueOf(true); System.out.println(t1==f1); //true System.out.println(Boolean.TRUE==Boolean.TRUE); //true //============================================// Integer i1 = 33; //è¿™é‡Œå‘ç”Ÿäº†è‡ªåŠ¨è£…ç®±ï¼Œç›¸å½“äºInteger.valueOf(30) Integer i2 = 33; System.out.println(i1 == i2);// è¾“å‡º true Float i11 = 333f; Float i22 = 333f; System.out.println(i11 == i22);// è¾“å‡º false Double i3 = 1.2; Double i4 = 1.2; System.out.println(i3 == i4);// è¾“å‡º false //===========================================// Integer i1 = 40; Integer i2 = new Integer(40); System.out.println(i1==i2); å¦‚ä¸Šï¼Œæ‰€æœ‰æ•´å‹åŒ…è£…ç±»å¯¹è±¡ä¹‹é—´å€¼çš„æ¯”è¾ƒï¼Œåº”è¯¥å…¨éƒ¨ä½¿ç”¨equalsæ–¹æ³•æ¯”è¾ƒ ä»€ä¹ˆæ˜¯è‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±\nè£…ç®±ï¼šå°†åŸºæœ¬ç±»å‹ç”¨å®ƒä»¬å¯¹åº”çš„å¼•ç”¨ç±»å‹åŒ…è£…èµ·æ¥ï¼› æ‹†ç®±ï¼šå°†åŒ…è£…ç±»å‹è½¬æ¢ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ï¼› ä¸¾ä¾‹è¯´æ˜\nInteger i = 10 ;//è£…ç®± ç›¸å½“äºInteger.valueOf(10) int n = i ;//æ‹†ç®± å¯¹åº”çš„å­—èŠ‚ç \nL1 LINENUMBER 8 L1 ALOAD 0 BIPUSH 10 INVOKESTATIC java/lang/Integer.valueOf (I)Ljava/lang/Integer; PUTFIELD AutoBoxTest.i : Ljava/lang/Integer; L2 LINENUMBER 9 L2 ALOAD 0 ALOAD 0 GETFIELD AutoBoxTest.i : Ljava/lang/Integer; INVOKEVIRTUAL java/lang/Integer.intValue ()I PUTFIELD AutoBoxTest.n : I RETURN å¦‚å›¾ï¼ŒInteger i = 10 ç­‰ä»·äºInteger i = Integer.valueOf(10)\nint n= i ç­‰ä»·äº int n= i.intValue();\né¢‘ç¹æ‹†è£…ç®±ä¼šä¸¥é‡å½±å“ç³»ç»Ÿæ€§èƒ½\næµ®ç‚¹æ•°è¿ç®—çš„æ—¶å€™ä¼šæœ‰ç²¾åº¦ä¸¢å¤±çš„é£é™©\nè¿™ä¸ªå’Œè®¡ç®—æœºä¿å­˜æµ®ç‚¹æ•°çš„æœºåˆ¶æœ‰å¾ˆå¤§å…³ç³»ã€‚æˆ‘ä»¬çŸ¥é“è®¡ç®—æœºæ˜¯äºŒè¿›åˆ¶çš„ï¼Œè€Œä¸”è®¡ç®—æœºåœ¨è¡¨ç¤ºä¸€ä¸ªæ•°å­—æ—¶ï¼Œå®½åº¦æ˜¯æœ‰é™çš„ï¼Œæ— é™å¾ªç¯çš„å°æ•°å­˜å‚¨åœ¨è®¡ç®—æœºæ—¶ï¼Œåªèƒ½è¢«æˆªæ–­ï¼Œæ‰€ä»¥å°±ä¼šå¯¼è‡´å°æ•°ç²¾åº¦å‘ç”ŸæŸå¤±çš„æƒ…å†µã€‚è¿™ä¹Ÿå°±æ˜¯è§£é‡Šäº†ä¸ºä»€ä¹ˆæµ®ç‚¹æ•°æ²¡æœ‰åŠæ³•ç”¨äºŒè¿›åˆ¶ç²¾ç¡®è¡¨ç¤ºã€‚\nåè¿›åˆ¶ä¸‹çš„0.2æ— æ³•ç²¾ç¡®è½¬æ¢æˆäºŒè¿›åˆ¶å°æ•°\n// 0.2 è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°çš„è¿‡ç¨‹ä¸ºï¼Œä¸æ–­ä¹˜ä»¥ 2ï¼Œç›´åˆ°ä¸å­˜åœ¨å°æ•°ä¸ºæ­¢ï¼Œ // åœ¨è¿™ä¸ªè®¡ç®—è¿‡ç¨‹ä¸­ï¼Œå¾—åˆ°çš„æ•´æ•°éƒ¨åˆ†ä»ä¸Šåˆ°ä¸‹æ’åˆ—å°±æ˜¯äºŒè¿›åˆ¶çš„ç»“æœã€‚ 0.2 * 2 = 0.4 -\u0026gt; 0 0.4 * 2 = 0.8 -\u0026gt; 0 0.8 * 2 = 1.6 -\u0026gt; 1 0.6 * 2 = 1.2 -\u0026gt; 1 0.2 * 2 = 0.4 -\u0026gt; 0ï¼ˆå‘ç”Ÿå¾ªç¯ï¼‰ ä½¿ç”¨BigDecimalè§£å†³ä¸Šé¢çš„é—®é¢˜\nBigDecimal a = new BigDecimal(\u0026#34;1.0\u0026#34;); BigDecimal b = new BigDecimal(\u0026#34;0.9\u0026#34;); BigDecimal c = new BigDecimal(\u0026#34;0.8\u0026#34;); BigDecimal x = a.subtract(b); BigDecimal y = b.subtract(c); System.out.println(x); /* 0.1 */ System.out.println(y); /* 0.1 */ System.out.println(Objects.equals(x, y)); /* true */ è¶…è¿‡longæ•´å½¢çš„æ•°æ®ï¼Œä½¿ç”¨BigInteger\nJavaä¸­ï¼Œ64ä½longæ•´å‹æ˜¯æœ€å¤§çš„æ•´æ•°ç±»å‹\nlong l = Long.MAX_VALUE; System.out.println(l + 1); // -9223372036854775808 System.out.println(l + 1 == Long.MIN_VALUE); // true //BigIntegerå†…éƒ¨ä½¿ç”¨int[] æ•°ç»„æ¥å­˜å‚¨ä»»æ„å¤§å°çš„æ•´å‹æ•°æ® //å¯¹äºå¸¸è§„æ•´æ•°ç±»å‹ï¼Œä½¿ç”¨BigIntegerè¿ç®—çš„æ•ˆç‡ä¼šé™ä½ "},{"id":164,"href":"/zh/docs/study/Review/ssm/scope_transaction/","title":"ä½œç”¨åŸŸåŠäº‹åŠ¡","section":"Ssm","content":" å››ç§ä½œç”¨åŸŸ # singletonï¼šé»˜è®¤å€¼ï¼Œå½“IOCå®¹å™¨ä¸€åˆ›å»ºå°±ä¼šåˆ›å»ºbeanå®ä¾‹ï¼Œè€Œä¸”æ˜¯å•ä¾‹çš„ï¼Œæ¯æ¬¡å¾—åˆ°çš„æ˜¯åŒä¸€ä¸ª prototypeï¼šåŸå‹çš„ï¼ŒIOCå®¹å™¨åˆ›å»ºæ—¶ä¸å†åˆ›å»ºbeanå®ä¾‹ã€‚æ¯æ¬¡è°ƒç”¨getBeanæ–¹æ³•æ—¶å†å®ä¾‹åŒ–è¯¥beanï¼ˆæ¯æ¬¡éƒ½ä¼šè¿›è¡Œå®ä¾‹åŒ–ï¼‰ requestï¼šæ¯æ¬¡è¯·æ±‚ä¼šå®ä¾‹åŒ–ä¸€ä¸ªbean sessionï¼šåœ¨ä¸€æ¬¡ä¼šè¯ä¸­å…±äº«ä¸€ä¸ªbean äº‹åŠ¡ # äº‹åŠ¡æ˜¯ä»€ä¹ˆ # é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ\näº‹åŠ¡çš„ç‰¹æ€§ # ACID\nAtomicity /ËŒÃ¦tÉ™ËˆmÉªsÉ™ti/åŸå­æ€§ , è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ Consistency /kÉ™nËˆsÉªstÉ™nsi/ ä¸€è‡´æ€§ , æ•°æ®åº“çš„å®Œæ•´æ€§ Isolation /ËŒaÉªsÉ™ËˆleÉªÊƒn/ éš”ç¦»æ€§ , æ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ , è¿™é‡Œæ¶‰åŠåˆ°äº‹åŠ¡éš”ç¦»çº§åˆ« Durability /ËŒdjÊŠÉ™rÉ™ËˆbÉªlÉ™ti/ æŒä¹…æ€§ , äº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤± Springæ”¯æŒä¸¤ç§æ–¹å¼çš„äº‹åŠ¡ç®¡ç† # ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç† /ËˆeksÉªkjuËt/ execute\nä½¿ç”¨transactionTemplate\n@Autowired private TransactionTemplate transactionTemplate; public void testTransaction() { transactionTemplate.execute(new TransactionCallbackWithoutResult() { @Override protected void doInTransactionWithoutResult(TransactionStatus transactionStatus) { try { // .... ä¸šåŠ¡ä»£ç  } catch (Exception e){ //å›æ»š transactionStatus.setRollbackOnly(); } } }); } ä½¿ç”¨transactionManager\n@Autowired private PlatformTransactionManager transactionManager; public void testTransaction() { TransactionStatus status = transactionManager.getTransaction(new DefaultTransactionDefinition()); try { // .... ä¸šåŠ¡ä»£ç  transactionManager.commit(status); } catch (Exception e) { transactionManager.rollback(status); } } å£°æ˜å¼äº‹åŠ¡ç®¡ç†\n@Transactional(propagation = Propagation.REQUIRED) public void aMethod { //do something B b = new B(); C c = new C(); b.bMethod(); c.cMethod(); } äº‹åŠ¡ä¼ æ’­è¡Œä¸º # Definition /ËŒdefÉªËˆnÉªÊƒ(É™)n/ å®šä¹‰\nPropagation /ËŒprÉ’pÉ™ËˆÉ¡eÉªÊƒn/ ä¼ æ’­\nå‡è®¾æœ‰ä»£ç å¦‚ä¸‹ï¼š\n@Service Class A { @Autowired B b; @Transactional(propagation = Propagation.REQUIRED) public void aMethod { //do something b.bMethod(); } } @Service Class B { @Transactional(propagation = Propagation.XXXXXX) public void bMethod { //do something } } å…±7ç§ï¼Œå…¶ä¸­ä¸»è¦æœ‰4ç§å¦‚ä¸‹\nTransactionDefinition.PROPAGATION_REQUIRED å¦‚æœå¤–éƒ¨æ–¹æ³•æ²¡æœ‰å¼€å¯äº‹åŠ¡ï¼Œåˆ™å†…éƒ¨æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå³å†…å¤–ä¸¤ä¸ªæ–¹æ³•çš„äº‹åŠ¡äº’ç›¸ç‹¬ç«‹ï¼›å¦‚æœå¤–éƒ¨æ–¹æ³•å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™å†…éƒ¨æ–¹æ³•åŠ å…¥è¯¥äº‹åŠ¡ï¼Œå³å†…å¤–ä¸¤ä¸ªæ–¹æ³•ä½¿ç”¨åŒä¸€ä¸ªäº‹åŠ¡\nTransactionDefinition.PROPAGATION_REQUIRES_NEW å¦‚æœå¤–éƒ¨æ–¹æ³•å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™ä¼šæŒ‚èµ·å½“å‰çš„äº‹åŠ¡ï¼Œå¹¶ä¸”å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå½“å¤–éƒ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œå†…éƒ¨æ–¹æ³•ä¸ä¼šå›æ»šï¼›è€Œå½“å†…éƒ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œå¤–éƒ¨æ–¹æ³•ä¼šæ£€æµ‹åˆ°å¹¶è¿›è¡Œå›æ»šã€‚ å¦‚æœå¤–éƒ¨æ–¹æ³•ä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™ä¹Ÿä¼šå¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡\nTransactionDefinition.PROPAGATION_NESTED: å¦‚æœå¤–éƒ¨æ–¹æ³•å¼€å¯äº‹åŠ¡ï¼Œåˆ™åœ¨å†…éƒ¨å†å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œä½œä¸ºåµŒå¥—äº‹åŠ¡å­˜åœ¨ï¼›å¦‚æœå¤–éƒ¨æ–¹æ³•æ— äº‹åŠ¡ï¼Œåˆ™å•ç‹¬å¼€å¯ä¸€ä¸ªäº‹åŠ¡\nåœ¨å¤–å›´æ–¹æ³•å¼€å¯äº‹åŠ¡çš„æƒ…å†µä¸‹Propagation.NESTEDä¿®é¥°çš„å†…éƒ¨æ–¹æ³•å±äºå¤–éƒ¨äº‹åŠ¡çš„å­äº‹åŠ¡ï¼Œå¤–å›´ä¸»äº‹åŠ¡å›æ»šï¼Œå­äº‹åŠ¡ä¸€å®šå›æ»šï¼Œè€Œå†…éƒ¨å­äº‹åŠ¡å¯ä»¥å•ç‹¬å›æ»šè€Œä¸å½±å“å¤–å›´ä¸»äº‹åŠ¡å’Œå…¶ä»–å­äº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯å’Œä¸Šé¢çš„PROPAGATION_REQUIRES_NEWç›¸å\nTransactionDefinition.PROPAGATION_MANDATORY å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ mandatory /ËˆmÃ¦ndÉ™tÉ™ri/ å¼ºåˆ¶çš„\nä¸‹é¢ä¸‰ä¸ªæ¯”è¾ƒä¸å¸¸ç”¨\nTransactionDefinition.PROPAGATION_SUPPORTS: å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œã€‚ TransactionDefinition.PROPAGATION_NOT_SUPPORTED: ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚ TransactionDefinition.PROPAGATION_NEVER: ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ äº‹åŠ¡éš”ç¦»çº§åˆ« # TransactionDefinition.ISOLATION_DEFAULT TransactionDefinition.ISOLATION_READ_UNCOMMITTED è¯»æœªæäº¤ï¼Œçº§åˆ«æœ€ä½ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯» TransactionDefinition.ISOLATION_READ_COMMITTED è¯»å·²æäº¤ï¼Œå¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ã€‚å¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»ä¼šå‘ç”Ÿ TransactionDefinition.ISOLATION_SERIALIZABLE ä¸²è¡ŒåŒ–ï¼Œå¯ä»¥é˜²æ­¢è„è¯»ã€å¹»è¯»åŠä¸å¯é‡å¤è¯»ï¼Œæ‰€æœ‰äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œå®Œå…¨æœä»ACIDï¼Œä½†ä¸¥é‡å½±å“æ€§èƒ½ "},{"id":165,"href":"/zh/docs/study/Review/basics/member_variables_and_local_variables/","title":"æˆå‘˜å˜é‡ä¸å±€éƒ¨å˜é‡","section":"JavaåŸºç¡€(å°šç¡…è°·)_","content":" ä»£ç  # static int s; int i; int j; { int i = 1; i++; j++; s++; } public void test(int j) { j++; i++; s++; } public static void main(String[] args) { Exam5 obj1 = new Exam5(); Exam5 obj2 = new Exam5(); obj1.test(10); obj1.test(20); obj2.test(30); System.out.println(obj1.i + \u0026#34;,\u0026#34; + obj1.j + \u0026#34;,\u0026#34; + obj1.s); System.out.println(obj2.i + \u0026#34;,\u0026#34; + obj2.j + \u0026#34;,\u0026#34; + obj2.s); } è¿è¡Œç»“æœ # 2,1,5 1,1,5 åˆ†æ # å°±è¿‘åŸåˆ™ # ä»£ç ä¸­æœ‰å¾ˆå¤šä¿®æ”¹å˜é‡çš„è¯­å¥ï¼Œä¸‹é¢æ˜¯ç”¨å°±è¿‘åŸåˆ™+ä½œç”¨åŸŸåˆ†æçš„å›¾ å±€éƒ¨å˜é‡å’Œç±»å˜é‡ # å±€éƒ¨å˜é‡åŒ…æ‹¬æ–¹æ³•ä½“{}ï¼Œå½¢å‚ï¼Œä»¥åŠä»£ç å—\nå¸¦staticä¸ºç±»å˜é‡ï¼Œä¸å¸¦çš„ä¸ºå®ä¾‹å˜é‡\nä»£ç ä¸­çš„å˜é‡åˆ†ç±» ä¿®é¥°ç¬¦ \u0026ndash;å±€éƒ¨å˜é‡åªæœ‰final \u0026ndash; å®ä¾‹å˜é‡ public , protected , private , final , static , volatile transient\nå­˜å‚¨ä½ç½®\nå±€éƒ¨å˜é‡ï¼šæ ˆ\nå®ä¾‹å˜é‡ï¼šå †\nç±»å˜é‡ï¼šæ–¹æ³•åŒºï¼ˆç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ï¼‰\nä½œç”¨åŸŸ å±€éƒ¨å˜é‡ï¼šä»å£°æ˜å¤„å¼€å§‹ï¼Œåˆ°æ‰€å±çš„ } ç»“æŸ this é¢˜ä¸­çš„sæ—¢å¯ä»¥ç”¨æˆå‘˜å˜é‡è®¿é—®ï¼Œä¹Ÿå¯ä»¥ç”¨ç±»åè®¿é—®\nç”Ÿå‘½å‘¨æœŸ\nå±€éƒ¨å˜é‡ï¼šæ¯ä¸€ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸€æ¬¡è°ƒç”¨æ‰§è¡Œéƒ½æ˜¯æ–°çš„ç”Ÿå‘½å‘¨æœŸ å®ä¾‹å˜é‡ï¼šéšç€å¯¹è±¡çš„åˆ›å»ºè€Œåˆå§‹åŒ–ï¼Œéšç€å¯¹è±¡è¢«å›æ”¶è€Œæ¶ˆäº¡ï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹å˜é‡æ˜¯ç‹¬ç«‹çš„ ç±»å˜é‡ï¼šéšç€ç±»çš„åˆå§‹åŒ–è€Œåˆå§‹åŒ–ï¼Œéšç€ç±»çš„å¸è½½è€Œæ¶ˆäº¡ï¼Œè¯¥ç±»çš„æ‰€æœ‰å¯¹è±¡çš„ç±»å˜é‡æ˜¯å…±äº«çš„ ä»£ç çš„æ‰§è¡Œï¼Œjvmä¸­ # Exam5 obj1=new Exam5();\nobj1.test(10)\néé™æ€ä»£ç å—æˆ–è€…è¿›å…¥æ–¹æ³•ï¼Œéƒ½ä¼šåœ¨æ ˆä¸­å¼€è¾Ÿç©ºé—´å­˜å‚¨å±€éƒ¨å˜é‡ æ³¨æ„ï¼šé™æ€ä»£ç å—å®šä¹‰çš„å˜é‡ï¼Œåªä¼šå­˜åœ¨äºé™æ€ä»£ç å—ä¸­ã€‚ä¸æ˜¯ç±»å˜é‡ï¼Œä¹Ÿä¸å±äºæˆå‘˜å˜é‡\n"},{"id":166,"href":"/zh/docs/study/Review/basics/recursion_and_iteration/","title":"é€’å½’ä¸è¿­ä»£","section":"JavaåŸºç¡€(å°šç¡…è°·)_","content":" ç¼–ç¨‹é¢˜ # æœ‰næ­¥å°é˜¶ï¼Œä¸€æ¬¡åªèƒ½ä¸Š1æ­¥æˆ–2æ­¥ï¼Œå…±æœ‰å¤šå°‘ç§èµ°æ³•\nåˆ†æ # åˆ†æ\nn = 1ï¼Œ1æ­¥ f(1) = 1\nn = 2, ä¸¤ä¸ª1æ­¥,2æ­¥ f(2) = 2\nn = 3, åˆ†ä¸¤ç§æƒ…å†µï¼š æœ€å1æ­¥æ˜¯2çº§å°é˜¶/æœ€å1æ­¥æ˜¯1çº§å°é˜¶ï¼Œ å³ f(3) = f(1)+f(2) n = 4, åˆ†ä¸¤ç§æƒ…å†µï¼š æœ€å1æ­¥æ˜¯2çº§å°é˜¶/æœ€å1æ­¥æ˜¯1çº§å°é˜¶ï¼Œ å³f(4) = f(2)+f(3)\nä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡æœ‰å‡ (n)ä¸ªå°é˜¶ï¼Œæ€»è¦åˆ†æˆä¸¤ç§æƒ…å†µï¼šæœ€å1æ­¥æ˜¯2çº§å°é˜¶/æœ€å1æ­¥æ˜¯1çº§å°é˜¶ï¼Œå³ f(n)= f(n-2) + f(n-1)\né€’å½’ # public static int f(int n){ if(n==1 || n==2){ return n; } return f(n-2)+f(n-1); } public static void main(String[] args) { System.out.println(f(1)); //1 System.out.println(f(2)); //2 System.out.println(f(3)); //3 System.out.println(f(4)); //5 System.out.println(f(5)); //8 } debugè°ƒè¯• æ–¹æ³•æ ˆ f(4)\u0026mdash;-\u0026gt;åˆ†è§£æˆf(2)+f(3) f(2)\u0026mdash;è¿”å›- f(3)\u0026mdash;f(2)è¿”å›\u0026mdash;f(1)è¿”å› ã€f(3)åˆ†è§£æˆf(2)å’Œf(1)ã€‘ æ–¹æ³•æ ˆçš„ä¸ªæ•°ï¼š ä½¿ç”¨å¾ªç¯ # public static int loop(int n){ if (n \u0026lt; 1) { throw new IllegalArgumentException(n + \u0026#34;ä¸èƒ½å°äº1\u0026#34;); } if (n == 1 || n == 2) { return n; } int one=2;//æœ€ååªèµ°1æ­¥ï¼Œä¼šæœ‰2ç§èµ°æ³• int two=1;//æœ€åèµ°2æ­¥ï¼Œä¼šæœ‰1ç§èµ°æ³• int sum=0; for(int i=3;i\u0026lt;=n;i++){ //æœ€åè·¨ä¸¤çº§å°é˜¶+æœ€åè·¨ä¸€çº§å°é˜¶çš„èµ°æ³• sum=two+one; two=one; one=sum; } return sum; } å°ç»“ # æ–¹æ³•è°ƒç”¨è‡ªèº«ç§°ä¸ºé€’å½’ï¼Œåˆ©ç”¨å˜é‡çš„åŸå€¼æ¨å‡ºæ–°å€¼ç§°ä¸ºè¿­ä»£(whileå¾ªç¯) é€’å½’\nä¼˜ç‚¹ï¼šå¤§é—®é¢˜è½¬æ¢ä¸ºå°é—®é¢˜ï¼Œä»£ç ç²¾ç®€\nç¼ºç‚¹ï¼šæµªè´¹ç©ºé—´ï¼ˆæ ˆç©ºé—´ï¼‰ï¼Œå¯èƒ½ä¼šç…§æˆæ ˆçš„æº¢å‡º è¿­ä»£\nä¼˜ç‚¹ï¼šæ•ˆç‡é«˜ï¼Œæ—¶é—´åªå—å¾ªç¯æ¬¡æ•°é™åˆ¶ï¼Œä¸å—å‡ºæ ˆå…¥æ ˆæ—¶é—´\nç¼ºç‚¹ï¼šä¸å¦‚é€’å½’ç²¾ç®€ï¼Œå¯è¯»æ€§ç¨å·® "},{"id":167,"href":"/zh/docs/study/Review/basics/method_parameter_passing_mechanism/","title":"æ–¹æ³•çš„å‚æ•°ä¼ é€’æœºåˆ¶","section":"JavaåŸºç¡€(å°šç¡…è°·)_","content":" ä»£ç  # public class Exam4 { public static void main(String[] args) { int i = 1; String str = \u0026#34;hello\u0026#34;; Integer num = 2; int[] arr = {1, 2, 3, 4, 5}; MyData my = new MyData(); change(i, str, num, arr, my); System.out.println(\u0026#34;i = \u0026#34; + i); System.out.println(\u0026#34;str = \u0026#34; + str); System.out.println(\u0026#34;num = \u0026#34; + num); System.out.println(\u0026#34;arr = \u0026#34; + Arrays.toString(arr)); System.out.println(\u0026#34;my.a = \u0026#34; + my.a); } public static void change(int j, String s, Integer n, int[] a, MyData m) { j+=1; s+=\u0026#34;world\u0026#34;; n+=1; a[0]+=1; m.a+=1; } } ç»“æœ\ni = 1 str = hello num = 2 arr = [2, 2, 3, 4, 5] my.a = 11 çŸ¥è¯†ç‚¹ # æ–¹æ³•çš„å‚æ•°ä¼ é€’æœºåˆ¶ Stringã€åŒ…è£…ç±»ç­‰å¯¹è±¡çš„ä¸å¯å˜æ€§ åˆ†æ # å¯¹äºåŒ…è£…ç±»ï¼Œå¦‚æœæ˜¯ä½¿ç”¨newï¼Œé‚£ä¹ˆä¸€å®šæ˜¯å¼€è¾Ÿæ–°çš„ç©ºé—´ï¼›å¦‚æœæ˜¯ç›´æ¥èµ‹å€¼ï¼Œé‚£ä¹ˆ-128-127ä¹‹é—´ä¼šæœ‰ç¼“å­˜æ± (å †ä¸­)\n//å½“ä½¿ç”¨newçš„æ—¶å€™ï¼Œä¸€å®šåœ¨å †ä¸­æ–°å¼€è¾Ÿçš„ç©ºé—´ Integer a1= new Integer(12); Integer b1= new Integer(12); System.out.println(a1 == b1);//false Integer a2= -128; Integer b2= -128; System.out.println(a2 == b2);//true Integer a21= -129; Integer b21= -129; System.out.println(a21 == b21);//false Integer a3= 127; Integer b3= 127; System.out.println(a3 == b3);//true Integer a4= 22; Integer b4= 22; System.out.println(a4 == b4);//true Integer a31= 128; Integer b31= 128; System.out.println(a31 == b31);//false å¯¹äºStringç±»\n//å…ˆæŸ¥æ‰¾å¸¸é‡æ± ä¸­æ˜¯å¦æœ‰\u0026#34;abc\u0026#34;ï¼Œå¦‚æœæœ‰ç›´æ¥è¿”å›åœ¨å¸¸é‡æ± ä¸­çš„å¼•ç”¨, //å¦‚æœæ²¡æœ‰ï¼Œåˆ™åœ¨å¸¸é‡æ± ä¸­åˆ›å»º\u0026#34;abc\u0026#34;,ç„¶åè¿”å›è¯¥å¼•ç”¨ String a=\u0026#34;abc\u0026#34;; //å…ˆæŸ¥æ‰¾å¸¸é‡æ± ä¸­æ˜¯å¦æœ‰\u0026#34;abc\u0026#34;ï¼Œå¦‚æœæœ‰åˆ™åœ¨å †å†…å­˜ä¸­åˆ›å»ºå¯¹è±¡ï¼Œç„¶åè¿”å›å †å†…å­˜ä¸­çš„åœ°å€ //å¦‚æœæ²¡æœ‰ï¼Œåˆ™å…ˆåœ¨å¸¸é‡æ± ä¸­åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åå†åœ¨å †å†…å­˜ä¸­åˆ›å»ºå¯¹è±¡ï¼Œæœ€åè¿”å›å †å†…å­˜ä¸­çš„åœ°å€ String ab=new String(\u0026#34;abc\u0026#34;); System.out.println(a==ab);//true //intern() //åˆ¤æ–­å¸¸é‡æ± ä¸­æ˜¯å¦æœ‰abå¯¹è±¡çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœå­˜åœ¨\u0026#34;abc\u0026#34;åˆ™è¿”å›\u0026#34;abc\u0026#34;åœ¨ //å¸¸é‡æ± ä¸­çš„å¼•ç”¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åœ¨å¸¸é‡æ± ä¸­åˆ›å»º, //å¹¶è¿”å›\u0026#34;abc\u0026#34;åœ¨å¸¸é‡æ± ä¸­çš„å¼•ç”¨ System.out.println(a==ab.intern());//true changeæ–¹æ³•è°ƒç”¨ä¹‹å‰ï¼Œjvmä¸­çš„ç»“æ„ æ–¹æ³•æ ˆå¸§ä¸­çš„æ•°æ® æ‰§è¡Œchangeæ–¹æ³•åï¼Œå®å‚ç»™å½¢å‚èµ‹å€¼ï¼š åŸºæœ¬æ•°æ®ç±»å‹ï¼šæ•°æ®å€¼ å¼•ç”¨æ•°æ®ç±»å‹ï¼šåœ°å€å€¼\nå½“å®å‚æ˜¯ç‰¹æ®Šçš„ç±»å‹æ—¶ï¼šæ¯”å¦‚Stringã€åŒ…è£…ç±»ç­‰å¯¹è±¡ï¼Œä¸å¯å˜ï¼Œå³ s+=\u0026quot;world\u0026quot;; ä¼šå¯¼è‡´åˆ›å»ºä¸¤ä¸ªå¯¹è±¡ï¼Œå¦‚å›¾ï¼ˆ Integerä¹Ÿæ˜¯ï¼‰ æ•°ç»„å’Œå¯¹è±¡ï¼Œåˆ™æ˜¯æ‰¾åˆ°å †å†…å­˜ä¸­çš„åœ°å€ï¼Œç›´æ¥æ›´æ”¹\n"},{"id":168,"href":"/zh/docs/study/Review/basics/class_and_instance_initialization/","title":"ç±»ã€å®ä¾‹åˆå§‹åŒ–","section":"JavaåŸºç¡€(å°šç¡…è°·)_","content":" ä»£ç  # public class Son extends Father{ private int i=test(); private static int j=method(); static { System.out.print(\u0026#34;(6)\u0026#34;); } Son(){ System.out.print(\u0026#34;(7)\u0026#34;); } { System.out.print(\u0026#34;(8)\u0026#34;); } public int test(){ System.out.print(\u0026#34;(9)\u0026#34;); return 1; } public static int method(){ System.out.print(\u0026#34;(10)\u0026#34;); return 1; } public static void main(String[] args) { Son s1=new Son(); System.out.println(); Son s2=new Son(); } } public class Father { private int i=test(); private static int j=method(); static { System.out.print(\u0026#34;(1)\u0026#34;); } Father(){ System.out.print(\u0026#34;(2)\u0026#34;); } { System.out.print(\u0026#34;(3)\u0026#34;); } public int test() { System.out.print(\u0026#34;(4)\u0026#34;); return 1; } public static int method() { System.out.print(\u0026#34;(5)\u0026#34;); return 1; } } è¾“å‡ºï¼š\n(5)(1)(10)(6)(9)(3)(2)(9)(8)(7) (9)(3)(2)(9)(8)(7) åˆ†æ # ç±»åˆå§‹åŒ–è¿‡ç¨‹\nå½“å®ä¾‹åŒ–äº†ä¸€ä¸ªå¯¹è±¡/æˆ–mainæ‰€åœ¨ç±»ä¼šå¯¼è‡´ç±»åˆå§‹åŒ– å­ç±»åˆå§‹åŒ–å‰ä¼šå…ˆåˆå§‹åŒ–çˆ¶ç±» ç±»åˆå§‹åŒ–æ‰§è¡Œçš„æ˜¯clinit æ–¹æ³•ï¼Œç¼–è¯‘æŸ¥çœ‹å­—èŠ‚ç å¯å¾—çŸ¥ clinit ç”±é™æ€ç±»å˜é‡æ˜¾ç¤ºèµ‹å€¼è¯­å¥ ä»¥åŠ é™æ€ä»£ç å—ç»„æˆ(ç”±ä¸Šåˆ°ä¸‹é¡ºåº)ï¼Œä¸”åªæ‰§è¡Œä¸€æ¬¡\nå¦‚ä¸‹\nå®ä¾‹åˆå§‹åŒ–è¿‡ç¨‹\næ‰§è¡Œçš„æ˜¯initæ–¹æ³• ç”±éé™æ€å®ä¾‹å˜é‡æ˜¾ç¤ºèµ‹å€¼è¯­å¥ ä»¥åŠ éé™æ€ä»£ç å— [ä»ä¸Šåˆ°ä¸‹é¡ºåº] ä»¥åŠå¯¹åº”æ„é€ å™¨ä»£ç [æœ€åæ‰§è¡Œ] ç»„æˆ å…¶ä¸­ï¼Œå­ç±»æ„é€ å™¨ä¸€å®šä¼šè°ƒç”¨super() [æœ€å‰é¢] 1ï¼‰ super() ã€æœ€å‰ã€‘ 2ï¼‰i = test() 3ï¼‰å­ç±»çš„éé™æ€ä»£ç å— ã€2ï¼Œ3æŒ‰é¡ºåºã€‘ 4) å­ç±»çš„æ— å‚æ„é€ (æœ€å)\né‡å†™çš„é—®é¢˜ å¦‚ä¸Šæ‰€ç¤ºï¼Œåˆå§‹åŒ–Sonå¯¹è±¡çš„æ—¶å€™ï¼Œä¼šå…ˆè°ƒç”¨super()æ–¹æ³•ï¼Œå³åˆå§‹åŒ–çˆ¶ç±»ï¼Œç„¶åä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„ éé™æ€å˜é‡èµ‹å€¼ä»¥åŠéé™æ€ä»£ç å—ï¼Œæœ€åæ‰æ˜¯çˆ¶ç±»çš„æ„é€ å™¨ä»£ç å—\nè°ƒç”¨çˆ¶ç±»éé™æ€å˜é‡èµ‹å€¼çš„æ—¶å€™ï¼Œå¦‚æœè°ƒç”¨äº†éé™æ€æ–¹æ³•ï¼Œå°±ä¼šæ¶‰åŠåˆ°é‡å†™é—®é¢˜ï¼Œæ¯”å¦‚è¿™é‡Œçš„\npublic class Father{ private int i= test(); } è¿™é‡Œä¼šè°ƒç”¨å­ç±»(å½“å‰æ­£åœ¨åˆå§‹åŒ–çš„å¯¹è±¡)çš„test()æ–¹æ³•ï¼Œè€Œä¸æ˜¯çˆ¶ç±»çš„test()\nå“ªäº›æ–¹æ³•ä¸å¯è¢«é‡å†™ finalæ–¹æ³•ã€é™æ€æ–¹æ³•ã€çˆ¶ç±»ä¸­çš„privateç­‰ä¿®é¥°ä½¿å¾—å­ç±»ä¸å¯è§çš„æ–¹æ³• "},{"id":169,"href":"/zh/docs/study/Review/basics/singleton_design_pattern/","title":"å•ä¾‹è®¾è®¡æ¨¡å¼","section":"JavaåŸºç¡€(å°šç¡…è°·)_","content":" ç‰¹ç‚¹ # è¯¥ç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ æ„é€ å™¨ç§æœ‰åŒ– è¯¥ç±»å†…éƒ¨è‡ªè¡Œåˆ›å»ºè¯¥å®ä¾‹ ä½¿ç”¨é™æ€å˜é‡ä¿å­˜ èƒ½å‘å¤–éƒ¨æä¾›è¿™ä¸ªå®ä¾‹ ç›´æ¥æš´éœ² ä½¿ç”¨é™æ€å˜é‡çš„getæ–¹æ³•è·å– å‡ å¤§æ–¹æ³• # é¥¿æ±‰å¼ # éšç€ç±»çš„åŠ è½½è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸ç®¡æ˜¯å¦éœ€è¦éƒ½ä¼šç›´æ¥åˆ›å»ºå®ä¾‹å¯¹è±¡\npublic class Singleton1 { public static final Singleton1 INSTANCE=new Singleton1(); private Singleton1() { } } æšä¸¾ # æšä¸¾ç±»è¡¨ç¤ºè¯¥ç±»å‹çš„å¯¹è±¡æ˜¯æœ‰é™çš„å‡ ä¸ª\npublic enum Singleton2 { INSTANCE } ä½¿ç”¨é™æ€ä»£ç å— # éšç€ç±»çš„åŠ è½½è¿›è¡Œåˆå§‹åŒ–\npublic class Singleton2 { public static final Singleton2 INSTANCE; static { INSTANCE = new Singleton2(); } private Singleton2() { } } å¦‚å›¾ï¼Œå½“åˆå§‹åŒ–å®ä¾‹æ—¶éœ€è¦è¿›è¡Œå¤æ‚å–å€¼æ“ä½œæ—¶ï¼Œå¯ä»¥å–ä»£ç¬¬ä¸€ç§æ–¹æ³• æ‡’æ±‰å¼ # å»¶è¿Ÿåˆ›å»ºå¯¹è±¡\npublic class Singleton4 { //ä¸ºäº†é˜²æ­¢é‡æ’åºï¼Œéœ€è¦æ·»åŠ volatileå…³é”®å­— private static volatile Singleton4 INSTANCE; private Singleton4() { } /** * double check * @return */ public static Singleton4 getInstance() { //2 å…ˆåˆ¤æ–­ä¸€æ¬¡,å¯¹äºåé¢çš„æ“ä½œ(æ­¤æ—¶å·²ç»åˆ›å»ºäº†å¯¹è±¡)èƒ½å‡å°‘åŠ é”æ¬¡æ•° if (INSTANCE == null) { //å¦‚æœè¿™é‡Œä¸åŠ é”ä¼šå¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½åˆšè¿›äº†åˆ¤æ–­è¯­å¥ä¹‹åï¼Œæ‰§è¡Œæƒè¢«å‰¥å¤ºäº†åˆåˆ›å»ºå¥½äº†å¯¹è±¡ï¼Œ //æ‰€ä»¥åˆ¤æ–­åŠåˆ›å»ºå¯¹è±¡å¿…é¡»æ˜¯åŸå­æ“ä½œ synchronized (Singleton4.class) { if (INSTANCE == null) { //ç”¨æ¥æ¨¡æ‹Ÿå¤šçº¿ç¨‹è¢«å‰¥å¤ºæ‰§è¡Œæƒ try { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); } //å¦‚æœè¿™ä¸ªåœ°æ–¹ä¸åŠ volatile,ä¼šå‡ºç°çš„é—®é¢˜æ˜¯,æŒ‡ä»¤é‡æ’ 1,2,3æ˜¯æ­£å¸¸çš„, //ä¼šé‡æ’æˆ1,3,2 ç„¶ååˆ«çš„çº¿ç¨‹å»æ‹¿çš„æ—¶å€™ï¼Œåˆ¤æ–­ä¸ºéç©ºï¼Œä½†æ˜¯å®é™…ä¸Šè¿è¡Œçš„æ—¶å€™ï¼Œå‘ç°é‡Œé¢çš„æ•°æ®æ˜¯ç©ºçš„ //1 memory = allocate();//åˆ†é…å¯¹è±¡ç©ºé—´ //2 instance(memory); //åˆå§‹åŒ–å¯¹è±¡ //3 instance = memory; //è®¾ç½®instanceæŒ‡å‘åˆšåˆšåˆ†é…çš„ä½ç½® INSTANCE = new Singleton4(); } } } return INSTANCE; } } ä½¿ç”¨é™æ€å†…éƒ¨ç±» # public class Singleton6 { private Singleton6(){ } private static class Inner{ private static final Singleton6 INSTANCE=new Singleton6(); } public static Singleton6 getInstance(){ return Inner.INSTANCE; } } åªæœ‰å½“å†…éƒ¨ç±»è¢«åŠ è½½å’Œåˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ‰ä¼šåˆ›å»ºINSTANCEå®ä¾‹å¯¹è±¡ é™æ€å†…éƒ¨ç±»ä¸ä¼šè‡ªåŠ¨éšç€å¤–éƒ¨ç±»çš„åŠ è½½å’Œåˆå§‹åŒ–è€Œåˆå§‹åŒ–ï¼Œä»–éœ€è¦å•ç‹¬å»åŠ è½½å’Œåˆå§‹åŒ– åˆç”±äºä»–æ˜¯åœ¨å†…éƒ¨ç±»åŠ è½½å’Œåˆå§‹åŒ–æ—¶ï¼Œåˆ›å»ºçš„ï¼Œå±äºç±»åŠ è½½å™¨å¤„ç†çš„ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ "},{"id":170,"href":"/zh/docs/study/Review/basics/self_incrementing_variable/","title":"è‡ªå¢å˜é‡","section":"JavaåŸºç¡€(å°šç¡…è°·)_","content":" é¢˜ç›® # int i=1; i=i++; int j=i++; int k = i+ ++i * i++; System.out.println(\u0026#34;i=\u0026#34;+i); System.out.println(\u0026#34;j=\u0026#34;+j); System.out.println(\u0026#34;k=\u0026#34;+k); è®²è§£ # å¯¹äºæ“ä½œæ•°æ ˆå’Œå±€éƒ¨å˜é‡è¡¨çš„ç†è§£ # å¯¹äºä¸‹é¢çš„ä»£ç \nint i=10; int j=9; j=i; åç¼–è¯‘ä¹‹åï¼ŒæŸ¥çœ‹å­—èŠ‚ç \n0 bipush 10 2 istore_1 3 bipush 9 5 istore_2 6 iload_1 7 istore_2 8 return å¦‚ä¸‹å›¾ï¼Œè¿™ä¸‰è¡Œä»£ç ï¼Œæ˜¯ä¾æ¬¡æŠŠ10ï¼Œ9å…ˆæ”¾åˆ°å±€éƒ¨å˜é‡è¡¨çš„1ï¼Œ2ä½ç½®ã€‚\nä¹‹åå‘¢ï¼Œå†æŠŠå±€éƒ¨å˜é‡è¡¨ä¸­1ä½ç½®çš„å€¼ï¼Œæ”¾å…¥æ“ä½œæ•°æ ˆä¸­\næœ€åï¼Œå°†æ“ä½œæ•°æ ˆå¼¹å‡ºä¸€ä¸ªæ•°(10)ï¼Œå°†æ•°å€¼èµ‹ç»™å±€éƒ¨å˜é‡è¡¨ä¸­çš„ä½ç½®2\nå¦‚ä¸Šå›¾ï¼Œå½“æ–¹æ³•ä¸ºé™æ€æ–¹æ³•æ—¶ï¼Œå±€éƒ¨å˜é‡è¡¨0ä½ç½®å­˜å‚¨çš„æ˜¯å®å‚ç¬¬1ä¸ªæ•°\n(å½“æ–¹æ³•ä¸ºéé™æ€æ–¹æ³•æ—¶ï¼Œå±€éƒ¨å˜é‡è¡¨0ä½ç½®å­˜å‚¨çš„æ˜¯thiså¼•ç”¨)\nå¯¹äºä¸‹é¢è¿™æ®µä»£ç \nint i=10; int j=20; i=i++; j=++j; System.out.println(i); System.out.println(j); ç¼–è¯‘åçš„å­—èŠ‚ç \n0 bipush 10 2 istore_1 3 bipush 20 5 istore_2 6 iload_1 7 iinc 1 by 1 10 istore_1 11 iinc 2 by 1 14 iload_2 15 istore_2 16 getstatic #5 \u0026lt;java/lang/System.out : Ljava/io/PrintStream;\u0026gt; 19 iload_1 20 invokevirtual #6 \u0026lt;java/io/PrintStream.println : (I)V\u0026gt; 23 getstatic #5 \u0026lt;java/lang/System.out : Ljava/io/PrintStream;\u0026gt; 26 iload_2 27 invokevirtual #6 \u0026lt;java/io/PrintStream.println : (I)V\u0026gt; 30 return å¦‚ä¸Šå¯¹äºj = ++j ;æ˜¯\n11 iinc 2 by 1 14 iload_2 15 istore_2 å…ˆå¯¹å±€éƒ¨å˜é‡è¡¨2ä¸­çš„ å€¼ åŠ 1ï¼Œç„¶åå°†ç»“æœ æ”¾å…¥æ“ä½œæ•°æ ˆä¸­ï¼Œä¹‹åå†å°†æ“ä½œæ•°æ ˆå¼¹å‡ºä¸€ä¸ªæ•°å¹¶èµ‹å€¼ç»™ ä½ç½®2\nå¯¹äºé¢˜ç›®çš„è§£é‡Š # int i=1; i=i++; int j=i++; int k = i+ ++i * i++; System.out.println(\u0026#34;i=\u0026#34;+i); System.out.println(\u0026#34;j=\u0026#34;+j); System.out.println(\u0026#34;k=\u0026#34;+k); ç¼–è¯‘åçš„å­—èŠ‚ç \n0 iconst_1 1 istore_1 2 iload_1 3 iinc 1 by 1 6 istore_1 7 iload_1 8 iinc 1 by 1 11 istore_2 12 iload_1 13 iinc 1 by 1 16 iload_1 17 iload_1 18 iinc 1 by 1 21 imul 22 iadd 23 istore_3 å¯¹äº int j = i++\n7 iload_1 8 iinc 1 by 1 11 istore_2 å…ˆå°†içš„å€¼æ”¾è¿›æ ˆä¸­ï¼Œç„¶åå°†å±€éƒ¨å˜é‡è¡¨ä¸­çš„i + 1ï¼Œä¹‹åå°†æ ˆä¸­çš„å€¼èµ‹å€¼ç»™j åˆ°è¿™æ­¥éª¤çš„æ—¶å€™ï¼Œi = 2 ï¼Œj = 1\næœ€åä¸€æ­¥ int k = i+ ++i * i++\n12 iload_1 13 iinc 1 by 1 16 iload_1 17 iload_1 18 iinc 1 by 1 21 imul 22 iadd 23 istore_3 å¦‚å­—èŠ‚ç æ‰€ç¤ºï¼Œå…ˆå°†i loadè¿›æ“ä½œæ•°æ ˆä¸­(2)ï¼Œç„¶åå°†å±€éƒ¨å˜é‡è¡¨ä¸­çš„i è‡ªå¢ (3)ï¼Œä¹‹åå°†è‡ªå¢åçš„ç»“æœ(3)æ”¾å…¥æ“ä½œæ•°æ ˆä¸­ï¼Œç¬¬äºŒæ¬¡å°†å±€éƒ¨å˜é‡è¡¨ä¸­çš„iæ”¾å…¥æ“ä½œæ•°æ ˆä¸­ã€‚ç„¶åæ­¤æ—¶æ“ä½œæ•°æ ˆä¸­å­˜åœ¨ 3 3 2 (ç”±æ ˆé¡¶åˆ°æ ˆåº•) ï¼Œä¾æ¬¡è¿›è¡Œä¹˜æ³•åŠ æ³• ï¼ˆ3*3+2ï¼‰ =11 ï¼Œæ”¾å…¥å±€éƒ¨å˜é‡è¡¨3 ä¸­ã€‚ æ‰€ä»¥ç»“æœä¸º 2ï¼Œ 1ï¼Œ11\nå°ç»“ # â€‹\n"},{"id":171,"href":"/zh/docs/study/Git/git_sgg/19-26/","title":"19-26_git_å°šç¡…è°·","section":"åŸºç¡€(å°šç¡…è°·è§†é¢‘)_","content":" ä»‹ç» # ä½¿ç”¨ä»£ç æ‰˜ç®¡ä¸­å¿ƒï¼ˆè¿œç¨‹æœåŠ¡å™¨ï¼‰ å›¢é˜Ÿå†…å†™ä½œ push\u0026ndash;clone\u0026ndash;push\u0026mdash; \u0026ndash;pull è·¨å›¢é˜Ÿå†™ä½œ forkï¼ˆåˆ°è‡ªå·±çš„è¿œç¨‹åº“ï¼‰\u0026mdash;clone åˆ›å»ºè¿œç¨‹åº“\u0026amp;åˆ›å»ºåˆ«å # å®˜ç½‘ï¼šhttps://github.com ç°åœ¨yuebuqunæ³¨å†Œä¸€ä¸ªè´¦å· åˆ›å»ºä¸€ä¸ªè¿œç¨‹åº“git-demoï¼Œåˆ›å»ºæˆåŠŸ åˆ›å»ºè¿œç¨‹åº“åˆ«å git remote -v ï¼ˆæŸ¥çœ‹åˆ«åï¼‰ ä¸ºè¿œç¨‹åº“åˆ›å»ºåˆ«å git remote add git-demo https://github.com/lwmfjc/git-demo.git åˆ«ååˆ›å»ºæˆåŠŸ fetchå’Œpushéƒ½å¯ä»¥ä½¿ç”¨åˆ«å æ¨é€æœ¬åœ°åº“åˆ°è¿œç¨‹åº“ # æ¨é€masteråˆ†æ”¯ åˆ‡æ¢git checkout master æ¨é€ git push git-demo master æ‹‰å–è¿œç¨‹åº“åˆ°æœ¬åœ°åº“ # git pull git-demo master ç»“æœ å…‹éš†è¿œç¨‹åº“åˆ°æœ¬åœ° # git clone xxxxxxx/git-demo.git cloneä¹‹åæœ‰é»˜è®¤çš„åˆ«åï¼Œä¸”å·²ç»åˆå§‹åŒ–äº†æœ¬åœ°åº“ å›¢é˜Ÿå†…å†™ä½œ # lhcä¿®æ”¹äº†git-demoä¸‹çš„hello.txt ä¹‹åè¿›è¡Œgit add hello.txt git commit -m \u0026ldquo;lhc-commit \u0026quot; hello.txt ç°åœ¨è¿›è¡Œpush git push origin master å‡ºé”™äº† ä½¿ç”¨ybqï¼Œå¯¹åº“è¿›è¡Œè®¾ç½®ï¼Œç®¡ç†æˆå‘˜ æ·»åŠ æˆå‘˜å³å¯ è¾“å…¥è´¦å·å å°†é‚€è¯·å‡½ å‘é€ç»™lhc ç°åœ¨å†æ¬¡æ¨é€ï¼Œåˆ™æ¨é€æˆåŠŸ å›¢é˜Ÿå¤–åˆä½œ # å…ˆæŠŠåˆ«äººçš„é¡¹ç›®forkä¸‹æ¥ ä¹‹åè¿›è¡Œä¿®æ”¹å¹¶ä¸”commit pull request (æ‹‰å–è¯·æ±‚) è¯·æ±‚ ä¸œæ–¹ä¸è´¥ï¼š\nå²³ä¸ç¾¤ï¼šçœ‹åˆ°åˆ«äººå‘è¿‡æ¥çš„è¯·æ±‚ å¯ä»¥åŒæ„ åˆå¹¶ç”³è¯· SSHå…å¯†ç™»å½• # sshå…å¯†å…¬é’¥æ·»åŠ \næ·»åŠ ä¹‹å‰,\ngit config --global user.name \u0026#34;username\u0026#34; git config --global user.email useremail@qq.com åˆ é™¤~/.ssh ä½¿ç”¨\nssh-keygen -t rsa -C xxxx@xx.com # å†æ¬¡åˆ°~/.ssh æŸ¥çœ‹ cat id_rsa ç§é’¥ æŠŠç§é’¥å¤åˆ¶åˆ° è´¦å·\u0026ndash;è®¾ç½®\u0026ndash;ssh and gpgkeys æµ‹è¯•æ˜¯å¦æˆåŠŸ "},{"id":172,"href":"/zh/docs/life/archive/20220724/","title":"äººä¸ºä»€ä¹ˆè¦ç»“å©š(æ‰¾å¯¹è±¡)","section":"å¾€æ—¥å½’æ¡£","content":"å…¶å®è¿™æ˜¯æˆ‘åœ¨å…­ä¸ƒå¹´å‰æ€è€ƒçš„ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘è§‰å¾—ç»“å©šï¼Œå¹¶ä¸èƒ½å•çº¯çš„ä½œä¸ºä¸€ä¸ªä¸–ä¿—ä»»åŠ¡ã€‚å¾ˆå¤šäººï¼Œæ˜¯å› ä¸ºå¹´çºªåˆ°äº†ç»“å©šï¼Œå› ä¸ºçˆ¶æ¯å‚¬ç»“å©šï¼Œå› ä¸ºçœ‹åˆ°åˆ«äººç»“å©šè€Œç»“å©šï¼Œæ€»ä¹‹ï¼Œæ˜¯ä¸ºåˆ«äººè€Œæ´»ã€‚ä½†æˆ‘è§‰å¾—ï¼Œç»“å©šçš„æœ¬è´¨ï¼Œåº”è¯¥æ˜¯ä¸¤ä¸ªäººç”Ÿæ´»çš„ç»“åˆï¼ŒåŒ…æ‹¬äº†å¾ˆå¤šï¼Œæ¯”å¦‚ç”Ÿæ´»ä¸­çš„å–œæ€’å“€ä¹äº’äº«ï¼Œè¿™æ˜¯æœ€åŸºç¡€çš„ï¼Œå¼€å¿ƒäº†æœ‰äººæ›¿ä½ é«˜å…´ï¼Œç”Ÿæ°”éš¾è¿‡äº†æœ‰äººå®‰æ…°ä½ ã€å¿ƒç–¼ä½ ã€‚å¦‚æœè¿è¿™ä¸ªéƒ½åšä¸åˆ°è€Œå„æ´»å„çš„ï¼Œé‚£æˆ‘å®åœ¨æƒ³ä¸æ˜ç™½è¿™ç§å©šå§»çš„æ„ä¹‰åœ¨å“ªï¼Œè€Œç°åœ¨å¾ˆå¤šæƒ…å†µæ­£æ˜¯è¿™æ ·ï¼Œæœ‰ä¸ºäº†å®¶åº­è€Œå·¥ä½œè¾›è‹¦è€Œæ²¡æœ‰äº¤é›†çš„ï¼Œä¹Ÿæœ‰å•çº¯çš„ç›¸å¤„è…»äº†ã€æ‡’äº†ã€‚\nè€Œè¯´åˆ°è…»ï¼Œè¿™å°±åœ¨äºä¸€ç‚¹ï¼Œå°±æ˜¯æœ‰äº›å©šå§»æ˜¯å¾ˆä»“ä¿ƒçš„ï¼Œå‹æ ¹å°±æ²¡çœ‹æ¸…æ¥šå¯¹æ–¹çš„æ ·å­(æ€§æ ¼ã€ä¸‰è§‚)ï¼Œæˆ–è€…æ˜¯ä¸æ¸…æ¥šè‡ªå·±å–œæ¬¢çš„æ˜¯ä»€ä¹ˆæ ·çš„äººï¼Œå°±å·²ç»åœ¨ä¸€èµ·äº†ï¼Œä¹‹åæ‰å‘ç°å¯¹æ–¹å¾ˆå¤šé—®é¢˜ä¸æ˜¯è‡ªå·±èƒ½æ¥å—çš„ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™å·²ç»æ™šäº†ã€‚æ‰€ä»¥â€œå†…åœ¨â€ï¼Œæ‰èƒ½æŒä¹…å¸å¼•ä¸€ä¸ªäººï¼Œå› ä¸ºè¿™æ˜¯ä¸è½»æ˜“éšæ—¶å…‰å˜è¿è€Œæ”¹å˜çš„ã€‚\nåˆ†äº«ä¹Ÿå¹¶éç®€å•çš„åˆ†äº«ï¼Œå¦‚æœåˆ†äº«çš„ä¸œè¥¿å¯¹æ–¹æ²¡æœ‰å•¥æ„Ÿè§‰ï¼Œé‚£è¿™ç§å…³ç³»ä¹Ÿæ˜¯å¾ˆéš¾æŒä¹…çš„ã€‚å› æ­¤ï¼Œæœ€ä½³çš„å©šå§»ï¼Œåº”è¯¥æ˜¯å¼‚æ€§çŸ¥å·±ï¼Œä½ çš„ä¸€äº›å¿ƒç†ï¼Œä¸ç”¨å‘å¯¹æ–¹è§£é‡Šå¤ªå¤šï¼Œå½“ç„¶ è¿™é‡Œå¹¶ä¸æ˜¯è¯´ä¸€å¼€å§‹å°±æ˜¯è¿™ç§çŠ¶æ€ï¼Œæ›´å¤šæ˜¯é€šè¿‡åé¢ä¸æ–­äº†è§£ã€ä¸æ–­ç£¨åˆè€Œè¾¾æˆè¿™ç§çŠ¶æ€ï¼Œå½“ä½ è¢«åˆ«äººè¯¯ä¼šäº†æœ‰äººç†è§£ï¼Œè¿™æ˜¯ä¸–é—´æœ€å¥½çš„è‰¯è¯ã€‚ç†è§£ä¸€ä¸ªäººï¼Œå°±æ˜¯æ‹¯æ•‘ä¸€ä¸ªä¸–ç•Œï¼Œä¸€èŠ±ä¸€ä¸–ç•Œï¼Œä¸€æ ‘ä¸€è©æã€‚\nå©šå§»ï¼Œå°±æ˜¯æ‰¾ä¸ªäº’ç›¸ç†è§£çš„çˆ±äººï¼Œå…±äº«ä¸–é—´å†·æš–ï¼Œç™½é¦–ä¸ç›¸ç¦»ã€‚\n"},{"id":173,"href":"/zh/docs/study/Git/git_sgg/09-18/","title":"09-18_git_å°šç¡…è°·","section":"åŸºç¡€(å°šç¡…è°·è§†é¢‘)_","content":" å‘½ä»¤ # å‘½ä»¤-è®¾ç½®ç”¨æˆ·ç­¾å\næŸ¥çœ‹ git config user.name git config user.email è®¾ç½® git config --global user.name ly001 git config --global user.email xxx@xx.com gitçš„é…ç½®æ–‡ä»¶æŸ¥çœ‹ ä½œç”¨ï¼šåŒºåˆ†ä¸åŒæ“ä½œè€…èº«ä»½ï¼Œè·Ÿåé¢ç™»é™†çš„è´¦å·æ²¡æœ‰å…³ç³» åˆå§‹åŒ–æœ¬åœ°åº“\ngit init å¤šå‡ºä¸€ä¸ªæ–‡ä»¶å¤¹ æŸ¥çœ‹æœ¬åœ°åº“çŠ¶æ€\ngit status é»˜è®¤åœ¨masteråˆ†æ”¯ æ–°å¢ä¸€ä¸ªæ–‡ä»¶ vim hello.txt æ­¤æ—¶æŸ¥çœ‹æœ¬åœ°åº“çš„çŠ¶æ€ untracketd files æœªè¢«è¿½è¸ªçš„æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªæ–‡ä»¶è¿˜åœ¨å·¥ä½œåŒº æ·»åŠ æš‚å­˜åŒº\ngit add hello.txt LF å°†ä¼šè¢«æ›¿æ¢æˆ CRLFï¼Œwindowsé‡Œé¢æ˜¯CRLFï¼Œä¹Ÿå°±æ˜¯è¯´\nè¿™ä¸ªæ¢è¡Œç¬¦è‡ªåŠ¨è½¬æ¢ä¼šæŠŠè‡ªåŠ¨æŠŠä½ ä»£ç é‡Œ ä¸ä½ å½“å‰æ“ä½œç³»ç»Ÿä¸ç›¸åŒçš„æ¢è¡Œçš„æ–¹å¼ è½¬æ¢æˆå½“å‰ç³»ç»Ÿçš„æ¢è¡Œæ–¹å¼ï¼ˆå³LFå’ŒCRLF ä¹‹é—´çš„è½¬æ¢ï¼‰\nè¿™æ˜¯å› ä¸ºè¿™ä¸ªhello.txtæ˜¯ä½¿ç”¨vm hello.txtåœ¨git bashé‡Œé¢æ·»åŠ çš„ï¼Œå¦‚æœç›´æ¥åœ¨windowsæ–‡ä»¶ç®¡ç†å™¨æ·»åŠ ä¸€ä¸ªæ–‡ä»¶ï¼ˆhello2.txt)ï¼Œå°±ä¼šå‘ç°æ²¡æœ‰è¿™ä¸ªè­¦å‘Šï¼Œå› ä¸ºä»–å·²ç»æ˜¯CRLFäº† ï¼ˆä¸ºäº†å’Œè§†é¢‘ä¿æŒä¸€è‡´ï¼Œgit rm \u0026ndash;cached hello2.txt ååˆ é™¤è¿™ä¸ªæ–‡ä»¶ï¼‰ æŸ¥çœ‹å½“å‰çŠ¶æ€ï¼Œç»¿è‰²è¡¨ç¤ºgitå·²ç»è¿½è¸ªåˆ°äº†è¿™ä¸ªæ–‡ä»¶\næ–‡ä»¶å·²ç»å­˜åœ¨äºæš‚å­˜åŒº ä½¿ç”¨git rm --cached hello.txtå¯ä»¥å°†æ–‡ä»¶ä»æš‚å­˜åŒºåˆ é™¤ ä½¿ç”¨åï¼Œæ–‡ä»¶åˆå‡ºç°åœ¨å·¥ä½œåŒºäº†ï¼ˆæœªæ·»åŠ ï¼‰ æäº¤æœ¬åœ°åº“\ngit commit -m \u0026quot;first commit\u0026quot; hello.txt ä¼šå‡ºç°ä¸€äº›è­¦å‘Šï¼Œä»¥åŠæ­¤æ—¶æäº¤çš„ä¿®æ”¹å’Œç”Ÿæˆçš„ç‰ˆæœ¬å·ï¼ˆå‰ä¸ƒä½ï¼‰ git status ä½¿ç”¨git reflogæŸ¥çœ‹å¼•ç”¨æ—¥å¿—ä¿¡æ¯ git log æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ä¿¡æ¯ ä¿®æ”¹å‘½ä»¤\nå‰æï¼Œä¿®æ”¹äº†æ–‡ä»¶ git status\nçº¢è‰²è¡¨ç¤ºgitè¿˜æ²¡æœ‰è¿½è¸ªåˆ°è¿™ä¸ªä¿®æ”¹ï¼Œå¦‚æœæ­¤æ—¶commit ï¼Œä¼šæç¤ºæ²¡æœ‰éœ€è¦commitçš„ ä½¿ç”¨git add hello.txt å°†æ–‡ä»¶ä¿®æ”¹æ·»åŠ åˆ°æš‚å­˜åŒº ä¹‹ågit status æ³¨æ„ï¼Œè¿™é‡Œå¦‚æœæäº¤åˆ°æš‚å­˜åŒºä¹‹åï¼Œä½¿ç”¨git restoreæ˜¯æ— æ³•æ¢å¤æ–‡ä»¶çš„\ngit restore --staged \u0026lt;file\u0026gt;...\u0026quot; to unstage ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ä¸¢å¼ƒè¿™ä¸ªæ–‡ä»¶çš„commitæ“ä½œ\nå‡ ä¸ªå‘½ä»¤çš„åŒºåˆ«ï¼š\ngit restore file çš„å‘½ä»¤æ˜¯ä¸¢å¼ƒä½ åœ¨å·¥ä½œåŒºä¿®æ”¹çš„å†…å®¹,(ä¿®æ”¹çš„å†…å®¹ä¼šä¸¢å¤±) git restore \u0026ndash;staged file ä¸¢å¼ƒä½ åœ¨å·¥ä½œåŒºçš„ä¿®æ”¹ä¸è¢«commit ã€‚ä½†æ˜¯ä½ çš„ä¿®æ”¹ä¾ç„¶åœ¨å·¥ä½œåŒºã€‚ git rm \u0026ndash;cached fileå’Œgit restore \u0026ndash;staged file æ•ˆæœå¥½åƒä¸€æ ·ï¼Œè¿™é‡Œä¸åšæ›´è¿›ä¸€æ­¥çš„åˆ†æ å›åˆ°æœ€åˆï¼Œè¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†çœ‹ä¿®æ”¹ï¼Œå¦‚æœ€ä¸Šé¢ï¼Œå°†ç¬¬ä¸€è¡Œåé¢æ·»åŠ äº†22222\ncommit ä¹‹åçš„æç¤ºï¼Œåˆ é™¤äº†ä¸€è¡Œï¼Œæ·»åŠ äº†ä¸€è¡Œï¼ˆä¿®æ”¹çš„å¦ä¸€ç§è¯´æ³•ï¼‰ å¦‚æœï¼ŒHEAD -\u0026gt; master ï¼ŒæŒ‡é’ˆæŒ‡å‘äº†ç¬¬äºŒä¸ªç‰ˆæœ¬ è¿™é‡Œå†åšç¬¬ä¸‰æ¬¡ä¿®æ”¹ï¼Œå¹¶add åŠcommit æŸ¥çœ‹å·¥ä½œåŒºï¼Œæ°¸è¿œåªæœ‰æœ€åé‚£æ¬¡ä¿®æ”¹çš„æ–‡ä»¶ ç‰ˆæœ¬ç©¿æ¢­\ngit reflogå’Œgit log å›é¡¾ï¼šhello.txtå…ˆæ˜¯5è¡Œï¼Œç„¶åç¬¬ä¸€è¡ŒåŠ äº†2ï¼Œä¹‹åç¬¬äºŒè¡ŒåŠ äº†3\nä½¿ç”¨git reset \u0026ndash;hard ç‰ˆæœ¬å·è¿›è¡Œç©¿æ¢­ï¼Œè¿™é‡Œå¤šäº†ä¸€è¡Œï¼Œæ˜¯å› ä¸ºæˆ‘å¤åˆ¶çš„æ—¶å€™å¤åˆ¶ç²—äº†ç‰ˆæœ¬å·\nä½¿ç”¨cat æŸ¥çœ‹ï¼Œå‘ç°æ–‡ä»¶å·²ç»åœ¨å¦ä¸€ä¸ªç‰ˆæœ¬ æŸ¥çœ‹.gitçš„ä¸€äº›æ–‡ä»¶ è¯´æ˜ç›®å‰æ˜¯åœ¨masterè¿™ä¸ªç‰ˆæœ¬ä¸Š ä¸‹é¢è¿™ä¸ªæ–‡ä»¶ .git/refs/heads/master è®°å½•äº†æŒ‡å‘masteråˆ†æ”¯çš„å“ªä¸ªç‰ˆæœ¬å· è¿™é‡Œå°†æ–‡ä»¶æŒ‡å‘æœ€åˆçš„ç‰ˆæœ¬ æ­¤æ—¶æŸ¥çœ‹åˆšæ‰è¯´çš„é‚£ä¸ªè®°å½•æŸä¸ªåˆ†æ”¯å½“å‰æŒ‡å‘ç‰ˆæœ¬çš„æ–‡ä»¶ï¼Œå·²ç»åšäº†æ›´æ–° å†ç©¿æ¢­ä¸ºåé¢çš„ç‰ˆæœ¬ git reset \u0026ndash;hard file å›¾ç‰‡è§£é‡Š masteræŒ‡é’ˆæŒ‡å‘first,second,third headæ°¸è¿œéƒ½æ˜¯æŒ‡å‘masterï¼ˆå½“å‰åˆ†æ”¯ï¼Œç›®å‰åªæœ‰masterï¼Œæ‰€ä»¥ä¸å˜ï¼‰\nåˆ†æ”¯ # æ¦‚è¿°å’Œä¼˜ç‚¹ æŸ¥çœ‹\u0026amp;åˆ›å»º\u0026amp;åˆ‡æ¢\ngit branch åˆ†æ”¯å #åˆ›å»ºåˆ†æ”¯ git branch -v #æŸ¥çœ‹åˆ†æ”¯ git checkout åˆ†æ”¯å #åˆ‡æ¢åˆ†æ”¯ git merge åˆ†æ”¯å #æŠŠæŒ‡å®šçš„åˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ä¸Š æŸ¥çœ‹åˆ†æ”¯å¹¶æ˜¾ç¤ºå½“å‰åˆ†æ”¯æŒ‡å‘çš„ç‰ˆæœ¬ git branch -v åˆ›å»ºåˆ†æ”¯ git branch hot-fix git branch #å†æ¬¡æŸ¥çœ‹ åˆ‡æ¢åˆ†æ”¯\ngit branch hot-fix æ­¤æ—¶ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶å¹¶æäº¤ æŸ¥çœ‹.git/headæ–‡ä»¶ï¼Œä¼šå‘ç°ç°åœ¨å®ƒæŒ‡å‘hot-fixåˆ†æ”¯ åˆå¹¶åˆ†æ”¯ï¼ˆæ­£å¸¸åˆå¹¶ï¼‰\nåˆ‡æ¢åˆ†æ”¯ å°†æŸåˆ†æ”¯xxåˆå¹¶åˆ°å½“å‰åˆ†æ”¯ git merge åˆ†æ”¯å\nå¦‚å›¾ï¼Œåˆå¹¶æˆåŠŸ ä»¥åé¢é‚£ä¸ªåˆ†æ”¯çš„ä¿®æ”¹ä¸ºä¸»\nåˆå¹¶åˆ†æ”¯ï¼ˆå†²çªåˆå¹¶ï¼‰\nå‰æï¼Œç°åœ¨masteråˆ†æ”¯å€’æ•°ç¬¬äºŒè¡Œä¿®æ”¹å¹¶æ·»åŠ å’Œæäº¤ æ­¤æ—¶åˆ‡æ¢åˆ°hot-fixåˆ†æ”¯ ä¿®æ”¹å€’æ•°ç¬¬ä¸€è¡Œ å°†æ–‡ä»¶ä»å·¥ä½œåŒºæ·»åŠ åˆ°æš‚å­˜åŒºå¹¶æäº¤åˆ°æœ¬åœ°åº“ æ­¤æ—¶å†åˆ‡å›master\ngit checkout master git merge hot-fix æç¤ºå‡ºé”™äº†ï¼Œè€Œä¸”æ‰€æœ‰æœ‰å¼‚å¸¸çš„æ–‡ä»¶ï¼Œéƒ½ä»¥ä¸‹é¢çš„å½¢å¼æ ‡æ³¨ æŒ‰ddè¿›è¡Œåˆ é™¤æŸä¸€è¡Œ æ”¹å®Œäº†ä¹‹åï¼Œä¿å­˜å¹¶æäº¤å³å¯ åˆ‡å›ä¹‹åæŸ¥çœ‹hot-fixåˆ†æ”¯ï¼Œå‘ç°è¿™é‡Œçš„æ–‡ä»¶æ˜¯æ²¡æœ‰å˜åŒ–çš„ åŸç† "},{"id":174,"href":"/zh/docs/study/Git/git_sgg/01-08/","title":"01-08_git_å°šç¡…è°·","section":"åŸºç¡€(å°šç¡…è°·è§†é¢‘)_","content":" æ¦‚è¿° # è¯¾ç¨‹ä»‹ç» # Git - gitä»‹ç»\u0026ndash;åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶+é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶ - gitå®‰è£…\u0026ndash;åŸºäºå®˜ç½‘ï¼Œ2.31.1 windows - åŸºäºå¼€å‘æ¡ˆä¾‹ è¯¦ç»†è®²è§£å¸¸ç”¨å‘½ä»¤ - gitåˆ†æ”¯\u0026mdash;ç‰¹æ€§ã€åˆ›å»ºã€è½¬æ¢ã€åˆå¹¶ã€ä»£ç åˆå¹¶å†²çªè§£å†³ - ideaé›†æˆgit Github å¦‚ä½•åˆ›å»ºè¿œç¨‹åº“ æ¨é€ push æ‹‰å– pull å…‹éš† clone sshå…å¯†ç™»å½• idea githubé›†æˆ Giteeç äº‘ ç äº‘åˆ›å»ºè¿œç¨‹åº“ Ideaé›†æˆGitee Gitlab gitlabæœåŠ¡å™¨çš„æ­å»ºå’Œéƒ¨ç½² ideaé›†æˆgitlab è¯¾ç¨‹ç›®æ ‡ï¼šäº”ä¸ªå°æ—¶ï¼Œç†Ÿç»ƒæŒæ¡gitã€githubã€gitee å®˜ç½‘ä»‹ç» # gitæ˜¯å…è´¹çš„å¼€æºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ å»‰ä»·çš„æœ¬åœ°åº“ åˆ†æ”¯åŠŸèƒ½ Everything is local ç‰ˆæœ¬æ§åˆ¶ä»‹ç» # è®°å½•æ–‡ä»¶å†…å®¹å˜åŒ–ï¼Œä»¥ä¾¿å°†æ¥æŸ¥é˜…ç‰¹å®šç‰ˆæœ¬ä¿®è®¢è®°å½•çš„ç³»ç»Ÿ å¦‚æœæ²¡æœ‰git ä¸ºä»€ä¹ˆéœ€è¦ç‰ˆæœ¬æ§åˆ¶ï¼ˆä»ä¸ªäººå¼€å‘è¿‡æ¸¡åˆ°å›¢é˜Ÿåˆä½œï¼‰ åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶VSé›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶ # SVNï¼Œå•ä¸€çš„é›†ä¸­ç®¡ç†çš„æœåŠ¡å™¨ï¼Œä¿å­˜æ‰€æœ‰æ–‡ä»¶çš„ä¿®è®¢ç‰ˆæœ¬ã€‚å…¶ä»–äººéƒ½å…ˆè¿åˆ°è¿™ä¸ªä¸­å¤®æœåŠ¡å™¨ä¸Šè·å–æœ€æ–°å¤„ç†æ˜¯å¦å†²çª ç¼ºç‚¹ï¼Œå•ç‚¹æ•…éšœï¼Œå¦‚æœæŸæ®µæ—¶é—´å†…æ•…éšœäº†ï¼Œé‚£ä¹ˆå°±æ²¡æ³•æäº¤ Gitï¼Œæ¯å°ç”µè„‘éƒ½æ˜¯ä»£ç åº“ å¦‚æœè¿œç¨‹åº“æŒ‚äº†ï¼Œæœ¬åœ°è¿˜æ˜¯å¯ä»¥åšç‰ˆæœ¬æ§åˆ¶çš„ï¼Œåªä¸è¿‡ä¸èƒ½åšä»£ç æ¨é€è€Œå·² æ¯ä¸ªå®¢æˆ·ç«¯ä¿å­˜çš„éƒ½æ˜¯å®Œæ•´çš„é¡¹ç›®ï¼ˆåŒ…æ‹¬å†å²è®°å½•ï¼‰ å‘å±•å†å² # linuxç³»ç»Ÿç‰ˆæœ¬æ§åˆ¶å†å² 1991-2002 æ‰‹åŠ¨åˆå¹¶ 2002 BitKeeperæˆæƒLinuxç¤¾åŒºå…è´¹ä½¿ç”¨ï¼ˆç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼‰ ç¤¾åŒºå°†å…¶ç ´è§£ 2005 ç”¨Cè¯­è¨€å¼€å‘äº†ä¸€ä¸ªåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼šGit ä¸¤å‘¨å¼€å‘æ—¶é—´ 2008å¹´ GitHubä¸Šçº¿ å·¥ä½œæœºåˆ¶å’Œä»£ç æ‰˜ç®¡ä¸­å¿ƒ # å·¥ä½œæœºåˆ¶\nå¦‚æœgit commit ï¼Œä¼šç”Ÿæˆå¯¹åº”çš„å†å²ç‰ˆæœ¬ï¼Œé‚£ä¹ˆè¿™é‡Œçš„å†å²ç‰ˆæœ¬æ˜¯åˆ ä¸æ‰çš„ å¦‚æœåªæ˜¯åœ¨å·¥ä½œåŒºï¼Œæˆ–è€…æ·»åŠ åˆ°äº†æš‚å­˜åŒºï¼Œé‚£ä¹ˆæ˜¯å¯ä»¥æ¢å¤(åˆ æ‰ï¼ˆæ“ä½œè®°å½•ï¼‰)çš„ git add (è®©gitçŸ¥é“æœ‰è¿™ä¸ªæ–‡ä»¶) å¦‚æœåªæœ‰v1,v2,v3ï¼ŒV3ç‰ˆæœ¬æ˜¯åˆ ä¸æ‰çš„ï¼Œå¦‚æœè¦æ¢å¤æˆv2ï¼Œåªèƒ½å†æäº¤ä¸€æ¬¡ç‰ˆæœ¬ è¿œç¨‹åº“\u0026ndash; ä»£ç æ‰˜ç®¡ä¸­å¿ƒæ˜¯åŸºäºç½‘ç»œæœåŠ¡å™¨çš„è¿œç¨‹ä»£ç ä»“åº“ï¼Œç®€ç§°ä¸ºè¿œç¨‹åº“ å±€åŸŸç½‘ GitLab\näº’è”ç½‘ GitHub Gitee ç äº‘\nå®‰è£… # gitå®‰è£…ã€å®¢æˆ·ç«¯ä½¿ç”¨(windows)\ngitå®‰è£…ä½ç½® ä»»æ„ éä¸­æ–‡ã€æ— ç©ºæ ¼\né€‰é¡¹é…ç½® ç¼–è¾‘å™¨é€‰æ‹© æ˜¯å¦ä¿®æ”¹åˆå§‹åŒ–åˆ†æ”¯çš„åå­—\u0026ndash;é»˜è®¤master é»˜è®¤ç¬¬äºŒä¸ªï¼Œè¿™é‡Œé€‰æ‹©ç¬¬ä¸€ä¸ªï¼Œåªèƒ½åœ¨git bashé‡Œé¢ä½¿ç”¨ åå°å®¢æˆ·ç«¯åè®® é…ç½®è¡Œæœ«æ¢è¡Œç¬¦ windows\u0026ndash;CRLF linux\u0026ndash;LF\né»˜è®¤ï¼Œè®©gitæ ¹æ®ç³»ç»Ÿè‡ªåŠ¨è½¬æ¢\nä»è¿œç¨‹æ‹‰å–ä»£ç æ—¶ï¼Œæ¨¡å¼\u0026ndash;ç”¨é»˜è®¤ å‡­æ®ç®¡ç†å™¨ è®°å½•ç™»é™†è¡Œä¸ºï¼Œä¸ç”¨æ¯æ¬¡ç™»å½• å…¶ä»–é…ç½® è½¯é“¾æ¥æ–‡ä»¶ ç¼“å­˜ å†git bashé‡Œè¿è¡Œç¬¬ä¸‰æ–¹ç¨‹åº\nå®‰è£…æˆåŠŸ\u0026mdash;è§†é¢‘é‡Œé¢æ˜¯2.31 "},{"id":175,"href":"/zh/docs/study/Maven/advance_dljd/01-21/","title":"01-21 mavenå¤šæ¨¡å—ç®¡ç†_åŠ¨åŠ›èŠ‚ç‚¹","section":"è¿›é˜¶(åŠ¨åŠ›èŠ‚ç‚¹)_","content":" åœºæ™¯ä»‹ç» # ä¸šåŠ¡ä¾èµ– å¤šæ¨¡å—ç®¡ç† ç‰ˆæœ¬ç®¡ç† ç¬¬1ç§æ–¹å¼ # åˆ›å»ºçˆ¶å·¥ç¨‹ # å…ˆåˆ›å»ºä¸€ä¸ªç©ºé¡¹ç›® åœ¨è¿™ä¸ªç©ºé¡¹ç›®ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªmoduleå½“ä½œmavençˆ¶å·¥ç¨‹ ç»“æ„ pomæ–‡ä»¶\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode.maven\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;001-maven-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0.0\u0026lt;/version\u0026gt; \u0026lt;!-- packaging æ ‡ç­¾æŒ‡å®šæ‰“åŒ…æ–¹å¼ï¼Œé»˜è®¤ä¸ºjar --\u0026gt; \u0026lt;!-- mavençˆ¶å·¥ç¨‹å¿…é¡»éµå®ˆä»¥ä¸‹ä¸¤ç‚¹è¦æ±‚ 1ã€packagingæ ‡ç­¾çš„æ–‡æœ¬å†…å®¹å¿…é¡»è®¾ç½®ä¸ºpom 2ã€æŠŠsrcåˆ é™¤ --\u0026gt; \u0026lt;/project\u0026gt; ä»‹ç»pomæ–‡ä»¶ # pom é¡¹ç›®å¯¹è±¡æ¨¡å‹ï¼Œproject object modelï¼Œè¯¥æ–‡ä»¶å¯ä»¥å­å·¥ç¨‹è¢«ç»§æ‰¿ mavenå¤šæ¨¡å—ç®¡ç†ï¼Œå…¶å®å°±æ˜¯è®©å®ƒçš„å­æ¨¡å—çš„pomæ–‡ä»¶æ¥ç»§æ‰¿çˆ¶å·¥ç¨‹çš„pom\nåˆ›å»ºmaven javaå­å·¥ç¨‹ # æ–°å»ºä¸€ä¸ªmodule\næ³¨æ„è·¯å¾„ï¼Œ002åœ¨IDEA-mavençš„ç›®å½•ä¸‹ æŸ¥çœ‹pomæ–‡ä»¶\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;!--æŒ‡å‘çˆ¶å·¥ç¨‹çš„gavåæ ‡--\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;artifactId\u0026gt;001-maven-parent\u0026lt;/artifactId\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode.maven\u0026lt;/groupId\u0026gt; \u0026lt;version\u0026gt;1.0.0\u0026lt;/version\u0026gt; \u0026lt;!--ç›¸å¯¹è·¯å¾„--\u0026gt; \u0026lt;relativePath\u0026gt;../001-maven-parent/pom.xml\u0026lt;/relativePath\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;artifactId\u0026gt;002-maven-java\u0026lt;/artifactId\u0026gt; \u0026lt;/project\u0026gt; åˆ›å»ºmaven webå­å·¥ç¨‹ # åˆ›å»ºæ–°æ¨¡å— æŸ¥çœ‹pom\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;artifactId\u0026gt;001-maven-parent\u0026lt;/artifactId\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode.maven\u0026lt;/groupId\u0026gt; \u0026lt;version\u0026gt;1.0.0\u0026lt;/version\u0026gt; \u0026lt;relativePath\u0026gt;../001-maven-parent/pom.xml\u0026lt;/relativePath\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;artifactId\u0026gt;003-maven-web\u0026lt;/artifactId\u0026gt; \u0026lt;packaging\u0026gt;war\u0026lt;/packaging\u0026gt; \u0026lt;/project\u0026gt; ä¿®æ”¹å­å·¥ç¨‹ä¸ºçˆ¶å·¥ç¨‹ # â€‹\t1 çˆ¶å·¥ç¨‹çš„pom.xmlç§çš„packagingæ ‡ç­¾çš„æ–‡æœ¬å†…å®¹å¿…é¡»è®¾ç½®pom\nâ€‹\t2 åˆ é™¤srcç›®å½•\nå¦‚å›¾ï¼Œæ¯”å¦‚è¿™é‡Œä¿®æ”¹002-maven-javaä¸ºçˆ¶å·¥ç¨‹ æ·»åŠ 004ä¸º002çš„å­å·¥ç¨‹ æŸ¥çœ‹pomæ–‡ä»¶\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;artifactId\u0026gt;002-maven-java\u0026lt;/artifactId\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode.maven\u0026lt;/groupId\u0026gt; \u0026lt;version\u0026gt;1.0.0\u0026lt;/version\u0026gt; \u0026lt;relativePath\u0026gt;../002-maven-java/pom.xml\u0026lt;/relativePath\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;artifactId\u0026gt;004-maven-java-1\u0026lt;/artifactId\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;maven.compiler.source\u0026gt;8\u0026lt;/maven.compiler.source\u0026gt; \u0026lt;maven.compiler.target\u0026gt;8\u0026lt;/maven.compiler.target\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;/project\u0026gt; æ‰‹åŠ¨ä¿®æ”¹Mavenå·¥ç¨‹ä¸ºå­å·¥ç¨‹(éideaä¸­) # è¿™é‡Œè¯´çš„æ˜¯ï¼Œåˆ›å»ºå­å·¥ç¨‹çš„æ—¶å€™ï¼Œæ²¡æœ‰é€‰æ‹©çˆ¶å·¥ç¨‹ åˆ›å»ºå®Œä¹‹åçš„pom.xml\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode.maven\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;005-maven-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0.0\u0026lt;/version\u0026gt; \u0026lt;/project\u0026gt; ä¿®æ”¹ï¼ˆæ·»åŠ parentæ ‡ç­¾å³å¯ï¼‰\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;artifactId\u0026gt;001-maven-parent\u0026lt;/artifactId\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode.maven\u0026lt;/groupId\u0026gt; \u0026lt;version\u0026gt;1.0.0\u0026lt;/version\u0026gt; \u0026lt;relativePath\u0026gt;../001-maven-parent/pom.xml\u0026lt;/relativePath\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;artifactId\u0026gt;005-maven-java\u0026lt;/artifactId\u0026gt; \u0026lt;/project\u0026gt; æ³¨æ„ å­æ¨¡å—ç»§æ‰¿çˆ¶å·¥ç¨‹æ‰€æœ‰ä¾èµ– # æ¯”å¦‚åœ¨çˆ¶å·¥ç¨‹æ·»åŠ è¿™å—ä¾èµ–\n\u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;junit\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;junit\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.12\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.1.46\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;dubbo\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.5.3\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; å¦‚ä¸‹ çˆ¶å·¥ç¨‹æ·»åŠ çš„ä¾èµ–ï¼Œæ‰€æœ‰å­æ¨¡å—ä¼šæ— æ¡ä»¶ç»§æ‰¿\nçˆ¶å·¥ç¨‹ç®¡ç†ä¾èµ– # ä¾èµ–å†—ä½™çš„é—®é¢˜ åŠ å¼ºç®¡ç†\n\u0026lt;!--åŠ å¼ºç®¡ç†--\u0026gt; \u0026lt;dependencyManagement\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;junit\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;junit\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.12\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.1.46\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;dubbo\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.5.3\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/dependencyManagement\u0026gt; ç»“æœï¼Œä¾èµ–éƒ½æ²¡æœ‰äº† å­å·¥ç¨‹å£°æ˜å¼ç»§æ‰¿çˆ¶å·¥ç¨‹ä¾èµ– # æ¯”å¦‚002-maven-javaï¼ˆå­æ¨¡å—ï¼Œä½†åˆæ˜¯004çš„çˆ¶å·¥ç¨‹ï¼‰éœ€è¦mysql\n\u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; æ•ˆæœ å­æ¨¡å—ä¾èµ–çš„ç‰ˆæœ¬å·ç»§æ‰¿çˆ¶å·¥ç¨‹ä¾èµ–çš„ç‰ˆæœ¬å· å¦‚æœå­æ¨¡å—æŒ‡å®šä»¥æ¥çš„ç‰ˆæœ¬å·ï¼Œé‚£å°±ä¸ä¼šç»§æ‰¿çˆ¶å·¥ç¨‹ä¾èµ–çš„ç‰ˆæœ¬å· çˆ¶å·¥ç¨‹ç®¡ç†ä¾èµ–ç‰ˆæœ¬å· # ä½¿ç”¨propertieså˜é‡\n\u0026lt;properties\u0026gt; \u0026lt;!--è‡ªå®šä¹‰æ ‡ç­¾åç§°--\u0026gt; \u0026lt;!--çº¦å®šï¼šé€šå¸¸ç®¡ç†ä¾èµ–ç‰ˆæœ¬å·çš„æ ‡ç­¾åï¼šé¡¹ç›®åç§°-å­—æ®µversionï¼Œ é¡¹ç›®åç§°.å­—æ®µversion--\u0026gt; \u0026lt;junit-version\u0026gt;4.12\u0026lt;/junit-version\u0026gt; \u0026lt;mysql-connector-java-version\u0026gt;5.1.46\u0026lt;/mysql-connector-java-version\u0026gt; \u0026lt;dubbo-version\u0026gt;2.5.3\u0026lt;/dubbo-version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;!--åŠ å¼ºç®¡ç†--\u0026gt; \u0026lt;dependencyManagement\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;junit\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;junit\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${junit-version}\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${mysql-connector-java-version}\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;dubbo\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${dubbo-version}\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/dependencyManagement\u0026gt; å›é¡¾ç¬¬1ç§å®ç°æ–¹å¼ # çˆ¶å·¥ç¨‹çš„è¦æ±‚ å­å·¥ç¨‹çš„æ·»åŠ  å­å·¥ç¨‹æ”¹ä¸ºçˆ¶å·¥ç¨‹ å­å·¥ç¨‹å’Œçˆ¶å·¥ç¨‹æ˜¯å¹³çº§çš„ çˆ¶å·¥ç¨‹åŠ å¼ºç®¡ç† \u0026lt;dependencyManagement\u0026gt;\u0026lt;/\u0026lt;dependencyManagement\u0026gt; æ³¨æ„ï¼Œç¬¬ä¸€ç§æ–¹æ³•çˆ¶å·¥ç¨‹çš„pom.xmlä¸­ï¼Œè¿™ä¸ªä¹Ÿåº”è¯¥æ˜¯å¿…é¡»çš„ ç¬¬2ç§æ–¹å¼ # åˆ›å»ºçˆ¶å·¥ç¨‹ # æœ€é¡¶å±‚åˆ›å»ºä¸€ä¸ªå·¥ç¨‹ï¼ˆçˆ¶å·¥ç¨‹ï¼‰ pomæ–‡ä»¶ï¼ˆæœªå¤„ç†ï¼‰\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode.maven\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0.0\u0026lt;/version\u0026gt; \u0026lt;packaging\u0026gt;war\u0026lt;/packaging\u0026gt; \u0026lt;/project\u0026gt; ç›®å½•ç»“æ„(æœªå¤„ç†) å¤„ç†å pom.xml\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode.maven\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0.0\u0026lt;/version\u0026gt; \u0026lt;packaging\u0026gt;pom\u0026lt;/packaging\u0026gt; \u0026lt;!-- 1.packagingæ ‡ç­¾æ–‡æœ¬å†…å®¹å¿…é¡»è®¾ç½®ä¸ºpom 2.åˆ é™¤srcç›®å½• --\u0026gt; \u0026lt;/project\u0026gt; ç»“æ„ åˆ›å»ºå­å·¥ç¨‹ # å­å·¥ç¨‹çš„pom.xml\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;!--æŒ‡å‘çˆ¶å·¥ç¨‹--\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;artifactId\u0026gt;maven-parent\u0026lt;/artifactId\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode.maven\u0026lt;/groupId\u0026gt; \u0026lt;version\u0026gt;1.0.0\u0026lt;/version\u0026gt; \u0026lt;!--æ³¨æ„ï¼Œè¿™é‡Œä¸éœ€è¦æ‰¾pom.xmlï¼Œå› ä¸ºè¯¥å­å·¥ç¨‹å’Œçˆ¶å·¥ç¨‹çš„pom.xmlåŒçº§--\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;artifactId\u0026gt;maven-java-001\u0026lt;/artifactId\u0026gt; \u0026lt;/project\u0026gt; çˆ¶å·¥ç¨‹çš„pom.xml\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode.maven\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0.0\u0026lt;/version\u0026gt; \u0026lt;!--çˆ¶å·¥ç¨‹åŒ…å«çš„æ‰€æœ‰å­æ¨¡å—--\u0026gt; \u0026lt;modules\u0026gt; \u0026lt;module\u0026gt;maven-java-001\u0026lt;/module\u0026gt; \u0026lt;/modules\u0026gt; \u0026lt;packaging\u0026gt;pom\u0026lt;/packaging\u0026gt; \u0026lt;!-- 1.packagingæ ‡ç­¾æ–‡æœ¬å†…å®¹å¿…é¡»è®¾ç½®ä¸ºpom 2.åˆ é™¤srcç›®å½• --\u0026gt; \u0026lt;/project\u0026gt; ç¬¬äºŒä¸ªå­æ¨¡å—\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;artifactId\u0026gt;maven-parent\u0026lt;/artifactId\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode.maven\u0026lt;/groupId\u0026gt; \u0026lt;version\u0026gt;1.0.0\u0026lt;/version\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;artifactId\u0026gt;maven-web-001\u0026lt;/artifactId\u0026gt; \u0026lt;packaging\u0026gt;war\u0026lt;/packaging\u0026gt; \u0026lt;/project\u0026gt; çˆ¶å·¥ç¨‹pom.xmlçš„å˜åŒ– åˆ›å»ºå­å·¥ç¨‹çš„å­å·¥ç¨‹ # çˆ¶å·¥ç¨‹å¿…é¡»éµå¾ª\npackagingæ ‡ç­¾æ–‡æœ¬å†…å®¹è®¾ç½®ä¸ºpom åˆ é™¤srcç›®å½• åˆ›å»ºå­å·¥ç¨‹ maven-java-001çš„pom.xmlæŸ¥çœ‹\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;!--æŒ‡å‘çˆ¶å·¥ç¨‹--\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;artifactId\u0026gt;maven-parent\u0026lt;/artifactId\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode.maven\u0026lt;/groupId\u0026gt; \u0026lt;version\u0026gt;1.0.0\u0026lt;/version\u0026gt; \u0026lt;!--æ³¨æ„ï¼Œè¿™é‡Œä¸éœ€è¦æ‰¾pom.xmlï¼Œå› ä¸ºè¯¥å­å·¥ç¨‹å’Œçˆ¶å·¥ç¨‹çš„pom.xmlåŒçº§--\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;artifactId\u0026gt;maven-java-001\u0026lt;/artifactId\u0026gt; \u0026lt;packaging\u0026gt;pom\u0026lt;/packaging\u0026gt; \u0026lt;modules\u0026gt; \u0026lt;module\u0026gt;maven-java-0101\u0026lt;/module\u0026gt; \u0026lt;/modules\u0026gt; \u0026lt;/project\u0026gt; å­æ¨¡å—çš„pom.xml\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;artifactId\u0026gt;maven-java-001\u0026lt;/artifactId\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode.maven\u0026lt;/groupId\u0026gt; \u0026lt;version\u0026gt;1.0.0\u0026lt;/version\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;artifactId\u0026gt;maven-java-0101\u0026lt;/artifactId\u0026gt; \u0026lt;/project\u0026gt; çˆ¶å·¥ç¨‹ç®¡ç†ä¾èµ– # çˆ¶å·¥ç¨‹çš„pomæ–‡ä»¶ å­æ¨¡å—ä¹Ÿä¸€èµ·ç»§æ‰¿äº† çˆ¶å·¥ç¨‹ç®¡ç†æ‰€æœ‰ä¾èµ– å¦‚æœå­å·¥ç¨‹éœ€è¦ï¼Œåˆ™ä½¿ç”¨å£°æ˜å¼ä¾èµ– ä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®šç‰ˆæœ¬å· çˆ¶å·¥ç¨‹ç®¡ç†ä¾èµ–çš„ç‰ˆæœ¬å· # ä½¿ç”¨propertiesç®¡ç†ç‰ˆæœ¬å·ï¼Œå’Œç¬¬ä¸€ç§æ–¹å¼ä¸€æ · å­å·¥ç¨‹ç»§æ‰¿çˆ¶å·¥ç¨‹ç¼–è¯‘æ’ä»¶ # ä¿®æ”¹ä¹‹åï¼Œè¿™é‡Œä¸ºäº†çœ‹æ•ˆæœï¼Œæ”¹æˆ1.6\n\u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-compiler-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.8.1\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;source\u0026gt;1.6\u0026lt;/source\u0026gt; \u0026lt;target\u0026gt;1.6\u0026lt;/target\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; ç¬¬3ç§æ–¹å¼ # å‰é¢ä¸¤ç§æ··åˆä½¿ç”¨\nå…ˆåˆ›å»ºä¸€ä¸ªç©ºé¡¹ç›® ç„¶åå‡è®¾æœ‰ä¸‰ä¸ªçˆ¶å·¥ç¨‹ ç„¶åæ¯ä¸ªçˆ¶å·¥ç¨‹åˆéƒ½æœ‰å­æ¨¡å— "},{"id":176,"href":"/zh/docs/study/Maven/base_dljd/31-43/","title":"31-43 mavenåŸºç¡€_åŠ¨åŠ›èŠ‚ç‚¹","section":"åŸºç¡€(åŠ¨åŠ›èŠ‚ç‚¹)_","content":" ideaä¸­è®¾ç½®maven # å’Œideaé›†æˆmaven åˆ›å»ºæ™®é€šçš„j2seé¡¹ç›® # ä½¿ç”¨ideaåˆ›å»ºç©ºç™½é¡¹ç›® æ–°å»ºä¸€ä¸ªmodule ä½¿ç”¨æ¨¡æ¿åˆ›å»ºæ™®é€šjavaé¡¹ç›® è¾“å…¥gav è®¾ç½®mavenä¿¡æ¯ æ ‡å‡†çš„mavenå·¥ç¨‹ ä¸åˆ›å»ºç½‘ç«™æœ‰å…³ï¼Œåˆ æ‰å³å¯\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;ch01-maven-j2se\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0\u0026lt;/version\u0026gt; \u0026lt;!--è®¾ç½®ç½‘ç«™ï¼Œæ³¨é‡Šæ‰å³å¯--\u0026gt; \u0026lt;!-- \u0026lt;name\u0026gt;ch01-maven-j2se\u0026lt;/name\u0026gt; \u0026lt;!â€“ FIXME change it to the project\u0026#39;s website â€“\u0026gt; \u0026lt;url\u0026gt;http://www.example.com\u0026lt;/url\u0026gt;--\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;!--mavenå¸¸ç”¨è®¾ç½®--\u0026gt; \u0026lt;project.build.sourceEncoding\u0026gt;UTF-8\u0026lt;/project.build.sourceEncoding\u0026gt; \u0026lt;maven.compiler.source\u0026gt;1.8\u0026lt;/maven.compiler.source\u0026gt; \u0026lt;maven.compiler.target\u0026gt;1.8\u0026lt;/maven.compiler.target\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt;\u0026lt;!--å•å…ƒæµ‹è¯•--\u0026gt; \u0026lt;groupId\u0026gt;junit\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;junit\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.11\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;build\u0026gt; \u0026lt;!--æ’ä»¶ç‰ˆæœ¬çš„é…ç½®ï¼Œæ— ç‰¹æ®ŠæŒ‡å®šåˆ™åˆ é™¤--\u0026gt; \u0026lt;pluginManagement\u0026gt;\u0026lt;!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) --\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;!-- clean lifecycle, see https://maven.apache.org/ref/current/maven-core/lifecycles.html#clean_Lifecycle --\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;artifactId\u0026gt;maven-clean-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.1.0\u0026lt;/version\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;!-- default lifecycle, jar packaging: see https://maven.apache.org/ref/current/maven-core/default-bindings.html#Plugin_bindings_for_jar_packaging --\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;artifactId\u0026gt;maven-resources-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.0.2\u0026lt;/version\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;artifactId\u0026gt;maven-compiler-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.8.0\u0026lt;/version\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;artifactId\u0026gt;maven-surefire-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.22.1\u0026lt;/version\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;artifactId\u0026gt;maven-jar-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.0.2\u0026lt;/version\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;artifactId\u0026gt;maven-install-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.5.2\u0026lt;/version\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;artifactId\u0026gt;maven-deploy-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.8.2\u0026lt;/version\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;!-- site lifecycle, see https://maven.apache.org/ref/current/maven-core/lifecycles.html#site_Lifecycle --\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;artifactId\u0026gt;maven-site-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.7.1\u0026lt;/version\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;artifactId\u0026gt;maven-project-info-reports-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.0.0\u0026lt;/version\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/pluginManagement\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;/project\u0026gt; å•å…ƒæµ‹è¯• # å…³äºideaé¢œè‰² ç¼–å†™javaç¨‹åº\npackage com.bjpowernode; public class HelloMaven { public int addNumber(int n1,int n2){ return n1+n2; } public static void main(String[] args) { HelloMaven helloMaven=new HelloMaven(); int res=helloMaven.addNumber(10,20); System.out.println(\u0026#34;res = \u0026#34;+res); } } æµ‹è¯•ä½¿ç”¨ ideaä¸­mavenå·¥å…·çª—å£ # Mavenç”Ÿæˆçš„ç›®å½• ä½¿ç”¨mvn cleanè¿›è¡Œæ¸…ç†\nÎ» mvn clean [INFO] Scanning for projects... [INFO] [INFO] ------------------\u0026lt; com.bjpowernode:ch01-maven-j2se \u0026gt;------------------- [INFO] Building ch01-maven-j2se 1.0 [INFO] --------------------------------[ jar ]--------------------------------- [INFO] [INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ ch01-maven-j2se --- [INFO] Deleting D:\\Users\\ly\\Documents\\git\\mavenwork\\04-project\\ch01-maven-j2se\\target [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 0.438 s [INFO] Finished at: 2022-07-13T23:39:03+08:00 [INFO] ------------------------------------------------------------------------ çª—å£ å•å…ƒæµ‹è¯• æ‰“åŒ… installå®‰è£… å…¶ä»– é‡æ–°æ›´æ–°ä¾èµ–é¡¹ åˆ›å»ºwebé¡¹ç›®åŠ å…¥servletä¾èµ– # ç»“æ„ åˆ›å»ºjavaæ–‡ä»¶å¤¹å’Œèµ„æºæ–‡ä»¶å¤¹ pomæ–‡ä»¶\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;ch02-maven-web\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0\u0026lt;/version\u0026gt; \u0026lt;packaging\u0026gt;war\u0026lt;/packaging\u0026gt; \u0026lt;name\u0026gt;ch02-maven-web Maven Webapp\u0026lt;/name\u0026gt; \u0026lt;!-- FIXME change it to the project\u0026#39;s website --\u0026gt; \u0026lt;url\u0026gt;http://www.example.com\u0026lt;/url\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;project.build.sourceEncoding\u0026gt;UTF-8\u0026lt;/project.build.sourceEncoding\u0026gt; \u0026lt;maven.compiler.source\u0026gt;1.8\u0026lt;/maven.compiler.source\u0026gt; \u0026lt;maven.compiler.target\u0026gt;1.8\u0026lt;/maven.compiler.target\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;!--servletä¾èµ–--\u0026gt; \u0026lt;!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;javax.servlet\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;javax.servlet-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.0.1\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!--jspä¾èµ–--\u0026gt; \u0026lt;!-- https://mvnrepository.com/artifact/javax.servlet.jsp/javax.servlet.jsp-api --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;javax.servlet.jsp\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;javax.servlet.jsp-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.3.3\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!--junit--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;junit\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;junit\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.11\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/project\u0026gt; å’Œä¸Šé¢è¿›è¡Œå¯¹æ¯” åˆ›å»ºservlet # åˆ›å»ºå®Œä¹‹å\nä»£ç \npackage com.bjpowernode.controller; import javax.servlet.*; import javax.servlet.http.*; import java.io.IOException; public class HelloServlet extends HttpServlet { @Override protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { } @Override protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { } } web.xml\n\u0026lt;!DOCTYPE web-app PUBLIC \u0026#34;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\u0026#34; \u0026#34;http://java.sun.com/dtd/web-app_2_3.dtd\u0026#34; \u0026gt; \u0026lt;web-app\u0026gt; \u0026lt;display-name\u0026gt;Archetype Created Web Application\u0026lt;/display-name\u0026gt; \u0026lt;servlet\u0026gt; \u0026lt;servlet-name\u0026gt;HelloServlet\u0026lt;/servlet-name\u0026gt; \u0026lt;servlet-class\u0026gt;com.bjpowernode.controller.HelloServlet\u0026lt;/servlet-class\u0026gt; \u0026lt;/servlet\u0026gt; \u0026lt;/web-app\u0026gt; æ·»åŠ mapping\n\u0026lt;!DOCTYPE web-app PUBLIC \u0026#34;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\u0026#34; \u0026#34;http://java.sun.com/dtd/web-app_2_3.dtd\u0026#34; \u0026gt; \u0026lt;web-app\u0026gt; \u0026lt;display-name\u0026gt;Archetype Created Web Application\u0026lt;/display-name\u0026gt; \u0026lt;servlet\u0026gt; \u0026lt;servlet-name\u0026gt;HelloServlet\u0026lt;/servlet-name\u0026gt; \u0026lt;servlet-class\u0026gt;com.bjpowernode.controller.HelloServlet\u0026lt;/servlet-class\u0026gt; \u0026lt;/servlet\u0026gt; \u0026lt;servlet-mapping\u0026gt; \u0026lt;servlet-name\u0026gt;HelloServlet\u0026lt;/servlet-name\u0026gt; \u0026lt;url-pattern\u0026gt;/hello\u0026lt;/url-pattern\u0026gt; \u0026lt;/servlet-mapping\u0026gt; \u0026lt;/web-app\u0026gt; æ·»åŠ jsp\n\u0026lt;%-- Created by IntelliJ IDEA. User: ly Date: 2022/7/16 Time: 18:10 To change this template use File | Settings | File Templates. --%\u0026gt; \u0026lt;%@ page contentType=\u0026#34;text/html;charset=UTF-8\u0026#34; language=\u0026#34;java\u0026#34; %\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;index\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;a href=\u0026#34;hello\u0026#34; \u0026gt;è®¿é—®\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; è®¾ç½®è½¬å‘\npackage com.bjpowernode.controller; import javax.servlet.*; import javax.servlet.http.*; import java.io.IOException; public class HelloServlet extends HttpServlet { @Override protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { System.out.println(\u0026#34;æ”¶åˆ°è¯·æ±‚äº†\u0026#34;); //è½¬å‘åˆ°show request.getRequestDispatcher(\u0026#34;/show.jsp\u0026#34;) .forward(request,response); } @Override protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { } } è®¾ç½®tomcatå¹¶å‘å¸ƒ\nideaå‡ºç°not found for the web module. å¤ä¹ æ ¸å¿ƒçš„æ¦‚å¿µ # çº¦å®šçš„ç›®å½•ç»“æ„ pom é¡¹ç›®å¯¹è±¡æ¨¡å‹ï¼ŒgroupId,artifactId,version gav ä»“åº“ æœ¬åœ°ä»“åº“ \u0026hellip;../.m2/repository è¿œç¨‹ä»“åº“ ç”Ÿå‘½å‘¨æœŸï¼Œcleanï¼Œcompileï¼Œtest-compileï¼Œtestï¼Œpackageï¼Œinstall mavenå’Œideaé›†æˆ è®¾ç½®mavenå®‰è£…ç›®å½•å’Œé…ç½®æ–‡ä»¶ è®¾ç½®Runnerï¼Œåˆ›å»ºmavenæ—¶é€Ÿåº¦å¿« ä½¿ç”¨æ¨¡æ¿åˆ›å»º seå’Œweb å¯¼å…¥æ¨¡å—åˆ°idea # å¯¼å…¥02è¿™ä¸ªé¡¹ç›® ç»“æœ å½“ç£ç›˜ä¸­æ–‡ä»¶å¤¹åå­—å’Œé¡¹ç›®åä¸ä¸€æ ·æ—¶ å¦‚æœå¯¼å…¥åé¢œè‰²ä¸å¯¹ï¼Œåˆ™éœ€è¦å³é”® mark as scopeä¾èµ–èŒƒå›´ # scopeæ ‡ç­¾\nä¾èµ–èŒƒå›´ï¼šscopeæ ‡ç­¾ï¼Œè¿™ä¸ªä¾èµ–åœ¨é¡¹ç›®æ„å»ºçš„å“ªä¸ªé˜¶æ®µèµ·ä½œç”¨\nå€¼ï¼šcompileï¼Œé»˜è®¤ï¼Œå‚ä¸æ„å»ºé¡¹ç›®çš„æ‰€æœ‰é˜¶æ®µï¼› testï¼šæµ‹è¯•ï¼Œåœ¨æµ‹è¯•é˜¶æ®µä½¿ç”¨ï¼Œæ¯”å¦‚æ‰§è¡Œmvn test ä¼šä½¿ç”¨junit providedï¼šæä¾›è€…ï¼Œé¡¹ç›®åœ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨æ—¶ï¼Œä¸éœ€è¦æä¾›è¿™ä¸ªä¾èµ–çš„jarï¼Œè€Œæ˜¯ç”±æœåŠ¡å™¨æä¾›è¿™ä¸ªä»¥æ¥çš„jaråŒ… æ‰“åŒ…æ—¶åªæœ‰mysql waræ–‡ä»¶ ç»™æœåŠ¡å™¨ï¼Œå³æ”¾åˆ°tomcatçš„webappsä¸­ å¯åŠ¨tomcatä¹‹åï¼Œä¼šè‡ªåŠ¨è§£å‹ è®¿é—® è‡ªå®šä¹‰å˜é‡ # propertiesæ ‡ç­¾ï¼Œå¸¸ç”¨è®¾ç½® testæŠ¥å‘Š è¿™ç§éœ€è¦å°†æ–‡ä»¶å¤¹åˆ é™¤ï¼Œç„¶åreimport å…¨å±€å˜é‡ï¼Œæ¯”å¦‚ä¾èµ–ç‰ˆæœ¬å· é‡å¤çš„é—®é¢˜ åœ¨propertiesé‡Œé¢å®šä¹‰å³å¯ ä½¿ç”¨å…¨å±€å˜é‡ ${å˜é‡å} å¤„ç†æ–‡ä»¶çš„é»˜è®¤è§„åˆ™ # ä½¿ç”¨èµ„æºæ’ä»¶ ä¾‹å­ æ”¾ç½®ä¸‰ä¸ªæ–‡ä»¶ è¿›è¡Œå››ä¸ªæ“ä½œï¼Œä¼šç”Ÿæˆèµ„æºæ–‡ä»¶ï¼ˆsrc/resourcesï¼‰æ‹·è´åˆ°target/classesç›®å½•ä¸‹ å¦‚æœåœ¨javaä¸‹çš„åŒ…ä¸­æ”¾èµ„æºæ–‡ä»¶ æ²¡æœ‰æ‹·è´ å³mavenåªå¤„ç†src/main/javaç›®å½•ä¸‹çš„.javaæ–‡ä»¶ï¼ŒæŠŠè¿™äº›ç¼–è¯‘æˆclassï¼Œæ‹·è´åˆ°target/classesç›®å½•ä¸­ï¼Œä¸å¤„ç†å…¶ä»–æ–‡ä»¶ èµ„æºæ’ä»¶ # buildä¸‹\n\u0026lt;build\u0026gt; \u0026lt;!--èµ„æºæ’ä»¶--\u0026gt; \u0026lt;resources\u0026gt; \u0026lt;resource\u0026gt; \u0026lt;!--æ‰€åœ¨çš„ç›®å½•--\u0026gt; \u0026lt;directory\u0026gt;src/main/java\u0026lt;/directory\u0026gt; \u0026lt;!--åŒ…æ‹¬propertiesåŠxmlåç¼€æ–‡ä»¶--\u0026gt; \u0026lt;includes\u0026gt; \u0026lt;include\u0026gt;**/*.properties\u0026lt;/include\u0026gt; \u0026lt;include\u0026gt;**/*.xml\u0026lt;/include\u0026gt; \u0026lt;include\u0026gt;**/*.txt\u0026lt;/include\u0026gt; \u0026lt;include\u0026gt;**/*\u0026lt;/include\u0026gt; \u0026lt;/includes\u0026gt; \u0026lt;excludes\u0026gt; \u0026lt;exclude\u0026gt;**/*.java\u0026lt;/exclude\u0026gt; \u0026lt;/excludes\u0026gt; \u0026lt;!--ä¸ä½¿ç”¨è¿‡æ»¤å™¨ï¼Œ*.xmlå·²ç»èµ·åˆ°è¿‡æ»¤ä½œç”¨äº†--\u0026gt; \u0026lt;filtering\u0026gt;false\u0026lt;/filtering\u0026gt; \u0026lt;/resource\u0026gt; \u0026lt;/resources\u0026gt; \u0026lt;/resources\u0026gt; \u0026lt;/build\u0026gt; ç»“æœ "},{"id":177,"href":"/zh/docs/study/Maven/base_dljd/17-30/","title":"17-30 mavenåŸºç¡€_åŠ¨åŠ›èŠ‚ç‚¹","section":"åŸºç¡€(åŠ¨åŠ›èŠ‚ç‚¹)_","content":" æœ¬åœ°ä»“åº“çš„è®¾ç½® # è¿œç¨‹ä»“åº“\u0026ndash;\u0026gt;æœ¬åœ°ä»“åº“\nmavenä»“åº“\nå­˜æ”¾mavenå·¥å…·è‡ªå·±çš„jaråŒ… ç¬¬ä¸‰æ–¹jarï¼Œæ¯”å¦‚mysqlé©±åŠ¨ è‡ªå·±å†™çš„ç¨‹åºï¼Œå¯ä»¥æ‰“åŒ…ä¸ºjarï¼Œå­˜æ”¾åˆ°ä»“åº“ åˆ†ç±»\næœ¬åœ°ä»“åº“ï¼ˆæœ¬æœºï¼‰ï¼šä½äºè‡ªå·±è®¡ç®—æœºä¸­ï¼Œç£ç›˜ä¸­æŸä¸ªç›®å½•\né»˜è®¤ä½ç½® ç™»å½•æ“ä½œç³»ç»Ÿçš„è´¦å·ç›®å½•/.m2/repository C:\\Users\\ly.m2\\repository\nå¯ä¿®æ”¹ æ¯”å¦‚æ”¾åœ¨dç›˜ä¸­\nè‹±[rÉªËˆpÉ’zÉ™tri] D:\\software\\apache-maven-3.8.6\\repository å¤‡ä»½å¹¶ç¼–è¾‘ æ”¹æˆå·¦æ–œæ çš„æ–¹å¼\n\u0026lt;settings xmlns=\u0026#34;http://maven.apache.org/SETTINGS/1.2.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/SETTINGS/1.2.0 https://maven.apache.org/xsd/settings-1.2.0.xsd\u0026#34;\u0026gt; \u0026lt;!-- localRepository | The path to the local repository maven will use to store artifacts. | | Default: ${user.home}/.m2/repository \u0026lt;localRepository\u0026gt;/path/to/local/repo\u0026lt;/localRepository\u0026gt; --\u0026gt; \u0026lt;localRepository\u0026gt;D:/software/apache-maven-3.8.6/repository\u0026lt;/localRepository\u0026gt; æŠŠä¹‹å‰userä¸‹çš„repositoryçš„æ–‡ä»¶éƒ½æ‹·è´åˆ° D:/software/apache-maven-3.8.6/repository ä¸‹ ç„¶åå†å¯¹Helloé¡¹ç›®è¿›è¡Œç¼–è¯‘ mvn compile å‘ç°ä¸ä¼šä¸‹è½½ä»»ä½•æ–‡ä»¶ï¼Œä¸”userä¸‹çš„repositoryä¹Ÿä¸ä¼šå†è¿›è¡Œä¸‹è½½\nä¸‹é¢çš„èµ„æºæ˜¯ä»mavenä¸­ä¸‹è½½ï¼Œæˆ–è€…ç”¨mavenæ‰“åŒ…çš„ pom.xmlæ¥è¯´æ˜æŸä¸ªé¡¹ç›®éœ€è¦æ€ä¹ˆå¤„ç†ä»£ç ã€é¡¹ç›®ç»“æ„\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34; ?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;ch01-maven\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;packaging\u0026gt;jar\u0026lt;/packaging\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;java.version\u0026gt;1.8\u0026lt;/java.version\u0026gt; \u0026lt;maven.compiler.source\u0026gt;1.8\u0026lt;/maven.compiler.source\u0026gt; \u0026lt;maven.compiler.target\u0026gt;1.8\u0026lt;/maven.compiler.target\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.1.9\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/project\u0026gt; mvnå‘½ä»¤éœ€è¦åœ¨pom.xmlæ‰€åœ¨çš„ç›®å½•ä¸‹æ‰§è¡Œ ä»“åº“çš„å·¥ä½œæ–¹å¼ # ç”Ÿå‘½å‘¨æœŸæ’ä»¶å‘½ä»¤ # åŒ…æ‹¬ æ¸…ç†ï¼ˆåˆ é™¤targetæ–‡ä»¶ï¼Œä½†æ˜¯ä¸å¤„ç†å·²ç»installçš„jarï¼‰ã€ç¼–è¯‘ï¼ˆå½“å‰ç›®å½•ç”Ÿæˆtargetç›®å½•ï¼Œæ”¾ç½®ç¼–è¯‘ä¸»ç¨‹åºä¹‹åç”Ÿæˆçš„å­—èŠ‚ç ï¼‰ã€æµ‹è¯•ï¼ˆç”Ÿæˆsurefire-reportsï¼Œä¿å­˜æµ‹è¯•ç»“æœï¼‰ã€æŠ¥å‘Šã€æ‰“åŒ…ï¼ˆæ‰“åŒ…ä¸»ç¨‹åº[ç¼–è¯‘ã€ç¼–è¯‘æµ‹è¯•ã€æµ‹è¯•ï¼Œå¹¶æŒ‰ç…§pom.xmlé…ç½®æŠŠä¸»ç¨‹åºæ‰“åŒ…æˆjaråŒ…æˆ–waråŒ…]ï¼‰ã€å®‰è£…ï¼ˆæŠŠæœ¬å·¥ç¨‹æ‰“åŒ…ï¼Œå¹¶æŒ‰ç…§å·¥ç¨‹åæ ‡ä¿å­˜åˆ°æœ¬åœ°ä»“åº“ä¸­ï¼‰ã€éƒ¨ç½²(æ‰“åŒ…ï¼Œä¿å­˜åˆ°æœ¬åœ°ä»“åº“ï¼Œå¹¶ä¿å­˜åˆ°ç§æœä¸­ï¼Œä¸”è‡ªåŠ¨æŠŠé¡¹ç›®éƒ¨ç½²åˆ°webå®¹å™¨ä¸­) æ’ä»¶ï¼šè¦å®Œæˆæ„å»ºé¡¹ç›®çš„å„ä¸ªé˜¶æ®µï¼Œè¦ä½¿ç”¨mavençš„å‘½ä»¤ï¼Œæ‰§è¡Œå‘½ä»¤çš„åŠŸèƒ½ï¼Œæ˜¯é€šè¿‡æ’ä»¶å®Œæˆçš„ æ’ä»¶å°±æ˜¯jarï¼Œä¸€äº›ç±» å‘½ä»¤ï¼šæ‰§è¡ŒmavenåŠŸèƒ½ï¼Œé€šè¿‡å‘½ä»¤å‘å‡ºï¼Œæ¯”å¦‚mvn compileï¼ˆç¼–è¯‘æ—¶ç”±ç›¸å…³çš„ç±»æ¥æ“ä½œï¼‰ junitä½¿ç”¨ # å•å…ƒæµ‹è¯• junitï¼šå•å…ƒæµ‹è¯•çš„å·¥å…·ï¼Œjavaä¸­ç»å¸¸ä½¿ç”¨ å•å…ƒï¼Œjavaä¸­æŒ‡çš„æ˜¯æ–¹æ³•ï¼Œæ–¹æ³•å°±æ˜¯ä¸€ä¸ªå•å…ƒï¼Œæ–¹æ³•æ˜¯æµ‹è¯•çš„æœ€å°å•ä½\nä½œç”¨ï¼Œä½¿ç”¨junitå»æµ‹è¯•æ–¹æ³•æ˜¯å¦å®Œæˆäº†è¦æ±‚ï¼Œå¼€å‘äººå‘˜è‡ªæµ‹\nä½¿ç”¨å•å…ƒæµ‹è¯•\nåŠ å…¥junitçš„ä¾èµ–ï¼ˆéœ€è¦ç”¨ä»–çš„ç±»å’Œæ–¹æ³•ï¼‰\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;junit\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;junit\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.12\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; åœ¨src/test/javaç›®å½•ä¸­åˆ›å»ºæµ‹è¯•ç±»æ–‡ä»¶ï¼Œå†™æµ‹è¯•ä»£ç \næµ‹è¯•ç±»çš„å®šä¹‰ï¼Œåç§°ä¸€èˆ¬æ˜¯Test+è¦æµ‹è¯•çš„ç±»åç§° æµ‹è¯•å®ƒçš„åŒ…åå’Œè¦æµ‹è¯•çš„ç±»åŒ…åä¸€æ · åœ¨ç±»ä¸­å®šä¹‰æ–¹æ³•ï¼Œè¦æµ‹è¯•çš„ä»£ç  æ–¹æ³•å®šä¹‰ï¼špublicæ–¹æ³•ï¼Œæ²¡æœ‰è¿”å›å€¼ï¼Œåç§°è‡ªå®šä¹‰ï¼ˆå»ºè®®Test+æµ‹è¯•çš„æ–¹æ³•åç§°ï¼‰ æ–¹æ³•æ²¡æœ‰å‚æ•° æµ‹è¯•ç±»ä¸­çš„æ–¹æ³•ï¼Œå¯ä»¥å•ç‹¬æ‰§è¡Œï¼Œæµ‹è¯•ç±»ä¹Ÿå¯ä»¥å•ç‹¬æ‰§è¡Œ åœ¨è¯¥æ–¹æ³•ä¸Šé¢åŠ å…¥æ³¨è§£@Test æ³¨æ„ï¼šmvn compileçš„æ—¶å€™ï¼Œä¼šä¸‹è½½3.8.2çš„jaråŒ… åˆ›å»ºæµ‹è¯•ç±»å’Œæµ‹è¯•æ–¹æ³• # package com.bjpowernode; //å¯¼å…¥åŒ… import org.junit.Assert; import org.junit.Test; public class TestHelloMaven{ //å®šä¹‰å¤šä¸ªç‹¬ç«‹çš„æµ‹è¯•æ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½æ˜¯ç‹¬ç«‹çš„ public void testAddNumber(){ System.out.println(\u0026#34;æ‰§è¡Œäº†æµ‹è¯•æ–¹æ³•testAddNumber\u0026#34;); HelloMaven hello=new HelloMaven(); int res=hello.addNumber(10,20); //æŠŠè®¡ç®—ç»“æœresäº¤ç»™junitåˆ¤æ–­ //æœŸæœ›å€¼ï¼Œå®é™…å€¼ Assert.assertEquals(30,res); } } ç›¸å…³å‘½ä»¤ # mvn clean ï¼Œæ¸…ç†ï¼Œåˆ é™¤ä»¥å‰ç”Ÿæˆçš„æ•°æ®ï¼ˆåˆ é™¤targetç›®å½•ï¼‰ æ’ä»¶åŠç‰ˆæœ¬ maven-clean-plugin:2.5\nd:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\u0026gt;mvn clean [INFO] Scanning for projects... [INFO] [INFO] ---------------------\u0026lt; com.bjpowernode:ch01-maven \u0026gt;--------------------- [INFO] Building ch01-maven 1.0-SNAPSHOT [INFO] --------------------------------[ jar ]--------------------------------- [INFO] [INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ ch01-maven --- [INFO] Deleting d:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\\target [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 0.354 s [INFO] Finished at: 2022-07-09T17:03:46+08:00 [INFO] ------------------------------------------------------------------------ ä»£ç çš„ç¼–è¯‘ mvn compileï¼šç¼–è¯‘å‘½ä»¤ï¼ŒæŠŠsrc/main/java ç›®å½•ä¸­çš„javaä»£ç ç¼–è¯‘ä¸ºclassæ–‡ä»¶ åŒæ—¶æŠŠclassæ–‡ä»¶æ‹·è´åˆ°target/classesç›®å½•ï¼Œè¿™ä¸ªç›®å½•classesæ˜¯å­˜æ”¾ç±»æ–‡ä»¶çš„æ ¹ç›®å½•ï¼ˆä¹Ÿå«åšç±»è·¯å¾„ï¼Œclasspathï¼‰\nç¼–è¯‘åæ”¾åˆ°target\\classesä¸­ æ’ä»¶ï¼šmaven-compiler-plugin:3.1 ç¼–è¯‘ä»£ç  maven-resources-plugin:2.6:resources èµ„æºæ’ä»¶ï¼Œä½œç”¨æ˜¯æŠŠsrc/main/resourcesç›®å½•ä¸­çš„æ–‡ä»¶æ‹·è´åˆ°target/classes ç›®å½•ä¸­\nÎ» mvn compile [INFO] Scanning for projects... [INFO] [INFO] ---------------------\u0026lt; com.bjpowernode:ch01-maven \u0026gt;--------------------- [INFO] Building ch01-maven 1.0-SNAPSHOT [INFO] --------------------------------[ jar ]--------------------------------- [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ ch01-maven --- [WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent![INFO] Copying 1 resource [INFO] [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ ch01-maven --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding GBK, i.e. build is platform dependent! [INFO] Compiling 1 source file to D:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\\target\\classes [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 3.164 s [INFO] Finished at: 2022-07-09T17:20:30+08:00 [INFO] ------------------------------------------------------------------------ æµ‹è¯•resourcesæ’ä»¶ mvn test-compile:ç¼–è¯‘å‘½ä»¤ï¼Œç¼–è¯‘src/test/java ç›®å½•ä¸­çš„æºæ–‡ä»¶ï¼ŒæŠŠç”Ÿæˆçš„classæ‹·è´åˆ°target/test-classesç›®å½•ä¸­ï¼ŒåŒæ—¶æŠŠsrc/test/resourcesç›®å½•ä¸­çš„æ–‡ä»¶æ‹·è´åˆ°test-classesç›®å½• å‘½ä»¤æ‰§è¡Œå‰ æ‰§è¡Œå æ’ä»¶ maven-resources-plugin:2.6:resources maven-compiler-plugin:3.1:compile maven-resources-plugin:2.6:testResources maven-compiler-plugin:3.1:testCompile\nÎ» mvn test-compile [INFO] Scanning for projects... [INFO] [INFO] ---------------------\u0026lt; com.bjpowernode:ch01-maven \u0026gt;--------------------- [INFO] Building ch01-maven 1.0-SNAPSHOT [INFO] --------------------------------[ jar ]--------------------------------- Downloading from central: https://repo.maven.apache.org/maven2/junit/junit/4.12/junit-4.12.jar Downloading from central: https://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar Downloaded from central: https://repo.maven.apache.org/maven2/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar (45 kB at 24 kB/s) Downloaded from central: https://repo.maven.apache.org/maven2/junit/junit/4.12/junit-4.12.jar (315 kB at 118 kB/s) [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ ch01-maven --- [WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent![INFO] Copying 2 resources [INFO] [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ ch01-maven --- [INFO] Nothing to compile - all classes are up to date [INFO] [INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ ch01-maven --- [WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent![INFO] Copying 1 resource [INFO] [INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ ch01-maven --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding GBK, i.e. build is platform dependent! [INFO] Compiling 1 source file to D:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\\target\\test-classes [WARNING] /D:/Users/ly/Documents/git/mavenwork/Hello/src/test/java/com/bjpowernode/TestHelloMaven.java:[2,7] ç¼–ç GBKçš„ä¸å¯æ˜ å°„å­—ç¬¦ [WARNING] /D:/Users/ly/Documents/git/mavenwork/Hello/src/test/java/com/bjpowernode/TestHelloMaven.java:[8,42] ç¼–ç GBKçš„ä¸å¯æ˜ å°„å­—ç¬¦ [WARNING] /D:/Users/ly/Documents/git/mavenwork/Hello/src/test/java/com/bjpowernode/TestHelloMaven.java:[14,29] ç¼–ç GBKçš„ä¸å¯æ˜ å°„å­—ç¬¦ [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 8.085 s [INFO] Finished at: 2022-07-09T17:28:14+08:00 [INFO] ------------------------------------------------------------------------ mvn test æµ‹è¯•å‘½ä»¤ï¼Œæ‰§è¡Œtest-classesç›®å½•çš„ç¨‹åºï¼Œæµ‹è¯•src/main/javaç›®å½•ä¸­çš„ä¸»ç¨‹åºæ˜¯å¦ç¬¦åˆè¦æ±‚ æ³¨æ„ï¼Œè¿™é‡Œè¿˜æ˜¯ä¼šç”¨åˆ°ç¼–è¯‘æ’ä»¶å’Œèµ„æºæ’ä»¶ï¼Œä» T E S T S å¼€å§‹æµ‹è¯• ç»“æœResults :\nTests run: 1, Failures: 0, Errors: 0, Skipped: 0 æµ‹è¯•æ’ä»¶ maven-surefire-plugin:2.12.4\nÎ» mvn test [INFO] Scanning for projects... [INFO] [INFO] ---------------------\u0026lt; com.bjpowernode:ch01-maven \u0026gt;--------------------- [INFO] Building ch01-maven 1.0-SNAPSHOT [INFO] --------------------------------[ jar ]--------------------------------- [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ ch01-maven --- [WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent![INFO] Copying 2 resources [INFO] [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ ch01-maven --- [INFO] Nothing to compile - all classes are up to date [INFO] [INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ ch01-maven --- [WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent![INFO] Copying 1 resource [INFO] [INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ ch01-maven --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding GBK, i.e. build is platform dependent! [INFO] Compiling 1 source file to D:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\\target\\test-classes [INFO] [INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ ch01-maven --- [INFO] Surefire report directory: D:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\\target\\surefire-reports ------------------------------------------------------- T E S T S ------------------------------------------------------- Running com.bjpowernode.TestHelloMaven æ‰§è¡Œäº†æµ‹è¯•æ–¹æ³•testAddNumber hello maven -addNumber Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.131 sec Results : Tests run: 1, Failures: 0, Errors: 0, Skipped: 0 [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 4.630 s [INFO] Finished at: 2022-07-09T17:32:49+08:00 [INFO] ------------------------------------------------------------------------ æµ‹è¯•æŠ¥å‘Š æµ‹è¯•å¤±è´¥çš„æƒ…å†µ ç»“æœ\nÎ» mvn test [INFO] Scanning for projects... [INFO] [INFO] ---------------------\u0026lt; com.bjpowernode:ch01-maven \u0026gt;--------------------- [INFO] Building ch01-maven 1.0-SNAPSHOT [INFO] --------------------------------[ jar ]--------------------------------- [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ ch01-maven --- [WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent![INFO] Copying 2 resources [INFO] [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ ch01-maven --- [INFO] Nothing to compile - all classes are up to date [INFO] [INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ ch01-maven --- [WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent![INFO] Copying 1 resource [INFO] [INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ ch01-maven --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding GBK, i.e. build is platform dependent! [INFO] Compiling 1 source file to D:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\\target\\test-classes [INFO] [INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ ch01-maven --- [INFO] Surefire report directory: D:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\\target\\surefire-reports ------------------------------------------------------- T E S T S ------------------------------------------------------- Running com.bjpowernode.TestHelloMaven æ‰§è¡Œäº†æµ‹è¯•æ–¹æ³•testAddNumber hello maven -addNumber Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.217 sec \u0026lt;\u0026lt;\u0026lt; FAILURE! testAddNumber(com.bjpowernode.TestHelloMaven) Time elapsed: 0.043 sec \u0026lt;\u0026lt;\u0026lt; FAILURE! java.lang.AssertionError: expected:\u0026lt;60\u0026gt; but was:\u0026lt;30\u0026gt; at org.junit.Assert.fail(Assert.java:88) at org.junit.Assert.failNotEquals(Assert.java:834) at org.junit.Assert.assertEquals(Assert.java:645) at org.junit.Assert.assertEquals(Assert.java:631) at com.bjpowernode.TestHelloMaven.testAddNumber(TestHelloMaven.java:15) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50) at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12) at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47) at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17) at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57) at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290) at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71) at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288) at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58) at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268) at org.junit.runners.ParentRunner.run(ParentRunner.java:363) at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:252) at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:141) at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:112) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:189) at org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:165) at org.apache.maven.surefire.booter.ProviderFactory.invokeProvider(ProviderFactory.java:85) at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:115) at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:75) Results : Failed tests: testAddNumber(com.bjpowernode.TestHelloMaven): expected:\u0026lt;60\u0026gt; but was:\u0026lt;30\u0026gt; Tests run: 1, Failures: 1, Errors: 0, Skipped: 0 [INFO] ------------------------------------------------------------------------ [INFO] BUILD FAILURE [INFO] ------------------------------------------------------------------------ [INFO] Total time: 8.018 s [INFO] Finished at: 2022-07-09T17:35:38+08:00 [INFO] ------------------------------------------------------------------------ [ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:2.12.4:test (default-test) on project ch01-maven: There are test failures. [ERROR] [ERROR] Please refer to D:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\\target\\surefire-reports for the individual test results. [ERROR] -\u0026gt; [Help 1] [ERROR] [ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch. [ERROR] Re-run Maven using the -X switch to enable full debug logging. [ERROR] [ERROR] For more information about the errors and possible solutions, please read the following articles: [ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException mvn package æ‰“åŒ…ï¼Œä½œç”¨æ˜¯æŠŠé¡¹ç›®ä¸­çš„èµ„æºclassæ–‡ä»¶å’Œé…ç½®æ–‡ä»¶ï¼Œéƒ½æ”¾åˆ°ä¸€ä¸ªå‹ç¼©åŒ…ä¸­ï¼Œé»˜è®¤å‹ç¼©æ–‡ä»¶æ˜¯jarç±»å‹ï¼Œwebåº”ç”¨æ˜¯warç±»å‹ï¼Œæ‰©å±•åjar/war è¿™é‡Œè¿›è¡Œäº†ç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ… [INFO] Building jar: D:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\\target\\ch01-maven-1.0-SNAPSHOT.jar æ‰“åŒ…æ’ä»¶ maven-jar-plugin:2.4:jar (default-jar) @ ch01-maven maven-jar-plugin:2.4ç”¨æ¥æ‰§è¡Œæ‰“åŒ…ï¼Œä¼šç”Ÿæˆjaræ‰©å±•åæ–‡ä»¶\nÎ» mvn package [INFO] Scanning for projects... [INFO] [INFO] ---------------------\u0026lt; com.bjpowernode:ch01-maven \u0026gt;--------------------- [INFO] Building ch01-maven 1.0-SNAPSHOT [INFO] --------------------------------[ jar ]--------------------------------- [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ ch01-maven --- [WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent! [INFO] Copying 2 resources [INFO] [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ ch01-maven --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding GBK, i.e. build is platform dependent! [INFO] Compiling 1 source file to D:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\\target\\classes [INFO] [INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ ch01-maven --- [WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent! [INFO] Copying 1 resource [INFO] [INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ ch01-maven --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding GBK, i.e. build is platform dependent! [INFO] Compiling 1 source file to D:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\\target\\test-classes [INFO] [INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ ch01-maven --- [INFO] Surefire report directory: D:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\\target\\surefire-reports ------------------------------------------------------- T E S T S ------------------------------------------------------- Running com.bjpowernode.TestHelloMaven æ‰§è¡Œäº†æµ‹è¯•æ–¹æ³•testAddNumber hello maven -addNumber Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.135 sec Results : Tests run: 1, Failures: 0, Errors: 0, Skipped: 0 [INFO] [INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ ch01-maven --- [INFO] Building jar: D:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\\target\\ch01-maven-1.0-SNAPSHOT.jar [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 5.624 s [INFO] Finished at: 2022-07-09T17:40:44+08:00 [INFO] ------------------------------------------------------------------------ ç”Ÿæˆch01-maven-1.0-SNAPSHOT.jar åæ ‡\n\u0026lt;groupId\u0026gt;com.bjpowernode\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;ch01-maven\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;packaging\u0026gt;jar\u0026lt;/packaging\u0026gt; æ‰“åŒ…çš„æ–‡ä»¶å artifactId-version.packaging æŸ¥çœ‹jar æ‰“åŒ…çš„æ–‡ä»¶ä¸­ï¼ŒåŒ…æ‹¬src/mainç›®å½•ä¸­æ‰€æœ‰çš„ç”Ÿæˆçš„classæ–‡ä»¶å’Œé…ç½®æ–‡ä»¶ï¼ˆresourcesä¸‹ï¼‰ï¼Œå’Œæµ‹è¯•testæ— å…³\nmvn install æŠŠç”Ÿæˆçš„æ‰“åŒ…æ–‡ä»¶ï¼ˆjarï¼‰å®‰è£…åˆ°mavenä»“åº“ä¸­ æ’ä»¶ï¼šmaven-install-plugin-2.4\nÎ» mvn install [INFO] Scanning for projects... [INFO] [INFO] ---------------------\u0026lt; com.bjpowernode:ch01-maven \u0026gt;--------------------- [INFO] Building ch01-maven 1.0-SNAPSHOT [INFO] --------------------------------[ jar ]--------------------------------- [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ ch01-maven --- [WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent! [INFO] Copying 2 resources [INFO] [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ ch01-maven --- [INFO] Nothing to compile - all classes are up to date [INFO] [INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ ch01-maven --- [WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent! [INFO] Copying 1 resource [INFO] [INFO] --- maven-compiler-plugin:3.1:testCompile (default-testCompile) @ ch01-maven --- [INFO] Nothing to compile - all classes are up to date [INFO] [INFO] --- maven-surefire-plugin:2.12.4:test (default-test) @ ch01-maven --- [INFO] Surefire report directory: D:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\\target\\surefire-reports ------------------------------------------------------- T E S T S ------------------------------------------------------- Running com.bjpowernode.TestHelloMaven æ‰§è¡Œäº†æµ‹è¯•æ–¹æ³•testAddNumber hello maven -addNumber Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.162 sec Results : Tests run: 1, Failures: 0, Errors: 0, Skipped: 0 [INFO] [INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ ch01-maven --- [INFO] [INFO] --- maven-install-plugin:2.4:install (default-install) @ ch01-maven --- [INFO] Installing D:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\\target\\ch01-maven-1.0-SNAPSHOT.jar to D:\\software\\apache-maven-3.8.6\\repository\\com\\bjpowernode\\ch01-maven\\1.0-SNAPSHOT\\ch01-maven-1.0-SNAPSHOT.jar [INFO] Installing D:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\\pom.xml to D:\\software\\apache-maven-3.8.6\\repository\\com\\bjpowernode\\ch01-maven\\1.0-SNAPSHOT\\ch01-maven-1.0-SNAPSHOT.pom [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 5.063 s [INFO] Finished at: 2022-07-09T17:48:43+08:00 [INFO] ------------------------------------------------------------------------ å¦‚ä¸Šï¼Œ\nInstalling D:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\\target\\ch01-maven-1.0-SNAPSHOT.jar to D:\\software\\apache-maven-3.8.6\\repository\\com\\bjpowernode\\ch01-maven\\1.0-SNAPSHOT\\ch01-maven-1.0-SNAPSHOT.jar è·¯å¾„ com\\bjpowernode\\ch01-maven\\1.0-SNAPSHOT ï¼Œå¦‚ä¸‹ï¼Œè·Ÿåæ ‡æœ‰å…³\n\u0026lt;groupId\u0026gt;com.bjpowernode\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;ch01-maven\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;packaging\u0026gt;jar\u0026lt;/packaging\u0026gt; \u0026lt;!--groupIdå‡ºç°ç‚¹ï¼Œåˆ™ä½¿ç”¨\\ï¼ˆæ–‡ä»¶å¤¹ï¼‰åˆ†å‰² artifactId ç‹¬ç«‹æ–‡ä»¶å¤¹ version ç‹¬ç«‹æ–‡ä»¶å¤¹ --\u0026gt; ç»“æœ éƒ¨ç½² mvn deploy éƒ¨ç½²ä¸»ç¨‹åºï¼ˆæŠŠæœ¬å·¥ç¨‹æ‰“åŒ…ï¼ŒæŒ‰ç…§æœ¬å·¥ç¨‹çš„åæ ‡ä¿å­˜åˆ°æœ¬åœ°ä»“åº“ä¸­ï¼Œå¹¶ä¸”ä¿å­˜åˆ°ç§æœä»“åº“ä¸­ï¼Œè¿˜ä¼šè‡ªåŠ¨æŠŠé¡¹ç›®éƒ¨ç½²åˆ°webå®¹å™¨ä¸­\nä»¥ä¸Šå‘½ä»¤æ˜¯å¯ä»¥ç»„åˆç€ç”¨çš„\nÎ» mvn clean compile [INFO] Scanning for projects... [INFO] [INFO] ---------------------\u0026lt; com.bjpowernode:ch01-maven \u0026gt;--------------------- [INFO] Building ch01-maven 1.0-SNAPSHOT [INFO] --------------------------------[ jar ]--------------------------------- [INFO] [INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ ch01-maven --- [INFO] Deleting D:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\\target [INFO] [INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ ch01-maven --- [WARNING] Using platform encoding (GBK actually) to copy filtered resources, i.e. build is platform dependent! [INFO] Copying 2 resources [INFO] [INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ ch01-maven --- [INFO] Changes detected - recompiling the module! [WARNING] File encoding has not been set, using platform encoding GBK, i.e. build is platform dependent! [INFO] Compiling 1 source file to D:\\Users\\ly\\Documents\\git\\mavenwork\\Hello\\target\\classes [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 2.725 s [INFO] Finished at: 2022-07-09T17:53:36+08:00 [INFO] ------------------------------------------------------------------------ é…ç½®æ’ä»¶ # å¸¸ç”¨æ’ä»¶è®¾ç½®\n\u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-compiler-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.8.1\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;source\u0026gt;1.8\u0026lt;/source\u0026gt; \u0026lt;target\u0026gt;1.8\u0026lt;/target\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; å…ˆçœ‹ä¸€ä¸‹ï¼Œç›®å‰çš„ç‰ˆæœ¬ maven-compiler-plugin:3.1:compile "},{"id":178,"href":"/zh/docs/study/Maven/base_dljd/01-16/","title":"01-16 mavenåŸºç¡€_åŠ¨åŠ›èŠ‚ç‚¹","section":"åŸºç¡€(åŠ¨åŠ›èŠ‚ç‚¹)_","content":" è¯¾ç¨‹ä»‹ç» # maven è‡ªåŠ¨åŒ–æ„å»º\u0026ndash;\u0026gt;å¼€å‘\u0026ndash;ç¼–è¯‘\u0026ndash;è¿è¡Œ-æµ‹è¯•\u0026ndash;æ‰“åŒ…\u0026ndash;éƒ¨ç½² ï¼ˆm ei \u0026rsquo; venï¼‰ mavençš„ä½œç”¨ # è½¯ä»¶æ˜¯ä¸€ä¸ªå·¥ç¨‹ è½¯ä»¶ä¸­é‡å¤çš„æ“ä½œï¼ˆå¼€å‘é˜¶æ®µï¼‰ éœ€æ±‚åˆ†æ è®¾è®¡é˜¶æ®µ å¼€å‘é˜¶æ®µï¼ˆç¼–ç ï¼‰ï¼Œç¼–è¯‘ï¼Œæµ‹è¯• æµ‹è¯•é˜¶æ®µï¼ˆä¸“ä¸šæµ‹è¯•ï¼‰ï¼Œæµ‹è¯•æŠ¥å‘Š é¡¹ç›®æ‰“åŒ…ï¼Œå‘å¸ƒï¼Œç»™å®¢æˆ·å®‰è£…é¡¹ç›® maven é¡¹ç›®è‡ªåŠ¨æ„å»ºï¼Œæ¸…ç†ã€ç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…ã€å®‰è£…ã€éƒ¨ç½² ç®¡ç†ä¾èµ–ï¼šé¡¹ç›®ä¸­éœ€è¦ä½¿ç”¨çš„å…¶ä»–èµ„æº Mavenä¸­çš„æ¦‚å¿µ # æ²¡æœ‰ä½¿ç”¨mavenï¼Œç®¡ç†jarï¼Œæ‰‹åŠ¨å¤„ç†jarï¼Œä»¥åŠjarä¹‹é—´çš„ä¾èµ– mavenæ˜¯apache ã€É™ËˆpÃ¦tÊƒiã€‘åŸºé‡‘ä¼šçš„å¼€æºé¡¹ç›®ï¼Œä½¿ç”¨javaè¯­æ³•å¼€å‘ mavenæ˜¯é¡¹ç›®çš„è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œç®¡ç†é¡¹ç›®ä¾èµ– mavenä¸­çš„æ¦‚å¿µ POM çº¦å®šçš„ç›®å½• åæ ‡ ä¾èµ–ç®¡ç† ä»“åº“ç®¡ç† ç”Ÿå‘½å‘¨æœŸ æ’ä»¶å’Œç›®æ ‡ ç»§æ‰¿ ï¼ˆé«˜çº§å†…å®¹ï¼‰ èšåˆ ï¼ˆé«˜çº§å†…å®¹ï¼‰ Mavenèµ„æºçš„è·å–ä¸å®‰è£…ï¼Œæµ‹è¯• # https://maven.apache.org/index.html\nå„ç§å†…å®¹ è¦æ±‚ è§†é¢‘ç”¨çš„3.6.3 ï¼Œè¿™é‡Œä¸‹è½½3.8.6 ï¼ˆæœ€æ–°çš„ï¼Œä¸è¦å’Œç”µè„‘åŸé…ç½®å†²çªï¼Œæ–¹ä¾¿å­¦ä¹ ï¼Œåç»­æ”¹å›3.8.4ï¼‰\næ£€æŸ¥java home å¦‚æœæ²¡æœ‰éœ€è¦è¿›è¡Œé…ç½® å°†mavençš„binç›®å½•é…ç½®åˆ°pathç¯å¢ƒå˜é‡ä¸‹ï¼ˆè¿™é‡Œä½¿ç”¨çš„æ˜¯ä¸‹ä¸€èŠ‚çš„æ–¹æ³•ï¼Œè§†é¢‘ä¸­æ²¡æœ‰ç”¨MAVEN_HOMEï¼Œè€Œæ˜¯ç›´æ¥å°†mavençš„binç›®å½•è·¯å¾„åŠ åˆ°pathä¸­ï¼‰ mavenè§£å‹åçš„ç›®å½•ç»“æ„ å¦ä¸€ç§å®‰è£…æ–¹å¼ # ç¡®å®šJAVA_HOMEæ˜¯å¦æœ‰æ•ˆ åˆ›å»ºM2_HOME(MAVEN_HOME)ï¼Œå€¼ä¸ºmavençš„å®‰è£…ç›®å½• åœ¨pathç¯å¢ƒä¸­ï¼ŒåŠ å…¥%M2_HOME%\\bin æµ‹è¯•mavenå®‰è£… mvn -v çº¦å®šçš„ç›®å½•ç»“æ„ # å¤§å¤šæ•°äººéµå®ˆçš„ç›®å½•ç»“æ„\nä¸€ä¸ªmavené¡¹ç›®å¯¹åº”ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚Hello\nHello \\src \\main\tå«åšä¸»ç¨‹åºç›®å½•ï¼ˆå®Œæˆé¡¹ç›®åŠŸèƒ½çš„ä»£ç å’Œé…ç½®æ–‡ä»¶ï¼‰ \\java\tæºä»£ç ï¼ˆåŒ…å’Œç›¸å…³çš„ç±»å®šä¹‰ï¼‰ \\resources é…ç½®æ–‡ä»¶ \\test\tæ”¾ç½®æµ‹è¯•ç¨‹åºä»£ç ï¼ˆå¼€å‘äººå‘˜è‡ªå·±å†™çš„æµ‹è¯•ä»£ç ï¼‰ \\java\tæµ‹è¯•ä»£ç ï¼ˆjunitï¼‰ \\resources æµ‹è¯•ç¨‹åºçš„é…ç½®æ–‡ä»¶ \\pom.xml\tmavençš„é…ç½®æ–‡ä»¶ Helloçš„Mavené¡¹ç›® # mavenå¯ä»¥ç‹¬ç«‹ä½¿ç”¨ï¼šåˆ›å»ºé¡¹ç›®ã€ç¼–è¯‘ä»£ç ã€æµ‹è¯•ç¨‹åºã€æ‰“åŒ…ã€éƒ¨ç½²ç­‰\nå’Œideaä¸€èµ·ä½¿ç”¨ï¼Œå®ç°ç¼–ç ã€æµ‹è¯•ã€æ‰“åŒ…\npom.xmlåŸºæœ¬æ¨¡æ¿\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34; ?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;ch01-maven\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;java.version\u0026gt;1.8\u0026lt;/java.version\u0026gt; \u0026lt;maven.compiler.source\u0026gt;1.8\u0026lt;/maven.compiler.source\u0026gt; \u0026lt;maven.compiler.target\u0026gt;1.8\u0026lt;/maven.compiler.target\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;/project\u0026gt; ç›®å½•åˆ›å»º åœ¨mainä¸‹åˆ›å»ºä¸€ä¸ªcom.bjpowernodeçš„åŒ…ï¼Œä»¥åŠä¸€ä¸ªjavaæ–‡ä»¶\npackage com.bjpowernode; public class HelloMaven{ public int addNumber(int n1,int n2){ System.out.println(\u0026#34;hello maven -addNumber\u0026#34;); return n1+n2; } public static void main(String args[]){ HelloMaven hello=new HelloMaven(); int res=hello.addNumber(10,20); System.out.println(\u0026#34;åœ¨mainæ–¹æ³•ä¸­ï¼Œæ‰§è¡Œhelloçš„æ–¹æ³•=\u0026#34;+res); } } åœ¨Helloç›®å½•ä¸‹ï¼Œè¿›è¡Œç¼–è¯‘ ä½¿ç”¨mvn compileè¿›è¡Œç¼–è¯‘ ç¬¬ä¸€æ¬¡ä¼šä¸‹è½½ä¸€äº›ä¸œè¥¿ æŸ¥çœ‹targetæ–‡ä»¶ è¿›å…¥classesæ‰§è¡Œjavaç¨‹åº\njava com.bjpowernode.HelloMaven pom-modelVersion # pom\u0026ndash;Project Object Model é¡¹ç›®å¯¹è±¡æ¨¡å‹\nMavenæŠŠä¸€ä¸ªé¡¹ç›®çš„ç»“æ„å’Œå†…å®¹æŠ½è±¡æˆä¸€ä¸ªæ¨¡å‹ï¼Œåœ¨xmlæ–‡ä»¶ä¸­è¿›è¡Œå£°æ˜ï¼Œä»¥æ–¹ä¾¿è¿›è¡Œæ„å»ºå’Œæè¿°\npomæ–‡ä»¶è§£é‡Š\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34; ?\u0026gt; \u0026lt;!--projectæ˜¯æ ¹æ ‡ç­¾ï¼Œåé¢çš„æ˜¯çº¦æŸæ–‡ä»¶ (maven-v4_0_0.xsd)--\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\u0026#34;\u0026gt; \u0026lt;!--pomæ¨¡å‹ç‰ˆæœ¬,4.0.0--\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;!--åæ ‡--\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;ch01-maven\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;java.version\u0026gt;1.8\u0026lt;/java.version\u0026gt; \u0026lt;maven.compiler.source\u0026gt;1.8\u0026lt;/maven.compiler.source\u0026gt; \u0026lt;maven.compiler.target\u0026gt;1.8\u0026lt;/maven.compiler.target\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;/project\u0026gt; pom-groupIdï¼ŒartifactIdï¼Œversion # åæ ‡ç»„æˆï¼Œgroupid,artifactId,version ä½œç”¨ï¼šèµ„æºçš„å”¯ä¸€æ ‡è¯†ï¼Œmavenä¸­æ¯ä¸ªèµ„æºéƒ½æ˜¯åæ ‡ï¼Œç®€ç§°gav groupIdï¼šç»„ç»‡åç§°ï¼Œä»£ç ã€‚å…¬å¸æˆ–å•ä½æ ‡è¯†ï¼Œå¸¸ä½¿ç”¨å…¬å¸åŸŸåçš„å€’å†™ å¦‚æœè§„æ¨¡å¤§ï¼Œå¯ä»¥æ˜¯ åŸŸåå€’å†™+å¤§é¡¹ç›®åç§° ä¾‹å¦‚ç™¾åº¦æ— äººè½¦é¡¹ç›® ï¼š com.baidu.appollo artifactIdï¼šé¡¹ç›®åç§°ï¼Œå¦‚æœgroupIdä¸­æœ‰é¡¹ç›®ï¼Œæ­¤æ—¶å½“å‰çš„å€¼å°±æ˜¯å­é¡¹ç›®åï¼Œé¡¹ç›®åç§°æ˜¯å”¯ä¸€çš„ versionIdï¼šé¡¹ç›®ç‰ˆæœ¬å·ï¼Œä½¿ç”¨æ•°å­—ï¼Œæ¨èä¸‰ä½ ä¾‹å¦‚ ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.å°ç‰ˆæœ¬å· ä¾‹å¦‚ 5.2.5 å¸¦å¿«ç…§çš„ç‰ˆæœ¬ï¼Œä»¥-SNAPSHOTç»“å°¾ï¼Œå³éç¨³å®šç‰ˆæœ¬ pom-gavä½œç”¨ # æ¯ä¸ªmavené¡¹ç›®éƒ½æœ‰è‡ªå·±çš„gav ç®¡ç†ä¾èµ–ï¼Œä½¿ç”¨å…¶ä»–jaråŒ…ï¼Œä¹Ÿç”¨gavæ ‡è¯† åæ ‡ åæ ‡å€¼çš„è·å– https://mvnrepository.com/ ä¾‹å¦‚mysql pom-ä¾èµ–çš„ä½¿ç”¨ # ä¾èµ–dependency é¡¹ç›®ä¸­ä½¿ç”¨çš„å…¶ä»–èµ„æºï¼ˆjarï¼‰ éœ€è¦ä½¿ç”¨mavenæ¥è¡¨ç¤ºä¾èµ–ã€ç®¡ç†ä¾èµ–ï¼Œé€šè¿‡ä½¿ç”¨dependenciesã€dependencyå’Œgavå®Œæˆä¾èµ–çš„ä½¿ç”¨\n\u0026lt;dependencies\u0026gt; \u0026lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;8.0.29\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;!--mavenä½¿ç”¨gavæ ‡è¯†ï¼Œä»äº’è”ç½‘ä¸‹è½½ä¾èµ–çš„jarï¼Œä¸‹è½½åˆ°æœ¬æœºä¸­ï¼Œç”±mavenç®¡ç†é¡¹ç›®ä½¿ç”¨çš„è¿™äº›jar--\u0026gt; å®Œæ•´\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34; ?\u0026gt; \u0026lt;!--projectæ˜¯æ ¹æ ‡ç­¾ï¼Œåé¢çš„æ˜¯çº¦æŸæ–‡ä»¶ (maven-v4_0_0.xsd)--\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\u0026#34;\u0026gt; \u0026lt;!--pomæ¨¡å‹ç‰ˆæœ¬,4.0.0--\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;!--åæ ‡--\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;ch01-maven\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;java.version\u0026gt;1.8\u0026lt;/java.version\u0026gt; \u0026lt;maven.compiler.source\u0026gt;1.8\u0026lt;/maven.compiler.source\u0026gt; \u0026lt;maven.compiler.target\u0026gt;1.8\u0026lt;/maven.compiler.target\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;8.0.29\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;!--mavenä½¿ç”¨gavæ ‡è¯†ï¼Œä»äº’è”ç½‘ä¸‹è½½ä¾èµ–çš„jarï¼Œä¸‹è½½åˆ°æœ¬æœºä¸­ï¼Œç”±mavenç®¡ç†é¡¹ç›®ä½¿ç”¨çš„è¿™äº›jar--\u0026gt; \u0026lt;!--packaging é¡¹ç›®æ‰“åŒ…ç±»å‹---\u0026gt; \u0026lt;/project\u0026gt; pom-æ‰“åŒ…ç±»å‹ # \u0026lt;packaging\u0026gt; é¡¹ç›®æ‰“åŒ…ç±»å‹\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34; ?\u0026gt; \u0026lt;!--projectæ˜¯æ ¹æ ‡ç­¾ï¼Œåé¢çš„æ˜¯çº¦æŸæ–‡ä»¶ (maven-v4_0_0.xsd)--\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\u0026#34;\u0026gt; \u0026lt;!--pomæ¨¡å‹ç‰ˆæœ¬,4.0.0--\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;!--åæ ‡--\u0026gt; \u0026lt;groupId\u0026gt;com.bjpowernode\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;ch01-maven\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;packaging\u0026gt;jar\u0026lt;/packaging\u0026gt; \u0026lt;/project\u0026gt; å…¶ä»– pom-ç»§æ‰¿å’Œèšåˆ # ç»§æ‰¿ parent èšåˆ modules "},{"id":179,"href":"/zh/docs/study/Linux/hanshunping/52-x/","title":"52-X","section":"éŸ©é¡ºå¹³è€å¸ˆ_","content":" crondå¿«é€Ÿå…¥é—¨ # ä½¿ç”¨å‘½ä»¤ crontab -e åˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡\n*/1 * * * * ls -l /etc/ \u0026gt; /tmp/to.txt ç‰¹æ®Šç¬¦å· ï¼Œä»£è¡¨ä¸è¿ç»­ -ç ´æŠ˜å· è¡¨ç¤ºè¿ç»­ å…¶ä»– å®šæ—¶è°ƒç”¨è„šæœ¬\nç¼–è¾‘è„šæœ¬ my.sh\ndate \u0026gt;\u0026gt; /home/mycal date \u0026gt;\u0026gt; /home/mycal ç»™è„šæœ¬èµ‹äºˆxæƒé™\nchmod u+x my.sh crontab -e\n*/1 * * * * my.sh æ•°æ®åº“å¤‡ä»½ crontab -r åˆ é™¤\ncrontab -l åˆ—å‡º\ncrontab -e ç¼–è¾‘ä»»åŠ¡\natd æ˜¯å¦åœ¨è¿è¡Œ yum install -y atd systemctl start atd\njobé˜Ÿåˆ— até€‰é¡¹ atæŒ‡å®šæ—¶é—´ æ·»åŠ ä»»åŠ¡ at 5pm tomorrow æ˜å¤©ä¸‹åˆ5ç‚¹\nat now + 2 minutes 2åˆ†é’Ÿå\natrm 5 åˆ é™¤5å·\nä¸¤åˆ†é’Ÿåæ‰§è¡ŒæŸä¸ªè„šæœ¬ ç£ç›˜åˆ†åŒº # åˆ†åŒºè·Ÿæ–‡ä»¶ç³»ç»Ÿçš„å…³ç³» (æŒ‚è½½) å°†ä¸€ä¸ªåˆ†åŒºæŒ‚è½½åˆ°æŸä¸ªç›®å½•ï¼Œç”¨æˆ·è¿›å…¥åˆ°æŸä¸ªç›®å½•ï¼Œå°±ç›¸å½“äºè®¿é—®åˆ°æŸä¸ªåˆ†åŒºäº† lsblk linuxåˆ†IDEç¡¬ç›˜å’ŒSCSIç¡¬ç›˜ ç›®å‰åŸºæœ¬æ˜¯SCSIç¡¬ç›˜ sdx~ xä»£è¡¨abcdï¼Œ~è¡¨ç¤ºæ•°å­— lsblk -f æ–‡ä»¶ç±»å‹ï¼Œå”¯ä¸€æ ‡è¯†ç¬¦ ç°åœ¨æŒ‚è½½ä¸€ä¸ªåˆ†åŒº å¦‚å›¾ ç»™è™šæ‹Ÿæœºï¼Œæ·»åŠ ä¸€ä¸ªç¡¬ç›˜ é‡å¯åï¼Œä½¿ç”¨lsblk è¿›è¡Œåˆ†åŒº fdisk /dev/sdb ä¹‹åè¾“å…¥pï¼Œ è¾“å…¥åˆ†åŒºæ•°ï¼ˆè¿™é‡Œæ˜¯1ï¼‰ æœ€åä¸€æ­¥ï¼Œè¾“å…¥w ï¼Œå†™å…¥åˆ†åŒºå¹¶é€€å‡º æŸ¥çœ‹ å°†åˆ†åŒºæ ¼å¼åŒ– mkfs -t ext4 /dev/sdb1 æŸ¥çœ‹ è¿›è¡ŒæŒ‚è½½ mount /dev/sdb1 /newdisk/ umount /dev/sdb1 å¸è½½ ç”¨å‘½ä»¤è¡ŒæŒ‚è½½çš„æŒ‡ä»¤ï¼Œé‡å¯åæŒ‚è½½å…³ç³»ä¼šæ¶ˆå¤± æ°¸ä¹…æŒ‚è½½ï¼šä¿®æ”¹/etc/fstab # df -h æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ du -h \u0026ndash;max-depth=1 /opt ls -l /opt | grep \u0026ldquo;^-\u0026rdquo; | wc -l ä½¿ç”¨æ­£åˆ™ï¼Œå¹¶ç»Ÿè®¡æ•°é‡ ls -lR /opt æ³¨æ„ï¼Œè¿™é‡ŒåŠ äº†Rï¼Œå°†é€’å½’æ˜¾ç¤º ä½¿ç”¨yum install -y tree ç½‘ç»œé…ç½® # ifconfig æŸ¥çœ‹ip\nç½‘ç»œçš„äº’é€š è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨ ä½¿ç”¨pingåˆ¤æ–­ä¸»æœºé—´æ˜¯å¦äº’é€š\nvi /etc/sysconfig/network-scripts/ifcfg-ens33 ç¼–è¾‘ip\nTYPE=\u0026#34;Ethernet\u0026#34; PROXY_METHOD=\u0026#34;none\u0026#34; BROWSER_ONLY=\u0026#34;no\u0026#34; DEFROUTE=\u0026#34;yes\u0026#34; IPV4_FAILURE_FATAL=\u0026#34;no\u0026#34; IPV6INIT=\u0026#34;yes\u0026#34; IPV6_AUTOCONF=\u0026#34;yes\u0026#34; IPV6_DEFROUTE=\u0026#34;yes\u0026#34; IPV6_FAILURE_FATAL=\u0026#34;no\u0026#34; IPV6_ADDR_GEN_MODE=\u0026#34;stable-privacy\u0026#34; NAME=\u0026#34;ens33\u0026#34; UUID=\u0026#34;8c2741af-382a-44a6-b161-aed16a29875d\u0026#34; DEVICE=\u0026#34;ens33\u0026#34; BOOTPROTO=\u0026#34;static\u0026#34; ONBOOT=\u0026#34;yes\u0026#34; IPADDR=192.168.200.160 GATEWAY=192.168.200.2 DNS1=192.168.200.2 æ³¨æ„æœ€åäº”è¡Œ ä¿®æ”¹hostname vim /etc/hostname\nè¿›ç¨‹ # æ¯ä¸€ä¸ªæ‰§è¡Œçš„ç¨‹åºè¢«ç§°ä¸ºä¸€ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½åˆ†é…ä¸€ä¸ªIDå·- æ¯ä¸ªè¿›ç¨‹éƒ½å¯ä»¥ä»¥å‰å°/åå°æ–¹å¼è¿è¡Œ ä¸€åŠç³»ç»ŸæœåŠ¡ä»¥åå°è¿›ç¨‹æ–¹å¼å­˜åœ¨çš„ ä½¿ç”¨psæ˜¾ç¤ºè¿›ç¨‹ ps -aux ä¸€äº›å‚æ•°è§£é‡Š ä½¿ç”¨grepè¿‡æ»¤ è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ ps -ef ç”±systemdç”Ÿæˆå¯åŠ¨å…¶ä»–è¿›ç¨‹ å­è¿›ç¨‹ä¹‹é—´å…³ç³» è¿›ç¨‹çš„ç»ˆæ­¢ kill / killall killall å°†å­è¿›ç¨‹ä¸€èµ·æ€æ­» kill -9 å¼ºåˆ¶ç»ˆæ­¢ å¦‚æœæŠŠsshdæ€æ­»ï¼Œé‚£å°±å†ä¹Ÿè¿ä¸ä¸Šäº† é‡æ–°å¯åŠ¨sshd /bin/systemctl start sshd.service yum -y install psmisc pstree -u å¸¦ä¸Šç”¨æˆ· pstree -p å¸¦ä¸Šè¿›ç¨‹å· æœåŠ¡ç®¡ç† # æœåŠ¡ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯è¿›ç¨‹ service æœåŠ¡å start|stop|restart|reload|status centos7.0ä¹‹åï¼Œä¸»è¦ç”¨systemctl è¿˜ä½¿ç”¨serviceçš„å‘½ä»¤ ç½‘ç»œè¿æ¥æŸ¥çœ‹ æœåŠ¡çš„è¿è¡Œçº§åˆ« systemctl set-default graphical.target //é»˜è®¤è¿›å…¥å›¾å½¢åŒ–ç•Œé¢ rpmç®¡ç† # è½¯ä»¶åŒ…ç®¡ç† # "},{"id":180,"href":"/zh/docs/study/Linux/hanshunping/40-51/","title":"linux_éŸ©è€å¸ˆ_40-51","section":"éŸ©é¡ºå¹³è€å¸ˆ_","content":" ç»„ä»‹ç» # æ¯ä¸ªç”¨æˆ·å¿…å®šå±äºæŸä¸ªç»„ æ¯ä¸ªæ–‡ä»¶æœ‰å‡ ä¸ªæ¦‚å¿µï¼šæ‰€æœ‰è€…ã€æ‰€åœ¨ç»„ã€å…¶ä»–ç»„ tomåˆ›å»ºäº†hello.txtï¼Œåˆ™æ‰€æœ‰è€…ä¸ºtomï¼Œé»˜è®¤æ‰€åœ¨ç»„ä¸ºtomç»„ é™¤äº†æ‰€åœ¨ç»„ï¼Œå°±æ˜¯å…¶ä»–ç»„ ls -ahl ï¼ˆhæ›´å‹å¥½ï¼Œaéšè—ï¼Œlåˆ—è¡¨ï¼‰ æ‰€æœ‰è€… # ä½¿ç”¨chown root helo.java ä¿®æ”¹ï¼Œæ•ˆæœå¦‚ä¸‹ æ‰€åœ¨ç»„ä¿®æ”¹ # ç»„çš„åˆ›å»º groupadd monster åˆ›å»ºä¸€ä¸ªç”¨æˆ·å¹¶è®©ä»–å±äºè¯¥ç»„ useradd -g monster fox æ³¨æ„é€»è¾‘ï¼Œæ­¤æ—¶ä½¿ç”¨foxåˆ›å»ºæ–‡ä»¶ passwd fox ç»™foxåˆ›å»ºå¯†ç  å¦‚å›¾ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ ä½¿ç”¨chgrp fruit orange.txt ä¿®æ”¹æ–‡ä»¶çš„æ‰€åœ¨ç»„ æ”¹å˜æŸä¸ªç”¨æˆ·æ‰€åœ¨ç»„ usermod -g fruit fox ä½¿ç”¨ cat /etc/group æŸ¥çœ‹æ‰€æœ‰çš„ç»„ å½“ä¸€ä¸ªç”¨æˆ·å±äºå¤šä¸ªç»„çš„æ—¶å€™ï¼Œgroupsä¼šå‡ºç°å¤šä¸ªç»„å rwxæƒé™ # rwxrwxrwx ç¬¬ä¸€åˆ—æœ‰åä½ï¼Œç¬¬0ä½ç¡®è®¤æ–‡ä»¶ç±»å‹ -æ™®é€šæ–‡ä»¶ï¼Œlæ˜¯é“¾æ¥ï¼›dæ˜¯ç›®å½•ï¼›cæ˜¯å­—ç¬¦è®¾å¤‡æ–‡ä»¶ã€é¼ æ ‡ã€é”®ç›˜ï¼›bå—è®¾å¤‡ 1-3è¡¨ç¤ºæ–‡ä»¶æ‰€æœ‰è€…æ‹¥æœ‰çš„æƒé™ï¼›4-6æ˜¯æ–‡ä»¶æ‰€åœ¨ç»„æ‰€æ‹¥æœ‰çš„æƒé™ï¼Œ7-9 å…¶ä»–ç»„æ‰€æ‹¥æœ‰çš„æƒé™\nrwxä½œç”¨åˆ°æ–‡ä»¶ï¼Œrä»£è¡¨å¯è¯»å¯æŸ¥çœ‹ï¼Œwä»£è¡¨å¯ä¿®æ”¹ï¼ˆå¦‚æœæ˜¯åˆ é™¤æƒé™ï¼Œåˆ™å¿…é¡»åœ¨è¯¥æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•æœ‰å†™æƒé™ï¼Œæ‰èƒ½åˆ é™¤ï¼‰ï¼Œxä»£è¡¨å¯æ‰§è¡Œ rwxä½œç”¨åˆ°ç›®å½•ï¼Œrè¡¨ç¤ºå¯ä»¥è¯»å–(lså¯æŸ¥çœ‹ç›®å½•å†…å®¹)ï¼Œwè¡¨ç¤ºå¯å†™ï¼ˆå¯ä»¥åœ¨ç›®å½•å†…åˆ›å»ºã€åˆ é™¤ã€é‡å‘½åç›®å½•ï¼‰ï¼Œxè¡¨ç¤ºå¯ä»¥è¿›å…¥è¯¥ç›®å½• rwxåˆ†åˆ«ç”¨æ•°å­—è¡¨ç¤ºï¼Œ4ï¼Œ2ï¼Œ1ã€‚å½“æ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œåˆ™ä¸º7 æœ€åé¢çš„æ•°å­—ï¼Œä»£è¡¨è¿æ¥æ•°ï¼ˆæˆ–è€…å­ç›®å½•æ•°ï¼‰ 1213 æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ï¼Œå¦‚æœæ˜¯æ–‡ä»¶å¤¹åˆ™æ˜¾ç¤º4096 æœ€åabcè¡¨ç¤ºæ–‡ä»¶åï¼Œè“è‰²è¡¨ç¤ºæ˜¯ç›®å½• ä¿®æ”¹æƒé™ # chmod ä¿®æ”¹æƒé™ï¼Œuï¼šæ‰€æœ‰è€…ï¼Œgï¼šæ‰€æœ‰ç»„ï¼Œoï¼šå…¶ä»–äººï¼Œa æ‰€æœ‰ï¼ˆugoæ€»å’Œï¼‰ chmod u=rwx,g=rw,o=x æ–‡ä»¶/ç›®å½•å è¿™é‡Œç­‰å·è¡¨ç¤ºç›´æ¥ç»™æƒé™ chmod o+w æ–‡ä»¶/ç›®å½•å è¿™é‡ŒåŠ è¡¨ç¤º+æƒé™ chmod a-x æ–‡ä»¶/ç›®å½•å chmod u=rwx,g=rx,o=rx abc ç»™æ–‡ä»¶æ·»åŠ æ‰§è¡Œæƒé™ï¼ˆä¼šå˜æˆç»¿è‰²çš„ï¼‰ ä½¿ç”¨æ•°å­— å°†abc.txtæ–‡ä»¶æƒé™ä¿®æ”¹æˆrwxr-xr-xä½¿ç”¨æ•°å­—å®ç° chmod 755 abc ä¿®æ”¹æ‰€æœ‰è€…å’Œæ‰€åœ¨ç»„ # chown tom abc #ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…ä¸ºtom chown -R tom abc #ä¿®æ”¹æ–‡ä»¶å¤¹åŠå…¶æ‰€æœ‰å­ç›®å½•æ‰€æœ‰è€…ä¸ºtom chgrp -R fruit kkk #ä¿®æ”¹æ–‡ä»¶å¤¹æ‰€åœ¨ç»„ä¸ºfruit æƒé™ç®¡ç†åº”ç”¨å®ä¾‹ # è­¦å¯Ÿå’ŒåœŸåŒªçš„æ¸¸æˆ\nå‰æï¼Œæœ‰policeå’Œbanditä¸¤ä¸ªç»„ï¼Œ\njackï¼Œjerryå±äºè­¦å¯Ÿç»„\nxhï¼Œxqå±äºåœŸåŒªç»„\ngroupadd police groupadd bandit useradd -g police jack useradd -g police jerry useradd -g bandit xh useradd -g bandit xq chmod 640 jack.txt\nchmod o=r,g=rw jack.txt\nå¦‚æœè¦å¯¹ç›®å½•å†…æ“ä½œï¼Œé‚£ä¹ˆå…ˆæœ‰æ”¹ç›®å½•ç›¸åº”æƒé™\nchmod 770 jack æ”¾å¼€jackç›®å½•æƒé™ é¢˜ç›® å¯¹ä¸€ä¸ªç›®å½•ä¸èƒ½ls(æ²¡æœ‰è¯»æƒé™)ï¼Œä½†æ˜¯æ˜¯å¯ä»¥ç›´æ¥è¯»å†™ç›®å½•ä¸­çš„æ–‡ä»¶çš„ï¼ˆæœ‰æƒé™çš„æƒ…å†µä¸‹ï¼‰\n# "},{"id":181,"href":"/zh/docs/study/MySQL/bl_sgg/96-00/","title":"mysqlé«˜é˜¶_sgg 96-00","section":"è¿›é˜¶(å°šç¡…è°·)_","content":" ç« èŠ‚æ¦‚è¿° # æ¶æ„ç¯‡\n1-3 4 5 6 ç´¢å¼•åŠè°ƒä¼˜ç¯‡\n01 02-03\n04-05\n06 äº‹åŠ¡ç¯‡\n01-02 03 04 æ—¥å¿—ä¸å¤‡ä»½ç¯‡\n01 02 03 CentOSç¯å¢ƒå‡†å¤‡ # è¿™é‡Œä¸»è¦æ˜¯åšäº†å…‹éš†ï¼Œå¹¶æ²¡æœ‰è®²åˆ°CentOSçš„å®‰è£…ï¼Œæ‰€ä»¥ç¬”è®°ä¸è®°å½•äº† MySQLçš„å¸è½½ # æŸ¥æ‰¾å½“å‰ç³»ç»Ÿå·²ç»è£…äº†å“ªäº› rpm -qa |grep mysql\næŸ¥æ‰¾mysqlæœåŠ¡è¿è¡ŒçŠ¶æ€ systemctl status mysql\nåœæ­¢mysqlæœåŠ¡ systemctl stop mysql\nåˆ é™¤\nyum remove mysql-community-client-plugins-8.0.29-1.el7.x86_64 yum remove mysql-community-common-8.0.29-1.el7.x86_64 æŸ¥æ‰¾å¸¦mysqlåå­—çš„æ–‡ä»¶å¤¹ find / -name mysql\nè¿›è¡Œåˆ é™¤\nrm -rf /usr/lib64/mysql rm -rf /usr/share/mysql rm -rf /etc/selinux/targeted/active/modules/100/mysql rm -rf /etc/my.cnf Linuxä¸‹å®‰è£…MySQL8.0ä¸5.7ç‰ˆæœ¬ # ç‰ˆæœ¬ä»‹ç» ä¸‹è½½åœ°å€ : https://www.mysql.com/downloads/ è¿›å…¥ å³ https://dev.mysql.com/downloads/mysql/ ç‰ˆæœ¬é€‰æ‹© ä¸‹è½½æœ€å¤§çš„é‚£ä¸ªï¼Œç¦»çº¿ç‰ˆ ä¸‹è½½åè§£å‹ï¼Œå¹¶å°†ä¸‹é¢å…­ä¸ªæ”¾è¿›linuxä¸­\nå¦‚æœæ˜¯5.7ï¼Œåˆ™éœ€è¦è¿›å…¥ https://downloads.mysql.com/archives/community/\nä¸‹è½½åè§£å‹ æ‹·è´è¿›linux å®‰è£…å‰ï¼Œç»™/tmpä¸´æ—¶ç›®å½•æƒé™\nchmod -R 777 /tmp\næ£€æŸ¥ä¾èµ–\nrpm -qa |grep libaio ##libaio-0.3.109-13.el7.x86_64 rpm -qa |grep net-tools ##net-tools-2.0-0.24.20131004git.el7.x86_64 ç¡®ä¿ç›®å½•ä¸‹å·²ç»å­˜åœ¨5ï¼ˆ4ï¼‰ä¸ªæ–‡ä»¶å¹¶ä¸¥æ ¼æŒ‰é¡ºåºæ‰§è¡Œ\nrpm -ivh mysql-community-common-8.0.29-1.el7.x86_64.rpm rpm -ivh mysql-community-client-plugins-8.0.29-1.el7.x86_64.rpm rpm -ivh mysql-community-libs-8.0.29-1.el7.x86_64.rpm rpm -ivh mysql-community-client-8.0.29-1.el7.x86_64.rpm rpm -ivh mysql-community-icu-data-files-8.0.29-1.el7.x86_64.rpm rpm -ivh mysql-community-server-8.0.29-1.el7.x86_64.rpm å®‰è£…libsçš„æ—¶å€™ï¼Œä¼šæŠ¥é”™\nerror: Failed dependencies: mariadb-libs is obsoleted by mysql-community-libs-8.0.29-1.el7.x86_64 ä½¿ç”¨ä¸‹é¢å‘½ä»¤ï¼Œè§†é¢‘çš„æ–¹æ³•\nyum remove mysql-libs ä½¿ç”¨ä¸‹é¢å‘½ä»¤ï¼Œå¸è½½mariadb (è¿™æ˜¯æˆ‘è‡ªå·±çš„æ–¹æ³•)\nrpm -qa | grep mariadb\næŸ¥æ‰¾åˆ°å¯¹åº”çš„ç‰ˆæœ¬ mariadb-libs-5.5.60-1.el7_5.x86_64 # ä¸‹é¢å¸è½½æŸ¥æ‰¾å‡ºæ¥çš„ç‰ˆæœ¬ # yum remove mariadb-libs-5.5.60-1.el7_5.x86_64 # å†æ¬¡æ‰§è¡Œåå®‰è£…æˆåŠŸ\næœåŠ¡åˆå§‹åŒ– mysqld --initialize --user=mysql\næŸ¥çœ‹é»˜è®¤ç”Ÿæˆçš„å¯†ç  cat /var/log/mysqld.log åˆ¤æ–­mysqlæ˜¯å¦å¯åŠ¨ systemctl status mysqld\nå¯åŠ¨æœåŠ¡systemctl start mysqld å†æ¬¡åˆ¤æ–­ï¼Œå‘ç°å·²ç»å¯åŠ¨ è®¾ç½®ä¸ºè‡ªåŠ¨å¯åŠ¨\næŸ¥çœ‹å½“å‰æ˜¯å¦å¼€æœºè‡ªå¯åŠ¨ systemctl list-unit-files|grep mysqld.service å¦‚æœæ˜¯disableï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤å¼€æœºè‡ªå¯åŠ¨ systemctl enable mysqld.service è¿›è¡Œç™»å½•\nmysql -u root -p ç”¨åˆšæ‰çš„å¯†ç \nä½¿ç”¨æŸ¥è¯¢ï¼Œæç¤ºéœ€è¦é‡ç½®å¯†ç  å¯†ç æ›´æ–°\nalter user \u0026#39;root\u0026#39;@\u0026#39;localhost\u0026#39; identified by \u0026#39;123456\u0026#39;; quit # é€€å‡ºé‡æ–°ç™»å½• 5.7çš„å®‰è£… èµ‹äºˆæƒé™å¹¶æ£€æŸ¥åŒ…ï¼Œè¿™é‡Œå‘ç°ç¼ºå°‘äº†libaioï¼Œæ‰€ä»¥yum install libaio\nSQLyogå®ç°MySQL8.0å’Œ5.7çš„è¿œç¨‹è¿æ¥ # sqlyogä¸‹è½½ https://github.com/webyog/sqlyog-community/wiki/Downloads\né»˜è®¤æƒ…å†µä¸‹ä¼šæœ‰è¿æ¥å‡ºé”™ å…ˆæµ‹è¯•ipåŠç«¯å£å· æ­¤æ—¶linuxç«¯å£å·å¹¶æ²¡æœ‰å¼€æ”¾ ä½¿ç”¨systemctl status firewalldå‘ç°é˜²ç«å¢™å¼€å¯ ï¼ˆactive) ä½¿ç”¨systemctl stop firewalldå°†é˜²ç«å¢™å…³é—­ å¼€æœºæ—¶å…³é—­é˜²ç«å¢™systemctl disable firewalld æ­¤æ—¶è¿˜æ˜¯æŠ¥é”™ è¿™æ˜¯ç”±äºrootä¸å…è®¸è¢«è¿œç¨‹è¿æ¥\næŸ¥çœ‹userè¡¨ï¼Œå‘ç°åªå…è®¸æœ¬åœ°ç™»å½• ä¿®æ”¹å¹¶æ›´æ–°æƒé™\nupdate user set host = \u0026#39;192.168.1.%\u0026#39; where user= \u0026#39;root\u0026#39;; #æˆ–è€… update user set host = \u0026#39;%\u0026#39; where user= \u0026#39;root\u0026#39;; #æ›´æ–°æƒé™ flush privileges; ä¹‹åå¦‚æœå‡ºç°ä¸‹é¢çš„é—®é¢˜ï¼ˆè§†é¢‘ä¸­æœ‰ï¼Œæˆ‘æ²¡é‡åˆ°ï¼‰ ALTER USER \u0026#39;root\u0026#39;@\u0026#39;%\u0026#39; IDENTIFIED WITH mysql_native_password BY \u0026#39;123456\u0026#39;; ç„¶åå°±å¯ä»¥è¿æ¥äº† å‘½ä»¤è¡Œè¿›è¡Œè¿œç¨‹è¿æ¥ mysql -u root -h 192.168.200.150 -P3306 -p\nå­—ç¬¦é›†çš„ä¿®æ”¹ä¸åº•å±‚åŸç†è¯´æ˜ # æ¯”è¾ƒè§„åˆ™_è¯·æ±‚åˆ°å“åº”è¿‡ç¨‹ä¸­çš„ç¼–ç ä¸è§£ç è¿‡ç¨‹ # SQLå¤§å°å†™è§„èŒƒä¸sql_modelçš„è®¾ç½® # "},{"id":182,"href":"/zh/docs/study/Algorithm/algorithhms_4th/3.2.1/","title":"ç®—æ³•çº¢çš®ä¹¦ 3.2.1","section":"_ç®—æ³•(ç¬¬å››ç‰ˆ)_","content":" äºŒå‰æŸ¥æ‰¾æ ‘ # ä½¿ç”¨æ¯ä¸ªç»“ç‚¹å«æœ‰ä¸¤ä¸ªé“¾æ¥ï¼ˆé“¾è¡¨ä¸­æ¯ä¸ªç»“ç‚¹åªå«æœ‰ä¸€ä¸ªé“¾æ¥ï¼‰çš„äºŒå‰æŸ¥æ‰¾æ ‘æ¥é«˜æ•ˆåœ°å®ç°ç¬¦å·è¡¨\nè¯¥æ•°æ®ç»“æ„ç”±ç»“ç‚¹ç»„æˆï¼Œç»“ç‚¹åŒ…å«çš„é“¾æ¥å¯ä»¥ä¸ºç©º(null)æˆ–è€…æŒ‡å‘å…¶ä»–ç»“ç‚¹\nä¸€æ£µäºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBSTï¼‰æ˜¯ä¸€æ£µäºŒå‰æ ‘ï¼Œå…¶ä¸­æ¯ä¸ªç»“ç‚¹éƒ½å«æœ‰ä¸€ä¸ªComparable çš„é”®ï¼ˆä»¥ åŠç›¸å…³è”çš„å€¼ï¼‰ä¸”æ¯ä¸ªç»“ç‚¹çš„é”®éƒ½å¤§äºå…¶å·¦å­æ ‘ä¸­çš„ä»»æ„ç»“ç‚¹çš„é”®è€Œå°äºå³å­æ ‘çš„ä»»æ„ç»“ç‚¹çš„é”®ã€‚\nåŸºæœ¬å®ç° # æ•°æ®è¡¨ç¤º\næ¯ä¸ªç»“ç‚¹éƒ½å«æœ‰ä¸€ä¸ªé”®ã€ä¸€ä¸ªå€¼ã€ä¸€æ¡å·¦é“¾æ¥ã€ä¸€æ¡å³é“¾æ¥å’Œä¸€ä¸ªç»“ç‚¹è®¡æ•°å™¨ å·¦é“¾æ¥æŒ‡å‘ä¸€æ£µç”±å°äºè¯¥ç»“ç‚¹çš„æ‰€æœ‰é”®ç»„æˆçš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå³é“¾æ¥æŒ‡å‘ä¸€æ£µç”±å¤§äºè¯¥èŠ‚ç‚¹çš„æ‰€æœ‰é”®ç»„æˆçš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå˜é‡Nç»™å‡ºäº†ä»¥è¯¥ç»“ç‚¹ä¸ºæ ¹çš„å­æ ‘çš„ç»“ç‚¹æ€»æ•° å¯¹äºä»»æ„èŠ‚ç‚¹æ€»æ˜¯æˆç«‹ size(x)=size(x.left)+size(x.right)+1 å¤šæ£µäºŒå‰æŸ¥æ‰¾æ ‘è¡¨ç¤ºåŒä¸€ç»„æœ‰åºçš„é”®æ¥å®ç°æ„å»ºå’Œä½¿ç”¨äºŒå‰æŸ¥æ‰¾æ ‘çš„é«˜æ ¡ç®—æ³• æŸ¥æ‰¾\nåœ¨ç¬¦å·è¡¨ä¸­æŸ¥æ‰¾ä¸€ä¸ªé”®å¯èƒ½å¾—åˆ°ä¸¤ç§ç»“æœï¼šå¦‚æœå«æœ‰è¯¥é”®çš„ç»“ç‚¹å­˜åœ¨è¡¨ä¸­ï¼Œæˆ‘ä»¬çš„æŸ¥æ‰¾å°±å‘½ä¸­äº†ï¼Œç„¶åè¿”å›å€¼ï¼›å¦åˆ™æŸ¥æ‰¾æœªå‘½ä¸­ï¼ˆè¿”å›null) é€’å½’ï¼šå¦‚æœæ ‘æ˜¯ç©ºçš„ï¼Œåˆ™æŸ¥æ‰¾æœªå‘½ä¸­ï¼›å¦‚æœè¢«æŸ¥æ‰¾çš„é”®å’Œæ ¹èŠ‚ç‚¹çš„é”®ç›¸ç­‰ï¼ŒæŸ¥æ‰¾å‘½ä¸­ï¼Œå¦åˆ™åœ¨é€‚å½“çš„å­æ ‘ä¸­æŸ¥æ‰¾ï¼šå¦‚æœè¢«æŸ¥æ‰¾çš„é”®è¾ƒå°å°±é€‰æ‹©å·¦å­æ ‘ï¼Œå¦åˆ™é€‰æ‹©å³å­æ ‘ ä¸‹é¢çš„get()æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªç»“ç‚¹ï¼ˆå­æ ‘æ ¹èŠ‚ç‚¹ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¢«æŸ¥æ‰¾çš„é”®ï¼Œä»£ç ä¼šä¿è¯åªæœ‰è¯¥ç»“ç‚¹æ‰€è¡¨ç¤ºçš„å­æ ‘æ‰ä¼šå«æœ‰å’Œè¢«æŸ¥æ‰¾çš„é”®ç›¸ç­‰çš„ç»“ç‚¹ ä»æ ¹ç»“ç‚¹å¼€å§‹ï¼Œåœ¨æ¯ä¸ªç»“ç‚¹ä¸­æŸ¥æ‰¾çš„è¿›ç¨‹éƒ½ä¼šé€’å½’åœ°åœ¨å®ƒçš„ä¸€ä¸ªå­ç»“ç‚¹ä¸Šå±•å¼€ï¼Œå› æ­¤ä¸€æ¬¡æŸ¥æ‰¾ä¹Ÿå°±å®šä¹‰äº†æ ‘çš„ä¸€æ¡è·¯å¾„ã€‚å¯¹äºå‘½ä¸­çš„æŸ¥æ‰¾ï¼Œè·¯å¾„åœ¨å«æœ‰è¢«æŸ¥æ‰¾çš„é”®çš„ç»“ç‚¹å¤„ç»“æŸã€‚å¯¹äºæœªå‘½ä¸­çš„æŸ¥æ‰¾ï¼Œè·¯å¾„çš„ç»ˆç‚¹æ˜¯ä¸€ä¸ªç©ºé“¾æ¥ åŸºäºäºŒå‰æŸ¥æ‰¾æ ‘çš„ç¬¦å·è¡¨\npublic class BST\u0026lt;Key extends Comparable\u0026lt;Key\u0026gt;, Value\u0026gt; { private Node root; // äºŒå‰æŸ¥æ‰¾æ ‘çš„æ ¹ç»“ç‚¹ private class Node { private Key key; // é”® private Value val; // å€¼ private Node left, right; // æŒ‡å‘å­æ ‘çš„é“¾æ¥ private int N; // ä»¥è¯¥ç»“ç‚¹ä¸ºæ ¹çš„å­æ ‘ä¸­çš„ç»“ç‚¹æ€»æ•° public Node(Key key, Value val, int N) { this.key = key; this.val = val; this.N = N; } } public int size() { return size(root); } private int size(Node x) { if (x == null) return 0; else return x.N; } public Value get(Key key) // è¯·è§ç®—æ³•3.3ï¼ˆç»­1ï¼‰ public void put(Key key, Value val) // è¯·è§ç®—æ³•3.3ï¼ˆç»­1ï¼‰ // max()ã€min()ã€floor()ã€ceiling()æ–¹æ³•è¯·è§ç®—æ³•3.3ï¼ˆç»­2ï¼‰ // select()ã€rank()æ–¹æ³•è¯·è§ç®—æ³•3.3ï¼ˆç»­3ï¼‰ // delete()ã€deleteMin()ã€deleteMax()æ–¹æ³•è¯·è§ç®—æ³•3.3ï¼ˆç»­4ï¼‰ // keys()æ–¹æ³•è¯·è§ç®—æ³•3.3ï¼ˆç»­5ï¼‰ } æ¯ä¸ªNode å¯¹è±¡éƒ½æ˜¯ä¸€æ£µå«æœ‰N ä¸ªç»“ç‚¹çš„å­æ ‘çš„æ ¹ç»“ç‚¹ï¼Œå®ƒçš„å·¦é“¾æ¥æŒ‡å‘ä¸€æ£µç”±å°äºè¯¥ç»“ç‚¹çš„æ‰€æœ‰é”®ç»„æˆçš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå³é“¾æ¥æŒ‡å‘ä¸€æ£µç”±å¤§äºè¯¥ç»“ç‚¹çš„æ‰€æœ‰é”®ç»„æˆçš„äºŒå‰æŸ¥æ‰¾ æ ‘ã€‚root å˜é‡æŒ‡å‘äºŒå‰æŸ¥æ‰¾æ ‘çš„æ ¹ç»“ç‚¹Node å¯¹è±¡ï¼ˆè¿™æ£µæ ‘åŒ…å«äº†ç¬¦å·è¡¨ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹ï¼‰ äºŒå‰æŸ¥æ‰¾æ ‘çš„æŸ¥æ‰¾å’Œæ’åºæ–¹æ³•çš„å®ç°\npublic Value get(Key key) { return get(root, key); } private Value get(Node x, Key key) { // åœ¨ä»¥xä¸ºæ ¹ç»“ç‚¹çš„å­æ ‘ä¸­æŸ¥æ‰¾å¹¶è¿”å›keyæ‰€å¯¹åº”çš„å€¼ï¼› // å¦‚æœæ‰¾ä¸åˆ°åˆ™è¿”å›null if (x == null) return null; int cmp = key.compareTo(x.key); if (cmp \u0026lt; 0) return get(x.left, key); else if (cmp \u0026gt; 0) return get(x.right, key); else return x.val; } public void put(Key key, Value val) { // æŸ¥æ‰¾keyï¼Œæ‰¾åˆ°åˆ™æ›´æ–°å®ƒçš„å€¼ï¼Œå¦åˆ™ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªæ–°çš„ç»“ç‚¹ root = put(root, key, val); } private Node put(Node x, Key key, Value val) { // å¦‚æœkeyå­˜åœ¨äºä»¥xä¸ºæ ¹ç»“ç‚¹çš„å­æ ‘ä¸­åˆ™æ›´æ–°å®ƒçš„å€¼ï¼› // å¦åˆ™å°†ä»¥keyå’Œvalä¸ºé”®å€¼å¯¹çš„æ–°ç»“ç‚¹æ’å…¥åˆ°è¯¥å­æ ‘ä¸­ if (x == null) return new Node(key, val, 1); int cmp = key.compareTo(x.key); //æ³¨æ„ï¼Œè¿™é‡Œè¿›è¡Œæ¯”è¾ƒåï¼Œç¡®è®¤æ–°èŠ‚ç‚¹åº”è¯¥æ”¾åœ¨å½“å‰èŠ‚ç‚¹çš„å·¦è¾¹è¿˜æ˜¯å³è¾¹ if (cmp \u0026lt; 0) x.left = put(x.left, key, val); else if (cmp \u0026gt; 0) x.right = put(x.right, key, val); else x.val = val; x.N = size(x.left) + size(x.right) + 1; return x; } æ’å…¥ put()æ–¹æ³•çš„å®ç°é€»è¾‘å’Œé€’å½’æŸ¥æ‰¾å¾ˆç›¸ä¼¼ï¼šå¦‚æœæ ‘æ˜¯ç©ºçš„ï¼Œå°±è¿”å›ä¸€ä¸ªå«æœ‰è¯¥é”®å€¼å¯¹çš„æ–°èŠ‚ç‚¹ï¼›å¦‚æœè¢«æŸ¥æ‰¾çš„é”®å°äºæ ¹èŠ‚ç‚¹çš„é”®ï¼Œæˆ‘ä»¬å°±ä¼šç»§ç»­åœ¨å·¦å­æ ‘ä¸­æ’å…¥è¯¥é”®ï¼Œå¦åˆ™åœ¨å³å­æ ‘ä¸­æ’å…¥è¯¥é”®\né€’å½’\nå¯ä»¥å°†é€’å½’è°ƒç”¨å‰çš„ä»£ç æƒ³è±¡æˆæ²¿ç€æ ‘å‘ä¸‹èµ°ï¼šå®ƒä¼šå°†ç»™å®šçš„é”®å’Œæ¯ä¸ªç»“ç‚¹çš„é”®ç›¸æ¯”è¾ƒå¹¶æ ¹æ®ç»“æœå‘å·¦æˆ–è€…å‘å³ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªç»“ç‚¹ã€‚ç„¶åå¯ä»¥å°†é€’å½’è°ƒç”¨åçš„ä»£ç æƒ³è±¡æˆæ²¿ç€æ ‘å‘ä¸Šçˆ¬ åœ¨ä¸€æ£µç®€å•çš„äºŒå‰æŸ¥æ‰¾æ ‘ä¸­ï¼Œå”¯ä¸€çš„æ–°é“¾æ¥å°±æ˜¯åœ¨æœ€åº•å±‚æŒ‡å‘æ–°ç»“ç‚¹çš„é“¾æ¥ï¼Œé‡ç½®æ›´ä¸Šå±‚çš„é“¾æ¥å¯ä»¥é€šè¿‡æ¯”è¾ƒè¯­å¥æ¥é¿å…ã€‚åŒæ ·ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è·¯å¾„ä¸Šæ¯ä¸ªç»“ç‚¹ä¸­çš„è®¡æ•°å™¨çš„å€¼åŠ 1ï¼Œä½†æˆ‘ä»¬ä½¿ç”¨äº†æ›´åŠ é€šç”¨çš„ä»£ç ï¼Œä½¿ä¹‹ç­‰äºç»“ç‚¹çš„æ‰€æœ‰å­ç»“ç‚¹çš„è®¡æ•°å™¨ä¹‹å’ŒåŠ 1 ä½¿ç”¨äºŒå‰æŸ¥æ‰¾æ ‘çš„æ ‡å‡†ç´¢å¼•ç”¨ä¾‹çš„è½¨è¿¹ åˆ†æ # åœ¨ç”±N ä¸ªéšæœºé”®æ„é€ çš„äºŒå‰æŸ¥æ‰¾æ ‘ä¸­ï¼ŒæŸ¥æ‰¾å‘½ä¸­å¹³å‡æ‰€éœ€çš„æ¯”è¾ƒæ¬¡æ•°ä¸ºâˆ¼ 2lnN\nåœ¨ç”±N ä¸ªéšæœºé”®æ„é€ çš„äºŒå‰æŸ¥æ‰¾æ ‘ä¸­æ’å…¥æ“ä½œå’ŒæŸ¥æ‰¾æœªå‘½ä¸­å¹³å‡æ‰€éœ€çš„æ¯”è¾ƒæ¬¡æ•°ä¸ºâˆ¼ 2lnNï¼ˆçº¦1.39lgNï¼‰\næœ‰åºæ€§ç›¸å…³çš„æ–¹æ³•ä¸åˆ é™¤æ“ä½œ # æœ€å¤§é”®å’Œæœ€å°é”® # å¦‚æœæ ¹ç»“ç‚¹çš„å·¦é“¾æ¥ä¸ºç©ºï¼Œé‚£ä¹ˆä¸€æ£µäºŒå‰æŸ¥æ‰¾æ ‘ä¸­æœ€å°çš„é”®å°±æ˜¯æ ¹ç»“ç‚¹ï¼›å¦‚æœå·¦é“¾æ¥éç©ºï¼Œé‚£ä¹ˆ æ ‘ä¸­çš„æœ€å°é”®å°±æ˜¯å·¦å­æ ‘ä¸­çš„æœ€å°é”®\nå‘ä¸Šå–æ•´å’Œå‘ä¸‹å–æ•´ # å¦‚æœç»™å®šçš„é”®key å°äºäºŒå‰æŸ¥æ‰¾æ ‘çš„æ ¹ç»“ç‚¹çš„é”®ï¼Œé‚£ä¹ˆå°äºç­‰äºkey çš„æœ€å¤§é”®floor(key) ä¸€å®š åœ¨æ ¹ç»“ç‚¹çš„å·¦å­æ ‘ä¸­ï¼›å¦‚æœç»™å®šçš„é”®key å¤§äºäºŒå‰æŸ¥æ‰¾æ ‘çš„æ ¹ç»“ç‚¹ï¼Œé‚£ä¹ˆåªæœ‰å½“æ ¹ç»“ç‚¹å³å­æ ‘ä¸­å­˜åœ¨å°äºç­‰äºkey çš„ç»“ç‚¹æ—¶ï¼Œå°äºç­‰äºkey çš„æœ€å¤§é”®æ‰ä¼šå‡ºç°åœ¨å³å­æ ‘ä¸­ï¼Œå¦åˆ™æ ¹ç»“ç‚¹å°±æ˜¯å°äºç­‰äºkeyçš„æœ€å¤§é”®\né€‰æ‹©æ“ä½œ # public Key min() { return min(root).key; } private Node min(Node x) { if (x.left == null) return x; return min(x.left); } public Key floor(Key key) { Node x = floor(root, key); if (x == null) return null; return x.key; } private Node floor(Node x, Key key) { if (x == null) return null; int cmp = key.compareTo(x.key); if (cmp == 0) return x; if (cmp \u0026lt; 0) return floor(x.left, key); Node t = floor(x.right, key); if (t != null) return t; else return x; } æ’å # åˆ é™¤æœ€å¤§é”®å’Œåˆ é™¤æœ€å°é”® # åˆ é™¤æ“ä½œ # èŒƒå›´æŸ¥æ‰¾ # æ€§èƒ½åˆ†æ # "},{"id":183,"href":"/zh/docs/study/MyBatis-Plus/bl_sgg/40-57/","title":"mybatis-plus-sgg-40-57","section":"åŸºç¡€(å°šç¡…è°·)_","content":" LambdaXxxWrapper # LambdaQueryWrapperä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢å­—æ®µåå†™é”™\n@Test public void test11(){ String username=\u0026#34;abc\u0026#34;; Integer ageBegin=null; Integer ageEnd=30; LambdaQueryWrapper\u0026lt;User\u0026gt; queryWrapper=new LambdaQueryWrapper\u0026lt;\u0026gt;(); queryWrapper.like(StringUtils.isNotBlank(username),User::getUserName,username) .ge(ageBegin!=null,User::getAge,ageBegin); userMapper.selectList(queryWrapper); } sqlæ—¥å¿—æ‰“å°\n==\u0026gt; Preparing: SELECT uid AS id,name AS userName,age,email,is_deleted_ly FROM t_user WHERE is_deleted_ly=0 AND (name LIKE ?) ==\u0026gt; Parameters: %abc%(String) \u0026lt;== Total: 0 LambdaUpdateWrapper\n@Test public void test12() { //(age\u0026gt;23ä¸”ç”¨æˆ·ååŒ…å«a) æˆ– (é‚®ç®±ä¸ºnull) LambdaUpdateWrapper\u0026lt;User\u0026gt; updateWrapper = new LambdaUpdateWrapper\u0026lt;\u0026gt;(); updateWrapper.like(User::getUserName, \u0026#34;a\u0026#34;) .and(userUpdateWrapper -\u0026gt; userUpdateWrapper.gt(User::getAge, 23).or().isNotNull(User::getEmail)); updateWrapper.set(User::getUserName, \u0026#34;å°é»‘\u0026#34;).set(User::getEmail, \u0026#34;abc@ly.com\u0026#34;); userMapper.update(null, updateWrapper); } sqlæ—¥å¿—æ‰“å°\n==\u0026gt; Preparing: UPDATE t_user SET name=?,email=? WHERE is_deleted_ly=0 AND (name LIKE ? AND (age \u0026gt; ? OR email IS NOT NULL)) ==\u0026gt; Parameters: å°é»‘(String), abc@ly.com(String), %a%(String), 23(Integer) \u0026lt;== Updates: 0 MyBatisåˆ†é¡µ # å…ˆä½¿ç”¨é…ç½®ç±»\n@Configuration @MapperScan(\u0026#34;com.ly.mybatisplus.mapper\u0026#34;) public class MyBatisConfig { @Bean public MybatisPlusInterceptor mybatisPlusInterceptor(){ MybatisPlusInterceptor mybatisPlusInterceptor=new MybatisPlusInterceptor(); mybatisPlusInterceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL)); return mybatisPlusInterceptor; } } ä½¿ç”¨\n@Test public void testPage() { Page\u0026lt;User\u0026gt; page = new Page\u0026lt;\u0026gt;(); page.setCurrent(2);//å½“å‰é¡µé¡µç  page.setSize(3);//æ¯é¡µæ¡æ•° Page\u0026lt;User\u0026gt; userPage = userMapper.selectPage(page, null); System.out.println(userPage.getRecords() + \u0026#34;----\\n\u0026#34; + userPage.getPages() + \u0026#34;----\\n\u0026#34; + userPage.getTotal() + \u0026#34;---\\n\u0026#34;) ; } sqlæ—¥å¿—æ‰“å°\n==\u0026gt; Preparing: SELECT uid AS id,name AS userName,age,email,is_deleted_ly FROM t_user WHERE is_deleted_ly=0 LIMIT ?,? ==\u0026gt; Parameters: 3(Long), 3(Long) \u0026lt;== Columns: id, userName, age, email, is_deleted_ly \u0026lt;== Row: 4, è¢«ä¿®æ”¹äº†, 21, test4@baomidou.com, 0 \u0026lt;== Row: 5, è¢«ä¿®æ”¹äº†, 24, emailè¢«ä¿®æ”¹äº†, 0 \u0026lt;== Row: 6, å¼ ä¸‰5, 18, test5@baomidou.com, 0 \u0026lt;== Total: 3 ç»“æœPageå¯¹è±¡çš„æ•°æ®\n[User(id=4, userName=è¢«ä¿®æ”¹äº†, age=21, email=test4@baomidou.com, isDeletedLy=0), User(id=5, userName=è¢«ä¿®æ”¹äº†, age=24, email=emailè¢«ä¿®æ”¹äº†, isDeletedLy=0), User(id=6, userName=å¼ ä¸‰5, age=18, email=test5@baomidou.com, isDeletedLy=0)]---- 3---- 8--- è‡ªå®šä¹‰åˆ†é¡µåŠŸèƒ½\né¦–å…ˆï¼Œè®¾ç½®ç±»å‹åˆ«åæ‰€åœ¨çš„åŒ…\nmybatis-plus: type-aliases-package: com.ly.mybatisplus.pojo åœ¨Mapperç±»ä¸­ç¼–å†™æ¥å£æ–¹æ³•\n@Repository public interface UserMapper extends BaseMapper\u0026lt;User\u0026gt; { /** * é€šè¿‡å¹´é¾„æŸ¥è¯¢å¹¶åˆ†é¡µ * @param page mybatis-plusæä¾›çš„ï¼Œå¿…é¡»å­˜åœ¨ä¸”åœ¨ç¬¬ä¸€ä¸ªä½ç½® * @param age * @return */ Page\u0026lt;User\u0026gt; selectPageVO(Page\u0026lt;User\u0026gt; page,Integer age); } æ³¨æ„ç¬¬ä¸€ä¸ªå‚æ•°\nåœ¨Mapper.xmlä¸­ç¼–å†™è¯­å¥\n\u0026lt;select id=\u0026#34;selectPageVO\u0026#34; resultType=\u0026#34;User\u0026#34;\u0026gt; select uid,name,email from t_user where age \u0026gt; #{age} \u0026lt;/select\u0026gt; æµ‹è¯•æ–¹æ³•\n@Test public void testPageCustom() { Page\u0026lt;User\u0026gt; page = new Page\u0026lt;\u0026gt;(); page.setCurrent(3);//å½“å‰é¡µé¡µç  page.setSize(5);//æ¯é¡µæ¡æ•° Page\u0026lt;User\u0026gt; userPage = userMapper.selectPageVO(page, 12); System.out.println(userPage.getRecords() + \u0026#34;----\\n\u0026#34; + userPage.getPages() + \u0026#34;----\\n\u0026#34; + userPage.getTotal() + \u0026#34;---\\n\u0026#34;) ; } sqlæ—¥å¿—è¾“å‡º\n==\u0026gt; Preparing: SELECT COUNT(*) AS total FROM t_user WHERE age \u0026gt; ? ==\u0026gt; Parameters: 12(Integer) \u0026lt;== Columns: total \u0026lt;== Row: 20 \u0026lt;== Total: 1 //ä»ç¬¬10è¡Œå¼€å§‹ï¼ˆä¸åŒ…æ‹¬ç¬¬10è¡Œï¼‰ï¼Œå–5æ¡è®°å½• ==\u0026gt; Preparing: select uid,name,email from t_user where age \u0026gt; ? LIMIT ?,? ==\u0026gt; Parameters: 12(Integer), 10(Long), 5(Long) \u0026lt;== Columns: uid, name, email \u0026lt;== Row: 11, a, null \u0026lt;== Row: 12, a, null \u0026lt;== Row: 13, a, null \u0026lt;== Row: 14, a, null \u0026lt;== Row: 15, a, null \u0026lt;== Total: 5 Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@706fe5c6] [null, null, null, null, null]---- 4---- 20--- æ³¨æ„ä¸Šé¢é‚£ä¸ªsqlï¼Œä»–ä¼šå…ˆæŸ¥è¯¢æ¡æ•°ï¼Œå¦‚æœæ¡æ•°\u0026lt;=0ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæ‰§è¡Œä¸‹é¢çš„æ•°æ®æœç´¢äº†\næ‚²è§‚é”å’Œä¹è§‚é” # åœºæ™¯ ä¹è§‚é”æ ¹æ®ç‰ˆæœ¬å·ä½¿ç”¨ version\nä¹è§‚é”å®ç°æµç¨‹ æ¨¡æ‹Ÿå†²çª # è¡¨åˆ›å»º\nCREATE TABLE t_product ( id BIGINT ( 20 ) NOT NULL COMMENT \u0026#39;ä¸»é”®id\u0026#39;, NAME VARCHAR ( 30 ) null DEFAULT NULL COMMENT \u0026#39;å•†å“åç§°\u0026#39;, price INT ( 11 ) DEFAULT 0 COMMENT \u0026#39;ä»·æ ¼\u0026#39;, version INT ( 11 ) DEFAULT 0 COMMENT \u0026#39;ä¹è§‚é”ç‰ˆæœ¬å·\u0026#39;, PRIMARY KEY ( id ) ) åˆ›å»ºProductMapper\n@Repository public interface ProductMapper extends BaseMapper\u0026lt;Product\u0026gt; { } æ•°æ®åº“æ•°æ® ä»£ç \n@Test public void testModel() { //å°ææŸ¥è¯¢å•†å“ Product productLi = productMapper.selectById(1L); //å°ç‹æŸ¥è¯¢å•†å“ Product productWang = productMapper.selectById(1L); //å°æå°†å•†å“åŠ 50 productLi.setPrice(productLi.getPrice()+50); productMapper.updateById(productLi); //å°ç‹å°†ä»·æ ¼é™ä½30 productWang.setPrice(productWang.getPrice()-30); productMapper.updateById(productWang); } sqlæ—¥å¿—\n==\u0026gt; Preparing: UPDATE t_product SET name=?, price=?, version=? WHERE id=? ==\u0026gt; Parameters: å¤–æ˜Ÿäºº(String), 150(Integer), 0(Integer), 1(Long) \u0026lt;== Updates: 1 Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@6325f352] Creating a new SqlSession SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@70730db] was not registered for synchronization because synchronization is not active JDBC Connection [HikariProxyConnection@91831175 wrapping com.mysql.cj.jdbc.ConnectionImpl@74ea46e2] will not be managed by Spring ==\u0026gt; Preparing: UPDATE t_product SET name=?, price=?, version=? WHERE id=? ==\u0026gt; Parameters: å¤–æ˜Ÿäºº(String), 70(Integer), 0(Integer), 1(Long) \u0026lt;== Updates: 1 //æœ€ç»ˆç»“æœä¸º70\nä¹è§‚é”æ’ä»¶ # åœ¨å®ä½“ç±»ä¸­ä½¿ç”¨@Versionæ³¨è§£è¡¨ç¤ºä¹è§‚é”ç‰ˆæœ¬å·\n@Version private Integer version; é…ç½®ç±»\n@Bean public MybatisPlusInterceptor mybatisPlusInterceptor(){ MybatisPlusInterceptor mybatisPlusInterceptor=new MybatisPlusInterceptor(); mybatisPlusInterceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL)); //æ·»åŠ ä¹è§‚é”æ’ä»¶ mybatisPlusInterceptor.addInnerInterceptor(new OptimisticLockerInnerInterceptor()); return mybatisPlusInterceptor; } å†æ¬¡è¿è¡Œä»£ç \n@Test public void testModel() { //å°ææŸ¥è¯¢å•†å“ Product productLi = productMapper.selectById(1L); //å°ç‹æŸ¥è¯¢å•†å“ Product productWang = productMapper.selectById(1L); //å°æå°†å•†å“åŠ 50 productLi.setPrice(productLi.getPrice()+50); productMapper.updateById(productLi); //å°ç‹å°†ä»·æ ¼é™ä½30 productWang.setPrice(productWang.getPrice()-30); productMapper.updateById(productWang); } sqlæ—¥å¿—æŸ¥çœ‹\n==\u0026gt; Preparing: UPDATE t_product SET name=?, price=?, version=? WHERE id=? AND version=? ==\u0026gt; Parameters: å¤–æ˜Ÿäºº(String), 120(Integer), 1(Integer), 1(Long), 0(Integer) \u0026lt;== Updates: 1 Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@2d64160c] Creating a new SqlSession SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@33063f5b] was not registered for synchronization because synchronization is not active JDBC Connection [HikariProxyConnection@356539350 wrapping com.mysql.cj.jdbc.ConnectionImpl@127a7272] will not be managed by Spring ==\u0026gt; Preparing: UPDATE t_product SET name=?, price=?, version=? WHERE id=? AND version=? ==\u0026gt; Parameters: å¤–æ˜Ÿäºº(String), 40(Integer), 1(Integer), 1(Long), 0(Integer) \u0026lt;== Updates: 0 ä¼˜åŒ–ä¿®æ”¹æµç¨‹ # @Test public void testModel() { //å°ææŸ¥è¯¢å•†å“ Product productLi = productMapper.selectById(1L); //å°ç‹æŸ¥è¯¢å•†å“ Product productWang = productMapper.selectById(1L); //å°æå°†å•†å“åŠ 50 productLi.setPrice(productLi.getPrice() + 50); productMapper.updateById(productLi); //å°ç‹å°†ä»·æ ¼é™ä½30 productWang.setPrice(productWang.getPrice() - 30); int i = productMapper.updateById(productWang); //å¦‚æœå°ç‹æ“ä½œå¤±è´¥,å†è·å–ä¸€æ¬¡ if (i == 0) { Product product = productMapper.selectById(1L); product.setPrice(product.getPrice() - 30); productMapper.updateById(product); } } sqlæ—¥å¿—æ‰“å°\n==\u0026gt; Preparing: UPDATE t_product SET name=?, price=?, version=? WHERE id=? AND version=? ==\u0026gt; Parameters: å¤–æ˜Ÿäºº(String), 150(Integer), 6(Integer), 1(Long), 5(Integer) \u0026lt;== Updates: 1 Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@544e8149] Creating a new SqlSession SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@48a0c8aa] was not registered for synchronization because synchronization is not active JDBC Connection [HikariProxyConnection@1637000661 wrapping com.mysql.cj.jdbc.ConnectionImpl@5f481b73] will not be managed by Spring ==\u0026gt; Preparing: UPDATE t_product SET name=?, price=?, version=? WHERE id=? AND version=? ==\u0026gt; Parameters: å¤–æ˜Ÿäºº(String), 70(Integer), 6(Integer), 1(Long), 5(Integer) \u0026lt;== Updates: 0 Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@48a0c8aa] Creating a new SqlSession SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@4cbc2e3b] was not registered for synchronization because synchronization is not active JDBC Connection [HikariProxyConnection@43473566 wrapping com.mysql.cj.jdbc.ConnectionImpl@5f481b73] will not be managed by Spring ==\u0026gt; Preparing: SELECT id,name,price,version FROM t_product WHERE id=? ==\u0026gt; Parameters: 1(Long) \u0026lt;== Columns: id, name, price, version \u0026lt;== Row: 1, å¤–æ˜Ÿäºº, 150, 6 \u0026lt;== Total: 1 Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@4cbc2e3b] Creating a new SqlSession SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@57562473] was not registered for synchronization because synchronization is not active JDBC Connection [HikariProxyConnection@2050360660 wrapping com.mysql.cj.jdbc.ConnectionImpl@5f481b73] will not be managed by Spring ==\u0026gt; Preparing: UPDATE t_product SET name=?, price=?, version=? WHERE id=? AND version=? ==\u0026gt; Parameters: å¤–æ˜Ÿäºº(String), 120(Integer), 7(Integer), 1(Long), 6(Integer) \u0026lt;== Updates: 1 Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@57562473] é€šç”¨æšä¸¾ # æ·»åŠ ä¸€ä¸ªenumç±»\n@Getter public enum SexEnum { MALE(1, \u0026#34;ç”·\u0026#34;), FEMALE(2, \u0026#34;å¥³\u0026#34;); private Integer sex; private String sexName; SexEnum(Integer sex, String sexName) { this.sex = sex; this.sexName = sexName; } } æ•°æ®åº“å¢åŠ ä¸€ä¸ªsex å­—æ®µï¼Œå®ä½“ç±»å¢åŠ ä¸€ä¸ªsexå±æ€§ å®ä½“ç±»\nprivate SexEnum sex; è¿›è¡Œæ·»åŠ \n@Test public void testEnum(){ User user=new User(); user.setUserName(\u0026#34;enum - æµ‹è¯•åå­—\u0026#34;); user.setSexEnum(SexEnum.MALE); int insert = userMapper.insert(user); System.out.println(insert); } æ³¨æ„çœ‹sqlæ—¥å¿—ï¼Œæœ‰æŠ¥é”™ä¿¡æ¯\n==\u0026gt; Preparing: INSERT INTO t_user ( name, sex ) VALUES ( ?, ? ) ==\u0026gt; Parameters: enum - æµ‹è¯•åå­—(String), MALE(String) ### SQL: INSERT INTO t_user ( name, sex ) VALUES ( ?, ? ) ### Cause: java.sql.SQLException: Incorrect integer value: \u0026#39;MALE\u0026#39; for column \u0026#39;sex\u0026#39; at row 1 æ’å…¥äº†éæ•°å­—\nä¿®æ­£ï¼Œenumç±»æ·»åŠ æ³¨è§£\n@EnumValue //å°†æ³¨è§£æ‰€æ ‡è¯†çš„å±æ€§çš„å€¼è®¾ç½®åˆ°æ•°æ®åº“ private Integer sex; æ‰«æé€šç”¨æšä¸¾çš„åŒ… application.ymlä¸­\nmybatis-plus: type-enums-package: com.ly.mybatisplus.enums è¿è¡Œæµ‹è¯•ç±»å¹¶æŸ¥çœ‹æ—¥å¿—\n==\u0026gt; Preparing: INSERT INTO t_user ( name, sex ) VALUES ( ?, ? ) ==\u0026gt; Parameters: enum - æµ‹è¯•åå­—(String), 1(Integer) \u0026lt;== Updates: 1 ä»£ç ç”Ÿæˆå™¨ # {% post_link study/mybatis_plus/official/hello åœ¨28%è¿›åº¦çš„åœ°æ–¹ %}\nmybatis-plus ä»£ç è‡ªåŠ¨ç”Ÿæˆ\nmaven ä¾èµ–\n\u0026lt;!-- https://mvnrepository.com/artifact/com.baomidou/mybatis-plus-generator --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.baomidou\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mybatis-plus-generator\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.5.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- https://mvnrepository.com/artifact/org.apache.velocity/velocity-engine-core --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.velocity\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;velocity-engine-core\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.3\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; åœ¨æµ‹è¯•ç±»ä¸­ç¼–å†™ç¨‹åºè®©å…¶è‡ªåŠ¨ç”Ÿæˆ\nimport com.baomidou.mybatisplus.generator.FastAutoGenerator; import com.baomidou.mybatisplus.generator.config.DataSourceConfig; import org.apache.ibatis.jdbc.ScriptRunner; import java.io.InputStream; import java.io.InputStreamReader; import java.sql.Connection; import java.sql.SQLException; /** * \u0026lt;p\u0026gt; * å¿«é€Ÿç”Ÿæˆ * \u0026lt;/p\u0026gt; * * @author lanjerry * @since 2021-09-16 */ public class FastAutoGeneratorTest { /** * æ‰§è¡Œåˆå§‹åŒ–æ•°æ®åº“è„šæœ¬ */ public static void before() throws SQLException { Connection conn = DATA_SOURCE_CONFIG.build().getConn(); InputStream inputStream = FastAutoGeneratorTest.class.getResourceAsStream(\u0026#34;/db/schema-mysql.sql\u0026#34;); ScriptRunner scriptRunner = new ScriptRunner(conn); scriptRunner.setAutoCommit(true); scriptRunner.runScript(new InputStreamReader(inputStream)); conn.close(); } /** * æ•°æ®æºé…ç½® */ private static final DataSourceConfig.Builder DATA_SOURCE_CONFIG = new DataSourceConfig .Builder(\u0026#34;jdbc:mysql://localhost:3306/mybatis_plus_demo?useUnicode=true\u0026amp;characterEncoding=utf-8\u0026amp;allowMultiQueries=true\u0026amp;nullCatalogMeansCurrent=true\u0026#34;, \u0026#34;root\u0026#34;, \u0026#34;123456\u0026#34;); /** * æ‰§è¡Œ run */ public static void main(String[] args) throws SQLException { before(); FastAutoGenerator.create(DATA_SOURCE_CONFIG) // å…¨å±€é…ç½® .globalConfig((scanner, builder) -\u0026gt; builder.author(scanner.apply(\u0026#34;è¯·è¾“å…¥ä½œè€…åç§°\u0026#34;))) // åŒ…é…ç½® .packageConfig((scanner, builder) -\u0026gt; builder.parent(scanner.apply(\u0026#34;è¯·è¾“å…¥åŒ…å\u0026#34;))) // ç­–ç•¥é…ç½® .strategyConfig((scanner, builder) -\u0026gt; builder.addInclude(scanner.apply(\u0026#34;è¯·è¾“å…¥è¡¨åï¼Œå¤šä¸ªè¡¨åç”¨,éš”å¼€\u0026#34;))) /* æ¨¡æ¿å¼•æ“é…ç½®ï¼Œé»˜è®¤ Velocity å¯é€‰æ¨¡æ¿å¼•æ“ Beetl æˆ– Freemarker .templateEngine(new BeetlTemplateEngine()) .templateEngine(new FreemarkerTemplateEngine()) */ .execute(); } } shang gui gu é…ç½® æ¨¡æ‹Ÿå¤šæ•°æ®æºç¯å¢ƒ # æ–°å»ºä¸€ä¸ªmybatis-plusæ•°æ®åº“å’Œè¡¨ mavenä¾èµ–æ·»åŠ \n\u0026lt;!-- https://mvnrepository.com/artifact/com.baomidou/dynamic-datasource-spring-boot-starter --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.baomidou\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;dynamic-datasource-spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.5.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; å‰æ ä½¿ç”¨mybatis_plusä¸­çš„t_productè¡¨ åŠmybatis_plus1ä¸­çš„t_product1è¡¨\nymlé…ç½®\nspring: datasource: dynamic: primary: master #è®¾ç½®é»˜è®¤çš„æ•°æ®æºæˆ–è€…æ•°æ®æºç»„,é»˜è®¤å€¼å³ä¸ºmaster strict: false #ä¸¥æ ¼åŒ¹é…æ•°æ®æº,é»˜è®¤false. trueæœªåŒ¹é…åˆ°æŒ‡å®šæ•°æ®æºæ—¶æŠ›å¼‚å¸¸,falseä½¿ç”¨é»˜è®¤æ•°æ®æº datasource: master: url: jdbc:mysql://localhost:3306/mybatis_plus?characterEncoding=utf-8\u0026amp;\u0026amp;useSSL=false\u0026amp;\u0026amp;allowPublicKeyRetrieval=true username: root password: 123456 driver-class-name: com.mysql.jdbc.Driver # 3.2.0å¼€å§‹æ”¯æŒSPIå¯çœç•¥æ­¤é…ç½® slave_1: url: jdbc:mysql://localhost:3306/mybatis_plus_1?characterEncoding=utf-8\u0026amp;\u0026amp;useSSL=false\u0026amp;\u0026amp;allowPublicKeyRetrieval=true username: root password: 123456 driver-class-name: com.mysql.jdbc.Driver #slave_2: # url: ENC(xxxxx) # å†…ç½®åŠ å¯†,ä½¿ç”¨è¯·æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ # username: ENC(xxxxx) # password: ENC(xxxxx) # driver-class-name: com.mysql.jdbc.Driver #......çœç•¥ #ä»¥ä¸Šä¼šé…ç½®ä¸€ä¸ªé»˜è®¤åº“masterï¼Œä¸€ä¸ªç»„slaveä¸‹æœ‰ä¸¤ä¸ªå­åº“slave_1,slave_2 ä»£ç \nç»“æ„ å®‰è£…MyBatisXæ’ä»¶ # æ’ä»¶å¸‚åœº è‡ªåŠ¨å®šä½ MyBatisä»£ç å¿«é€Ÿç”Ÿæˆ # é…ç½® urlåŠå¯†ç é…ç½® ä½¿ç”¨ è‡ªåŠ¨ç”Ÿæˆ "},{"id":184,"href":"/zh/docs/study/MyBatis-Plus/bl_sgg/19-39/","title":"mybatis-plus-sgg-19-39","section":"åŸºç¡€(å°šç¡…è°·)_","content":" é€šç”¨Serviceåº”ç”¨ # è¿™é‡Œä¼šå‡ºç° publicKey is now allowed ï¼Œåœ¨æ•°æ®åº“è¿æ¥è¯­å¥åé¢åŠ ä¸Šè¿™å¥è¯å³å¯ allowPublicKeyRetrieval=true\nspring: #é…ç½®æ•°æ®æº datasource: #é…ç½®æ•°æ®æºç±»å‹ type: com.zaxxer.hikari.HikariDataSource #é…ç½®æ•°æ®æºå„ä¸ªä¿¡æ¯ driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://localhost:3306/mybatis_plus?characterEncoding=utf-8\u0026amp;\u0026amp;useSSL=false\u0026amp;\u0026amp;allowPublicKeyRetrieval=true username: root password: 123456 æŸ¥è¯¢\n@Test public void testList(){ //List\u0026lt;User\u0026gt; list = userService.list(); long count = userService.count(); System.out.println(\u0026#34;æ€»æ¡æ•°ï¼š\u0026#34;+count); } SQLæ‰§è¡Œè¯­å¥\n==\u0026gt; Preparing: SELECT COUNT( * ) FROM user ==\u0026gt; Parameters: \u0026lt;== Columns: COUNT( * ) \u0026lt;== Row: 5 \u0026lt;== Total: 1 æ‰¹é‡æ·»åŠ \n@Test public void batchInsert(){ List\u0026lt;User\u0026gt; users=new ArrayList\u0026lt;\u0026gt;(); for(int i=0;i\u0026lt;10;i++){ User user=new User(); user.setName(\u0026#34;name\u0026#34;+i); user.setEmail(\u0026#34;email\u0026#34;+i); users.add(user); } boolean b = userService.saveBatch(users); System.out.println(\u0026#34;result:\u0026#34;+b); } sqlæ—¥å¿—è¾“å‡º\n==\u0026gt; Preparing: INSERT INTO user ( id, name, email ) VALUES ( ?, ?, ? ) ==\u0026gt; Parameters: 1532579686881243138(Long), name0(String), email0(String) ==\u0026gt; Parameters: 1532579687124512770(Long), name1(String), email1(String) ==\u0026gt; Parameters: 1532579687128707074(Long), name2(String), email2(String) ==\u0026gt; Parameters: 1532579687128707075(Long), name3(String), email3(String) ==\u0026gt; Parameters: 1532579687132901377(Long), name4(String), email4(String) ==\u0026gt; Parameters: 1532579687137095681(Long), name5(String), email5(String) ==\u0026gt; Parameters: 1532579687137095682(Long), name6(String), email6(String) ==\u0026gt; Parameters: 1532579687141289985(Long), name7(String), email7(String) ==\u0026gt; Parameters: 1532579687145484289(Long), name8(String), email8(String) ==\u0026gt; Parameters: 1532579687145484290(Long), name9(String), email9(String) result:true æ³¨æ„ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªä¸ªçš„insert into ï¼Œè€Œä¸æ˜¯ä¸€æ¡(å•ä¸ªçš„sqlè¯­å¥è¿›è¡Œå¾ªç¯æ·»åŠ )\nMyBatis-Pluså¸¸ç”¨æ³¨è§£1 # ç°åœ¨å°†mysqlæ•°æ®åº“è¡¨useråæ”¹ä¸ºt_user ä¼šæç¤ºä¸‹é¢çš„æŠ¥é”™\nCause: java.sql.BatchUpdateException: Table \u0026#39;mybatis_plus.user\u0026#39; doesn\u0026#39;t exist è¯´æ˜mybatis plusæŸ¥è¯¢çš„æ—¶å€™ä¼šå»æ‰¾å®ä½“ç±»åä¸€æ ·çš„è¡¨\nä½¿ç”¨@TableName(\u0026ldquo;t_user\u0026rdquo;) è®¾ç½®å®ä½“ç±»å¯¹åº”çš„è¡¨å\n@Data @TableName(\u0026#34;t_user\u0026#34;) public class User { private Long id; private String name; private Integer age; private String email; } ä¿®æ”¹åæ‰§è¡ŒæˆåŠŸ ç»Ÿä¸€æ·»åŠ \nmybatis-plus: configuration: global-config: db-config: table-prefix: t_ æŒ‡å®šä¸»é”®å å‡è®¾ç°åœ¨æŠŠæ•°æ®åº“åˆ—åå’Œbeançš„å±æ€§åidæ”¹ä¸ºuid,æ­¤æ—¶æ–°å¢ä¸€æ¡è®°å½•\nField \u0026#39;uid\u0026#39; doesn\u0026#39;t have a default value ; Field \u0026#39;uid\u0026#39; doesn\u0026#39;t have a default value; nested exception is java.sql.SQLException: Field \u0026#39;uid\u0026#39; doesn\u0026#39;t have a default value è¯´æ˜æ­¤æ—¶æ²¡æœ‰ä¸ºuidèµ‹å€¼ ä½¿ç”¨@TableIdå‘Šè¯‰mybatis-plusé‚£ä¸ªå­—æ®µä¸ºä¸»é”®ï¼Œè®©mybatis-plusä¸ºä»–èµ‹é»˜è®¤å€¼\n@Data public class User { @TableId private Long uid; private String name; private Integer age; private String email; } sqlæ‰“å°\n==\u0026gt; Preparing: INSERT INTO t_user ( uid, name, age ) VALUES ( ?, ?, ? ) ==\u0026gt; Parameters: 1532582462671618050(Long), å¼ ä¸‰(String), 18(Integer) \u0026lt;== Updates: 1 @TableIdçš„valueå±æ€§ # ç”¨äºæŒ‡å®šç»‘å®šçš„ä¸»é”®çš„å­—æ®µ å‡è®¾æ­¤æ—¶å°†beançš„ä¸»é”®å±æ€§åä¸ºidï¼Œæ•°æ®åº“ä¸»é”®åæ˜¯uid\næ­¤æ—¶è¿è¡Œï¼Œä¼šæç¤º\n### SQL: INSERT INTO t_user ( id, name, age ) VALUES ( ?, ?, ? ) ### Cause: java.sql.SQLSyntaxErrorException: Unknown column \u0026#39;id\u0026#39; in \u0026#39;field list\u0026#39; ä»–ä¼šæ‹¿beançš„å±æ€§æ¥ç”Ÿæˆsqlè¯­å¥\nåŠ ä¸Š@TableId(value=\u0026ldquo;uid\u0026rdquo;)åè¿è¡Œæ­£å¸¸\n@TableIdçš„valueå±æ€§ # /** * ç”ŸæˆIDç±»å‹æšä¸¾ç±» * * @author hubin * @since 2015-11-10 */ @Getter public enum IdType { /** * æ•°æ®åº“IDè‡ªå¢ * \u0026lt;p\u0026gt;è¯¥ç±»å‹è¯·ç¡®ä¿æ•°æ®åº“è®¾ç½®äº† IDè‡ªå¢ å¦åˆ™æ— æ•ˆ\u0026lt;/p\u0026gt; */ AUTO(0), /** * è¯¥ç±»å‹ä¸ºæœªè®¾ç½®ä¸»é”®ç±»å‹(æ³¨è§£é‡Œç­‰äºè·Ÿéšå…¨å±€,å…¨å±€é‡Œçº¦ç­‰äº INPUT) */ NONE(1), /** * ç”¨æˆ·è¾“å…¥ID * \u0026lt;p\u0026gt;è¯¥ç±»å‹å¯ä»¥é€šè¿‡è‡ªå·±æ³¨å†Œè‡ªåŠ¨å¡«å……æ’ä»¶è¿›è¡Œå¡«å……\u0026lt;/p\u0026gt; */ INPUT(2), /* ä»¥ä¸‹3ç§ç±»å‹ã€åªæœ‰å½“æ’å…¥å¯¹è±¡ID ä¸ºç©ºï¼Œæ‰è‡ªåŠ¨å¡«å……ã€‚ */ /** * åˆ†é…ID (ä¸»é”®ç±»å‹ä¸ºnumberæˆ–stringï¼‰, * é»˜è®¤å®ç°ç±» {@link com.baomidou.mybatisplus.core.incrementer.DefaultIdentifierGenerator}(é›ªèŠ±ç®—æ³•) * * @since 3.3.0 */ ASSIGN_ID(3), /** * åˆ†é…UUID (ä¸»é”®ç±»å‹ä¸º string) * é»˜è®¤å®ç°ç±» {@link com.baomidou.mybatisplus.core.incrementer.DefaultIdentifierGenerator}(UUID.replace(\u0026#34;-\u0026#34;,\u0026#34;\u0026#34;)) */ ASSIGN_UUID(4); private final int key; IdType(int key) { this.key = key; } } //ä½¿ç”¨è‡ªå¢ @TableId(value=\u0026#34;uid\u0026#34;,type = IdType.AUTO ) private Long id; ç„¶åå°†æ•°æ®åº“ä¸»é”®è®¾ç½®ä¸ºè‡ªåŠ¨é€’å¢\næ–°å¢åidä¸º6\né€šè¿‡å…¨å±€å±æ€§è®¾ç½®ä¸»é”®ç”Ÿæˆç­–ç•¥ # å…¨å±€é…ç½®è®¾ç½®\nmybatis-plus: global-config: db-config: id-type: auto é›ªèŠ±ç®—æ³• # æ•°æ®åº“æ‰©å±•æ–¹å¼ï¼šä¸»ä»å¤åˆ¶ã€ä¸šåŠ¡åˆ†åº“ã€æ•°æ®åº“åˆ†è¡¨ æ•°æ®åº“æ‹†åˆ†ï¼šæ°´å¹³æ‹†åˆ†ã€å‚ç›´æ‹†åˆ† æ°´å¹³åˆ†è¡¨ç›¸å¯¹å‚ç›´åˆ†è¡¨ï¼Œä¼šå¼•å…¥æ›´å¤šçš„å¤æ‚æ€§ï¼Œæ¯”å¦‚è¦æ±‚å”¯ä¸€çš„æ•°æ®idè¯¥æ€ä¹ˆå¤„ç† å¯ä»¥ç»™æ¯ä¸ªåˆ†è¡¨éƒ½ç»™å®šä¸€ä¸ªèŒƒå›´å¤§å°ï¼Œä½†æ˜¯è¿™æ ·åˆ†æ®µå¤§å°ä¸å¥½å– å¯ä»¥å–æ¨¡ï¼Œä½†æ˜¯å¦‚æœå¢åŠ äº†æœºå™¨ï¼ŒåŸæ¥çš„å€¼ä¸»é”®ï¼ˆæ€ä¹ˆå¤„ç†æ˜¯ä¸ªé—®é¢˜ é›ªèŠ±ç®—æ³•ï¼Œç”±Twitterå…¬å¸ƒçš„åˆ†å¸ƒå¼ä¸»é”®ç”Ÿæˆç®—æ³• èƒ½å¤Ÿä¿è¯ä¸åŒè¡¨çš„ä¸»é”®çš„ä¸é‡å¤æ€§ï¼Œä»¥åŠç›¸åŒè¡¨çš„ä¸»é”®çš„æœ‰åºæ€§ æ ¸å¿ƒæ€æƒ³ MyBatis-Pluså¸¸ç”¨æ³¨è§£2 # æ­¤æ—¶æ•°æ®åº“å­—æ®µåä¸ºnameï¼Œå¦‚æœç°åœ¨å®ä½“ç±»çš„åå­—æ”¹ä¸ºuserNameï¼Œé‚£ä¹ˆä¼šæŠ¥é”™\nINSERT INTO t_user ( user_name, age ) VALUES ( ?, ? ) åˆä¸€æ¬¡è¯æ˜äº†MyBatis-plusé€šè¿‡å®ä½“ç±»å±æ€§çŒœæµ‹æ•°æ®åº“è¡¨çš„ç›¸å…³å­—æ®µ\nä½¿ç”¨@TableFiledæ¥æŒ‡å®šå¯¹åº”çš„å­—æ®µå\n@TableField(value = \u0026#34;name\u0026#34;) private String userName; æŸ¥è¯¢\nä»£ç \n@Test public void selectTest() { User user = userService.getById(5L); System.out.println(\u0026#34;ç»“æœ:\u0026#34; + user); } sqlæ‰§è¡Œè¯­å¥\n==\u0026gt; Preparing: SELECT uid AS id,name AS userName,age,email,is_deleted_ly FROM t_user WHERE uid=? AND is_deleted_ly=0 ==\u0026gt; Parameters: 5(Long) \u0026lt;== Columns: id, userName, age, email, is_deleted_ly \u0026lt;== Row: 5, Billie, 24, emailè¢«ä¿®æ”¹äº†, 0 \u0026lt;== Total: 1 Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@5e048149] ç»“æœ:User(id=5, userName=Billie, age=24, email=emailè¢«ä¿®æ”¹äº†, isDeletedLy=0) é€»è¾‘åˆ é™¤(ä¸»è¦æ˜¯å…è®¸æ•°æ®çš„æ¢å¤) è¿™é‡Œå¢åŠ ä¸€ä¸ªisDeletedLyå­—æ®µï¼ˆè¿™é‡Œä¸ºäº†æµ‹è¯•ï¼Œä¸€èˆ¬æ˜¯isDeletedï¼‰\nåœ¨Userç±»æ·»åŠ ä¸‹é¢çš„å­—æ®µ\n@TableLogic private Integer isDeletedLy; é€»è¾‘åˆ é™¤\nä»£ç \n@Test public void deleteLogic() { boolean save = userService.removeBatchByIds(Arrays.asList(1L,2L,3L)); System.out.println(\u0026#34;ç»“æœ:\u0026#34; + save); } sqlæ‰§è¡Œè¯­å¥ æ³¨æ„ï¼Œè¿™é‡Œä½¿ç”¨äº†is_deleted_ly=0æ˜¯å› ä¸ºåœ¨ä¸‹é¢çš„æ­¥éª¤åŠ å…¥äº†é€»è¾‘åˆ é™¤æ³¨è§£\n==\u0026gt; Preparing: UPDATE t_user SET is_deleted_ly=1 WHERE uid=? AND is_deleted_ly=0 ==\u0026gt; Parameters: 1(Long) ==\u0026gt; Parameters: 2(Long) ==\u0026gt; Parameters: 3(Long) ç»“æœ æ¡ä»¶æ„é€ å™¨ # ç»“æ„ è§£é‡Š æŸ¥çœ‹BaseWrapperæºç \n/** * Mapper ç»§æ‰¿è¯¥æ¥å£åï¼Œæ— éœ€ç¼–å†™ mapper.xml æ–‡ä»¶ï¼Œå³å¯è·å¾—CRUDåŠŸèƒ½ * \u0026lt;p\u0026gt;è¿™ä¸ª Mapper æ”¯æŒ id æ³›å‹\u0026lt;/p\u0026gt; * * @author hubin * @since 2016-01-23 */ public interface BaseMapper\u0026lt;T\u0026gt; extends Mapper\u0026lt;T\u0026gt; { /** * æ’å…¥ä¸€æ¡è®°å½• * * @param entity å®ä½“å¯¹è±¡ */ int insert(T entity); /** * æ ¹æ® ID åˆ é™¤ * * @param id ä¸»é”®ID */ int deleteById(Serializable id); /** * æ ¹æ®å®ä½“(ID)åˆ é™¤ * * @param entity å®ä½“å¯¹è±¡ * @since 3.4.4 */ int deleteById(T entity); /** * æ ¹æ® columnMap æ¡ä»¶ï¼Œåˆ é™¤è®°å½• * * @param columnMap è¡¨å­—æ®µ map å¯¹è±¡ */ int deleteByMap(@Param(Constants.COLUMN_MAP) Map\u0026lt;String, Object\u0026gt; columnMap); /** * æ ¹æ® entity æ¡ä»¶ï¼Œåˆ é™¤è®°å½• * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸º null,é‡Œé¢çš„ entity ç”¨äºç”Ÿæˆ where è¯­å¥ï¼‰ */ int delete(@Param(Constants.WRAPPER) Wrapper\u0026lt;T\u0026gt; queryWrapper); /** * åˆ é™¤ï¼ˆæ ¹æ®IDæˆ–å®ä½“ æ‰¹é‡åˆ é™¤ï¼‰ * * @param idList ä¸»é”®IDåˆ—è¡¨æˆ–å®ä½“åˆ—è¡¨(ä¸èƒ½ä¸º null ä»¥åŠ empty) */ int deleteBatchIds(@Param(Constants.COLLECTION) Collection\u0026lt;?\u0026gt; idList); /** * æ ¹æ® ID ä¿®æ”¹ * * @param entity å®ä½“å¯¹è±¡ */ int updateById(@Param(Constants.ENTITY) T entity); /** * æ ¹æ® whereEntity æ¡ä»¶ï¼Œæ›´æ–°è®°å½• * * @param entity å®ä½“å¯¹è±¡ (set æ¡ä»¶å€¼,å¯ä»¥ä¸º null) * @param updateWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸º null,é‡Œé¢çš„ entity ç”¨äºç”Ÿæˆ where è¯­å¥ï¼‰ */ int update(@Param(Constants.ENTITY) T entity, @Param(Constants.WRAPPER) Wrapper\u0026lt;T\u0026gt; updateWrapper); /** * æ ¹æ® ID æŸ¥è¯¢ * * @param id ä¸»é”®ID */ T selectById(Serializable id); /** * æŸ¥è¯¢ï¼ˆæ ¹æ®ID æ‰¹é‡æŸ¥è¯¢ï¼‰ * * @param idList ä¸»é”®IDåˆ—è¡¨(ä¸èƒ½ä¸º null ä»¥åŠ empty) */ List\u0026lt;T\u0026gt; selectBatchIds(@Param(Constants.COLLECTION) Collection\u0026lt;? extends Serializable\u0026gt; idList); /** * æŸ¥è¯¢ï¼ˆæ ¹æ® columnMap æ¡ä»¶ï¼‰ * * @param columnMap è¡¨å­—æ®µ map å¯¹è±¡ */ List\u0026lt;T\u0026gt; selectByMap(@Param(Constants.COLUMN_MAP) Map\u0026lt;String, Object\u0026gt; columnMap); /** * æ ¹æ® entity æ¡ä»¶ï¼ŒæŸ¥è¯¢ä¸€æ¡è®°å½• * \u0026lt;p\u0026gt;æŸ¥è¯¢ä¸€æ¡è®°å½•ï¼Œä¾‹å¦‚ qw.last(\u0026#34;limit 1\u0026#34;) é™åˆ¶å–ä¸€æ¡è®°å½•, æ³¨æ„ï¼šå¤šæ¡æ•°æ®ä¼šæŠ¥å¼‚å¸¸\u0026lt;/p\u0026gt; * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸º nullï¼‰ */ default T selectOne(@Param(Constants.WRAPPER) Wrapper\u0026lt;T\u0026gt; queryWrapper) { List\u0026lt;T\u0026gt; ts = this.selectList(queryWrapper); if (CollectionUtils.isNotEmpty(ts)) { if (ts.size() != 1) { throw ExceptionUtils.mpe(\u0026#34;One record is expected, but the query result is multiple records\u0026#34;); } return ts.get(0); } return null; } /** * æ ¹æ® Wrapper æ¡ä»¶ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨è®°å½• * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±» * @return */ default boolean exists(Wrapper\u0026lt;T\u0026gt; queryWrapper) { Long count = this.selectCount(queryWrapper); return null != count \u0026amp;\u0026amp; count \u0026gt; 0; } /** * æ ¹æ® Wrapper æ¡ä»¶ï¼ŒæŸ¥è¯¢æ€»è®°å½•æ•° * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸º nullï¼‰ */ Long selectCount(@Param(Constants.WRAPPER) Wrapper\u0026lt;T\u0026gt; queryWrapper); /** * æ ¹æ® entity æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½• * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸º nullï¼‰ */ List\u0026lt;T\u0026gt; selectList(@Param(Constants.WRAPPER) Wrapper\u0026lt;T\u0026gt; queryWrapper); /** * æ ¹æ® Wrapper æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½• * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸º nullï¼‰ */ List\u0026lt;Map\u0026lt;String, Object\u0026gt;\u0026gt; selectMaps(@Param(Constants.WRAPPER) Wrapper\u0026lt;T\u0026gt; queryWrapper); /** * æ ¹æ® Wrapper æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½• * \u0026lt;p\u0026gt;æ³¨æ„ï¼š åªè¿”å›ç¬¬ä¸€ä¸ªå­—æ®µçš„å€¼\u0026lt;/p\u0026gt; * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸º nullï¼‰ */ List\u0026lt;Object\u0026gt; selectObjs(@Param(Constants.WRAPPER) Wrapper\u0026lt;T\u0026gt; queryWrapper); /** * æ ¹æ® entity æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½•ï¼ˆå¹¶ç¿»é¡µï¼‰ * * @param page åˆ†é¡µæŸ¥è¯¢æ¡ä»¶ï¼ˆå¯ä»¥ä¸º RowBounds.DEFAULTï¼‰ * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸º nullï¼‰ */ \u0026lt;P extends IPage\u0026lt;T\u0026gt;\u0026gt; P selectPage(P page, @Param(Constants.WRAPPER) Wrapper\u0026lt;T\u0026gt; queryWrapper); /** * æ ¹æ® Wrapper æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½•ï¼ˆå¹¶ç¿»é¡µï¼‰ * * @param page åˆ†é¡µæŸ¥è¯¢æ¡ä»¶ * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±» */ \u0026lt;P extends IPage\u0026lt;Map\u0026lt;String, Object\u0026gt;\u0026gt;\u0026gt; P selectMapsPage(P page, @Param(Constants.WRAPPER) Wrapper\u0026lt;T\u0026gt; queryWrapper); } Wrapperæ¡ä»¶ç»„è£… queryWrapperæµ‹è¯•\n@Test public void test01() { QueryWrapper\u0026lt;User\u0026gt; userQueryWrapper = new QueryWrapper\u0026lt;\u0026gt;(); //é“¾å¼ç»“æ„è°ƒç”¨ userQueryWrapper.like(\u0026#34;name\u0026#34;, \u0026#34;a\u0026#34;) .between(\u0026#34;age\u0026#34;, 10, 30) .isNotNull(\u0026#34;email\u0026#34;); List\u0026lt;User\u0026gt; users = userMapper.selectList(userQueryWrapper); users.forEach(System.out::println); } sqlæ—¥å¿—æ‰“å°\n//æ³¨æ„ï¼Œè¿™é‡Œå‡ºç°äº†é€»è¾‘åˆ é™¤æ¡ä»¶ ==\u0026gt; Preparing: SELECT uid AS id,name AS userName,age,email,is_deleted_ly FROM t_user WHERE is_deleted_ly=0 AND (name LIKE ? AND age BETWEEN ? AND ? AND email IS NOT NULL) ==\u0026gt; Parameters: %a%(String), 10(Integer), 30(Integer) \u0026lt;== Columns: id, userName, age, email, is_deleted_ly \u0026lt;== Row: 4, Sandy, 21, test4@baomidou.com, 0 \u0026lt;== Row: 5, Billiea, 24, emailè¢«ä¿®æ”¹äº†, 0 \u0026lt;== Total: 2 Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@19650aa6] User(id=4, userName=Sandy, age=21, email=test4@baomidou.com, isDeletedLy=0) User(id=5, userName=Billiea, age=24, email=emailè¢«ä¿®æ”¹äº†, isDeletedLy=0) ä½¿ç”¨æ’åº\n@Test public void test02() { QueryWrapper\u0026lt;User\u0026gt; userQueryWrapper = new QueryWrapper\u0026lt;\u0026gt;(); userQueryWrapper.orderByDesc(\u0026#34;age\u0026#34;) .orderByAsc(\u0026#34;uid\u0026#34;); List\u0026lt;User\u0026gt; users = userMapper.selectList(userQueryWrapper); users.forEach(System.out::println); } sqlæ—¥å¿—æ‰“å°\n==\u0026gt; Preparing: SELECT uid AS id,name AS userName,age,email,is_deleted_ly FROM t_user WHERE is_deleted_ly=0 ORDER BY age DESC,uid ASC ==\u0026gt; Parameters: \u0026lt;== Columns: id, userName, age, email, is_deleted_ly \u0026lt;== Row: 7, å¼ ä¸‰6, 38, test6@baomidou.com, 0 \u0026lt;== Row: 5, Billiea, 24, emailè¢«ä¿®æ”¹äº†, 0 \u0026lt;== Row: 4, Sandy, 21, test4@baomidou.com, 0 \u0026lt;== Row: 6, å¼ ä¸‰5, 18, test5@baomidou.com, 0 \u0026lt;== Row: 8, å¼ ä¸‰a, 18, null, 0 \u0026lt;== Total: 5 Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@7158daf2] User(id=7, userName=å¼ ä¸‰6, age=38, email=test6@baomidou.com, isDeletedLy=0) User(id=5, userName=Billiea, age=24, email=emailè¢«ä¿®æ”¹äº†, isDeletedLy=0) User(id=4, userName=Sandy, age=21, email=test4@baomidou.com, isDeletedLy=0) User(id=6, userName=å¼ ä¸‰5, age=18, email=test5@baomidou.com, isDeletedLy=0) User(id=8, userName=å¼ ä¸‰a, age=18, email=null, isDeletedLy=0) æ¡ä»¶é€»è¾‘åˆ é™¤\nä»£ç \n@Test public void test03() { QueryWrapper\u0026lt;User\u0026gt; userQueryWrapper=new QueryWrapper\u0026lt;\u0026gt;(); userQueryWrapper.isNull(\u0026#34;email\u0026#34;); int deleted = userMapper.delete(userQueryWrapper); System.out.println(deleted); } sqlæ—¥å¿—è¾“å‡º\n==\u0026gt; Preparing: UPDATE t_user SET is_deleted_ly=1 WHERE is_deleted_ly=0 AND (email IS NULL) ==\u0026gt; Parameters: \u0026lt;== Updates: 1 ä¿®æ”¹\n@Test public void test04() { QueryWrapper\u0026lt;User\u0026gt; userQueryWrapper=new QueryWrapper\u0026lt;\u0026gt;(); //(age\u0026gt;23ä¸”ç”¨æˆ·ååŒ…å«a) æˆ– (é‚®ç®±ä¸ºnull) userQueryWrapper.gt(\u0026#34;age\u0026#34;,23) .like(\u0026#34;name\u0026#34;,\u0026#34;a\u0026#34;) .or() .isNull(\u0026#34;email\u0026#34;); User user=new User(); user.setUserName(\u0026#34;è¢«ä¿®æ”¹äº†\u0026#34;); int deleted = userMapper.update(user,userQueryWrapper); System.out.println(deleted); } sqlæ—¥å¿—æ‰“å°\n==\u0026gt; Preparing: UPDATE t_user SET name=? WHERE is_deleted_ly=0 AND (age \u0026gt; ? AND name LIKE ? OR email IS NULL) ==\u0026gt; Parameters: è¢«ä¿®æ”¹äº†(String), 23(Integer), %a%(String) \u0026lt;== Updates: 1 æ¡ä»¶ä¼˜å…ˆçº§\n@Test public void test05() { QueryWrapper\u0026lt;User\u0026gt; userQueryWrapper = new QueryWrapper\u0026lt;\u0026gt;(); //(age\u0026gt;23ä¸”ç”¨æˆ·ååŒ…å«a) æˆ– (é‚®ç®±ä¸ºnull) userQueryWrapper .like(\u0026#34;name\u0026#34;, \u0026#34;a\u0026#34;) //andé‡Œé¢æ˜¯ä¸€ä¸ªæ¡ä»¶æ„é€ å™¨ .and( userQueryWrapper1 -\u0026gt; userQueryWrapper1.gt(\u0026#34;age\u0026#34;, 20) .or() .isNull(\u0026#34;email\u0026#34;) ); User user = new User(); user.setUserName(\u0026#34;è¢«ä¿®æ”¹äº†\u0026#34;); int deleted = userMapper.update(user, userQueryWrapper); System.out.println(deleted); } sqlæ—¥å¿—è¾“å‡º\n==\u0026gt; Preparing: UPDATE t_user SET name=? WHERE is_deleted_ly=0 AND (name LIKE ? AND (age \u0026gt; ? OR email IS NULL)) ==\u0026gt; Parameters: è¢«ä¿®æ”¹äº†(String), %a%(String), 20(Integer) \u0026lt;== Updates: 1 æ³¨æ„ orä¹Ÿæœ‰ä¼˜å…ˆçº§çš„å‚æ•° åªæŸ¥è¯¢æŸäº›å­—æ®µ\n@Test public void test06() { QueryWrapper\u0026lt;User\u0026gt; userQueryWrapper =new QueryWrapper\u0026lt;\u0026gt;(); userQueryWrapper.select(\u0026#34;uid\u0026#34;,\u0026#34;name\u0026#34;); List\u0026lt;Map\u0026lt;String, Object\u0026gt;\u0026gt; maps = userMapper.selectMaps(userQueryWrapper); System.out.println(maps); } sqlè¾“å‡º\n==\u0026gt; Preparing: SELECT uid,name FROM t_user WHERE is_deleted_ly=0 ==\u0026gt; Parameters: \u0026lt;== Columns: uid, name \u0026lt;== Row: 4, è¢«ä¿®æ”¹äº† \u0026lt;== Row: 5, è¢«ä¿®æ”¹äº† \u0026lt;== Row: 6, å¼ ä¸‰5 \u0026lt;== Row: 7, å¼ ä¸‰6 \u0026lt;== Total: 4 å­æŸ¥è¯¢ å‡è®¾éœ€è¦å®Œæ•´ä¸‹é¢çš„sqlæŸ¥è¯¢ ä»£ç \n@Test public void test7(){ //æŸ¥è¯¢idå°äºç­‰äº100 QueryWrapper\u0026lt;User\u0026gt; userQueryWrapper=new QueryWrapper\u0026lt;\u0026gt;(); userQueryWrapper.inSql(\u0026#34;uid\u0026#34;, \u0026#34;select uid from t_user where uid \u0026lt;= 100\u0026#34;); List\u0026lt;User\u0026gt; users = userMapper.selectList(userQueryWrapper); users.forEach(System.out::println); } sqlè¾“å‡º\n==\u0026gt; Preparing: SELECT uid AS id,name AS userName,age,email,is_deleted_ly FROM t_user WHERE is_deleted_ly=0 AND (uid IN (select uid from t_user where uid \u0026lt;= 100)) ==\u0026gt; Parameters: \u0026lt;== Columns: id, userName, age, email, is_deleted_ly \u0026lt;== Row: 4, è¢«ä¿®æ”¹äº†, 21, test4@baomidou.com, 0 \u0026lt;== Row: 5, è¢«ä¿®æ”¹äº†, 24, emailè¢«ä¿®æ”¹äº†, 0 \u0026lt;== Row: 6, å¼ ä¸‰5, 18, test5@baomidou.com, 0 \u0026lt;== Row: 7, å¼ ä¸‰6, 38, test6@baomidou.com, 0 \u0026lt;== Total: 4 UpdateWrapper\n@Test public void test8(){ //(age\u0026gt;23ä¸”ç”¨æˆ·ååŒ…å«a) æˆ– (é‚®ç®±ä¸ºnull) UpdateWrapper\u0026lt;User\u0026gt; updateWrapper=new UpdateWrapper\u0026lt;\u0026gt;(); updateWrapper.like(\u0026#34;name\u0026#34;,\u0026#34;a\u0026#34;) .and(userUpdateWrapper -\u0026gt; userUpdateWrapper.gt(\u0026#34;age\u0026#34;,23).or().isNotNull(\u0026#34;email\u0026#34;)); updateWrapper.set(\u0026#34;name\u0026#34;,\u0026#34;å°é»‘\u0026#34;).set(\u0026#34;email\u0026#34;,\u0026#34;abc@ly.com\u0026#34;); userMapper.update(null,updateWrapper); } sqlæ—¥å¿—è¾“å‡º\n==\u0026gt; Preparing: UPDATE t_user SET name=?,email=? WHERE is_deleted_ly=0 AND (name LIKE ? AND (age \u0026gt; ? OR email IS NOT NULL)) ==\u0026gt; Parameters: å°é»‘(String), abc@ly.com(String), %a%(String), 23(Integer) \u0026lt;== Updates: 0 æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œç»„è£…æ¡ä»¶\n@Test public void test9(){ String username=\u0026#34;\u0026#34;; Integer ageBegin=null; Integer ageEnd=30; QueryWrapper\u0026lt;User\u0026gt; queryWrapper=new QueryWrapper\u0026lt;\u0026gt;(); if(StringUtils.isNotBlank(username)){ queryWrapper.like(\u0026#34;user_name\u0026#34;,username); } if( ageBegin!=null){ queryWrapper.gt(\u0026#34;age\u0026#34;,ageBegin); } if( ageEnd!=null){ queryWrapper.le(\u0026#34;age\u0026#34;,ageEnd); } userMapper.selectList(queryWrapper); } sqlæ—¥å¿—æ‰“å°\n==\u0026gt; Preparing: SELECT uid AS id,name AS userName,age,email,is_deleted_ly FROM t_user WHERE is_deleted_ly=0 AND (age \u0026lt;= ?) ==\u0026gt; Parameters: 30(Integer) \u0026lt;== Columns: id, userName, age, email, is_deleted_ly \u0026lt;== Row: 4, è¢«ä¿®æ”¹äº†, 21, test4@baomidou.com, 0 \u0026lt;== Row: 5, è¢«ä¿®æ”¹äº†, 24, emailè¢«ä¿®æ”¹äº†, 0 \u0026lt;== Row: 6, å¼ ä¸‰5, 18, test5@baomidou.com, 0 \u0026lt;== Total: 3 ä½¿ç”¨conditionå¤„ç†æ¡ä»¶\n@Test public void test10(){ String username=\u0026#34;abc\u0026#34;; Integer ageBegin=null; Integer ageEnd=30; QueryWrapper\u0026lt;User\u0026gt; queryWrapper=new QueryWrapper\u0026lt;\u0026gt;(); queryWrapper.like(StringUtils.isNotBlank(username),\u0026#34;name\u0026#34;,username) .ge(ageBegin!=null,\u0026#34;age\u0026#34;,ageBegin); userMapper.selectList(queryWrapper); } sqlæ—¥å¿—è¾“å‡º\n==\u0026gt; Preparing: SELECT uid AS id,name AS userName,age,email,is_deleted_ly FROM t_user WHERE is_deleted_ly=0 AND (name LIKE ?) ==\u0026gt; Parameters: %abc%(String) \u0026lt;== Total: 0 "},{"id":185,"href":"/zh/docs/study/MyBatis-Plus/bl_sgg/12-18/","title":"mybatis-plus-sgg-12-18","section":"åŸºç¡€(å°šç¡…è°·)_","content":" BaseMapper # æ³¨ï¼šä½¿ç”¨ mvn dependency:resolve -Dclassifier=sources æ¥è·å¾—mapperæºç \nä¸€äº›æ¥å£ä»‹ç»\n/** * æ’å…¥ä¸€æ¡è®°å½• * * @param entity å®ä½“å¯¹è±¡ */ int insert(T entity); /** * æ ¹æ® ID åˆ é™¤ * * @param id ä¸»é”®ID */ int deleteById(Serializable id); /** * æ ¹æ®å®ä½“(ID)åˆ é™¤ * * @param entity å®ä½“å¯¹è±¡ * @since 3.4.4 */ int deleteById(T entity); /** * æ ¹æ® columnMap æ¡ä»¶ï¼Œåˆ é™¤è®°å½• * * @param columnMap è¡¨å­—æ®µ map å¯¹è±¡ */ int deleteByMap(@Param(Constants.COLUMN_MAP) Map\u0026lt;String, Object\u0026gt; columnMap); /** * æ ¹æ® entity æ¡ä»¶ï¼Œåˆ é™¤è®°å½• * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸º null,é‡Œé¢çš„ entity ç”¨äºç”Ÿæˆ where è¯­å¥ï¼‰ */ int delete(@Param(Constants.WRAPPER) Wrapper\u0026lt;T\u0026gt; queryWrapper); /** * åˆ é™¤ï¼ˆæ ¹æ®IDæˆ–å®ä½“ æ‰¹é‡åˆ é™¤ï¼‰ * * @param idList ä¸»é”®IDåˆ—è¡¨æˆ–å®ä½“åˆ—è¡¨(ä¸èƒ½ä¸º null ä»¥åŠ empty) */ int deleteBatchIds(@Param(Constants.COLLECTION) Collection\u0026lt;?\u0026gt; idList); /** * æ ¹æ® ID ä¿®æ”¹ * * @param entity å®ä½“å¯¹è±¡ */ int updateById(@Param(Constants.ENTITY) T entity); /** * æ ¹æ® whereEntity æ¡ä»¶ï¼Œæ›´æ–°è®°å½• * * @param entity å®ä½“å¯¹è±¡ (set æ¡ä»¶å€¼,å¯ä»¥ä¸º null) * @param updateWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸º null,é‡Œé¢çš„ entity ç”¨äºç”Ÿæˆ where è¯­å¥ï¼‰ */ int update(@Param(Constants.ENTITY) T entity, @Param(Constants.WRAPPER) Wrapper\u0026lt;T\u0026gt; updateWrapper); /** * æ ¹æ® ID æŸ¥è¯¢ * * @param id ä¸»é”®ID */ T selectById(Serializable id); /** * æŸ¥è¯¢ï¼ˆæ ¹æ®ID æ‰¹é‡æŸ¥è¯¢ï¼‰ * * @param idList ä¸»é”®IDåˆ—è¡¨(ä¸èƒ½ä¸º null ä»¥åŠ empty) */ List\u0026lt;T\u0026gt; selectBatchIds(@Param(Constants.COLLECTION) Collection\u0026lt;? extends Serializable\u0026gt; idList); /** * æŸ¥è¯¢ï¼ˆæ ¹æ® columnMap æ¡ä»¶ï¼‰ * * @param columnMap è¡¨å­—æ®µ map å¯¹è±¡ */ List\u0026lt;T\u0026gt; selectByMap(@Param(Constants.COLUMN_MAP) Map\u0026lt;String, Object\u0026gt; columnMap); /** * æ ¹æ® entity æ¡ä»¶ï¼ŒæŸ¥è¯¢ä¸€æ¡è®°å½• * \u0026lt;p\u0026gt;æŸ¥è¯¢ä¸€æ¡è®°å½•ï¼Œä¾‹å¦‚ qw.last(\u0026#34;limit 1\u0026#34;) é™åˆ¶å–ä¸€æ¡è®°å½•, æ³¨æ„ï¼šå¤šæ¡æ•°æ®ä¼šæŠ¥å¼‚å¸¸\u0026lt;/p\u0026gt; * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸º nullï¼‰ */ default T selectOne(@Param(Constants.WRAPPER) Wrapper\u0026lt;T\u0026gt; queryWrapper) { List\u0026lt;T\u0026gt; ts = this.selectList(queryWrapper); if (CollectionUtils.isNotEmpty(ts)) { if (ts.size() != 1) { throw ExceptionUtils.mpe(\u0026#34;One record is expected, but the query result is multiple records\u0026#34;); } return ts.get(0); } return null; } /** * æ ¹æ® Wrapper æ¡ä»¶ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨è®°å½• * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±» * @return */ default boolean exists(Wrapper\u0026lt;T\u0026gt; queryWrapper) { Long count = this.selectCount(queryWrapper); return null != count \u0026amp;\u0026amp; count \u0026gt; 0; } /** * æ ¹æ® Wrapper æ¡ä»¶ï¼ŒæŸ¥è¯¢æ€»è®°å½•æ•° * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸º nullï¼‰ */ Long selectCount(@Param(Constants.WRAPPER) Wrapper\u0026lt;T\u0026gt; queryWrapper); /** * æ ¹æ® entity æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½• * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸º nullï¼‰ */ List\u0026lt;T\u0026gt; selectList(@Param(Constants.WRAPPER) Wrapper\u0026lt;T\u0026gt; queryWrapper); /** * æ ¹æ® Wrapper æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½• * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸º nullï¼‰ */ List\u0026lt;Map\u0026lt;String, Object\u0026gt;\u0026gt; selectMaps(@Param(Constants.WRAPPER) Wrapper\u0026lt;T\u0026gt; queryWrapper); /** * æ ¹æ® Wrapper æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½• * \u0026lt;p\u0026gt;æ³¨æ„ï¼š åªè¿”å›ç¬¬ä¸€ä¸ªå­—æ®µçš„å€¼\u0026lt;/p\u0026gt; * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸º nullï¼‰ */ List\u0026lt;Object\u0026gt; selectObjs(@Param(Constants.WRAPPER) Wrapper\u0026lt;T\u0026gt; queryWrapper); /** * æ ¹æ® entity æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½•ï¼ˆå¹¶ç¿»é¡µï¼‰ * * @param page åˆ†é¡µæŸ¥è¯¢æ¡ä»¶ï¼ˆå¯ä»¥ä¸º RowBounds.DEFAULTï¼‰ * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸º nullï¼‰ */ \u0026lt;P extends IPage\u0026lt;T\u0026gt;\u0026gt; P selectPage(P page, @Param(Constants.WRAPPER) Wrapper\u0026lt;T\u0026gt; queryWrapper); /** * æ ¹æ® Wrapper æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½•ï¼ˆå¹¶ç¿»é¡µï¼‰ * * @param page åˆ†é¡µæŸ¥è¯¢æ¡ä»¶ * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±» */ \u0026lt;P extends IPage\u0026lt;Map\u0026lt;String, Object\u0026gt;\u0026gt;\u0026gt; P selectMapsPage(P page, @Param(Constants.WRAPPER) Wrapper\u0026lt;T\u0026gt; queryWrapper); BaseMapperæµ‹è¯•\næ–°å¢\n@Test public void testInsert(){ User user=new User(); user.setName(\u0026#34;å°æ˜\u0026#34;); user.setAge(11); user.setEmail(\u0026#34;xx@163.com\u0026#34;); int insertNum = userMapper.insert(user); System.out.println(\u0026#34;result:\u0026#34;+insertNum); System.out.println(\u0026#34;result:\u0026#34;+user); } sqlæ—¥å¿—è¾“å‡º\n==\u0026gt; Preparing: INSERT INTO user ( id, name, age, email ) VALUES ( ?, ?, ?, ? ) ==\u0026gt; Parameters: 1532542803866394625(Long), å°æ˜(String), 11(Integer), xx@163.com(String) \u0026lt;== Updates: 1 åˆ é™¤\nidåˆ é™¤\n@Test public void testDelete(){ int result = userMapper.deleteById(1532542803866394625L); System.out.println(result); } sqlæ—¥å¿—è¾“å‡º\n==\u0026gt; Preparing: DELETE FROM user WHERE id=? ==\u0026gt; Parameters: 1532542803866394625(Long) \u0026lt;== Updates: 1 Mapåˆ é™¤\n@Test public void testDeleteByMap(){ Map\u0026lt;String,Object\u0026gt; hash=new HashMap\u0026lt;\u0026gt;(); hash.put(\u0026#34;name\u0026#34;,\u0026#34;Sandy\u0026#34;); hash.put(\u0026#34;age\u0026#34;,\u0026#34;1234\u0026#34;); int result = userMapper.deleteByMap(hash); System.out.println(result); } sqlæ—¥å¿—è¾“å‡º\n==\u0026gt; Preparing: DELETE FROM user WHERE name = ? AND age = ? ==\u0026gt; Parameters: Sandy(String), 1234(String) \u0026lt;== Updates: 0 æ‰¹é‡åˆ é™¤\n@Test public void testDeleteByIds(){ List\u0026lt;Long\u0026gt; ids = Arrays.asList(1L, 2L, 5L); int result = userMapper.deleteBatchIds(ids); System.out.println(result); } sqlæ—¥å¿—è¾“å‡º\n==\u0026gt; Preparing: DELETE FROM user WHERE id IN ( ? , ? , ? ) ==\u0026gt; Parameters: 1(Long), 2(Long), 5(Long) \u0026lt;== Updates: 3 ä¿®æ”¹\næ ¹æ®idä¿®æ”¹\n@Test public void testUpdateById (){ User user=new User(); user.setId(5L); user.setEmail(\u0026#34;emailè¢«ä¿®æ”¹äº†\u0026#34; ); int result = userMapper.updateById(user); System.out.println(result); } sqlæ—¥å¿—è¾“å‡º\n==\u0026gt; Preparing: UPDATE user SET email=? WHERE id=? ==\u0026gt; Parameters: emailè¢«ä¿®æ”¹äº†(String), 5(Long) \u0026lt;== Updates: 1 æ³¨æ„ï¼Œè¿™é‡Œä¸ä¼šä¿®æ”¹å¦ä¸€ä¸ªå­—æ®µnameçš„å€¼\næŸ¥è¯¢\né€šè¿‡idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯\n@Test public void testSelectById (){ User user = userMapper.selectById(3); System.out.println(user); } sqlæ—¥å¿—è¾“å‡º\n==\u0026gt; Preparing: SELECT id,name,age,email FROM user WHERE id=? ==\u0026gt; Parameters: 3(Integer) \u0026lt;== Columns: id, name, age, email \u0026lt;== Row: 3, Tom, 28, test3@baomidou.com \u0026lt;== Total: 1 é€šè¿‡idé›†åˆæŸ¥è¯¢\n@Test public void testSelectByIds() { List\u0026lt;User\u0026gt; users = userMapper.selectBatchIds(Arrays.asList(1L, 2L, 5L)); users.forEach(System.out::println); } sqlæ—¥å¿—è¾“å‡º\n==\u0026gt; Preparing: SELECT id,name,age,email FROM user WHERE id IN ( ? , ? , ? ) ==\u0026gt; Parameters: 1(Long), 2(Long), 5(Long) \u0026lt;== Columns: id, name, age, email \u0026lt;== Row: 1, Jone, 18, test1@baomidou.com \u0026lt;== Row: 2, Jack, 20, test2@baomidou.com \u0026lt;== Row: 5, Billie, 24, emailè¢«ä¿®æ”¹äº† \u0026lt;== Total: 3 é€šè¿‡mapæŸ¥è¯¢\n@Test public void testSelectMap() { Map\u0026lt;String, Object\u0026gt; hashMap = new HashMap\u0026lt;\u0026gt;(); hashMap.put(\u0026#34;name\u0026#34;,\u0026#34;Jon\u0026#34;); hashMap.put(\u0026#34;age\u0026#34;,18); List\u0026lt;User\u0026gt; users = userMapper.selectByMap(hashMap); users.forEach(System.out::println); } sqlæ—¥å¿—è¾“å‡º\n==\u0026gt; Preparing: SELECT id,name,age,email FROM user WHERE name = ? AND age = ? ==\u0026gt; Parameters: Tom(String), 18(Integer) \u0026lt;== Columns: id, name, age, email \u0026lt;== Row: 3, Tom, 18, test3@baomidou.com \u0026lt;== Total: 1 æŸ¥è¯¢æ‰€æœ‰æ•°æ®\n@Test public void testSelectAll() { List\u0026lt;User\u0026gt; users = userMapper.selectList(null); users.forEach(System.out::println); } sqlæ—¥å¿—è¾“å‡º\n==\u0026gt; Preparing: SELECT id,name,age,email FROM user ==\u0026gt; Parameters: \u0026lt;== Columns: id, name, age, email \u0026lt;== Row: 1, Jone, 18, test1@baomidou.com \u0026lt;== Row: 2, Jack, 20, test2@baomidou.com \u0026lt;== Row: 3, Tom, 18, test3@baomidou.com \u0026lt;== Row: 4, Sandy, 21, test4@baomidou.com \u0026lt;== Row: 5, Billie, 24, emailè¢«ä¿®æ”¹äº† \u0026lt;== Total: 5 è‡ªå®šä¹‰åŠŸèƒ½ # mapperæ˜ å°„æ–‡ä»¶é»˜è®¤ä½ç½®\nmybatis-plus: configuration: log-impl: org.apache.ibatis.logging.stdout.StdOutImpl mapper-locations: - classpath:/mapper/**/*.xml #é»˜è®¤ä½ç½® æ˜ å°„æ–‡ä»¶é…ç½® /mapper/UserMapper.xml\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34; ?\u0026gt; \u0026lt;!DOCTYPE mapper PUBLIC \u0026#34;-//mybatis.org//DTD Mapper 3.0//EN\u0026#34; \u0026#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd\u0026#34; \u0026gt; \u0026lt;mapper namespace=\u0026#34;com.ly.mybatisplus.mapper.UserMapper\u0026#34;\u0026gt; \u0026lt;select id=\u0026#34;selectMapById\u0026#34; resultType=\u0026#34;map\u0026#34;\u0026gt; select id,name,age,email from user where id = #{id} and 1=1 \u0026lt;/select\u0026gt; \u0026lt;/mapper\u0026gt; ä»£ç æ‰§è¡Œ\n@Test public void testSelectCustom() { Map\u0026lt;String, Object\u0026gt; map = userMapper.selectMapById(2L); System.out.println(map); } sqlæ—¥å¿—æ‰§è¡Œ\n==\u0026gt; Preparing: select id,name,age,email from user where id = ? and 1=1 ==\u0026gt; Parameters: 2(Long) \u0026lt;== Columns: id, name, age, email \u0026lt;== Row: 2, Jack, 20, test2@baomidou.com \u0026lt;== Total: 1 é€šç”¨Serviceæ¥å£ # å’Œé€šç”¨Mapperçš„æ–¹æ³•åæœ‰åŒºåˆ† Service CRUDä¸­\nä½¿ç”¨getæŸ¥è¯¢ã€mapper-selectã€‘ removeåˆ é™¤ ã€mapper-deleteã€‘ listæŸ¥è¯¢é›†åˆ pageåˆ†é¡µ IServiceæºç \n/** * é¡¶çº§ Service * * @author hubin * @since 2018-06-23 */ public interface IService\u0026lt;T\u0026gt; { /** * é»˜è®¤æ‰¹æ¬¡æäº¤æ•°é‡ */ int DEFAULT_BATCH_SIZE = 1000; /** * æ’å…¥ä¸€æ¡è®°å½•ï¼ˆé€‰æ‹©å­—æ®µï¼Œç­–ç•¥æ’å…¥ï¼‰ * * @param entity å®ä½“å¯¹è±¡ */ default boolean save(T entity) { return SqlHelper.retBool(getBaseMapper().insert(entity)); } /** * æ’å…¥ï¼ˆæ‰¹é‡ï¼‰ * * @param entityList å®ä½“å¯¹è±¡é›†åˆ */ @Transactional(rollbackFor = Exception.class) default boolean saveBatch(Collection\u0026lt;T\u0026gt; entityList) { return saveBatch(entityList, DEFAULT_BATCH_SIZE); } /** * æ’å…¥ï¼ˆæ‰¹é‡ï¼‰ * * @param entityList å®ä½“å¯¹è±¡é›†åˆ * @param batchSize æ’å…¥æ‰¹æ¬¡æ•°é‡ */ boolean saveBatch(Collection\u0026lt;T\u0026gt; entityList, int batchSize); /** * æ‰¹é‡ä¿®æ”¹æ’å…¥ * * @param entityList å®ä½“å¯¹è±¡é›†åˆ */ @Transactional(rollbackFor = Exception.class) default boolean saveOrUpdateBatch(Collection\u0026lt;T\u0026gt; entityList) { return saveOrUpdateBatch(entityList, DEFAULT_BATCH_SIZE); } /** * æ‰¹é‡ä¿®æ”¹æ’å…¥ * * @param entityList å®ä½“å¯¹è±¡é›†åˆ * @param batchSize æ¯æ¬¡çš„æ•°é‡ */ boolean saveOrUpdateBatch(Collection\u0026lt;T\u0026gt; entityList, int batchSize); /** * æ ¹æ® ID åˆ é™¤ * * @param id ä¸»é”®ID */ default boolean removeById(Serializable id) { return SqlHelper.retBool(getBaseMapper().deleteById(id)); } /** * æ ¹æ® ID åˆ é™¤ * * @param id ä¸»é”®(ç±»å‹å¿…é¡»ä¸å®ä½“ç±»å‹å­—æ®µä¿æŒä¸€è‡´) * @param useFill æ˜¯å¦å¯ç”¨å¡«å……(ä¸ºtrueçš„æƒ…å†µ,ä¼šå°†å…¥å‚è½¬æ¢å®ä½“è¿›è¡Œdeleteåˆ é™¤) * @return åˆ é™¤ç»“æœ * @since 3.5.0 */ default boolean removeById(Serializable id, boolean useFill) { throw new UnsupportedOperationException(\u0026#34;ä¸æ”¯æŒçš„æ–¹æ³•!\u0026#34;); } /** * æ ¹æ®å®ä½“(ID)åˆ é™¤ * * @param entity å®ä½“ * @since 3.4.4 */ default boolean removeById(T entity) { return SqlHelper.retBool(getBaseMapper().deleteById(entity)); } /** * æ ¹æ® columnMap æ¡ä»¶ï¼Œåˆ é™¤è®°å½• * * @param columnMap è¡¨å­—æ®µ map å¯¹è±¡ */ default boolean removeByMap(Map\u0026lt;String, Object\u0026gt; columnMap) { Assert.notEmpty(columnMap, \u0026#34;error: columnMap must not be empty\u0026#34;); return SqlHelper.retBool(getBaseMapper().deleteByMap(columnMap)); } /** * æ ¹æ® entity æ¡ä»¶ï¼Œåˆ é™¤è®°å½• * * @param queryWrapper å®ä½“åŒ…è£…ç±» {@link com.baomidou.mybatisplus.core.conditions.query.QueryWrapper} */ default boolean remove(Wrapper\u0026lt;T\u0026gt; queryWrapper) { return SqlHelper.retBool(getBaseMapper().delete(queryWrapper)); } /** * åˆ é™¤ï¼ˆæ ¹æ®ID æ‰¹é‡åˆ é™¤ï¼‰ * * @param list ä¸»é”®IDæˆ–å®ä½“åˆ—è¡¨ */ default boolean removeByIds(Collection\u0026lt;?\u0026gt; list) { if (CollectionUtils.isEmpty(list)) { return false; } return SqlHelper.retBool(getBaseMapper().deleteBatchIds(list)); } /** * æ‰¹é‡åˆ é™¤ * * @param list ä¸»é”®IDæˆ–å®ä½“åˆ—è¡¨ * @param useFill æ˜¯å¦å¡«å……(ä¸ºtrueçš„æƒ…å†µ,ä¼šå°†å…¥å‚è½¬æ¢å®ä½“è¿›è¡Œdeleteåˆ é™¤) * @return åˆ é™¤ç»“æœ * @since 3.5.0 */ @Transactional(rollbackFor = Exception.class) default boolean removeByIds(Collection\u0026lt;?\u0026gt; list, boolean useFill) { if (CollectionUtils.isEmpty(list)) { return false; } if (useFill) { return removeBatchByIds(list, true); } return SqlHelper.retBool(getBaseMapper().deleteBatchIds(list)); } /** * æ‰¹é‡åˆ é™¤(jdbcæ‰¹é‡æäº¤) * * @param list ä¸»é”®IDæˆ–å®ä½“åˆ—è¡¨(ä¸»é”®IDç±»å‹å¿…é¡»ä¸å®ä½“ç±»å‹å­—æ®µä¿æŒä¸€è‡´) * @return åˆ é™¤ç»“æœ * @since 3.5.0 */ @Transactional(rollbackFor = Exception.class) default boolean removeBatchByIds(Collection\u0026lt;?\u0026gt; list) { return removeBatchByIds(list, DEFAULT_BATCH_SIZE); } /** * æ‰¹é‡åˆ é™¤(jdbcæ‰¹é‡æäº¤) * * @param list ä¸»é”®IDæˆ–å®ä½“åˆ—è¡¨(ä¸»é”®IDç±»å‹å¿…é¡»ä¸å®ä½“ç±»å‹å­—æ®µä¿æŒä¸€è‡´) * @param useFill æ˜¯å¦å¯ç”¨å¡«å……(ä¸ºtrueçš„æƒ…å†µ,ä¼šå°†å…¥å‚è½¬æ¢å®ä½“è¿›è¡Œdeleteåˆ é™¤) * @return åˆ é™¤ç»“æœ * @since 3.5.0 */ @Transactional(rollbackFor = Exception.class) default boolean removeBatchByIds(Collection\u0026lt;?\u0026gt; list, boolean useFill) { return removeBatchByIds(list, DEFAULT_BATCH_SIZE, useFill); } /** * æ‰¹é‡åˆ é™¤(jdbcæ‰¹é‡æäº¤) * * @param list ä¸»é”®IDæˆ–å®ä½“åˆ—è¡¨ * @param batchSize æ‰¹æ¬¡å¤§å° * @return åˆ é™¤ç»“æœ * @since 3.5.0 */ default boolean removeBatchByIds(Collection\u0026lt;?\u0026gt; list, int batchSize) { throw new UnsupportedOperationException(\u0026#34;ä¸æ”¯æŒçš„æ–¹æ³•!\u0026#34;); } /** * æ‰¹é‡åˆ é™¤(jdbcæ‰¹é‡æäº¤) * * @param list ä¸»é”®IDæˆ–å®ä½“åˆ—è¡¨ * @param batchSize æ‰¹æ¬¡å¤§å° * @param useFill æ˜¯å¦å¯ç”¨å¡«å……(ä¸ºtrueçš„æƒ…å†µ,ä¼šå°†å…¥å‚è½¬æ¢å®ä½“è¿›è¡Œdeleteåˆ é™¤) * @return åˆ é™¤ç»“æœ * @since 3.5.0 */ default boolean removeBatchByIds(Collection\u0026lt;?\u0026gt; list, int batchSize, boolean useFill) { throw new UnsupportedOperationException(\u0026#34;ä¸æ”¯æŒçš„æ–¹æ³•!\u0026#34;); } /** * æ ¹æ® ID é€‰æ‹©ä¿®æ”¹ * * @param entity å®ä½“å¯¹è±¡ */ default boolean updateById(T entity) { return SqlHelper.retBool(getBaseMapper().updateById(entity)); } /** * æ ¹æ® UpdateWrapper æ¡ä»¶ï¼Œæ›´æ–°è®°å½• éœ€è¦è®¾ç½®sqlset * * @param updateWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±» {@link com.baomidou.mybatisplus.core.conditions.update.UpdateWrapper} */ default boolean update(Wrapper\u0026lt;T\u0026gt; updateWrapper) { return update(null, updateWrapper); } /** * æ ¹æ® whereEntity æ¡ä»¶ï¼Œæ›´æ–°è®°å½• * * @param entity å®ä½“å¯¹è±¡ * @param updateWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±» {@link com.baomidou.mybatisplus.core.conditions.update.UpdateWrapper} */ default boolean update(T entity, Wrapper\u0026lt;T\u0026gt; updateWrapper) { return SqlHelper.retBool(getBaseMapper().update(entity, updateWrapper)); } /** * æ ¹æ®ID æ‰¹é‡æ›´æ–° * * @param entityList å®ä½“å¯¹è±¡é›†åˆ */ @Transactional(rollbackFor = Exception.class) default boolean updateBatchById(Collection\u0026lt;T\u0026gt; entityList) { return updateBatchById(entityList, DEFAULT_BATCH_SIZE); } /** * æ ¹æ®ID æ‰¹é‡æ›´æ–° * * @param entityList å®ä½“å¯¹è±¡é›†åˆ * @param batchSize æ›´æ–°æ‰¹æ¬¡æ•°é‡ */ boolean updateBatchById(Collection\u0026lt;T\u0026gt; entityList, int batchSize); /** * TableId æ³¨è§£å­˜åœ¨æ›´æ–°è®°å½•ï¼Œå¦æ’å…¥ä¸€æ¡è®°å½• * * @param entity å®ä½“å¯¹è±¡ */ boolean saveOrUpdate(T entity); /** * æ ¹æ® ID æŸ¥è¯¢ * * @param id ä¸»é”®ID */ default T getById(Serializable id) { return getBaseMapper().selectById(id); } /** * æŸ¥è¯¢ï¼ˆæ ¹æ®ID æ‰¹é‡æŸ¥è¯¢ï¼‰ * * @param idList ä¸»é”®IDåˆ—è¡¨ */ default List\u0026lt;T\u0026gt; listByIds(Collection\u0026lt;? extends Serializable\u0026gt; idList) { return getBaseMapper().selectBatchIds(idList); } /** * æŸ¥è¯¢ï¼ˆæ ¹æ® columnMap æ¡ä»¶ï¼‰ * * @param columnMap è¡¨å­—æ®µ map å¯¹è±¡ */ default List\u0026lt;T\u0026gt; listByMap(Map\u0026lt;String, Object\u0026gt; columnMap) { return getBaseMapper().selectByMap(columnMap); } /** * æ ¹æ® Wrapperï¼ŒæŸ¥è¯¢ä¸€æ¡è®°å½• \u0026lt;br/\u0026gt; * \u0026lt;p\u0026gt;ç»“æœé›†ï¼Œå¦‚æœæ˜¯å¤šä¸ªä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œéšæœºå–ä¸€æ¡åŠ ä¸Šé™åˆ¶æ¡ä»¶ wrapper.last(\u0026#34;LIMIT 1\u0026#34;)\u0026lt;/p\u0026gt; * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±» {@link com.baomidou.mybatisplus.core.conditions.query.QueryWrapper} */ default T getOne(Wrapper\u0026lt;T\u0026gt; queryWrapper) { return getOne(queryWrapper, true); } /** * æ ¹æ® Wrapperï¼ŒæŸ¥è¯¢ä¸€æ¡è®°å½• * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±» {@link com.baomidou.mybatisplus.core.conditions.query.QueryWrapper} * @param throwEx æœ‰å¤šä¸ª result æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ */ T getOne(Wrapper\u0026lt;T\u0026gt; queryWrapper, boolean throwEx); /** * æ ¹æ® Wrapperï¼ŒæŸ¥è¯¢ä¸€æ¡è®°å½• * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±» {@link com.baomidou.mybatisplus.core.conditions.query.QueryWrapper} */ Map\u0026lt;String, Object\u0026gt; getMap(Wrapper\u0026lt;T\u0026gt; queryWrapper); /** * æ ¹æ® Wrapperï¼ŒæŸ¥è¯¢ä¸€æ¡è®°å½• * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±» {@link com.baomidou.mybatisplus.core.conditions.query.QueryWrapper} * @param mapper è½¬æ¢å‡½æ•° */ \u0026lt;V\u0026gt; V getObj(Wrapper\u0026lt;T\u0026gt; queryWrapper, Function\u0026lt;? super Object, V\u0026gt; mapper); /** * æŸ¥è¯¢æ€»è®°å½•æ•° * * @see Wrappers#emptyWrapper() */ default long count() { return count(Wrappers.emptyWrapper()); } /** * æ ¹æ® Wrapper æ¡ä»¶ï¼ŒæŸ¥è¯¢æ€»è®°å½•æ•° * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±» {@link com.baomidou.mybatisplus.core.conditions.query.QueryWrapper} */ default long count(Wrapper\u0026lt;T\u0026gt; queryWrapper) { return SqlHelper.retCount(getBaseMapper().selectCount(queryWrapper)); } /** * æŸ¥è¯¢åˆ—è¡¨ * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±» {@link com.baomidou.mybatisplus.core.conditions.query.QueryWrapper} */ default List\u0026lt;T\u0026gt; list(Wrapper\u0026lt;T\u0026gt; queryWrapper) { return getBaseMapper().selectList(queryWrapper); } /** * æŸ¥è¯¢æ‰€æœ‰ * * @see Wrappers#emptyWrapper() */ default List\u0026lt;T\u0026gt; list() { return list(Wrappers.emptyWrapper()); } /** * ç¿»é¡µæŸ¥è¯¢ * * @param page ç¿»é¡µå¯¹è±¡ * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±» {@link com.baomidou.mybatisplus.core.conditions.query.QueryWrapper} */ default \u0026lt;E extends IPage\u0026lt;T\u0026gt;\u0026gt; E page(E page, Wrapper\u0026lt;T\u0026gt; queryWrapper) { return getBaseMapper().selectPage(page, queryWrapper); } /** * æ— æ¡ä»¶ç¿»é¡µæŸ¥è¯¢ * * @param page ç¿»é¡µå¯¹è±¡ * @see Wrappers#emptyWrapper() */ default \u0026lt;E extends IPage\u0026lt;T\u0026gt;\u0026gt; E page(E page) { return page(page, Wrappers.emptyWrapper()); } /** * æŸ¥è¯¢åˆ—è¡¨ * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±» {@link com.baomidou.mybatisplus.core.conditions.query.QueryWrapper} */ default List\u0026lt;Map\u0026lt;String, Object\u0026gt;\u0026gt; listMaps(Wrapper\u0026lt;T\u0026gt; queryWrapper) { return getBaseMapper().selectMaps(queryWrapper); } /** * æŸ¥è¯¢æ‰€æœ‰åˆ—è¡¨ * * @see Wrappers#emptyWrapper() */ default List\u0026lt;Map\u0026lt;String, Object\u0026gt;\u0026gt; listMaps() { return listMaps(Wrappers.emptyWrapper()); } /** * æŸ¥è¯¢å…¨éƒ¨è®°å½• */ default List\u0026lt;Object\u0026gt; listObjs() { return listObjs(Function.identity()); } /** * æŸ¥è¯¢å…¨éƒ¨è®°å½• * * @param mapper è½¬æ¢å‡½æ•° */ default \u0026lt;V\u0026gt; List\u0026lt;V\u0026gt; listObjs(Function\u0026lt;? super Object, V\u0026gt; mapper) { return listObjs(Wrappers.emptyWrapper(), mapper); } /** * æ ¹æ® Wrapper æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½• * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±» {@link com.baomidou.mybatisplus.core.conditions.query.QueryWrapper} */ default List\u0026lt;Object\u0026gt; listObjs(Wrapper\u0026lt;T\u0026gt; queryWrapper) { return listObjs(queryWrapper, Function.identity()); } /** * æ ¹æ® Wrapper æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½• * * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±» {@link com.baomidou.mybatisplus.core.conditions.query.QueryWrapper} * @param mapper è½¬æ¢å‡½æ•° */ default \u0026lt;V\u0026gt; List\u0026lt;V\u0026gt; listObjs(Wrapper\u0026lt;T\u0026gt; queryWrapper, Function\u0026lt;? super Object, V\u0026gt; mapper) { return getBaseMapper().selectObjs(queryWrapper).stream().filter(Objects::nonNull).map(mapper).collect(Collectors.toList()); } /** * ç¿»é¡µæŸ¥è¯¢ * * @param page ç¿»é¡µå¯¹è±¡ * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±» {@link com.baomidou.mybatisplus.core.conditions.query.QueryWrapper} */ default \u0026lt;E extends IPage\u0026lt;Map\u0026lt;String, Object\u0026gt;\u0026gt;\u0026gt; E pageMaps(E page, Wrapper\u0026lt;T\u0026gt; queryWrapper) { return getBaseMapper().selectMapsPage(page, queryWrapper); } /** * æ— æ¡ä»¶ç¿»é¡µæŸ¥è¯¢ * * @param page ç¿»é¡µå¯¹è±¡ * @see Wrappers#emptyWrapper() */ default \u0026lt;E extends IPage\u0026lt;Map\u0026lt;String, Object\u0026gt;\u0026gt;\u0026gt; E pageMaps(E page) { return pageMaps(page, Wrappers.emptyWrapper()); } /** * è·å–å¯¹åº” entity çš„ BaseMapper * * @return BaseMapper */ BaseMapper\u0026lt;T\u0026gt; getBaseMapper(); /** * è·å– entity çš„ class * * @return {@link Class\u0026lt;T\u0026gt;} */ Class\u0026lt;T\u0026gt; getEntityClass(); /** * ä»¥ä¸‹çš„æ–¹æ³•ä½¿ç”¨ä»‹ç»: * * ä¸€. åç§°ä»‹ç» * 1. æ–¹æ³•åå¸¦æœ‰ query çš„ä¸ºå¯¹æ•°æ®çš„æŸ¥è¯¢æ“ä½œ, æ–¹æ³•åå¸¦æœ‰ update çš„ä¸ºå¯¹æ•°æ®çš„ä¿®æ”¹æ“ä½œ * 2. æ–¹æ³•åå¸¦æœ‰ lambda çš„ä¸ºå†…éƒ¨æ–¹æ³•å…¥å‚ column æ”¯æŒå‡½æ•°å¼çš„ * äºŒ. æ”¯æŒä»‹ç» * * 1. æ–¹æ³•åå¸¦æœ‰ query çš„æ”¯æŒä»¥ {@link ChainQuery} å†…éƒ¨çš„æ–¹æ³•åç»“å°¾è¿›è¡Œæ•°æ®æŸ¥è¯¢æ“ä½œ * 2. æ–¹æ³•åå¸¦æœ‰ update çš„æ”¯æŒä»¥ {@link ChainUpdate} å†…éƒ¨çš„æ–¹æ³•åä¸ºç»“å°¾è¿›è¡Œæ•°æ®ä¿®æ”¹æ“ä½œ * * ä¸‰. ä½¿ç”¨ç¤ºä¾‹,åªç”¨ä¸å¸¦ lambda çš„æ–¹æ³•å„å±•ç¤ºä¸€ä¸ªä¾‹å­,å…¶ä»–ç±»æ¨ * 1. æ ¹æ®æ¡ä»¶è·å–ä¸€æ¡æ•°æ®: `query().eq(\u0026#34;column\u0026#34;, value).one()` * 2. æ ¹æ®æ¡ä»¶åˆ é™¤ä¸€æ¡æ•°æ®: `update().eq(\u0026#34;column\u0026#34;, value).remove()` * */ /** * é“¾å¼æŸ¥è¯¢ æ™®é€š * * @return QueryWrapper çš„åŒ…è£…ç±» */ default QueryChainWrapper\u0026lt;T\u0026gt; query() { return ChainWrappers.queryChain(getBaseMapper()); } /** * é“¾å¼æŸ¥è¯¢ lambda å¼ * \u0026lt;p\u0026gt;æ³¨æ„ï¼šä¸æ”¯æŒ Kotlin \u0026lt;/p\u0026gt; * * @return LambdaQueryWrapper çš„åŒ…è£…ç±» */ default LambdaQueryChainWrapper\u0026lt;T\u0026gt; lambdaQuery() { return ChainWrappers.lambdaQueryChain(getBaseMapper()); } /** * é“¾å¼æŸ¥è¯¢ lambda å¼ * kotlin ä½¿ç”¨ * * @return KtQueryWrapper çš„åŒ…è£…ç±» */ default KtQueryChainWrapper\u0026lt;T\u0026gt; ktQuery() { return ChainWrappers.ktQueryChain(getBaseMapper(), getEntityClass()); } /** * é“¾å¼æŸ¥è¯¢ lambda å¼ * kotlin ä½¿ç”¨ * * @return KtQueryWrapper çš„åŒ…è£…ç±» */ default KtUpdateChainWrapper\u0026lt;T\u0026gt; ktUpdate() { return ChainWrappers.ktUpdateChain(getBaseMapper(), getEntityClass()); } /** * é“¾å¼æ›´æ”¹ æ™®é€š * * @return UpdateWrapper çš„åŒ…è£…ç±» */ default UpdateChainWrapper\u0026lt;T\u0026gt; update() { return ChainWrappers.updateChain(getBaseMapper()); } /** * é“¾å¼æ›´æ”¹ lambda å¼ * \u0026lt;p\u0026gt;æ³¨æ„ï¼šä¸æ”¯æŒ Kotlin \u0026lt;/p\u0026gt; * * @return LambdaUpdateWrapper çš„åŒ…è£…ç±» */ default LambdaUpdateChainWrapper\u0026lt;T\u0026gt; lambdaUpdate() { return ChainWrappers.lambdaUpdateChain(getBaseMapper()); } /** * \u0026lt;p\u0026gt; * æ ¹æ®updateWrapperå°è¯•æ›´æ–°ï¼Œå¦ç»§ç»­æ‰§è¡ŒsaveOrUpdate(T)æ–¹æ³• * æ­¤æ¬¡ä¿®æ”¹ä¸»è¦æ˜¯å‡å°‘äº†æ­¤é¡¹ä¸šåŠ¡ä»£ç çš„ä»£ç é‡ï¼ˆå­˜åœ¨æ€§éªŒè¯ä¹‹åçš„saveOrUpdateæ“ä½œï¼‰ * \u0026lt;/p\u0026gt; * * @param entity å®ä½“å¯¹è±¡ */ default boolean saveOrUpdate(T entity, Wrapper\u0026lt;T\u0026gt; updateWrapper) { return update(entity, updateWrapper) || saveOrUpdate(entity); } } IServiceæœ‰ä¸€ä¸ªå®ç°ç±»ï¼šServiceImpl\nè‡ªå®šä¹‰ä¸€ä¸ªä¸šåŠ¡Serviceæ¥å£ï¼Œç»§æ‰¿IService\npublic interface UserService extends IService\u0026lt;User\u0026gt;{ } ç¼–å†™ä¸€ä¸ªå®ç°ç±»ï¼Œå®ç°UserServiceæ¥å£ï¼Œå¹¶ç»§æ‰¿ServiceImpl\npublic class UserServiceImpl extends ServiceImpl\u0026lt;UserMapper, User\u0026gt; implements UserService { } è¿™æ ·æ—¢å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨MybatisPlusæä¾›çš„åŠŸèƒ½\n# "},{"id":186,"href":"/zh/docs/study/MyBatis-Plus/bl_sgg/01-11/","title":"mybatis-plus-sgg-01-11","section":"åŸºç¡€(å°šç¡…è°·)_","content":" ç®€ä»‹ # MyBatis-Plusæ˜¯ä¸€ä¸ªMyBatisçš„å¢å¼ºå·¥å…·ï¼Œåœ¨MyBatisçš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿ è¿™é‡Œä»¥MySQLæ•°æ®åº“ä¸ºæ¡ˆä¾‹ï¼Œä»¥Ideaä½œä¸ºIDEï¼Œä½¿ç”¨Mavenä½œä¸ºæ„å»ºå·¥å…·ï¼Œä½¿ç”¨SpringBootå®Œæˆå„ç§åŠŸèƒ½ è¯¾ç¨‹ä¸»è¦å†…å®¹ ç‰¹æ€§ æ¶¦ç‰©æ— å£°ã€æ•ˆç‡è‡³ä¸Šã€ä¸°å¯ŒåŠŸèƒ½ æ”¯æŒçš„æ•°æ®åº“ æ¡†æ¶ç»“æ„ å·¦è¾¹ï¼šæ‰«æå®ä½“ï¼Œä»å®ä½“æŠ½å–å±æ€§çŒœæµ‹æ•°æ®åº“å­—æ®µ é€šè¿‡é»˜è®¤æä¾›çš„æ–¹æ³•ä½¿ç”¨sqlè¯­å¥ï¼Œç„¶åæ³¨å…¥mybatiså®¹å™¨ å¼€å‘ç¯å¢ƒ # æµ‹è¯•æ•°æ®åº“å’Œè¡¨ # è¿™é‡Œåˆ›å»ºæ•°æ®åº“mybatis_plus\nç„¶ååˆ›å»ºè¡¨user\nDROP TABLE IF EXISTS user; CREATE TABLE user ( id BIGINT(20) NOT NULL COMMENT \u0026#39;ä¸»é”®ID\u0026#39;, name VARCHAR(30) NULL DEFAULT NULL COMMENT \u0026#39;å§“å\u0026#39;, age INT(11) NULL DEFAULT NULL COMMENT \u0026#39;å¹´é¾„\u0026#39;, email VARCHAR(50) NULL DEFAULT NULL COMMENT \u0026#39;é‚®ç®±\u0026#39;, PRIMARY KEY (id) ); æ’å…¥é»˜è®¤æ•°æ®\nDELETE FROM user; INSERT INTO user (id, name, age, email) VALUES (1, \u0026#39;Jone\u0026#39;, 18, \u0026#39;test1@baomidou.com\u0026#39;), (2, \u0026#39;Jack\u0026#39;, 20, \u0026#39;test2@baomidou.com\u0026#39;), (3, \u0026#39;Tom\u0026#39;, 28, \u0026#39;test3@baomidou.com\u0026#39;), (4, \u0026#39;Sandy\u0026#39;, 21, \u0026#39;test4@baomidou.com\u0026#39;), (5, \u0026#39;Billie\u0026#39;, 24, \u0026#39;test5@baomidou.com\u0026#39;); Spring Bootå·¥ç¨‹ # æ·»åŠ ä¾èµ–ï¼Œå¹¶install Lombok æ’ä»¶\n\u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.7.0\u0026lt;/version\u0026gt; \u0026lt;relativePath/\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.baomidou\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mybatis-plus-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.5.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;8.0.29\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.projectlombok\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;lombok\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.18.24\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- https://mvnrepository.com/artifact/com.baomidou/mybatis-plus-generator --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.baomidou\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mybatis-plus-generator\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.5.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; åŸºç¡€é…ç½® # åˆ›å»ºspring bootå¯åŠ¨ç±»\n@SpringBootApplication public class MybatisPlusApplication { public static void main(String[] args) { SpringApplication.run(MybatisPlusApplication.class, args); } } é…ç½®resources/application.ymlæ–‡ä»¶\nspring: #é…ç½®æ•°æ®æº datasource: #é…ç½®æ•°æ®æºç±»å‹ type: com.zaxxer.hikari.HikariDataSource #é…ç½®æ•°æ®æºå„ä¸ªä¿¡æ¯ driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://localhost:3306/mybatis_plus?characterEncoding=utf-8\u0026amp;\u0026amp;useSSL=false username: root password: 123456 è¿™ä¸ªæ—¶å€™å¯åŠ¨ä¼šç›´æ¥ç»“æŸï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨springboot-web åŒ… å®ä½“ç±»çš„åˆ›å»º\npackage com.ly.mybatisplus.pojo; import lombok.Data; //ç›¸å½“äºget set æ— å‚æ„é€ å™¨ hashCode()å’Œequals()ã€toString()æ–¹æ³•é‡å†™ @Data public class User { private Long id; private String name; private Integer age; private String email; } mapperçš„åˆ›å»º mapper/UserMapper\npackage com.ly.mybatisplus.mapper; import com.baomidou.mybatisplus.core.mapper.BaseMapper; import com.ly.mybatisplus.pojo.User; import org.springframework.stereotype.Repository; //å°†è¿™ä¸ªç±»æ ‡è®°æˆæŒä¹…å±‚ç»„ä»¶ å¤„ç†æµ‹è¯•ç±»ä¸­çº¢è‰²ä¸‹åˆ’çº¿çš„é—®é¢˜ @Repository public interface UserMapper extends BaseMapper\u0026lt;User\u0026gt; { } è®¾ç½®mapperæ¥å£æ‰€åœ¨çš„åŒ…\npackage com.ly.mybatisplus; import org.mybatis.spring.annotation.MapperScan; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication //æ‰«ææŒ‡å®šåŒ…ä¸‹çš„mapperæ¥å£ @MapperScan(\u0026#34;com.ly.mybatisplus.mapper\u0026#34;) public class MybatisPlusApplication { public static void main(String[] args) { SpringApplication.run(MybatisPlusApplication.class, args); } } æµ‹è¯• # æµ‹è¯•ç±»çš„åˆ›å»º\nimport com.ly.mybatisplus.MybatisPlusApplication; import com.ly.mybatisplus.mapper.UserMapper; import com.ly.mybatisplus.pojo.User; import org.junit.jupiter.api.Test; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.boot.test.context.SpringBootTest; import java.util.List; //å¯èƒ½æ˜¯ç”±äºæ²¡æœ‰ä½¿ç”¨webåŒ…ä¾èµ–ï¼Œè¿™é‡Œè¦åŠ å…¥classesæŒ‡å®šå¯åŠ¨ç±» @SpringBootTest(classes = MybatisPlusApplication.class) public class MybatisPlusTest { @Autowired private UserMapper userMapper; @Test public void testSelect(){ //é€šè¿‡æ¡ä»¶æ„é€ å™¨æŸ¥è¯¢listé›†åˆ nullè¡¨ç¤ºæ²¡æœ‰æ¡ä»¶ List\u0026lt;User\u0026gt; users = userMapper.selectList(null); users.forEach(System.out::println); } } åŠ å…¥æ—¥å¿—åŠŸèƒ½ # é…ç½®application.ymlåŠ å…¥æ—¥å¿—\n#æ—¥å¿— mybatis-plus: configuration: log-impl: org.apache.ibatis.logging.stdout.StdOutImpl æ•ˆæœ å¦‚ä¸Šå›¾ï¼ŒæŸ¥è¯¢çš„å­—æ®µåæ¥è‡ªäºå®ä½“ç±»å±æ€§ "},{"id":187,"href":"/zh/docs/study/Algorithm/algorithhms_4th/3.1.1-3.1.7/","title":"ç®—æ³•çº¢çš®ä¹¦ 3.1.1-3.1.7","section":"_ç®—æ³•(ç¬¬å››ç‰ˆ)_","content":" æŸ¥æ‰¾ # ç»å…¸æŸ¥æ‰¾ç®—æ³•\nç”¨ç¬¦å·è¡¨è¿™ä¸ªè¯æ¥æè¿°æŠ½è±¡çš„è¡¨æ ¼ï¼Œå°†ä¿¡æ¯ï¼ˆå€¼ï¼‰å­˜å‚¨åœ¨å…¶ä¸­ï¼Œç„¶åæŒ‰ç…§æŒ‡å®šçš„é”®æ¥è·å–è¿™äº›ä¿¡æ¯\nç¬¦å·è¡¨ä¹Ÿè¢«ç§°ä¸ºå­—å…¸\nåœ¨è‹±è¯­å­—å…¸é‡Œï¼Œé”®å°±æ˜¯å•è¯ï¼Œå€¼å°±æ˜¯å•è¯å¯¹åº”çš„å®šä¹‰ã€å‘éŸ³å’Œè¯æº ç¬¦å·è¡¨æœ‰æ—¶åˆå«ç´¢å¼• åœ¨ä¸€æœ¬ä¹¦çš„ç´¢å¼•ä¸­ï¼Œé”®å°±æ˜¯æœ¯è¯­ï¼Œè€Œå€¼å°±æ˜¯ä¹¦ä¸­è¯¥æœ¯è¯­å‡ºç°çš„æ‰€æœ‰é¡µç  ä¸‹é¢å­¦ä¹ ä¸‰ç§ç»å…¸çš„æ•°æ®ç±»å‹ï¼šäºŒå‰æŸ¥æ‰¾æ ‘ã€çº¢é»‘æ ‘å’Œæ•£åˆ—è¡¨\nç¬¦å·è¡¨ # ç¬¦å·è¡¨æœ€ä¸»è¦çš„ç›®çš„æ˜¯å°†é”®å’Œå€¼è”ç³»èµ·æ¥\nç”¨ä¾‹èƒ½å¤Ÿå°†ä¸€ä¸ªé”®å€¼å¯¹æ’å…¥ç¬¦å·è¡¨å¹¶å¸Œæœ›åœ¨ä¹‹åèƒ½å¤Ÿä»ç¬¦å·è¡¨çš„æ‰€æœ‰é”®å€¼å¯¹ä¸­æŒ‰ç…§é”®ç›´æ¥æ‰¾åˆ°ç›¸å¯¹åº”çš„å€¼\nç¬¦å·è¡¨æ˜¯ä¸€ç§å­˜å‚¨é”®å€¼å¯¹çš„æ•°æ®ç»“æ„ï¼Œæ”¯æŒä¸¤ç§æ“ä½œï¼šæ’å…¥(put)ï¼Œå³å°†ä¸€ç»„æ–°çš„é”®å€¼å¯¹å­˜å…¥è¡¨ä¸­ï¼›æŸ¥æ‰¾(get)ï¼Œå³æ ¹æ®ç»™å®šçš„é”®å¾—åˆ°ç›¸åº”çš„å€¼\nå…¸å‹çš„ç¬¦å·è¡¨åº”ç”¨ API # ç¬¦å·è¡¨æ˜¯ä¸€ç§å…¸å‹çš„æ•°æ®ç±»å‹ ï¼šä»£è¡¨ç€ä¸€ç»„å®šä¹‰æ¸…æ™°çš„å€¼åŠç›¸åº”çš„æ“ä½œã€‚ä½¿ç”¨åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼ˆAPIï¼‰æ¥ç²¾ç¡®åœ°å®šä¹‰è¿™äº›æ“ä½œ ä¸€ç§ç®€å•çš„æ³›å‹ç¬¦å·è¡¨API ST(Symbol Table) æ³›å‹ å¯¹äºç¬¦å·è¡¨ï¼Œæˆ‘ä»¬é€šè¿‡æ˜ç¡®åœ°æŒ‡å®šæŸ¥æ‰¾æ—¶é”®å’Œå€¼çš„ç±»å‹æ¥åŒºåˆ†å®ƒä»¬çš„ä¸åŒè§’è‰²ã€keyå’Œvalueã€‘\né‡å¤çš„é”®\nè¿™é‡Œå‡è®¾æ¯ä¸ªé”®åªå¯¹åº”ç€ä¸€ä¸ªå€¼ï¼ˆè¡¨ä¸­ä¸å…è®¸é‡å¤å€¼ï¼‰ å½“ç”¨ä¾‹ä»£ç å‘è¡¨ä¸­å­˜å…¥çš„é”®å€¼å¯¹å’Œè¡¨ä¸­å·²æœ‰çš„é”®ï¼ˆåŠå…³è”çš„å€¼ï¼‰å†²çªæ—¶ï¼Œæ–°çš„å€¼ä¼šæ›¿ä»£æ—§çš„å€¼ ä¸Šè¿°å®šä¹‰äº†å…³è”æ•°ç»„çš„æŠ½è±¡å½¢å¼ï¼Œå¯ä»¥å°†ç¬¦å·è¡¨æƒ³è±¡æˆæ•°ç»„ï¼Œé”®å³ç´¢å¼•ï¼Œå€¼å³æ•°ç»„ä¸­çš„å€¼ åœ¨ä¸€ä¸ªå…³è”æ•°ç»„ä¸­ï¼Œé”®å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œä½†æˆ‘ä»¬ä»ç„¶å¯ä»¥ç”¨å®ƒæ¥å¿«é€Ÿè®¿é—®æ•°ç»„çš„å€¼ éJavaä½¿ç”¨st[key]æ¥æ›¿ä»£st.get(key)ï¼Œç”¨st[key]=valæ¥æ›¿ä»£st.put(key,val) é”®ä¸èƒ½ä¸ºç©º\nå€¼ä¸èƒ½ä¸ºç©ºï¼ˆå› ä¸ºè§„å®šå½“é”®ä¸å­˜åœ¨æ—¶get()è¿”å›ç©ºï¼‰ å½“å€¼ä¸ºç©ºè¡¨ç¤ºåˆ é™¤\nåˆ é™¤æ“ä½œ\nå»¶æ—¶åˆ é™¤ï¼Œå…ˆå°†é”®å¯¹åº”çš„å€¼ç½®ç©ºï¼Œä¹‹ååœ¨æŸä¸ªæ—¶åˆ»åˆ é™¤æ‰€æœ‰å€¼ä¸ºç©ºçš„é”®\nå³æ—¶åˆ é™¤ï¼Œç«‹å³ä»è¡¨ä¸­åˆ é™¤æŒ‡å®šçš„é”® putå®ç°çš„å¼€å¤´ï¼š\nif(val == null){ delete(key); return; } ä¾¿æ·æ–¹æ³• è¿­ä»£ åœ¨APIç¬¬ä¸€è¡ŒåŠ ä¸Šimplements Iterable\u0026lt;Key\u0026gt; ï¼Œæ‰€æœ‰å®ç°éƒ½åŒ…å«iterator()æ–¹æ³•æ¥å®ç°hasNext()å’Œnext()æ–¹æ³•çš„è¿­ä»£å™¨ï¼›è¿™é‡Œé‡‡ç”¨å¦ä¸€ç§æ–¹å¼ï¼šå®šä¹‰keysè¿”å›ä¸€ä¸ªIterable\u0026lt;Key\u0026gt;å¯¹è±¡ä»¥æ–¹ä¾¿ä¾¿åˆ©æ‰€æœ‰çš„é”®ï¼Œä¸”å…è®¸éå†ä¸€éƒ¨åˆ†\né”®çš„ç­‰ä»·æ€§ è‡ªå®šä¹‰çš„é”®éœ€è¦é‡å†™equals()æ–¹æ³•ï¼›ä¸”æœ€å¥½ä½¿ç”¨ä¸å¯å˜æ•°æ®ç±»å‹ä½œä¸ºé”®\næœ‰åºç¬¦å·è¡¨ # ä¸€ç§æœ‰åºçš„æ³›å‹ç¬¦å·è¡¨çš„API æœ€å¤§å€¼å’Œæœ€å°å€¼ã€å‘ä¸‹å–æ•´å’Œå‘ä¸Šå–æ•´ã€æ’åå’Œé€‰æ‹© å¯¹äº0åˆ°size()-1çš„æ‰€æœ‰iéƒ½æœ‰i==rank(select(i))ï¼Œä¸”æ‰€æœ‰çš„é”®éƒ½æ»¡è¶³key == select(rank(key)) èŒƒå›´æŸ¥æ‰¾ ä¾‹å¤–æƒ…å†µ å½“ä¸€ä¸ªæ–¹æ³•éœ€è¦è¿”å›ä¸€ä¸ªé”®ä½†è¡¨ä¸­æ²¡æœ‰åˆé€‚çš„é”®å¯ä»¥è¿”å›æ—¶ï¼Œæˆ‘ä»¬çº¦å®šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ æœ‰åºç¬¦å·è¡¨ä¸­å†—ä½™æœ‰åºæ€§æ–¹æ³•çš„é»˜è®¤å®ç° æ‰€æœ‰Comparableç±»å‹ä¸­compareTo()æ–¹æ³•å’Œequals()æ–¹æ³•çš„ä¸€è‡´æ€§ â˜…â˜…æˆæœ¬æ¨¡å‹ åœ¨å­¦ä¹ ç¬¦å·è¡¨çš„å®ç°æ—¶ï¼Œæˆ‘ä»¬ä¼šç»Ÿè®¡æ¯”è¾ƒçš„æ¬¡æ•°ï¼ˆç­‰ä»·æ€§æµ‹è¯•æˆ–æ˜¯é”®çš„ç›¸äº’æ¯”è¾ƒï¼‰ï¼Œåœ¨å†…å¾ªç¯**ä¸è¿›è¡Œæ¯”è¾ƒï¼ˆæå°‘ï¼‰**çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šç»Ÿè®¡æ•°ç»„çš„è®¿é—®æ¬¡æ•° ç”¨ä¾‹ä¸¾ä¾‹ # å¦‚ä½•ä½¿ç”¨\nè¡Œä¸ºæµ‹è¯•ç”¨ä¾‹ ç®€å•çš„ç¬¦å·è¡¨æµ‹è¯•ç”¨ä¾‹ æµ‹è¯•ç”¨ä¾‹çš„é”®ã€å€¼å’Œè¾“å‡º æ€§èƒ½æµ‹è¯•ç”¨ä¾‹ æŸ¥æ‰¾é¢‘ç‡æœ€é«˜çš„å•è¯\npublic class FrequencyCounter { public static void main(String[] args) { int minlen = Integer.parseint(args[0]); // æœ€å°é”®é•¿ ST\u0026lt;String, Integer\u0026gt; st = new ST\u0026lt;String, Integer\u0026gt;(); while (!StdIn.isEmpty()) { // æ„é€ ç¬¦å·è¡¨å¹¶ç»Ÿè®¡é¢‘ç‡ String word = StdIn.readString(); if (word.length() \u0026lt; minlen) continue; // å¿½ç•¥è¾ƒçŸ­çš„å•è¯ if (!st.contains(word)) st.put(word, 1); else st.put(word, st.get(word) + 1); } // æ‰¾å‡ºå‡ºç°é¢‘ç‡æœ€é«˜çš„å•è¯ String max = \u0026#34; \u0026#34;; st.put(max, 0); for (String word : st.keys()) if (st.get(word) \u0026gt; st.get(max)) max = word; StdOut.println(max + \u0026#34; \u0026#34; + st.get(max)); } } æ¯ä¸ªå•è¯éƒ½ä¼šè¢«ä½œä¸ºé”®è¿›è¡Œæœç´¢ï¼Œå› æ­¤å¤„ç†æ€§èƒ½å’Œè¾“å…¥æ–‡æœ¬çš„å•è¯æ€»é‡å¿…ç„¶æœ‰å…³ï¼›å…¶æ¬¡ï¼Œè¾“å…¥çš„æ¯ä¸ªå•è¯éƒ½ä¼šè¢«å­˜å…¥ç¬¦å·è¡¨ï¼ˆè¾“å…¥ä¸­ä¸é‡å¤å•è¯çš„æ€»æ•°ä¹Ÿå°±æ˜¯æ‰€æœ‰é”®éƒ½è¢«æ’å…¥ä»¥åç¬¦å·è¡¨çš„å¤§å°ï¼‰ï¼Œå› æ­¤è¾“å…¥æµä¸­ä¸åŒçš„å•è¯çš„æ€»æ•°ä¹Ÿæ˜¯ç›¸å…³çš„\næ— åºé“¾è¡¨ä¸­çš„é¡ºåºæŸ¥æ‰¾ # é¡ºåºæŸ¥æ‰¾çš„å®šä¹‰ï¼šä½¿ç”¨é“¾è¡¨ï¼Œæ¯ä¸ªç»“ç‚¹å­˜å‚¨ä¸€ä¸ªé”®å€¼å¯¹ï¼Œget()å®ç°å³ä¸ºéå†é“¾è¡¨ï¼Œç”¨equals()æ–¹æ³•æ¯”è¾ƒéœ€è¢«æŸ¥æ‰¾çš„é”®å’Œæ¯ä¸ªèŠ‚ç‚¹ä¸­çš„é”®ã€‚å¦‚æœåŒ¹é…æˆåŠŸæˆ‘ä»¬å°±è¿”å›ç›¸åº”çš„å€¼ï¼Œå¦åˆ™è¿”å›nullã€‚put()å®ç°ä¹Ÿæ˜¯éå†é“¾è¡¨ï¼Œç”¨equals()æ–¹æ³•æ¯”è¾ƒéœ€è¢«æŸ¥æ‰¾çš„é”®å’Œæ¯ä¸ªèŠ‚ç‚¹ä¸­çš„é”®ã€‚å¦‚æœåŒ¹é…æˆåŠŸæˆ‘ä»¬å°±ç”¨ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šæ›´æ–°å’Œè¯¥é”®ç›¸å…³è”çš„å€¼ï¼Œå¦åˆ™æˆ‘ä»¬å°±ç”¨ç»™å®šçš„é”®å€¼å¯¹åˆ›å»ºä¸€ä¸ªæ–°çš„ç»“ç‚¹å¹¶å°†å…¶æ’å…¥åˆ°é“¾è¡¨çš„å¼€å¤´ã€‚è¿™ç§æ–¹æ³•ç§°ä¸ºé¡ºåºæŸ¥æ‰¾\nå‘½ä¸­è¡¨ç¤ºä¸€æ¬¡æˆåŠŸçš„æŸ¥æ‰¾ï¼Œæœªå‘½ä¸­è¡¨ç¤ºä¸€æ¬¡å¤±è´¥çš„æŸ¥æ‰¾\nä½¿ç”¨åŸºäºé“¾è¡¨çš„ç¬¦å·è¡¨çš„ç´¢å¼•ç”¨ä¾‹çš„è½¨è¿¹ é¡ºåºæŸ¥æ‰¾ï¼ˆåŸºäºæ— åºé“¾è¡¨ï¼‰\npublic class SequentialSearchST\u0026lt;Key,Value\u0026gt; { private Node first; //é“¾è¡¨é¦–ç»“ç‚¹ private class Node{ //é“¾è¡¨ç»“ç‚¹çš„å®šä¹‰ Key key; Value val; Node next; public Node(Key key, Value val, Node next) { this.key = key; this.val = val; this.next = next; } } public Value get(Key key) { // æŸ¥æ‰¾ç»™å®šçš„é”®ï¼Œè¿”å›ç›¸å…³è”çš„å€¼ for (Node x = first; x != null; x = x.next) if (key.equals(x.key)) return x.val; // å‘½ä¸­ return null; // æœªåä¸­ } public void put(Key key, Value val) { // æŸ¥æ‰¾ç»™å®šçš„é”®ï¼Œæ‰¾åˆ°åˆ™æ›´æ–°å…¶å€¼ï¼Œå¦åˆ™åœ¨è¡¨ä¸­æ–°å»ºç»“ç‚¹ for (Node x = first; x != null; x = x.next) if (key.equals(x.key)) { x.val = val; return; } // å‘½ä¸­ï¼Œæ›´æ–° first = new Node(key, val, first); // æœªå‘½ä¸­ï¼Œæ–°å»ºç»“ç‚¹ } } åœ¨å«æœ‰N å¯¹é”®å€¼çš„åŸºäºï¼ˆæ— åºï¼‰é“¾è¡¨çš„ç¬¦å·è¡¨ä¸­ï¼Œæœªå‘½ä¸­çš„æŸ¥æ‰¾å’Œæ’å…¥æ“ä½œéƒ½éœ€è¦N æ¬¡æ¯”è¾ƒã€‚å‘½ä¸­çš„æŸ¥æ‰¾åœ¨æœ€åæƒ…å†µä¸‹éœ€è¦N æ¬¡æ¯”è¾ƒã€‚ç‰¹åˆ«åœ°ï¼Œå‘ä¸€ä¸ªç©ºè¡¨ä¸­æ’å…¥N ä¸ªä¸åŒçš„é”®éœ€è¦âˆ¼ N2/2 æ¬¡æ¯”è¾ƒ\næŸ¥æ‰¾ä¸€ä¸ªå·²ç»å­˜åœ¨çš„é”®å¹¶ä¸éœ€è¦çº¿æ€§çº§åˆ«çš„æ—¶é—´ã€‚ä¸€ç§åº¦é‡æ–¹æ³•æ˜¯æŸ¥æ‰¾è¡¨ä¸­çš„æ¯ä¸ªé”®ï¼Œå¹¶å°†æ€» æ—¶é—´é™¤ä»¥N\næœ‰åºæ•°ç»„ä¸­çš„äºŒåˆ†æŸ¥æ‰¾ # æœ‰åºç¬¦å·è¡¨APIï¼šå®ƒä½¿ç”¨çš„æ•°æ®ç»“æ„æ˜¯ä¸€å¯¹å¹³è¡Œçš„æ•°ç»„ï¼Œä¸€ä¸ªå­˜å‚¨é”®ä¸€ä¸ªå­˜å‚¨å€¼\n//rank()ï¼šå°äºkçš„é”®çš„æ•°é‡\npublic class BinarySearchST\u0026lt;Key extends Comparable\u0026lt;Key\u0026gt;, Value\u0026gt; { private Key[] keys; private Value[] vals; private int N; public BinarySearchST(int capacity) { // è°ƒæ•´æ•°ç»„å¤§å°çš„æ ‡å‡†ä»£ç è¯·è§ç®—æ³•1.1 keys = (Key[]) new Comparable[capacity]; vals = (Value[]) new Object[capacity]; } public int size() { return N; } public Value get(Key key) { if (isEmpty()) return null; int i = rank(key); //æ³¨æ„ï¼Œè¿™é‡Œiä¸ä¸€å®šå°±æ˜¯åˆšå¥½æ˜¯keyæ‰€åœ¨çš„ç´¢å¼•ï¼Œä»–è¡¨ç¤ºæ¯”keyçš„å€¼å°çš„ä¸ªæ•° if (i \u0026lt; N \u0026amp;\u0026amp; keys[i].compareTo(key) == 0) return vals[i]; else return null; } public int rank(Key key) // è¯·è§ç®—æ³•3.2ï¼ˆç»­1ï¼‰ public void put(Key key, Value val) { // æŸ¥æ‰¾é”®ï¼Œæ‰¾åˆ°åˆ™æ›´æ–°å€¼ï¼Œå¦åˆ™åˆ›å»ºæ–°çš„å…ƒç´  int i = rank(key); if (i \u0026lt; N \u0026amp;\u0026amp; keys[i].compareTo(key) == 0) { vals[i] = val; return; } //æ ¹æ®æˆæœ¬æ¨¡å‹ï¼Œè¿™é‡Œä¸ç»Ÿè®¡ for (int j = N; j \u0026gt; i; j--) { keys[j] = keys[j-1]; vals[j] = vals[j-1]; } keys[i] = key; vals[i] = val; N++; } public void delete(Key key) // è¯¥æ–¹æ³•çš„å®ç°è¯·è§ç»ƒä¹ 3.1.16 } äºŒåˆ†æŸ¥æ‰¾ æˆ‘ä»¬ä½¿ç”¨æœ‰åºæ•°ç»„å­˜å‚¨é”®çš„åŸå› æ˜¯ï¼Œç»å…¸äºŒåˆ†æŸ¥æ‰¾æ³•èƒ½å¤Ÿæ ¹æ®æ•°ç»„çš„ç´¢å¼•å¤§å¤§å‡å°‘æ¯æ¬¡æŸ¥æ‰¾æ‰€éœ€çš„æ¯”è¾ƒæ¬¡æ•°\né€’å½’çš„äºŒåˆ†æŸ¥æ‰¾\npublic int rank(Key key, int lo, int hi) { if (hi \u0026lt; lo) return lo; int mid = lo + (hi - lo) / 2; int cmp = key.compareTo(keys[mid]); if (cmp \u0026lt; 0) return rank(key, lo, mid-1); else if (cmp \u0026gt; 0) return rank(key, mid+1, hi); else return mid; //å¦‚æœå­˜åœ¨ï¼Œè¿”å›keyæ‰€åœ¨ä½ç½®çš„ç´¢å¼•ï¼ˆä¹Ÿå°±æ˜¯keyä¹‹å‰çš„å…ƒç´ çš„ä¸ªæ•° ï¼‰ } rank()çš„æ€§è´¨ï¼šå¦‚æœè¡¨ä¸­å­˜åœ¨è¯¥é”®ï¼Œrank()åº”è¯¥è¿”å›è¯¥é”®çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¡¨ä¸­å°äºå®ƒçš„é”®çš„æ•°é‡ï¼›å¦‚æœè¡¨ä¸­ä¸å­˜åœ¨è¯¥é”®ï¼Œran()è¿˜æ˜¯åº”è¯¥è¿”å›è¡¨ä¸­å°äºå®ƒçš„é”®çš„æ•°é‡\nå¥½å¥½æƒ³æƒ³ç®—æ³•3.2ï¼ˆç»­1ï¼‰ä¸­éé€’å½’çš„rank() ä¸ºä»€ä¹ˆèƒ½å¤Ÿåšåˆ°è¿™äº›ï¼ˆä½ å¯ä»¥è¯æ˜ä¸¤ä¸ªç‰ˆæœ¬çš„ç­‰ä»·æ€§ï¼Œæˆ–è€…ç›´æ¥è¯æ˜éé€’å½’ç‰ˆæœ¬ä¸­çš„å¾ªç¯åœ¨ç»“æŸæ—¶lo çš„å€¼æ­£å¥½ç­‰äºè¡¨ä¸­å°äºè¢«æŸ¥æ‰¾çš„é”®çš„é”®çš„æ•°é‡ï¼‰ï¼Œæ‰€æœ‰ç¨‹åºå‘˜éƒ½èƒ½ä»è¿™äº›æ€è€ƒä¸­æœ‰æ‰€æ”¶è·ã€‚ï¼ˆæç¤ºï¼šlo çš„åˆå§‹å€¼ä¸º0ï¼Œä¸”æ°¸è¿œä¸ä¼šå˜å°ï¼‰ å‡è®¾æœ‰ä¸‹é¢è¿™ä¹ˆä¸€ç»„æ•°(key value)\n0 1 2 3 4 1 2 3 5 9 æˆ‘è¦æŸ¥æ‰¾6ï¼Œé‚£ä¹ˆè½¨è¿¹ä¸ºï¼š low=0ï¼Œhigh=4ï¼Œmid=2 low=2+1=3ï¼Œhigh=4ï¼Œmid=3 low=3+1=4ï¼Œhigh=4ï¼Œmid=4 low=4ï¼Œhigh=4-1ï¼Œæ­¤æ—¶high\u0026lt;lowï¼Œè¿”å›lowã€ä¹Ÿå°±æ˜¯è¯´æ‰¾åˆ°äº†æœ€æ¥è¿‘äºè¦æŸ¥æ‰¾çš„æ•°çš„ä¸‹æ ‡ã€‘\nå¸¦å›¾è½¨è¿¹ åŸºäºäºŒåˆ†æŸ¥æ‰¾çš„æœ‰åºç¬¦å·è¡¨çš„å…¶ä»–æ“ä½œ\npublic Key min() { return keys[0]; } public Key max() { return keys[N-1]; } public Key select(int k) { return keys[k]; } //å¤§äºç­‰äºkeyçš„æœ€å°æ•´æ•° public Key ceiling(Key key) { int i = rank(key); return keys[i]; } //å°äºç­‰äºkeyçš„æœ€å¤§æ•´æ•° public Key floor(Key key) // è¯·è§ç»ƒä¹ 3.1.17 public Key delete(Key key) // è¯·è§ç»ƒä¹ 3.1.16 public Iterable\u0026lt;Key\u0026gt; keys(Key lo, Key hi) { Queue\u0026lt;Key\u0026gt; q = new Queue\u0026lt;Key\u0026gt;(); for (int i = rank(lo); i \u0026lt; rank(hi); i++) q.enqueue(keys[i]); if (contains(hi)) q.enqueue(keys[rank(hi)]); return q; } å¯¹äºŒåˆ†æŸ¥æ‰¾çš„åˆ†æ # åœ¨N ä¸ªé”®çš„æœ‰åºæ•°ç»„ä¸­è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾æœ€å¤šéœ€è¦ï¼ˆlgN+1ï¼‰æ¬¡æ¯”è¾ƒï¼ˆæ— è®ºæ˜¯å¦æˆåŠŸï¼‰\nå‘å¤§å°ä¸ºN çš„æœ‰åºæ•°ç»„ä¸­æ’å…¥ä¸€ä¸ªæ–°çš„å…ƒç´ åœ¨æœ€åæƒ…å†µä¸‹éœ€è¦è®¿é—®âˆ¼ 2N æ¬¡æ•°ç»„ï¼Œå› æ­¤å‘ä¸€ä¸ªç©ºç¬¦å·è¡¨ä¸­æ’å…¥N ä¸ªå…ƒç´ åœ¨æœ€åæƒ…å†µä¸‹éœ€è¦è®¿é—®âˆ¼ N2 æ¬¡æ•°ç»„\né¢„è§ˆ # ç®€å•çš„ç¬¦å·è¡¨å®ç°çš„æˆæœ¬æ€»ç»“ ç¬¦å·è¡¨çš„å„ç§å®ç°çš„ä¼˜ç¼ºç‚¹ æˆ‘ä»¬æœ‰è‹¥å¹²ç§é«˜æ•ˆçš„ç¬¦å·è¡¨å®ç°ï¼Œå®ƒä»¬èƒ½å¤Ÿå¹¶ä¸”å·²ç»è¢«åº”ç”¨äºæ— æ•°ç¨‹åºä¹‹ä¸­äº† "},{"id":188,"href":"/zh/docs/study/Algorithm/algorithhms_4th/2.5/","title":"ç®—æ³•çº¢çš®ä¹¦ 2.5","section":"_ç®—æ³•(ç¬¬å››ç‰ˆ)_","content":" æ’åºå¦‚æ­¤æœ‰ç”¨çš„åŸå› æ˜¯ï¼Œåœ¨æœ‰åºçš„æ•°ç»„ä¸­æŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ ï¼Œè¦æ¯”åœ¨ä¸€ä¸ªæ— åºçš„æ•°ç»„ä¸­æŸ¥æ‰¾ç®€å•å¾—å¤š é€šç”¨æ’åºç®—æ³•æ˜¯æœ€é‡è¦çš„ ç®—æ³•æ€æƒ³è™½ç„¶ç®€å•ï¼Œä½†æ˜¯é€‚ç”¨é¢†åŸŸå¹¿æ³› å°†å„ç§æ•°æ®æ’åº # Javaçš„çº¦å®šä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿåˆ©ç”¨Javaçš„å›è°ƒæœºåˆ¶å°†ä»»æ„å®ç°Comparableæ¥å£çš„æ•°æ®ç±»å‹æ’åº\næˆ‘ä»¬çš„ä»£ç ç›´æ¥èƒ½å¤Ÿå°†Stringã€Integerã€Double å’Œä¸€äº›å…¶ä»–ä¾‹å¦‚File å’ŒURL ç±»å‹çš„æ•°ç»„æ’åºï¼Œå› ä¸ºå®ƒä»¬éƒ½å®ç°äº†Comparable æ¥å£ äº¤æ˜“äº‹åŠ¡ å•†ä¸šæ•°æ®çš„å¤„ç†ï¼Œè®¾æƒ³ä¸€å®¶äº’è”ç½‘å•†ä¸šå…¬å¸ä¸ºæ¯ç¬”äº¤æ˜“è®°å½•éƒ½ä¿å­˜äº†æ‰€æœ‰çš„ç›¸å…³ä¿¡æ¯\npublic int compareTo(Transaction that) { return this.when.compareTo(that.when); } æŒ‡é’ˆæ’åº æˆ‘ä»¬ä½¿ç”¨çš„æ–¹æ³•åœ¨ç»å…¸æ•™æä¸­è¢«ç§°ä¸ºæŒ‡é’ˆæ’åºï¼Œå› ä¸ºæˆ‘ä»¬åªå¤„ç†å…ƒç´ çš„å¼•ç”¨è€Œä¸ç§»åŠ¨æ•°æ®æœ¬èº«\nä¸å¯å˜çš„é”® ç”¨ä¸å¯å˜çš„æ•°æ®ç±»å‹ä½œä¸ºé”®ï¼Œæ¯”å¦‚Stringã€Integerã€Doubleå’ŒFileç­‰\nå»‰ä»·çš„äº¤æ¢\nä½¿ç”¨å¼•ç”¨çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ä¸å¿…ç§»åŠ¨æ•´ä¸ªå…ƒç´ å¯¹äºå‡ ä¹ä»»æ„å¤§å°çš„å…ƒç´ ï¼Œä½¿ç”¨å¼•ç”¨ä½¿å¾—åœ¨ä¸€èˆ¬æƒ…å†µä¸‹äº¤æ¢çš„æˆæœ¬å’Œæ¯”è¾ƒçš„æˆæœ¬å‡ ä¹ç›¸åŒï¼ˆä»£ä»·æ˜¯éœ€è¦é¢å¤–çš„ç©ºé—´å­˜å‚¨è¿™äº›å¼•ç”¨ï¼‰\nç ”ç©¶å°†æ•°å­—æ’åºçš„ç®—æ³•æ€§èƒ½çš„ä¸€ç§æ–¹æ³•å°±æ˜¯è§‚å¯Ÿå…¶æ‰€éœ€çš„æ¯”è¾ƒå’Œäº¤æ¢æ€»æ•°ï¼Œå› ä¸ºè¿™é‡Œéšå¼åœ°å‡è®¾äº†æ¯”è¾ƒå’Œäº¤æ¢çš„æˆæœ¬æ˜¯ç›¸åŒçš„\nå¤šç§æ’åºæ–¹æ³•\næ ¹æ®æƒ…å†µå°†ä¸€ç»„å¯¹è±¡æŒ‰ç…§ä¸åŒçš„æ–¹å¼æ’åºã€‚Java çš„Comparator æ¥å£å…è®¸æˆ‘ä»¬åœ¨ä¸€ä¸ªç±»ä¹‹ä¸­å®ç°å¤šç§æ’åºæ–¹æ³• å¤šé”®æ•°ç»„\nä¸€ä¸ªå…ƒç´ çš„å¤šç§å±æ€§éƒ½å¯èƒ½è¢«ç”¨ä½œæ’åºçš„é”®\næˆ‘ä»¬å¯ä»¥å®šä¹‰å¤šç§æ¯”è¾ƒå™¨ï¼Œè¦å°†Transaction å¯¹è±¡çš„æ•°ç»„æŒ‰ç…§æ—¶é—´æ’åºå¯ä»¥è°ƒç”¨ï¼š Insertion.sort(a, new Transaction.WhenOrder()) æˆ–è€…è¿™æ ·æ¥æŒ‰ç…§é‡‘é¢æ’åºï¼š Insertion.sort(a, new Transaction.HowMuchOrder()) ä½¿ç”¨Comparatorçš„æ’å…¥æ’åº\npublic static void sort(Object[] a, Comparator c) { int N = a.length; for (int i = 1; i \u0026lt; N; i++) for (int j = i; j \u0026gt; 0 \u0026amp;\u0026amp; less(Comparator, a[j], a[j-1]); j--) exch(a, j, j-1); } private static Boolean less(Comparator c, Object v, Object w) { return c.compare(v, w) \u0026lt; 0; } private static void exch(Object[] a, int i, int j) { Object t = a[i]; a[i] = a[j]; a[j] = t; } ä½¿ç”¨æ¯”è¾ƒå™¨å®ç°ä¼˜å…ˆé˜Ÿåˆ—\næ‰©å±•ä¼˜å…ˆé˜Ÿåˆ— å¯¼å…¥ java.util.Comparatorï¼› ä¸º MaxPQ æ·»åŠ ä¸€ä¸ªå®ä¾‹å˜é‡ comparator ä»¥åŠä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œè¯¥æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªæ¯”è¾ƒå™¨ ä½œä¸ºå‚æ•°å¹¶ç”¨å®ƒå°†comparator åˆå§‹åŒ–ï¼› åœ¨ less()ä¸­æ£€æŸ¥ comparatorå±æ€§æ˜¯å¦ä¸º nullï¼ˆå¦‚æœä¸æ˜¯çš„è¯å°±ç”¨å®ƒè¿›è¡Œæ¯”è¾ƒï¼‰ã€‚ //ä½¿ç”¨äº†Comparatorçš„æ’å…¥æ’åº import java.util.Comparator; public class Transaction { ... private final String who; private final Date when; private final double amount; ... public static class WhoOrder implements Comparator\u0026lt;Transaction\u0026gt; { public int compare(Transaction v, Transaction w) { return v.who.compareTo(w.who); } } public static class WhenOrder implements Comparator\u0026lt;Transaction\u0026gt; { public int compare(Transaction v, Transaction w) { return v.when.compareTo(w.when); } } public static class HowMuchOrder implements Comparator\u0026lt;Transaction\u0026gt; { public int compare(Transaction v, Transaction w) { if (v.amount \u0026lt; w.amount) return -1; if (v.amount \u0026gt; w.amount) return +1; return 0; } } } ç¨³å®šæ€§\nå¦‚æœä¸€ä¸ªæ’åºç®—æ³•èƒ½å¤Ÿä¿ç•™æ•°ç»„ä¸­é‡å¤å…ƒç´ çš„ç›¸å¯¹ä½ç½®åˆ™å¯ä»¥è¢«ç§°ä¸ºæ˜¯ç¨³å®šçš„ ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªéœ€è¦å¤„ç†å¤§é‡å«æœ‰åœ°ç†ä½ç½®å’Œæ—¶é—´æˆ³çš„äº‹ä»¶çš„äº’è”ç½‘å•†ä¸šåº”ç”¨ç¨‹ åºã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨äº‹ä»¶å‘ç”Ÿæ—¶å°†å®ƒä»¬æŒ¨ä¸ªå­˜å‚¨åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œè¿™æ ·åœ¨æ•°ç»„ä¸­å®ƒä»¬å·²ç»æ˜¯æŒ‰ç…§æ—¶é—´é¡ºåºæ’å¥½äº†çš„ã€‚ç°åœ¨å‡è®¾åœ¨è¿›ä¸€æ­¥å¤„ç†å‰å°†æŒ‰ç…§åœ°ç†ä½ç½®åˆ‡åˆ†ã€‚ä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯å°†æ•°ç»„æŒ‰ç…§ä½ç½®æ’åºã€‚å¦‚æœæ’åºç®—æ³•ä¸æ˜¯ç¨³å®šçš„ï¼Œæ’åºåçš„æ¯ä¸ªåŸå¸‚çš„äº¤æ˜“å¯èƒ½ä¸ä¼šå†æ˜¯æŒ‰ç…§æ—¶é—´é¡ºåºæ’åˆ—çš„äº† æˆ‘ä»¬å­¦ä¹ è¿‡çš„ä¸€éƒ¨åˆ†ç®—æ³•æ˜¯ç¨³å®šçš„ï¼ˆæ’å…¥æ’åºå’Œå½’å¹¶æ’åºï¼‰ï¼Œä½†å¾ˆå¤šä¸æ˜¯ï¼ˆé€‰æ‹©æ’åºã€å¸Œå°”æ’åºã€å¿«é€Ÿæ’åºå’Œå †æ’åºï¼‰ æœ‰å¾ˆå¤šåŠæ³•èƒ½å¤Ÿå°†ä»»æ„æ’åºç®—æ³•å˜æˆç¨³å®šçš„ï¼ˆè¯·è§ç»ƒä¹ 2.5.18ï¼‰ï¼Œä½†ä¸€èˆ¬åªæœ‰åœ¨ç¨³å®šæ€§æ˜¯å¿…è¦çš„æƒ…å†µä¸‹ç¨³å®šçš„æ’åºç®—æ³•æ‰æœ‰ä¼˜åŠ¿ å›¾ç¤º æˆ‘åº”è¯¥ä½¿ç”¨å“ªç§æ’åºç®—æ³• # å„ç§æ’åºç®—æ³•çš„æ€§èƒ½ç‰¹ç‚¹ å¿«é€Ÿæ’åºæ˜¯æœ€å¿«çš„é€šç”¨æ’åºç®—æ³• å°†åŸå§‹ç±»å‹æ•°æ®æ’åº ä¸€äº›æ€§èƒ½ä¼˜å…ˆçš„åº”ç”¨çš„é‡ç‚¹å¯èƒ½æ˜¯å°†æ•°å­—æ’åºï¼Œå› æ­¤æ›´åˆç†çš„åšæ³•æ˜¯è·³è¿‡å¼•ç”¨ç›´æ¥å°†åŸå§‹æ•°æ® ç±»å‹çš„æ•°æ®æ’åº Javaç³»ç»Ÿåº“çš„æ’åºç®—æ³• java.util.Arrays.sort() Java çš„ç³»ç»Ÿç¨‹åºå‘˜é€‰æ‹©å¯¹åŸå§‹æ•°æ®ç±»å‹ä½¿ç”¨ï¼ˆä¸‰å‘åˆ‡åˆ†çš„ï¼‰å¿«é€Ÿæ’åºï¼Œå¯¹å¼•ç”¨ç±»å‹ä½¿ç”¨å½’å¹¶æ’ åºã€‚è¿™äº›é€‰æ‹©å®é™…ä¸Šä¹Ÿæš—ç¤ºç€ç”¨é€Ÿåº¦å’Œç©ºé—´ï¼ˆå¯¹äºåŸå§‹æ•°æ®ç±»å‹ï¼‰æ¥æ¢å–ç¨³å®šæ€§ï¼ˆå¯¹äºå¼•ç”¨ç±»å‹ï¼‰ï¼Œ å¦‚æœè€ƒè™‘ç¨³å®šæ€§ï¼Œåˆ™é€‰æ‹©Merge.sort() å½’å¹¶æ’åº é—®é¢˜çš„å½’çº¦ # å½’çº¦æŒ‡çš„æ˜¯ä¸ºè§£å†³æŸä¸ªé—®é¢˜è€Œå‘æ˜çš„ç®—æ³•æ­£å¥½å¯ä»¥ç”¨æ¥è§£å†³å¦ä¸€ç§é—®é¢˜\nä½¿ç”¨è§£å†³é—®é¢˜B çš„æ–¹æ³•æ¥è§£å†³é—®é¢˜A æ—¶ï¼Œä½ éƒ½æ˜¯åœ¨å°†A å½’çº¦ä¸ºBã€‚\nå¦‚æœå…ˆå°†æ•°æ®æ’åºï¼Œé‚£ä¹ˆè§£å†³å‰©ä¸‹çš„é—®é¢˜å°±å‰©ä¸‹çº¿æ€§çº§åˆ«çš„æ—¶é—´ï¼Œå½’çº¦åçš„è¿è¡Œæ—¶é—´çš„å¢é•¿æ•°é‡çº§ç”±å¹³æ–¹çº§åˆ«é™ä½åˆ°äº†çº¿æ€§çº§åˆ«\næ‰¾å‡ºé‡å¤å…ƒç´ çš„ä¸ªæ•°ï¼ˆå…ˆæ’åºï¼Œåéå†ï¼‰\nQuick.sort(a); int count = 1; // å‡è®¾a.length \u0026gt; 0. for (int i = 1; i \u0026lt; a.length; i++) if (a[i].compareTo(a[i-1]) != 0) count++; Kendall tauè·ç¦»\nä¼˜å…ˆé˜Ÿåˆ—\nåœ¨2.4 èŠ‚ä¸­æˆ‘ä»¬å·²ç»è§è¿‡ä¸¤ä¸ªè¢«å½’çº¦ä¸ºä¼˜å…ˆé˜Ÿåˆ—æ“ä½œçš„é—®é¢˜çš„ä¾‹å­ã€‚ä¸€ä¸ªæ˜¯2.4.2.1 èŠ‚ä¸­çš„TopMï¼Œå®ƒèƒ½å¤Ÿæ‰¾åˆ°è¾“å…¥æµä¸­M ä¸ªæœ€å¤§çš„å…ƒç´ ï¼›å¦ä¸€ä¸ªæ˜¯2.4.4.7 èŠ‚ä¸­çš„Multiwayï¼Œå®ƒèƒ½å¤Ÿå°†M ä¸ªè¾“å…¥æµå½’å¹¶ä¸ºä¸€ä¸ªæœ‰åºçš„è¾“å‡ºæµã€‚è¿™ä¸¤ä¸ªé—®é¢˜éƒ½å¯ä»¥è½»æ˜“ç”¨é•¿åº¦ä¸ºM çš„ä¼˜å…ˆé˜Ÿåˆ—è§£å†³\nä¸­ä½æ•°ä¸é¡ºåºç»Ÿè®¡ (ä¸å¿«é€Ÿæ’åºæœ‰å…³)\næ’åºåº”ç”¨ä¸€è§ˆ # å•†ä¸šè®¡ç®—ï¼šæŒ‰ç…§åå­—æˆ–è€…æ•°å­—æ’åºçš„è´¦å·ã€æŒ‰ç…§æ—¥æœŸæˆ–è€…é‡‘é¢æ’åºçš„äº¤æ˜“ã€æŒ‰ç…§ é‚®ç¼–æˆ–è€…åœ°å€æ’åºçš„é‚®ä»¶ã€æŒ‰ç…§åç§°æˆ–è€…æ—¥æœŸæ’åºçš„æ–‡ä»¶ç­‰ï¼Œ å¤„ç†è¿™äº›æ•°æ®å¿…ç„¶éœ€è¦æ’åºç®— ä¿¡æ¯æœç´¢ï¼šæœ‰åºçš„é¡ºåºå¯ä»¥ä½¿ç”¨ç»å…¸çš„äºŒåˆ†æŸ¥æ‰¾æ³• è¿ç­¹å­¦æŒ‡çš„æ˜¯ç ”ç©¶æ•°å­¦æ¨¡å‹å¹¶å°†å…¶åº”ç”¨äºé—®é¢˜è§£å†³å’Œå†³ç­–çš„é¢†åŸŸ äº‹ä»¶é©±åŠ¨æ¨¡æ‹Ÿã€æ•°å€¼è®¡ç®—ã€ç»„åˆæœç´¢ åŸºäºæ’åºç®—æ³•çš„ç®—æ³• Primç®—æ³•å’ŒDijkstraç®—æ³• Kruskalç®—æ³• éœå¤«æ›¼å‹ç¼© å­—ç¬¦ä¸²å¤„ç† "},{"id":189,"href":"/zh/docs/study/Algorithm/algorithhms_4th/2.4/","title":"ç®—æ³•çº¢çš®ä¹¦ 2.4","section":"_ç®—æ³•(ç¬¬å››ç‰ˆ)_","content":" ä¼˜å…ˆé˜Ÿåˆ— # æœ‰äº›æƒ…å†µä¸‹ï¼Œä¸éœ€è¦è¦æ±‚å¤„ç†çš„å…ƒç´ å…¨éƒ¨æœ‰åºï¼Œåªè¦æ±‚æ¯æ¬¡éƒ½å¤„ç†é”®å€¼æœ€å¤§çš„å…ƒç´ ï¼Œç„¶åå†æ”¶é›†æ›´å¤šçš„å…ƒç´ ï¼Œç„¶åå†å¤„ç†é”®å€¼æœ€å¤§çš„å…ƒç´  éœ€è¦ä¸€ç§æ•°æ®ç»“æ„ï¼Œæ”¯æŒæ“ä½œï¼šåˆ é™¤æœ€å¤§å…ƒç´ å’Œæ’å…¥å…ƒç´ ï¼Œè¿™ç§æ•°æ®ç±»å‹å«åšä¼˜å…ˆé˜Ÿåˆ— ä¼˜å…ˆé˜Ÿåˆ—çš„åŸºæœ¬è¡¨ç°å½¢å¼ï¼šå…¶ä¸€æˆ–ä¸¤ç§æ“ä½œéƒ½èƒ½åœ¨çº¿æ€§æ—¶é—´å†…å®Œæˆ åŸºäºäºŒå‰å †æ•°æ®ç»“æ„çš„ä¼˜å…ˆé˜Ÿåˆ—ï¼Œç”¨æ•°ç»„ä¿å­˜å…ƒç´ å¹¶æŒ‰ç…§ä¸€å®šæ¡ä»¶æ’åºï¼Œä»¥å®ç°é«˜æ•ˆçš„åˆ é™¤æœ€å¤§å…ƒç´ å’Œæ’å…¥å…ƒç´  API # æŠ½è±¡æ•°æ®ç±»å‹ï¼Œæœ€é‡è¦çš„æ“ä½œæ˜¯åˆ é™¤æœ€å¤§å…ƒç´ å’Œæ’å…¥å…ƒç´  delMax()å’Œinsert()\nç”¨â€œæœ€å¤§å…ƒç´ â€ä»£æ›¿â€œæœ€å¤§é”®å€¼â€æˆ–æ˜¯â€œé”®å€¼æœ€å¤§çš„å…ƒç´ â€\næ³›å‹ä¼˜å…ˆé˜Ÿåˆ—çš„API ä¼˜å…ˆé˜Ÿåˆ—çš„è°ƒç”¨ç¤ºä¾‹ ä»Nå„è¾“å…¥ä¸­æ‰¾åˆ°æœ€å¤§çš„Må„å…ƒç´ æ‰€éœ€æˆæœ¬ ä¼˜å…ˆé˜Ÿåˆ—çš„ç”¨ä¾‹ pqé‡Œé¢æœ€å¤šæ”¾5ä¸ªï¼Œå½“å¤§äº5ä¸ªçš„æ—¶å€™ï¼Œå°±ä»ä¸­å‰”é™¤1ä¸ª\npublic class TopM { public static void main(String[] args) { // æ‰“å°è¾“å…¥æµä¸­æœ€å¤§çš„Mè¡Œ int M = Integer.parseint(args[0]); MinPQ\u0026lt;Transaction\u0026gt; pq = new MinPQ\u0026lt;Transaction\u0026gt;(M+1); while (StdIn.hasNextLine()) { // ä¸ºä¸‹ä¸€è¡Œè¾“å…¥åˆ›å»ºä¸€ä¸ªå…ƒç´ å¹¶æ”¾å…¥ä¼˜å…ˆé˜Ÿåˆ—ä¸­ pq.insert(new Transaction(StdIn.readLine())); if (pq.size() \u0026gt; M) pq.delMin(); // å¦‚æœä¼˜å…ˆé˜Ÿåˆ—ä¸­å­˜åœ¨M+1ä¸ªå…ƒç´ åˆ™åˆ é™¤å…¶ä¸­æœ€å°çš„å…ƒç´  } // æœ€å¤§çš„Mä¸ªå…ƒç´ éƒ½åœ¨ä¼˜å…ˆé˜Ÿåˆ—ä¸­ Stack\u0026lt;Transaction\u0026gt; stack = new Stack\u0026lt;Transaction\u0026gt;(); while (!pq.isEmpty()) stack.push(pq.delMin()); for (Transaction t : stack) StdOut.println(t); } } åº”ç”¨ åˆçº§å®ç° # æ•°ç»„å®ç°ï¼ˆæ— åºï¼‰ insertå…ƒç´ å’Œæ ˆçš„push()æ–¹æ³•å®Œå…¨ä¸€æ ·ï¼›è¦åˆ é™¤æœ€å¤§å…ƒç´ ï¼Œå¯ä»¥æ·»åŠ ä¸€æ®µç±»ä¼¼é€‰æ‹©æ’åºçš„å†…å¾ªç¯çš„ä»£ç ï¼Œå°†æœ€å¤§å…ƒç´ çš„è¾¹ç•Œå…ƒç´ äº¤æ¢ï¼Œç„¶ååˆ é™¤ æ•°ç»„å®ç°ï¼ˆæœ‰åºï¼‰ insert()æ–¹æ³•æ—¶ï¼Œå§‹ç»ˆå°†è¾ƒå¤§çš„å…ƒç´ ï¼Œå‘å³è¾¹ç§»åŠ¨ä¸€æ ¼ä»¥ä½¿æ•°ç»„æœ‰åºï¼›åˆ é™¤æœ€å¤§å…ƒç´ å°±æ˜¯pop() é“¾è¡¨è¡¨ç¤ºæ³• å¯ä»¥ç”¨åŸºäºé“¾è¡¨çš„ä¸‹å‹æ ˆçš„ä»£ç ä½œä¸ºåŸºç¡€ï¼Œè€Œåå¯ä»¥é€‰æ‹©ä¿®æ”¹pop() æ¥æ‰¾åˆ°å¹¶è¿”å›æœ€å¤§å…ƒç´ ï¼Œæˆ–æ˜¯ä¿®æ”¹push() æ¥ä¿è¯æ‰€æœ‰å…ƒç´ ä¸ºé€†åºå¹¶ç”¨pop() æ¥åˆ é™¤å¹¶è¿”å›é“¾è¡¨çš„é¦–å…ƒç´ (ä¹Ÿå°±æ˜¯æœ€å¤§çš„å…ƒç´ ) ä¼˜å…ˆé˜Ÿåˆ—çš„å„ç§å®ç°åœ¨æœ€åæƒ…å†µä¸‹è¿è¡Œæ—¶é—´çš„å¢é•¿æ•°é‡çº§ åœ¨ä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—ä¸Šæ‰§è¡Œçš„ä¸€ç³»åˆ—æ“ä½œå¦‚è¡¨2.4.4æ‰€ç¤º å †çš„å®šä¹‰ # å½“ä¸€æ£µäºŒå‰æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¤§äºç­‰äºä»–çš„ä¸¤ä¸ªå­ç»“ç‚¹æ—¶ï¼Œå®ƒè¢«ç§°ä¸ºå †æœ‰åº\né‡è¦æ€§è´¨1\nåœ¨å †æœ‰åºçš„äºŒå‰æ ‘ä¸­ï¼Œæ¯ä¸ªç»“ç‚¹éƒ½å°äºç­‰äºå®ƒçš„çˆ¶ç»“ç‚¹ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚ä»ä»»æ„ç»“ç‚¹å‘ä¸Šï¼Œæˆ‘ä»¬éƒ½èƒ½å¾—åˆ°ä¸€åˆ—éé€’å‡çš„å…ƒç´ ï¼›ä»ä»»æ„ç»“ç‚¹å‘ä¸‹ï¼Œæˆ‘ä»¬éƒ½èƒ½å¾—åˆ°ä¸€åˆ—éé€’å¢çš„å…ƒç´ \né‡è¦å‘½é¢˜ æ ¹ç»“ç‚¹æ˜¯å †æœ‰åºçš„äºŒå‰æ ‘ä¸­çš„æœ€å¤§ç»“ç‚¹\näºŒå‰å †è¡¨ç¤ºæ³•\nå¦‚æœä½¿ç”¨æŒ‡é’ˆæ¥è¡¨ç¤ºå †æœ‰åºçš„äºŒå‰æ ‘ï¼Œéœ€è¦ä¸‰ä¸ªæŒ‡é’ˆæ¥æ‰¾åˆ°å®ƒçš„ä¸Šä¸‹ç»“ç‚¹ ä½¿ç”¨æ•°ç»„æ¥è¡¨ç¤º(å‰ææ˜¯ä½¿ç”¨å®Œå…¨äºŒå‰æ ‘æ¥è¡¨ç¤º)ï¼Œé‚£ä¹ˆåªè¦ä¸€å±‚ä¸€å±‚ç”±ä¸Šå‘ä¸‹ä»å·¦è‡³å³ï¼Œåœ¨æ¯ä¸ªç»“ç‚¹çš„ä¸‹æ–¹è¿æ¥ä¸¤ä¸ªæ›´å°çš„ç»“ç‚¹ï¼Œç›´è‡³å°†Nä¸ªç»“ç‚¹å…¨éƒ¨è¿æ¥å®Œæ¯• å³å°†äºŒå‰æ ‘çš„ç»“ç‚¹æŒ‰ç…§å±‚çº§é¡ºåºæ”¾å…¥æ•°ç»„ä¸­ äºŒå‰å †æ˜¯ä¸€ç»„èƒ½å¤Ÿç”¨å †æœ‰åºçš„å®Œå…¨äºŒå‰æ ‘æ’åºçš„å…ƒç´ ï¼Œå¹¶åœ¨æ•°ç»„ä¸­æŒ‰ç…§å±‚çº§å‚¨å­˜ï¼ˆä¸ä½¿ ç”¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼‰\nå›¾è§£ ä¸‹é¢å°†äºŒå‰æ ‘ ç®€ç§°ä¸ºå †\nåœ¨ä¸€ä¸ªå †ä¸­ï¼Œä½ç½®k çš„ç»“ç‚¹çš„çˆ¶ç»“ç‚¹çš„ä½ç½®ä¸ºï£°k/2ï£»ï¼Œè€Œå®ƒçš„ä¸¤ä¸ªå­ç»“ç‚¹çš„ä½ç½®åˆ™åˆ†åˆ«ä¸º2k å’Œ2k+1ã€‚è¿™æ ·åœ¨ä¸ä½¿ç”¨æŒ‡é’ˆçš„æƒ…å†µä¸‹ï¼ˆæˆ‘ä»¬åœ¨ç¬¬3 ç« ä¸­è®¨è®ºäºŒå‰æ ‘æ—¶ä¼šç”¨åˆ°å®ƒä»¬ï¼‰æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è®¡ç®—æ•°ç»„çš„ç´¢å¼•åœ¨æ ‘ä¸­ä¸Šä¸‹ç§»åŠ¨ï¼šä»a[k] å‘ä¸Šä¸€å±‚å°±ä»¤k ç­‰äºk/2ï¼Œå‘ä¸‹ä¸€å±‚åˆ™ä»¤k ç­‰äº2k æˆ–2k+1\nä¸€æ£µå¤§å°ä¸ºNçš„å®Œå…¨äºŒå‰æ ‘çš„é«˜åº¦ä¸º[lgN]\nå½“Nè¾¾åˆ°2çš„å¹‚æ—¶æ ‘çš„é«˜åº¦ä¸ºåŠ 1 æ•°ç»„ä¸ä½¿ç”¨ä½ç½®[0]\nå †çš„ç®—æ³• # å †å®ç°çš„æ¯”è¾ƒå’Œäº¤æ¢æ–¹æ³•\nprivate Boolean less(int i, int j) { return pq[i].compareTo(pq[j]) \u0026lt; 0; } private void exch(int i, int j) { Key t = pq[i]; pq[i] = pq[j]; pq[j] = t; } å †çš„æ“ä½œé¦–å…ˆè¿›è¡Œä¸€äº›ç®€å•çš„æ”¹åŠ¨ï¼Œæ‰“ç ´å †çš„çŠ¶æ€ï¼Œå†éå†å †å¹¶æŒ‰ç…§è¦æ±‚å°†å †çš„çŠ¶æ€å›å¤ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºå †çš„æœ‰åºåŒ–\nå½“æŸä¸ªç»“ç‚¹çš„ä¼˜å…ˆçº§ä¸Šå‡ï¼ˆæˆ–æ˜¯åœ¨å †åº•åŠ å…¥ä¸€ä¸ªæ–°çš„å…ƒç´ ï¼‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç”±ä¸‹è‡³ä¸Šæ¢å¤å †çš„é¡ºåºã€‚å½“æŸä¸ªç»“ç‚¹çš„ä¼˜å…ˆçº§ä¸‹é™ï¼ˆä¾‹å¦‚ï¼Œå°†æ ¹ç»“ç‚¹æ›¿æ¢ä¸ºä¸€ä¸ªè¾ƒå°çš„å…ƒç´ ï¼‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç”±ä¸Šè‡³ä¸‹æ¢å¤å †çš„é¡ºåº\nç”±ä¸‹è‡³ä¸Šçš„å †æœ‰åºåŒ–ï¼ˆä¸Šæµ®ï¼‰ã€åœ¨æœ€åä½ç½®æ’å…¥ä¸€ä¸ªå…ƒç´ ã€‘\nè¯´æ˜ å¦‚æœå †çš„æœ‰åºçŠ¶æ€å› ä¸ºæŸä¸ªç»“ç‚¹å˜å¾—æ¯”å®ƒçš„çˆ¶ç»“ç‚¹æ›´å¤§è€Œè¢«æ‰“ç ´ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦é€šè¿‡äº¤æ¢å®ƒå’Œå®ƒçš„çˆ¶ç»“ç‚¹æ¥ä¿®å¤å †ã€‚äº¤æ¢åï¼Œè¿™ä¸ªç»“ç‚¹æ¯”å®ƒçš„ä¸¤ä¸ªå­ç»“ç‚¹éƒ½å¤§ï¼ˆä¸€ä¸ªæ˜¯æ›¾ç»çš„çˆ¶ç»“ç‚¹ï¼Œå¦ä¸€ä¸ªæ¯”å®ƒæ›´å°ï¼Œå› ä¸ºå®ƒæ˜¯æ›¾ç»çˆ¶ç»“ç‚¹çš„å­ç»“ç‚¹ï¼‰ï¼Œä½†è¿™ä¸ªç»“ç‚¹ä»ç„¶å¯èƒ½æ¯”å®ƒç°åœ¨çš„çˆ¶ç»“ç‚¹æ›´å¤§ã€‚æˆ‘ä»¬å¯ä»¥ä¸€ééåœ°ç”¨åŒæ ·çš„åŠæ³•æ¢å¤ç§©åºï¼Œå°†è¿™ä¸ªç»“ç‚¹ä¸æ–­å‘ä¸Šç§»åŠ¨ç›´åˆ°æˆ‘ä»¬é‡ åˆ°äº†ä¸€ä¸ªæ›´å¤§çš„çˆ¶ç»“ç‚¹ã€‚\nä»£ç \nprivate void swim(int k) { while (k \u0026gt; 1 \u0026amp;\u0026amp; less(k/2, k)) { exch(k/2, k); k = k/2; } } ç”±ä¸Šè‡³ä¸‹çš„å †æœ‰åºåŒ–ï¼ˆä¸‹æ²‰ï¼‰ã€åœ¨æ ¹èŠ‚ç‚¹æ’å…¥ä¸€ä¸ªå…ƒç´ ã€‘\nå¦‚æœå †çš„æœ‰åºçŠ¶æ€å› ä¸ºæŸä¸ªç»“ç‚¹å˜å¾—æ¯”å®ƒçš„ä¸¤ä¸ªå­ç»“ç‚¹æˆ–æ˜¯å…¶ä¸­ä¹‹ä¸€æ›´å°äº†è€Œè¢«æ‰“ç ´äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å®ƒå’Œå®ƒçš„ä¸¤ä¸ªå­ç»“ç‚¹ä¸­çš„è¾ƒå¤§è€…äº¤æ¢æ¥æ¢å¤å †ã€‚äº¤æ¢å¯èƒ½ä¼šåœ¨å­ç»“ç‚¹å¤„ç»§ç»­æ‰“ç ´å †çš„æœ‰åºçŠ¶æ€ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸æ–­åœ°ç”¨ç›¸åŒçš„æ–¹å¼å°†å…¶ä¿®å¤ï¼Œå°†ç»“ç‚¹å‘ä¸‹ç§»åŠ¨ç›´åˆ°å®ƒçš„å­ç»“ç‚¹éƒ½æ¯”å®ƒæ›´å°æˆ–æ˜¯åˆ°è¾¾äº†å †çš„åº•éƒ¨\nä»£ç \nprivate void sink(int k) { while (2*k \u0026lt;= N) { int j = 2*k; //j\u0026lt;Nç”¨æ¥åˆ¤æ–­jæ˜¯å¦å­˜åœ¨å³å…„å¼Ÿç»“ç‚¹ï¼Œå½“j==Nï¼ˆå³jä¸ºæ ‘çš„[ä»å·¦åˆ°å³]æœ€æœ«ä¸€ä¸ªç»“ç‚¹ï¼Œé‚£ä¹ˆå®ƒæ²¡æœ‰å³å…„å¼Ÿç»“ç‚¹ï¼‰ if (j \u0026lt; N \u0026amp;\u0026amp; less(j, j+1)) j++; //å½“æ ¹èŠ‚ç‚¹æ²¡æœ‰å°äºå­èŠ‚ç‚¹æ—¶ï¼Œè·³å‡ºå¾ªç¯ if (!less(k, j)) break; exch(k, j); k = j; } } å¯¹äºä¸Šé¢çš„è¯´æ˜\næ’å…¥å…ƒç´ ã€‚æˆ‘ä»¬å°†æ–°å…ƒç´ åŠ åˆ°æ•°ç»„æœ«å°¾ï¼Œå¢åŠ å †çš„å¤§å°å¹¶è®©è¿™ä¸ªæ–°å…ƒç´ ä¸Šæµ®åˆ°åˆé€‚çš„ä½ ç½®ï¼ˆå¦‚å›¾2.4.5 å·¦åŠéƒ¨åˆ†æ‰€ç¤ºï¼‰ã€‚ åˆ é™¤æœ€å¤§å…ƒç´ ã€‚æˆ‘ä»¬ä»æ•°ç»„é¡¶ç«¯åˆ å»æœ€å¤§çš„å…ƒç´ å¹¶å°†æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ æ”¾åˆ°é¡¶ç«¯ï¼Œå‡ å°å †çš„å¤§å°å¹¶è®©è¿™ä¸ªå…ƒç´ ä¸‹æ²‰åˆ°åˆé€‚çš„ä½ç½®ï¼ˆå¦‚å›¾2.4.5 å³åŠéƒ¨åˆ†æ‰€ç¤ºï¼‰ ä¸Šé¢å¯¹ä¼˜å…ˆé˜Ÿåˆ—APIçš„å®ç°ï¼Œèƒ½å¤Ÿä¿è¯æ’å…¥å…ƒç´ å’Œåˆ é™¤å…ƒç´ è¿™ä¸¤ä¸ªæ“ä½œçš„ç”¨æ—¶ï¼Œå’Œé˜Ÿåˆ—çš„å¤§å°ä»…æˆå¯¹æ•°å…³ç³» å›¾è§£å †çš„æ“ä½œ åŸºäºå †çš„ä¼˜å…ˆé˜Ÿåˆ—\npublic class MaxPQ\u0026lt;Key extends Comparable\u0026lt;Key\u0026gt;\u0026gt; { private Key[] pq; // åŸºäºå †çš„å®Œå…¨äºŒå‰æ ‘ private int N = 0; // å­˜å‚¨äºpq[1..N]ä¸­ï¼Œpq[0]æ²¡æœ‰ä½¿ç”¨ public MaxPQ(int maxN) { pq = (Key[]) new Comparable[maxN+1]; } public Boolean isEmpty() { return N == 0; } public int size() { return N; } public void insert(Key v) { pq[++N] = v; swim(N); } public Key delMax() { Key max = pq[1]; // ä»æ ¹ç»“ç‚¹å¾—åˆ°æœ€å¤§å…ƒç´  exch(1, N--); // å°†å…¶å’Œæœ€åä¸€ä¸ªç»“ç‚¹äº¤æ¢ pq[N+1] = null; // é˜²æ­¢å¯¹è±¡æ¸¸ç¦» sink(1); // æ¢å¤å †çš„æœ‰åºæ€§ return max; } // è¾…åŠ©æ–¹æ³•çš„å®ç°è¯·è§æœ¬èŠ‚å‰é¢çš„ä»£ç æ¡† private Boolean less(int i, int j) private void exch(int i, int j) private void swim(int k) private void sink(int k) } è¯´æ˜\nä¼˜å…ˆé˜Ÿåˆ—ç”±ä¸€ä¸ªåŸºäºå †çš„å®Œå…¨äºŒå‰æ ‘è¡¨ç¤ºï¼Œ å­˜å‚¨äºæ•°ç»„pq[1..N] ä¸­ï¼Œpq[0] æ²¡æœ‰ä½¿ç”¨ã€‚åœ¨insert() ä¸­ï¼Œæˆ‘ä»¬å°†N åŠ ä¸€å¹¶æŠŠæ–°å…ƒç´ æ·»åŠ åœ¨æ•°ç»„æœ€åï¼Œç„¶åç”¨swim() æ¢å¤å †çš„ç§©åºã€‚åœ¨delMax() ä¸­ï¼Œæˆ‘ä»¬ä»pq[1] ä¸­å¾—åˆ°éœ€è¦è¿”å›çš„å…ƒç´ ï¼Œç„¶åå°†pq[N] ç§»åŠ¨åˆ°pq[1]ï¼Œå°†N å‡ä¸€å¹¶ç”¨sink() æ¢å¤å †çš„ç§©åºã€‚åŒæ—¶æˆ‘ä»¬è¿˜å°†ä¸å†ä½¿ç”¨çš„pq[N+1] è®¾ä¸ºnullï¼Œä»¥ä¾¿ç³»ç»Ÿå›æ”¶å®ƒæ‰€å ç”¨çš„ç©ºé—´ã€‚å’Œä»¥å‰ä¸€æ ·ï¼ˆè¯·è§1.3 èŠ‚ï¼‰ï¼Œè¿™é‡Œçœç•¥äº†åŠ¨æ€è°ƒæ•´æ•°ç»„å¤§å°çš„ä»£ç \nå¯¹äºä¸€ä¸ªå«æœ‰Nä¸ªå…ƒç´ çš„åŸºäºå †çš„ä¼˜å…ˆé˜Ÿåˆ—ï¼Œæ’å…¥å…ƒç´ æ“ä½œåªéœ€ä¸è¶…è¿‡ï¼ˆlgN+1ï¼‰æ¬¡æ¯”è¾ƒï¼Œåˆ é™¤æœ€å¤§å…ƒç´ çš„æ“ä½œéœ€è¦ä¸è¶…è¿‡2lgN æ¬¡æ¯”è¾ƒã€‚\nåœ¨å †ä¸Šè¿›è¡Œæ“ä½œ å¤šå‰å † åŸºäºç”¨æ•°ç»„è¡¨ç¤ºçš„å®Œå…¨ä¸‰å‰æ ‘æ„é€ å †å¹¶ä¿®æ”¹ç›¸åº”çš„ä»£ç å¹¶ä¸å›°éš¾ã€‚å¯¹äºæ•°ç»„ä¸­1 è‡³N çš„N ä¸ªå…ƒç´ ï¼Œä½ç½®kçš„ç»“ç‚¹å¤§äºç­‰äºä½äº3k-1ã€3k å’Œ3k+1 çš„ç»“ç‚¹ï¼Œå°äºç­‰äºä½äºï£°(k+1)/3ï£» çš„ç»“ç‚¹\nè°ƒæ•´æ•°ç»„å¤§å° æ·»åŠ ä¸€ä¸ªæ²¡æœ‰å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œ åœ¨insert() ä¸­æ·»åŠ å°†æ•°ç»„é•¿åº¦åŠ å€çš„ä»£ç ï¼Œåœ¨delMax()ä¸­æ·»åŠ å°†æ•°ç»„é•¿åº¦å‡åŠçš„ä»£ç ï¼Œå°±åƒåœ¨1.3 èŠ‚ä¸­çš„æ ˆé‚£æ ·\nå…ƒç´ çš„ä¸å¯å˜æ€§ ä¼˜å…ˆé˜Ÿåˆ—å­˜å‚¨äº†ç”¨ä¾‹åˆ›å»ºçš„å¯¹è±¡ï¼Œä½†åŒæ—¶å‡è®¾ç”¨ä¾‹ä»£ç ä¸ä¼šæ”¹å˜å®ƒä»¬\nç´¢å¼•ä¼˜å…ˆé˜Ÿåˆ— æ³¨æ„minIndex()ï¼Œæœ€å°å…ƒç´ çš„ç´¢å¼•ä¸ä¸€å®šæ˜¯0ï¼Œè¿™é‡Œè¯´çš„ç´¢å¼•ä¸æ˜¯IndexMinPQæ•°æ®ç»“æ„ä¸­çš„æ•°ç»„çš„ç´¢å¼•ã€‚è¿™ä¸¤ä¸ªä¸æ˜¯ä¸€ä¸ªæ„æ€ è¡¨2.4.6 å«æœ‰N ä¸ªå…ƒç´ çš„åŸºäºå †çš„ç´¢å¼•ä¼˜å…ˆé˜Ÿåˆ—æ‰€æœ‰æ“ä½œåœ¨æœ€åæƒ…å†µä¸‹çš„æˆæœ¬ ç´¢å¼•ä¼˜å…ˆé˜Ÿåˆ—ç”¨ä¾‹ å°†å¤šä¸ªæœ‰åºçš„è¾“å…¥æµå½’å¹¶æˆä¸€ä¸ªæœ‰åºçš„è¾“å‡ºæµ â˜…æ³¨æ„ï¼Œè¿™å¤šä¸ªè¾“å…¥æµæœ¬èº«æ˜¯æœ‰åºçš„\npublic class Multiway { public static void merge(In[] streams) { int N = streams.length; IndexMinPQ\u0026lt;String\u0026gt; pq = new IndexMinPQ\u0026lt;String\u0026gt;(N); for (int i = 0; i \u0026lt; N; i++){ if (!streams[i].isEmpty()){ //åˆå§‹åŒ–ï¼Œä»æ–‡ä»¶æµä¸­è¯»å–ä¸€ä¸ªæ•°ï¼Œæ”¾åˆ°ä¼˜å…ˆé˜Ÿåˆ—ä¸­ pq.insert(i, streams[i].readString()); } } while (!pq.isEmpty()) { StdOut.println(pq.min()); //ä»ä¼˜å…ˆé˜Ÿåˆ—ä¸­å–æœ€å°çš„æ•°å‡ºæ¥ int i = pq.delMin(); if (!streams[i].isEmpty()) //å–å‡ºæ•°çš„é‚£ä¸ªä½ç½®ï¼Œå†ä»æ–‡ä»¶æµè¯»ä¸€ä¸ªå€¼æ”¾è¿›å» pq.insert(i, streams[i].readString()); } } public static void main(String[] args) { int N = args.length; In[] streams = new In[N]; for (int i = 0; i \u0026lt; N; i++) streams[i] = new In(args[i]); //ä¸‰ä¸ªæ–‡ä»¶åœ°å€ merge(streams); } } å †æ’åº # æˆ‘ä»¬å¯ä»¥æŠŠä»»æ„ä¼˜å…ˆé˜Ÿåˆ—å˜æˆä¸€ç§æ’åºæ–¹æ³•ï¼Œå°†æ‰€æœ‰å…ƒç´ æ’å…¥ä¸€ä¸ªæŸ¥æ‰¾æœ€å°å…ƒç´ çš„ä¼˜å…ˆé˜Ÿåˆ—ï¼Œç„¶åå†é‡å¤è°ƒç”¨åˆ é™¤æœ€å°å…ƒç´ çš„æ“ä½œæ¥å°†ä»–ä»¬æŒ‰é¡ºåºåˆ å»\nç”¨å †æ¥å®ç°ç»å…¸è€Œä¼˜é›…çš„æ’åºç®—æ³•\u0026ndash;å †æ’åº ä¸ºäº†ä¸å‰é¢ä»£ç ä¿æŒä¸€è‡´ï¼Œä½¿ç”¨é¢å‘æœ€å¤§å…ƒç´ çš„ä¼˜å…ˆé˜Ÿåˆ—å¹¶é‡å¤åˆ é™¤æœ€å¤§å…ƒç´ ï¼›ä¸ºäº†æ’åºéœ€è¦ï¼Œç›´æ¥ä½¿ç”¨swim()å’Œsink()ï¼Œä¸”å°†éœ€è¦æ’åºçš„æ•°ç»„æœ¬èº«ä½œä¸ºå †ï¼Œçœå»é¢å¤–ç©ºé—´ å †çš„æ„é€ \nå¯ä»¥ä»å·¦åˆ°å³ï¼Œå°±åƒè¿ç»­å‘ä¼˜å…ˆé˜Ÿåˆ—ä¸­æ’å…¥å…ƒç´ ä¸€æ ·\nä»å³åˆ°å·¦ï¼Œç”¨sink()å‡½æ•°æ„é€ å­å †\nâ˜… é‡è¦å‰æï¼šæ¯ä¸ªå­å †éƒ½ç¬¦åˆä¼˜å…ˆåºåˆ—çš„æ ¹èŠ‚ç‚¹å¤§äºå…¶ä»–ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥è·³è¿‡å¤§å°ä¸º1çš„å­å †ï¼‰ æ‰€ä»¥åªè¦å¯¹æ¯ä¸ªå­å †çš„æ ¹èŠ‚ç‚¹ï¼Œè¿›è¡Œsink()å‡½æ•°æ“ä½œå°±å¯ä»¥æ„é€ å‡ºä¼˜å…ˆé˜Ÿåˆ—ç»“æ„çš„æ•°ç»„äº†\nè¿›è¡Œæ’åº ä¸»è¦æ˜¯å°†æ•°ç»„çš„ä½ç½®1å’ŒN-1è¿›è¡Œäº¤æ¢ï¼Œç„¶ååœ¨1ä½ç½®è¿›è¡Œsink()æ“ä½œ ä¸æ–­å¾ªç¯ï¼Œå³å¯è®©æ•´ä¸ªæ•°ç»„æœ‰åº\nsort(Comparable[] a) { int N = a.length; for (int k = N/2; k \u0026gt;= 1; k--) sink(a, k, N); while (N \u0026gt; 1) { exch(a, 1, N--); sink(a, 1, N); } } æ³¨æ„ï¼Œè¿™é‡Œçš„sink()å‡½æ•°è¢«ä¿®æ”¹è¿‡ï¼Œä¸»è¦æ˜¯æŒ‡å®šäº†è¦sinkçš„æœ€åä¸€ä¸ªä½ç½®ã€sink() è¢«ä¿®æ”¹è¿‡ï¼Œä»¥a[] å’ŒN ä½œä¸ºå‚æ•°ã€‘ å †æ’åºçš„è½¨è¿¹ï¼ˆæ¯æ¬¡ä¸‹æ²‰åçš„æ•°ç»„å†…å®¹ï¼‰ å †æ’åºï¼šå †çš„æ„é€ ï¼ˆå·¦ï¼‰å’Œä¸‹æ²‰æ’åºï¼ˆå³ï¼‰ å †æ’åºçš„ä¸»è¦å·¥ä½œéƒ½æ˜¯åœ¨ç¬¬äºŒé˜¶æ®µå®Œæˆçš„ã€‚è¿™é‡Œæˆ‘ä»¬å°†å †ä¸­çš„æœ€å¤§å…ƒç´ åˆ é™¤ï¼Œç„¶åæ”¾å…¥å †ç¼©å° åæ•°ç»„ä¸­ç©ºå‡ºçš„ä½ç½®\nå°†Nä¸ªå…ƒç´ æ’åºï¼Œå †æ’åºåªéœ€å°‘äºï¼ˆ2N x lgN+2N ï¼‰æ¬¡æ¯”è¾ƒï¼ˆä»¥åŠä¸€èˆ¬æ¬¡æ•°çš„äº¤æ¢ï¼‰\nã€‚2N é¡¹æ¥è‡ªäºå †çš„æ„é€ ï¼ˆ è§å‘½é¢˜Rï¼‰ã€‚2NlgN é¡¹æ¥è‡ªäºæ¯æ¬¡ä¸‹æ²‰æ“ä½œæœ€å¤§å¯èƒ½éœ€è¦2lgNæ¬¡æ¯”è¾ƒï¼ˆè§å‘½é¢˜P ä¸å‘½é¢˜Qï¼‰\næˆ‘ä»¬å°†è¯¥å®ç°å’Œä¼˜å…ˆé˜Ÿåˆ—çš„API ç‹¬ç«‹å¼€æ¥æ˜¯ä¸ºäº†çªå‡ºè¿™ä¸ªæ’åºç®—æ³•çš„ç®€æ´æ€§ï¼ˆsort() æ–¹æ³•åªéœ€8 è¡Œä»£ç ï¼Œsink() å‡½æ•°8 è¡Œï¼‰ï¼Œå¹¶ä½¿å…¶å¯ä»¥åµŒå…¥å…¶ä»–ä»£ç ä¹‹ä¸­ã€‚\nå°ç»“\nåœ¨æœ€åçš„æƒ…å†µä¸‹å®ƒä¹Ÿèƒ½ä¿è¯ä½¿ç”¨ï½ 2NlgN æ¬¡æ¯”è¾ƒå’Œæ’å®šçš„é¢å¤–ç©ºé—´ã€‚å½“ç©ºé—´ååˆ†ç´§å¼ çš„æ—¶å€™ï¼ˆä¾‹å¦‚åœ¨åµŒå…¥å¼ç³»ç»Ÿæˆ–ä½æˆæœ¬çš„ç§»åŠ¨è®¾å¤‡ä¸­ï¼‰å®ƒå¾ˆæµè¡Œï¼Œå› ä¸ºå®ƒåªç”¨å‡ è¡Œå°±èƒ½å®ç°ï¼ˆç”šè‡³æœºå™¨ç ä¹Ÿæ˜¯ï¼‰è¾ƒå¥½çš„æ€§èƒ½ã€‚ä½†ç°ä»£ç³»ç»Ÿçš„è®¸å¤šåº”ç”¨å¾ˆå°‘ä½¿ç”¨å®ƒï¼Œå› ä¸ºå®ƒæ— æ³•åˆ©ç”¨ç¼“å­˜ã€‚æ•°ç»„å…ƒç´ å¾ˆå°‘å’Œç›¸é‚»çš„å…¶ä»–å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå› æ­¤ç¼“å­˜æœªå‘½ä¸­çš„æ¬¡æ•°è¦è¿œè¿œé«˜äºå¤§å¤šæ•°æ¯”è¾ƒéƒ½åœ¨ç›¸é‚»å…ƒç´ é—´è¿›è¡Œçš„ç®—æ³•ï¼Œå¦‚å¿«é€Ÿæ’åºã€å½’å¹¶æ’åºï¼Œç”šè‡³æ˜¯å¸Œå°”æ’åº ç”¨å †å®ç°çš„ä¼˜å…ˆé˜Ÿåˆ—åœ¨ç°ä»£åº”ç”¨ç¨‹åºä¸­è¶Šæ¥è¶Šé‡è¦ï¼Œå› ä¸ºå®ƒèƒ½åœ¨æ’å…¥æ“ä½œå’Œåˆ é™¤æœ€å¤§å…ƒç´ æ“ä½œæ··åˆçš„åŠ¨æ€åœºæ™¯ä¸­ä¿è¯å¯¹æ•°çº§åˆ«çš„è¿è¡Œæ—¶é—´ "},{"id":190,"href":"/zh/docs/study/Flowable/zsx_design/01/","title":"zsx_flowable_design01","section":"Flowable","content":" æ¨¡å‹è®¾è®¡å®Œåï¼Œä¸‹é¢ä¸‰ä¸ªè¡¨æœ‰å˜åŒ–\nact_cio_model act_cio_model_module_rel act_ge_bytearray éƒ¨ç½²ä¹‹åï¼Œå››ä¸ªè¡¨æœ‰å˜åŒ– act_cio_deployment å¤šäº†39æ¡è®°å½• act_ge_bytearray å¤šäº†ä¸¤æ¡è®°å½• act_re_deployment å¤šäº†ä¸€æ¡è®°å½• act_re_procdef å¤šäº†ä¸€æ¡è®°å½• æµç¨‹å¼€å§‹è¿è¡Œ\nä¸‹é¢åªå†™ä¸Šä¸»è¦çš„å‡ ä¸ªè¡¨ é€å®¡æ—¶è¿™ä¸ªç»“ç‚¹åªèƒ½é€‰ä¸€ä¸ª æµç¨‹è¿è¡Œæ—¶å˜é‡è¡¨ "},{"id":191,"href":"/zh/docs/study/Linux/hanshunping/28-39/","title":"linux_éŸ©è€å¸ˆ_28-39","section":"éŸ©é¡ºå¹³è€å¸ˆ_","content":" æ–‡ä»¶ç›®å½• # ç”¨æ¥å®šä½ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ cd ~ ç”¨æ¥å®šä½å®¶ç›®å½• cd .. è¿”å›ä¸Šä¸€çº§ cd - è¿”å›ä¸Šä¸€æ¬¡ç›®å½•\nmkdir ç”¨äºåˆ›å»ºç›®å½• mkdir -p hello/l1/l2 å¤šçº§ç›®å½•åˆ›å»º\nrecursion é€’å½’ rm -rf è¦åˆ é™¤çš„ç›®å½• #é€’å½’åˆ é™¤\nä½¿ç”¨cpè¿›è¡Œå¤åˆ¶ï¼ŒåŠ ä¸Š -r è¿›è¡Œé€’å½’å¤åˆ¶\nrm åˆ é™¤æŸä¸ªæ–‡ä»¶ï¼ˆå¸¦æç¤ºï¼‰\nrm -f åˆ é™¤æ–‡ä»¶ï¼ˆä¸å¸¦æç¤ºï¼‰ rm -rf å¼ºåˆ¶åˆ é™¤é€’å½’æ–‡ä»¶ï¼ˆå¤¹ï¼‰ mv ç”¨æ¥é‡å‘½åï¼ˆç§»åŠ¨åˆ°åŒä¸€ç›®å½•ä¸‹ï¼‰ã€ï¼ˆæˆ–è€…ç§»åŠ¨æ–‡ä»¶ï¼‰\næ³¨æ„ï¼Œä¸‹é¢çš„å‘½ä»¤ï¼Œæ˜¯å°†helloç§»åŠ¨åˆ°hello2ä¸‹ï¼Œå¹¶æ”¹åä¸ºaï¼ˆè€Œä¸æ˜¯hello2ä¸‹çš„aç›®å½•ï¼‰ mv Hello.java hello2/a\nmv Hello.java hello2/a/ ç§»åŠ¨åˆ°hello2ä¸‹çš„aç›®å½•ä¸‹(æœ€åæœ‰ä¸€ä¸ªæ–œæ ) ç§»åŠ¨ç›®å½•\nmv hello2 hello1/AB æˆ–è€… mv hello2/ hello1/AB\næˆ–è€… mv hello2/ hello1/AB/\nä¼šæŠŠæ•´ä¸ªhello2æ–‡ä»¶å¤¹ï¼ˆåŒ…æ‹¬hello2ï¼‰ç§»åŠ¨åˆ°ABä¸‹\nåŒæ ·æ˜¯ä¸Šé¢çš„æŒ‡ä»¤ï¼Œå¦‚æœABä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä¼šå°†hello2ç§»åŠ¨åˆ°hello1ä¸‹ï¼Œå¹¶å°†hello2æ–‡ä»¶å¤¹ï¼Œæ”¹åä¸ºAB\ncat æŒ‡ä»¤\ncat -p /etc/profile æµè§ˆå¹¶æ˜¾ç¤ºæ–‡ä»¶ ç®¡é“å‘½ä»¤ cat -p /etc/profile | more æŠŠå‰é¢çš„ç»“æœå†äº¤ç»™moreå¤„ç† ï¼ˆè¾“å…¥enteræŸ¥çœ‹ä¸‹ä¸€è¡Œï¼Œç©ºæ ¼æŸ¥çœ‹ä¸‹ä¸€é¡µï¼‰ lessæŒ‡ä»¤\nless /etc/profile lessæŒ‡ä»¤æ˜¾ç¤ºçš„æ—¶å€™ï¼Œæ˜¯æŒ‰éœ€åŠ è½½å†…å®¹ï¼Œæ•ˆç‡è¾ƒé«˜, qé€€å‡º echo è¾“å‡ºåˆ°æ§åˆ¶å°\necho $HOSTNAME è¾“å‡ºç¯å¢ƒå˜é‡ head æ–‡ä»¶å‰å‡ è¡Œ\nhead -3 /etc/profile #æŸ¥çœ‹æ–‡ä»¶å‰ä¸‰è¡Œ tail æ–‡ä»¶åå‡ è¡Œ\nå®æ—¶ç›‘æ§ tail -f mydate.txt è¦†ç›– echo \u0026ldquo;hello\u0026rdquo; \u0026gt; mydate.txt è¿½åŠ  echo \u0026ldquo;hi\u0026rdquo; \u0026raquo; mydate.txt cal \u0026gt; mydate.txt å°†æ—¥å¿—æ·»åŠ åˆ°æ–‡ä»¶å lnæŒ‡ä»¤ ln -s /root/ /home/myroot åœ¨homeä¸‹åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥ï¼Œåä¸ºmyrootï¼Œè¿æ¥åˆ°root æ­¤æ—¶cd myrootï¼Œå°±ä¼šè¿›å…¥rootæ–‡ä»¶å¤¹ ä½¿ç”¨rm -f åˆ é™¤è½¯è¿æ¥ åŠ¨æ€é“¾æ¥åº“ history æŸ¥çœ‹æ›¾ç»æ‰§è¡Œè¿‡çš„å‘½ä»¤ ! + æ•°å­—ï¼Œæ‰§è¡Œæ›¾ç»æ‰§è¡Œè¿‡çš„æŒ‡ä»¤ æ—¶é—´æ—¥æœŸ # dateæŒ‡ä»¤\u0026ndash; æ˜¾ç¤ºå½“å‰æ—¥æœŸ date date +%Y å¹´ä»½ date +%m æœˆä»½ date +%d å“ªä¸€å¤© date \u0026ldquo;+%Y-%m-%d %H:%M:%S\u0026rdquo; å¹´æœˆæ—¥æ—¶åˆ†ç§’ cal 2020 #2020å¹´æ‰€æœ‰æ—¥å† æŸ¥æ‰¾æŒ‡ä»¤ # find /home -name hello.txt åœ¨/homeç›®å½•ä¸‹ï¼ŒæŒ‰åå­—æŸ¥æ‰¾hello.txt find /home -user tom æŒ‰æ‹¥æœ‰è€…æŸ¥æ‰¾\nfind / -size -10M | more æŸ¥æ‰¾å°äº10Mçš„æ–‡ä»¶ ls -lh (h,ä»¥æ›´ç¬¦åˆäººç±»æŸ¥çœ‹çš„çš„æ–¹å¼æ˜¾ç¤º) locate æœç´¢æ–‡ä»¶ ï¼ˆlocateä¹‹å‰è¦ä½¿ç”¨updatedbæŒ‡ä»¤åˆ›å»ºï¼‰ (å…ˆä½¿ç”¨yum install -y mlocate è¿›è¡Œå®‰è£…)\nè¿›è¡ŒæŸ¥æ‰¾ which ls æŸ¥çœ‹lsåœ¨å“ªä¸ªç›®å½•ä¸‹ grep è¿‡æ»¤æŸ¥æ‰¾ï¼Œç®¡é“ç¬¦ï¼Œ\u0026quot;|\u0026quot; è¡¨ç¤ºå°†å‰ä¸€ä¸ªå‘½ä»¤çš„å¤„ç†ç»“æœè¾“å‡ºä¼ é€’ç»™åé¢çš„å‘½ä»¤å¤„ç†\ncat /etc/profile | grep 22 -n -i å‹ç¼©å’Œè§£å‹ # ä½¿ç”¨gzip å’Œ gunzip tar ç”¨æ¥å‹ç¼©æˆ–è€…è§£å‹ å‹ç¼©åçš„æ ¼å¼ .tar.gz é€‰é¡¹è¯´æ˜ -c äº§ç”Ÿ.taræ‰“åŒ…æ–‡ä»¶ -v æ˜¾ç¤ºè¯¦æƒ…ä¿¡æ¯ -f æŒ‡å®šå‹ç¼©åçš„æ–‡ä»¶å -z æ‰“åŒ…åŒæ—¶å‹ç¼© -x è§£åŒ….taræ–‡ä»¶ ä½¿ç”¨ tar -zcvf pc.tar.gz /home/pig.txt /home/cat.txt è§£å‹ tar -zxvf pc.tar.gz è§£å‹åˆ°æŒ‡å®šçš„ç›®å½• tar -zxvf pc.tar.gz -C tom/ # "},{"id":192,"href":"/zh/docs/study/Linux/hanshunping/21-27/","title":"linux_éŸ©è€å¸ˆ_21-33","section":"éŸ©é¡ºå¹³è€å¸ˆ_","content":" ç”¨æˆ·ç®¡ç† # ä½¿ç”¨ssh root@192.168.200.201è¿›è¡ŒæœåŠ¡å™¨è¿æ¥ xshellä¸­ ctr+shift+r ç”¨æ¥é‡æ–°è¿æ¥\nç”¨æˆ·è§£é‡Šå›¾ æ·»åŠ ä¸€ä¸ªç”¨æˆ·milanï¼Œä¼šè‡ªåŠ¨åˆ›å»ºè¯¥ç”¨æˆ·çš„å®¶ç›®å½•milan\nå½“ç™»å½•è¯¥ç”¨æˆ·æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°å®¶ç›®å½•ä¸‹ æŒ‡å®šå®¶ç›®å½• æŒ‡å®šå¯†ç  ç”¨milanç™»å½•ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°/home/milan pwd:æ˜¾ç¤ºå½“å‰ç”¨æˆ·æ‰€åœ¨çš„ç›®å½•\nç”¨æˆ·åˆ é™¤\nåˆ é™¤ç”¨æˆ·ä½†ä¿ç•™å®¶ç›®å½• éœ€è¦ç”¨è¶…çº§ç®¡ç†å‘˜æ‰èƒ½åˆ é™¤ ä½¿ç”¨su -u rootåˆ‡æ¢åˆ°è¶…çº§ç®¡ç†å‘˜ å…ˆlogoutç„¶åå†åˆ é™¤ åˆ é™¤ç”¨æˆ·åŠå®¶ç›®å½• userdel -r milan å»ºè®®ä¿ç•™å®¶ç›®å½• æŸ¥è¯¢rootç”¨æˆ·ä¿¡æ¯\nä½¿ç”¨id xx æŸ¥è¯¢ åˆ‡æ¢ç”¨æˆ· su - xx\nä»æƒé™é«˜åˆ‡æ¢åˆ°æƒé™ä½çš„ç”¨æˆ·ä¸éœ€è¦å¯†ç ï¼›åä¹‹éœ€è¦ ä½¿ç”¨logoutï¼ˆexitä¹Ÿè¡Œï¼‰ï¼Œä»rootç”¨æˆ·å›åˆ°jack æŸ¥çœ‹å½“å‰ç”¨æˆ· who am i å³ä½¿åˆ‡æ¢äº†ç”¨æˆ·ï¼Œè¿”å›çš„è¿˜æ˜¯rootï¼ˆç¬¬ä¸€æ¬¡ç™»å½•æ—¶çš„ç”¨æˆ·) ç”¨æˆ·ç»„ï¼ˆè§’è‰²ï¼‰\nå¢åŠ ã€åˆ é™¤ç»„\ngroupadd wudang groupdel wudang å¦‚æœæ·»åŠ ç”¨æˆ·çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šç»„ï¼Œé‚£ä¹ˆä¼šåˆ›å»ºä¸€ä¸ªè·Ÿç”¨æˆ·åä¸€æ ·çš„åå­—çš„ç»„ idæ˜¯1002ï¼Œç»„ä¸ºking\næ·»åŠ ç”¨æˆ·zwjï¼Œæ·»åŠ ç»„wudangï¼Œå¹¶å°†zwjæ·»åŠ åˆ°wudangç»„é‡Œé¢\ngroupadd wudang useradd -g wudang zwj ä¿®æ”¹ç”¨æˆ·æ‰€åœ¨ç»„\ngroupadd mojiao usermod -g mojiao zwj å…³äºç”¨æˆ·å’Œç»„ç›¸å…³çš„æ–‡ä»¶\n/etc/passwd æ¯è¡Œçš„å«ä¹‰ shell è§£é‡Šå’Œç¿»è¯‘æŒ‡ä»¤ ä¸€èˆ¬ç”¨bashï¼Œè¿˜æœ‰å…¶ä»–ï¼Œå¾ˆå¤š\n/etc/shadow å£ä»¤é…ç½®æ–‡ä»¶\næ¯è¡Œçš„å«ä¹‰ /etc/group è®°å½•ç»„çš„ä¿¡æ¯ ç»„åï¼šå£ä»¤ï¼šç»„æ ‡è¯†å·ï¼šç»„å†…ç”¨æˆ·åˆ—è¡¨\nè¿è¡Œçº§åˆ« # åŸºæœ¬ä»‹ç»\n0 å…³æœº 1 å•ç”¨æˆ·ï¼ˆæ‰¾å›å¯†ç ï¼‰ 2 å¤šç”¨æˆ·çŠ¶æ€æ²¡æœ‰ç½‘ç»œæœåŠ¡ 3 å¤šç”¨æˆ·çŠ¶æ€æœ‰ç½‘ç»œæœåŠ¡ 4ç³»ç»Ÿæœªä½¿ç”¨ä¿ç•™ç»™ç”¨æˆ· 5 å›¾å½¢ç•Œé¢ 6 ç³»ç»Ÿé‡å¯ åœ¨å›¾å½¢ç•Œé¢è¾“å…¥init 3 ä¼šç›´æ¥è¿›å…¥ç»ˆç«¯ç•Œé¢\nä¹‹åè¾“å…¥init 5 ä¼šé‡æ–°è¿›å…¥å›¾å½¢ç•Œé¢ init 0 ä¼šç›´æ¥å…³æœº\næŒ‡å®šé»˜è®¤çº§åˆ« centosOS7ä¹‹å‰ï¼Œåœ¨/etc/inittabæ–‡ä»¶ä¸­ ä¹‹åè¿›è¡Œäº†ç®€åŒ–ï¼Œå¦‚ä¸‹ æŸ¥çœ‹é»˜è®¤çº§åˆ«\nsystemctl get-default # multi-user.target è®¾ç½®é»˜è®¤çº§åˆ«\nsystemctl set-default multi-user.target æ‰¾å›rootå¯†ç  # è¿™é‡Œè®²çš„æ˜¯centos os7ä¹‹å\né‡å¯åï¼Œç«‹é©¬æŒ‰e\nç„¶åå…‰æ ‡å¾€ä¸‹æ»‘ åœ¨utf-8åé¢ï¼ŒåŠ å…¥ init=/bin/sh ï¼ˆè¿›å…¥å•ç”¨æˆ·å®ä¾‹ï¼Œæ³¨æ„ è¿™é‡Œä¸è¦åŠ å…¥ç©ºæ ¼ï¼‰\nç„¶åctrl+x è¡¨ç¤ºå¯åŠ¨\nç„¶åè¾“å…¥\nmount -o remount,rw / passwd ä¿®æ”¹æˆåŠŸ ç„¶åå†è¾“å…¥\ntouch /.autorelabel exec /sbin/init exec /sbin/init ä¹‹åæ—¶é—´æ¯”è¾ƒé•¿ï¼Œç­‰å¾…ä¸€ä¼šï¼Œå¯†ç åˆ™ç”Ÿæ•ˆ\n(å¡ä½ä¸¤ä¸‰åˆ†é’Ÿ)\nssh root@192.168.200.201 ç™»å½•æˆåŠŸ\nå¸®åŠ©æŒ‡ä»¤ # man ls linuxä¸­ï¼Œéšè—æ–‡ä»¶ä»¥ . å¼€å¤´ï¼ˆä»¥ç‚¹å¼€å¤´ï¼‰ è¾“å…¥qé€€å‡ºman lsé€‰é¡¹å¯ä»¥ç»„åˆä½¿ç”¨ ls -l å•åˆ—è¾“å‡º(use a long listing format)ï¼Œä¿¡æ¯æœ€å…¨ ls -la å•åˆ—è¾“å‡ºï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶ ls -al /root æ˜¾ç¤º/rootç›®å½•ä¸‹çš„å†…å®¹ help å†…ç½®å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯\nè¯¥å‘½ä»¤åœ¨zshä¸‹ä¸èƒ½ç”¨ï¼Œæ‰€ä»¥ä½¿ç”¨ä¸‹é¢æŒ‡ä»¤åˆ‡æ¢ chsh -s /bin/bash #zshåˆ‡æ¢åˆ°bashï¼Œé‡å¯åç”Ÿæ•ˆ chsh -s /bin/zsh #bashåˆ‡æ¢åˆ°zshï¼Œé‡å¯åç”Ÿæ•ˆ help cd End "},{"id":193,"href":"/zh/docs/study/MyBatis-Plus/official/hello/","title":"å®˜æ–¹çš„hello-world","section":"My Batis Plus","content":" ç®€ä»‹ # MyBatis-Plus (opens new window)ï¼ˆç®€ç§° MPï¼‰æ˜¯ä¸€ä¸ª MyBatis (opens new window)çš„å¢å¼ºå·¥å…·ï¼Œåœ¨ MyBatis çš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚ å¿«é€Ÿå¼€å§‹ # æ•°æ®åº“çš„Schemaè„šæœ¬ resources/db/schema-mysql.sql\nDROP TABLE IF EXISTS user; CREATE TABLE user ( id BIGINT(20) NOT NULL COMMENT \u0026#39;ä¸»é”®ID\u0026#39;, name VARCHAR(30) NULL DEFAULT NULL COMMENT \u0026#39;å§“å\u0026#39;, age INT(11) NULL DEFAULT NULL COMMENT \u0026#39;å¹´é¾„\u0026#39;, email VARCHAR(50) NULL DEFAULT NULL COMMENT \u0026#39;é‚®ç®±\u0026#39;, PRIMARY KEY (id) ); æ•°æ®åº“Dataè„šæœ¬ resources/db/data-mysql.sql\nDELETE FROM user; INSERT INTO user (id, name, age, email) VALUES (1, \u0026#39;Jone\u0026#39;, 18, \u0026#39;test1@baomidou.com\u0026#39;), (2, \u0026#39;Jack\u0026#39;, 20, \u0026#39;test2@baomidou.com\u0026#39;), (3, \u0026#39;Tom\u0026#39;, 28, \u0026#39;test3@baomidou.com\u0026#39;), (4, \u0026#39;Sandy\u0026#39;, 21, \u0026#39;test4@baomidou.com\u0026#39;), (5, \u0026#39;Billie\u0026#39;, 24, \u0026#39;test5@baomidou.com\u0026#39;); åˆ›å»ºä¸€ä¸ªspring bootå·¥ç¨‹ï¼ˆä½¿ç”¨mavenï¼‰\nçˆ¶å·¥ç¨‹\n\u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.7.0\u0026lt;/version\u0026gt; \u0026lt;relativePath/\u0026gt; \u0026lt;/parent\u0026gt; springboot ç›¸å…³ä»“åº“åŠmybatis-plusã€mysqlã€Lombokç›¸å…³ä»“åº“å¼•å…¥\n\u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.baomidou\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mybatis-plus-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.5.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.h2database\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;h2\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;runtime\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;8.0.29\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.projectlombok\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;lombok\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.18.24\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; é…ç½®resources/application.ymlæ–‡ä»¶\nspring: datasource: url: jdbc:mysql://localhost:3306/mybatis_plus_demo?useUnicode=true\u0026amp;characterEncoding=utf-8\u0026amp;allowMultiQueries=true\u0026amp;nullCatalogMeansCurrent=true username: root password: 123456 driver-class-name: com.mysql.cj.jdbc.Driver sql: init: schema-locations: classpath:db/schema-mysql.sql data-locations: classpath:db/data-mysql.sql mode: always entityç±»å’Œmapperç±»çš„å¤„ç†\nentity\n@Data public class User { private Long id; private String name; private Integer age; private String email; } mapper\nimport com.baomidou.mybatisplus.core.mapper.BaseMapper; import com.baomidou.mybatisplus.samples.quickstart.entity.User; public interface UserMapper extends BaseMapper\u0026lt;User\u0026gt; { } æµ‹è¯•ç±»\nimport com.baomidou.mybatisplus.samples.quickstart.Application; import com.baomidou.mybatisplus.samples.quickstart.entity.User; import com.baomidou.mybatisplus.samples.quickstart.mapper.UserMapper; import org.junit.jupiter.api.Assertions; import org.junit.jupiter.api.Test; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.boot.test.context.SpringBootTest; import java.util.List; @SpringBootTest(classes = {Application.class}) public class SampleTest { @Autowired private UserMapper userMapper; @Test public void testSelect() { System.out.println((\u0026#34;----- selectAll method test ------\u0026#34;)); List\u0026lt;User\u0026gt; userList = userMapper.selectList(null); Assertions.assertEquals(5, userList.size()); userList.forEach(System.out::println); } } mybatis-plus ä»£ç è‡ªåŠ¨ç”Ÿæˆ # maven ä¾èµ–\n\u0026lt;!-- https://mvnrepository.com/artifact/com.baomidou/mybatis-plus-generator --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.baomidou\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mybatis-plus-generator\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.5.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- https://mvnrepository.com/artifact/org.apache.velocity/velocity-engine-core --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.velocity\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;velocity-engine-core\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.3\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; åœ¨æµ‹è¯•ç±»ä¸­ç¼–å†™ç¨‹åºè®©å…¶è‡ªåŠ¨ç”Ÿæˆ\nimport com.baomidou.mybatisplus.generator.FastAutoGenerator; import com.baomidou.mybatisplus.generator.config.DataSourceConfig; import org.apache.ibatis.jdbc.ScriptRunner; import java.io.InputStream; import java.io.InputStreamReader; import java.sql.Connection; import java.sql.SQLException; /** * \u0026lt;p\u0026gt; * å¿«é€Ÿç”Ÿæˆ * \u0026lt;/p\u0026gt; * * @author lanjerry * @since 2021-09-16 */ public class FastAutoGeneratorTest { /** * æ‰§è¡Œåˆå§‹åŒ–æ•°æ®åº“è„šæœ¬ */ public static void before() throws SQLException { Connection conn = DATA_SOURCE_CONFIG.build().getConn(); InputStream inputStream = FastAutoGeneratorTest.class.getResourceAsStream(\u0026#34;/db/schema-mysql.sql\u0026#34;); ScriptRunner scriptRunner = new ScriptRunner(conn); scriptRunner.setAutoCommit(true); scriptRunner.runScript(new InputStreamReader(inputStream)); conn.close(); } /** * æ•°æ®æºé…ç½® */ private static final DataSourceConfig.Builder DATA_SOURCE_CONFIG = new DataSourceConfig .Builder(\u0026#34;jdbc:mysql://localhost:3306/mybatis_plus_demo?useUnicode=true\u0026amp;characterEncoding=utf-8\u0026amp;allowMultiQueries=true\u0026amp;nullCatalogMeansCurrent=true\u0026#34;, \u0026#34;root\u0026#34;, \u0026#34;123456\u0026#34;); /** * æ‰§è¡Œ run */ public static void main(String[] args) throws SQLException { before(); FastAutoGenerator.create(DATA_SOURCE_CONFIG) // å…¨å±€é…ç½® .globalConfig((scanner, builder) -\u0026gt; builder.author(scanner.apply(\u0026#34;è¯·è¾“å…¥ä½œè€…åç§°\u0026#34;))) // åŒ…é…ç½® .packageConfig((scanner, builder) -\u0026gt; builder.parent(scanner.apply(\u0026#34;è¯·è¾“å…¥åŒ…å\u0026#34;))) // ç­–ç•¥é…ç½® .strategyConfig((scanner, builder) -\u0026gt; builder.addInclude(scanner.apply(\u0026#34;è¯·è¾“å…¥è¡¨åï¼Œå¤šä¸ªè¡¨åç”¨,éš”å¼€\u0026#34;))) /* æ¨¡æ¿å¼•æ“é…ç½®ï¼Œé»˜è®¤ Velocity å¯é€‰æ¨¡æ¿å¼•æ“ Beetl æˆ– Freemarker .templateEngine(new BeetlTemplateEngine()) .templateEngine(new FreemarkerTemplateEngine()) */ .execute(); } } ä½¿ç”¨mybats-xæ’ä»¶è‡ªåŠ¨ç”Ÿæˆä»£ç \næ“ä½œ ç¼–å†™controllerç¡®å®š\n@RestController @RequestMapping(\u0026#34;user\u0026#34;) public class UserController { @Autowired private UserService userService; @RequestMapping(\u0026#34;findAll\u0026#34;) public List\u0026lt;User\u0026gt; findAll(){ List\u0026lt;User\u0026gt; list = userService.list(); return list; } } xmlæ–‡ä»¶\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE mapper PUBLIC \u0026#34;-//mybatis.org//DTD Mapper 3.0//EN\u0026#34; \u0026#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd\u0026#34;\u0026gt; \u0026lt;mapper namespace=\u0026#34;com.baomidou.mybatisplus.samples.quickstart.mapper.UserMapper\u0026#34;\u0026gt; \u0026lt;resultMap id=\u0026#34;BaseResultMap\u0026#34; type=\u0026#34;com.baomidou.mybatisplus.samples.quickstart.entity.User\u0026#34;\u0026gt; \u0026lt;id property=\u0026#34;id\u0026#34; column=\u0026#34;id\u0026#34; jdbcType=\u0026#34;BIGINT\u0026#34;/\u0026gt; \u0026lt;result property=\u0026#34;name\u0026#34; column=\u0026#34;name\u0026#34; jdbcType=\u0026#34;VARCHAR\u0026#34;/\u0026gt; \u0026lt;result property=\u0026#34;age\u0026#34; column=\u0026#34;age\u0026#34; jdbcType=\u0026#34;INTEGER\u0026#34;/\u0026gt; \u0026lt;result property=\u0026#34;email\u0026#34; column=\u0026#34;email\u0026#34; jdbcType=\u0026#34;VARCHAR\u0026#34;/\u0026gt; \u0026lt;/resultMap\u0026gt; \u0026lt;sql id=\u0026#34;Base_Column_List\u0026#34;\u0026gt; id,name,age, email \u0026lt;/sql\u0026gt; \u0026lt;/mapper\u0026gt; entity\n/** * * @TableName user */ @TableName(value =\u0026#34;user\u0026#34;) public class User implements Serializable { /** * ä¸»é”®ID */ @TableId private Long id; /** * å§“å */ private String name; /** * å¹´é¾„ */ private Integer age; /** * é‚®ç®± */ private String email; @TableField(exist = false) private static final long serialVersionUID = 1L; /** * ä¸»é”®ID */ public Long getId() { return id; } /** * ä¸»é”®ID */ public void setId(Long id) { this.id = id; } /** * å§“å */ public String getName() { return name; } /** * å§“å */ public void setName(String name) { this.name = name; } /** * å¹´é¾„ */ public Integer getAge() { return age; } /** * å¹´é¾„ */ public void setAge(Integer age) { this.age = age; } /** * é‚®ç®± */ public String getEmail() { return email; } /** * é‚®ç®± */ public void setEmail(String email) { this.email = email; } @Override public boolean equals(Object that) { if (this == that) { return true; } if (that == null) { return false; } if (getClass() != that.getClass()) { return false; } User other = (User) that; return (this.getId() == null ? other.getId() == null : this.getId().equals(other.getId())) \u0026amp;\u0026amp; (this.getName() == null ? other.getName() == null : this.getName().equals(other.getName())) \u0026amp;\u0026amp; (this.getAge() == null ? other.getAge() == null : this.getAge().equals(other.getAge())) \u0026amp;\u0026amp; (this.getEmail() == null ? other.getEmail() == null : this.getEmail().equals(other.getEmail())); } @Override public int hashCode() { final int prime = 31; int result = 1; result = prime * result + ((getId() == null) ? 0 : getId().hashCode()); result = prime * result + ((getName() == null) ? 0 : getName().hashCode()); result = prime * result + ((getAge() == null) ? 0 : getAge().hashCode()); result = prime * result + ((getEmail() == null) ? 0 : getEmail().hashCode()); return result; } @Override public String toString() { StringBuilder sb = new StringBuilder(); sb.append(getClass().getSimpleName()); sb.append(\u0026#34; [\u0026#34;); sb.append(\u0026#34;Hash = \u0026#34;).append(hashCode()); sb.append(\u0026#34;, id=\u0026#34;).append(id); sb.append(\u0026#34;, name=\u0026#34;).append(name); sb.append(\u0026#34;, age=\u0026#34;).append(age); sb.append(\u0026#34;, email=\u0026#34;).append(email); sb.append(\u0026#34;, serialVersionUID=\u0026#34;).append(serialVersionUID); sb.append(\u0026#34;]\u0026#34;); return sb.toString(); } } serviceæ¥å£ç±»\npublic interface UserService extends IService\u0026lt;User\u0026gt; { } serviceImpl\n@Service public class UserServiceImpl extends ServiceImpl\u0026lt;UserMapper, User\u0026gt; implements UserService{ } mapper\npublic interface UserMapper extends BaseMapper\u0026lt;User\u0026gt; { } controlleræµ‹è¯•\n@RestController @RequestMapping(\u0026#34;user\u0026#34;) public class UserController { @Autowired private UserService userService; @RequestMapping(\u0026#34;findAll\u0026#34;) public List\u0026lt;User\u0026gt; findAll(){ List\u0026lt;User\u0026gt; list = userService.list(); return list; } } æµ‹è¯• ä½¿ç”¨mybatis-x æ’ä»¶ï¼ˆideaï¼‰\n"},{"id":194,"href":"/zh/docs/study/Flowable/boge_blbl/03-others/","title":"boge-03-å…¶ä»–","section":"åŸºç¡€(æ³¢å“¥)_","content":" ä¼šç­¾ # æµç¨‹å›¾ç»˜åˆ¶ æ³¨æ„ä¸Šé¢å‡ ä¸ªå‚æ•°\nå¤šå®ä¾‹ç±»å‹ç”¨æ¥åˆ¤æ–­ä¸²è¡Œå¹¶è¡Œ åŸºæ•°ï¼ˆæœ‰å‡ ä¸ªç”¨æˆ·å¤„ç†ï¼‰ å…ƒç´ å˜é‡ é›†åˆï¼ˆé›†åˆå˜é‡ï¼‰ å®Œæˆæ¡ä»¶\u0026ndash;è¿™é‡Œå¡«çš„æ˜¯ ${nrOfCompletedInstances \u0026gt; 1 } åœ¨ä»»åŠ¡ç›‘å¬å™¨ package org.flowable.listener; import org.flowable.engine.ProcessEngine; import org.flowable.engine.ProcessEngines; import org.flowable.engine.TaskService; import org.flowable.engine.delegate.TaskListener; import org.flowable.task.api.Task; import org.flowable.task.service.delegate.DelegateTask; public class MultiInstanceTaskListener implements TaskListener { @Override public void notify(DelegateTask delegateTask) { System.out.println(\u0026#34;å¤„ç†aaaa\u0026#34;); if(delegateTask.getEventName().equals(\u0026#34;create\u0026#34;)) { System.out.println(\u0026#34;ä»»åŠ¡id\u0026#34; + delegateTask.getId()); System.out.println(\u0026#34;å“ªäº›äººéœ€è¦ä¼šç­¾\u0026#34; + delegateTask.getVariable(\u0026#34;persons\u0026#34;)); System.out.println(\u0026#34;ä»»åŠ¡å¤„ç†äºº\u0026#34; + delegateTask.getVariable(\u0026#34;person\u0026#34;)); ProcessEngine engine = ProcessEngines.getDefaultProcessEngine(); TaskService taskService = engine.getTaskService(); Task task = taskService.createTaskQuery().taskId(delegateTask.getId()).singleResult(); task.setAssignee(delegateTask.getVariable(\u0026#34;person\u0026#34;).toString()); taskService.saveTask(task); } } } xml\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;definitions xmlns=\u0026#34;http://www.omg.org/spec/BPMN/20100524/MODEL\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:xsd=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; xmlns:flowable=\u0026#34;http://flowable.org/bpmn\u0026#34; xmlns:bpmndi=\u0026#34;http://www.omg.org/spec/BPMN/20100524/DI\u0026#34; xmlns:omgdc=\u0026#34;http://www.omg.org/spec/DD/20100524/DC\u0026#34; xmlns:omgdi=\u0026#34;http://www.omg.org/spec/DD/20100524/DI\u0026#34; typeLanguage=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; expressionLanguage=\u0026#34;http://www.w3.org/1999/XPath\u0026#34; targetNamespace=\u0026#34;http://www.flowable.org/processdef\u0026#34; exporter=\u0026#34;Flowable Open Source Modeler\u0026#34; exporterVersion=\u0026#34;6.7.2\u0026#34;\u0026gt; \u0026lt;process id=\u0026#34;join-key\u0026#34; name=\u0026#34;ä¼šç­¾æµ‹è¯•1\u0026#34; isExecutable=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;documentation\u0026gt;join-desc\u0026lt;/documentation\u0026gt; \u0026lt;startEvent id=\u0026#34;startEvent1\u0026#34; name=\u0026#34;ç”³è¯·äºº\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt;\u0026lt;/startEvent\u0026gt; \u0026lt;userTask id=\u0026#34;sid-477F728E-2F63-43BF-A278-76FBCF58B475\u0026#34; name=\u0026#34;ä¼šç­¾äººå‘˜\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;flowable:taskListener event=\u0026#34;create\u0026#34; class=\u0026#34;org.flowable.listener.MultiInstanceTaskListener\u0026#34;\u0026gt;\u0026lt;/flowable:taskListener\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;multiInstanceLoopCharacteristics isSequential=\u0026#34;false\u0026#34; flowable:collection=\u0026#34;persons\u0026#34; flowable:elementVariable=\u0026#34;person\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt;\u0026lt;/extensionElements\u0026gt; \u0026lt;loopCardinality\u0026gt;3\u0026lt;/loopCardinality\u0026gt; \u0026lt;completionCondition\u0026gt;${nrOfCompletedInstances \u0026gt; 1 }\u0026lt;/completionCondition\u0026gt; \u0026lt;/multiInstanceLoopCharacteristics\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-B5F81E26-E53B-4D10-8328-C5B3C35E0DD5\u0026#34; sourceRef=\u0026#34;startEvent1\u0026#34; targetRef=\u0026#34;sid-477F728E-2F63-43BF-A278-76FBCF58B475\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;endEvent id=\u0026#34;sid-3448D902-AE89-467D-8945-805BDEDE7BCA\u0026#34;\u0026gt;\u0026lt;/endEvent\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-598B2F86-A13B-48BE-88AF-6B61CDA24EA7\u0026#34; sourceRef=\u0026#34;sid-477F728E-2F63-43BF-A278-76FBCF58B475\u0026#34; targetRef=\u0026#34;sid-3448D902-AE89-467D-8945-805BDEDE7BCA\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;/process\u0026gt; \u0026lt;bpmndi:BPMNDiagram id=\u0026#34;BPMNDiagram_join-key\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNPlane bpmnElement=\u0026#34;join-key\u0026#34; id=\u0026#34;BPMNPlane_join-key\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;startEvent1\u0026#34; id=\u0026#34;BPMNShape_startEvent1\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;30.0\u0026#34; width=\u0026#34;30.0\u0026#34; x=\u0026#34;105.0\u0026#34; y=\u0026#34;100.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-477F728E-2F63-43BF-A278-76FBCF58B475\u0026#34; id=\u0026#34;BPMNShape_sid-477F728E-2F63-43BF-A278-76FBCF58B475\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;330.0\u0026#34; y=\u0026#34;60.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-3448D902-AE89-467D-8945-805BDEDE7BCA\u0026#34; id=\u0026#34;BPMNShape_sid-3448D902-AE89-467D-8945-805BDEDE7BCA\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;28.0\u0026#34; width=\u0026#34;28.0\u0026#34; x=\u0026#34;600.0\u0026#34; y=\u0026#34;106.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-B5F81E26-E53B-4D10-8328-C5B3C35E0DD5\u0026#34; id=\u0026#34;BPMNEdge_sid-B5F81E26-E53B-4D10-8328-C5B3C35E0DD5\u0026#34; flowable:sourceDockerX=\u0026#34;15.0\u0026#34; flowable:sourceDockerY=\u0026#34;15.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;134.94999855629513\u0026#34; y=\u0026#34;115.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;232.5\u0026#34; y=\u0026#34;115.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;232.5\u0026#34; y=\u0026#34;100.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;330.0\u0026#34; y=\u0026#34;100.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-598B2F86-A13B-48BE-88AF-6B61CDA24EA7\u0026#34; id=\u0026#34;BPMNEdge_sid-598B2F86-A13B-48BE-88AF-6B61CDA24EA7\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;14.0\u0026#34; flowable:targetDockerY=\u0026#34;14.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;429.95000000000005\u0026#34; y=\u0026#34;100.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;515.0\u0026#34; y=\u0026#34;100.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;515.0\u0026#34; y=\u0026#34;120.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;600.0\u0026#34; y=\u0026#34;120.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;/bpmndi:BPMNPlane\u0026gt; \u0026lt;/bpmndi:BPMNDiagram\u0026gt; \u0026lt;/definitions\u0026gt; å°†æµç¨‹éƒ¨ç½²\n@Test public void deploy() { deleteAll(); ProcessEngine engine = ProcessEngines.getDefaultProcessEngine(); RepositoryService repositoryService = engine.getRepositoryService(); Deployment deploy = repositoryService.createDeployment() .addClasspathResource(\u0026#34;ä¼šç­¾æµ‹è¯•1.bpmn20.xml\u0026#34;) .deploy(); System.out.println(\u0026#34;éƒ¨ç½²æˆåŠŸ:\u0026#34; + deploy.getId()); } è¿è¡Œæµç¨‹\n@Test public void run(){ ProcessEngine defaultProcessEngine = ProcessEngines.getDefaultProcessEngine(); RuntimeService runtimeService = defaultProcessEngine.getRuntimeService(); HashMap\u0026lt;String,Object\u0026gt; map=new HashMap\u0026lt;\u0026gt;(); ArrayList\u0026lt;String\u0026gt; persons=new ArrayList\u0026lt;\u0026gt;(); persons.add(\u0026#34;å¼ ä¸‰\u0026#34;); persons.add(\u0026#34;æå››\u0026#34;); persons.add(\u0026#34;ç‹äº”\u0026#34;); map.put(\u0026#34;persons\u0026#34;,persons); ProcessInstance processInstance = runtimeService.startProcessInstanceById(\u0026#34;join-key:1:17504\u0026#34;,map); } æ­¤æ—¶æ•°æ®åº“ä¼šæœ‰ä¸‰ä¸ªä»»åŠ¡ å®Œæˆç¬¬ä¸€ä¸ªä»»åŠ¡\n@Test public void completeTask(){ //15020 ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = engine.getTaskService(); taskService.complete(\u0026#34;20020\u0026#34;); } å†å®Œæˆä¸€ä¸ªä»»åŠ¡åï¼Œæµç¨‹ä¼šç›´æ¥ç»“æŸ\n@Test public void completeTask(){ //15020 ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = engine.getTaskService(); taskService.complete(\u0026#34;20028\u0026#34;); } æµç¨‹ç»“æŸ\n"},{"id":195,"href":"/zh/docs/study/Flowable/boge_blbl/02-advance_6/","title":"boge-02-flowableè¿›é˜¶_6","section":"åŸºç¡€(æ³¢å“¥)_","content":" ä»»åŠ¡å›é€€-ä¸²è¡Œå›é€€ # æµç¨‹å›¾ç»˜åˆ¶ xml\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;definitions xmlns=\u0026#34;http://www.omg.org/spec/BPMN/20100524/MODEL\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:xsd=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; xmlns:flowable=\u0026#34;http://flowable.org/bpmn\u0026#34; xmlns:bpmndi=\u0026#34;http://www.omg.org/spec/BPMN/20100524/DI\u0026#34; xmlns:omgdc=\u0026#34;http://www.omg.org/spec/DD/20100524/DC\u0026#34; xmlns:omgdi=\u0026#34;http://www.omg.org/spec/DD/20100524/DI\u0026#34; typeLanguage=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; expressionLanguage=\u0026#34;http://www.w3.org/1999/XPath\u0026#34; targetNamespace=\u0026#34;http://www.flowable.org/processdef\u0026#34; exporter=\u0026#34;Flowable Open Source Modeler\u0026#34; exporterVersion=\u0026#34;6.7.2\u0026#34;\u0026gt; \u0026lt;process id=\u0026#34;reback-key\u0026#34; name=\u0026#34;å›é€€å¤„ç†\u0026#34; isExecutable=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;documentation\u0026gt;reback-desc\u0026lt;/documentation\u0026gt; \u0026lt;startEvent id=\u0026#34;startEvent1\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt;\u0026lt;/startEvent\u0026gt; \u0026lt;userTask id=\u0026#34;sid-D380E41A-48EE-4C08-AD01-1D509C512543\u0026#34; name=\u0026#34;ç”¨æˆ·1\u0026#34; flowable:assignee=\u0026#34;user1\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-E2423FC5-F954-43D3-B57C-8460057CB7D6\u0026#34; sourceRef=\u0026#34;startEvent1\u0026#34; targetRef=\u0026#34;sid-D380E41A-48EE-4C08-AD01-1D509C512543\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;userTask id=\u0026#34;sid-AF50E3D0-2014-4308-A717-D76586837D70\u0026#34; name=\u0026#34;ç”¨æˆ·2\u0026#34; flowable:assignee=\u0026#34;user2\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-7C8750DC-E1C1-4AB2-B18C-2C103B61A5E5\u0026#34; sourceRef=\u0026#34;sid-D380E41A-48EE-4C08-AD01-1D509C512543\u0026#34; targetRef=\u0026#34;sid-AF50E3D0-2014-4308-A717-D76586837D70\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;userTask id=\u0026#34;sid-F4CE7565-5977-4B9C-A603-AB3B817B8C8C\u0026#34; name=\u0026#34;ç”¨æˆ·3\u0026#34; flowable:assignee=\u0026#34;user3\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-F91582FE-D110-48C9-9407-605E503E42B2\u0026#34; sourceRef=\u0026#34;sid-AF50E3D0-2014-4308-A717-D76586837D70\u0026#34; targetRef=\u0026#34;sid-F4CE7565-5977-4B9C-A603-AB3B817B8C8C\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;userTask id=\u0026#34;sid-727C1235-F9C1-4CC5-BC6C-E56ABCA105B0\u0026#34; name=\u0026#34;ç”¨æˆ·4\u0026#34; flowable:assignee=\u0026#34;user4\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-6D998C20-2A97-44B5-92D0-118E5CB05795\u0026#34; sourceRef=\u0026#34;sid-F4CE7565-5977-4B9C-A603-AB3B817B8C8C\u0026#34; targetRef=\u0026#34;sid-727C1235-F9C1-4CC5-BC6C-E56ABCA105B0\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;endEvent id=\u0026#34;sid-6E5F5037-1979-4150-8408-D0BFD0315BCA\u0026#34;\u0026gt;\u0026lt;/endEvent\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-3ECF3E34-6C07-4AE6-997B-583BF8868AC8\u0026#34; sourceRef=\u0026#34;sid-727C1235-F9C1-4CC5-BC6C-E56ABCA105B0\u0026#34; targetRef=\u0026#34;sid-6E5F5037-1979-4150-8408-D0BFD0315BCA\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;/process\u0026gt; \u0026lt;bpmndi:BPMNDiagram id=\u0026#34;BPMNDiagram_reback-key\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNPlane bpmnElement=\u0026#34;reback-key\u0026#34; id=\u0026#34;BPMNPlane_reback-key\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;startEvent1\u0026#34; id=\u0026#34;BPMNShape_startEvent1\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;30.0\u0026#34; width=\u0026#34;30.0\u0026#34; x=\u0026#34;100.0\u0026#34; y=\u0026#34;163.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-D380E41A-48EE-4C08-AD01-1D509C512543\u0026#34; id=\u0026#34;BPMNShape_sid-D380E41A-48EE-4C08-AD01-1D509C512543\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;165.0\u0026#34; y=\u0026#34;135.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-AF50E3D0-2014-4308-A717-D76586837D70\u0026#34; id=\u0026#34;BPMNShape_sid-AF50E3D0-2014-4308-A717-D76586837D70\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;320.0\u0026#34; y=\u0026#34;138.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-F4CE7565-5977-4B9C-A603-AB3B817B8C8C\u0026#34; id=\u0026#34;BPMNShape_sid-F4CE7565-5977-4B9C-A603-AB3B817B8C8C\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;465.0\u0026#34; y=\u0026#34;138.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-727C1235-F9C1-4CC5-BC6C-E56ABCA105B0\u0026#34; id=\u0026#34;BPMNShape_sid-727C1235-F9C1-4CC5-BC6C-E56ABCA105B0\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;610.0\u0026#34; y=\u0026#34;138.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-6E5F5037-1979-4150-8408-D0BFD0315BCA\u0026#34; id=\u0026#34;BPMNShape_sid-6E5F5037-1979-4150-8408-D0BFD0315BCA\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;28.0\u0026#34; width=\u0026#34;28.0\u0026#34; x=\u0026#34;755.0\u0026#34; y=\u0026#34;164.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-6D998C20-2A97-44B5-92D0-118E5CB05795\u0026#34; id=\u0026#34;BPMNEdge_sid-6D998C20-2A97-44B5-92D0-118E5CB05795\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;564.9499999999907\u0026#34; y=\u0026#34;178.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;609.9999999999807\u0026#34; y=\u0026#34;178.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-7C8750DC-E1C1-4AB2-B18C-2C103B61A5E5\u0026#34; id=\u0026#34;BPMNEdge_sid-7C8750DC-E1C1-4AB2-B18C-2C103B61A5E5\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;264.9499999999882\u0026#34; y=\u0026#34;175.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;292.5\u0026#34; y=\u0026#34;175.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;292.5\u0026#34; y=\u0026#34;178.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;319.9999999999603\u0026#34; y=\u0026#34;178.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-3ECF3E34-6C07-4AE6-997B-583BF8868AC8\u0026#34; id=\u0026#34;BPMNEdge_sid-3ECF3E34-6C07-4AE6-997B-583BF8868AC8\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;14.0\u0026#34; flowable:targetDockerY=\u0026#34;14.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;709.9499999999999\u0026#34; y=\u0026#34;178.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;755.0\u0026#34; y=\u0026#34;178.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-E2423FC5-F954-43D3-B57C-8460057CB7D6\u0026#34; id=\u0026#34;BPMNEdge_sid-E2423FC5-F954-43D3-B57C-8460057CB7D6\u0026#34; flowable:sourceDockerX=\u0026#34;15.0\u0026#34; flowable:sourceDockerY=\u0026#34;15.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;129.94340692927761\u0026#34; y=\u0026#34;177.55019845363262\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;164.99999999999906\u0026#34; y=\u0026#34;176.4985\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-F91582FE-D110-48C9-9407-605E503E42B2\u0026#34; id=\u0026#34;BPMNEdge_sid-F91582FE-D110-48C9-9407-605E503E42B2\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;419.94999999999067\u0026#34; y=\u0026#34;178.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;464.9999999999807\u0026#34; y=\u0026#34;178.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;/bpmndi:BPMNPlane\u0026gt; \u0026lt;/bpmndi:BPMNDiagram\u0026gt; \u0026lt;/definitions\u0026gt; éƒ¨ç½²å¹¶è¿è¡Œ\nä¾æ¬¡å®Œæˆ1ï¼Œ2ï¼Œ3\nä»ä»»æ„èŠ‚ç‚¹è·³è½¬åˆ°ä»»æ„èŠ‚ç‚¹\n@Test public void backProcess(){ ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); RuntimeService runtimeService = engine.getRuntimeService(); //ä»å½“å‰æµç¨‹è·³è½¬åˆ°ä»»æ„èŠ‚ç‚¹ runtimeService.createChangeActivityStateBuilder() .processInstanceId(\u0026#34;2501\u0026#34;) //4--\u0026gt;3 ï¼Œæ´»åŠ¨id .moveActivityIdTo(\u0026#34;sid-727C1235-F9C1-4CC5-BC6C-E56ABCA105B0\u0026#34;, \u0026#34;sid-F4CE7565-5977-4B9C-A603-AB3B817B8C8C\u0026#34;) .changeState(); } å¯ä»¥åœ¨è¿™ä¸ªè¡¨é‡Œè®©ç”¨æˆ·é€‰æ‹©å›é€€èŠ‚ç‚¹ æ­¤æ—¶è®©user3å†å®Œæˆä»»åŠ¡\næ³¨ï¼šç”¨ä¸‹é¢çš„æ–¹æ³•ï¼Œä¸å…³å¿ƒå½“å‰èŠ‚ç‚¹ï¼Œåªå†™æ˜è¦è·³è½¬çš„ç»“ç‚¹å³å¯ è‡ªå®šä¹‰è¡¨å• # å†…ç½®è¡¨å• # ç»˜åˆ¶ xml\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;definitions xmlns=\u0026#34;http://www.omg.org/spec/BPMN/20100524/MODEL\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:xsd=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; xmlns:flowable=\u0026#34;http://flowable.org/bpmn\u0026#34; xmlns:bpmndi=\u0026#34;http://www.omg.org/spec/BPMN/20100524/DI\u0026#34; xmlns:omgdc=\u0026#34;http://www.omg.org/spec/DD/20100524/DC\u0026#34; xmlns:omgdi=\u0026#34;http://www.omg.org/spec/DD/20100524/DI\u0026#34; typeLanguage=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; expressionLanguage=\u0026#34;http://www.w3.org/1999/XPath\u0026#34; targetNamespace=\u0026#34;http://www.flowable.org/processdef\u0026#34; exporter=\u0026#34;Flowable Open Source Modeler\u0026#34; exporterVersion=\u0026#34;6.7.2\u0026#34;\u0026gt; \u0026lt;process id=\u0026#34;form1-test-key\u0026#34; name=\u0026#34;form1-test-name\u0026#34; isExecutable=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;documentation\u0026gt;form1-test-desc\u0026lt;/documentation\u0026gt; \u0026lt;startEvent id=\u0026#34;startEvent1\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;flowable:formProperty id=\u0026#34;days\u0026#34; name=\u0026#34;å¤©æ•°\u0026#34; type=\u0026#34;long\u0026#34; default=\u0026#34;5\u0026#34;\u0026gt;\u0026lt;/flowable:formProperty\u0026gt; \u0026lt;flowable:formProperty id=\u0026#34;start_time\u0026#34; name=\u0026#34;å¼€å§‹æ—¶é—´\u0026#34; type=\u0026#34;date\u0026#34; datePattern=\u0026#34;MM-dd-yyyy\u0026#34;\u0026gt;\u0026lt;/flowable:formProperty\u0026gt; \u0026lt;flowable:formProperty id=\u0026#34;reason\u0026#34; name=\u0026#34;åŸå› \u0026#34; type=\u0026#34;string\u0026#34;\u0026gt;\u0026lt;/flowable:formProperty\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/startEvent\u0026gt; \u0026lt;userTask id=\u0026#34;sid-4C9C8571-1423-4137-93FC-6A138D504E24\u0026#34; name=\u0026#34;ç”¨æˆ·ç”³è¯·\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;flowable:formProperty id=\u0026#34;days\u0026#34; name=\u0026#34;å¤©æ•°\u0026#34; type=\u0026#34;long\u0026#34;\u0026gt;\u0026lt;/flowable:formProperty\u0026gt; \u0026lt;flowable:formProperty id=\u0026#34;start_time\u0026#34; name=\u0026#34;å¼€å§‹æ—¶é—´\u0026#34; type=\u0026#34;date\u0026#34; datePattern=\u0026#34;MM-dd-yyyy\u0026#34;\u0026gt;\u0026lt;/flowable:formProperty\u0026gt; \u0026lt;flowable:formProperty id=\u0026#34;reason\u0026#34; name=\u0026#34;åŸå› \u0026#34; type=\u0026#34;string\u0026#34;\u0026gt;\u0026lt;/flowable:formProperty\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-8944FE04-D27B-435F-A8A8-4E545AB3D6C0\u0026#34; sourceRef=\u0026#34;startEvent1\u0026#34; targetRef=\u0026#34;sid-4C9C8571-1423-4137-93FC-6A138D504E24\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;exclusiveGateway id=\u0026#34;sid-35DD948A-C095-486E-98E0-4A0EEC4D9FBC\u0026#34;\u0026gt;\u0026lt;/exclusiveGateway\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-0EA36B83-6115-414F-BC7D-9CB338B03F22\u0026#34; sourceRef=\u0026#34;sid-4C9C8571-1423-4137-93FC-6A138D504E24\u0026#34; targetRef=\u0026#34;sid-35DD948A-C095-486E-98E0-4A0EEC4D9FBC\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;userTask id=\u0026#34;sid-4B6496FE-B5FE-41AC-83F8-4B7224B09FBD\u0026#34; name=\u0026#34;æ€»ç›‘å®¡æ‰¹\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt;\u0026lt;/userTask\u0026gt; \u0026lt;userTask id=\u0026#34;sid-8DE5EA05-89D5-48B0-9359-F8ABFB3A3500\u0026#34; name=\u0026#34;éƒ¨é—¨ç»ç†å®¡æ‰¹\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt;\u0026lt;/userTask\u0026gt; \u0026lt;exclusiveGateway id=\u0026#34;sid-0EC09183-F41B-4785-83E7-423BB86EB013\u0026#34;\u0026gt;\u0026lt;/exclusiveGateway\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-562C26B5-B634-4771-BF54-C311D56A5317\u0026#34; sourceRef=\u0026#34;sid-4B6496FE-B5FE-41AC-83F8-4B7224B09FBD\u0026#34; targetRef=\u0026#34;sid-0EC09183-F41B-4785-83E7-423BB86EB013\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-9AC3E009-D4D6-4D8B-883C-701E044715E9\u0026#34; sourceRef=\u0026#34;sid-8DE5EA05-89D5-48B0-9359-F8ABFB3A3500\u0026#34; targetRef=\u0026#34;sid-0EC09183-F41B-4785-83E7-423BB86EB013\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;endEvent id=\u0026#34;sid-9CD52D35-7874-42F4-B392-466F71316BFE\u0026#34;\u0026gt;\u0026lt;/endEvent\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-FABB64D1-0182-41D8-90FE-53FE7FE3F024\u0026#34; sourceRef=\u0026#34;sid-0EC09183-F41B-4785-83E7-423BB86EB013\u0026#34; targetRef=\u0026#34;sid-9CD52D35-7874-42F4-B392-466F71316BFE\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-E4DB6764-3EA3-427B-AD00-4D812E404FD6\u0026#34; sourceRef=\u0026#34;sid-35DD948A-C095-486E-98E0-4A0EEC4D9FBC\u0026#34; targetRef=\u0026#34;sid-4B6496FE-B5FE-41AC-83F8-4B7224B09FBD\u0026#34;\u0026gt; \u0026lt;conditionExpression xsi:type=\u0026#34;tFormalExpression\u0026#34;\u0026gt;\u0026lt;![CDATA[${day \u0026gt; 3}]]\u0026gt;\u0026lt;/conditionExpression\u0026gt; \u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-585C37CB-61FE-4518-B3B6-5722A90A854F\u0026#34; sourceRef=\u0026#34;sid-35DD948A-C095-486E-98E0-4A0EEC4D9FBC\u0026#34; targetRef=\u0026#34;sid-8DE5EA05-89D5-48B0-9359-F8ABFB3A3500\u0026#34;\u0026gt; \u0026lt;conditionExpression xsi:type=\u0026#34;tFormalExpression\u0026#34;\u0026gt;\u0026lt;![CDATA[${day \u0026lt;= 3}]]\u0026gt;\u0026lt;/conditionExpression\u0026gt; \u0026lt;/sequenceFlow\u0026gt; \u0026lt;/process\u0026gt; \u0026lt;bpmndi:BPMNDiagram id=\u0026#34;BPMNDiagram_form1-test-key\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNPlane bpmnElement=\u0026#34;form1-test-key\u0026#34; id=\u0026#34;BPMNPlane_form1-test-key\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;startEvent1\u0026#34; id=\u0026#34;BPMNShape_startEvent1\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;30.0\u0026#34; width=\u0026#34;30.0\u0026#34; x=\u0026#34;100.0\u0026#34; y=\u0026#34;163.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-4C9C8571-1423-4137-93FC-6A138D504E24\u0026#34; id=\u0026#34;BPMNShape_sid-4C9C8571-1423-4137-93FC-6A138D504E24\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;175.0\u0026#34; y=\u0026#34;138.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-35DD948A-C095-486E-98E0-4A0EEC4D9FBC\u0026#34; id=\u0026#34;BPMNShape_sid-35DD948A-C095-486E-98E0-4A0EEC4D9FBC\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;40.0\u0026#34; width=\u0026#34;40.0\u0026#34; x=\u0026#34;315.0\u0026#34; y=\u0026#34;150.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-4B6496FE-B5FE-41AC-83F8-4B7224B09FBD\u0026#34; id=\u0026#34;BPMNShape_sid-4B6496FE-B5FE-41AC-83F8-4B7224B09FBD\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;405.0\u0026#34; y=\u0026#34;30.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-8DE5EA05-89D5-48B0-9359-F8ABFB3A3500\u0026#34; id=\u0026#34;BPMNShape_sid-8DE5EA05-89D5-48B0-9359-F8ABFB3A3500\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;405.0\u0026#34; y=\u0026#34;225.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-0EC09183-F41B-4785-83E7-423BB86EB013\u0026#34; id=\u0026#34;BPMNShape_sid-0EC09183-F41B-4785-83E7-423BB86EB013\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;40.0\u0026#34; width=\u0026#34;40.0\u0026#34; x=\u0026#34;585.0\u0026#34; y=\u0026#34;165.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-9CD52D35-7874-42F4-B392-466F71316BFE\u0026#34; id=\u0026#34;BPMNShape_sid-9CD52D35-7874-42F4-B392-466F71316BFE\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;28.0\u0026#34; width=\u0026#34;28.0\u0026#34; x=\u0026#34;670.0\u0026#34; y=\u0026#34;171.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-585C37CB-61FE-4518-B3B6-5722A90A854F\u0026#34; id=\u0026#34;BPMNEdge_sid-585C37CB-61FE-4518-B3B6-5722A90A854F\u0026#34; flowable:sourceDockerX=\u0026#34;20.5\u0026#34; flowable:sourceDockerY=\u0026#34;20.5\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;335.5\u0026#34; y=\u0026#34;189.43998414376327\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;335.5\u0026#34; y=\u0026#34;265.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;405.0\u0026#34; y=\u0026#34;265.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-E4DB6764-3EA3-427B-AD00-4D812E404FD6\u0026#34; id=\u0026#34;BPMNEdge_sid-E4DB6764-3EA3-427B-AD00-4D812E404FD6\u0026#34; flowable:sourceDockerX=\u0026#34;20.5\u0026#34; flowable:sourceDockerY=\u0026#34;20.5\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;336.66824324324324\u0026#34; y=\u0026#34;151.67117117117118\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;342.0\u0026#34; y=\u0026#34;66.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;404.9999999999999\u0026#34; y=\u0026#34;68.23008849557522\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-0EA36B83-6115-414F-BC7D-9CB338B03F22\u0026#34; id=\u0026#34;BPMNEdge_sid-0EA36B83-6115-414F-BC7D-9CB338B03F22\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;20.5\u0026#34; flowable:targetDockerY=\u0026#34;20.5\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;274.95000000000005\u0026#34; y=\u0026#34;174.60633484162895\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;316.77118644067775\u0026#34; y=\u0026#34;171.76800847457628\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-8944FE04-D27B-435F-A8A8-4E545AB3D6C0\u0026#34; id=\u0026#34;BPMNEdge_sid-8944FE04-D27B-435F-A8A8-4E545AB3D6C0\u0026#34; flowable:sourceDockerX=\u0026#34;15.0\u0026#34; flowable:sourceDockerY=\u0026#34;15.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;129.9499984899576\u0026#34; y=\u0026#34;178.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;174.9999999999917\u0026#34; y=\u0026#34;178.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-FABB64D1-0182-41D8-90FE-53FE7FE3F024\u0026#34; id=\u0026#34;BPMNEdge_sid-FABB64D1-0182-41D8-90FE-53FE7FE3F024\u0026#34; flowable:sourceDockerX=\u0026#34;20.5\u0026#34; flowable:sourceDockerY=\u0026#34;20.5\u0026#34; flowable:targetDockerX=\u0026#34;14.0\u0026#34; flowable:targetDockerY=\u0026#34;14.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;624.5591869398207\u0026#34; y=\u0026#34;185.37820512820514\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;670.0002755524882\u0026#34; y=\u0026#34;185.08885188426405\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-9AC3E009-D4D6-4D8B-883C-701E044715E9\u0026#34; id=\u0026#34;BPMNEdge_sid-9AC3E009-D4D6-4D8B-883C-701E044715E9\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;20.0\u0026#34; flowable:targetDockerY=\u0026#34;20.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;504.95000000000005\u0026#34; y=\u0026#34;238.33333333333334\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;591.9565217391304\u0026#34; y=\u0026#34;191.93913043478258\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-562C26B5-B634-4771-BF54-C311D56A5317\u0026#34; id=\u0026#34;BPMNEdge_sid-562C26B5-B634-4771-BF54-C311D56A5317\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;20.5\u0026#34; flowable:targetDockerY=\u0026#34;20.5\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;504.95000000000005\u0026#34; y=\u0026#34;70.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;605.5\u0026#34; y=\u0026#34;70.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;605.5\u0026#34; y=\u0026#34;165.5\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;/bpmndi:BPMNPlane\u0026gt; \u0026lt;/bpmndi:BPMNDiagram\u0026gt; \u0026lt;/definitions\u0026gt; å°†æµç¨‹å®šä¹‰éƒ¨ç½²\n@Test public void deploy() { ProcessEngine engine = ProcessEngines.getDefaultProcessEngine(); RepositoryService repositoryService = engine.getRepositoryService(); Deployment deploy = repositoryService.createDeployment() .addClasspathResource(\u0026#34;form1-test-name.bpmn20.xml\u0026#34;) .deploy(); System.out.println(\u0026#34;éƒ¨ç½²æˆåŠŸ:\u0026#34; + deploy.getId()); } æŸ¥çœ‹éƒ¨ç½²çš„æµç¨‹å†…ç½®çš„è¡¨å•\n@Test public void getStartForm(){ ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); FormService formService = engine.getFormService(); StartFormData startFormData = formService.getStartFormData(\u0026#34;form1-test-key:1:17504\u0026#34;); List\u0026lt;FormProperty\u0026gt; formProperties = startFormData.getFormProperties(); for (FormProperty property:formProperties){ System.out.println(\u0026#34;id==\u0026gt;\u0026#34;+property.getId()); System.out.println(\u0026#34;name==\u0026gt;\u0026#34;+property.getName()); System.out.println(\u0026#34;value==\u0026gt;\u0026#34;+property.getValue()); } } ç¬¬ä¸€ç§å¯åŠ¨æ–¹å¼ï¼Œé€šè¿‡map ç¬¬äºŒç§å¯åŠ¨æ–¹å¼\n@Test public void startProcess2(){ ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); FormService formService = engine.getFormService(); Map\u0026lt;String,String\u0026gt; map=new HashMap\u0026lt;\u0026gt;(); map.put(\u0026#34;days\u0026#34;,\u0026#34;2\u0026#34;); map.put(\u0026#34;startTime\u0026#34;,\u0026#34;22020405\u0026#34;); map.put(\u0026#34;reason\u0026#34;,\u0026#34;æƒ³ç©\u0026#34;); formService.submitStartFormData(\u0026#34;form1-test-key:1:17504\u0026#34;,map); } æ³¨æ„æŸ¥çœ‹act_ru_variableå˜é‡è¡¨ æŸ¥çœ‹ä»»åŠ¡ä¸­çš„è¡¨å•æ•°æ®\n/** * æŸ¥çœ‹å¯¹åº”çš„è¡¨å•æ•°æ® */ @Test public void getTaskFormData(){ ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); FormService formService = engine.getFormService(); TaskFormData taskFormData = formService.getTaskFormData(\u0026#34;20012\u0026#34;); List\u0026lt;FormProperty\u0026gt; formProperties = taskFormData.getFormProperties(); for (FormProperty property:formProperties){ System.out.println(\u0026#34;id==\u0026gt;\u0026#34;+property.getId()); System.out.println(\u0026#34;name==\u0026gt;\u0026#34;+property.getName()); System.out.println(\u0026#34;value==\u0026gt;\u0026#34;+property.getValue()); } //è¿™é‡Œåšä¸€ä¸ªæµ‹è¯•ï¼Œè®¾ç½®å¤„ç†äºº /*TaskService taskService = engine.getTaskService(); taskService.setAssignee(\u0026#34;20012\u0026#34;,\u0026#34;lalala\u0026#34;);*/ } æŸ¥çœ‹å®Œæˆçš„ä»»åŠ¡ã€ä¸»è¦ã€‘//æœ‰ç‚¹é—®é¢˜ï¼Œä¸ç®¡ å¤–ç½®è¡¨å• # [flowable-uiä¸­æ²¡æ‰¾åˆ°ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯eclipseç‹¬æœ‰çš„]\n"},{"id":196,"href":"/zh/docs/study/Flowable/boge_blbl/02-advance_5/","title":"boge-02-flowableè¿›é˜¶_5","section":"åŸºç¡€(æ³¢å“¥)_","content":" ç½‘å…³ # æ’ä»–ç½‘å…³ # ä¼šæŒ‰ç…§æ‰€æœ‰å‡ºå£é¡ºåºæµå®šä¹‰çš„é¡ºåºå¯¹å®ƒä»¬è¿›è¡Œè®¡ç®—ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªæ¡ä»¶è®¡ç®—ä¸ºtrueçš„é¡ºåºæµï¼ˆå½“æ²¡æœ‰è®¾ç½®æ¡ä»¶æ—¶ï¼Œè®¤ä¸ºé¡ºåºæµä¸ºtrueï¼‰ç»§ç»­æµç¨‹\næ’ä»–ç½‘å…³çš„ç»˜åˆ¶ xmlæ–‡ä»¶\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;definitions xmlns=\u0026#34;http://www.omg.org/spec/BPMN/20100524/MODEL\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:xsd=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; xmlns:flowable=\u0026#34;http://flowable.org/bpmn\u0026#34; xmlns:bpmndi=\u0026#34;http://www.omg.org/spec/BPMN/20100524/DI\u0026#34; xmlns:omgdc=\u0026#34;http://www.omg.org/spec/DD/20100524/DC\u0026#34; xmlns:omgdi=\u0026#34;http://www.omg.org/spec/DD/20100524/DI\u0026#34; typeLanguage=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; expressionLanguage=\u0026#34;http://www.w3.org/1999/XPath\u0026#34; targetNamespace=\u0026#34;http://www.flowable.org/processdef\u0026#34; exporter=\u0026#34;Flowable Open Source Modeler\u0026#34; exporterVersion=\u0026#34;6.7.2\u0026#34;\u0026gt; \u0026lt;process id=\u0026#34;holiday-exclusive\u0026#34; name=\u0026#34;è¯·å‡æµç¨‹-æ’ä»–ç½‘å…³\u0026#34; isExecutable=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;startEvent id=\u0026#34;startEvent1\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt;\u0026lt;/startEvent\u0026gt; \u0026lt;userTask id=\u0026#34;sid-3D5ED4D4-97F5-4FFD-B160-F00566ECC55E\u0026#34; name=\u0026#34;åˆ›å»ºè¯·å‡å•\u0026#34; flowable:assignee=\u0026#34;zhangsan\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-33A73370-751D-413F-9306-39DEAA674DB6\u0026#34; sourceRef=\u0026#34;startEvent1\u0026#34; targetRef=\u0026#34;sid-3D5ED4D4-97F5-4FFD-B160-F00566ECC55E\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;exclusiveGateway id=\u0026#34;sid-5B2117E6-D341-49F2-85B2-336CA836C7D8\u0026#34;\u0026gt;\u0026lt;/exclusiveGateway\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-D1B1F6E0-EA7F-4FF7-AD0C-5D43DBCEBFD2\u0026#34; sourceRef=\u0026#34;sid-3D5ED4D4-97F5-4FFD-B160-F00566ECC55E\u0026#34; targetRef=\u0026#34;sid-5B2117E6-D341-49F2-85B2-336CA836C7D8\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;userTask id=\u0026#34;sid-08A6CB64-C9BB-4342-852D-444A75315BDE\u0026#34; name=\u0026#34;æ€»ç»ç†å®¡æ‰¹\u0026#34; flowable:assignee=\u0026#34;wangwu\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;userTask id=\u0026#34;sid-EA98D0C3-E41D-4DEB-8933-91A1B7301ABE\u0026#34; name=\u0026#34;éƒ¨é—¨ç»ç†å®¡æ‰¹\u0026#34; flowable:assignee=\u0026#34;lisi\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;userTask id=\u0026#34;sid-24F73F7F-EB61-484F-A494-686E194D0118\u0026#34; name=\u0026#34;äººäº‹å®¡æ‰¹\u0026#34; flowable:assignee=\u0026#34;zhaoliu\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-8BA0B88C-BA4F-446D-B5E7-6BF0830B1DC8\u0026#34; sourceRef=\u0026#34;sid-EA98D0C3-E41D-4DEB-8933-91A1B7301ABE\u0026#34; targetRef=\u0026#34;sid-24F73F7F-EB61-484F-A494-686E194D0118\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-E748F81F-B0B2-4C34-B993-FBAA2BCD0995\u0026#34; sourceRef=\u0026#34;sid-08A6CB64-C9BB-4342-852D-444A75315BDE\u0026#34; targetRef=\u0026#34;sid-24F73F7F-EB61-484F-A494-686E194D0118\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-928C6C6F-57F1-40F2-BE0F-1A9FF3E6E9E4\u0026#34; sourceRef=\u0026#34;sid-5B2117E6-D341-49F2-85B2-336CA836C7D8\u0026#34; targetRef=\u0026#34;sid-08A6CB64-C9BB-4342-852D-444A75315BDE\u0026#34;\u0026gt; \u0026lt;conditionExpression xsi:type=\u0026#34;tFormalExpression\u0026#34;\u0026gt;\u0026lt;![CDATA[${num\u0026gt;3}]]\u0026gt;\u0026lt;/conditionExpression\u0026gt; \u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-4DB25720-11C8-401E-BB4C-83BB25510B2E\u0026#34; sourceRef=\u0026#34;sid-5B2117E6-D341-49F2-85B2-336CA836C7D8\u0026#34; targetRef=\u0026#34;sid-EA98D0C3-E41D-4DEB-8933-91A1B7301ABE\u0026#34;\u0026gt; \u0026lt;conditionExpression xsi:type=\u0026#34;tFormalExpression\u0026#34;\u0026gt;\u0026lt;![CDATA[${num\u0026lt;3}]]\u0026gt;\u0026lt;/conditionExpression\u0026gt; \u0026lt;/sequenceFlow\u0026gt; \u0026lt;/process\u0026gt; \u0026lt;bpmndi:BPMNDiagram id=\u0026#34;BPMNDiagram_holiday-exclusive\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNPlane bpmnElement=\u0026#34;holiday-exclusive\u0026#34; id=\u0026#34;BPMNPlane_holiday-exclusive\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;startEvent1\u0026#34; id=\u0026#34;BPMNShape_startEvent1\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;30.0\u0026#34; width=\u0026#34;30.0\u0026#34; x=\u0026#34;30.0\u0026#34; y=\u0026#34;163.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-3D5ED4D4-97F5-4FFD-B160-F00566ECC55E\u0026#34; id=\u0026#34;BPMNShape_sid-3D5ED4D4-97F5-4FFD-B160-F00566ECC55E\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;150.0\u0026#34; y=\u0026#34;135.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-5B2117E6-D341-49F2-85B2-336CA836C7D8\u0026#34; id=\u0026#34;BPMNShape_sid-5B2117E6-D341-49F2-85B2-336CA836C7D8\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;40.0\u0026#34; width=\u0026#34;40.0\u0026#34; x=\u0026#34;315.0\u0026#34; y=\u0026#34;155.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-08A6CB64-C9BB-4342-852D-444A75315BDE\u0026#34; id=\u0026#34;BPMNShape_sid-08A6CB64-C9BB-4342-852D-444A75315BDE\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;420.0\u0026#34; y=\u0026#34;225.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-EA98D0C3-E41D-4DEB-8933-91A1B7301ABE\u0026#34; id=\u0026#34;BPMNShape_sid-EA98D0C3-E41D-4DEB-8933-91A1B7301ABE\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;405.0\u0026#34; y=\u0026#34;30.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-24F73F7F-EB61-484F-A494-686E194D0118\u0026#34; id=\u0026#34;BPMNShape_sid-24F73F7F-EB61-484F-A494-686E194D0118\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;630.0\u0026#34; y=\u0026#34;225.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-8BA0B88C-BA4F-446D-B5E7-6BF0830B1DC8\u0026#34; id=\u0026#34;BPMNEdge_sid-8BA0B88C-BA4F-446D-B5E7-6BF0830B1DC8\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;504.95000000000005\u0026#34; y=\u0026#34;70.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;680.0\u0026#34; y=\u0026#34;70.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;680.0\u0026#34; y=\u0026#34;225.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-4DB25720-11C8-401E-BB4C-83BB25510B2E\u0026#34; id=\u0026#34;BPMNEdge_sid-4DB25720-11C8-401E-BB4C-83BB25510B2E\u0026#34; flowable:sourceDockerX=\u0026#34;20.5\u0026#34; flowable:sourceDockerY=\u0026#34;20.5\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;335.5\u0026#34; y=\u0026#34;155.5\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;335.5\u0026#34; y=\u0026#34;70.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;404.99999999996083\u0026#34; y=\u0026#34;70.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-33A73370-751D-413F-9306-39DEAA674DB6\u0026#34; id=\u0026#34;BPMNEdge_sid-33A73370-751D-413F-9306-39DEAA674DB6\u0026#34; flowable:sourceDockerX=\u0026#34;15.0\u0026#34; flowable:sourceDockerY=\u0026#34;15.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;59.94725673598754\u0026#34; y=\u0026#34;177.70973069236373\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;150.0\u0026#34; y=\u0026#34;175.96677419354836\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-D1B1F6E0-EA7F-4FF7-AD0C-5D43DBCEBFD2\u0026#34; id=\u0026#34;BPMNEdge_sid-D1B1F6E0-EA7F-4FF7-AD0C-5D43DBCEBFD2\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;20.5\u0026#34; flowable:targetDockerY=\u0026#34;20.5\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;249.95000000000002\u0026#34; y=\u0026#34;175.18431734317343\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;315.42592592592536\u0026#34; y=\u0026#34;175.42592592592592\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-E748F81F-B0B2-4C34-B993-FBAA2BCD0995\u0026#34; id=\u0026#34;BPMNEdge_sid-E748F81F-B0B2-4C34-B993-FBAA2BCD0995\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;519.95\u0026#34; y=\u0026#34;265.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;629.9999999998776\u0026#34; y=\u0026#34;265.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-928C6C6F-57F1-40F2-BE0F-1A9FF3E6E9E4\u0026#34; id=\u0026#34;BPMNEdge_sid-928C6C6F-57F1-40F2-BE0F-1A9FF3E6E9E4\u0026#34; flowable:sourceDockerX=\u0026#34;20.5\u0026#34; flowable:sourceDockerY=\u0026#34;20.5\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;335.5\u0026#34; y=\u0026#34;194.43942522321433\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;335.5\u0026#34; y=\u0026#34;265.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;420.0\u0026#34; y=\u0026#34;265.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;/bpmndi:BPMNPlane\u0026gt; \u0026lt;/bpmndi:BPMNDiagram\u0026gt; \u0026lt;/definitions\u0026gt; éƒ¨ç½²\n@Test public void deploy(){ ProcessEngine engine= ProcessEngines.getDefaultProcessEngine(); RepositoryService repositoryService = engine.getRepositoryService(); Deployment deploy = repositoryService.createDeployment() .addClasspathResource(\u0026#34;è¯·å‡æµç¨‹-æ’ä»–ç½‘å…³.bpmn20.xml\u0026#34;) .deploy(); System.out.println(\u0026#34;éƒ¨ç½²æˆåŠŸ:\u0026#34;+deploy); } è¿è¡Œ\n@Test public void run() { ProcessEngine engine = ProcessEngines.getDefaultProcessEngine(); RuntimeService runtimeService = engine.getRuntimeService(); Map\u0026lt;String, Object\u0026gt; variables = new HashMap\u0026lt;\u0026gt;(); variables.put(\u0026#34;num\u0026#34;, 2); runtimeService.startProcessInstanceById (\u0026#34;holiday-exclusive:1:4\u0026#34;, variables); } æ•°æ®åº“ å¼ ä¸‰å®Œæˆä»»åŠ¡\n@Test public void taskComplete(){ ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = engine.getTaskService(); Task task = taskService.createTaskQuery() .taskAssignee(\u0026#34;zhangsan\u0026#34;) .processInstanceId(\u0026#34;2501\u0026#34;) .singleResult(); taskService.complete(task.getId()); } //æ¥ä¸‹æ¥ä¼šèµ°åˆ°éƒ¨é—¨ç»ç†å®¡æ‰¹\næ­¤æ—¶å†ranä¸€ä¸ªnumä¸º4çš„å®ä¾‹ï¼Œç„¶åå¼ ä¸‰å®Œæˆï¼Œæ­¤æ—¶ä¼šèµ°åˆ°æ€»ç»ç†å®¡æ‰¹\næ³¨æ„ï¼Œå¦‚æœè¿™é‡Œnumè®¾ç½®ä¸º3ï¼Œåˆ™ä¼šæŠ¥é”™ ä¸¤è€…åŒºåˆ« å¦‚æœä¸Šé¢çš„åˆ†æ”¯éƒ½ä¸æ»¡è¶³æ¡ä»¶ï¼Œé‚£ä¹ˆä¼šç›´æ¥å¼‚å¸¸ç»“æŸ //å¦‚æœä½¿ç”¨æ’ä»–ç½‘å…³ï¼Œå¦‚æœæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œæµç¨‹å’Œä»»åŠ¡éƒ½è¿˜åœ¨ï¼Œåªæ˜¯ä»£ç æŠ›å¼‚å¸¸ //å¦‚æœä¸¤ä¸ªéƒ½æ»¡è¶³ï¼Œé‚£ä¹ˆä¼šæ‰¾å‡ºå…ˆå®šä¹‰çš„çº¿èµ°\nå¹¶è¡Œç½‘å…³ # ç»˜åˆ¶æµç¨‹å›¾ xmlæ–‡ä»¶\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;definitions xmlns=\u0026#34;http://www.omg.org/spec/BPMN/20100524/MODEL\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:xsd=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; xmlns:flowable=\u0026#34;http://flowable.org/bpmn\u0026#34; xmlns:bpmndi=\u0026#34;http://www.omg.org/spec/BPMN/20100524/DI\u0026#34; xmlns:omgdc=\u0026#34;http://www.omg.org/spec/DD/20100524/DC\u0026#34; xmlns:omgdi=\u0026#34;http://www.omg.org/spec/DD/20100524/DI\u0026#34; typeLanguage=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; expressionLanguage=\u0026#34;http://www.w3.org/1999/XPath\u0026#34; targetNamespace=\u0026#34;http://www.flowable.org/processdef\u0026#34; exporter=\u0026#34;Flowable Open Source Modeler\u0026#34; exporterVersion=\u0026#34;6.7.2\u0026#34;\u0026gt; \u0026lt;process id=\u0026#34;holiday-parr-key\u0026#34; name=\u0026#34;è¯·å‡æµç¨‹-å¹¶è¡Œç½‘å…³\u0026#34; isExecutable=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;documentation\u0026gt;holiday-parr-descr\u0026lt;/documentation\u0026gt; \u0026lt;startEvent id=\u0026#34;startEvent1\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt;\u0026lt;/startEvent\u0026gt; \u0026lt;userTask id=\u0026#34;sid-47EAD72A-932E-4850-9218-08A7335CEEDD\u0026#34; name=\u0026#34;åˆ›å»ºè¯·å‡å•\u0026#34; flowable:assignee=\u0026#34;zhangsan\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-8B72154F-6D29-47F8-A81C-A070F82B95F9\u0026#34; sourceRef=\u0026#34;startEvent1\u0026#34; targetRef=\u0026#34;sid-47EAD72A-932E-4850-9218-08A7335CEEDD\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;parallelGateway id=\u0026#34;sid-8B323A3D-F6DA-4D38-9CAE-D4CDA1031343\u0026#34;\u0026gt;\u0026lt;/parallelGateway\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-5F0BF3BD-BC7C-4AA0-AF87-F679C8EEB40B\u0026#34; sourceRef=\u0026#34;sid-47EAD72A-932E-4850-9218-08A7335CEEDD\u0026#34; targetRef=\u0026#34;sid-8B323A3D-F6DA-4D38-9CAE-D4CDA1031343\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;userTask id=\u0026#34;sid-AEFBD42F-2A10-4630-8E56-EDBD35CC95B1\u0026#34; name=\u0026#34;æŠ€æœ¯ç»ç†\u0026#34; flowable:assignee=\u0026#34;lisi\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-49DBB929-7488-471A-B79C-6BBFF4C810E0\u0026#34; sourceRef=\u0026#34;sid-8B323A3D-F6DA-4D38-9CAE-D4CDA1031343\u0026#34; targetRef=\u0026#34;sid-AEFBD42F-2A10-4630-8E56-EDBD35CC95B1\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;userTask id=\u0026#34;sid-8FB84D20-C946-4988-B4C4-16FFD899AF63\u0026#34; name=\u0026#34;é¡¹ç›®ç»ç†\u0026#34; flowable:assignee=\u0026#34;wangwu\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-DCF940BC-05D4-4260-8C50-A4C6E291DEA3\u0026#34; sourceRef=\u0026#34;sid-8B323A3D-F6DA-4D38-9CAE-D4CDA1031343\u0026#34; targetRef=\u0026#34;sid-8FB84D20-C946-4988-B4C4-16FFD899AF63\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;parallelGateway id=\u0026#34;sid-B25B9926-873F-46F5-9D62-D155462C1665\u0026#34;\u0026gt;\u0026lt;/parallelGateway\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-18DF81F2-2B7F-4CC7-AD70-8A878FC7B125\u0026#34; sourceRef=\u0026#34;sid-AEFBD42F-2A10-4630-8E56-EDBD35CC95B1\u0026#34; targetRef=\u0026#34;sid-B25B9926-873F-46F5-9D62-D155462C1665\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-B00C2DDD-8A30-4BA0-A2F8-69185D8506F5\u0026#34; sourceRef=\u0026#34;sid-8FB84D20-C946-4988-B4C4-16FFD899AF63\u0026#34; targetRef=\u0026#34;sid-B25B9926-873F-46F5-9D62-D155462C1665\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;userTask id=\u0026#34;sid-143837B7-0687-4268-B381-BA2442E39097\u0026#34; name=\u0026#34;æ€»ç»ç†\u0026#34; flowable:assignee=\u0026#34;zjl\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;endEvent id=\u0026#34;sid-5ACFE3BE-E094-43A9-85C5-7D438EFE5A97\u0026#34;\u0026gt;\u0026lt;/endEvent\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-4255A9F7-39A1-46D3-AF14-DBEFF17AE911\u0026#34; sourceRef=\u0026#34;sid-143837B7-0687-4268-B381-BA2442E39097\u0026#34; targetRef=\u0026#34;sid-5ACFE3BE-E094-43A9-85C5-7D438EFE5A97\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-2F49B59A-6860-4101-8156-84780094E6FE\u0026#34; sourceRef=\u0026#34;sid-B25B9926-873F-46F5-9D62-D155462C1665\u0026#34; targetRef=\u0026#34;sid-5ACFE3BE-E094-43A9-85C5-7D438EFE5A97\u0026#34;\u0026gt; \u0026lt;conditionExpression xsi:type=\u0026#34;tFormalExpression\u0026#34;\u0026gt;\u0026lt;![CDATA[${num \u0026lt;= 3}]]\u0026gt;\u0026lt;/conditionExpression\u0026gt; \u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-A5253FCB-3D23-483F-A511-197811F656D6\u0026#34; sourceRef=\u0026#34;sid-B25B9926-873F-46F5-9D62-D155462C1665\u0026#34; targetRef=\u0026#34;sid-143837B7-0687-4268-B381-BA2442E39097\u0026#34;\u0026gt; \u0026lt;conditionExpression xsi:type=\u0026#34;tFormalExpression\u0026#34;\u0026gt;\u0026lt;![CDATA[${num \u0026gt; 3}]]\u0026gt;\u0026lt;/conditionExpression\u0026gt; \u0026lt;/sequenceFlow\u0026gt; \u0026lt;/process\u0026gt; \u0026lt;bpmndi:BPMNDiagram id=\u0026#34;BPMNDiagram_holiday-parr-key\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNPlane bpmnElement=\u0026#34;holiday-parr-key\u0026#34; id=\u0026#34;BPMNPlane_holiday-parr-key\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;startEvent1\u0026#34; id=\u0026#34;BPMNShape_startEvent1\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;30.0\u0026#34; width=\u0026#34;30.0\u0026#34; x=\u0026#34;100.0\u0026#34; y=\u0026#34;163.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-47EAD72A-932E-4850-9218-08A7335CEEDD\u0026#34; id=\u0026#34;BPMNShape_sid-47EAD72A-932E-4850-9218-08A7335CEEDD\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;175.0\u0026#34; y=\u0026#34;138.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-8B323A3D-F6DA-4D38-9CAE-D4CDA1031343\u0026#34; id=\u0026#34;BPMNShape_sid-8B323A3D-F6DA-4D38-9CAE-D4CDA1031343\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;40.0\u0026#34; width=\u0026#34;40.0\u0026#34; x=\u0026#34;387.0\u0026#34; y=\u0026#34;143.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-AEFBD42F-2A10-4630-8E56-EDBD35CC95B1\u0026#34; id=\u0026#34;BPMNShape_sid-AEFBD42F-2A10-4630-8E56-EDBD35CC95B1\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;495.0\u0026#34; y=\u0026#34;45.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-8FB84D20-C946-4988-B4C4-16FFD899AF63\u0026#34; id=\u0026#34;BPMNShape_sid-8FB84D20-C946-4988-B4C4-16FFD899AF63\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;495.0\u0026#34; y=\u0026#34;225.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-B25B9926-873F-46F5-9D62-D155462C1665\u0026#34; id=\u0026#34;BPMNShape_sid-B25B9926-873F-46F5-9D62-D155462C1665\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;40.0\u0026#34; width=\u0026#34;40.0\u0026#34; x=\u0026#34;695.0\u0026#34; y=\u0026#34;143.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-143837B7-0687-4268-B381-BA2442E39097\u0026#34; id=\u0026#34;BPMNShape_sid-143837B7-0687-4268-B381-BA2442E39097\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;795.0\u0026#34; y=\u0026#34;60.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-5ACFE3BE-E094-43A9-85C5-7D438EFE5A97\u0026#34; id=\u0026#34;BPMNShape_sid-5ACFE3BE-E094-43A9-85C5-7D438EFE5A97\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;28.0\u0026#34; width=\u0026#34;28.0\u0026#34; x=\u0026#34;840.0\u0026#34; y=\u0026#34;225.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-4255A9F7-39A1-46D3-AF14-DBEFF17AE911\u0026#34; id=\u0026#34;BPMNEdge_sid-4255A9F7-39A1-46D3-AF14-DBEFF17AE911\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;14.0\u0026#34; flowable:targetDockerY=\u0026#34;14.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;847.586690647482\u0026#34; y=\u0026#34;139.95\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;853.095383523332\u0026#34; y=\u0026#34;225.02614923910227\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-8B72154F-6D29-47F8-A81C-A070F82B95F9\u0026#34; id=\u0026#34;BPMNEdge_sid-8B72154F-6D29-47F8-A81C-A070F82B95F9\u0026#34; flowable:sourceDockerX=\u0026#34;15.0\u0026#34; flowable:sourceDockerY=\u0026#34;15.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;129.9499984899576\u0026#34; y=\u0026#34;178.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;174.9999999999917\u0026#34; y=\u0026#34;178.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-49DBB929-7488-471A-B79C-6BBFF4C810E0\u0026#34; id=\u0026#34;BPMNEdge_sid-49DBB929-7488-471A-B79C-6BBFF4C810E0\u0026#34; flowable:sourceDockerX=\u0026#34;20.5\u0026#34; flowable:sourceDockerY=\u0026#34;20.5\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;404.70744680851067\u0026#34; y=\u0026#34;145.2843450479233\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;395.0\u0026#34; y=\u0026#34;82.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;494.9999999999998\u0026#34; y=\u0026#34;84.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-2F49B59A-6860-4101-8156-84780094E6FE\u0026#34; id=\u0026#34;BPMNEdge_sid-2F49B59A-6860-4101-8156-84780094E6FE\u0026#34; flowable:sourceDockerX=\u0026#34;20.5\u0026#34; flowable:sourceDockerY=\u0026#34;20.5\u0026#34; flowable:targetDockerX=\u0026#34;14.0\u0026#34; flowable:targetDockerY=\u0026#34;14.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;715.5\u0026#34; y=\u0026#34;182.43746693121696\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;715.5\u0026#34; y=\u0026#34;239.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;840.0\u0026#34; y=\u0026#34;239.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-DCF940BC-05D4-4260-8C50-A4C6E291DEA3\u0026#34; id=\u0026#34;BPMNEdge_sid-DCF940BC-05D4-4260-8C50-A4C6E291DEA3\u0026#34; flowable:sourceDockerX=\u0026#34;20.5\u0026#34; flowable:sourceDockerY=\u0026#34;20.5\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;407.5\u0026#34; y=\u0026#34;182.44067421259845\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;407.5\u0026#34; y=\u0026#34;265.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;494.9999999999674\u0026#34; y=\u0026#34;265.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-A5253FCB-3D23-483F-A511-197811F656D6\u0026#34; id=\u0026#34;BPMNEdge_sid-A5253FCB-3D23-483F-A511-197811F656D6\u0026#34; flowable:sourceDockerX=\u0026#34;20.5\u0026#34; flowable:sourceDockerY=\u0026#34;20.5\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;715.5\u0026#34; y=\u0026#34;143.5\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;715.5\u0026#34; y=\u0026#34;90.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;795.0\u0026#34; y=\u0026#34;96.13899613899613\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-5F0BF3BD-BC7C-4AA0-AF87-F679C8EEB40B\u0026#34; id=\u0026#34;BPMNEdge_sid-5F0BF3BD-BC7C-4AA0-AF87-F679C8EEB40B\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;20.0\u0026#34; flowable:targetDockerY=\u0026#34;20.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;274.9499999999998\u0026#34; y=\u0026#34;173.87912087912088\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;388.52284263959393\u0026#34; y=\u0026#34;164.5190355329949\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-18DF81F2-2B7F-4CC7-AD70-8A878FC7B125\u0026#34; id=\u0026#34;BPMNEdge_sid-18DF81F2-2B7F-4CC7-AD70-8A878FC7B125\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;20.0\u0026#34; flowable:targetDockerY=\u0026#34;20.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;594.95\u0026#34; y=\u0026#34;107.91823529411766\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;701.273276904474\u0026#34; y=\u0026#34;156.70967741935485\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-B00C2DDD-8A30-4BA0-A2F8-69185D8506F5\u0026#34; id=\u0026#34;BPMNEdge_sid-B00C2DDD-8A30-4BA0-A2F8-69185D8506F5\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;20.5\u0026#34; flowable:targetDockerY=\u0026#34;20.5\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;594.95\u0026#34; y=\u0026#34;235.23460410557183\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;702.9632352941177\u0026#34; y=\u0026#34;170.94457720588235\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;/bpmndi:BPMNPlane\u0026gt; \u0026lt;/bpmndi:BPMNDiagram\u0026gt; \u0026lt;/definitions\u0026gt; å¹¶è¡Œç½‘å…³çš„æ¡ä»¶ä¼šè¢«å¿½ç•¥ ä»£ç æµ‹è¯•\n//éƒ¨ç½²å¹¶è¿è¡Œ @Test public void deploy() { ProcessEngine engine = ProcessEngines.getDefaultProcessEngine(); RepositoryService repositoryService = engine.getRepositoryService(); Deployment deploy = repositoryService.createDeployment() .addClasspathResource(\u0026#34;è¯·å‡æµç¨‹-å¹¶è¡Œç½‘å…³.bpmn20.xml\u0026#34;) .deploy(); System.out.println(\u0026#34;éƒ¨ç½²æˆåŠŸ:\u0026#34; + deploy.getId()); } @Test public void run() { ProcessEngine engine = ProcessEngines.getDefaultProcessEngine(); RuntimeService runtimeService = engine.getRuntimeService(); Map\u0026lt;String, Object\u0026gt; variables = new HashMap\u0026lt;\u0026gt;(); variables.put(\u0026#34;num\u0026#34;, 4); runtimeService.startProcessInstanceById (\u0026#34;holiday-parr-key:1:12504\u0026#34;, variables); } æ­¤æ—¶ä»»åŠ¡åœç•™åœ¨zhangsan è®©zhangsanå®Œæˆä»»åŠ¡\n@Test public void taskComplete(){ ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = engine.getTaskService(); Task task = taskService.createTaskQuery() .taskAssignee(\u0026#34;zhangsan\u0026#34;) .processInstanceId(\u0026#34;15001\u0026#34;) .singleResult(); taskService.complete(task.getId()); } æŸ¥çœ‹è¡¨æ•°æ®(ä¸€ä¸ªä»»åŠ¡åŒ…å«å¤šä¸ªæ‰§è¡Œå®ä¾‹) è®©ç‹äº”å’Œæå››è¿›è¡Œå®¡æ‰¹ æŸ¥çœ‹æ•°æ®åº“ï¼Œwangwuå®¡æ‰¹åï¼Œact_ru_taskå°±å°‘äº†ä¸€æ¡è®°å½• æ­¤æ—¶èµ°åˆ°æ€»ç»ç†èŠ‚ç‚¹ å›¾è§£ åŒ…å®¹ç½‘å…³ # åŒ…å®¹ç½‘å…³å¯ä»¥é€‰æ‹©å¤šäºä¸€æ¡é¡ºåºæµã€‚å³å›ºå®šå‡ æ¡å¿…èµ°ï¼Œå…¶ä»–å‡ æ¡èµ°æ¡ä»¶\næµç¨‹å›¾ xml\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;definitions xmlns=\u0026#34;http://www.omg.org/spec/BPMN/20100524/MODEL\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:xsd=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; xmlns:flowable=\u0026#34;http://flowable.org/bpmn\u0026#34; xmlns:bpmndi=\u0026#34;http://www.omg.org/spec/BPMN/20100524/DI\u0026#34; xmlns:omgdc=\u0026#34;http://www.omg.org/spec/DD/20100524/DC\u0026#34; xmlns:omgdi=\u0026#34;http://www.omg.org/spec/DD/20100524/DI\u0026#34; typeLanguage=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; expressionLanguage=\u0026#34;http://www.w3.org/1999/XPath\u0026#34; targetNamespace=\u0026#34;http://www.flowable.org/processdef\u0026#34; exporter=\u0026#34;Flowable Open Source Modeler\u0026#34; exporterVersion=\u0026#34;6.7.2\u0026#34;\u0026gt; \u0026lt;process id=\u0026#34;holiday-inclusive\u0026#34; name=\u0026#34;holiday-inclusive-name\u0026#34; isExecutable=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;documentation\u0026gt;holiday-inclusive-desc\u0026lt;/documentation\u0026gt; \u0026lt;startEvent id=\u0026#34;startEvent1\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt;\u0026lt;/startEvent\u0026gt; \u0026lt;userTask id=\u0026#34;sid-6C2C29AA-C1D2-4B09-A542-ED194A13F5F2\u0026#34; name=\u0026#34;åˆ›å»ºè¯·å‡å•\u0026#34; flowable:assignee=\u0026#34;i0\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-CAD92170-984F-49E0-BB6D-589B11F7FB8B\u0026#34; sourceRef=\u0026#34;startEvent1\u0026#34; targetRef=\u0026#34;sid-6C2C29AA-C1D2-4B09-A542-ED194A13F5F2\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;inclusiveGateway id=\u0026#34;sid-46FAF12A-7430-4AFA-AABB-99B2D875C9CD\u0026#34;\u0026gt;\u0026lt;/inclusiveGateway\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-CCD38C3B-C06F-4646-B979-F65C0CA26321\u0026#34; sourceRef=\u0026#34;sid-6C2C29AA-C1D2-4B09-A542-ED194A13F5F2\u0026#34; targetRef=\u0026#34;sid-46FAF12A-7430-4AFA-AABB-99B2D875C9CD\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;userTask id=\u0026#34;sid-9AD9C288-F114-4AC6-9366-A09A786B068E\u0026#34; name=\u0026#34;é¡¹ç›®ç»ç†\u0026#34; flowable:assignee=\u0026#34;i1\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;userTask id=\u0026#34;sid-764DC717-439D-425E-83FF-D81BD08A2562\u0026#34; name=\u0026#34;äººäº‹\u0026#34; flowable:assignee=\u0026#34;i2\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-B8DE143C-4636-4F2C-99C9-8949E23B0042\u0026#34; sourceRef=\u0026#34;sid-46FAF12A-7430-4AFA-AABB-99B2D875C9CD\u0026#34; targetRef=\u0026#34;sid-764DC717-439D-425E-83FF-D81BD08A2562\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;userTask id=\u0026#34;sid-AC8D2717-5BCD-4C5B-81BB-2FF66CFFC615\u0026#34; name=\u0026#34;æŠ€æœ¯ç»ç†\u0026#34; flowable:assignee=\u0026#34;i3\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;inclusiveGateway id=\u0026#34;sid-6449A9C8-B7A3-44EE-BEDF-154AF323B1A8\u0026#34;\u0026gt;\u0026lt;/inclusiveGateway\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-A52331B4-3769-46D8-AAC1-C34214C729BD\u0026#34; sourceRef=\u0026#34;sid-9AD9C288-F114-4AC6-9366-A09A786B068E\u0026#34; targetRef=\u0026#34;sid-6449A9C8-B7A3-44EE-BEDF-154AF323B1A8\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-681E9C5D-AD4B-45DD-BF12-E2CD5304ADFB\u0026#34; sourceRef=\u0026#34;sid-764DC717-439D-425E-83FF-D81BD08A2562\u0026#34; targetRef=\u0026#34;sid-6449A9C8-B7A3-44EE-BEDF-154AF323B1A8\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-78E79754-E64A-4ADE-A9BB-F9B224D3A5A0\u0026#34; sourceRef=\u0026#34;sid-AC8D2717-5BCD-4C5B-81BB-2FF66CFFC615\u0026#34; targetRef=\u0026#34;sid-6449A9C8-B7A3-44EE-BEDF-154AF323B1A8\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;exclusiveGateway id=\u0026#34;sid-65D4D76B-AD2B-4AE9-8E78-7B8C33BD9E55\u0026#34;\u0026gt;\u0026lt;/exclusiveGateway\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-422FC4A8-B667-4271-9CB3-A1D2CFEFC5E1\u0026#34; sourceRef=\u0026#34;sid-6449A9C8-B7A3-44EE-BEDF-154AF323B1A8\u0026#34; targetRef=\u0026#34;sid-65D4D76B-AD2B-4AE9-8E78-7B8C33BD9E55\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;userTask id=\u0026#34;sid-4B834200-7995-453B-BC08-AF93C9F29FCF\u0026#34; name=\u0026#34;æ€»ç»ç†\u0026#34; flowable:assignee=\u0026#34;wz\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;endEvent id=\u0026#34;sid-7296D067-FF72-49F9-B416-2452640A0FBC\u0026#34;\u0026gt;\u0026lt;/endEvent\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-AD0571E9-839D-4F1F-89ED-05BE60F841FD\u0026#34; sourceRef=\u0026#34;sid-4B834200-7995-453B-BC08-AF93C9F29FCF\u0026#34; targetRef=\u0026#34;sid-7296D067-FF72-49F9-B416-2452640A0FBC\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-E808AF78-E258-4997-B4FE-C393D8EBA3B9\u0026#34; sourceRef=\u0026#34;sid-46FAF12A-7430-4AFA-AABB-99B2D875C9CD\u0026#34; targetRef=\u0026#34;sid-9AD9C288-F114-4AC6-9366-A09A786B068E\u0026#34;\u0026gt; \u0026lt;conditionExpression xsi:type=\u0026#34;tFormalExpression\u0026#34;\u0026gt;\u0026lt;![CDATA[${num\u0026gt;3}]]\u0026gt;\u0026lt;/conditionExpression\u0026gt; \u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-E4AD02E7-A69A-4684-9A00-DE9B11711348\u0026#34; sourceRef=\u0026#34;sid-46FAF12A-7430-4AFA-AABB-99B2D875C9CD\u0026#34; targetRef=\u0026#34;sid-AC8D2717-5BCD-4C5B-81BB-2FF66CFFC615\u0026#34;\u0026gt; \u0026lt;conditionExpression xsi:type=\u0026#34;tFormalExpression\u0026#34;\u0026gt;\u0026lt;![CDATA[${num \u0026lt;= 3}]]\u0026gt;\u0026lt;/conditionExpression\u0026gt; \u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-A6760B6A-B74F-4D35-93C2-6653751F8873\u0026#34; sourceRef=\u0026#34;sid-65D4D76B-AD2B-4AE9-8E78-7B8C33BD9E55\u0026#34; targetRef=\u0026#34;sid-4B834200-7995-453B-BC08-AF93C9F29FCF\u0026#34;\u0026gt; \u0026lt;conditionExpression xsi:type=\u0026#34;tFormalExpression\u0026#34;\u0026gt;\u0026lt;![CDATA[${num \u0026gt; 3}]]\u0026gt;\u0026lt;/conditionExpression\u0026gt; \u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-97A0DAB9-564D-4A62-92A4-26C7056CD347\u0026#34; sourceRef=\u0026#34;sid-65D4D76B-AD2B-4AE9-8E78-7B8C33BD9E55\u0026#34; targetRef=\u0026#34;sid-7296D067-FF72-49F9-B416-2452640A0FBC\u0026#34;\u0026gt; \u0026lt;conditionExpression xsi:type=\u0026#34;tFormalExpression\u0026#34;\u0026gt;\u0026lt;![CDATA[${num\u0026lt;=3 }]]\u0026gt;\u0026lt;/conditionExpression\u0026gt; \u0026lt;/sequenceFlow\u0026gt; \u0026lt;/process\u0026gt; \u0026lt;bpmndi:BPMNDiagram id=\u0026#34;BPMNDiagram_holiday-inclusive\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNPlane bpmnElement=\u0026#34;holiday-inclusive\u0026#34; id=\u0026#34;BPMNPlane_holiday-inclusive\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;startEvent1\u0026#34; id=\u0026#34;BPMNShape_startEvent1\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;30.0\u0026#34; width=\u0026#34;30.0\u0026#34; x=\u0026#34;100.0\u0026#34; y=\u0026#34;163.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-6C2C29AA-C1D2-4B09-A542-ED194A13F5F2\u0026#34; id=\u0026#34;BPMNShape_sid-6C2C29AA-C1D2-4B09-A542-ED194A13F5F2\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;195.0\u0026#34; y=\u0026#34;135.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-46FAF12A-7430-4AFA-AABB-99B2D875C9CD\u0026#34; id=\u0026#34;BPMNShape_sid-46FAF12A-7430-4AFA-AABB-99B2D875C9CD\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;40.0\u0026#34; width=\u0026#34;40.0\u0026#34; x=\u0026#34;366.0\u0026#34; y=\u0026#34;145.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-9AD9C288-F114-4AC6-9366-A09A786B068E\u0026#34; id=\u0026#34;BPMNShape_sid-9AD9C288-F114-4AC6-9366-A09A786B068E\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;451.0\u0026#34; y=\u0026#34;30.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-764DC717-439D-425E-83FF-D81BD08A2562\u0026#34; id=\u0026#34;BPMNShape_sid-764DC717-439D-425E-83FF-D81BD08A2562\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;450.0\u0026#34; y=\u0026#34;120.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-AC8D2717-5BCD-4C5B-81BB-2FF66CFFC615\u0026#34; id=\u0026#34;BPMNShape_sid-AC8D2717-5BCD-4C5B-81BB-2FF66CFFC615\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;465.0\u0026#34; y=\u0026#34;255.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-6449A9C8-B7A3-44EE-BEDF-154AF323B1A8\u0026#34; id=\u0026#34;BPMNShape_sid-6449A9C8-B7A3-44EE-BEDF-154AF323B1A8\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;40.0\u0026#34; width=\u0026#34;40.0\u0026#34; x=\u0026#34;656.0\u0026#34; y=\u0026#34;137.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-65D4D76B-AD2B-4AE9-8E78-7B8C33BD9E55\u0026#34; id=\u0026#34;BPMNShape_sid-65D4D76B-AD2B-4AE9-8E78-7B8C33BD9E55\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;40.0\u0026#34; width=\u0026#34;40.0\u0026#34; x=\u0026#34;750.0\u0026#34; y=\u0026#34;137.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-4B834200-7995-453B-BC08-AF93C9F29FCF\u0026#34; id=\u0026#34;BPMNShape_sid-4B834200-7995-453B-BC08-AF93C9F29FCF\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;855.0\u0026#34; y=\u0026#34;60.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-7296D067-FF72-49F9-B416-2452640A0FBC\u0026#34; id=\u0026#34;BPMNShape_sid-7296D067-FF72-49F9-B416-2452640A0FBC\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;28.0\u0026#34; width=\u0026#34;28.0\u0026#34; x=\u0026#34;900.0\u0026#34; y=\u0026#34;240.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-681E9C5D-AD4B-45DD-BF12-E2CD5304ADFB\u0026#34; id=\u0026#34;BPMNEdge_sid-681E9C5D-AD4B-45DD-BF12-E2CD5304ADFB\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;20.0\u0026#34; flowable:targetDockerY=\u0026#34;20.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;549.9499999999988\u0026#34; y=\u0026#34;159.14772727272728\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;656.3351955307262\u0026#34; y=\u0026#34;157.33435754189946\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-CCD38C3B-C06F-4646-B979-F65C0CA26321\u0026#34; id=\u0026#34;BPMNEdge_sid-CCD38C3B-C06F-4646-B979-F65C0CA26321\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;20.0\u0026#34; flowable:targetDockerY=\u0026#34;20.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;294.94999999999993\u0026#34; y=\u0026#34;171.45390070921985\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;367.32450331125824\u0026#34; y=\u0026#34;166.32119205298014\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-AD0571E9-839D-4F1F-89ED-05BE60F841FD\u0026#34; id=\u0026#34;BPMNEdge_sid-AD0571E9-839D-4F1F-89ED-05BE60F841FD\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;14.0\u0026#34; flowable:targetDockerY=\u0026#34;14.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;907.3347402597402\u0026#34; y=\u0026#34;139.95\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;913.1831773972388\u0026#34; y=\u0026#34;240.02104379436742\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-A6760B6A-B74F-4D35-93C2-6653751F8873\u0026#34; id=\u0026#34;BPMNEdge_sid-A6760B6A-B74F-4D35-93C2-6653751F8873\u0026#34; flowable:sourceDockerX=\u0026#34;22.5\u0026#34; flowable:sourceDockerY=\u0026#34;7.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;775.8406515580737\u0026#34; y=\u0026#34;142.87818696883852\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;855.0\u0026#34; y=\u0026#34;116.58716981132078\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-B8DE143C-4636-4F2C-99C9-8949E23B0042\u0026#34; id=\u0026#34;BPMNEdge_sid-B8DE143C-4636-4F2C-99C9-8949E23B0042\u0026#34; flowable:sourceDockerX=\u0026#34;20.5\u0026#34; flowable:sourceDockerY=\u0026#34;20.5\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;405.4272235576724\u0026#34; y=\u0026#34;165.5\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;428.0\u0026#34; y=\u0026#34;165.5\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;428.0\u0026#34; y=\u0026#34;160.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;449.99999999999346\u0026#34; y=\u0026#34;160.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-422FC4A8-B667-4271-9CB3-A1D2CFEFC5E1\u0026#34; id=\u0026#34;BPMNEdge_sid-422FC4A8-B667-4271-9CB3-A1D2CFEFC5E1\u0026#34; flowable:sourceDockerX=\u0026#34;20.5\u0026#34; flowable:sourceDockerY=\u0026#34;20.5\u0026#34; flowable:targetDockerX=\u0026#34;20.5\u0026#34; flowable:targetDockerY=\u0026#34;20.5\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;695.4399309245483\u0026#34; y=\u0026#34;157.5\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;750.5\u0026#34; y=\u0026#34;157.5\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-97A0DAB9-564D-4A62-92A4-26C7056CD347\u0026#34; id=\u0026#34;BPMNEdge_sid-97A0DAB9-564D-4A62-92A4-26C7056CD347\u0026#34; flowable:sourceDockerX=\u0026#34;20.5\u0026#34; flowable:sourceDockerY=\u0026#34;20.5\u0026#34; flowable:targetDockerX=\u0026#34;14.0\u0026#34; flowable:targetDockerY=\u0026#34;14.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;770.5\u0026#34; y=\u0026#34;176.44111163227018\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;770.5\u0026#34; y=\u0026#34;264.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;900.033302364888\u0026#34; y=\u0026#34;254.96981315483313\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-A52331B4-3769-46D8-AAC1-C34214C729BD\u0026#34; id=\u0026#34;BPMNEdge_sid-A52331B4-3769-46D8-AAC1-C34214C729BD\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;20.0\u0026#34; flowable:targetDockerY=\u0026#34;20.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;550.95\u0026#34; y=\u0026#34;94.83228571428573\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;662.6257153758107\u0026#34; y=\u0026#34;150.3587786259542\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-E808AF78-E258-4997-B4FE-C393D8EBA3B9\u0026#34; id=\u0026#34;BPMNEdge_sid-E808AF78-E258-4997-B4FE-C393D8EBA3B9\u0026#34; flowable:sourceDockerX=\u0026#34;20.5\u0026#34; flowable:sourceDockerY=\u0026#34;20.5\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;386.5\u0026#34; y=\u0026#34;145.5\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;386.5\u0026#34; y=\u0026#34;70.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;451.0\u0026#34; y=\u0026#34;70.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-CAD92170-984F-49E0-BB6D-589B11F7FB8B\u0026#34; id=\u0026#34;BPMNEdge_sid-CAD92170-984F-49E0-BB6D-589B11F7FB8B\u0026#34; flowable:sourceDockerX=\u0026#34;15.0\u0026#34; flowable:sourceDockerY=\u0026#34;15.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;129.94999191137833\u0026#34; y=\u0026#34;178.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;162.5\u0026#34; y=\u0026#34;178.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;162.5\u0026#34; y=\u0026#34;175.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;194.99999999998522\u0026#34; y=\u0026#34;175.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-E4AD02E7-A69A-4684-9A00-DE9B11711348\u0026#34; id=\u0026#34;BPMNEdge_sid-E4AD02E7-A69A-4684-9A00-DE9B11711348\u0026#34; flowable:sourceDockerX=\u0026#34;20.5\u0026#34; flowable:sourceDockerY=\u0026#34;20.5\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;386.5\u0026#34; y=\u0026#34;184.4426890432099\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;386.5\u0026#34; y=\u0026#34;295.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;465.0\u0026#34; y=\u0026#34;295.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-78E79754-E64A-4ADE-A9BB-F9B224D3A5A0\u0026#34; id=\u0026#34;BPMNEdge_sid-78E79754-E64A-4ADE-A9BB-F9B224D3A5A0\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;20.0\u0026#34; flowable:targetDockerY=\u0026#34;20.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;561.6083333333333\u0026#34; y=\u0026#34;255.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;665.2307692307692\u0026#34; y=\u0026#34;166.20769230769233\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;/bpmndi:BPMNPlane\u0026gt; \u0026lt;/bpmndi:BPMNDiagram\u0026gt; \u0026lt;/definitions\u0026gt; éƒ¨ç½²å¹¶è¿è¡Œ\n@Test public void deploy() { ProcessEngine engine = ProcessEngines.getDefaultProcessEngine(); RepositoryService repositoryService = engine.getRepositoryService(); Deployment deploy = repositoryService.createDeployment() .addClasspathResource(\u0026#34;holiday-inclusive-name.bpmn20.xml\u0026#34;) .deploy(); System.out.println(\u0026#34;éƒ¨ç½²æˆåŠŸ:\u0026#34; + deploy.getId()); } @Test public void run() { ProcessEngine engine = ProcessEngines.getDefaultProcessEngine(); RuntimeService runtimeService = engine.getRuntimeService(); Map\u0026lt;String, Object\u0026gt; variables = new HashMap\u0026lt;\u0026gt;(); variables.put(\u0026#34;num\u0026#34;, 4); runtimeService.startProcessInstanceById (\u0026#34;holiday-inclusive:1:4\u0026#34;, variables); } i0å®Œæˆä»»åŠ¡\n@Test public void taskComplete(){ ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = engine.getTaskService(); Task task = taskService.createTaskQuery() .taskAssignee(\u0026#34;i0\u0026#34;) .processInstanceId(\u0026#34;2501\u0026#34;) .singleResult(); taskService.complete(task.getId()); } çœ‹æ•°æ®ï¼Œé»˜è®¤èµ°äººäº‹å’Œé¡¹ç›®ç»ç† i1,i2æ‰€åœ¨ä»»åŠ¡æ‰§è¡Œå®Œåï¼Œä¼šå‘ç°èµ°æ€»ç»ç† i1èµ°å®Œä¹‹å i2èµ°çš„æ—¶å€™ï¼ŒæŠŠnumè®¾ä¸º1ï¼Œç›´æ¥ç»“æŸ\n@Test public void taskComplete(){ ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = engine.getTaskService(); Task task = taskService.createTaskQuery() .taskAssignee(\u0026#34;i2\u0026#34;) .processInstanceId(\u0026#34;2501\u0026#34;) .singleResult(); taskService.setVariable(task.getId(), \u0026#34;num\u0026#34;,1); taskService.complete(task.getId()); } äº‹ä»¶ç½‘å…³ # "},{"id":197,"href":"/zh/docs/study/Flowable/boge_blbl/02-advance_4/","title":"boge-02-flowableè¿›é˜¶_4","section":"åŸºç¡€(æ³¢å“¥)_","content":" å€™é€‰äºº # æµç¨‹å›¾è®¾è®¡\næ€»ä½“ å…·ä½“ éƒ¨ç½²å¹¶å¯åŠ¨æµç¨‹\n@Test public void deploy(){ ProcessEngine processEngine= ProcessEngines.getDefaultProcessEngine(); RepositoryService repositoryService = processEngine.getRepositoryService(); Deployment deploy = repositoryService.createDeployment().name(\u0026#34;lyç”»çš„è¯·å‡æµç¨‹-å€™é€‰äºº\u0026#34;) .addClasspathResource(\u0026#34;è¯·å‡æµç¨‹-å€™é€‰äºº.bpmn20.xml\u0026#34;) .deploy(); } @Test public void runProcess(){ //è®¾ç½®å€™é€‰äºº Map\u0026lt;String,Object\u0026gt; variables=new HashMap\u0026lt;\u0026gt;(); variables.put(\u0026#34;candidate1\u0026#34;,\u0026#34;å¼ ä¸‰\u0026#34;); variables.put(\u0026#34;candidate2\u0026#34;,\u0026#34;æå››\u0026#34;); variables.put(\u0026#34;candidate3\u0026#34;,\u0026#34;ç‹äº”\u0026#34;); ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); //è·å–æµç¨‹è¿è¡ŒæœåŠ¡ RuntimeService runtimeService = engine.getRuntimeService(); //è¿è¡Œæµç¨‹ ProcessInstance processInstance = runtimeService.startProcessInstanceById( \u0026#34;holiday-candidate:1:4\u0026#34;,variables); System.out.println(\u0026#34;processInstance--\u0026#34;+processInstance); } æŸ¥çœ‹æ•°æ®åº“è¡¨æ•°æ®\nå¤„ç†äººä¸ºç©º å˜é‡ å›¾è§£ å®é™…ï¼Œä½œä¸ºç™»å½•ç”¨æˆ·å¦‚æœæ˜¯å¼ ä¸‰/æå››æˆ–è€…ç‹äº”ï¼Œé‚£å®ƒå¯ä»¥æŸ¥çœ‹å®ƒè‡ªå·±æ˜¯å€™é€‰äººçš„ä»»åŠ¡\n/** * æŸ¥è¯¢å€™é€‰ä»»åŠ¡ */ @Test public void queryCandidate(){ ProcessEngine processEngine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService=processEngine.getTaskService(); List\u0026lt;Task\u0026gt; tasks = taskService.createTaskQuery() .processInstanceId(\u0026#34;5001\u0026#34;) .taskCandidateUser(\u0026#34;å¼ ä¸‰\u0026#34;) .list(); for(Task task:tasks){ System.out.println(\u0026#34;id--\u0026#34;+task.getId()+\u0026#34;--\u0026#34;+task.getName()); } } æ‹¾å–ä»»åŠ¡\n/** * æ‹¾å–ä»»åŠ¡ */ @Test public void claimTaskCandidate(){ ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService=engine.getTaskService(); Task task = taskService.createTaskQuery() .processInstanceId(\u0026#34;5001\u0026#34;) .taskCandidateUser(\u0026#34;å¼ ä¸‰\u0026#34;) .singleResult(); if(task != null ){ //æ‹¾å–ä»»åŠ¡ taskService.claim(task.getId(),\u0026#34;å¼ ä¸‰\u0026#34;); System.out.println(\u0026#34;æ‹¾å–ä»»åŠ¡æˆåŠŸ\u0026#34;); } } æ•°æ®åº“æ•°æ® æ­¤æ—¶æŸ¥è¯¢æå››å€™é€‰ä»»åŠ¡ï¼Œå°±æŸ¥è¯¢ä¸åˆ°äº† å½’è¿˜ä»»åŠ¡\n/** * æ‹¾å–ä»»åŠ¡ */ @Test public void unclaimTaskCandidate(){ ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService=engine.getTaskService(); Task task = taskService.createTaskQuery() .processInstanceId(\u0026#34;5001\u0026#34;) .taskAssignee(\u0026#34;å¼ ä¸‰\u0026#34;) .singleResult(); if(task != null ){ //å½’è¿˜ä»»åŠ¡ taskService.unclaim(task.getId()); System.out.println(\u0026#34;å½’è¿˜ä»»åŠ¡æˆåŠŸ\u0026#34;); } } æ•°æ®åº“æ•°æ® æ­¤æ—¶ç”¨æå››ï¼Œæ‹¾å–æˆåŠŸ ä»»åŠ¡äº¤æ¥(å§”æ‰˜)\n/** * ä»»åŠ¡äº¤æ¥(å§”æ‰˜) */ @Test public void taskCandidate(){ ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService=engine.getTaskService(); Task task = taskService.createTaskQuery() .processInstanceId(\u0026#34;5001\u0026#34;) .taskAssignee(\u0026#34;æå››\u0026#34;) .singleResult(); if(task != null ){ taskService.setAssignee(task.getId(),\u0026#34;èµµå…­\u0026#34;); System.out.println(\u0026#34;ä»»åŠ¡äº¤æ¥ç»™èµµå…­\u0026#34;); } } ç»“æœ å®Œæˆä»»åŠ¡\n/** * å®Œæˆä»»åŠ¡ */ @Test public void taskComplete(){ ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = engine.getTaskService(); Task task = taskService.createTaskQuery() .processInstanceId(\u0026#34;5001\u0026#34;) .taskAssignee(\u0026#34;èµµå…­\u0026#34;) .singleResult(); if(task!=null){ taskService.complete(task.getId()); System.out.println(\u0026#34;å®Œæˆä»»åŠ¡\u0026#34;); } } æ­¤æ—¶ä»»åŠ¡ç»™wzäº† å€™é€‰äººç»„ # å½“å€™é€‰äººå¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ†ç»„ã€‚ï¼ˆå…ˆåˆ›å»ºç»„ï¼Œç„¶åå°†ç”¨æˆ·æ”¾åˆ°ç»„ä¸­ï¼‰\nç»´æŠ¤ç”¨æˆ·å’Œç»„\n/** * åˆ›å»ºç”¨æˆ· */ @Test public void createUser(){ ProcessEngine engine= ProcessEngines.getDefaultProcessEngine(); IdentityService identityService = engine.getIdentityService(); User user1 = identityService.newUser(\u0026#34;æé£\u0026#34;); user1.setFirstName(\u0026#34;li\u0026#34;); user1.setLastName(\u0026#34;fei\u0026#34;); identityService.saveUser(user1); User user2 = identityService.newUser(\u0026#34;ç¯æ ‡\u0026#34;); user2.setFirstName(\u0026#34;deng\u0026#34;); user2.setLastName(\u0026#34;biao\u0026#34;); identityService.saveUser(user2); User user3 = identityService.newUser(\u0026#34;ç”°å®¶\u0026#34;); user3.setFirstName(\u0026#34;tian\u0026#34;); user3.setLastName(\u0026#34;jia\u0026#34;); identityService.saveUser(user3); } /** * åˆ›å»ºç»„ */ @Test public void createGroup(){ ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); IdentityService identityService = engine.getIdentityService(); Group group1 = identityService.newGroup(\u0026#34;group1\u0026#34;); group1.setName(\u0026#34;é”€å”®éƒ¨\u0026#34;); group1.setType(\u0026#34;typ1\u0026#34;); identityService.saveGroup(group1); Group group2 = identityService.newGroup(\u0026#34;group2\u0026#34;); group2.setName(\u0026#34;å¼€å‘éƒ¨\u0026#34;); group2.setType(\u0026#34;typ2\u0026#34;); identityService.saveGroup(group2); } /** * åˆ†é… */ @Test public void userGroup(){ ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); IdentityService identityService = engine.getIdentityService(); //æ‰¾åˆ°ç»„ Group group1 = identityService.createGroupQuery().groupId(\u0026#34;group1\u0026#34;) .singleResult(); //æ‰¾åˆ°æ‰€æœ‰ç”¨æˆ· List\u0026lt;User\u0026gt; list = identityService.createUserQuery().list(); for(User user:list){ identityService.createMembership(user.getId(),group1.getId()); System.out.println(user.getId()); } } è¡¨ç»“æ„\nåº”ç”¨ï¼Œåˆ›å»ºæµç¨‹å›¾ xmlæ–‡ä»¶\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;definitions xmlns=\u0026#34;http://www.omg.org/spec/BPMN/20100524/MODEL\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:xsd=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; xmlns:flowable=\u0026#34;http://flowable.org/bpmn\u0026#34; xmlns:bpmndi=\u0026#34;http://www.omg.org/spec/BPMN/20100524/DI\u0026#34; xmlns:omgdc=\u0026#34;http://www.omg.org/spec/DD/20100524/DC\u0026#34; xmlns:omgdi=\u0026#34;http://www.omg.org/spec/DD/20100524/DI\u0026#34; typeLanguage=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; expressionLanguage=\u0026#34;http://www.w3.org/1999/XPath\u0026#34; targetNamespace=\u0026#34;http://www.flowable.org/processdef\u0026#34; exporter=\u0026#34;Flowable Open Source Modeler\u0026#34; exporterVersion=\u0026#34;6.7.2\u0026#34;\u0026gt; \u0026lt;process id=\u0026#34;holiday-group\u0026#34; name=\u0026#34;è¯·æ±‚æµç¨‹-å€™é€‰äººç»„\u0026#34; isExecutable=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;startEvent id=\u0026#34;startEvent1\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt;\u0026lt;/startEvent\u0026gt; \u0026lt;userTask id=\u0026#34;sid-B4CAA6EE-47C0-4C51-AB0F-7A347AA88CF9\u0026#34; name=\u0026#34;åˆ›å»ºè¯·å‡å•\u0026#34; flowable:candidateGroups=\u0026#34;${g1}\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt;\u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-FAA16FF3-BFC5-49AA-8BB5-7DF1918F67FF\u0026#34; sourceRef=\u0026#34;startEvent1\u0026#34; targetRef=\u0026#34;sid-B4CAA6EE-47C0-4C51-AB0F-7A347AA88CF9\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;userTask id=\u0026#34;sid-C3C15BE2-2D50-4178-AD36-D6BAC5C47526\u0026#34; name=\u0026#34;æ€»ç»ç†å®¡æ‰¹\u0026#34; flowable:assignee=\u0026#34;wz\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-9821E7E5-DB4A-4BE5-95C7-2721E98D6BD6\u0026#34; sourceRef=\u0026#34;sid-B4CAA6EE-47C0-4C51-AB0F-7A347AA88CF9\u0026#34; targetRef=\u0026#34;sid-C3C15BE2-2D50-4178-AD36-D6BAC5C47526\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;endEvent id=\u0026#34;sid-BF42EC91-584D-4C19-8EC0-9658CD948CDE\u0026#34;\u0026gt;\u0026lt;/endEvent\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-6F5E54EF-5767-4E22-8AC7-322C7E332B6B\u0026#34; sourceRef=\u0026#34;sid-C3C15BE2-2D50-4178-AD36-D6BAC5C47526\u0026#34; targetRef=\u0026#34;sid-BF42EC91-584D-4C19-8EC0-9658CD948CDE\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;/process\u0026gt; \u0026lt;bpmndi:BPMNDiagram id=\u0026#34;BPMNDiagram_holiday-group\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNPlane bpmnElement=\u0026#34;holiday-group\u0026#34; id=\u0026#34;BPMNPlane_holiday-group\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;startEvent1\u0026#34; id=\u0026#34;BPMNShape_startEvent1\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;30.0\u0026#34; width=\u0026#34;30.0\u0026#34; x=\u0026#34;100.0\u0026#34; y=\u0026#34;163.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-B4CAA6EE-47C0-4C51-AB0F-7A347AA88CF9\u0026#34; id=\u0026#34;BPMNShape_sid-B4CAA6EE-47C0-4C51-AB0F-7A347AA88CF9\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;165.0\u0026#34; y=\u0026#34;135.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-C3C15BE2-2D50-4178-AD36-D6BAC5C47526\u0026#34; id=\u0026#34;BPMNShape_sid-C3C15BE2-2D50-4178-AD36-D6BAC5C47526\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;330.0\u0026#34; y=\u0026#34;135.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-BF42EC91-584D-4C19-8EC0-9658CD948CDE\u0026#34; id=\u0026#34;BPMNShape_sid-BF42EC91-584D-4C19-8EC0-9658CD948CDE\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;28.0\u0026#34; width=\u0026#34;28.0\u0026#34; x=\u0026#34;510.0\u0026#34; y=\u0026#34;164.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-9821E7E5-DB4A-4BE5-95C7-2721E98D6BD6\u0026#34; id=\u0026#34;BPMNEdge_sid-9821E7E5-DB4A-4BE5-95C7-2721E98D6BD6\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;264.94999999998356\u0026#34; y=\u0026#34;175.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;330.0\u0026#34; y=\u0026#34;175.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-FAA16FF3-BFC5-49AA-8BB5-7DF1918F67FF\u0026#34; id=\u0026#34;BPMNEdge_sid-FAA16FF3-BFC5-49AA-8BB5-7DF1918F67FF\u0026#34; flowable:sourceDockerX=\u0026#34;15.0\u0026#34; flowable:sourceDockerY=\u0026#34;15.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;129.94340692927761\u0026#34; y=\u0026#34;177.55019845363262\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;164.99999999999906\u0026#34; y=\u0026#34;176.4985\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-6F5E54EF-5767-4E22-8AC7-322C7E332B6B\u0026#34; id=\u0026#34;BPMNEdge_sid-6F5E54EF-5767-4E22-8AC7-322C7E332B6B\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;14.0\u0026#34; flowable:targetDockerY=\u0026#34;14.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;429.9499999999989\u0026#34; y=\u0026#34;176.04062499999998\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;510.0021426561354\u0026#34; y=\u0026#34;177.70839534661596\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;/bpmndi:BPMNPlane\u0026gt; \u0026lt;/bpmndi:BPMNDiagram\u0026gt; \u0026lt;/definitions\u0026gt; éƒ¨ç½²å¹¶å¯åŠ¨æµç¨‹\n@Test public void deploy(){ ProcessEngine processEngine= ProcessEngines.getDefaultProcessEngine(); RepositoryService repositoryService = processEngine.getRepositoryService(); Deployment deploy = repositoryService.createDeployment().name(\u0026#34;lyç”»çš„è¯·å‡æµç¨‹-å€™é€‰äºº\u0026#34;) .addClasspathResource(\u0026#34;è¯·æ±‚æµç¨‹-å€™é€‰äººç»„.bpmn20.xml\u0026#34;) .deploy(); } @Test public void runProcess(){ ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); //å®é™…å¼€å‘ï¼Œåº”è¯¥æŒ‰ä¸‹é¢ä»£ç è®©ç”¨æˆ·é€‰ IdentityService identityService = engine.getIdentityService(); List\u0026lt;Group\u0026gt; list = identityService.createGroupQuery().list(); //è·å–æµç¨‹è¿è¡ŒæœåŠ¡ RuntimeService runtimeService = engine.getRuntimeService(); //è®¾ç½®å€™é€‰äºº Map\u0026lt;String,Object\u0026gt; variables=new HashMap\u0026lt;\u0026gt;(); variables.put(\u0026#34;g1\u0026#34;,\u0026#34;group1\u0026#34;); //è¿è¡Œæµç¨‹ ProcessInstance processInstance = runtimeService. startProcessInstanceById( \u0026#34;holiday-group:1:25004\u0026#34;,variables); System.out.println(\u0026#34;processInstance--\u0026#34;+processInstance); } è¡¨ variables æŸ¥æ‰¾å½“å‰ç”¨æˆ·æ‰€åœ¨ç»„çš„ä»»åŠ¡ï¼Œå¹¶æ‹¾å–\n/** * æŸ¥è¯¢å€™é€‰ç»„ä»»åŠ¡ */ @Test public void queryCandidateGroup(){ String userId=\u0026#34;ç¯æ ‡\u0026#34;; ProcessEngine processEngine=ProcessEngines.getDefaultProcessEngine(); IdentityService identityService = processEngine.getIdentityService(); Group group = identityService.createGroupQuery(). groupMember(userId) .singleResult(); System.out.println(\u0026#34;ç¯æ ‡ç»„id\u0026#34;+group.getId()); TaskService taskService=processEngine.getTaskService(); List\u0026lt;Task\u0026gt; tasks = taskService.createTaskQuery() .processInstanceId(\u0026#34;27501\u0026#34;) .taskCandidateGroup(group.getId()) .list(); for(Task task:tasks){ System.out.println(\u0026#34;id--\u0026#34;+task.getId()+\u0026#34;--\u0026#34;+task.getName()); } Task task = taskService.createTaskQuery() .processInstanceId(\u0026#34;27501\u0026#34;) .taskCandidateGroup(group.getId()) .singleResult(); if(task!=null){ System.out.println(\u0026#34;æ‹¾å–ä»»åŠ¡--\u0026#34;+task.getId() +\u0026#34;ä»»åŠ¡å--\u0026#34;+task.getName()); taskService.claim(task.getId(),userId); } } æ•°æ®åº“æ•°æ® å®Œæˆä»»åŠ¡\n/** * å®Œæˆä»»åŠ¡ */ @Test public void taskComplete(){ ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = engine.getTaskService(); Task task = taskService.createTaskQuery() .processInstanceId(\u0026#34;27501\u0026#34;) .taskAssignee(\u0026#34;ç¯æ ‡\u0026#34;) .singleResult(); if(task!=null){ taskService.complete(task.getId()); System.out.println(\u0026#34;å®Œæˆä»»åŠ¡\u0026#34;); } } # "},{"id":198,"href":"/zh/docs/study/Flowable/boge_blbl/02-advance_3/","title":"boge-02-flowableè¿›é˜¶_3","section":"åŸºç¡€(æ³¢å“¥)_","content":" ä»»åŠ¡åˆ†é…-uelè¡¨è¾¾å¼ # é€šè¿‡å˜é‡æŒ‡å®šæ¥è¿›è¡Œåˆ†é…\né¦–å…ˆç»˜åˆ¶æµç¨‹å›¾ï¼ˆå®šä¹‰ï¼‰ å˜é‡å¤„ç† ä¹‹åå°†xmlæ–‡ä»¶å¯¼å‡º\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;definitions xmlns=\u0026#34;http://www.omg.org/spec/BPMN/20100524/MODEL\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:xsd=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; xmlns:flowable=\u0026#34;http://flowable.org/bpmn\u0026#34; xmlns:bpmndi=\u0026#34;http://www.omg.org/spec/BPMN/20100524/DI\u0026#34; xmlns:omgdc=\u0026#34;http://www.omg.org/spec/DD/20100524/DC\u0026#34; xmlns:omgdi=\u0026#34;http://www.omg.org/spec/DD/20100524/DI\u0026#34; typeLanguage=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; expressionLanguage=\u0026#34;http://www.w3.org/1999/XPath\u0026#34; targetNamespace=\u0026#34;http://www.flowable.org/processdef\u0026#34; exporter=\u0026#34;Flowable Open Source Modeler\u0026#34; exporterVersion=\u0026#34;6.7.2\u0026#34;\u0026gt; \u0026lt;process id=\u0026#34;holiday-new\u0026#34; name=\u0026#34;æ–°è¯·å‡æµç¨‹\u0026#34; isExecutable=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;documentation\u0026gt;new-description\u0026lt;/documentation\u0026gt; \u0026lt;startEvent id=\u0026#34;startEvent1\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt;\u0026lt;/startEvent\u0026gt; \u0026lt;userTask id=\u0026#34;sid-8D901410-5BD7-4EED-B988-5E40D12298C7\u0026#34; name=\u0026#34;åˆ›å»ºè¯·å‡æµç¨‹\u0026#34; flowable:assignee=\u0026#34;${assignee0}\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;userTask id=\u0026#34;sid-5EB8F68B-7876-42AF-98E1-FCA27F99D8CE\u0026#34; name=\u0026#34;å®¡æ‰¹è¯·å‡æµç¨‹\u0026#34; flowable:assignee=\u0026#34;${assignee1}\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-631EFFB0-795A-4777-B49E-CF7D015BFF15\u0026#34; sourceRef=\u0026#34;sid-8D901410-5BD7-4EED-B988-5E40D12298C7\u0026#34; targetRef=\u0026#34;sid-5EB8F68B-7876-42AF-98E1-FCA27F99D8CE\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;endEvent id=\u0026#34;sid-15CAD0D3-7F8B-404C-9346-A8D2A456D47B\u0026#34;\u0026gt;\u0026lt;/endEvent\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-001CA567-6169-4F8A-A0E5-010721D52508\u0026#34; sourceRef=\u0026#34;sid-5EB8F68B-7876-42AF-98E1-FCA27F99D8CE\u0026#34; targetRef=\u0026#34;sid-15CAD0D3-7F8B-404C-9346-A8D2A456D47B\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-0A4A52F2-ECF6-44B2-AA41-F926AA7F5932\u0026#34; sourceRef=\u0026#34;startEvent1\u0026#34; targetRef=\u0026#34;sid-8D901410-5BD7-4EED-B988-5E40D12298C7\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;/process\u0026gt; \u0026lt;bpmndi:BPMNDiagram id=\u0026#34;BPMNDiagram_holiday-new\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNPlane bpmnElement=\u0026#34;holiday-new\u0026#34; id=\u0026#34;BPMNPlane_holiday-new\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;startEvent1\u0026#34; id=\u0026#34;BPMNShape_startEvent1\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;30.0\u0026#34; width=\u0026#34;30.0\u0026#34; x=\u0026#34;100.0\u0026#34; y=\u0026#34;145.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-8D901410-5BD7-4EED-B988-5E40D12298C7\u0026#34; id=\u0026#34;BPMNShape_sid-8D901410-5BD7-4EED-B988-5E40D12298C7\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;225.0\u0026#34; y=\u0026#34;120.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-5EB8F68B-7876-42AF-98E1-FCA27F99D8CE\u0026#34; id=\u0026#34;BPMNShape_sid-5EB8F68B-7876-42AF-98E1-FCA27F99D8CE\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;370.0\u0026#34; y=\u0026#34;120.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-15CAD0D3-7F8B-404C-9346-A8D2A456D47B\u0026#34; id=\u0026#34;BPMNShape_sid-15CAD0D3-7F8B-404C-9346-A8D2A456D47B\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;28.0\u0026#34; width=\u0026#34;28.0\u0026#34; x=\u0026#34;555.0\u0026#34; y=\u0026#34;146.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-001CA567-6169-4F8A-A0E5-010721D52508\u0026#34; id=\u0026#34;BPMNEdge_sid-001CA567-6169-4F8A-A0E5-010721D52508\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;14.0\u0026#34; flowable:targetDockerY=\u0026#34;14.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;469.94999999997356\u0026#34; y=\u0026#34;160.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;555.0\u0026#34; y=\u0026#34;160.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-0A4A52F2-ECF6-44B2-AA41-F926AA7F5932\u0026#34; id=\u0026#34;BPMNEdge_sid-0A4A52F2-ECF6-44B2-AA41-F926AA7F5932\u0026#34; flowable:sourceDockerX=\u0026#34;15.0\u0026#34; flowable:sourceDockerY=\u0026#34;15.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;129.94999928606217\u0026#34; y=\u0026#34;160.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;224.99999999995185\u0026#34; y=\u0026#34;160.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-631EFFB0-795A-4777-B49E-CF7D015BFF15\u0026#34; id=\u0026#34;BPMNEdge_sid-631EFFB0-795A-4777-B49E-CF7D015BFF15\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;324.9499999999907\u0026#34; y=\u0026#34;160.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;369.9999999999807\u0026#34; y=\u0026#34;160.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;/bpmndi:BPMNPlane\u0026gt; \u0026lt;/bpmndi:BPMNDiagram\u0026gt; \u0026lt;/definitions\u0026gt; æµç¨‹å®šä¹‰çš„éƒ¨ç½²\n/** * æµç¨‹çš„éƒ¨ç½² */ @Test public void testDeploy() { //è·å–ProcessEngineå¯¹è±¡ ProcessEngine processEngine = configuration.buildProcessEngine(); //è·å–æœåŠ¡(repositoryï¼Œæµç¨‹å®šä¹‰) RepositoryService repositoryService = processEngine.getRepositoryService(); Deployment deploy = repositoryService.createDeployment() .addClasspathResource(\u0026#34;æ–°è¯·å‡æµç¨‹.bpmn20.xml\u0026#34;) .name(\u0026#34;è¯·æ±‚æµç¨‹\u0026#34;) //æµç¨‹å .deploy(); System.out.println(\u0026#34;éƒ¨ç½²id\u0026#34; + deploy.getId()); System.out.println(\u0026#34;éƒ¨ç½²å\u0026#34; + deploy.getName()); } æµç¨‹çš„å¯åŠ¨ï¼ˆåœ¨æµç¨‹å¯åŠ¨æ—¶å°±å·²ç»å¤„ç†å¥½äº†å„ä¸ªèŠ‚ç‚¹çš„å¤„ç†äººï¼‰\n/** * æµç¨‹å®ä¾‹çš„å¯åŠ¨ */ @Test public void testRunProcess2(){ ProcessEngine engine=ProcessEngines.getDefaultProcessEngine(); RuntimeService runtimeService = engine.getRuntimeService(); //å¯åŠ¨æµç¨‹æ—¶ï¼Œå‘èµ·äººå°±å·²ç»è®¾ç½®å¥½äº† Map\u0026lt;String,Object\u0026gt; variables=new HashMap\u0026lt;\u0026gt;(); variables.put(\u0026#34;assignee0\u0026#34;,\u0026#34;å¼ ä¸‰\u0026#34;); variables.put(\u0026#34;assignee1\u0026#34;,\u0026#34;æå››\u0026#34;); ProcessInstance processInstance = runtimeService.startProcessInstanceById(\u0026#34;holiday-new:1:4\u0026#34;,variables); System.out.println(processInstance); } æŸ¥çœ‹æ•°æ®åº“è¡¨æ•°æ®\nact_ru_variable\nact_ru_task è®©å¼ ä¸‰å®Œæˆå¤„ç†\n@Test public void testComplete(){ ProcessEngine processEngine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = processEngine.getTaskService(); Task task = taskService.createTaskQuery().taskAssignee(\u0026#34;å¼ ä¸‰\u0026#34;) .processInstanceId(\u0026#34;2501\u0026#34;) .singleResult(); taskService.complete(task.getId()); } æ­¤æ—¶è§‚å¯Ÿtaskå’Œidentityè¿™ä¸¤å¼ è¡¨\nä»»åŠ¡å˜æˆäº†æå››ï¼Œè€Œidentityå¤šäº†å¼ ä¸‰çš„è®°å½•\nä»»åŠ¡åˆ†é…-ç›‘å¬å™¨åˆ†é… # é¦–å…ˆï¼Œjavaä»£ç ä¸­ï¼Œè‡ªå®šä¹‰ä¸€ä¸ªç›‘å¬å™¨ ã€æ³¨æ„ï¼Œè¿™é‡Œç»™ä»»åŠ¡åˆ†é…assigneeæ˜¯åœ¨createä¸­åˆ†é…æ‰æ˜¯æœ‰ç”¨çš„ã€‘\npackage org.flowable.listener; import org.flowable.engine.delegate.TaskListener; import org.flowable.task.service.delegate.DelegateTask; public class MyTaskListener implements TaskListener { /** * ç›‘å¬å™¨è§¦å‘çš„æ–¹æ³• * @param delegateTask */ @Override public void notify(DelegateTask delegateTask) { System.out.println(\u0026#34;MyTaskListenerè§¦å‘ï¼š\u0026#34;+delegateTask .getName()); if(\u0026#34;åˆ›å»ºè¯·å‡æµç¨‹\u0026#34;.equals(delegateTask.getName()) \u0026amp;\u0026amp;\u0026#34;create\u0026#34;.equals(delegateTask.getEventName())){ delegateTask.setAssignee(\u0026#34;å°æ˜\u0026#34;); }else { delegateTask.setAssignee(\u0026#34;å°æ\u0026#34;); } } } ä¸¤ä¸ªèŠ‚ç‚¹èµ°çš„æ˜¯åŒä¸€ä¸ªç›‘å¬å™¨\nxmlå®šä¹‰ä¸­ä»»åŠ¡ç›‘å¬å™¨çš„é…ç½®(ä¸¤ä¸ªèŠ‚ç‚¹éƒ½é…ç½®äº†) \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;definitions xmlns=\u0026#34;http://www.omg.org/spec/BPMN/20100524/MODEL\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:xsd=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; xmlns:flowable=\u0026#34;http://flowable.org/bpmn\u0026#34; xmlns:bpmndi=\u0026#34;http://www.omg.org/spec/BPMN/20100524/DI\u0026#34; xmlns:omgdc=\u0026#34;http://www.omg.org/spec/DD/20100524/DC\u0026#34; xmlns:omgdi=\u0026#34;http://www.omg.org/spec/DD/20100524/DI\u0026#34; typeLanguage=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; expressionLanguage=\u0026#34;http://www.w3.org/1999/XPath\u0026#34; targetNamespace=\u0026#34;http://www.flowable.org/processdef\u0026#34; exporter=\u0026#34;Flowable Open Source Modeler\u0026#34; exporterVersion=\u0026#34;6.7.2\u0026#34;\u0026gt; \u0026lt;process id=\u0026#34;holiday-new\u0026#34; name=\u0026#34;æ–°è¯·å‡æµç¨‹\u0026#34; isExecutable=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;documentation\u0026gt;new-description\u0026lt;/documentation\u0026gt; \u0026lt;startEvent id=\u0026#34;startEvent1\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt;\u0026lt;/startEvent\u0026gt; \u0026lt;userTask id=\u0026#34;sid-8D901410-5BD7-4EED-B988-5E40D12298C7\u0026#34; name=\u0026#34;åˆ›å»ºè¯·å‡æµç¨‹\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;flowable:taskListener event=\u0026#34;create\u0026#34; class=\u0026#34;org.flowable.listener.MyTaskListener\u0026#34;\u0026gt;\u0026lt;/flowable:taskListener\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;userTask id=\u0026#34;sid-5EB8F68B-7876-42AF-98E1-FCA27F99D8CE\u0026#34; name=\u0026#34;å®¡æ‰¹è¯·å‡æµç¨‹\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;flowable:taskListener event=\u0026#34;create\u0026#34; class=\u0026#34;org.flowable.listener.MyTaskListener\u0026#34;\u0026gt;\u0026lt;/flowable:taskListener\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-631EFFB0-795A-4777-B49E-CF7D015BFF15\u0026#34; sourceRef=\u0026#34;sid-8D901410-5BD7-4EED-B988-5E40D12298C7\u0026#34; targetRef=\u0026#34;sid-5EB8F68B-7876-42AF-98E1-FCA27F99D8CE\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-001CA567-6169-4F8A-A0E5-010721D52508\u0026#34; sourceRef=\u0026#34;sid-5EB8F68B-7876-42AF-98E1-FCA27F99D8CE\u0026#34; targetRef=\u0026#34;sid-15CAD0D3-7F8B-404C-9346-A8D2A456D47B\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-0A4A52F2-ECF6-44B2-AA41-F926AA7F5932\u0026#34; sourceRef=\u0026#34;startEvent1\u0026#34; targetRef=\u0026#34;sid-8D901410-5BD7-4EED-B988-5E40D12298C7\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;endEvent id=\u0026#34;sid-15CAD0D3-7F8B-404C-9346-A8D2A456D47B\u0026#34;\u0026gt;\u0026lt;/endEvent\u0026gt; \u0026lt;/process\u0026gt; \u0026lt;bpmndi:BPMNDiagram id=\u0026#34;BPMNDiagram_holiday-new\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNPlane bpmnElement=\u0026#34;holiday-new\u0026#34; id=\u0026#34;BPMNPlane_holiday-new\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;startEvent1\u0026#34; id=\u0026#34;BPMNShape_startEvent1\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;30.0\u0026#34; width=\u0026#34;30.0\u0026#34; x=\u0026#34;100.0\u0026#34; y=\u0026#34;115.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-8D901410-5BD7-4EED-B988-5E40D12298C7\u0026#34; id=\u0026#34;BPMNShape_sid-8D901410-5BD7-4EED-B988-5E40D12298C7\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;195.0\u0026#34; y=\u0026#34;90.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-5EB8F68B-7876-42AF-98E1-FCA27F99D8CE\u0026#34; id=\u0026#34;BPMNShape_sid-5EB8F68B-7876-42AF-98E1-FCA27F99D8CE\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;370.0\u0026#34; y=\u0026#34;90.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-15CAD0D3-7F8B-404C-9346-A8D2A456D47B\u0026#34; id=\u0026#34;BPMNShape_sid-15CAD0D3-7F8B-404C-9346-A8D2A456D47B\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;28.0\u0026#34; width=\u0026#34;28.0\u0026#34; x=\u0026#34;570.0\u0026#34; y=\u0026#34;116.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-001CA567-6169-4F8A-A0E5-010721D52508\u0026#34; id=\u0026#34;BPMNEdge_sid-001CA567-6169-4F8A-A0E5-010721D52508\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;14.0\u0026#34; flowable:targetDockerY=\u0026#34;14.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;469.9499999999809\u0026#34; y=\u0026#34;130.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;570.0\u0026#34; y=\u0026#34;130.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-0A4A52F2-ECF6-44B2-AA41-F926AA7F5932\u0026#34; id=\u0026#34;BPMNEdge_sid-0A4A52F2-ECF6-44B2-AA41-F926AA7F5932\u0026#34; flowable:sourceDockerX=\u0026#34;15.0\u0026#34; flowable:sourceDockerY=\u0026#34;15.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;129.94999891869114\u0026#34; y=\u0026#34;130.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;195.0\u0026#34; y=\u0026#34;130.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-631EFFB0-795A-4777-B49E-CF7D015BFF15\u0026#34; id=\u0026#34;BPMNEdge_sid-631EFFB0-795A-4777-B49E-CF7D015BFF15\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;294.95000000000005\u0026#34; y=\u0026#34;130.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;369.99999999993753\u0026#34; y=\u0026#34;130.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;/bpmndi:BPMNPlane\u0026gt; \u0026lt;/bpmndi:BPMNDiagram\u0026gt; \u0026lt;/definitions\u0026gt; ä¹‹åå°†æµç¨‹å†é‡æ–°éƒ¨ç½²ä¸€é\n/** * æµç¨‹çš„éƒ¨ç½² */ @Test public void testDeploy() { //è·å–ProcessEngineå¯¹è±¡ ProcessEngine processEngine = configuration.buildProcessEngine(); //è·å–æœåŠ¡(repositoryï¼Œæµç¨‹å®šä¹‰) RepositoryService repositoryService = processEngine.getRepositoryService(); Deployment deploy = repositoryService.createDeployment() .addClasspathResource(\u0026#34;æ–°è¯·å‡æµç¨‹.bpmn20.xml\u0026#34;) .name(\u0026#34;è¯·æ±‚æµç¨‹\u0026#34;) //æµç¨‹å .deploy(); System.out.println(\u0026#34;éƒ¨ç½²id\u0026#34; + deploy.getId()); System.out.println(\u0026#34;éƒ¨ç½²å\u0026#34; + deploy.getName()); } æµç¨‹è¿è¡Œ\n/** * æµç¨‹å®ä¾‹çš„å¯åŠ¨ */ @Test public void testRunProcess3() { ProcessEngine engine = ProcessEngines.getDefaultProcessEngine(); RuntimeService runtimeService = engine.getRuntimeService(); ProcessInstance processInstance = runtimeService.startProcessInstanceById( \u0026#34;holiday-new:1:4\u0026#34;); System.out.println(processInstance); } æ§åˆ¶å°æŸ¥çœ‹ æ•°æ®åº“æŸ¥çœ‹ è®©å°æ˜å¤„ç†ä»»åŠ¡\n@Test public void testComplete(){ ProcessEngine processEngine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = processEngine.getTaskService(); Task task = taskService.createTaskQuery().taskAssignee(\u0026#34;å°æ˜\u0026#34;) .processInstanceId(\u0026#34;2501\u0026#34;) .singleResult(); taskService.complete(task.getId()); } æ•°æ®åº“æŸ¥çœ‹ æµç¨‹å˜é‡ # å…¨å±€å˜é‡ï¼ˆè·Ÿæµç¨‹æœ‰å…³ï¼‰å’Œå±€éƒ¨å˜é‡ï¼ˆè·Ÿtaskæœ‰å…³ï¼‰\nä¸€ä¸ªæµç¨‹å®šä¹‰ï¼Œå¯ä»¥è¿è¡Œå¤šä¸ªæµç¨‹å®ä¾‹ï¼› å½“ç”¨åˆ°å­æµç¨‹æ—¶ï¼Œå°±ä¼šå‡ºç°ä¸€å¯¹å¤šçš„å…³ç³» å…¨å±€å˜é‡è¢«é‡å¤èµ‹å€¼æ—¶åé¢ä¼šè¦†ç›–å‰é¢\næµç¨‹å›¾çš„åˆ›å»º è¿™é‡Œè¿˜è®¾ç½®äº†æ¡ä»¶ï¼Œè¯¦è§xmæ–‡ä»¶ sequenceFlow.conditionExpression å±æ€§\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;definitions xmlns=\u0026#34;http://www.omg.org/spec/BPMN/20100524/MODEL\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:xsd=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; xmlns:flowable=\u0026#34;http://flowable.org/bpmn\u0026#34; xmlns:bpmndi=\u0026#34;http://www.omg.org/spec/BPMN/20100524/DI\u0026#34; xmlns:omgdc=\u0026#34;http://www.omg.org/spec/DD/20100524/DC\u0026#34; xmlns:omgdi=\u0026#34;http://www.omg.org/spec/DD/20100524/DI\u0026#34; typeLanguage=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; expressionLanguage=\u0026#34;http://www.w3.org/1999/XPath\u0026#34; targetNamespace=\u0026#34;http://www.flowable.org/processdef\u0026#34; exporter=\u0026#34;Flowable Open Source Modeler\u0026#34; exporterVersion=\u0026#34;6.7.2\u0026#34;\u0026gt; \u0026lt;process id=\u0026#34;evection\u0026#34; name=\u0026#34;å‡ºå·®ç”³è¯·å•\u0026#34; isExecutable=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;documentation\u0026gt;å‡ºå·®ç”³è¯·å•\u0026lt;/documentation\u0026gt; \u0026lt;startEvent id=\u0026#34;startEvent1\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt;\u0026lt;/startEvent\u0026gt; \u0026lt;userTask id=\u0026#34;sid-BFB6D699-D3B5-4C6C-A0F2-00584EAAF207\u0026#34; name=\u0026#34;åˆ›å»ºå‡ºå·®ç”³è¯·å•\u0026#34; flowable:assignee=\u0026#34;${assignee0}\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-EE410204-0433-4FE6-A958-48585A2A7B4B\u0026#34; sourceRef=\u0026#34;startEvent1\u0026#34; targetRef=\u0026#34;sid-BFB6D699-D3B5-4C6C-A0F2-00584EAAF207\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;userTask id=\u0026#34;sid-D10C4F45-B429-4E24-B474-5354F1661645\u0026#34; name=\u0026#34;éƒ¨é—¨ç»ç†å®¡æ‰¹\u0026#34; flowable:assignee=\u0026#34;${assignee1}\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-752CE2F2-40EC-4140-AF60-BEACD06D43A7\u0026#34; sourceRef=\u0026#34;sid-BFB6D699-D3B5-4C6C-A0F2-00584EAAF207\u0026#34; targetRef=\u0026#34;sid-D10C4F45-B429-4E24-B474-5354F1661645\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;userTask id=\u0026#34;sid-35AB278B-E16D-4CEC-98B1-FBB139FB5AC1\u0026#34; name=\u0026#34;æ€»ç»ç†å®¡æ‰¹\u0026#34; flowable:assignee=\u0026#34;${assignee2}\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;userTask id=\u0026#34;sid-4C26DA5C-A4CC-48A5-ABA9-853E82FC2413\u0026#34; name=\u0026#34;è´¢åŠ¡å®¡æ‰¹ \u0026#34; flowable:assignee=\u0026#34;${assignee3}\u0026#34; flowable:formFieldValidation=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;extensionElements\u0026gt; \u0026lt;modeler:initiator-can-complete xmlns:modeler=\u0026#34;http://flowable.org/modeler\u0026#34;\u0026gt;\u0026lt;![CDATA[false]]\u0026gt;\u0026lt;/modeler:initiator-can-complete\u0026gt; \u0026lt;/extensionElements\u0026gt; \u0026lt;/userTask\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-BE043A23-0F38-4ED9-A0D1-F4C2F7908A50\u0026#34; sourceRef=\u0026#34;sid-35AB278B-E16D-4CEC-98B1-FBB139FB5AC1\u0026#34; targetRef=\u0026#34;sid-4C26DA5C-A4CC-48A5-ABA9-853E82FC2413\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;endEvent id=\u0026#34;sid-B3A1D5D4-E1FD-4599-A482-762C7C617844\u0026#34;\u0026gt;\u0026lt;/endEvent\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-6C0130A8-E078-486B-9B6E-D8C14BBCD8EF\u0026#34; sourceRef=\u0026#34;sid-4C26DA5C-A4CC-48A5-ABA9-853E82FC2413\u0026#34; targetRef=\u0026#34;sid-B3A1D5D4-E1FD-4599-A482-762C7C617844\u0026#34;\u0026gt;\u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-F85B2D44-1B42-4748-AB35-123C7CCD2F75\u0026#34; sourceRef=\u0026#34;sid-D10C4F45-B429-4E24-B474-5354F1661645\u0026#34; targetRef=\u0026#34;sid-35AB278B-E16D-4CEC-98B1-FBB139FB5AC1\u0026#34;\u0026gt; \u0026lt;conditionExpression xsi:type=\u0026#34;tFormalExpression\u0026#34;\u0026gt;\u0026lt;![CDATA[${num \u0026gt;= 3}]]\u0026gt;\u0026lt;/conditionExpression\u0026gt; \u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;sid-B12793A8-FC65-408C-81AD-EC81FEEF6E46\u0026#34; sourceRef=\u0026#34;sid-D10C4F45-B429-4E24-B474-5354F1661645\u0026#34; targetRef=\u0026#34;sid-4C26DA5C-A4CC-48A5-ABA9-853E82FC2413\u0026#34;\u0026gt; \u0026lt;conditionExpression xsi:type=\u0026#34;tFormalExpression\u0026#34;\u0026gt;\u0026lt;![CDATA[${num \u0026lt; 3}]]\u0026gt;\u0026lt;/conditionExpression\u0026gt; \u0026lt;/sequenceFlow\u0026gt; \u0026lt;/process\u0026gt; \u0026lt;bpmndi:BPMNDiagram id=\u0026#34;BPMNDiagram_evection\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNPlane bpmnElement=\u0026#34;evection\u0026#34; id=\u0026#34;BPMNPlane_evection\u0026#34;\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;startEvent1\u0026#34; id=\u0026#34;BPMNShape_startEvent1\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;30.0\u0026#34; width=\u0026#34;30.0\u0026#34; x=\u0026#34;100.0\u0026#34; y=\u0026#34;75.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-BFB6D699-D3B5-4C6C-A0F2-00584EAAF207\u0026#34; id=\u0026#34;BPMNShape_sid-BFB6D699-D3B5-4C6C-A0F2-00584EAAF207\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;175.0\u0026#34; y=\u0026#34;50.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-D10C4F45-B429-4E24-B474-5354F1661645\u0026#34; id=\u0026#34;BPMNShape_sid-D10C4F45-B429-4E24-B474-5354F1661645\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;320.0\u0026#34; y=\u0026#34;50.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-35AB278B-E16D-4CEC-98B1-FBB139FB5AC1\u0026#34; id=\u0026#34;BPMNShape_sid-35AB278B-E16D-4CEC-98B1-FBB139FB5AC1\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;555.0\u0026#34; y=\u0026#34;50.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-4C26DA5C-A4CC-48A5-ABA9-853E82FC2413\u0026#34; id=\u0026#34;BPMNShape_sid-4C26DA5C-A4CC-48A5-ABA9-853E82FC2413\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;80.0\u0026#34; width=\u0026#34;100.0\u0026#34; x=\u0026#34;555.0\u0026#34; y=\u0026#34;210.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNShape bpmnElement=\u0026#34;sid-B3A1D5D4-E1FD-4599-A482-762C7C617844\u0026#34; id=\u0026#34;BPMNShape_sid-B3A1D5D4-E1FD-4599-A482-762C7C617844\u0026#34;\u0026gt; \u0026lt;omgdc:Bounds height=\u0026#34;28.0\u0026#34; width=\u0026#34;28.0\u0026#34; x=\u0026#34;750.0\u0026#34; y=\u0026#34;236.0\u0026#34;\u0026gt;\u0026lt;/omgdc:Bounds\u0026gt; \u0026lt;/bpmndi:BPMNShape\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-EE410204-0433-4FE6-A958-48585A2A7B4B\u0026#34; id=\u0026#34;BPMNEdge_sid-EE410204-0433-4FE6-A958-48585A2A7B4B\u0026#34; flowable:sourceDockerX=\u0026#34;15.0\u0026#34; flowable:sourceDockerY=\u0026#34;15.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;129.9499984899576\u0026#34; y=\u0026#34;90.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;175.0\u0026#34; y=\u0026#34;90.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-752CE2F2-40EC-4140-AF60-BEACD06D43A7\u0026#34; id=\u0026#34;BPMNEdge_sid-752CE2F2-40EC-4140-AF60-BEACD06D43A7\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;274.95000000000005\u0026#34; y=\u0026#34;90.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;320.0\u0026#34; y=\u0026#34;90.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-B12793A8-FC65-408C-81AD-EC81FEEF6E46\u0026#34; id=\u0026#34;BPMNEdge_sid-B12793A8-FC65-408C-81AD-EC81FEEF6E46\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;419.95000000000005\u0026#34; y=\u0026#34;124.0085106382979\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;555.0\u0026#34; y=\u0026#34;215.95744680851067\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-6C0130A8-E078-486B-9B6E-D8C14BBCD8EF\u0026#34; id=\u0026#34;BPMNEdge_sid-6C0130A8-E078-486B-9B6E-D8C14BBCD8EF\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;14.0\u0026#34; flowable:targetDockerY=\u0026#34;14.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;654.9499999998701\u0026#34; y=\u0026#34;250.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;750.0\u0026#34; y=\u0026#34;250.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-BE043A23-0F38-4ED9-A0D1-F4C2F7908A50\u0026#34; id=\u0026#34;BPMNEdge_sid-BE043A23-0F38-4ED9-A0D1-F4C2F7908A50\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;605.0\u0026#34; y=\u0026#34;129.95\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;605.0\u0026#34; y=\u0026#34;210.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;bpmndi:BPMNEdge bpmnElement=\u0026#34;sid-F85B2D44-1B42-4748-AB35-123C7CCD2F75\u0026#34; id=\u0026#34;BPMNEdge_sid-F85B2D44-1B42-4748-AB35-123C7CCD2F75\u0026#34; flowable:sourceDockerX=\u0026#34;50.0\u0026#34; flowable:sourceDockerY=\u0026#34;40.0\u0026#34; flowable:targetDockerX=\u0026#34;50.0\u0026#34; flowable:targetDockerY=\u0026#34;40.0\u0026#34;\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;419.95000000000005\u0026#34; y=\u0026#34;90.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;omgdi:waypoint x=\u0026#34;555.0\u0026#34; y=\u0026#34;90.0\u0026#34;\u0026gt;\u0026lt;/omgdi:waypoint\u0026gt; \u0026lt;/bpmndi:BPMNEdge\u0026gt; \u0026lt;/bpmndi:BPMNPlane\u0026gt; \u0026lt;/bpmndi:BPMNDiagram\u0026gt; \u0026lt;/definitions\u0026gt; æµç¨‹è¿›è¡Œéƒ¨ç½²\n/** * æµç¨‹çš„éƒ¨ç½² */ @Test public void testDeploy() { //è·å–ProcessEngineå¯¹è±¡ ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine(); //è·å–æœåŠ¡(repositoryï¼Œæµç¨‹å®šä¹‰) RepositoryService repositoryService = processEngine.getRepositoryService(); Deployment deploy = repositoryService.createDeployment() .addClasspathResource(\u0026#34;å‡ºå·®ç”³è¯·å•.bpmn20.xml\u0026#34;) .name(\u0026#34;è¯·å‡æµç¨‹\u0026#34;) //æµç¨‹å .deploy(); System.out.println(\u0026#34;éƒ¨ç½²id\u0026#34; + deploy.getId()); System.out.println(\u0026#34;éƒ¨ç½²å\u0026#34; + deploy.getName()); } æµç¨‹è¿è¡Œ\n/** * æµç¨‹å®ä¾‹çš„å®šä¹‰ */ @Test public void runProcess(){ ProcessEngine processEngine=ProcessEngines.getDefaultProcessEngine(); RuntimeService runtimeService = processEngine.getRuntimeService(); Map\u0026lt;String,Object\u0026gt; variables=new HashMap\u0026lt;\u0026gt;(); variables.put(\u0026#34;assignee0\u0026#34;,\u0026#34;å¼ ä¸‰\u0026#34;); variables.put(\u0026#34;assignee1\u0026#34;,\u0026#34;æå››\u0026#34;); variables.put(\u0026#34;assignee2\u0026#34;,\u0026#34;ç‹äº”\u0026#34;); variables.put(\u0026#34;assignee3\u0026#34;,\u0026#34;èµµè´¢åŠ¡\u0026#34;); ProcessInstance processInstance = runtimeService. startProcessInstanceById(\u0026#34;evection:1:4\u0026#34;, variables); } //è¿™æ—¶å€™èŠ‚ç‚¹èµ°åˆ°å¼ ä¸‰äº†ï¼Œè®©å¼ ä¸‰å¤„ç†\n/** * ä»»åŠ¡å®Œæˆ */ @Test public void taskComplete(){ ProcessEngine processEngine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = processEngine.getTaskService(); Task task = taskService.createTaskQuery() .processInstanceId(\u0026#34;2501\u0026#34;) .taskAssignee(\u0026#34;å¼ ä¸‰\u0026#34;) .singleResult(); Map\u0026lt;String,Object\u0026gt; processVariables=task.getProcessVariables(); processVariables.put(\u0026#34;num\u0026#34;,3); taskService.complete(task.getId(),processVariables); } ä¸‹é¢ä¿®æ”¹numçš„å€¼ï¼Œä¿®æ”¹ä¹‹å‰ å…¨å±€å˜é‡çš„æŸ¥è¯¢\n@Test public void getVariables(){ ProcessEngine processEngine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = processEngine.getTaskService(); Task task = taskService.createTaskQuery() .includeProcessVariables() //æ³¨æ„ï¼Œè¿™ä¸ªä¸€å®šè¦åŠ çš„ä¸ç„¶è·å–ä¸åˆ°å…¨å±€å˜é‡ .processInstanceId(\u0026#34;2501\u0026#34;) .taskAssignee(\u0026#34;å¼ ä¸‰\u0026#34;) .singleResult(); //è¿™é‡Œåªèƒ½è·å–åˆ°ä»»åŠ¡çš„å±€éƒ¨å˜é‡ Map\u0026lt;String, Object\u0026gt; processVariables = task.getProcessVariables(); System.out.println(\u0026#34;å½“å‰æµç¨‹å˜é‡--start\u0026#34;); Set\u0026lt;String\u0026gt; keySet1 = processVariables.keySet(); for(String key:keySet1){ System.out.println(\u0026#34;key--\u0026#34;+key+\u0026#34;value--\u0026#34;+processVariables.get(key)); } System.out.println(\u0026#34;å½“å‰æµç¨‹å˜é‡--end\u0026#34;); } ä¿®æ”¹\n@Test public void updateVariables(){ ProcessEngine processEngine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = processEngine.getTaskService(); Task task = taskService.createTaskQuery() .includeProcessVariables() //æ³¨æ„ï¼Œè¿™ä¸ªä¸€å®šè¦åŠ çš„ä¸ç„¶è·å–ä¸åˆ°å…¨å±€å˜é‡ .processInstanceId(\u0026#34;2501\u0026#34;) .taskAssignee(\u0026#34;æå››\u0026#34;) .singleResult(); Map\u0026lt;String, Object\u0026gt; processVariables = task.getProcessVariables(); System.out.println(\u0026#34;å½“å‰æµç¨‹å˜é‡--start\u0026#34;); Set\u0026lt;String\u0026gt; keySet = processVariables.keySet(); for(String key:keySet){ System.out.println(\u0026#34;key--\u0026#34;+key+\u0026#34;value--\u0026#34;+processVariables.get(key)); } System.out.println(\u0026#34;å½“å‰æµç¨‹å˜é‡--end\u0026#34;); processVariables.put(\u0026#34;num\u0026#34;,5); taskService.setVariablesLocal(task.getId(),processVariables); } ç»“æœ\næŒ‰ç…§è§†é¢‘çš„è¯´æ³•ï¼Œè¿™é‡Œé”™äº†ï¼Œåº”è¯¥æ˜¯ä¼šå¤šäº†5æ¡è®°å½• å±€éƒ¨å˜é‡çš„å†æ¬¡æµ‹è¯•\n@Test public void updateVariables(){ ProcessEngine processEngine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = processEngine.getTaskService(); Task task = taskService.createTaskQuery() .includeProcessVariables() .processInstanceId(\u0026#34;2501\u0026#34;) .taskAssignee(\u0026#34;å¼ ä¸‰\u0026#34;) .singleResult(); //æµç¨‹è¿˜æ²¡å¼€å§‹è¿è¡Œçš„æƒ…å†µä¸‹ï¼Œå–åˆ°çš„æ˜¯å…¨å±€å˜é‡ Map\u0026lt;String, Object\u0026gt; processVariables = task.getProcessVariables(); System.out.println(\u0026#34;å½“å‰æµç¨‹å˜é‡--start\u0026#34;); Set\u0026lt;String\u0026gt; keySet = processVariables.keySet(); for(String key:keySet){ System.out.println(\u0026#34;key--\u0026#34;+key+\u0026#34;value--\u0026#34;+processVariables.get(key)); } System.out.println(\u0026#34;å½“å‰æµç¨‹å˜é‡--end\u0026#34;); Map\u0026lt;String,Object\u0026gt; varLocalInsert=new HashMap\u0026lt;\u0026gt;(); varLocalInsert.put(\u0026#34;num\u0026#34;,5); Map\u0026lt;String,Object\u0026gt; varUpdate=new HashMap\u0026lt;\u0026gt;(); varUpdate.put(\u0026#34;a\u0026#34;,\u0026#34;å˜¿å˜¿\u0026#34;); //è¿™é‡Œæµ‹è¯•ä¼šä¸ä¼šæŠŠå…¨å±€å˜é‡å…¨éƒ¨è¦†ç›– taskService.setVariables(task.getId(),varUpdate); taskService.setVariablesLocal(task.getId(),varLocalInsert); } ä¿®æ”¹å‰ ä¿®æ”¹å ç»“æœè¡¨æ˜è¿™æ˜¯æ‰¹é‡å¢åŠ /ä¿®æ”¹ï¼Œè€Œä¸æ˜¯è¦†ç›– å½“å‰æ•°æ®åº“çš„æ•°æ® 1ä¸ªå±€éƒ¨å˜é‡numï¼Œ5ä¸ªå…¨å±€å˜é‡ æ¥ä¸‹æ¥åœ¨å¼ ä¸‰èŠ‚ç‚¹è®¾ç½®ä¸€ä¸ªå±€éƒ¨å˜é‡\n/** * ä»»åŠ¡å®Œæˆ */ @Test public void taskComplete(){ ProcessEngine processEngine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = processEngine.getTaskService(); Task task = taskService.createTaskQuery() .processInstanceId(\u0026#34;2501\u0026#34;) .taskAssignee(\u0026#34;å¼ ä¸‰\u0026#34;) .singleResult(); Map\u0026lt;String,Object\u0026gt; processVariables=task.getProcessVariables(); processVariables.put(\u0026#34;num\u0026#34;,2); taskService.complete(task.getId(),processVariables); } æŸ¥çœ‹æ•°æ®åº“è¡¨ï¼Œå‘ç°numå·²ç»è¢«ä¿®æ”¹æˆ2 è¿™æ—¶æå››è®¾ç½®äº†ä¸€ä¸ªå±€éƒ¨å˜é‡num=6\n@Test public void updateVariables2(){ ProcessEngine processEngine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = processEngine.getTaskService(); Task task = taskService.createTaskQuery() .includeProcessVariables() .processInstanceId(\u0026#34;2501\u0026#34;) .taskAssignee(\u0026#34;æå››\u0026#34;) .singleResult(); Map\u0026lt;String,Object\u0026gt; varLocalInsert=new HashMap\u0026lt;\u0026gt;(); varLocalInsert.put(\u0026#34;num\u0026#34;,6); Map\u0026lt;String,Object\u0026gt; varUpdate=new HashMap\u0026lt;\u0026gt;(); varUpdate.put(\u0026#34;a\u0026#34;,\u0026#34;å˜¿å˜¿\u0026#34;); //è¿™é‡Œæµ‹è¯•ä¼šä¸ä¼šæŠŠå…¨å±€å˜é‡å…¨éƒ¨è¦†ç›– //taskService.setVariables(task.getId(),varUpdate); taskService.setVariablesLocal(task.getId(),varLocalInsert); } ä»…ä»…å¤šäº†ä¸€æ¡è®°å½• ä¿®æ”¹å…¨å±€å˜é‡\n@Test public void updateVariables3(){ ProcessEngine processEngine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = processEngine.getTaskService(); Task task = taskService.createTaskQuery() .includeProcessVariables() .processInstanceId(\u0026#34;2501\u0026#34;) .taskAssignee(\u0026#34;æå››\u0026#34;) .singleResult(); Map\u0026lt;String,Object\u0026gt; varLocalInsert=new HashMap\u0026lt;\u0026gt;(); varLocalInsert.put(\u0026#34;num\u0026#34;,18); varLocalInsert.put(\u0026#34;a\u0026#34;,\u0026#34;aè¢«ä¿®æ”¹äº†\u0026#34;); //è¿™é‡Œæµ‹è¯•ä¼šä¸ä¼šæŠŠå…¨å±€å˜é‡å…¨éƒ¨è¦†ç›– //taskService.setVariables(task.getId(),varUpdate); taskService.setVariables(task.getId(),varLocalInsert); } ç»“æœå¦‚ä¸‹ï¼Œå½“å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡çš„åç§°ä¸€æ ·æ—¶ï¼Œåªèƒ½ä¿®æ”¹å±€éƒ¨å˜é‡ è®©æå››å®Œæˆå®¡æ‰¹ è¿™é‡Œå­˜åœ¨å±€éƒ¨å˜é‡num=18ï¼Œä¸”å®Œæˆæ—¶è®¾ç½®äº†å±€éƒ¨å˜é‡20\n@Test public void taskComplete4(){ ProcessEngine processEngine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = processEngine.getTaskService(); Task task = taskService.createTaskQuery() .includeProcessVariables() .processInstanceId(\u0026#34;2501\u0026#34;) .taskAssignee(\u0026#34;æå››\u0026#34;) .singleResult(); // System.out.println(\u0026#34;taskId\u0026#34;+task.getId()); Map\u0026lt;String,Object\u0026gt; map=new HashMap\u0026lt;\u0026gt;(); map.put(\u0026#34;num\u0026#34;,20); taskService.complete(task.getId(),map); } æ³¨æ„ï¼Œè¿™é‡Œå…¨å±€å˜é‡è¢«æ”¹æˆ20äº†ï¼Œå±€éƒ¨å˜é‡è¢«åˆ é™¤äº† èµ°åˆ°äº†æ€»ç»ç†å®¡æ‰¹\nå†æµ‹è¯• å°†æ•°æ®æ¸…ç©ºï¼Œé‡æ–°éƒ¨ç½²å¹¶è¿è¡Œæµç¨‹\nç°åœ¨åœ¨èµµå››èŠ‚ç‚¹ï¼Œå±€éƒ¨å˜é‡ä¸º @Test public void taskComplete4(){ ProcessEngine processEngine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = processEngine.getTaskService(); Task task = taskService.createTaskQuery() .includeProcessVariables() .processInstanceId(\u0026#34;2501\u0026#34;) .taskAssignee(\u0026#34;æå››\u0026#34;) .singleResult(); // System.out.println(\u0026#34;taskId\u0026#34;+task.getId()); Map\u0026lt;String,Object\u0026gt; map=new HashMap\u0026lt;\u0026gt;(); map.put(\u0026#34;num\u0026#34;,20); taskService.setVariablesLocal(task.getId(),map); taskService.complete(task.getId()); } è¿è¡Œå®Œä¹‹åï¼Œå±€éƒ¨å˜é‡å˜æˆ20äº†ï¼Œä½†æ˜¯æµç¨‹èµ°ä¸ä¸‹å» ç¨ä½œæ›´æ”¹ï¼Œæ·»åŠ ä¸€ä¸ªå…¨å±€å˜é‡(ä½†æ˜¯ç”±äºå­˜åœ¨å±€éƒ¨å˜é‡aï¼Œæ‰€ä»¥è¿™é‡Œå…¨å±€å˜é‡æ²¡è®¾ç½®æˆåŠŸ)\n@Test public void taskComplete4(){ ProcessEngine processEngine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = processEngine.getTaskService(); Task task = taskService.createTaskQuery() .includeProcessVariables() .processInstanceId(\u0026#34;2501\u0026#34;) .taskAssignee(\u0026#34;æå››\u0026#34;) .singleResult(); // System.out.println(\u0026#34;taskId\u0026#34;+task.getId()); Map\u0026lt;String,Object\u0026gt; map=new HashMap\u0026lt;\u0026gt;(); map.put(\u0026#34;num\u0026#34;,20); taskService.setVariablesLocal(task.getId(),map); Map\u0026lt;String,Object\u0026gt; map1=new HashMap\u0026lt;\u0026gt;(); map1.put(\u0026#34;num\u0026#34;,1); taskService.setVariables(task.getId(),map1); taskService.complete(task.getId()); } ç°åœ¨åªèƒ½é€šè¿‡åœ¨completeä¸­è®¾ç½®ï¼Œæ¥ä½¿å¾—å…¨å±€å˜é‡ç”Ÿæ•ˆ\n@Test public void taskComplete4(){ ProcessEngine processEngine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = processEngine.getTaskService(); Task task = taskService.createTaskQuery() .includeProcessVariables() .processInstanceId(\u0026#34;2501\u0026#34;) .taskAssignee(\u0026#34;æå››\u0026#34;) .singleResult(); // System.out.println(\u0026#34;taskId\u0026#34;+task.getId()); Map\u0026lt;String,Object\u0026gt; map=new HashMap\u0026lt;\u0026gt;(); map.put(\u0026#34;num\u0026#34;,null); taskService.setVariablesLocal(task.getId(),map); Map\u0026lt;String,Object\u0026gt; map1=new HashMap\u0026lt;\u0026gt;(); map1.put(\u0026#34;num\u0026#34;,1); //taskService.setVariables(task.getId(),map1); taskService.complete(task.getId(),map1); } ç»“æœï¼Œå…¨å±€å˜é‡è®¾ç½®æˆåŠŸï¼Œä¸”ä»»åŠ¡æµè½¬åˆ°äº†è´¢åŠ¡é‚£ å†æµ‹è¯•\nåœ¨å­˜åœ¨å±€éƒ¨å˜é‡num=2çš„æƒ…å†µä¸‹æ‰§è¡Œä¸‹é¢ä»£ç \n@Test public void taskComplete5() { ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine(); TaskService taskService = processEngine.getTaskService(); Task task = taskService.createTaskQuery() .includeProcessVariables() .processInstanceId(\u0026#34;2501\u0026#34;) .taskAssignee(\u0026#34;æå››\u0026#34;) .singleResult(); // System.out.println(\u0026#34;taskId\u0026#34; + task.getId()); Map\u0026lt;String, Object\u0026gt; map = new HashMap\u0026lt;\u0026gt;(); map.put(\u0026#34;num\u0026#34;, 15); taskService.setVariables(task.getId(), map); taskService.complete(task.getId()); /*Map\u0026lt;String,Object\u0026gt; map1=new HashMap\u0026lt;\u0026gt;(); map1.put(\u0026#34;num\u0026#34;,1); taskService.complete(task.getId(),map1);*/ } ä¼šæç¤ºæŠ¥é”™ï¼ŒUnknown property used in expression: ${num \u0026gt;= 3}\n//è¯´æ˜çº¿æ¡ä¸­æŸ¥æ‰¾çš„æ˜¯å…¨å±€å˜é‡\nåœ¨ä¸å­˜åœ¨å±€éƒ¨å˜é‡numçš„æƒ…å†µä¸‹æ‰§è¡Œä¸Šé¢ä»£ç ï¼Œä¼šèµ°æ€»ç»ç†å®¡æ‰¹ï¼ˆnum\u0026gt;3)\nåœ¨completeä¸­åŠ ä¸Šmapå‚æ•°ï¼ŒéªŒè¯æ˜çº¿æ¡æŸ¥æ‰¾çš„æ˜¯å…¨å±€å˜é‡çš„å€¼ï¼Œcompleteå¸¦ä¸Švariablesä¼šè®¾ç½®å…¨å±€å˜é‡\n@Test public void taskComplete5() { ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine(); TaskService taskService = processEngine.getTaskService(); Task task = taskService.createTaskQuery() .includeProcessVariables() .processInstanceId(\u0026#34;2501\u0026#34;) .taskAssignee(\u0026#34;æå››\u0026#34;) .singleResult(); // System.out.println(\u0026#34;taskId\u0026#34; + task.getId()); Map\u0026lt;String, Object\u0026gt; map = new HashMap\u0026lt;\u0026gt;(); map.put(\u0026#34;num\u0026#34;, 15); // taskService.setVariables(task.getId(), map); taskService.complete(task.getId(),map); /*Map\u0026lt;String,Object\u0026gt; map1=new HashMap\u0026lt;\u0026gt;(); map1.put(\u0026#34;num\u0026#34;,1); taskService.complete(task.getId(),map1);*/ } æ•°æ®åº“è¡¨ act_hi_varinst é‡Œé¢çœ‹å¾—åˆ°å±€éƒ¨å˜é‡\n"},{"id":199,"href":"/zh/docs/study/Flowable/boge_blbl/02-advance_2/","title":"boge-02-flowableè¿›é˜¶_2","section":"åŸºç¡€(æ³¢å“¥)_","content":" ServiceæœåŠ¡æ¥å£ # å„ä¸ªServiceç±» RepositoryService èµ„æºç®¡ç†ç±»ï¼Œæµç¨‹å®šä¹‰ã€éƒ¨ç½²ã€æ–‡ä»¶ RuntimeService æµç¨‹è¿è¡Œç®¡ç†ç±»ï¼Œè¿è¡Œè¿‡ç¨‹ä¸­ï¼ˆæ‰§è¡Œï¼‰ TaskService ä»»åŠ¡ç®¡ç†ç±» HistoryService å†å²ç®¡ç†ç±» ManagerService å¼•æ“ç®¡ç†ç±» Flowableå›¾æ ‡ # BPMN2.0å®šä¹‰çš„ä¸€äº›å›¾æ ‡\næ—¶é—´ æ´»åŠ¨ ç½‘å…³ æµç¨‹éƒ¨ç½²æ·±å…¥è§£æ # ä½¿ç”¨eclipseæ‰“åŒ…éƒ¨ç½²(æ²¡æœ‰eclipseç¯å¢ƒï¼Œæ‰€ä»¥è¿™é‡Œåªæœ‰æˆªå›¾) å°†ä¸¤ä¸ªæµç¨‹ï¼Œæ‰“åŒ…ä¸ºbaræ–‡ä»¶ï¼Œç„¶åæ”¾åˆ°é¡¹ç›®resourcesæ–‡ä»¶å¤¹ä¸­ è¿™é‡Œæ˜¯ä¸ºäº†æµ‹è¯•ä¸€æ¬¡éƒ¨ç½²å¤šä¸ªæµç¨‹ï¼ˆå®šä¹‰ï¼Œå›¾ï¼‰ ä»£ç å¦‚ä¸‹ éƒ¨ç½²å®ŒæˆåæŸ¥çœ‹è¡¨ç»“æ„\nact_re_procdef\néƒ¨ç½²idä¸€æ · act_re_deployment ç»“è®ºï¼šéƒ¨ç½²å’Œå®šä¹‰æ˜¯1å¯¹å¤šçš„å…³ç³»\næ¯æ¬¡éƒ¨ç½²æ‰€æ¶‰åŠåˆ°çš„èµ„æºæ–‡ä»¶ æ¶‰åŠåˆ°çš„ä¸‰å¼ è¡¨\nact_ge_bytearray act_re_procdef category\u0026ndash;\u0026gt;xmlä¸­çš„namespace name\u0026ndash;\u0026gt;å®šä¹‰æ—¶èµ·çš„åç§° key_\u0026mdash;\u0026gt;xmlä¸­å®šä¹‰çš„id resource_name\u0026mdash;\u0026gt;xmlæ–‡ä»¶åç§° dgrm_resource_name\u0026ndash;\u0026gt;ç”Ÿæˆå›¾ç‰‡åç§° suspension_state \u0026ndash;\u0026gt; æ˜¯å¦è¢«æŒ‚èµ·\ntenant_id \u0026ndash; \u0026gt;è°éƒ¨ç½²çš„æµç¨‹\nact_re_deployment name_éƒ¨ç½²å\nä»£ç  ä¸»è¦æºç  DeployCmd.class DeploymentEntityManagerImpl.java insert()æ–¹æ³• æ’å…¥å¹¶æ‰§è¡Œèµ„æº ç‚¹å¼€é‡Œé¢çš„insertæ–¹æ³• AbstractDataManger.insert() å›åˆ°testç±»ï¼Œdeploy()æ–¹æ³•æœ€ç»ˆå°±æ˜¯å®Œæˆäº†è¡¨ç»“æ„çš„æ•°æ®çš„æ“ä½œï¼ˆé€šè¿‡Mybatisï¼‰\næµç¨‹çš„æŒ‚èµ·å’Œæ¿€æ´» # xmlæ–‡ä»¶\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;definitions xmlns=\u0026#34;http://www.omg.org/spec/BPMN/20100524/MODEL\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:xsd=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; xmlns:bpmndi=\u0026#34;http://www.omg.org/spec/BPMN/20100524/DI\u0026#34; xmlns:omgdc=\u0026#34;http://www.omg.org/spec/DD/20100524/DC\u0026#34; xmlns:omgdi=\u0026#34;http://www.omg.org/spec/DD/20100524/DI\u0026#34; xmlns:flowable=\u0026#34;http://flowable.org/bpmn\u0026#34; typeLanguage=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; expressionLanguage=\u0026#34;http://www.w3.org/1999/XPath\u0026#34; targetNamespace=\u0026#34;http://www.flowable.org/processdef\u0026#34;\u0026gt; \u0026lt;!--id process key--\u0026gt; \u0026lt;process id=\u0026#34;holidayRequest\u0026#34; name=\u0026#34;è¯·å‡æµç¨‹\u0026#34; isExecutable=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;startEvent id=\u0026#34;startEvent\u0026#34;/\u0026gt; \u0026lt;!--sequenceFlowè¡¨ç¤ºçš„æ˜¯çº¿æ¡ç®­å¤´--\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;startEvent\u0026#34; targetRef=\u0026#34;approveTask\u0026#34;/\u0026gt; \u0026lt;userTask id=\u0026#34;approveTask\u0026#34; name=\u0026#34;åŒæ„æˆ–è€…æ‹’ç»è¯·å‡\u0026#34; flowable:assignee=\u0026#34;zhangsan\u0026#34;/\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;approveTask\u0026#34; targetRef=\u0026#34;decision\u0026#34;/\u0026gt; \u0026lt;!--ç½‘å…³--\u0026gt; \u0026lt;exclusiveGateway id=\u0026#34;decision\u0026#34;/\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;decision\u0026#34; targetRef=\u0026#34;externalSystemCall\u0026#34;\u0026gt; \u0026lt;!--æ¡ä»¶--\u0026gt; \u0026lt;conditionExpression xsi:type=\u0026#34;tFormalExpression\u0026#34;\u0026gt; \u0026lt;![CDATA[ ${approved} ]]\u0026gt; \u0026lt;/conditionExpression\u0026gt; \u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;decision\u0026#34; targetRef=\u0026#34;sendRejectionMail\u0026#34;\u0026gt; \u0026lt;!--æ¡ä»¶--\u0026gt; \u0026lt;conditionExpression xsi:type=\u0026#34;tFormalExpression\u0026#34;\u0026gt; \u0026lt;![CDATA[ ${!approved} ]]\u0026gt; \u0026lt;/conditionExpression\u0026gt; \u0026lt;/sequenceFlow\u0026gt; \u0026lt;serviceTask id=\u0026#34;externalSystemCall\u0026#34; name=\u0026#34;Enter holidays in external system\u0026#34; flowable:class=\u0026#34;org.flowable.CallExternalSystemDelegate\u0026#34;/\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;externalSystemCall\u0026#34; targetRef=\u0026#34;holidayApprovedTask\u0026#34;/\u0026gt; \u0026lt;userTask id=\u0026#34;holidayApprovedTask\u0026#34; name=\u0026#34;Holiday approved\u0026#34; flowable:assignee=\u0026#34;lisi\u0026#34;/\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;holidayApprovedTask\u0026#34; targetRef=\u0026#34;approveEnd\u0026#34;/\u0026gt; \u0026lt;!--å‘é€ä¸€ä¸ªé‚®ä»¶--\u0026gt; \u0026lt;serviceTask id=\u0026#34;sendRejectionMail\u0026#34; name=\u0026#34;Send out rejection email\u0026#34; flowable:class=\u0026#34;org.flowable.SendRejectionMail\u0026#34;/\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;sendRejectionMail\u0026#34; targetRef=\u0026#34;rejectEnd\u0026#34;/\u0026gt; \u0026lt;endEvent id=\u0026#34;approveEnd\u0026#34;/\u0026gt; \u0026lt;endEvent id=\u0026#34;rejectEnd\u0026#34;/\u0026gt; \u0026lt;/process\u0026gt; \u0026lt;/definitions\u0026gt; éƒ¨ç½²çš„æµç¨‹é»˜è®¤æƒ…å†µä¸‹ä¸ºæ¿€æ´»ï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨è¯¥å®šä¹‰çš„æµç¨‹ï¼Œé‚£ä¹ˆå¯ä»¥æŒ‚èµ·è¯¥æµç¨‹ï¼Œå½“ç„¶è¯¥æµç¨‹å®šä¹‰ä¸‹è¾¹æ‰€æœ‰çš„æµç¨‹å®ä¾‹å…¨éƒ¨æš‚åœã€‚\næµç¨‹å®šä¹‰è¢«å®šä¹‰ä¸ºæŒ‚èµ·ï¼Œè¯¥æµç¨‹å®šä¹‰å°†ä¸å…è®¸å¯åŠ¨æ–°çš„æµç¨‹å®ä¾‹ï¼Œä¸”è¯¥æµç¨‹å®šä¹‰ä¸‹æ‰€æœ‰çš„æµç¨‹å®ä¾‹å°†è¢«å…¨éƒ¨æŒ‚èµ·æš‚åœæ‰§è¡Œ\nè¡¨ç»“æ„ act_re_procdefè¡¨ä¸­çš„SUSPENSION_STATEå­—æ®µæ¥è¡¨ç¤º1æ¿€æ´»ï¼Œ2æŒ‚èµ·\næŒ‚èµ·æµç¨‹\n@Test public void testSuspend() { ProcessEngine engine = ProcessEngines.getDefaultProcessEngine(); RepositoryService repositoryService = engine.getRepositoryService(); //æ‰¾åˆ°æµç¨‹å®šä¹‰ ProcessDefinition processDefinition = repositoryService. createProcessDefinitionQuery().processDefinitionId(\u0026#34;holidayRequest:1:7503\u0026#34;) .singleResult(); //å½“å‰æµç¨‹å®šä¹‰çš„çŠ¶æ€ boolean suspended = processDefinition.isSuspended(); if (suspended) { //å¦‚æœæŒ‚èµ·åˆ™æ¿€æ´» System.out.println(\u0026#34;æ¿€æ´»æµç¨‹(å®šä¹‰)\u0026#34; + processDefinition.getId() + \u0026#34;name:\u0026#34; + processDefinition .getName()); repositoryService.activateProcessDefinitionById(processDefinition.getId()); } else { //å¦‚æœæ¿€æ´»åˆ™æŒ‚èµ· System.out.println(\u0026#34;æŒ‚èµ·æµç¨‹(å®šä¹‰)\u0026#34; + processDefinition.getId() + \u0026#34;name:\u0026#34; + processDefinition .getName()); repositoryService.suspendProcessDefinitionById(processDefinition.getId()); } } æ‰§è¡Œå å¦‚æœè¿™æ—¶å¯åŠ¨æµç¨‹\n/** * æµç¨‹è¿è¡Œ */ @Test public void testRunProcess() { ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();//configuration.buildProcessEngine(); RuntimeService runtimeService = processEngine.getRuntimeService(); //è¿™è¾¹æ¨¡æ‹Ÿè¡¨å•æ•°æ®(è¡¨å•æ•°æ®æœ‰å¤šç§å¤„ç†æ–¹å¼ï¼Œè¿™åªæ˜¯å…¶ä¸­ä¸€ç§) Map\u0026lt;String, Object\u0026gt; map = new HashMap\u0026lt;\u0026gt;(); map.put(\u0026#34;employee\u0026#34;, \u0026#34;å¼ ä¸‰\u0026#34;); map.put(\u0026#34;nrOfHolidays\u0026#34;, 3); map.put(\u0026#34;description\u0026#34;, \u0026#34;å·¥ä½œç´¯äº†æƒ³å‡ºå»ç©\u0026#34;); ProcessInstance holidayRequest = runtimeService.startProcessInstanceByKey( \u0026#34;holidayRequest\u0026#34;, map); System.out.println(\u0026#34;æµç¨‹å®šä¹‰çš„id:\u0026#34; + holidayRequest.getProcessDefinitionId()); System.out.println(\u0026#34;å½“å‰æ´»è·ƒid:\u0026#34; + holidayRequest.getActivityId()); System.out.println(\u0026#34;æµç¨‹è¿è¡Œid:\u0026#34; + holidayRequest.getId()); } åˆ™ä¼šå‡ºç°å¼‚å¸¸æŠ¥é”™ä¿¡æ¯\norg.flowable.common.engine.api.FlowableException: Cannot start process instance. Process definition è¯·å‡æµç¨‹ (id = holidayRequest:1:7503) is suspended æ­¤æ—¶å†è¿è¡Œä¸€æ¬¡testSuspend()ï¼Œå°†æµç¨‹å®šä¹‰æ¿€æ´»ï¼Œæ­¤æ—¶æ•°æ®åº“act_re_procdefè¡¨ä¸­çš„SUSPENSION_STATEå­—æ®µå€¼ä¸º1 å†è¿è¡ŒtestRunProcess()ï¼Œæµç¨‹æ­£å¸¸å¯åŠ¨ å¯åŠ¨æµç¨‹çš„åŸç† # æµç¨‹å¯åŠ¨\n/** * æµç¨‹è¿è¡Œ */ @Test public void testRunProcess() { ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();//configuration.buildProcessEngine(); RepositoryService repositoryService = processEngine.getRepositoryService(); Deployment deploy = repositoryService.createDeployment() .addClasspathResource(\u0026#34;holiday-request.bpmn20.xml\u0026#34;) .name(\u0026#34;ly05150817éƒ¨ç½²çš„è¯·å‡æµç¨‹\u0026#34;) .deploy(); //é€šè¿‡éƒ¨ç½²idæŸ¥æ‰¾æµç¨‹å®šä¹‰ ProcessDefinition processDefinition = repositoryService.createProcessDefinitionQuery(). deploymentId(deploy.getId()) .singleResult(); RuntimeService runtimeService = processEngine.getRuntimeService(); //è¿™è¾¹æ¨¡æ‹Ÿè¡¨å•æ•°æ®(è¡¨å•æ•°æ®æœ‰å¤šç§å¤„ç†æ–¹å¼ï¼Œè¿™åªæ˜¯å…¶ä¸­ä¸€ç§) Map\u0026lt;String, Object\u0026gt; map = new HashMap\u0026lt;\u0026gt;(); map.put(\u0026#34;employee\u0026#34;, \u0026#34;å¼ ä¸‰\u0026#34;); map.put(\u0026#34;nrOfHolidays\u0026#34;, 3); map.put(\u0026#34;description\u0026#34;, \u0026#34;å·¥ä½œç´¯äº†æƒ³å‡ºå»ç©\u0026#34;); ProcessInstance holidayRequest = runtimeService.startProcessInstanceById( processDefinition.getId(), \u0026#34;order1000\u0026#34;, map); System.out.println(\u0026#34;æµç¨‹å®šä¹‰çš„id:\u0026#34; + holidayRequest.getProcessDefinitionId()); System.out.println(\u0026#34;å½“å‰æ´»è·ƒid:\u0026#34; + holidayRequest.getActivityId()); System.out.println(\u0026#34;æµç¨‹è¿è¡Œid:\u0026#34; + holidayRequest.getId()); } æ¶‰åŠåˆ°çš„è¡¨ï¼š(HIä¸­ä¹Ÿæœ‰å¯¹åº”çš„è¡¨)\nACT_RU_EXECUTION è¿è¡Œæ—¶æµç¨‹æ‰§è¡Œå®ä¾‹ å½“å¯åŠ¨ä¸€ä¸ªå®ä¾‹çš„æ—¶å€™ï¼Œè¿™é‡Œä¼šæœ‰ä¸¤ä¸ªæµç¨‹æ‰§è¡Œ\nACT_RU_IDENTITYLINK è¿è¡Œæ—¶ç”¨æˆ·å…³ç³»ä¿¡æ¯\nè®°å½•æµç¨‹å®ä¾‹å½“å‰æ‰€å¤„çš„èŠ‚ç‚¹\næ•°æ®åº“è¡¨ æœ‰å‡ ç§ä»»åŠ¡å¤„ç†äººçš„ç±»å‹\npublic class IdentityLinkType { public static final String ASSIGNEE = \u0026#34;assignee\u0026#34;; //æŒ‡æ´¾ public static final String CANDIDATE = \u0026#34;candidate\u0026#34;;//å€™é€‰ public static final String OWNER = \u0026#34;owner\u0026#34;;//æ‹¥æœ‰è€… public static final String STARTER = \u0026#34;starter\u0026#34;;//å¯åŠ¨è€… public static final String PARTICIPANT = \u0026#34;participant\u0026#34;;//å‚ä¸è€… public static final String REACTIVATOR = \u0026#34;reactivator\u0026#34;; } ACT_RU_TASK è¿è¡Œæ—¶ä»»åŠ¡è¡¨ ACT_RU_VARIABLE è¿è¡Œæ—¶å˜é‡è¡¨\nå¤„ç†æµç¨‹çš„åŸç† # æµç¨‹å¤„ç†\n@Test public void testCompleted(){ ProcessEngine processEngine=ProcessEngines.getDefaultProcessEngine(); TaskService taskService = processEngine.getTaskService(); Task task = taskService.createTaskQuery() .processInstanceId(\u0026#34;4\u0026#34;) .taskAssignee(\u0026#34;zhangsan\u0026#34;) .singleResult(); //è·å–å½“å‰æµç¨‹å®ä¾‹ç»‘å®šçš„æµç¨‹å˜é‡ Map\u0026lt;String, Object\u0026gt; processVariables = task.getProcessVariables(); Set\u0026lt;String\u0026gt; keySet = processVariables.keySet(); for(String key:keySet){ Object o = processVariables.get(key); System.out.println(\u0026#34;key:\u0026#34;+key+\u0026#34;--value:\u0026#34;+o); } processVariables.put(\u0026#34;approved\u0026#34;,true);//åŒæ„ processVariables.put(\u0026#34;description\u0026#34;,\u0026#34;æˆ‘è¢«ä¿®æ”¹äº†\u0026#34;); taskService.complete(task.getId(),processVariables); } è¿™é‡Œç”¨çš„æ˜¯ä¹‹å‰çš„xmlï¼Œæ‰€ä»¥åº”è¯¥ç»™ä¸€ä¸ªæœåŠ¡ç›‘å¬ç±»\npublic class CallExternalSystemDelegate implements JavaDelegate { @Override public void execute(DelegateExecution execution) { System.out.println(\u0026#34;æ‚¨çš„è¯·æ±‚é€šè¿‡äº†ï¼\u0026#34;); } } ä»»åŠ¡å¤„ç†åï¼Œè¿™é‡Œæ·»åŠ äº†ä¸€ä¸ªå˜é‡ï¼Œä¸”ä¿®æ”¹äº†å˜é‡description å¯ä»¥é€šè¿‡æµç¨‹å˜é‡ï¼Œå®ƒå¯ä»¥åœ¨æ•´ä¸ªæµç¨‹è¿‡ç¨‹ä¸­æµè½¬çš„[æ³¨æ„ï¼Œè¿™é‡Œæµç¨‹ç»“æŸåæµç¨‹å˜é‡ä¼šä¸å­˜åœ¨çš„ï¼Œä½†æ˜¯act_hi_variinsté‡Œé¢å¯ä»¥çœ‹åˆ°æµç¨‹å˜é‡å®ä¾‹] //æˆ‘æ„Ÿè§‰åº”è¯¥ç”¨è¡¨å•æ›¿ä»£ act_ru_taskå’Œact_ru_identitylink\nä¸¤è€…åŒºåˆ« ACT _ RU _ IDENTITYLINKï¼šæ­¤è¡¨å­˜å‚¨æœ‰å…³ç”¨æˆ·æˆ–ç»„çš„æ•°æ®åŠå…¶ä¸ï¼ˆæµç¨‹/æ¡ˆä¾‹/ç­‰ï¼‰å®ä¾‹ç›¸å…³çš„è§’è‰²ã€‚è¯¥è¡¨ä¹Ÿè¢«å…¶ä»–éœ€è¦èº«ä»½é“¾æ¥çš„å¼•æ“ä½¿ç”¨ã€‚ã€æ˜¾ç¤ºå…¨éƒ¨ï¼ŒåŒ…æ‹¬å·²å®Œæˆã€‘ ACT _ RU _ TASKï¼šæ­¤è¡¨åŒ…å«ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®ä¾‹çš„æ¯ä¸ªæœªå®Œæˆç”¨æˆ·ä»»åŠ¡çš„æ¡ç›®ã€‚ç„¶ååœ¨æŸ¥è¯¢ç”¨æˆ·çš„ä»»åŠ¡åˆ—è¡¨æ—¶ä½¿ç”¨æ­¤è¡¨ã€‚ã€è¿™é‡Œåªæ˜¾ç¤ºè¿è¡Œä¸­ã€‘ act_ru_task è®°å½•å½“å‰å®ä¾‹æ‰€è¿è¡Œçš„å½“å‰èŠ‚ç‚¹çš„ä¿¡æ¯ act_ru_identitylink act_ru_executionè¿™ä¸ªè¡¨çš„æ•°æ®ä¸ä¼šæœ‰å˜åŠ¨ æµç¨‹ç»“æŸçš„åŸç† # æµç¨‹èµ°å®Œ\n@Test public void testCompleted1() { ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine(); TaskService taskService = processEngine.getTaskService(); Task task = taskService.createTaskQuery() .processInstanceId(\u0026#34;4\u0026#34;) .taskAssignee(\u0026#34;lisi\u0026#34;) .singleResult(); //è·å–å½“å‰æµç¨‹å®ä¾‹ç»‘å®šçš„æµç¨‹å˜é‡ Map\u0026lt;String, Object\u0026gt; processVariables = task.getProcessVariables(); Set\u0026lt;String\u0026gt; keySet = processVariables.keySet(); for (String key : keySet) { Object o = processVariables.get(key); System.out.println(\u0026#34;key:\u0026#34; + key + \u0026#34;--value:\u0026#34; + o); } /* processVariables.put(\u0026#34;approved\u0026#34;,true);//æ‹’ç» processVariables.put(\u0026#34;description\u0026#34;,\u0026#34;æˆ‘è¢«ä¿®æ”¹äº†\u0026#34;);*/ taskService.complete(task.getId(), processVariables); } æ­¤æ—¶è·Ÿæµç¨‹ç›¸å…³çš„æ•°æ®éƒ½ä¼šè¢«æ¸…ç©ºæ‰ å†å²æ•°æ®\nå˜é‡ ä»»åŠ¡æµè½¬å†å² æµç¨‹å®ä¾‹ æ¶‰åŠåˆ°çš„ç”¨æˆ· æµç¨‹æ´»åŠ¨\n"},{"id":200,"href":"/zh/docs/problem/Idea/01/","title":"é—®é¢˜01","section":"Idea","content":" Cannot download sources # åœ¨mavené¡¹ç›®(æ ¹ç›®å½•)ä¸‹æ‰§è¡Œ\nmvn dependency:resolve -Dclassifier=sources ä¼šå¼€å§‹ä¸‹è½½ï¼Œæœ‰æ§åˆ¶å°è¾“å‡ºï¼Œç»“æŸåå†ç‚¹å³å¯\né¢„ç•™ # "},{"id":201,"href":"/zh/docs/study/Flowable/boge_blbl/02-advance_1/","title":"boge-02-flowableè¿›é˜¶_1","section":"åŸºç¡€(æ³¢å“¥)_","content":" è¡¨ç»“æ„ # å°½é‡é€šè¿‡APIåŠ¨æ•°æ®\nACT_REï¼šrepositoryï¼ŒåŒ…å«æµç¨‹å®šä¹‰å’Œæµç¨‹é™æ€èµ„æº\nACT_RU: runtimeï¼ŒåŒ…å«æµç¨‹å®ä¾‹ã€ä»»åŠ¡ã€å˜é‡ç­‰ï¼Œæµç¨‹ç»“æŸä¼šåˆ é™¤\nACT_HI: historyï¼ŒåŒ…å«å†å²æ•°æ®ï¼Œæ¯”å¦‚å†å²æµç¨‹å®ä¾‹ã€å˜é‡ã€ä»»åŠ¡ç­‰\nACT_GE: generalï¼Œé€šç”¨æ•°æ®\nACT_ID: identityï¼Œç»„ç»‡æœºæ„ã€‚åŒ…å«æ ‡è¯†çš„ä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·ã€ç”¨æˆ·ç»„ç­‰ç­‰\nå…·ä½“çš„\næµç¨‹å†å²è®°å½•\næµç¨‹å®šä¹‰è¡¨ è¿è¡Œå®ä¾‹è¡¨ ç”¨æˆ·ç”¨æˆ·ç»„è¡¨\næºç ä¸­çš„ä½“ç° é»˜è®¤çš„é…ç½®æ–‡ä»¶åŠ è½½ # å¯¹äº\nProcessEngine defaultProcessEngine = ProcessEngines.getDefaultProcessEngine(); //--\u0026gt; public static ProcessEngine getDefaultProcessEngine() { return getProcessEngine(NAME_DEFAULT); //NAME_DEFAULT = \u0026#34;default\u0026#34; } //--\u0026gt; public static ProcessEngine getProcessEngine(String processEngineName) { if (!isInitialized()) { init(); } return processEngines.get(processEngineName); } //--\u0026gt;éƒ¨åˆ† /** * Initializes all process engines that can be found on the classpath for resources \u0026lt;code\u0026gt;flowable.cfg.xml\u0026lt;/code\u0026gt; (plain Flowable style configuration) and for resources * \u0026lt;code\u0026gt;flowable-context.xml\u0026lt;/code\u0026gt; (Spring style configuration). */ public static synchronized void init() { if (!isInitialized()) { if (processEngines == null) { // Create new map to store process-engines if current map is null processEngines = new HashMap\u0026lt;\u0026gt;(); } ClassLoader classLoader = ReflectUtil.getClassLoader(); Enumeration\u0026lt;URL\u0026gt; resources = null; try { resources = classLoader.getResources(\u0026#34;flowable.cfg.xml\u0026#34;); } catch (IOException e) { throw new FlowableIllegalArgumentException(\u0026#34;problem retrieving flowable.cfg.xml resources on the classpath: \u0026#34; + System.getProperty(\u0026#34;java.class.path\u0026#34;), e); } //åé¢è¿˜æœ‰ï¼Œæ¯å¸–å‡ºæ¥ } } æ³¨æ„è¿™è¡ŒclassLoader.getResources(\u0026quot;flowable.cfg.xml\u0026quot;); éœ€è¦åœ¨resourcesæ ¹ç›®å½•ä¸‹æ”¾è¿™ä¹ˆä¸€ä¸ªæ–‡ä»¶\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;beans xmlns=\u0026#34;http://www.springframework.org/schema/beans\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\u0026#34;\u0026gt; \u0026lt;bean id=\u0026#34;processEngineConfiguration\u0026#34; class=\u0026#34;org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;jdbcUrl\u0026#34; value=\u0026#34;jdbc:mysql://localhost:3306/flow1?useUnicode=true\u0026amp;amp;characterEncoding=utf-8\u0026amp;amp;allowMultiQueries=true\u0026amp;amp;nullCatalogMeansCurrent=true\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;jdbcDriver\u0026#34; value=\u0026#34;com.mysql.cj.jdbc.Driver\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;jdbcUsername\u0026#34; value=\u0026#34;root\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;jdbcPassword\u0026#34; value=\u0026#34;123456\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;databaseSchemaUpdate\u0026#34; value=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;!--å¼‚æ­¥æ‰§è¡Œå™¨--\u0026gt; \u0026lt;property name=\u0026#34;asyncExecutorActivate\u0026#34; value=\u0026#34;false\u0026#34;/\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;/beans\u0026gt; æ–°å»ºæ•°æ®åº“flow1ï¼Œè¿è¡Œæµ‹è¯•ä»£ç \n@Test public void processEngine2(){ ProcessEngine defaultProcessEngine = ProcessEngines.getDefaultProcessEngine(); System.out.println(defaultProcessEngine); } æ­¤æ—¶æ•°æ®åº“å·²ç»æœ‰è¡¨\nåŠ è½½è‡ªå®šä¹‰åç§°çš„é…ç½®æ–‡ä»¶ # æŠŠåˆšæ‰çš„æ•°æ®åº“æ¸…ç©ºï¼Œå°†flowableçš„é…ç½®æ–‡ä»¶æ”¾åˆ°ç›®å½•custom/lycfg.xmlä¸­ ä»£ç \n@Test public void processEngine03(){ ProcessEngineConfiguration configuration = ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(\u0026#34;custom/lycfg.xml\u0026#34;); System.out.println(configuration); ProcessEngine processEngine = configuration.buildProcessEngine(); System.out.println(processEngine); } ProcessEngineæºç æŸ¥çœ‹ # æºç è¿½æº¯\nconfiguration.buildProcessEngine() //---\u0026gt;ProcessEngineConfigurationImpl.class @Override public ProcessEngine buildProcessEngine() { init(); ProcessEngineImpl processEngine = new ProcessEngineImpl(this); //... } //----\u0026gt;ProcessEngineImpl.class public class ProcessEngineImpl implements ProcessEngine { private static final Logger LOGGER = LoggerFactory.getLogger(ProcessEngineImpl.class); protected String name; protected RepositoryService repositoryService; protected RuntimeService runtimeService; protected HistoryService historicDataService; protected IdentityService identityService; protected TaskService taskService; protected FormService formService; protected ManagementService managementService; protected DynamicBpmnService dynamicBpmnService; protected ProcessMigrationService processInstanceMigrationService; protected AsyncExecutor asyncExecutor; protected AsyncExecutor asyncHistoryExecutor; protected CommandExecutor commandExecutor; protected Map\u0026lt;Class\u0026lt;?\u0026gt;, SessionFactory\u0026gt; sessionFactories; protected TransactionContextFactory transactionContextFactory; protected ProcessEngineConfigurationImpl processEngineConfiguration; //è¿™é‡Œé€šè¿‡ProcessEngineConfigurationImplè·å–å„ç§å¯¹è±¡ public ProcessEngineImpl(ProcessEngineConfigurationImpl processEngineConfiguration) { this.processEngineConfiguration = processEngineConfiguration; this.name = processEngineConfiguration.getEngineName(); this.repositoryService = processEngineConfiguration.getRepositoryService(); this.runtimeService = processEngineConfiguration.getRuntimeService(); this.historicDataService = processEngineConfiguration.getHistoryService(); this.identityService = processEngineConfiguration.getIdentityService(); this.taskService = processEngineConfiguration.getTaskService(); this.formService = processEngineConfiguration.getFormService(); this.managementService = processEngineConfiguration.getManagementService(); this.dynamicBpmnService = processEngineConfiguration.getDynamicBpmnService(); this.processInstanceMigrationService = processEngineConfiguration.getProcessMigrationService(); this.asyncExecutor = processEngineConfiguration.getAsyncExecutor(); this.asyncHistoryExecutor = processEngineConfiguration.getAsyncHistoryExecutor(); this.commandExecutor = processEngineConfiguration.getCommandExecutor(); this.sessionFactories = processEngineConfiguration.getSessionFactories(); this.transactionContextFactory = processEngineConfiguration.getTransactionContextFactory(); } //... } //----\u0026gt;ProcessEngine.class è·å–å„ä¸ªserviceæœåŠ¡ public interface ProcessEngine extends Engine { /** the version of the flowable library */ String VERSION = FlowableVersions.CURRENT_VERSION; /** * Starts the execuctors (async and async history), if they are configured to be auto-activated. */ void startExecutors(); RepositoryService getRepositoryService(); RuntimeService getRuntimeService(); FormService getFormService(); TaskService getTaskService(); HistoryService getHistoryService(); IdentityService getIdentityService(); ManagementService getManagementService(); DynamicBpmnService getDynamicBpmnService(); ProcessMigrationService getProcessMigrationService(); ProcessEngineConfiguration getProcessEngineConfiguration(); } ProcessEngineConfigurationä¸­çš„initæ–¹æ³• # æºç è¿½æº¯\nconfiguration.buildProcessEngine() //---\u0026gt;ProcessEngineConfigurationImpl.class @Override public ProcessEngine buildProcessEngine() { init(); ProcessEngineImpl processEngine = new ProcessEngineImpl(this); //... } //---\u0026gt;ProcessEngineConfigurationImpl.init(); public void init() { initEngineConfigurations(); initConfigurators(); configuratorsBeforeInit(); initClock(); initObjectMapper(); initProcessDiagramGenerator(); initCommandContextFactory(); initTransactionContextFactory(); initCommandExecutors(); initIdGenerator(); initHistoryLevel(); initFunctionDelegates(); initAstFunctionCreators(); initDelegateInterceptor(); initBeans(); initExpressionManager(); initAgendaFactory(); //å…³ç³»å‹æ•°æ®åº“ if (usingRelationalDatabase) { initDataSource();//ä¸‹é¢æ‹¿è¿™ä¸ªä¸¾ä¾‹1 } else { initNonRelationalDataSource(); } if (usingRelationalDatabase || usingSchemaMgmt) { initSchemaManager(); initSchemaManagementCommand(); } configureVariableServiceConfiguration(); configureJobServiceConfiguration(); initHelpers(); initVariableTypes(); initFormEngines(); initFormTypes(); initScriptingEngines(); initBusinessCalendarManager(); initServices(); initWsdlImporterFactory(); initBehaviorFactory(); initListenerFactory(); initBpmnParser(); initProcessDefinitionCache(); initProcessDefinitionInfoCache(); initAppResourceCache(); initKnowledgeBaseCache(); initJobHandlers(); initHistoryJobHandlers(); initTransactionFactory(); if (usingRelationalDatabase) { initSqlSessionFactory();//ä¸‹é¢æ‹¿è¿™ä¸ªä¸¾ä¾‹2 } initSessionFactories(); //ç›¸å…³è¡¨ç»“æ„æ“ä½œ initDataManagers(); //ä¸‹é¢æ‹¿è¿™ä¸ªä¸¾ä¾‹2 initEntityManagers(); initCandidateManager(); initVariableAggregator(); initHistoryManager(); initChangeTenantIdManager(); initDynamicStateManager(); initProcessInstanceMigrationValidationManager(); initIdentityLinkInterceptor(); initJpa(); initDeployers(); initEventHandlers(); initFailedJobCommandFactory(); initEventDispatcher(); initProcessValidator(); initFormFieldHandler(); initDatabaseEventLogging(); initFlowable5CompatibilityHandler(); initVariableServiceConfiguration(); //æµç¨‹å˜é‡ initIdentityLinkServiceConfiguration(); initEntityLinkServiceConfiguration(); initEventSubscriptionServiceConfiguration(); initTaskServiceConfiguration(); initJobServiceConfiguration(); initBatchServiceConfiguration(); initAsyncExecutor(); initAsyncHistoryExecutor(); configuratorsAfterInit(); afterInitTaskServiceConfiguration(); afterInitEventRegistryEventBusConsumer(); initHistoryCleaningManager(); initLocalizationManagers(); } //---\u0026gt;AbstractEngineConfiguration //----\u0026gt;AbstractEngineConfiguration.initDataSrouce() public static Properties getDefaultDatabaseTypeMappings() { Properties databaseTypeMappings = new Properties(); databaseTypeMappings.setProperty(\u0026#34;H2\u0026#34;, DATABASE_TYPE_H2); databaseTypeMappings.setProperty(\u0026#34;HSQL Database Engine\u0026#34;, DATABASE_TYPE_HSQL); databaseTypeMappings.setProperty(\u0026#34;MySQL\u0026#34;, DATABASE_TYPE_MYSQL); databaseTypeMappings.setProperty(\u0026#34;MariaDB\u0026#34;, DATABASE_TYPE_MYSQL); databaseTypeMappings.setProperty(\u0026#34;Oracle\u0026#34;, DATABASE_TYPE_ORACLE); databaseTypeMappings.setProperty(PRODUCT_NAME_POSTGRES, DATABASE_TYPE_POSTGRES); databaseTypeMappings.setProperty(\u0026#34;Microsoft SQL Server\u0026#34;, DATABASE_TYPE_MSSQL); databaseTypeMappings.setProperty(DATABASE_TYPE_DB2, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2/NT\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2/NT64\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2 UDP\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2/LINUX\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2/LINUX390\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2/LINUXX8664\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2/LINUXZ64\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2/LINUXPPC64\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2/LINUXPPC64LE\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2/400 SQL\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2/6000\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2 UDB iSeries\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2/AIX64\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2/HPUX\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2/HP64\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2/SUN\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2/SUN64\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2/PTX\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2/2\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(\u0026#34;DB2 UDB AS400\u0026#34;, DATABASE_TYPE_DB2); databaseTypeMappings.setProperty(PRODUCT_NAME_CRDB, DATABASE_TYPE_COCKROACHDB); return databaseTypeMappings; } //initDataSource(); protected void initDataSource() { if (dataSource == null) { if (dataSourceJndiName != null) { try { dataSource = (DataSource) new InitialContext().lookup(dataSourceJndiName); } catch (Exception e) { throw new FlowableException(\u0026#34;couldn\u0026#39;t lookup datasource from \u0026#34; + dataSourceJndiName + \u0026#34;: \u0026#34; + e.getMessage(), e); } } else if (jdbcUrl != null) { if ((jdbcDriver == null) || (jdbcUsername == null)) { throw new FlowableException(\u0026#34;DataSource or JDBC properties have to be specified in a process engine configuration\u0026#34;); } logger.debug(\u0026#34;initializing datasource to db: {}\u0026#34;, jdbcUrl); if (logger.isInfoEnabled()) { logger.info(\u0026#34;Configuring Datasource with following properties (omitted password for security)\u0026#34;); logger.info(\u0026#34;datasource driver : {}\u0026#34;, jdbcDriver); logger.info(\u0026#34;datasource url : {}\u0026#34;, jdbcUrl); logger.info(\u0026#34;datasource user name : {}\u0026#34;, jdbcUsername); } PooledDataSource pooledDataSource = new PooledDataSource(this.getClass().getClassLoader(), jdbcDriver, jdbcUrl, jdbcUsername, jdbcPassword); if (jdbcMaxActiveConnections \u0026gt; 0) { pooledDataSource.setPoolMaximumActiveConnections(jdbcMaxActiveConnections); } if (jdbcMaxIdleConnections \u0026gt; 0) { pooledDataSource.setPoolMaximumIdleConnections(jdbcMaxIdleConnections); } if (jdbcMaxCheckoutTime \u0026gt; 0) { pooledDataSource.setPoolMaximumCheckoutTime(jdbcMaxCheckoutTime); } if (jdbcMaxWaitTime \u0026gt; 0) { pooledDataSource.setPoolTimeToWait(jdbcMaxWaitTime); } if (jdbcPingEnabled) { pooledDataSource.setPoolPingEnabled(true); if (jdbcPingQuery != null) { pooledDataSource.setPoolPingQuery(jdbcPingQuery); } pooledDataSource.setPoolPingConnectionsNotUsedFor(jdbcPingConnectionNotUsedFor); } if (jdbcDefaultTransactionIsolationLevel \u0026gt; 0) { pooledDataSource.setDefaultTransactionIsolationLevel(jdbcDefaultTransactionIsolationLevel); } dataSource = pooledDataSource; } } if (databaseType == null) { initDatabaseType(); } } //initSqlSessionFactory(); public void initSqlSessionFactory() { if (sqlSessionFactory == null) { InputStream inputStream = null; try { //è·å–MyBatisé…ç½®æ–‡ä»¶ä¿¡æ¯ inputStream = getMyBatisXmlConfigurationStream(); Environment environment = new Environment(\u0026#34;default\u0026#34;, transactionFactory, dataSource); Reader reader = new InputStreamReader(inputStream); Properties properties = new Properties(); properties.put(\u0026#34;prefix\u0026#34;, databaseTablePrefix); String wildcardEscapeClause = \u0026#34;\u0026#34;; if ((databaseWildcardEscapeCharacter != null) \u0026amp;\u0026amp; (databaseWildcardEscapeCharacter.length() != 0)) { wildcardEscapeClause = \u0026#34; escape \u0026#39;\u0026#34; + databaseWildcardEscapeCharacter + \u0026#34;\u0026#39;\u0026#34;; } properties.put(\u0026#34;wildcardEscapeClause\u0026#34;, wildcardEscapeClause); // set default properties properties.put(\u0026#34;limitBefore\u0026#34;, \u0026#34;\u0026#34;); properties.put(\u0026#34;limitAfter\u0026#34;, \u0026#34;\u0026#34;); properties.put(\u0026#34;limitBetween\u0026#34;, \u0026#34;\u0026#34;); properties.put(\u0026#34;limitBeforeNativeQuery\u0026#34;, \u0026#34;\u0026#34;); properties.put(\u0026#34;limitAfterNativeQuery\u0026#34;, \u0026#34;\u0026#34;); properties.put(\u0026#34;blobType\u0026#34;, \u0026#34;BLOB\u0026#34;); properties.put(\u0026#34;boolValue\u0026#34;, \u0026#34;TRUE\u0026#34;); if (databaseType != null) { properties.load(getResourceAsStream(pathToEngineDbProperties())); } //Mybatisç›¸å…³çš„é…ç½® Configuration configuration = initMybatisConfiguration(environment, reader, properties); sqlSessionFactory = new DefaultSqlSessionFactory(configuration); } catch (Exception e) { throw new FlowableException(\u0026#34;Error while building ibatis SqlSessionFactory: \u0026#34; + e.getMessage(), e); } finally { IoUtil.closeSilently(inputStream); } } } //ProcessEngineConfigurationImpl.getMyBatisXmlConfigurationStream(); @Override public InputStream getMyBatisXmlConfigurationStream() { return getResourceAsStream(mybatisMappingFile); } //ä»£ç å¾€ä¸Šç¿» //æ„é€ å™¨ä¸­ public ProcessEngineConfigurationImpl() { mybatisMappingFile = DEFAULT_MYBATIS_MAPPING_FILE; } //å…¶ä¸­ public static final String DEFAULT_MYBATIS_MAPPING_FILE = \u0026#34;org/flowable/db/mapping/mappings.xml\u0026#34;; æŸ¥æ‰¾æ˜ å°„æ–‡ä»¶ mappings.xml\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE configuration PUBLIC \u0026#34;-//mybatis.org//DTD Config 3.0//EN\u0026#34; \u0026#34;http://mybatis.org/dtd/mybatis-3-config.dtd\u0026#34;\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;settings\u0026gt; \u0026lt;setting name=\u0026#34;lazyLoadingEnabled\u0026#34; value=\u0026#34;false\u0026#34; /\u0026gt; \u0026lt;/settings\u0026gt; \u0026lt;typeAliases\u0026gt; \u0026lt;typeAlias type=\u0026#34;org.flowable.common.engine.impl.persistence.entity.ByteArrayRefTypeHandler\u0026#34; alias=\u0026#34;ByteArrayRefTypeHandler\u0026#34; /\u0026gt; \u0026lt;typeAlias type=\u0026#34;org.flowable.common.engine.impl.persistence.entity.ByteArrayRefTypeHandler\u0026#34; alias=\u0026#34;VariableByteArrayRefTypeHandler\u0026#34; /\u0026gt; \u0026lt;typeAlias type=\u0026#34;org.flowable.common.engine.impl.persistence.entity.ByteArrayRefTypeHandler\u0026#34; alias=\u0026#34;JobByteArrayRefTypeHandler\u0026#34; /\u0026gt; \u0026lt;typeAlias type=\u0026#34;org.flowable.common.engine.impl.persistence.entity.ByteArrayRefTypeHandler\u0026#34; alias=\u0026#34;BatchByteArrayRefTypeHandler\u0026#34; /\u0026gt; \u0026lt;/typeAliases\u0026gt; \u0026lt;typeHandlers\u0026gt; \u0026lt;typeHandler handler=\u0026#34;ByteArrayRefTypeHandler\u0026#34; javaType=\u0026#34;org.flowable.common.engine.impl.persistence.entity.ByteArrayRef\u0026#34; jdbcType=\u0026#34;VARCHAR\u0026#34; /\u0026gt; \u0026lt;typeHandler handler=\u0026#34;VariableByteArrayRefTypeHandler\u0026#34; javaType=\u0026#34;org.flowable.common.engine.impl.persistence.entity.ByteArrayRef\u0026#34; jdbcType=\u0026#34;VARCHAR\u0026#34; /\u0026gt; \u0026lt;typeHandler handler=\u0026#34;JobByteArrayRefTypeHandler\u0026#34; javaType=\u0026#34;org.flowable.common.engine.impl.persistence.entity.ByteArrayRef\u0026#34; jdbcType=\u0026#34;VARCHAR\u0026#34; /\u0026gt; \u0026lt;typeHandler handler=\u0026#34;BatchByteArrayRefTypeHandler\u0026#34; javaType=\u0026#34;org.flowable.common.engine.impl.persistence.entity.ByteArrayRef\u0026#34; jdbcType=\u0026#34;VARCHAR\u0026#34; /\u0026gt; \u0026lt;/typeHandlers\u0026gt; \u0026lt;mappers\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/db/mapping/ChangeTenantBpmn.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/db/mapping/entity/Attachment.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/db/mapping/entity/Comment.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/job/service/db/mapping/entity/DeadLetterJob.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/db/mapping/entity/Deployment.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/db/mapping/entity/Execution.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/db/mapping/entity/ActivityInstance.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/db/mapping/entity/HistoricActivityInstance.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/db/mapping/entity/HistoricDetail.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/db/mapping/entity/HistoricProcessInstance.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/variable/service/db/mapping/entity/HistoricVariableInstance.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/task/service/db/mapping/entity/HistoricTaskInstance.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/task/service/db/mapping/entity/HistoricTaskLogEntry.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/identitylink/service/db/mapping/entity/HistoricIdentityLink.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/entitylink/service/db/mapping/entity/HistoricEntityLink.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/job/service/db/mapping/entity/HistoryJob.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/identitylink/service/db/mapping/entity/IdentityLink.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/entitylink/service/db/mapping/entity/EntityLink.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/job/service/db/mapping/entity/Job.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/db/mapping/entity/Model.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/db/mapping/entity/ProcessDefinition.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/db/mapping/entity/ProcessDefinitionInfo.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/common/db/mapping/entity/Property.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/common/db/mapping/entity/ByteArray.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/common/db/mapping/common.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/db/mapping/entity/Resource.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/job/service/db/mapping/entity/SuspendedJob.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/job/service/db/mapping/entity/ExternalWorkerJob.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/common/db/mapping/entity/TableData.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/task/service/db/mapping/entity/Task.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/job/service/db/mapping/entity/TimerJob.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/variable/service/db/mapping/entity/VariableInstance.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/eventsubscription/service/db/mapping/entity/EventSubscription.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/db/mapping/entity/EventLogEntry.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/batch/service/db/mapping/entity/Batch.xml\u0026#34; /\u0026gt; \u0026lt;mapper resource=\u0026#34;org/flowable/batch/service/db/mapping/entity/BatchPart.xml\u0026#34; /\u0026gt; \u0026lt;/mappers\u0026gt; \u0026lt;/configuration\u0026gt; æºç \n//ProcessEnginConfigurationImpl.init()ä¸­çš„ä»£ç  initDataManagers(); //ä¸‹é¢æ‹¿è¿™ä¸ªä¸¾ä¾‹3 //-\u0026gt;\u0026gt;\u0026gt; @Override @SuppressWarnings(\u0026#34;rawtypes\u0026#34;) public void initDataManagers() { super.initDataManagers(); if (attachmentDataManager == null) { attachmentDataManager = new MybatisAttachmentDataManager(this); } if (commentDataManager == null) { commentDataManager = new MybatisCommentDataManager(this); } if (deploymentDataManager == null) { //ä¸‹é¢æ‹¿è¿™ä¸ªæŸ¥çœ‹ deploymentDataManager = new MybatisDeploymentDataManager(this); } if (eventLogEntryDataManager == null) { eventLogEntryDataManager = new MybatisEventLogEntryDataManager(this); } if (executionDataManager == null) { executionDataManager = new MybatisExecutionDataManager(this); } if (dbSqlSessionFactory != null \u0026amp;\u0026amp; executionDataManager instanceof AbstractDataManager) { dbSqlSessionFactory.addLogicalEntityClassMapping(\u0026#34;execution\u0026#34;, ((AbstractDataManager) executionDataManager).getManagedEntityClass()); } if (historicActivityInstanceDataManager == null) { historicActivityInstanceDataManager = new MybatisHistoricActivityInstanceDataManager(this); } if (activityInstanceDataManager == null) { activityInstanceDataManager = new MybatisActivityInstanceDataManager(this); } if (historicDetailDataManager == null) { historicDetailDataManager = new MybatisHistoricDetailDataManager(this); } if (historicProcessInstanceDataManager == null) { historicProcessInstanceDataManager = new MybatisHistoricProcessInstanceDataManager(this); } if (modelDataManager == null) { modelDataManager = new MybatisModelDataManager(this); } if (processDefinitionDataManager == null) { processDefinitionDataManager = new MybatisProcessDefinitionDataManager(this); } if (processDefinitionInfoDataManager == null) { processDefinitionInfoDataManager = new MybatisProcessDefinitionInfoDataManager(this); } if (resourceDataManager == null) { resourceDataManager = new MybatisResourceDataManager(this); } } //--\u0026gt;MybatisDeploymentDataManagerï¼Œè¿™ä¸ªç±»ç›¸å½“äºmybatisä¸­çš„mapper /** * @author Joram Barrez */ public class MybatisDeploymentDataManager extends AbstractProcessDataManager\u0026lt;DeploymentEntity\u0026gt; implements DeploymentDataManager { public MybatisDeploymentDataManager(ProcessEngineConfigurationImpl processEngineConfiguration) { super(processEngineConfiguration); } @Override public Class\u0026lt;? extends DeploymentEntity\u0026gt; getManagedEntityClass() { return DeploymentEntityImpl.class; } @Override public DeploymentEntity create() { return new DeploymentEntityImpl(); } @Override public long findDeploymentCountByQueryCriteria(DeploymentQueryImpl deploymentQuery) { return (Long) getDbSqlSession().selectOne(\u0026#34;selectDeploymentCountByQueryCriteria\u0026#34;, deploymentQuery); } @Override @SuppressWarnings(\u0026#34;unchecked\u0026#34;) public List\u0026lt;Deployment\u0026gt; findDeploymentsByQueryCriteria(DeploymentQueryImpl deploymentQuery) { final String query = \u0026#34;selectDeploymentsByQueryCriteria\u0026#34;; return getDbSqlSession().selectList(query, deploymentQuery); } @Override public List\u0026lt;String\u0026gt; getDeploymentResourceNames(String deploymentId) { return getDbSqlSession().getSqlSession().selectList(\u0026#34;selectResourceNamesByDeploymentId\u0026#34;, deploymentId); } @Override @SuppressWarnings(\u0026#34;unchecked\u0026#34;) public List\u0026lt;Deployment\u0026gt; findDeploymentsByNativeQuery(Map\u0026lt;String, Object\u0026gt; parameterMap) { return getDbSqlSession().selectListWithRawParameter(\u0026#34;selectDeploymentByNativeQuery\u0026#34;, parameterMap); } @Override public long findDeploymentCountByNativeQuery(Map\u0026lt;String, Object\u0026gt; parameterMap) { return (Long) getDbSqlSession().selectOne(\u0026#34;selectDeploymentCountByNativeQuery\u0026#34;, parameterMap); } } ProcessEngineå„ç§æ–¹æ³•å¯¹æ¯” # ProcessEngines.getDefaultProcessEngine();çš„æ–¹å¼\n/** * Initializes all process engines that can be found on the classpath for resources \u0026lt;code\u0026gt;flowable.cfg.xml\u0026lt;/code\u0026gt; (plain Flowable style configuration) and for resources * \u0026lt;code\u0026gt;flowable-context.xml\u0026lt;/code\u0026gt; (Spring style configuration). */ public static synchronized void init() { if (!isInitialized()) { if (processEngines == null) { // Create new map to store process-engines if current map is null processEngines = new HashMap\u0026lt;\u0026gt;(); } ClassLoader classLoader = ReflectUtil.getClassLoader(); Enumeration\u0026lt;URL\u0026gt; resources = null; try { resources = classLoader.getResources(\u0026#34;flowable.cfg.xml\u0026#34;); } catch (IOException e) { throw new FlowableIllegalArgumentException(\u0026#34;problem retrieving flowable.cfg.xml resources on the classpath: \u0026#34; + System.getProperty(\u0026#34;java.class.path\u0026#34;), e); } // Remove duplicated configuration URL\u0026#39;s using set. Some // classloaders may return identical URL\u0026#39;s twice, causing duplicate // startups Set\u0026lt;URL\u0026gt; configUrls = new HashSet\u0026lt;\u0026gt;(); while (resources.hasMoreElements()) { configUrls.add(resources.nextElement()); } for (URL resource : configUrls) { LOGGER.info(\u0026#34;Initializing process engine using configuration \u0026#39;{}\u0026#39;\u0026#34;, resource); initProcessEngineFromResource(resource); //æ³¨æ„è¿™ä¸ª } try { resources = classLoader.getResources(\u0026#34;flowable-context.xml\u0026#34;); } catch (IOException e) { throw new FlowableIllegalArgumentException(\u0026#34;problem retrieving flowable-context.xml resources on the classpath: \u0026#34; + System.getProperty(\u0026#34;java.class.path\u0026#34;), e); } while (resources.hasMoreElements()) { URL resource = resources.nextElement(); LOGGER.info(\u0026#34;Initializing process engine using Spring configuration \u0026#39;{}\u0026#39;\u0026#34;, resource); initProcessEngineFromSpringResource(resource); } setInitialized(true); } else { LOGGER.info(\u0026#34;Process engines already initialized\u0026#34;); } } å¯ä»¥é€šè¿‡Springé…ç½®æ–‡ä»¶çš„æ–¹å¼\ninitProcessEngineFromResource(resource); //æ³¨æ„è¿™ä¸ª private static EngineInfo initProcessEngineFromResource(URL resourceUrl) { EngineInfo processEngineInfo = processEngineInfosByResourceUrl.get(resourceUrl.toString()); // if there is an existing process engine info if (processEngineInfo != null) { // remove that process engine from the member fields processEngineInfos.remove(processEngineInfo); if (processEngineInfo.getException() == null) { String processEngineName = processEngineInfo.getName(); processEngines.remove(processEngineName); processEngineInfosByName.remove(processEngineName); } processEngineInfosByResourceUrl.remove(processEngineInfo.getResourceUrl()); } String resourceUrlString = resourceUrl.toString(); try { LOGGER.info(\u0026#34;initializing process engine for resource {}\u0026#34;, resourceUrl); //æ³¨æ„è¿™ä¸ª ProcessEngine processEngine = buildProcessEngine(resourceUrl); String processEngineName = processEngine.getName(); LOGGER.info(\u0026#34;initialised process engine {}\u0026#34;, processEngineName); processEngineInfo = new EngineInfo(processEngineName, resourceUrlString, null); processEngines.put(processEngineName, processEngine); processEngineInfosByName.put(processEngineName, processEngineInfo); } catch (Throwable e) { LOGGER.error(\u0026#34;Exception while initializing process engine: {}\u0026#34;, e.getMessage(), e); processEngineInfo = new EngineInfo(null, resourceUrlString, ExceptionUtils.getStackTrace(e)); } processEngineInfosByResourceUrl.put(resourceUrlString, processEngineInfo); processEngineInfos.add(processEngineInfo); return processEngineInfo; } æºç \nbuildProcessEngine(resourceUrl); // private static ProcessEngine buildProcessEngine(URL resource) { InputStream inputStream = null; try { inputStream = resource.openStream(); ProcessEngineConfiguration processEngineConfiguration = ProcessEngineConfiguration.createProcessEngineConfigurationFromInputStream(inputStream); return processEngineConfiguration.buildProcessEngine(); } catch (IOException e) { throw new FlowableIllegalArgumentException(\u0026#34;couldn\u0026#39;t open resource stream: \u0026#34; + e.getMessage(), e); } finally { IoUtil.closeSilently(inputStream); } } "},{"id":202,"href":"/zh/docs/study/Flowable/boge_blbl/01-base/","title":"boge-01-flowableåŸºç¡€","section":"åŸºç¡€(æ³¢å“¥)_","content":" Flowableä»‹ç» # flowableçš„å†å²\nflowableæ˜¯BPNMçš„ä¸€ä¸ªåŸºäºjavaçš„è½¯ä»¶å®ç°ï¼Œä¸ä»…åŒ…æ‹¬BPMNï¼Œè¿˜æœ‰DMNå†³ç­–è¡¨å’ŒCMMNCaseç®¡ç†å¼•æ“ï¼Œå¹¶ä¸”æœ‰è‡ªå·±çš„ç”¨æˆ·ç®¡ç†ã€å¾®æœåŠ¡APIç­‰\nè·å–Engineå¯¹è±¡ # mavenä¾èµ–\n\u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;8.0.29\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- https://mvnrepository.com/artifact/org.flowable/flowable-engine --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.flowable\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flowable-engine\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;6.7.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- https://mvnrepository.com/artifact/junit/junit --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;junit\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;junit\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.13.2\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; é…ç½®å¹¶è·å–ProcessEngine\nProcessEngineConfiguration configuration= new StandaloneProcessEngineConfiguration(); //é…ç½® configuration.setJdbcDriver(\u0026#34;com.mysql.cj.jdbc.Driver\u0026#34;); configuration.setJdbcUsername(\u0026#34;root\u0026#34;); configuration.setJdbcPassword(\u0026#34;123456\u0026#34;); //nullCatalogMeansCurrent=true è®¾ç½®ä¸ºåªæŸ¥å½“å‰è¿æ¥çš„schemaåº“ configuration.setJdbcUrl(\u0026#34;jdbc:mysql://localhost:3306/flowable-learn?\u0026#34; + \u0026#34;useUnicode=true\u0026amp;characterEncoding=utf-8\u0026#34; + \u0026#34;\u0026amp;allowMultiQueries=true\u0026#34; + \u0026#34;\u0026amp;nullCatalogMeansCurrent=true\u0026#34;); //å¦‚æœæ•°æ®åº“ä¸­è¡¨ç»“æ„ä¸å­˜åœ¨åˆ™æ–°å»º configuration.setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE); //æ„å»ºProcessEngine ProcessEngine processEngine=configuration.buildProcessEngine(); æ—¥å¿—å’Œè¡¨ç»“æ„ä»‹ç» # æ·»åŠ slf4jä¾èµ–\n\u0026lt;!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-reload4j --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.slf4j\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;slf4j-reload4j\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.7.36\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-api --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.logging.log4j\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;log4j-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.17.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; æ·»åŠ logé…ç½®æ–‡ä»¶\nlog4j.rootLogger = DEBUG, CA log4j.appender.CA = org.apache.log4j.ConsoleAppender log4j.appender.CA.layout = org.apache.log4j.PatternLayout log4j.appender.CA.layout.ConversionPattern = %d{hh:mm:ss,SSS} {%t} %-5p %c %x - %m%n æ­¤æ—¶å†æ¬¡å¯åŠ¨å°±ä¼šçœ‹åˆ°ä¸€å †æ—¥å¿— è¡¨ æµç¨‹å®šä¹‰æ–‡ä»¶è§£æ # å…ˆé€šè¿‡æµç¨‹ç»˜åˆ¶å™¨ç»˜åˆ¶æµç¨‹\næ¡ˆä¾‹ï¼ˆå®˜ç½‘ï¼Œè¯·å‡æµç¨‹ï¼‰ è®¾è®¡å¥½æµç¨‹ä¹‹åï¼Œæµç¨‹æ•°æ®ä¿å­˜åœ¨holiday-request.bpmn20.xmlæ–‡ä»¶ä¸­\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;definitions xmlns=\u0026#34;http://www.omg.org/spec/BPMN/20100524/MODEL\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:xsd=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; xmlns:bpmndi=\u0026#34;http://www.omg.org/spec/BPMN/20100524/DI\u0026#34; xmlns:omgdc=\u0026#34;http://www.omg.org/spec/DD/20100524/DC\u0026#34; xmlns:omgdi=\u0026#34;http://www.omg.org/spec/DD/20100524/DI\u0026#34; xmlns:flowable=\u0026#34;http://flowable.org/bpmn\u0026#34; typeLanguage=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; expressionLanguage=\u0026#34;http://www.w3.org/1999/XPath\u0026#34; targetNamespace=\u0026#34;http://www.flowable.org/processdef\u0026#34;\u0026gt; \u0026lt;!--id process key--\u0026gt; \u0026lt;process id=\u0026#34;holidayRequest\u0026#34; name=\u0026#34;è¯·å‡æµç¨‹\u0026#34; isExecutable=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;startEvent id=\u0026#34;startEvent\u0026#34;/\u0026gt; \u0026lt;!--sequenceFlowè¡¨ç¤ºçš„æ˜¯çº¿æ¡ç®­å¤´--\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;startEvent\u0026#34; targetRef=\u0026#34;approveTask\u0026#34;/\u0026gt; \u0026lt;userTask id=\u0026#34;approveTask\u0026#34; name=\u0026#34;åŒæ„æˆ–è€…æ‹’ç»è¯·å‡\u0026#34;/\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;approveTask\u0026#34; targetRef=\u0026#34;decision\u0026#34;/\u0026gt; \u0026lt;!--ç½‘å…³--\u0026gt; \u0026lt;exclusiveGateway id=\u0026#34;decision\u0026#34;/\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;decision\u0026#34; targetRef=\u0026#34;externalSystemCall\u0026#34;\u0026gt; \u0026lt;!--æ¡ä»¶--\u0026gt; \u0026lt;conditionExpression xsi:type=\u0026#34;tFormalExpression\u0026#34;\u0026gt; \u0026lt;![CDATA[ ${approved} ]]\u0026gt; \u0026lt;/conditionExpression\u0026gt; \u0026lt;/sequenceFlow\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;decision\u0026#34; targetRef=\u0026#34;sendRejectionMail\u0026#34;\u0026gt; \u0026lt;!--æ¡ä»¶--\u0026gt; \u0026lt;conditionExpression xsi:type=\u0026#34;tFormalExpression\u0026#34;\u0026gt; \u0026lt;![CDATA[ ${!approved} ]]\u0026gt; \u0026lt;/conditionExpression\u0026gt; \u0026lt;/sequenceFlow\u0026gt; \u0026lt;serviceTask id=\u0026#34;externalSystemCall\u0026#34; name=\u0026#34;Enter holidays in external system\u0026#34; flowable:class=\u0026#34;org.flowable.CallExternalSystemDelegate\u0026#34;/\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;externalSystemCall\u0026#34; targetRef=\u0026#34;holidayApprovedTask\u0026#34;/\u0026gt; \u0026lt;userTask id=\u0026#34;holidayApprovedTask\u0026#34; name=\u0026#34;Holiday approved\u0026#34;/\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;holidayApprovedTask\u0026#34; targetRef=\u0026#34;approveEnd\u0026#34;/\u0026gt; \u0026lt;!--å‘é€ä¸€ä¸ªé‚®ä»¶--\u0026gt; \u0026lt;serviceTask id=\u0026#34;sendRejectionMail\u0026#34; name=\u0026#34;Send out rejection email\u0026#34; flowable:class=\u0026#34;org.flowable.SendRejectionMail\u0026#34;/\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;sendRejectionMail\u0026#34; targetRef=\u0026#34;rejectEnd\u0026#34;/\u0026gt; \u0026lt;endEvent id=\u0026#34;approveEnd\u0026#34;/\u0026gt; \u0026lt;endEvent id=\u0026#34;rejectEnd\u0026#34;/\u0026gt; \u0026lt;/process\u0026gt; \u0026lt;/definitions\u0026gt; éƒ¨ç½²æµç¨‹-ä»£ç å®ç° # ä½¿ç”¨@bofore å¤„ç†æµ‹è¯•ä¸­ç¹ççš„é…ç½®æ“ä½œ\nProcessEngineConfiguration configuration = null; @Before public void before() { configuration = new StandaloneProcessEngineConfiguration(); //é…ç½® configuration.setJdbcDriver(\u0026#34;com.mysql.cj.jdbc.Driver\u0026#34;); configuration.setJdbcUsername(\u0026#34;root\u0026#34;); configuration.setJdbcPassword(\u0026#34;123456\u0026#34;); //nullCatalogMeansCurrent=true è®¾ç½®ä¸ºåªæŸ¥å½“å‰è¿æ¥çš„schemaåº“ configuration.setJdbcUrl(\u0026#34;jdbc:mysql://localhost:3306/flowable-learn?\u0026#34; + \u0026#34;useUnicode=true\u0026amp;characterEncoding=utf-8\u0026#34; + \u0026#34;\u0026amp;allowMultiQueries=true\u0026#34; + \u0026#34;\u0026amp;nullCatalogMeansCurrent=true\u0026#34;); //å¦‚æœæ•°æ®åº“ä¸­è¡¨ç»“æ„ä¸å­˜åœ¨åˆ™æ–°å»º configuration.setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE); } ProcessEngineæä¾›çš„å‡ ä¸ªæœåŠ¡ æµç¨‹éƒ¨ç½²\n/** * æµç¨‹çš„éƒ¨ç½² */ @Test public void testDeploy() { //è·å–ProcessEngineå¯¹è±¡ ProcessEngine processEngine = configuration.buildProcessEngine(); //è·å–æœåŠ¡(repositoryï¼Œæµç¨‹å®šä¹‰) RepositoryService repositoryService = processEngine.getRepositoryService(); Deployment deploy = repositoryService.createDeployment().addClasspathResource(\u0026#34;holiday-request.bpmn20.xml\u0026#34;) .name(\u0026#34;è¯·æ±‚æµç¨‹\u0026#34;) //æµç¨‹å .deploy(); System.out.println(\u0026#34;éƒ¨ç½²id\u0026#34; + deploy.getId()); System.out.println(\u0026#34;éƒ¨ç½²å\u0026#34; + deploy.getName()); } è¡¨ç»“æ„ æŸ¥è¯¢å’Œåˆ é™¤æ“ä½œ # æŸ¥è¯¢å·²ç»éƒ¨ç½²çš„æµç¨‹å®šä¹‰\n/** * æµç¨‹å®šä¹‰åŠéƒ¨ç½²çš„æŸ¥è¯¢ */ @Test public void testDeployQuery(){ ProcessEngine processEngine=configuration.buildProcessEngine(); RepositoryService repositoryService=processEngine.getRepositoryService(); //æµç¨‹éƒ¨ç½²æŸ¥è¯¢ //è¿™é‡Œåªéƒ¨ç½²äº†ä¸€ä¸ªæµç¨‹å®šä¹‰ Deployment deployment = repositoryService.createDeploymentQuery() .deploymentId(\u0026#34;1\u0026#34;).singleResult(); System.out.println(\u0026#34;éƒ¨ç½²æ—¶çš„åç§°:\u0026#34;+deployment.getName()); //æµç¨‹å®šä¹‰æŸ¥è¯¢å™¨ ProcessDefinitionQuery processDefinitionQuery = repositoryService.createProcessDefinitionQuery(); //æŸ¥è¯¢åˆ°çš„æµç¨‹å®šä¹‰ ProcessDefinition processDefinition = processDefinitionQuery.deploymentId(\u0026#34;1\u0026#34;).singleResult(); System.out.println(\u0026#34;éƒ¨ç½²id:\u0026#34;+processDefinition.getDeploymentId()); System.out.println(\u0026#34;å®šä¹‰å:\u0026#34;+processDefinition.getName()); System.out.println(\u0026#34;æè¿°:\u0026#34;+processDefinition.getDescription()); System.out.println(\u0026#34;å®šä¹‰id:\u0026#34;+processDefinition.getId()); } åˆ é™¤æµç¨‹å®šä¹‰\nä»£ç \n/** * æµç¨‹åˆ é™¤ */ @Test public void testDeleteDeploy(){ ProcessEngine processEngine=configuration.buildProcessEngine(); RepositoryService repositoryService=processEngine. getRepositoryService(); //æ³¨æ„ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ—¶éƒ¨ç½²id //åé¢é‚£ä¸ªå‚æ•°è¡¨ç¤ºçº§è”åˆ é™¤ï¼Œå¦‚æœæµç¨‹å¯åŠ¨äº†ä¼šåŒæ—¶åˆ é™¤ä»»åŠ¡ã€‚ repositoryService.deleteDeployment(\u0026#34;2501\u0026#34;,true); } ä¸‹é¢ä¸‰ä¸ªè¡¨çš„æ•°æ®éƒ½ä¼šè¢«åˆ é™¤ å¯åŠ¨æµç¨‹å®ä¾‹ # ç”±äºåˆšæ‰å°†éƒ¨ç½²åˆ é™¤äº†ï¼Œæ‰€ä»¥è¿™é‡Œå†è¿è¡ŒtestDeploy()é‡æ–°éƒ¨ç½²ä¸Š\nè¿™é‡Œé€šè¿‡æµç¨‹å®šä¹‰keyï¼ˆxmlä¸­çš„idï¼‰å¯åŠ¨æµç¨‹\n/** * æµç¨‹è¿è¡Œ */ @Test public void testRunProcess(){ ProcessEngine processEngine=configuration.buildProcessEngine(); RuntimeService runtimeService = processEngine.getRuntimeService(); //è¿™è¾¹æ¨¡æ‹Ÿè¡¨å•æ•°æ®(è¡¨å•æ•°æ®æœ‰å¤šç§å¤„ç†æ–¹å¼ï¼Œè¿™åªæ˜¯å…¶ä¸­ä¸€ç§) Map\u0026lt;String,Object\u0026gt; map=new HashMap\u0026lt;\u0026gt;(); map.put(\u0026#34;employee\u0026#34;,\u0026#34;å¼ ä¸‰\u0026#34;); map.put(\u0026#34;nrOfHolidays\u0026#34;,3); map.put(\u0026#34;description\u0026#34;,\u0026#34;å·¥ä½œç´¯äº†æƒ³å‡ºå»ç©\u0026#34;); ProcessInstance holidayRequest = runtimeService.startProcessInstanceByKey(\u0026#34;holidayRequest\u0026#34;, map); System.out.println(\u0026#34;æµç¨‹å®šä¹‰çš„id:\u0026#34;+holidayRequest.getProcessDefinitionId()); System.out.println(\u0026#34;å½“å‰æ´»è·ƒid:\u0026#34;+holidayRequest.getActivityId()); System.out.println(\u0026#34;æµç¨‹è¿è¡Œid:\u0026#34;+holidayRequest.getId()); } ä¸‰ä¸ªè¡¨ act_ru_variable act_ru_task arc_ru_execution\næŸ¥è¯¢ä»»åŠ¡ # è¿™é‡Œå…ˆæŒ‡å®šä¸€ä¸‹æ¯ä¸ªä»»åŠ¡çš„å€™é€‰äººï¼Œä¿®æ”¹xmlæ–‡ä»¶ä¸­userTaskçš„èŠ‚ç‚¹å±æ€§\nä¿®æ”¹å‰å…ˆåˆ é™¤ä¸€ä¸‹ä¹‹å‰éƒ¨ç½²çš„æµç¨‹å›¾(è¿˜æ˜¯ä¸Šé¢çš„ä»£ç )\n/** * æµç¨‹åˆ é™¤ */ @Test public void testDeleteDeploy(){ ProcessEngine processEngine=configuration.buildProcessEngine(); RepositoryService repositoryService=processEngine. getRepositoryService(); //æ³¨æ„ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ—¶éƒ¨ç½²id //åé¢é‚£ä¸ªå‚æ•°è¡¨ç¤ºçº§è”åˆ é™¤ï¼Œtrueè¡¨ç¤ºå¦‚æœæµç¨‹å¯åŠ¨äº†ä¼šåŒæ—¶åˆ é™¤ä»»åŠ¡ã€‚ repositoryService.deleteDeployment(\u0026#34;2501\u0026#34;,false); } è¿™é‡Œç”¨falseå‚æ•°æµ‹è¯•ï¼Œä¼šæç¤ºå¤±è´¥ï¼Œè¿è¡Œä¸­çš„æµç¨‹ä¸å…è®¸åˆ é™¤ã€‚å°†ç¬¬äºŒä¸ªå‚æ•°æ”¹ä¸ºtrueå³å¯çº§è”åˆ é™¤\nåˆ é™¤åå¯ä»¥å‘ç°ä¸‹é¢å‡ ä¸ªè¡¨æ•°æ®å…¨éƒ¨æ¸…ç©ºäº† ç„¶åä¿®æ”¹xmlå®šä¹‰æ–‡ä»¶å¹¶è¿è¡ŒtestDeploy()é‡æ–°éƒ¨ç½²\nå®šä¹‰ä¿®æ”¹\n\u0026lt;userTask id=\u0026#34;approveTask\u0026#34; name=\u0026#34;åŒæ„æˆ–è€…æ‹’ç»è¯·å‡\u0026#34; flowable:assignee=\u0026#34;zhangsan\u0026#34;/\u0026gt; \u0026lt;!--è¿™é‡Œå¢åŠ äº†assigneeå±æ€§å€¼--\u0026gt; è¿è¡Œæµç¨‹ testRunProcess()\nè¿è¡ŒåèŠ‚ç‚¹ä¼šè·³åˆ°ç»™zhangsançš„é‚£ä¸ªä»»åŠ¡ï¼ŒæŸ¥çœ‹æ•°æ®åº“è¡¨ æµç¨‹å˜é‡ æŸ¥è¯¢ä»»åŠ¡\n/** * æµ‹è¯•ä»»åŠ¡æŸ¥è¯¢ */ @Test public void testQueryTask(){ ProcessEngine processEngine=configuration.buildProcessEngine(); TaskService taskService = processEngine.getTaskService(); //é€šè¿‡æµç¨‹å®šä¹‰æŸ¥è¯¢ä»»åŠ¡ List\u0026lt;Task\u0026gt; list = taskService.createTaskQuery().processDefinitionKey(\u0026#34;holidayRequest\u0026#34;) .taskAssignee(\u0026#34;zhangsan\u0026#34;) .list(); for (Task task:list){ System.out.println(\u0026#34;ä»»åŠ¡å¯¹åº”çš„æµç¨‹å®šä¹‰id\u0026#34;+task.getProcessDefinitionId()); System.out.println(\u0026#34;ä»»åŠ¡å\u0026#34;+task.getName()); System.out.println(\u0026#34;ä»»åŠ¡å¤„ç†äºº\u0026#34;+task.getAssignee()); System.out.println(\u0026#34;ä»»åŠ¡æè¿°\u0026#34;+task.getDescription()); System.out.println(\u0026#34;ä»»åŠ¡id\u0026#34;+task.getId()); } } å¤„ç†ä»»åŠ¡ # æµç¨‹å›¾å®šä¹‰çš„åˆ†æ ä»»åŠ¡Aå¤„ç†åï¼Œæ ¹æ®å¤„ç†ç»“æœï¼ˆè¿™é‡Œæ˜¯æ‹’ç»ï¼‰ï¼Œä¼šèµ°å‘ä»»åŠ¡Dï¼Œç„¶åä»»åŠ¡Dæ˜¯ä¸€ä¸ªServiceï¼Œä¸”é€šè¿‡javaçš„å§”æ‰˜å¯¹è±¡ï¼Œè‡ªåŠ¨å®ç°æ“ä½œ\nåˆ°äº†Dé‚£ä¸ªèŠ‚ç‚¹ï¼Œè¿™é‡ŒæŒ‡å®šäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„javaç±»å¤„ç† ä»£ç é…ç½®ï¼Œæ³¨æ„ç±»åå’Œxmlä¸­çš„ä¸€è‡´\npackage org.flowable; import org.flowable.engine.delegate.DelegateExecution; import org.flowable.engine.delegate.JavaDelegate; public class SendRejectionMail implements JavaDelegate { /** * è¿™æ˜¯ä¸€ä¸ªflowableä¸­çš„è§¦å‘å™¨ * * @param delegateExecution */ @Override public void execute(DelegateExecution delegateExecution) { //è§¦å‘æ‰§è¡Œçš„é€»è¾‘ æŒ‰ç…§æˆ‘ä»¬åœ¨æµç¨‹ä¸­çš„å®šä¹‰ç»™è¢«æ‹’ç»çš„å‘˜å·¥å‘é€é€šçŸ¥é‚®ä»¶ System.out.println(\u0026#34;ä¸å¥½æ„æ€ï¼Œä½ çš„è¯·å‡ç”³è¯·è¢«æ‹’ç»äº†\u0026#34;); } } ä»»åŠ¡çš„å®Œæˆ\n@Test public void testCompleteTask() { ProcessEngine engine = configuration.buildProcessEngine(); TaskService taskService = engine.getTaskService(); //æŸ¥æ‰¾å‡ºå¼ ä¸‰åœ¨è¿™ä¸ªæµç¨‹å®šä¹‰ä¸­çš„ä»»åŠ¡ Task task = taskService.createTaskQuery().processDefinitionKey(\u0026#34;holidayRequest\u0026#34;) .taskAssignee(\u0026#34;zhangsan\u0026#34;) .singleResult(); //åˆ›å»ºæµç¨‹å˜é‡ HashMap\u0026lt;String, Object\u0026gt; map = new HashMap\u0026lt;\u0026gt;(); map.put(\u0026#34;approved\u0026#34;, false); //å®Œæˆä»»åŠ¡ taskService.complete(task.getId(), map); } æ§åˆ¶å° æ•°æ®åº“ ä¸‹é¢å‡ ä¸ªè¡¨çš„æ•°æ®éƒ½è¢«æ¸…ç©ºäº† å†å²ä»»åŠ¡çš„å®Œæˆ # Flowableæµç¨‹å¼•æ“å¯ä»¥è‡ªåŠ¨å­˜å‚¨æ‰€æœ‰æµç¨‹å®ä¾‹çš„å®¡è®¡æ•°æ®æˆ–å†å²æ•°æ®\nå…ˆæŸ¥çœ‹ä¸€ä¸‹åˆšæ‰ç”¨çš„æµç¨‹å®šä¹‰çš„id å†å²ä¿¡æ¯æŸ¥è¯¢\n@Test public void testHistory(){ ProcessEngine processEngine=configuration.buildProcessEngine(); HistoryService historyService=processEngine.getHistoryService(); List\u0026lt;HistoricActivityInstance\u0026gt; list = historyService.createHistoricActivityInstanceQuery() .processDefinitionId(\u0026#34;holidayRequest:1:7503\u0026#34;) .finished() //æŸ¥è¯¢å·²ç»å®Œæˆçš„ .orderByHistoricActivityInstanceEndTime().asc() //æŒ‡å®šæ’åºå­—æ®µå’Œå‡é™åº .list(); for(HistoricActivityInstance history:list){ //æ³¨æ„,å’Œè§†é¢‘ä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œhistoryè¡¨è¿˜è®°å½•äº†æµç¨‹ç®­å¤´æµå‘çš„é‚£ä¸ªèŠ‚ç‚¹ //_flow_ System.out.println( \u0026#34;æ´»åŠ¨å--\u0026#34;+history.getActivityName()+ \u0026#34;å¤„ç†äºº--\u0026#34;+history.getAssignee()+ \u0026#34;æ´»åŠ¨id--\u0026#34;+history.getActivityId()+ \u0026#34;å¤„ç†æ—¶é•¿--\u0026#34;+history.getDurationInMillis()+\u0026#34;æ¯«ç§’\u0026#34;); } ä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œåœ¨æ—§ç‰ˆæœ¬æ—¶æ²¡æœ‰çš„ æµç¨‹è®¾è®¡å™¨ # æœ‰eclipseæµç¨‹è®¾è®¡å™¨ï¼Œå’Œflowableæµç¨‹è®¾è®¡å™¨\nä½¿ç”¨eclipseçš„è®¾è®¡ï¼Œä¼šç”Ÿæˆä¸€ä¸ªbaræ–‡ä»¶ï¼Œä»£ç ç¨å¾®æœ‰ç‚¹ä¸åŒ æ¥æ”¶ä¸€ä¸ªZipInputStream\nFlowableUI # ä½¿ç”¨flowableå®˜æ–¹æä¾›çš„åŒ…ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªwarï¼Œç›´æ¥ç”¨å‘½ä»¤ java -jar xx.warå¯åŠ¨å³å¯ è¿™ä¸ªåº”ç”¨åˆ†æˆå››ä¸ªæ¨¡å— æµç¨‹å›¾çš„ç»˜åˆ¶åŠç”¨æˆ·åˆ†é… "},{"id":203,"href":"/zh/docs/study/Linux/hanshunping/12-20/","title":"linux_éŸ©è€å¸ˆ_12-20","section":"éŸ©é¡ºå¹³è€å¸ˆ_","content":" ç›®å½•ç»“æ„ # ç›®å½•ç»“æ„å¾ˆé‡è¦\nwindowsä¸‹ linuxä¸‹ï¼Œä»æ ¹ç›®å½•å¼€å§‹åˆ†æ”¯ /ï¼Œ/root ï¼ˆrootç”¨æˆ·ï¼‰ï¼Œ/home ï¼ˆåˆ›å»ºçš„ç”¨æˆ·çš„ç›®å½•ï¼‰ï¼Œ/binï¼ˆå¸¸ç”¨çš„æŒ‡ä»¤ï¼‰ï¼Œ/etcï¼ˆç¯å¢ƒé…ç½®ï¼‰\nåœ¨linuxä¸–ç•Œé‡Œï¼Œä¸€åˆ‡çš†æ–‡ä»¶\ncpuè¢«æ˜ å°„æˆæ–‡ä»¶\nç¡¬ç›˜ å…·ä½“çš„ç›®å½•ç»“æ„\n/bin å¸¸ç”¨ï¼Œbinaryçš„ç¼©å†™ï¼Œå­˜æ”¾å¸¸ç”¨çš„å‘½ä»¤ (/usr/binã€/usr/local/bin) /sbin ï¼ˆ/usr/sbinã€/usr/local/sbinï¼‰ SuperUserï¼Œå­˜æ”¾çš„æ˜¯ç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨çš„ç³»ç»Ÿç®¡ç†ç¨‹åº\n/home å­˜æ”¾æ™®é€šç”¨æˆ·çš„ä¸»ç›®å½•\nuseradd jack ä¹‹åçœ‹è¯¥ç›®å½• åˆ æ‰ userdel -r jack ç›®å½•æ¶ˆå¤± /root è¯¥ç›®å½•ä¸ºç³»ç»Ÿç®¡ç†å‘˜ï¼Œä¹Ÿç§°è¶…çº§ç®¡ç†å‘˜çš„ç”¨æˆ·çš„ä¸»ç›®å½•\n/lib ç³»ç»Ÿå¼€æœºæ‰€éœ€è¦çš„æœ€åŸºæœ¬çš„åŠ¨æ€è¿æ¥å…±äº«åº“ï¼Œå…¶ä½œç”¨ç±»ä¼¼äºwindowsé‡Œçš„DLLï¼Œå‡ ä¹æ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½éœ€è¦ç”¨åˆ°è¿™äº›å…±äº«åº“\nlost+found ä¸€èˆ¬ä¸ºç©ºï¼Œéæ³•å…³æœºåä¼šå­˜æ”¾æ–‡ä»¶\n/etc ç³»ç»Ÿç®¡ç†æ‰€éœ€è¦çš„é…ç½®æ–‡ä»¶å’Œå­ç›®å½•ï¼Œæ¯”å¦‚mysqlçš„my.conf\n/usr ç”¨æˆ·çš„åº”ç”¨ç¨‹åºå’Œæ–‡ä»¶ï¼Œç±»ä¼¼windowsçš„program files\n/boot å¯åŠ¨Linuxæ—¶ä½¿ç”¨çš„æ ¸å¿ƒæ–‡ä»¶ï¼ˆç ´ååˆ™æ— æ³•å¯åŠ¨ï¼‰\n/proc ï¼ˆä¸èƒ½åŠ¨ï¼‰ è™šæ‹Ÿç›®å½•ï¼Œç³»ç»Ÿå†…å­˜çš„æ˜ å°„ï¼Œè®¿é—®è¿™ä¸ªç›®å½•è·å–ç³»ç»Ÿä¿¡æ¯\n/srv ï¼ˆä¸èƒ½åŠ¨ï¼‰ serviceçš„ç¼©å†™ï¼Œå­˜æ”¾æœåŠ¡å¯åŠ¨ä¹‹åéœ€è¦æå–çš„æ•°æ®\n/sys ï¼ˆä¸èƒ½åŠ¨ï¼‰ å®‰è£…äº†2.6å†…æ ¸ä¸­æ–°å‡ºç°çš„æ–‡ä»¶ç³»ç»Ÿ sysfs\n/tmp è¿™ä¸ªç›®å½•ç”¨æ¥å­˜æ”¾ä¸€äº›ä¸´æ—¶æ–‡ä»¶\n/dev ç±»ä¼¼windowsè®¾å¤‡ç®¡ç†å™¨ï¼Œå°†ç¡¬ä»¶æ˜ å°„æˆæ–‡ä»¶\n/media linuxç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«ä¸€äº›è®¾å¤‡ï¼Œuç›˜ã€å…‰é©±ï¼Œå°†è¯†åˆ«çš„è®¾å¤‡æ˜ å°„åˆ°è¯¥ç›®å½•ä¸‹\n/mnt ä¸ºäº†è®©ç”¨æˆ·æŒ‚è½½åˆ«çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚å°†å¤–éƒ¨çš„å­˜å‚¨æŒ‚è½½åˆ°è¯¥ç›®å½• /opt ç»™ä¸»æœºé¢å¤–å®‰è£…è½¯ä»¶æ‰€å­˜æ”¾çš„ç›®å½•\n/usr/local ç»™ä¸»æœºé¢å¤–å®‰è£…è½¯ä»¶æ‰€å®‰è£…çš„ç›®å½•ï¼Œä¸€èˆ¬é€šè¿‡ç¼–è¯‘æºç æ–¹å¼å®‰è£…çš„ç¨‹åº\n/var æ—¥å¿—ï¼Œä¸æ–­æ‰©å……çš„ä¸œè¥¿ /selinux [security-enhanced linux] å®‰å…¨å­ç³»ç»Ÿï¼Œæ§åˆ¶ç¨‹åºåªèƒ½è®¿é—®ç‰¹å®šæ–‡ä»¶ (å¯ç”¨ä¹‹åæ‰èƒ½çœ‹åˆ°)\nè¿œç¨‹ç™»é™† # èƒŒæ™¯ linuxæœåŠ¡å™¨å¼€å‘å°ç»„å…±äº« æ­£å¼ä¸Šçº¿é¡¹ç›®è¿è¡Œåœ¨å…¬ç½‘ï¼Œæ‰€ä»¥éœ€è¦è¿œç¨‹å¼€å‘éƒ¨ç½² å›¾è§£ è½¯ä»¶ xshell å’Œxftp https://www.xshell.com/zh/free-for-home-school/ ä½¿ç”¨ifconfig æŸ¥çœ‹ip å…ˆæ·»åŠ ç½‘ç»œå·¥å…·åŒ… yum install net-tools -y ä½¿ç”¨ åœ¨å®¢æˆ·ç«¯æ‰“å¼€cmdï¼Œå¹¶ä½¿ç”¨pingå‘½ä»¤ xshellä¸­é…ç½®å¹¶è¿›è¡Œè¿æ¥ æŒ‰ä½ctrl+é¼ æ ‡æ»šè½´å¯ä»¥æ”¾å¤§å­—ä½“ è¿œç¨‹æ–‡ä»¶ä¼ è¾“ # xtfp6 personå®‰è£… æ–°å»ºè¿æ¥é…ç½® æ–‡ä»¶å¤¹ å¯ä»¥åœ¨è¿™é‡Œç›´æ¥å¤åˆ¶ä¸Šä¼  å›¾è§£ è§£å†³ä¹±ç é—®é¢˜ reboot vimå¿«æ·é”® # vi ï¼šlinuxå†…ç½®viæ–‡æœ¬ç¼–è¾‘å™¨ vimæ˜¯viçš„å¢å¼ºç‰ˆæœ¬ï¼Œæœ‰ä¸°å¯Œçš„å­—ä½“é¢œè‰²\nå¸¸ç”¨çš„ä¸‰ç§æ¨¡å¼\næ­£å¸¸æ¨¡å¼ï¼Œä½¿ç”¨ä¸Šä¸‹å·¦å³ã€å¤åˆ¶ç²˜è´´ æ’å…¥æ¨¡å¼ æ­£å¸¸æ¨¡å¼\u0026ndash;\u0026gt;æ’å…¥æ¨¡å¼ æŒ‰ä¸‹i I o O a A r Rï¼ˆä¸€èˆ¬ç”¨iï¼‰ å‘½ä»¤è¡Œæ¨¡å¼ æ’å…¥æ¨¡å¼\u0026ndash;\u0026gt;å‘½ä»¤è¡Œ è¾“å…¥è¾“å…¥escè¡¨ç¤ºé€€å‡ºï¼Œç„¶åè¾“å…¥: è¾“å…¥wqè¡¨ç¤ºä¿å­˜å¹¶é€€å‡º ç¼–è¾‘ï¼Œé‡æ–°vim Hello.java ä¸‹é¢ï¼Œè¿™æ—¶å€™æŒ‰tabå¯ä»¥è‡ªåŠ¨è¡¥å…¨ å‘½ä»¤ å¿«æ·é”®ä½¿ç”¨\næ­£å¸¸æ¨¡å¼ä¸‹\nè¾“å…¥yyï¼Œæ‹·è´å½“å‰è¡Œã€‚pè¿›è¡Œç²˜è´´ 4yyï¼Œæ‹·è´å½“å‰è¡Œ(åŒ…æ‹¬)å¾€ä¸‹4è¡Œ\nè¾“å…¥ddï¼Œåˆ é™¤å½“å‰è¡Œ 4ddï¼Œåˆ é™¤å½“å‰è¡Œï¼ˆåŒ…æ‹¬ï¼‰å¾€ä¸‹4è¡Œ\nå®šä½åˆ°é¦–è¡Œ(gg)æˆ–è€…æœ«è¡ŒG\nä½¿ç”¨uï¼Œæ’¤å›åˆšæ‰çš„è¾“å…¥(lalalaå°†è¢«æ’¤å›) å®šä½åˆ°20è¡Œ ï¼ˆ20+shift+gï¼‰ã€å…¶å®æ˜¯20+Gã€‘\nå‘½ä»¤æ¨¡å¼ ï¼šåˆ‡æ¢åˆ°å‘½ä»¤è¡Œ)\nå‘½ä»¤è¡Œæ¨¡å¼ä¸‹ï¼ˆï¼šä¸‹ï¼‰ï¼Œè¾“å…¥ /æœç´¢å†…å®¹\næˆ–è€…ï¼ˆ/ï¼‰ä¸‹ï¼Œç›´æ¥è¾“å…¥æœç´¢å†…å®¹\nå†æ¬¡è¾“å…¥ / ï¼Œå°±ä¼šæ¸…ç©ºå‰é¢çš„æœç´¢\nè®¾ç½®æ–‡ä»¶è¡Œå·ï¼ˆï¼šä¸‹ï¼‰ set nu è®¾ç½®ï¼›set nonu å–æ¶ˆ å¦‚æœä¿®æ”¹å¤ªå¤šï¼Œéœ€è¦å…ˆæ‹·è´åˆ°windowsä¸‹ï¼Œç„¶åå†ä¼ ä¸Šæ¥\nvim/vi å¿«æ·é”® å…³æœºé‡å¯ # å‘½ä»¤ halt åœæ­¢\nshutdown -h now #ç«‹åˆ»å…³æœº shutdown -h 1 #ç»™å‡ºæç¤ºå¹¶å…³æœº shutdown -r now #ç°åœ¨é‡å¯è®¡ç®—æœº halt #ç«‹åˆ»å…³æœº(è™šæ‹Ÿæœºå¥½åƒåªæ˜¯æŠŠcpuå…³é—­ï¼Ÿ) reboot #ç«‹åˆ»é‡å¯ sync #å°†å†…å­˜çš„æ•°æ®åŒæ­¥åˆ°ç£ç›˜ sync #å°†å†…å­˜çš„æ•°æ®åŒæ­¥åˆ°ç£ç›˜ shutdown/reboot/haltç­‰å‘½ä»¤éƒ½ä¼šåœ¨æ‰§è¡Œå‰æ‰§è¡Œsync ç™»å½•æ³¨é”€ # å°½é‡ä¸è¦ç”¨rootè´¦å·ç™»å½•\næ™®é€šç”¨æˆ·ç™»é™†åï¼Œç”¨su - ç”¨æˆ·å åˆ‡æ¢æˆç³»ç»Ÿç®¡ç†å‘˜èº«ä»½ logout æ³¨é”€ç”¨æˆ·ï¼ˆå›¾å½¢é¡µé¢æ²¡æ•ˆæœï¼‰ åœ¨è¿è¡Œçº§åˆ«3ä¸‹æœ‰æ•ˆ "},{"id":204,"href":"/zh/docs/study/Linux/hanshunping/07-11/","title":"linux_éŸ©è€å¸ˆ_07-11","section":"éŸ©é¡ºå¹³è€å¸ˆ_","content":" ç½‘ç»œè¿æ¥ # ç½‘ç»œè¿æ¥çš„ä¸‰ç§æ¨¡å¼ åŒä¸€ä¸ªæ•™å®¤çš„ä¸‰ä¸ªä¸»æœº æ­¤æ—¶ä¸‰ä¸ªåŒå­¦å¯ä»¥æ­£å¸¸é€šè®¯ æ¡¥æ¥æ¨¡å¼ è¿™æ˜¯å¼ ä¸‰çš„è™šæ‹Ÿæœºå’Œå¤–éƒ¨äº’é€šï¼›ä½†æ˜¯å¦‚æœè¿™æ ·è®¾ç½®ï¼Œipä¼šä¸å¤Ÿç”¨ï¼› NATæ¨¡å¼ å¦‚å›¾ï¼Œè™šæ‹Ÿæœºå¯ä»¥è·Ÿè™šæ‹Ÿçš„ç½‘å¡(192.168.100.99)äº’é€šï¼Œä¸”é€šè¿‡è¿™ä¸ªè™šæ‹Ÿç½‘å¡ï¼ŒåŠï¼ˆ192.168.0.50ä»£ç†ï¼‰ï¼Œä¸å¤–ç•Œ(192.168.0.X)äº’é€š NATæ¨¡å¼ï¼Œç½‘ç»œåœ°å€è½¬æ¢æ¨¡å¼ï¼Œè™šæ‹Ÿç³»ç»Ÿå’Œå¤–éƒ¨ç³»ç»Ÿé€šè®¯ï¼Œä¸é€ æˆIPå†²çª æ³¨æ„ï¼Œè¿™é‡Œå¤–éƒ¨å…¶ä»–ä¸»æœº(é™¤0.50å’Œ100.99)æ˜¯è®¿é—®ä¸åˆ°100.88çš„ ä¸»æœºæ¨¡å¼ï¼šç‹¬ç«‹çš„ç³»ç»Ÿ è™šæ‹Ÿæœºå…‹éš† # æ–¹å¼1ï¼Œç›´æ¥æ‹·è´æ•´ä¸ªæ–‡ä»¶å¤¹ æ–¹å¼2ï¼Œä½¿ç”¨VMWare å…‹éš†å‰å…ˆæŠŠå…‹éš†ç›®æ ‡å…³é—­ å…‹éš†è™šæ‹Ÿæœºå½“å‰çŠ¶æ€\u0026ndash;åˆ›å»ºå®Œæ•´å…‹éš† è™šæ‹Ÿæœºå¿«ç…§ # ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿæœºå¿«ç…§ å¿«ç…§a ä¹‹ååˆ›å»ºäº†æ–‡ä»¶å¤¹hello ç„¶åæ‹æ‘„å¿«ç…§b ä¹‹ååˆ›å»ºäº†æ–‡ä»¶å¤¹hello2 ç„¶åæ‹æ‘„å¿«ç…§c\nç›®å‰ å›åˆ°å¿«ç…§A ä¹‹åä¼šé‡å¯ï¼Œæ•ˆæœï¼ˆä¸¤ä¸ªæ–‡ä»¶å¤¹éƒ½æ²¡æœ‰äº†)\nå¦‚æœæ¢å¤åˆ°Bï¼Œç„¶åå†åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œå°±ä¼šå˜æˆ è™šæ‹Ÿæœºè¿ç§» # ç›´æ¥å‰ªåˆ‡ã€åˆ é™¤ï¼Œå³å¯ vmtoolså·¥å…· # å¦‚ä¸‹æ­¥éª¤ï¼Œæ³¨æ„ï¼Œè¿™é‡Œåªæ˜¯åœ¨æœ‰ç•Œé¢çš„æƒ…å†µä¸‹è¿›è¡Œå®‰è£… å®‰è£…å®Œæ¯•å åœ¨vmä¸Šé¢è®¾ç½® å…±äº«æ–‡ä»¶å¤¹åœ¨linuxä¸­çš„è·¯å¾„ /mnt/hgfs/myshare "},{"id":205,"href":"/zh/docs/study/Flowable/offical/05/","title":"Flowable-05-spring-boot","section":"å®˜æ–¹æ–‡æ¡£","content":" å…¥é—¨ # éœ€è¦ä¸¤ä¸ªä¾èµ–\n\u0026lt;properties\u0026gt; \u0026lt;flowable.version\u0026gt;6.7.2\u0026lt;/flowable.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.flowable\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flowable-spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${flowable.version}\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- https://mvnrepository.com/artifact/com.h2database/h2 --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.h2database\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;h2\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.1.212\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; ç»“åˆSpringï¼š\nåªéœ€å°†ä¾èµ–é¡¹æ·»åŠ åˆ°ç±»è·¯å¾„å¹¶ä½¿ç”¨*@SpringBootApplication*æ³¨é‡Šï¼Œå¹•åå°±ä¼šå‘ç”Ÿå¾ˆå¤šäº‹æƒ…ï¼š\nè‡ªåŠ¨åˆ›å»ºå†…å­˜æ•°æ®æºï¼ˆå› ä¸º H2 é©±åŠ¨ç¨‹åºä½äºç±»è·¯å¾„ä¸­ï¼‰å¹¶ä¼ é€’ç»™ Flowable æµç¨‹å¼•æ“é…ç½®\nå·²åˆ›å»ºå¹¶å…¬å¼€äº† Flowable ProcessEngineã€CmmnEngineã€DmnEngineã€FormEngineã€ContentEngine å’Œ IdmEngine bean\næ‰€æœ‰ Flowable æœåŠ¡éƒ½æš´éœ²ä¸º Spring bean\nSpring Job Executor å·²åˆ›å»º\nå°†è‡ªåŠ¨éƒ¨ç½²æµç¨‹æ–‡ä»¶å¤¹ä¸­çš„ä»»ä½• BPMN 2.0 æµç¨‹å®šä¹‰ã€‚åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹processeså¹¶å°†ä¸€ä¸ªè™šæ‹Ÿè¿›ç¨‹å®šä¹‰ï¼ˆåä¸ºone-task-process.bpmn20.xmlï¼‰æ·»åŠ åˆ°æ­¤æ–‡ä»¶å¤¹ã€‚è¯¥æ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹æ‰€ç¤ºã€‚\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;definitions xmlns=\u0026#34;http://www.omg.org/spec/BPMN/20100524/MODEL\u0026#34; xmlns:flowable=\u0026#34;http://flowable.org/bpmn\u0026#34; targetNamespace=\u0026#34;Examples\u0026#34;\u0026gt; \u0026lt;process id=\u0026#34;oneTaskProcess\u0026#34; name=\u0026#34;The One Task Process\u0026#34;\u0026gt; \u0026lt;startEvent id=\u0026#34;theStart\u0026#34; /\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;flow1\u0026#34; sourceRef=\u0026#34;theStart\u0026#34; targetRef=\u0026#34;theTask\u0026#34; /\u0026gt; \u0026lt;userTask id=\u0026#34;theTask\u0026#34; name=\u0026#34;my task\u0026#34; flowable:assignee=\u0026#34;kermit\u0026#34; /\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;flow2\u0026#34; sourceRef=\u0026#34;theTask\u0026#34; targetRef=\u0026#34;theEnd\u0026#34; /\u0026gt; \u0026lt;endEvent id=\u0026#34;theEnd\u0026#34; /\u0026gt; \u0026lt;/process\u0026gt; \u0026lt;/definitions\u0026gt; æ¡ˆä¾‹æ–‡ä»¶å¤¹ä¸­çš„ä»»ä½• CMMN 1.1 æ¡ˆä¾‹å®šä¹‰éƒ½å°†è‡ªåŠ¨éƒ¨ç½²ã€‚\nå°†è‡ªåŠ¨éƒ¨ç½²dmnæ–‡ä»¶å¤¹ä¸­çš„ä»»ä½• DMN 1.1 dmn å®šä¹‰ã€‚\nè¡¨å•æ–‡ä»¶å¤¹ä¸­çš„ä»»ä½•è¡¨å•å®šä¹‰éƒ½å°†è‡ªåŠ¨éƒ¨ç½²ã€‚\njavaä»£ç  åœ¨é¡¹ç›®æœåŠ¡å¯åŠ¨çš„æ—¶å€™å°±å»åŠ è½½ä¸€äº›æ•°æ®\n@SpringBootApplication(proxyBeanMethods = false) public class MyApplication { public static void main(String[] args) { SpringApplication.run(MyApplication.class, args); } @Bean public CommandLineRunner init(final RepositoryService repositoryService, final RuntimeService runtimeService, final TaskService taskService) { //è¯¥beanåœ¨é¡¹ç›®æœåŠ¡å¯åŠ¨çš„æ—¶å€™å°±å»åŠ è½½ä¸€äº›æ•°æ® return new CommandLineRunner() { @Override public void run(String... strings) throws Exception { //æœ‰å‡ ä¸ªæµç¨‹å®šä¹‰ System.out.println(\u0026#34;Number of process definitions : \u0026#34; + repositoryService.createProcessDefinitionQuery().count()); //æœ‰å¤šå°‘ä¸ªä»»åŠ¡ System.out.println(\u0026#34;Number of tasks : \u0026#34; + taskService.createTaskQuery().count()); runtimeService.startProcessInstanceByKey(\u0026#34;oneTaskProcess\u0026#34;); //å¼€å¯æµç¨‹åæœ‰å¤šå°‘ä¸ªä»»åŠ¡ï¼ˆ+1ï¼‰ System.out.println(\u0026#34;Number of tasks after process start: \u0026#34; + taskService.createTaskQuery().count()); } }; } } æ›´æ”¹æ•°æ®åº“ # æ·»åŠ ä¾èµ–\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;8.0.29\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; application.ymlä¸­æ·»åŠ é…ç½®\nspring: datasource: url: jdbc:mysql://localhost:3306/flowable-spring-boot?useUnicode=true\u0026amp;characterEncoding=utf-8\u0026amp;allowMultiQueries=true\u0026amp;nullCatalogMeansCurrent=true username: root password: 123456 driver-class-name: com.mysql.jdbc.Driver Restæ”¯æŒ # webæ”¯æŒ\n\u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.6.7\u0026lt;/version\u0026gt; \u0026lt;/parent\u0026gt; æ·»åŠ ä¾èµ–\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; ä½¿ç”¨Serviceå¯åŠ¨æµç¨‹åŠè·å–ç»™å®šå—è®©äººçš„ä»»åŠ¡\n@Service public class MyService { @Autowired private RuntimeService runtimeService; @Autowired private TaskService taskService; @Transactional public void startProcess() { runtimeService.startProcessInstanceByKey(\u0026#34;oneTaskProcess\u0026#34;); } @Transactional public List\u0026lt;Task\u0026gt; getTasks(String assignee) { return taskService.createTaskQuery().taskAssignee(assignee).list(); } } åˆ›å»ºRESTç«¯ç‚¹\n@RestController public class MyRestController { @Autowired private MyService myService; @PostMapping(value=\u0026#34;/process\u0026#34;) public void startProcessInstance() { myService.startProcess(); } @RequestMapping(value=\u0026#34;/tasks\u0026#34;, method= RequestMethod.GET, produces=MediaType.APPLICATION_JSON_VALUE) public List\u0026lt;TaskRepresentation\u0026gt; getTasks(@RequestParam String assignee) { List\u0026lt;Task\u0026gt; tasks = myService.getTasks(assignee); List\u0026lt;TaskRepresentation\u0026gt; dtos = new ArrayList\u0026lt;TaskRepresentation\u0026gt;(); for (Task task : tasks) { dtos.add(new TaskRepresentation(task.getId(), task.getName())); } return dtos; } static class TaskRepresentation { private String id; private String name; public TaskRepresentation(String id, String name) { this.id = id; this.name = name; } public String getId() { return id; } public void setId(String id) { this.id = id; } public String getName() { return name; } public void setName(String name) { this.name = name; } } } ä½¿ç”¨ä¸‹é¢è¯­å¥è¿›è¡Œæµ‹è¯•\ncurl http://localhost:8080/tasks?assignee=kermit [] curl -X POST http://localhost:8080/process curl http://localhost:8080/tasks?assignee=kermit [{\u0026#34;id\u0026#34;:\u0026#34;10004\u0026#34;,\u0026#34;name\u0026#34;:\u0026#34;my task\u0026#34;}] JPAæ”¯æŒ # æ·»åŠ ä¾èµ–\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-data-jpa\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; åˆ›å»ºä¸€ä¸ªå®ä½“ç±»\n@Entity class Person { @Id @GeneratedValue private Long id; private String username; private String firstName; private String lastName; private Date birthDate; public Person() { } public Person(String username, String firstName, String lastName, Date birthDate) { this.username = username; this.firstName = firstName; this.lastName = lastName; this.birthDate = birthDate; } public Long getId() { return id; } public void setId(Long id) { this.id = id; } public String getUsername() { return username; } public void setUsername(String username) { this.username = username; } public String getFirstName() { return firstName; } public void setFirstName(String firstName) { this.firstName = firstName; } public String getLastName() { return lastName; } public void setLastName(String lastName) { this.lastName = lastName; } public Date getBirthDate() { return birthDate; } public void setBirthDate(Date birthDate) { this.birthDate = birthDate; } } å±æ€§æ–‡ä»¶æ·»åŠ \nspring.jpa.hibernate.ddl-auto=update æ·»åŠ Repositoryç±»\n@Repository public interface PersonRepository extends JpaRepository\u0026lt;Person, Long\u0026gt; { Person findByUsername(String username); } ä»£ç \næ·»åŠ äº‹åŠ¡\nstartProcessç°åœ¨ä¿®æ”¹æˆï¼šè·å–ä¼ å…¥çš„å—ç†äººç”¨æˆ·åï¼ŒæŸ¥æ‰¾Personï¼Œå¹¶å°†PersonJPAå¯¹è±¡ä½œä¸ºæµç¨‹å˜é‡æ”¾å…¥æµç¨‹å®ä¾‹ä¸­\nåœ¨CommandLineRunnerä¸­åˆå§‹åŒ–æ—¶åˆ›å»ºç”¨æˆ·\n@Service @Transactional public class MyService { @Autowired private RuntimeService runtimeService; @Autowired private TaskService taskService; @Autowired private PersonRepository personRepository; public void startProcess(String assignee) { Person person = personRepository.findByUsername(assignee); Map\u0026lt;String, Object\u0026gt; variables = new HashMap\u0026lt;String, Object\u0026gt;(); variables.put(\u0026#34;person\u0026#34;, person); runtimeService.startProcessInstanceByKey(\u0026#34;oneTaskProcess\u0026#34;, variables); } public List\u0026lt;Task\u0026gt; getTasks(String assignee) { return taskService.createTaskQuery().taskAssignee(assignee).list(); } public void createDemoUsers() { if (personRepository.findAll().size() == 0) { personRepository.save(new Person(\u0026#34;jbarrez\u0026#34;, \u0026#34;Joram\u0026#34;, \u0026#34;Barrez\u0026#34;, new Date())); personRepository.save(new Person(\u0026#34;trademakers\u0026#34;, \u0026#34;Tijs\u0026#34;, \u0026#34;Rademakers\u0026#34;, new Date())); } } } CommandRunnerä¿®æ”¹\n@Bean public CommandLineRunner init(final MyService myService) { return new CommandLineRunner() { public void run(String... strings) throws Exception { myService.createDemoUsers(); } }; } RestControllerä¿®æ”¹\n@RestController public class MyRestController { @Autowired private MyService myService; @PostMapping(value=\u0026#34;/process\u0026#34;) public void startProcessInstance(@RequestBody StartProcessRepresentation startProcessRepresentation) { myService.startProcess(startProcessRepresentation.getAssignee()); } ... static class StartProcessRepresentation { private String assignee; public String getAssignee() { return assignee; } public void setAssignee(String assignee) { this.assignee = assignee; } } ä¿®æ”¹æµç¨‹å®šä¹‰\n\u0026lt;userTask id=\u0026#34;theTask\u0026#34; name=\u0026#34;my task\u0026#34; flowable:assignee=\u0026#34;${person.id}\u0026#34;/\u0026gt; æµ‹è¯•\nå¯åŠ¨spring bootä¹‹åpersonè¡¨ä¼šæœ‰ä¸¤æ¡æ•°æ®\nå¯åŠ¨æµç¨‹å®ä¾‹\næ­¤æ—¶ä¼šæŠŠä»æ•°æ®åº“æŸ¥æ‰¾åˆ°çš„personä¼ å…¥æµç¨‹å›¾(å˜é‡)\ncurl -H \u0026#34;Content-Type: application/json\u0026#34; -d \u0026#39;{\u0026#34;assignee\u0026#34; : \u0026#34;jbarrez\u0026#34;}\u0026#39; http://localhost:8080/process ä½¿ç”¨idè·å–ä»»åŠ¡åˆ—è¡¨\ncurl http://localhost:8080/tasks?assignee=1 [{\u0026#34;id\u0026#34;:\u0026#34;12505\u0026#34;,\u0026#34;name\u0026#34;:\u0026#34;my task\u0026#34;}] å¯æµåŠ¨çš„æ‰§è¡Œå™¨ç«¯ç‚¹ # "},{"id":206,"href":"/zh/docs/study/Flowable/offical/04/","title":"Flowable-04-spring","section":"å®˜æ–¹æ–‡æ¡£","content":" ProcessEngineFactoryBean # å°†ProcessEngineé…ç½®ä¸ºå¸¸è§„çš„SpringBean\n\u0026lt;bean id=\u0026#34;processEngineConfiguration\u0026#34; class=\u0026#34;org.flowable.spring.SpringProcessEngineConfiguration\u0026#34;\u0026gt; ... \u0026lt;/bean\u0026gt; \u0026lt;bean id=\u0026#34;processEngine\u0026#34; class=\u0026#34;org.flowable.spring.ProcessEngineFactoryBean\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;processEngineConfiguration\u0026#34; ref=\u0026#34;processEngineConfiguration\u0026#34; /\u0026gt; \u0026lt;/bean\u0026gt; ä½¿ç”¨transaction\n\u0026lt;beans xmlns=\u0026#34;http://www.springframework.org/schema/beans\u0026#34; xmlns:context=\u0026#34;http://www.springframework.org/schema/context\u0026#34; xmlns:tx=\u0026#34;http://www.springframework.org/schema/tx\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd\u0026#34;\u0026gt; \u0026lt;bean id=\u0026#34;dataSource\u0026#34; class=\u0026#34;org.springframework.jdbc.datasource.SimpleDriverDataSource\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;driverClass\u0026#34; value=\u0026#34;org.h2.Driver\u0026#34; /\u0026gt; \u0026lt;property name=\u0026#34;url\u0026#34; value=\u0026#34;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000\u0026#34; /\u0026gt; \u0026lt;property name=\u0026#34;username\u0026#34; value=\u0026#34;sa\u0026#34; /\u0026gt; \u0026lt;property name=\u0026#34;password\u0026#34; value=\u0026#34;\u0026#34; /\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;bean id=\u0026#34;transactionManager\u0026#34; class=\u0026#34;org.springframework.jdbc.datasource.DataSourceTransactionManager\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;dataSource\u0026#34; ref=\u0026#34;dataSource\u0026#34; /\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;bean id=\u0026#34;processEngineConfiguration\u0026#34; class=\u0026#34;org.flowable.spring.SpringProcessEngineConfiguration\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;dataSource\u0026#34; ref=\u0026#34;dataSource\u0026#34; /\u0026gt; \u0026lt;property name=\u0026#34;transactionManager\u0026#34; ref=\u0026#34;transactionManager\u0026#34; /\u0026gt; \u0026lt;property name=\u0026#34;databaseSchemaUpdate\u0026#34; value=\u0026#34;true\u0026#34; /\u0026gt; \u0026lt;property name=\u0026#34;asyncExecutorActivate\u0026#34; value=\u0026#34;false\u0026#34; /\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;bean id=\u0026#34;processEngine\u0026#34; class=\u0026#34;org.flowable.spring.ProcessEngineFactoryBean\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;processEngineConfiguration\u0026#34; ref=\u0026#34;processEngineConfiguration\u0026#34; /\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;bean id=\u0026#34;repositoryService\u0026#34; factory-bean=\u0026#34;processEngine\u0026#34; factory-method=\u0026#34;getRepositoryService\u0026#34; /\u0026gt; \u0026lt;bean id=\u0026#34;runtimeService\u0026#34; factory-bean=\u0026#34;processEngine\u0026#34; factory-method=\u0026#34;getRuntimeService\u0026#34; /\u0026gt; \u0026lt;bean id=\u0026#34;taskService\u0026#34; factory-bean=\u0026#34;processEngine\u0026#34; factory-method=\u0026#34;getTaskService\u0026#34; /\u0026gt; \u0026lt;bean id=\u0026#34;historyService\u0026#34; factory-bean=\u0026#34;processEngine\u0026#34; factory-method=\u0026#34;getHistoryService\u0026#34; /\u0026gt; \u0026lt;bean id=\u0026#34;managementService\u0026#34; factory-bean=\u0026#34;processEngine\u0026#34; factory-method=\u0026#34;getManagementService\u0026#34; /\u0026gt; ... è¿˜åŒ…æ‹¬äº†å…¶ä»–çš„ä¸€äº›bean\n\u0026lt;beans\u0026gt; ... \u0026lt;tx:annotation-driven transaction-manager=\u0026#34;transactionManager\u0026#34;/\u0026gt; \u0026lt;bean id=\u0026#34;userBean\u0026#34; class=\u0026#34;org.flowable.spring.test.UserBean\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;runtimeService\u0026#34; ref=\u0026#34;runtimeService\u0026#34; /\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;bean id=\u0026#34;printer\u0026#34; class=\u0026#34;org.flowable.spring.test.Printer\u0026#34; /\u0026gt; \u0026lt;/beans\u0026gt; ä½¿ç”¨\nä½¿ç”¨XMLèµ„æºæ–¹å¼ç±»é…ç½®Springåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡\nClassPathXmlApplicationContext applicationContext = new ClassPathXmlApplicationContext( \u0026#34;org/flowable/examples/spring/SpringTransactionIntegrationTest-context.xml\u0026#34;); æˆ–è€…æ·»åŠ æ³¨è§£\n@ContextConfiguration( \u0026#34;classpath:org/flowable/spring/test/transaction/SpringTransactionIntegrationTest-context.xml\u0026#34;) è·å–æœåŠ¡beanå¹¶è¿›è¡Œéƒ¨ç½²æµç¨‹\nRepositoryService repositoryService = (RepositoryService) applicationContext.getBean(\u0026#34;repositoryService\u0026#34;); String deploymentId = repositoryService .createDeployment() .addClasspathResource(\u0026#34;org/flowable/spring/test/hello.bpmn20.xml\u0026#34;) .deploy() .getId(); ä¸‹é¢çœ‹userBeanç±»ï¼Œä½¿ç”¨äº†Transactionäº‹åŠ¡\npublic class UserBean { /** injected by Spring */ private RuntimeService runtimeService; @Transactional public void hello() { // here you can do transactional stuff in your domain model // and it will be combined in the same transaction as // the startProcessInstanceByKey to the Flowable RuntimeService runtimeService.startProcessInstanceByKey(\u0026#34;helloProcess\u0026#34;); } public void setRuntimeService(RuntimeService runtimeService) { this.runtimeService = runtimeService; } } ä½¿ç”¨userBean\nUserBean userBean = (UserBean) applicationContext.getBean(\u0026#34;userBean\u0026#34;); userBean.hello(); è¡¨è¾¾å¼ # BPMN æµç¨‹ä¸­çš„æ‰€æœ‰è¡¨è¾¾å¼ä¹Ÿå°†é»˜è®¤â€œçœ‹åˆ°â€æ‰€æœ‰ Spring bean\nè¦å®Œå…¨ä¸æš´éœ²ä»»ä½• beanï¼Œåªéœ€å°†ä¸€ä¸ªç©ºåˆ—è¡¨ä½œä¸º SpringProcessEngineConfiguration ä¸Šçš„â€œbeansâ€å±æ€§ä¼ é€’ã€‚å½“æ²¡æœ‰è®¾ç½® \u0026lsquo;beans\u0026rsquo; å±æ€§æ—¶ï¼Œä¸Šä¸‹æ–‡ä¸­çš„æ‰€æœ‰ Spring beans éƒ½å°†å¯ç”¨\nå¦‚ä¸‹ï¼Œå¯ä»¥è®¾ç½®æš´éœ²çš„bean\n\u0026lt;bean id=\u0026#34;processEngineConfiguration\u0026#34; class=\u0026#34;org.flowable.spring.SpringProcessEngineConfiguration\u0026#34;\u0026gt; ... \u0026lt;property name=\u0026#34;beans\u0026#34;\u0026gt; \u0026lt;map\u0026gt; \u0026lt;entry key=\u0026#34;printer\u0026#34; value-ref=\u0026#34;printer\u0026#34; /\u0026gt; \u0026lt;/map\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;bean id=\u0026#34;printer\u0026#34; class=\u0026#34;org.flowable.examples.spring.Printer\u0026#34; /\u0026gt; ç°åœ¨çš„beanè¿›è¡Œå…¬å¼€äº†ï¼Œåœ¨.bpmn20.xmlä¸­å¯ä»¥ä½¿ç”¨\n\u0026lt;definitions id=\u0026#34;definitions\u0026#34;\u0026gt; \u0026lt;process id=\u0026#34;helloProcess\u0026#34;\u0026gt; \u0026lt;startEvent id=\u0026#34;start\u0026#34; /\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;flow1\u0026#34; sourceRef=\u0026#34;start\u0026#34; targetRef=\u0026#34;print\u0026#34; /\u0026gt; \u0026lt;serviceTask id=\u0026#34;print\u0026#34; flowable:expression=\u0026#34;#{printer.printMessage()}\u0026#34; /\u0026gt; \u0026lt;sequenceFlow id=\u0026#34;flow2\u0026#34; sourceRef=\u0026#34;print\u0026#34; targetRef=\u0026#34;end\u0026#34; /\u0026gt; \u0026lt;endEvent id=\u0026#34;end\u0026#34; /\u0026gt; \u0026lt;/process\u0026gt; \u0026lt;/definitions\u0026gt; Printç±»\npublic class Printer { public void printMessage() { System.out.println(\u0026#34;hello world\u0026#34;); } } springé…ç½®bean\n\u0026lt;beans\u0026gt; ... \u0026lt;bean id=\u0026#34;printer\u0026#34; class=\u0026#34;org.flowable.examples.spring.Printer\u0026#34; /\u0026gt; \u0026lt;/beans\u0026gt; è‡ªåŠ¨èµ„æºéƒ¨ç½² # \u0026lt;bean id=\u0026#34;processEngineConfiguration\u0026#34; class=\u0026#34;org.flowable.spring.SpringProcessEngineConfiguration\u0026#34;\u0026gt; ... \u0026lt;property name=\u0026#34;deploymentResources\u0026#34; value=\u0026#34;classpath*:/org/flowable/spring/test/autodeployment/autodeploy.*.bpmn20.xml\u0026#34; /\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;bean id=\u0026#34;processEngine\u0026#34; class=\u0026#34;org.flowable.spring.ProcessEngineFactoryBean\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;processEngineConfiguration\u0026#34; ref=\u0026#34;processEngineConfiguration\u0026#34; /\u0026gt; \u0026lt;/bean\u0026gt; å•å…ƒæµ‹è¯• # @ExtendWith(FlowableSpringExtension.class) @ExtendWith(SpringExtension.class) @ContextConfiguration(classes = SpringJunitJupiterTest.TestConfiguration.class) public class MyBusinessProcessTest { @Autowired private RuntimeService runtimeService; @Autowired private TaskService taskService; @Test @Deployment void simpleProcessTest() { runtimeService.startProcessInstanceByKey(\u0026#34;simpleProcess\u0026#34;); Task task = taskService.createTaskQuery().singleResult(); assertEquals(\u0026#34;My Task\u0026#34;, task.getName()); taskService.complete(task.getId()); assertEquals(0, runtimeService.createProcessInstanceQuery().count()); } } "},{"id":207,"href":"/zh/docs/study/Flowable/offical/03/","title":"Flowable-03-api","section":"å®˜æ–¹æ–‡æ¡£","content":" æµç¨‹å¼•æ“APIå’ŒæœåŠ¡ # å¼•æ“APIæ˜¯ä¸Flowableäº¤äº’çš„å¸¸è§æ–¹å¼ï¼Œä¸»è¦èµ·ç‚¹æ˜¯ProcessEngineï¼Œå¯ä»¥é€šè¿‡é…ç½®ï¼ˆConfigurationç« èŠ‚ï¼‰ä¸­æè¿°çš„å¤šç§æ–¹å¼åˆ›å»ºã€‚\nä»ProcessEngineè·å–åŒ…å«å·¥ä½œæµ/BPMæ–¹æ³•çš„å„ç§æœåŠ¡ã€‚ProcessEngineå’ŒæœåŠ¡å¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„\nä¸‹é¢æ˜¯é€šè¿‡processEngineè·å–å„ç§æœåŠ¡çš„æ–¹æ³•\nProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine(); RuntimeService runtimeService = processEngine.getRuntimeService(); RepositoryService repositoryService = processEngine.getRepositoryService(); TaskService taskService = processEngine.getTaskService(); ManagementService managementService = processEngine.getManagementService(); IdentityService identityService = processEngine.getIdentityService(); HistoryService historyService = processEngine.getHistoryService(); FormService formService = processEngine.getFormService(); DynamicBpmnService dynamicBpmnService = processEngine.getDynamicBpmnService(); ProcessEngines.getDefaultProcessEngine()åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶åˆå§‹åŒ–å¹¶æ„å»ºæµç¨‹å¼•æ“ï¼Œç„¶åè¿”å›ç›¸åŒçš„æµç¨‹å¼•æ“\nProcessEnginesç±»å°†æ‰«ææ‰€æœ‰flowable.cfg.xmlå’Œflowable-context.xmlæ–‡ä»¶ã€‚\nå¯¹äºæ‰€æœ‰ flowable.cfg.xml æ–‡ä»¶ï¼Œæµç¨‹å¼•æ“å°†ä»¥å…¸å‹çš„ Flowable æ–¹å¼æ„å»ºï¼šProcessEngineConfiguration.createProcessEngineConfigurationFromInputStream(inputStream).buildProcessEngine()ã€‚\nå¯¹äºæ‰€æœ‰ flowable-context.xml æ–‡ä»¶ï¼Œæµç¨‹å¼•æ“å°†ä»¥ Spring æ–¹å¼æ„å»ºï¼šé¦–å…ˆåˆ›å»º Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œç„¶åä»è¯¥åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­è·å–æµç¨‹å¼•æ“ã€‚\nThe RepositoryService is probably the first service needed when working with the Flowable engine.\nè¯¥æœåŠ¡**(RepositoryService)æä¾›ç”¨äºç®¡ç†å’Œæ“ä½œéƒ¨ç½²deployments**å’Œæµç¨‹å®šä¹‰çš„æ“ä½œ\næŸ¥è¯¢å¼•æ“å·²çŸ¥çš„éƒ¨ç½²å’Œæµç¨‹å®šä¹‰ æš‚åœå’Œæ¿€æ´»ä½œä¸ºä¸€ä¸ªæ•´ä½“æˆ–ç‰¹å®šæµç¨‹å®šä¹‰çš„éƒ¨ç½²ã€‚æŒ‚èµ·æ„å‘³ç€ä¸èƒ½å¯¹å®ƒä»¬æ‰§è¡Œè¿›ä¸€æ­¥çš„æ“ä½œï¼Œè€Œæ¿€æ´»åˆ™ç›¸åå¹¶å†æ¬¡å¯ç”¨æ“ä½œ æ£€ç´¢å„ç§èµ„æºï¼Œä¾‹å¦‚å¼•æ“è‡ªåŠ¨ç”Ÿæˆçš„éƒ¨ç½²æˆ–æµç¨‹å›¾ä¸­åŒ…å«çš„æ–‡ä»¶ æ£€ç´¢æµç¨‹å®šä¹‰çš„ POJO ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬å¯ç”¨äºä½¿ç”¨ Java è€Œä¸æ˜¯ XML æ¥å†…çœæµç¨‹ RepositoryServiceä¸»è¦æ˜¯å…³äºé™æ€ä¿¡æ¯ï¼ˆä¸ä¼šæ”¹å˜çš„æ•°æ®ï¼Œæˆ–è€…è‡³å°‘ä¸ä¼šæ”¹å˜å¤ªå¤šï¼‰ï¼Œè€ŒRuntimeServiceå¤„ç†å¯åŠ¨æµç¨‹å®šä¹‰çš„æ–°æµç¨‹å®ä¾‹\næµç¨‹å®šä¹‰å®šä¹‰äº†æµç¨‹ä¸­ä¸åŒæ­¥éª¤çš„ç»“æ„å’Œè¡Œä¸ºï¼Œæµç¨‹å®ä¾‹æ˜¯æ­¤ç±»æµç¨‹å®šä¹‰çš„ä¸€æ¬¡æ‰§è¡Œ\nå¯¹äºæ¯ä¸ªæµç¨‹å®šä¹‰ï¼Œé€šå¸¸æœ‰è®¸å¤šå®ä¾‹åŒæ—¶è¿è¡Œ\nRuntimeä¹Ÿç”¨äºæ£€ç´¢å’Œå­˜å‚¨æµç¨‹å˜é‡\nRuntimeserviceè¿˜å¯ä»¥ç”¨æ¥æŸ¥è¯¢æµç¨‹å®ä¾‹å’Œæ‰§è¡Œ(executions)\nExecutions are a representation of the \u0026rsquo;token\u0026rsquo; concept of BPMN 2.0. æ‰§è¡Œæ˜¯æŒ‡å‘æµç¨‹å®ä¾‹å½“å‰æ‰€åœ¨ä½ç½®çš„æŒ‡é’ˆ\nåªè¦æµç¨‹å®ä¾‹æ­£åœ¨ç­‰å¾…å¤–éƒ¨è§¦å‘å™¨å¹¶ä¸”æµç¨‹éœ€è¦ç»§ç»­ï¼Œå°±ä¼šä½¿ç”¨ RuntimeService\næµç¨‹å®ä¾‹å¯ä»¥æœ‰å„ç§ç­‰å¾…çŠ¶æ€ï¼Œå¹¶ä¸”è¯¥æœåŠ¡åŒ…å«å„ç§æ“ä½œä»¥å‘å®ä¾‹å‘å‡ºâ€œä¿¡å·â€ï¼Œå³æ¥æ”¶åˆ°å¤–éƒ¨è§¦å‘å™¨å¹¶ä¸”æµç¨‹å®ä¾‹å¯ä»¥ç»§ç»­\néœ€è¦ç”±ç³»ç»Ÿçš„äººç±»ç”¨æˆ·æ‰§è¡Œçš„ä»»åŠ¡æ˜¯BPMå¼•æ“ï¼ˆå¦‚Floableï¼‰çš„æ ¸å¿ƒï¼Œå›´ç»•ä»»åŠ¡çš„æ‰€æœ‰å†…å®¹éƒ½åœ¨TaskServiceä¸­è¿›è¡Œåˆ†ç»„\næŸ¥è¯¢åˆ†é…ç»™ç”¨æˆ·æˆ–ç»„çš„ä»»åŠ¡ åˆ›å»ºæ–°çš„ç‹¬ç«‹ä»»åŠ¡ï¼ˆä¸æµç¨‹å®ä¾‹æ— å…³ï¼‰ ä»»åŠ¡è¢«åˆ†é…ç»™å“ªä¸ªç”¨æˆ·æˆ–å“ªäº›ç”¨æˆ·ï¼Œä»¥åŠè®©è¿™äº›ç”¨æˆ·ä»¥æŸç§æ–¹å¼å‚ä¸è¯¥ä»»åŠ¡ è¦æ±‚å¹¶å®Œæˆä¸€é¡¹ä»»åŠ¡ï¼Œå£°æ˜æ„å‘³ç€æŸäººå†³å®šæˆä¸ºè¯¥ä»»åŠ¡çš„å—è®©äººassignee IdentityServiceæ”¯æŒç»„å’Œç”¨æˆ·çš„ç®¡ç†ï¼ˆåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ã€æŸ¥è¯¢ï¼‰\nFormServiceæ˜¯å¯é€‰æœåŠ¡ï¼Œå¼•å…¥äº†å¯åŠ¨è¡¨å•ï¼ˆstart formï¼‰å’Œä»»åŠ¡è¡¨å•(a task form)çš„æ¦‚å¿µ\nHistoryServiceå…¬å¼€äº† Flowable å¼•æ“æ”¶é›†çš„æ‰€æœ‰å†å²æ•°æ®ã€‚åœ¨æ‰§è¡Œæµç¨‹æ—¶ï¼Œå¼•æ“å¯ä»¥ä¿ç•™å¾ˆå¤šæ•°æ®ï¼ˆè¿™æ˜¯å¯é…ç½®çš„ï¼‰ï¼Œä¾‹å¦‚æµç¨‹å®ä¾‹çš„å¯åŠ¨æ—¶é—´ï¼Œè°åšäº†å“ªäº›ä»»åŠ¡ï¼Œå®Œæˆä»»åŠ¡èŠ±äº†å¤šé•¿æ—¶é—´ï¼Œæ¯ä¸ªæµç¨‹å®ä¾‹ä¸­éµå¾ªçš„è·¯å¾„ï¼Œç­‰ç­‰ã€‚\nä½¿ç”¨Flowable ç¼–å†™è‡ªå®šä¹‰åº”ç”¨ç¨‹åºæ—¶ï¼Œé€šå¸¸ä¸éœ€è¦**ManagementService ã€‚**å®ƒå…è®¸æ£€ç´¢æœ‰å…³æ•°æ®åº“è¡¨å’Œè¡¨å…ƒæ•°æ®çš„ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å…¬å¼€äº†ä½œä¸šçš„æŸ¥è¯¢åŠŸèƒ½å’Œç®¡ç†æ“ä½œ\nDynamicBpmnServiceå¯ç”¨äºæ›´æ”¹æµç¨‹å®šä¹‰çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ— éœ€é‡æ–°éƒ¨ç½²å®ƒã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æ›´æ”¹æµç¨‹å®šä¹‰ä¸­ç”¨æˆ·ä»»åŠ¡çš„å—ç†äººå®šä¹‰ï¼Œæˆ–æ›´æ”¹æœåŠ¡ä»»åŠ¡çš„ç±»åã€‚\nå¼‚å¸¸ç­–ç•¥ # Flowable ä¸­çš„åŸºæœ¬å¼‚å¸¸æ˜¯ org.flowable.engine.FlowableException\nFlowableçš„ä¸€äº›å¼‚å¸¸å­ç±»\nFlowableWrongDbExceptionï¼šå½“ Flowable å¼•æ“å‘ç°æ•°æ®åº“æ¶æ„ç‰ˆæœ¬å’Œå¼•æ“ç‰ˆæœ¬ä¸åŒ¹é…æ—¶æŠ›å‡ºã€‚ FlowableOptimisticLockingExceptionï¼šå½“å¹¶å‘è®¿é—®åŒä¸€æ•°æ®æ¡ç›®å¯¼è‡´æ•°æ®å­˜å‚¨å‘ç”Ÿä¹è§‚é”å®šæ—¶æŠ›å‡ºã€‚ FlowableClassLoadingExceptionï¼šå½“è¯·æ±‚åŠ è½½çš„ç±»æœªæ‰¾åˆ°æˆ–åŠ è½½æ—¶å‘ç”Ÿé”™è¯¯æ—¶æŠ›å‡ºï¼ˆä¾‹å¦‚ JavaDelegatesã€TaskListeners \u0026hellip;\u0026hellip;ï¼‰ã€‚ FlowableObjectNotFoundExceptionï¼šå½“è¯·æ±‚æˆ–æ“ä½œçš„å¯¹è±¡ä¸å­˜åœ¨æ—¶æŠ›å‡ºã€‚ FlowableIllegalArgumentExceptionï¼šå¼‚å¸¸è¡¨æ˜åœ¨ Flowable API è°ƒç”¨ä¸­æä¾›äº†éæ³•å‚æ•°ï¼Œåœ¨å¼•æ“é…ç½®ä¸­é…ç½®äº†éæ³•å€¼ï¼Œæˆ–è€…æä¾›äº†éæ³•å€¼ï¼Œæˆ–è€…åœ¨æµç¨‹å®šä¹‰ä¸­ä½¿ç”¨äº†éæ³•å€¼ã€‚ FlowableTaskAlreadyClaimedExceptionï¼šå½“ä»»åŠ¡å·²è¢«å£°æ˜æ—¶æŠ›å‡ºï¼Œå½“ taskService.claim(\u0026hellip;) è¢«è°ƒç”¨æ—¶ æŸ¥è¯¢æ¥å£ # å¼•æ“æŸ¥è¯¢æ•°æ®æœ‰ä¸¤ç§æ–¹å¼ï¼šthe query API and native queries\nqueryAPiå…è®¸ä½¿ç”¨fluent APIç¼–å†™å®Œå…¨ç±»å‹å®‰å…¨çš„æŸ¥è¯¢ï¼Œä¾‹å¦‚\nList\u0026lt;Task\u0026gt; tasks = taskService.createTaskQuery() .taskAssignee(\u0026#34;kermit\u0026#34;) .processVariableValueEquals(\u0026#34;orderId\u0026#34;, \u0026#34;0815\u0026#34;) .orderByDueDate().asc() .list(); native queries ï¼ˆè¿”å›ç±»å‹ç”±æ‚¨ä½¿ç”¨çš„æŸ¥è¯¢å¯¹è±¡å®šä¹‰ï¼Œæ•°æ®æ˜ å°„åˆ°æ­£ç¡®çš„å¯¹è±¡[æ¯”å¦‚ä»»åŠ¡ã€æµç¨‹å®ä¾‹ã€æ‰§è¡Œç­‰ï¼Œä¸”æ‚¨å¿…é¡»ä½¿ç”¨åœ¨æ•°æ®åº“ä¸­å®šä¹‰çš„è¡¨æ˜å’Œåˆ—å]ï¼‰ã€‚å¦‚ä¸‹ï¼Œå¯ä»¥é€šè¿‡apiæ£€ç´¢è¡¨åç­‰ï¼Œä½¿ä¾èµ–å…³ç³»å°½å¯èƒ½å°\nList\u0026lt;Task\u0026gt; tasks = taskService.createNativeTaskQuery() .sql(\u0026#34;SELECT count(*) FROM \u0026#34; + managementService.getTableName(Task.class) + \u0026#34; T WHERE T.NAME_ = #{taskName}\u0026#34;) .parameter(\u0026#34;taskName\u0026#34;, \u0026#34;gonzoTask\u0026#34;) .list(); long count = taskService.createNativeTaskQuery() .sql(\u0026#34;SELECT count(*) FROM \u0026#34; + managementService.getTableName(Task.class) + \u0026#34; T1, \u0026#34; + managementService.getTableName(VariableInstanceEntity.class) + \u0026#34; V1 WHERE V1.TASK_ID_ = T1.ID_\u0026#34;) .count(); å˜é‡ # æ¯ä¸ªæµç¨‹å®ä¾‹éƒ½éœ€è¦å¹¶ä½¿ç”¨æ•°æ®æ¥æ‰§è¡Œå…¶ç»„æˆçš„æ­¥éª¤ã€‚åœ¨ Flowable ä¸­ï¼Œè¿™äº›æ•°æ®ç§°ä¸ºå˜é‡ï¼Œå­˜å‚¨åœ¨æ•°æ®åº“ä¸­\næµç¨‹å®ä¾‹å¯ä»¥æœ‰å˜é‡ï¼ˆç§°ä¸ºæµç¨‹å˜é‡ï¼‰ï¼Œä¹Ÿå¯ä»¥æœ‰æ‰§è¡Œï¼ˆæŒ‡å‘æµç¨‹å¤„äºæ´»åŠ¨çŠ¶æ€çš„ç‰¹å®šæŒ‡é’ˆï¼‰ã€‚ç”¨æˆ·ä»»åŠ¡ä¹Ÿå¯ä»¥æœ‰å˜é‡ï¼Œå˜é‡å­˜å‚¨åœ¨ACT_RU_VARIABLEæ•°æ®åº“è¡¨ä¸­\næ‰€æœ‰startProcessInstanceXXXæ–¹æ³•éƒ½æœ‰ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œç”¨äºåœ¨åˆ›å»ºå’Œå¯åŠ¨æµç¨‹å®ä¾‹æ—¶æä¾›å˜é‡\nProcessInstance startProcessInstanceByKey(String processDefinitionKey, Map\u0026lt;String, Object\u0026gt; variables); å¯ä»¥åœ¨æµç¨‹æ‰§è¡ŒæœŸé—´æ·»åŠ å˜é‡ã€‚ä¾‹å¦‚ï¼Œï¼ˆRuntimeServiceï¼‰\nvoid setVariable(String executionId, String variableName, Object value); void setVariableLocal(String executionId, String variableName, Object value); void setVariables(String executionId, Map\u0026lt;String, ? extends Object\u0026gt; variables); void setVariablesLocal(String executionId, Map\u0026lt;String, ? extends Object\u0026gt; variables); æ£€ç´¢å˜é‡ TaskServiceä¸Šå­˜åœ¨ç±»ä¼¼çš„æ–¹æ³•ã€‚è¿™æ„å‘³ç€ä»»åŠ¡ï¼ˆå¦‚æ‰§è¡Œï¼‰å¯ä»¥å…·æœ‰ä»…åœ¨ä»»åŠ¡æœŸé—´â€œæ´»åŠ¨â€çš„å±€éƒ¨å˜é‡\nMap\u0026lt;String, Object\u0026gt; getVariables(String executionId); Map\u0026lt;String, Object\u0026gt; getVariablesLocal(String executionId); Map\u0026lt;String, Object\u0026gt; getVariables(String executionId, Collection\u0026lt;String\u0026gt; variableNames); Map\u0026lt;String, Object\u0026gt; getVariablesLocal(String executionId, Collection\u0026lt;String\u0026gt; variableNames); Object getVariable(String executionId, String variableName); \u0026lt;T\u0026gt; T getVariable(String executionId, String variableName, Class\u0026lt;T\u0026gt; variableClass); å½“å‰æ‰§è¡Œæˆ–ä»»åŠ¡å¯¹è±¡æ˜¯å¯ç”¨çš„ï¼Œå®ƒå¯ä»¥ç”¨äºå˜é‡è®¾ç½®å’Œ/æˆ–æ£€ç´¢\nexecution.getVariables(); execution.getVariables(Collection\u0026lt;String\u0026gt; variableNames); execution.getVariable(String variableName); execution.setVariables(Map\u0026lt;String, object\u0026gt; variables); execution.setVariable(String variableName, Object value); åœ¨æ‰§è¡Œä¸Šè¿°ä»»ä½•è°ƒç”¨æ—¶ï¼Œæ‰€æœ‰å˜é‡éƒ½ä¼šåœ¨åå°ä»æ•°æ®åº“ä¸­è·å–ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæ‚¨æœ‰ 10 ä¸ªå˜é‡ï¼Œä½†åªèƒ½é€šè¿‡*getVariable(\u0026ldquo;myVariable\u0026rdquo;)*è·å¾—ä¸€ä¸ªï¼Œé‚£ä¹ˆåœ¨å¹•åå°†è·å–å¹¶ç¼“å­˜å…¶ä»– 9 ä¸ª\næ¥ä¸Šè¿°ï¼Œå¯ä»¥è®¾ç½®æ˜¯å¦ç¼“å­˜æ‰€æœ‰å˜é‡\nMap\u0026lt;String, Object\u0026gt; getVariables(Collection\u0026lt;String\u0026gt; variableNames, boolean fetchAllVariables); Object getVariable(String variableName, boolean fetchAllVariables); void setVariable(String variableName, Object value, boolean fetchAllVariables); ç¬æ€å˜é‡ # ç¬æ€å˜é‡æ˜¯è¡Œä¸ºç±»ä¼¼äºå¸¸è§„å˜é‡ä½†ä¸æŒä¹…çš„å˜é‡ã€‚é€šå¸¸ï¼Œç¬æ€å˜é‡ç”¨äºé«˜çº§ç”¨ä¾‹\nå¯¹äºç¬æ€å˜é‡ï¼Œæ ¹æœ¬æ²¡æœ‰å­˜å‚¨å†å²è®°å½•ã€‚ ä¸å¸¸è§„å˜é‡ä¸€æ ·ï¼Œç¬æ€å˜é‡åœ¨è®¾ç½®æ—¶æ”¾åœ¨æœ€é«˜çˆ¶çº§ã€‚è¿™æ„å‘³ç€åœ¨æ‰§è¡Œæ—¶è®¾ç½®å˜é‡æ—¶ï¼Œç¬æ€å˜é‡å®é™…ä¸Šå­˜å‚¨åœ¨æµç¨‹å®ä¾‹æ‰§è¡Œä¸­ã€‚ä¸å¸¸è§„å˜é‡ä¸€æ ·ï¼Œå¦‚æœåœ¨ç‰¹å®šæ‰§è¡Œæˆ–ä»»åŠ¡ä¸Šè®¾ç½®å˜é‡ï¼Œåˆ™å­˜åœ¨æ–¹æ³•çš„å±€éƒ¨å˜ä½“ã€‚ åªèƒ½åœ¨æµç¨‹å®šä¹‰ä¸­çš„ä¸‹ä¸€ä¸ªâ€œç­‰å¾…çŠ¶æ€â€ä¹‹å‰è®¿é—®ç¬æ€å˜é‡ã€‚åœ¨é‚£ä¹‹åï¼Œä»–ä»¬å°±èµ°äº†ã€‚åœ¨è¿™é‡Œï¼Œç­‰å¾…çŠ¶æ€æ˜¯æŒ‡æµç¨‹å®ä¾‹ä¸­å®ƒè¢«æŒä¹…åŒ–åˆ°æ•°æ®å­˜å‚¨ä¸­çš„ç‚¹ã€‚è¯·æ³¨æ„ï¼Œåœ¨æ­¤å®šä¹‰ä¸­ï¼Œå¼‚æ­¥æ´»åŠ¨ä¹Ÿæ˜¯â€œç­‰å¾…çŠ¶æ€â€ï¼ ç¬æ€å˜é‡åªèƒ½ç”±setTransientVariable(name, value)è®¾ç½®ï¼Œä½†è°ƒç”¨getVariable(name)æ—¶ä¹Ÿä¼šè¿”å›ç¬æ€å˜é‡ï¼ˆä¹Ÿå­˜åœ¨ä¸€ä¸ªgetTransientVariable(name)ï¼Œå®ƒåªæ£€æŸ¥ç¬æ€å˜é‡ï¼‰ã€‚è¿™æ ·åšçš„åŸå› æ˜¯ä½¿è¡¨è¾¾å¼çš„ç¼–å†™å˜å¾—å®¹æ˜“ï¼Œå¹¶ä¸”ä½¿ç”¨å˜é‡çš„ç°æœ‰é€»è¾‘é€‚ç”¨äºè¿™ä¸¤ç§ç±»å‹ã€‚ ç¬æ€å˜é‡ä¼šéšè—åŒåçš„æŒä¹…å˜é‡ã€‚è¿™æ„å‘³ç€å½“åœ¨æµç¨‹å®ä¾‹ä¸ŠåŒæ—¶è®¾ç½®æŒä¹…å˜é‡å’Œç¬æ€å˜é‡å¹¶*è°ƒç”¨ getVariable(\u0026ldquo;someVariable\u0026rdquo;)*æ—¶ï¼Œå°†è¿”å›ç¬æ€å˜é‡å€¼ã€‚ å¯ä»¥åœ¨å¤§å¤šæ•°åœ°æ–¹è®¾ç½®å’Œè·å–ç¬æ€å˜é‡\nå…³äºJavaDelegateå®ç°ä¸­çš„DelegateExecution\nå…³äºExecutionListenerå®ç°ä¸­çš„DelegateExecutionå’Œå…³äºTaskListenerå®ç°çš„DelegateTask\né€šè¿‡æ‰§è¡Œå¯¹è±¡åœ¨è„šæœ¬ä»»åŠ¡ä¸­\né€šè¿‡è¿è¡Œæ—¶æœåŠ¡å¯åŠ¨æµç¨‹å®ä¾‹æ—¶\nå®Œæˆä»»åŠ¡æ—¶\nè°ƒç”¨runtimeService.triggeræ–¹æ³•æ—¶\næ–¹æ³•\nvoid setTransientVariable(String variableName, Object variableValue); void setTransientVariableLocal(String variableName, Object variableValue); void setTransientVariables(Map\u0026lt;String, Object\u0026gt; transientVariables); void setTransientVariablesLocal(Map\u0026lt;String, Object\u0026gt; transientVariables); Object getTransientVariable(String variableName); Object getTransientVariableLocal(String variableName); Map\u0026lt;String, Object\u0026gt; getTransientVariables(); Map\u0026lt;String, Object\u0026gt; getTransientVariablesLocal(); void removeTransientVariable(String variableName); void removeTransientVariableLocal(String variableName); å…¸å‹ç¤ºä¾‹ ç¬æ€å˜é‡ä¼ é€’\nProcessInstance processInstance = runtimeService.createProcessInstanceBuilder() .processDefinitionKey(\u0026#34;someKey\u0026#34;) .transientVariable(\u0026#34;configParam01\u0026#34;, \u0026#34;A\u0026#34;) .transientVariable(\u0026#34;configParam02\u0026#34;, \u0026#34;B\u0026#34;) .transientVariable(\u0026#34;configParam03\u0026#34;, \u0026#34;C\u0026#34;) .start(); è·å–æ•°æ®\npublic static class FetchDataServiceTask implements JavaDelegate { public void execute(DelegateExecution execution) { String configParam01 = (String) execution.getVariable(configParam01); // ... RestResponse restResponse = executeRestCall(); execution.setTransientVariable(\u0026#34;response\u0026#34;, restResponse.getBody()); execution.setTransientVariable(\u0026#34;status\u0026#34;, restResponse.getStatus()); } } ç¦»å¼€ç‹¬å ç½‘å…³çš„åºåˆ—æµçš„æ¡ä»¶ä¸çŸ¥é“ä½¿ç”¨çš„æ˜¯æŒä¹…å˜é‡è¿˜æ˜¯ç¬æ€å˜é‡ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸ºçŠ¶æ€ç¬æ€å˜é‡ï¼‰ï¼š\n\u0026lt;conditionExpression xsi:type=\u0026#34;tFormalExpression\u0026#34;\u0026gt;${status == 200}\u0026lt;/conditionExpression\u0026gt; è¡¨è¾¾å¼ # Flowableä½¿ç”¨UELè¿›è¡Œè¡¨è¾¾å¼è§£æï¼ŒUELä»£è¡¨ç»Ÿä¸€è¡¨è¾¾å¼è¯­è¨€ï¼Œæ˜¯EE6è§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚ä¸¤ç§ç±»å‹çš„è¡¨è¾¾å¼ï¼ˆå€¼è¡¨è¾¾å¼å’Œæ–¹æ³•è¡¨è¾¾å¼ï¼‰ï¼Œéƒ½å¯ä»¥åœ¨éœ€è¦è¡¨è¾¾å¼çš„åœ°æ–¹ä½¿ç”¨\nå€¼è¡¨è¾¾å¼ï¼Œè§£æä¸ºä¸€ä¸ªå€¼\n${myVar} ${myBean.myProperty} æ–¹æ³•è¡¨è¾¾å¼ï¼šè°ƒç”¨å¸¦æˆ–ä¸å¸¦å‚æ•°çš„æ–¹æ³•\n${printer.print()} ${myBean.addNewOrder(\u0026#39;orderName\u0026#39;)} ${myBean.doSomething(myVar, execution)} è¡¨è¾¾å¼å‡½æ•° # ä¸€äº›å¼€ç®±å³ç”¨çš„å‡½æ•°\nvariables:get(varName)ï¼šæ£€ç´¢å˜é‡çš„å€¼ã€‚ä¸ç›´æ¥åœ¨è¡¨è¾¾å¼ä¸­å†™å˜é‡åçš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œå½“å˜é‡ä¸å­˜åœ¨æ—¶ï¼Œä½¿ç”¨è¿™ä¸ªå‡½æ•°ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ä¾‹å¦‚ï¼Œå¦‚æœmyVariableä¸å­˜åœ¨ï¼Œ*${myVariable == \u0026ldquo;hello\u0026rdquo;}ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½†${var:get(myVariable) == \u0026lsquo;hello\u0026rsquo;}*ä¼šæ­£å¸¸å·¥ä½œã€‚ variables:getOrDefault(varName, defaultValue)ï¼šç±»ä¼¼äºgetï¼Œä½†å¯ä»¥é€‰æ‹©æä¾›é»˜è®¤å€¼ï¼Œå½“å˜é‡æœªè®¾ç½®æˆ–å€¼ä¸ºnullæ—¶è¿”å›ã€‚ variables:exists(varName) ï¼šå¦‚æœå˜é‡å…·æœ‰éç©ºå€¼ï¼Œåˆ™è¿”å›true ã€‚ variables:isEmpty(varName) (alias :empty ) : æ£€æŸ¥å˜é‡å€¼æ˜¯å¦ä¸ä¸ºç©ºã€‚æ ¹æ®å˜é‡ç±»å‹ï¼Œè¡Œä¸ºå¦‚ä¸‹ï¼š å¯¹äºå­—ç¬¦ä¸²å˜é‡ï¼Œå¦‚æœå˜é‡æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œåˆ™è®¤ä¸ºè¯¥å˜é‡ä¸ºç©ºã€‚ å¯¹äº java.util.Collection å˜é‡ï¼Œå¦‚æœé›†åˆæ²¡æœ‰å…ƒç´ ï¼Œåˆ™è¿”å›true ã€‚ å¯¹äº ArrayNode å˜é‡ï¼Œå¦‚æœæ²¡æœ‰å…ƒç´ åˆ™è¿”å›true å¦‚æœå˜é‡ä¸ºnullï¼Œåˆ™å§‹ç»ˆè¿”å›true variables:isNotEmpty(varName) (alias : notEmpty) : isEmptyçš„é€†è¿ç®—ã€‚ variables:equals(varName, value)ï¼ˆåˆ«å*:eq*ï¼‰ï¼šæ£€æŸ¥å˜é‡æ˜¯å¦ç­‰äºç»™å®šå€¼ã€‚è¿™æ˜¯è¡¨è¾¾å¼çš„ç®€å†™å‡½æ•°ï¼Œå¦åˆ™å°†è¢«å†™ä¸º*${execution.getVariable(\u0026ldquo;varName\u0026rdquo;) != null \u0026amp;\u0026amp; execution.getVariable(\u0026ldquo;varName\u0026rdquo;) == value}*ã€‚ å¦‚æœå˜é‡å€¼ä¸º nullï¼Œåˆ™è¿”å› falseï¼ˆé™¤éä¸ null æ¯”è¾ƒï¼‰ã€‚ variables:notEquals(varName, value)ï¼ˆåˆ«å*:ne ï¼‰ï¼š* equalsçš„åå‘æ¯”è¾ƒã€‚ variables:contains(varName, value1, value2, \u0026hellip;)ï¼šæ£€æŸ¥æä¾›çš„æ‰€æœ‰å€¼æ˜¯å¦åŒ…å«åœ¨å˜é‡ä¸­ã€‚æ ¹æ®å˜é‡ç±»å‹ï¼Œè¡Œä¸ºå¦‚ä¸‹ï¼š å¯¹äºå­—ç¬¦ä¸²å˜é‡ï¼Œä¼ é€’çš„å€¼ç”¨ä½œéœ€è¦æˆä¸ºå˜é‡ä¸€éƒ¨åˆ†çš„å­å­—ç¬¦ä¸² å¯¹äº java.util.Collection å˜é‡ï¼Œæ‰€æœ‰ä¼ é€’çš„å€¼éƒ½éœ€è¦æ˜¯é›†åˆçš„ä¸€ä¸ªå…ƒç´ ï¼ˆæ­£åˆ™åŒ…å«è¯­ä¹‰ï¼‰ã€‚ å¯¹äº ArrayNode å˜é‡ï¼šæ”¯æŒæ£€æŸ¥ arraynode æ˜¯å¦åŒ…å«ä½œä¸ºå˜é‡ç±»å‹æ”¯æŒçš„ç±»å‹çš„ JsonNode å½“å˜é‡å€¼ä¸º null æ—¶ï¼Œåœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½è¿”å› falseã€‚å½“å˜é‡å€¼ä¸ä¸ºnullï¼Œä¸”å®ä¾‹ç±»å‹ä¸æ˜¯ä¸Šè¿°ç±»å‹ä¹‹ä¸€æ—¶ï¼Œä¼šè¿”å›falseã€‚ variables:containsAny(varName, value1, value2, \u0026hellip;)ï¼šç±»ä¼¼äºcontainså‡½æ•°ï¼Œä½†å¦‚æœä»»ä½•ï¼ˆè€Œéå…¨éƒ¨ï¼‰ä¼ é€’çš„å€¼åŒ…å«åœ¨å˜é‡ä¸­ï¼Œåˆ™å°†è¿”å›true ã€‚ variables:base64(varName)ï¼šå°†äºŒè¿›åˆ¶æˆ–å­—ç¬¦ä¸²å˜é‡è½¬æ¢ä¸º Base64 å­—ç¬¦ä¸² æ¯”è¾ƒå™¨åŠŸèƒ½ï¼š variables:lowerThan(varName, value) (åˆ«å*:lessThanæˆ–:lt* ) : ${execution.getVariable(\u0026ldquo;varName\u0026rdquo;) != null \u0026amp;\u0026amp; execution.getVariable(\u0026ldquo;varName\u0026rdquo;) \u0026lt; value}çš„ç®€å†™ å˜é‡ï¼šlowerThanOrEquals(varName, value)ï¼ˆåˆ«å*:lessThanOrEqualsæˆ–:lte*ï¼‰ï¼šç±»ä¼¼ï¼Œä½†ç°åœ¨ç”¨äº*\u0026lt; =* variables:greaterThan(varName, value) (alias :gt ) : ç±»ä¼¼ï¼Œä½†ç°åœ¨ç”¨äº*\u0026gt;* variables:greaterThanOrEquals(varName, value) (alias :gte ) : ç±»ä¼¼ï¼Œä½†ç°åœ¨ç”¨äº*\u0026gt; =* å•å…ƒæµ‹è¯• # ä½¿ç”¨è‡ªå®šä¹‰èµ„æºè¿›è¡Œå•å…ƒæµ‹è¯•\n@FlowableTest public class MyBusinessProcessTest { private ProcessEngine processEngine; private RuntimeService runtimeService; private TaskService taskService; @BeforeEach void setUp(ProcessEngine processEngine) { this.processEngine = processEngine; this.runtimeService = processEngine.getRuntimeService(); this.taskService = processEngine.getTaskService(); } @Test @Deployment(resources = \u0026#34;holiday-request.bpmn20.xml\u0026#34;) void testSimpleProcess() { HashMap\u0026lt;String, Object\u0026gt; employeeInfo = new HashMap\u0026lt;\u0026gt;(); employeeInfo.put(\u0026#34;employee\u0026#34;, \u0026#34;wangwu1028930\u0026#34;); //employeeInfo.put() runtimeService.startProcessInstanceByKey( \u0026#34;holidayRequest\u0026#34;, employeeInfo ); Task task = taskService.createTaskQuery().singleResult(); assertEquals(\u0026#34;Approve or reject request\u0026#34;, task.getName()); HashMap\u0026lt;String, Object\u0026gt; hashMap = new HashMap\u0026lt;\u0026gt;(); hashMap.put(\u0026#34;approved\u0026#34;, true); taskService.complete(task.getId(), hashMap); assertEquals(1, runtimeService .createProcessInstanceQuery().count()); } } è°ƒè¯•å•å…ƒæµ‹è¯• # Webåº”ç”¨ç¨‹åºä¸­çš„æµç¨‹å¼•æ“ # ç¼–å†™ä¸€ä¸ªç®€å•çš„ServletContextListeneræ¥åˆå§‹åŒ–å’Œé”€æ¯æ™®é€šServletç¯å¢ƒä¸­çš„æµç¨‹å¼•æ“\npublic class ProcessEnginesServletContextListener implements ServletContextListener { public void contextInitialized(ServletContextEvent servletContextEvent) { ProcessEngines.init(); } public void contextDestroyed(ServletContextEvent servletContextEvent) { ProcessEngines.destroy(); } } å…¶ä¸­ï¼ŒProcessEngines.init()å°†åœ¨ç±»è·¯å¾„ä¸­æŸ¥æ‰¾flowable.cfg.xmlèµ„æºæ–‡ä»¶ï¼Œå¹¶ä¸ºç»™å®šçš„é…ç½®åˆ›å»ºä¸€ä¸ªProcessEngineï¼Œä½¿ç”¨ä¸‹é¢ä¸¤ç§æ–¹å¼æ¥è·å–ä»–\nProcessEngines.getDefaultProcessEngine() //æˆ–è€…ä¸‹é¢çš„æ–¹å¼ ProcessEngines.getProcessEngine(\u0026#34;myName\u0026#34;); "},{"id":208,"href":"/zh/docs/study/Flowable/offical/02/","title":"Flowable-02-Configuration","section":"å®˜æ–¹æ–‡æ¡£","content":" åˆ›å»ºæµç¨‹å¼•æ“ # Flowable æµç¨‹å¼•æ“é€šè¿‡ä¸€ä¸ªåä¸º flowable.cfg.xml çš„ XML æ–‡ä»¶è¿›è¡Œé…ç½®\nç°åœ¨ç±»è·¯å¾„ä¸‹æ”¾ç½®floable.cfg.xmlæ–‡ä»¶\n\u0026lt;beans xmlns=\u0026#34;http://www.springframework.org/schema/beans\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\u0026#34;\u0026gt; \u0026lt;bean id=\u0026#34;processEngineConfiguration\u0026#34; class=\u0026#34;org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;jdbcUrl\u0026#34; value=\u0026#34;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000\u0026#34; /\u0026gt; \u0026lt;property name=\u0026#34;jdbcDriver\u0026#34; value=\u0026#34;org.h2.Driver\u0026#34; /\u0026gt; \u0026lt;property name=\u0026#34;jdbcUsername\u0026#34; value=\u0026#34;sa\u0026#34; /\u0026gt; \u0026lt;property name=\u0026#34;jdbcPassword\u0026#34; value=\u0026#34;\u0026#34; /\u0026gt; \u0026lt;property name=\u0026#34;databaseSchemaUpdate\u0026#34; value=\u0026#34;true\u0026#34; /\u0026gt; \u0026lt;property name=\u0026#34;asyncExecutorActivate\u0026#34; value=\u0026#34;false\u0026#34; /\u0026gt; \u0026lt;property name=\u0026#34;mailServerHost\u0026#34; value=\u0026#34;mail.my-corp.com\u0026#34; /\u0026gt; \u0026lt;property name=\u0026#34;mailServerPort\u0026#34; value=\u0026#34;5025\u0026#34; /\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;/beans\u0026gt; ç„¶åä½¿ç”¨é™æ€æ–¹æ³•è¿›è¡Œè·å–ProcessEngine\nProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine(); è¿˜æœ‰å…¶ä»–é…ç½®ï¼Œè¿™é‡Œä¸ä¸€ä¸€åˆ—ä¸¾ï¼Œè¯¦è§æ–‡æ¡£åœ°å€ https://www.flowable.com/open-source/docs/bpmn/ch03-Configuration\nå¤§è‡´ç›®å½•å¦‚ä¸‹ "},{"id":209,"href":"/zh/docs/study/Flowable/offical/01/","title":"Flowable-01-GettingStarted","section":"å®˜æ–¹æ–‡æ¡£","content":" å…¥é—¨ # ä»€ä¹ˆæ˜¯æµåŠ¨æ€§ # Flowable æ˜¯ä¸€ä¸ªç”¨ Java ç¼–å†™çš„è½»é‡çº§ä¸šåŠ¡æµç¨‹å¼•æ“ã€‚Flowable æµç¨‹å¼•æ“å…è®¸æ‚¨éƒ¨ç½² BPMN 2.0 æµç¨‹å®šä¹‰ï¼ˆç”¨äºå®šä¹‰æµç¨‹çš„è¡Œä¸š XML æ ‡å‡†ï¼‰ã€åˆ›å»ºè¿™äº›æµç¨‹å®šä¹‰çš„æµç¨‹å®ä¾‹ã€è¿è¡ŒæŸ¥è¯¢ã€è®¿é—®æ´»åŠ¨æˆ–å†å²æµç¨‹å®ä¾‹å’Œç›¸å…³æ•°æ®ç­‰ç­‰ã€‚\nå¯ä»¥ä½¿ç”¨ Flowable REST API é€šè¿‡ HTTP è¿›è¡Œé€šä¿¡ã€‚è¿˜æœ‰å‡ ä¸ª Flowable åº”ç”¨ç¨‹åºï¼ˆFlowable Modelerã€Flowable Adminã€Flowable IDM å’Œ Flowable Taskï¼‰æä¾›å¼€ç®±å³ç”¨çš„ç¤ºä¾‹ UIï¼Œç”¨äºå¤„ç†æµç¨‹å’Œä»»åŠ¡ã€‚\nFlowableå’ŒActiviti # Flowableæ˜¯Activitiçš„ä¸€ä¸ªåˆ†æ”¯\næ„å»ºå‘½ä»¤è¡Œå‘½ä»¤ # åˆ›å»ºæµç¨‹å¼•æ“ # è¯·å‡æµç¨‹å¦‚ä¸‹\nå‘˜å·¥è¦æ±‚ä¼‘å‡æ•°æ¬¡ ç»ç†æ‰¹å‡†æˆ–æ‹’ç»è¯·æ±‚ ä¹‹åå°†æ¨¡æ‹Ÿå†æŸä¸ªå¤–éƒ¨ç³»ç»Ÿä¸­æ³¨å†Œè¯·æ±‚ï¼Œå¹¶å‘å‘˜å·¥å‘é€ä¸€å°åŒ…å«ç»“æœçš„é‚®ä»¶ åˆ›å»ºä¸€ä¸ªç©ºçš„Maveé¡¹ç›®ï¼Œå¹¶æ·»åŠ ä¾èµ–\n\u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.flowable\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flowable-engine\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;6.6.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.h2database\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;h2\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.3.176\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;8.0.29\u0026lt;/version\u0026gt; \u0026lt;!--å½“ç‰ˆæœ¬å·\u0026gt;=8.0.22æ—¶ä¼šæŠ¥dateè½¬å­—ç¬¦ä¸²çš„é”™è¯¯--\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; æ·»åŠ ä¸€ä¸ªå¸¦æœ‰Mainæ–¹æ³•çš„ç±»\nè¿™é‡Œå®ä¾‹åŒ–ä¸€ä¸ªProcessEngineå®ä¾‹ï¼Œä¸€èˆ¬åªéœ€è¦å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œæ˜¯é€šè¿‡ProcessEngineConfigurationåˆ›å»ºçš„ï¼Œç”¨æ¥é…ç½®å’Œè°ƒæ•´æµç¨‹å¼•æ“çš„é…ç½®\nProcessEngineConfigurationä¹Ÿå¯ä»¥ä½¿ç”¨é…ç½® XML æ–‡ä»¶åˆ›å»º ProcessEngineConfigurationéœ€è¦çš„æœ€ä½é…ç½®æ˜¯ä¸æ•°æ®åº“çš„ JDBC è¿æ¥ package org.flowable; import org.flowable.engine.ProcessEngine; import org.flowable.engine.ProcessEngineConfiguration; import org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration; public class HolidayRequest { public static void main(String[] args) { //è¿™é‡Œæ”¹ç”¨mysqlï¼Œæ³¨æ„åé¢çš„nullCatalogMeansCurrent=true //æ³¨æ„ï¼Œpoméœ€è¦æ·»åŠ mysqlé©±åŠ¨ä¾èµ– ProcessEngineConfiguration cfg = new StandaloneProcessEngineConfiguration() .setJdbcUrl(\u0026#34;jdbc:mysql://localhost:3306/flowable_official?useUnicode=true\u0026#34; + \u0026#34;\u0026amp;characterEncoding=utf-8\u0026amp;serverTimezone=Asia/Shanghai\u0026amp;allowMultiQueries=true\u0026#34; +\u0026#34;\u0026amp;nullCatalogMeansCurrent=true\u0026#34; ) .setJdbcUsername(\u0026#34;root\u0026#34;) .setJdbcPassword(\u0026#34;123456\u0026#34;) .setJdbcDriver(\u0026#34;com.mysql.cj.jdbc.Driver\u0026#34;) .setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE); /* //è¿™æ˜¯å®˜ç½‘ï¼Œç”¨çš„h2 ProcessEngineConfiguration cfg = new StandaloneProcessEngineConfiguration() .setJdbcUrl(\u0026#34;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=-1\u0026#34;) .setJdbcUsername(\u0026#34;sa\u0026#34;) .setJdbcPassword(\u0026#34;\u0026#34;) .setJdbcDriver(\u0026#34;org.h2.Driver\u0026#34;) .setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE);*/ ProcessEngine processEngine = cfg.buildProcessEngine(); } } è¿è¡Œåä¼šå‡ºç°slf4jçš„è­¦å‘Šï¼Œæ·»åŠ ä¾èµ–å¹¶ç¼–å†™é…ç½®æ–‡ä»¶å³å¯\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.slf4j\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;slf4j-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.7.30\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.slf4j\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;slf4j-log4j12\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.7.30\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; é…ç½®æ–‡ä»¶\nlog4j.rootLogger=DEBUG, CA log4j.appender.CA=org.apache.log4j.ConsoleAppender log4j.appender.CA.layout=org.apache.log4j.PatternLayout log4j.appender.CA.layout.ConversionPattern=%d{hh:mm:ss,SSS} [%t] %-5p %c %x - %m%n é‡è¿è¡Œç¨‹åºæ— è­¦å‘Š\nä¼šè‡ªåŠ¨å¾€mysqlæ·»åŠ ä¸€äº›è¡¨åŠæ•°æ®\néƒ¨ç½²æµç¨‹å®šä¹‰ # flowable å¼•æ“å¸Œæœ›ä»¥ BPMN 2.0 æ ¼å¼å®šä¹‰æµç¨‹ï¼Œè¿™æ˜¯ä¸€ç§åœ¨è¡Œä¸šä¸­è¢«å¹¿æ³›æ¥å—çš„ XML æ ‡å‡†ã€‚Flowableæœ¯è¯­ç§°ä¹‹ä¸ºæµç¨‹å®šä¹‰ ï¼ˆå¯ä»¥ç†è§£æˆè®¸å¤šæ‰§è¡Œçš„è“å›¾ï¼‰ï¼Œä»æµç¨‹å®šä¹‰ä¸­å¯ä»¥å¯åŠ¨è®¸å¤šæµç¨‹å®ä¾‹\næµç¨‹å®šä¹‰äº†è¯·å‡å‡æœŸæ‰€æ¶‰åŠçš„ä¸åŒæ­¥éª¤ï¼Œè€Œä¸€ä¸ªæµç¨‹å®ä¾‹ä¸ä¸€ä½ç‰¹å®šå‘˜å·¥çš„å‡æœŸè¯·ç›¸åŒ¹é…ã€‚\nBPMN 2.0 å­˜å‚¨ä¸º XMLï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€ä¸ªå¯è§†åŒ–éƒ¨åˆ†ï¼šå®ƒä»¥æ ‡å‡†æ–¹å¼å®šä¹‰æ¯ä¸ªä¸åŒçš„æ­¥éª¤ç±»å‹ï¼ˆäººå·¥ä»»åŠ¡ã€è‡ªåŠ¨æœåŠ¡è°ƒç”¨ç­‰ï¼‰å¦‚ä½•è¡¨ç¤ºï¼Œä»¥åŠå¦‚ä½•å°†è¿™äº›ä¸åŒçš„æ­¥éª¤è¿æ¥åˆ°å½¼æ­¤ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒBPMN 2.0 æ ‡å‡†å…è®¸æŠ€æœ¯äººå‘˜å’Œä¸šåŠ¡äººå‘˜ä»¥åŒæ–¹éƒ½ç†è§£çš„æ–¹å¼å°±ä¸šåŠ¡æµç¨‹è¿›è¡Œäº¤æµã€‚\næˆ‘ä»¬å°†ä½¿ç”¨çš„æµç¨‹å®šä¹‰\nå‡è®¾è¯¥è¿‡ç¨‹æ˜¯é€šè¿‡æä¾›ä¸€äº›ä¿¡æ¯å¼€å§‹çš„ å·¦è¾¹çš„åœ†åœˆç§°ä¸ºå¼€å§‹äº‹ä»¶ ç¬¬ä¸€ä¸ªçŸ©å½¢æ˜¯ç”¨æˆ·ä»»åŠ¡ï¼ˆç»ç†å¿…é¡»æ‰§è¡Œï¼Œæ‰¹å‡†æˆ–æ‹’ç»ï¼‰ æ ¹æ®ç»ç†å†³å®šï¼Œä¸“ç”¨ç½‘å…³ ï¼ˆå¸¦æœ‰åå­—è±å½¢ï¼‰ä¼šå°†æµç¨‹å®ä¾‹è·¯ç”±åˆ°æ‰¹å‡†æˆ–æ‹’ç»è·¯å¾„ å¦‚æœè·å¾—æ‰¹å‡†ï¼Œå¿…é¡»åœ¨æŸä¸ªå¤–éƒ¨ç³»ç»Ÿä¸­æ³¨å†Œè¯·æ±‚ï¼Œç„¶åå†æ¬¡ä¸ºåŸå§‹å‘˜å·¥æ‰§è¡Œç”¨æˆ·ä»»åŠ¡ï¼Œé€šçŸ¥ä»–ä»¬è¯¥å†³å®š å¦‚æœè¢«æ‹’ç»ï¼Œåˆ™ä¼šå‘å‘˜å·¥å‘é€ä¸€å°ç”µå­é‚®ä»¶ï¼Œé€šçŸ¥ä»–ä»¬è¿™ä¸€ç‚¹ æ­¤ç±»æµç¨‹å®šä¹‰ä½¿ç”¨å¯è§†åŒ–å»ºæ¨¡å·¥å…·å»ºæ¨¡ï¼Œä¾‹å¦‚Flowable Designerï¼ˆEclipseï¼‰æˆ–FlowableModelerï¼ˆWebåº”ç”¨ç¨‹åºï¼‰\nBPMN 2.0 åŠå…¶æ¦‚å¿µ ä¸‹é¢çš„holiday-request.bmpn20.xmæ–‡ä»¶æ”¾åœ¨src/main/resoucesä¸­\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;definitions xmlns=\u0026#34;http://www.omg.org/spec/BPMN/20100524/MODEL\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:xsd=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; xmlns:bpmndi=\u0026#34;http://www.omg.org/spec/BPMN/20100524/DI\u0026#34; xmlns:omgdc=\u0026#34;http://www.omg.org/spec/DD/20100524/DC\u0026#34; xmlns:omgdi=\u0026#34;http://www.omg.org/spec/DD/20100524/DI\u0026#34; xmlns:flowable=\u0026#34;http://flowable.org/bpmn\u0026#34; typeLanguage=\u0026#34;http://www.w3.org/2001/XMLSchema\u0026#34; expressionLanguage=\u0026#34;http://www.w3.org/1999/XPath\u0026#34; targetNamespace=\u0026#34;http://www.flowable.org/processdef\u0026#34;\u0026gt; \u0026lt;process id=\u0026#34;holidayRequest\u0026#34; name=\u0026#34;Holiday Request\u0026#34; isExecutable=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;startEvent id=\u0026#34;startEvent\u0026#34;/\u0026gt; \u0026lt;!--çº¿æ¡æŒ‡å‘--\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;startEvent\u0026#34; targetRef=\u0026#34;approveTask\u0026#34;/\u0026gt; \u0026lt;userTask id=\u0026#34;approveTask\u0026#34; name=\u0026#34;Approve or reject request\u0026#34;/\u0026gt; \u0026lt;!--çº¿æ¡æŒ‡å‘--\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;approveTask\u0026#34; targetRef=\u0026#34;decision\u0026#34;/\u0026gt; \u0026lt;!--ç½‘å…³--\u0026gt; \u0026lt;exclusiveGateway id=\u0026#34;decision\u0026#34;/\u0026gt; \u0026lt;!--çº¿æ¡æŒ‡å‘ï¼Œä¸‹é¢æœ‰ä¸¤ä¸ªåˆ†æ”¯--\u0026gt; \u0026lt;!--çº¿æ¡æŒ‡å‘approved--\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;decision\u0026#34; targetRef=\u0026#34;externalSystemCall\u0026#34;\u0026gt; \u0026lt;conditionExpression xsi:type=\u0026#34;tFormalExpression\u0026#34;\u0026gt; \u0026lt;![CDATA[ ${approved} ]]\u0026gt; \u0026lt;/conditionExpression\u0026gt; \u0026lt;/sequenceFlow\u0026gt; \u0026lt;!--çº¿æ¡æŒ‡å‘!approved--\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;decision\u0026#34; targetRef=\u0026#34;sendRejectionMail\u0026#34;\u0026gt; \u0026lt;conditionExpression xsi:type=\u0026#34;tFormalExpression\u0026#34;\u0026gt; \u0026lt;![CDATA[ ${!approved} ]]\u0026gt; \u0026lt;/conditionExpression\u0026gt; \u0026lt;/sequenceFlow\u0026gt; \u0026lt;!--åˆ†æ”¯1--\u0026gt; \u0026lt;serviceTask id=\u0026#34;externalSystemCall\u0026#34; name=\u0026#34;Enter holidays in external system\u0026#34; flowable:class=\u0026#34;org.flowable.CallExternalSystemDelegate\u0026#34;/\u0026gt; \u0026lt;!--çº¿æ¡æŒ‡å‘--\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;externalSystemCall\u0026#34; targetRef=\u0026#34;holidayApprovedTask\u0026#34;/\u0026gt; \u0026lt;!--ç”¨æˆ·ä»»åŠ¡--\u0026gt; \u0026lt;userTask id=\u0026#34;holidayApprovedTask\u0026#34; name=\u0026#34;Holiday approved\u0026#34;/\u0026gt; \u0026lt;!--çº¿æ¡æŒ‡å‘--\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;holidayApprovedTask\u0026#34; targetRef=\u0026#34;approveEnd\u0026#34;/\u0026gt; \u0026lt;!--æœåŠ¡ä»»åŠ¡--\u0026gt; \u0026lt;serviceTask id=\u0026#34;sendRejectionMail\u0026#34; name=\u0026#34;Send out rejection email\u0026#34; flowable:class=\u0026#34;org.flowable.SendRejectionMail\u0026#34;/\u0026gt; \u0026lt;!--çº¿æ¡æŒ‡å‘--\u0026gt; \u0026lt;sequenceFlow sourceRef=\u0026#34;sendRejectionMail\u0026#34; targetRef=\u0026#34;rejectEnd\u0026#34;/\u0026gt; \u0026lt;!--åˆ†æ”¯2ç»“æŸ--\u0026gt; \u0026lt;endEvent id=\u0026#34;approveEnd\u0026#34;/\u0026gt; \u0026lt;!--åˆ†æ”¯2ç»“æŸ--\u0026gt; \u0026lt;endEvent id=\u0026#34;rejectEnd\u0026#34;/\u0026gt; \u0026lt;/process\u0026gt; \u0026lt;/definitions\u0026gt; è§£é‡Š\nè¯¥æ–‡ä»¶ä¸BPMN2.0æ ‡å‡†è§„èŒƒå®Œå…¨å…¼å®¹ æ¯ä¸ªæ­¥éª¤ï¼ˆæ´»åŠ¨ activityï¼‰ï¼Œéƒ½æœ‰ä¸€ä¸ªidå±æ€§ï¼Œåœ¨XMLä¸­ï¼Œè¯¥å±æ€§æä¾›å”¯ä¸€æ ‡è¯†ç¬¦ nameå±æ€§ä¸ºå¯é€‰çš„åç§°ï¼Œå¢åŠ äº†å¯è§†åŒ–å›¾è¡¨çš„å¯è¯»æ€§ æ´»åŠ¨é€šè¿‡**é¡ºåºæµ(sequenceFlow)**è¿æ¥ï¼Œå³å¯è§†å›¾ä¸­çš„å®šå‘ç®­å¤´ã€‚æ‰§è¡Œæµç¨‹å®ä¾‹æ—¶ï¼Œæ‰§è¡Œå°†ä»å¼€å§‹äº‹ä»¶æµå‘ä¸‹ä¸€ä¸ªæ´»åŠ¨ï¼Œä¸”éµå¾ªé¡ºåºæµ ç¦»å¼€ä¸“æœ‰ç½‘å…³çš„åºåˆ—æµï¼ˆå¸¦æœ‰ X çš„è±å½¢ï¼‰æ˜¾ç„¶æ˜¯ç‰¹æ®Šçš„ï¼šä¸¤è€…éƒ½æœ‰ä¸€ä¸ªä»¥è¡¨è¾¾å¼å½¢å¼å®šä¹‰çš„æ¡ä»¶ï¼ˆè§ç¬¬ 25 å’Œ 32 è¡Œï¼‰ã€‚å½“æµç¨‹å®ä¾‹æ‰§è¡Œåˆ°è¾¾æ­¤gatewayæ—¶ï¼Œå°†è¯„ä¼°æ¡ä»¶å¹¶é‡‡ç”¨ç¬¬ä¸€ä¸ªè§£æä¸ºtrueçš„æ¡ä»¶ã€‚è¿™å°±æ˜¯è¿™é‡Œç‹¬æœ‰çš„å«ä¹‰ï¼šåªé€‰æ‹©ä¸€ä¸ªã€‚å¦‚æœéœ€è¦ä¸åŒçš„è·¯ç”±è¡Œä¸ºï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ç±»å‹çš„ç½‘å…³ è¡¨è¾¾å¼ä»¥${approved}çš„å½¢å¼ï¼Œæ˜¯${approved == true}çš„ç®€å†™ approvedç§°ä¸ºè¿‡ç¨‹å˜é‡ï¼Œä»–ä¸æµç¨‹å®ä¾‹ä¸€èµ·å­˜å‚¨ï¼ˆæŒä¹…æ•°æ®ä¸ºï¼Œåœ¨æµç¨‹å®ä¾‹çš„å£°æ˜å‘¨æœŸå†…ä½¿ç”¨ï¼‰ï¼Œæ„å‘³ç€å¿…é¡»åœ¨æµç¨‹å®ä¾‹çš„æŸä¸ªæ—¶é—´ç‚¹ï¼ˆæäº¤ç»ç†ç”¨æˆ·ä»»åŠ¡æ—¶ï¼Œå³ç»“ç‚¹\u0026lt;userTask id=\u0026quot;approveTask\u0026quot; /\u0026gt;[Flowableæœ¯è¯­ï¼Œå®Œæˆ])è®¾ç½®æ­¤æµç¨‹å˜é‡ï¼‰ éƒ¨ç½²æµç¨‹ ä½¿ç”¨RepositoryServiceï¼Œå®ƒå¯ä»¥ä»ProcessEngineå¯¹è±¡ä¸­æ£€ç´¢ï¼Œé€šè¿‡ä¼ é€’XMLæ–‡ä»¶çš„ä½ç½®å¹¶è°ƒç”¨deploy()æ–¹æ³•æ¥æ‰§è¡Œå®ƒæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„Deployment\nRepositoryService repositoryService = processEngine.getRepositoryService(); //éƒ¨ç½²æµç¨‹ Deployment deployment = repositoryService.createDeployment() .addClasspathResource(\u0026#34;holiday-request.bpmn20.xml\u0026#34;) .deploy(); //æ‰“å°éƒ¨ç½²id System.out.println(\u0026#34;Found deployment id : \u0026#34; + deployment.getId()); æ¯æ¬¡éƒ¨ç½²çš„idå­˜åœ¨act_re_deploymentè¡¨ä¸­ é€šè¿‡APIæŸ¥è¯¢æ¥éªŒè¯å¼•æ“æ˜¯å¦çŸ¥é“æµç¨‹å®šä¹‰\nProcessDefinition processDefinition = repositoryService.createProcessDefinitionQuery() .deploymentId(deployment.getId()) .singleResult(); System.out.println(\u0026#34;Found process definition : \u0026#34; + processDefinition.getName()); å¯åŠ¨æµç¨‹å®ä¾‹ # ç°åœ¨å·²ç»å°†æµç¨‹å®šä¹‰éƒ¨ç½²åˆ°æµç¨‹å¼•æ“ä¸­äº†ï¼Œæ‰€ä»¥å¯ä»¥å°†æ­¤æµç¨‹å®šä¹‰ä½œä¸ºâ€œè“å›¾â€æ¥å¯åŠ¨æµç¨‹å®ä¾‹\nå¯åŠ¨å‰æä¾›ä¸€äº›åˆå§‹æµç¨‹å˜é‡ ï¼Œé€šå¸¸ï¼Œå½“æµç¨‹è‡ªåŠ¨è§¦å‘æ—¶ï¼Œå°†é€šè¿‡å‘ˆç°ç»™ç”¨æˆ·çš„è¡¨å•æˆ–è€…é€šè¿‡REST APIè·å¾—è¿™äº›ä¿¡æ¯ï¼Œæœ¬ä¾‹ä¸ºä¿æŒç®€å•ä½¿ç”¨java.util.Scanneråœ¨å‘½ä»¤ä¸­ç®€å•è¾“å…¥ä¸€äº›æ•°æ®\nScanner scanner= new Scanner(System.in); System.out.println(\u0026#34;Who are you?\u0026#34;); String employee = scanner.nextLine(); System.out.println(\u0026#34;How many holidays do you want to request?\u0026#34;); Integer nrOfHolidays = Integer.valueOf(scanner.nextLine()); System.out.println(\u0026#34;Why do you need them?\u0026#34;); String description = scanner.nextLine(); æ¥ä¸‹æ¥ï¼Œé€šè¿‡RuntimeServiceå¯åŠ¨ä¸€ä¸ªæµç¨‹å®ä¾‹ï¼Œæµç¨‹å®ä¾‹ä½¿ç”¨keyå¯åŠ¨ï¼Œæ­¤é”®ä¸BPMN2.0 XMLæ–‡ä»¶ä¸­è®¾ç½®çš„idå±æ€§åŒ¹é…\nRuntimeService runtimeService = processEngine.getRuntimeService(); Map\u0026lt;String, Object\u0026gt; variables = new HashMap\u0026lt;String, Object\u0026gt;(); variables.put(\u0026#34;employee\u0026#34;, employee); variables.put(\u0026#34;nrOfHolidays\u0026#34;, nrOfHolidays); variables.put(\u0026#34;description\u0026#34;, description); ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(\u0026#34;holidayRequest\u0026#34;, variables); æµç¨‹å®ä¾‹å¯åŠ¨æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ‰§è¡Œ(execution)å¹¶å°†å…¶æ”¾å…¥start eventå¯åŠ¨äº‹ä»¶ä¸­ã€‚ä¹‹åï¼Œæ­¤æ‰§è¡Œ(execution)éµå®ˆuser task ç”¨æˆ·ä»»åŠ¡çš„åºåˆ—æµ sequence flowä»¥ä¾›ç»ç†æ‰¹å‡†å¹¶æ‰§è¡Œç”¨æˆ·ä»»åŠ¡user taskè¡Œä¸º æ­¤è¡Œä¸ºå°†åœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼Œç¨åå¯ä»¥ä½¿ç”¨æŸ¥è¯¢æ‰¾åˆ°è¯¥ä»»åŠ¡ ç”¨æˆ·ä»»åŠ¡å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå¼•æ“å°†åœæ­¢è¿›ä¸€æ­¥æ‰§è¡Œä»»ä½•æ“ä½œï¼Œè¿”å› API è°ƒç”¨ æ”¯çº¿ï¼šäº¤æ˜“æ€§ (Sidetrack: transactionality) # å½“æ‚¨è¿›è¡Œ Flowable API è°ƒç”¨æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€åˆ‡éƒ½æ˜¯åŒæ­¥synchronousçš„ï¼Œå¹¶ä¸”æ˜¯åŒä¸€äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ã€‚è¿™æ„å‘³ç€ï¼Œå½“æ–¹æ³•è°ƒç”¨è¿”å›æ—¶ï¼Œå°†å¯åŠ¨å¹¶æäº¤äº‹åŠ¡ã€‚ å½“ä¸€ä¸ªæµç¨‹å®ä¾‹å¯åŠ¨æ—¶ï¼Œä»æµç¨‹å®ä¾‹å¯åŠ¨åˆ°ä¸‹ä¸€ä¸ªç­‰å¾…çŠ¶æ€ä¼šæœ‰ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªç”¨æˆ·ä»»åŠ¡ã€‚å½“å¼•æ“åˆ°è¾¾è¿™ä¸ªç”¨æˆ·ä»»åŠ¡æ—¶ï¼ŒçŠ¶æ€è¢«æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­å¹¶ä¸”äº‹åŠ¡è¢«æäº¤å¹¶ä¸”APIè°ƒç”¨è¿”å› åœ¨ Flowable ä¸­ï¼Œå½“ç»§ç»­ä¸€ä¸ªæµç¨‹å®ä¾‹æ—¶ï¼Œæ€»ä¼šæœ‰ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡ä»å‰ä¸€ä¸ªç­‰å¾…çŠ¶æ€è½¬åˆ°ä¸‹ä¸€ä¸ªç­‰å¾…çŠ¶æ€ã€‚ æŸ¥è¯¢å’Œå®Œæˆä»»åŠ¡ # ä¸ºç”¨æˆ·ä»»åŠ¡é…ç½®åˆ†é…\n[ç¬¬ä¸€ä¸ªä»»åŠ¡è¿›å…¥\u0026quot;ç»ç†\u0026quot;ç»„]\n\u0026lt;userTask id=\u0026#34;approveTask\u0026#34; name=\u0026#34;Approve or reject request\u0026#34; flowable:candidateGroups=\u0026#34;managers\u0026#34;/\u0026gt; ç¬¬äºŒä¸ªä»»åŠ¡çš„å—è®©äººassigneeå±æ€§ åŸºäºæˆ‘ä»¬åœ¨æµç¨‹å®ä¾‹å¯åŠ¨æ—¶ä¼ é€’çš„æµç¨‹å˜é‡çš„åŠ¨æ€åˆ†é…\n\u0026lt;userTask id=\u0026#34;holidayApprovedTask\u0026#34; name=\u0026#34;Holiday approved\u0026#34; flowable:assignee=\u0026#34;${employee}\u0026#34;/\u0026gt; æŸ¥è¯¢å¹¶è¿”å›\u0026quot;managers\u0026quot;ç»„çš„ä»»åŠ¡\nTaskService taskService = processEngine.getTaskService(); List\u0026lt;Task\u0026gt; tasks = taskService.createTaskQuery().taskCandidateGroup(\u0026#34;managers\u0026#34;).list(); System.out.println(\u0026#34;You have \u0026#34; + tasks.size() + \u0026#34; tasks:\u0026#34;); for (int i=0; i\u0026lt;tasks.size(); i++) { System.out.println((i+1) + \u0026#34;) \u0026#34; + tasks.get(i).getName());// } æœ‰ä¸‰ä¸ªæ˜¯å› ä¸ºå¯åŠ¨äº†ä¸‰ä¸ªå®ä¾‹\nè·å–ç‰¹å®šçš„æµç¨‹å®ä¾‹å˜é‡ï¼Œå¹¶åœ¨å±å¹•ä¸Šæ˜¾ç¤ºå®é™…è¯·æ±‚\nSystem.out.println(\u0026#34;Which task would you like to complete?\u0026#34;); int taskIndex = Integer.valueOf(scanner.nextLine()); Task task = tasks.get(taskIndex - 1); Map\u0026lt;String, Object\u0026gt; processVariables = taskService.getVariables(task.getId()); System.out.println(processVariables.get(\u0026#34;employee\u0026#34;) + \u0026#34; wants \u0026#34; + processVariables.get(\u0026#34;nrOfHolidays\u0026#34;) + \u0026#34; of holidays. Do you approve this?\u0026#34;); è®¾ç½®variablesè®©ç»ç†æ‰¹å‡†\nboolean approved = scanner.nextLine().toLowerCase().equals(\u0026#34;y\u0026#34;); variables = new HashMap\u0026lt;String, Object\u0026gt;(); variables.put(\u0026#34;approved\u0026#34;, approved); //ç»ç†å®Œæˆä»»åŠ¡ taskService.complete(task.getId(), variables); $\\color{red}è¯¥ä»»åŠ¡ç°å·²å®Œæˆï¼Œå¹¶ä¸”åŸºäº\u0026quot;approved\u0026quot;æµç¨‹å˜é‡é€‰æ‹©ç¦»å¼€ä¸“ç”¨ç½‘å…³çš„ä¸¤æ¡è·¯å¾„ä¹‹ä¸€$\nç¼–å†™JavaDelegate # å®ç°åœ¨è¯·æ±‚è¢«æ‰¹å‡†æ—¶å°†æ‰§è¡Œçš„è‡ªåŠ¨é€»è¾‘ï¼Œåœ¨BPMN2.0 XMLä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªæœåŠ¡ä»»åŠ¡\n\u0026lt;serviceTask id=\u0026#34;externalSystemCall\u0026#34; name=\u0026#34;Enter holidays in external system\u0026#34; flowable:class=\u0026#34;org.flowable.CallExternalSystemDelegate\u0026#34;/\u0026gt; è¿™é‡ŒæŒ‡å®šäº†å…·ä½“å®ç°ç±»\npackage org.flowable; import org.flowable.engine.delegate.DelegateExecution; import org.flowable.engine.delegate.JavaDelegate; public class CallExternalSystemDelegate implements JavaDelegate { public void execute(DelegateExecution execution) { System.out.println(\u0026#34;Calling the external system for employee \u0026#34; + execution.getVariable(\u0026#34;employee\u0026#34;)); } } å½“æ‰§è¡Œexecutionåˆ°è¾¾service tastæœåŠ¡ä»»åŠ¡æ—¶ï¼ŒBPMN 2.0 XMLä¸­å¼•ç”¨çš„ç±»è¢«å®ä¾‹åŒ–å¹¶è¢«è°ƒç”¨\nè¿è¡Œï¼Œå‘ç°è‡ªå®šä¹‰é€»è¾‘ç¡®å®å·²æ‰§è¡Œ\nå¤„ç†å†å²æ•°æ® # Flowableå¼•æ“ä¼šè‡ªåŠ¨å­˜å‚¨æ‰€æœ‰æµç¨‹å®ä¾‹çš„å®¡è®¡æ•°æ®audit data æˆ–å†å²æ•°æ®historical data\nä¸‹é¢ï¼Œæ˜¾ç¤ºä¸€ç›´åœ¨æ‰§è¡Œçš„æµç¨‹å®ä¾‹çš„æŒç»­æ—¶é—´ï¼Œä»ProcessEngineè·å–HistoryServiceå¹¶åˆ›å»ºå†å²æ´»åŠ¨æŸ¥è¯¢ã€‚è¿™é‡Œæ·»åŠ äº†è¿‡æ»¤\u0026ndash;1 ä»…é’ˆå¯¹ä¸€ä¸ªç‰¹å®šæµç¨‹å®ä¾‹çš„æ´»åŠ¨ \u0026ndash;2 åªæœ‰å·²ç»å®Œæˆçš„æ´»åŠ¨\nHistoryService historyService = processEngine.getHistoryService(); List\u0026lt;HistoricActivityInstance\u0026gt; activities = historyService.createHistoricActivityInstanceQuery() .processInstanceId(processInstance.getId()) .finished() .orderByHistoricActivityInstanceEndTime().asc() .list(); for (HistoricActivityInstance activity : activities) { System.out.println(activity.getActivityId() + \u0026#34; took \u0026#34; + activity.getDurationInMillis() + \u0026#34; milliseconds\u0026#34;); } ç»“è®º # æœ¬æ•™ç¨‹ä»‹ç»äº†å„ç§ Flowable å’Œ BPMN 2.0 æ¦‚å¿µå’Œæœ¯è¯­ï¼ŒåŒæ—¶è¿˜æ¼”ç¤ºäº†å¦‚ä½•ä»¥ç¼–ç¨‹æ–¹å¼ä½¿ç”¨ Flowable APIã€‚\nFlowable REST APIå…¥é—¨ # è®¾ç½®RESTåº”ç”¨ç¨‹åº # ä½¿ç”¨flowable-rest.war , java -jar flowable-rest.war\næµ‹è¯•æ˜¯å¦è¿è¡ŒæˆåŠŸ\ncurl --user rest-admin:test http://localhost:8080/flowable-rest/service/management/engine éƒ¨ç½²æµç¨‹å®šä¹‰ # å…ˆåˆ‡åˆ°è¯¥æ–‡ä»¶å¤¹ä¸‹ ä½¿ç”¨ä¸‹é¢å‘½ä»¤å¯åŠ¨flowable-rest\njava -jar flowable-rest.war éƒ¨ç½²æµç¨‹å®šä¹‰\ncurl --user rest-admin:test -F \u0026#34;file=@holiday-request.bpmn20.xml\u0026#34; http://localhost:8080/flowable-rest/service/repository/deployments æŸ¥çœ‹æµç¨‹æ˜¯å¦éƒ¨ç½²\ncurl --user rest-admin:test http://localhost:8080/flowable-rest/service/repository/process-definitions å°†è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨æ¯ä¸ªå…ƒç´ æ˜¯å½“å‰éƒ¨ç½²åˆ°å¼•æ“çš„æ‰€æœ‰æµç¨‹å®šä¹‰ å¯åŠ¨æµç¨‹å®ä¾‹ # å‘½ä»¤\ncurl --user rest-admin:test -H \u0026#34;Content-Type: application/json\u0026#34; -X POST -d \u0026#39;{ \u0026#34;processDefinitionKey\u0026#34;:\u0026#34;holidayRequest\u0026#34;, \u0026#34;variables\u0026#34;: [ { \u0026#34;name\u0026#34;:\u0026#34;employee\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;John Doe\u0026#34; }, { \u0026#34;name\u0026#34;:\u0026#34;nrOfHolidays\u0026#34;, \u0026#34;value\u0026#34;: 7 }]}\u0026#39; http://localhost:8080/flowable-rest/service/runtime/process-instances windowsä¸­ä¼šæŠ¥é”™\u0026hellip;ä¼°è®¡æ˜¯æ²¡è½¬ä¹‰å•¥çš„åŸå›  å°†è¿”å›\n{\u0026#34;id\u0026#34;:\u0026#34;43\u0026#34;,\u0026#34;url\u0026#34;:\u0026#34;http://localhost:8080/flowable-rest/service/runtime/process-instances/43\u0026#34;,\u0026#34;businessKey\u0026#34;:null,\u0026#34;suspended\u0026#34;:false,\u0026#34;ended\u0026#34;:false,\u0026#34;processDefinitionId\u0026#34;:\u0026#34;holidayRequest:1:42\u0026#34;,\u0026#34;processDefinitionUrl\u0026#34;:\u0026#34;http://localhost:8080/flowable-rest/service/repository/process-definitions/holidayRequest:1:42\u0026#34;,\u0026#34;activityId\u0026#34;:null,\u0026#34;variables\u0026#34;:[],\u0026#34;tenantId\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;completed\u0026#34;:false} ä»»åŠ¡åˆ—è¡¨å’Œå®Œæˆä»»åŠ¡ # è·å–managerç»ç†ç»„çš„æ‰€æœ‰ä»»åŠ¡\ncurl --user rest-admin:test -H \u0026#34;Content-Type: application/json\u0026#34; -X POST -d \u0026#39;{ \u0026#34;candidateGroup\u0026#34; : \u0026#34;managers\u0026#34; }\u0026#39; http://localhost:8080/flowable-rest/service/query/tasks ä½¿ç”¨å‘½ä»¤å®Œæˆä¸€ä¸ªä»»åŠ¡\ncurl --user rest-admin:test -H \u0026#34;Content-Type: application/json\u0026#34; -X POST -d \u0026#39;{ \u0026#34;action\u0026#34; : \u0026#34;complete\u0026#34;, \u0026#34;variables\u0026#34; : [ { \u0026#34;name\u0026#34; : \u0026#34;approved\u0026#34;, \u0026#34;value\u0026#34; : true} ] }\u0026#39; http://localhost:8080/flowable-rest/service/runtime/tasks/25 è¿™é‡Œä¼šæŠ¥ä¸‹é¢çš„é”™\n{\u0026#34;message\u0026#34;:\u0026#34;Internal server error\u0026#34;,\u0026#34;exception\u0026#34;:\u0026#34;couldn\u0026#39;t instantiate class org.flowable.CallExternalSystemDelegate\u0026#34;} è§£å†³åŠæ³•\nè¿™æ„å‘³ç€å¼•æ“æ‰¾ä¸åˆ°æœåŠ¡ä»»åŠ¡ä¸­å¼•ç”¨çš„ CallExternalSystemDelegate ç±»ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å°†è¯¥ç±»æ”¾åœ¨åº”ç”¨ç¨‹åºçš„ç±»è·¯å¾„ä¸­ï¼ˆè¿™å°†éœ€è¦é‡æ–°å¯åŠ¨ï¼‰ã€‚æŒ‰ç…§æœ¬èŠ‚æ‰€è¿°åˆ›å»ºç±»ï¼Œå°†å…¶æ‰“åŒ…ä¸ºJARï¼Œå¹¶å°†å…¶æ”¾åœ¨Tomcatçš„webappsæ–‡ä»¶å¤¹ä¸‹çš„flowable-restæ–‡ä»¶å¤¹çš„WEB-INF/libæ–‡ä»¶å¤¹ä¸­ã€‚\n"},{"id":210,"href":"/zh/docs/study/Algorithm/algorithhms_4th/2.1.2-2.1.3/","title":"ç®—æ³•çº¢çš®ä¹¦ 2.1.2-2.1.3","section":"_ç®—æ³•(ç¬¬å››ç‰ˆ)_","content":" æ’åº # åˆçº§æ’åºç®—æ³• # é€‰æ‹©æ’åº # å‘½é¢˜Aã€‚å¯¹äºé•¿åº¦ä¸ºN çš„æ•°ç»„ï¼Œé€‰æ‹©æ’åºéœ€è¦å¤§çº¦ N^2/2 æ¬¡æ¯”è¾ƒå’ŒN æ¬¡äº¤æ¢ã€‚\nä»£ç \npublic class Selection { public static void sort(Comparable[] a) { // å°†a[]æŒ‰å‡åºæ’åˆ— int N = a.length; // æ•°ç»„é•¿åº¦ for (int i = 0; i \u0026lt; N; i++) { // å°†a[i]å’Œa[i+1..N]ä¸­æœ€å°çš„å…ƒç´ äº¤æ¢ int min = i; // æœ€å°å…ƒç´ çš„ç´¢å¼• for (int j = i+1; j \u0026lt; N; j++) if (less(a[j], a[min])) min = j; exch(a, i, min); } } // less()ã€exch()ã€isSorted()å’Œmain()æ–¹æ³•è§â€œæ’åºç®—æ³•ç±»æ¨¡æ¿â€ } ç‰¹ç‚¹\nè¿è¡Œæ—¶é—´ä¸è¾“å…¥æ— å…³ï¼Œå³è¾“å…¥æ•°æ®çš„åˆå§‹çŠ¶æ€ï¼ˆæ¯”å¦‚æ˜¯å¦å·²æ’åºå¥½ç­‰ç­‰ï¼‰ä¸å½±å“æ’åºæ—¶é—´ æ•°æ®ç§»åŠ¨æ˜¯æœ€å°‘çš„ï¼ˆåªä½¿ç”¨äº†Næ¬¡äº¤æ¢ï¼Œäº¤æ¢æ¬¡æ•°å’Œæ•°ç»„çš„å¤§å°æ˜¯çº¿æ€§å…³ç³» æ’å…¥æ’åº # å‘½é¢˜Bã€‚å¯¹äºéšæœºæ’åˆ—çš„é•¿åº¦ä¸ºN ä¸”ä¸»é”®ä¸é‡å¤çš„æ•°ç»„ï¼Œå¹³å‡æƒ…å†µä¸‹æ’å…¥æ’åºéœ€è¦ï½ N^2/4 æ¬¡æ¯”è¾ƒä»¥åŠï½ N^2/4 æ¬¡äº¤æ¢ã€‚æœ€åæƒ…å†µä¸‹éœ€è¦ï½ N^2/2 æ¬¡æ¯”è¾ƒå’Œï½ N^2/2 æ¬¡äº¤æ¢ï¼Œæœ€å¥½æƒ…å†µä¸‹éœ€è¦N-1æ¬¡æ¯”è¾ƒå’Œ0 æ¬¡äº¤æ¢ã€‚\nä»£ç \npublic static void sort(Comparable[] a) { int N = a.length; //å°†ä¸‹è¡¨ä¸º n-1çš„æ•°ï¼Œä¾æ¬¡å’Œn-2,n-3ä¸€ç›´åˆ°0æ¯”è¾ƒï¼Œ //æ‰€ä»¥ç¬¬äºŒå±‚foråªèµ°åˆ°1ï¼Œå› ä¸º0å‰é¢æ²¡æœ‰å€¼ //å¦‚æœæ¯”å‰é¢çš„å€¼å°ï¼Œå°±è¿›è¡Œäº¤æ¢ for (int i = 1; i \u0026lt; N; i++) { for (int j = i; j \u0026gt; 0 \u0026amp;\u0026amp; less(a[j], a[j - 1]); j--) { exch(a, j, j - 1); } } } å½“å€’ç½®çš„æ•°é‡å¾ˆå°æ—¶ï¼Œæ’å…¥æ’åºæ¯”æœ¬ç« ä¸­çš„å…¶ä»–ä»»ä½•ç®—æ³•éƒ½å¿«\nå‘½é¢˜Cã€‚æ’å…¥æ’åºéœ€è¦çš„äº¤æ¢æ“ä½œå’Œæ•°ç»„ä¸­å€’ç½®çš„æ•°é‡ç›¸åŒï¼Œéœ€è¦çš„æ¯”è¾ƒæ¬¡æ•°å¤§äºç­‰äºå€’ç½®çš„æ•°é‡ï¼Œå°äºç­‰äºå€’ç½®çš„æ•°é‡åŠ ä¸Šæ•°ç»„çš„å¤§å°å†å‡ä¸€ã€‚\næ€§è´¨Dã€‚å¯¹äºéšæœºæ’åºçš„æ— é‡å¤ä¸»é”®çš„æ•°ç»„ï¼Œæ’å…¥æ’åºå’Œé€‰æ‹©æ’åºçš„è¿è¡Œæ—¶é—´æ˜¯å¹³æ–¹çº§åˆ«çš„ï¼Œä¸¤è€…ä¹‹æ¯”åº”è¯¥æ˜¯ä¸€ä¸ªè¾ƒå°çš„å¸¸æ•°\nå¸Œå°”æ’åº # å¸Œå°”æ’åºçš„æ€æƒ³æ˜¯ä½¿æ•°ç»„ä¸­ä»»æ„é—´éš”ä¸ºhçš„å…ƒç´ éƒ½æ˜¯æœ‰åºçš„ï¼Œè¿™æ ·çš„æ•°ç»„ç§°ä¸ºhæœ‰åºæ•°ç»„ï¼Œä¸€ä¸ªhæœ‰åºæ•°ç»„å°±æ˜¯hä¸ªäº’ç›¸ç‹¬ç«‹çš„æœ‰åºæ•°ç»„ç¼–åˆ¶åœ¨ä¸€èµ·ç»„æˆçš„æ•°ç»„\nç®—æ³•2.3 çš„å®ç°ä½¿ç”¨äº†åºåˆ—1/2ï¼ˆ3k-1ï¼‰ï¼Œä»N/3 å¼€å§‹é€’å‡è‡³1ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªåºåˆ—ç§°ä¸ºé€’å¢åºåˆ—\nè¯¦è¿°\nå®ç°å¸Œå°”æ’åºçš„ä¸€ç§æ–¹æ³•æ˜¯å¯¹äºæ¯ä¸ªhï¼Œç”¨æ’å…¥æ’åºå°†h ä¸ªå­æ•°ç»„ç‹¬ç«‹åœ°æ’åºã€‚ä½†å› ä¸ºå­æ•°ç»„æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•æ˜¯åœ¨h- å­æ•°ç»„ä¸­å°†æ¯ä¸ªå…ƒç´ äº¤æ¢åˆ°æ¯”å®ƒå¤§çš„å…ƒç´ ä¹‹å‰å»ï¼ˆå°†æ¯”å®ƒå¤§çš„å…ƒç´ å‘å³ç§»åŠ¨ä¸€æ ¼ï¼‰ã€‚åªéœ€è¦åœ¨æ’å…¥æ’åºçš„ä»£ç ä¸­å°†ç§»åŠ¨å…ƒç´ çš„è·ç¦»ç”±1 æ”¹ä¸ºh å³å¯ã€‚è¿™æ ·ï¼Œå¸Œå°”æ’åºçš„å®ç°å°±è½¬åŒ–ä¸ºäº†ä¸€ä¸ªç±»ä¼¼äºæ’å…¥æ’åºä½†ä½¿ç”¨ä¸åŒå¢é‡çš„è¿‡ç¨‹ã€‚\nä»£ç \npublic class Shell { public static void sort(Comparable[] a) { // å°†a[]æŒ‰å‡åºæ’åˆ— int N = a.length; int h = 1; while (h \u0026lt; N/3) h = 3*h + 1; // 1, 4, 13, 40, 121, 364, 1093, ... while (h \u0026gt;= 1) { // å°†æ•°ç»„å˜ä¸ºhæœ‰åº for (int i = h; i \u0026lt; N; i++) { // å°†a[i]æ’å…¥åˆ°a[i-h], a[i-2*h], a[i-3*h]... ä¹‹ä¸­ for (int j = i; j \u0026gt;= h \u0026amp;\u0026amp; less(a[j], a[j-h]); j -= h) exch(a, j, j-h); } h = h/3; } } // less()ã€exch()ã€isSorted()å’Œmain()æ–¹æ³•è§â€œæ’åºç®—æ³•ç±»æ¨¡æ¿â€ } é€šè¿‡æå‡é€Ÿåº¦æ¥è§£å†³å…¶ä»–æ–¹å¼æ— æ³•è§£å†³çš„é—®é¢˜æ˜¯ç ”ç©¶ç®—æ³•çš„è®¾è®¡å’Œæ€§èƒ½çš„ä¸»è¦åŸå› ä¹‹ä¸€\nå½’å¹¶æ’åº # å½’å¹¶æ’åºæœ€å¸å¼•äººçš„æ€§è´¨æ˜¯å®ƒèƒ½å¤Ÿä¿è¯å°†ä»»æ„é•¿åº¦ä¸ºNçš„æ•°ç»„æ’åºæ‰€éœ€æ—¶é—´å’ŒNlogNæˆæ­£æ¯”ï¼Œä¸»è¦ç¼ºç‚¹æ˜¯ä»–æ‰€éœ€çš„é¢å¤–ç©ºé—´å’ŒNæˆæ­£æ¯”\nå½’å¹¶æ’åºç¤ºæ„å›¾ è‡ªé¡¶å‘ä¸‹çš„å½’å¹¶æ’åº # åŸåœ°å½’å¹¶çš„æŠ½è±¡æ–¹æ³•\n/** * è¿™é‡Œæœ‰ä¸€ä¸ªå‰æï¼Œå°±æ˜¯a[i..mid]æ˜¯æœ‰åºçš„ï¼Œ * a[mid..hi]æ˜¯æœ‰åºçš„ * * @param a * @param lo * @param mid * @param hi */ public static void merge(Comparable[] a, int lo, int mid, int hi) { int i = lo, j = mid + 1; //å…ˆåœ¨è¾…åŠ©æ•°ç»„èµ‹ä¸Šéœ€è¦çš„å€¼ for (int k = lo; k \u0026lt;= hi; k++) { aux[k] = a[k]; } //æœ€åæƒ…å†µä¸‹è¿™é‡Œæ—¶éœ€è¦æ¯”è¾ƒhi-lo+1æ¬¡çš„ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„é•¿åº¦ for (int k = lo; k \u0026lt;= hi; k++) { if (i \u0026gt; mid) { //è¯´æ˜i(å·¦è¾¹ï¼‰æ¯”è¾ƒå®Œäº†ï¼Œç›´æ¥æ‹¿å³è¾¹çš„å€¼æ”¾è¿›å» a[k] = aux[j++]; } else if (j \u0026gt; hi) { //è¯´æ˜j(å³è¾¹)æ¯”è¾ƒå®Œäº†ï¼Œç›´æ¥æ‹¿å·¦è¾¹çš„å€¼æ”¾è¿›å» a[k] = aux[i++]; } else if (less(aux[j], aux[i])) { //å·¦å³éƒ½è¿˜æœ‰å€¼çš„æƒ…å†µä¸‹ï¼Œå–å‡ºæœ€å°çš„å€¼æ”¾è¿›å» a[k] = aux[j++]; } else { a[k] = aux[i++]; } } } é€’å½’è¿›è¡Œå½’å¹¶æ’åº\nprivate static void sort(Comparable[] a, int lo, int hi) { if (hi \u0026lt;= lo) { return; } int mid = lo + (hi - lo) / 2; //ä¿è¯å·¦è¾¹æœ‰åº sort(a, lo, mid); //ä¿è¯å³è¾¹æœ‰åº sort(a, mid + 1, hi); //å½’å¹¶æ•°ç»„æœ‰åºçš„ä¸¤éƒ¨åˆ† merge(a, lo, mid, hi); } è¾…åŠ©æ•°ç»„çš„ä¸€æ¬¡æ€§åˆå§‹åŒ–\nprivate static Comparable[] aux; public static void sort(Comparable[] a) { aux = new Comparable[a.length];//è¾…åŠ©æ•°ç»„ï¼Œä¸€æ¬¡æ€§åˆ†é…ç©ºé—´ sort(a, 0, a.length - 1); } è‡ªé¡¶å‘ä¸‹çš„å½’å¹¶æ’åºçš„è°ƒç”¨è½¨è¿¹ N=16æ—¶å½’å¹¶æ’åºä¸­å­æ•°ç»„çš„ä¾èµ–æ ‘ æ¯ä¸ªç»“ç‚¹éƒ½è¡¨ç¤ºä¸€ä¸ªsort() æ–¹æ³•é€šè¿‡merge() æ–¹æ³•å½’å¹¶è€Œæˆçš„å­æ•°ç»„ã€‚è¿™æ£µæ ‘æ­£å¥½æœ‰n å±‚ã€‚å¯¹äº0 åˆ°n-1 ä¹‹é—´çš„ä»»æ„kï¼Œè‡ªé¡¶å‘ä¸‹çš„ç¬¬k å±‚æœ‰2^k ä¸ªå­æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„çš„é•¿åº¦ä¸º $2^{(n-k)}$ï¼Œå½’å¹¶æœ€å¤šéœ€è¦$2^{(n-k)}$æ¬¡æ¯”è¾ƒã€‚å› æ­¤æ¯å±‚çš„æ¯”è¾ƒæ¬¡æ•°ä¸º$ 2^k * 2 ^ {( n - 1 )} = 2 ^ n $ ï¼Œnå±‚æ€»å…±ä¸º $n*2^n = lg N * (2 ^ { lg N}) = lg N * N$\nå‘½é¢˜Fã€‚å¯¹äºé•¿åº¦ä¸ºN çš„ä»»æ„æ•°ç»„ï¼Œè‡ªé¡¶å‘ä¸‹çš„å½’å¹¶æ’åºéœ€è¦(1/2)N lgN è‡³N lgN æ¬¡æ¯”è¾ƒã€‚\næ³¨ï¼šå› ä¸ºå½’å¹¶æ‰€éœ€è¦çš„æ¯”è¾ƒæ¬¡æ•°æœ€å°‘ä¸ºN/2\nå‘½é¢˜Gã€‚å¯¹äºé•¿åº¦ä¸ºN çš„ä»»æ„æ•°ç»„ï¼Œè‡ªé¡¶å‘ä¸‹çš„å½’å¹¶æ’åºæœ€å¤šéœ€è¦è®¿é—®æ•°ç»„6NlgN æ¬¡ã€‚ è¯æ˜ã€‚æ¯æ¬¡å½’å¹¶æœ€å¤šéœ€è¦è®¿é—®æ•°ç»„6N æ¬¡ï¼ˆ2N æ¬¡ç”¨æ¥å¤åˆ¶ï¼Œ2N æ¬¡ç”¨æ¥å°†æ’å¥½åºçš„å…ƒç´ ç§»åŠ¨å›å»ï¼Œå¦å¤–æœ€å¤šæ¯”è¾ƒ2N æ¬¡ï¼‰ï¼Œæ ¹æ®å‘½é¢˜F å³å¯å¾—åˆ°è¿™ä¸ªå‘½é¢˜çš„ç»“æœã€‚\nè‡ªåº•å‘ä¸Šçš„å½’å¹¶æ’åº # é€’å½’å®ç°çš„å½’å¹¶æ’åºæ—¶ç®—æ³•è®¾è®¡ä¸­åˆ†æ²»æ€æƒ³ çš„å…¸å‹åº”ç”¨\nè‡ªåº•å‘ä¸Šçš„å½’å¹¶æ’åºçš„å¯è§†è½¨è¿¹\næºä»£ç \nprivate static Comparable[] aux; private static void sort(Comparable[] a) { int N = a.length; aux = new Comparable[N]; //æ¯æ¬¡åˆå¹¶çš„å­æ•°ç»„é•¿åº¦ç¿»å€ for (int sz = 1; sz \u0026lt; N; sz = sz + sz) { //lo:å­æ•°ç»„ç´¢å¼• //è¾¹ç•Œé—®é¢˜ï¼Œ å‡è®¾æ˜¯Nä¸º2^nï¼Œåˆ™å€’æ•°ç¬¬äºŒä¸ªæ•°ç»„çš„å…ƒç´ çš„ä¸‹æ ‡ï¼Œä¸€å®šåœ¨å€’æ•°ç¬¬ä¸€ä¸ªå…ƒç´ ä¸‹æ ‡(n-sz)ä¹‹å‰ for (int lo = 0; lo \u0026lt; N - sz; lo += sz + sz) { //å¾ªç¯åˆå¹¶ä¸€ä¸ªä¸ªçš„å°æ•°ç»„ merge(a, lo, lo + sz - 1, Math.min(lo + sz + sz - 1, N - 1)); } } } å­æ•°ç»„çš„å¤§å°szçš„åˆå§‹å€¼ä¸º1ï¼Œæ¯æ¬¡åŠ å€\næœ€åä¸€ä¸ªå­æ•°ç»„çš„å¤§å°åªæœ‰åœ¨æ•°ç»„å¤§å°æ˜¯szçš„å¶æ•°å€çš„æ—¶å€™æ‰ä¼šç­‰äºszï¼ˆå¦åˆ™æ¯”szå°)\nå‘½é¢˜Hã€‚å¯¹äºé•¿åº¦ä¸ºN çš„ä»»æ„æ•°ç»„ï¼Œè‡ªåº•å‘ä¸Šçš„å½’å¹¶æ’åºéœ€è¦1/2NlgN è‡³NlgN æ¬¡æ¯”è¾ƒï¼Œæœ€å¤šè®¿é—®æ•°ç»„6NlgN æ¬¡ã€‚\nè‡ªåº•å‘ä¸Šçš„å½’å¹¶æ’åºæ¯”è¾ƒé€‚åˆç”¨é“¾è¡¨ç»„ç»‡çš„æ•°æ®ã€‚æƒ³è±¡ä¸€ä¸‹å°†é“¾è¡¨å…ˆæŒ‰å¤§å°ä¸º1 çš„å­é“¾è¡¨è¿›è¡Œæ’åºï¼Œç„¶åæ˜¯å¤§å°ä¸º2 çš„å­é“¾è¡¨ï¼Œç„¶åæ˜¯å¤§å°ä¸º4 çš„å­é“¾è¡¨ç­‰ã€‚è¿™ç§æ–¹æ³•åªéœ€è¦é‡æ–°ç»„ç»‡é“¾è¡¨é“¾æ¥å°±èƒ½å°†é“¾è¡¨åŸåœ°æ’åºï¼ˆä¸éœ€è¦åˆ›å»ºä»»ä½•æ–°çš„é“¾è¡¨ç»“ç‚¹ï¼‰\nå½’å¹¶æ’åºå‘Šè¯‰æˆ‘ä»¬ï¼Œå½“èƒ½å¤Ÿç”¨å…¶ä¸­ä¸€ç§æ–¹æ³•è§£å†³ä¸€ä¸ªé—®é¢˜æ—¶ï¼Œéƒ½åº”è¯¥è¯•è¯•å¦ä¸€ç§ï¼Œå¯ä»¥åƒMerge.sort()é‚£æ ·åŒ–æ•´ä¸ºé›¶ï¼ˆç„¶åé€’å½’åœ°è§£å†³ï¼‰é—®é¢˜ï¼Œæˆ–è€…åƒMergeBU.sort()é‚£æ ·å¾ªåºæ¸è¿›çš„è§£å†³é—®é¢˜\nå‘½é¢˜Iã€‚æ²¡æœ‰ä»»ä½•åŸºäºæ¯”è¾ƒçš„ç®—æ³•èƒ½å¤Ÿä¿è¯ä½¿ç”¨å°‘äºlgï¼ˆN!ï¼‰ï½ NlgN æ¬¡æ¯”è¾ƒå°†é•¿åº¦ä¸ºN çš„æ•°ç»„æ’åº\nå‘½é¢˜Jã€‚å½’å¹¶æ’åºæ˜¯ä¸€ç§æ¸è¿›æœ€ä¼˜çš„åŸºäºæ¯”è¾ƒæ’åºçš„ç®—æ³•ã€‚\nå¿«é€Ÿæ’åº # å¿«é€Ÿæ’åºæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„æ’åºç®—æ³•\nåŸºæœ¬ç®—æ³• # æ˜¯ä¸€ç§åˆ†æ²»çš„æ’åºç®—æ³•ï¼Œå°†ä¸€ä¸ªæ•°ç»„åˆ†æˆä¸¤ä¸ªå­æ•°ç»„ï¼Œå°†ä¸¤éƒ¨åˆ†ç‹¬ç«‹çš„æ’åº\nå½’å¹¶æ’åºå°†æ•°ç»„åˆ†æˆä¸¤ä¸ªå­æ•°ç»„åˆ†åˆ«æ’åºï¼Œå¹¶å°†æœ‰åºçš„å­æ•°ç»„å½’å¹¶ä»¥å°†ä¸¤ä¸ªæ•°ç»„æ’åºï¼›å¿«é€Ÿæ’åºå°†æ•°ç»„æ’åºçš„æ–¹å¼æ˜¯å½“ä¸¤ä¸ªå­æ•°ç»„éƒ½æœ‰åºæ—¶æ•´ä¸ªæ•°ç»„ä¹Ÿéƒ½æœ‰åºäº†\nå½’å¹¶æ’åºï¼šé€’å½’è°ƒç”¨å‘ç”Ÿåœ¨å¤„ç†æ•°ç»„ä¹‹å‰ï¼›å¿«é€Ÿæ’åºï¼šé€’å½’è°ƒç”¨å‘ç”Ÿåœ¨å¤„ç†æ•°ç»„ä¹‹å\nå½’å¹¶æ’åºä¸­æ•°ç»„è¢«åˆ†ä¸ºä¸¤åŠï¼›å¿«é€Ÿæ’åºä¸­åˆ‡åˆ†å–å†³äºæ•°ç»„å†…å®¹\nå¿«é€Ÿæ’åºç¤ºæ„å›¾ é€’å½’ä»£ç \npublic static void sort(Comparable[] a, int lo, int hi) { if (hi \u0026lt;= lo) return; int j = partition(a, lo, hi); //åˆ‡åˆ† sort(a, lo, j - 1); /// å°†å·¦åŠéƒ¨åˆ†a[lo .. j-1]æ’åº sort(a, j + 1, hi);//å°†å³åŠéƒ¨åˆ†a[j+1..hi]æ’åº } å¿«é€Ÿæ’åºé€’å½’çš„å°†å­æ•°ç»„a[lo..hi]æ’åºï¼Œå…ˆç”¨partition()æ–¹æ³•å°†a[j]æ”¾åˆ°ä¸€ä¸ªåˆé€‚çš„ä½ç½®ï¼Œç„¶åå†ç”¨é€’å½’è°ƒç”¨å°†å…¶ä»–ä½ç½®çš„å…ƒç´ æ’åº åˆ‡åˆ†åä½¿å¾—æ•°ç»„æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶\nå¯¹äºæŸä¸ªjï¼Œa[j]å·²ç»æ’å®š a[lo]åˆ°a[j-1]çš„æ‰€æœ‰å…ƒç´ éƒ½ä¸å¤§äºa[j] a[j+1]çš„æ‰€æœ‰å…ƒç´ éƒ½ä¸å°äºa[j] å½’çº³æ³•è¯æ˜æ•°ç»„æœ‰åºï¼š\nå¦‚æœå·¦å­æ•°ç»„å’Œå³å­æ•°ç»„éƒ½æ˜¯æœ‰åºçš„ï¼Œé‚£ä¹ˆç”±å·¦å­æ•°ç»„ï¼ˆæœ‰åºä¸”æ²¡æœ‰ä»»ä½•å…ƒç´ å¤§äºåˆ‡åˆ†å…ƒç´ ï¼‰ã€åˆ‡åˆ†å…ƒç´ å’Œå³å­æ•°ç»„ï¼ˆæœ‰åºä¸”æ²¡æœ‰ä»»ä½•å…ƒç´ å°äºåˆ‡åˆ†å…ƒç´ ï¼‰ç»„æˆçš„ç»“æœæ•°ç»„ä¹Ÿä¸€å®šæ˜¯æœ‰åºçš„\nä¸€èˆ¬ç­–ç•¥æ˜¯å…ˆéšæ„åœ°å–a[lo] ä½œä¸ºåˆ‡åˆ†å…ƒç´ ï¼Œå³é‚£ä¸ªå°†ä¼šè¢«æ’å®šçš„å…ƒç´ ï¼Œç„¶åæˆ‘ä»¬ä»æ•°ç»„çš„å·¦ç«¯å¼€å§‹å‘å³æ‰«æç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªå¤§äºç­‰äºå®ƒçš„å…ƒç´ ï¼Œå†ä»æ•°ç»„çš„å³ç«¯å¼€å§‹å‘å·¦æ‰«æç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªå°äºç­‰äºå®ƒçš„å…ƒç´ ã€‚è¿™ä¸¤ä¸ªå…ƒç´ æ˜¾ç„¶æ˜¯æ²¡æœ‰æ’å®šçš„ï¼Œå› æ­¤æˆ‘ä»¬äº¤æ¢å®ƒä»¬çš„ä½ç½®ã€‚å¦‚æ­¤ç»§ç»­ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¿è¯å·¦æŒ‡é’ˆi çš„å·¦ä¾§å…ƒç´ éƒ½ä¸å¤§äºåˆ‡åˆ†å…ƒç´ ï¼Œå³æŒ‡é’ˆj çš„å³ä¾§å…ƒç´ éƒ½ä¸å°äºåˆ‡åˆ†å…ƒç´ ã€‚å½“ä¸¤ä¸ªæŒ‡é’ˆç›¸é‡æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å°†åˆ‡åˆ†å…ƒç´ a[lo] å’Œå·¦å­æ•°ç»„æœ€å³ä¾§çš„å…ƒç´ ï¼ˆa[j]ï¼‰äº¤æ¢ç„¶åè¿”å›j å³å¯\nä»£ç å¦‚ä¸‹\nprivate static int partition(Comparable[] a, int lo, int hi) { int i = lo, j = hi + 1; //å·¦å³æ‰«ææŒ‡é’ˆ Comparable v = a[lo]; //åˆ‡åˆ†å…ƒç´  while (true) { //ä»å·¦å¾€å³æ‰«æï¼Œå¦‚æœæ‰¾åˆ°äº†å¤§äºç­‰äºvå€¼çš„æ•°ï¼Œå°±é€€å‡ºå¾ªç¯ while (less(a[++i], v)) { if (i == hi) break; } //ä»å³å¾€å·¦æ‰«æï¼Œå¦‚æœæ‰¾åˆ°äº†å°äºç­‰äºvå€¼å¾—æ•°ï¼Œå°±é€€å‡ºå¾ªç¯ while (less(a[--j], v)) { if (j == lo) break; } if (i \u0026gt;= j) break;//å¦‚æœiï¼Œjç›¸é‡åˆ™é€€å‡ºå¾ªç¯ //å°†å·¦è¾¹å¤§äºç­‰äºvå€¼çš„æ•°ä¸å³è¾¹å°äºç­‰äºvå€¼çš„æ•°äº¤æ¢ exch(a, i, j); } //ä¸Šé¢çš„éå†ç»“æŸåï¼Œa[lo+1...j]å’Œa[i..hi]éƒ½å·²ç»åˆ†åˆ«æœ‰åº //ä¸”a[j]\u0026lt;=a[i]\u0026lt;=a[lo]ï¼Œæ‰€ä»¥åº”è¯¥äº¤æ¢a[lo]å’Œa[j](è€Œä¸æ˜¯a[i)ï¼Œå› ä¸º //a[i]æœ‰å¯èƒ½å¤§äºa[lo] exch(a, lo, j); //è¿”å›a[lo]è¢«äº¤æ¢çš„ä½ç½® return j; } åˆ‡åˆ†è½¨è¿¹ æ€§èƒ½ç‰¹ç‚¹ # å°†é•¿åº¦ä¸ºNçš„æ— é‡å¤æ•°ç»„æ’åºï¼Œå¿«é€Ÿæ’åºå¹³å‡éœ€è¦~2N lnN æ¬¡æ¯”è¾ƒï¼ˆä»¥åŠ1/6çš„äº¤æ¢ï¼‰\nç®—æ³•æ”¹è¿› # ä¸‰å‘åˆ‡åˆ†\n"},{"id":211,"href":"/zh/docs/problem/Git/01/","title":"gitä½¿ç”¨sshè¿ä¸ä¸Š","section":"Git","content":" å¤„ç†æ–¹å¼ åœ¨ç³»ç»Ÿçš„hostæ–‡ä»¶ä¸­ï¼Œæ·»åŠ ipæŒ‡å®š\n199.232.69.194 github.global.ssl.fastly.net 140.82.114.4 github.com "},{"id":212,"href":"/zh/docs/life/archive/20220416/","title":"ã€Šä½œé…’ã€‹æœ‰æ„Ÿ","section":"å¾€æ—¥å½’æ¡£","content":"æœ€è¿‘å‡ å¤©åƒé¥­ï¼Œç»å¸¸å¬åˆ°ä¸€é¦–å¾ˆå—¨çš„æ­Œã€‚æ—‹å¾‹å¾ˆè½»å¿«ï¼Œå…¶å®æœ¬æ¥ä¹Ÿå°±ä¸€å¬è€Œè¿‡ï¼Œå¯èƒ½æ˜¯è€³é—»ç›®æŸ“æ¬¡æ•°å¤šäº†ï¼Œå¥½å¥‡å¿ƒä¸Šæ¥äº†ï¼ŒæŸ¥äº†ä¸‹æ­Œè¯ã€‚\nå¬è¿™é¦–æ­ŒæœŸé—´æˆ‘å±…ç„¶è”æƒ³äº†å¾ˆå¤šï¼Œæœç„¶æ˜¯è€emoäº†ã€‚ä¸çŸ¥é“æ€ä¹ˆå›äº‹ï¼Œæˆ‘è¿™ç§ä¸ä¸–æ— äº‰çš„å¿ƒæ€ï¼Œå¬å®Œåå±…ç„¶ä¹Ÿè®©æˆ‘å¹»æƒ³äº†ä¸€ä¸‹è¿™æ­Œæè¿°çš„çˆ±æƒ…æ¨¡æ ·ã€‚æˆ‘åˆçªç„¶æƒ³åˆ°ï¼Œå¦‚ä»Šç¤¾ä¼šä¸Šç¦»å©šç‡å±…é«˜ä¸ä¸‹ï¼Œä¹Ÿè®¸ä¸ç½‘ç»œä¿¡æ¯çš„ä¼ è¾“æœ‰å¯†åˆ‡å…³è”ã€‚å¦‚æœæ˜¯å¤ä»£ï¼Œå«é”™äººæˆ–è€…å¨¶é”™äººï¼Œå¤§å®¶ä¹Ÿéƒ½éƒ½è®¤äº†ï¼Œæœ‰ä»€ä¹ˆå°æ‰“å°é—¹éƒ½äº’ç›¸åŒ…å«ã€‚è€Œå¦‚ä»Šï¼Œç”Ÿæ´»å‹åŠ›ä¸æ–­å¢å¤§ï¼ŒåŠ ä¸Šç½‘ç»œä¸Šçˆ†ç‚¸å¼ï¼ˆè‡³å°‘æ•ˆæœæ˜¯ï¼‰çš„å®£ä¼ çˆ±æƒ…ï¼Œå¯¹æ¯”æ˜¾è‘—ï¼Œå¾ˆè®©äººä¸€ç€é­”å°±é™·è¿›å»ï¼Œå°±æ‘’å¼ƒå‡ å¹´ç”šè‡³åå‡ å¹´çš„å¤«å¦»ä¹‹æƒ…ï¼Œå»è¿½æ±‚æ‰€è°“çš„çœŸçˆ±ã€è‡ªç”±ã€‚\næ¯ä¸ªäººå¯¹è‡ªå·±çš„è¿‡å¾€ï¼Œæˆ–å¤šæˆ–å°‘éƒ½ä¼šä¸ç”˜ã€‚å¦‚æœè¿™ç§ä¸ç”˜è‡ªå·±æ²¡æœ‰åŠæ³•åŒ–è§£ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨æŸä¸€åˆ»çˆ†å‘ã€‚æ¯ä¸ªäººéƒ½åº”è¯¥ï¼Œä¹Ÿå¿…å®šä¼šä¸ºè‡ªå·±æ›¾ç»çš„æ‰€ä½œæ‰€ä¸ºè´Ÿè´£ã€‚ä¸è¦æ‡µæ‡µæ‡‚æ‡‚åœ°è¿›å…¥(ç°ä»£)å©šå§»ï¼Œè¿™æ ·å¯¹è‡ªå·±å’Œå®ƒäººéƒ½æå…¶ä¸è´Ÿè´£ã€‚ çˆ†ç‚¸å¼çš„ä¿¡æ¯æ¥æ”¶ä¼šæ¿€å‘ä½ æ‰€æœ‰çš„å†²åŠ¨ä¸ä¸ç”˜ã€‚\n"},{"id":213,"href":"/zh/docs/study/Algorithm/algorithhms_4th/2.1.1/","title":"ç®—æ³•çº¢çš®ä¹¦ 2.1.1","section":"_ç®—æ³•(ç¬¬å››ç‰ˆ)_","content":" æ’åº # æ’åºå°±æ˜¯å°†ä¸€ç»„å¯¹è±¡æŒ‰ç…§æŸç§é€»è¾‘é¡ºåºé‡æ–°æ’åºçš„è¿‡ç¨‹\nå¯¹æ’åºç®—æ³•çš„åˆ†ææœ‰åŠ©äºç†è§£æœ¬ä¹¦ä¸­æ¯”è¾ƒç®—æ³•æ€§èƒ½çš„æ–¹æ³• ç±»ä¼¼æŠ€æœ¯èƒ½è§£å†³å…¶ä»–ç±»å‹é—®é¢˜ æ’åºç®—æ³•å¸¸å¸¸æ˜¯æˆ‘ä»¬è§£å†³å…¶ä»–é—®é¢˜çš„ç¬¬ä¸€æ­¥ åˆçº§æ’åºç®—æ³• # ç†Ÿæ‚‰æœ¯è¯­åŠæŠ€å·§ æŸäº›æƒ…å†µä¸‹åˆçº§ç®—æ³•æ›´æœ‰æ•ˆ æœ‰åŠ©äºæ”¹è¿›å¤æ‚ç®—æ³•çš„æ•ˆç‡ æ¸¸æˆè§„åˆ™ # ä¸»è¦å…³æ³¨é‡æ–°æ’åºæ•°ç»„å…ƒç´ çš„ç®—æ³•ï¼Œæ¯ä¸ªå…ƒç´ éƒ½ä¼šæœ‰ä¸€ä¸ªä¸»é”®\næ’åºåç´¢å¼•è¾ƒå¤§çš„ä¸»é”®å¤§äºç´¢å¼•è¾ƒå°çš„ä¸»é”®\nä¸€èˆ¬æƒ…å†µä¸‹æ’åºç®—æ³•é€šè¿‡ä¸¤ä¸ªæ–¹æ³•æ“ä½œæ•°æ®ï¼Œless()è¿›è¡Œæ¯”è¾ƒï¼Œexch()è¿›è¡Œäº¤æ¢\næ’åºç®—æ³•ç±»çš„æ¨¡æ¿\npublic class Example { public static void sort(Comparable[] a) { /* è¯·è§ç®—æ³•2.1ã€ç®—æ³•2.2ã€ç®—æ³•2.3ã€ç®—æ³•2.4ã€ç®—æ³•2.5æˆ–ç®—æ³•2.7*/ } private static Boolean less(Comparable v, Comparable w) { return v.compareTo(w) \u0026lt; 0; } private static void exch(Comparable[] a, int i, int j) { Comparable t = a[i]; a[i] = a[j]; a[j] = t; } private static void show(Comparable[] a) { // åœ¨å•è¡Œä¸­æ‰“å°æ•°ç»„ for (int i = 0; i \u0026lt; a.length; i++) StdOut.print(a[i] + \u0026#34; \u0026#34;); StdOut.println(); } public static Boolean isSorted(Comparable[] a) { // æµ‹è¯•æ•°ç»„å…ƒç´ æ˜¯å¦æœ‰åº for (int i = 1; i \u0026lt; a.length; i++) if (less(a[i], a[i-1])) return false; return true; } public static void main(String[] args) { // ä»æ ‡å‡†è¾“å…¥è¯»å–å­—ç¬¦ä¸²ï¼Œå°†å®ƒä»¬æ’åºå¹¶è¾“å‡º String[] a = In.readStrings(); sort(a); assert isSorted(a); show(a); } } ä½¿ç”¨\n% more tiny.txt S O R T E X A M P L E % java Example \u0026lt; tiny.txt A E E L M O P R S T X % more words3.txt bed bug dad yes zoo ... all bad yet % java Example \u0026lt; words.txt all bad bed bug dad ... yes yet zoo ä½¿ç”¨assertéªŒè¯\næ’åºæˆæœ¬æ¨¡å‹ï¼šåœ¨ç ”ç©¶æ’åºç®—æ³•æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—æ¯”è¾ƒå’Œäº¤æ¢çš„æ•°é‡ã€‚å¯¹äºä¸äº¤æ¢å…ƒç´ çš„ç®—æ³•ï¼Œæˆ‘ä»¬ä¼šæ¯”è¾ƒè®¿é—®æ•°ç»„çš„æ¬¡æ•°\né¢å¤–å†…å­˜å¼€é”€å’Œè¿è¡Œæ—¶é—´åŒç­‰é‡è¦ï¼Œæ’åºç®—æ³•åˆ†ä¸º\né™¤äº†å‡½æ•°è°ƒç”¨éœ€è¦çš„æ ˆå’Œå›ºå®šæ•°ç›®çš„å®ä¾‹å˜é‡ä¹‹å¤–ï¼Œæ— éœ€é¢å¤–å†…å­˜çš„åŸåœ°æ’åºç®—æ³• éœ€è¦é¢å¤–å†…å­˜ç©ºé—´æ¥å­˜å‚¨å¦ä¸€ä»½æ•°ç»„å‰¯æœ¬çš„å…¶ä»–æ’åºç®—æ³• æ•°æ®ç±»å‹\næ’åºæ¨¡æ¿é€‚ç”¨äºä»»ä½•å®ç°äº†Comparableæ¥å£çš„æ•°æ®ç±»å‹\nå¯¹äºè‡ªå·±çš„æ•°æ®ç±»å‹ï¼Œå®ç°Comparableæ¥å£å³å¯\npublic class Date implements Comparable\u0026lt;Date\u0026gt; { private final int day; private final int month; private final int year; public Date(int d, int m, int y) { day = d; month = m; year = y; } public int day() { return day; } public int month() { return month; } public int year() { return year; } public int compareTo(Date that) { if (this.year \u0026gt; that.year ) return +1; if (this.year \u0026lt; that.year ) return -1; if (this.month \u0026gt; that.month) return +1; if (this.month \u0026lt; that.month) return -1; if (this.day \u0026gt; that.day ) return +1; if (this.day \u0026lt; that.day ) return -1; return 0; } public String toString() { return month + \u0026#34;/\u0026#34; + day + \u0026#34;/\u0026#34; + year; } } compareTo()å¿…é¡»å®ç°å…¨åºå…³ç³» è‡ªåæ€§ï¼Œåå¯¹ç§°æ€§åŠä¼ é€’æ€§ ç»å…¸ç®—æ³•ï¼ŒåŒ…æ‹¬é€‰æ‹©æ’åºã€æ’å…¥æ’åºã€å¸Œå°”æ’åºã€å½’å¹¶æ’åºã€å¿«é€Ÿæ’åºå’Œå †æ’åº\n"},{"id":214,"href":"/zh/docs/study/RocketMQ/heima/05advance/","title":"05é«˜çº§åŠŸèƒ½","section":"åŸºç¡€(é»‘é©¬)_","content":" å­¦ä¹ æ¥æº https://www.bilibili.com/video/BV1L4411y7mnï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…ï¼\næ¶ˆæ¯å­˜å‚¨ # æµç¨‹ # å­˜å‚¨ä»‹è´¨ # å…³ç³»å‹æ•°æ®åº“DB # é€‚åˆæ•°æ®é‡ä¸å¤Ÿå¤§ï¼Œæ¯”å¦‚ActiveMQå¯é€‰ç”¨JDBCæ–¹å¼ä½œä¸ºæ¶ˆæ¯æŒä¹…åŒ–\næ–‡ä»¶ç³»ç»Ÿ # å…³ç³»å‹æ•°æ®åº“æœ€ç»ˆä¹Ÿæ˜¯è¦å­˜åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­çš„ï¼Œä¸å¦‚ç›´æ¥å­˜åˆ°æ–‡ä»¶ç³»ç»Ÿï¼Œç»•è¿‡å…³ç³»å‹æ•°æ®åº“ å¸¸è§çš„RocketMQ/RabbitMQ/Kafkaéƒ½æ˜¯é‡‡ç”¨æ¶ˆæ¯åˆ·ç›˜åˆ°è®¡ç®—æœºçš„æ–‡ä»¶ç³»ç»Ÿæ¥åšæŒä¹…åŒ–(åŒæ­¥åˆ·ç›˜/å¼‚æ­¥åˆ·ç›˜) æ¶ˆæ¯å‘é€ # é¡ºåºå†™ï¼š600MB/sï¼Œéšæœºå†™ï¼š100KB/s\nç³»ç»Ÿè¿è¡Œä¸€æ®µæ—¶é—´åï¼Œæˆ‘ä»¬å¯¹æ–‡ä»¶çš„å¢åˆ æ”¹ä¼šå¯¼è‡´ç£ç›˜ä¸Šæ•°æ®æ— æ³•è¿ç»­ï¼Œéå¸¸çš„åˆ†æ•£ã€‚\né¡ºåºè¯»ä¹Ÿåªæ˜¯é€»è¾‘ä¸Šçš„é¡ºåºï¼Œä¹Ÿå°±æ˜¯æŒ‰ç…§å½“å‰æ–‡ä»¶çš„ç›¸å¯¹åç§»é‡é¡ºåºè¯»å–ï¼Œå¹¶éç£ç›˜ä¸Šè¿ç»­ç©ºé—´è¯»å–\nå¯¹äºç£ç›˜çš„è¯»å†™åˆ†ä¸ºä¸¤ç§æ¨¡å¼ï¼Œé¡ºåºIOå’ŒéšæœºIOã€‚ éšæœºIOå­˜åœ¨ä¸€ä¸ªå¯»å€çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥æ•ˆç‡æ¯”è¾ƒä½ã€‚è€Œé¡ºåºIOï¼Œç›¸å½“äºæœ‰ä¸€ä¸ªç‰©ç†ç´¢å¼•ï¼Œåœ¨è¯»å–çš„æ—¶å€™ä¸éœ€è¦å¯»æ‰¾åœ°å€ï¼Œæ•ˆç‡å¾ˆé«˜ã€‚\næ¥æºï¼š https://www.cnblogs.com/liuche/p/15455808.html\næ•°æ®ç½‘ç»œä¼ è¾“\né›¶æ‹·è´æŠ€æœ¯MappedByteBufferï¼Œçœå»äº†ç”¨æˆ·æ€ï¼Œç”±å†…æ ¸æ€ç›´æ¥æ‹·è´åˆ°ç½‘ç»œé©±åŠ¨å†…æ ¸ã€‚ RocketMQé»˜è®¤è®¾ç½®å•ä¸ªCommitLogæ—¥å¿—æ•°æ®æ–‡ä»¶ä¸º1G\næ¶ˆæ¯å­˜å‚¨ # ä¸‰ä¸ªæ¦‚å¿µï¼šcommitLogã€ConsumerQueueã€index\nCommitLog # é»˜è®¤å¤§å°1G\nå­˜å‚¨æ¶ˆæ¯çš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬äº†Topicã€QueueIdã€Message è¿˜å­˜å‚¨äº†ConsumerQueueç›¸å…³ä¿¡æ¯ï¼Œæ‰€ä»¥ConsumerQueueä¸¢äº†ä¹Ÿæ²¡äº‹ ConsumerQueue # å­˜å‚¨äº†æ¶ˆæ¯åœ¨CommitLogçš„ç´¢å¼•ï¼ˆå‡ ç™¾Kï¼ŒLinuxä¼šäº‹å…ˆåŠ è½½åˆ°å†…å­˜ä¸­ï¼‰ åŒ…æ‹¬æœ€å°/æœ€å¤§åç§»é‡ã€å·²ç»æ¶ˆè´¹çš„åç§»é‡ ä¸€ä¸ªTopicå¤šä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—å¯¹åº”ä¸€ä¸ªConsumerQueue\nIndex # ä¹Ÿæ˜¯ç´¢å¼•æ–‡ä»¶ï¼Œä¸ºæ¶ˆæ¯æŸ¥è¯¢æœåŠ¡ï¼Œé€šè¿‡keyæˆ–æ—¶é—´åŒºé—´æŸ¥è¯¢æ¶ˆæ¯\næ€»ç»“ # åˆ·ç›˜æœºåˆ¶ # åŒæ­¥åˆ·ç›˜ å¼‚æ­¥åˆ·ç›˜ é«˜å¯ç”¨æ€§æœºåˆ¶ # æ¶ˆè´¹é«˜å¯ç”¨åŠå‘é€é«˜å¯ç”¨ # æ¶ˆæ¯ä¸»ä»å¤åˆ¶ # è´Ÿè½½å‡è¡¡ # æ¶ˆæ¯é‡è¯• # ä¸‹é¢éƒ½æ˜¯é’ˆå¯¹æ¶ˆè´¹å¤±è´¥çš„é‡è¯•\né¡ºåºæ¶ˆæ¯ # RocketMQä¼šè‡ªåŠ¨ä¸æ–­é‡è¯•ï¼Œä¸”ä¸ºäº†ä¿è¯é¡ºåºæ€§ï¼Œä¼šå¯¼è‡´æ¶ˆæ¯æ¶ˆè´¹è¢«é˜»å¡ã€‚ä½¿ç”¨æ—¶è¦åŠæ—¶ç›‘æ§å¹¶å¤„ç†æ¶ˆè´¹å¤±è´¥ç°è±¡\næ— åºæ¶ˆæ¯ï¼ˆæ™®é€šã€å®šæ—¶ã€å»¶æ—¶ã€äº‹åŠ¡ï¼‰ # é€šè¿‡è®¾ç½®è¿”å›çŠ¶æ€è¾¾åˆ°æ¶ˆæ¯é‡è¯•çš„ç»“æœ é‡è¯•åªå¯¹é›†ç¾¤æ¶ˆè´¹æ–¹å¼ç”Ÿæ•ˆï¼Œå¹¿æ’­æ–¹å¼ä¸æä¾›é‡è¯•ç‰¹æ€§ é‡è¯•æ¬¡æ•° å¦‚æœ16æ¬¡åè¿˜æ˜¯æ¶ˆè´¹å¤±è´¥ï¼Œä¼šè¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼Œä¸å†è¢«æ¶ˆè´¹ é…ç½®æ˜¯å¦é‡è¯• # é‡è¯• # ä¸é‡è¯•ï¼Œè®¤ä¸ºæ¶ˆè´¹æˆåŠŸ # ä¿®æ”¹é‡è¯•æ¬¡æ•° # åœ¨åˆ›å»ºæ¶ˆè´¹è€…çš„æ—¶å€™ï¼Œä¼ å…¥Propertieså³å¯\næ³¨æ„äº‹é¡¹ # messge.getReconsumeTimes()è·å–æ¶ˆæ¯å·²ç»é‡è¯•çš„æ¬¡æ•°\næ­»ä¿¡é˜Ÿåˆ— # ç‰¹æ€§ # é’ˆå¯¹çš„æ˜¯æ¶ˆè´¹è€…ç»„ï¼›ä¸å†è¢«æ­£å¸¸æ¶ˆè´¹ï¼›æœ‰è¿‡æœŸæ—¶é—´ï¼›\næŸ¥çœ‹ # é€šè¿‡adminçš„æ§åˆ¶å°æŸ¥çœ‹\nå¯é‡å‘ï¼›å¯æŒ‡å®šåç‰¹æ®Šæ¶ˆè´¹\nå¯ä»¥é‡å‘ï¼Œä¹Ÿå¯ä»¥å†™ä¸€ä¸ªæ¶ˆè´¹è€…ï¼ŒæŒ‡å®šæ­»ä¿¡é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯\næ¶ˆè´¹å¹‚ç­‰ # åŒä¸€æ¡æ¶ˆæ¯ä¸è®ºæ¶ˆè´¹å¤šå°‘æ¬¡ï¼Œç»“æœåº”è¯¥éƒ½æ˜¯ä¸€æ ·çš„\nå‘é€æ—¶å‘é€çš„æ¶ˆæ¯é‡å¤ # "},{"id":215,"href":"/zh/docs/study/Algorithm/algorithhms_4th/1.5.1-1.5.3/","title":"ç®—æ³•çº¢çš®ä¹¦ 1.5.1-1.5.3","section":"_ç®—æ³•(ç¬¬å››ç‰ˆ)_","content":" æ¡ˆä¾‹ç ”ç©¶ï¼šunion-find ç®—æ³• # è®¾è®¡å’Œåˆ†æç®—æ³•çš„åŸºæœ¬æ–¹æ³• ä¼˜ç§€çš„ç®—æ³•èƒ½è§£å†³å®é™…é—®é¢˜ é«˜æ•ˆçš„ç®—æ³•ä¹Ÿå¯ä»¥å¾ˆç®€å• ç†è§£æŸä¸ªå®ç°çš„æ€§èƒ½ç‰¹ç‚¹æ˜¯ä¸€é¡¹æœ‰è¶£çš„æŒ‘æˆ˜ åœ¨è§£å†³åŒä¸€ä¸ªé—®é¢˜çš„å¤šç§ç®—æ³•é—´é€‰æ‹©ï¼Œç§‘å­¦æ–¹æ³•æ˜¯ä¸€ç§é‡è¦å·¥å…· è¿­ä»£å¼æ”¹è¿›èƒ½è®©ç®—æ³•æ•ˆç‡è¶Šæ¥è¶Šé«˜ åŠ¨æ€è¿é€šæ€§ # ä»è¾“å…¥ä¸­è¯»å–æ•´æ•°å¯¹p qï¼Œå¦‚æœå·²çŸ¥çš„æ‰€æœ‰æ•´æ•°å¯¹éƒ½ä¸èƒ½è¯´æ˜p,qç›¸è¿ï¼Œå°±æ‰“å°å‡ºpq ç½‘ç»œï¼šæ•´ä¸ªç¨‹åºèƒ½å¤Ÿåˆ¤å®šæ˜¯å¦éœ€è¦åœ¨pqä¹‹é—´æ¶è®¾ä¸€æ¡æ–°çš„è¿æ¥æ‰èƒ½è¿›è¡Œé€šä¿¡ å˜é‡åç­‰ä»·æ€§ï¼ˆå³æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªå¼•ç”¨ï¼‰ æ•°å­¦é›†åˆï¼šåœ¨å¤„ç†ä¸€ä¸ªæ•´æ•°å¯¹pqæ—¶ï¼Œæˆ‘ä»¬æ˜¯åœ¨åˆ¤æ–­å®ƒä»¬æ˜¯å¦å±äºç›¸åŒçš„é›†åˆ æœ¬èŠ‚ä¸­ï¼Œå°†å¯¹è±¡ç§°ä¸ºè§¦ç‚¹ï¼Œæ•´æ•°å¯¹ç§°ä¸ºè¿æ¥ï¼Œç­‰ä»·ç±»ç§°ä¸ºè¿é€šåˆ†é‡æˆ–æ˜¯ç®€ç§°åˆ†é‡ è¿é€šæ€§ é—®é¢˜åªè¦æ±‚æˆ‘ä»¬çš„ç¨‹åºèƒ½å¤Ÿåˆ¤åˆ«ç»™å®šçš„æ•´æ•°å¯¹pqæ˜¯å¦ç›¸è¿ï¼Œå¹¶æ²¡æœ‰è¦æ±‚ç»™ä¸¤è€…ä¹‹é—´çš„é€šè·¯ä¸Šçš„æ‰€æœ‰è¿æ¥ union-findç®—æ³•çš„API\næ•°æ®ç»“æ„å’Œç®—æ³•çš„è®¾è®¡å½±å“åˆ°ç®—æ³•çš„æ•ˆç‡ å®ç° # public class UF { private int[]\tid; /* åˆ†é‡idï¼ˆä»¥è§¦ç‚¹ä½œä¸ºç´¢å¼•ï¼‰ */ private int\tcount; /* åˆ†é‡æ•°é‡ */ public UF( int N ) { /* åˆå§‹åŒ–åˆ†é‡idæ•°ç»„ */ count\t= N; id\t= new int[N]; for ( int i = 0; i \u0026lt; N; i++ ) id[i] = i; } public int count() { return(count); } public Boolean connected( int p, int q ) { return(find( p ) == find( q ) ); } public int find( int p ) public void union( int p, int q ) /* è¯·è§1.5.2.1èŠ‚ç”¨ä¾‹ï¼ˆquick-findï¼‰ã€1.5.2.3èŠ‚ç”¨ä¾‹ï¼ˆquick-unionï¼‰å’Œç®—æ³•1.5ï¼ˆåŠ æƒquick-unionï¼‰ */ public static void main( String[] args ) { /* è§£å†³ç”±StdInå¾—åˆ°çš„åŠ¨æ€è¿é€šæ€§é—®é¢˜ */ int\tN\t= StdIn.readint(); /* è¯»å–è§¦ç‚¹æ•°é‡ */ UF\tuf\t= new UF( N ); /* åˆå§‹åŒ–Nä¸ªåˆ†é‡ */ while ( !StdIn.isEmpty() ) { int\tp\t= StdIn.readint(); int\tq\t= StdIn.readint(); /* è¯»å–æ•´æ•°å¯¹ */ if ( uf.connected( p, q ) ) continue; /* å¦‚æœå·²ç»è¿é€šåˆ™å¿½ç•¥ */ uf.union( p, q ); /* å½’å¹¶åˆ†é‡ */ StdOut.println( p + \u0026#34; \u0026#34; + q ); /* æ‰“å°è¿æ¥ */ } StdOut.println( uf.count() + \u0026#34;components\u0026#34; ); } } union-findçš„æˆæœ¬æ¨¡å‹ï¼šunion-find APIçš„å„ç§ç®—æ³•ï¼Œç»Ÿè®¡çš„æ˜¯æ•°ç»„çš„è®¿é—®æ¬¡æ•°ï¼Œä¸è®ºè¯»å†™\nä»¥ä¸‹æœ‰ä¸‰ç§å®ç°\nä¸”ä»…å½“id[p] ç­‰äºid[q] æ—¶p å’Œq æ˜¯è¿é€šçš„\npublic int find(int p) { return id[p]; } public void union(int p, int q) { // å°†på’Œqå½’å¹¶åˆ°ç›¸åŒçš„åˆ†é‡ä¸­ int pID = find(p);mi int qID = find(q); // å¦‚æœpå’Œqå·²ç»åœ¨ç›¸åŒçš„åˆ†é‡ä¹‹ä¸­åˆ™ä¸éœ€è¦é‡‡å–ä»»ä½•è¡ŒåŠ¨ if (pID == qID) return; // å°†pçš„åˆ†é‡é‡å‘½åä¸ºqçš„åç§° for (int i = 0; i \u0026lt; id.length; i++) if (id[i] == pID) id[i] = qID; count--; } å‘½é¢˜Fï¼šåœ¨quick-find ç®—æ³•ä¸­ï¼Œæ¯æ¬¡find() è°ƒç”¨åªéœ€è¦è®¿é—®æ•°ç»„ä¸€æ¬¡ï¼Œè€Œå½’å¹¶ä¸¤ä¸ªåˆ†é‡çš„union() æ“ä½œè®¿é—®æ•°ç»„çš„æ¬¡æ•°åœ¨(N+3) åˆ°(2N+1) ä¹‹é—´ã€‚\nè¯æ˜ï¼šç”±ä»£ç é©¬ä¸Šå¯ä»¥çŸ¥é“ï¼Œæ¯æ¬¡connected() è°ƒç”¨éƒ½ä¼šæ£€æŸ¥id[] æ•°ç»„ä¸­çš„ä¸¤ä¸ªå…ƒç´ æ˜¯å¦ç›¸ç­‰ï¼Œå³ä¼šè°ƒç”¨ä¸¤æ¬¡find() æ–¹æ³•ã€‚å½’å¹¶ä¸¤ä¸ªåˆ†é‡çš„union() æ“ä½œä¼šè°ƒç”¨ä¸¤æ¬¡find()ï¼Œæ£€æŸ¥id[] æ•°ç»„ä¸­çš„å…¨éƒ¨N ä¸ªå…ƒç´ å¹¶æ”¹å˜å®ƒä»¬ä¸­1 åˆ°N-1 ä¸ªå…ƒç´ çš„å€¼ã€‚\nå‡è®¾æˆ‘ä»¬ä½¿ç”¨quick-find ç®—æ³•æ¥è§£å†³åŠ¨æ€è¿é€šæ€§é—®é¢˜å¹¶ä¸”æœ€ååªå¾—åˆ°äº†ä¸€ä¸ªè¿é€šåˆ†é‡ï¼Œé‚£ä¹ˆè¿™è‡³å°‘éœ€è¦è°ƒç”¨N-1 æ¬¡union()ï¼Œå³è‡³å°‘(N+3)(N-1) ï½ N2 æ¬¡æ•°ç»„è®¿é—®â€”â€”æˆ‘ä»¬é©¬ä¸Šå¯ä»¥çŒœæƒ³åŠ¨æ€è¿é€šæ€§çš„quick-find ç®—æ³•æ˜¯å¹³æ–¹çº§åˆ«çš„\nä»¥è§¦ç‚¹ä½œä¸ºç´¢å¼•çš„id[]æ•°ç»„ï¼Œæ¯ä¸ªè§¦ç‚¹æ‰€å¯¹åº”çš„id[]å…ƒç´ éƒ½æ˜¯åŒä¸€ä¸ªåˆ†é‡ä¸­çš„å¦ä¸€ä¸ªè§¦ç‚¹çš„åç§° å¦‚ä¸‹å›¾ï¼š private int find(int p) { // æ‰¾å‡ºåˆ†é‡çš„åç§° while (p != id[p]) p = id[p]; return p; } public void union(int p, int q) { // å°†på’Œqçš„æ ¹èŠ‚ç‚¹ç»Ÿä¸€ int pRoot = find(p); int qRoot = find(q); if (pRoot == qRoot) return; id[pRoot] = qRoot; count--; } quick-unionç®—æ³•çš„æœ€åæƒ…å†µ åŠ æƒquick-unionç®—æ³•ï¼ˆå‡å°‘æ ‘çš„é«˜åº¦ï¼‰ ç”¨ä¸€ä¸ªæ•°ç»„æ¥è¡¨ç¤ºå„ä¸ªèŠ‚ç‚¹å¯¹åº”çš„åˆ†é‡çš„å¤§å°\npublic class WeightedQuickUnionUF { private int[] id; // çˆ¶é“¾æ¥æ•°ç»„ï¼ˆç”±è§¦ç‚¹ç´¢å¼•ï¼‰ private int[] sz; // ï¼ˆç”±è§¦ç‚¹ç´¢å¼•çš„ï¼‰å„ä¸ªæ ¹èŠ‚ç‚¹æ‰€å¯¹åº”çš„åˆ†é‡çš„å¤§å° private int count; // è¿é€šåˆ†é‡çš„æ•°é‡ public WeightedQuickUnionUF(int N) { count = N; id = new int[N]; for (int i = 0; i \u0026lt; N; i++) id[i] = i; sz = new int[N]; for (int i = 0; i \u0026lt; N; i++) sz[i] = 1; } public int count() { return count; } public Boolean connected(int p, int q) { return find(p) == find(q); } public int find(int p) { // è·Ÿéšé“¾æ¥æ‰¾åˆ°æ ¹èŠ‚ç‚¹ while (p != id[p]) p = id[p]; return p; } public void union(int p, int q) { int i = find(p); int j = find(q); if (i == j) return; // å°†å°æ ‘çš„æ ¹èŠ‚ç‚¹è¿æ¥åˆ°å¤§æ ‘çš„æ ¹èŠ‚ç‚¹ if (sz[i] \u0026lt; sz[j]) { id[i] = j; sz[j] += sz[i]; } else { id[j] = i; sz[i] += sz[j]; } count--; } } quick-union ç®—æ³•ä¸åŠ æƒquick-union ç®—æ³•çš„å¯¹æ¯”ï¼ˆ100 ä¸ªè§¦ç‚¹ï¼Œ88 æ¬¡union() æ“ä½œï¼‰ æ‰€æœ‰æ“ä½œçš„æ€»æˆæœ¬ å±•æœ› # ç ”ç©¶é—®é¢˜çš„æ­¥éª¤\nå®Œæ•´è€Œè¯¦ç»†åœ°å®šä¹‰é—®é¢˜ï¼Œæ‰¾å‡ºè§£å†³é—®é¢˜æ‰€å¿…éœ€çš„åŸºæœ¬æŠ½è±¡æ“ä½œå¹¶å®šä¹‰ä¸€ä»½ APIã€‚ ç®€æ´åœ°å®ç°ä¸€ç§åˆçº§ç®—æ³•ï¼Œç»™å‡ºä¸€ä¸ªç²¾å¿ƒç»„ç»‡çš„å¼€å‘ç”¨ä¾‹å¹¶ä½¿ç”¨å®é™…æ•°æ®ä½œä¸ºè¾“å…¥ã€‚ å½“å®ç°æ‰€èƒ½è§£å†³çš„é—®é¢˜çš„æœ€å¤§è§„æ¨¡è¾¾ä¸åˆ°æœŸæœ›æ—¶å†³å®šæ”¹è¿›è¿˜æ˜¯æ”¾å¼ƒã€‚ é€æ­¥æ”¹è¿›å®ç°ï¼Œé€šè¿‡ç»éªŒæ€§åˆ†ææˆ–ï¼ˆå’Œï¼‰æ•°å­¦åˆ†æéªŒè¯æ”¹è¿›åçš„æ•ˆæœã€‚ ç”¨æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡è¡¨ç¤ºæ•°æ®ç»“æ„æˆ–ç®—æ³•æ¥è®¾è®¡æ›´é«˜çº§çš„æ”¹è¿›ç‰ˆæœ¬ã€‚ å¦‚æœå¯èƒ½å°½é‡ä¸ºæœ€åæƒ…å†µä¸‹çš„æ€§èƒ½æä¾›ä¿è¯ï¼Œä½†åœ¨å¤„ç†æ™®é€šæ•°æ®æ—¶ä¹Ÿè¦æœ‰è‰¯å¥½çš„æ€§èƒ½ã€‚ åœ¨é€‚å½“çš„æ—¶å€™å°†æ›´ç»†è‡´çš„æ·±å…¥ç ”ç©¶ç•™ç»™æœ‰ç»éªŒçš„ç ”ç©¶è€…å¹¶ç»§ç»­è§£å†³ä¸‹ä¸€ä¸ªé—®é¢˜ã€‚ "},{"id":216,"href":"/zh/docs/study/RocketMQ/heima/04case/","title":"04æ¡ˆä¾‹","section":"åŸºç¡€(é»‘é©¬)_","content":" å­¦ä¹ æ¥æº https://www.bilibili.com/video/BV1L4411y7mnï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!åŸºæœ¬æ¶æ„\næ¶æ„ # æµç¨‹å›¾ # ä¸‹å•æµç¨‹ # æ”¯ä»˜æµç¨‹ # SpringBootæ•´åˆRocketMQ # ä¾èµ–åŒ… # \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.rocketmq\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rocketmq-spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; ç”Ÿäº§è€… # yaml # rocketmq: name-server: 192.168.1.135:9876;192.168.1.138:9876 producer: group: my-group ä½¿ç”¨ # @Autowired private RocketMQTemplate template; @RequestMapping(\u0026#34;rocketmq\u0026#34;) public String rocketmq(){ log.info(\u0026#34;æˆ‘è¢«è°ƒç”¨äº†-rocketmq\u0026#34;); //ä¸»é¢˜+å†…å®¹ template.convertAndSend(\u0026#34;mytopic-ly\u0026#34;,\u0026#34;hello1231\u0026#34;); return \u0026#34;hello world\u0026#34;+serverPort; } æ¶ˆè´¹è€… # yaml # rocketmq: name-server: 192.168.1.135:9876;192.168.1.138:9876 consumer: group: my-group2 ä½¿ç”¨ # åˆ›å»ºç›‘å¬å™¨\n@RocketMQMessageListener(topic = \u0026#34;mytopic-ly\u0026#34;, consumeMode = ConsumeMode.CONCURRENTLY,consumerGroup = \u0026#34;${rocketmq.producer.group}\u0026#34;) @Slf4j @Component public class Consumer implements RocketMQListener\u0026lt;String\u0026gt; { @Override public void onMessage(String s) { log.info(\u0026#34;æ¶ˆè´¹äº†\u0026#34;+s); } } ä¸‹å•æµç¨‹åˆ©ç”¨MQè¿›è¡Œå›é€€å¤„ç†ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ # åº“å­˜å›é€€çš„æ¶ˆè´¹è€…ï¼Œä»£ç å¦‚ä¸‹ï¼š\n@Slf4j @Component @RocketMQMessageListener(topic = \u0026#34;${mq.order.topic}\u0026#34;,consumerGroup = \u0026#34;${mq.order.consumer.group.name}\u0026#34;,messageModel = MessageModel.BROADCASTING ) public class CancelMQListener implements RocketMQListener\u0026lt;MessageExt\u0026gt;{ @Value(\u0026#34;${mq.order.consumer.group.name}\u0026#34;) private String groupName; @Autowired private TradeGoodsMapper goodsMapper; @Autowired private TradeMqConsumerLogMapper mqConsumerLogMapper; @Autowired private TradeGoodsNumberLogMapper goodsNumberLogMapper; @Override public void onMessage(MessageExt messageExt) { String msgId=null; String tags=null; String keys=null; String body=null; try { //1. è§£ææ¶ˆæ¯å†…å®¹ msgId = messageExt.getMsgId(); tags= messageExt.getTags(); keys= messageExt.getKeys(); body= new String(messageExt.getBody(),\u0026#34;UTF-8\u0026#34;); log.info(\u0026#34;æ¥å—æ¶ˆæ¯æˆåŠŸ\u0026#34;); //2. æŸ¥è¯¢æ¶ˆæ¯æ¶ˆè´¹è®°å½• TradeMqConsumerLogKey primaryKey = new TradeMqConsumerLogKey(); primaryKey.setMsgTag(tags); primaryKey.setMsgKey(keys); primaryKey.setGroupName(groupName); TradeMqConsumerLog mqConsumerLog = mqConsumerLogMapper.selectByPrimaryKey(primaryKey); if(mqConsumerLog!=null){ //3. åˆ¤æ–­å¦‚æœæ¶ˆè´¹è¿‡... //3.1 è·å¾—æ¶ˆæ¯å¤„ç†çŠ¶æ€ Integer status = mqConsumerLog.getConsumerStatus(); //å¤„ç†è¿‡...è¿”å› if(ShopCode.SHOP_MQ_MESSAGE_STATUS_SUCCESS.getCode().intValue()==status.intValue()){ log.info(\u0026#34;æ¶ˆæ¯:\u0026#34;+msgId+\u0026#34;,å·²ç»å¤„ç†è¿‡\u0026#34;); return; } //æ­£åœ¨å¤„ç†...è¿”å› if(ShopCode.SHOP_MQ_MESSAGE_STATUS_PROCESSING.getCode().intValue()==status.intValue()){ log.info(\u0026#34;æ¶ˆæ¯:\u0026#34;+msgId+\u0026#34;,æ­£åœ¨å¤„ç†\u0026#34;); return; } //å¤„ç†å¤±è´¥ if(ShopCode.SHOP_MQ_MESSAGE_STATUS_FAIL.getCode().intValue()==status.intValue()){ //è·å¾—æ¶ˆæ¯å¤„ç†æ¬¡æ•° Integer times = mqConsumerLog.getConsumerTimes(); if(times\u0026gt;3){ log.info(\u0026#34;æ¶ˆæ¯:\u0026#34;+msgId+\u0026#34;,æ¶ˆæ¯å¤„ç†è¶…è¿‡3æ¬¡,ä¸èƒ½å†è¿›è¡Œå¤„ç†äº†\u0026#34;); return; } mqConsumerLog.setConsumerStatus(ShopCode.SHOP_MQ_MESSAGE_STATUS_PROCESSING.getCode()); //ä½¿ç”¨æ•°æ®åº“ä¹è§‚é”æ›´æ–° TradeMqConsumerLogExample example = new TradeMqConsumerLogExample(); TradeMqConsumerLogExample.Criteria criteria = example.createCriteria(); criteria.andMsgTagEqualTo(mqConsumerLog.getMsgTag()); criteria.andMsgKeyEqualTo(mqConsumerLog.getMsgKey()); criteria.andGroupNameEqualTo(groupName); criteria.andConsumerTimesEqualTo(mqConsumerLog.getConsumerTimes()); int r = mqConsumerLogMapper.updateByExampleSelective(mqConsumerLog, example); if(r\u0026lt;=0){ //æœªä¿®æ”¹æˆåŠŸ,å…¶ä»–çº¿ç¨‹å¹¶å‘ä¿®æ”¹ log.info(\u0026#34;å¹¶å‘ä¿®æ”¹,ç¨åå¤„ç†\u0026#34;); } } }else{ //4. åˆ¤æ–­å¦‚æœæ²¡æœ‰æ¶ˆè´¹è¿‡... mqConsumerLog = new TradeMqConsumerLog(); mqConsumerLog.setMsgTag(tags); mqConsumerLog.setMsgKey(keys); mqConsumerLog.setGroupName(groupName); mqConsumerLog.setConsumerStatus(ShopCode.SHOP_MQ_MESSAGE_STATUS_PROCESSING.getCode()); mqConsumerLog.setMsgBody(body); mqConsumerLog.setMsgId(msgId); mqConsumerLog.setConsumerTimes(0); //å°†æ¶ˆæ¯å¤„ç†ä¿¡æ¯æ·»åŠ åˆ°æ•°æ®åº“ mqConsumerLogMapper.insert(mqConsumerLog); } //5. å›é€€åº“å­˜ MQEntity mqEntity = JSON.parseObject(body, MQEntity.class); Long goodsId = mqEntity.getGoodsId(); TradeGoods goods = goodsMapper.selectByPrimaryKey(goodsId); goods.setGoodsNumber(goods.getGoodsNumber()+mqEntity.getGoodsNum()); goodsMapper.updateByPrimaryKey(goods); //6. å°†æ¶ˆæ¯çš„å¤„ç†çŠ¶æ€æ”¹ä¸ºæˆåŠŸ mqConsumerLog.setConsumerStatus(ShopCode.SHOP_MQ_MESSAGE_STATUS_SUCCESS.getCode()); mqConsumerLog.setConsumerTimestamp(new Date()); mqConsumerLogMapper.updateByPrimaryKey(mqConsumerLog); log.info(\u0026#34;å›é€€åº“å­˜æˆåŠŸ\u0026#34;); } catch (Exception e) { e.printStackTrace(); TradeMqConsumerLogKey primaryKey = new TradeMqConsumerLogKey(); primaryKey.setMsgTag(tags); primaryKey.setMsgKey(keys); primaryKey.setGroupName(groupName); TradeMqConsumerLog mqConsumerLog = mqConsumerLogMapper.selectByPrimaryKey(primaryKey); if(mqConsumerLog==null){ //æ•°æ®åº“æœªæœ‰è®°å½• mqConsumerLog = new TradeMqConsumerLog(); mqConsumerLog.setMsgTag(tags); mqConsumerLog.setMsgKey(keys); mqConsumerLog.setGroupName(groupName); mqConsumerLog.setConsumerStatus(ShopCode.SHOP_MQ_MESSAGE_STATUS_FAIL.getCode()); mqConsumerLog.setMsgBody(body); mqConsumerLog.setMsgId(msgId); mqConsumerLog.setConsumerTimes(1); mqConsumerLogMapper.insert(mqConsumerLog); }else{ mqConsumerLog.setConsumerTimes(mqConsumerLog.getConsumerTimes()+1); mqConsumerLogMapper.updateByPrimaryKeySelective(mqConsumerLog); } } } } "},{"id":217,"href":"/zh/docs/study/RocketMQ/heima/03messagetype/","title":"03æ”¶å‘æ¶ˆæ¯","section":"åŸºç¡€(é»‘é©¬)_","content":" å­¦ä¹ æ¥æº https://www.bilibili.com/video/BV1L4411y7mnï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!å‰æ\nä¾èµ–åŒ… # \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.rocketmq\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;rocketmq-client\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.4.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; æ¶ˆæ¯ç”Ÿäº§è€…æ­¥éª¤ # åˆ›å»ºç”Ÿäº§è€…ï¼Œç”Ÿäº§è€…ç»„å\u0026ndash;\u0026gt;æŒ‡å®šnameserveråœ°å€\u0026ndash;\u0026gt;å¯åŠ¨producer\u0026ndash;\u0026gt;\nåˆ›å»ºæ¶ˆæ¯å¯¹è±¡(Topicã€Tagã€æ¶ˆæ¯ä½“)\nå‘é€æ¶ˆæ¯ã€å…³é—­ç”Ÿäº§è€…producer\næ¶ˆæ¯æ¶ˆè´¹è€…æ­¥éª¤ # åˆ›å»ºæ¶ˆè´¹è€…ï¼Œåˆ¶å®šæ¶ˆè´¹è€…ç»„å\u0026ndash;\u0026gt;æŒ‡å®šnameserveråœ°å€\nè®¢é˜…Topicå’ŒTagï¼Œè®¾ç½®å›è°ƒå‡½æ•°å¤„ç†æ¶ˆæ¯\nå¯åŠ¨æ¶ˆè´¹è€…consumer\næ¶ˆæ¯å‘é€ # åŒæ­¥æ¶ˆæ¯ # å‘é€æ¶ˆæ¯åå®¢æˆ·ç«¯ä¼šè¿›è¡Œé˜»å¡ï¼Œç›´åˆ°å¾—åˆ°ç»“æœåï¼Œå®¢æˆ·ç«¯æ‰ä¼šç»§ç»­æ‰§è¡Œ\npublic static void main(String[] args) throws MQClientException, MQBrokerException, RemotingException, InterruptedException { //åˆ›å»ºProducerï¼Œå¹¶æŒ‡å®šç”Ÿäº§è€…ç»„ DefaultMQProducer producer = new DefaultMQProducer(\u0026#34;group1\u0026#34;); producer.setNamesrvAddr(\u0026#34;192.168.1.135:9876;192.168.1.138:9876\u0026#34;); producer.start(); for (int i = 0; i \u0026lt; 10; i++) { Message msg = new Message(); msg.setTopic(\u0026#34;base\u0026#34;); msg.setTags(\u0026#34;Tag1\u0026#34;); msg.setBody((\u0026#34;hello world\u0026#34; + i).getBytes()); //å‘é€æ¶ˆæ¯ SendResult result = producer.send(msg); //å‘é€çŠ¶æ€ SendStatus sendStatus = result.getSendStatus(); //æ¶ˆæ¯id String msgId = result.getMsgId(); //æ¶ˆæ¯æ¥æ”¶é˜Ÿåˆ—id MessageQueue messageQueue = result.getMessageQueue(); int queueId = messageQueue.getQueueId(); log.info(result.toString()); log.info(messageQueue.toString()); log.info(\u0026#34;status:\u0026#34; + sendStatus + \u0026#34;msgId:\u0026#34; + msgId + \u0026#34;queueId\u0026#34; + queueId); TimeUnit.SECONDS.sleep(1); } log.info(\u0026#34;å‘é€ç»“æŸ===================\u0026#34;); producer.shutdown(); } å¼‚æ­¥æ¶ˆæ¯ # å‘é€æ¶ˆæ¯åä¸ä¼šå¯¼è‡´é˜»å¡ï¼Œå½“brokerè¿”å›ç»“æœæ—¶ï¼Œä¼šè°ƒç”¨å›è°ƒå‡½æ•°è¿›è¡Œå¤„ç†\npublic static void main(String[] args) throws MQClientException, MQBrokerException, RemotingException, InterruptedException { //åˆ›å»ºProducerï¼Œå¹¶æŒ‡å®šç”Ÿäº§è€…ç»„ DefaultMQProducer producer = new DefaultMQProducer(\u0026#34;group1\u0026#34;); producer.setNamesrvAddr(\u0026#34;192.168.1.135:9876;192.168.1.138:9876\u0026#34;); producer.start(); for (int i = 0; i \u0026lt; 10; i++) { Message msg = new Message(); msg.setTopic(\u0026#34;base\u0026#34;); msg.setTags(\u0026#34;Tag1\u0026#34;); msg.setBody((\u0026#34;hello world\u0026#34; + i).getBytes()); //å‘é€æ¶ˆæ¯ producer.send(msg, new SendCallback() { @Override public void onSuccess(SendResult result) { //å‘é€çŠ¶æ€ SendStatus sendStatus = result.getSendStatus(); //æ¶ˆæ¯id String msgId = result.getMsgId(); //æ¶ˆæ¯æ¥æ”¶é˜Ÿåˆ—id MessageQueue messageQueue = result.getMessageQueue(); int queueId = messageQueue.getQueueId(); log.info(result.toString()); log.info(messageQueue.toString()); log.info(\u0026#34;status:\u0026#34; + sendStatus + \u0026#34;msgId:\u0026#34; + msgId + \u0026#34;queueId\u0026#34; + queueId); } @Override public void onException(Throwable throwable) { log.error(\u0026#34;å‘é€å¼‚å¸¸\u0026#34; + throwable); } }); //TimeUnit.SECONDS.sleep(1); } log.info(\u0026#34;å‘é€ç»“æŸ===================\u0026#34;); TimeUnit.SECONDS.sleep(3); } å•å‘æ¶ˆæ¯ # ä¸å…³å¿ƒå‘é€ç»“æœ\npublic static void main(String[] args) throws MQClientException, MQBrokerException, RemotingException, InterruptedException { //åˆ›å»ºProducerï¼Œå¹¶æŒ‡å®šç”Ÿäº§è€…ç»„ DefaultMQProducer producer = new DefaultMQProducer(\u0026#34;group1\u0026#34;); producer.setNamesrvAddr(\u0026#34;192.168.1.135:9876;192.168.1.138:9876\u0026#34;); producer.start(); for (int i = 0; i \u0026lt; 10; i++) { Message msg = new Message(); msg.setTopic(\u0026#34;base\u0026#34;); msg.setTags(\u0026#34;Tag3\u0026#34;); msg.setBody((\u0026#34;hello world danxiang\u0026#34; + i).getBytes()); //å‘é€æ¶ˆæ¯ producer.sendOneway(msg); //TimeUnit.SECONDS.sleep(1); } log.info(\u0026#34;å‘é€ç»“æŸ===================\u0026#34;); TimeUnit.SECONDS.sleep(3); } æ¶ˆè´¹æ¶ˆæ¯ # public static void main(String[] args) throws MQClientException { DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(\u0026#34;group1\u0026#34;); consumer.setNamesrvAddr(\u0026#34;192.168.1.135:9876;192.168.1.138:9876\u0026#34;); consumer.subscribe(\u0026#34;base\u0026#34;, \u0026#34;Tag3\u0026#34;); consumer.registerMessageListener(new MessageListenerConcurrently() { @Override public ConsumeConcurrentlyStatus consumeMessage(List\u0026lt;MessageExt\u0026gt; list, ConsumeConcurrentlyContext consumeConcurrentlyContext) { for (MessageExt messageExt : list) { log.info(messageExt.toString()); String s = new String(messageExt.getBody()); log.info(s); } return ConsumeConcurrentlyStatus.CONSUME_SUCCESS; } }); consumer.start(); } æ¶ˆè´¹æ¨¡å¼ # æ³¨æ„äº‹é¡¹ # å¦‚æœä¸€ä¸ªæ¶ˆæ¯åœ¨å¹¿æ’­æ¶ˆè´¹æ¨¡å¼ä¸‹è¢«æ¶ˆè´¹è¿‡ï¼Œä¹‹åå†å¯åŠ¨ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥åœ¨é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ä¸‹å†è¢«æ¶ˆè´¹ä¸€æ¬¡ã€‚æˆ–è€…ï¼š\nå¦‚æœä¸€ä¸ªæ¶ˆæ¯åœ¨é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ä¸‹è¢«æ¶ˆè´¹è¿‡ï¼Œä¹‹åå†å¯åŠ¨ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥åœ¨å¹¿æ’­æ¶ˆè´¹æ¨¡å¼ä¸‹å†è¢«æ¶ˆè´¹ä¸€æ¬¡ å¦‚æœä¸€ä¸ªæ¶ˆæ¯åœ¨å¹¿æ’­æ¶ˆè´¹æ¨¡å¼ä¸‹è¢«æ¶ˆè´¹è¿‡ï¼Œä¹‹åå†å¯åŠ¨ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆå®ƒä¸èƒ½åœ¨å¹¿æ’­æ¨¡å¼ä¸‹å†è¢«æ¶ˆè´¹ã€‚æˆ–è€…\nå¦‚æœä¸€ä¸ªæ¶ˆæ¯åœ¨é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ä¸‹è¢«æ¶ˆè´¹è¿‡ï¼Œä¹‹åå†å¯åŠ¨ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆå®ƒä¸èƒ½åœ¨é›†ç¾¤æ¨¡å¼ä¸‹å†è¢«æ¶ˆè´¹ã€‚ é¡ºåºæ¶ˆæ¯ # æ¶ˆæ¯å®ä½“ # @Data @AllArgsConstructor @NoArgsConstructor @ToString public class OrderStep { private int orderId; private String desc; public static List\u0026lt;OrderStep\u0026gt; getData(){ List\u0026lt;OrderStep\u0026gt; orderSteps=new ArrayList\u0026lt;\u0026gt;(); OrderStep orderStep=new OrderStep(123,\u0026#34;åˆ›å»º\u0026#34;); orderSteps.add(orderStep); orderStep=new OrderStep(125,\u0026#34;åˆ›å»º\u0026#34;); orderSteps.add(orderStep); orderStep=new OrderStep(123,\u0026#34;ä»˜æ¬¾\u0026#34;); orderSteps.add(orderStep); orderStep=new OrderStep(125,\u0026#34;ä»˜æ¬¾\u0026#34;); orderSteps.add(orderStep); orderStep=new OrderStep(123,\u0026#34;æ¨é€\u0026#34;); orderSteps.add(orderStep); orderStep=new OrderStep(124,\u0026#34;åˆ›å»º\u0026#34;); orderSteps.add(orderStep); orderStep=new OrderStep(124,\u0026#34;ä»˜æ¬¾\u0026#34;); orderSteps.add(orderStep); orderStep=new OrderStep(124,\u0026#34;æ¨é€\u0026#34;); orderSteps.add(orderStep); orderStep=new OrderStep(123,\u0026#34;å®Œæˆ\u0026#34;); orderSteps.add(orderStep); orderStep=new OrderStep(125,\u0026#34;æ¨é€\u0026#34;); orderSteps.add(orderStep); return orderSteps; } } å‘é€æ¶ˆæ¯ # //åŒä¸€ä¸ªè®¢å•çš„æ¶ˆæ¯ï¼Œæ”¾åœ¨åŒä¸€ä¸ªtopicçš„åŒä¸€ä¸ªqueueé‡Œé¢ public static void main(String[] args) throws MQClientException { DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(\u0026#34;group1\u0026#34;); consumer.setNamesrvAddr(\u0026#34;192.168.1.135:9876;192.168.1.138:9876\u0026#34;); consumer.subscribe(\u0026#34;base\u0026#34;, \u0026#34;Tag1\u0026#34;); consumer.setMessageModel(MessageModel.BROADCASTING); consumer.registerMessageListener(new MessageListenerConcurrently() { @Override public ConsumeConcurrentlyStatus consumeMessage(List\u0026lt;MessageExt\u0026gt; list, ConsumeConcurrentlyContext consumeConcurrentlyContext) { for (MessageExt messageExt : list) { //log.info(messageExt.toString()); String s = new String(messageExt.getBody()); log.info(s); } return ConsumeConcurrentlyStatus.CONSUME_SUCCESS; } }); consumer.start(); } é¡ºåºæ¶ˆè´¹æ¶ˆæ¯ # public class ConsumerOrder { public static void main(String[] args) throws MQClientException { DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(\u0026#34;group1\u0026#34;); consumer.setNamesrvAddr(\u0026#34;192.168.1.135:9876;192.168.1.138:9876\u0026#34;); consumer.subscribe(\u0026#34;OrderTopic\u0026#34;, \u0026#34;*\u0026#34;); consumer.registerMessageListener(new MessageListenerOrderly() { @Override public ConsumeOrderlyStatus consumeMessage(List\u0026lt;MessageExt\u0026gt; list, ConsumeOrderlyContext consumeOrderlyContext) { for (MessageExt messageExt : list) { //log.info(messageExt.toString()); String s = new String(messageExt.getBody()); log.info(s); } return ConsumeOrderlyStatus.SUCCESS; } }); consumer.start(); } } MessageListenerOrderly ä¿è¯äº†åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å»æ¶ˆè´¹è¿™ä¸ªqueueï¼Œä½†ä¸èƒ½ä¿è¯æ¯æ¬¡æ¶ˆè´¹queueçš„ä¼šæ˜¯åŒä¸€ä¸ªçº¿ç¨‹\nç”±äºqueueå…·æœ‰å…ˆè¿›å…ˆå‡ºçš„æœ‰åºæ€§ï¼Œæ‰€ä»¥è¿™å¹¶ä¸å½±å“æ¶ˆè´¹queueä¸­æ¶ˆæ¯çš„é¡ºåºæ€§\nå»¶æ—¶æ¶ˆæ¯ # åœ¨ç”Ÿäº§è€…ç«¯è®¾ç½®ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªæ¶ˆæ¯åœ¨ä¸€å®šå»¶æ—¶åæ‰èƒ½æ¶ˆè´¹\nmessage.setDelayTimLevel(2) //çº§åˆ«2ï¼Œå³å»¶æ—¶10ç§’//1s 5s 10s 30s 1m\næ‰¹é‡æ¶ˆæ¯å‘é€ # producer.send(List\u0026lt;Message\u0026gt; messages)\näº‹åŠ¡æ¶ˆæ¯ # äº‹åŠ¡æ¶ˆæ¯çš„æ¶æ„å›¾ # ç”Ÿäº§è€… # public class SyncProducer { public static void main(String[] args) throws MQClientException, MQBrokerException, RemotingException, InterruptedException { //åˆ›å»ºProducerï¼Œå¹¶æŒ‡å®šç”Ÿäº§è€…ç»„ TransactionMQProducer producer = new TransactionMQProducer(\u0026#34;group1\u0026#34;); producer.setNamesrvAddr(\u0026#34;192.168.1.135:9876;192.168.1.138:9876\u0026#34;); producer.setTransactionListener(new TransactionListener() { /** * åœ¨è¯¥æ–¹æ³•ä¸­æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ * @param message * @param o * @return */ @Override public LocalTransactionState executeLocalTransaction(Message message, Object o) { if(\u0026#34;TAGA\u0026#34;.equals(message.getTags())){ return LocalTransactionState.COMMIT_MESSAGE; }else if(\u0026#34;TAGB\u0026#34;.equals(message.getTags())){ return LocalTransactionState.ROLLBACK_MESSAGE; }else if(\u0026#34;TAGC\u0026#34;.equals(message.getTags())){ return LocalTransactionState.UNKNOW; } return LocalTransactionState.UNKNOW; } /** * è¯¥æ–¹æ³•æ—¶MQè¿›è¡Œæ¶ˆæ¯æ˜¯æ— çŠ¶æ€çš„å›æŸ¥ * @param messageExt * @return */ @Override public LocalTransactionState checkLocalTransaction(MessageExt messageExt) { log.info(\u0026#34;æ¶ˆæ¯çš„å›æŸ¥:\u0026#34;+messageExt.getTags()); try { log.info(\u0026#34;5såå‘Šè¯‰mqå¯ä»¥æäº¤äº†\u0026#34;); TimeUnit.SECONDS.sleep(5); } catch (InterruptedException e) { e.printStackTrace(); } //å¯ä»¥æäº¤ return LocalTransactionState.COMMIT_MESSAGE; } }); producer.start(); String[] tags={\u0026#34;TAGA\u0026#34;,\u0026#34;TAGB\u0026#34;,\u0026#34;TAGC\u0026#34;}; for (int i = 0; i \u0026lt; 3; i++) { Message msg = new Message(); msg.setTopic(\u0026#34;TransactionTopic\u0026#34;); msg.setTags(tags[i]); msg.setBody((\u0026#34;hello world\u0026#34; + i).getBytes()); //å‘é€æ¶ˆæ¯ //å‚æ•°ï¼šé’ˆå¯¹æŸä¸€ä¸ªæ¶ˆæ¯è¿›è¡Œäº‹åŠ¡æ§åˆ¶ SendResult result = producer.sendMessageInTransaction(msg,null); //å‘é€çŠ¶æ€ SendStatus sendStatus = result.getSendStatus(); log.info(result.toString()); log.info(\u0026#34;status:\u0026#34; + sendStatus ); } log.info(\u0026#34;å‘é€ç»“æŸ===================\u0026#34;); //producer.shutdown(); } } æ¶ˆè´¹è€… # @Slf4j public class Consumer { public static void main(String[] args) throws MQClientException { DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(\u0026#34;group1\u0026#34;); consumer.setNamesrvAddr(\u0026#34;192.168.1.135:9876;192.168.1.138:9876\u0026#34;); consumer.subscribe(\u0026#34;TransactionTopic\u0026#34;, \u0026#34;*\u0026#34;); consumer.registerMessageListener(new MessageListenerConcurrently() { @Override public ConsumeConcurrentlyStatus consumeMessage(List\u0026lt;MessageExt\u0026gt; list, ConsumeConcurrentlyContext consumeConcurrentlyContext) { for (MessageExt messageExt : list) { String s = new String(messageExt.getBody()); log.info(s); } return ConsumeConcurrentlyStatus.CONSUME_SUCCESS; } }); consumer.start(); log.info(\u0026#34;ç”Ÿäº§è€…å¯åŠ¨----\u0026#34;); } } "},{"id":218,"href":"/zh/docs/study/Algorithm/algorithhms_4th/1.4.1-1.4.10/","title":"ç®—æ³•çº¢çš®ä¹¦ 1.4.1-1.4.10","section":"_ç®—æ³•(ç¬¬å››ç‰ˆ)_","content":" ç®—æ³•åˆ†æ # ä½¿ç”¨æ•°å­¦åˆ†æä¸ºç®—æ³•æˆæœ¬å»ºç«‹ç®€æ´çš„æ¨¡å‹ï¼Œå¹¶ä½¿ç”¨å®éªŒæ•°æ®éªŒè¯è¿™äº›æ¨¡å‹\nç§‘å­¦æ–¹æ³• # è§‚å¯Ÿã€å‡è®¾ã€é¢„æµ‹ã€è§‚å¯Ÿå¹¶æ ¸å®é¢„æµ‹ã€åå¤ç¡®è®¤é¢„æµ‹å’Œè§‚å¯Ÿ åŸåˆ™ï¼šå®éªŒå¯é‡ç° è§‚å¯Ÿ # è®¡ç®—æ€§ä»»åŠ¡çš„å›°éš¾ç¨‹åº¦å¯ä»¥ç”¨é—®é¢˜çš„è§„æ¨¡æ¥è¡¡é‡\né—®é¢˜è§„æ¨¡å¯ä»¥æ˜¯è¾“å…¥çš„å¤§å°æˆ–æŸä¸ªå‘½ä»¤è¡Œå‚æ•°çš„å€¼\nç ”ç©¶é—®é¢˜è§„æ¨¡å’Œè¿è¡Œæ—¶é—´çš„å…³ç³»\nä½¿ç”¨è®¡æ—¶å™¨å¾—åˆ°å¤§æ¦‚çš„è¿è¡Œæ—¶é—´ å…¸å‹ç”¨ä¾‹\npublic static void main(String[] args) { int N = Integer.parseInt(args[0]); int[] a = new int[N]; for (int i = 0; i \u0026lt; N; i++) a[i] = StdRandom.uniform(-1000000, 1000000); Stopwatch timer = new Stopwatch(); int cnt = ThreeSum.count(a); double time = timer.elapsedTime(); StdOut.println(cnt + \u0026#34; triples \u0026#34; + time + \u0026#34; seconds\u0026#34;); } ä½¿ç”¨æ–¹æ³• æ•°æ®ç±»å‹çš„å®ç°\npublic class Stopwatch { private final long start; public Stopwatch() { start = System.currentTimeMillis(); } public double elapsedTime() { long now = System.currentTimeMillis(); return (now - start) / 1000.0; } } æ•°å­¦æ¨¡å‹ # ç¨‹åºè¿è¡Œçš„æ€»æ—¶é—´ä¸»è¦å’Œä¸¤ç‚¹æœ‰å…³ï¼šæ‰§è¡Œæ¯æ¡è¯­å¥çš„è€—æ—¶ï¼›æ‰§è¡Œæ¯æ¡è¯­å¥çš„é¢‘ç‡\nå®šä¹‰ï¼šæˆ‘ä»¬ç”¨~f(N) è¡¨ç¤ºæ‰€æœ‰éšç€N çš„å¢å¤§é™¤ä»¥f(N) çš„ç»“æœè¶‹è¿‘äº1 çš„å‡½æ•°ã€‚æˆ‘ä»¬ç”¨g(N) ~ f(N) è¡¨ç¤ºg(N)/f(N) éšç€N çš„å¢å¤§è¶‹è¿‘äº1ã€‚ å³ä½¿ç”¨æ›°ç­‰å·å¿½ç•¥è¾ƒå°çš„é¡¹\n$$ f(N)=N^b(logN)^c $$\nå°†f(N)ç§°ä¸ºg(N)çš„å¢é•¿çš„æ•°é‡çº§\nå¸¸è§çš„å¢é•¿æ•°é‡çº§å‡½æ•° æœ¬ä¹¦ç”¨æ€§è´¨è¡¨ç¤ºéœ€è¦ç”¨å®éªŒéªŒè¯çš„çŒœæƒ³\nThreeSumåˆ†æ æ‰§è¡Œæœ€é¢‘ç¹çš„æŒ‡ä»¤å†³å®šäº†ç¨‹åºæ‰§è¡Œçš„æ€»æ—¶é—´\u0026ndash;æˆ‘ä»¬å°†è¿™äº›æŒ‡ä»¤ç§°ä¸ºç¨‹åºçš„å†…å¾ªç¯\nç¨‹åºè¿è¡Œæ—¶é—´çš„åˆ†æ ç®—æ³•çš„åˆ†æ ThreeSumçš„è¿è¡Œæ—¶é—´å¢é•¿æ•°é‡çº§ä¸ºN^3ï¼Œä¸åœ¨å“ªå°æœºå™¨æ— å…³\næˆæœ¬æ¨¡å‹ 3-sumçš„æˆæœ¬æ¨¡å‹ï¼šæ•°ç»„çš„è®¿é—®æ¬¡æ•°ï¼ˆè®¿é—®æ•°ç»„å…ƒç´ çš„æ¬¡æ•°ï¼Œæ— è®ºè¯»å†™ï¼‰\næ€»ç»“-å¾—åˆ°è¿è¡Œæ—¶é—´çš„æ•°å­¦æ¨¡å‹æ‰€éœ€çš„æ­¥éª¤\nç¡®å®šè¾“å…¥æ¨¡å‹ï¼Œå®šä¹‰é—®é¢˜çš„è§„æ¨¡ è¯†åˆ«å†…å¾ªç¯ æ ¹æ®å†…å¾ªç¯ä¸­çš„æ“ä½œç¡®å®šæˆæœ¬æ¨¡å‹ å¯¹äºç»™å®šçš„è¾“å…¥ï¼Œåˆ¤æ–­è¿™äº›æ“ä½œçš„æ‰§è¡Œæ•ˆç‡ å¢é•¿æ•°é‡çº§çš„åˆ†ç±» # æˆé•¿å¢é•¿çš„æ•°é‡çº§ä¸€èˆ¬éƒ½æ˜¯é—®é¢˜è§„æ¨¡Nçš„è‹¥å¹²å‡½æ•°ä¹‹ä¸€ï¼Œå¦‚ä¸‹è¡¨ å¸¸æ•°çº§åˆ«è¡¨ç¤ºè¿è¡Œæ—¶é—´ä¸ä¾èµ–äºN å¯¹æ•°çº§åˆ«ï¼Œç»å…¸ä¾‹å­æ˜¯äºŒåˆ†æŸ¥æ‰¾ çº¿æ€§çº§åˆ«ï¼ˆå¸¸è§çš„forå¾ªç¯ï¼‰ çº¿æ€§å¯¹æ•°çº§åˆ« ï¼Œå…¶ä¸­ï¼Œå¯¹æ•°çš„åº•æ•°å’Œå¢é•¿çš„æ•°é‡çº§æ— å…³ å¹³æ–¹çº§åˆ«ï¼Œä¸€èˆ¬æŒ‡ä¸¤ä¸ªåµŒå¥—çš„forå¾ªç¯ ç«‹æ–¹çº§åˆ«ï¼Œä¸€èˆ¬å«æœ‰ä¸‰ä¸ªåµŒå¥—çš„forå¾ªç¯ æŒ‡æ•°çº§åˆ« é—®é¢˜è§„æ¨¡ï¼ˆå›¾ï¼‰ å…¸å‹çš„å¢é•¿æ•°é‡çº§å‡½æ•°ï¼ˆå›¾ï¼‰ å…¸å‹çš„å¢é•¿æ•°é‡çº§å‡½æ•° åœ¨æŸä¸ªæˆæœ¬æ¨¡å‹ä¸‹å¯ä»¥æå‡ºç²¾ç¡®çš„å‘½é¢˜ æ¯”å¦‚ï¼Œå½’å¹¶æ’åºæ‰€éœ€çš„æ¯”è¾ƒæ¬¡æ•°åœ¨$1/2NlgN$~$NlgN$ä¹‹é—´ ï¼Œå³å½’å¹¶æ’åºæ‰€éœ€çš„è¿è¡Œæ—¶é—´çš„å¢é•¿æ•°é‡çº§æ˜¯çº¿æ€§å¯¹æ•°çš„ï¼Œä¹Ÿå°±æ˜¯ï¼šå½’å¹¶æ’åºæ˜¯çº¿æ€§å¯¹æ•°çš„ è®¾è®¡æ›´å¿«çš„ç®—æ³• # å‰æï¼Œç›®å‰å·²çŸ¥å½’å¹¶æ’åºæ˜¯çº¿æ€§å¯¹æ•°çº§åˆ«çš„ï¼ŒäºŒåˆ†æŸ¥æ‰¾æ˜¯å¯¹æ•°çº§åˆ«çš„\nå°†3-sumé—®é¢˜ç®€åŒ–ä¸º2-sumé—®é¢˜ï¼Œå³æ‰¾å‡ºä¸€ä¸ªè¾“å…¥æ–‡ä»¶ä¸­æ‰€æœ‰å’Œä¸º0çš„æ•´æ•°å¯¹çš„æ•°é‡ï¼Œä¸ºäº†ç®€åŒ–é—®é¢˜ï¼Œé¢˜è®¾æ‰€æœ‰æ•´æ•°å‡ä¸ç›¸åŒ\nå¯ä»¥ä½¿ç”¨åŒå±‚å¾ªç¯ï¼Œä»¥å¹³æ–¹çº§åˆ«æ¥è§£å†³\næ”¹è¿›åçš„ç®—æ³•ï¼Œå½“ä¸”ä»…å½“-a[i]å­˜åœ¨äºæ•°ç»„ä¸­ä¸”a[i]éé›¶æ—¶ï¼Œa[i]å­˜åœ¨äºæŸä¸ªå’Œä¸º0çš„æ•´æ•°å¯¹ä¹‹ä¸­\nä»£ç å¦‚ä¸‹\nimport java.util.Arrays; public class TwoSumFast { public static int count(int[] a) { // è®¡ç®—å’Œä¸º0çš„æ•´æ•°å¯¹çš„æ•°ç›® Arrays.sort(a); int N = a.length; int cnt = 0; for (int i = 0; i \u0026lt; N; i++) if (BinarySearch.rank(-a[i], a) \u0026gt; i) cnt++; return cnt; } public static void main(String[] args) { int[] a = In.readInts(args[0]); StdOut.println(count(a)); } } 3-sumé—®é¢˜çš„å¿«é€Ÿç®—æ³•\nå½“ä¸”ä»…å½“-(a[i]+a[j])åœ¨æ•°ç»„ä¸­,ä¸”ä¸æ˜¯a[i]ä¹Ÿä¸æ˜¯a[j]æ—¶ï¼Œæ•´æ•°å¯¹(a[i]å’Œa[j])ä¸ºæŸä¸ªå’Œä¸º0çš„ä¸‰å…ƒç»„çš„ä¸€éƒ¨åˆ†\næ€»è¿è¡Œæ—¶é—´å’Œ$N^2logN$æˆæ­£æ¯”\nä»£ç å¦‚ä¸‹\nimport java.util.Arrays; public class ThreeSumFast { public static int count(int[] a) { // è®¡ç®—å’Œä¸ºï¼çš„ä¸‰å…ƒç»„çš„æ•°ç›® Arrays.sort(a); int N = a.length; int cnt = 0; for (int i = 0; i \u0026lt; N; i++) for (int j = i + 1; j \u0026lt; N; j++) if (BinarySearch.rank(-a[i] - a[j], a) \u0026gt; j) { cnt++; } return cnt; } public static void main(String[] args) { int[] a = In.readInts(args[0]); StdOut.println(count(a)); } } ä¸‹ç•Œ\nä¸ºç®—æ³•åœ¨æœ€åæƒ…å†µä¸‹çš„è¿è¡Œæ—¶é—´ç»™å‡ºä¸€ä¸ªä¸‹ç•Œçš„æ€ æƒ³æ˜¯éå¸¸æœ‰æ„ä¹‰çš„\nè¿è¡Œæ—¶é—´çš„æ€»ç»“\nå›¾1 å›¾2 å®ç°å¹¶åˆ†æè¯¥é—®é¢˜çš„ä¸€ç§ç®€å•è§£æ³•ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæš´åŠ›ç®—æ³•\nç®—æ³•çš„æ”¹è¿›ï¼Œèƒ½é™ä½ç®—æ³•æ‰€éœ€çš„è¿è¡Œæ—¶é—´çš„å¢é•¿æ•°é‡çº§\nå€ç‡å®éªŒ # ç¿»å€åè¿è¡Œæ—¶é—´ï¼Œä¸æ²¡ç¿»å€æ—¶çš„è¿è¡Œæ—¶é—´æˆæ­£æ¯”\nä»£ç \npublic class DoublingRatio { public static double timeTrial(int N) // å‚è§DoublingTestï¼ˆè¯·è§1.4.2.3 èŠ‚å®éªŒç¨‹åºï¼‰ public static void main(String[] args) { double prev = timeTrial(125); for (int N = 250; true; N += N) { double time = timeTrial(N); StdOut.printf(\u0026#34;%6d %7.1f \u0026#34;, N, time); StdOut.printf(\u0026#34;%5.1fn\u0026#34;, time/prev); prev = time; } } } è¯•éªŒç»“æœ é¢„æµ‹ å€ç‡å®šç†ï¼ˆæ²¡çœ‹æ‡‚ï¼Œä¸ç®¡ï¼‰ è¯„ä¼°å®ƒè§£å†³å¤§å‹é—®é¢˜çš„å¯è¡Œæ€§ è¯„ä¼°ä½¿ç”¨æ›´å¿«çš„è®¡ç®—æœºæ‰€äº§ç”Ÿçš„ä»·å€¼ æ³¨æ„äº‹é¡¹ # å¤§å¸¸æ•°ï¼Œ$c = 10^3æˆ–10^6$ éå†³å®šæ€§çš„å†…å¾ªç¯ æŒ‡ä»¤æ—¶é—´ ç³»ç»Ÿå› ç´  ä¸åˆ†ä¼¯ä»²ï¼ˆç›¸åŒä»»åŠ¡åœ¨ä¸åŒåœºæ™¯æ•ˆç‡ä¸ä¸€æ ·ï¼‰ å¯¹è¾“å…¥çš„å¼ºçƒˆä¾èµ– å¤šä¸ªé—®é¢˜å‚é‡ å¤„ç†å¯¹äºè¾“å…¥çš„ä¾èµ– # è¾“å…¥æ¨¡å‹ï¼Œä¾‹å¦‚å‡è®¾ThreeSumçš„æ‰€æœ‰è¾“å…¥å‡ä¸ºéšæœºintå€¼ï¼Œå¯èƒ½ä¸åˆ‡å®é™… è¾“å…¥çš„åˆ†æï¼Œéœ€è¦æ•°å­¦å‡ åƒ å¯¹æœ€åæƒ…å†µä¸‹çš„æ€§èƒ½ä¿è¯ å‘½é¢˜ï¼ˆè¿™é‡Œåªé’ˆå¯¹ä¹‹å‰çš„ä»£ç ï¼‰ å¯¹è®¡åˆ’ç®—æ³•ï¼Œæœ‰æ—¶å€™å¯¹è¾“å…¥éœ€è¦è¿›è¡Œæ‰“ä¹± æ“ä½œåºåˆ— å‡æ‘Šåˆ†æ é€šè¿‡è®°å½•æ‰€æœ‰æ“ä½œçš„æ€»æˆæœ¬å¹¶é™¤ä»¥æ“ä½œæ€»æ•°æ¥å°†æˆæœ¬å‡æ‘Š å†…å­˜ # Javaçš„å†…å­˜åˆ†é…ç³»ç»Ÿ åŸå§‹æ•°æ®ç±»å‹çš„å¸¸è§å†…å­˜ã€éœ€æ±‚ è¿™é‡Œæ¼äº†ï¼Œshortä¹Ÿæ˜¯2å­—èŠ‚ã€‚æ€»ç»“booleanã€byte 1å­—èŠ‚ï¼›charã€short 2å­—èŠ‚ï¼›intã€float 4å­—èŠ‚ï¼›longã€double 8å­—èŠ‚ å¯¹è±¡ï¼ˆè·³è¿‡ï¼‰ è¦çŸ¥é“ä¸€ä¸ªå¯¹è±¡æ‰€ä½¿ç”¨çš„å†…å­˜é‡ï¼Œéœ€è¦å°†æ‰€æœ‰å®ä¾‹å˜é‡ä½¿ç”¨çš„å†…å­˜ä¸å†…å­˜æœ¬èº«çš„å¼€é”€ï¼ˆä¸€èˆ¬æ˜¯16å­—èŠ‚ï¼‰\nä¸€èˆ¬å†…å­˜çš„ä½¿ç”¨éƒ½ä¼šè¢«å¡«å……ä¸º8å­—èŠ‚çš„å€æ•°ï¼ˆæ³¨æ„ï¼Œè¯´çš„æ˜¯64ä½è®¡ç®—æœºä¸­çš„æœºå™¨å­—ï¼‰\nå¼•ç”¨å­˜å‚¨éœ€è¦8å­—èŠ‚\nå…¸å‹å¯¹è±¡çš„å†…å­˜éœ€æ±‚ ä¾‹å¦‚ç¬¬ä¸€ä¸ªï¼Œ16+4=20ï¼›20+4 = 24ä¸º8çš„å€æ•°\né“¾è¡¨ï¼ŒåµŒå¥—çš„éé™æ€ï¼ˆå†…éƒ¨ï¼‰ç±»ï¼Œå¦‚ä¸Šé¢çš„Nodeï¼Œéœ€è¦é¢å¤–çš„8å­—èŠ‚ï¼ˆç”¨äºå¤–éƒ¨ç±»çš„å¼•ç”¨ï¼‰\næ•°ç»„ intå€¼ã€doubleå€¼ã€å¯¹è±¡å’Œæ•°ç»„çš„æ•°ç»„å¯¹å†…å­˜çš„å…¸å‹éœ€æ±‚ æ¯”å¦‚ä¸€ä¸ªåŸå§‹æ•°æ®ç±»å‹çš„æ•°ç»„ï¼Œéœ€è¦24å­—èŠ‚çš„å¤´ä¿¡æ¯ï¼ˆ16å­—èŠ‚çš„å¯¹è±¡å¼€é”€ï¼Œ4å­—èŠ‚ç”¨äºä¿å­˜é•¿åº¦[æ•°ç»„é•¿åº¦]ï¼Œä»¥åŠ4å¡«å……å­—èŠ‚ï¼Œå†åŠ ä¸Šä¿å­˜å€¼éœ€è¦çš„å†…å­˜ï¼‰ Dateå¯¹è±¡éœ€è¦çš„ï¼šä¸€ä¸ªå«æœ‰N ä¸ªDate å¯¹è±¡ï¼ˆè¯·è§è¡¨1.2.12ï¼‰çš„æ•° ç»„éœ€è¦ä½¿ç”¨24 å­—èŠ‚ï¼ˆæ•°ç»„å¼€é”€ï¼‰åŠ ä¸Š8N å­—èŠ‚ï¼ˆæ‰€æœ‰å¼•ç”¨ï¼‰åŠ ä¸Šæ¯ä¸ªå¯¹è±¡çš„32 å­—èŠ‚ï¼Œæ€»å…±ï¼ˆ24 +40Nï¼‰å­—èŠ‚ ã€è¿™é‡Œè¯´çš„æ˜¯éœ€è¦ï¼Œå’Œæœ¬èº«å­˜å‚¨æ˜¯ä¸¤å›äº‹ã€‘\n![ly-20241212142056395](img/ly-20241212142056395.png) å­—ç¬¦ä¸²å¯¹è±¡\nString çš„æ ‡å‡†å®ç°å«æœ‰4 ä¸ªå®ä¾‹å˜é‡ï¼šä¸€ä¸ªæŒ‡å‘å­—ç¬¦æ•°ç»„çš„å¼•ç”¨ï¼ˆ8 å­—èŠ‚ï¼‰å’Œä¸‰ ä¸ªint å€¼ï¼ˆå„4 å­—èŠ‚ï¼‰ã€‚ç¬¬ä¸€ä¸ªint å€¼æè¿°çš„æ˜¯å­—ç¬¦æ•°ç»„ä¸­çš„åç§»é‡ï¼Œç¬¬äºŒä¸ªint å€¼æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼ˆå­—ç¬¦ä¸²çš„é•¿åº¦ï¼‰ã€‚æŒ‰ç…§å›¾1.4.10 ä¸­æ‰€ç¤ºçš„å®ä¾‹å˜é‡åï¼Œå¯¹è±¡æ‰€è¡¨ç¤ºçš„å­—ç¬¦ä¸²ç”±value[offset]åˆ°value[offset + count - 1] ä¸­çš„å­—ç¬¦ç»„æˆã€‚String å¯¹è±¡ä¸­çš„ç¬¬ä¸‰ä¸ªint å€¼æ˜¯ä¸€ä¸ªæ•£åˆ—å€¼ï¼Œå®ƒåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥èŠ‚çœä¸€äº›è®¡ç®—ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å¿½ç•¥å®ƒã€‚å› æ­¤ï¼Œæ¯ä¸ªString å¯¹è±¡æ€»å…±ä¼šä½¿ç”¨40å­—èŠ‚ï¼ˆ16 å­—èŠ‚è¡¨ç¤ºå¯¹è±¡ï¼Œä¸‰ä¸ªint å®ä¾‹å˜é‡å„éœ€4 å­—èŠ‚ï¼ŒåŠ ä¸Šæ•°ç»„å¼•ç”¨çš„8 å­—èŠ‚å’Œ4 ä¸ªå¡«å……å­—èŠ‚ï¼‰\nå­—ç¬¦ä¸²çš„å€¼å’Œå­å­—ç¬¦ä¸²\nä¸€ä¸ªé•¿åº¦ä¸ºN çš„String å¯¹è±¡ä¸€èˆ¬éœ€è¦ä½¿ç”¨40 å­—èŠ‚ï¼ˆString å¯¹è±¡æœ¬èº«ï¼‰åŠ ä¸Šï¼ˆ24+2Nï¼‰å­—èŠ‚ï¼ˆå­—ç¬¦æ•°ç»„ï¼‰ï¼Œæ€»å…±ï¼ˆ64+2Nï¼‰å­—èŠ‚ Java å¯¹å­—ç¬¦ä¸²çš„è¡¨ç¤ºå¸Œæœ›èƒ½å¤Ÿé¿å…å¤åˆ¶å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ ä¸€ä¸ªå­å­—ç¬¦ä¸²æ‰€éœ€çš„é¢å¤–å†…å­˜æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œæ„é€ ä¸€ä¸ªå­å­—ç¬¦ä¸²æ‰€éœ€çš„æ—¶é—´ä¹Ÿæ˜¯å¸¸æ•° å…³äºå­å­—ç¬¦ä¸² å±•æœ› # æœ€é‡è¦çš„æ˜¯ä»£ç æ­£ç¡®ï¼Œå…¶æ¬¡æ‰æ˜¯æ€§èƒ½ "},{"id":219,"href":"/zh/docs/study/Algorithm/algorithhms_4th/1.3.3.1-1.3.4/","title":"ç®—æ³•çº¢çš®ä¹¦1.3.3.1-1.3.4","section":"_ç®—æ³•(ç¬¬å››ç‰ˆ)_","content":" èƒŒåŒ…ã€é˜Ÿåˆ—å’Œæ ˆ # é“¾è¡¨ # é“¾è¡¨æ˜¯ä¸€ç§é€’å½’çš„æ•°æ®ç»“æ„ï¼Œå®ƒæˆ–è€…ä¸ºç©º(null)ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªæŒ‡å‘ä¸€ä¸ªç»“ç‚¹ï¼ˆnodeï¼‰çš„å¼•ç”¨ï¼Œè¯¥èŠ‚ç‚¹å«æœ‰ä¸€ä¸ªæ³›å‹çš„å…ƒç´ å’Œä¸€ä¸ªæŒ‡å‘å¦ä¸€æ¡é“¾è¡¨çš„å¼•ç”¨ã€‚ ç»“ç‚¹è®°å½• # ä½¿ç”¨åµŒå¥—ç±»å®šä¹‰ç»“ç‚¹çš„æŠ½è±¡æ•°æ®ç±»å‹\nprivate class Node { Item item; Node next; } è¯¥ç±»æ²¡æœ‰å…¶å®ƒä»»ä½•æ–¹æ³•ï¼Œä¸”ä¼šåœ¨ä»£ç ä¸­ç›´æ¥å¼•ç”¨å®ä¾‹å˜é‡ï¼Œè¿™ç§ç±»å‹çš„å˜é‡ç§°ä¸ºè®°å½• æ„é€ é“¾è¡¨ # éœ€è¦ä¸€ä¸ªNodeç±»å‹çš„å˜é‡ï¼Œä¿è¯å®ƒçš„å€¼æ˜¯nullæˆ–è€…æŒ‡å‘å¦ä¸€ä¸ªNodeå¯¹è±¡çš„nextåŸŸæŒ‡å‘äº†å¦ä¸€ä¸ªé“¾è¡¨ å¦‚ä¸‹å›¾ é“¾è¡¨è¡¨ç¤ºçš„æ˜¯ä¸€åˆ—å…ƒç´  é“¾å¼ç»“æ„åœ¨æœ¬ä¹¦ä¸­çš„å¯è§†åŒ–è¡¨ç¤º é•¿æ–¹å½¢è¡¨ç¤ºå¯¹è±¡ï¼›å®ä¾‹å˜é‡çš„å€¼å†™åœ¨é•¿æ–¹å½¢ä¸­ï¼›ç”¨æŒ‡å‘è¢«å¼•ç”¨å¯¹è±¡çš„ç®­å¤´è¡¨ç¤ºå¼•ç”¨å…³ç³» æœ¯è¯­é“¾æ¥è¡¨ç¤ºå¯¹ç»“ç‚¹çš„å¼•ç”¨ åœ¨è¡¨å¤´æ’å…¥ç»“ç‚¹ # åœ¨é¦–ç»“ç‚¹ä¸ºfirst çš„ç»™å®šé“¾è¡¨å¼€å¤´æ’å…¥å­—ç¬¦ä¸²notï¼Œæˆ‘ä»¬å…ˆå°†first ä¿å­˜åœ¨oldfirst ä¸­ï¼Œ ç„¶åå°†ä¸€ä¸ªæ–°ç»“ç‚¹èµ‹äºˆfirstï¼Œå¹¶å°†å®ƒçš„item åŸŸè®¾ä¸ºnotï¼Œnext åŸŸè®¾ä¸ºoldfirst\næ—¶é—´å¤æ‚åº¦ä¸ºO(1)\nå¦‚å›¾ ä»è¡¨å¤´åˆ é™¤ç»“ç‚¹ # å°†firstæŒ‡å‘first.next\nåŸå…ˆçš„ç»“ç‚¹ç§°ä¸ºå­¤å„¿ï¼ŒJavaçš„å†…å­˜ç®¡ç†ç³»ç»Ÿæœ€ç»ˆå°†å›æ”¶å®ƒæ‰€å ç”¨çš„å†…å­˜\nå¦‚å›¾ åœ¨è¡¨å°¾æ’å…¥ç»“ç‚¹ # æ¯ä¸ªä¿®æ”¹é“¾è¡¨çš„æ“ä½œéƒ½éœ€è¦å¢åŠ æ£€æŸ¥æ˜¯å¦è¦ä¿®æ”¹è¯¥å˜é‡ï¼ˆä»¥åŠåšå‡ºç›¸åº”ä¿®æ”¹ï¼‰çš„ä»£ç \nä¾‹å¦‚ï¼Œå½“åˆ é™¤é“¾è¡¨é¦–ç»“ç‚¹æ—¶å¯èƒ½æ”¹å˜æŒ‡å‘é“¾è¡¨çš„å°¾ç»“ç‚¹çš„å¼•ç”¨ï¼Œå› ä¸ºé“¾è¡¨ä¸­åªæœ‰ä¸€ä¸ªç»“ç‚¹æ—¶å®ƒæ—¢æ˜¯é¦–ç»“ç‚¹åˆæ˜¯å°¾ç»“ç‚¹\nå¦‚å›¾ å…¶ä»–ä½ç½®çš„æ’å…¥å’Œåˆ é™¤æ“ä½œ # åˆ é™¤æŒ‡å®šç»“ç‚¹ï¼›åœ¨æŒ‡å®šèŠ‚ç‚¹æ’å…¥æ–°ç»“ç‚¹\néœ€è¦å°†é“¾è¡¨å°¾ç»“ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„é“¾æ¥ï¼ˆå®ƒæŒ‡å‘çš„æ˜¯lastï¼‰å€¼æ”¹ä¸ºnull ä¸ºäº†æ‰¾åˆ°æŒ‡å‘lastçš„ç»“ç‚¹ï¼Œéœ€è¦éå†é“¾è¡¨ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n) å®ç°ä»»æ„æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ ‡å‡†è§£å†³æ–¹æ¡ˆæ˜¯åŒå‘é“¾è¡¨ éå† # å°†xåˆå§‹åŒ–ä¸ºé“¾è¡¨é¦–ç»“ç‚¹ï¼Œç„¶åé€šè¿‡x.itemè®¿é—®å’Œxç›¸å…³è”çš„å…ƒç´ ï¼Œå¹¶å°†xè®¾ä¸ºx.nextæ¥è®¿é—®é“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼ŒçŸ¥é“x=null(æ²¡æœ‰ä¸‹ä¸€ä¸ªç»“ç‚¹äº†ï¼Œåˆ°è¾¾é“¾è¡¨ç»“å°¾)\nfor (Node x = first; x != null; x = x.next) { // å¤„ç†x.item } æ ˆçš„å®ç° # ä½¿ç”¨é“¾è¡¨å®ç°æ ˆ\nå°†æ ˆä¿å­˜ä¸ºä¸€æ¡é“¾è¡¨ï¼Œæ ˆçš„é¡¶éƒ¨å³ä¸ºè¡¨å¤´ï¼Œå®ä¾‹å˜é‡first æŒ‡å‘æ ˆé¡¶ã€‚è¿™æ ·ï¼Œå½“ä½¿ç”¨push() å‹å…¥ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæˆ‘ä»¬ä¼šæŒ‰ç…§1.3.3.3 èŠ‚æ‰€è®¨è®ºçš„ä»£ç å°†è¯¥å…ƒç´ æ·»åŠ åœ¨è¡¨å¤´ï¼›å½“ä½¿ç”¨pop() åˆ é™¤ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæˆ‘ä»¬ä¼šæŒ‰ç…§1.3.3.4 èŠ‚è®¨è®ºçš„ä»£ç å°†è¯¥å…ƒç´ ä»è¡¨å¤´åˆ é™¤ã€‚è¦å®ç°size() æ–¹æ³•ï¼Œæˆ‘ä»¬ç”¨å®ä¾‹å˜é‡N ä¿å­˜å…ƒç´ çš„ä¸ªæ•°ï¼Œåœ¨å‹å…¥å…ƒç´ æ—¶å°†N åŠ 1ï¼Œåœ¨å¼¹å‡ºå…ƒç´ æ—¶å°†N å‡1ã€‚è¦å®ç°isEmpty() æ–¹æ³•ï¼Œåªéœ€æ£€æŸ¥first æ˜¯å¦ä¸ºnullï¼ˆæˆ–è€…å¯ä»¥æ£€æŸ¥N æ˜¯å¦ä¸º0ï¼‰\nå®ç°ä¸Šè¿°å‡ ä¸ªæ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)\nä¸‹å‹å †æ ˆï¼ˆé“¾è¡¨çš„å®ç°ï¼‰\npublic class Stack\u0026lt;Item\u0026gt; implements Iterable\u0026lt;Item\u0026gt; { private Node first; // æ ˆé¡¶ï¼ˆæœ€è¿‘æ·»åŠ çš„å…ƒç´ ï¼‰ private int N; // å…ƒç´ æ•°é‡ private class Node { // å®šä¹‰äº†ç»“ç‚¹çš„åµŒå¥—ç±» Item item; Node next; } public Boolean isEmpty() { return first == null; } // æˆ–ï¼šN == 0 public int size() { return N; } public void push(Item item) { // å‘æ ˆé¡¶æ·»åŠ å…ƒç´  Node oldfirst = first; first = new Node(); first.item = item; first.next = oldfirst; N++; } public Item pop() { // ä»æ ˆé¡¶åˆ é™¤å…ƒç´  Item item = first.item; first = first.next; N--; return item; } // iterator() çš„å®ç°è¯·è§ç®—æ³•1.4 // æµ‹è¯•ç”¨ä¾‹main() çš„å®ç°è¯·è§æœ¬èŠ‚å‰é¢éƒ¨åˆ† } æµ‹è¯•ç”¨ä¾‹(pop()ä¹‹å‰æµ‹è¯•ç”¨ä¾‹åšäº†åˆ¤æ–­)\npublic static void main(String[] args) { // åˆ›å»ºä¸€ä¸ªæ ˆå¹¶æ ¹æ®StdInä¸­çš„æŒ‡ç¤ºå‹å…¥æˆ–å¼¹å‡ºå­—ç¬¦ä¸² Stack\u0026lt;String\u0026gt; s = new Stack\u0026lt;String\u0026gt;(); while (!StdIn.isEmpty()) { String item = StdIn.readString(); if (!item.equals(\u0026#34;-\u0026#34;)) s.push(item); else if (!s.isEmpty()) StdOut.print(s.pop() + \u0026#34; \u0026#34;); } StdOut.println(\u0026#34;(\u0026#34; + s.size() + \u0026#34; left on stack)\u0026#34;); } é˜Ÿåˆ—çš„å®ç° # è¿™é‡Œç»´æŠ¤äº†firstå’Œlastä¸¤ä¸ªå˜é‡\nQueueå®ç°ä½¿ç”¨çš„æ•°æ®ç»“æ„å’ŒStackéƒ½æ˜¯é“¾è¡¨ï¼Œä½†å®ç°äº†ä¸åŒçš„æ·»åŠ å’Œåˆ é™¤å…ƒç´ çš„ç®—æ³•ï¼Œæ‰€ä»¥å‰è€…æ˜¯å…ˆå…¥å…ˆå‡ºï¼Œåè€…æ˜¯åè¿›å…ˆå‡º\nQueueçš„æµ‹è¯•ç”¨ä¾‹\npublic static void main(String[] args) { // åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—å¹¶æ“ä½œå­—ç¬¦ä¸²å…¥åˆ—æˆ–å‡ºåˆ— Queue\u0026lt;String\u0026gt; q = new Queue\u0026lt;String\u0026gt;(); while (!StdIn.isEmpty()) { String item = StdIn.readString(); if (!item.equals(\u0026#34;-\u0026#34;)) q.enqueue(item); else if (!q.isEmpty()) StdOut.print(q.dequeue() + \u0026#34; \u0026#34;); } StdOut.println(\u0026#34;(\u0026#34; + q.size() + \u0026#34; left on queue)\u0026#34;); } Queueçš„æµ‹è¯•ç”¨ä¾‹\npublic static void main(String[] args) { // åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—å¹¶æ“ä½œå­—ç¬¦ä¸²å…¥åˆ—æˆ–å‡ºåˆ— Queue\u0026lt;String\u0026gt; q = new Queue\u0026lt;String\u0026gt;(); while (!StdIn.isEmpty()) { String item = StdIn.readString(); if (!item.equals(\u0026#34;-\u0026#34;)) q.enqueue(item); else if (!q.isEmpty()) StdOut.print(q.dequeue() + \u0026#34; \u0026#34;); } StdOut.println(\u0026#34;(\u0026#34; + q.size() + \u0026#34; left on queue)\u0026#34;); } Queueçš„å®ç°\nå¦‚ä¸‹ï¼Œenqueue()éœ€è¦é¢å¤–è€ƒè™‘firstï¼Œdequeue()éœ€è¦é¢å¤–è€ƒè™‘last å¦‚æœåŸé˜Ÿåˆ—æ²¡æœ‰ç»“ç‚¹ï¼Œé‚£ä¹ˆå¢åŠ ålastæŒ‡å‘äº†æ–°çš„å…ƒç´ ï¼Œåº”è¯¥æŠŠfirstä¹ŸæŒ‡å‘æ–°å…ƒç´  å¦‚æœåŸå¯¹é˜Ÿåˆ—åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆåˆ é™¤åfirstç¡®å®æŒ‡å‘nullï¼Œè€Œlastæ²¡æœ‰æ›´æ–°ï¼Œæ‰€ä»¥éœ€è¦ä¸‹é¢çš„åˆ¤æ–­æ‰‹åŠ¨æ›´æ–° public class Queue\u0026lt;Item\u0026gt; implements Iterable\u0026lt;Item\u0026gt; { private Node first; // æŒ‡å‘æœ€æ—©æ·»åŠ çš„ç»“ç‚¹çš„é“¾æ¥ private Node last; // æŒ‡å‘æœ€è¿‘æ·»åŠ çš„ç»“ç‚¹çš„é“¾æ¥ private int N; // é˜Ÿåˆ—ä¸­çš„å…ƒç´ æ•°é‡ private class Node { // å®šä¹‰äº†ç»“ç‚¹çš„åµŒå¥—ç±» Item item; Node next; } public Boolean isEmpty() { return first == null; } // æˆ–ï¼š N == 0. public int size() { return N; } public void enqueue(Item item) { // å‘è¡¨å°¾æ·»åŠ å…ƒç´  Node oldlast = last; last = new Node(); last.item = item; last.next = null; if (isEmpty()) first = last; else oldlast.next = last; N++; } public Item dequeue() { // ä»è¡¨å¤´åˆ é™¤å…ƒç´  Item item = first.item; first = first.next; if (isEmpty()) last = null; N--; return item; } // iterator() çš„å®ç°è¯·è§ç®—æ³•1.4 // æµ‹è¯•ç”¨ä¾‹main() çš„å®ç°è¯·è§å‰é¢ } åœ¨ç»“æ„åŒ–æ•°æ®é›†æ—¶ï¼Œé“¾è¡¨æ˜¯æ•°ç»„çš„ä¸€ç§é‡è¦æ›¿ä»£æ–¹æ³•\nèƒŒåŒ…çš„å®ç° # åªéœ€è¦å°†Stackä¸­çš„push()æ”¹ä¸ºadd()å³å¯ï¼Œå¹¶å»æ‰pop()\nä¸‹é¢æ·»åŠ äº†Iteratorå®ç°ç±»ï¼Œä»¥åŠiterator()å…·ä½“æ–¹æ³• å…¶ä¸­ï¼ŒåµŒå¥—ç±»ListIterator ç»´æŠ¤äº†ä¸€ä¸ªå®ä¾‹å˜é‡currentæ¥è®°å½•é“¾è¡¨çš„å½“å‰ç»“ç‚¹ã€‚hasNext() æ–¹æ³•ä¼šæ£€æµ‹current æ˜¯å¦ä¸ºnullï¼Œnext() æ–¹æ³•ä¼šä¿å­˜å½“å‰å…ƒç´ çš„å¼•ç”¨ï¼Œå°†current å˜é‡æŒ‡å‘é“¾è¡¨ä¸­çš„ä¸‹ä¸ªç»“ç‚¹å¹¶è¿”å›æ‰€ä¿å­˜çš„å¼•ç”¨ã€‚\nimport java.util.Iterator; public class Bag\u0026lt;Item\u0026gt; implements Iterable\u0026lt;Item\u0026gt; { private Node first; // é“¾è¡¨çš„é¦–ç»“ç‚¹ private class Node { Item item; Node next; } public void add(Item item) { // å’ŒStack çš„push() æ–¹æ³•å®Œå…¨ç›¸åŒ Node oldfirst = first; first = new Node(); first.item = item; first.next = oldfirst; } public Iterator\u0026lt;Item\u0026gt; iterator() { return new ListIterator(); } private class ListIterator implements Iterator\u0026lt;Item\u0026gt; { private Node current = first; public Boolean hasNext() { return current != null; } public void remove() { } public Item next() { Item item = current.item; current = current.next; return item; } } } ç»¼è¿° # å­¦ä¹ äº†æ”¯æŒæ³›å‹å’Œè¿­ä»£çš„èƒŒåŒ…ã€é˜Ÿåˆ—å’Œæ ˆ\nç°åœ¨æ‹¥æœ‰ä¸¤ç§è¡¨ç¤ºå¯¹è±¡é›†åˆçš„æ–¹å¼ï¼Œå³æ•°ç»„å’Œé“¾è¡¨\u0026mdash;\u0026gt;é¡ºåºå­˜å‚¨å’Œé“¾å¼å­˜å‚¨\nå„ç§å«æœ‰å¤šä¸ªé“¾æ¥çš„æ•°æ®ç»“æ„ï¼Œå¦‚äºŒå‰æ ‘çš„æ•°æ®ç»“æ„ï¼Œç”±å«æœ‰ä¸¤ä¸ªé“¾æ¥çš„èŠ‚ç‚¹ç»„æˆ å¤åˆå‹çš„æ•°æ®ç»“æ„ï¼šèƒŒåŒ…å­˜å‚¨æ ˆï¼Œé˜Ÿåˆ—å­˜å‚¨æ•°ç»„ç­‰ï¼Œä¾‹å¦‚ç”¨æ•°ç»„çš„èƒŒåŒ…è¡¨ç¤ºå›¾ åŸºç¡€æ•°æ®ç»“æ„ ç ”ç©¶æ–°é¢†åŸŸæ—¶ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤è¯†åˆ«å¹¶ä½¿ç”¨æ•°æ®æŠ½è±¡è§£å†³é—®é¢˜\nå®šä¹‰API æ ¹æ®åº”ç”¨åœºæ™¯å¼€å‘ç”¨ä¾‹ä»£ç  æè¿°æ•°æ®ç»“æ„ï¼ˆä¸€ç»„å€¼çš„è¡¨ç¤ºï¼‰ï¼Œå¹¶åœ¨APIæ‰€å¯¹åº”çš„æŠ½è±¡æ•°æ®ç±»å‹çš„å®ç°ä¸­æ ¹æ®å®ƒå®šä¹‰ç±»çš„å®ä¾‹å˜é‡ æè¿°ç®—æ³•ï¼ˆå®ç°ä¸€ç»„æ“ä½œçš„æ–¹å¼ï¼‰ï¼Œå®ç°ç±»çš„å®ä¾‹æ–¹æ³• åˆ†æç®—æ³•çš„æ€§èƒ½ç‰¹ç‚¹ æœ¬ä¹¦çš„æ•°æ®ç»“æ„ä¸¾ä¾‹ End # "},{"id":220,"href":"/zh/docs/study/RocketMQ/heima/02buildcluster/","title":"02åŒä¸»åŒä»é›†ç¾¤æ­å»º","section":"åŸºç¡€(é»‘é©¬)_","content":" å­¦ä¹ æ¥æº https://www.bilibili.com/video/BV1L4411y7mnï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\næœåŠ¡å™¨ä¿¡æ¯ä¿®æ”¹ # åœ¨.135å’Œ.138å‡è¿›è¡Œä¸‹é¢çš„æ“ä½œ\nè§£å‹ # rocketmqè§£å‹åˆ°/usr/local/rocketmqç›®å½•ä¸‹\nhostæ·»åŠ  # #æ·»åŠ host vim /etc/hosts ##æ·»åŠ å†…å®¹ 192.168.1.135 rocketmq-nameserver1 192.168.1.138 rocketmq-nameserver2 192.168.1.135 rocketmq-master1 192.168.1.135 rocketmq-slave2 192.168.1.138 rocketmq-master2 192.168.1.138 rocketmq-slave1 ## ä¿å­˜å systemctl restart network é˜²ç«å¢™ # ç›´æ¥å…³é—­ # ## é˜²ç«å¢™å…³é—­ systemctl stop firewalld.service ## é˜²ç«å¢™çŠ¶æ€æŸ¥çœ‹ firewall-cmd --state ##ç¦æ­¢å¼€æœºå¯åŠ¨ systemctl disable firewalld.service æˆ–è€…ç›´æ¥å…³é—­å¯¹åº”ç«¯å£å³å¯ # ç¯å¢ƒå˜é‡é…ç½® # ä¸ºäº†æ‰§è¡Œrocketmqå‘½ä»¤æ–¹ä¾¿\n#æ·»åŠ ç¯å¢ƒå˜é‡ vim /etc/profile #æ·»åŠ  ROCKETMQ_HOME=/usr/local/rocketmq/rocketmq-all-4.4.0-bin-release PATH=$PATH:$ROCKETMQ_HOME/bin export ROCKETMQ_HOME PATH #ä½¿é…ç½®ç”Ÿæ•ˆ source /etc/profile æ¶ˆæ¯å­˜å‚¨è·¯å¾„åˆ›å»º # a # mkdir /usr/local/rocketmq/store-a mkdir /usr/local/rocketmq/store-a/commitlog mkdir /usr/local/rocketmq/store-a/consumequeue mkdir /usr/local/rocketmq/store-a/index b # mkdir /usr/local/rocketmq/store-b mkdir /usr/local/rocketmq/store-b/commitlog mkdir /usr/local/rocketmq/store-b/consumequeue mkdir /usr/local/rocketmq/store-b/index åŒä¸»åŒä»é…ç½®æ–‡ä»¶çš„ä¿®æ”¹ # master-a # #æ‰€å±é›†ç¾¤åå­— brokerClusterName=rocketmq-cluster #brokeråå­—ï¼Œæ³¨æ„æ­¤å¤„ä¸åŒçš„é…ç½®æ–‡ä»¶å¡«å†™çš„ä¸ä¸€æ · brokerName=broker-a #0 è¡¨ç¤º Masterï¼Œ\u0026gt;0 è¡¨ç¤º Slave brokerId=0 #nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰² namesrvAddr=rocketmq-nameserver1:9876;rocketmq-nameserver2:9876 #åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•° defaultTopicQueueNums=4 #æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­ autoCreateTopicEnable=true #æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­ autoCreateSubscriptionGroup=true #Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£ listenPort=10911 #åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ 4ç‚¹ deleteWhen=04 #æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ 48 å°æ—¶ fileReservedTime=120 #commitLogæ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1G mapedFileSizeCommitLog=1073741824 #ConsumeQueueæ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜30Wæ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´ mapedFileSizeConsumeQueue=300000 #destroyMapedFileIntervalForcibly=120000 #redeleteHangedFileInterval=120000 #æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´ diskMaxUsedSpaceRatio=88 #å­˜å‚¨è·¯å¾„ storePathRootDir=/usr/local/rocketmq/store-a #commitLog å­˜å‚¨è·¯å¾„ storePathCommitLog=/usr/local/rocketmq/store-a/commitlog #æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨è·¯å¾„å­˜å‚¨è·¯å¾„ storePathConsumeQueue=/usr/local/rocketmq/store-a/consumequeue #æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„ storePathIndex=/usr/local/rocketmq/store-a/index #checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„ storeCheckpoint=/usr/local/rocketmq/store-a/checkpoint #abort æ–‡ä»¶å­˜å‚¨è·¯å¾„ abortFile=/usr/local/rocketmq/store-a/abort #é™åˆ¶çš„æ¶ˆæ¯å¤§å° maxMessageSize=65536 #flushCommitLogLeastPages=4 #flushConsumeQueueLeastPages=2 #flushCommitLogThoroughInterval=10000 #flushConsumeQueueThoroughInterval=60000 #Broker çš„è§’è‰² #- ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master #- SYNC_MASTER åŒæ­¥åŒå†™Master #- SLAVE brokerRole=SYNC_MASTER #åˆ·ç›˜æ–¹å¼ #- ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜ #- SYNC_FLUSH åŒæ­¥åˆ·ç›˜ flushDiskType=SYNC_FLUSH #checkTransactionMessageEnable=false #å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡ #sendMessageThreadPoolNums=128 #æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡ #pullMessageThreadPoolNums=128 slave-b # #æ‰€å±é›†ç¾¤åå­— brokerClusterName=rocketmq-cluster #brokeråå­—ï¼Œæ³¨æ„æ­¤å¤„ä¸åŒçš„é…ç½®æ–‡ä»¶å¡«å†™çš„ä¸ä¸€æ · brokerName=broker-b #0 è¡¨ç¤º Masterï¼Œ\u0026gt;0 è¡¨ç¤º Slave brokerId=1 #nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰² namesrvAddr=rocketmq-nameserver1:9876;rocketmq-nameserver2:9876 #åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•° defaultTopicQueueNums=4 #æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­ autoCreateTopicEnable=true #æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­ autoCreateSubscriptionGroup=true #Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£ listenPort=11011 #åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ 4ç‚¹ deleteWhen=04 #æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ 48 å°æ—¶ fileReservedTime=120 #commitLogæ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1G mapedFileSizeCommitLog=1073741824 #ConsumeQueueæ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜30Wæ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´ mapedFileSizeConsumeQueue=300000 #destroyMapedFileIntervalForcibly=120000 #redeleteHangedFileInterval=120000 #æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´ diskMaxUsedSpaceRatio=88 #å­˜å‚¨è·¯å¾„ storePathRootDir=/usr/local/rocketmq/store-b #commitLog å­˜å‚¨è·¯å¾„ storePathCommitLog=/usr/local/rocketmq/store-b/commitlog #æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨è·¯å¾„å­˜å‚¨è·¯å¾„ storePathConsumeQueue=/usr/local/rocketmq/store-b/consumequeue #æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„ storePathIndex=/usr/local/rocketmq/store-b/index #checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„ storeCheckpoint=/usr/local/rocketmq/store-b/checkpoint #abort æ–‡ä»¶å­˜å‚¨è·¯å¾„ abortFile=/usr/local/rocketmq/store-b/abort #é™åˆ¶çš„æ¶ˆæ¯å¤§å° maxMessageSize=65536 #flushCommitLogLeastPages=4 #flushConsumeQueueLeastPages=2 #flushCommitLogThoroughInterval=10000 #flushConsumeQueueThoroughInterval=60000 #Broker çš„è§’è‰² #- ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master #- SYNC_MASTER åŒæ­¥åŒå†™Master #- SLAVE brokerRole=SLAVE #åˆ·ç›˜æ–¹å¼ #- ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜ #- SYNC_FLUSH åŒæ­¥åˆ·ç›˜ flushDiskType=ASYNC_FLUSH #checkTransactionMessageEnable=false #å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡ #sendMessageThreadPoolNums=128 #æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡ #pullMessageThreadPoolNums=128 master-b # #æ‰€å±é›†ç¾¤åå­— brokerClusterName=rocketmq-cluster #brokeråå­—ï¼Œæ³¨æ„æ­¤å¤„ä¸åŒçš„é…ç½®æ–‡ä»¶å¡«å†™çš„ä¸ä¸€æ · brokerName=broker-b #0 è¡¨ç¤º Masterï¼Œ\u0026gt;0 è¡¨ç¤º Slave brokerId=0 #nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰² namesrvAddr=rocketmq-nameserver1:9876;rocketmq-nameserver2:9876 #åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•° defaultTopicQueueNums=4 #æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­ autoCreateTopicEnable=true #æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­ autoCreateSubscriptionGroup=true #Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£ listenPort=10911 #åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ 4ç‚¹ deleteWhen=04 #æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ 48 å°æ—¶ fileReservedTime=120 #commitLogæ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1G mapedFileSizeCommitLog=1073741824 #ConsumeQueueæ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜30Wæ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´ mapedFileSizeConsumeQueue=300000 #destroyMapedFileIntervalForcibly=120000 #redeleteHangedFileInterval=120000 #æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´ diskMaxUsedSpaceRatio=88 #å­˜å‚¨è·¯å¾„ storePathRootDir=/usr/local/rocketmq/store-b #commitLog å­˜å‚¨è·¯å¾„ storePathCommitLog=/usr/local/rocketmq/store-b/commitlog #æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨è·¯å¾„å­˜å‚¨è·¯å¾„ storePathConsumeQueue=/usr/local/rocketmq/store-b/consumequeue #æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„ storePathIndex=/usr/local/rocketmq/store-b/index #checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„ storeCheckpoint=/usr/local/rocketmq/store-b/checkpoint #abort æ–‡ä»¶å­˜å‚¨è·¯å¾„ abortFile=/usr/local/rocketmq/store-b/abort #é™åˆ¶çš„æ¶ˆæ¯å¤§å° maxMessageSize=65536 #flushCommitLogLeastPages=4 #flushConsumeQueueLeastPages=2 #flushCommitLogThoroughInterval=10000 #flushConsumeQueueThoroughInterval=60000 #Broker çš„è§’è‰² #- ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master #- SYNC_MASTER åŒæ­¥åŒå†™Master #- SLAVE brokerRole=SYNC_MASTER #åˆ·ç›˜æ–¹å¼ #- ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜ #- SYNC_FLUSH åŒæ­¥åˆ·ç›˜ flushDiskType=SYNC_FLUSH #checkTransactionMessageEnable=false #å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡ #sendMessageThreadPoolNums=128 #æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡ #pullMessageThreadPoolNums=128 slave-a # #æ‰€å±é›†ç¾¤åå­— brokerClusterName=rocketmq-cluster #brokeråå­—ï¼Œæ³¨æ„æ­¤å¤„ä¸åŒçš„é…ç½®æ–‡ä»¶å¡«å†™çš„ä¸ä¸€æ · brokerName=broker-a #0 è¡¨ç¤º Masterï¼Œ\u0026gt;0 è¡¨ç¤º Slave brokerId=1 #nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰² namesrvAddr=rocketmq-nameserver1:9876;rocketmq-nameserver2:9876 #åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•° defaultTopicQueueNums=4 #æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­ autoCreateTopicEnable=true #æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­ autoCreateSubscriptionGroup=true #Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£ listenPort=11011 #åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ 4ç‚¹ deleteWhen=04 #æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ 48 å°æ—¶ fileReservedTime=120 #commitLogæ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1G mapedFileSizeCommitLog=1073741824 #ConsumeQueueæ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜30Wæ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´ mapedFileSizeConsumeQueue=300000 #destroyMapedFileIntervalForcibly=120000 #redeleteHangedFileInterval=120000 #æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´ diskMaxUsedSpaceRatio=88 #å­˜å‚¨è·¯å¾„ storePathRootDir=/usr/local/rocketmq/store-a #commitLog å­˜å‚¨è·¯å¾„ storePathCommitLog=/usr/local/rocketmq/store-a/commitlog #æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨è·¯å¾„å­˜å‚¨è·¯å¾„ storePathConsumeQueue=/usr/local/rocketmq/store-a/consumequeue #æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„ storePathIndex=/usr/local/rocketmq/store-a/index #checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„ storeCheckpoint=/usr/local/rocketmq/store-a/checkpoint #abort æ–‡ä»¶å­˜å‚¨è·¯å¾„ abortFile=/usr/local/rocketmq/store-a/abort #é™åˆ¶çš„æ¶ˆæ¯å¤§å° maxMessageSize=65536 #flushCommitLogLeastPages=4 #flushConsumeQueueLeastPages=2 #flushCommitLogThoroughInterval=10000 #flushConsumeQueueThoroughInterval=60000 #Broker çš„è§’è‰² #- ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master #- SYNC_MASTER åŒæ­¥åŒå†™Master #- SLAVE brokerRole=SLAVE #åˆ·ç›˜æ–¹å¼ #- ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜ #- SYNC_FLUSH åŒæ­¥åˆ·ç›˜ flushDiskType=ASYNC_FLUSH #checkTransactionMessageEnable=false #å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡ #sendMessageThreadPoolNums=128 #æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡ #pullMessageThreadPoolNums=128 ä¿®æ”¹ä¸¤å°ä¸»æœºçš„runserver.shåŠrunbroker.shä¿®æ”¹ # ä¿®æ”¹runbroker.sh # JAVA_OPT=\u0026#34;${JAVA_OPT} -server -Xms256m -Xmx256m -Xmn128m\u0026#34; ä¿®æ”¹runserver.sh # JAVA_OPT=\u0026#34;${JAVA_OPT} -server -Xms256m -Xmx256m -Xmn128m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m\u0026#34; ä¸¤å°ä¸»æœºåˆ†åˆ«å¯åŠ¨nameserverå’ŒBrocker # ## åœ¨ä¸¤å°ä¸»æœºåˆ†åˆ«å¯åŠ¨nameserver nohup sh mqnamesrv \u0026amp; #135å¯åŠ¨master1 nohup sh mqbroker -c /usr/local/rocketmq/rocketmq-all-4.4.0-bin-release/conf/2m-2s-sync/broker-a.properties \u0026amp; #135å¯åŠ¨slave2 nohup sh mqbroker -c /usr/local/rocketmq/rocketmq-all-4.4.0-bin-release/conf/2m-2s-sync/broker-b-s.properties \u0026amp; #æŸ¥çœ‹ jps 3478 Jps 3366 BrokerStartup 3446 BrokerStartup 3334 NamesrvStartup #138å¯åŠ¨master2 nohup sh mqbroker -c /usr/local/rocketmq/rocketmq-all-4.4.0-bin-release/conf/2m-2s-sync/broker-b.properties \u0026amp; #135å¯åŠ¨slave1 nohup sh mqbroker -c /usr/local/rocketmq/rocketmq-all-4.4.0-bin-release/conf/2m-2s-sync/broker-a-s.properties \u0026amp; #æŸ¥çœ‹ jps 3376 Jps 3360 BrokerStartup 3251 NamesrvStartup 3295 BrokerStartup åŒä¸»åŒä»é›†ç¾¤æ­å»ºå®Œæ¯•ï¼\né›†ç¾¤ç®¡ç†å·¥å…· # mqadmin # cd bin è¿›å…¥binç›®å½•ï¼šmqadminï¼Œå¯¹ä¸‹é¢çš„ä¿¡æ¯è¿›è¡Œæ“ä½œ\ntopicã€é›†ç¾¤ã€Brokerã€æ¶ˆæ¯ã€æ¶ˆè´¹è€…ç»„ã€ç”Ÿäº§è€…ç»„ã€è¿æ¥ç›¸å…³ã€namesrvç›¸å…³ã€å…¶ä»–\nrocket-console # //å·²ç»å¼ƒç”¨ï¼Œç°åœ¨æ”¹ç”¨rocketmq-dashboard\nhttps://github.com/apache/rocketmq-dashboard\n"},{"id":221,"href":"/zh/docs/study/RocketMQ/heima/01base/","title":"01rocketmqå­¦ä¹ ","section":"åŸºç¡€(é»‘é©¬)_","content":" å­¦ä¹ æ¥æº https://www.bilibili.com/video/BV1L4411y7mnï¼ˆæ·»åŠ å°éƒ¨åˆ†ç¬”è®°ï¼‰æ„Ÿè°¢ä½œè€…!\nåŸºæœ¬æ“ä½œ # ä¸‹è½½ # https://rocketmq.apache.org/download/ é€‰æ‹©Binaryä¸‹è½½å³å¯ï¼Œæ”¾åˆ°Linuxä¸»æœºä¸­\nå‰æjavaè¿è¡Œç¯å¢ƒ # yum search java | grep jdk yum install -y java-1.8.0-openjdk-devel.x86_64 # java -version æ­£å¸¸ # javac -version æ­£å¸¸ å¯åŠ¨ # #nameserverå¯åŠ¨ nohup sh bin/mqnamesrv \u0026amp; #nameserveræ—¥å¿—æŸ¥çœ‹ tail -f ~/logs/rocketmqlogs/namesrv.log #è¾“å‡º 2023-04-06 00:08:34 INFO main - tls.client.certPath = null 2023-04-06 00:08:34 INFO main - tls.client.authServer = false 2023-04-06 00:08:34 INFO main - tls.client.trustCertPath = null 2023-04-06 00:08:35 INFO main - Using OpenSSL provider 2023-04-06 00:08:35 INFO main - SSLContext created for server 2023-04-06 00:08:36 INFO NettyEventExecutor - NettyEventExecutor service started 2023-04-06 00:08:36 INFO main - The Name Server boot success. serializeType=JSON 2023-04-06 00:08:36 INFO FileWatchService - FileWatchService service started 2023-04-06 00:09:35 INFO NSScheduledThread1 - -------------------------------------------------------- 2023-04-06 00:09:35 INFO NSScheduledThread1 - configTable SIZE: 0 #brokerå¯åŠ¨ nohup sh bin/mqbroker -n localhost:9876 \u0026amp; #æŸ¥çœ‹brokeræ—¥å¿— tail -f ~/logs/rocketmqlogs/broker.log #æ—¥å¿—å¦‚ä¸‹ tail: æ— æ³•æ‰“å¼€\u0026#34;/root/logs/rocketmqlogs/broker.log\u0026#34; è¯»å–æ•°æ®: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½• tail: æ²¡æœ‰å‰©ä½™æ–‡ä»¶ ğŸ‘‡ #jpsæŸ¥çœ‹ 2465 Jps 2430 NamesrvStartup #è¯´æ˜æ²¡æœ‰å¯åŠ¨æˆåŠŸ,å› ä¸ºé»˜è®¤é…ç½®çš„è™šæ‹Ÿæœºå†…å­˜è¾ƒå¤§ vim bin/runbroker.sh ä»¥åŠ vim runserver.sh #ä¿®æ”¹ JAVA_OPT=\u0026#34;${JAVA_OPT} -server -Xms8g -Xmx8g -Xmn4g\u0026#34; #ä¿®æ”¹ä¸º JAVA_OPT=\u0026#34;${JAVA_OPT} -server -Xms256m -Xmx256m -Xmn128m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m\u0026#34; #ä¿®æ”¹å®Œæ¯•åå¯åŠ¨ #å…ˆå…³é—­namesrvå #æŒ‰ä¸Šè¿°å¯åŠ¨namesrvä»¥åŠbroker sh bin/mqshutdown namesrv # jspå‘½ä»¤æŸ¥çœ‹è¿›ç¨‹ 2612 Jps 2551 BrokerStartup 2524 NamesrvStartup æµ‹è¯• # åŒä¸€å°æœºå™¨ä¸Šï¼Œä¸¤ä¸ªcmdçª—å£\nå‘é€ç«¯ # #é…ç½®namesrvä¸ºç¯å¢ƒå˜é‡ export NAMESRV_ADDR=localhost:9876 #è¿è¡Œç¨‹åºï¼ˆå‘é€æ¶ˆæ¯ï¼‰ sh bin/tools.sh org.apache.rocketmq.example.quickstart.Producer #ç»“æœ SendResult [sendStatus=SEND_OK, msgId=C0A801640B012503DBD319DEF7D203E1, offsetMsgId=C0A8010300002A9F0000000000057878, messageQueue=MessageQueue [topic=TopicTest, brokerName=rheCentos700, queueId=3], queueOffset=498] SendResult [sendStatus=SEND_OK, msgId=C0A801640B012503DBD319DEF7D803E2, offsetMsgId=C0A8010300002A9F000000000005792C, messageQueue=MessageQueue [topic=TopicTest, brokerName=rheCentos700, queueId=0], queueOffset=498] SendResult [sendStatus=SEND_OK, msgId=C0A801640B012503DBD319DEF7DB03E3, offsetMsgId=C0A8010300002A9F00000000000579E0, messageQueue=MessageQueue [topic=TopicTest, brokerName=rheCentos700, queueId=1], queueOffset=498] æ¥æ”¶ç«¯ # #é…ç½®namesrvä¸ºç¯å¢ƒå˜é‡ export NAMESRV_ADDR=localhost:9876 #è¿è¡Œç¨‹åºï¼ˆå‘é€æ¶ˆæ¯ï¼‰ sh bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer #ç»“æœ ConsumeMessageThread_5 Receive New Messages: [MessageExt [queueId=0, storeSize=180, queueOffset=499, sysFlag=0, bornTimestamp=1680712442864, bornHost=/192.168.1.3:45716, storeTimestamp=1680712442878, storeHost=/192.168.1.3:10911, msgId=C0A8010300002A9F0000000000057BFC, commitLogOffset=359420, bodyCRC=1359908749, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic=\u0026#39;TopicTest\u0026#39;, flag=0, properties={MIN_OFFSET=0, MAX_OFFSET=500, CONSUME_START_TIME=1680712442881, UNIQ_KEY=C0A801640B012503DBD319DEF7F003E6, WAIT=true, TAGS=TagA}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 32, 57, 57, 56], transactionId=\u0026#39;null\u0026#39;}]] ConsumeMessageThread_2 Receive New Messages: [MessageExt [queueId=1, storeSize=180, queueOffset=499, sysFlag=0, bornTimestamp=1680712442879, bornHost=/192.168.1.3:45716, storeTimestamp=1680712442883, storeHost=/192.168.1.3:10911, msgId=C0A8010300002A9F0000000000057CB0, commitLogOffset=359600, bodyCRC=638172955, reconsumeTimes=0, preparedTransactionOffset=0, toString()=Message{topic=\u0026#39;TopicTest\u0026#39;, flag=0, properties={MIN_OFFSET=0, MAX_OFFSET=500, CONSUME_START_TIME=1680712442889, UNIQ_KEY=C0A801640B012503DBD319DEF7FF03E7, WAIT=true, TAGS=TagA}, body=[72, 101, 108, 108, 111, 32, 82, 111, 99, 107, 101, 116, 77, 81, 32, 57, 57, 57], transactionId=\u0026#39;null\u0026#39;}]] RocketMQåŸºæœ¬æ¶æ„ # ç®€å•è§£é‡Š # nameserverï¼šbrokerçš„ç®¡ç†è€… brokerï¼šè‡ªå·±æ‰¾namesererä¸ŠæŠ¥ brokerï¼šçœŸæ­£å­˜å‚¨æ¶ˆæ¯çš„åœ°æ–¹ nameserveræ˜¯æ— çŠ¶æ€çš„ï¼Œå³nameserverä¹‹é—´ä¸ç”¨åŒæ­¥brokerä¿¡æ¯ï¼Œç”±brokerè‡ªå·±ä¸ŠæŠ¥ Produceré›†ç¾¤ä¹‹é—´ä¹Ÿä¸éœ€è¦åŒæ­¥ï¼›Consumeré›†ç¾¤ä¹‹é—´ä¹Ÿä¸éœ€è¦åŒæ­¥ BrokerMasterå’ŒBrokerSlaveä¹‹é—´ä¿¡æ¯æ˜¯æœ‰åŒæ­¥çš„ å¦‚å›¾ # "},{"id":222,"href":"/zh/docs/study/Algorithm/algorithhms_4th/1.3.1.1-1.3.2.5/","title":"ç®—æ³•çº¢çš®ä¹¦ 1.3.1.1-1.3.2.5","section":"_ç®—æ³•(ç¬¬å››ç‰ˆ)_","content":" èƒŒåŒ…ã€é˜Ÿåˆ—å’Œæ ˆ # æ•°æ®ç±»å‹çš„å€¼å°±æ˜¯ä¸€ç»„å¯¹è±¡çš„é›†åˆï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯å…³äºæ·»åŠ ã€åˆ é™¤æˆ–æ˜¯è®¿é—®é›†åˆä¸­çš„å¯¹è±¡ æœ¬ç« å°†å­¦ä¹ ä¸‰ç§æ•°æ®ç±»å‹ï¼šèƒŒåŒ…Bagã€é˜Ÿåˆ—Queueã€æ ˆStack å¯¹é›†åˆä¸­çš„å¯¹è±¡çš„è¡¨ç¤ºæ–¹å¼ç›´æ¥å½±å“å„ç§æ“ä½œçš„æ•ˆç‡ ä»‹ç»æ³›å‹å’Œè¿­ä»£ ä»‹ç»å¹¶è¯´æ˜é“¾å¼æ•°æ®ç»“æ„çš„é‡è¦æ€§(é“¾è¡¨) API # æ³›å‹å¯è¿­ä»£çš„åŸºç¡€é›†åˆæ•°æ®ç±»å‹çš„API\nèƒŒåŒ…\né˜Ÿåˆ—(å…ˆè¿›å…ˆå‡ºFIFO)\nä¸‹å‹(åè¿›å…ˆå‡º,LIFO)æ ˆ æ³›å‹\næ³›å‹ï¼Œå‚æ•°åŒ–ç±»å‹ åœ¨æ¯ä»½API ä¸­ï¼Œç±»ååçš„\u0026lt;Item\u0026gt; è®°å·å°†Item å®šä¹‰ä¸ºä¸€ä¸ªç±»å‹å‚æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªè±¡å¾æ€§çš„å ä½ç¬¦ï¼Œè¡¨ç¤ºçš„æ˜¯ç”¨ä¾‹å°†ä¼šä½¿ç”¨çš„æŸç§å…·ä½“æ•°æ®ç±»å‹ è‡ªåŠ¨è£…ç®±\nç”¨æ¥å¤„ç†åŸå§‹ç±»å‹ Booleanã€Byteã€Characterã€Doubleã€Floatã€Integerã€Long å’ŒShort åˆ†åˆ«å¯¹åº”ç€booleanã€byteã€charã€doubleã€floatã€intã€long å’Œshort è‡ªåŠ¨å°†ä¸€ä¸ªåŸå§‹æ•°æ®ç±»å‹è½¬æ¢ä¸ºä¸€ä¸ªå°è£…ç±»å‹ç§°ä¸ºè‡ªåŠ¨è£…ç®±ï¼Œè‡ªåŠ¨å°†ä¸€ä¸ªå°è£…ç±»å‹è½¬æ¢ä¸ºä¸€ä¸ªåŸå§‹æ•°æ®ç±»å‹è¢«ç§°ä¸ºè‡ªåŠ¨æ‹†ç®± å¯è¿­ä»£çš„é›†åˆç±»å‹\nè¿­ä»£è®¿é—®é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´  èƒŒåŒ…æ˜¯ä¸€ç§ä¸æ”¯æŒä»ä¸­åˆ é™¤å…ƒç´ çš„é›†åˆæ•°æ®ç±»å‹\u0026ndash;å¸®åŠ©ç”¨ä¾‹æ”¶é›†å…ƒç´ å¹¶è¿­ä»£éå†æ‰€æœ‰æ”¶é›†åˆ°çš„å…ƒç´ ï¼ˆæ— åºéå†ï¼‰\nå…¸å‹ç”¨ä¾‹ï¼Œè®¡ç®—æ ‡å‡†å·®\nå…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—\næ˜¯ä¸€ç§åŸºäºå…ˆè¿›å…ˆå‡º(FIFO)ç­–ç•¥çš„é›†åˆç±»å‹ ä½¿ç”¨é˜Ÿåˆ—çš„ä¸»è¦åŸå› ï¼šé›†åˆä¿å­˜å…ƒç´ çš„åŒæ—¶ä¿å­˜å®ƒä»¬çš„ç›¸å¯¹é¡ºåº å¦‚å›¾\nQueueç”¨ä¾‹(å…ˆè¿›å…ˆå‡º) ä¸‹å‹æ ˆ\nç®€ç§°æ ˆï¼Œæ˜¯ä¸€ç§åŸºäºåè¿›å…ˆå‡ºLIFOç­–ç•¥çš„é›†åˆç±»å‹ æ¯”å¦‚ï¼Œæ”¶é‚®ä»¶ç­‰ï¼Œå¦‚å›¾\nStackçš„ç”¨ä¾‹\nç”¨æ ˆè§£å†³ç®—æ•°è¡¨è¾¾å¼çš„é—®é¢˜\nï¼ˆåŒæ ˆç®—æ•°è¡¨è¾¾å¼æ±‚å€¼ç®—æ³•ï¼‰\né›†åˆç±»æ•°æ®ç±»å‹çš„å®ç° # å®šå®¹æ ˆï¼Œè¡¨ç¤ºå®¹é‡å›ºå®šçš„å­—ç¬¦ä¸²æ ˆçš„æŠ½è±¡æ•°æ®ç±»å‹\nåªèƒ½å¤„ç†Stringå€¼ï¼Œæ”¯æŒpushå’Œpop\næŠ½è±¡æ•°æ®ç±»å‹\næµ‹è¯•ç”¨ä¾‹\nä½¿ç”¨æ–¹æ³•\næ•°æ®ç±»å‹çš„å®ç°\næ³›å‹\npublic class FixedCapacityStack\u0026lt;Item\u0026gt; ç”±äºä¸å…è®¸ç›´æ¥åˆ›å»ºæ³›å‹æ•°ç»„ï¼Œæ‰€ä»¥ a =new Item[cap] ä¸å…è®¸ï¼Œåº”è¯¥æ”¹ä¸º\na=(Item[])new Object[cap]; æ³›å‹å®šå®¹æ ˆçš„æŠ½è±¡æ•°æ®ç±»å‹\næµ‹è¯•ç”¨ä¾‹\nä½¿ç”¨æ–¹æ³•\næ•°æ®ç±»å‹çš„å®ç°\nè°ƒæ•´æ•°ç»„å¤§å°\nNä¸ºå½“å‰å…ƒç´ çš„æ•°é‡\nä½¿ç”¨resizeåˆ›å»ºæ–°çš„æ•°ç»„\nå½“å…ƒç´ æ»¡äº†çš„æ—¶å€™è¿›è¡Œæ‰©å®¹\nå½“å…ƒç´ è¿‡å°‘(1/4)çš„æ—¶å€™ï¼Œè¿›è¡Œå‡åŠ\nå¯¹è±¡æ¸¸ç¦»\nJavaçš„åƒåœ¾å›æ”¶ç­–ç•¥æ˜¯å›æ”¶æ‰€æœ‰æ— æ³•è¢«è®¿é—®çš„å¯¹è±¡çš„å†…å­˜\nç¤ºä¾‹ä¸­ï¼Œè¢«å¼¹å‡ºçš„å…ƒç´ ä¸å†éœ€è¦ï¼Œä½†ç”±äºæ•°ç»„ä¸­çš„å¼•ç”¨ä»ç„¶è®©å®ƒå¯ä»¥ç»§ç»­å­˜åœ¨ï¼ˆåƒåœ¾å›æ”¶å™¨æ— æ³•å›æ”¶ï¼‰ï¼Œè¿™ç§æƒ…å†µï¼ˆä¿å­˜äº†ä¸€ä¸ªä¸éœ€è¦çš„å¯¹è±¡çš„å¼•ç”¨ï¼‰ç§°ä¸ºæ¸¸ç¦»ï¼Œé¿å…æ¸¸ç¦»çš„åšæ³•å°±æ˜¯å°†æ•°ç»„å…ƒç´ è®¾ä¸ºnull\nè¿­ä»£\nforeachå’Œwhile\né›†åˆæ•°æ®ç±»å‹å¿…é¡»å®ç°iterator()å¹¶è¿”å›Iteratorå¯¹è±¡ Iteratorç±»å¿…é¡»åŒ…æ‹¬ä¸¤ä¸ªæ–¹æ³•,hasNext()å’Œnext() è®©ç±»ç»§æ‰¿Iterable\u0026lt;Item\u0026gt;ä½¿ç±»å¯è¿­ä»£ ä½¿ç”¨ä¸€ä¸ªåµŒå¥—ç±»\nä¸‹å‹æ ˆçš„ä»£ç \nimport java.util.Iterator; public class ResizingArrayStack\u0026lt;Item\u0026gt; implements Iterable\u0026lt;Item\u0026gt; { private\tItem[] a = (Item[]) new Object[1]; /* æ ˆå…ƒç´  */ private int\tN = 0; /* å…ƒç´ æ•°é‡ */ public boolean isEmpty() { return(N == 0); } public int size() { return(N); } private void resize( int max ) { /* å°†æ ˆç§»åŠ¨åˆ°ä¸€ä¸ªå¤§å°ä¸ºmax çš„æ–°æ•°ç»„ */ Item[] temp = (Item[]) new Object[max]; for ( int i = 0; i \u0026lt; N; i++ ) temp[i] = a[i]; a = temp; } public void push( Item item ) { /* å°†å…ƒç´ æ·»åŠ åˆ°æ ˆé¡¶ */ if ( N == a.length ) resize( 2 * a.length ); a[N++] = item; } public Item pop() { /* ä»æ ˆé¡¶åˆ é™¤å…ƒç´  */ Item item = a[--N]; a[N] = null; /* é¿å…å¯¹è±¡æ¸¸ç¦»ï¼ˆè¯·è§1.3.2.4 èŠ‚ï¼‰ */ if ( N \u0026gt; 0 \u0026amp;\u0026amp; N == a.length / 4 ) resize( a.length / 2 ); return(item); } public Iterator\u0026lt;Item\u0026gt; iterator() { return(new ReverseArrayIterator() ); } private class ReverseArrayIterator implements Iterator\u0026lt;Item\u0026gt; { /* æ”¯æŒåè¿›å…ˆå‡ºçš„è¿­ä»£ */ private int i = N; public boolean hasNext() { return(i \u0026gt; 0); } public Item next() { return(a[--i]); } public void remove() { } } } End # "},{"id":223,"href":"/zh/docs/study/Algorithm/algorithhms_4th/1.2.1-1.2.5/","title":"ç®—æ³•çº¢çš®ä¹¦ 1.2.1-1.2.5","section":"_ç®—æ³•(ç¬¬å››ç‰ˆ)_","content":" æ•°æ®æŠ½è±¡ # æ•°æ®ç±»å‹æŒ‡çš„æ˜¯ä¸€ç»„å€¼å’Œä¸€ç»„å¯¹è¿™äº›å€¼çš„æ“ä½œçš„é›†åˆ\nå®šä¹‰å’Œä½¿ç”¨æ•°æ®ç±»å‹çš„è¿‡ç¨‹ï¼Œä¹Ÿè¢«ç§°ä¸ºæ•°æ®æŠ½è±¡ Javaç¼–ç¨‹çš„åŸºç¡€æ˜¯ä½¿ç”¨classå…³é”®å­—æ„é€ è¢«ç§°ä¸ºå¼•ç”¨ç±»å‹çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿç§°é¢å‘å¯¹è±¡ç¼–ç¨‹ å®šä¹‰è‡ªå·±çš„æ•°æ®ç±»å‹æ¥æŠ½è±¡ä»»æ„å¯¹è±¡ æŠ½è±¡æ•°æ®ç±»å‹ï¼ˆADTï¼‰æ˜¯ä¸€ç§èƒ½å¤Ÿå¯¹ä½¿ç”¨è€…éšè—æ•°æ®è¡¨ç¤ºçš„æ•°æ®ç±»å‹ æŠ½è±¡æ•°æ®ç±»å‹å°†æ•°æ®å’Œå‡½æ•°çš„å®ç°ç›¸å…³è”ï¼Œå°†æ•°æ®çš„è¡¨ç¤ºæ–¹å¼éšè—èµ·æ¥ æŠ½è±¡æ•°æ®ç±»å‹ä½¿ç”¨æ—¶ï¼Œå…³æ³¨APIæè¿°çš„æ“ä½œä¸Šè€Œä¸ä¼šå»å…³å¿ƒæ•°æ®çš„è¡¨ç¤ºï¼›å®ç°æŠ½è±¡æ•°æ®ç±»å‹æ—¶ï¼Œå…³æ³¨æ•°æ®æœ¬èº«å¹¶å°†å®ç°å¯¹æ•°æ®çš„å„ç§æ“ä½œ ç ”ç©¶åŒä¸€ä¸ªé—®é¢˜çš„ä¸åŒç®—æ³•çš„ä¸»è¦åŸå› æ˜¯ä»–ä»¬çš„æ€§èƒ½ä¸åŒ ä½¿ç”¨æŠ½è±¡æ•°æ®ç±»å‹ # ä½¿ç”¨ä¸€ç§æ•°æ®ç±»å‹å¹¶ä¸ä¸€å®šéå¾—çŸ¥é“å®ƒæ˜¯å¦‚ä½•å®ç°çš„ ä½¿ç”¨Counter(è®¡æ•°å™¨)çš„ç®€å•æ•°æ®ç±»å‹çš„ç¨‹åºï¼Œæ“ä½œæœ‰ åˆ›å»ºå¯¹è±¡å¹¶åˆå§‹åŒ–ä¸º0 å½“å‰å€¼åŠ 1 è·å–å½“å‰å€¼ åœºæ™¯ï¼Œç”¨äºç”µå­è®¡ç¥¨ æŠ½è±¡æ•°æ®ç±»å‹çš„API(åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£) APIç”¨æ¥è¯´æ˜æŠ½è±¡æ•°æ®ç±»å‹çš„è¡Œä¸º å°†åˆ—å‡ºæ‰€æœ‰æ„é€ å‡½æ•°å’Œå®ä¾‹æ–¹æ³•(å³æ“ä½œ) è®¡ç®—å™¨çš„API\nç»§æ‰¿çš„æ–¹æ³• æ‰€æœ‰æ•°æ®ç±»å‹éƒ½ä¼šç»§æ‰¿toString()æ–¹æ³• Javaä¼šåœ¨ç”¨+è¿ç®—ç¬¦å°†ä»»æ„æ•°æ®ç±»å‹çš„å€¼å’ŒStringå€¼è¿æ¥æ—¶è°ƒç”¨toString() é»˜è®¤å®ç°ï¼šè¿”å›è¯¥æ•°æ®ç±»å‹å€¼çš„å†…å­˜åœ°å€ ç”¨ä¾‹ä»£ç  å¯ä»¥åœ¨ç”¨ä¾‹ä»£ç ä¸­ï¼Œå£°æ˜å˜é‡ã€åˆ›å»ºå¯¹è±¡æ¥ä¿å­˜æ•°æ®ç±»å‹çš„å€¼å¹¶å…è®¸é€šè¿‡å®ä¾‹æ–¹æ³•æ¥æ“ä½œå®ƒä»¬ å¯¹è±¡ å¯¹è±¡æ˜¯èƒ½å¤Ÿæ‰¿è½½æ•°æ®ç±»å‹çš„å€¼çš„å®ä½“ å¯¹è±¡ä¸‰å¤§ç‰¹æ€§ï¼šçŠ¶æ€ã€æ ‡è¯†å’Œè¡Œä¸º çŠ¶æ€ï¼šæ•°æ®ç±»å‹ä¸­çš„å€¼ æ ‡è¯†ï¼šåœ¨å†…å­˜ä¸­çš„åœ°å€ è¡Œä¸ºï¼šæ•°æ®ç±»å‹çš„æ“ä½œ Javaä½¿ç”¨\u0026quot;å¼•ç”¨ç±»å‹\u0026quot;å’ŒåŸå§‹æ•°æ®ç±»å‹åŒºåˆ« åˆ›å»ºå¯¹è±¡ æ¯ç§æ•°æ®ç±»å‹ä¸­çš„å€¼éƒ½å­˜å‚¨äºä¸€ä¸ªå¯¹è±¡ä¸­ æ„é€ å‡½æ•°æ€»æ˜¯è¿”å›ä»–çš„æ•°æ®ç±»å‹çš„å¯¹è±¡çš„å¼•ç”¨ ä½¿ç”¨new()ï¼Œä¼šä¸ºæ–°çš„å¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´ï¼Œè°ƒç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–å¯¹è±¡ä¸­çš„å€¼ï¼Œè¿”å›è¯¥å¯¹è±¡çš„ä¸€ä¸ªå¼•ç”¨ æŠ½è±¡æ•°æ®ç±»å‹å‘ç”¨ä¾‹éšè—äº†å€¼çš„è¡¨ç¤ºç»†èŠ‚ å®ä¾‹æ–¹æ³•ï¼šå‚æ•°æŒ‰å€¼ä¼ é€’ æ–¹æ³•æ¯æ¬¡è§¦å‘éƒ½å’Œä¸€ä¸ªå¯¹è±¡ç›¸å…³ é™æ€æ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯å®ç°å‡½æ•°ï¼›éé™æ€(å®ä¾‹)æ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯å®ç°æ•°æ®ç±»å‹çš„æ“ä½œ ä½¿ç”¨å¯¹è±¡\nå¼€å‘æŸç§æ•°æ®ç±»å‹çš„ç”¨ä¾‹ å£°æ˜è¯¥ç±»å‹çš„å˜é‡ï¼Œä»¥å¼•ç”¨å¯¹è±¡ ä½¿ç”¨newè§¦å‘èƒ½å¤Ÿåˆ›å»ºè¯¥ç±»å‹çš„å¯¹è±¡çš„ä¸€ä¸ªæ„é€ å‡½æ•° ä½¿ç”¨å˜é‡åè°ƒç”¨å®ä¾‹æ–¹æ³• èµ‹å€¼è¯­å¥(å¯¹è±¡èµ‹å€¼) åˆ«åï¼šä¸¤ä¸ªå˜é‡åŒæ—¶æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ å°†å¯¹è±¡ä½œä¸ºå‚æ•° Javaå°†å‚æ•°å€¼çš„ä¸€ä¸ªå‰¯æœ¬ä»è°ƒç”¨ç«¯ä¼ é€’ç»™äº†æ–¹æ³•ï¼Œè¿™ç§æ–¹å¼ç§°ä¸ºæŒ‰å€¼ä¼ é€’ å½“ä½¿ç”¨å¼•ç”¨ç±»å‹ä½œä¸ºå‚æ•°æ—¶æˆ‘ä»¬åˆ›å»ºçš„éƒ½æ˜¯åˆ«åï¼Œè¿™ç§çº¦å®šä¼šä¼ é€’å¼•ç”¨çš„å€¼(å¤åˆ¶å¼•ç”¨)ï¼Œä¹Ÿå°±æ˜¯ä¼ é€’å¯¹è±¡çš„å¼•ç”¨ è™½ç„¶æ— æ³•æ”¹å˜åŸå§‹çš„å¼•ç”¨(å°†åŸå˜é‡æŒ‡å‘å¦ä¸€ä¸ªCounterå¯¹è±¡)ï¼Œä½†èƒ½å¤Ÿæ”¹å˜è¯¥å¯¹è±¡çš„å€¼ å°†å¯¹è±¡ä½œä¸ºè¿”å›å€¼ ç”±äºJavaåªç”±ä¸€ä¸ªè¿”å›å€¼ï¼Œæœ‰äº†å¯¹è±¡å®é™…ä¸Šå°±èƒ½è¿”å›å¤šä¸ªå€¼ æ•°ç»„ä¹Ÿæ˜¯å¯¹è±¡ å°†æ•°ç»„ä¼ é€’ç»™ä¸€ä¸ªæ–¹æ³•æˆ–æ˜¯å°†ä¸€ä¸ªæ•°ç»„å˜é‡æ”¾åœ¨èµ‹å€¼è¯­å¥çš„å³ä¾§æ—¶ï¼Œæˆ‘ä»¬éƒ½æ˜¯åœ¨åˆ›å»ºæ•°ç»„å¼•ç”¨çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œè€Œéæ•°ç»„çš„å‰¯æœ¬ å¯¹è±¡çš„æ•°ç»„\nåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ•°ç»„ ä½¿ç”¨æ–¹æ‹¬å·è¯­æ³•è°ƒç”¨æ•°ç»„çš„æ„é€ å‡½æ•°åˆ›å»ºæ•°ç»„ å¯¹äºæ¯ä¸ªæ•°ç»„å…ƒç´ è°ƒç”¨å®ƒçš„æ„é€ å‡½æ•°åˆ›å»ºç›¸åº”çš„å¯¹è±¡\nå¦‚ä¸‹å›¾\nè¿ç”¨æ•°æ®æŠ½è±¡çš„æ€æƒ³ç¼–å†™ä»£ç (å®šä¹‰å’Œä½¿ç”¨æ•°æ®ç±»å‹ï¼Œå°†æ•°æ®ç±»å‹çš„å€¼å°è£…åœ¨å¯¹è±¡ä¸­)çš„æ–¹å¼ç§°ä¸ºé¢å‘å¯¹è±¡ç¼–ç¨‹ æ€»ç»“ æ•°æ®ç±»å‹æŒ‡çš„æ˜¯ä¸€ç»„å€¼å’Œä¸€ç»„å¯¹å€¼çš„æ“ä½œçš„é›†åˆ æˆ‘ä»¬ä¼šåœ¨æ•°æ®ç±»å‹çš„Javaç±»ä¸­ç¼–å†™ç”¨ç† å¯¹è±¡æ˜¯èƒ½å¤Ÿå­˜å‚¨ä»»æ„è¯¥æ•°æ®ç±»å‹çš„å€¼çš„å®ä½“ å¯¹è±¡æœ‰ä¸‰ä¸ªå…³é”®æ€§è´¨ï¼šçŠ¶æ€ã€æ ‡è¯†å’Œè¡Œä¸º æŠ½è±¡æ•°æ®ç±»å‹ä¸¾ä¾‹ # æœ¬ä¹¦ä¸­å°†ä¼šç”¨åˆ°æˆ–å¼€å‘çš„æ‰€æœ‰æ•°æ®ç±»å‹ java.lang.* Javaæ ‡å‡†åº“ä¸­çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼Œéœ€è¦importï¼Œæ¯”å¦‚java.ioã€java.netç­‰ I/Oå¤„ç†å˜æŠ½è±¡æ•°æ®ç±»å‹,StdInå’ŒStdOut é¢å‘æ•°æ®ç±»æŠ½è±¡æ•°æ®ç±»å‹ï¼Œè®¡ç®—æœºå’Œå’Œä¿¡æ¯å¤„ç† é›†åˆç±»æŠ½è±¡æ•°æ®ç±»å‹ï¼Œä¸»è¦æ˜¯ä¸ºäº†ç®€åŒ–å¯¹åŒä¸€ç±»å‹çš„ä¸€ç»„æ•°æ®çš„æ“ä½œï¼ŒåŒ…æ‹¬Bagã€Stackå’ŒQueueï¼ŒPQ(ä¼˜å…ˆé˜Ÿåˆ—)ã€ST(ç¬¦å·è¡¨)ã€SET(é›†åˆ) é¢å‘æ“ä½œçš„æŠ½è±¡æ•°æ®ç±»å‹(ç”¨æ¥åˆ†æå„ç§ç®—æ³•) å›¾ç®—æ³•ç›¸å…³çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼Œç”¨æ¥å°è£…å„ç§å›¾çš„è¡¨ç¤ºçš„é¢å‘æ•°æ®çš„æŠ½è±¡æ•°æ®ç±»å‹ï¼Œå’Œä¸€äº›æä¾›å›¾çš„å¤„ç†ç®—æ³•çš„é¢å‘æ“ä½œçš„æŠ½è±¡æ•°æ®ç±»å‹ å‡ ä½•å¯¹è±¡(ç”»å›¾(å›¾å½¢)çš„)[è·³è¿‡] ä¿¡æ¯å¤„ç† æŠ½è±¡æ•°æ®ç±»å‹æ˜¯ç»„ç»‡ä¿¡æ¯çš„ä¸€ç§è‡ªç„¶æ–¹å¼ å®šä¹‰å’ŒçœŸå®ä¸–ç•Œä¸­çš„ç‰©ä½“ç›¸å¯¹åº”çš„å¯¹è±¡ å­—ç¬¦ä¸² javaçš„String ä¸€ä¸ªStringå€¼æ˜¯ä¸€ä¸²å¯ä»¥ç”±ç´¢å¼•è®¿é—®çš„charå€¼ æœ‰äº†Stringç±»å‹å¯ä»¥å†™å‡ºæ¸…æ™°å¹²å‡€çš„ç”¨ä¾‹ä»£ç è€Œæ— éœ€å…³å¿ƒå­—ç¬¦ä¸²çš„è¡¨ç¤ºæ–¹å¼ æŠ½è±¡æ•°æ®ç±»å‹çš„å®ç° # ä½¿ç”¨Javaçš„ç±»(class)å®ç°æŠ½è±¡æ•°æ®ç±»å‹å¹¶å°†æ‰€æœ‰ä»£ç æ”¾å…¥ä¸€ä¸ªå’Œç±»åç›¸åŒå¹¶å¸¦æœ‰.javaæ‰©å±•åçš„æ–‡ä»¶ å¦‚ä¸‹å›¾\nå®ä¾‹å˜é‡\nç”¨æ¥å®šä¹‰æ•°æ®ç±»å‹çš„å€¼(æ¯ä¸ªå¯¹è±¡çš„çŠ¶æ€) æ„é€ å‡½æ•° æ¯ä¸ªJavaç±»éƒ½è‡³å°‘æœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ä»¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ ‡è¯† æ¯ä¸ªæ„é€ å‡½æ•°å°†åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¹¶å‘è°ƒç”¨è€…è¿”å›ä¸€ä¸ªè¯¥å¯¹è±¡çš„å¼•ç”¨ å®ä¾‹æ–¹æ³• å¦‚å›¾\nä½œç”¨åŸŸ å‚æ•°å˜é‡ã€å±€éƒ¨å˜é‡ã€å®ä¾‹å˜é‡ èŒƒå›´(å¦‚å›¾)\nAPIã€ç”¨ä¾‹ä¸å®ç° æˆ‘ä»¬è¦å­¦ä¹ çš„æ¯ä¸ªæŠ½è±¡æ•°æ®ç±»å‹çš„å®ç°ï¼Œéƒ½ä¼šæ˜¯ä¸€ä¸ªå«æœ‰è‹¥å¹²ç§æœ‰å®ä¾‹å˜é‡ã€æ„é€ å‡½æ•°ã€å®ä¾‹æ–¹æ³•å’Œä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹çš„Javaç±» ç”¨ä¾‹å’Œå®ç°åˆ†ç¦»(ä¸€èˆ¬å°†ç”¨ä¾‹ç‹¬ç«‹æˆå«æœ‰é™æ€æ–¹æ³•main()çš„ç±») åšæ³•å¦‚ä¸‹ å®šä¹‰ä¸€ä»½APIï¼ŒAPiçš„ä½œç”¨æ˜¯å°†ä½¿ç”¨å’Œå®ç°åˆ†ç¦»ï¼Œä»¥å®ç°æ¨¡å—åŒ–ç¼–ç¨‹ ç”¨ä¸€ä¸ªJavaç±»å®ç°APIçš„å®šä¹‰ å®ç°å¤šä¸ªæµ‹è¯•ç”¨ä¾‹æ¥éªŒè¯å‰ä¸¤æ­¥åšå‡ºçš„è®¾è®¡å†³å®š ä¾‹å­å¦‚ä¸‹ API\nå…¸å‹ç”¨ä¾‹\næ•°æ®ç±»å‹çš„å®ç°\nä½¿ç”¨æ–¹æ³•(æ‰§è¡Œç¨‹åº)\næ›´å¤šæŠ½è±¡æ•°æ®ç±»å‹çš„å®ç° # æ—¥æœŸ ä¸¤ç§å®ç°æ–¹å¼\næœ¬ä¹¦åå¤å‡ºç°çš„ä¸»é¢˜ï¼Œå³ç†è§£å„ç§å®ç°å¯¹ç©ºé—´å’Œæ—¶é—´çš„éœ€æ±‚ ç»´æŠ¤å¤šä¸ªå®ç° æ¯”è¾ƒåŒä¸€ä»½APIçš„ä¸¤ç§å®ç°åœ¨åŒä¸€ä¸ªç”¨ä¾‹ä¸­çš„æ€§èƒ½è¡¨ç°ï¼Œéœ€è¦ä¸‹é¢éæ­£å¼çš„å‘½åçº¦å®š ä½¿ç”¨å‰ç¼€çš„æè¿°æ€§ä¿®é¥°ç¬¦ï¼Œæ¯”å¦‚BasicDateå’ŒSmallDate,ä»¥åŠæ˜¯å¦åˆæ³•çš„SmartDate é€‚åˆå¤§å¤šæ•°ç”¨åŠ›çš„éœ€æ±‚çš„å®ç°ï¼Œæ¯”å¦‚Date ç´¯åŠ å™¨ æ•°æ®ç±»å‹çš„è®¾è®¡ # æŠ½è±¡æ•°æ®ç±»å‹æ˜¯ä¸€ç§å‘ç”¨ä¾‹éšè—å†…éƒ¨è¡¨ç¤ºçš„æ•°æ®ç±»å‹ å°è£…(æ•°æ®å°è£…) è®¾è®¡APi ç®—æ³•ä¸æŠ½è±¡æ•°æ®ç±»å‹ èƒ½å¤Ÿå‡†ç¡®åœ°è¯´æ˜ä¸€ä¸ªç®—æ³•çš„ç›®çš„åŠå…¶ä»–ç¨‹åºåº”è¯¥å¦‚ä½•ä½¿ç”¨è¯¥ç®—æ³• æ¯ä¸ªJavaç¨‹åºéƒ½æ˜¯ä¸€ç»„é™æ€æ–¹æ³•å’Œ(æˆ–)ä¸€ç§æ•°æ®ç±»å‹çš„å®ç°çš„é›†åˆ æœ¬ä¹¦ä¸­å…³æ³¨çš„æ˜¯æŠ½è±¡æ•°æ®ç±»å‹çš„å®ç°ä¸­çš„æ“ä½œå’Œå‘ç”¨ä¾‹éšè—å…¶ä¸­çš„æ•°æ®è¡¨ç¤º ä¾‹å­ï¼Œå°†äºŒåˆ†æ³•å°è£… API\nå…¸å‹çš„ç”¨ä¾‹\næ•°æ®ç±»å‹çš„å®ç°\næ¥å£ç»§æ‰¿ Javaè¯­è¨€ä¸ºå®šä¹‰å¯¹è±¡ä¹‹é—´çš„å…³ç³»æä¾›äº†æ”¯æŒï¼Œç§°ä¸ºæ¥å£ æ¥å£ç»§æ‰¿ä½¿å¾—æˆ‘ä»¬çš„ç¨‹åºèƒ½å¤Ÿé€šè¿‡è°ƒç”¨æ¥å£ä¸­çš„æ–¹æ³•æ“ä½œå®ç°è¯¥æ¥å£çš„ä»»æ„ç±»å‹çš„å¯¹è±¡ æœ¬ä¹¦ä¸­ä½¿ç”¨åˆ°çš„æ¥å£\nç»§æ‰¿ ç”±Objectç±»ç»§æ‰¿å¾—åˆ°çš„æ–¹æ³•\nç»§æ‰¿toString()å¹¶è‡ªå®šä¹‰ å°è£…ç±»å‹(å†…ç½®çš„å¼•ç”¨ç±»å‹ï¼ŒåŒ…æ‹¬Booleanã€Byteã€Characterã€Doubleã€Floatã€Integerã€Longå’ŒShort) ç­‰ä»·æ€§ å¦‚å›¾\nä¾‹å­ï¼Œåœ¨Dateä¸­é‡å†™equals\nå†…å­˜ç®¡ç†\nJavaå…·æœ‰è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œé€šè¿‡è®°å½•å­¤å„¿å¯¹è±¡å¹¶å°†å®ƒä»¬çš„å†…å­˜é‡Šæ”¾åˆ°å†…å­˜æ± ä¸­ ä¸å¯å˜æ€§\nä½¿ç”¨finalä¿è¯æ•°æ®ä¸å¯å˜\nä½¿ç”¨finalä¿®é¥°çš„å¼•ç”¨ç±»å‹ï¼Œä¸èƒ½å†å¼•ç”¨(æŒ‡å‘)å…¶ä»–å¯¹è±¡ï¼Œä½†å¯¹è±¡æœ¬èº«çš„å€¼å¯æ”¹å˜ å¥‘çº¦å¼è®¾è®¡ Javaè¯­è¨€èƒ½å¤Ÿåœ¨ç¨‹åºè¿è¡Œæ—¶æ£€æµ‹ç¨‹åºçŠ¶æ€ å¼‚å¸¸(Exception)+æ–­è¨€(Assertion) å¼‚å¸¸ä¸é”™è¯¯\nå…è®¸æŠ›å‡ºå¼‚å¸¸æˆ–æŠ›å‡ºé”™è¯¯ æ–­è¨€\nç¨‹åºä¸åº”è¯¥ä¾èµ–æ–­è¨€ End # "},{"id":224,"href":"/zh/docs/study/Algorithm/algorithhms_4th/1.1.6-1.1.11/","title":"ç®—æ³•çº¢çš®ä¹¦ 1.1.6-1.1.11","section":"_ç®—æ³•(ç¬¬å››ç‰ˆ)_","content":" åŸºç¡€ç¼–ç¨‹æ¨¡å‹ # é™æ€æ–¹æ³• # æœ¬ä¹¦ä¸­æ‰€æœ‰çš„Javaç¨‹åºè¦ä¹ˆæ˜¯æ•°æ®ç±»å‹çš„å®šä¹‰ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•åº“ å½“è®¨è®ºé™æ€æ–¹æ³•å’Œå®ä½“æ–¹æ³•å…±æœ‰çš„å±æ€§æ—¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ä¸åŠ å®šè¯­çš„æ–¹æ³•ä¸€è¯ æ–¹æ³•éœ€è¦å‚æ•°(æŸç§æ•°æ®ç±»å‹çš„å€¼)å¹¶æ ¹æ®å‚æ•°è®¡ç®—å‡ºæŸç§æ•°æ®ç±»å‹çš„è¿”å›å€¼(ä¾‹å¦‚æ•°å­¦å‡½æ•°çš„ç»“æœ)æˆ–è€…äº§ç”ŸæŸç§å‰¯ä½œç”¨(ä¾‹å¦‚æ‰“å°ä¸€ä¸ªå€¼) é™æ€æ–¹æ³•ç”±ç­¾å(public static ä»¥åŠå‡½æ•°çš„è¿”å›å€¼,æ–¹æ³•ååŠä¸€ä¸²å‚æ•°)å’Œå‡½æ•°ä½“ç»„æˆ è°ƒç”¨é™æ€æ–¹æ³•(å†™å‡ºæ–¹æ³•åå¹¶åœ¨åé¢çš„æ‹¬å·ä¸­åˆ—å‡ºæ•°å€¼) æ–¹æ³•çš„æ€§è´¨ æ–¹æ³•çš„å‚æ•°æŒ‰å€¼ä¼ é€’ï¼Œæ–¹æ³•ä¸­ä½¿ç”¨çš„å‚æ•°å˜é‡èƒ½å¤Ÿå¼•ç”¨è°ƒç”¨è€…çš„å‚æ•°å¹¶æ”¹å˜å…¶å†…å®¹(åªæ˜¯ä¸èƒ½æ”¹å˜åŸæ•°ç»„å˜é‡æœ¬èº«) æ–¹æ³•åå¯ä»¥è¢«é‡è½½ æ–¹æ³•åªèƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œä½†èƒ½åŒ…å«å¤šä¸ªè¿”å›è¯­å¥ æ–¹æ³•å¯ä»¥äº§ç”Ÿå‰¯ä½œç”¨ é€’å½’ï¼šæ–¹æ³•å¯ä»¥è°ƒç”¨è‡ªå·± å¯ä»¥ä½¿ç”¨æ•°å­¦å½’çº³æ³•è¯æ˜æ‰€è§£é‡Šç®—æ³•çš„æ­£ç¡®æ€§,ç¼–å†™é€’å½’é‡è¦çš„ä¸‰ç‚¹ é€’å½’æ€»æœ‰ä¸€ä¸ªæœ€ç®€å•çš„æƒ…å†µ(æ–¹æ³•ç¬¬ä¸€æ¡æ€»åŒ…å«returnçš„æ¡ä»¶è¯­å¥) é€’å½’è°ƒç”¨æ€»æ˜¯å»å°è¯•è§£å†³ä¸€ä¸ªè§„æ¨¡æ›´å°çš„å­é—®é¢˜ é€’å½’è°ƒç”¨çš„çˆ¶é—®é¢˜å’Œå°è¯•è§£å†³çš„å­é—®é¢˜ä¹‹é—´ä¸åº”è¯¥ç”±äº¤é›† å¦‚ä¸‹å›¾ä¸­ï¼Œä¸¤ä¸ªå­é—®é¢˜å„è‡ªæ“ä½œçš„æ•°ç»„éƒ¨åˆ†æ˜¯ä¸åŒçš„\nåŸºç¡€ç¼–ç¨‹æ¨¡å‹ é™æ€æ–¹æ³•åº“æ˜¯å®šä¹‰åœ¨ä¸€ä¸ªJavaç±»ä¸­çš„ä¸€ç»„é™æ€æ–¹æ³• Javaå¼€å‘çš„åŸºæœ¬æ¨¡å¼æ˜¯ç¼–å†™ä¸€ä¸ªé™æ€æ–¹æ³•åº“(åŒ…å«ä¸€ä¸ªmain()æ–¹æ³•)ç±»å®Œæˆä¸€ä¸ªä»»åŠ¡ åœ¨æœ¬ä¹¦ä¸­ï¼Œå½“æˆ‘ä»¬æåˆ°ç”¨äºæ‰§è¡Œä¸€é¡¹äººç‰©çš„Javaç¨‹åºæ—¶ï¼Œæˆ‘ä»¬æŒ‡çš„å°±æ˜¯ç”¨è¿™ç§æ¨¡å¼å¼€å‘çš„ä»£ç (è¿˜åŒ…æ‹¬å¯¹æ•°æ®ç±»å‹çš„å®šä¹‰) æ¨¡å—åŒ–ç¼–ç¨‹ é€šè¿‡é™æ€æ–¹æ³•åº“å®ç°äº†æ¨¡å—åŒ–ç¼–ç¨‹ ä¸€ä¸ªåº“ä¸­çš„é™æ€æ–¹æ³•ä¹Ÿèƒ½å¤Ÿè°ƒç”¨å¦ä¸€ä¸ªåº“ä¸­å®šä¹‰çš„é™æ€æ–¹æ³• å•å…ƒæµ‹è¯• Javaç¼–ç¨‹æœ€ä½³å®è·µä¹‹ä¸€å°±æ˜¯æ¯ä¸ªé™æ€æ–¹æ³•åº“ä¸­éƒ½åŒ…å«ä¸€ä¸ªmain()å‡½æ•°æ¥æµ‹è¯•åº“ä¸­æ‰€æœ‰çš„æ–¹æ³• æœ¬ä¹¦ä¸­ä½¿ç”¨main()æ¥è¯´æ˜æ¨¡å—çš„åŠŸèƒ½å¹¶å°†æµ‹è¯•ç”¨ä¾‹ç•™ä½œç»ƒä¹  å¤–éƒ¨åº“ ç³»ç»Ÿæ ‡å‡†åº“ java.lang.*:åŒ…æ‹¬Mathåº“;Stringå’ŒStringBuilderåº“ å¯¼å…¥çš„ç³»ç»Ÿåº“ java.util.Arrays æœ¬ä¹¦ä¸­å…¶ä»–åº“ æœ¬ä¹¦ä½¿ç”¨äº†ä½œè€…å¼€å‘çš„æ ‡å‡†åº“Std* API # æ¨¡å—åŒ–ç¼–ç¨‹é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œè®°å½•åº“æ–¹æ³•çš„ç”¨æ³•å¹¶ä¾›å…¶ä»–äººå‚è€ƒçš„æ–‡æ¡£ ä¼šç»Ÿä¸€ä½¿ç”¨åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£APIçš„æ–¹æ³•åˆ—å‡ºæ¯ä¸ªåº“æ–¹æ³•ã€ç­¾ååŠç®€è¿° ç”¨ä¾‹(è°ƒç”¨å¦ä¸€ä¸ªåº“ä¸­çš„æ–¹æ³•çš„ç¨‹åº)ï¼Œå®ç°(å®ç°äº†æŸä¸ªAPIæ–¹æ³•çš„Javaä»£ç ) ä½œè€…è‡ªå·±çš„ä¸¤ä¸ªåº“ï¼Œä¸€ä¸ªæ‰©å±•Math.random(),ä¸€ä¸ªæ”¯æŒå„ç§ç»Ÿè®¡ éšæœºé™æ€æ–¹æ³•åº“(StdRandom)çš„API\næ•°æ®åˆ†ææ–¹æ³•åº“(StdStats)çš„API\nStdRandomåº“ä¸­çš„é™æ€æ–¹æ³•çš„å®ç° ç¼–å†™è‡ªå·±çš„åº“ ç¼–å†™ç”¨ä¾‹ï¼Œå®ç°ä¸­å°†è®¡ç®—è¿‡ç¨‹åˆ†è§£ æ˜ç¡®é™æ€æ–¹æ³•åº“å’Œä¸ä¹‹å¯¹åº”çš„API å®ç°APIå’Œä¸€ä¸ªèƒ½å¤Ÿå¯¹æ–¹æ³•è¿›è¡Œç‹¬ç«‹æµ‹è¯•çš„main()å‡½æ•° APIçš„ç›®çš„æ˜¯å°†è°ƒç”¨å’Œå®ç°åˆ†ç¦» å­—ç¬¦ä¸² # å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä½¿ç”¨ + ç±»å‹è½¬æ¢(å°†ç”¨æˆ·ä»é”®ç›˜è¾“å…¥çš„å†…å®¹è½¬æ¢æˆç›¸åº”æ•°æ®ç±»å‹çš„å€¼ä»¥åŠå°†å„ç§æ•°æ®ç±»å‹çš„å€¼è½¬æ¢æˆèƒ½å¤Ÿåœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„å€¼)\nå¦‚æœæ•°å­—è·Ÿåœ¨+åé¢ï¼Œé‚£ä¹ˆä¼šå°†æ•°æ®ç±»å‹çš„å€¼è‡ªåŠ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸² å‘½ä»¤è¡Œå‚æ•° Javaä¸­å­—ç¬¦ä¸²çš„å­˜åœ¨ï¼Œä½¿ç¨‹åºèƒ½å¤Ÿæ¥æ”¶åˆ°ä»å‘½ä»¤è¡Œä¼ é€’æ¥çš„ä¿¡æ¯ å½“è¾“å…¥å‘½ä»¤javaå’Œä¸€ä¸ªåº“ååŠä¸€ç³»åˆ—å­—ç¬¦ä¸²åï¼ŒJavaç³»ç»Ÿä¼šè°ƒç”¨åº“çš„main()æ–¹æ³•å¹¶å°†åé¢çš„ä¸€ç³»åˆ—å­—ç¬¦ä¸²å˜æˆä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ƒ è¾“å…¥è¾“å‡º # Javaç¨‹åºå¯ä»¥ä»å‘½ä»¤è¡Œå‚æ•°æˆ–è€…ä¸€ä¸ªåä¸ºæ ‡å‡†è¾“å…¥æµçš„æŠ½è±¡å­—ç¬¦æµä¸­è·å¾—è¾“å…¥ï¼Œå¹¶å°†è¾“å‡ºå†™å…¥å¦ä¸€ä¸ªåä¸ºæ ‡å‡†è¾“å‡ºæµçš„å­—ç¬¦æµä¸­ é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘½ä»¤è¡Œå‚æ•°ã€æ ‡å‡†è¾“å…¥å’Œæ ‡å‡†è¾“å‡ºæ˜¯å’Œåº”ç”¨ç¨‹åºç»‘å®šçš„ï¼Œè€Œåº”ç”¨ç¨‹åºæ˜¯ç”±èƒ½å¤Ÿæ¥å—å‘½ä»¤è¾“å…¥çš„æ“ä½œç³»ç»Ÿæˆ–æ˜¯å¼€å‘ç¯å¢ƒæ‰€æ”¯æŒ ä½¿ç”¨ç»ˆç«¯æ¥æŒ‡ä»£è¿™ä¸ªåº”ç”¨ç¨‹åºæä¾›çš„ä¾›è¾“å…¥å’Œæ˜¾ç¤ºçš„çª—å£,å¦‚å›¾\nå‘½ä»¤å’Œå‚æ•° ç»ˆç«¯çª—å£åŒ…å«ä¸€ä¸ªæç¤ºç¬¦ï¼Œé€šè¿‡å®ƒæˆ‘ä»¬èƒ½å¤Ÿå‘æ“ä½œç³»ç»Ÿè¾“å…¥å‘½ä»¤å’Œå‚æ•° æ“ä½œç³»ç»Ÿå¸¸ç”¨å‘½ä»¤\næ ‡å‡†è¾“å‡º StdOutåº“çš„ä½œç”¨æ˜¯æ”¯æŒæ ‡å‡†è¾“å‡º æ ‡å‡†è¾“å‡ºåº“çš„é™æ€æ–¹æ³•çš„API\næ ¼å¼åŒ–è¾“å‡º å­—ç¬¦%å¹¶ç´§è·Ÿä¸€ä¸ªå­—ç¬¦è¡¨ç¤ºçš„è½¬æ¢ä»£ç (åŒ…æ‹¬d,få’Œs)ã€‚%å’Œè½¬æ¢ä»£ç ä¹‹é—´å¯ä»¥æ’å…¥è¯ä¹¦è¡¨ç¤ºå€¼çš„å®½åº¦ï¼Œä¸”è½¬æ¢åä¼šåœ¨å­—ç¬¦ä¸²å·¦è¾¹æ·»åŠ ç©ºæ ¼ä»¥è¾¾åˆ°éœ€è¦çš„å®½åº¦ã€‚è´Ÿæ•°è¡¨ç¤ºç©ºæ ¼ä»å³è¾¹åŠ  å®½åº¦åç”¨å°æ•°ç‚¹åŠæ•°å€¼å¯ä»¥æŒ‡å®šç²¾åº¦(æˆ–Stringå­—ç¬¦ä¸²æ‰€æˆªå–çš„é•¿åº¦) æ ¼å¼ä¸­è½¬æ¢ä»£ç å’Œå¯¹åº”å‚æ•°çš„æ•°æ®ç±»å‹å¿…é¡»åŒ¹é… æ ‡å‡†è¾“å…¥ StdInåº“ä»æ ‡å‡†è¾“å…¥æµä¸­è·å–æ•°æ®ï¼Œç„¶åå°†æ ‡å‡†è¾“å‡ºå®šå‘åˆ°ç»ˆç«¯çª—å£ æ ‡å‡†è¾“å…¥æµæœ€é‡è¦çš„ç‰¹ç‚¹ï¼Œè¿™äº›å€¼ä¼šåœ¨ç¨‹åºè¯»å–åæ¶ˆå¤± ä¾‹å­\næ ‡å‡†è¾“å…¥åº“ä¸­çš„é™æ€æ–¹æ³•API\né‡å®šå‘å’Œç®¡é“ å°†æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ java RandomSeq 1000 100.0 200.0 \u0026gt; data.txt ä»æ–‡ä»¶è€Œä¸æ˜¯ç»ˆç«¯åº”ç”¨ç¨‹åºä¸­è¯»å–æ•°æ® java Average \u0026lt; data.txt å°†ä¸€ä¸ªç¨‹åºçš„è¾“å‡ºé‡å®šå‘ä¸ºå¦ä¸€ä¸ªç¨‹åºçš„è¾“å…¥ï¼Œå«åšç®¡é“ java RandomSeq 1000 100.0 200.0 | java Average çªç ´äº†æˆ‘ä»¬èƒ½å¤Ÿå¤„ç†çš„è¾“å…¥è¾“å‡ºæµçš„é•¿åº¦é™åˆ¶ å³ä½¿è®¡ç®—æœºæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ¥å­˜å‚¨åäº¿ä¸ªæ•°ï¼Œ æˆ‘ä»¬ä»ç„¶å¯ä»¥å°†ä¾‹å­ä¸­çš„1000 æ¢æˆ1 000 000 000 ï¼ˆå½“ç„¶æˆ‘ä»¬è¿˜æ˜¯éœ€è¦ä¸€äº›æ—¶é—´æ¥å¤„ç†å®ƒä»¬ï¼‰ã€‚å½“RandomSeq è°ƒç”¨StdOut.println() æ—¶ï¼Œå®ƒå°±å‘è¾“å‡ºæµçš„æœ«å°¾æ·»åŠ äº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼›å½“Average è°ƒç”¨StdIn.readInt() æ—¶ï¼Œå®ƒå°±ä»è¾“å…¥æµçš„å¼€å¤´åˆ é™¤äº†ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚è¿™äº›åŠ¨ä½œå‘ç”Ÿçš„å®é™…é¡ºåºå–å†³äºæ“ä½œç³»ç»Ÿ å‘½ä»¤è¡Œçš„é‡å®šå‘åŠç®¡é“\nåŸºäºæ–‡ä»¶çš„è¾“å…¥è¾“å‡º Inå’ŒOutåº“æä¾›äº†ä¸€äº›é™æ€æ–¹æ³•,æ¥å®ç°å‘æ–‡ä»¶ä¸­å†™å…¥æˆ–ä»æ–‡ä»¶ä¸­è¯»å–ä¸€ä¸ªåŸå§‹æ•°æ®ç±»å‹çš„æ•°ç»„çš„æŠ½è±¡ ç”¨äºè¯»å–å’Œå†™å…¥æ•°ç»„çš„é™æ€æ–¹æ³•çš„API\næ ‡å‡†ç»˜å›¾åº“(åŸºæœ¬æ–¹æ³•å’Œæ§åˆ¶æ–¹æ³•)\u0026ndash;è¿™é‡Œè·³è¿‡ äºŒåˆ†æŸ¥æ‰¾ # å¦‚å›¾ï¼Œåœ¨ç»ˆç«¯æ¥æ”¶éœ€è¦åˆ¤æ–­çš„æ•°å­—ï¼Œå¦‚æœä¸å­˜åœ¨äºç™½åå•(æ–‡ä»¶ä¸­çš„intæ•°ç»„)ä¸­åˆ™è¾“å‡º å¼€å‘ç”¨ä¾‹ä»¥åŠä½¿ç”¨æµ‹è¯•æ–‡ä»¶(æ•°ç»„é•¿åº¦å¾ˆå¤§çš„ç™½åå•) æ¨¡æ‹Ÿå®é™…æƒ…å†µæ¥å±•ç¤ºå½“å‰ç®—æ³•çš„å¿…è¦æ€§ï¼Œæ¯”å¦‚ å°†å®¢æˆ·çš„è´¦å·ä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ç§°å®ƒä¸ºç™½åå•ï¼› ä»æ ‡å‡†è¾“å…¥ä¸­å¾—åˆ°æ¯ç¬”äº¤æ˜“çš„è´¦å·ï¼› ä½¿ç”¨è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹åœ¨æ ‡å‡†è¾“å‡ºä¸­æ‰“å°æ‰€æœ‰ä¸ä»»ä½•å®¢æˆ·æ— å…³çš„è´¦å·ï¼Œå…¬å¸å¾ˆå¯èƒ½æ‹’ç»æ­¤ç±»äº¤æ˜“ã€‚ ä½¿ç”¨é¡ºåºæŸ¥æ‰¾ public static int rank(int key, int[] a) { for (int i = 0; i \u0026lt; a.length; i++) if (a[i] == key) return i; return -1; } å½“å¤„ç†å¤§é‡è¾“å…¥çš„æ—¶å€™ï¼Œé¡ºåºæŸ¥æ‰¾çš„æ•ˆç‡æå…¶ä½ å±•æœ› # ä¸‹ä¸€èŠ‚ï¼Œé¼“åŠ±ä½¿ç”¨æ•°æ®æŠ½è±¡ï¼Œæˆ–ç§°é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯æ“ä½œé¢„å®šä¹‰çš„æ•°æ®ç±»å‹çš„é™æ€æ–¹æ³• ä½¿ç”¨æ•°æ®æŠ½è±¡çš„å¥½å¤„ å¤ç”¨æ€§ é“¾å¼æ•°æ®ç»“æ„æ¯”æ•°ç»„æ›´çµæ´» å¯ä»¥å‡†ç¡®åœ°å®šä¹‰é”é¢å¯¹çš„ç®—æ³•é—®é¢˜ 1.1 End # "},{"id":225,"href":"/zh/docs/study/Other/pc_base/","title":"ç”µè„‘åŸºç¡€æ“ä½œ","section":"å…¶ä»–","content":"\n"},{"id":226,"href":"/zh/docs/study/Algorithm/algorithhms_4th/1.1.1-1.1.5/","title":"ç®—æ³•çº¢çš®ä¹¦ 1.1.1-1.1.5","section":"_ç®—æ³•(ç¬¬å››ç‰ˆ)_","content":" åŸºç¡€ç¼–ç¨‹æ¨¡å‹ # Javaç¨‹åºçš„åŸºæœ¬ç»“æ„ # æœ¬ä¹¦å­¦ä¹ ç®—æ³•çš„æ–¹æ³•ï¼šç”¨Javaç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ç¨‹åºæ¥å®ç°ç®—æ³•(ç›¸æ¯”ç”¨è‡ªç„¶è¯­è¨€æœ‰å¾ˆå¤šä¼˜åŠ¿) åŠ£åŠ¿ï¼šç¼–ç¨‹è¯­è¨€ç‰¹å®šï¼Œä½¿ç®—æ³•çš„æ€æƒ³å’Œå®ç°ç»†èŠ‚å˜å¾—å›°éš¾(æ‰€ä»¥æœ¬ä¹¦å°½é‡ä½¿ç”¨å¤§éƒ¨åˆ†è¯­è¨€éƒ½å¿…é¡»çš„è¯­æ³•) æŠŠæè¿°å’Œå®ç°ç®—æ³•æ‰€ç”¨åˆ°çš„è¯­è¨€ç‰¹æ€§ã€è½¯ä»¶åº“å’Œæ“ä½œç³»ç»Ÿç‰¹å®šæ€»ç§°ä¸ºåŸºç¡€ç¼–ç¨‹æ¨¡å‹ Javaç¨‹åºçš„åŸºæœ¬ç»“æ„ ä¸€æ®µJavaç¨‹åºæˆ–è€…æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•åº“ï¼Œæˆ–è€…å®šä¹‰äº†ä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œéœ€è¦ç”¨åˆ°çš„è¯­æ³•\nåŸå§‹æ•°æ®ç±»å‹(åœ¨è®¡ç®—æœºä¸­ç²¾ç¡®åœ°å®šä¹‰æ•´æ•°æµ®ç‚¹æ•°å¸ƒå°”å€¼ç­‰) è¯­å¥(åˆ›å»ºå˜é‡å¹¶èµ‹å€¼ï¼Œæ§åˆ¶è¿è¡Œæµç¨‹æˆ–å¼•å‘å‰¯ä½œç”¨æ¥è¿›è¡Œè®¡ç®—ï¼ŒåŒ…æ‹¬å£°æ˜ã€èµ‹å€¼ã€æ¡ä»¶ã€å¾ªç¯ã€è°ƒç”¨å’Œè¿”å›) æ•°ç»„(å¤šä¸ªåŒç§æ•°æ®ç±»å‹å€¼çš„é›†åˆ) é™æ€æ–¹æ³•(å°è£…å¹¶é‡ç”¨ä»£ç ) å­—ç¬¦ä¸²(ä¸€è¿ä¸²çš„å­—ç¬¦ï¼Œå†…ç½®ä¸€äº›å¯¹ä»–ä»¬çš„æ“ä½œ) æ ‡å‡†è¾“å…¥/è¾“å‡º(æ˜¯ç¨‹åºä¸å¤–ç•Œè”ç³»çš„æ¡¥æ¢) æ•°æ®æŠ½è±¡(æ•°æ®æŠ½è±¡å°è£…å’Œé‡ç”¨ä»£ç ï¼Œå¯ä»¥å®šä¹‰éåŸå§‹æ•°æ®ç±»å‹ï¼Œè¿›è€Œé¢å‘å¯¹è±¡ç¼–ç¨‹) æŠŠè¿™ç§è¾“å…¥å‘½ä»¤æ‰§è¡Œç¨‹åºçš„ç¯å¢ƒç§°ä¸º è™šæ‹Ÿç»ˆç«¯\nè¦æ‰§è¡Œä¸€æ¡Javaç¨‹åºï¼Œéœ€è¦å…ˆç”¨javacå‘½ä»¤ç¼–è¯‘ï¼Œç„¶åç”¨javaå‘½ä»¤è¿è¡Œï¼Œæ¯”å¦‚ä¸‹é¢çš„æ–‡ä»¶ï¼Œéœ€è¦ä½¿ç”¨å‘½ä»¤\njavac BinarySearch.java java BinarySearch åŸå§‹æ•°æ®ç±»å‹ä¸è¡¨è¾¾å¼ # æ•°æ®ç±»å‹å°±æ˜¯ä¸€ç»„æ•°æ®å’Œå…¶æ‰€èƒ½è¿›è¡Œçš„æ“ä½œçš„é›†åˆ Javaä¸­æœ€åŸºç¡€çš„æ•°æ®ç±»å‹(æ•´å‹intï¼ŒåŒç²¾åº¦å®æ•°ç±»å‹double,å¸ƒå°”å€¼boolean,å­—ç¬¦å‹char) Javaç¨‹åºæ§åˆ¶ç”¨æ ‡è¯†ç¬¦å‘½åçš„å˜é‡ å¯¹äºåŸå§‹ç±»å‹ï¼Œç”¨æ ‡è¯†ç¬¦å¼•ç”¨å˜é‡ï¼Œ+-*/æŒ‡å®šæ“ä½œï¼Œç”¨å­—é¢é‡æ¥è¡¨ç¤ºå€¼(å¦‚1æˆ–3.14),ç”¨è¡¨è¾¾å¼è¡¨ç¤ºå¯¹å€¼çš„æ“ä½œ( è¡¨è¾¾å¼:(x+2.334)/2 ) åªè¦èƒ½å¤ŸæŒ‡å®šå€¼åŸŸå’Œåœ¨æ­¤å€¼åŸŸä¸Šçš„æ“ä½œï¼Œå°±èƒ½å®šä¹‰ä¸€ä¸ªæ•°æ®ç±»å‹(å¾ˆåƒæ•°å­¦ä¸Šå‡½æ•°çš„å®šä¹‰) +-*/æ˜¯è¢«é‡è½½è¿‡çš„ è¿ç®—äº§ç”Ÿçš„æ•°æ®çš„æ•°æ®ç±»å‹å’Œå‚ä¸è¿ç®—çš„æ•°æ®çš„æ•°æ®ç±»å‹æ˜¯ç›¸åŒçš„(5/3=1,5.0/3.0=1.6667ç­‰) å¦‚ä¸‹å›¾(å›¾æ­ªäº†äº¿ç‚¹ç‚¹..) è¡¨è¾¾å¼ è¡¨è¾¾å¼å…·æœ‰ä¼˜å…ˆçº§ï¼ŒJavaä½¿ç”¨çš„æ˜¯ä¸­ç¼€è¡¨è¾¾å¼(ä¸€ä¸ªå­—é¢é‡ç´§æ¥è¿ç®—ç¬¦ï¼Œç„¶åæ˜¯å¦ä¸€ä¸ªå­—é¢é‡)ã€‚é€»è¾‘è¿ç®—ä¸­ä¼˜å…ˆçº§ ! \u0026amp;\u0026amp; || ,è¿ç®—ç¬¦ä¸­ * / % é«˜äº+ - ã€‚æ‹¬å·èƒ½æ”¹å˜è¿™äº›è§„åˆ™ã€‚ä»£ç ä¸­å°½é‡ä½¿ç”¨æ‹¬å·æ¶ˆé™¤å¯¹ä¼˜å…ˆçº§çš„ä¾èµ– ç±»å‹è½¬æ¢ æ•°å€¼ä¼šè‡ªåŠ¨æå‡ä¸ºé«˜çº§æ•°æ®ç±»å‹ï¼Œå¦‚1+2.5 1ä¼šè¢«å…ˆè½¬ä¸ºdouble 1.0ï¼Œå€¼ä¹Ÿä¸ºdoubleçš„3.5 å¼ºè½¬(æŠŠç±»å‹åæ”¾åœ¨æ‹¬å·é‡Œè®²å…¶è½¬æ¢ä¸ºæ‹¬å·ä¸­çš„ç±»å‹) è®²é«˜çº§æ•°æ®ç±»å‹è½¬ä¸ºä½çº§å¯èƒ½ä¼šå¯¼è‡´ç²¾åº¦çš„ç¼ºå¤±ï¼Œå°½é‡å°‘ä½¿ç”¨ æ¯”è¾ƒ ==ã€!=ã€\u0026lt;ã€\u0026lt;=ã€\u0026gt;ã€\u0026gt;=ï¼Œè¿™äº›è¿ç®—ç¬¦ç§°ä¸º æ··åˆç±»å‹è¿ç®—ç¬¦ï¼Œå› ä¸ºç»“æœæ˜¯å¸ƒå°”å‹è€Œä¸æ˜¯å‚ä¸æ¯”è¾ƒçš„æ•°æ®ç±»å‹ ç»“æœæ˜¯å¸ƒå°”å‹çš„è¡¨è¾¾å¼ç§°ä¸ºå¸ƒå°”è¡¨è¾¾å¼ å…¶ä»–åŸå§‹ç±»å‹(intä¸º32ä½ï¼Œdoubleä¸º64ä½) long,64ä½æ•´æ•° short,16ä½æ•´æ•° char,16ä½å­—ç¬¦ byte,8ä½æ•´æ•° 32ä½å•ç²¾åº¦å®æ•°,float è¯­å¥ # è¯­å¥ç”¨æ¥åˆ›å»ºå’Œæ“ä½œå˜é‡ã€å¯¹å˜é‡èµ‹å€¼å¹¶æ§åˆ¶æ“ä½œçš„æ‰§è¡Œæµç¨‹ åŒ…æ‹¬å£°æ˜è¯­å¥ã€èµ‹å€¼è¯­å¥ã€æ¡ä»¶è¯­å¥ã€å¾ªç¯è¯­å¥ã€è°ƒç”¨å’Œè¿”å›è¯­å¥ å£°æ˜ï¼šè®©ä¸€ä¸ªå˜é‡åå’Œä¸€ä¸ªç±»å‹åœ¨ç¼–è¯‘æ—¶å…³è”èµ·æ¥ èµ‹å€¼ï¼šå°†(ç”±ä¸€ä¸ªè¡¨è¾¾å¼å®šä¹‰çš„)æŸä¸ªæ•°æ®ç±»å‹é¢å€¼å’Œä¸€ä¸ªå˜é‡å…³è”èµ·æ¥ æ¡ä»¶è¯­å¥ï¼š if (\u0026lt;boolean expression\u0026gt;) { \u0026lt;block statement\u0026gt; } å¾ªç¯è¯­å¥ while(\u0026lt;boolean expression\u0026gt;) { \u0026lt;block statement\u0026gt; } å…¶ä¸­å¾ªç¯è¯­å¥ä¸­çš„ä»£ç æ®µç§°ä¸ºå¾ªç¯ä½“ breakä¸continueè¯­å¥ breakï¼Œç«‹å³é€€å‡ºå¾ªç¯ continueï¼Œç«‹å³å¼€å§‹ä¸‹ä¸€è½®å¾ªç¯ ç®€ä¾¿è®°æ³• # å£°æ˜å¹¶åˆå§‹åŒ– éšå¼èµ‹å€¼ ++i;\u0026ndash;i i/=2;i+=1 å•è¯­å¥ä»£ç æ®µ(çœç•¥if/whileä»£ç æ®µçš„èŠ±æ‹¬å·) forè¯­å¥ for(\u0026lt;initialize\u0026gt;;\u0026lt;boolean expression\u0026gt;;\u0026lt;increment\u0026gt;) { \u0026lt;block statements\u0026gt; } è¿™æ®µä»£ç ç­‰ä»·äºåé¢çš„ \u0026lt;initialize\u0026gt;; while(\u0026lt;boolean expression\u0026gt;) { \u0026lt;block statments\u0026gt; \u0026lt;increment\u0026gt;; } javaè¯­å¥æ€»ç»“\næ•°ç»„ # æ•°ç»„èƒ½å¤Ÿå­˜å‚¨ç›¸åŒç±»å‹çš„å¤šä¸ªæ•°æ® Nä¸ªæ•°ç»„çš„æ•°ç»„ç¼–å·ä¸º0è‡³N-1ï¼›è¿™ç§æ•°ç»„åœ¨Javaä¸­ç§°ä¸ºä¸€ç»´æ•°ç»„ åˆ›å»ºå¹¶åˆå§‹åŒ–æ•°ç»„ éœ€è¦ä¸‰ä¸ªæ­¥éª¤ï¼Œå£°æ˜æ•°ç»„åå­—å’Œç±»å‹ï¼Œåˆ›å»ºæ•°ç»„ï¼Œåˆå§‹åŒ–æ•°ç»„å…ƒç´  å£°æ˜å¹¶åˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„\nç®€åŒ–å†™æ³•\ndouble[] a = new double[N]; ä½¿ç”¨æ•°ç»„(è®¿é—®çš„ç´¢å¼•å°äº0æˆ–è€…å¤§äºN-1æ—¶ä¼šæŠ›å‡ºArrayIndexOutOfBoundsException) å…¸å‹çš„æ•°ç»„å¤„ç†ä»£ç \nèµ·åˆ«å ä¸‹é¢çš„æƒ…å†µå¹¶æ²¡æœ‰å°†æ•°ç»„æ–°å¤åˆ¶ä¸€ä»½ï¼Œè€Œæ˜¯aï¼ŒbæŒ‡å‘äº†åŒä¸€ä¸ªæ•°ç»„\näºŒç»´æ•°ç»„ Javaä¸­äºŒç»´æ•°ç»„å°±æ˜¯ä¸€å †æ•°ç»„çš„æ•°ç»„ äºŒç»´æ•°ç»„å¯ä»¥æ˜¯å‚å·®ä¸é½ï¼Œæ¯”å¦‚a[0]=new double[5],a[1]=new double[6]ä¹‹ç±» äºŒç»´æ•°ç»„çš„åˆ›å»ºåŠåˆå§‹åŒ– double[][] a; a = new double[M][N]; for (int i = 0; i \u0026lt; M; i++) for (int j = 0; j \u0026lt; N; j++) a[i][j] = 0.0; ç²¾ç®€åçš„ä»£ç  double[][] a=new double[M][N]; "},{"id":227,"href":"/zh/docs/study/Linux/hanshunping/01-06/","title":"linux_éŸ©è€å¸ˆ_01-06","section":"éŸ©é¡ºå¹³è€å¸ˆ_","content":" åŸºç¡€ä»‹ç» # æœ¬å¥—è¯¾ç¨‹å†…å®¹\nåŸºç¡€ç¯‡: linuxå…¥é—¨ã€vmå’ŒLinuxçš„å®‰è£…ã€linuxç›®å½•ç»“æ„ å®æ“ç¯‡ è¿œç¨‹ç™»å½•ï¼ˆxshellï¼Œxftpï¼‰ã€å®ç”¨æŒ‡ä»¤ã€è¿›ç¨‹ç®¡ç†ã€ç”¨æˆ·ç®¡ç† viå’Œvimç¼–è¾‘å™¨ã€å®šæ—¶ä»»åŠ¡è°ƒåº¦ã€RPMå’ŒYUM å¼€æœºã€é‡å¯å’Œç”¨æˆ·ç™»å½•æ³¨é”€ã€ç£ç›˜åˆ†åŒºåŠæŒ‚è½½ã€ç½‘ç»œé…ç½® linuxä½¿ç”¨çš„åœ°æ–¹ åœ¨linuxä¸‹å¼€å‘é¡¹ç›®(éœ€è¦æŠŠjavaeeé¡¹ç›®éƒ¨ç½²åˆ°linuxä¸‹è¿è¡Œ) linuxè¿ç»´å·¥ç¨‹å¸ˆ(æœåŠ¡å™¨è§„åˆ’ã€ä¼˜åŒ–ã€ç›‘æ§ç­‰) linuxåµŒå…¥å¼å·¥ç¨‹å¸ˆ(linuxä¸‹é©±åŠ¨å¼€å‘[c,c++]) linuxåº”ç”¨é¢†åŸŸ ä¸ªäººæ¡Œé¢ æœåŠ¡å™¨(å…è´¹ç¨³å®šé«˜æ•ˆ) åµŒå…¥å¼é¢†åŸŸ(å¯¹è½¯ä»¶è£å‰ªï¼Œå†…æ ¸æœ€å°å¯è¾¾å‡ ç™¾kbç­‰) linuxä»‹ç» # linuxæ˜¯ä¸€ä¸ªå¼€æºå…è´¹æ“ä½œç³»ç»Ÿ linuxå‰ç¥¥ç‰©\ntux(/tu\u0026rsquo;ks/å”¾å¯si)ï¼Œæ²¡æ‰¾åˆ°éŸ³æ ‡ï¼Œå°†å°±ä¸€ä¸‹\nlinuxä¹‹çˆ¶ï¼Œlinusï¼Œä¹Ÿæ˜¯gitçš„åˆ›ä½œè€…\nä¸»è¦å‘è¡Œç‰ˆï¼šUbuntuã€RedHatï¼ŒCentosï¼ŒDebianç­‰\nRedHatå’ŒCentosä½¿ç”¨åŒæ ·çš„æºç ï¼Œä½†æ˜¯RedHatæ”¶è´¹ Linuxå’ŒUnixçš„å…³ç³»\nunixä¹Ÿæ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œè´å°”å®éªŒå®¤ã€‚åšä¸€ä¸ªå¤šç”¨æˆ·åˆ†æ—¶æ“ä½œç³»ç»Ÿï¼Œ multicsï¼Œä½†æ˜¯æ²¡å®Œæˆã€‚å…¶ä¸­ä¸€ä¸ªåæ¥åœ¨è¿™åŸºç¡€ä¸Šï¼Œå®Œæˆçš„æ“ä½œç³»ç»Ÿä¸ºunix ï¼ˆåŸæœ¬æ˜¯Bè¯­è¨€å†™çš„ï¼‰ï¼Œåé¢å’Œå¦ä¸€ä¸ªäººç”¨unixç”¨cè¯­è¨€æ”¹å†™äº†ã€‚\nunixæºç æ˜¯å…¬å¼€çš„ï¼Œåé¢å•†ä¸šå…¬å¸æ‹¿æ¥åŒ…è£…åšæˆè‡ªå·±çš„ç³»ç»Ÿï¼Œ åé¢æœ‰ä¸ªäººæå€¡è‡ªç”±æ—¶ä»£ç”¨æˆ·åº”è¯¥å¯¹æºç äº«æœ‰è¯»å†™æƒåˆ©è€Œéå„æ–­\nåé¢RichardStallmanå‘èµ·GNUè®¡åˆ’ï¼ˆå¼€æºè®¡åˆ’ï¼‰ï¼ŒLinuså‚åŠ è¯¥è®¡åˆ’ï¼Œå¹¶å…±äº«å‡ºlinuxå†…æ ¸ï¼Œäºæ˜¯å¤§å®¶åœ¨æ­¤åŸºç¡€ä¸Šå¼€å‘å‡ºå„ç§è½¯ä»¶ã€‚linuxåˆç§°GNU/linux Linuxå’ŒUnixå…³ç³»\nVMWareå®‰è£…Centos7.6 # åœ¨windowsä¸­å®‰è£…Linuxç³»ç»Ÿ\nVMå’ŒLinuxç³»ç»Ÿåœ¨pcä¸­çš„å…³ç³»\nå®‰è£…è¿‡ç¨‹ä¸­ï¼Œç½‘ç»œæ¨¡å¼ä½¿ç”¨NATæ¨¡å¼\né€‰æ‹©æœ€å°å®‰è£…ï¼Œä¸”é€‰æ‹©CompatibilityLibrarieså’ŒDevelopmentTools\nlinuxåˆ†åŒº\nä¸€èˆ¬åˆ†ä¸ºä¸‰ä¸ª\nä¸€èˆ¬boot1G,swapåˆ†åŒºä¸€èˆ¬è·Ÿå†…å­˜å¤§å°ä¸€è‡´ï¼Œè¿™é‡Œæ˜¯2Gï¼Œæ‰€ä»¥æ ¹åˆ†åŒºå°±æ˜¯å‰©ä¸‹çš„ï¼Œä¹Ÿå°±æ˜¯20-1-2=17G\nå¦‚å›¾ï¼Œbootï¼Œ/ï¼Œswapéƒ½æ˜¯æ ‡å‡†åˆ†åŒºã€‚ä¸”bootå’Œ/æ˜¯ext4çš„æ–‡ä»¶æ ¼å¼ï¼Œswapæ˜¯swapçš„æ–‡ä»¶æ ¼å¼\nä¿®æ”¹ä¸»æœºå\nä¿®æ”¹å¯†ç åŠå¢åŠ é™¤rootå¤–çš„æ™®é€šç”¨æˆ·\nä¿®æ”¹ç½‘ç»œä¸ºå›ºå®šip(NATæ¨¡å¼ä¸‹)\nå…ˆåœ¨VMé‡Œé¢æŠŠå­ç½‘ipæ”¹äº†ï¼Œè¿™é‡Œæ”¹æˆ 192.168.200.0\nç„¶åæ”¹ç½‘å…³ä¸º192.168.200.200\nä½¿ç”¨yum install -y vim å®‰è£…æ–‡æœ¬ç¼–è¾‘å·¥å…· æœ€ååœ¨linuxä¸­æ”¹é…ç½®æ–‡ä»¶ vim /etc/sysconfig/network-scripts/ifcfg-ens33 å…¶ä¸­å…ˆä¿®æ”¹BOOTPROTO=\u0026ldquo;static\u0026rdquo; ç„¶åè®¾ç½®ipåœ°å€ã€ç½‘å…³å’ŒDNSï¼Œ ä¸‹é¢æ˜¯æ·»åŠ åˆ°ä¸Šé¢çš„ifcfg-ens33åé¢ï¼Œä¸æ˜¯ç›´æ¥æ‰§è¡Œä»£ç  IPADDR=192.168.200.200 GATEWAY=192.168.200.2 DNS1=192.168.200.2 ä½¿ç”¨å‘½ä»¤é‡å¯ç½‘ç»œ service network restart # æˆ–è€…ç›´æ¥é‡å¯ç”µè„‘ reboot è¿™é‡Œé¡ºä¾¿è£…ä¸€ä¸‹zsx\nsh -c \u0026#34;$(wget https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh -O -)\u0026#34; "},{"id":228,"href":"/zh/docs/study/Redis/shangguigu_BV1Rv41177Af/19-A/","title":"redis_å°šç¡…è°·_19-A","section":"åŸºç¡€(å°šç¡…è°·)_","content":" éªŒè¯ç æ¨¡æ‹Ÿ # é¦–å…ˆéœ€è¦ä¸€ä¸ªMyRediså•ä¾‹ç±» /** * MyRediså•ä¾‹ç±» */ public class MyJedis { private static Jedis myJedis; public static Jedis getInstance() { //å¦‚æœæ˜¯ç©ºåˆ™è¿›è¡Œåˆå§‹åŒ– if (myJedis == null) { //ç”±äºsynchronizedåŒæ­¥æ˜¯åœ¨æ¡ä»¶åˆ¤æ–­å†…ï¼Œæ‰€ä»¥åŒæ­¥ //å¹¶ä¸ä¼šä¸€ç›´éƒ½æ‰§è¡Œï¼Œå¢åŠ äº†æ•ˆç‡ synchronized (MyJedis.class) { if (myJedis == null) { //è®¾ç½®å¯†ç  DefaultJedisClientConfig.Builder builder = DefaultJedisClientConfig.builder() .password(\u0026#34;hello.lwm\u0026#34;); DefaultJedisClientConfig config = builder.build(); Jedis jedis = new redis.clients.jedis.Jedis(\u0026#34;192.168.200.200\u0026#34;, 6379, config); return jedis; } } } return myJedis; } } "},{"id":229,"href":"/zh/docs/study/Redis/shangguigu_BV1Rv41177Af/18/","title":"redis_å°šç¡…è°·_18","section":"åŸºç¡€(å°šç¡…è°·)_","content":" Jedisæ“ä½œRedis6 # æ’æ›²:æœ¬åœ°é¡¹ç›®å…³è”githubè¿œç¨‹åº“ git init git add README.md git commit -m \u0026#34;first commit\u0026#34; #-mè¡¨ç¤ºå¼ºåˆ¶é‡å‘½å git branch -M main #ä½¿ç”¨åˆ«å git remote add origin git@github.com:lwmfjc/jedis_demo.git #ç”¨äº†-uä¹‹åä»¥åå¯ä»¥ç›´æ¥ç”¨git pushæ›¿ä»£æ•´è¡Œ git push -u origin main jedis pomä¾èµ– \u0026lt;!-- https://mvnrepository.com/artifact/redis.clients/jedis --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;redis.clients\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jedis\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.0.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; jedisä½¿ç”¨ public class Main { public static void main(String[] args) { //è®¾ç½®å¯†ç  DefaultJedisClientConfig.Builder builder = DefaultJedisClientConfig.builder() .password(\u0026#34;hello.lwm\u0026#34;); DefaultJedisClientConfig config = builder.build(); Jedis jedis = new Jedis(\u0026#34;192.168.200.200\u0026#34;, 6379, config); //ping String value = jedis.ping(); System.out.println(value); //è¿”å›æ‰€æœ‰key Set\u0026lt;String\u0026gt; keys = jedis.keys(\u0026#34;*\u0026#34;); System.out.println(\u0026#34;key count: \u0026#34; + keys.size()); for (String key : keys) { System.out.printf(\u0026#34;key--:%s---value:%s\\n\u0026#34;, key, jedis.get(key)); } System.out.println(\u0026#34;æ“ä½œlist\u0026#34;); //æ“ä½œlist jedis.lpush(\u0026#34;ly-list\u0026#34;, \u0026#34;java\u0026#34;, \u0026#34;c++\u0026#34;, \u0026#34;css\u0026#34;); List\u0026lt;String\u0026gt; lrange = jedis.lrange(\u0026#34;ly-list\u0026#34;, 0, -1); for (String v : lrange) { System.out.println(\u0026#34;value:\u0026#34; + v); } //æ“ä½œset System.out.println(\u0026#34;æ“ä½œset\u0026#34;); jedis.sadd(\u0026#34;ly-set\u0026#34;, \u0026#34;1\u0026#34;, \u0026#34;3\u0026#34;, \u0026#34;3\u0026#34;, \u0026#34;5\u0026#34;, \u0026#34;1\u0026#34;); Set\u0026lt;String\u0026gt; smembers = jedis.smembers(\u0026#34;ly-set\u0026#34;); for (String v : smembers) { System.out.println(\u0026#34;value:\u0026#34; + v); } //æ“ä½œhash System.out.println(\u0026#34;æ“ä½œhash\u0026#34;); jedis.hset(\u0026#34;ly-hash\u0026#34;, \u0026#34;name\u0026#34;, \u0026#34;lidian\u0026#34;); jedis.hset(\u0026#34;ly-hash\u0026#34;, \u0026#34;age\u0026#34;, \u0026#34;30\u0026#34;); jedis.hset(\u0026#34;ly-hash\u0026#34;, \u0026#34;sex\u0026#34;, \u0026#34;man\u0026#34;); Map\u0026lt;String, String\u0026gt; lyHash = jedis.hgetAll(\u0026#34;ly-hash\u0026#34;); for (String key : lyHash.keySet()) { System.out.println(key + \u0026#34;:\u0026#34; + lyHash.get(key)); } //æ“ä½œzset System.out.println(\u0026#34;æ“ä½œzset\u0026#34;); jedis.zadd(\u0026#34;person\u0026#34;, 100, \u0026#34;xiaohong\u0026#34;); jedis.zadd(\u0026#34;person\u0026#34;, 80, \u0026#34;xiaoli\u0026#34;); jedis.zadd(\u0026#34;person\u0026#34;, 90, \u0026#34;xiaochen\u0026#34;); List\u0026lt;String\u0026gt; person = jedis.zrange(\u0026#34;person\u0026#34;, 0, -1); for (String name : person) { System.out.println(name); } //ç»“æŸæ“ä½œ jedis.flushDB(); jedis.close(); } } "},{"id":230,"href":"/zh/docs/study/Redis/shangguigu_BV1Rv41177Af/12-17/","title":"redis_å°šç¡…è°·_12-17","section":"åŸºç¡€(å°šç¡…è°·)_","content":" Redisé…ç½®æ–‡ä»¶ # redisä¸­å•ä½çš„è®¾ç½®ï¼Œæ”¯æŒk,kb,m,mb,g,gbï¼Œä¸”ä¸åŒºåˆ†å¤§å°å†™\ninclude (åŒ…å«å…¶ä»–æ–‡ä»¶ï¼Œæ¯”å¦‚å…¬å…±éƒ¨åˆ†)\nbind bind 127.0.0.1 ::1 #listens on loopback IPv4 and IPv6 åé¢è¿™ä¸ª::1ï¼Œç›¸å½“äºipv6ç‰ˆçš„127.0.0.1ã€‚åœ¨redisé…ç½®æ–‡ä»¶ä¸­ï¼Œæ•´å¥è¡¨ç¤ºåªå…è®¸æœ¬åœ°ç½‘å¡çš„æŸä¸ªipè¿æ¥(ä½†æ˜¯å®ƒå¹¶ä¸èƒ½æŒ‡å®šæŸä¸ªä¸»æœºè¿æ¥åˆ°redisä¸­ã€‚æ¯”å¦‚æœ¬æœºæœ‰ä¸¤ä¸ªç½‘å¡ï¼Œä¸¤ä¸ªipï¼Œå¯ä»¥é™å®šåªæœ‰å…¶ä¸­ä¸€ä¸ªipå¯ä»¥è¿æ¥) å¦‚æœæ³¨é‡Šæ‰äº†/æˆ–è€…bind 0.0.0.0ï¼Œè¡¨ç¤ºå…è®¸æ‰€æœ‰ä¸»æœºè¿æ¥ protected-mode protected-mode yes è®¾ç½®ä¿æŠ¤æ¨¡å¼ä¸ºyesï¼Œprotectedæ˜¯redisæœ¬èº«çš„ä¸€ä¸ªå®‰å…¨å±‚ï¼Œè¿™ä¸ªå®‰å…¨å±‚åœ¨åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸‰ä¸ªæ¡ä»¶çš„æ—¶å€™ä¼šå¼€å¯ï¼Œå¼€å¯ååªæœ‰æœ¬æœºå¯ä»¥è®¿é—®redis protected-mode yes æ²¡æœ‰bindæŒ‡ä»¤(bind 0.0.0.0ä¸å±äºè¿™ä¸ªæ¡ä»¶) æ²¡æœ‰è®¾ç½®å¯†ç  (æ²¡æœ‰è®¾ç½®requirepass password) åªè¦ä¸Šé¢ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œå°±ä¸ä¼šå¼€å¯ä¿æŠ¤æ¨¡å¼ã€‚æ¢è¨€ä¹‹ï¼Œåªè¦è®¾ç½®äº†bind 0.0.0.0æˆ–è€…æ²¡æœ‰è®¾ç½®bindï¼Œä¸”ä¸æ»¡è¶³ä¸Šé¢ä¸‰ä¸ªæ¡ä»¶ä¹‹ä¸€ï¼Œå°±èƒ½å¤Ÿè¿›è¡Œè¿œç¨‹è®¿é—®(å½“ç„¶ï¼Œlinux/windowsçš„6379ç«¯å£è¦å¼€æ”¾) tcp-backlog è¡¨ç¤ºæœªè¿æ¥é˜Ÿåˆ—æ€»å’Œ timeout ç§’ä¸ºå•ä½ï¼Œæ—¶é—´å†…æ²¡æ“ä½œåˆ™æ–­å¼€è¿æ¥ tcp-keepalive 300 å¿ƒè·³æ£€æµ‹ï¼Œæ¯éš”300sæ£€æµ‹è¿æ¥æ˜¯å¦å­˜åœ¨ pidfile /var/run/redis_6379.pid å°†è¿›ç¨‹å·ä¿å­˜åˆ°æ–‡ä»¶ä¸­ loglevel è¡¨ç¤ºæ—¥å¿—çš„çº§åˆ«/debug/verbose/notice/warning logfile \u0026quot;\u0026quot; è®¾ç½®æ—¥å¿—çš„è·¯å¾„ database 16 é»˜è®¤æœ‰16ä¸ªåº“ requirepass password è®¾ç½®å¯†ç  maxclients è®¾ç½®æœ€å¤§è¿æ¥æ•° maxmemory è®¾ç½®æœ€å¤§å†…å­˜é‡ï¼Œè¾¾åˆ°åˆ™ä¼šæ ¹æ®ç§»é™¤ç­–ç•¥è¿›è¡Œç§»é™¤æ“ä½œ Redisçš„å‘å¸ƒå’Œè®¢é˜… # å‘å¸ƒè®¢é˜…ï¼Œpub/subï¼Œæ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€…pubå‘é€æ¶ˆæ¯ï¼Œè®¢é˜…å™¨subæ¥æ”¶æ¶ˆæ¯ å‘å¸ƒè€…èƒ½å‘å¸ƒæ¶ˆæ¯ï¼Œè®¢é˜…è€…å¯ä»¥è®¢é˜…/æ¥æ”¶æ¶ˆæ¯\næ“ä½œ subscribe channel1 #å®¢æˆ·ç«¯Aè®¢é˜…é¢‘é“ publish channel1 helloly #å‘é¢‘é“å‘é€æ¶ˆæ¯ æ­¤æ—¶è®¢é˜…channel1é¢‘é“çš„å®¢æˆ·ç«¯å°±ä¼šæ¥æ”¶åˆ°æ¶ˆæ¯\nredisæ–°æ•°æ®ç±»å‹ # Bitmaps # è¿›è¡ŒäºŒè¿›åˆ¶æ“ä½œ\nå¯ä»¥æŠŠBitmapsæƒ³è±¡æˆä¸€ä¸ªä»¥ä½ä¸ºå•ä½çš„æ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸ªå•å…ƒåªèƒ½å­˜å‚¨0å’Œ1ï¼Œæ•°ç»„çš„ä¸‹æ ‡åœ¨Bitmapsä¸­å«åšåç§»é‡\nbitcount:ç»Ÿè®¡å­—ç¬¦ä¸²è¢«è®¾ç½®ä¸º1çš„bitæ•°ï¼Œè¿™é‡Œç»“æœæ˜¯5\nbitcount u1 0 1 #ç»Ÿè®¡å­—ç¬¦ä¸²ç¬¬0ä¸ªå­—èŠ‚åˆ°ç¬¬1ä¸ªå­—èŠ‚1çš„bitæ•°\n(1,6,11,15,19bitå€¼ä¸º1)[ä¹Ÿå°±æ˜¯ç»Ÿè®¡ç¬¬0åˆ°ç¬¬15ä½çš„1çš„ä¸ªæ•°]\nsetbit u1 1 1 setbit u1 2 1 setbit u1 5 1 setbit u1 9 1 setbit u2 0 1 setbit u2 1 1 setbit u2 4 1 setbit u2 9 1 è·å–u1ï¼Œu2å…±åŒä½ä¸º1çš„ä¸ªæ•°ï¼Œå¦‚ä¸Š1,9éƒ½æ˜¯1ï¼Œæ‰€ä»¥è¿”å›2ï¼Œä¸” bitcount u1\u0026ndash;u2çš„å€¼ä¸º2ï¼ˆç¬¬1å’Œç¬¬9ä½ä¸º1ï¼‰ï¼Œå…¶å®å°±æ˜¯u1å’Œu2è¿›è¡Œ\u0026amp;æ“ä½œ\nbitop and u1-and-u2 u1 u2 è·å–u1æˆ–u2å­˜åœ¨å€¼ä¸º1çš„ä½çš„ä¸ªæ•°ï¼Œå¦‚ä¸Šç»“æœä¸º8-2=6ï¼Œç»“æœå­˜åœ¨u1-or-u2ä¸­ï¼Œå³1ï¼Œ2ï¼Œ5ï¼Œ9ï¼Œ0ï¼Œ4çš„ä½ å€¼ä¸º1(çš„å­—ç¬¦ä¸²)ï¼Œå…¶å®å°±æ˜¯u1å’Œu2è¿›è¡Œæˆ–æ“ä½œ\næ€§èƒ½æ¯”è¾ƒï¼Œå‡è®¾æœ‰ä¸€äº¿ä¸ªç”¨æˆ·ï¼Œç”¨æˆ·idæ•°å€¼é€’å¢ï¼Œéœ€æ±‚æ˜¯å­˜å‚¨æ¯ä¸ªç”¨æˆ·æ˜¯å¦æ´»è·ƒã€‚ä¸‹é¢æ˜¯ä½¿ç”¨hashMapå’Œbitmapsçš„æ¯”è¾ƒ\nbitmapsä¸»è¦ç”¨æ¥è¿›è¡Œä½æ“ä½œè®¡ç®—\nHyperLogLog # è§£å†³åŸºæ•°é—®é¢˜\nä»{1,3,5,5,7,8,8,7,9}æ‰¾å‡ºåŸºæ•°ï¼šåŸºæ•°ä¸º5ï¼Œå³ä¸é‡å¤å…ƒç´ çš„ä¸ªæ•° è§£å†³æ–¹æ¡ˆ mysqlä¸­å¯ä»¥ç”¨distinct count redisä¸­å¯ä»¥ç”¨hash,set,bitmaps ä½¿ç”¨ pfadd a 1 2 3 4 3 3 3 2 1 6 7 pfcount a #å¾—åˆ°åŸºæ•° 6 pfadd b 1 10 7 15 #åŸºæ•°4 pfmerge c a b #å°†aï¼Œbåˆå¹¶åˆ°c pfcount c #å¾—åˆ°åŸºæ•°8 GEOç±»å‹ (geographic) # åŸºæœ¬å‘½ä»¤ geoadd china:city 121.47 31.43 shanghai geoadd china:city 166.50 29.53 chongqing 114.05 22.52 shenzhen geoadd china:city 16.38 39.90 beijing ä¸æ”¯æŒå—åŒ—æï¼Œæ‰€ä»¥æœ‰æ•ˆç»åº¦åœ¨-180åˆ°180åº¦ï¼Œæœ‰æ•ˆçº¬åº¦ä»-85.05xxxåº¦åˆ°85.05xxxåº¦ è·å–åæ ‡å€¼åŠç›´çº¿è·ç¦» geopos china:city beijing #è·å–beijingç»çº¬åº¦ geodist china:city beijing shenzhen km #è·å–beijingåˆ°shenzhençš„ç›´çº¿è·ç¦» # å•ä½æœ‰m,km,ft,mi ä»¥ç»™å®šçš„ç»çº¬åº¦ä¸ºä¸­å¿ƒï¼Œæ‰¾å‡ºæŸä¸€åŠå¾„å†…çš„å…ƒç´  georadius china:city 110 30 1000 km End # "},{"id":231,"href":"/zh/docs/study/Redis/shangguigu_BV1Rv41177Af/06-11/","title":"redis_å°šç¡…è°·_06-11","section":"åŸºç¡€(å°šç¡…è°·)_","content":" Redisé’ˆå¯¹keyçš„åŸºæœ¬æ“ä½œ # å¸¸ç”¨å‘½ä»¤ keys * #æŸ¥æ‰¾å½“å‰åº“æ‰€æœ‰åº“ exists key1 #key1æ˜¯å¦å­˜åœ¨ 1å­˜åœ¨ï¼›0ä¸å­˜åœ¨ type key2 #key2çš„ç±»å‹ del key3 #åˆ é™¤key3 unlink key3 #åˆ é™¤key3(é€‰æ‹©éé˜»å¡åˆ é™¤ã€‚ä¼šå…ˆä»å…ƒæ•°æ®åˆ é™¤ï¼Œè€ŒçœŸæ­£åˆ é™¤æ˜¯å¼‚æ­¥åˆ é™¤) expire key1 10 #è®¾ç½®key1çš„è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’ ttl key1 #è·å–key1çš„å‰©ä½™å­˜æ´»æ—¶é—´ï¼Œ-2è¡¨ç¤ºkeyå·²è¿‡æœŸæˆ–ä¸å­˜åœ¨ï¼Œ-1è¡¨ç¤ºæ°¸ä¸è¿‡æœŸ select 1 #åˆ‡æ¢åˆ°1å·åº“(redisä¸­æœ‰15ä¸ªåº“ï¼Œé»˜è®¤åœ¨åº“1) dbsize #æŸ¥æ‰¾å½“å‰redisåº“ä¸­æœ‰å¤šå°‘ä¸ªkey flushdb #æ¸…ç©ºå½“å‰åº“ flushall #æ¸…ç©ºæ‰€æœ‰åº“ Redisä¸­å¸¸ç”¨æ•°æ®ç±»å‹ # å­—ç¬¦ä¸²ï¼ˆStringï¼‰ # Stringæ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œå¯ä»¥åŒ…å«jpgå›¾ç‰‡æˆ–åºåˆ—åŒ–çš„å¯¹è±¡ ä¸€ä¸ªRedisä¸­å­—ç¬¦ä¸²valueæœ€å¤šå¯ä»¥åªèƒ½æ˜¯512M å¸¸ç”¨å‘½ä»¤ set key1 value1 get key1 set key1 value11 #å°†è¦†ç›–ä¸Šä¸€ä¸ªå€¼ append key1 abc #åœ¨key1çš„å€¼è¿½åŠ \u0026#34;abc\u0026#34; strlen key1 #keyå€¼çš„é•¿åº¦ setnx key1 value #å½“keyä¸å­˜åœ¨æ—¶æ‰è®¾ç½®key incr n1 #å°†n1çš„å€¼åŠ ä¸€,,å¦‚æœn1ä¸å­˜åœ¨åˆ™ä¼šåˆ›å»ºkey n1 å¹¶æ”¹ä¸º1(0+1) decr n1 #å°†n1çš„å€¼å‡ä¸€,å¦‚æœn1ä¸å­˜åœ¨åˆ™ä¼šåˆ›å»ºkey n1 å¹¶æ”¹ä¸º-1(0-1) incrby n1 20 #å°†n1çš„å€¼åŠ 20ï¼Œå…¶ä»–åŒä¸Š decrby n1 20 #å°†n1çš„å€¼å‡20ï¼Œå…¶ä»–åŒä¸Š redisåŸå­æ€§\nincrå…·æœ‰åŸå­æ€§æ“ä½œ\njavaä¸­çš„i++ä¸æ˜¯åŸå­æ“ä½œ å…¶ä»–å‘½ä»¤ mset k1 v1 k2 v2 mget k1 k2 msetnx k1 v1 k2 v2 #ä»…å½“æ‰€æœ‰çš„keyéƒ½ä¸å­˜åœ¨æ—¶æ‰ä¼šè¿›è¡Œè®¾ç½® getrange name 0 3 #æˆªæ–­å­—ç¬¦ä¸²[0,3] setrange name 3 123 #ä»ä¸‹æ ‡[3]å¼€å§‹æ›¿æ¢å­—ç¬¦ä¸²ï¼ˆæ¢æˆ123ï¼‰ setex k1 20 v1 #è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º20s expire k1 30 #è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º30s getset k1 123 #è·å–æ—§å€¼ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªæ–°å€¼ æ•°æ®ç»“æ„ï¼ŒSimpleDynamicStringï¼ŒSDSï¼Œç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼Œå†…éƒ¨ç»“æ„ç±»ä¼¼Javaçš„ArrayListï¼Œé‡‡ç”¨é¢„åˆ†é…å†—ä½™ç©ºé—´çš„æ–¹å¼æ¥å‡å°‘å†…å­˜çš„é¢‘ç¹åˆ†é…\nåˆ—è¡¨ (List) # å•é”®å¤šå€¼ åº•å±‚æ˜¯åŒå‘é“¾è¡¨ ä»å·¦æ”¾ lpush k1 v1 v2 v3 #ä»å·¦è¾¹æ”¾(ä»å·¦å¾€å³æ¨) lrange k1 0 -1 #ä»å·¦è¾¹å–(v3 v2 v1) lpush:\nä»å³æ”¾ rpush k2 v1 v2 v3 brpush:\nlpop/rpop lpop k2 #ä»å·¦è¾¹å¼¹å‡ºä¸€ä¸ªå€¼ lpop k2 2 #ä»å·¦è¾¹å¼¹å‡ºä¸¤ä¸ªå€¼ï¼Œå½“é”®æ²¡æœ‰åŒ…å«å€¼æ—¶ï¼Œé”®è¢«åˆ é™¤ rpoplpush lpush a a1 a2 a3 rpush b b1 b2 b3 rpoplpush a b #æ­¤æ—¶a:a1 a2ï¼Œb:a3 b1 b2 b3 lrange lrange b 1 2 #è·å–bä¸­ä¸‹æ ‡[1,2]çš„æ‰€æœ‰å€¼ lrange b 1 -1 #è·å–æ‰€æœ‰å€¼[1,æœ€å¤§ä¸‹æ ‡]çš„æ‰€æœ‰å€¼ lindex,llen lindex b 1 #ç›´æ¥å–ç¬¬ä¸€ä¸ªä¸‹æ ‡çš„å…ƒç´  llen b #è·å–åˆ—è¡¨çš„é•¿åº¦ linsert linsert b before b2 myinsert linsert b after b2 myinsert #åœ¨æŸä¸ªåˆ—è¡¨çš„å€¼(å¦‚æœé‡å¤å–ç¬¬ä¸€ä¸ª)çš„ä½ç½®ä¹‹å‰/ä¹‹åæ’å…¥å€¼ lrem,lset lrem b 2 a #ä»båˆ—è¡¨ä¸­ï¼Œåˆ é™¤ä¸¤ä¸ªaï¼ˆä»å·¦å¾€å³ï¼‰ lset b 2 AA #æŠŠä¸‹æ ‡2çš„å€¼è®¾ç½®ä¸ºAA listæ•°æ®ç»“æ„æ˜¯ä¸€ä¸ªå¿«é€Ÿåˆ—è¡¨ï¼Œquicklist\nå½“å…ƒç´ è¾ƒå°‘çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨è¿ç»­çš„å†…å­˜å­˜å‚¨ï¼Œç»“æ„æ—¶ziplistï¼Œå³å‹ç¼©åˆ—è¡¨ï¼›å½“æ•°æ®å¤šçš„æ—¶å€™ä¼šæœ‰å¤šä¸ªå‹ç¼©åˆ—è¡¨ï¼Œç„¶åä¼šé“¾æ¥åˆ°ä¸€èµ·(ä½¿ç”¨åŒå‘æŒ‡é’ˆ)\né›†åˆ(Set) # ç‰¹ç‚¹ï¼šæ— åºï¼Œä¸é‡å¤ Set:stringç±»å‹çš„æ— åºé›†åˆï¼Œåº•å±‚æ˜¯ä¸€ä¸ªvalueä¸ºnullçš„hashè¡¨ï¼›æ·»åŠ /åˆ é™¤æ—¶é—´å¤æ‚åº¦ä¸ºO(1) å¸¸ç”¨å‘½ä»¤ sadd k1 v1 v2 v3 v2 v2 v1 #è®¾ç½®é›†åˆä¸­çš„å€¼ smembers k1 #å–å‡ºé›†åˆä¸­çš„å€¼ sismember k1 v3 #k1æ˜¯å¦å­˜åœ¨v3ï¼Œå­˜åœ¨è¿”å›1ï¼Œä¸å­˜åœ¨è¿”å›0 scard k1 #è¿”å›é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•° srem k1 v2 v3 #åˆ é™¤é›†åˆä¸­çš„v2å’Œv3 spop k1 #ä»k1ä¸­éšæœºå–å‡ºä¸€ä¸ªå€¼ srandmember k1 2 #ä»k1ä¸­éšæœºå–å‡º2ä¸ªå€¼ smove a k a1 #ä»aä¸­å°†a1ç§»åŠ¨åˆ°kä¸­ sinter a k #å–aï¼Œkçš„äº¤é›† sunion a k #å–aï¼Œkçš„å¹¶é›† sdiff a k #è¿”å›ä¸¤ä¸ªé›†åˆçš„å·®é›†ï¼ˆä»é›†åˆaä¸­ï¼Œå»é™¤å­˜åœ¨é›†åˆkä¸­çš„å…ƒç´ ï¼Œå³a-kï¼‰ Setæ•°æ®ç»“æ„æ—¶dictå­—å…¸ï¼Œå­—å…¸ä½¿ç”¨å“ˆå¸Œè¡¨å®ç°çš„ å“ˆå¸Œï¼ˆHash) # æ˜¯Stringç±»å‹çš„fieldå’Œvalueçš„æ˜ å°„è¡¨ï¼Œç”¨æ¥å­˜å‚¨å¯¹è±¡,ç±»ä¼¼javaä¸­çš„Map\u0026lt;String,Object\u0026gt; å¸¸ç”¨å‘½ä»¤ hset user:1001 id 1 #è®¾ç½®(å¯¹è±¡)user:1001çš„idå±æ€§å€¼ hset user:1001 name zhangsan hget user:1001 name #å–å‡ºuser:1001çš„name hmset user:1001 id 1 name zhangsan #æ‰¹é‡è®¾ç½®ï¼ˆç°åœ¨hsetä¹Ÿå¯ä»¥æ‰¹é‡è®¾ç½®äº†ï¼Œhmsetå·²å¼ƒç”¨ï¼‰ hexists user:1001 id 1 #åˆ¤æ–­å±æ€§idæ˜¯å¦å­˜åœ¨ hkeys user:1001 #æŸ¥çœ‹hashç»“æ„ä¸­çš„æ‰€æœ‰filed hvals user:1001 #æŸ¥çœ‹hashç»“æ„ä¸­æ‰€æœ‰value hincrby user:1001 age 2 #ç»™hashç»“æ„çš„ageå±æ€§å€¼åŠ 2 hsetnx user:1001 age 10 #ç»™hashç»“æ„çš„ageå±æ€§è®¾ç½®å€¼ä¸º10ï¼ˆå¦‚æœageå±æ€§ä¸å­˜åœ¨ï¼‰ hashç±»å‹æ•°æ®ç»“æ„ï¼Œå½“field-valueé•¿åº¦è¾ƒçŸ­æ—¶ç”¨çš„æ˜¯ziplistï¼Œå¦åˆ™ä½¿ç”¨çš„æ˜¯hashtable æœ‰åºé›†åˆ(ZSet) # ä¸setå¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯æ˜¯æœ‰åºçš„ æœ‰åºé›†åˆçš„æ‰€æœ‰å…ƒç´ ï¼ˆæˆå‘˜ï¼‰éƒ½å…³è”ä¸€ä¸ªè¯„åˆ†(score)ï¼Œscoreç”¨æ¥ä»æœ€ä½åˆ°æœ€é«˜æ–¹å¼è¿›è¡Œæ’åºï¼Œæˆå‘˜å”¯ä¸€ä½†è¯„åˆ†æ˜¯é‡å¤çš„ å¸¸ç”¨å‘½ä»¤ zadd topn 100 xiaoming 120 xiaohong 60 xiaochen #æ·»åŠ keyå¹¶ä¸ºæ¯ä¸ªæˆå‘˜æ·»åŠ è¯„åˆ† zadd topn xiaoli 200 zrange topn 0 -1 #æŸ¥æ‰¾å‡ºæ‰€æœ‰æˆå‘˜(æŒ‰æ’åç”±å°åˆ°å¤§) zrange topn 0 -1 withscores #ä»å°åˆ°å¤§æŸ¥æ‰¾æ‰€æœ‰æˆå‘˜å¹¶æ˜¾ç¤ºåˆ†æ•° zrangebyscore topn 130 200 #æŸ¥æ‰¾æ‰€æœ‰åœ¨130-200çš„æˆå‘˜ zrevrangebyscore topn 200 130 #ä»å¤§åˆ°å°æŸ¥æ‰¾æ‰€æœ‰æˆå‘˜ï¼ˆæ³¨æ„ï¼Œä»å¤§åˆ°å°æ—¶ç¬¬ä¸€ä¸ªå€¼å¿…é¡»å¤§äºç­‰äºç¬¬äºŒä¸ªï¼‰ zincrby topn 15 xiaohong #ç»™å°çº¢æ·»åŠ 15åˆ† zrem topn xiaohong #åˆ é™¤å…ƒç´  zcount topn 10 200 #ç»Ÿè®¡è¯¥é›†åˆï¼Œåˆ†æ•°åŒºé—´å†…çš„å…ƒç´ ä¸ªæ•° zrank topn xiaohong #xiaohongçš„æ’åï¼Œä»0å¼€å§‹ zsetåº•å±‚æ•°æ®ç»“æ„ hashç»“æ„\nè·³è·ƒè¡¨ ç»™å…ƒç´ valueæ’åºï¼Œæ ¹æ®scoreçš„èŒƒå›´è·å–å…ƒç´ åˆ—è¡¨ å¯¹æ¯”æœ‰åºé“¾è¡¨å’Œè·³è·ƒè¡¨ æŸ¥æ‰¾51å…ƒç´ \nè·³è·ƒè¡¨\næŒ‰å›¾ä¸­çš„é¡ºåºæŸ¥æ‰¾ï¼ŒæŸ¥æ‰¾å››æ¬¡å°±èƒ½æ‰¾åˆ°\nEnd "},{"id":232,"href":"/zh/docs/problem/Hugo/p1/","title":"hugoè¸©å‘","section":"Hugo","content":" å¯¹äºè®¿é—®æ–‡ä»¶èµ„æº\nhugoçš„æ–‡ä»¶å¤¹åä¸èƒ½ä»¥-ç»“å°¾ã€‚ ä¸€ä¸ªæ–‡ä»¶å¤¹(æ¯”å¦‚è¿™é‡Œæ˜¯hugoæ–‡ä»¶å¤¹)ä¸­ï¼Œå…¶ä¸­çš„index.mdæ–‡ä»¶ä¸­å¼•ç”¨å›¾ç‰‡æ—¶ï¼Œæ˜¯ä»¥index.mdæ‰€åœ¨æ–‡ä»¶å¤¹(ä¹Ÿå°±æ˜¯hugoæ–‡ä»¶å¤¹)ä¸ºæ ¹ç›®å½•è®¿é—®å›¾ç‰‡ï¼›è€Œå…¶ä¸­çš„01a.mdæ–‡ä»¶ä¸­å¼•ç”¨å›¾ç‰‡æ—¶ï¼Œæ˜¯ä»¥å’Œè¯¥æ–‡ä»¶åŒçº§çš„01aæ–‡ä»¶å¤¹(ä¹Ÿå°±æ˜¯hugo/01a/)ä¸ºæ ¹ç›®å½•ï¼Œè®¿é—®å›¾ç‰‡\nå½“ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹å­˜åœ¨index.mdæ–‡ä»¶æ—¶ï¼Œå…¶ä»–æ–‡ä»¶(ä»£è¡¨çš„æ–‡ç« )ä¸æ˜¾ç¤ºåœ¨ç½‘ç«™çš„æ–‡ç« åˆ—è¡¨\nä¸ºäº†æŸäº›æ–‡ä»¶é¢„è§ˆåŠŸèƒ½ï¼Œæˆ‘å»ºè®®ä½¿ç”¨ä¸‹é¢çš„æ–‡ä»¶å¤¹ç»“æ„å¤„ç†æ–‡ç« åŠèµ„æº\n"},{"id":233,"href":"/zh/docs/problem/Hugo/01a/","title":"å›¾ç‰‡æµ‹è¯•(hugoè¸©å‘)","section":"Hugo","content":" å›¾ç‰‡æµ‹è¯• # "},{"id":234,"href":"/zh/docs/study/Redis/shangguigu_BV1Rv41177Af/01-05/","title":"redis_å°šç¡…è°·_01-05","section":"åŸºç¡€(å°šç¡…è°·)_","content":" è¯¾ç¨‹ç®€ä»‹ # NoSQLæ•°æ®åº“ç®€ä»‹ã€Redisæ¦‚è¿°ä¸å®‰è£…ã€å¸¸ç”¨äº”å¤§æ•°æ®ç»“æ„ã€é…ç½®æ–‡ä»¶è¯¦è§£ã€å‘å¸ƒä¸è®¢é˜…ã€Redis6æ–°æ•°æ®ç±»å‹ã€Redisä¸spring bootæ•´åˆã€äº‹åŠ¡æ“ä½œã€æŒä¹…åŒ–ä¹‹RDBã€æŒä¹…åŒ–ä¹‹AOFã€ä¸»ä»å¤åˆ¶åŠé›†ç¾¤ã€Redis6åº”ç”¨é—®é¢˜(ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©ä»¥åŠåˆ†å¸ƒå¼é”)ã€Redis6æ–°å¢åŠŸèƒ½\nNoSQLæ•°æ®åº“ç®€ä»‹ # Rediså±äºNoSQLæ•°æ®åº“ æŠ€æœ¯åˆ†ä¸ºä¸‰å¤§ç±» è§£å†³åŠŸèƒ½æ€§é—®é¢˜ï¼šJavaã€Jspã€RDBMSã€Tomcatã€Linuxã€JDBCã€SVN è§£å†³æ‰©å±•æ€§é—®é¢˜ï¼šStrutsã€Springã€SpringMVCã€Hibernateã€Mybatis è§£å†³æ€§èƒ½é—®é¢˜ï¼šNoSQLã€Javaçº¿ç¨‹ã€Nginxã€MQã€ElasticSearch ç¼“å­˜æ•°æ®åº“çš„å¥½å¤„ å®Œå…¨åœ¨å†…å­˜ä¸­ï¼Œé€Ÿåº¦å¿«ï¼Œç»“æ„ç®€å• ä½œä¸ºç¼“å­˜æ•°æ®åº“ï¼šå‡å°‘ioçš„è¯»æ“ä½œ NoSQLï¼Not Only SQL,ä¸ä»…ä»…æ˜¯SQLï¼Œæ³›æŒ‡éæ³›å‹æ•°æ®åº“ ä¸æ”¯æŒACID(ä½†æ˜¯NoSQLæ”¯æŒäº‹åŠ¡) é€‰è¶…äºSQLçš„æ€§èƒ½ NoSQLé€‚ç”¨åœºæ™¯ å¯¹æ•°æ®é«˜å¹¶å‘çš„è¯»å†™ æµ·é‡æ•°æ®çš„è¯»å†™ å¯¹æ•°æ®é«˜å¯æ‰©å±•æ€§ NoSQLä¸é€‚ç”¨çš„åœºæ™¯ éœ€è¦äº‹åŠ¡æ”¯æŒ åŸºäºsqlçš„ç»“æ„åŒ–æŸ¥è¯¢å­˜å‚¨ å¤šç§NoSQLæ•°æ®åº“ä»‹ç» Memcache ä¸æ”¯æŒæŒä¹…åŒ–ï¼Œæ•°æ®ç±»å‹å•ä¸€ï¼Œä¸€èˆ¬ä½œä¸ºè¾…åŠ©æŒä¹…åŒ–çš„æ•°æ®åº“ Redis æ”¯æŒæŒä¹…åŒ–ï¼Œé™¤äº†k-væ¨¡å¼è¿˜æœ‰å…¶ä»–å¤šç§æ•°æ®ç»“æ„ï¼Œä¸€èˆ¬ä½œä¸ºè¾…åŠ©æŒä¹…åŒ–çš„æ•°æ®åº“ MongoDBï¼Œæ˜¯æ–‡æ¡£å‹æ•°æ®ç±»å‹ï¼›k-væ¨¡å‹ï¼Œä½†æ˜¯å¯¹valueæä¾›äº†ä¸°å¯Œçš„æŸ¥è¯¢åŠŸèƒ½ï¼›æ”¯æŒäºŒè¿›åˆ¶æ•°æ®åŠå¤§å‹å¯¹è±¡ï¼›æ›¿ä»£RDBMSï¼Œæˆä¸ºç‹¬ç«‹æ•°æ®åº“ å¤§æ•°æ®æ—¶ä»£ï¼ˆè¡Œå¼æ•°æ®åº“ã€åˆ—å¼æ•°æ®åº“ï¼‰ è¡Œå¼æ•°æ®åº“\næŸ¥è¯¢æŸä¸€å—æ•°æ®çš„æ—¶å€™æ•ˆç‡é«˜\nåˆ—å¼æ•°æ®åº“\næŸ¥è¯¢æŸä¸€åˆ—ç»Ÿè®¡ä¿¡æ¯å¿«\nå…¶ä»–\nHbaseï¼ŒCassandraï¼Œå›¾å…³ç³»æ•°æ®åº“(æ¯”å¦‚ç¤¾ä¼šå…³ç³»ï¼Œå…¬å…±äº¤é€šç½‘ç­‰) å°è®¡\nNoSQLæ•°æ®åº“æ˜¯ä¸ºæé«˜æ€§èƒ½è€Œäº§ç”Ÿçš„éå…³ç³»å‹æ•°æ®åº“ Redisæ¦‚è¿°ä¸å®‰è£… # ç®€å•æ¦‚è¿° Redisæ˜¯ä¸€ä¸ªå¼€æºçš„kvå­˜å‚¨ç³»ç»Ÿ ç›¸æ¯”Mencachedï¼Œæ”¯æŒå­˜å‚¨çš„æ•°æ®ç±»å‹æ›´å¤šï¼ŒåŒ…æ‹¬stringï¼Œlistï¼Œsetï¼Œzsetä»¥åŠhashï¼Œè¿™äº›ç±»å‹éƒ½æ”¯æŒ(popã€add/removeåŠå–äº¤å¹¶é›†å’Œå·®é›†ç­‰)ï¼Œæ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ Redisæ•°æ®éƒ½æ˜¯ç¼“å­˜åœ¨å†…å­˜ä¸­ Redisä¼šå‘¨æœŸæ€§åœ°æŠŠæ•°æ®å†™å…¥ç£ç›˜æˆ–ä¿®æ”¹æ“ä½œå†™å…¥è¿½åŠ çš„è®°å½•æ–‡ä»¶ èƒ½åœ¨æ­¤åŸºç¡€ä¸Šå®ç°master-slave(ä¸»ä»)åŒæ­¥ RedisåŠŸèƒ½ é…åˆå…³ç³»å‹æ•°æ®åº“åšé«˜é€Ÿç¼“å­˜ Rediså…·æœ‰å¤šæ ·çš„æ•°æ®ç»“æ„å­˜å‚¨æŒä¹…åŒ–æ•°æ® å…¶ä»–éƒ¨åˆ†åŠŸèƒ½\nRediså®‰è£… ä»å®˜ç½‘ä¸­ä¸‹è½½redis-6.xx.tar.gzåŒ…(è¯¥æ•™ç¨‹åœ¨linuxä¸­ä½¿ç”¨redis6æ•™å­¦) ç¼–è¯‘rediséœ€è¦gccç¯å¢ƒ ä½¿ç”¨gcc \u0026ndash;versionæŸ¥çœ‹æœåŠ¡å™¨æ˜¯å¦æœ‰gccç¯å¢ƒ å¦‚æœæ²¡æœ‰éœ€è¦è¿›è¡Œå®‰è£… apt install -y gcc æˆ–è€… yum install -y gcc å°†rediså‹ç¼©æ–‡ä»¶è¿›è¡Œè§£å‹ tar -zxvf redis-6xx.tar.gz è¿›å…¥è§£å‹åçš„æ–‡ä»¶å¤¹ï¼Œå¹¶ä½¿ç”¨makeå‘½ä»¤è¿›è¡Œç¼–è¯‘ make å¦‚æœæŠ¥é”™äº†ï¼Œéœ€è¦å…ˆç”¨ä¸‹é¢å‘½ä»¤æ¸…ç†ï¼Œä¹‹åå†è¿›è¡Œç¼–è¯‘ make distclean å®‰è£…redis make install è¿›å…¥/usr/local/binç›®å½•ï¼ŒæŸ¥çœ‹ç›®å½•\nRediså¯åŠ¨ å‰å°å¯åŠ¨ redis-server åå°å¯åŠ¨ åœ¨åˆšæ‰è§£å‹çš„æ–‡ä»¶å¤¹ä¸­ï¼Œæ‹·è´å‡ºredis.confæ–‡ä»¶(è¿™é‡Œæ‹·è´åˆ°/etc/ç›®å½•ä¸‹) cp redis.conf /etc/redis.conf åˆ°etcä¸­ä¿®æ”¹redis.confæ–‡ä»¶ vim /etc/redis.conf # è¿›å…¥ç¼–è¾‘å™¨åä½¿ç”¨ä¸‹é¢å‘½ä»¤è¿›è¡Œæœç´¢å¹¶å›è½¦ /daemonize no å°†noæ”¹ä¸ºyeså¹¶ä¿å­˜ è¿›å…¥/usr/local/binç›®å½•å¯åŠ¨redis redis-server /etc/redis.conf æŸ¥çœ‹è¿›ç¨‹ï¼Œå‘ç°rediså·²ç»å¯åŠ¨ ps -ef | grep redis ä½¿ç”¨redis-cli å®¢æˆ·ç«¯è¿æ¥redis redis-cli keys * ç›¸å…³çŸ¥è¯† # Redis6379çš„ç”±æ¥ äººåMerz åœ¨ä¹å®«æ ¼å¯¹åº”çš„æ•°å­—å°±æ˜¯6379\nRedisé»˜è®¤æœ‰15ä¸ªåº“ï¼Œé»˜è®¤æ•°æ®éƒ½åœ¨æ•°æ®åº“0ä¸­ï¼Œæ‰€æœ‰åº“çš„å¯†ç éƒ½æ˜¯ç›¸åŒçš„ Redisæ˜¯å•çº¿ç¨‹+å¤šè·¯å¤ç”¨æŠ€æœ¯ Redisæ˜¯ä¸²è¡Œæ“ä½œ\nç«è½¦ç«™çš„ä¾‹å­\nå½“1ï¼Œ2ï¼Œ3æ²¡æœ‰ç¥¨çš„æ—¶å€™ï¼Œä¸ç”¨ä¸€ç›´ç­‰å¾…ä¹°ç¥¨ï¼Œå¯ä»¥ç»§ç»­åšè‡ªå·±çš„äº‹æƒ…ï¼Œé»„ç‰›ä¹°åˆ°ç¥¨å°±ä¼šé€šçŸ¥123è¿›è¡Œå–ç¥¨\nMemcachedå’ŒRedisåŒºåˆ« Memcachedæ”¯æŒå•ä¸€æ•°æ®ç±»å‹ï¼ŒRedisæ”¯æŒå¤šæ•°æ®ç±»å‹ Memcachedä¸æ”¯æŒæŒä¹…åŒ– Memcachedç”¨çš„å¤šçº¿ç¨‹+é”çš„æœºåˆ¶ï¼ŒRedisç”¨çš„æ˜¯å•çº¿ç¨‹+å¤šè·¯å¤ç”¨ç¨‹åº End # "},{"id":235,"href":"/zh/docs/life/archive/20121226/","title":"2021å¹´æœ€åä¸€ä¸ªå‘¨æ—¥","section":"å¾€æ—¥å½’æ¡£","content":" è£…å®½å¸¦ # å¤ªæ™šäº†ï¼Œä¸æƒ³å†™äº†- -ã€‚ç®€å•å†™å‡ ä¸ªå­—å§ï¼Œæ»¡å¿ƒæœŸå¾…çš„è£…äº†å®½å¸¦ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æˆ‘æƒ³åƒçš„é‚£ä¹ˆå¿«ä¹ã€‚åè€Œæ‰“äº†ä¸¤æŠŠæ¸¸æˆæ›´éš¾è¿‡äº†ï¼Œéš¾è¿‡çš„æ˜¯æµªè´¹äº†æ—¶é—´ä¹Ÿä»€ä¹ˆéƒ½æ²¡å¾—åˆ°\nå›¾ä¹¦é¦† # ä¸‹åˆè·‘å»å›¾ä¹¦é¦†æ”¶è·å€’æ˜¯æŒºå¤šï¼Œå¯èƒ½æ˜¯æˆ‘ä¸å¤ªç†Ÿæ‚‰ï¼Œå¯¹äºä¹¦æ¶ä¸Šçš„ä¹¦æ²¡æœ‰å¤ªå¤§çš„æ„Ÿè§¦ã€‚ä½†æ˜¯ç¯å¢ƒçœŸçš„å¤ªæ£’äº†ï¼Œå¾ˆå®‰é™ï¼Œæ„Ÿè§‰å¤šå‘å‡ºç‚¹å£°éŸ³æˆ‘éƒ½ä¼šè§‰å¾—ä¸å¥½æ„æ€ï¼Œå¤§å®¶éƒ½å¾ˆè‡ªè§‰ã€‚ä¹Ÿè®¸å¯¹ç»å¸¸ç½‘ä¸Šéƒ½èƒ½æ‰¾åˆ°ç”µå­ä¹¦çœ‹(ç¨‹åºå‘˜çš„äº‹æ€ä¹ˆèƒ½æ˜¯ç›—å‘¢)çš„äººå¸®åŠ©ä¸ä¼šç‰¹åˆ«å¤§ï¼Œä½†å¯¹äºå¾ˆå¤§ä¸€éƒ¨åˆ†äººç»å¯¹å¸®åŠ©ç‰¹åˆ«å¤§ï¼ŒåŒ…æ‹¬å­¦ç”Ÿã€è€å¹´äººã€è¿˜æœ‰ä¸€äº›æ–‡å­¦ç±»ä¹¦ç±é˜…è¯»è€…ç­‰ç­‰(æˆ‘ä¸€ç›´è®¤ä¸ºæ–‡å­¦ç±»çš„ä¸€å®šè¦çº¸è´¨çš„çœ‹èµ·æ¥æ‰æœ‰å‘³é“~)\nå½“ç„¶ï¼Œä»å›¾ä¹¦é¦†å›æ¥æˆ‘åˆæ‰“äº†ä¸¤æŠŠæ¸¸æˆ o_Oï¼Œdota2 yyds!! æ‰“å®Œæ—¥å¸¸å¸è½½ï¼Œå“ˆå“ˆ\næ¯æ¬¡å»å›¾ä¹¦é¦†æˆ‘éƒ½ä¼šæƒ³èµ·é‚£å¥è¯ï¼Œ\u0026quot;ä¸€ä¸ªå›½å®¶ä¸ºå…¶å¹´è½»äººæ‰€æä¾›çš„æ•™è‚²ï¼Œå†³å®šäº†è¿™ä¸ªå›½å®¶æœªæ¥çš„æ ·å­\u0026quot;ã€‚\nå¸Œæœ›èƒ½å¤šåŠç‚¹è¿™æ ·çš„å›¾ä¹¦é¦†ï¼Œå¤§å®¶éƒ½èƒ½å°‘ç‚¹æµ®èºï¼Œå¤šç‚¹æ²‰æ·€ï¼›è™½ç„¶æˆ‘å¹¶ä¸æ˜¯çƒ­å¿ƒå…¬ç›Šäººå£«ï¼Œä½†æˆ‘è¿˜æ˜¯å¸Œæœ›å’±ä»¬å›½å®¶çš„äººæ°‘éƒ½ç”Ÿæ´»çš„è¶Šæ¥è¶Šå¥½ã€‚ä¸è¦è¾œè´Ÿæˆ‘ä»¬æ›¾ç»å—è¿‡çš„è‹¦éš¾ã€‚\n"},{"id":236,"href":"/zh/docs/life/archive/20231021/","title":"æ²‰æ²¦","section":"å¾€æ—¥å½’æ¡£","content":"ç©ç‰©ä¸§å¿—å¹¶éæ˜¯é”™çš„ï¼Œå¦‚æœä½ å‘½é‡Œæ˜¯çš„è¯ã€‚å¯æƒœæˆ‘ä¸æ˜¯ï¼Œæˆ‘æ˜æ˜¾æœ‰å…¶ä»–æ›´ä¸ºé‡è¦çš„äº‹ç­‰ç€æˆ‘å»åšã€‚æˆ‘åº”è¯¥æ˜¯éª¨å­é‡Œçš„è€å®äººã€‚å¦‚æœé¡ºåˆ©çš„è¯æˆ‘åº”è¯¥å±äºç ”ç©¶æ‰€é‚£ç§è€å¹²éƒ¨ï¼Œè‡³å°‘ç°åœ¨æ€ç»´å·²ç»è€åŒ–å¾—è·Ÿä»–ä»¬å·®ä¸å¤šäº†ã€‚\n"}]