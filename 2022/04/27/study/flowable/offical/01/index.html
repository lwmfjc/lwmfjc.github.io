<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"lwmfjc.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="入门">
<meta property="og:type" content="article">
<meta property="og:title" content="Flowable-01-GettingStarted">
<meta property="og:url" content="https://lwmfjc.github.io/2022/04/27/study/flowable/offical/01/index.html">
<meta property="og:site_name" content="随记">
<meta property="og:description" content="入门">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lwmfjc.github.io/attachments/img/ly-20241129104804387.png">
<meta property="og:image" content="https://lwmfjc.github.io/attachments/img/ly-20241129104804852.png">
<meta property="og:image" content="https://lwmfjc.github.io/attachments/img/ly-20241129104805206.png">
<meta property="og:image" content="https://lwmfjc.github.io/attachments/img/ly-20241129104805594.png">
<meta property="og:image" content="https://lwmfjc.github.io/attachments/img/ly-20241129104805948.png">
<meta property="article:published_time" content="2022-04-27T22:32:24.000Z">
<meta property="article:modified_time" content="2022-04-27T22:32:24.000Z">
<meta property="article:author" content="刘易">
<meta property="article:tag" content="flowable官方">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lwmfjc.github.io/attachments/img/ly-20241129104804387.png">


<link rel="canonical" href="https://lwmfjc.github.io/2022/04/27/study/flowable/offical/01/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://lwmfjc.github.io/2022/04/27/study/flowable/offical/01/","path":"2022/04/27/study/flowable/offical/01/","title":"Flowable-01-GettingStarted"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Flowable-01-GettingStarted | 随记</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">随记</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%A5%E9%97%A8"><span class="nav-number">1.</span> <span class="nav-text">入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%B5%81%E5%8A%A8%E6%80%A7"><span class="nav-number">1.1.</span> <span class="nav-text">什么是流动性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Flowable%E5%92%8CActiviti"><span class="nav-number">1.2.</span> <span class="nav-text">Flowable和Activiti</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="nav-number">1.3.</span> <span class="nav-text">构建命令行命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%B5%81%E7%A8%8B%E5%BC%95%E6%93%8E"><span class="nav-number">1.3.1.</span> <span class="nav-text">创建流程引擎</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89"><span class="nav-number">1.3.2.</span> <span class="nav-text">部署流程定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B"><span class="nav-number">1.3.3.</span> <span class="nav-text">启动流程实例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%94%AF%E7%BA%BF%EF%BC%9A%E4%BA%A4%E6%98%93%E6%80%A7-Sidetrack-transactionality"><span class="nav-number">1.3.4.</span> <span class="nav-text">支线：交易性 (Sidetrack: transactionality)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%AE%8C%E6%88%90%E4%BB%BB%E5%8A%A1"><span class="nav-number">1.3.5.</span> <span class="nav-text">查询和完成任务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E5%86%99JavaDelegate"><span class="nav-number">1.3.6.</span> <span class="nav-text">编写JavaDelegate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E5%8E%86%E5%8F%B2%E6%95%B0%E6%8D%AE"><span class="nav-number">1.3.7.</span> <span class="nav-text">处理历史数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%93%E8%AE%BA"><span class="nav-number">1.3.8.</span> <span class="nav-text">结论</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Flowable-REST-API%E5%85%A5%E9%97%A8"><span class="nav-number">1.4.</span> <span class="nav-text">Flowable REST API入门</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AEREST%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.4.1.</span> <span class="nav-text">设置REST应用程序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E5%AE%9A%E4%B9%89-1"><span class="nav-number">1.4.2.</span> <span class="nav-text">部署流程定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B-1"><span class="nav-number">1.4.3.</span> <span class="nav-text">启动流程实例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1%E5%88%97%E8%A1%A8%E5%92%8C%E5%AE%8C%E6%88%90%E4%BB%BB%E5%8A%A1"><span class="nav-number">1.4.4.</span> <span class="nav-text">任务列表和完成任务</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="刘易"
      src="/images/sys/avatar.png">
  <p class="site-author-name" itemprop="name">刘易</p>
  <div class="site-description" itemprop="description">知命不惧 日日自新</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">259</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">45</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/lwmfjc" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;lwmfjc" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=450 src="//music.163.com/outchain/player?type=0&id=33517178&auto=1&height=430"></iframe>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lwmfjc.github.io/2022/04/27/study/flowable/offical/01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/sys/avatar.png">
      <meta itemprop="name" content="刘易">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随记">
      <meta itemprop="description" content="知命不惧 日日自新">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Flowable-01-GettingStarted | 随记">
      <meta itemprop="description" content="入门">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Flowable-01-GettingStarted
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-04-27 22:32:24" itemprop="dateCreated datePublished" datetime="2022-04-27T22:32:24+00:00">2022-04-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">学习</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>14k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>25 分钟</span>
    </span>
</div>

            <div class="post-description">入门</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><h3 id="什么是流动性"><a href="#什么是流动性" class="headerlink" title="什么是流动性"></a>什么是流动性</h3><blockquote>
<p>Flowable 是一个用 Java 编写的轻量级业务流程引擎。Flowable 流程引擎允许您部署 BPMN 2.0 流程定义（用于定义流程的行业 XML 标准）、创建这些流程定义的流程实例、运行查询、访问活动或历史流程实例和相关数据等等。</p>
</blockquote>
<blockquote>
<p>可以使用 Flowable REST API 通过 HTTP 进行通信。还有几个 Flowable 应用程序（Flowable Modeler、Flowable Admin、Flowable IDM 和 Flowable Task）提供开箱即用的示例 UI，用于处理流程和任务。</p>
</blockquote>
<h3 id="Flowable和Activiti"><a href="#Flowable和Activiti" class="headerlink" title="Flowable和Activiti"></a>Flowable和Activiti</h3><p>Flowable是Activiti的一个分支</p>
<h3 id="构建命令行命令"><a href="#构建命令行命令" class="headerlink" title="构建命令行命令"></a>构建命令行命令</h3><h4 id="创建流程引擎"><a href="#创建流程引擎" class="headerlink" title="创建流程引擎"></a>创建流程引擎</h4><p>请假流程如下  </p>
<ul>
<li>员工要求休假数次</li>
<li>经理批准或拒绝请求</li>
<li>之后将模拟再某个外部系统中注册请求，并向员工发送一封包含结果的邮件</li>
</ul>
<p>创建一个空的Mave项目，并添加依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.flowable<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flowable-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.176<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.29<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!--当版本号&gt;=8.0.22时会报date转字符串的错误--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加一个带有Main方法的类</p>
<p>这里实例化一个<strong>ProcessEngine</strong>实例，一般只需要实例化一次，是通过<strong>ProcessEngineConfiguration</strong>创建的，用来配置和调整流程引擎的配置</p>
<ul>
<li><em>ProcessEngineConfiguration</em>也可以使用配置 XML 文件创建</li>
<li><em>ProcessEngineConfiguration</em>需要的最低配置是与数据库的 JDBC 连接</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.flowable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.ProcessEngine;</span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.ProcessEngineConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HolidayRequest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//这里改用mysql，注意后面的nullCatalogMeansCurrent=true</span></span><br><span class="line">        <span class="comment">//注意，pom需要添加mysql驱动依赖</span></span><br><span class="line">        <span class="type">ProcessEngineConfiguration</span> <span class="variable">cfg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandaloneProcessEngineConfiguration</span>()</span><br><span class="line">                .setJdbcUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/flowable_official?useUnicode=true&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;&amp;characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghai&amp;allowMultiQueries=true&quot;</span></span><br><span class="line">                        +<span class="string">&quot;&amp;nullCatalogMeansCurrent=true&quot;</span></span><br><span class="line">                )</span><br><span class="line">                .setJdbcUsername(<span class="string">&quot;root&quot;</span>)</span><br><span class="line">                .setJdbcPassword(<span class="string">&quot;123456&quot;</span>)</span><br><span class="line">                .setJdbcDriver(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>)</span><br><span class="line">                .setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE);</span><br><span class="line">        <span class="comment">/* //这是官网，用的h2</span></span><br><span class="line"><span class="comment">        ProcessEngineConfiguration cfg = new StandaloneProcessEngineConfiguration()</span></span><br><span class="line"><span class="comment">                .setJdbcUrl(&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=-1&quot;)</span></span><br><span class="line"><span class="comment">                .setJdbcUsername(&quot;sa&quot;)</span></span><br><span class="line"><span class="comment">                .setJdbcPassword(&quot;&quot;)</span></span><br><span class="line"><span class="comment">                .setJdbcDriver(&quot;org.h2.Driver&quot;)</span></span><br><span class="line"><span class="comment">                .setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE);*/</span></span><br><span class="line"></span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> cfg.buildProcessEngine();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行后会出现slf4j的警告，添加依赖并编写配置文件即可</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置文件</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">DEBUG, CA</span></span><br><span class="line"><span class="attr">log4j.appender.CA</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.CA.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.CA.layout.ConversionPattern</span>=<span class="string">%d&#123;hh:mm:ss,SSS&#125; [%t] %-5p %c %x - %m%n</span></span><br></pre></td></tr></table></figure>

<p>重运行程序无警告</p>
<p>会自动往mysql添加一些表及数据</p>
<h4 id="部署流程定义"><a href="#部署流程定义" class="headerlink" title="部署流程定义"></a>部署流程定义</h4><p>flowable 引擎希望以 BPMN 2.0 格式定义流程，这是一种在行业中被广泛接受的 XML 标准。Flowable术语称之为<strong>流程定义</strong> （可以理解成许多执行的蓝图），从流程定义中可以启动许多<strong>流程实例</strong> </p>
<p>流程定义了请假假期所涉及的不同步骤，而一个流程实例与一位特定员工的假期请相匹配。</p>
<blockquote>
<p>BPMN 2.0 存储为 XML，但它也有一个可视化部分：它以标准方式定义每个不同的步骤类型（人工任务、自动服务调用等）如何表示，以及如何将这些不同的步骤连接到彼此。通过这种方式，BPMN 2.0 标准允许技术人员和业务人员以双方都理解的方式就业务流程进行交流。</p>
</blockquote>
<p>我们将使用的流程定义</p>
<p><img src="/attachments/img/ly-20241129104804387.png"></p>
<ul>
<li>假设该过程是通过提供一些信息开始的</li>
<li>左边的圆圈称为<strong>开始事件</strong></li>
<li>第一个矩形是<strong>用户任务</strong>（经理必须执行，批准或拒绝）</li>
<li>根据经理决定，<strong>专用网关</strong> （带有十字菱形）会将流程实例路由到批准或拒绝路径</li>
<li>如果获得批准，必须在某个外部系统中注册请求，然后再次为原始员工执行用户任务，通知他们该决定</li>
<li>如果被拒绝，则会向员工发送一封电子邮件，通知他们这一点</li>
</ul>
<p>此类流程定义使用可视化建模工具建模，例如Flowable Designer（Eclipse）或FlowableModeler（Web应用程序）</p>
<ul>
<li><p>BPMN 2.0 及其概念<br>下面的holiday-request.bmpn20.xm文件放在src&#x2F;main&#x2F;resouces中</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">definitions</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:bpmndi</span>=<span class="string">&quot;http://www.omg.org/spec/BPMN/20100524/DI&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:omgdc</span>=<span class="string">&quot;http://www.omg.org/spec/DD/20100524/DC&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:omgdi</span>=<span class="string">&quot;http://www.omg.org/spec/DD/20100524/DI&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:flowable</span>=<span class="string">&quot;http://flowable.org/bpmn&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">typeLanguage</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">expressionLanguage</span>=<span class="string">&quot;http://www.w3.org/1999/XPath&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">targetNamespace</span>=<span class="string">&quot;http://www.flowable.org/processdef&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">process</span> <span class="attr">id</span>=<span class="string">&quot;holidayRequest&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Holiday Request&quot;</span> <span class="attr">isExecutable</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">startEvent</span> <span class="attr">id</span>=<span class="string">&quot;startEvent&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--线条指向--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">sourceRef</span>=<span class="string">&quot;startEvent&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;approveTask&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">id</span>=<span class="string">&quot;approveTask&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Approve or reject request&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--线条指向--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">sourceRef</span>=<span class="string">&quot;approveTask&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;decision&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--网关--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusiveGateway</span> <span class="attr">id</span>=<span class="string">&quot;decision&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--线条指向，下面有两个分支--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--线条指向approved--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">sourceRef</span>=<span class="string">&quot;decision&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;externalSystemCall&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[</span><br><span class="line">          $&#123;approved&#125;</span><br><span class="line">        ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--线条指向!approved--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">sourceRef</span>=<span class="string">&quot;decision&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;sendRejectionMail&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">conditionExpression</span> <span class="attr">xsi:type</span>=<span class="string">&quot;tFormalExpression&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[</span><br><span class="line">          $&#123;!approved&#125;</span><br><span class="line">        ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">conditionExpression</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--分支1--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">serviceTask</span> <span class="attr">id</span>=<span class="string">&quot;externalSystemCall&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Enter holidays in external system&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">flowable:class</span>=<span class="string">&quot;org.flowable.CallExternalSystemDelegate&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--线条指向--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">sourceRef</span>=<span class="string">&quot;externalSystemCall&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;holidayApprovedTask&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--用户任务--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">id</span>=<span class="string">&quot;holidayApprovedTask&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Holiday approved&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--线条指向--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">sourceRef</span>=<span class="string">&quot;holidayApprovedTask&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;approveEnd&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--服务任务--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">serviceTask</span> <span class="attr">id</span>=<span class="string">&quot;sendRejectionMail&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Send out rejection email&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">flowable:class</span>=<span class="string">&quot;org.flowable.SendRejectionMail&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--线条指向--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">sourceRef</span>=<span class="string">&quot;sendRejectionMail&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;rejectEnd&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--分支2结束--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">endEvent</span> <span class="attr">id</span>=<span class="string">&quot;approveEnd&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--分支2结束--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">endEvent</span> <span class="attr">id</span>=<span class="string">&quot;rejectEnd&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">process</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">definitions</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>解释</p>
<ul>
<li>该文件与BPMN2.0标准规范完全兼容</li>
<li>每个步骤（活动 activity），都有一个id属性，在XML中，该属性提供唯一标识符<br>name属性为可选的名称，增加了可视化图表的可读性</li>
<li>活动通过**顺序流(sequenceFlow)**连接，即可视图中的定向箭头。执行流程实例时，执行将从开始事件流向下一个活动，且遵循顺序流</li>
<li>离开<em>专有网关</em>的<em>序列流</em>（带有 X 的菱形）显然是特殊的：两者都有一个以<em>表达式</em>形式定义的<em>条件</em>（见第 25 和 32 行）。当流程实例执行到达此<em>gateway</em>时，将评估<em>条件</em>并采用第一个解析为<em>true</em>的条件。这就是这里<em>独有</em>的含义：只选择一个。如果需要不同的路由行为，当然也可以使用其他类型的网关<ul>
<li>表达式以${approved}的形式，是${approved &#x3D;&#x3D; true}的简写</li>
<li>approved称为过程变量，他与流程实例一起存储（持久数据为，在流程实例的声明周期内使用），意味着必须在流程实例的某个时间点（提交经理用户任务时，即结点<userTask id="approveTask" />[Flowable术语，完成])设置此流程变量）</li>
</ul>
</li>
</ul>
</li>
<li><p>部署流程<br>使用RepositoryService，它可以从ProcessEngine对象中检索，通过传递XML文件的位置并调用deploy()方法来执行它来创建一个新的Deployment</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line"><span class="comment">//部署流程</span></span><br><span class="line"><span class="type">Deployment</span> <span class="variable">deployment</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">  .addClasspathResource(<span class="string">&quot;holiday-request.bpmn20.xml&quot;</span>)</span><br><span class="line">  .deploy();</span><br><span class="line">        <span class="comment">//打印部署id</span></span><br><span class="line">System.out.println(<span class="string">&quot;Found deployment id : &quot;</span> + deployment.getId());</span><br></pre></td></tr></table></figure>



<p>每次部署的id存在act_re_deployment表中<br><img src="/attachments/img/ly-20241129104804852.png"></p>
</li>
<li><p>通过API查询来验证引擎是否知道流程定义</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ProcessDefinition</span> <span class="variable">processDefinition</span> <span class="operator">=</span> repositoryService.createProcessDefinitionQuery()</span><br><span class="line">  .deploymentId(deployment.getId())</span><br><span class="line">  .singleResult();</span><br><span class="line">System.out.println(<span class="string">&quot;Found process definition : &quot;</span> + processDefinition.getName());</span><br></pre></td></tr></table></figure>
</li>
<li></li>
</ul>
</li>
</ul>
<h4 id="启动流程实例"><a href="#启动流程实例" class="headerlink" title="启动流程实例"></a>启动流程实例</h4><p>现在已经将流程定义部署到流程引擎中了，所以可以将此<strong>流程定义</strong>作为“蓝图”来启动流程实例</p>
<p>启动前提供一些<em>初始流程变量</em> ，通常，当流程自动触发时，将通过呈现给用户的表单或者通过REST API获得这些信息，本例为保持简单使用java.util.Scanner在命令中简单输入一些数据</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Scanner scanner= <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;Who are you?&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">employee</span> <span class="operator">=</span> scanner.nextLine();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;How many holidays do you want to request?&quot;</span>);</span><br><span class="line"><span class="type">Integer</span> <span class="variable">nrOfHolidays</span> <span class="operator">=</span> Integer.valueOf(scanner.nextLine());</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;Why do you need them?&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">description</span> <span class="operator">=</span> scanner.nextLine();</span><br></pre></td></tr></table></figure>

<p>接下来，通过RuntimeService启动一个流程实例，流程实例使用key启动，此键与BPMN2.0 XML文件中设置的id属性匹配</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">RuntimeService</span> <span class="variable">runtimeService</span> <span class="operator">=</span> processEngine.getRuntimeService();</span><br><span class="line"></span><br><span class="line">Map&lt;String, Object&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line">variables.put(<span class="string">&quot;employee&quot;</span>, employee);</span><br><span class="line">variables.put(<span class="string">&quot;nrOfHolidays&quot;</span>, nrOfHolidays);</span><br><span class="line">variables.put(<span class="string">&quot;description&quot;</span>, description);</span><br><span class="line"><span class="type">ProcessInstance</span> <span class="variable">processInstance</span> <span class="operator">=</span></span><br><span class="line">  runtimeService.startProcessInstanceByKey(<span class="string">&quot;holidayRequest&quot;</span>, variables);</span><br></pre></td></tr></table></figure>

<ul>
<li>流程实例启动时，会创建一个<strong>执行(execution)<strong>并将其放入</strong>start event启动事件</strong>中。之后，此<strong>执行(execution)<strong>遵守</strong>user task 用户任务</strong>的<strong>序列流 sequence flow</strong>以供经理批准并执行<strong>用户任务user task</strong>行为</li>
<li>此行为将在数据库中创建一个任务，稍后可以使用查询找到该任务</li>
<li>用户任务处于<em>等待状态</em>，引擎将停止进一步执行任何操作，返回 API 调用</li>
</ul>
<h4 id="支线：交易性-Sidetrack-transactionality"><a href="#支线：交易性-Sidetrack-transactionality" class="headerlink" title="支线：交易性 (Sidetrack: transactionality)"></a>支线：交易性 (Sidetrack: transactionality)</h4><ul>
<li>当您进行 Flowable API 调用时，默认情况下，一切都是同步<strong>synchronous</strong>的，并且是同一事务的一部分。这意味着，当方法调用返回时，将启动并提交事务。</li>
<li>当一个流程实例启动时，从流程实例启动到下一个<em>等待状态</em>会有<strong>一个数据库事务</strong>。在本例中，这是第一个用户任务。当引擎到达这个用户任务时，状态被持久化到数据库中并且事务被提交并且API调用返回</li>
<li>在 Flowable 中，当继续一个流程实例时，总会有一个数据库事务从前一个<em>等待状态</em>转到下一个<em>等待状态</em>。</li>
<li></li>
</ul>
<h4 id="查询和完成任务"><a href="#查询和完成任务" class="headerlink" title="查询和完成任务"></a>查询和完成任务</h4><ul>
<li><p>为用户任务配置分配</p>
<ul>
<li><p>[第一个任务进入”经理”组]</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">userTask</span> <span class="attr">id</span>=<span class="string">&quot;approveTask&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Approve or reject request&quot;</span> <span class="attr">flowable:candidateGroups</span>=<span class="string">&quot;managers&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>第二个任务的<em>受让人assignee</em>属性<br>基于我们在流程实例启动时传递的流程变量的动态分配</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">userTask</span> <span class="attr">id</span>=<span class="string">&quot;holidayApprovedTask&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Holiday approved&quot;</span> <span class="attr">flowable:assignee</span>=<span class="string">&quot;$&#123;employee&#125;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>查询并返回”managers”组的任务</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line">List&lt;Task&gt; tasks = taskService.createTaskQuery().taskCandidateGroup(<span class="string">&quot;managers&quot;</span>).list();</span><br><span class="line">System.out.println(<span class="string">&quot;You have &quot;</span> + tasks.size() + <span class="string">&quot; tasks:&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;tasks.size(); i++) &#123;</span><br><span class="line">  System.out.println((i+<span class="number">1</span>) + <span class="string">&quot;) &quot;</span> + tasks.get(i).getName());<span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><img src="/attachments/img/ly-20241129104805206.png" alt="ly-20241129104805206"></p>
<p>有三个是因为启动了三个实例</p>
</li>
<li><p>获取特定的流程实例变量，并在屏幕上显示实际请求</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;Which task would you like to complete?&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">taskIndex</span> <span class="operator">=</span> Integer.valueOf(scanner.nextLine());</span><br><span class="line"><span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> tasks.get(taskIndex - <span class="number">1</span>);</span><br><span class="line">Map&lt;String, Object&gt; processVariables = taskService.getVariables(task.getId());</span><br><span class="line">System.out.println(processVariables.get(<span class="string">&quot;employee&quot;</span>) + <span class="string">&quot; wants &quot;</span> +</span><br><span class="line">    processVariables.get(<span class="string">&quot;nrOfHolidays&quot;</span>) + <span class="string">&quot; of holidays. Do you approve this?&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置variables让经理批准</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="variable">approved</span> <span class="operator">=</span> scanner.nextLine().toLowerCase().equals(<span class="string">&quot;y&quot;</span>);</span><br><span class="line">variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line">variables.put(<span class="string">&quot;approved&quot;</span>, approved);</span><br><span class="line"><span class="comment">//经理完成任务</span></span><br><span class="line">taskService.complete(task.getId(), variables);</span><br></pre></td></tr></table></figure>

<p>$\color{red}该任务现已完成，并且基于”approved”流程变量选择离开专用网关的两条路径之一$</p>
<p><img src="/attachments/img/ly-20241129104805594.png"></p>
</li>
</ul>
</li>
</ul>
<h4 id="编写JavaDelegate"><a href="#编写JavaDelegate" class="headerlink" title="编写JavaDelegate"></a>编写JavaDelegate</h4><ul>
<li><p>实现在请求被批准时将执行的自动逻辑，在BPMN2.0 XML中，这是一个<strong>服务任务</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">serviceTask</span> <span class="attr">id</span>=<span class="string">&quot;externalSystemCall&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Enter holidays in external system&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">flowable:class</span>=<span class="string">&quot;org.flowable.CallExternalSystemDelegate&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里指定了具体实现类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.flowable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.delegate.DelegateExecution;</span><br><span class="line"><span class="keyword">import</span> org.flowable.engine.delegate.JavaDelegate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CallExternalSystemDelegate</span> <span class="keyword">implements</span> <span class="title class_">JavaDelegate</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(DelegateExecution execution)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Calling the external system for employee &quot;</span></span><br><span class="line">            + execution.getVariable(<span class="string">&quot;employee&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>当<strong>执行execution</strong>到达<strong>service tast服务任务</strong>时，BPMN 2.0 XML中引用的类被实例化并被调用</p>
</li>
<li><p>运行，发现自定义逻辑确实已执行</p>
</li>
</ul>
<h4 id="处理历史数据"><a href="#处理历史数据" class="headerlink" title="处理历史数据"></a>处理历史数据</h4><p>Flowable引擎会自动存储所有流程实例的<strong>审计数据audit data</strong> 或<strong>历史数据historical data</strong></p>
<p>下面，显示一直在执行的流程实例的持续时间，从ProcessEngine获取HistoryService并创建历史活动查询。这里添加了过滤–1 仅针对一个特定流程实例的活动 –2 只有已经完成的活动</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">HistoryService</span> <span class="variable">historyService</span> <span class="operator">=</span> processEngine.getHistoryService();</span><br><span class="line">List&lt;HistoricActivityInstance&gt; activities =</span><br><span class="line">  historyService.createHistoricActivityInstanceQuery()</span><br><span class="line">   .processInstanceId(processInstance.getId())</span><br><span class="line">   .finished()</span><br><span class="line">   .orderByHistoricActivityInstanceEndTime().asc()</span><br><span class="line">   .list();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (HistoricActivityInstance activity : activities) &#123;</span><br><span class="line">  System.out.println(activity.getActivityId() + <span class="string">&quot; took &quot;</span></span><br><span class="line">    + activity.getDurationInMillis() + <span class="string">&quot; milliseconds&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h4><p>本教程介绍了各种 Flowable 和 BPMN 2.0 概念和术语，同时还演示了如何以编程方式使用 Flowable API。</p>
<h3 id="Flowable-REST-API入门"><a href="#Flowable-REST-API入门" class="headerlink" title="Flowable REST API入门"></a>Flowable REST API入门</h3><h4 id="设置REST应用程序"><a href="#设置REST应用程序" class="headerlink" title="设置REST应用程序"></a>设置REST应用程序</h4><p>使用flowable-rest.war ,  java -jar flowable-rest.war</p>
<p>测试是否运行成功</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl --user rest-admin:test http://localhost:8080/flowable-rest/service/management/engine</span><br></pre></td></tr></table></figure>

<h4 id="部署流程定义-1"><a href="#部署流程定义-1" class="headerlink" title="部署流程定义"></a>部署流程定义</h4><ul>
<li><p>先切到该文件夹下<br><img src="/attachments/img/ly-20241129104805948.png"></p>
</li>
<li><p>使用下面命令启动flowable-rest</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar flowable-rest.war</span><br></pre></td></tr></table></figure>
</li>
<li><p>部署流程定义</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl --user rest-admin:test -F &quot;file=@holiday-request.bpmn20.xml&quot; http://localhost:8080/flowable-rest/service/repository/deployments</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看流程是否部署</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl --user rest-admin:test http://localhost:8080/flowable-rest/service/repository/process-definitions</span><br></pre></td></tr></table></figure>

<ul>
<li>将返回一个列表，列表每个元素是当前部署到引擎的所有流程定义</li>
</ul>
</li>
</ul>
<h4 id="启动流程实例-1"><a href="#启动流程实例-1" class="headerlink" title="启动流程实例"></a>启动流程实例</h4><ul>
<li><p>命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl --user rest-admin:test -H &quot;Content-Type: application/json&quot; -X POST -d &#x27;&#123; &quot;processDefinitionKey&quot;:&quot;holidayRequest&quot;, &quot;variables&quot;: [ &#123; &quot;name&quot;:&quot;employee&quot;, &quot;value&quot;: &quot;John Doe&quot; &#125;, &#123; &quot;name&quot;:&quot;nrOfHolidays&quot;, &quot;value&quot;: 7 &#125;]&#125;&#x27; http://localhost:8080/flowable-rest/service/runtime/process-instances</span><br></pre></td></tr></table></figure>

<p>windows中会报错…估计是没转义啥的原因<br>将返回</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;43&quot;</span><span class="punctuation">,</span><span class="attr">&quot;url&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://localhost:8080/flowable-rest/service/runtime/process-instances/43&quot;</span><span class="punctuation">,</span><span class="attr">&quot;businessKey&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;suspended&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;ended&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;processDefinitionId&quot;</span><span class="punctuation">:</span><span class="string">&quot;holidayRequest:1:42&quot;</span><span class="punctuation">,</span><span class="attr">&quot;processDefinitionUrl&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://localhost:8080/flowable-rest/service/repository/process-definitions/holidayRequest:1:42&quot;</span><span class="punctuation">,</span><span class="attr">&quot;activityId&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;variables&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;tenantId&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;completed&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="任务列表和完成任务"><a href="#任务列表和完成任务" class="headerlink" title="任务列表和完成任务"></a>任务列表和完成任务</h4><ul>
<li><p>获取manager经理组的所有任务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl --user rest-admin:test -H &quot;Content-Type: application/json&quot; -X POST -d &#x27;&#123; &quot;candidateGroup&quot; : &quot;managers&quot; &#125;&#x27; http://localhost:8080/flowable-rest/service/query/tasks</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用命令完成一个任务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl --user rest-admin:test -H &quot;Content-Type: application/json&quot; -X POST -d &#x27;&#123; &quot;action&quot; : &quot;complete&quot;, &quot;variables&quot; : [ &#123; &quot;name&quot; : &quot;approved&quot;, &quot;value&quot; : true&#125; ]  &#125;&#x27; http://localhost:8080/flowable-rest/service/runtime/tasks/25</span><br></pre></td></tr></table></figure>

<ul>
<li><p>这里会报下面的错</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;message&quot;</span><span class="punctuation">:</span><span class="string">&quot;Internal server error&quot;</span><span class="punctuation">,</span><span class="attr">&quot;exception&quot;</span><span class="punctuation">:</span><span class="string">&quot;couldn&#x27;t instantiate class org.flowable.CallExternalSystemDelegate&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>解决办法</p>
<blockquote>
<p>这意味着引擎找不到服务任务中引用的 CallExternalSystemDelegate 类。为了解决这个问题，需要将该类放在应用程序的类路径中（这将需要重新启动）。按照本节所述创建类，将其打包为JAR，并将其放在Tomcat的webapps文件夹下的flowable-rest文件夹的WEB-INF&#x2F;lib文件夹中。</p>
</blockquote>
</li>
</ul>
</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/flowable%E5%AE%98%E6%96%B9/" rel="tag"># flowable官方</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/04/23/study/algorithm/algorithhms_4th/2.1.2-2.1.3/" rel="prev" title="算法红皮书 2.1.2-2.1.3">
                  <i class="fa fa-angle-left"></i> 算法红皮书 2.1.2-2.1.3
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/04/29/study/flowable/offical/02/" rel="next" title="Flowable-02-Configuration">
                  Flowable-02-Configuration <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">刘易</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">1.5m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">46:31</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.3.0/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>



  <script src="/js/third-party/fancybox.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"lwmfjc/blog.comment","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
